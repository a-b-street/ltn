var gS=Object.defineProperty;var _S=(e,t,n)=>t in e?gS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Wn=(e,t,n)=>(_S(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const u of r)if(u.type==="childList")for(const p of u.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&i(p)}).observe(document,{childList:!0,subtree:!0});function n(r){const u={};return r.integrity&&(u.integrity=r.integrity),r.referrerPolicy&&(u.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?u.credentials="include":r.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function i(r){if(r.ep)return;r.ep=!0;const u=n(r);fetch(r.href,u)}})();function Oe(){}function Ir(e,t){for(const n in t)e[n]=t[n];return e}function Lb(e){return e()}function kv(){return Object.create(null)}function Xr(e){e.forEach(Lb)}function pg(e){return typeof e=="function"}function rn(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let Tm;function Br(e,t){return e===t?!0:(Tm||(Tm=document.createElement("a")),Tm.href=t,e===Tm.href)}function yS(e){return Object.keys(e).length===0}function Mb(e,...t){if(e==null){for(const i of t)i(void 0);return Oe}const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function Pb(e){let t;return Mb(e,n=>t=n)(),t}function Ee(e,t,n){e.$$.on_destroy.push(Mb(t,n))}function Vr(e,t,n,i){if(e){const r=Ab(e,t,n,i);return e[0](r)}}function Ab(e,t,n,i){return e[1]&&i?Ir(n.ctx.slice(),e[1](i(t))):n.ctx}function Ur(e,t,n,i){if(e[2]&&i){const r=e[2](i(n));if(t.dirty===void 0)return r;if(typeof r=="object"){const u=[],p=Math.max(t.dirty.length,r.length);for(let a=0;a<p;a+=1)u[a]=t.dirty[a]|r[a];return u}return t.dirty|r}return t.dirty}function Gr(e,t,n,i,r,u){if(r){const p=Ab(t,n,i,u);e.p(p,r)}}function qr(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let i=0;i<n;i++)t[i]=-1;return t}return-1}function vS(e){const t={};for(const n in e)t[n]=!0;return t}function jm(e){return e??""}function mn(e,t,n){return e.set(n),t}function K_(e){return e&&pg(e.destroy)?e.destroy:Oe}const bS=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function vt(e,t){e.appendChild(t)}function Ot(e,t,n){e.insertBefore(t,n||null)}function Rt(e){e.parentNode&&e.parentNode.removeChild(e)}function ad(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function Lt(e){return document.createElement(e)}function jl(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function He(e){return document.createTextNode(e)}function te(){return He(" ")}function bs(){return He("")}function Se(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}function xS(e){return function(t){return t.preventDefault(),e.call(this,t)}}function Vt(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function wS(e){return Array.from(e.childNodes)}function Yi(e,t){t=""+t,e.data!==t&&(e.data=t)}function Vf(e,t){e.value=t??""}function ul(e,t,n,i){n==null?e.style.removeProperty(t):e.style.setProperty(t,n,i?"important":"")}function Nv(e,t,n){for(let i=0;i<e.options.length;i+=1){const r=e.options[i];if(r.__value===t){r.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function SS(e){const t=e.querySelector(":checked");return t&&t.__value}function cl(e,t,n){e.classList.toggle(t,!!n)}function ES(e,t,{bubbles:n=!1,cancelable:i=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:i})}let Uf;function Df(e){Uf=e}function ld(){if(!Uf)throw new Error("Function called outside component initialization");return Uf}function ud(e){ld().$$.on_mount.push(e)}function Ds(e){ld().$$.on_destroy.push(e)}function ep(){const e=ld();return(t,n,{cancelable:i=!1}={})=>{const r=e.$$.callbacks[t];if(r){const u=ES(t,n,{cancelable:i});return r.slice().forEach(p=>{p.call(e,u)}),!u.defaultPrevented}return!0}}function kb(e,t){return ld().$$.context.set(e,t),t}function IS(e){return ld().$$.context.get(e)}function ui(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(i=>i.call(this,t))}const Ch=[],yr=[];let Ph=[];const J_=[],Nb=Promise.resolve();let Q_=!1;function Db(){Q_||(Q_=!0,Nb.then(Rb))}function CS(){return Db(),Nb}function Zm(e){Ph.push(e)}function Nu(e){J_.push(e)}const V_=new Set;let wh=0;function Rb(){if(wh!==0)return;const e=Uf;do{try{for(;wh<Ch.length;){const t=Ch[wh];wh++,Df(t),TS(t.$$)}}catch(t){throw Ch.length=0,wh=0,t}for(Df(null),Ch.length=0,wh=0;yr.length;)yr.pop()();for(let t=0;t<Ph.length;t+=1){const n=Ph[t];V_.has(n)||(V_.add(n),n())}Ph.length=0}while(Ch.length);for(;J_.length;)J_.pop()();Q_=!1,V_.clear(),Df(e)}function TS(e){if(e.fragment!==null){e.update(),Xr(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Zm)}}function LS(e){const t=[],n=[];Ph.forEach(i=>e.indexOf(i)===-1?t.push(i):n.push(i)),n.forEach(i=>i()),Ph=t}const Fm=new Set;let _c;function Bi(){_c={r:0,c:[],p:_c}}function Vi(){_c.r||Xr(_c.c),_c=_c.p}function Ct(e,t){e&&e.i&&(Fm.delete(e),e.i(t))}function At(e,t,n,i){if(e&&e.o){if(Fm.has(e))return;Fm.add(e),_c.c.push(()=>{Fm.delete(e),i&&(n&&e.d(1),i())}),e.o(t)}else i&&i()}function aa(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function MS(e,t){At(e,1,1,()=>{t.delete(e.key)})}function PS(e,t,n,i,r,u,p,a,_,x,S,L){let k=e.length,D=u.length,F=k;const K={};for(;F--;)K[e[F].key]=F;const W=[],Q=new Map,U=new Map,X=[];for(F=D;F--;){const ct=L(r,u,F),ht=n(ct);let rt=p.get(ht);rt?i&&X.push(()=>rt.p(ct,t)):(rt=x(ht,ct),rt.c()),Q.set(ht,W[F]=rt),ht in K&&U.set(ht,Math.abs(F-K[ht]))}const Y=new Set,pt=new Set;function gt(ct){Ct(ct,1),ct.m(a,S),p.set(ct.key,ct),S=ct.first,D--}for(;k&&D;){const ct=W[D-1],ht=e[k-1],rt=ct.key,Et=ht.key;ct===ht?(S=ct.first,k--,D--):Q.has(Et)?!p.has(rt)||Y.has(rt)?gt(ct):pt.has(Et)?k--:U.get(rt)>U.get(Et)?(pt.add(rt),gt(ct)):(Y.add(Et),k--):(_(ht,p),k--)}for(;k--;){const ct=e[k];Q.has(ct.key)||_(ct,p)}for(;D;)gt(W[D-1]);return Xr(X),W}function Ob(e,t){const n={},i={},r={$$scope:1};let u=e.length;for(;u--;){const p=e[u],a=t[u];if(a){for(const _ in p)_ in a||(i[_]=1);for(const _ in a)r[_]||(n[_]=a[_],r[_]=1);e[u]=a}else for(const _ in p)r[_]=1}for(const p in i)p in n||(n[p]=void 0);return n}function Du(e,t,n){const i=e.$$.props[t];i!==void 0&&(e.$$.bound[i]=n,n(e.$$.ctx[i]))}function ee(e){e&&e.c()}function Qt(e,t,n){const{fragment:i,after_update:r}=e.$$;i&&i.m(t,n),Zm(()=>{const u=e.$$.on_mount.map(Lb).filter(pg);e.$$.on_destroy?e.$$.on_destroy.push(...u):Xr(u),e.$$.on_mount=[]}),r.forEach(Zm)}function $t(e,t){const n=e.$$;n.fragment!==null&&(LS(n.after_update),Xr(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function AS(e,t){e.$$.dirty[0]===-1&&(Ch.push(e),Db(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function un(e,t,n,i,r,u,p=null,a=[-1]){const _=Uf;Df(e);const x=e.$$={fragment:null,ctx:[],props:u,update:Oe,not_equal:r,bound:kv(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(_?_.$$.context:[])),callbacks:kv(),dirty:a,skip_bound:!1,root:t.target||_.$$.root};p&&p(x.root);let S=!1;if(x.ctx=n?n(e,t.props||{},(L,k,...D)=>{const F=D.length?D[0]:k;return x.ctx&&r(x.ctx[L],x.ctx[L]=F)&&(!x.skip_bound&&x.bound[L]&&x.bound[L](F),S&&AS(e,L)),k}):[],x.update(),S=!0,Xr(x.before_update),x.fragment=i?i(x.ctx):!1,t.target){if(t.hydrate){const L=wS(t.target);x.fragment&&x.fragment.l(L),L.forEach(Rt)}else x.fragment&&x.fragment.c();t.intro&&Ct(e.$$.fragment),Qt(e,t.target,t.anchor),Rb()}Df(_)}class cn{constructor(){Wn(this,"$$");Wn(this,"$$set")}$destroy(){$t(this,1),this.$destroy=Oe}$on(t,n){if(!pg(n))return Oe;const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(n),()=>{const r=i.indexOf(n);r!==-1&&i.splice(r,1)}}$set(t){this.$$set&&!yS(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const kS="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(kS);let me;const Vl=new Array(128).fill(void 0);Vl.push(void 0,null,!0,!1);function pn(e){return Vl[e]}let Rf=Vl.length;function NS(e){e<132||(Vl[e]=Rf,Rf=e)}function ps(e){const t=pn(e);return NS(e),t}let Ms=0,Ef=null;function Ah(){return(Ef===null||Ef.byteLength===0)&&(Ef=new Uint8Array(me.memory.buffer)),Ef}const Bm=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},DS=typeof Bm.encodeInto=="function"?function(e,t){return Bm.encodeInto(e,t)}:function(e,t){const n=Bm.encode(e);return t.set(n),{read:e.length,written:n.length}};function Bl(e,t,n){if(n===void 0){const a=Bm.encode(e),_=t(a.length,1)>>>0;return Ah().subarray(_,_+a.length).set(a),Ms=a.length,_}let i=e.length,r=t(i,1)>>>0;const u=Ah();let p=0;for(;p<i;p++){const a=e.charCodeAt(p);if(a>127)break;u[r+p]=a}if(p!==i){p!==0&&(e=e.slice(p)),r=n(r,i,i=p+e.length*3,1)>>>0;const a=Ah().subarray(r+p,r+i),_=DS(e,a);p+=_.written}return Ms=p,r}function Th(e){return e==null}let If=null;function Je(){return(If===null||If.byteLength===0)&&(If=new Int32Array(me.memory.buffer)),If}const zb=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&zb.decode();function ea(e,t){return e=e>>>0,zb.decode(Ah().subarray(e,e+t))}function ai(e){Rf===Vl.length&&Vl.push(Vl.length+1);const t=Rf;return Rf=Vl[t],Vl[t]=e,t}let Cf=null;function Fb(){return(Cf===null||Cf.byteLength===0)&&(Cf=new Float64Array(me.memory.buffer)),Cf}let Tf=null;function RS(){return(Tf===null||Tf.byteLength===0)&&(Tf=new BigInt64Array(me.memory.buffer)),Tf}function $_(e){const t=typeof e;if(t=="number"||t=="boolean"||e==null)return`${e}`;if(t=="string")return`"${e}"`;if(t=="symbol"){const r=e.description;return r==null?"Symbol":`Symbol(${r})`}if(t=="function"){const r=e.name;return typeof r=="string"&&r.length>0?`Function(${r})`:"Function"}if(Array.isArray(e)){const r=e.length;let u="[";r>0&&(u+=$_(e[0]));for(let p=1;p<r;p++)u+=", "+$_(e[p]);return u+="]",u}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let i;if(n.length>1)i=n[1];else return toString.call(e);if(i=="Object")try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:i}function OS(e,t){const n=t(e.length*1,1)>>>0;return Ah().set(e,n/1),Ms=e.length,n}function zS(e,t){return e=e>>>0,Fb().subarray(e/8,e/8+t)}function FS(e,t){return e=e>>>0,Ah().subarray(e/1,e/1+t)}function mc(e,t){try{return e.apply(this,t)}catch(n){me.__wbindgen_exn_store(ai(n))}}class BS{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();me.__wbg_ltn_free(t)}constructor(t,n){try{const _=me.__wbindgen_add_to_stack_pointer(-16),x=OS(t,me.__wbindgen_malloc),S=Ms;var i=Th(n)?0:Bl(n,me.__wbindgen_malloc,me.__wbindgen_realloc),r=Ms;me.ltn_new(_,x,S,i,r);var u=Je()[_/4+0],p=Je()[_/4+1],a=Je()[_/4+2];if(a)throw ps(p);return this.__wbg_ptr=u>>>0,this}finally{me.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let t,n;try{const x=me.__wbindgen_add_to_stack_pointer(-16);me.ltn_getInvertedBoundary(x,this.__wbg_ptr);var i=Je()[x/4+0],r=Je()[x/4+1],u=Je()[x/4+2],p=Je()[x/4+3],a=i,_=r;if(p)throw a=0,_=0,ps(u);return t=a,n=_,ea(a,_)}finally{me.__wbindgen_add_to_stack_pointer(16),me.__wbindgen_free(t,n,1)}}getBounds(){try{const r=me.__wbindgen_add_to_stack_pointer(-16);me.ltn_getBounds(r,this.__wbg_ptr);var t=Je()[r/4+0],n=Je()[r/4+1],i=zS(t,n).slice();return me.__wbindgen_free(t,n*8,8),i}finally{me.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const r=me.__wbindgen_add_to_stack_pointer(-16);me.ltn_toRouteSnapper(r,this.__wbg_ptr);var t=Je()[r/4+0],n=Je()[r/4+1],i=FS(t,n).slice();return me.__wbindgen_free(t,n*1,1),i}finally{me.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let t,n;try{const x=me.__wbindgen_add_to_stack_pointer(-16);me.ltn_toRouteSnapperGj(x,this.__wbg_ptr);var i=Je()[x/4+0],r=Je()[x/4+1],u=Je()[x/4+2],p=Je()[x/4+3],a=i,_=r;if(p)throw a=0,_=0,ps(u);return t=a,n=_,ea(a,_)}finally{me.__wbindgen_add_to_stack_pointer(16),me.__wbindgen_free(t,n,1)}}renderModalFilters(){let t,n;try{const x=me.__wbindgen_add_to_stack_pointer(-16);me.ltn_renderModalFilters(x,this.__wbg_ptr);var i=Je()[x/4+0],r=Je()[x/4+1],u=Je()[x/4+2],p=Je()[x/4+3],a=i,_=r;if(p)throw a=0,_=0,ps(u);return t=a,n=_,ea(a,_)}finally{me.__wbindgen_add_to_stack_pointer(16),me.__wbindgen_free(t,n,1)}}renderNeighbourhood(){let t,n;try{const x=me.__wbindgen_add_to_stack_pointer(-16);me.ltn_renderNeighbourhood(x,this.__wbg_ptr);var i=Je()[x/4+0],r=Je()[x/4+1],u=Je()[x/4+2],p=Je()[x/4+3],a=i,_=r;if(p)throw a=0,_=0,ps(u);return t=a,n=_,ea(a,_)}finally{me.__wbindgen_add_to_stack_pointer(16),me.__wbindgen_free(t,n,1)}}setNeighbourhoodBoundary(t,n){try{const u=me.__wbindgen_add_to_stack_pointer(-16),p=Bl(t,me.__wbindgen_malloc,me.__wbindgen_realloc),a=Ms;me.ltn_setNeighbourhoodBoundary(u,this.__wbg_ptr,p,a,ai(n));var i=Je()[u/4+0],r=Je()[u/4+1];if(r)throw ps(i)}finally{me.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(t){const n=Bl(t,me.__wbindgen_malloc,me.__wbindgen_realloc),i=Ms;me.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,n,i)}setCurrentNeighbourhood(t){try{const r=me.__wbindgen_add_to_stack_pointer(-16),u=Bl(t,me.__wbindgen_malloc,me.__wbindgen_realloc),p=Ms;me.ltn_setCurrentNeighbourhood(r,this.__wbg_ptr,u,p);var n=Je()[r/4+0],i=Je()[r/4+1];if(i)throw ps(n)}finally{me.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(t,n){try{const u=me.__wbindgen_add_to_stack_pointer(-16),p=Bl(n,me.__wbindgen_malloc,me.__wbindgen_realloc),a=Ms;me.ltn_addModalFilter(u,this.__wbg_ptr,ai(t),p,a);var i=Je()[u/4+0],r=Je()[u/4+1];if(r)throw ps(i)}finally{me.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(t,n){try{const u=me.__wbindgen_add_to_stack_pointer(-16),p=Bl(n,me.__wbindgen_malloc,me.__wbindgen_realloc),a=Ms;me.ltn_addManyModalFilters(u,this.__wbg_ptr,ai(t),p,a);var i=Je()[u/4+0],r=Je()[u/4+1];if(r)throw ps(i)}finally{me.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(t){me.ltn_deleteModalFilter(this.__wbg_ptr,t)}undo(){me.ltn_undo(this.__wbg_ptr)}redo(){me.ltn_redo(this.__wbg_ptr)}getShortcutsCrossingRoad(t){let n,i;try{const S=me.__wbindgen_add_to_stack_pointer(-16);me.ltn_getShortcutsCrossingRoad(S,this.__wbg_ptr,t);var r=Je()[S/4+0],u=Je()[S/4+1],p=Je()[S/4+2],a=Je()[S/4+3],_=r,x=u;if(a)throw _=0,x=0,ps(p);return n=_,i=x,ea(_,x)}finally{me.__wbindgen_add_to_stack_pointer(16),me.__wbindgen_free(n,i,1)}}toSavefile(){let t,n;try{const x=me.__wbindgen_add_to_stack_pointer(-16);me.ltn_toSavefile(x,this.__wbg_ptr);var i=Je()[x/4+0],r=Je()[x/4+1],u=Je()[x/4+2],p=Je()[x/4+3],a=i,_=r;if(p)throw a=0,_=0,ps(u);return t=a,n=_,ea(a,_)}finally{me.__wbindgen_add_to_stack_pointer(16),me.__wbindgen_free(t,n,1)}}loadSavefile(t){try{const r=me.__wbindgen_add_to_stack_pointer(-16);me.ltn_loadSavefile(r,this.__wbg_ptr,ai(t));var n=Je()[r/4+0],i=Je()[r/4+1];if(i)throw ps(n)}finally{me.__wbindgen_add_to_stack_pointer(16)}}compareRoute(t,n,i,r){let u,p;try{const D=me.__wbindgen_add_to_stack_pointer(-16);me.ltn_compareRoute(D,this.__wbg_ptr,t,n,i,r);var a=Je()[D/4+0],_=Je()[D/4+1],x=Je()[D/4+2],S=Je()[D/4+3],L=a,k=_;if(S)throw L=0,k=0,ps(x);return u=L,p=k,ea(L,k)}finally{me.__wbindgen_add_to_stack_pointer(16),me.__wbindgen_free(u,p,1)}}}async function VS(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(i){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function US(){const e={};return e.wbg={},e.wbg.__wbindgen_object_drop_ref=function(t){ps(t)},e.wbg.__wbindgen_string_get=function(t,n){const i=pn(n),r=typeof i=="string"?i:void 0;var u=Th(r)?0:Bl(r,me.__wbindgen_malloc,me.__wbindgen_realloc),p=Ms;Je()[t/4+1]=p,Je()[t/4+0]=u},e.wbg.__wbindgen_error_new=function(t,n){const i=new Error(ea(t,n));return ai(i)},e.wbg.__wbindgen_boolean_get=function(t){const n=pn(t);return typeof n=="boolean"?n?1:0:2},e.wbg.__wbindgen_is_bigint=function(t){return typeof pn(t)=="bigint"},e.wbg.__wbindgen_bigint_from_i64=function(t){return ai(t)},e.wbg.__wbindgen_jsval_eq=function(t,n){return pn(t)===pn(n)},e.wbg.__wbindgen_bigint_from_u64=function(t){const n=BigInt.asUintN(64,t);return ai(n)},e.wbg.__wbindgen_number_get=function(t,n){const i=pn(n),r=typeof i=="number"?i:void 0;Fb()[t/8+1]=Th(r)?0:r,Je()[t/4+0]=!Th(r)},e.wbg.__wbindgen_is_object=function(t){const n=pn(t);return typeof n=="object"&&n!==null},e.wbg.__wbindgen_in=function(t,n){return pn(t)in pn(n)},e.wbg.__wbindgen_string_new=function(t,n){const i=ea(t,n);return ai(i)},e.wbg.__wbindgen_is_undefined=function(t){return pn(t)===void 0},e.wbg.__wbindgen_object_clone_ref=function(t){const n=pn(t);return ai(n)},e.wbg.__wbindgen_jsval_loose_eq=function(t,n){return pn(t)==pn(n)},e.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(t,n){const i=pn(t)[pn(n)];return ai(i)},e.wbg.__wbg_debug_34c9290896ec9856=function(t){console.debug(pn(t))},e.wbg.__wbg_error_e60eff06f24ab7a4=function(t){console.error(pn(t))},e.wbg.__wbg_info_d7d58472d0bab115=function(t){console.info(pn(t))},e.wbg.__wbg_log_a4530b4fe289336f=function(t){console.log(pn(t))},e.wbg.__wbg_warn_f260f49434e45e62=function(t){console.warn(pn(t))},e.wbg.__wbg_new_abda76e883ba8a5f=function(){const t=new Error;return ai(t)},e.wbg.__wbg_stack_658279fe44541cf6=function(t,n){const i=pn(n).stack,r=Bl(i,me.__wbindgen_malloc,me.__wbindgen_realloc),u=Ms;Je()[t/4+1]=u,Je()[t/4+0]=r},e.wbg.__wbg_error_f851667af71bcfc6=function(t,n){let i,r;try{i=t,r=n,console.error(ea(t,n))}finally{me.__wbindgen_free(i,r,1)}},e.wbg.__wbg_performance_3f3012faa4463882=function(t){const n=pn(t).performance;return ai(n)},e.wbg.__wbg_now_2fd65358804c9485=function(t){return pn(t).now()},e.wbg.__wbg_get_f01601b5a68d10e3=function(t,n){const i=pn(t)[n>>>0];return ai(i)},e.wbg.__wbg_length_1009b1af0c481d7b=function(t){return pn(t).length},e.wbg.__wbindgen_is_function=function(t){return typeof pn(t)=="function"},e.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(t,n){const i=new Function(ea(t,n));return ai(i)},e.wbg.__wbg_next_9b877f231f476d01=function(t){const n=pn(t).next;return ai(n)},e.wbg.__wbg_next_6529ee0cca8d57ed=function(){return mc(function(t){const n=pn(t).next();return ai(n)},arguments)},e.wbg.__wbg_done_5fe336b092d60cf2=function(t){return pn(t).done},e.wbg.__wbg_value_0c248a78fdc8e19f=function(t){const n=pn(t).value;return ai(n)},e.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return ai(Symbol.iterator)},e.wbg.__wbg_get_7b48513de5dc5ea4=function(){return mc(function(t,n){const i=Reflect.get(pn(t),pn(n));return ai(i)},arguments)},e.wbg.__wbg_call_90c26b09837aba1c=function(){return mc(function(t,n){const i=pn(t).call(pn(n));return ai(i)},arguments)},e.wbg.__wbg_self_f0e34d89f33b99fd=function(){return mc(function(){const t=self.self;return ai(t)},arguments)},e.wbg.__wbg_window_d3b084224f4774d7=function(){return mc(function(){const t=window.window;return ai(t)},arguments)},e.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return mc(function(){const t=globalThis.globalThis;return ai(t)},arguments)},e.wbg.__wbg_global_35dfdd59a4da3e74=function(){return mc(function(){const t=global.global;return ai(t)},arguments)},e.wbg.__wbg_isArray_74fb723e24f76012=function(t){return Array.isArray(pn(t))},e.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(t){let n;try{n=pn(t)instanceof ArrayBuffer}catch{n=!1}return n},e.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(t){return Number.isSafeInteger(pn(t))},e.wbg.__wbg_entries_9e2e2aa45aa5094a=function(t){const n=Object.entries(pn(t));return ai(n)},e.wbg.__wbg_buffer_a448f833075b71ba=function(t){const n=pn(t).buffer;return ai(n)},e.wbg.__wbg_new_8f67e318f15d7254=function(t){const n=new Uint8Array(pn(t));return ai(n)},e.wbg.__wbg_set_2357bf09366ee480=function(t,n,i){pn(t).set(pn(n),i>>>0)},e.wbg.__wbg_length_1d25fa9e4ac21ce7=function(t){return pn(t).length},e.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(t){let n;try{n=pn(t)instanceof Uint8Array}catch{n=!1}return n},e.wbg.__wbindgen_bigint_get_as_i64=function(t,n){const i=pn(n),r=typeof i=="bigint"?i:void 0;RS()[t/8+1]=Th(r)?BigInt(0):r,Je()[t/4+0]=!Th(r)},e.wbg.__wbindgen_debug_string=function(t,n){const i=$_(pn(n)),r=Bl(i,me.__wbindgen_malloc,me.__wbindgen_realloc),u=Ms;Je()[t/4+1]=u,Je()[t/4+0]=r},e.wbg.__wbindgen_throw=function(t,n){throw new Error(ea(t,n))},e.wbg.__wbindgen_memory=function(){const t=me.memory;return ai(t)},e}function GS(e,t){return me=e.exports,Bb.__wbindgen_wasm_module=t,Tf=null,Cf=null,If=null,Ef=null,me}async function Bb(e){if(me!==void 0)return me;typeof e>"u"&&(e="/ltn/assets/backend_bg.wasm");const t=US();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:i}=await VS(await e,t);return GS(n,i)}let Xe;const Vb=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Vb.decode();let Lf=null;function Of(){return(Lf===null||Lf.byteLength===0)&&(Lf=new Uint8Array(Xe.memory.buffer)),Lf}function Ul(e,t){return e=e>>>0,Vb.decode(Of().subarray(e,e+t))}const Gl=new Array(128).fill(void 0);Gl.push(void 0,null,!0,!1);let zf=Gl.length;function Or(e){zf===Gl.length&&Gl.push(Gl.length+1);const t=zf;return zf=Gl[t],Gl[t]=e,t}function Ln(e){return Gl[e]}function qS(e){e<132||(Gl[e]=zf,zf=e)}function Vm(e){const t=Ln(e);return qS(e),t}function U_(e){return e==null}let Mf=null;function jS(){return(Mf===null||Mf.byteLength===0)&&(Mf=new Float64Array(Xe.memory.buffer)),Mf}let Pf=null;function Ci(){return(Pf===null||Pf.byteLength===0)&&(Pf=new Int32Array(Xe.memory.buffer)),Pf}let Lu=0;const Um=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},ZS=typeof Um.encodeInto=="function"?function(e,t){return Um.encodeInto(e,t)}:function(e,t){const n=Um.encode(e);return t.set(n),{read:e.length,written:n.length}};function Lm(e,t,n){if(n===void 0){const a=Um.encode(e),_=t(a.length,1)>>>0;return Of().subarray(_,_+a.length).set(a),Lu=a.length,_}let i=e.length,r=t(i,1)>>>0;const u=Of();let p=0;for(;p<i;p++){const a=e.charCodeAt(p);if(a>127)break;u[r+p]=a}if(p!==i){p!==0&&(e=e.slice(p)),r=n(r,i,i=p+e.length*3,1)>>>0;const a=Of().subarray(r+p,r+i),_=ZS(e,a);p+=_.written}return Lu=p,r}function ty(e){const t=typeof e;if(t=="number"||t=="boolean"||e==null)return`${e}`;if(t=="string")return`"${e}"`;if(t=="symbol"){const r=e.description;return r==null?"Symbol":`Symbol(${r})`}if(t=="function"){const r=e.name;return typeof r=="string"&&r.length>0?`Function(${r})`:"Function"}if(Array.isArray(e)){const r=e.length;let u="[";r>0&&(u+=ty(e[0]));for(let p=1;p<r;p++)u+=", "+ty(e[p]);return u+="]",u}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let i;if(n.length>1)i=n[1];else return toString.call(e);if(i=="Object")try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:i}function WS(e,t){const n=t(e.length*1,1)>>>0;return Of().set(e,n/1),Lu=e.length,n}function G_(e,t){try{return e.apply(this,t)}catch(n){Xe.__wbindgen_exn_store(Or(n))}}class Wm{static __wrap(t){t=t>>>0;const n=Object.create(Wm.prototype);return n.__wbg_ptr=t,n}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();Xe.__wbg_jsroutesnapper_free(t)}constructor(t){try{const u=Xe.__wbindgen_add_to_stack_pointer(-16),p=WS(t,Xe.__wbindgen_malloc),a=Lu;Xe.jsroutesnapper_new(u,p,a);var n=Ci()[u/4+0],i=Ci()[u/4+1],r=Ci()[u/4+2];if(r)throw Vm(i);return Wm.__wrap(n)}finally{Xe.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(t){Xe.jsroutesnapper_setRouteConfig(this.__wbg_ptr,Or(t))}setAreaMode(){Xe.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let t,n;try{const u=Xe.__wbindgen_add_to_stack_pointer(-16);Xe.jsroutesnapper_getConfig(u,this.__wbg_ptr);var i=Ci()[u/4+0],r=Ci()[u/4+1];return t=i,n=r,Ul(i,r)}finally{Xe.__wbindgen_add_to_stack_pointer(16),Xe.__wbindgen_free(t,n,1)}}toFinalFeature(){try{const i=Xe.__wbindgen_add_to_stack_pointer(-16);Xe.jsroutesnapper_toFinalFeature(i,this.__wbg_ptr);var t=Ci()[i/4+0],n=Ci()[i/4+1];let r;return t!==0&&(r=Ul(t,n).slice(),Xe.__wbindgen_free(t,n*1)),r}finally{Xe.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let t,n;try{const u=Xe.__wbindgen_add_to_stack_pointer(-16);Xe.jsroutesnapper_renderGeojson(u,this.__wbg_ptr);var i=Ci()[u/4+0],r=Ci()[u/4+1];return t=i,n=r,Ul(i,r)}finally{Xe.__wbindgen_add_to_stack_pointer(16),Xe.__wbindgen_free(t,n,1)}}toggleSnapMode(){Xe.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(t,n,i){return Xe.jsroutesnapper_onMouseMove(this.__wbg_ptr,t,n,i)!==0}onClick(){Xe.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return Xe.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return Xe.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){Xe.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(t){try{const r=Xe.__wbindgen_add_to_stack_pointer(-16);Xe.jsroutesnapper_editExisting(r,this.__wbg_ptr,Or(t));var n=Ci()[r/4+0],i=Ci()[r/4+1];if(i)throw Vm(n)}finally{Xe.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let t,n;try{const u=Xe.__wbindgen_add_to_stack_pointer(-16);Xe.jsroutesnapper_debugRenderGraph(u,this.__wbg_ptr);var i=Ci()[u/4+0],r=Ci()[u/4+1];return t=i,n=r,Ul(i,r)}finally{Xe.__wbindgen_add_to_stack_pointer(16),Xe.__wbindgen_free(t,n,1)}}routeNameForWaypoints(t){let n,i;try{const S=Xe.__wbindgen_add_to_stack_pointer(-16);Xe.jsroutesnapper_routeNameForWaypoints(S,this.__wbg_ptr,Or(t));var r=Ci()[S/4+0],u=Ci()[S/4+1],p=Ci()[S/4+2],a=Ci()[S/4+3],_=r,x=u;if(a)throw _=0,x=0,Vm(p);return n=_,i=x,Ul(_,x)}finally{Xe.__wbindgen_add_to_stack_pointer(16),Xe.__wbindgen_free(n,i,1)}}addSnappedWaypoint(t,n){Xe.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,t,n)}undo(){Xe.jsroutesnapper_undo(this.__wbg_ptr)}}async function XS(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(i){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function HS(){const e={};return e.wbg={},e.wbg.__wbindgen_string_new=function(t,n){const i=Ul(t,n);return Or(i)},e.wbg.__wbindgen_object_drop_ref=function(t){Vm(t)},e.wbg.__wbindgen_error_new=function(t,n){const i=new Error(Ul(t,n));return Or(i)},e.wbg.__wbindgen_is_object=function(t){const n=Ln(t);return typeof n=="object"&&n!==null},e.wbg.__wbindgen_is_undefined=function(t){return Ln(t)===void 0},e.wbg.__wbindgen_in=function(t,n){return Ln(t)in Ln(n)},e.wbg.__wbindgen_number_get=function(t,n){const i=Ln(n),r=typeof i=="number"?i:void 0;jS()[t/8+1]=U_(r)?0:r,Ci()[t/4+0]=!U_(r)},e.wbg.__wbindgen_boolean_get=function(t){const n=Ln(t);return typeof n=="boolean"?n?1:0:2},e.wbg.__wbindgen_object_clone_ref=function(t){const n=Ln(t);return Or(n)},e.wbg.__wbindgen_jsval_loose_eq=function(t,n){return Ln(t)==Ln(n)},e.wbg.__wbindgen_string_get=function(t,n){const i=Ln(n),r=typeof i=="string"?i:void 0;var u=U_(r)?0:Lm(r,Xe.__wbindgen_malloc,Xe.__wbindgen_realloc),p=Lu;Ci()[t/4+1]=p,Ci()[t/4+0]=u},e.wbg.__wbg_String_4370c5505c674d30=function(t,n){const i=String(Ln(n)),r=Lm(i,Xe.__wbindgen_malloc,Xe.__wbindgen_realloc),u=Lu;Ci()[t/4+1]=u,Ci()[t/4+0]=r},e.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(t,n){const i=Ln(t)[Ln(n)];return Or(i)},e.wbg.__wbg_new_abda76e883ba8a5f=function(){const t=new Error;return Or(t)},e.wbg.__wbg_stack_658279fe44541cf6=function(t,n){const i=Ln(n).stack,r=Lm(i,Xe.__wbindgen_malloc,Xe.__wbindgen_realloc),u=Lu;Ci()[t/4+1]=u,Ci()[t/4+0]=r},e.wbg.__wbg_error_f851667af71bcfc6=function(t,n){let i,r;try{i=t,r=n,console.error(Ul(t,n))}finally{Xe.__wbindgen_free(i,r,1)}},e.wbg.__wbg_debug_9a6b3243fbbebb61=function(t){console.debug(Ln(t))},e.wbg.__wbg_error_788ae33f81d3b84b=function(t){console.error(Ln(t))},e.wbg.__wbg_info_2e30e8204b29d91d=function(t){console.info(Ln(t))},e.wbg.__wbg_log_1d3ae0273d8f4f8a=function(t){console.log(Ln(t))},e.wbg.__wbg_warn_d60e832f9882c1b2=function(t){console.warn(Ln(t))},e.wbg.__wbg_get_44be0491f933a435=function(t,n){const i=Ln(t)[n>>>0];return Or(i)},e.wbg.__wbg_length_fff51ee6522a1a18=function(t){return Ln(t).length},e.wbg.__wbindgen_is_function=function(t){return typeof Ln(t)=="function"},e.wbg.__wbg_next_526fc47e980da008=function(t){const n=Ln(t).next;return Or(n)},e.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return G_(function(t){const n=Ln(t).next();return Or(n)},arguments)},e.wbg.__wbg_done_5c1f01fb660d73b5=function(t){return Ln(t).done},e.wbg.__wbg_value_1695675138684bd5=function(t){const n=Ln(t).value;return Or(n)},e.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return Or(Symbol.iterator)},e.wbg.__wbg_get_97b561fb56f034b5=function(){return G_(function(t,n){const i=Reflect.get(Ln(t),Ln(n));return Or(i)},arguments)},e.wbg.__wbg_call_cb65541d95d71282=function(){return G_(function(t,n){const i=Ln(t).call(Ln(n));return Or(i)},arguments)},e.wbg.__wbg_isArray_4c24b343cb13cfb1=function(t){return Array.isArray(Ln(t))},e.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(t){let n;try{n=Ln(t)instanceof ArrayBuffer}catch{n=!1}return n},e.wbg.__wbg_buffer_085ec1f694018c4f=function(t){const n=Ln(t).buffer;return Or(n)},e.wbg.__wbg_new_8125e318e6245eed=function(t){const n=new Uint8Array(Ln(t));return Or(n)},e.wbg.__wbg_set_5cf90238115182c3=function(t,n,i){Ln(t).set(Ln(n),i>>>0)},e.wbg.__wbg_length_72e2208bbc0efc61=function(t){return Ln(t).length},e.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(t){let n;try{n=Ln(t)instanceof Uint8Array}catch{n=!1}return n},e.wbg.__wbindgen_debug_string=function(t,n){const i=ty(Ln(n)),r=Lm(i,Xe.__wbindgen_malloc,Xe.__wbindgen_realloc),u=Lu;Ci()[t/4+1]=u,Ci()[t/4+0]=r},e.wbg.__wbindgen_throw=function(t,n){throw new Error(Ul(t,n))},e.wbg.__wbindgen_memory=function(){const t=Xe.memory;return Or(t)},e}function YS(e,t){return Xe=e.exports,Ub.__wbindgen_wasm_module=t,Mf=null,Pf=null,Lf=null,Xe}async function Ub(e){if(Xe!==void 0)return Xe;typeof e>"u"&&(e="/ltn/assets/route_snapper_bg.wasm");const t=HS();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:i}=await XS(await e,t);return YS(n,i)}const Sh=[];function q_(e,t){return{subscribe:Ti(e,t).subscribe}}function Ti(e,t=Oe){let n;const i=new Set;function r(a){if(rn(e,a)&&(e=a,n)){const _=!Sh.length;for(const x of i)x[1](),Sh.push(x,e);if(_){for(let x=0;x<Sh.length;x+=2)Sh[x][0](Sh[x+1]);Sh.length=0}}}function u(a){r(a(e))}function p(a,_=Oe){const x=[a,_];return i.add(x),i.size===1&&(n=t(r,u)||Oe),a(e),()=>{i.delete(x),i.size===0&&n&&(n(),n=null)}}return{set:r,update:u,subscribe:p}}let KS=Date.now();function np(e){return`${e}-${KS++}`}const Sy=Symbol.for("svelte-maplibre");function ip(){return IS(Sy)}function JS(e){let t=new WeakMap;return n=>{var p;let i=t.get(n.originalEvent);if(i!==void 0)return i;let u=(p=n.target.queryRenderedFeatures(n.point).find(a=>{var _;return(_=e.get(a.layer.id))==null?void 0:_.interactive}))==null?void 0:p.layer.id;return t.set(n.originalEvent,u),u}}function QS(){let e=new Map;return kb(Sy,{map:Ti(null),source:q_(null),layer:q_(null),popupTarget:q_(null),cluster:Ti(),loadedImages:Ti(new Set),minzoom:Ti(0),maxzoom:Ti(24),layerEvent:Ti(null),layerInfo:e,eventTopMost:JS(e)})}function Dv(e){return{subscribe:e.subscribe}}function Ey({key:e,setPopupTarget:t=!1,setCluster:n=!1,setMouseEvent:i=!1}){let r=ip(),u=Ti(null),p=Dv(u),a={...r,[e]:Dv(u)};if(t&&(a.popupTarget=p),i){let _=Ti(null);a.layerEvent=_,r.layerEvent=_}return n&&(a.cluster=Ti()),kb(Sy,a),{...r,self:u}}function $S(){return Ey({key:"source",setCluster:!0})}function tE(e=!0){return Ey({key:"layer",setPopupTarget:e,setMouseEvent:e})}function eE(){return Ey({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}function nE(e){return"layerType"in e&&e.layerType==="deckgl"}var Gb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qb(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function jb(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var r=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(n,i,r.get?r:{enumerable:!0,get:function(){return e[i]}})}),n}var Zb={exports:{}};(function(e,t){(function(n,i){e.exports=i()})(Gb,function(){var n,i,r;function u(a,_){if(!n)n=_;else if(!i)i=_;else{var x="var sharedChunk = {}; ("+n+")(sharedChunk); ("+i+")(sharedChunk);",S={};n(S),r=_(S),typeof window<"u"&&(r.workerUrl=window.URL.createObjectURL(new Blob([x],{type:"text/javascript"})))}}u(["exports"],function(a){function _(l,o,c,f){return new(c||(c=Promise))(function(m,v){function w(P){try{T(f.next(P))}catch(N){v(N)}}function E(P){try{T(f.throw(P))}catch(N){v(N)}}function T(P){var N;P.done?m(P.value):(N=P.value,N instanceof c?N:new c(function(z){z(N)})).then(w,E)}T((f=f.apply(l,o||[])).next())})}function x(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}typeof SuppressedError=="function"&&SuppressedError;var S=L;function L(l,o){this.x=l,this.y=o}L.prototype={clone:function(){return new L(this.x,this.y)},add:function(l){return this.clone()._add(l)},sub:function(l){return this.clone()._sub(l)},multByPoint:function(l){return this.clone()._multByPoint(l)},divByPoint:function(l){return this.clone()._divByPoint(l)},mult:function(l){return this.clone()._mult(l)},div:function(l){return this.clone()._div(l)},rotate:function(l){return this.clone()._rotate(l)},rotateAround:function(l,o){return this.clone()._rotateAround(l,o)},matMult:function(l){return this.clone()._matMult(l)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(l){return this.x===l.x&&this.y===l.y},dist:function(l){return Math.sqrt(this.distSqr(l))},distSqr:function(l){var o=l.x-this.x,c=l.y-this.y;return o*o+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith:function(l){return this.angleWithSep(l.x,l.y)},angleWithSep:function(l,o){return Math.atan2(this.x*o-this.y*l,this.x*l+this.y*o)},_matMult:function(l){var o=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=o,this},_add:function(l){return this.x+=l.x,this.y+=l.y,this},_sub:function(l){return this.x-=l.x,this.y-=l.y,this},_mult:function(l){return this.x*=l,this.y*=l,this},_div:function(l){return this.x/=l,this.y/=l,this},_multByPoint:function(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint:function(l){return this.x/=l.x,this.y/=l.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var l=this.y;return this.y=this.x,this.x=-l,this},_rotate:function(l){var o=Math.cos(l),c=Math.sin(l),f=c*this.x+o*this.y;return this.x=o*this.x-c*this.y,this.y=f,this},_rotateAround:function(l,o){var c=Math.cos(l),f=Math.sin(l),m=o.y+f*(this.x-o.x)+c*(this.y-o.y);return this.x=o.x+c*(this.x-o.x)-f*(this.y-o.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},L.convert=function(l){return l instanceof L?l:Array.isArray(l)?new L(l[0],l[1]):l};var k=x(S),D=F;function F(l,o,c,f){this.cx=3*l,this.bx=3*(c-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(f-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=o,this.p2x=c,this.p2y=f}F.prototype={sampleCurveX:function(l){return((this.ax*l+this.bx)*l+this.cx)*l},sampleCurveY:function(l){return((this.ay*l+this.by)*l+this.cy)*l},sampleCurveDerivativeX:function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},solveCurveX:function(l,o){if(o===void 0&&(o=1e-6),l<0)return 0;if(l>1)return 1;for(var c=l,f=0;f<8;f++){var m=this.sampleCurveX(c)-l;if(Math.abs(m)<o)return c;var v=this.sampleCurveDerivativeX(c);if(Math.abs(v)<1e-6)break;c-=m/v}var w=0,E=1;for(c=l,f=0;f<20&&(m=this.sampleCurveX(c),!(Math.abs(m-l)<o));f++)l>m?w=c:E=c,c=.5*(E-w)+w;return c},solve:function(l,o){return this.sampleCurveY(this.solveCurveX(l,o))}};var K=x(D);let W,Q;function U(){return W==null&&(W=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),W}function X(){if(Q==null&&(Q=!1,U())){const o=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(o){for(let f=0;f<5*5;f++){const m=4*f;o.fillStyle=`rgb(${m},${m+1},${m+2})`,o.fillRect(f%5,Math.floor(f/5),1,1)}const c=o.getImageData(0,0,5,5).data;for(let f=0;f<5*5*4;f++)if(f%4!=3&&c[f]!==f){Q=!0;break}}}return Q||!1}function Y(l,o,c,f){const m=new K(l,o,c,f);return function(v){return m.solve(v)}}const pt=Y(.25,.1,.25,1);function gt(l,o,c){return Math.min(c,Math.max(o,l))}function ct(l,o,c){const f=c-o,m=((l-o)%f+f)%f+o;return m===o?c:m}function ht(l,...o){for(const c of o)for(const f in c)l[f]=c[f];return l}let rt=1;function Et(l,o,c){const f={};for(const m in l)f[m]=o.call(c||this,l[m],m,l);return f}function mt(l,o,c){const f={};for(const m in l)o.call(c||this,l[m],m,l)&&(f[m]=l[m]);return f}function dt(l){return Array.isArray(l)?l.map(dt):typeof l=="object"&&l?Et(l,dt):l}const Jt={};function kt(l){Jt[l]||(typeof console<"u"&&console.warn(l),Jt[l]=!0)}function Gt(l,o,c){return(c.y-l.y)*(o.x-l.x)>(o.y-l.y)*(c.x-l.x)}function Kt(l){let o=0;for(let c,f,m=0,v=l.length,w=v-1;m<v;w=m++)c=l[m],f=l[w],o+=(f.x-c.x)*(c.y+f.y);return o}function be(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let ce=null;function $e(l){return typeof ImageBitmap<"u"&&l instanceof ImageBitmap}const jn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ze(l,o,c,f,m){return _(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const v=new VideoFrame(l,{timestamp:0});try{const w=v==null?void 0:v.format;if(!w||!w.startsWith("BGR")&&!w.startsWith("RGB"))throw new Error(`Unrecognized format ${w}`);const E=w.startsWith("BGR"),T=new Uint8ClampedArray(f*m*4);if(yield v.copyTo(T,function(P,N,z,V,Z){const H=4*Math.max(-N,0),tt=(Math.max(0,z)-z)*V*4+H,lt=4*V,ft=Math.max(0,N),Tt=Math.max(0,z);return{rect:{x:ft,y:Tt,width:Math.min(P.width,N+V)-ft,height:Math.min(P.height,z+Z)-Tt},layout:[{offset:tt,stride:lt}]}}(l,o,c,f,m)),E)for(let P=0;P<T.length;P+=4){const N=T[P];T[P]=T[P+2],T[P+2]=N}return T}finally{v.close()}})}let ze,Ue,dn,Jn;const Zn={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(l){const o=requestAnimationFrame(l);return{cancel:()=>cancelAnimationFrame(o)}},getImageData(l,o=0){return this.getImageCanvasContext(l).getImageData(-o,-o,l.width+2*o,l.height+2*o)},getImageCanvasContext(l){const o=window.document.createElement("canvas"),c=o.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return o.width=l.width,o.height=l.height,c.drawImage(l,0,0,l.width,l.height),c},resolveURL:l=>(dn||(dn=document.createElement("a")),dn.href=l,dn.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Jn==null&&(Jn=matchMedia("(prefers-reduced-motion: reduce)")),Jn.matches)}},re={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Be extends Error{constructor(o,c,f,m){super(`AJAXError: ${c} (${o}): ${f}`),this.status=o,this.statusText=c,this.url=f,this.body=m}}const fn=be()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Un=l=>re.REGISTERED_PROTOCOLS[l.substring(0,l.indexOf("://"))];function ur(l,o){const c=new AbortController,f=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,cache:l.cache,referrer:fn(),signal:c.signal});let m=!1,v=!1;return l.type==="json"&&f.headers.set("Accept","application/json"),v||fetch(f).then(w=>w.ok?(E=>{(l.type==="arrayBuffer"||l.type==="image"?E.arrayBuffer():l.type==="json"?E.json():E.text()).then(T=>{v||(m=!0,o(null,T,E.headers.get("Cache-Control"),E.headers.get("Expires")))}).catch(T=>{v||o(new Error(T.message))})})(w):w.blob().then(E=>o(new Be(w.status,w.statusText,l.url,E)))).catch(w=>{w.code!==20&&o(new Error(w.message))}),{cancel:()=>{v=!0,m||c.abort()}}}const Ai=function(l,o){if(/:\/\//.test(l.url)&&!/^https?:|^file:/.test(l.url)){if(be()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",l,o);if(!be())return(Un(l.url)||ur)(l,o)}if(!(/^file:/.test(c=l.url)||/^file:/.test(fn())&&!/^\w+:/.test(c))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return ur(l,o);if(be()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",l,o,void 0,!0)}var c;return function(f,m){const v=new XMLHttpRequest;v.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(v.responseType="arraybuffer");for(const w in f.headers)v.setRequestHeader(w,f.headers[w]);return f.type==="json"&&(v.responseType="text",v.setRequestHeader("Accept","application/json")),v.withCredentials=f.credentials==="include",v.onerror=()=>{m(new Error(v.statusText))},v.onload=()=>{if((v.status>=200&&v.status<300||v.status===0)&&v.response!==null){let w=v.response;if(f.type==="json")try{w=JSON.parse(v.response)}catch(E){return m(E)}m(null,w,v.getResponseHeader("Cache-Control"),v.getResponseHeader("Expires"))}else{const w=new Blob([v.response],{type:v.getResponseHeader("Content-Type")});m(new Be(v.status,v.statusText,f.url,w))}},v.send(f.body),{cancel:()=>v.abort()}}(l,o)},wt=function(l,o){return Ai(ht(l,{type:"arrayBuffer"}),o)};function De(l){if(!l||l.indexOf("://")<=0||l.indexOf("data:image/")===0||l.indexOf("blob:")===0)return!0;const o=new URL(l),c=window.location;return o.protocol===c.protocol&&o.host===c.host}function Ve(l,o,c){c[l]&&c[l].indexOf(o)!==-1||(c[l]=c[l]||[],c[l].push(o))}function ki(l,o,c){if(c&&c[l]){const f=c[l].indexOf(o);f!==-1&&c[l].splice(f,1)}}class On{constructor(o,c={}){ht(this,c),this.type=o}}class tn extends On{constructor(o,c={}){super("error",ht({error:o},c))}}class Gn{on(o,c){return this._listeners=this._listeners||{},Ve(o,c,this._listeners),this}off(o,c){return ki(o,c,this._listeners),ki(o,c,this._oneTimeListeners),this}once(o,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},Ve(o,c,this._oneTimeListeners),this):new Promise(f=>this.once(o,f))}fire(o,c){typeof o=="string"&&(o=new On(o,c||{}));const f=o.type;if(this.listens(f)){o.target=this;const m=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const E of m)E.call(this,o);const v=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const E of v)ki(f,E,this._oneTimeListeners),E.call(this,o);const w=this._eventedParent;w&&(ht(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(o))}else o instanceof tn&&console.error(o.error);return this}listens(o){return this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o)}setEventedParent(o,c){return this._eventedParent=o,this._eventedParentData=c,this}}var qt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const mi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function qi(l,o){const c={};for(const f in l)f!=="ref"&&(c[f]=l[f]);return mi.forEach(f=>{f in o&&(c[f]=o[f])}),c}function In(l,o){if(Array.isArray(l)){if(!Array.isArray(o)||l.length!==o.length)return!1;for(let c=0;c<l.length;c++)if(!In(l[c],o[c]))return!1;return!0}if(typeof l=="object"&&l!==null&&o!==null){if(typeof o!="object"||Object.keys(l).length!==Object.keys(o).length)return!1;for(const c in l)if(!In(l[c],o[c]))return!1;return!0}return l===o}const en={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function uo(l,o,c){c.push({command:en.addSource,args:[l,o[l]]})}function or(l,o,c){o.push({command:en.removeSource,args:[l]}),c[l]=!0}function Ni(l,o,c,f){or(l,c,f),uo(l,o,c)}function ii(l,o,c){let f;for(f in l[c])if(Object.prototype.hasOwnProperty.call(l[c],f)&&f!=="data"&&!In(l[c][f],o[c][f]))return!1;for(f in o[c])if(Object.prototype.hasOwnProperty.call(o[c],f)&&f!=="data"&&!In(l[c][f],o[c][f]))return!1;return!0}function vn(l,o,c,f,m,v){let w;for(w in o=o||{},l=l||{})Object.prototype.hasOwnProperty.call(l,w)&&(In(l[w],o[w])||c.push({command:v,args:[f,w,o[w],m]}));for(w in o)Object.prototype.hasOwnProperty.call(o,w)&&!Object.prototype.hasOwnProperty.call(l,w)&&(In(l[w],o[w])||c.push({command:v,args:[f,w,o[w],m]}))}function gi(l){return l.id}function wa(l,o){return l[o.id]=o,l}class ae{constructor(o,c,f,m){this.message=(o?`${o}: `:"")+f,m&&(this.identifier=m),c!=null&&c.__line__&&(this.line=c.__line__)}}function wo(l,...o){for(const c of o)for(const f in c)l[f]=c[f];return l}class ri extends Error{constructor(o,c){super(c),this.message=c,this.key=o}}class Sa{constructor(o,c=[]){this.parent=o,this.bindings={};for(const[f,m]of c)this.bindings[f]=m}concat(o){return new Sa(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const Ss={kind:"null"},ue={kind:"number"},ln={kind:"string"},Ke={kind:"boolean"},Pr={kind:"color"},is={kind:"object"},on={kind:"value"},Es={kind:"collator"},st={kind:"formatted"},B={kind:"padding"},G={kind:"resolvedImage"},J={kind:"variableAnchorOffsetCollection"};function q(l,o){return{kind:"array",itemType:l,N:o}}function ot(l){if(l.kind==="array"){const o=ot(l.itemType);return typeof l.N=="number"?`array<${o}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${o}>`}return l.kind}const St=[Ss,ue,ln,Ke,Pr,st,is,q(on),B,G,J];function _t(l,o){if(o.kind==="error")return null;if(l.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!_t(l.itemType,o.itemType))&&(typeof l.N!="number"||l.N===o.N))return null}else{if(l.kind===o.kind)return null;if(l.kind==="value"){for(const c of St)if(!_t(c,o))return null}}return`Expected ${ot(l)} but found ${ot(o)} instead.`}function it(l,o){return o.some(c=>c.kind===l.kind)}function bt(l,o){return o.some(c=>c==="null"?l===null:c==="array"?Array.isArray(l):c==="object"?l&&!Array.isArray(l)&&typeof l=="object":c===typeof l)}function jt(l,o){return l.kind==="array"&&o.kind==="array"?l.itemType.kind===o.itemType.kind&&typeof l.N=="number":l.kind===o.kind}const Zt=.96422,Xt=.82521,Pe=4/29,Ye=6/29,Ie=3*Ye*Ye,Fe=Ye*Ye*Ye,nn=Math.PI/180,qn=180/Math.PI;function Qn(l){return(l%=360)<0&&(l+=360),l}function An([l,o,c,f]){let m,v;const w=Hr((.2225045*(l=Pn(l))+.7168786*(o=Pn(o))+.0606169*(c=Pn(c)))/1);l===o&&o===c?m=v=w:(m=Hr((.4360747*l+.3850649*o+.1430804*c)/Zt),v=Hr((.0139322*l+.0971045*o+.7141733*c)/Xt));const E=116*w-16;return[E<0?0:E,500*(m-w),200*(w-v),f]}function Pn(l){return l<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function Hr(l){return l>Fe?Math.pow(l,1/3):l/Ie+Pe}function oi([l,o,c,f]){let m=(l+16)/116,v=isNaN(o)?m:m+o/500,w=isNaN(c)?m:m-c/200;return m=1*Ar(m),v=Zt*Ar(v),w=Xt*Ar(w),[sr(3.1338561*v-1.6168667*m-.4906146*w),sr(-.9787684*v+1.9161415*m+.033454*w),sr(.0719453*v-.2289914*m+1.4052427*w),f]}function sr(l){return(l=l<=.00304?12.92*l:1.055*Math.pow(l,1/2.4)-.055)<0?0:l>1?1:l}function Ar(l){return l>Ye?l*l*l:Ie*(l-Pe)}function rs(l){return parseInt(l.padEnd(2,l),16)/255}function bd(l,o){return ru(o?l/100:l,0,1)}function ru(l,o,c){return Math.min(Math.max(o,l),c)}function ou(l){return!l.some(Number.isNaN)}const Ng={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Hn{constructor(o,c,f,m=1,v=!0){this.r=o,this.g=c,this.b=f,this.a=m,v||(this.r*=m,this.g*=m,this.b*=m,m||this.overwriteGetter("rgb",[o,c,f,m]))}static parse(o){if(o instanceof Hn)return o;if(typeof o!="string")return;const c=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const m=Ng[f];if(m){const[w,E,T]=m;return[w/255,E/255,T/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const w=f.length<6?1:2;let E=1;return[rs(f.slice(E,E+=w)),rs(f.slice(E,E+=w)),rs(f.slice(E,E+=w)),rs(f.slice(E,E+w)||"ff")]}if(f.startsWith("rgb")){const w=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[E,T,P,N,z,V,Z,H,tt,lt,ft,Tt]=w,yt=[N||" ",Z||" ",lt].join("");if(yt==="  "||yt==="  /"||yt===",,"||yt===",,,"){const Mt=[P,V,tt].join(""),zt=Mt==="%%%"?100:Mt===""?255:0;if(zt){const Ht=[ru(+T/zt,0,1),ru(+z/zt,0,1),ru(+H/zt,0,1),ft?bd(+ft,Tt):1];if(ou(Ht))return Ht}}return}}const v=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[w,E,T,P,N,z,V,Z,H]=v,tt=[T||" ",N||" ",V].join("");if(tt==="  "||tt==="  /"||tt===",,"||tt===",,,"){const lt=[+E,ru(+P,0,100),ru(+z,0,100),Z?bd(+Z,H):1];if(ou(lt))return function([ft,Tt,yt,Mt]){function zt(Ht){const ye=(Ht+ft/30)%12,Te=Tt*Math.min(yt,1-yt);return yt-Te*Math.max(-1,Math.min(ye-3,9-ye,1))}return ft=Qn(ft),Tt/=100,yt/=100,[zt(0),zt(8),zt(4),Mt]}(lt)}}}(o);return c?new Hn(...c,!1):void 0}get rgb(){const{r:o,g:c,b:f,a:m}=this,v=m||1/0;return this.overwriteGetter("rgb",[o/v,c/v,f/v,m])}get hcl(){return this.overwriteGetter("hcl",function(o){const[c,f,m,v]=An(o),w=Math.sqrt(f*f+m*m);return[Math.round(1e4*w)?Qn(Math.atan2(m,f)*qn):NaN,w,c,v]}(this.rgb))}get lab(){return this.overwriteGetter("lab",An(this.rgb))}overwriteGetter(o,c){return Object.defineProperty(this,o,{value:c}),c}toString(){const[o,c,f,m]=this.rgb;return`rgba(${[o,c,f].map(v=>Math.round(255*v)).join(",")},${m})`}}Hn.black=new Hn(0,0,0,1),Hn.white=new Hn(1,1,1,1),Hn.transparent=new Hn(0,0,0,0),Hn.red=new Hn(1,0,0,1);class pp{constructor(o,c,f){this.sensitivity=o?c?"variant":"case":c?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,c){return this.collator.compare(o,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class zc{constructor(o,c,f,m,v){this.text=o,this.image=c,this.scale=f,this.fontStack=m,this.textColor=v}}class Yr{constructor(o){this.sections=o}static fromString(o){return new Yr([new zc(o,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(o=>o.text.length!==0||o.image&&o.image.name.length!==0)}static factory(o){return o instanceof Yr?o:Yr.fromString(o)}toString(){return this.sections.length===0?"":this.sections.map(o=>o.text).join("")}}class zo{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof zo)return o;if(typeof o=="number")return new zo([o,o,o,o]);if(Array.isArray(o)&&!(o.length<1||o.length>4)){for(const c of o)if(typeof c!="number")return;switch(o.length){case 1:o=[o[0],o[0],o[0],o[0]];break;case 2:o=[o[0],o[1],o[0],o[1]];break;case 3:o=[o[0],o[1],o[2],o[1]]}return new zo(o)}}toString(){return JSON.stringify(this.values)}}const Dg=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class os{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof os)return o;if(Array.isArray(o)&&!(o.length<1)&&o.length%2==0){for(let c=0;c<o.length;c+=2){const f=o[c],m=o[c+1];if(typeof f!="string"||!Dg.has(f)||!Array.isArray(m)||m.length!==2||typeof m[0]!="number"||typeof m[1]!="number")return}return new os(o)}}toString(){return JSON.stringify(this.values)}}class kr{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new kr({name:o,available:!1}):null}}function Fc(l,o,c,f){return typeof l=="number"&&l>=0&&l<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof c=="number"&&c>=0&&c<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[l,o,c,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[l,o,c,f]:[l,o,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function su(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof Hn||l instanceof pp||l instanceof Yr||l instanceof zo||l instanceof os||l instanceof kr)return!0;if(Array.isArray(l)){for(const o of l)if(!su(o))return!1;return!0}if(typeof l=="object"){for(const o in l)if(!su(l[o]))return!1;return!0}return!1}function wi(l){if(l===null)return Ss;if(typeof l=="string")return ln;if(typeof l=="boolean")return Ke;if(typeof l=="number")return ue;if(l instanceof Hn)return Pr;if(l instanceof pp)return Es;if(l instanceof Yr)return st;if(l instanceof zo)return B;if(l instanceof os)return J;if(l instanceof kr)return G;if(Array.isArray(l)){const o=l.length;let c;for(const f of l){const m=wi(f);if(c){if(c===m)continue;c=on;break}c=m}return q(c||on,o)}return is}function zn(l){const o=typeof l;return l===null?"":o==="string"||o==="number"||o==="boolean"?String(l):l instanceof Hn||l instanceof Yr||l instanceof zo||l instanceof os||l instanceof kr?l.toString():JSON.stringify(l)}class wl{constructor(o,c){this.type=o,this.value=c}static parse(o,c){if(o.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!su(o[1]))return c.error("invalid value");const f=o[1];let m=wi(f);const v=c.expectedType;return m.kind!=="array"||m.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(m=v),new wl(m,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Di{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}const Bc={string:ln,number:ue,boolean:Ke,object:is};class ss{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");let f,m=1;const v=o[0];if(v==="array"){let E,T;if(o.length>2){const P=o[1];if(typeof P!="string"||!(P in Bc)||P==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);E=Bc[P],m++}else E=on;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return c.error('The length argument to "array" must be a positive integer literal',2);T=o[2],m++}f=q(E,T)}else{if(!Bc[v])throw new Error(`Types doesn't contain name = ${v}`);f=Bc[v]}const w=[];for(;m<o.length;m++){const E=c.parse(o[m],m,on);if(!E)return null;w.push(E)}return new ss(f,w)}evaluate(o){for(let c=0;c<this.args.length;c++){const f=this.args[c].evaluate(o);if(!_t(this.type,wi(f)))return f;if(c===this.args.length-1)throw new Di(`Expected value to be of type ${ot(this.type)}, but found ${ot(wi(f))} instead.`)}throw new Error}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const fp={"to-boolean":Ke,"to-color":Pr,"to-number":ue,"to-string":ln};class Ha{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");const f=o[0];if(!fp[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&o.length!==2)return c.error("Expected one argument.");const m=fp[f],v=[];for(let w=1;w<o.length;w++){const E=c.parse(o[w],w,on);if(!E)return null;v.push(E)}return new Ha(m,v)}evaluate(o){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(o);case"color":{let c,f;for(const m of this.args){if(c=m.evaluate(o),f=null,c instanceof Hn)return c;if(typeof c=="string"){const v=o.parseColor(c);if(v)return v}else if(Array.isArray(c)&&(f=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:Fc(c[0],c[1],c[2],c[3]),!f))return new Hn(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new Di(f||`Could not parse color from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"padding":{let c;for(const f of this.args){c=f.evaluate(o);const m=zo.parse(c);if(m)return m}throw new Di(`Could not parse padding from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"variableAnchorOffsetCollection":{let c;for(const f of this.args){c=f.evaluate(o);const m=os.parse(c);if(m)return m}throw new Di(`Could not parse variableAnchorOffsetCollection from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"number":{let c=null;for(const f of this.args){if(c=f.evaluate(o),c===null)return 0;const m=Number(c);if(!isNaN(m))return m}throw new Di(`Could not convert ${JSON.stringify(c)} to number.`)}case"formatted":return Yr.fromString(zn(this.args[0].evaluate(o)));case"resolvedImage":return kr.fromString(zn(this.args[0].evaluate(o)));default:return zn(this.args[0].evaluate(o))}}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const xd=["Unknown","Point","LineString","Polygon"];class dp{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?xd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(o){let c=this._parseColorCache[o];return c||(c=this._parseColorCache[o]=Hn.parse(o)),c}}class Vc{constructor(o,c,f=[],m,v=new Sa,w=[]){this.registry=o,this.path=f,this.key=f.map(E=>`[${E}]`).join(""),this.scope=v,this.errors=w,this.expectedType=m,this._isConstant=c}parse(o,c,f,m,v={}){return c?this.concat(c,f,m)._parse(o,v):this._parse(o,v)}_parse(o,c){function f(m,v,w){return w==="assert"?new ss(v,[m]):w==="coerce"?new Ha(v,[m]):m}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=o[0];if(typeof m!="string")return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[m];if(v){let w=v.parse(o,this);if(!w)return null;if(this.expectedType){const E=this.expectedType,T=w.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||T.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string")if(E.kind!=="padding"||T.kind!=="value"&&T.kind!=="number"&&T.kind!=="array")if(E.kind!=="variableAnchorOffsetCollection"||T.kind!=="value"&&T.kind!=="array"){if(this.checkSubtype(E,T))return null}else w=f(w,E,c.typeAnnotation||"coerce");else w=f(w,E,c.typeAnnotation||"coerce");else w=f(w,E,c.typeAnnotation||"coerce");else w=f(w,E,c.typeAnnotation||"assert")}if(!(w instanceof wl)&&w.type.kind!=="resolvedImage"&&this._isConstant(w)){const E=new dp;try{w=new wl(w.type,w.evaluate(E))}catch(T){return this.error(T.message),null}}return w}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,c,f){const m=typeof o=="number"?this.path.concat(o):this.path,v=f?this.scope.concat(f):this.scope;return new Vc(this.registry,this._isConstant,m,c||null,v,this.errors)}error(o,...c){const f=`${this.key}${c.map(m=>`[${m}]`).join("")}`;this.errors.push(new ri(f,o))}checkSubtype(o,c){const f=_t(o,c);return f&&this.error(f),f}}class Uc{constructor(o,c,f){this.type=Es,this.locale=f,this.caseSensitive=o,this.diacriticSensitive=c}static parse(o,c){if(o.length!==2)return c.error("Expected one argument.");const f=o[1];if(typeof f!="object"||Array.isArray(f))return c.error("Collator options argument must be an object.");const m=c.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Ke);if(!m)return null;const v=c.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Ke);if(!v)return null;let w=null;return f.locale&&(w=c.parse(f.locale,1,ln),!w)?null:new Uc(m,v,w)}evaluate(o){return new pp(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}}const Ya=8192;function mp(l,o){l[0]=Math.min(l[0],o[0]),l[1]=Math.min(l[1],o[1]),l[2]=Math.max(l[2],o[0]),l[3]=Math.max(l[3],o[1])}function Hu(l,o){return!(l[0]<=o[0]||l[2]>=o[2]||l[1]<=o[1]||l[3]>=o[3])}function wd(l,o){const c=(180+l[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,m=Math.pow(2,o.z);return[Math.round(c*m*Ya),Math.round(f*m*Ya)]}function Rg(l,o,c){const f=l[0]-o[0],m=l[1]-o[1],v=l[0]-c[0],w=l[1]-c[1];return f*w-v*m==0&&f*v<=0&&m*w<=0}function gp(l,o){let c=!1;for(let w=0,E=o.length;w<E;w++){const T=o[w];for(let P=0,N=T.length;P<N-1;P++){if(Rg(l,T[P],T[P+1]))return!1;(m=T[P])[1]>(f=l)[1]!=(v=T[P+1])[1]>f[1]&&f[0]<(v[0]-m[0])*(f[1]-m[1])/(v[1]-m[1])+m[0]&&(c=!c)}}var f,m,v;return c}function _p(l,o){for(let c=0;c<o.length;c++)if(gp(l,o[c]))return!0;return!1}function Sd(l,o,c,f){const m=f[0]-c[0],v=f[1]-c[1],w=(l[0]-c[0])*v-m*(l[1]-c[1]),E=(o[0]-c[0])*v-m*(o[1]-c[1]);return w>0&&E<0||w<0&&E>0}function Og(l,o,c){for(const P of c)for(let N=0;N<P.length-1;++N)if((E=[(w=P[N+1])[0]-(v=P[N])[0],w[1]-v[1]])[0]*(T=[(m=o)[0]-(f=l)[0],m[1]-f[1]])[1]-E[1]*T[0]!=0&&Sd(f,m,v,w)&&Sd(v,w,f,m))return!0;var f,m,v,w,E,T;return!1}function Ed(l,o){for(let c=0;c<l.length;++c)if(!gp(l[c],o))return!1;for(let c=0;c<l.length-1;++c)if(Og(l[c],l[c+1],o))return!1;return!0}function Id(l,o){for(let c=0;c<o.length;c++)if(Ed(l,o[c]))return!0;return!1}function Gc(l,o,c){const f=[];for(let m=0;m<l.length;m++){const v=[];for(let w=0;w<l[m].length;w++){const E=wd(l[m][w],c);mp(o,E),v.push(E)}f.push(v)}return f}function Cd(l,o,c){const f=[];for(let m=0;m<l.length;m++){const v=Gc(l[m],o,c);f.push(v)}return f}function Td(l,o,c,f){if(l[0]<c[0]||l[0]>c[2]){const m=.5*f;let v=l[0]-c[0]>m?-f:c[0]-l[0]>m?f:0;v===0&&(v=l[0]-c[2]>m?-f:c[2]-l[0]>m?f:0),l[0]+=v}mp(o,l)}function yp(l,o,c,f){const m=Math.pow(2,f.z)*Ya,v=[f.x*Ya,f.y*Ya],w=[];for(const E of l)for(const T of E){const P=[T.x+v[0],T.y+v[1]];Td(P,o,c,m),w.push(P)}return w}function vp(l,o,c,f){const m=Math.pow(2,f.z)*Ya,v=[f.x*Ya,f.y*Ya],w=[];for(const T of l){const P=[];for(const N of T){const z=[N.x+v[0],N.y+v[1]];mp(o,z),P.push(z)}w.push(P)}if(o[2]-o[0]<=m/2){(E=o)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(const T of w)for(const P of T)Td(P,o,c,m)}var E;return w}class Sl{constructor(o,c){this.type=Ke,this.geojson=o,this.geometries=c}static parse(o,c){if(o.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(su(o[1])){const f=o[1];if(f.type==="FeatureCollection")for(let m=0;m<f.features.length;++m){const v=f.features[m].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Sl(f,f.features[m].geometry)}else if(f.type==="Feature"){const m=f.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Sl(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Sl(f,f)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(c,f){const m=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],w=c.canonicalID();if(f.type==="Polygon"){const E=Gc(f.coordinates,v,w),T=yp(c.geometry(),m,v,w);if(!Hu(m,v))return!1;for(const P of T)if(!gp(P,E))return!1}if(f.type==="MultiPolygon"){const E=Cd(f.coordinates,v,w),T=yp(c.geometry(),m,v,w);if(!Hu(m,v))return!1;for(const P of T)if(!_p(P,E))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(c,f){const m=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],w=c.canonicalID();if(f.type==="Polygon"){const E=Gc(f.coordinates,v,w),T=vp(c.geometry(),m,v,w);if(!Hu(m,v))return!1;for(const P of T)if(!Ed(P,E))return!1}if(f.type==="MultiPolygon"){const E=Cd(f.coordinates,v,w),T=vp(c.geometry(),m,v,w);if(!Hu(m,v))return!1;for(const P of T)if(!Id(P,E))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class qc{constructor(o,c){this.type=c.type,this.name=o,this.boundExpression=c}static parse(o,c){if(o.length!==2||typeof o[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const f=o[1];return c.scope.has(f)?new qc(f,c.scope.get(f)):c.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}}class as{constructor(o,c,f,m){this.name=o,this.type=c,this._evaluate=f,this.args=m}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}static parse(o,c){const f=o[0],m=as.definitions[f];if(!m)return c.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(m)?m[0]:m.type,w=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,E=w.filter(([P])=>!Array.isArray(P)||P.length===o.length-1);let T=null;for(const[P,N]of E){T=new Vc(c.registry,jc,c.path,null,c.scope);const z=[];let V=!1;for(let Z=1;Z<o.length;Z++){const H=o[Z],tt=Array.isArray(P)?P[Z-1]:P.type,lt=T.parse(H,1+z.length,tt);if(!lt){V=!0;break}z.push(lt)}if(!V)if(Array.isArray(P)&&P.length!==z.length)T.error(`Expected ${P.length} arguments, but found ${z.length} instead.`);else{for(let Z=0;Z<z.length;Z++){const H=Array.isArray(P)?P[Z]:P.type,tt=z[Z];T.concat(Z+1).checkSubtype(H,tt.type)}if(T.errors.length===0)return new as(f,v,N,z)}}if(E.length===1)c.errors.push(...T.errors);else{const P=(E.length?E:w).map(([z])=>{return V=z,Array.isArray(V)?`(${V.map(ot).join(", ")})`:`(${ot(V.type)}...)`;var V}).join(" | "),N=[];for(let z=1;z<o.length;z++){const V=c.parse(o[z],1+N.length);if(!V)return null;N.push(ot(V.type))}c.error(`Expected arguments of type ${P}, but found (${N.join(", ")}) instead.`)}return null}static register(o,c){as.definitions=c;for(const f in c)o[f]=as}}function jc(l){if(l instanceof qc)return jc(l.boundExpression);if(l instanceof as&&l.name==="error"||l instanceof Uc||l instanceof Sl)return!1;const o=l instanceof Ha||l instanceof ss;let c=!0;return l.eachChild(f=>{c=o?c&&jc(f):c&&f instanceof wl}),!!c&&Zc(l)&&Wc(l,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Zc(l){if(l instanceof as&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof Sl)return!1;let o=!0;return l.eachChild(c=>{o&&!Zc(c)&&(o=!1)}),o}function Yu(l){if(l instanceof as&&l.name==="feature-state")return!1;let o=!0;return l.eachChild(c=>{o&&!Yu(c)&&(o=!1)}),o}function Wc(l,o){if(l instanceof as&&o.indexOf(l.name)>=0)return!1;let c=!0;return l.eachChild(f=>{c&&!Wc(f,o)&&(c=!1)}),c}function au(l,o){const c=l.length-1;let f,m,v=0,w=c,E=0;for(;v<=w;)if(E=Math.floor((v+w)/2),f=l[E],m=l[E+1],f<=o){if(E===c||o<m)return E;v=E+1}else{if(!(f>o))throw new Di("Input is not a number.");w=E-1}return 0}class Ka{constructor(o,c,f){this.type=o,this.input=c,this.labels=[],this.outputs=[];for(const[m,v]of f)this.labels.push(m),this.outputs.push(v)}static parse(o,c){if(o.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return c.error("Expected an even number of arguments.");const f=c.parse(o[1],1,ue);if(!f)return null;const m=[];let v=null;c.expectedType&&c.expectedType.kind!=="value"&&(v=c.expectedType);for(let w=1;w<o.length;w+=2){const E=w===1?-1/0:o[w],T=o[w+1],P=w,N=w+1;if(typeof E!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(m.length&&m[m.length-1][0]>=E)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const z=c.parse(T,N,v);if(!z)return null;v=v||z.type,m.push([E,z])}return new Ka(v,f,m)}evaluate(o){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(o);const m=this.input.evaluate(o);if(m<=c[0])return f[0].evaluate(o);const v=c.length;return m>=c[v-1]?f[v-1].evaluate(o):f[au(c,m)].evaluate(o)}eachChild(o){o(this.input);for(const c of this.outputs)o(c)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function Cn(l,o,c){return l+c*(o-l)}function Xc(l,o,c){return l.map((f,m)=>Cn(f,o[m],c))}const Fo={number:Cn,color:function(l,o,c,f="rgb"){switch(f){case"rgb":{const[m,v,w,E]=Xc(l.rgb,o.rgb,c);return new Hn(m,v,w,E,!1)}case"hcl":{const[m,v,w,E]=l.hcl,[T,P,N,z]=o.hcl;let V,Z;if(isNaN(m)||isNaN(T))isNaN(m)?isNaN(T)?V=NaN:(V=T,w!==1&&w!==0||(Z=P)):(V=m,N!==1&&N!==0||(Z=v));else{let Tt=T-m;T>m&&Tt>180?Tt-=360:T<m&&m-T>180&&(Tt+=360),V=m+c*Tt}const[H,tt,lt,ft]=function([Tt,yt,Mt,zt]){return Tt=isNaN(Tt)?0:Tt*nn,oi([Mt,Math.cos(Tt)*yt,Math.sin(Tt)*yt,zt])}([V,Z??Cn(v,P,c),Cn(w,N,c),Cn(E,z,c)]);return new Hn(H,tt,lt,ft,!1)}case"lab":{const[m,v,w,E]=oi(Xc(l.lab,o.lab,c));return new Hn(m,v,w,E,!1)}}},array:Xc,padding:function(l,o,c){return new zo(Xc(l.values,o.values,c))},variableAnchorOffsetCollection:function(l,o,c){const f=l.values,m=o.values;if(f.length!==m.length)throw new Di(`Cannot interpolate values of different length. from: ${l.toString()}, to: ${o.toString()}`);const v=[];for(let w=0;w<f.length;w+=2){if(f[w]!==m[w])throw new Di(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${f[w]}, to[${w}]: ${m[w]}`);v.push(f[w]);const[E,T]=f[w+1],[P,N]=m[w+1];v.push([Cn(E,P,c),Cn(T,N,c)])}return new os(v)}};class Bo{constructor(o,c,f,m,v){this.type=o,this.operator=c,this.interpolation=f,this.input=m,this.labels=[],this.outputs=[];for(const[w,E]of v)this.labels.push(w),this.outputs.push(E)}static interpolationFactor(o,c,f,m){let v=0;if(o.name==="exponential")v=bp(c,o.base,f,m);else if(o.name==="linear")v=bp(c,1,f,m);else if(o.name==="cubic-bezier"){const w=o.controlPoints;v=new K(w[0],w[1],w[2],w[3]).solve(bp(c,1,f,m))}return v}static parse(o,c){let[f,m,v,...w]=o;if(!Array.isArray(m)||m.length===0)return c.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const P=m[1];if(typeof P!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:P}}else{if(m[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const P=m.slice(1);if(P.length!==4||P.some(N=>typeof N!="number"||N<0||N>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:P}}}if(o.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(v=c.parse(v,2,ue),!v)return null;const E=[];let T=null;f==="interpolate-hcl"||f==="interpolate-lab"?T=Pr:c.expectedType&&c.expectedType.kind!=="value"&&(T=c.expectedType);for(let P=0;P<w.length;P+=2){const N=w[P],z=w[P+1],V=P+3,Z=P+4;if(typeof N!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(E.length&&E[E.length-1][0]>=N)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',V);const H=c.parse(z,Z,T);if(!H)return null;T=T||H.type,E.push([N,H])}return jt(T,ue)||jt(T,Pr)||jt(T,B)||jt(T,J)||jt(T,q(ue))?new Bo(T,f,m,v,E):c.error(`Type ${ot(T)} is not interpolatable.`)}evaluate(o){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(o);const m=this.input.evaluate(o);if(m<=c[0])return f[0].evaluate(o);const v=c.length;if(m>=c[v-1])return f[v-1].evaluate(o);const w=au(c,m),E=Bo.interpolationFactor(this.interpolation,m,c[w],c[w+1]),T=f[w].evaluate(o),P=f[w+1].evaluate(o);switch(this.operator){case"interpolate":return Fo[this.type.kind](T,P,E);case"interpolate-hcl":return Fo.color(T,P,E,"hcl");case"interpolate-lab":return Fo.color(T,P,E,"lab")}}eachChild(o){o(this.input);for(const c of this.outputs)o(c)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function bp(l,o,c,f){const m=f-c,v=l-c;return m===0?0:o===1?v/m:(Math.pow(o,v)-1)/(Math.pow(o,m)-1)}class Hc{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expectected at least one argument.");let f=null;const m=c.expectedType;m&&m.kind!=="value"&&(f=m);const v=[];for(const E of o.slice(1)){const T=c.parse(E,1+v.length,f,void 0,{typeAnnotation:"omit"});if(!T)return null;f=f||T.type,v.push(T)}if(!f)throw new Error("No output type");const w=m&&v.some(E=>_t(m,E.type));return new Hc(w?on:f,v)}evaluate(o){let c,f=null,m=0;for(const v of this.args)if(m++,f=v.evaluate(o),f&&f instanceof kr&&!f.available&&(c||(c=f.name),f=null,m===this.args.length&&(f=c)),f!==null)break;return f}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}class Yc{constructor(o,c){this.type=c.type,this.bindings=[].concat(o),this.result=c}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const c of this.bindings)o(c[1]);o(this.result)}static parse(o,c){if(o.length<4)return c.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const f=[];for(let v=1;v<o.length-1;v+=2){const w=o[v];if(typeof w!="string")return c.error(`Expected string, but found ${typeof w} instead.`,v);if(/[^a-zA-Z0-9_]/.test(w))return c.error("Variable names must contain only alphanumeric characters or '_'.",v);const E=c.parse(o[v+1],v+1);if(!E)return null;f.push([w,E])}const m=c.parse(o[o.length-1],o.length-1,c.expectedType,f);return m?new Yc(f,m):null}outputDefined(){return this.result.outputDefined()}}class xp{constructor(o,c,f){this.type=o,this.index=c,this.input=f}static parse(o,c){if(o.length!==3)return c.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const f=c.parse(o[1],1,ue),m=c.parse(o[2],2,q(c.expectedType||on));return f&&m?new xp(m.type.itemType,f,m):null}evaluate(o){const c=this.index.evaluate(o),f=this.input.evaluate(o);if(c<0)throw new Di(`Array index out of bounds: ${c} < 0.`);if(c>=f.length)throw new Di(`Array index out of bounds: ${c} > ${f.length-1}.`);if(c!==Math.floor(c))throw new Di(`Array index must be an integer, but found ${c} instead.`);return f[c]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}}class wp{constructor(o,c){this.type=Ke,this.needle=o,this.haystack=c}static parse(o,c){if(o.length!==3)return c.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const f=c.parse(o[1],1,on),m=c.parse(o[2],2,on);return f&&m?it(f.type,[Ke,ln,ue,Ss,on])?new wp(f,m):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${ot(f.type)} instead`):null}evaluate(o){const c=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(!f)return!1;if(!bt(c,["boolean","string","number","null"]))throw new Di(`Expected first argument to be of type boolean, string, number or null, but found ${ot(wi(c))} instead.`);if(!bt(f,["string","array"]))throw new Di(`Expected second argument to be of type array or string, but found ${ot(wi(f))} instead.`);return f.indexOf(c)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}}class Kc{constructor(o,c,f){this.type=ue,this.needle=o,this.haystack=c,this.fromIndex=f}static parse(o,c){if(o.length<=2||o.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const f=c.parse(o[1],1,on),m=c.parse(o[2],2,on);if(!f||!m)return null;if(!it(f.type,[Ke,ln,ue,Ss,on]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${ot(f.type)} instead`);if(o.length===4){const v=c.parse(o[3],3,ue);return v?new Kc(f,m,v):null}return new Kc(f,m)}evaluate(o){const c=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(!bt(c,["boolean","string","number","null"]))throw new Di(`Expected first argument to be of type boolean, string, number or null, but found ${ot(wi(c))} instead.`);if(!bt(f,["string","array"]))throw new Di(`Expected second argument to be of type array or string, but found ${ot(wi(f))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(o);return f.indexOf(c,m)}return f.indexOf(c)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}}class Sp{constructor(o,c,f,m,v,w){this.inputType=o,this.type=c,this.input=f,this.cases=m,this.outputs=v,this.otherwise=w}static parse(o,c){if(o.length<5)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return c.error("Expected an even number of arguments.");let f,m;c.expectedType&&c.expectedType.kind!=="value"&&(m=c.expectedType);const v={},w=[];for(let P=2;P<o.length-1;P+=2){let N=o[P];const z=o[P+1];Array.isArray(N)||(N=[N]);const V=c.concat(P);if(N.length===0)return V.error("Expected at least one branch label.");for(const H of N){if(typeof H!="number"&&typeof H!="string")return V.error("Branch labels must be numbers or strings.");if(typeof H=="number"&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return V.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof H=="number"&&Math.floor(H)!==H)return V.error("Numeric branch labels must be integer values.");if(f){if(V.checkSubtype(f,wi(H)))return null}else f=wi(H);if(v[String(H)]!==void 0)return V.error("Branch labels must be unique.");v[String(H)]=w.length}const Z=c.parse(z,P,m);if(!Z)return null;m=m||Z.type,w.push(Z)}const E=c.parse(o[1],1,on);if(!E)return null;const T=c.parse(o[o.length-1],o.length-1,m);return T?E.type.kind!=="value"&&c.concat(1).checkSubtype(f,E.type)?null:new Sp(f,m,E,v,w,T):null}evaluate(o){const c=this.input.evaluate(o);return(wi(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}}class Ep{constructor(o,c,f){this.type=o,this.branches=c,this.otherwise=f}static parse(o,c){if(o.length<4)return c.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return c.error("Expected an odd number of arguments.");let f;c.expectedType&&c.expectedType.kind!=="value"&&(f=c.expectedType);const m=[];for(let w=1;w<o.length-1;w+=2){const E=c.parse(o[w],w,Ke);if(!E)return null;const T=c.parse(o[w+1],w+1,f);if(!T)return null;m.push([E,T]),f=f||T.type}const v=c.parse(o[o.length-1],o.length-1,f);if(!v)return null;if(!f)throw new Error("Can't infer output type");return new Ep(f,m,v)}evaluate(o){for(const[c,f]of this.branches)if(c.evaluate(o))return f.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[c,f]of this.branches)o(c),o(f);o(this.otherwise)}outputDefined(){return this.branches.every(([o,c])=>c.outputDefined())&&this.otherwise.outputDefined()}}class Jc{constructor(o,c,f,m){this.type=o,this.input=c,this.beginIndex=f,this.endIndex=m}static parse(o,c){if(o.length<=2||o.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const f=c.parse(o[1],1,on),m=c.parse(o[2],2,ue);if(!f||!m)return null;if(!it(f.type,[q(on),ln,on]))return c.error(`Expected first argument to be of type array or string, but found ${ot(f.type)} instead`);if(o.length===4){const v=c.parse(o[3],3,ue);return v?new Jc(f.type,f,m,v):null}return new Jc(f.type,f,m)}evaluate(o){const c=this.input.evaluate(o),f=this.beginIndex.evaluate(o);if(!bt(c,["string","array"]))throw new Di(`Expected first argument to be of type array or string, but found ${ot(wi(c))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(o);return c.slice(f,m)}return c.slice(f)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}}function Ld(l,o){return l==="=="||l==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function Md(l,o,c,f){return f.compare(o,c)===0}function lu(l,o,c){const f=l!=="=="&&l!=="!=";return class Wb{constructor(v,w,E){this.type=Ke,this.lhs=v,this.rhs=w,this.collator=E,this.hasUntypedArgument=v.type.kind==="value"||w.type.kind==="value"}static parse(v,w){if(v.length!==3&&v.length!==4)return w.error("Expected two or three arguments.");const E=v[0];let T=w.parse(v[1],1,on);if(!T)return null;if(!Ld(E,T.type))return w.concat(1).error(`"${E}" comparisons are not supported for type '${ot(T.type)}'.`);let P=w.parse(v[2],2,on);if(!P)return null;if(!Ld(E,P.type))return w.concat(2).error(`"${E}" comparisons are not supported for type '${ot(P.type)}'.`);if(T.type.kind!==P.type.kind&&T.type.kind!=="value"&&P.type.kind!=="value")return w.error(`Cannot compare types '${ot(T.type)}' and '${ot(P.type)}'.`);f&&(T.type.kind==="value"&&P.type.kind!=="value"?T=new ss(P.type,[T]):T.type.kind!=="value"&&P.type.kind==="value"&&(P=new ss(T.type,[P])));let N=null;if(v.length===4){if(T.type.kind!=="string"&&P.type.kind!=="string"&&T.type.kind!=="value"&&P.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(N=w.parse(v[3],3,Es),!N)return null}return new Wb(T,P,N)}evaluate(v){const w=this.lhs.evaluate(v),E=this.rhs.evaluate(v);if(f&&this.hasUntypedArgument){const T=wi(w),P=wi(E);if(T.kind!==P.kind||T.kind!=="string"&&T.kind!=="number")throw new Di(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${T.kind}, ${P.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const T=wi(w),P=wi(E);if(T.kind!=="string"||P.kind!=="string")return o(v,w,E)}return this.collator?c(v,w,E,this.collator.evaluate(v)):o(v,w,E)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const zg=lu("==",function(l,o,c){return o===c},Md),Fg=lu("!=",function(l,o,c){return o!==c},function(l,o,c,f){return!Md(0,o,c,f)}),Bg=lu("<",function(l,o,c){return o<c},function(l,o,c,f){return f.compare(o,c)<0}),Vg=lu(">",function(l,o,c){return o>c},function(l,o,c,f){return f.compare(o,c)>0}),Ug=lu("<=",function(l,o,c){return o<=c},function(l,o,c,f){return f.compare(o,c)<=0}),Gg=lu(">=",function(l,o,c){return o>=c},function(l,o,c,f){return f.compare(o,c)>=0});class Ip{constructor(o,c,f,m,v){this.type=ln,this.number=o,this.locale=c,this.currency=f,this.minFractionDigits=m,this.maxFractionDigits=v}static parse(o,c){if(o.length!==3)return c.error("Expected two arguments.");const f=c.parse(o[1],1,ue);if(!f)return null;const m=o[2];if(typeof m!="object"||Array.isArray(m))return c.error("NumberFormat options argument must be an object.");let v=null;if(m.locale&&(v=c.parse(m.locale,1,ln),!v))return null;let w=null;if(m.currency&&(w=c.parse(m.currency,1,ln),!w))return null;let E=null;if(m["min-fraction-digits"]&&(E=c.parse(m["min-fraction-digits"],1,ue),!E))return null;let T=null;return m["max-fraction-digits"]&&(T=c.parse(m["max-fraction-digits"],1,ue),!T)?null:new Ip(f,v,w,E,T)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}}class Qc{constructor(o){this.type=st,this.sections=o}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");const f=o[1];if(!Array.isArray(f)&&typeof f=="object")return c.error("First argument must be an image or text section.");const m=[];let v=!1;for(let w=1;w<=o.length-1;++w){const E=o[w];if(v&&typeof E=="object"&&!Array.isArray(E)){v=!1;let T=null;if(E["font-scale"]&&(T=c.parse(E["font-scale"],1,ue),!T))return null;let P=null;if(E["text-font"]&&(P=c.parse(E["text-font"],1,q(ln)),!P))return null;let N=null;if(E["text-color"]&&(N=c.parse(E["text-color"],1,Pr),!N))return null;const z=m[m.length-1];z.scale=T,z.font=P,z.textColor=N}else{const T=c.parse(o[w],1,on);if(!T)return null;const P=T.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,m.push({content:T,scale:null,font:null,textColor:null})}}return new Qc(m)}evaluate(o){return new Yr(this.sections.map(c=>{const f=c.content.evaluate(o);return wi(f)===G?new zc("",f,null,null,null):new zc(zn(f),null,c.scale?c.scale.evaluate(o):null,c.font?c.font.evaluate(o).join(","):null,c.textColor?c.textColor.evaluate(o):null)}))}eachChild(o){for(const c of this.sections)o(c.content),c.scale&&o(c.scale),c.font&&o(c.font),c.textColor&&o(c.textColor)}outputDefined(){return!1}}class Cp{constructor(o){this.type=G,this.input=o}static parse(o,c){if(o.length!==2)return c.error("Expected two arguments.");const f=c.parse(o[1],1,ln);return f?new Cp(f):c.error("No image name provided.")}evaluate(o){const c=this.input.evaluate(o),f=kr.fromString(c);return f&&o.availableImages&&(f.available=o.availableImages.indexOf(c)>-1),f}eachChild(o){o(this.input)}outputDefined(){return!1}}class Tp{constructor(o){this.type=ue,this.input=o}static parse(o,c){if(o.length!==2)return c.error(`Expected 1 argument, but found ${o.length-1} instead.`);const f=c.parse(o[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${ot(f.type)} instead.`):new Tp(f):null}evaluate(o){const c=this.input.evaluate(o);if(typeof c=="string"||Array.isArray(c))return c.length;throw new Di(`Expected value to be of type string or array, but found ${ot(wi(c))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}}const uu={"==":zg,"!=":Fg,">":Vg,"<":Bg,">=":Gg,"<=":Ug,array:ss,at:xp,boolean:ss,case:Ep,coalesce:Hc,collator:Uc,format:Qc,image:Cp,in:wp,"index-of":Kc,interpolate:Bo,"interpolate-hcl":Bo,"interpolate-lab":Bo,length:Tp,let:Yc,literal:wl,match:Sp,number:ss,"number-format":Ip,object:ss,slice:Jc,step:Ka,string:ss,"to-boolean":Ha,"to-color":Ha,"to-number":Ha,"to-string":Ha,var:qc,within:Sl};function Pd(l,[o,c,f,m]){o=o.evaluate(l),c=c.evaluate(l),f=f.evaluate(l);const v=m?m.evaluate(l):1,w=Fc(o,c,f,v);if(w)throw new Di(w);return new Hn(o/255,c/255,f/255,v,!1)}function Ad(l,o){return l in o}function Lp(l,o){const c=o[l];return c===void 0?null:c}function El(l){return{type:l}}function kd(l){return{result:"success",value:l}}function Ja(l){return{result:"error",value:l}}function cu(l){return l["property-type"]==="data-driven"||l["property-type"]==="cross-faded-data-driven"}function Nd(l){return!!l.expression&&l.expression.parameters.indexOf("zoom")>-1}function Mp(l){return!!l.expression&&l.expression.interpolated}function Fn(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}function Si(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function qg(l){return l}function Tn(l,o){const c=o.type==="color",f=l.stops&&typeof l.stops[0][0]=="object",m=f||!(f||l.property!==void 0),v=l.type||(Mp(o)?"exponential":"interval");if(c||o.type==="padding"){const N=c?Hn.parse:zo.parse;(l=wo({},l)).stops&&(l.stops=l.stops.map(z=>[z[0],N(z[1])])),l.default=N(l.default?l.default:o.default)}if(l.colorSpace&&(w=l.colorSpace)!=="rgb"&&w!=="hcl"&&w!=="lab")throw new Error(`Unknown color space: "${l.colorSpace}"`);var w;let E,T,P;if(v==="exponential")E=Ku;else if(v==="interval")E=_i;else if(v==="categorical"){E=Ei,T=Object.create(null);for(const N of l.stops)T[N[0]]=N[1];P=typeof l.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);E=Dd}if(f){const N={},z=[];for(let H=0;H<l.stops.length;H++){const tt=l.stops[H],lt=tt[0].zoom;N[lt]===void 0&&(N[lt]={zoom:lt,type:l.type,property:l.property,default:l.default,stops:[]},z.push(lt)),N[lt].stops.push([tt[0].value,tt[1]])}const V=[];for(const H of z)V.push([N[H].zoom,Tn(N[H],o)]);const Z={name:"linear"};return{kind:"composite",interpolationType:Z,interpolationFactor:Bo.interpolationFactor.bind(void 0,Z),zoomStops:V.map(H=>H[0]),evaluate:({zoom:H},tt)=>Ku({stops:V,base:l.base},o,H).evaluate(H,tt)}}if(m){const N=v==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:N,interpolationFactor:Bo.interpolationFactor.bind(void 0,N),zoomStops:l.stops.map(z=>z[0]),evaluate:({zoom:z})=>E(l,o,z,T,P)}}return{kind:"source",evaluate(N,z){const V=z&&z.properties?z.properties[l.property]:void 0;return V===void 0?Il(l.default,o.default):E(l,o,V,T,P)}}}function Il(l,o,c){return l!==void 0?l:o!==void 0?o:c!==void 0?c:void 0}function Ei(l,o,c,f,m){return Il(typeof c===m?f[c]:void 0,l.default,o.default)}function _i(l,o,c){if(Fn(c)!=="number")return Il(l.default,o.default);const f=l.stops.length;if(f===1||c<=l.stops[0][0])return l.stops[0][1];if(c>=l.stops[f-1][0])return l.stops[f-1][1];const m=au(l.stops.map(v=>v[0]),c);return l.stops[m][1]}function Ku(l,o,c){const f=l.base!==void 0?l.base:1;if(Fn(c)!=="number")return Il(l.default,o.default);const m=l.stops.length;if(m===1||c<=l.stops[0][0])return l.stops[0][1];if(c>=l.stops[m-1][0])return l.stops[m-1][1];const v=au(l.stops.map(N=>N[0]),c),w=function(N,z,V,Z){const H=Z-V,tt=N-V;return H===0?0:z===1?tt/H:(Math.pow(z,tt)-1)/(Math.pow(z,H)-1)}(c,f,l.stops[v][0],l.stops[v+1][0]),E=l.stops[v][1],T=l.stops[v+1][1],P=Fo[o.type]||qg;return typeof E.evaluate=="function"?{evaluate(...N){const z=E.evaluate.apply(void 0,N),V=T.evaluate.apply(void 0,N);if(z!==void 0&&V!==void 0)return P(z,V,w,l.colorSpace)}}:P(E,T,w,l.colorSpace)}function Dd(l,o,c){switch(o.type){case"color":c=Hn.parse(c);break;case"formatted":c=Yr.fromString(c.toString());break;case"resolvedImage":c=kr.fromString(c.toString());break;case"padding":c=zo.parse(c);break;default:Fn(c)===o.type||o.type==="enum"&&o.values[c]||(c=void 0)}return Il(c,l.default,o.default)}as.register(uu,{error:[{kind:"error"},[ln],(l,[o])=>{throw new Di(o.evaluate(l))}],typeof:[ln,[on],(l,[o])=>ot(wi(o.evaluate(l)))],"to-rgba":[q(ue,4),[Pr],(l,[o])=>{const[c,f,m,v]=o.evaluate(l).rgb;return[255*c,255*f,255*m,v]}],rgb:[Pr,[ue,ue,ue],Pd],rgba:[Pr,[ue,ue,ue,ue],Pd],has:{type:Ke,overloads:[[[ln],(l,[o])=>Ad(o.evaluate(l),l.properties())],[[ln,is],(l,[o,c])=>Ad(o.evaluate(l),c.evaluate(l))]]},get:{type:on,overloads:[[[ln],(l,[o])=>Lp(o.evaluate(l),l.properties())],[[ln,is],(l,[o,c])=>Lp(o.evaluate(l),c.evaluate(l))]]},"feature-state":[on,[ln],(l,[o])=>Lp(o.evaluate(l),l.featureState||{})],properties:[is,[],l=>l.properties()],"geometry-type":[ln,[],l=>l.geometryType()],id:[on,[],l=>l.id()],zoom:[ue,[],l=>l.globals.zoom],"heatmap-density":[ue,[],l=>l.globals.heatmapDensity||0],"line-progress":[ue,[],l=>l.globals.lineProgress||0],accumulated:[on,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[ue,El(ue),(l,o)=>{let c=0;for(const f of o)c+=f.evaluate(l);return c}],"*":[ue,El(ue),(l,o)=>{let c=1;for(const f of o)c*=f.evaluate(l);return c}],"-":{type:ue,overloads:[[[ue,ue],(l,[o,c])=>o.evaluate(l)-c.evaluate(l)],[[ue],(l,[o])=>-o.evaluate(l)]]},"/":[ue,[ue,ue],(l,[o,c])=>o.evaluate(l)/c.evaluate(l)],"%":[ue,[ue,ue],(l,[o,c])=>o.evaluate(l)%c.evaluate(l)],ln2:[ue,[],()=>Math.LN2],pi:[ue,[],()=>Math.PI],e:[ue,[],()=>Math.E],"^":[ue,[ue,ue],(l,[o,c])=>Math.pow(o.evaluate(l),c.evaluate(l))],sqrt:[ue,[ue],(l,[o])=>Math.sqrt(o.evaluate(l))],log10:[ue,[ue],(l,[o])=>Math.log(o.evaluate(l))/Math.LN10],ln:[ue,[ue],(l,[o])=>Math.log(o.evaluate(l))],log2:[ue,[ue],(l,[o])=>Math.log(o.evaluate(l))/Math.LN2],sin:[ue,[ue],(l,[o])=>Math.sin(o.evaluate(l))],cos:[ue,[ue],(l,[o])=>Math.cos(o.evaluate(l))],tan:[ue,[ue],(l,[o])=>Math.tan(o.evaluate(l))],asin:[ue,[ue],(l,[o])=>Math.asin(o.evaluate(l))],acos:[ue,[ue],(l,[o])=>Math.acos(o.evaluate(l))],atan:[ue,[ue],(l,[o])=>Math.atan(o.evaluate(l))],min:[ue,El(ue),(l,o)=>Math.min(...o.map(c=>c.evaluate(l)))],max:[ue,El(ue),(l,o)=>Math.max(...o.map(c=>c.evaluate(l)))],abs:[ue,[ue],(l,[o])=>Math.abs(o.evaluate(l))],round:[ue,[ue],(l,[o])=>{const c=o.evaluate(l);return c<0?-Math.round(-c):Math.round(c)}],floor:[ue,[ue],(l,[o])=>Math.floor(o.evaluate(l))],ceil:[ue,[ue],(l,[o])=>Math.ceil(o.evaluate(l))],"filter-==":[Ke,[ln,on],(l,[o,c])=>l.properties()[o.value]===c.value],"filter-id-==":[Ke,[on],(l,[o])=>l.id()===o.value],"filter-type-==":[Ke,[ln],(l,[o])=>l.geometryType()===o.value],"filter-<":[Ke,[ln,on],(l,[o,c])=>{const f=l.properties()[o.value],m=c.value;return typeof f==typeof m&&f<m}],"filter-id-<":[Ke,[on],(l,[o])=>{const c=l.id(),f=o.value;return typeof c==typeof f&&c<f}],"filter->":[Ke,[ln,on],(l,[o,c])=>{const f=l.properties()[o.value],m=c.value;return typeof f==typeof m&&f>m}],"filter-id->":[Ke,[on],(l,[o])=>{const c=l.id(),f=o.value;return typeof c==typeof f&&c>f}],"filter-<=":[Ke,[ln,on],(l,[o,c])=>{const f=l.properties()[o.value],m=c.value;return typeof f==typeof m&&f<=m}],"filter-id-<=":[Ke,[on],(l,[o])=>{const c=l.id(),f=o.value;return typeof c==typeof f&&c<=f}],"filter->=":[Ke,[ln,on],(l,[o,c])=>{const f=l.properties()[o.value],m=c.value;return typeof f==typeof m&&f>=m}],"filter-id->=":[Ke,[on],(l,[o])=>{const c=l.id(),f=o.value;return typeof c==typeof f&&c>=f}],"filter-has":[Ke,[on],(l,[o])=>o.value in l.properties()],"filter-has-id":[Ke,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[Ke,[q(ln)],(l,[o])=>o.value.indexOf(l.geometryType())>=0],"filter-id-in":[Ke,[q(on)],(l,[o])=>o.value.indexOf(l.id())>=0],"filter-in-small":[Ke,[ln,q(on)],(l,[o,c])=>c.value.indexOf(l.properties()[o.value])>=0],"filter-in-large":[Ke,[ln,q(on)],(l,[o,c])=>function(f,m,v,w){for(;v<=w;){const E=v+w>>1;if(m[E]===f)return!0;m[E]>f?w=E-1:v=E+1}return!1}(l.properties()[o.value],c.value,0,c.value.length-1)],all:{type:Ke,overloads:[[[Ke,Ke],(l,[o,c])=>o.evaluate(l)&&c.evaluate(l)],[El(Ke),(l,o)=>{for(const c of o)if(!c.evaluate(l))return!1;return!0}]]},any:{type:Ke,overloads:[[[Ke,Ke],(l,[o,c])=>o.evaluate(l)||c.evaluate(l)],[El(Ke),(l,o)=>{for(const c of o)if(c.evaluate(l))return!0;return!1}]]},"!":[Ke,[Ke],(l,[o])=>!o.evaluate(l)],"is-supported-script":[Ke,[ln],(l,[o])=>{const c=l.globals&&l.globals.isSupportedScript;return!c||c(o.evaluate(l))}],upcase:[ln,[ln],(l,[o])=>o.evaluate(l).toUpperCase()],downcase:[ln,[ln],(l,[o])=>o.evaluate(l).toLowerCase()],concat:[ln,El(on),(l,o)=>o.map(c=>zn(c.evaluate(l))).join("")],"resolved-locale":[ln,[Es],(l,[o])=>o.evaluate(l).resolvedLocale()]});class Pp{constructor(o,c){var f;this.expression=o,this._warningHistory={},this._evaluator=new dp,this._defaultValue=c?(f=c).type==="color"&&Si(f.default)?new Hn(0,0,0,0):f.type==="color"?Hn.parse(f.default)||null:f.type==="padding"?zo.parse(f.default)||null:f.type==="variableAnchorOffsetCollection"?os.parse(f.default)||null:f.default===void 0?null:f.default:null,this._enumValues=c&&c.type==="enum"?c.values:null}evaluateWithoutErrorHandling(o,c,f,m,v,w){return this._evaluator.globals=o,this._evaluator.feature=c,this._evaluator.featureState=f,this._evaluator.canonical=m,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=w,this.expression.evaluate(this._evaluator)}evaluate(o,c,f,m,v,w){this._evaluator.globals=o,this._evaluator.feature=c||null,this._evaluator.featureState=f||null,this._evaluator.canonical=m,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=w||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Di(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function $c(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in uu}function th(l,o){const c=new Vc(uu,jc,[],o?function(m){const v={color:Pr,string:ln,number:ue,enum:ln,boolean:Ke,formatted:st,padding:B,resolvedImage:G,variableAnchorOffsetCollection:J};return m.type==="array"?q(v[m.value]||on,m.length):v[m.type]}(o):void 0),f=c.parse(l,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?kd(new Pp(f,o)):Ja(c.errors)}class Ap{constructor(o,c){this.kind=o,this._styleExpression=c,this.isStateDependent=o!=="constant"&&!Yu(c.expression)}evaluateWithoutErrorHandling(o,c,f,m,v,w){return this._styleExpression.evaluateWithoutErrorHandling(o,c,f,m,v,w)}evaluate(o,c,f,m,v,w){return this._styleExpression.evaluate(o,c,f,m,v,w)}}class eh{constructor(o,c,f,m){this.kind=o,this.zoomStops=f,this._styleExpression=c,this.isStateDependent=o!=="camera"&&!Yu(c.expression),this.interpolationType=m}evaluateWithoutErrorHandling(o,c,f,m,v,w){return this._styleExpression.evaluateWithoutErrorHandling(o,c,f,m,v,w)}evaluate(o,c,f,m,v,w){return this._styleExpression.evaluate(o,c,f,m,v,w)}interpolationFactor(o,c,f){return this.interpolationType?Bo.interpolationFactor(this.interpolationType,o,c,f):0}}function kp(l,o){const c=th(l,o);if(c.result==="error")return c;const f=c.value.expression,m=Zc(f);if(!m&&!cu(o))return Ja([new ri("","data expressions not supported")]);const v=Wc(f,["zoom"]);if(!v&&!Nd(o))return Ja([new ri("","zoom expressions not supported")]);const w=Qu(f);return w||v?w instanceof ri?Ja([w]):w instanceof Bo&&!Mp(o)?Ja([new ri("",'"interpolate" expressions cannot be used with this property')]):kd(w?new eh(m?"camera":"composite",c.value,w.labels,w instanceof Bo?w.interpolation:void 0):new Ap(m?"constant":"source",c.value)):Ja([new ri("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ju{constructor(o,c){this._parameters=o,this._specification=c,wo(this,Tn(this._parameters,this._specification))}static deserialize(o){return new Ju(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function Qu(l){let o=null;if(l instanceof Yc)o=Qu(l.result);else if(l instanceof Hc){for(const c of l.args)if(o=Qu(c),o)break}else(l instanceof Ka||l instanceof Bo)&&l.input instanceof as&&l.input.name==="zoom"&&(o=l);return o instanceof ri||l.eachChild(c=>{const f=Qu(c);f instanceof ri?o=f:!o&&f?o=new ri("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&f&&o!==f&&(o=new ri("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}function $u(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const o of l.slice(1))if(!$u(o)&&typeof o!="boolean")return!1;return!0;default:return!0}}const jg={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Np(l){if(l==null)return{filter:()=>!0,needGeometry:!1};$u(l)||(l=nh(l));const o=th(l,jg);if(o.result==="error")throw new Error(o.value.map(c=>`${c.key}: ${c.message}`).join(", "));return{filter:(c,f,m)=>o.value.evaluate(c,f,{},m),needGeometry:Rd(l)}}function Zg(l,o){return l<o?-1:l>o?1:0}function Rd(l){if(!Array.isArray(l))return!1;if(l[0]==="within")return!0;for(let o=1;o<l.length;o++)if(Rd(l[o]))return!0;return!1}function nh(l){if(!l)return!0;const o=l[0];return l.length<=1?o!=="any":o==="=="?Dp(l[1],l[2],"=="):o==="!="?tc(Dp(l[1],l[2],"==")):o==="<"||o===">"||o==="<="||o===">="?Dp(l[1],l[2],o):o==="any"?(c=l.slice(1),["any"].concat(c.map(nh))):o==="all"?["all"].concat(l.slice(1).map(nh)):o==="none"?["all"].concat(l.slice(1).map(nh).map(tc)):o==="in"?Od(l[1],l.slice(2)):o==="!in"?tc(Od(l[1],l.slice(2))):o==="has"?zd(l[1]):o==="!has"?tc(zd(l[1])):o!=="within"||l;var c}function Dp(l,o,c){switch(l){case"$type":return[`filter-type-${c}`,o];case"$id":return[`filter-id-${c}`,o];default:return[`filter-${c}`,l,o]}}function Od(l,o){if(o.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(c=>typeof c!=typeof o[0])?["filter-in-large",l,["literal",o.sort(Zg)]]:["filter-in-small",l,["literal",o]]}}function zd(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function tc(l){return["!",l]}function ih(l){const o=typeof l;if(o==="number"||o==="boolean"||o==="string"||l==null)return JSON.stringify(l);if(Array.isArray(l)){let m="[";for(const v of l)m+=`${ih(v)},`;return`${m}]`}const c=Object.keys(l).sort();let f="{";for(let m=0;m<c.length;m++)f+=`${JSON.stringify(c[m])}:${ih(l[c[m]])},`;return`${f}}`}function rh(l){let o="";for(const c of mi)o+=`/${ih(l[c])}`;return o}function Fd(l){const o=l.value;return o?[new ae(l.key,o,"constants have been deprecated as of v8")]:[]}function Ri(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function Cl(l){if(Array.isArray(l))return l.map(Cl);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const o={};for(const c in l)o[c]=Cl(l[c]);return o}return Ri(l)}function So(l){const o=l.key,c=l.value,f=l.valueSpec||{},m=l.objectElementValidators||{},v=l.style,w=l.styleSpec,E=l.validateSpec;let T=[];const P=Fn(c);if(P!=="object")return[new ae(o,c,`object expected, ${P} found`)];for(const N in c){const z=N.split(".")[0],V=f[z]||f["*"];let Z;if(m[z])Z=m[z];else if(f[z])Z=E;else if(m["*"])Z=m["*"];else{if(!f["*"]){T.push(new ae(o,c[N],`unknown property "${N}"`));continue}Z=E}T=T.concat(Z({key:(o&&`${o}.`)+N,value:c[N],valueSpec:V,style:v,styleSpec:w,object:c,objectKey:N,validateSpec:E},c))}for(const N in f)m[N]||f[N].required&&f[N].default===void 0&&c[N]===void 0&&T.push(new ae(o,c,`missing required property "${N}"`));return T}function hu(l){const o=l.value,c=l.valueSpec,f=l.style,m=l.styleSpec,v=l.key,w=l.arrayElementValidator||l.validateSpec;if(Fn(o)!=="array")return[new ae(v,o,`array expected, ${Fn(o)} found`)];if(c.length&&o.length!==c.length)return[new ae(v,o,`array length ${c.length} expected, length ${o.length} found`)];if(c["min-length"]&&o.length<c["min-length"])return[new ae(v,o,`array length at least ${c["min-length"]} expected, length ${o.length} found`)];let E={type:c.value,values:c.values};m.$version<7&&(E.function=c.function),Fn(c.value)==="object"&&(E=c.value);let T=[];for(let P=0;P<o.length;P++)T=T.concat(w({array:o,arrayIndex:P,value:o[P],valueSpec:E,validateSpec:l.validateSpec,style:f,styleSpec:m,key:`${v}[${P}]`}));return T}function ec(l){const o=l.key,c=l.value,f=l.valueSpec;let m=Fn(c);return m==="number"&&c!=c&&(m="NaN"),m!=="number"?[new ae(o,c,`number expected, ${m} found`)]:"minimum"in f&&c<f.minimum?[new ae(o,c,`${c} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&c>f.maximum?[new ae(o,c,`${c} is greater than the maximum value ${f.maximum}`)]:[]}function oh(l){const o=l.valueSpec,c=Ri(l.value.type);let f,m,v,w={};const E=c!=="categorical"&&l.value.property===void 0,T=!E,P=Fn(l.value.stops)==="array"&&Fn(l.value.stops[0])==="array"&&Fn(l.value.stops[0][0])==="object",N=So({key:l.key,value:l.value,valueSpec:l.styleSpec.function,validateSpec:l.validateSpec,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(Z){if(c==="identity")return[new ae(Z.key,Z.value,'identity function may not have a "stops" property')];let H=[];const tt=Z.value;return H=H.concat(hu({key:Z.key,value:tt,valueSpec:Z.valueSpec,validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:z})),Fn(tt)==="array"&&tt.length===0&&H.push(new ae(Z.key,tt,"array must have at least one stop")),H},default:function(Z){return Z.validateSpec({key:Z.key,value:Z.value,valueSpec:o,validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec})}}});return c==="identity"&&E&&N.push(new ae(l.key,l.value,'missing required property "property"')),c==="identity"||l.value.stops||N.push(new ae(l.key,l.value,'missing required property "stops"')),c==="exponential"&&l.valueSpec.expression&&!Mp(l.valueSpec)&&N.push(new ae(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(T&&!cu(l.valueSpec)?N.push(new ae(l.key,l.value,"property functions not supported")):E&&!Nd(l.valueSpec)&&N.push(new ae(l.key,l.value,"zoom functions not supported"))),c!=="categorical"&&!P||l.value.property!==void 0||N.push(new ae(l.key,l.value,'"property" property is required')),N;function z(Z){let H=[];const tt=Z.value,lt=Z.key;if(Fn(tt)!=="array")return[new ae(lt,tt,`array expected, ${Fn(tt)} found`)];if(tt.length!==2)return[new ae(lt,tt,`array length 2 expected, length ${tt.length} found`)];if(P){if(Fn(tt[0])!=="object")return[new ae(lt,tt,`object expected, ${Fn(tt[0])} found`)];if(tt[0].zoom===void 0)return[new ae(lt,tt,"object stop key must have zoom")];if(tt[0].value===void 0)return[new ae(lt,tt,"object stop key must have value")];if(v&&v>Ri(tt[0].zoom))return[new ae(lt,tt[0].zoom,"stop zoom values must appear in ascending order")];Ri(tt[0].zoom)!==v&&(v=Ri(tt[0].zoom),m=void 0,w={}),H=H.concat(So({key:`${lt}[0]`,value:tt[0],valueSpec:{zoom:{}},validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:ec,value:V}}))}else H=H.concat(V({key:`${lt}[0]`,value:tt[0],valueSpec:{},validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec},tt));return $c(Cl(tt[1]))?H.concat([new ae(`${lt}[1]`,tt[1],"expressions are not allowed in function stops.")]):H.concat(Z.validateSpec({key:`${lt}[1]`,value:tt[1],valueSpec:o,validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec}))}function V(Z,H){const tt=Fn(Z.value),lt=Ri(Z.value),ft=Z.value!==null?Z.value:H;if(f){if(tt!==f)return[new ae(Z.key,ft,`${tt} stop domain type must match previous stop domain type ${f}`)]}else f=tt;if(tt!=="number"&&tt!=="string"&&tt!=="boolean")return[new ae(Z.key,ft,"stop domain value must be a number, string, or boolean")];if(tt!=="number"&&c!=="categorical"){let Tt=`number expected, ${tt} found`;return cu(o)&&c===void 0&&(Tt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ae(Z.key,ft,Tt)]}return c!=="categorical"||tt!=="number"||isFinite(lt)&&Math.floor(lt)===lt?c!=="categorical"&&tt==="number"&&m!==void 0&&lt<m?[new ae(Z.key,ft,"stop domain values must appear in ascending order")]:(m=lt,c==="categorical"&&lt in w?[new ae(Z.key,ft,"stop domain values must be unique")]:(w[lt]=!0,[])):[new ae(Z.key,ft,`integer expected, found ${lt}`)]}}function Tl(l){const o=(l.expressionContext==="property"?kp:th)(Cl(l.value),l.valueSpec);if(o.result==="error")return o.value.map(f=>new ae(`${l.key}${f.key}`,l.value,f.message));const c=o.value.expression||o.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!c.outputDefined())return[new ae(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!Yu(c))return[new ae(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter"&&!Yu(c))return[new ae(l.key,l.value,'"feature-state" data expressions are not supported with filters.')];if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!Wc(c,["zoom","feature-state"]))return[new ae(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!Zc(c))return[new ae(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function nc(l){const o=l.key,c=l.value,f=l.valueSpec,m=[];return Array.isArray(f.values)?f.values.indexOf(Ri(c))===-1&&m.push(new ae(o,c,`expected one of [${f.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(f.values).indexOf(Ri(c))===-1&&m.push(new ae(o,c,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(c)} found`)),m}function pu(l){return $u(Cl(l.value))?Tl(wo({},l,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Bd(l)}function Bd(l){const o=l.value,c=l.key;if(Fn(o)!=="array")return[new ae(c,o,`array expected, ${Fn(o)} found`)];const f=l.styleSpec;let m,v=[];if(o.length<1)return[new ae(c,o,"filter array must have at least 1 element")];switch(v=v.concat(nc({key:`${c}[0]`,value:o[0],valueSpec:f.filter_operator,style:l.style,styleSpec:l.styleSpec})),Ri(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&Ri(o[1])==="$type"&&v.push(new ae(c,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&v.push(new ae(c,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(m=Fn(o[1]),m!=="string"&&v.push(new ae(`${c}[1]`,o[1],`string expected, ${m} found`)));for(let w=2;w<o.length;w++)m=Fn(o[w]),Ri(o[1])==="$type"?v=v.concat(nc({key:`${c}[${w}]`,value:o[w],valueSpec:f.geometry_type,style:l.style,styleSpec:l.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&v.push(new ae(`${c}[${w}]`,o[w],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let w=1;w<o.length;w++)v=v.concat(Bd({key:`${c}[${w}]`,value:o[w],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":m=Fn(o[1]),o.length!==2?v.push(new ae(c,o,`filter array for "${o[0]}" operator must have 2 elements`)):m!=="string"&&v.push(new ae(`${c}[1]`,o[1],`string expected, ${m} found`));break;case"within":m=Fn(o[1]),o.length!==2?v.push(new ae(c,o,`filter array for "${o[0]}" operator must have 2 elements`)):m!=="object"&&v.push(new ae(`${c}[1]`,o[1],`object expected, ${m} found`))}return v}function Vd(l,o){const c=l.key,f=l.validateSpec,m=l.style,v=l.styleSpec,w=l.value,E=l.objectKey,T=v[`${o}_${l.layerType}`];if(!T)return[];const P=E.match(/^(.*)-transition$/);if(o==="paint"&&P&&T[P[1]]&&T[P[1]].transition)return f({key:c,value:w,valueSpec:v.transition,style:m,styleSpec:v});const N=l.valueSpec||T[E];if(!N)return[new ae(c,w,`unknown property "${E}"`)];let z;if(Fn(w)==="string"&&cu(N)&&!N.tokens&&(z=/^{([^}]+)}$/.exec(w)))return[new ae(c,w,`"${E}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(z[1])} }\`.`)];const V=[];return l.layerType==="symbol"&&(E==="text-field"&&m&&!m.glyphs&&V.push(new ae(c,w,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&Si(Cl(w))&&Ri(w.type)==="identity"&&V.push(new ae(c,w,'"text-font" does not support identity functions'))),V.concat(f({key:l.key,value:w,valueSpec:N,style:m,styleSpec:v,expressionContext:"property",propertyType:o,propertyKey:E}))}function Ud(l){return Vd(l,"paint")}function Gd(l){return Vd(l,"layout")}function qd(l){let o=[];const c=l.value,f=l.key,m=l.style,v=l.styleSpec;c.type||c.ref||o.push(new ae(f,c,'either "type" or "ref" is required'));let w=Ri(c.type);const E=Ri(c.ref);if(c.id){const T=Ri(c.id);for(let P=0;P<l.arrayIndex;P++){const N=m.layers[P];Ri(N.id)===T&&o.push(new ae(f,c.id,`duplicate layer id "${c.id}", previously used at line ${N.id.__line__}`))}}if("ref"in c){let T;["type","source","source-layer","filter","layout"].forEach(P=>{P in c&&o.push(new ae(f,c[P],`"${P}" is prohibited for ref layers`))}),m.layers.forEach(P=>{Ri(P.id)===E&&(T=P)}),T?T.ref?o.push(new ae(f,c.ref,"ref cannot reference another ref layer")):w=Ri(T.type):o.push(new ae(f,c.ref,`ref layer "${E}" not found`))}else if(w!=="background")if(c.source){const T=m.sources&&m.sources[c.source],P=T&&Ri(T.type);T?P==="vector"&&w==="raster"?o.push(new ae(f,c.source,`layer "${c.id}" requires a raster source`)):P!=="raster-dem"&&w==="hillshade"?o.push(new ae(f,c.source,`layer "${c.id}" requires a raster-dem source`)):P==="raster"&&w!=="raster"?o.push(new ae(f,c.source,`layer "${c.id}" requires a vector source`)):P!=="vector"||c["source-layer"]?P==="raster-dem"&&w!=="hillshade"?o.push(new ae(f,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):w!=="line"||!c.paint||!c.paint["line-gradient"]||P==="geojson"&&T.lineMetrics||o.push(new ae(f,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new ae(f,c,`layer "${c.id}" must specify a "source-layer"`)):o.push(new ae(f,c.source,`source "${c.source}" not found`))}else o.push(new ae(f,c,'missing required property "source"'));return o=o.concat(So({key:f,value:c,valueSpec:v.layer,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,objectElementValidators:{"*":()=>[],type:()=>l.validateSpec({key:`${f}.type`,value:c.type,valueSpec:v.layer.type,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,object:c,objectKey:"type"}),filter:pu,layout:T=>So({layer:c,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":P=>Gd(wo({layerType:w},P))}}),paint:T=>So({layer:c,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":P=>Ud(wo({layerType:w},P))}})}})),o}function js(l){const o=l.value,c=l.key,f=Fn(o);return f!=="string"?[new ae(c,o,`string expected, ${f} found`)]:[]}const ic={promoteId:function({key:l,value:o}){if(Fn(o)==="string")return js({key:l,value:o});{const c=[];for(const f in o)c.push(...js({key:`${l}.${f}`,value:o[f]}));return c}}};function Vo(l){const o=l.value,c=l.key,f=l.styleSpec,m=l.style,v=l.validateSpec;if(!o.type)return[new ae(c,o,'"type" is required')];const w=Ri(o.type);let E;switch(w){case"vector":case"raster":return E=So({key:c,value:o,valueSpec:f[`source_${w.replace("-","_")}`],style:l.style,styleSpec:f,objectElementValidators:ic,validateSpec:v}),E;case"raster-dem":return E=function(T){var P;const N=(P=T.sourceName)!==null&&P!==void 0?P:"",z=T.value,V=T.styleSpec,Z=V.source_raster_dem,H=T.style;let tt=[];const lt=Fn(z);if(z===void 0)return tt;if(lt!=="object")return tt.push(new ae("source_raster_dem",z,`object expected, ${lt} found`)),tt;const ft=Ri(z.encoding)==="custom",Tt=["redFactor","greenFactor","blueFactor","baseShift"],yt=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const Mt in z)!ft&&Tt.includes(Mt)?tt.push(new ae(Mt,z[Mt],`In "${N}": "${Mt}" is only valid when "encoding" is set to "custom". ${yt} encoding found`)):Z[Mt]?tt=tt.concat(T.validateSpec({key:Mt,value:z[Mt],valueSpec:Z[Mt],validateSpec:T.validateSpec,style:H,styleSpec:V})):tt.push(new ae(Mt,z[Mt],`unknown property "${Mt}"`));return tt}({sourceName:c,value:o,style:l.style,styleSpec:f,validateSpec:v}),E;case"geojson":if(E=So({key:c,value:o,valueSpec:f.source_geojson,style:m,styleSpec:f,validateSpec:v,objectElementValidators:ic}),o.cluster)for(const T in o.clusterProperties){const[P,N]=o.clusterProperties[T],z=typeof P=="string"?[P,["accumulated"],["get",T]]:P;E.push(...Tl({key:`${c}.${T}.map`,value:N,validateSpec:v,expressionContext:"cluster-map"})),E.push(...Tl({key:`${c}.${T}.reduce`,value:z,validateSpec:v,expressionContext:"cluster-reduce"}))}return E;case"video":return So({key:c,value:o,valueSpec:f.source_video,style:m,validateSpec:v,styleSpec:f});case"image":return So({key:c,value:o,valueSpec:f.source_image,style:m,validateSpec:v,styleSpec:f});case"canvas":return[new ae(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return nc({key:`${c}.type`,value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:m,validateSpec:v,styleSpec:f})}}function rc(l){const o=l.value,c=l.styleSpec,f=c.light,m=l.style;let v=[];const w=Fn(o);if(o===void 0)return v;if(w!=="object")return v=v.concat([new ae("light",o,`object expected, ${w} found`)]),v;for(const E in o){const T=E.match(/^(.*)-transition$/);v=v.concat(T&&f[T[1]]&&f[T[1]].transition?l.validateSpec({key:E,value:o[E],valueSpec:c.transition,validateSpec:l.validateSpec,style:m,styleSpec:c}):f[E]?l.validateSpec({key:E,value:o[E],valueSpec:f[E],validateSpec:l.validateSpec,style:m,styleSpec:c}):[new ae(E,o[E],`unknown property "${E}"`)])}return v}function jd(l){const o=l.value,c=l.styleSpec,f=c.terrain,m=l.style;let v=[];const w=Fn(o);if(o===void 0)return v;if(w!=="object")return v=v.concat([new ae("terrain",o,`object expected, ${w} found`)]),v;for(const E in o)v=v.concat(f[E]?l.validateSpec({key:E,value:o[E],valueSpec:f[E],validateSpec:l.validateSpec,style:m,styleSpec:c}):[new ae(E,o[E],`unknown property "${E}"`)]);return v}function Zd(l){let o=[];const c=l.value,f=l.key;if(Array.isArray(c)){const m=[],v=[];for(const w in c)c[w].id&&m.includes(c[w].id)&&o.push(new ae(f,c,`all the sprites' ids must be unique, but ${c[w].id} is duplicated`)),m.push(c[w].id),c[w].url&&v.includes(c[w].url)&&o.push(new ae(f,c,`all the sprites' URLs must be unique, but ${c[w].url} is duplicated`)),v.push(c[w].url),o=o.concat(So({key:`${f}[${w}]`,value:c[w],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:l.validateSpec}));return o}return js({key:f,value:c})}const Wd={"*":()=>[],array:hu,boolean:function(l){const o=l.value,c=l.key,f=Fn(o);return f!=="boolean"?[new ae(c,o,`boolean expected, ${f} found`)]:[]},number:ec,color:function(l){const o=l.key,c=l.value,f=Fn(c);return f!=="string"?[new ae(o,c,`color expected, ${f} found`)]:Hn.parse(String(c))?[]:[new ae(o,c,`color expected, "${c}" found`)]},constants:Fd,enum:nc,filter:pu,function:oh,layer:qd,object:So,source:Vo,light:rc,terrain:jd,string:js,formatted:function(l){return js(l).length===0?[]:Tl(l)},resolvedImage:function(l){return js(l).length===0?[]:Tl(l)},padding:function(l){const o=l.key,c=l.value;if(Fn(c)==="array"){if(c.length<1||c.length>4)return[new ae(o,c,`padding requires 1 to 4 values; ${c.length} values found`)];const f={type:"number"};let m=[];for(let v=0;v<c.length;v++)m=m.concat(l.validateSpec({key:`${o}[${v}]`,value:c[v],validateSpec:l.validateSpec,valueSpec:f}));return m}return ec({key:o,value:c,valueSpec:{}})},variableAnchorOffsetCollection:function(l){const o=l.key,c=l.value,f=Fn(c),m=l.styleSpec;if(f!=="array"||c.length<1||c.length%2!=0)return[new ae(o,c,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let w=0;w<c.length;w+=2)v=v.concat(nc({key:`${o}[${w}]`,value:c[w],valueSpec:m.layout_symbol["text-anchor"]})),v=v.concat(hu({key:`${o}[${w+1}]`,value:c[w+1],valueSpec:{length:2,value:"number"},validateSpec:l.validateSpec,style:l.style,styleSpec:m}));return v},sprite:Zd};function Ea(l){const o=l.value,c=l.valueSpec,f=l.styleSpec;return l.validateSpec=Ea,c.expression&&Si(Ri(o))?oh(l):c.expression&&$c(Cl(o))?Tl(l):c.type&&Wd[c.type]?Wd[c.type](l):So(wo({},l,{valueSpec:c.type?f[c.type]:c}))}function Xd(l){const o=l.value,c=l.key,f=js(l);return f.length||(o.indexOf("{fontstack}")===-1&&f.push(new ae(c,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&f.push(new ae(c,o,'"glyphs" url must include a "{range}" token'))),f}function ls(l,o=qt){let c=[];return c=c.concat(Ea({key:"",value:l,valueSpec:o.$root,styleSpec:o,style:l,validateSpec:Ea,objectElementValidators:{glyphs:Xd,"*":()=>[]}})),l.constants&&(c=c.concat(Fd({key:"constants",value:l.constants,style:l,styleSpec:o,validateSpec:Ea}))),sh(c)}function Ia(l){return function(o){return l({...o,validateSpec:Ea})}}function sh(l){return[].concat(l).sort((o,c)=>o.line-c.line)}function Ca(l){return function(...o){return sh(l.apply(this,o))}}ls.source=Ca(Ia(Vo)),ls.sprite=Ca(Ia(Zd)),ls.glyphs=Ca(Ia(Xd)),ls.light=Ca(Ia(rc)),ls.terrain=Ca(Ia(jd)),ls.layer=Ca(Ia(qd)),ls.filter=Ca(Ia(pu)),ls.paintProperty=Ca(Ia(Ud)),ls.layoutProperty=Ca(Ia(Gd));const Ta=ls,Wg=Ta.light,Rp=Ta.paintProperty,Hd=Ta.layoutProperty;function ah(l,o){let c=!1;if(o&&o.length)for(const f of o)l.fire(new tn(new Error(f.message))),c=!0;return c}class fu{constructor(o,c,f){const m=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;const w=new Int32Array(this.arrayBuffer);o=w[0],this.d=(c=w[1])+2*(f=w[2]);for(let T=0;T<this.d*this.d;T++){const P=w[3+T],N=w[3+T+1];m.push(P===N?null:w.subarray(P,N))}const E=w[3+m.length+1];this.keys=w.subarray(w[3+m.length],E),this.bboxes=w.subarray(E),this.insert=this._insertReadonly}else{this.d=c+2*f;for(let w=0;w<this.d*this.d;w++)m.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=o,this.padding=f,this.scale=c/o,this.uid=0;const v=f/c*o;this.min=-v,this.max=o+v}insert(o,c,f,m,v){this._forEachCell(c,f,m,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(o),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(o,c,f,m,v,w){this.cells[v].push(w)}query(o,c,f,m,v){const w=this.min,E=this.max;if(o<=w&&c<=w&&E<=f&&E<=m&&!v)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(o,c,f,m,this._queryCell,T,{},v),T}}_queryCell(o,c,f,m,v,w,E,T){const P=this.cells[v];if(P!==null){const N=this.keys,z=this.bboxes;for(let V=0;V<P.length;V++){const Z=P[V];if(E[Z]===void 0){const H=4*Z;(T?T(z[H+0],z[H+1],z[H+2],z[H+3]):o<=z[H+2]&&c<=z[H+3]&&f>=z[H+0]&&m>=z[H+1])?(E[Z]=!0,w.push(N[Z])):E[Z]=!1}}}}_forEachCell(o,c,f,m,v,w,E,T){const P=this._convertToCellCoord(o),N=this._convertToCellCoord(c),z=this._convertToCellCoord(f),V=this._convertToCellCoord(m);for(let Z=P;Z<=z;Z++)for(let H=N;H<=V;H++){const tt=this.d*H+Z;if((!T||T(this._convertFromCellCoord(Z),this._convertFromCellCoord(H),this._convertFromCellCoord(Z+1),this._convertFromCellCoord(H+1)))&&v.call(this,o,c,f,m,tt,w,E,T))return}}_convertFromCellCoord(o){return(o-this.padding)/this.scale}_convertToCellCoord(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const o=this.cells,c=3+this.cells.length+1+1;let f=0;for(let w=0;w<this.cells.length;w++)f+=this.cells[w].length;const m=new Int32Array(c+f+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;let v=c;for(let w=0;w<o.length;w++){const E=o[w];m[3+w]=v,m.set(E,v),v+=E.length}return m[3+o.length]=v,m.set(this.keys,v),v+=this.keys.length,m[3+o.length+1]=v,m.set(this.bboxes,v),v+=this.bboxes.length,m.buffer}static serialize(o,c){const f=o.toArrayBuffer();return c&&c.push(f),{buffer:f}}static deserialize(o){return new fu(o.buffer)}}const La={};function xe(l,o,c={}){if(La[l])throw new Error(`${l} is already registered.`);Object.defineProperty(o,"_classRegistryKey",{value:l,writeable:!1}),La[l]={klass:o,omit:c.omit||[],shallow:c.shallow||[]}}xe("Object",Object),xe("TransferableGridIndex",fu),xe("Color",Hn),xe("Error",Error),xe("AJAXError",Be),xe("ResolvedImage",kr),xe("StylePropertyFunction",Ju),xe("StyleExpression",Pp,{omit:["_evaluator"]}),xe("ZoomDependentExpression",eh),xe("ZoomConstantExpression",Ap),xe("CompoundExpression",as,{omit:["_evaluate"]});for(const l in uu)uu[l]._classRegistryKey||xe(`Expression_${l}`,uu[l]);function lh(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function Qa(l,o){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||l instanceof Blob)return l;if(lh(l)||$e(l))return o&&o.push(l),l;if(ArrayBuffer.isView(l)){const c=l;return o&&o.push(c.buffer),c}if(l instanceof ImageData)return o&&o.push(l.data.buffer),l;if(Array.isArray(l)){const c=[];for(const f of l)c.push(Qa(f,o));return c}if(typeof l=="object"){const c=l.constructor,f=c._classRegistryKey;if(!f)throw new Error("can't serialize object of unregistered class");if(!La[f])throw new Error(`${f} is not registered.`);const m=c.serialize?c.serialize(l,o):{};if(c.serialize){if(o&&m===o[o.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in l){if(!l.hasOwnProperty(v)||La[f].omit.indexOf(v)>=0)continue;const w=l[v];m[v]=La[f].shallow.indexOf(v)>=0?w:Qa(w,o)}l instanceof Error&&(m.message=l.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(m.$name=f),m}throw new Error("can't serialize object of type "+typeof l)}function du(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||l instanceof Blob||lh(l)||$e(l)||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(du);if(typeof l=="object"){const o=l.$name||"Object";if(!La[o])throw new Error(`can't deserialize unregistered class ${o}`);const{klass:c}=La[o];if(!c)throw new Error(`can't deserialize unregistered class ${o}`);if(c.deserialize)return c.deserialize(l);const f=Object.create(c.prototype);for(const m of Object.keys(l)){if(m==="$name")continue;const v=l[m];f[m]=La[o].shallow.indexOf(m)>=0?v:du(v)}return f}throw new Error("can't deserialize object of type "+typeof l)}class Yd{constructor(){this.first=!0}update(o,c){const f=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=c),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=f,!0))}}const _e={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519};function Op(l){for(const o of l)if(Fp(o.charCodeAt(0)))return!0;return!1}function zp(l){for(const o of l)if(!Xg(o.charCodeAt(0)))return!1;return!0}function Xg(l){return!(_e.Arabic(l)||_e["Arabic Supplement"](l)||_e["Arabic Extended-A"](l)||_e["Arabic Presentation Forms-A"](l)||_e["Arabic Presentation Forms-B"](l))}function Fp(l){return!(l!==746&&l!==747&&(l<4352||!(_e["Bopomofo Extended"](l)||_e.Bopomofo(l)||_e["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||_e["CJK Compatibility Ideographs"](l)||_e["CJK Compatibility"](l)||_e["CJK Radicals Supplement"](l)||_e["CJK Strokes"](l)||!(!_e["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||_e["CJK Unified Ideographs Extension A"](l)||_e["CJK Unified Ideographs"](l)||_e["Enclosed CJK Letters and Months"](l)||_e["Hangul Compatibility Jamo"](l)||_e["Hangul Jamo Extended-A"](l)||_e["Hangul Jamo Extended-B"](l)||_e["Hangul Jamo"](l)||_e["Hangul Syllables"](l)||_e.Hiragana(l)||_e["Ideographic Description Characters"](l)||_e.Kanbun(l)||_e["Kangxi Radicals"](l)||_e["Katakana Phonetic Extensions"](l)||_e.Katakana(l)&&l!==12540||!(!_e["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!_e["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||_e["Unified Canadian Aboriginal Syllabics"](l)||_e["Unified Canadian Aboriginal Syllabics Extended"](l)||_e["Vertical Forms"](l)||_e["Yijing Hexagram Symbols"](l)||_e["Yi Syllables"](l)||_e["Yi Radicals"](l))))}function Kd(l){return!(Fp(l)||function(o){return!!(_e["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||_e["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||_e["Letterlike Symbols"](o)||_e["Number Forms"](o)||_e["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||_e["Control Pictures"](o)&&o!==9251||_e["Optical Character Recognition"](o)||_e["Enclosed Alphanumerics"](o)||_e["Geometric Shapes"](o)||_e["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||_e["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||_e["CJK Symbols and Punctuation"](o)||_e.Katakana(o)||_e["Private Use Area"](o)||_e["CJK Compatibility Forms"](o)||_e["Small Form Variants"](o)||_e["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(l))}function Jd(l){return l>=1424&&l<=2303||_e["Arabic Presentation Forms-A"](l)||_e["Arabic Presentation Forms-B"](l)}function Qd(l,o){return!(!o&&Jd(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||_e.Khmer(l))}function Hg(l){for(const o of l)if(Jd(o.charCodeAt(0)))return!0;return!1}const Bp="deferred",Vp="loading",Up="loaded";let Gp=null,Eo="unavailable",$a=null;const oc=function(l){l&&typeof l=="string"&&l.indexOf("NetworkError")>-1&&(Eo="error"),Gp&&Gp(l)};function qp(){sc.fire(new On("pluginStateChange",{pluginStatus:Eo,pluginURL:$a}))}const sc=new Gn,jp=function(){return Eo},$d=function(){if(Eo!==Bp||!$a)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Eo=Vp,qp(),$a&&wt({url:$a},l=>{l?oc(l):(Eo=Up,qp())})},Uo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Eo===Up||Uo.applyArabicShaping!=null,isLoading:()=>Eo===Vp,setState(l){if(!be())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Eo=l.pluginStatus,$a=l.pluginURL},isParsed(){if(!be())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Uo.applyArabicShaping!=null&&Uo.processBidirectionalText!=null&&Uo.processStyledBidirectionalText!=null},getPluginURL(){if(!be())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return $a}};class hi{constructor(o,c){this.zoom=o,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Yd,this.transition={})}isSupportedScript(o){return function(c,f){for(const m of c)if(!Qd(m.charCodeAt(0),f))return!1;return!0}(o,Uo.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const o=this.zoom,c=o-Math.floor(o),f=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*c}}}class uh{constructor(o,c){this.property=o,this.value=c,this.expression=function(f,m){if(Si(f))return new Ju(f,m);if($c(f)){const v=kp(f,m);if(v.result==="error")throw new Error(v.value.map(w=>`${w.key}: ${w.message}`).join(", "));return v.value}{let v=f;return m.type==="color"&&typeof f=="string"?v=Hn.parse(f):m.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?m.type==="variableAnchorOffsetCollection"&&Array.isArray(f)&&(v=os.parse(f)):v=zo.parse(f),{kind:"constant",evaluate:()=>v}}}(c===void 0?o.specification.default:c,o.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(o,c,f){return this.property.possiblyEvaluate(this,o,c,f)}}class Zp{constructor(o){this.property=o,this.value=new uh(o,void 0)}transitioned(o,c){return new em(this.property,this.value,c,ht({},o.transition,this.transition),o.now)}untransitioned(){return new em(this.property,this.value,null,{},0)}}class tm{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return dt(this._values[o].value.value)}setValue(o,c){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new Zp(this._values[o].property)),this._values[o].value=new uh(this._values[o].property,c===null?void 0:dt(c))}getTransition(o){return dt(this._values[o].transition)}setTransition(o,c){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new Zp(this._values[o].property)),this._values[o].transition=dt(c)||void 0}serialize(){const o={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(o[c]=f);const m=this.getTransition(c);m!==void 0&&(o[`${c}-transition`]=m)}return o}transitioned(o,c){const f=new nm(this._properties);for(const m of Object.keys(this._values))f._values[m]=this._values[m].transitioned(o,c._values[m]);return f}untransitioned(){const o=new nm(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].untransitioned();return o}}class em{constructor(o,c,f,m,v){this.property=o,this.value=c,this.begin=v+m.delay||0,this.end=this.begin+m.duration||0,o.specification.transition&&(m.delay||m.duration)&&(this.prior=f)}possiblyEvaluate(o,c,f){const m=o.now||0,v=this.value.possiblyEvaluate(o,c,f),w=this.prior;if(w){if(m>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(m<this.begin)return w.possiblyEvaluate(o,c,f);{const E=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(o,c,f),v,function(T){if(T<=0)return 0;if(T>=1)return 1;const P=T*T,N=P*T;return 4*(T<.5?N:3*(T-P)+N-.75)}(E))}}return v}}class nm{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,c,f){const m=new ch(this._properties);for(const v of Object.keys(this._values))m._values[v]=this._values[v].possiblyEvaluate(o,c,f);return m}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class Yg{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}hasValue(o){return this._values[o].value!==void 0}getValue(o){return dt(this._values[o].value)}setValue(o,c){this._values[o]=new uh(this._values[o].property,c===null?void 0:dt(c))}serialize(){const o={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(o[c]=f)}return o}possiblyEvaluate(o,c,f){const m=new ch(this._properties);for(const v of Object.keys(this._values))m._values[v]=this._values[v].possiblyEvaluate(o,c,f);return m}}class co{constructor(o,c,f){this.property=o,this.value=c,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(o){return this.value.kind==="constant"?this.value.value:o}evaluate(o,c,f,m){return this.property.evaluate(this.value,this.parameters,o,c,f,m)}}class ch{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class Ae{constructor(o){this.specification=o}possiblyEvaluate(o,c){if(o.isDataDriven())throw new Error("Value should not be data driven");return o.expression.evaluate(c)}interpolate(o,c,f){const m=Fo[this.specification.type];return m?m(o,c,f):o}}class Ge{constructor(o,c){this.specification=o,this.overrides=c}possiblyEvaluate(o,c,f,m){return new co(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(c,null,{},f,m)}:o.expression,c)}interpolate(o,c,f){if(o.value.kind!=="constant"||c.value.kind!=="constant")return o;if(o.value.value===void 0||c.value.value===void 0)return new co(this,{kind:"constant",value:void 0},o.parameters);const m=Fo[this.specification.type];if(m){const v=m(o.value.value,c.value.value,f);return new co(this,{kind:"constant",value:v},o.parameters)}return o}evaluate(o,c,f,m,v,w){return o.kind==="constant"?o.value:o.evaluate(c,f,m,v,w)}}class ac extends Ge{possiblyEvaluate(o,c,f,m){if(o.value===void 0)return new co(this,{kind:"constant",value:void 0},c);if(o.expression.kind==="constant"){const v=o.expression.evaluate(c,null,{},f,m),w=o.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,E=this._calculate(w,w,w,c);return new co(this,{kind:"constant",value:E},c)}if(o.expression.kind==="camera"){const v=this._calculate(o.expression.evaluate({zoom:c.zoom-1}),o.expression.evaluate({zoom:c.zoom}),o.expression.evaluate({zoom:c.zoom+1}),c);return new co(this,{kind:"constant",value:v},c)}return new co(this,o.expression,c)}evaluate(o,c,f,m,v,w){if(o.kind==="source"){const E=o.evaluate(c,f,m,v,w);return this._calculate(E,E,E,c)}return o.kind==="composite"?this._calculate(o.evaluate({zoom:Math.floor(c.zoom)-1},f,m),o.evaluate({zoom:Math.floor(c.zoom)},f,m),o.evaluate({zoom:Math.floor(c.zoom)+1},f,m),c):o.value}_calculate(o,c,f,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:o,to:c}:{from:f,to:c}}interpolate(o){return o}}class Wp{constructor(o){this.specification=o}possiblyEvaluate(o,c,f,m){if(o.value!==void 0){if(o.expression.kind==="constant"){const v=o.expression.evaluate(c,null,{},f,m);return this._calculate(v,v,v,c)}return this._calculate(o.expression.evaluate(new hi(Math.floor(c.zoom-1),c)),o.expression.evaluate(new hi(Math.floor(c.zoom),c)),o.expression.evaluate(new hi(Math.floor(c.zoom+1),c)),c)}}_calculate(o,c,f,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:o,to:c}:{from:f,to:c}}interpolate(o){return o}}class Xp{constructor(o){this.specification=o}possiblyEvaluate(o,c,f,m){return!!o.expression.evaluate(c,null,{},f,m)}interpolate(){return!1}}class Ji{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in o){const f=o[c];f.specification.overridable&&this.overridableProperties.push(c);const m=this.defaultPropertyValues[c]=new uh(f,void 0),v=this.defaultTransitionablePropertyValues[c]=new Zp(f);this.defaultTransitioningPropertyValues[c]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=m.possiblyEvaluate({})}}}xe("DataDrivenProperty",Ge),xe("DataConstantProperty",Ae),xe("CrossFadedDataDrivenProperty",ac),xe("CrossFadedProperty",Wp),xe("ColorRampProperty",Xp);const Hp="-transition";class us extends Gn{constructor(o,c){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1},o.type!=="custom"&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type!=="background"&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),c.layout&&(this._unevaluatedLayout=new Yg(c.layout)),c.paint)){this._transitionablePaint=new tm(c.paint);for(const f in o.paint)this.setPaintProperty(f,o.paint[f],{validate:!1});for(const f in o.layout)this.setLayoutProperty(f,o.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ch(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(o){return o==="visibility"?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,c,f={}){c!=null&&this._validate(Hd,`layers.${this.id}.layout.${o}`,o,c,f)||(o!=="visibility"?this._unevaluatedLayout.setValue(o,c):this.visibility=c)}getPaintProperty(o){return o.endsWith(Hp)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,c,f={}){if(c!=null&&this._validate(Rp,`layers.${this.id}.paint.${o}`,o,c,f))return!1;if(o.endsWith(Hp))return this._transitionablePaint.setTransition(o.slice(0,-11),c||void 0),!1;{const m=this._transitionablePaint._values[o],v=m.property.specification["property-type"]==="cross-faded-data-driven",w=m.value.isDataDriven(),E=m.value;this._transitionablePaint.setValue(o,c),this._handleSpecialPaintPropertyUpdate(o);const T=this._transitionablePaint._values[o].value;return T.isDataDriven()||w||v||this._handleOverridablePaintPropertyUpdate(o,E,T)}}_handleSpecialPaintPropertyUpdate(o){}_handleOverridablePaintPropertyUpdate(o,c,f){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||this.visibility==="none"}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,c){o.getCrossfadeParameters&&(this._crossfadeParameters=o.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,c)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),mt(o,(c,f)=>!(c===void 0||f==="layout"&&!Object.keys(c).length||f==="paint"&&!Object.keys(c).length))}_validate(o,c,f,m,v={}){return(!v||v.validate!==!1)&&ah(this,o.call(Ta,{key:c,layerType:this.type,objectKey:f,value:m,styleSpec:qt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const c=this.paint.get(o);if(c instanceof co&&cu(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}}const im={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ll{constructor(o,c){this._structArray=o,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Oi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,c){return o._trim(),c&&(o.isTransferred=!0,c.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const c=Object.create(this.prototype);return c.arrayBuffer=o.arrayBuffer,c.length=o.length,c.capacity=o.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ii(l,o=1){let c=0,f=0;return{members:l.map(m=>{const v=im[m.type].BYTES_PER_ELEMENT,w=c=mu(c,Math.max(o,v)),E=m.components||1;return f=Math.max(f,v),c+=v*E,{name:m.name,type:m.type,components:E,offset:w}}),size:mu(c,Math.max(f,o)),alignment:o}}function mu(l,o){return Math.ceil(l/o)*o}class lc extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c){const f=this.length;return this.resize(f+1),this.emplace(f,o,c)}emplace(o,c,f){const m=2*o;return this.int16[m+0]=c,this.int16[m+1]=f,o}}lc.prototype.bytesPerElement=4,xe("StructArrayLayout2i4",lc);class uc extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f){const m=this.length;return this.resize(m+1),this.emplace(m,o,c,f)}emplace(o,c,f,m){const v=3*o;return this.int16[v+0]=c,this.int16[v+1]=f,this.int16[v+2]=m,o}}uc.prototype.bytesPerElement=6,xe("StructArrayLayout3i6",uc);class Ml extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,o,c,f,m)}emplace(o,c,f,m,v){const w=4*o;return this.int16[w+0]=c,this.int16[w+1]=f,this.int16[w+2]=m,this.int16[w+3]=v,o}}Ml.prototype.bytesPerElement=8,xe("StructArrayLayout4i8",Ml);class Yp extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f,m,v,w){const E=this.length;return this.resize(E+1),this.emplace(E,o,c,f,m,v,w)}emplace(o,c,f,m,v,w,E){const T=6*o;return this.int16[T+0]=c,this.int16[T+1]=f,this.int16[T+2]=m,this.int16[T+3]=v,this.int16[T+4]=w,this.int16[T+5]=E,o}}Yp.prototype.bytesPerElement=12,xe("StructArrayLayout2i4i12",Yp);class Kp extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f,m,v,w){const E=this.length;return this.resize(E+1),this.emplace(E,o,c,f,m,v,w)}emplace(o,c,f,m,v,w,E){const T=4*o,P=8*o;return this.int16[T+0]=c,this.int16[T+1]=f,this.uint8[P+4]=m,this.uint8[P+5]=v,this.uint8[P+6]=w,this.uint8[P+7]=E,o}}Kp.prototype.bytesPerElement=8,xe("StructArrayLayout2i4ub8",Kp);class gu extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c){const f=this.length;return this.resize(f+1),this.emplace(f,o,c)}emplace(o,c,f){const m=2*o;return this.float32[m+0]=c,this.float32[m+1]=f,o}}gu.prototype.bytesPerElement=8,xe("StructArrayLayout2f8",gu);class Jp extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,f,m,v,w,E,T,P,N){const z=this.length;return this.resize(z+1),this.emplace(z,o,c,f,m,v,w,E,T,P,N)}emplace(o,c,f,m,v,w,E,T,P,N,z){const V=10*o;return this.uint16[V+0]=c,this.uint16[V+1]=f,this.uint16[V+2]=m,this.uint16[V+3]=v,this.uint16[V+4]=w,this.uint16[V+5]=E,this.uint16[V+6]=T,this.uint16[V+7]=P,this.uint16[V+8]=N,this.uint16[V+9]=z,o}}Jp.prototype.bytesPerElement=20,xe("StructArrayLayout10ui20",Jp);class Qp extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,f,m,v,w,E,T,P,N,z,V){const Z=this.length;return this.resize(Z+1),this.emplace(Z,o,c,f,m,v,w,E,T,P,N,z,V)}emplace(o,c,f,m,v,w,E,T,P,N,z,V,Z){const H=12*o;return this.int16[H+0]=c,this.int16[H+1]=f,this.int16[H+2]=m,this.int16[H+3]=v,this.uint16[H+4]=w,this.uint16[H+5]=E,this.uint16[H+6]=T,this.uint16[H+7]=P,this.int16[H+8]=N,this.int16[H+9]=z,this.int16[H+10]=V,this.int16[H+11]=Z,o}}Qp.prototype.bytesPerElement=24,xe("StructArrayLayout4i4ui4i24",Qp);class Bn extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f){const m=this.length;return this.resize(m+1),this.emplace(m,o,c,f)}emplace(o,c,f,m){const v=3*o;return this.float32[v+0]=c,this.float32[v+1]=f,this.float32[v+2]=m,o}}Bn.prototype.bytesPerElement=12,xe("StructArrayLayout3f12",Bn);class y extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.uint32[1*o+0]=c,o}}y.prototype.bytesPerElement=4,xe("StructArrayLayout1ul4",y);class s extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,f,m,v,w,E,T,P){const N=this.length;return this.resize(N+1),this.emplace(N,o,c,f,m,v,w,E,T,P)}emplace(o,c,f,m,v,w,E,T,P,N){const z=10*o,V=5*o;return this.int16[z+0]=c,this.int16[z+1]=f,this.int16[z+2]=m,this.int16[z+3]=v,this.int16[z+4]=w,this.int16[z+5]=E,this.uint32[V+3]=T,this.uint16[z+8]=P,this.uint16[z+9]=N,o}}s.prototype.bytesPerElement=20,xe("StructArrayLayout6i1ul2ui20",s);class h extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f,m,v,w){const E=this.length;return this.resize(E+1),this.emplace(E,o,c,f,m,v,w)}emplace(o,c,f,m,v,w,E){const T=6*o;return this.int16[T+0]=c,this.int16[T+1]=f,this.int16[T+2]=m,this.int16[T+3]=v,this.int16[T+4]=w,this.int16[T+5]=E,o}}h.prototype.bytesPerElement=12,xe("StructArrayLayout2i2i2i12",h);class d extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f,m,v){const w=this.length;return this.resize(w+1),this.emplace(w,o,c,f,m,v)}emplace(o,c,f,m,v,w){const E=4*o,T=8*o;return this.float32[E+0]=c,this.float32[E+1]=f,this.float32[E+2]=m,this.int16[T+6]=v,this.int16[T+7]=w,o}}d.prototype.bytesPerElement=16,xe("StructArrayLayout2f1f2i16",d);class g extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,o,c,f,m)}emplace(o,c,f,m,v){const w=12*o,E=3*o;return this.uint8[w+0]=c,this.uint8[w+1]=f,this.float32[E+1]=m,this.float32[E+2]=v,o}}g.prototype.bytesPerElement=12,xe("StructArrayLayout2ub2f12",g);class b extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,f){const m=this.length;return this.resize(m+1),this.emplace(m,o,c,f)}emplace(o,c,f,m){const v=3*o;return this.uint16[v+0]=c,this.uint16[v+1]=f,this.uint16[v+2]=m,o}}b.prototype.bytesPerElement=6,xe("StructArrayLayout3ui6",b);class I extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f,m,v,w,E,T,P,N,z,V,Z,H,tt,lt,ft){const Tt=this.length;return this.resize(Tt+1),this.emplace(Tt,o,c,f,m,v,w,E,T,P,N,z,V,Z,H,tt,lt,ft)}emplace(o,c,f,m,v,w,E,T,P,N,z,V,Z,H,tt,lt,ft,Tt){const yt=24*o,Mt=12*o,zt=48*o;return this.int16[yt+0]=c,this.int16[yt+1]=f,this.uint16[yt+2]=m,this.uint16[yt+3]=v,this.uint32[Mt+2]=w,this.uint32[Mt+3]=E,this.uint32[Mt+4]=T,this.uint16[yt+10]=P,this.uint16[yt+11]=N,this.uint16[yt+12]=z,this.float32[Mt+7]=V,this.float32[Mt+8]=Z,this.uint8[zt+36]=H,this.uint8[zt+37]=tt,this.uint8[zt+38]=lt,this.uint32[Mt+10]=ft,this.int16[yt+22]=Tt,o}}I.prototype.bytesPerElement=48,xe("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",I);class C extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f,m,v,w,E,T,P,N,z,V,Z,H,tt,lt,ft,Tt,yt,Mt,zt,Ht,ye,Te,ge,de,le,we){const he=this.length;return this.resize(he+1),this.emplace(he,o,c,f,m,v,w,E,T,P,N,z,V,Z,H,tt,lt,ft,Tt,yt,Mt,zt,Ht,ye,Te,ge,de,le,we)}emplace(o,c,f,m,v,w,E,T,P,N,z,V,Z,H,tt,lt,ft,Tt,yt,Mt,zt,Ht,ye,Te,ge,de,le,we,he){const ie=32*o,Re=16*o;return this.int16[ie+0]=c,this.int16[ie+1]=f,this.int16[ie+2]=m,this.int16[ie+3]=v,this.int16[ie+4]=w,this.int16[ie+5]=E,this.int16[ie+6]=T,this.int16[ie+7]=P,this.uint16[ie+8]=N,this.uint16[ie+9]=z,this.uint16[ie+10]=V,this.uint16[ie+11]=Z,this.uint16[ie+12]=H,this.uint16[ie+13]=tt,this.uint16[ie+14]=lt,this.uint16[ie+15]=ft,this.uint16[ie+16]=Tt,this.uint16[ie+17]=yt,this.uint16[ie+18]=Mt,this.uint16[ie+19]=zt,this.uint16[ie+20]=Ht,this.uint16[ie+21]=ye,this.uint16[ie+22]=Te,this.uint32[Re+12]=ge,this.float32[Re+13]=de,this.float32[Re+14]=le,this.uint16[ie+30]=we,this.uint16[ie+31]=he,o}}C.prototype.bytesPerElement=64,xe("StructArrayLayout8i15ui1ul2f2ui64",C);class M extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.float32[1*o+0]=c,o}}M.prototype.bytesPerElement=4,xe("StructArrayLayout1f4",M);class A extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f){const m=this.length;return this.resize(m+1),this.emplace(m,o,c,f)}emplace(o,c,f,m){const v=3*o;return this.uint16[6*o+0]=c,this.float32[v+1]=f,this.float32[v+2]=m,o}}A.prototype.bytesPerElement=12,xe("StructArrayLayout1ui2f12",A);class R extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,f){const m=this.length;return this.resize(m+1),this.emplace(m,o,c,f)}emplace(o,c,f,m){const v=4*o;return this.uint32[2*o+0]=c,this.uint16[v+2]=f,this.uint16[v+3]=m,o}}R.prototype.bytesPerElement=8,xe("StructArrayLayout1ul2ui8",R);class O extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c){const f=this.length;return this.resize(f+1),this.emplace(f,o,c)}emplace(o,c,f){const m=2*o;return this.uint16[m+0]=c,this.uint16[m+1]=f,o}}O.prototype.bytesPerElement=4,xe("StructArrayLayout2ui4",O);class j extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.uint16[1*o+0]=c,o}}j.prototype.bytesPerElement=2,xe("StructArrayLayout1ui2",j);class nt extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,o,c,f,m)}emplace(o,c,f,m,v){const w=4*o;return this.float32[w+0]=c,this.float32[w+1]=f,this.float32[w+2]=m,this.float32[w+3]=v,o}}nt.prototype.bytesPerElement=16,xe("StructArrayLayout4f16",nt);class et extends Ll{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new k(this.anchorPointX,this.anchorPointY)}}et.prototype.size=20;class at extends s{get(o){return new et(this,o)}}xe("CollisionBoxArray",at);class $ extends Ll{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(o){this._structArray.uint8[this._pos1+37]=o}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(o){this._structArray.uint8[this._pos1+38]=o}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(o){this._structArray.uint32[this._pos4+10]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}$.prototype.size=48;class xt extends I{get(o){return new $(this,o)}}xe("PlacedSymbolArray",xt);class Nt extends Ll{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(o){this._structArray.uint32[this._pos4+12]=o}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Nt.prototype.size=64;class ut extends C{get(o){return new Nt(this,o)}}xe("SymbolInstanceArray",ut);class It extends M{getoffsetX(o){return this.float32[1*o+0]}}xe("GlyphOffsetArray",It);class Ft extends uc{getx(o){return this.int16[3*o+0]}gety(o){return this.int16[3*o+1]}gettileUnitDistanceFromAnchor(o){return this.int16[3*o+2]}}xe("SymbolLineVertexArray",Ft);class Bt extends Ll{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Bt.prototype.size=12;class Wt extends A{get(o){return new Bt(this,o)}}xe("TextAnchorOffsetArray",Wt);class ne extends Ll{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ne.prototype.size=8;class Yt extends R{get(o){return new ne(this,o)}}xe("FeatureIndexArray",Yt);class se extends lc{}class Ce extends lc{}class xn extends lc{}class fe extends Yp{}class qe extends Kp{}class Le extends gu{}class Yn extends Jp{}class bn extends Qp{}class hn extends Bn{}class wn extends y{}class ji extends h{}class si extends g{}class Nr extends b{}class cr extends O{}const Qi=Ii([{name:"a_pos",components:2,type:"Int16"}],4),{members:Go}=Qi;class pi{constructor(o=[]){this.segments=o}prepareSegment(o,c,f,m){let v=this.segments[this.segments.length-1];return o>pi.MAX_VERTEX_ARRAY_LENGTH&&kt(`Max vertices per segment is ${pi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!v||v.vertexLength+o>pi.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==m)&&(v={vertexOffset:c.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},m!==void 0&&(v.sortKey=m),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const o of this.segments)for(const c in o.vaos)o.vaos[c].destroy()}static simpleSegment(o,c,f,m){return new pi([{vertexOffset:o,primitiveOffset:c,vertexLength:f,primitiveLength:m,vaos:{},sortKey:0}])}}function Zs(l,o){return 256*(l=gt(Math.floor(l),0,255))+gt(Math.floor(o),0,255)}pi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,xe("SegmentVector",pi);const Ws=Ii([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var tl={exports:{}},Pl={exports:{}};Pl.exports=function(l,o){var c,f,m,v,w,E,T,P;for(f=l.length-(c=3&l.length),m=o,w=3432918353,E=461845907,P=0;P<f;)T=255&l.charCodeAt(P)|(255&l.charCodeAt(++P))<<8|(255&l.charCodeAt(++P))<<16|(255&l.charCodeAt(++P))<<24,++P,m=27492+(65535&(v=5*(65535&(m=(m^=T=(65535&(T=(T=(65535&T)*w+(((T>>>16)*w&65535)<<16)&4294967295)<<15|T>>>17))*E+(((T>>>16)*E&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(T=0,c){case 3:T^=(255&l.charCodeAt(P+2))<<16;case 2:T^=(255&l.charCodeAt(P+1))<<8;case 1:m^=T=(65535&(T=(T=(65535&(T^=255&l.charCodeAt(P)))*w+(((T>>>16)*w&65535)<<16)&4294967295)<<15|T>>>17))*E+(((T>>>16)*E&65535)<<16)&4294967295}return m^=l.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0};var _u=Pl.exports,Kr={exports:{}};Kr.exports=function(l,o){for(var c,f=l.length,m=o^f,v=0;f>=4;)c=1540483477*(65535&(c=255&l.charCodeAt(v)|(255&l.charCodeAt(++v))<<8|(255&l.charCodeAt(++v))<<16|(255&l.charCodeAt(++v))<<24))+((1540483477*(c>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),f-=4,++v;switch(f){case 3:m^=(255&l.charCodeAt(v+2))<<16;case 2:m^=(255&l.charCodeAt(v+1))<<8;case 1:m=1540483477*(65535&(m^=255&l.charCodeAt(v)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0};var Dr=_u,ho=Kr.exports;tl.exports=Dr,tl.exports.murmur3=Dr,tl.exports.murmur2=ho;var Al=x(tl.exports);class Zi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,c,f,m){this.ids.push(hr(o)),this.positions.push(c,f,m)}getPositions(o){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const c=hr(o);let f=0,m=this.ids.length-1;for(;f<m;){const w=f+m>>1;this.ids[w]>=c?m=w:f=w+1}const v=[];for(;this.ids[f]===c;)v.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return v}static serialize(o,c){const f=new Float64Array(o.ids),m=new Uint32Array(o.positions);return Io(f,m,0,f.length-1),c&&c.push(f.buffer,m.buffer),{ids:f,positions:m}}static deserialize(o){const c=new Zi;return c.ids=o.ids,c.positions=o.positions,c.indexed=!0,c}}function hr(l){const o=+l;return!isNaN(o)&&o<=Number.MAX_SAFE_INTEGER?o:Al(String(l))}function Io(l,o,c,f){for(;c<f;){const m=l[c+f>>1];let v=c-1,w=f+1;for(;;){do v++;while(l[v]<m);do w--;while(l[w]>m);if(v>=w)break;Wi(l,v,w),Wi(o,3*v,3*w),Wi(o,3*v+1,3*w+1),Wi(o,3*v+2,3*w+2)}w-c<f-w?(Io(l,o,c,w),c=w+1):(Io(l,o,w+1,f),f=w)}}function Wi(l,o,c){const f=l[o];l[o]=l[c],l[c]=f}xe("FeaturePositionMap",Zi);class kl{constructor(o,c){this.gl=o.gl,this.location=c}}class hh extends kl{constructor(o,c){super(o,c),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class rm extends kl{constructor(o,c){super(o,c),this.current=[0,0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3]))}}class om extends kl{constructor(o,c){super(o,c),this.current=Hn.transparent}set(o){o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a))}}const Kg=new Float32Array(16);function $p(l){return[Zs(255*l.r,255*l.g),Zs(255*l.b,255*l.a)]}class Xs{constructor(o,c,f){this.value=o,this.uniformNames=c.map(m=>`u_${m}`),this.type=f}setUniform(o,c,f){o.set(f.constantOr(this.value))}getBinding(o,c,f){return this.type==="color"?new om(o,c):new hh(o,c)}}class Nl{constructor(o,c){this.uniformNames=c.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(o,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=o.pixelRatio,this.patternFrom=c.tlbr,this.patternTo=o.tlbr}setUniform(o,c,f,m){const v=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&o.set(v)}getBinding(o,c,f){return f.substr(0,9)==="u_pattern"?new rm(o,c):new hh(o,c)}}class Hs{constructor(o,c,f,m){this.expression=o,this.type=f,this.maxValue=0,this.paintVertexAttributes=c.map(v=>({name:`a_${v}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(o,c,f,m,v){const w=this.paintVertexArray.length,E=this.expression.evaluate(new hi(0),c,{},m,[],v);this.paintVertexArray.resize(o),this._setPaintValue(w,o,E)}updatePaintArray(o,c,f,m){const v=this.expression.evaluate({zoom:0},f,m);this._setPaintValue(o,c,v)}_setPaintValue(o,c,f){if(this.type==="color"){const m=$p(f);for(let v=o;v<c;v++)this.paintVertexArray.emplace(v,m[0],m[1])}else{for(let m=o;m<c;m++)this.paintVertexArray.emplace(m,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cs{constructor(o,c,f,m,v,w){this.expression=o,this.uniformNames=c.map(E=>`u_${E}_t`),this.type=f,this.useIntegerZoom=m,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=c.map(E=>({name:`a_${E}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new w}populatePaintArray(o,c,f,m,v){const w=this.expression.evaluate(new hi(this.zoom),c,{},m,[],v),E=this.expression.evaluate(new hi(this.zoom+1),c,{},m,[],v),T=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(T,o,w,E)}updatePaintArray(o,c,f,m){const v=this.expression.evaluate({zoom:this.zoom},f,m),w=this.expression.evaluate({zoom:this.zoom+1},f,m);this._setPaintValue(o,c,v,w)}_setPaintValue(o,c,f,m){if(this.type==="color"){const v=$p(f),w=$p(m);for(let E=o;E<c;E++)this.paintVertexArray.emplace(E,v[0],v[1],w[0],w[1])}else{for(let v=o;v<c;v++)this.paintVertexArray.emplace(v,f,m);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(m))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,c){const f=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,m=gt(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);o.set(m)}getBinding(o,c,f){return new hh(o,c)}}class Ys{constructor(o,c,f,m,v,w){this.expression=o,this.type=c,this.useIntegerZoom=f,this.zoom=m,this.layerId=w,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(o,c,f){const m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(m,o,c.patterns&&c.patterns[this.layerId],f)}updatePaintArray(o,c,f,m,v){this._setPaintValues(o,c,f.patterns&&f.patterns[this.layerId],v)}_setPaintValues(o,c,f,m){if(!m||!f)return;const{min:v,mid:w,max:E}=f,T=m[v],P=m[w],N=m[E];if(T&&P&&N)for(let z=o;z<c;z++)this.zoomInPaintVertexArray.emplace(z,P.tl[0],P.tl[1],P.br[0],P.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],P.pixelRatio,T.pixelRatio),this.zoomOutPaintVertexArray.emplace(z,P.tl[0],P.tl[1],P.br[0],P.br[1],N.tl[0],N.tl[1],N.br[0],N.br[1],P.pixelRatio,N.pixelRatio)}upload(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,Ws.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,Ws.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class tf{constructor(o,c,f){this.binders={},this._buffers=[];const m=[];for(const v in o.paint._values){if(!f(v))continue;const w=o.paint.get(v);if(!(w instanceof co&&cu(w.property.specification)))continue;const E=ww(v,o.type),T=w.value,P=w.property.specification.type,N=w.property.useIntegerZoom,z=w.property.specification["property-type"],V=z==="cross-faded"||z==="cross-faded-data-driven";if(T.kind==="constant")this.binders[v]=V?new Nl(T.value,E):new Xs(T.value,E,P),m.push(`/u_${v}`);else if(T.kind==="source"||V){const Z=Qy(v,P,"source");this.binders[v]=V?new Ys(T,P,N,c,Z,o.id):new Hs(T,E,P,Z),m.push(`/a_${v}`)}else{const Z=Qy(v,P,"composite");this.binders[v]=new cs(T,E,P,N,c,Z),m.push(`/z_${v}`)}}this.cacheKey=m.sort().join("")}getMaxValue(o){const c=this.binders[o];return c instanceof Hs||c instanceof cs?c.maxValue:0}populatePaintArrays(o,c,f,m,v){for(const w in this.binders){const E=this.binders[w];(E instanceof Hs||E instanceof cs||E instanceof Ys)&&E.populatePaintArray(o,c,f,m,v)}}setConstantPatternPositions(o,c){for(const f in this.binders){const m=this.binders[f];m instanceof Nl&&m.setConstantPatternPositions(o,c)}}updatePaintArrays(o,c,f,m,v){let w=!1;for(const E in o){const T=c.getPositions(E);for(const P of T){const N=f.feature(P.index);for(const z in this.binders){const V=this.binders[z];if((V instanceof Hs||V instanceof cs||V instanceof Ys)&&V.expression.isStateDependent===!0){const Z=m.paint.get(z);V.expression=Z.value,V.updatePaintArray(P.start,P.end,N,o[E],v),w=!0}}}}return w}defines(){const o=[];for(const c in this.binders){const f=this.binders[c];(f instanceof Xs||f instanceof Nl)&&o.push(...f.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return o}getBinderAttributes(){const o=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof Hs||f instanceof cs)for(let m=0;m<f.paintVertexAttributes.length;m++)o.push(f.paintVertexAttributes[m].name);else if(f instanceof Ys)for(let m=0;m<Ws.members.length;m++)o.push(Ws.members[m].name)}return o}getBinderUniforms(){const o=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof Xs||f instanceof Nl||f instanceof cs)for(const m of f.uniformNames)o.push(m)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o,c){const f=[];for(const m in this.binders){const v=this.binders[m];if(v instanceof Xs||v instanceof Nl||v instanceof cs){for(const w of v.uniformNames)if(c[w]){const E=v.getBinding(o,c[w],w);f.push({name:w,property:m,binding:E})}}}return f}setUniforms(o,c,f,m){for(const{name:v,property:w,binding:E}of c)this.binders[w].setUniform(E,m,f.get(w),v)}updatePaintBuffers(o){this._buffers=[];for(const c in this.binders){const f=this.binders[c];if(o&&f instanceof Ys){const m=o.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(f instanceof Hs||f instanceof cs)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(o){for(const c in this.binders){const f=this.binders[c];(f instanceof Hs||f instanceof cs||f instanceof Ys)&&f.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const c=this.binders[o];(c instanceof Hs||c instanceof cs||c instanceof Ys)&&c.destroy()}}}class Ma{constructor(o,c,f=()=>!0){this.programConfigurations={};for(const m of o)this.programConfigurations[m.id]=new tf(m,c,f);this.needsUpload=!1,this._featureMap=new Zi,this._bufferOffset=0}populatePaintArrays(o,c,f,m,v,w){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(o,c,m,v,w);c.id!==void 0&&this._featureMap.add(c.id,f,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,c,f,m){for(const v of f)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(o,this._featureMap,c,v,m)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}function ww(l,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[l]||[l.replace(`${o}-`,"").replace(/-/g,"_")]}function Qy(l,o,c){const f={color:{source:gu,composite:nt},number:{source:M,composite:gu}},m=function(v){return{"line-pattern":{source:Yn,composite:Yn},"fill-pattern":{source:Yn,composite:Yn},"fill-extrusion-pattern":{source:Yn,composite:Yn}}[v]}(l);return m&&m[c]||f[o][c]}xe("ConstantBinder",Xs),xe("CrossFadedConstantBinder",Nl),xe("SourceExpressionBinder",Hs),xe("CrossFadedCompositeBinder",Ys),xe("CompositeExpressionBinder",cs),xe("ProgramConfiguration",tf,{omit:["_buffers"]}),xe("ProgramConfigurationSet",Ma);const ar=8192,Jg=Math.pow(2,14)-1,$y=-Jg-1;function cc(l){const o=ar/l.extent,c=l.loadGeometry();for(let f=0;f<c.length;f++){const m=c[f];for(let v=0;v<m.length;v++){const w=m[v],E=Math.round(w.x*o),T=Math.round(w.y*o);w.x=gt(E,$y,Jg),w.y=gt(T,$y,Jg),(E<w.x||E>w.x+1||T<w.y||T>w.y+1)&&kt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return c}function hc(l,o){return{type:l.type,id:l.id,properties:l.properties,geometry:o?cc(l):[]}}function sm(l,o,c,f,m){l.emplaceBack(2*o+(f+1)/2,2*c+(m+1)/2)}class Qg{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new Ce,this.indexArray=new Nr,this.segments=new pi,this.programConfigurations=new Ma(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,f){const m=this.layers[0],v=[];let w=null,E=!1;m.type==="circle"&&(w=m.layout.get("circle-sort-key"),E=!w.isConstant());for(const{feature:T,id:P,index:N,sourceLayerIndex:z}of o){const V=this.layers[0]._featureFilter.needGeometry,Z=hc(T,V);if(!this.layers[0]._featureFilter.filter(new hi(this.zoom),Z,f))continue;const H=E?w.evaluate(Z,{},f):void 0,tt={id:P,properties:T.properties,type:T.type,sourceLayerIndex:z,index:N,geometry:V?Z.geometry:cc(T),patterns:{},sortKey:H};v.push(tt)}E&&v.sort((T,P)=>T.sortKey-P.sortKey);for(const T of v){const{geometry:P,index:N,sourceLayerIndex:z}=T,V=o[N].feature;this.addFeature(T,P,N,f),c.featureIndex.insert(V,P,N,z,this.index)}}update(o,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Go),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,c,f,m){for(const v of c)for(const w of v){const E=w.x,T=w.y;if(E<0||E>=ar||T<0||T>=ar)continue;const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),N=P.vertexLength;sm(this.layoutVertexArray,E,T,-1,-1),sm(this.layoutVertexArray,E,T,1,-1),sm(this.layoutVertexArray,E,T,1,1),sm(this.layoutVertexArray,E,T,-1,1),this.indexArray.emplaceBack(N,N+1,N+2),this.indexArray.emplaceBack(N,N+3,N+2),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,{},m)}}function t0(l,o){for(let c=0;c<l.length;c++)if(ph(o,l[c]))return!0;for(let c=0;c<o.length;c++)if(ph(l,o[c]))return!0;return!!$g(l,o)}function Sw(l,o,c){return!!ph(l,o)||!!t_(o,l,c)}function e0(l,o){if(l.length===1)return i0(o,l[0]);for(let c=0;c<o.length;c++){const f=o[c];for(let m=0;m<f.length;m++)if(ph(l,f[m]))return!0}for(let c=0;c<l.length;c++)if(i0(o,l[c]))return!0;for(let c=0;c<o.length;c++)if($g(l,o[c]))return!0;return!1}function Ew(l,o,c){if(l.length>1){if($g(l,o))return!0;for(let f=0;f<o.length;f++)if(t_(o[f],l,c))return!0}for(let f=0;f<l.length;f++)if(t_(l[f],o,c))return!0;return!1}function $g(l,o){if(l.length===0||o.length===0)return!1;for(let c=0;c<l.length-1;c++){const f=l[c],m=l[c+1];for(let v=0;v<o.length-1;v++)if(Iw(f,m,o[v],o[v+1]))return!0}return!1}function Iw(l,o,c,f){return Gt(l,c,f)!==Gt(o,c,f)&&Gt(l,o,c)!==Gt(l,o,f)}function t_(l,o,c){const f=c*c;if(o.length===1)return l.distSqr(o[0])<f;for(let m=1;m<o.length;m++)if(n0(l,o[m-1],o[m])<f)return!0;return!1}function n0(l,o,c){const f=o.distSqr(c);if(f===0)return l.distSqr(o);const m=((l.x-o.x)*(c.x-o.x)+(l.y-o.y)*(c.y-o.y))/f;return l.distSqr(m<0?o:m>1?c:c.sub(o)._mult(m)._add(o))}function i0(l,o){let c,f,m,v=!1;for(let w=0;w<l.length;w++){c=l[w];for(let E=0,T=c.length-1;E<c.length;T=E++)f=c[E],m=c[T],f.y>o.y!=m.y>o.y&&o.x<(m.x-f.x)*(o.y-f.y)/(m.y-f.y)+f.x&&(v=!v)}return v}function ph(l,o){let c=!1;for(let f=0,m=l.length-1;f<l.length;m=f++){const v=l[f],w=l[m];v.y>o.y!=w.y>o.y&&o.x<(w.x-v.x)*(o.y-v.y)/(w.y-v.y)+v.x&&(c=!c)}return c}function Cw(l,o,c){const f=c[0],m=c[2];if(l.x<f.x&&o.x<f.x||l.x>m.x&&o.x>m.x||l.y<f.y&&o.y<f.y||l.y>m.y&&o.y>m.y)return!1;const v=Gt(l,o,c[0]);return v!==Gt(l,o,c[1])||v!==Gt(l,o,c[2])||v!==Gt(l,o,c[3])}function ef(l,o,c){const f=o.paint.get(l).value;return f.kind==="constant"?f.value:c.programConfigurations.get(o.id).getMaxValue(l)}function am(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function lm(l,o,c,f,m){if(!o[0]&&!o[1])return l;const v=k.convert(o)._mult(m);c==="viewport"&&v._rotate(-f);const w=[];for(let E=0;E<l.length;E++)w.push(l[E].sub(v));return w}let r0,o0;xe("CircleBucket",Qg,{omit:["layers"]});var Tw={get paint(){return o0=o0||new Ji({"circle-radius":new Ge(qt.paint_circle["circle-radius"]),"circle-color":new Ge(qt.paint_circle["circle-color"]),"circle-blur":new Ge(qt.paint_circle["circle-blur"]),"circle-opacity":new Ge(qt.paint_circle["circle-opacity"]),"circle-translate":new Ae(qt.paint_circle["circle-translate"]),"circle-translate-anchor":new Ae(qt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ae(qt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ae(qt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ge(qt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ge(qt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ge(qt.paint_circle["circle-stroke-opacity"])})},get layout(){return r0=r0||new Ji({"circle-sort-key":new Ge(qt.layout_circle["circle-sort-key"])})}},Co=1e-6,fh=typeof Float32Array<"u"?Float32Array:Array;function e_(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function s0(l,o,c){var f=o[0],m=o[1],v=o[2],w=o[3],E=o[4],T=o[5],P=o[6],N=o[7],z=o[8],V=o[9],Z=o[10],H=o[11],tt=o[12],lt=o[13],ft=o[14],Tt=o[15],yt=c[0],Mt=c[1],zt=c[2],Ht=c[3];return l[0]=yt*f+Mt*E+zt*z+Ht*tt,l[1]=yt*m+Mt*T+zt*V+Ht*lt,l[2]=yt*v+Mt*P+zt*Z+Ht*ft,l[3]=yt*w+Mt*N+zt*H+Ht*Tt,l[4]=(yt=c[4])*f+(Mt=c[5])*E+(zt=c[6])*z+(Ht=c[7])*tt,l[5]=yt*m+Mt*T+zt*V+Ht*lt,l[6]=yt*v+Mt*P+zt*Z+Ht*ft,l[7]=yt*w+Mt*N+zt*H+Ht*Tt,l[8]=(yt=c[8])*f+(Mt=c[9])*E+(zt=c[10])*z+(Ht=c[11])*tt,l[9]=yt*m+Mt*T+zt*V+Ht*lt,l[10]=yt*v+Mt*P+zt*Z+Ht*ft,l[11]=yt*w+Mt*N+zt*H+Ht*Tt,l[12]=(yt=c[12])*f+(Mt=c[13])*E+(zt=c[14])*z+(Ht=c[15])*tt,l[13]=yt*m+Mt*T+zt*V+Ht*lt,l[14]=yt*v+Mt*P+zt*Z+Ht*ft,l[15]=yt*w+Mt*N+zt*H+Ht*Tt,l}Math.hypot||(Math.hypot=function(){for(var l=0,o=arguments.length;o--;)l+=arguments[o]*arguments[o];return Math.sqrt(l)});var nf,Lw=s0;function um(l,o,c){var f=o[0],m=o[1],v=o[2],w=o[3];return l[0]=c[0]*f+c[4]*m+c[8]*v+c[12]*w,l[1]=c[1]*f+c[5]*m+c[9]*v+c[13]*w,l[2]=c[2]*f+c[6]*m+c[10]*v+c[14]*w,l[3]=c[3]*f+c[7]*m+c[11]*v+c[15]*w,l}nf=new fh(4),fh!=Float32Array&&(nf[0]=0,nf[1]=0,nf[2]=0,nf[3]=0);class Mw extends us{constructor(o){super(o,Tw)}createBucket(o){return new Qg(o)}queryRadius(o){const c=o;return ef("circle-radius",this,c)+ef("circle-stroke-width",this,c)+am(this.paint.get("circle-translate"))}queryIntersectsFeature(o,c,f,m,v,w,E,T){const P=lm(o,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),w.angle,E),N=this.paint.get("circle-radius").evaluate(c,f)+this.paint.get("circle-stroke-width").evaluate(c,f),z=this.paint.get("circle-pitch-alignment")==="map",V=z?P:function(H,tt){return H.map(lt=>a0(lt,tt))}(P,T),Z=z?N*E:N;for(const H of m)for(const tt of H){const lt=z?tt:a0(tt,T);let ft=Z;const Tt=um([],[tt.x,tt.y,0,1],T);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ft*=Tt[3]/w.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ft*=w.cameraToCenterDistance/Tt[3]),Sw(V,lt,ft))return!0}return!1}}function a0(l,o){const c=um([],[l.x,l.y,0,1],o);return new k(c[0]/c[3],c[1]/c[3])}class l0 extends Qg{}let u0;xe("HeatmapBucket",l0,{omit:["layers"]});var Pw={get paint(){return u0=u0||new Ji({"heatmap-radius":new Ge(qt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ge(qt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ae(qt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Xp(qt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ae(qt.paint_heatmap["heatmap-opacity"])})}};function n_(l,{width:o,height:c},f,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==o*c*f)throw new RangeError(`mismatched image size. expected: ${m.length} but got: ${o*c*f}`)}else m=new Uint8Array(o*c*f);return l.width=o,l.height=c,l.data=m,l}function c0(l,{width:o,height:c},f){if(o===l.width&&c===l.height)return;const m=n_({},{width:o,height:c},f);i_(l,m,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,o),height:Math.min(l.height,c)},f),l.width=o,l.height=c,l.data=m.data}function i_(l,o,c,f,m,v){if(m.width===0||m.height===0)return o;if(m.width>l.width||m.height>l.height||c.x>l.width-m.width||c.y>l.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>o.width||m.height>o.height||f.x>o.width-m.width||f.y>o.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const w=l.data,E=o.data;if(w===E)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<m.height;T++){const P=((c.y+T)*l.width+c.x)*v,N=((f.y+T)*o.width+f.x)*v;for(let z=0;z<m.width*v;z++)E[N+z]=w[P+z]}return o}class rf{constructor(o,c){n_(this,o,1,c)}resize(o){c0(this,o,1)}clone(){return new rf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,c,f,m,v){i_(o,c,f,m,v,1)}}class Is{constructor(o,c){n_(this,o,4,c)}resize(o){c0(this,o,4)}replace(o,c){c?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new Is({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,c,f,m,v){i_(o,c,f,m,v,4)}}function h0(l){const o={},c=l.resolution||256,f=l.clips?l.clips.length:1,m=l.image||new Is({width:c,height:f});if(Math.log(c)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${c}`);const v=(w,E,T)=>{o[l.evaluationKey]=T;const P=l.expression.evaluate(o);m.data[w+E+0]=Math.floor(255*P.r/P.a),m.data[w+E+1]=Math.floor(255*P.g/P.a),m.data[w+E+2]=Math.floor(255*P.b/P.a),m.data[w+E+3]=Math.floor(255*P.a)};if(l.clips)for(let w=0,E=0;w<f;++w,E+=4*c)for(let T=0,P=0;T<c;T++,P+=4){const N=T/(c-1),{start:z,end:V}=l.clips[w];v(E,P,z*(1-N)+V*N)}else for(let w=0,E=0;w<c;w++,E+=4)v(0,E,w/(c-1));return m}xe("AlphaImage",rf),xe("RGBAImage",Is);class Aw extends us{createBucket(o){return new l0(o)}constructor(o){super(o,Pw),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=h0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let p0;var kw={get paint(){return p0=p0||new Ji({"hillshade-illumination-direction":new Ae(qt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ae(qt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ae(qt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ae(qt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ae(qt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ae(qt.paint_hillshade["hillshade-accent-color"])})}};class Nw extends us{constructor(o){super(o,kw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Dw=Ii([{name:"a_pos",components:2,type:"Int16"}],4),{members:Rw}=Dw;var r_={exports:{}};function cm(l,o,c){c=c||2;var f,m,v,w,E,T,P,N=o&&o.length,z=N?o[0]*c:l.length,V=f0(l,0,z,c,!0),Z=[];if(!V||V.next===V.prev)return Z;if(N&&(V=function(tt,lt,ft,Tt){var yt,Mt,zt,Ht=[];for(yt=0,Mt=lt.length;yt<Mt;yt++)(zt=f0(tt,lt[yt]*Tt,yt<Mt-1?lt[yt+1]*Tt:tt.length,Tt,!1))===zt.next&&(zt.steiner=!0),Ht.push(qw(zt));for(Ht.sort(Vw),yt=0;yt<Ht.length;yt++)ft=Uw(Ht[yt],ft);return ft}(l,o,V,c)),l.length>80*c){f=v=l[0],m=w=l[1];for(var H=c;H<z;H+=c)(E=l[H])<f&&(f=E),(T=l[H+1])<m&&(m=T),E>v&&(v=E),T>w&&(w=T);P=(P=Math.max(v-f,w-m))!==0?32767/P:0}return of(V,Z,c,f,m,P,0),Z}function f0(l,o,c,f,m){var v,w;if(m===a_(l,o,c,f)>0)for(v=o;v<c;v+=f)w=g0(v,l[v],l[v+1],w);else for(v=c-f;v>=o;v-=f)w=g0(v,l[v],l[v+1],w);return w&&hm(w,w.next)&&(af(w),w=w.next),w}function pc(l,o){if(!l)return l;o||(o=l);var c,f=l;do if(c=!1,f.steiner||!hm(f,f.next)&&$i(f.prev,f,f.next)!==0)f=f.next;else{if(af(f),(f=o=f.prev)===f.next)break;c=!0}while(c||f!==o);return o}function of(l,o,c,f,m,v,w){if(l){!w&&v&&function(N,z,V,Z){var H=N;do H.z===0&&(H.z=o_(H.x,H.y,z,V,Z)),H.prevZ=H.prev,H.nextZ=H.next,H=H.next;while(H!==N);H.prevZ.nextZ=null,H.prevZ=null,function(tt){var lt,ft,Tt,yt,Mt,zt,Ht,ye,Te=1;do{for(ft=tt,tt=null,Mt=null,zt=0;ft;){for(zt++,Tt=ft,Ht=0,lt=0;lt<Te&&(Ht++,Tt=Tt.nextZ);lt++);for(ye=Te;Ht>0||ye>0&&Tt;)Ht!==0&&(ye===0||!Tt||ft.z<=Tt.z)?(yt=ft,ft=ft.nextZ,Ht--):(yt=Tt,Tt=Tt.nextZ,ye--),Mt?Mt.nextZ=yt:tt=yt,yt.prevZ=Mt,Mt=yt;ft=Tt}Mt.nextZ=null,Te*=2}while(zt>1)}(H)}(l,f,m,v);for(var E,T,P=l;l.prev!==l.next;)if(E=l.prev,T=l.next,v?zw(l,f,m,v):Ow(l))o.push(E.i/c|0),o.push(l.i/c|0),o.push(T.i/c|0),af(l),l=T.next,P=T.next;else if((l=T)===P){w?w===1?of(l=Fw(pc(l),o,c),o,c,f,m,v,2):w===2&&Bw(l,o,c,f,m,v):of(pc(l),o,c,f,m,v,1);break}}}function Ow(l){var o=l.prev,c=l,f=l.next;if($i(o,c,f)>=0)return!1;for(var m=o.x,v=c.x,w=f.x,E=o.y,T=c.y,P=f.y,N=m<v?m<w?m:w:v<w?v:w,z=E<T?E<P?E:P:T<P?T:P,V=m>v?m>w?m:w:v>w?v:w,Z=E>T?E>P?E:P:T>P?T:P,H=f.next;H!==o;){if(H.x>=N&&H.x<=V&&H.y>=z&&H.y<=Z&&dh(m,E,v,T,w,P,H.x,H.y)&&$i(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function zw(l,o,c,f){var m=l.prev,v=l,w=l.next;if($i(m,v,w)>=0)return!1;for(var E=m.x,T=v.x,P=w.x,N=m.y,z=v.y,V=w.y,Z=E<T?E<P?E:P:T<P?T:P,H=N<z?N<V?N:V:z<V?z:V,tt=E>T?E>P?E:P:T>P?T:P,lt=N>z?N>V?N:V:z>V?z:V,ft=o_(Z,H,o,c,f),Tt=o_(tt,lt,o,c,f),yt=l.prevZ,Mt=l.nextZ;yt&&yt.z>=ft&&Mt&&Mt.z<=Tt;){if(yt.x>=Z&&yt.x<=tt&&yt.y>=H&&yt.y<=lt&&yt!==m&&yt!==w&&dh(E,N,T,z,P,V,yt.x,yt.y)&&$i(yt.prev,yt,yt.next)>=0||(yt=yt.prevZ,Mt.x>=Z&&Mt.x<=tt&&Mt.y>=H&&Mt.y<=lt&&Mt!==m&&Mt!==w&&dh(E,N,T,z,P,V,Mt.x,Mt.y)&&$i(Mt.prev,Mt,Mt.next)>=0))return!1;Mt=Mt.nextZ}for(;yt&&yt.z>=ft;){if(yt.x>=Z&&yt.x<=tt&&yt.y>=H&&yt.y<=lt&&yt!==m&&yt!==w&&dh(E,N,T,z,P,V,yt.x,yt.y)&&$i(yt.prev,yt,yt.next)>=0)return!1;yt=yt.prevZ}for(;Mt&&Mt.z<=Tt;){if(Mt.x>=Z&&Mt.x<=tt&&Mt.y>=H&&Mt.y<=lt&&Mt!==m&&Mt!==w&&dh(E,N,T,z,P,V,Mt.x,Mt.y)&&$i(Mt.prev,Mt,Mt.next)>=0)return!1;Mt=Mt.nextZ}return!0}function Fw(l,o,c){var f=l;do{var m=f.prev,v=f.next.next;!hm(m,v)&&d0(m,f,f.next,v)&&sf(m,v)&&sf(v,m)&&(o.push(m.i/c|0),o.push(f.i/c|0),o.push(v.i/c|0),af(f),af(f.next),f=l=v),f=f.next}while(f!==l);return pc(f)}function Bw(l,o,c,f,m,v){var w=l;do{for(var E=w.next.next;E!==w.prev;){if(w.i!==E.i&&jw(w,E)){var T=m0(w,E);return w=pc(w,w.next),T=pc(T,T.next),of(w,o,c,f,m,v,0),void of(T,o,c,f,m,v,0)}E=E.next}w=w.next}while(w!==l)}function Vw(l,o){return l.x-o.x}function Uw(l,o){var c=function(m,v){var w,E=v,T=m.x,P=m.y,N=-1/0;do{if(P<=E.y&&P>=E.next.y&&E.next.y!==E.y){var z=E.x+(P-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(z<=T&&z>N&&(N=z,w=E.x<E.next.x?E:E.next,z===T))return w}E=E.next}while(E!==v);if(!w)return null;var V,Z=w,H=w.x,tt=w.y,lt=1/0;E=w;do T>=E.x&&E.x>=H&&T!==E.x&&dh(P<tt?T:N,P,H,tt,P<tt?N:T,P,E.x,E.y)&&(V=Math.abs(P-E.y)/(T-E.x),sf(E,m)&&(V<lt||V===lt&&(E.x>w.x||E.x===w.x&&Gw(w,E)))&&(w=E,lt=V)),E=E.next;while(E!==Z);return w}(l,o);if(!c)return o;var f=m0(c,l);return pc(f,f.next),pc(c,c.next)}function Gw(l,o){return $i(l.prev,l,o.prev)<0&&$i(o.next,l,l.next)<0}function o_(l,o,c,f,m){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-c)*m|0)|l<<8))|l<<4))|l<<2))|l<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-f)*m|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function qw(l){var o=l,c=l;do(o.x<c.x||o.x===c.x&&o.y<c.y)&&(c=o),o=o.next;while(o!==l);return c}function dh(l,o,c,f,m,v,w,E){return(m-w)*(o-E)>=(l-w)*(v-E)&&(l-w)*(f-E)>=(c-w)*(o-E)&&(c-w)*(v-E)>=(m-w)*(f-E)}function jw(l,o){return l.next.i!==o.i&&l.prev.i!==o.i&&!function(c,f){var m=c;do{if(m.i!==c.i&&m.next.i!==c.i&&m.i!==f.i&&m.next.i!==f.i&&d0(m,m.next,c,f))return!0;m=m.next}while(m!==c);return!1}(l,o)&&(sf(l,o)&&sf(o,l)&&function(c,f){var m=c,v=!1,w=(c.x+f.x)/2,E=(c.y+f.y)/2;do m.y>E!=m.next.y>E&&m.next.y!==m.y&&w<(m.next.x-m.x)*(E-m.y)/(m.next.y-m.y)+m.x&&(v=!v),m=m.next;while(m!==c);return v}(l,o)&&($i(l.prev,l,o.prev)||$i(l,o.prev,o))||hm(l,o)&&$i(l.prev,l,l.next)>0&&$i(o.prev,o,o.next)>0)}function $i(l,o,c){return(o.y-l.y)*(c.x-o.x)-(o.x-l.x)*(c.y-o.y)}function hm(l,o){return l.x===o.x&&l.y===o.y}function d0(l,o,c,f){var m=fm($i(l,o,c)),v=fm($i(l,o,f)),w=fm($i(c,f,l)),E=fm($i(c,f,o));return m!==v&&w!==E||!(m!==0||!pm(l,c,o))||!(v!==0||!pm(l,f,o))||!(w!==0||!pm(c,l,f))||!(E!==0||!pm(c,o,f))}function pm(l,o,c){return o.x<=Math.max(l.x,c.x)&&o.x>=Math.min(l.x,c.x)&&o.y<=Math.max(l.y,c.y)&&o.y>=Math.min(l.y,c.y)}function fm(l){return l>0?1:l<0?-1:0}function sf(l,o){return $i(l.prev,l,l.next)<0?$i(l,o,l.next)>=0&&$i(l,l.prev,o)>=0:$i(l,o,l.prev)<0||$i(l,l.next,o)<0}function m0(l,o){var c=new s_(l.i,l.x,l.y),f=new s_(o.i,o.x,o.y),m=l.next,v=o.prev;return l.next=o,o.prev=l,c.next=m,m.prev=c,f.next=c,c.prev=f,v.next=f,f.prev=v,f}function g0(l,o,c,f){var m=new s_(l,o,c);return f?(m.next=f.next,m.prev=f,f.next.prev=m,f.next=m):(m.prev=m,m.next=m),m}function af(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function s_(l,o,c){this.i=l,this.x=o,this.y=c,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function a_(l,o,c,f){for(var m=0,v=o,w=c-f;v<c;v+=f)m+=(l[w]-l[v])*(l[v+1]+l[w+1]),w=v;return m}r_.exports=cm,r_.exports.default=cm,cm.deviation=function(l,o,c,f){var m=o&&o.length,v=Math.abs(a_(l,0,m?o[0]*c:l.length,c));if(m)for(var w=0,E=o.length;w<E;w++)v-=Math.abs(a_(l,o[w]*c,w<E-1?o[w+1]*c:l.length,c));var T=0;for(w=0;w<f.length;w+=3){var P=f[w]*c,N=f[w+1]*c,z=f[w+2]*c;T+=Math.abs((l[P]-l[z])*(l[N+1]-l[P+1])-(l[P]-l[N])*(l[z+1]-l[P+1]))}return v===0&&T===0?0:Math.abs((T-v)/v)},cm.flatten=function(l){for(var o=l[0][0].length,c={vertices:[],holes:[],dimensions:o},f=0,m=0;m<l.length;m++){for(var v=0;v<l[m].length;v++)for(var w=0;w<o;w++)c.vertices.push(l[m][v][w]);m>0&&c.holes.push(f+=l[m-1].length)}return c};var _0=x(r_.exports);function Zw(l,o,c,f,m){y0(l,o,c||0,f||l.length-1,m||Ww)}function y0(l,o,c,f,m){for(;f>c;){if(f-c>600){var v=f-c+1,w=o-c+1,E=Math.log(v),T=.5*Math.exp(2*E/3),P=.5*Math.sqrt(E*T*(v-T)/v)*(w-v/2<0?-1:1);y0(l,o,Math.max(c,Math.floor(o-w*T/v+P)),Math.min(f,Math.floor(o+(v-w)*T/v+P)),m)}var N=l[o],z=c,V=f;for(lf(l,c,o),m(l[f],N)>0&&lf(l,c,f);z<V;){for(lf(l,z,V),z++,V--;m(l[z],N)<0;)z++;for(;m(l[V],N)>0;)V--}m(l[c],N)===0?lf(l,c,V):lf(l,++V,f),V<=o&&(c=V+1),o<=V&&(f=V-1)}}function lf(l,o,c){var f=l[o];l[o]=l[c],l[c]=f}function Ww(l,o){return l<o?-1:l>o?1:0}function l_(l,o){const c=l.length;if(c<=1)return[l];const f=[];let m,v;for(let w=0;w<c;w++){const E=Kt(l[w]);E!==0&&(l[w].area=Math.abs(E),v===void 0&&(v=E<0),v===E<0?(m&&f.push(m),m=[l[w]]):m.push(l[w]))}if(m&&f.push(m),o>1)for(let w=0;w<f.length;w++)f[w].length<=o||(Zw(f[w],o,1,f[w].length-1,Xw),f[w]=f[w].slice(0,o));return f}function Xw(l,o){return o.area-l.area}function u_(l,o,c){const f=c.patternDependencies;let m=!1;for(const v of o){const w=v.paint.get(`${l}-pattern`);w.isConstant()||(m=!0);const E=w.constantOr(null);E&&(m=!0,f[E.to]=!0,f[E.from]=!0)}return m}function c_(l,o,c,f,m){const v=m.patternDependencies;for(const w of o){const E=w.paint.get(`${l}-pattern`).value;if(E.kind!=="constant"){let T=E.evaluate({zoom:f-1},c,{},m.availableImages),P=E.evaluate({zoom:f},c,{},m.availableImages),N=E.evaluate({zoom:f+1},c,{},m.availableImages);T=T&&T.name?T.name:T,P=P&&P.name?P.name:P,N=N&&N.name?N.name:N,v[T]=!0,v[P]=!0,v[N]=!0,c.patterns[w.id]={min:T,mid:P,max:N}}}return c}class h_{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new xn,this.indexArray=new Nr,this.indexArray2=new cr,this.programConfigurations=new Ma(o.layers,o.zoom),this.segments=new pi,this.segments2=new pi,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,f){this.hasPattern=u_("fill",this.layers,c);const m=this.layers[0].layout.get("fill-sort-key"),v=!m.isConstant(),w=[];for(const{feature:E,id:T,index:P,sourceLayerIndex:N}of o){const z=this.layers[0]._featureFilter.needGeometry,V=hc(E,z);if(!this.layers[0]._featureFilter.filter(new hi(this.zoom),V,f))continue;const Z=v?m.evaluate(V,{},f,c.availableImages):void 0,H={id:T,properties:E.properties,type:E.type,sourceLayerIndex:N,index:P,geometry:z?V.geometry:cc(E),patterns:{},sortKey:Z};w.push(H)}v&&w.sort((E,T)=>E.sortKey-T.sortKey);for(const E of w){const{geometry:T,index:P,sourceLayerIndex:N}=E;if(this.hasPattern){const z=c_("fill",this.layers,E,this.zoom,c);this.patternFeatures.push(z)}else this.addFeature(E,T,P,f,{});c.featureIndex.insert(o[P].feature,T,P,N,this.index)}}update(o,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,f)}addFeatures(o,c,f){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Rw),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,c,f,m,v){for(const w of l_(c,500)){let E=0;for(const Z of w)E+=Z.length;const T=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),P=T.vertexLength,N=[],z=[];for(const Z of w){if(Z.length===0)continue;Z!==w[0]&&z.push(N.length/2);const H=this.segments2.prepareSegment(Z.length,this.layoutVertexArray,this.indexArray2),tt=H.vertexLength;this.layoutVertexArray.emplaceBack(Z[0].x,Z[0].y),this.indexArray2.emplaceBack(tt+Z.length-1,tt),N.push(Z[0].x),N.push(Z[0].y);for(let lt=1;lt<Z.length;lt++)this.layoutVertexArray.emplaceBack(Z[lt].x,Z[lt].y),this.indexArray2.emplaceBack(tt+lt-1,tt+lt),N.push(Z[lt].x),N.push(Z[lt].y);H.vertexLength+=Z.length,H.primitiveLength+=Z.length}const V=_0(N,z);for(let Z=0;Z<V.length;Z+=3)this.indexArray.emplaceBack(P+V[Z],P+V[Z+1],P+V[Z+2]);T.vertexLength+=E,T.primitiveLength+=V.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,v,m)}}let v0,b0;xe("FillBucket",h_,{omit:["layers","patternFeatures"]});var Hw={get paint(){return b0=b0||new Ji({"fill-antialias":new Ae(qt.paint_fill["fill-antialias"]),"fill-opacity":new Ge(qt.paint_fill["fill-opacity"]),"fill-color":new Ge(qt.paint_fill["fill-color"]),"fill-outline-color":new Ge(qt.paint_fill["fill-outline-color"]),"fill-translate":new Ae(qt.paint_fill["fill-translate"]),"fill-translate-anchor":new Ae(qt.paint_fill["fill-translate-anchor"]),"fill-pattern":new ac(qt.paint_fill["fill-pattern"])})},get layout(){return v0=v0||new Ji({"fill-sort-key":new Ge(qt.layout_fill["fill-sort-key"])})}};class Yw extends us{constructor(o){super(o,Hw)}recalculate(o,c){super.recalculate(o,c);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new h_(o)}queryRadius(){return am(this.paint.get("fill-translate"))}queryIntersectsFeature(o,c,f,m,v,w,E){return e0(lm(o,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),w.angle,E),m)}isTileClipped(){return!0}}const Kw=Ii([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Jw=Ii([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Qw}=Kw;var yu={},$w=S,x0=mh;function mh(l,o,c,f,m){this.properties={},this.extent=c,this.type=0,this._pbf=l,this._geometry=-1,this._keys=f,this._values=m,l.readFields(t2,this,o)}function t2(l,o,c){l==1?o.id=c.readVarint():l==2?function(f,m){for(var v=f.readVarint()+f.pos;f.pos<v;){var w=m._keys[f.readVarint()],E=m._values[f.readVarint()];m.properties[w]=E}}(c,o):l==3?o.type=c.readVarint():l==4&&(o._geometry=c.pos)}function e2(l){for(var o,c,f=0,m=0,v=l.length,w=v-1;m<v;w=m++)f+=((c=l[w]).x-(o=l[m]).x)*(o.y+c.y);return f}mh.types=["Unknown","Point","LineString","Polygon"],mh.prototype.loadGeometry=function(){var l=this._pbf;l.pos=this._geometry;for(var o,c=l.readVarint()+l.pos,f=1,m=0,v=0,w=0,E=[];l.pos<c;){if(m<=0){var T=l.readVarint();f=7&T,m=T>>3}if(m--,f===1||f===2)v+=l.readSVarint(),w+=l.readSVarint(),f===1&&(o&&E.push(o),o=[]),o.push(new $w(v,w));else{if(f!==7)throw new Error("unknown command "+f);o&&o.push(o[0].clone())}}return o&&E.push(o),E},mh.prototype.bbox=function(){var l=this._pbf;l.pos=this._geometry;for(var o=l.readVarint()+l.pos,c=1,f=0,m=0,v=0,w=1/0,E=-1/0,T=1/0,P=-1/0;l.pos<o;){if(f<=0){var N=l.readVarint();c=7&N,f=N>>3}if(f--,c===1||c===2)(m+=l.readSVarint())<w&&(w=m),m>E&&(E=m),(v+=l.readSVarint())<T&&(T=v),v>P&&(P=v);else if(c!==7)throw new Error("unknown command "+c)}return[w,T,E,P]},mh.prototype.toGeoJSON=function(l,o,c){var f,m,v=this.extent*Math.pow(2,c),w=this.extent*l,E=this.extent*o,T=this.loadGeometry(),P=mh.types[this.type];function N(Z){for(var H=0;H<Z.length;H++){var tt=Z[H];Z[H]=[360*(tt.x+w)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(tt.y+E)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(f=0;f<T.length;f++)z[f]=T[f][0];N(T=z);break;case 2:for(f=0;f<T.length;f++)N(T[f]);break;case 3:for(T=function(Z){var H=Z.length;if(H<=1)return[Z];for(var tt,lt,ft=[],Tt=0;Tt<H;Tt++){var yt=e2(Z[Tt]);yt!==0&&(lt===void 0&&(lt=yt<0),lt===yt<0?(tt&&ft.push(tt),tt=[Z[Tt]]):tt.push(Z[Tt]))}return tt&&ft.push(tt),ft}(T),f=0;f<T.length;f++)for(m=0;m<T[f].length;m++)N(T[f][m])}T.length===1?T=T[0]:P="Multi"+P;var V={type:"Feature",geometry:{type:P,coordinates:T},properties:this.properties};return"id"in this&&(V.id=this.id),V};var n2=x0,w0=S0;function S0(l,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=l,this._keys=[],this._values=[],this._features=[],l.readFields(i2,this,o),this.length=this._features.length}function i2(l,o,c){l===15?o.version=c.readVarint():l===1?o.name=c.readString():l===5?o.extent=c.readVarint():l===2?o._features.push(c.pos):l===3?o._keys.push(c.readString()):l===4&&o._values.push(function(f){for(var m=null,v=f.readVarint()+f.pos;f.pos<v;){var w=f.readVarint()>>3;m=w===1?f.readString():w===2?f.readFloat():w===3?f.readDouble():w===4?f.readVarint64():w===5?f.readVarint():w===6?f.readSVarint():w===7?f.readBoolean():null}return m}(c))}S0.prototype.feature=function(l){if(l<0||l>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[l];var o=this._pbf.readVarint()+this._pbf.pos;return new n2(this._pbf,o,this.extent,this._keys,this._values)};var r2=w0;function o2(l,o,c){if(l===3){var f=new r2(c,c.readVarint()+c.pos);f.length&&(o[f.name]=f)}}yu.VectorTile=function(l,o){this.layers=l.readFields(o2,{},o)},yu.VectorTileFeature=x0,yu.VectorTileLayer=w0;const s2=yu.VectorTileFeature.types,p_=Math.pow(2,13);function uf(l,o,c,f,m,v,w,E){l.emplaceBack(o,c,2*Math.floor(f*p_)+w,m*p_*2,v*p_*2,Math.round(E))}class f_{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new fe,this.centroidVertexArray=new se,this.indexArray=new Nr,this.programConfigurations=new Ma(o.layers,o.zoom),this.segments=new pi,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,f){this.features=[],this.hasPattern=u_("fill-extrusion",this.layers,c);for(const{feature:m,id:v,index:w,sourceLayerIndex:E}of o){const T=this.layers[0]._featureFilter.needGeometry,P=hc(m,T);if(!this.layers[0]._featureFilter.filter(new hi(this.zoom),P,f))continue;const N={id:v,sourceLayerIndex:E,index:w,geometry:T?P.geometry:cc(m),properties:m.properties,type:m.type,patterns:{}};this.hasPattern?this.features.push(c_("fill-extrusion",this.layers,N,this.zoom,c)):this.addFeature(N,N.geometry,w,f,{}),c.featureIndex.insert(m,N.geometry,w,E,this.index,!0)}}addFeatures(o,c,f){for(const m of this.features){const{geometry:v}=m;this.addFeature(m,v,m.index,c,f)}}update(o,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Qw),this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,Jw.members,!0),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(o,c,f,m,v){const w={x:0,y:0,vertexCount:0};for(const E of l_(c,500)){let T=0;for(const H of E)T+=H.length;let P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const H of E){if(H.length===0||l2(H))continue;let tt=0;for(let lt=0;lt<H.length;lt++){const ft=H[lt];if(lt>=1){const Tt=H[lt-1];if(!a2(ft,Tt)){P.vertexLength+4>pi.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const yt=ft.sub(Tt)._perp()._unit(),Mt=Tt.dist(ft);tt+Mt>32768&&(tt=0),uf(this.layoutVertexArray,ft.x,ft.y,yt.x,yt.y,0,0,tt),uf(this.layoutVertexArray,ft.x,ft.y,yt.x,yt.y,0,1,tt),w.x+=2*ft.x,w.y+=2*ft.y,w.vertexCount+=2,tt+=Mt,uf(this.layoutVertexArray,Tt.x,Tt.y,yt.x,yt.y,0,0,tt),uf(this.layoutVertexArray,Tt.x,Tt.y,yt.x,yt.y,0,1,tt),w.x+=2*Tt.x,w.y+=2*Tt.y,w.vertexCount+=2;const zt=P.vertexLength;this.indexArray.emplaceBack(zt,zt+2,zt+1),this.indexArray.emplaceBack(zt+1,zt+2,zt+3),P.vertexLength+=4,P.primitiveLength+=2}}}}if(P.vertexLength+T>pi.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray)),s2[o.type]!=="Polygon")continue;const N=[],z=[],V=P.vertexLength;for(const H of E)if(H.length!==0){H!==E[0]&&z.push(N.length/2);for(let tt=0;tt<H.length;tt++){const lt=H[tt];uf(this.layoutVertexArray,lt.x,lt.y,0,0,1,1,0),w.x+=lt.x,w.y+=lt.y,w.vertexCount+=1,N.push(lt.x),N.push(lt.y)}}const Z=_0(N,z);for(let H=0;H<Z.length;H+=3)this.indexArray.emplaceBack(V+Z[H],V+Z[H+2],V+Z[H+1]);P.primitiveLength+=Z.length/3,P.vertexLength+=T}for(let E=0;E<w.vertexCount;E++)this.centroidVertexArray.emplaceBack(Math.floor(w.x/w.vertexCount),Math.floor(w.y/w.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,v,m)}}function a2(l,o){return l.x===o.x&&(l.x<0||l.x>ar)||l.y===o.y&&(l.y<0||l.y>ar)}function l2(l){return l.every(o=>o.x<0)||l.every(o=>o.x>ar)||l.every(o=>o.y<0)||l.every(o=>o.y>ar)}let E0;xe("FillExtrusionBucket",f_,{omit:["layers","features"]});var u2={get paint(){return E0=E0||new Ji({"fill-extrusion-opacity":new Ae(qt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ge(qt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ae(qt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ae(qt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ac(qt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ge(qt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ge(qt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ae(qt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class c2 extends us{constructor(o){super(o,u2)}createBucket(o){return new f_(o)}queryRadius(){return am(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(o,c,f,m,v,w,E,T){const P=lm(o,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),w.angle,E),N=this.paint.get("fill-extrusion-height").evaluate(c,f),z=this.paint.get("fill-extrusion-base").evaluate(c,f),V=function(H,tt,lt,ft){const Tt=[];for(const yt of H){const Mt=[yt.x,yt.y,0,1];um(Mt,Mt,tt),Tt.push(new k(Mt[0]/Mt[3],Mt[1]/Mt[3]))}return Tt}(P,T),Z=function(H,tt,lt,ft){const Tt=[],yt=[],Mt=ft[8]*tt,zt=ft[9]*tt,Ht=ft[10]*tt,ye=ft[11]*tt,Te=ft[8]*lt,ge=ft[9]*lt,de=ft[10]*lt,le=ft[11]*lt;for(const we of H){const he=[],ie=[];for(const Re of we){const Me=Re.x,gn=Re.y,fi=ft[0]*Me+ft[4]*gn+ft[12],yi=ft[1]*Me+ft[5]*gn+ft[13],fr=ft[2]*Me+ft[6]*gn+ft[14],hs=ft[3]*Me+ft[7]*gn+ft[15],To=fr+Ht,lr=hs+ye,Rr=fi+Te,Qr=yi+ge,Lo=fr+de,Mo=hs+le,dr=new k((fi+Mt)/lr,(yi+zt)/lr);dr.z=To/lr,he.push(dr);const mr=new k(Rr/Mo,Qr/Mo);mr.z=Lo/Mo,ie.push(mr)}Tt.push(he),yt.push(ie)}return[Tt,yt]}(m,z,N,T);return function(H,tt,lt){let ft=1/0;e0(lt,tt)&&(ft=I0(lt,tt[0]));for(let Tt=0;Tt<tt.length;Tt++){const yt=tt[Tt],Mt=H[Tt];for(let zt=0;zt<yt.length-1;zt++){const Ht=yt[zt],ye=[Ht,yt[zt+1],Mt[zt+1],Mt[zt],Ht];t0(lt,ye)&&(ft=Math.min(ft,I0(lt,ye)))}}return ft!==1/0&&ft}(Z[0],Z[1],V)}}function cf(l,o){return l.x*o.x+l.y*o.y}function I0(l,o){if(l.length===1){let c=0;const f=o[c++];let m;for(;!m||f.equals(m);)if(m=o[c++],!m)return 1/0;for(;c<o.length;c++){const v=o[c],w=l[0],E=m.sub(f),T=v.sub(f),P=w.sub(f),N=cf(E,E),z=cf(E,T),V=cf(T,T),Z=cf(P,E),H=cf(P,T),tt=N*V-z*z,lt=(V*Z-z*H)/tt,ft=(N*H-z*Z)/tt,Tt=f.z*(1-lt-ft)+m.z*lt+v.z*ft;if(isFinite(Tt))return Tt}return 1/0}{let c=1/0;for(const f of o)c=Math.min(c,f.z);return c}}const h2=Ii([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:p2}=h2,f2=Ii([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:d2}=f2,m2=yu.VectorTileFeature.types,g2=Math.cos(Math.PI/180*37.5),C0=Math.pow(2,14)/.5;class d_{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new qe,this.layoutVertexArray2=new Le,this.indexArray=new Nr,this.programConfigurations=new Ma(o.layers,o.zoom),this.segments=new pi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,f){this.hasPattern=u_("line",this.layers,c);const m=this.layers[0].layout.get("line-sort-key"),v=!m.isConstant(),w=[];for(const{feature:E,id:T,index:P,sourceLayerIndex:N}of o){const z=this.layers[0]._featureFilter.needGeometry,V=hc(E,z);if(!this.layers[0]._featureFilter.filter(new hi(this.zoom),V,f))continue;const Z=v?m.evaluate(V,{},f):void 0,H={id:T,properties:E.properties,type:E.type,sourceLayerIndex:N,index:P,geometry:z?V.geometry:cc(E),patterns:{},sortKey:Z};w.push(H)}v&&w.sort((E,T)=>E.sortKey-T.sortKey);for(const E of w){const{geometry:T,index:P,sourceLayerIndex:N}=E;if(this.hasPattern){const z=c_("line",this.layers,E,this.zoom,c);this.patternFeatures.push(z)}else this.addFeature(E,T,P,f,{});c.featureIndex.insert(o[P].feature,T,P,N,this.index)}}update(o,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,f)}addFeatures(o,c,f){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,d2)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,p2),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,c,f,m,v){const w=this.layers[0].layout,E=w.get("line-join").evaluate(o,{}),T=w.get("line-cap"),P=w.get("line-miter-limit"),N=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const z of c)this.addLine(z,o,E,T,P,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,v,m)}addLine(o,c,f,m,v,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ft=0;ft<o.length-1;ft++)this.totalDistance+=o[ft].dist(o[ft+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const E=m2[c.type]==="Polygon";let T=o.length;for(;T>=2&&o[T-1].equals(o[T-2]);)T--;let P=0;for(;P<T-1&&o[P].equals(o[P+1]);)P++;if(T<(E?3:2))return;f==="bevel"&&(v=1.05);const N=this.overscaling<=16?15*ar/(512*this.overscaling):0,z=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let V,Z,H,tt,lt;this.e1=this.e2=-1,E&&(V=o[T-2],lt=o[P].sub(V)._unit()._perp());for(let ft=P;ft<T;ft++){if(H=ft===T-1?E?o[P+1]:void 0:o[ft+1],H&&o[ft].equals(H))continue;lt&&(tt=lt),V&&(Z=V),V=o[ft],lt=H?H.sub(V)._unit()._perp():tt,tt=tt||lt;let Tt=tt.add(lt);Tt.x===0&&Tt.y===0||Tt._unit();const yt=tt.x*lt.x+tt.y*lt.y,Mt=Tt.x*lt.x+Tt.y*lt.y,zt=Mt!==0?1/Mt:1/0,Ht=2*Math.sqrt(2-2*Mt),ye=Mt<g2&&Z&&H,Te=tt.x*lt.y-tt.y*lt.x>0;if(ye&&ft>P){const le=V.dist(Z);if(le>2*N){const we=V.sub(V.sub(Z)._mult(N/le)._round());this.updateDistance(Z,we),this.addCurrentVertex(we,tt,0,0,z),Z=we}}const ge=Z&&H;let de=ge?f:E?"butt":m;if(ge&&de==="round"&&(zt<w?de="miter":zt<=2&&(de="fakeround")),de==="miter"&&zt>v&&(de="bevel"),de==="bevel"&&(zt>2&&(de="flipbevel"),zt<v&&(de="miter")),Z&&this.updateDistance(Z,V),de==="miter")Tt._mult(zt),this.addCurrentVertex(V,Tt,0,0,z);else if(de==="flipbevel"){if(zt>100)Tt=lt.mult(-1);else{const le=zt*tt.add(lt).mag()/tt.sub(lt).mag();Tt._perp()._mult(le*(Te?-1:1))}this.addCurrentVertex(V,Tt,0,0,z),this.addCurrentVertex(V,Tt.mult(-1),0,0,z)}else if(de==="bevel"||de==="fakeround"){const le=-Math.sqrt(zt*zt-1),we=Te?le:0,he=Te?0:le;if(Z&&this.addCurrentVertex(V,tt,we,he,z),de==="fakeround"){const ie=Math.round(180*Ht/Math.PI/20);for(let Re=1;Re<ie;Re++){let Me=Re/ie;if(Me!==.5){const fi=Me-.5;Me+=Me*fi*(Me-1)*((1.0904+yt*(yt*(3.55645-1.43519*yt)-3.2452))*fi*fi+(.848013+yt*(.215638*yt-1.06021)))}const gn=lt.sub(tt)._mult(Me)._add(tt)._unit()._mult(Te?-1:1);this.addHalfVertex(V,gn.x,gn.y,!1,Te,0,z)}}H&&this.addCurrentVertex(V,lt,-we,-he,z)}else if(de==="butt")this.addCurrentVertex(V,Tt,0,0,z);else if(de==="square"){const le=Z?1:-1;this.addCurrentVertex(V,Tt,le,le,z)}else de==="round"&&(Z&&(this.addCurrentVertex(V,tt,0,0,z),this.addCurrentVertex(V,tt,1,1,z,!0)),H&&(this.addCurrentVertex(V,lt,-1,-1,z,!0),this.addCurrentVertex(V,lt,0,0,z)));if(ye&&ft<T-1){const le=V.dist(H);if(le>2*N){const we=V.add(H.sub(V)._mult(N/le)._round());this.updateDistance(V,we),this.addCurrentVertex(we,lt,0,0,z),V=we}}}}addCurrentVertex(o,c,f,m,v,w=!1){const E=c.y*m-c.x,T=-c.y-c.x*m;this.addHalfVertex(o,c.x+c.y*f,c.y-c.x*f,w,!1,f,v),this.addHalfVertex(o,E,T,w,!0,-m,v),this.distance>C0/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(o,c,f,m,v,w))}addHalfVertex({x:o,y:c},f,m,v,w,E,T){const P=.5*(this.lineClips?this.scaledDistance*(C0-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((o<<1)+(v?1:0),(c<<1)+(w?1:0),Math.round(63*f)+128,Math.round(63*m)+128,1+(E===0?0:E<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const N=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,N),T.primitiveLength++),w?this.e2=N:this.e1=N}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(o,c){this.distance+=o.dist(c),this.updateScaledDistance()}}let T0,L0;xe("LineBucket",d_,{omit:["layers","patternFeatures"]});var M0={get paint(){return L0=L0||new Ji({"line-opacity":new Ge(qt.paint_line["line-opacity"]),"line-color":new Ge(qt.paint_line["line-color"]),"line-translate":new Ae(qt.paint_line["line-translate"]),"line-translate-anchor":new Ae(qt.paint_line["line-translate-anchor"]),"line-width":new Ge(qt.paint_line["line-width"]),"line-gap-width":new Ge(qt.paint_line["line-gap-width"]),"line-offset":new Ge(qt.paint_line["line-offset"]),"line-blur":new Ge(qt.paint_line["line-blur"]),"line-dasharray":new Wp(qt.paint_line["line-dasharray"]),"line-pattern":new ac(qt.paint_line["line-pattern"]),"line-gradient":new Xp(qt.paint_line["line-gradient"])})},get layout(){return T0=T0||new Ji({"line-cap":new Ae(qt.layout_line["line-cap"]),"line-join":new Ge(qt.layout_line["line-join"]),"line-miter-limit":new Ae(qt.layout_line["line-miter-limit"]),"line-round-limit":new Ae(qt.layout_line["line-round-limit"]),"line-sort-key":new Ge(qt.layout_line["line-sort-key"])})}};class _2 extends Ge{possiblyEvaluate(o,c){return c=new hi(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,zoomHistory:c.zoomHistory,transition:c.transition}),super.possiblyEvaluate(o,c)}evaluate(o,c,f,m){return c=ht({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(o,c,f,m)}}let dm;class y2 extends us{constructor(o){super(o,M0),this.gradientVersion=0,dm||(dm=new _2(M0.paint.properties["line-width"].specification),dm.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const c=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(c)&&c._styleExpression.expression instanceof Ka,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,c){super.recalculate(o,c),this.paint._values["line-floorwidth"]=dm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new d_(o)}queryRadius(o){const c=o,f=P0(ef("line-width",this,c),ef("line-gap-width",this,c)),m=ef("line-offset",this,c);return f/2+Math.abs(m)+am(this.paint.get("line-translate"))}queryIntersectsFeature(o,c,f,m,v,w,E){const T=lm(o,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),w.angle,E),P=E/2*P0(this.paint.get("line-width").evaluate(c,f),this.paint.get("line-gap-width").evaluate(c,f)),N=this.paint.get("line-offset").evaluate(c,f);return N&&(m=function(z,V){const Z=[];for(let H=0;H<z.length;H++){const tt=z[H],lt=[];for(let ft=0;ft<tt.length;ft++){const Tt=tt[ft-1],yt=tt[ft],Mt=tt[ft+1],zt=ft===0?new k(0,0):yt.sub(Tt)._unit()._perp(),Ht=ft===tt.length-1?new k(0,0):Mt.sub(yt)._unit()._perp(),ye=zt._add(Ht)._unit(),Te=ye.x*Ht.x+ye.y*Ht.y;Te!==0&&ye._mult(1/Te),lt.push(ye._mult(V)._add(yt))}Z.push(lt)}return Z}(m,N*E)),function(z,V,Z){for(let H=0;H<V.length;H++){const tt=V[H];if(z.length>=3){for(let lt=0;lt<tt.length;lt++)if(ph(z,tt[lt]))return!0}if(Ew(z,tt,Z))return!0}return!1}(T,m,P)}isTileClipped(){return!0}}function P0(l,o){return o>0?o+2*l:l}const v2=Ii([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),b2=Ii([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ii([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const x2=Ii([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Ii([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const A0=Ii([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),w2=Ii([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function S2(l,o,c){return l.sections.forEach(f=>{f.text=function(m,v,w){const E=v.layout.get("text-transform").evaluate(w,{});return E==="uppercase"?m=m.toLocaleUpperCase():E==="lowercase"&&(m=m.toLocaleLowerCase()),Uo.applyArabicShaping&&(m=Uo.applyArabicShaping(m)),m}(f.text,o,c)}),l}Ii([{name:"triangle",components:3,type:"Uint16"}]),Ii([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ii([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ii([{type:"Float32",name:"offsetX"}]),Ii([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ii([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const hf={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var pr=24,k0=$n,N0=function(l,o,c,f,m){var v,w,E=8*m-f-1,T=(1<<E)-1,P=T>>1,N=-7,z=c?m-1:0,V=c?-1:1,Z=l[o+z];for(z+=V,v=Z&(1<<-N)-1,Z>>=-N,N+=E;N>0;v=256*v+l[o+z],z+=V,N-=8);for(w=v&(1<<-N)-1,v>>=-N,N+=f;N>0;w=256*w+l[o+z],z+=V,N-=8);if(v===0)v=1-P;else{if(v===T)return w?NaN:1/0*(Z?-1:1);w+=Math.pow(2,f),v-=P}return(Z?-1:1)*w*Math.pow(2,v-f)},D0=function(l,o,c,f,m,v){var w,E,T,P=8*v-m-1,N=(1<<P)-1,z=N>>1,V=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,Z=f?0:v-1,H=f?1:-1,tt=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(E=isNaN(o)?1:0,w=N):(w=Math.floor(Math.log(o)/Math.LN2),o*(T=Math.pow(2,-w))<1&&(w--,T*=2),(o+=w+z>=1?V/T:V*Math.pow(2,1-z))*T>=2&&(w++,T/=2),w+z>=N?(E=0,w=N):w+z>=1?(E=(o*T-1)*Math.pow(2,m),w+=z):(E=o*Math.pow(2,z-1)*Math.pow(2,m),w=0));m>=8;l[c+Z]=255&E,Z+=H,E/=256,m-=8);for(w=w<<m|E,P+=m;P>0;l[c+Z]=255&w,Z+=H,w/=256,P-=8);l[c+Z-H]|=128*tt};function $n(l){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(l)?l:new Uint8Array(l||0),this.pos=0,this.type=0,this.length=this.buf.length}$n.Varint=0,$n.Fixed64=1,$n.Bytes=2,$n.Fixed32=5;var m_=4294967296,R0=1/m_,O0=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Dl(l){return l.type===$n.Bytes?l.readVarint()+l.pos:l.pos+1}function gh(l,o,c){return c?4294967296*o+(l>>>0):4294967296*(o>>>0)+(l>>>0)}function z0(l,o,c){var f=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));c.realloc(f);for(var m=c.pos-1;m>=l;m--)c.buf[m+f]=c.buf[m]}function E2(l,o){for(var c=0;c<l.length;c++)o.writeVarint(l[c])}function I2(l,o){for(var c=0;c<l.length;c++)o.writeSVarint(l[c])}function C2(l,o){for(var c=0;c<l.length;c++)o.writeFloat(l[c])}function T2(l,o){for(var c=0;c<l.length;c++)o.writeDouble(l[c])}function L2(l,o){for(var c=0;c<l.length;c++)o.writeBoolean(l[c])}function M2(l,o){for(var c=0;c<l.length;c++)o.writeFixed32(l[c])}function P2(l,o){for(var c=0;c<l.length;c++)o.writeSFixed32(l[c])}function A2(l,o){for(var c=0;c<l.length;c++)o.writeFixed64(l[c])}function k2(l,o){for(var c=0;c<l.length;c++)o.writeSFixed64(l[c])}function mm(l,o){return(l[o]|l[o+1]<<8|l[o+2]<<16)+16777216*l[o+3]}function _h(l,o,c){l[c]=o,l[c+1]=o>>>8,l[c+2]=o>>>16,l[c+3]=o>>>24}function F0(l,o){return(l[o]|l[o+1]<<8|l[o+2]<<16)+(l[o+3]<<24)}$n.prototype={destroy:function(){this.buf=null},readFields:function(l,o,c){for(c=c||this.length;this.pos<c;){var f=this.readVarint(),m=f>>3,v=this.pos;this.type=7&f,l(m,o,this),this.pos===v&&this.skip(f)}return o},readMessage:function(l,o){return this.readFields(l,o,this.readVarint()+this.pos)},readFixed32:function(){var l=mm(this.buf,this.pos);return this.pos+=4,l},readSFixed32:function(){var l=F0(this.buf,this.pos);return this.pos+=4,l},readFixed64:function(){var l=mm(this.buf,this.pos)+mm(this.buf,this.pos+4)*m_;return this.pos+=8,l},readSFixed64:function(){var l=mm(this.buf,this.pos)+F0(this.buf,this.pos+4)*m_;return this.pos+=8,l},readFloat:function(){var l=N0(this.buf,this.pos,!0,23,4);return this.pos+=4,l},readDouble:function(){var l=N0(this.buf,this.pos,!0,52,8);return this.pos+=8,l},readVarint:function(l){var o,c,f=this.buf;return o=127&(c=f[this.pos++]),c<128?o:(o|=(127&(c=f[this.pos++]))<<7,c<128?o:(o|=(127&(c=f[this.pos++]))<<14,c<128?o:(o|=(127&(c=f[this.pos++]))<<21,c<128?o:function(m,v,w){var E,T,P=w.buf;if(E=(112&(T=P[w.pos++]))>>4,T<128||(E|=(127&(T=P[w.pos++]))<<3,T<128)||(E|=(127&(T=P[w.pos++]))<<10,T<128)||(E|=(127&(T=P[w.pos++]))<<17,T<128)||(E|=(127&(T=P[w.pos++]))<<24,T<128)||(E|=(1&(T=P[w.pos++]))<<31,T<128))return gh(m,E,v);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(c=f[this.pos]))<<28,l,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var l=this.readVarint();return l%2==1?(l+1)/-2:l/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var l=this.readVarint()+this.pos,o=this.pos;return this.pos=l,l-o>=12&&O0?function(c,f,m){return O0.decode(c.subarray(f,m))}(this.buf,o,l):function(c,f,m){for(var v="",w=f;w<m;){var E,T,P,N=c[w],z=null,V=N>239?4:N>223?3:N>191?2:1;if(w+V>m)break;V===1?N<128&&(z=N):V===2?(192&(E=c[w+1]))==128&&(z=(31&N)<<6|63&E)<=127&&(z=null):V===3?(T=c[w+2],(192&(E=c[w+1]))==128&&(192&T)==128&&((z=(15&N)<<12|(63&E)<<6|63&T)<=2047||z>=55296&&z<=57343)&&(z=null)):V===4&&(T=c[w+2],P=c[w+3],(192&(E=c[w+1]))==128&&(192&T)==128&&(192&P)==128&&((z=(15&N)<<18|(63&E)<<12|(63&T)<<6|63&P)<=65535||z>=1114112)&&(z=null)),z===null?(z=65533,V=1):z>65535&&(z-=65536,v+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),v+=String.fromCharCode(z),w+=V}return v}(this.buf,o,l)},readBytes:function(){var l=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,l);return this.pos=l,o},readPackedVarint:function(l,o){if(this.type!==$n.Bytes)return l.push(this.readVarint(o));var c=Dl(this);for(l=l||[];this.pos<c;)l.push(this.readVarint(o));return l},readPackedSVarint:function(l){if(this.type!==$n.Bytes)return l.push(this.readSVarint());var o=Dl(this);for(l=l||[];this.pos<o;)l.push(this.readSVarint());return l},readPackedBoolean:function(l){if(this.type!==$n.Bytes)return l.push(this.readBoolean());var o=Dl(this);for(l=l||[];this.pos<o;)l.push(this.readBoolean());return l},readPackedFloat:function(l){if(this.type!==$n.Bytes)return l.push(this.readFloat());var o=Dl(this);for(l=l||[];this.pos<o;)l.push(this.readFloat());return l},readPackedDouble:function(l){if(this.type!==$n.Bytes)return l.push(this.readDouble());var o=Dl(this);for(l=l||[];this.pos<o;)l.push(this.readDouble());return l},readPackedFixed32:function(l){if(this.type!==$n.Bytes)return l.push(this.readFixed32());var o=Dl(this);for(l=l||[];this.pos<o;)l.push(this.readFixed32());return l},readPackedSFixed32:function(l){if(this.type!==$n.Bytes)return l.push(this.readSFixed32());var o=Dl(this);for(l=l||[];this.pos<o;)l.push(this.readSFixed32());return l},readPackedFixed64:function(l){if(this.type!==$n.Bytes)return l.push(this.readFixed64());var o=Dl(this);for(l=l||[];this.pos<o;)l.push(this.readFixed64());return l},readPackedSFixed64:function(l){if(this.type!==$n.Bytes)return l.push(this.readSFixed64());var o=Dl(this);for(l=l||[];this.pos<o;)l.push(this.readSFixed64());return l},skip:function(l){var o=7&l;if(o===$n.Varint)for(;this.buf[this.pos++]>127;);else if(o===$n.Bytes)this.pos=this.readVarint()+this.pos;else if(o===$n.Fixed32)this.pos+=4;else{if(o!==$n.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(l,o){this.writeVarint(l<<3|o)},realloc:function(l){for(var o=this.length||16;o<this.pos+l;)o*=2;if(o!==this.length){var c=new Uint8Array(o);c.set(this.buf),this.buf=c,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(l){this.realloc(4),_h(this.buf,l,this.pos),this.pos+=4},writeSFixed32:function(l){this.realloc(4),_h(this.buf,l,this.pos),this.pos+=4},writeFixed64:function(l){this.realloc(8),_h(this.buf,-1&l,this.pos),_h(this.buf,Math.floor(l*R0),this.pos+4),this.pos+=8},writeSFixed64:function(l){this.realloc(8),_h(this.buf,-1&l,this.pos),_h(this.buf,Math.floor(l*R0),this.pos+4),this.pos+=8},writeVarint:function(l){(l=+l||0)>268435455||l<0?function(o,c){var f,m;if(o>=0?(f=o%4294967296|0,m=o/4294967296|0):(m=~(-o/4294967296),4294967295^(f=~(-o%4294967296))?f=f+1|0:(f=0,m=m+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(v,w,E){E.buf[E.pos++]=127&v|128,v>>>=7,E.buf[E.pos++]=127&v|128,v>>>=7,E.buf[E.pos++]=127&v|128,v>>>=7,E.buf[E.pos++]=127&v|128,E.buf[E.pos]=127&(v>>>=7)}(f,0,c),function(v,w){var E=(7&v)<<4;w.buf[w.pos++]|=E|((v>>>=3)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v)))))}(m,c)}(l,this):(this.realloc(4),this.buf[this.pos++]=127&l|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=l>>>7&127))))},writeSVarint:function(l){this.writeVarint(l<0?2*-l-1:2*l)},writeBoolean:function(l){this.writeVarint(!!l)},writeString:function(l){l=String(l),this.realloc(4*l.length),this.pos++;var o=this.pos;this.pos=function(f,m,v){for(var w,E,T=0;T<m.length;T++){if((w=m.charCodeAt(T))>55295&&w<57344){if(!E){w>56319||T+1===m.length?(f[v++]=239,f[v++]=191,f[v++]=189):E=w;continue}if(w<56320){f[v++]=239,f[v++]=191,f[v++]=189,E=w;continue}w=E-55296<<10|w-56320|65536,E=null}else E&&(f[v++]=239,f[v++]=191,f[v++]=189,E=null);w<128?f[v++]=w:(w<2048?f[v++]=w>>6|192:(w<65536?f[v++]=w>>12|224:(f[v++]=w>>18|240,f[v++]=w>>12&63|128),f[v++]=w>>6&63|128),f[v++]=63&w|128)}return v}(this.buf,l,this.pos);var c=this.pos-o;c>=128&&z0(o,c,this),this.pos=o-1,this.writeVarint(c),this.pos+=c},writeFloat:function(l){this.realloc(4),D0(this.buf,l,this.pos,!0,23,4),this.pos+=4},writeDouble:function(l){this.realloc(8),D0(this.buf,l,this.pos,!0,52,8),this.pos+=8},writeBytes:function(l){var o=l.length;this.writeVarint(o),this.realloc(o);for(var c=0;c<o;c++)this.buf[this.pos++]=l[c]},writeRawMessage:function(l,o){this.pos++;var c=this.pos;l(o,this);var f=this.pos-c;f>=128&&z0(c,f,this),this.pos=c-1,this.writeVarint(f),this.pos+=f},writeMessage:function(l,o,c){this.writeTag(l,$n.Bytes),this.writeRawMessage(o,c)},writePackedVarint:function(l,o){o.length&&this.writeMessage(l,E2,o)},writePackedSVarint:function(l,o){o.length&&this.writeMessage(l,I2,o)},writePackedBoolean:function(l,o){o.length&&this.writeMessage(l,L2,o)},writePackedFloat:function(l,o){o.length&&this.writeMessage(l,C2,o)},writePackedDouble:function(l,o){o.length&&this.writeMessage(l,T2,o)},writePackedFixed32:function(l,o){o.length&&this.writeMessage(l,M2,o)},writePackedSFixed32:function(l,o){o.length&&this.writeMessage(l,P2,o)},writePackedFixed64:function(l,o){o.length&&this.writeMessage(l,A2,o)},writePackedSFixed64:function(l,o){o.length&&this.writeMessage(l,k2,o)},writeBytesField:function(l,o){this.writeTag(l,$n.Bytes),this.writeBytes(o)},writeFixed32Field:function(l,o){this.writeTag(l,$n.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(l,o){this.writeTag(l,$n.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(l,o){this.writeTag(l,$n.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(l,o){this.writeTag(l,$n.Fixed64),this.writeSFixed64(o)},writeVarintField:function(l,o){this.writeTag(l,$n.Varint),this.writeVarint(o)},writeSVarintField:function(l,o){this.writeTag(l,$n.Varint),this.writeSVarint(o)},writeStringField:function(l,o){this.writeTag(l,$n.Bytes),this.writeString(o)},writeFloatField:function(l,o){this.writeTag(l,$n.Fixed32),this.writeFloat(o)},writeDoubleField:function(l,o){this.writeTag(l,$n.Fixed64),this.writeDouble(o)},writeBooleanField:function(l,o){this.writeVarintField(l,!!o)}};var g_=x(k0);const __=3;function N2(l,o,c){l===1&&c.readMessage(D2,o)}function D2(l,o,c){if(l===3){const{id:f,bitmap:m,width:v,height:w,left:E,top:T,advance:P}=c.readMessage(R2,{});o.push({id:f,bitmap:new rf({width:v+2*__,height:w+2*__},m),metrics:{width:v,height:w,left:E,top:T,advance:P}})}}function R2(l,o,c){l===1?o.id=c.readVarint():l===2?o.bitmap=c.readBytes():l===3?o.width=c.readVarint():l===4?o.height=c.readVarint():l===5?o.left=c.readSVarint():l===6?o.top=c.readSVarint():l===7&&(o.advance=c.readVarint())}const B0=__;function V0(l){let o=0,c=0;for(const w of l)o+=w.w*w.h,c=Math.max(c,w.w);l.sort((w,E)=>E.h-w.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),c),h:1/0}];let m=0,v=0;for(const w of l)for(let E=f.length-1;E>=0;E--){const T=f[E];if(!(w.w>T.w||w.h>T.h)){if(w.x=T.x,w.y=T.y,v=Math.max(v,w.y+w.h),m=Math.max(m,w.x+w.w),w.w===T.w&&w.h===T.h){const P=f.pop();E<f.length&&(f[E]=P)}else w.h===T.h?(T.x+=w.w,T.w-=w.w):w.w===T.w?(T.y+=w.h,T.h-=w.h):(f.push({x:T.x+w.w,y:T.y,w:T.w-w.w,h:w.h}),T.y+=w.h,T.h-=w.h);break}}return{w:m,h:v,fill:o/(m*v)||0}}const qo=1;class y_{constructor(o,{pixelRatio:c,version:f,stretchX:m,stretchY:v,content:w}){this.paddedRect=o,this.pixelRatio=c,this.stretchX=m,this.stretchY=v,this.content=w,this.version=f}get tl(){return[this.paddedRect.x+qo,this.paddedRect.y+qo]}get br(){return[this.paddedRect.x+this.paddedRect.w-qo,this.paddedRect.y+this.paddedRect.h-qo]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*qo)/this.pixelRatio,(this.paddedRect.h-2*qo)/this.pixelRatio]}}class U0{constructor(o,c){const f={},m={};this.haveRenderCallbacks=[];const v=[];this.addImages(o,f,v),this.addImages(c,m,v);const{w,h:E}=V0(v),T=new Is({width:w||1,height:E||1});for(const P in o){const N=o[P],z=f[P].paddedRect;Is.copy(N.data,T,{x:0,y:0},{x:z.x+qo,y:z.y+qo},N.data)}for(const P in c){const N=c[P],z=m[P].paddedRect,V=z.x+qo,Z=z.y+qo,H=N.data.width,tt=N.data.height;Is.copy(N.data,T,{x:0,y:0},{x:V,y:Z},N.data),Is.copy(N.data,T,{x:0,y:tt-1},{x:V,y:Z-1},{width:H,height:1}),Is.copy(N.data,T,{x:0,y:0},{x:V,y:Z+tt},{width:H,height:1}),Is.copy(N.data,T,{x:H-1,y:0},{x:V-1,y:Z},{width:1,height:tt}),Is.copy(N.data,T,{x:0,y:0},{x:V+H,y:Z},{width:1,height:tt})}this.image=T,this.iconPositions=f,this.patternPositions=m}addImages(o,c,f){for(const m in o){const v=o[m],w={x:0,y:0,w:v.data.width+2*qo,h:v.data.height+2*qo};f.push(w),c[m]=new y_(w,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(o,c){o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in o.updatedImages)this.patchUpdatedImage(this.iconPositions[f],o.getImage(f),c),this.patchUpdatedImage(this.patternPositions[f],o.getImage(f),c)}patchUpdatedImage(o,c,f){if(!o||!c||o.version===c.version)return;o.version=c.version;const[m,v]=o.tl;f.update(c.data,void 0,{x:m,y:v})}}var vu;xe("ImagePosition",y_),xe("ImageAtlas",U0),a.ai=void 0,(vu=a.ai||(a.ai={}))[vu.none=0]="none",vu[vu.horizontal=1]="horizontal",vu[vu.vertical=2]="vertical",vu[vu.horizontalOnly=3]="horizontalOnly";const pf=-17;class ff{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,c){const f=new ff;return f.scale=o||1,f.fontStack=c,f}static forImage(o){const c=new ff;return c.imageName=o,c}}class yh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,c){const f=new yh;for(let m=0;m<o.sections.length;m++){const v=o.sections[m];v.image?f.addImageSection(v):f.addTextSection(v,c)}return f}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(){this.text=function(o){let c="";for(let f=0;f<o.length;f++){const m=o.charCodeAt(f+1)||null,v=o.charCodeAt(f-1)||null;c+=m&&Kd(m)&&!hf[o[f+1]]||v&&Kd(v)&&!hf[o[f-1]]||!hf[o[f]]?o[f]:hf[o[f]]}return c}(this.text)}trim(){let o=0;for(let f=0;f<this.text.length&&_m[this.text.charCodeAt(f)];f++)o++;let c=this.text.length;for(let f=this.text.length-1;f>=0&&f>=o&&_m[this.text.charCodeAt(f)];f--)c--;this.text=this.text.substring(o,c),this.sectionIndex=this.sectionIndex.slice(o,c)}substring(o,c){const f=new yh;return f.text=this.text.substring(o,c),f.sectionIndex=this.sectionIndex.slice(o,c),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,c)=>Math.max(o,this.sections[c].scale),0)}addTextSection(o,c){this.text+=o.text,this.sections.push(ff.forText(o.scale,o.fontStack||c));const f=this.sections.length-1;for(let m=0;m<o.text.length;++m)this.sectionIndex.push(f)}addImageSection(o){const c=o.image?o.image.name:"";if(c.length===0)return void kt("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(ff.forImage(c)),this.sectionIndex.push(this.sections.length-1)):kt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function gm(l,o,c,f,m,v,w,E,T,P,N,z,V,Z,H,tt){const lt=yh.fromFeature(l,m);let ft;z===a.ai.vertical&&lt.verticalizePunctuation();const{processBidirectionalText:Tt,processStyledBidirectionalText:yt}=Uo;if(Tt&&lt.sections.length===1){ft=[];const Ht=Tt(lt.toString(),v_(lt,P,v,o,f,Z,H));for(const ye of Ht){const Te=new yh;Te.text=ye,Te.sections=lt.sections;for(let ge=0;ge<ye.length;ge++)Te.sectionIndex.push(0);ft.push(Te)}}else if(yt){ft=[];const Ht=yt(lt.text,lt.sectionIndex,v_(lt,P,v,o,f,Z,H));for(const ye of Ht){const Te=new yh;Te.text=ye[0],Te.sectionIndex=ye[1],Te.sections=lt.sections,ft.push(Te)}}else ft=function(Ht,ye){const Te=[],ge=Ht.text;let de=0;for(const le of ye)Te.push(Ht.substring(de,le)),de=le;return de<ge.length&&Te.push(Ht.substring(de,ge.length)),Te}(lt,v_(lt,P,v,o,f,Z,H));const Mt=[],zt={positionedLines:Mt,text:lt.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:z,iconsInText:!1,verticalizable:!1};return function(Ht,ye,Te,ge,de,le,we,he,ie,Re,Me,gn){let fi=0,yi=pf,fr=0,hs=0;const To=he==="right"?1:he==="left"?0:.5;let lr=0;for(const dr of de){dr.trim();const mr=dr.getMaxScale(),po=(mr-1)*pr,Po={positionedGlyphs:[],lineOffset:0};Ht.positionedLines[lr]=Po;const fo=Po.positionedGlyphs;let jo=0;if(!dr.length()){yi+=le,++lr;continue}for(let gr=0;gr<dr.length();gr++){const Sn=dr.getSection(gr),mo=dr.getSectionIndex(gr),$r=dr.getCharCode(gr);let _r=0,Ks=null,Pa=null,Aa=null,Rl=pr;const Js=!(ie===a.ai.horizontal||!Me&&!Fp($r)||Me&&(_m[$r]||(Rr=$r,_e.Arabic(Rr)||_e["Arabic Supplement"](Rr)||_e["Arabic Extended-A"](Rr)||_e["Arabic Presentation Forms-A"](Rr)||_e["Arabic Presentation Forms-B"](Rr))));if(Sn.imageName){const Ts=ge[Sn.imageName];if(!Ts)continue;Aa=Sn.imageName,Ht.iconsInText=Ht.iconsInText||!0,Pa=Ts.paddedRect;const Wo=Ts.displaySize;Sn.scale=Sn.scale*pr/gn,Ks={width:Wo[0],height:Wo[1],left:qo,top:-B0,advance:Js?Wo[1]:Wo[0]},_r=po+(pr-Wo[1]*Sn.scale),Rl=Ks.advance;const Ol=Js?Wo[0]*Sn.scale-pr*mr:Wo[1]*Sn.scale-pr*mr;Ol>0&&Ol>jo&&(jo=Ol)}else{const Ts=Te[Sn.fontStack],Wo=Ts&&Ts[$r];if(Wo&&Wo.rect)Pa=Wo.rect,Ks=Wo.metrics;else{const Ol=ye[Sn.fontStack],yf=Ol&&Ol[$r];if(!yf)continue;Ks=yf.metrics}_r=(mr-Sn.scale)*pr}Js?(Ht.verticalizable=!0,fo.push({glyph:$r,imageName:Aa,x:fi,y:yi+_r,vertical:Js,scale:Sn.scale,fontStack:Sn.fontStack,sectionIndex:mo,metrics:Ks,rect:Pa}),fi+=Rl*Sn.scale+Re):(fo.push({glyph:$r,imageName:Aa,x:fi,y:yi+_r,vertical:Js,scale:Sn.scale,fontStack:Sn.fontStack,sectionIndex:mo,metrics:Ks,rect:Pa}),fi+=Ks.advance*Sn.scale+Re)}fo.length!==0&&(fr=Math.max(fi-Re,fr),F2(fo,0,fo.length-1,To,jo)),fi=0;const Zo=le*mr+jo;Po.lineOffset=Math.max(jo,po),yi+=Zo,hs=Math.max(Zo,hs),++lr}var Rr;const Qr=yi-pf,{horizontalAlign:Lo,verticalAlign:Mo}=b_(we);(function(dr,mr,po,Po,fo,jo,Zo,gr,Sn){const mo=(mr-po)*fo;let $r=0;$r=jo!==Zo?-gr*Po-pf:(-Po*Sn+.5)*Zo;for(const _r of dr)for(const Ks of _r.positionedGlyphs)Ks.x+=mo,Ks.y+=$r})(Ht.positionedLines,To,Lo,Mo,fr,hs,le,Qr,de.length),Ht.top+=-Mo*Qr,Ht.bottom=Ht.top+Qr,Ht.left+=-Lo*fr,Ht.right=Ht.left+fr}(zt,o,c,f,ft,w,E,T,z,P,V,tt),!function(Ht){for(const ye of Ht)if(ye.positionedGlyphs.length!==0)return!1;return!0}(Mt)&&zt}const _m={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},O2={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function G0(l,o,c,f,m,v){if(o.imageName){const w=f[o.imageName];return w?w.displaySize[0]*o.scale*pr/v+m:0}{const w=c[o.fontStack],E=w&&w[l];return E?E.metrics.advance*o.scale+m:0}}function q0(l,o,c,f){const m=Math.pow(l-o,2);return f?l<o?m/2:2*m:m+Math.abs(c)*c}function z2(l,o,c){let f=0;return l===10&&(f-=1e4),c&&(f+=150),l!==40&&l!==65288||(f+=50),o!==41&&o!==65289||(f+=50),f}function j0(l,o,c,f,m,v){let w=null,E=q0(o,c,m,v);for(const T of f){const P=q0(o-T.x,c,m,v)+T.badness;P<=E&&(w=T,E=P)}return{index:l,x:o,priorBreak:w,badness:E}}function Z0(l){return l?Z0(l.priorBreak).concat(l.index):[]}function v_(l,o,c,f,m,v,w){if(v!=="point")return[];if(!l)return[];const E=[],T=function(V,Z,H,tt,lt,ft){let Tt=0;for(let yt=0;yt<V.length();yt++){const Mt=V.getSection(yt);Tt+=G0(V.getCharCode(yt),Mt,tt,lt,Z,ft)}return Tt/Math.max(1,Math.ceil(Tt/H))}(l,o,c,f,m,w),P=l.text.indexOf("")>=0;let N=0;for(let V=0;V<l.length();V++){const Z=l.getSection(V),H=l.getCharCode(V);if(_m[H]||(N+=G0(H,Z,f,m,o,w)),V<l.length()-1){const tt=!((z=H)<11904||!(_e["Bopomofo Extended"](z)||_e.Bopomofo(z)||_e["CJK Compatibility Forms"](z)||_e["CJK Compatibility Ideographs"](z)||_e["CJK Compatibility"](z)||_e["CJK Radicals Supplement"](z)||_e["CJK Strokes"](z)||_e["CJK Symbols and Punctuation"](z)||_e["CJK Unified Ideographs Extension A"](z)||_e["CJK Unified Ideographs"](z)||_e["Enclosed CJK Letters and Months"](z)||_e["Halfwidth and Fullwidth Forms"](z)||_e.Hiragana(z)||_e["Ideographic Description Characters"](z)||_e["Kangxi Radicals"](z)||_e["Katakana Phonetic Extensions"](z)||_e.Katakana(z)||_e["Vertical Forms"](z)||_e["Yi Radicals"](z)||_e["Yi Syllables"](z)));(O2[H]||tt||Z.imageName)&&E.push(j0(V+1,N,T,E,z2(H,l.getCharCode(V+1),tt&&P),!1))}}var z;return Z0(j0(l.length(),N,T,E,0,!0))}function b_(l){let o=.5,c=.5;switch(l){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:o,verticalAlign:c}}function F2(l,o,c,f,m){if(!f&&!m)return;const v=l[c],w=(l[c].x+v.metrics.advance*v.scale)*f;for(let E=o;E<=c;E++)l[E].x-=w,l[E].y+=m}function B2(l,o,c){const{horizontalAlign:f,verticalAlign:m}=b_(c),v=o[0]-l.displaySize[0]*f,w=o[1]-l.displaySize[1]*m;return{image:l,top:w,bottom:w+l.displaySize[1],left:v,right:v+l.displaySize[0]}}function W0(l,o,c,f,m,v){const w=l.image;let E;if(w.content){const lt=w.content,ft=w.pixelRatio||1;E=[lt[0]/ft,lt[1]/ft,w.displaySize[0]-lt[2]/ft,w.displaySize[1]-lt[3]/ft]}const T=o.left*v,P=o.right*v;let N,z,V,Z;c==="width"||c==="both"?(Z=m[0]+T-f[3],z=m[0]+P+f[1]):(Z=m[0]+(T+P-w.displaySize[0])/2,z=Z+w.displaySize[0]);const H=o.top*v,tt=o.bottom*v;return c==="height"||c==="both"?(N=m[1]+H-f[0],V=m[1]+tt+f[2]):(N=m[1]+(H+tt-w.displaySize[1])/2,V=N+w.displaySize[1]),{image:w,top:N,right:z,bottom:V,left:Z,collisionPadding:E}}const df=255,el=128,bu=df*el;function X0(l,o){const{expression:c}=o;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new hi(l+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:m}=c;let v=0;for(;v<f.length&&f[v]<=l;)v++;v=Math.max(0,v-1);let w=v;for(;w<f.length&&f[w]<l+1;)w++;w=Math.min(f.length-1,w);const E=f[v],T=f[w];return c.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:T,interpolationType:m}:{kind:"camera",minZoom:E,maxZoom:T,minSize:c.evaluate(new hi(E)),maxSize:c.evaluate(new hi(T)),interpolationType:m}}}function x_(l,o,c){let f="never";const m=l.get(o);return m?f=m:l.get(c)&&(f="always"),f}const V2=yu.VectorTileFeature.types,U2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ym(l,o,c,f,m,v,w,E,T,P,N,z,V){const Z=E?Math.min(bu,Math.round(E[0])):0,H=E?Math.min(bu,Math.round(E[1])):0;l.emplaceBack(o,c,Math.round(32*f),Math.round(32*m),v,w,(Z<<1)+(T?1:0),H,16*P,16*N,256*z,256*V)}function w_(l,o,c){l.emplaceBack(o.x,o.y,c),l.emplaceBack(o.x,o.y,c),l.emplaceBack(o.x,o.y,c),l.emplaceBack(o.x,o.y,c)}function G2(l){for(const o of l.sections)if(Hg(o.text))return!0;return!1}class S_{constructor(o){this.layoutVertexArray=new bn,this.indexArray=new Nr,this.programConfigurations=o,this.segments=new pi,this.dynamicLayoutVertexArray=new hn,this.opacityVertexArray=new wn,this.hasVisibleVertices=!1,this.placedSymbolArray=new xt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(o,c,f,m){this.isEmpty()||(f&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,v2.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,b2.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,U2,!0),this.opacityVertexBuffer.itemSize=1),(f||m)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}xe("SymbolBuffers",S_);class E_{constructor(o,c,f){this.layoutVertexArray=new o,this.layoutAttributes=c,this.indexArray=new f,this.segments=new pi,this.collisionVertexArray=new si}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,x2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}xe("CollisionBuffers",E_);class vh{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(w=>w.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=e_([]),this.placementViewportMatrix=e_([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=X0(this.zoom,c["text-size"]),this.iconSizeData=X0(this.zoom,c["icon-size"]);const f=this.layers[0].layout,m=f.get("symbol-sort-key"),v=f.get("symbol-z-order");this.canOverlap=x_(f,"text-overlap","text-allow-overlap")!=="never"||x_(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!m.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(w=>a.ai[w])),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.sourceID=o.sourceID}createArrays(){this.text=new S_(new Ma(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new S_(new Ma(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new It,this.lineVertexArray=new Ft,this.symbolInstances=new ut,this.textAnchorOffsets=new Wt}calculateGlyphDependencies(o,c,f,m,v){for(let w=0;w<o.length;w++)if(c[o.charCodeAt(w)]=!0,(f||m)&&v){const E=hf[o.charAt(w)];E&&(c[E.charCodeAt(0)]=!0)}}populate(o,c,f){const m=this.layers[0],v=m.layout,w=v.get("text-font"),E=v.get("text-field"),T=v.get("icon-image"),P=(E.value.kind!=="constant"||E.value.value instanceof Yr&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),N=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,z=v.get("symbol-sort-key");if(this.features=[],!P&&!N)return;const V=c.iconDependencies,Z=c.glyphDependencies,H=c.availableImages,tt=new hi(this.zoom);for(const{feature:lt,id:ft,index:Tt,sourceLayerIndex:yt}of o){const Mt=m._featureFilter.needGeometry,zt=hc(lt,Mt);if(!m._featureFilter.filter(tt,zt,f))continue;let Ht,ye;if(Mt||(zt.geometry=cc(lt)),P){const ge=m.getValueAndResolveTokens("text-field",zt,f,H),de=Yr.factory(ge);G2(de)&&(this.hasRTLText=!0),(!this.hasRTLText||jp()==="unavailable"||this.hasRTLText&&Uo.isParsed())&&(Ht=S2(de,m,zt))}if(N){const ge=m.getValueAndResolveTokens("icon-image",zt,f,H);ye=ge instanceof kr?ge:kr.fromString(ge)}if(!Ht&&!ye)continue;const Te=this.sortFeaturesByKey?z.evaluate(zt,{},f):void 0;if(this.features.push({id:ft,text:Ht,icon:ye,index:Tt,sourceLayerIndex:yt,geometry:zt.geometry,properties:lt.properties,type:V2[lt.type],sortKey:Te}),ye&&(V[ye.name]=!0),Ht){const ge=w.evaluate(zt,{},f).join(","),de=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.ai.vertical)>=0;for(const le of Ht.sections)if(le.image)V[le.image.name]=!0;else{const we=Op(Ht.toString()),he=le.fontStack||ge,ie=Z[he]=Z[he]||{};this.calculateGlyphDependencies(le.text,ie,de,this.allowVerticalPlacement,we)}}}v.get("symbol-placement")==="line"&&(this.features=function(lt){const ft={},Tt={},yt=[];let Mt=0;function zt(ge){yt.push(lt[ge]),Mt++}function Ht(ge,de,le){const we=Tt[ge];return delete Tt[ge],Tt[de]=we,yt[we].geometry[0].pop(),yt[we].geometry[0]=yt[we].geometry[0].concat(le[0]),we}function ye(ge,de,le){const we=ft[de];return delete ft[de],ft[ge]=we,yt[we].geometry[0].shift(),yt[we].geometry[0]=le[0].concat(yt[we].geometry[0]),we}function Te(ge,de,le){const we=le?de[0][de[0].length-1]:de[0][0];return`${ge}:${we.x}:${we.y}`}for(let ge=0;ge<lt.length;ge++){const de=lt[ge],le=de.geometry,we=de.text?de.text.toString():null;if(!we){zt(ge);continue}const he=Te(we,le),ie=Te(we,le,!0);if(he in Tt&&ie in ft&&Tt[he]!==ft[ie]){const Re=ye(he,ie,le),Me=Ht(he,ie,yt[Re].geometry);delete ft[he],delete Tt[ie],Tt[Te(we,yt[Me].geometry,!0)]=Me,yt[Re].geometry=null}else he in Tt?Ht(he,ie,le):ie in ft?ye(he,ie,le):(zt(ge),ft[he]=Mt-1,Tt[ie]=Mt-1)}return yt.filter(ge=>ge.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((lt,ft)=>lt.sortKey-ft.sortKey)}update(o,c,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,c,this.layers,f),this.icon.programConfigurations.updatePaintArrays(o,c,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,c){const f=this.lineVertexArray.length;if(o.segment!==void 0){let m=o.dist(c[o.segment+1]),v=o.dist(c[o.segment]);const w={};for(let E=o.segment+1;E<c.length;E++)w[E]={x:c[E].x,y:c[E].y,tileUnitDistanceFromAnchor:m},E<c.length-1&&(m+=c[E+1].dist(c[E]));for(let E=o.segment||0;E>=0;E--)w[E]={x:c[E].x,y:c[E].y,tileUnitDistanceFromAnchor:v},E>0&&(v+=c[E-1].dist(c[E]));for(let E=0;E<c.length;E++){const T=w[E];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(o,c,f,m,v,w,E,T,P,N,z,V){const Z=o.indexArray,H=o.layoutVertexArray,tt=o.segments.prepareSegment(4*c.length,H,Z,this.canOverlap?w.sortKey:void 0),lt=this.glyphOffsetArray.length,ft=tt.vertexLength,Tt=this.allowVerticalPlacement&&E===a.ai.vertical?Math.PI/2:0,yt=w.text&&w.text.sections;for(let Mt=0;Mt<c.length;Mt++){const{tl:zt,tr:Ht,bl:ye,br:Te,tex:ge,pixelOffsetTL:de,pixelOffsetBR:le,minFontScaleX:we,minFontScaleY:he,glyphOffset:ie,isSDF:Re,sectionIndex:Me}=c[Mt],gn=tt.vertexLength,fi=ie[1];ym(H,T.x,T.y,zt.x,fi+zt.y,ge.x,ge.y,f,Re,de.x,de.y,we,he),ym(H,T.x,T.y,Ht.x,fi+Ht.y,ge.x+ge.w,ge.y,f,Re,le.x,de.y,we,he),ym(H,T.x,T.y,ye.x,fi+ye.y,ge.x,ge.y+ge.h,f,Re,de.x,le.y,we,he),ym(H,T.x,T.y,Te.x,fi+Te.y,ge.x+ge.w,ge.y+ge.h,f,Re,le.x,le.y,we,he),w_(o.dynamicLayoutVertexArray,T,Tt),Z.emplaceBack(gn,gn+1,gn+2),Z.emplaceBack(gn+1,gn+2,gn+3),tt.vertexLength+=4,tt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ie[0]),Mt!==c.length-1&&Me===c[Mt+1].sectionIndex||o.programConfigurations.populatePaintArrays(H.length,w,w.index,{},V,yt&&yt[Me])}o.placedSymbolArray.emplaceBack(T.x,T.y,lt,this.glyphOffsetArray.length-lt,ft,P,N,T.segment,f?f[0]:0,f?f[1]:0,m[0],m[1],E,0,!1,0,z)}_addCollisionDebugVertex(o,c,f,m,v,w){return c.emplaceBack(0,0),o.emplaceBack(f.x,f.y,m,v,Math.round(w.x),Math.round(w.y))}addCollisionDebugVertices(o,c,f,m,v,w,E){const T=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),P=T.vertexLength,N=v.layoutVertexArray,z=v.collisionVertexArray,V=E.anchorX,Z=E.anchorY;this._addCollisionDebugVertex(N,z,w,V,Z,new k(o,c)),this._addCollisionDebugVertex(N,z,w,V,Z,new k(f,c)),this._addCollisionDebugVertex(N,z,w,V,Z,new k(f,m)),this._addCollisionDebugVertex(N,z,w,V,Z,new k(o,m)),T.vertexLength+=4;const H=v.indexArray;H.emplaceBack(P,P+1),H.emplaceBack(P+1,P+2),H.emplaceBack(P+2,P+3),H.emplaceBack(P+3,P),T.primitiveLength+=4}addDebugCollisionBoxes(o,c,f,m){for(let v=o;v<c;v++){const w=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(w.x1,w.y1,w.x2,w.y2,m?this.textCollisionBox:this.iconCollisionBox,w.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new E_(ji,A0.members,cr),this.iconCollisionBox=new E_(ji,A0.members,cr);for(let o=0;o<this.symbolInstances.length;o++){const c=this.symbolInstances.get(o);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}}_deserializeCollisionBoxesForSymbol(o,c,f,m,v,w,E,T,P){const N={};for(let z=c;z<f;z++){const V=o.get(z);N.textBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},N.textFeatureIndex=V.featureIndex;break}for(let z=m;z<v;z++){const V=o.get(z);N.verticalTextBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},N.verticalTextFeatureIndex=V.featureIndex;break}for(let z=w;z<E;z++){const V=o.get(z);N.iconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},N.iconFeatureIndex=V.featureIndex;break}for(let z=T;z<P;z++){const V=o.get(z);N.verticalIconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},N.verticalIconFeatureIndex=V.featureIndex;break}return N}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,c){const f=o.placedSymbolArray.get(c),m=f.vertexStartIndex+4*f.numGlyphs;for(let v=f.vertexStartIndex;v<m;v+=4)o.indexArray.emplaceBack(v,v+1,v+2),o.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(o),f=Math.cos(o),m=[],v=[],w=[];for(let E=0;E<this.symbolInstances.length;++E){w.push(E);const T=this.symbolInstances.get(E);m.push(0|Math.round(c*T.anchorX+f*T.anchorY)),v.push(T.featureIndex)}return w.sort((E,T)=>m[E]-m[T]||v[T]-v[E]),w}addToSortKeyRanges(o,c){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===c?f.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const f=this.symbolInstances.get(c);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((m,v,w)=>{m>=0&&w.indexOf(m)===v&&this.addIndicesForPlacedSymbol(this.text,m)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let H0,Y0;xe("SymbolBucket",vh,{omit:["layers","collisionBoxArray","features","compareText"]}),vh.MAX_GLYPHS=65535,vh.addDynamicAttributes=w_;var I_={get paint(){return Y0=Y0||new Ji({"icon-opacity":new Ge(qt.paint_symbol["icon-opacity"]),"icon-color":new Ge(qt.paint_symbol["icon-color"]),"icon-halo-color":new Ge(qt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ge(qt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ge(qt.paint_symbol["icon-halo-blur"]),"icon-translate":new Ae(qt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ae(qt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ge(qt.paint_symbol["text-opacity"]),"text-color":new Ge(qt.paint_symbol["text-color"],{runtimeType:Pr,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new Ge(qt.paint_symbol["text-halo-color"]),"text-halo-width":new Ge(qt.paint_symbol["text-halo-width"]),"text-halo-blur":new Ge(qt.paint_symbol["text-halo-blur"]),"text-translate":new Ae(qt.paint_symbol["text-translate"]),"text-translate-anchor":new Ae(qt.paint_symbol["text-translate-anchor"])})},get layout(){return H0=H0||new Ji({"symbol-placement":new Ae(qt.layout_symbol["symbol-placement"]),"symbol-spacing":new Ae(qt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ae(qt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ge(qt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ae(qt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ae(qt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ae(qt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ae(qt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ae(qt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ae(qt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ge(qt.layout_symbol["icon-size"]),"icon-text-fit":new Ae(qt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ae(qt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ge(qt.layout_symbol["icon-image"]),"icon-rotate":new Ge(qt.layout_symbol["icon-rotate"]),"icon-padding":new Ge(qt.layout_symbol["icon-padding"]),"icon-keep-upright":new Ae(qt.layout_symbol["icon-keep-upright"]),"icon-offset":new Ge(qt.layout_symbol["icon-offset"]),"icon-anchor":new Ge(qt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ae(qt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ae(qt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ae(qt.layout_symbol["text-rotation-alignment"]),"text-field":new Ge(qt.layout_symbol["text-field"]),"text-font":new Ge(qt.layout_symbol["text-font"]),"text-size":new Ge(qt.layout_symbol["text-size"]),"text-max-width":new Ge(qt.layout_symbol["text-max-width"]),"text-line-height":new Ae(qt.layout_symbol["text-line-height"]),"text-letter-spacing":new Ge(qt.layout_symbol["text-letter-spacing"]),"text-justify":new Ge(qt.layout_symbol["text-justify"]),"text-radial-offset":new Ge(qt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ae(qt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ge(qt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ge(qt.layout_symbol["text-anchor"]),"text-max-angle":new Ae(qt.layout_symbol["text-max-angle"]),"text-writing-mode":new Ae(qt.layout_symbol["text-writing-mode"]),"text-rotate":new Ge(qt.layout_symbol["text-rotate"]),"text-padding":new Ae(qt.layout_symbol["text-padding"]),"text-keep-upright":new Ae(qt.layout_symbol["text-keep-upright"]),"text-transform":new Ge(qt.layout_symbol["text-transform"]),"text-offset":new Ge(qt.layout_symbol["text-offset"]),"text-allow-overlap":new Ae(qt.layout_symbol["text-allow-overlap"]),"text-overlap":new Ae(qt.layout_symbol["text-overlap"]),"text-ignore-placement":new Ae(qt.layout_symbol["text-ignore-placement"]),"text-optional":new Ae(qt.layout_symbol["text-optional"])})}};class K0{constructor(o){if(o.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=o.property.overrides?o.property.overrides.runtimeType:Ss,this.defaultValue=o}evaluate(o){if(o.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(o.formattedSection))return c.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}xe("FormatSectionOverride",K0,{omit:["defaultValue"]});class vm extends us{constructor(o){super(o,I_)}recalculate(o,c){if(super.recalculate(o,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const m=[];for(const v of f)m.indexOf(v)<0&&m.push(v);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(o,c,f,m){const v=this.layout.get(o).evaluate(c,{},f,m),w=this._unevaluatedLayout._values[o];return w.isDataDriven()||$c(w.value)||!v?v:function(E,T){return T.replace(/{([^{}]+)}/g,(P,N)=>E&&N in E?String(E[N]):"")}(c.properties,v)}createBucket(o){return new vh(o)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const o of I_.paint.overridableProperties){if(!vm.hasPaintOverride(this.layout,o))continue;const c=this.paint.get(o),f=new K0(c),m=new Pp(f,c.property.specification);let v=null;v=c.value.kind==="constant"||c.value.kind==="source"?new Ap("source",m):new eh("composite",m,c.value.zoomStops),this.paint._values[o]=new co(c.property,v,c.parameters)}}_handleOverridablePaintPropertyUpdate(o,c,f){return!(!this.layout||c.isDataDriven()||f.isDataDriven())&&vm.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,c){const f=o.get("text-field"),m=I_.paint.properties[c];let v=!1;const w=E=>{for(const T of E)if(m.overrides&&m.overrides.hasOverride(T))return void(v=!0)};if(f.value.kind==="constant"&&f.value.value instanceof Yr)w(f.value.value.sections);else if(f.value.kind==="source"){const E=P=>{v||(P instanceof wl&&wi(P.value)===st?w(P.value.sections):P instanceof Qc?w(P.sections):P.eachChild(E))},T=f.value;T._styleExpression&&E(T._styleExpression.expression)}return v}}let J0;var q2={get paint(){return J0=J0||new Ji({"background-color":new Ae(qt.paint_background["background-color"]),"background-pattern":new Wp(qt.paint_background["background-pattern"]),"background-opacity":new Ae(qt.paint_background["background-opacity"])})}};class j2 extends us{constructor(o){super(o,q2)}}let Q0;var Z2={get paint(){return Q0=Q0||new Ji({"raster-opacity":new Ae(qt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ae(qt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ae(qt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ae(qt.paint_raster["raster-brightness-max"]),"raster-saturation":new Ae(qt.paint_raster["raster-saturation"]),"raster-contrast":new Ae(qt.paint_raster["raster-contrast"]),"raster-resampling":new Ae(qt.paint_raster["raster-resampling"]),"raster-fade-duration":new Ae(qt.paint_raster["raster-fade-duration"])})}};class W2 extends us{constructor(o){super(o,Z2)}}class X2 extends us{constructor(o){super(o,{}),this.onAdd=c=>{this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},this.onRemove=c=>{this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},this.implementation=o}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class H2{constructor(o){this._callback=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const C_=63710088e-1;class xu{constructor(o,c){if(isNaN(o)||isNaN(c))throw new Error(`Invalid LngLat object: (${o}, ${c})`);if(this.lng=+o,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new xu(ct(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const c=Math.PI/180,f=this.lat*c,m=o.lat*c,v=Math.sin(f)*Math.sin(m)+Math.cos(f)*Math.cos(m)*Math.cos((o.lng-this.lng)*c);return C_*Math.acos(Math.min(v,1))}static convert(o){if(o instanceof xu)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new xu(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new xu(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const $0=2*Math.PI*C_;function tv(l){return $0*Math.cos(l*Math.PI/180)}function ev(l){return(180+l)/360}function nv(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function iv(l,o){return l/tv(o)}function rv(l){return 360*l-180}function T_(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}class bm{constructor(o,c,f=0){this.x=+o,this.y=+c,this.z=+f}static fromLngLat(o,c=0){const f=xu.convert(o);return new bm(ev(f.lng),nv(f.lat),iv(c,f.lat))}toLngLat(){return new xu(rv(this.x),T_(this.y))}toAltitude(){return this.z*tv(T_(this.y))}meterInMercatorCoordinateUnits(){return 1/$0*(o=T_(this.y),1/Math.cos(o*Math.PI/180));var o}}function ov(l,o,c){var f=2*Math.PI*6378137/256/Math.pow(2,c);return[l*f-2*Math.PI*6378137/2,o*f-2*Math.PI*6378137/2]}class L_{constructor(o,c,f){if(o<0||o>25||f<0||f>=Math.pow(2,o)||c<0||c>=Math.pow(2,o))throw new Error(`x=${c}, y=${f}, z=${o} outside of bounds. 0<=x<${Math.pow(2,o)}, 0<=y<${Math.pow(2,o)} 0<=z<=25 `);this.z=o,this.x=c,this.y=f,this.key=mf(0,o,o,c,f)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,c,f){const m=(w=this.y,E=this.z,T=ov(256*(v=this.x),256*(w=Math.pow(2,E)-w-1),E),P=ov(256*(v+1),256*(w+1),E),T[0]+","+T[1]+","+P[0]+","+P[1]);var v,w,E,T,P;const N=function(z,V,Z){let H,tt="";for(let lt=z;lt>0;lt--)H=1<<lt-1,tt+=(V&H?1:0)+(Z&H?2:0);return tt}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,c>1?"@2x":"").replace(/{quadkey}/g,N).replace(/{bbox-epsg-3857}/g,m)}isChildOf(o){const c=this.z-o.z;return c>0&&o.x===this.x>>c&&o.y===this.y>>c}getTilePoint(o){const c=Math.pow(2,this.z);return new k((o.x*c-this.x)*ar,(o.y*c-this.y)*ar)}toString(){return`${this.z}/${this.x}/${this.y}`}}class sv{constructor(o,c){this.wrap=o,this.canonical=c,this.key=mf(o,c.z,c.z,c.x,c.y)}}class Cs{constructor(o,c,f,m,v){if(o<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${o}; z = ${f}`);this.overscaledZ=o,this.wrap=c,this.canonical=new L_(f,+m,+v),this.key=mf(c,o,f,m,v)}clone(){return new Cs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-o;return o>this.canonical.z?new Cs(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Cs(o,this.wrap,o,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(o,c){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-o;return o>this.canonical.z?mf(this.wrap*+c,o,this.canonical.z,this.canonical.x,this.canonical.y):mf(this.wrap*+c,o,o,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(o){if(o.wrap!==this.wrap)return!1;const c=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>c&&o.canonical.y===this.canonical.y>>c}children(o){if(this.overscaledZ>=o)return[new Cs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,f=2*this.canonical.x,m=2*this.canonical.y;return[new Cs(c,this.wrap,c,f,m),new Cs(c,this.wrap,c,f+1,m),new Cs(c,this.wrap,c,f,m+1),new Cs(c,this.wrap,c,f+1,m+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new Cs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new Cs(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new sv(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(o){return this.canonical.getTilePoint(new bm(o.x-this.wrap,o.y))}}function mf(l,o,c,f,m){(l*=2)<0&&(l=-1*l-1);const v=1<<c;return(v*v*l+v*m+f).toString(36)+c.toString(36)+o.toString(36)}xe("CanonicalTileID",L_),xe("OverscaledTileID",Cs,{omit:["posMatrix"]});class av{constructor(o,c,f,m=1,v=1,w=1,E=0){if(this.uid=o,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void kt(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=c.height;const T=this.dim=c.height-2;switch(this.data=new Uint32Array(c.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=m,this.greenFactor=v,this.blueFactor=w,this.baseShift=E;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let P=0;P<T;P++)this.data[this._idx(-1,P)]=this.data[this._idx(0,P)],this.data[this._idx(T,P)]=this.data[this._idx(T-1,P)],this.data[this._idx(P,-1)]=this.data[this._idx(P,0)],this.data[this._idx(P,T)]=this.data[this._idx(P,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let P=0;P<T;P++)for(let N=0;N<T;N++){const z=this.get(P,N);z>this.max&&(this.max=z),z<this.min&&(this.min=z)}}get(o,c){const f=new Uint8Array(this.data.buffer),m=4*this._idx(o,c);return this.unpack(f[m],f[m+1],f[m+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(o,c){if(o<-1||o>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(o+1)}unpack(o,c,f){return o*this.redFactor+c*this.greenFactor+f*this.blueFactor-this.baseShift}getPixels(){return new Is({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(o,c,f){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let m=c*this.dim,v=c*this.dim+this.dim,w=f*this.dim,E=f*this.dim+this.dim;switch(c){case-1:m=v-1;break;case 1:v=m+1}switch(f){case-1:w=E-1;break;case 1:E=w+1}const T=-c*this.dim,P=-f*this.dim;for(let N=w;N<E;N++)for(let z=m;z<v;z++)this.data[this._idx(z,N)]=o.data[this._idx(z+T,N+P)]}}xe("DEMData",av);class lv{constructor(o){this._stringToNumber={},this._numberToString=[];for(let c=0;c<o.length;c++){const f=o[c];this._stringToNumber[f]=c,this._numberToString[c]=f}}encode(o){return this._stringToNumber[o]}decode(o){if(o>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${o} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[o]}}class uv{constructor(o,c,f,m,v){this.type="Feature",this._vectorTileFeature=o,o._z=c,o._x=f,o._y=m,this.properties=o.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={geometry:this.geometry};for(const c in this)c!=="_geometry"&&c!=="_vectorTileFeature"&&(o[c]=this[c]);return o}}class cv{constructor(o,c){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new fu(ar,16,0),this.grid3D=new fu(ar,16,0),this.featureIndexArray=new Yt,this.promoteId=c}insert(o,c,f,m,v,w){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,m,v);const T=w?this.grid3D:this.grid;for(let P=0;P<c.length;P++){const N=c[P],z=[1/0,1/0,-1/0,-1/0];for(let V=0;V<N.length;V++){const Z=N[V];z[0]=Math.min(z[0],Z.x),z[1]=Math.min(z[1],Z.y),z[2]=Math.max(z[2],Z.x),z[3]=Math.max(z[3],Z.y)}z[0]<ar&&z[1]<ar&&z[2]>=0&&z[3]>=0&&T.insert(E,z[0],z[1],z[2],z[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new yu.VectorTile(new g_(this.rawTileData)).layers,this.sourceLayerCoder=new lv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(o,c,f,m){this.loadVTLayers();const v=o.params||{},w=ar/o.tileSize/o.scale,E=Np(v.filter),T=o.queryGeometry,P=o.queryPadding*w,N=pv(T),z=this.grid.query(N.minX-P,N.minY-P,N.maxX+P,N.maxY+P),V=pv(o.cameraQueryGeometry),Z=this.grid3D.query(V.minX-P,V.minY-P,V.maxX+P,V.maxY+P,(lt,ft,Tt,yt)=>function(Mt,zt,Ht,ye,Te){for(const de of Mt)if(zt<=de.x&&Ht<=de.y&&ye>=de.x&&Te>=de.y)return!0;const ge=[new k(zt,Ht),new k(zt,Te),new k(ye,Te),new k(ye,Ht)];if(Mt.length>2){for(const de of ge)if(ph(Mt,de))return!0}for(let de=0;de<Mt.length-1;de++)if(Cw(Mt[de],Mt[de+1],ge))return!0;return!1}(o.cameraQueryGeometry,lt-P,ft-P,Tt+P,yt+P));for(const lt of Z)z.push(lt);z.sort(Y2);const H={};let tt;for(let lt=0;lt<z.length;lt++){const ft=z[lt];if(ft===tt)continue;tt=ft;const Tt=this.featureIndexArray.get(ft);let yt=null;this.loadMatchingFeature(H,Tt.bucketIndex,Tt.sourceLayerIndex,Tt.featureIndex,E,v.layers,v.availableImages,c,f,m,(Mt,zt,Ht)=>(yt||(yt=cc(Mt)),zt.queryIntersectsFeature(T,Mt,Ht,yt,this.z,o.transform,w,o.pixelPosMatrix)))}return H}loadMatchingFeature(o,c,f,m,v,w,E,T,P,N,z){const V=this.bucketLayerIDs[c];if(w&&!function(lt,ft){for(let Tt=0;Tt<lt.length;Tt++)if(ft.indexOf(lt[Tt])>=0)return!0;return!1}(w,V))return;const Z=this.sourceLayerCoder.decode(f),H=this.vtLayers[Z].feature(m);if(v.needGeometry){const lt=hc(H,!0);if(!v.filter(new hi(this.tileID.overscaledZ),lt,this.tileID.canonical))return}else if(!v.filter(new hi(this.tileID.overscaledZ),H))return;const tt=this.getId(H,Z);for(let lt=0;lt<V.length;lt++){const ft=V[lt];if(w&&w.indexOf(ft)<0)continue;const Tt=T[ft];if(!Tt)continue;let yt={};tt&&N&&(yt=N.getState(Tt.sourceLayer||"_geojsonTileLayer",tt));const Mt=ht({},P[ft]);Mt.paint=hv(Mt.paint,Tt.paint,H,yt,E),Mt.layout=hv(Mt.layout,Tt.layout,H,yt,E);const zt=!z||z(H,Tt,yt);if(!zt)continue;const Ht=new uv(H,this.z,this.x,this.y,tt);Ht.layer=Mt;let ye=o[ft];ye===void 0&&(ye=o[ft]=[]),ye.push({featureIndex:m,feature:Ht,intersectionZ:zt})}}lookupSymbolFeatures(o,c,f,m,v,w,E,T){const P={};this.loadVTLayers();const N=Np(v);for(const z of o)this.loadMatchingFeature(P,f,m,z,N,w,E,T,c);return P}hasLayer(o){for(const c of this.bucketLayerIDs)for(const f of c)if(o===f)return!0;return!1}getId(o,c){let f=o.id;return this.promoteId&&(f=o.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]],typeof f=="boolean"&&(f=Number(f))),f}}function hv(l,o,c,f,m){return Et(l,(v,w)=>{const E=o instanceof ch?o.get(w):null;return E&&E.evaluate?E.evaluate(c,f,m):E})}function pv(l){let o=1/0,c=1/0,f=-1/0,m=-1/0;for(const v of l)o=Math.min(o,v.x),c=Math.min(c,v.y),f=Math.max(f,v.x),m=Math.max(m,v.y);return{minX:o,minY:c,maxX:f,maxY:m}}function Y2(l,o){return o-l}function fv(l,o,c,f,m){const v=[];for(let w=0;w<l.length;w++){const E=l[w];let T;for(let P=0;P<E.length-1;P++){let N=E[P],z=E[P+1];N.x<o&&z.x<o||(N.x<o?N=new k(o,N.y+(o-N.x)/(z.x-N.x)*(z.y-N.y))._round():z.x<o&&(z=new k(o,N.y+(o-N.x)/(z.x-N.x)*(z.y-N.y))._round()),N.y<c&&z.y<c||(N.y<c?N=new k(N.x+(c-N.y)/(z.y-N.y)*(z.x-N.x),c)._round():z.y<c&&(z=new k(N.x+(c-N.y)/(z.y-N.y)*(z.x-N.x),c)._round()),N.x>=f&&z.x>=f||(N.x>=f?N=new k(f,N.y+(f-N.x)/(z.x-N.x)*(z.y-N.y))._round():z.x>=f&&(z=new k(f,N.y+(f-N.x)/(z.x-N.x)*(z.y-N.y))._round()),N.y>=m&&z.y>=m||(N.y>=m?N=new k(N.x+(m-N.y)/(z.y-N.y)*(z.x-N.x),m)._round():z.y>=m&&(z=new k(N.x+(m-N.y)/(z.y-N.y)*(z.x-N.x),m)._round()),T&&N.equals(T[T.length-1])||(T=[N],v.push(T)),T.push(z)))))}}return v}xe("FeatureIndex",cv,{omit:["rawTileData","sourceLayerCoder"]});class wu extends k{constructor(o,c,f,m){super(o,c),this.angle=f,m!==void 0&&(this.segment=m)}clone(){return new wu(this.x,this.y,this.angle,this.segment)}}function dv(l,o,c,f,m){if(o.segment===void 0||c===0)return!0;let v=o,w=o.segment+1,E=0;for(;E>-c/2;){if(w--,w<0)return!1;E-=l[w].dist(v),v=l[w]}E+=l[w].dist(l[w+1]),w++;const T=[];let P=0;for(;E<c/2;){const N=l[w],z=l[w+1];if(!z)return!1;let V=l[w-1].angleTo(N)-N.angleTo(z);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:E,angleDelta:V}),P+=V;E-T[0].distance>f;)P-=T.shift().angleDelta;if(P>m)return!1;w++,E+=N.dist(z)}return!0}function mv(l){let o=0;for(let c=0;c<l.length-1;c++)o+=l[c].dist(l[c+1]);return o}function gv(l,o,c){return l?.6*o*c:0}function _v(l,o){return Math.max(l?l.right-l.left:0,o?o.right-o.left:0)}function K2(l,o,c,f,m,v){const w=gv(c,m,v),E=_v(c,f)*v;let T=0;const P=mv(l)/2;for(let N=0;N<l.length-1;N++){const z=l[N],V=l[N+1],Z=z.dist(V);if(T+Z>P){const H=(P-T)/Z,tt=Fo.number(z.x,V.x,H),lt=Fo.number(z.y,V.y,H),ft=new wu(tt,lt,V.angleTo(z),N);return ft._round(),!w||dv(l,ft,E,w,o)?ft:void 0}T+=Z}}function J2(l,o,c,f,m,v,w,E,T){const P=gv(f,v,w),N=_v(f,m),z=N*w,V=l[0].x===0||l[0].x===T||l[0].y===0||l[0].y===T;return o-z<o/4&&(o=z+o/4),yv(l,V?o/2*E%o:(N/2+2*v)*w*E%o,o,P,c,z,V,!1,T)}function yv(l,o,c,f,m,v,w,E,T){const P=v/2,N=mv(l);let z=0,V=o-c,Z=[];for(let H=0;H<l.length-1;H++){const tt=l[H],lt=l[H+1],ft=tt.dist(lt),Tt=lt.angleTo(tt);for(;V+c<z+ft;){V+=c;const yt=(V-z)/ft,Mt=Fo.number(tt.x,lt.x,yt),zt=Fo.number(tt.y,lt.y,yt);if(Mt>=0&&Mt<T&&zt>=0&&zt<T&&V-P>=0&&V+P<=N){const Ht=new wu(Mt,zt,Tt,H);Ht._round(),f&&!dv(l,Ht,v,f,m)||Z.push(Ht)}}z+=ft}return E||Z.length||w||(Z=yv(l,z/2,c,f,m,v,w,!0,T)),Z}xe("Anchor",wu);const bh=qo;function vv(l,o,c,f){const m=[],v=l.image,w=v.pixelRatio,E=v.paddedRect.w-2*bh,T=v.paddedRect.h-2*bh,P=l.right-l.left,N=l.bottom-l.top,z=v.stretchX||[[0,E]],V=v.stretchY||[[0,T]],Z=(le,we)=>le+we[1]-we[0],H=z.reduce(Z,0),tt=V.reduce(Z,0),lt=E-H,ft=T-tt;let Tt=0,yt=H,Mt=0,zt=tt,Ht=0,ye=lt,Te=0,ge=ft;if(v.content&&f){const le=v.content;Tt=xm(z,0,le[0]),Mt=xm(V,0,le[1]),yt=xm(z,le[0],le[2]),zt=xm(V,le[1],le[3]),Ht=le[0]-Tt,Te=le[1]-Mt,ye=le[2]-le[0]-yt,ge=le[3]-le[1]-zt}const de=(le,we,he,ie)=>{const Re=wm(le.stretch-Tt,yt,P,l.left),Me=Sm(le.fixed-Ht,ye,le.stretch,H),gn=wm(we.stretch-Mt,zt,N,l.top),fi=Sm(we.fixed-Te,ge,we.stretch,tt),yi=wm(he.stretch-Tt,yt,P,l.left),fr=Sm(he.fixed-Ht,ye,he.stretch,H),hs=wm(ie.stretch-Mt,zt,N,l.top),To=Sm(ie.fixed-Te,ge,ie.stretch,tt),lr=new k(Re,gn),Rr=new k(yi,gn),Qr=new k(yi,hs),Lo=new k(Re,hs),Mo=new k(Me/w,fi/w),dr=new k(fr/w,To/w),mr=o*Math.PI/180;if(mr){const fo=Math.sin(mr),jo=Math.cos(mr),Zo=[jo,-fo,fo,jo];lr._matMult(Zo),Rr._matMult(Zo),Lo._matMult(Zo),Qr._matMult(Zo)}const po=le.stretch+le.fixed,Po=we.stretch+we.fixed;return{tl:lr,tr:Rr,bl:Lo,br:Qr,tex:{x:v.paddedRect.x+bh+po,y:v.paddedRect.y+bh+Po,w:he.stretch+he.fixed-po,h:ie.stretch+ie.fixed-Po},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Mo,pixelOffsetBR:dr,minFontScaleX:ye/w/P,minFontScaleY:ge/w/N,isSDF:c}};if(f&&(v.stretchX||v.stretchY)){const le=bv(z,lt,H),we=bv(V,ft,tt);for(let he=0;he<le.length-1;he++){const ie=le[he],Re=le[he+1];for(let Me=0;Me<we.length-1;Me++)m.push(de(ie,we[Me],Re,we[Me+1]))}}else m.push(de({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:T+1}));return m}function xm(l,o,c){let f=0;for(const m of l)f+=Math.max(o,Math.min(c,m[1]))-Math.max(o,Math.min(c,m[0]));return f}function bv(l,o,c){const f=[{fixed:-bh,stretch:0}];for(const[m,v]of l){const w=f[f.length-1];f.push({fixed:m-w.stretch,stretch:w.stretch}),f.push({fixed:m-w.stretch,stretch:w.stretch+(v-m)})}return f.push({fixed:o+bh,stretch:c}),f}function wm(l,o,c,f){return l/o*c+f}function Sm(l,o,c,f){return l-o*c/f}class Em{constructor(o,c,f,m,v,w,E,T,P,N){if(this.boxStartIndex=o.length,P){let z=w.top,V=w.bottom;const Z=w.collisionPadding;Z&&(z-=Z[1],V+=Z[3]);let H=V-z;H>0&&(H=Math.max(10,H),this.circleDiameter=H)}else{let z=w.top*E-T[0],V=w.bottom*E+T[2],Z=w.left*E-T[3],H=w.right*E+T[1];const tt=w.collisionPadding;if(tt&&(Z-=tt[0]*E,z-=tt[1]*E,H+=tt[2]*E,V+=tt[3]*E),N){const lt=new k(Z,z),ft=new k(H,z),Tt=new k(Z,V),yt=new k(H,V),Mt=N*Math.PI/180;lt._rotate(Mt),ft._rotate(Mt),Tt._rotate(Mt),yt._rotate(Mt),Z=Math.min(lt.x,ft.x,Tt.x,yt.x),H=Math.max(lt.x,ft.x,Tt.x,yt.x),z=Math.min(lt.y,ft.y,Tt.y,yt.y),V=Math.max(lt.y,ft.y,Tt.y,yt.y)}o.emplaceBack(c.x,c.y,Z,z,H,V,f,m,v)}this.boxEndIndex=o.length}}class Q2{constructor(o=[],c=$2){if(this.data=o,this.length=this.data.length,this.compare=c,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const o=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:c,compare:f}=this,m=c[o];for(;o>0;){const v=o-1>>1,w=c[v];if(f(m,w)>=0)break;c[o]=w,o=v}c[o]=m}_down(o){const{data:c,compare:f}=this,m=this.length>>1,v=c[o];for(;o<m;){let w=1+(o<<1),E=c[w];const T=w+1;if(T<this.length&&f(c[T],E)<0&&(w=T,E=c[T]),f(E,v)>=0)break;c[o]=E,o=w}c[o]=v}}function $2(l,o){return l<o?-1:l>o?1:0}function tS(l,o=1,c=!1){let f=1/0,m=1/0,v=-1/0,w=-1/0;const E=l[0];for(let Z=0;Z<E.length;Z++){const H=E[Z];(!Z||H.x<f)&&(f=H.x),(!Z||H.y<m)&&(m=H.y),(!Z||H.x>v)&&(v=H.x),(!Z||H.y>w)&&(w=H.y)}const T=Math.min(v-f,w-m);let P=T/2;const N=new Q2([],eS);if(T===0)return new k(f,m);for(let Z=f;Z<v;Z+=T)for(let H=m;H<w;H+=T)N.push(new xh(Z+P,H+P,P,l));let z=function(Z){let H=0,tt=0,lt=0;const ft=Z[0];for(let Tt=0,yt=ft.length,Mt=yt-1;Tt<yt;Mt=Tt++){const zt=ft[Tt],Ht=ft[Mt],ye=zt.x*Ht.y-Ht.x*zt.y;tt+=(zt.x+Ht.x)*ye,lt+=(zt.y+Ht.y)*ye,H+=3*ye}return new xh(tt/H,lt/H,0,Z)}(l),V=N.length;for(;N.length;){const Z=N.pop();(Z.d>z.d||!z.d)&&(z=Z,c&&console.log("found best %d after %d probes",Math.round(1e4*Z.d)/1e4,V)),Z.max-z.d<=o||(P=Z.h/2,N.push(new xh(Z.p.x-P,Z.p.y-P,P,l)),N.push(new xh(Z.p.x+P,Z.p.y-P,P,l)),N.push(new xh(Z.p.x-P,Z.p.y+P,P,l)),N.push(new xh(Z.p.x+P,Z.p.y+P,P,l)),V+=4)}return c&&(console.log(`num probes: ${V}`),console.log(`best distance: ${z.d}`)),z.p}function eS(l,o){return o.max-l.max}function xh(l,o,c,f){this.p=new k(l,o),this.h=c,this.d=function(m,v){let w=!1,E=1/0;for(let T=0;T<v.length;T++){const P=v[T];for(let N=0,z=P.length,V=z-1;N<z;V=N++){const Z=P[N],H=P[V];Z.y>m.y!=H.y>m.y&&m.x<(H.x-Z.x)*(m.y-Z.y)/(H.y-Z.y)+Z.x&&(w=!w),E=Math.min(E,n0(m,Z,H))}}return(w?1:-1)*Math.sqrt(E)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var Jr;a.aq=void 0,(Jr=a.aq||(a.aq={}))[Jr.center=1]="center",Jr[Jr.left=2]="left",Jr[Jr.right=3]="right",Jr[Jr.top=4]="top",Jr[Jr.bottom=5]="bottom",Jr[Jr["top-left"]=6]="top-left",Jr[Jr["top-right"]=7]="top-right",Jr[Jr["bottom-left"]=8]="bottom-left",Jr[Jr["bottom-right"]=9]="bottom-right";const Su=7,M_=Number.POSITIVE_INFINITY;function xv(l,o){return o[1]!==M_?function(c,f,m){let v=0,w=0;switch(f=Math.abs(f),m=Math.abs(m),c){case"top-right":case"top-left":case"top":w=m-Su;break;case"bottom-right":case"bottom-left":case"bottom":w=-m+Su}switch(c){case"top-right":case"bottom-right":case"right":v=-f;break;case"top-left":case"bottom-left":case"left":v=f}return[v,w]}(l,o[0],o[1]):function(c,f){let m=0,v=0;f<0&&(f=0);const w=f/Math.SQRT2;switch(c){case"top-right":case"top-left":v=w-Su;break;case"bottom-right":case"bottom-left":v=-w+Su;break;case"bottom":v=-f+Su;break;case"top":v=f-Su}switch(c){case"top-right":case"bottom-right":m=-w;break;case"top-left":case"bottom-left":m=w;break;case"left":m=f;break;case"right":m=-f}return[m,v]}(l,o[0])}function wv(l,o,c){var f;const m=l.layout,v=(f=m.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(o,{},c);if(v){const E=v.values,T=[];for(let P=0;P<E.length;P+=2){const N=T[P]=E[P],z=E[P+1].map(V=>V*pr);N.startsWith("top")?z[1]-=Su:N.startsWith("bottom")&&(z[1]+=Su),T[P+1]=z}return new os(T)}const w=m.get("text-variable-anchor");if(w){let E;E=l._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[m.get("text-radial-offset").evaluate(o,{},c)*pr,M_]:m.get("text-offset").evaluate(o,{},c).map(P=>P*pr);const T=[];for(const P of w)T.push(P,xv(P,E));return new os(T)}return null}function P_(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function nS(l,o,c,f,m,v,w,E,T,P,N){let z=v.textMaxSize.evaluate(o,{});z===void 0&&(z=w);const V=l.layers[0].layout,Z=V.get("icon-offset").evaluate(o,{},N),H=Ev(c.horizontal),tt=w/24,lt=l.tilePixelRatio*tt,ft=l.tilePixelRatio*z/24,Tt=l.tilePixelRatio*E,yt=l.tilePixelRatio*V.get("symbol-spacing"),Mt=V.get("text-padding")*l.tilePixelRatio,zt=function(ie,Re,Me,gn=1){const fi=ie.get("icon-padding").evaluate(Re,{},Me),yi=fi&&fi.values;return[yi[0]*gn,yi[1]*gn,yi[2]*gn,yi[3]*gn]}(V,o,N,l.tilePixelRatio),Ht=V.get("text-max-angle")/180*Math.PI,ye=V.get("text-rotation-alignment")!=="viewport"&&V.get("symbol-placement")!=="point",Te=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",ge=V.get("symbol-placement"),de=yt/2,le=V.get("icon-text-fit");let we;f&&le!=="none"&&(l.allowVerticalPlacement&&c.vertical&&(we=W0(f,c.vertical,le,V.get("icon-text-fit-padding"),Z,tt)),H&&(f=W0(f,H,le,V.get("icon-text-fit-padding"),Z,tt)));const he=(ie,Re)=>{Re.x<0||Re.x>=ar||Re.y<0||Re.y>=ar||function(Me,gn,fi,yi,fr,hs,To,lr,Rr,Qr,Lo,Mo,dr,mr,po,Po,fo,jo,Zo,gr,Sn,mo,$r,_r,Ks){const Pa=Me.addToLineVertexArray(gn,fi);let Aa,Rl,Js,Ts,Wo=0,Ol=0,yf=0,Lv=0,F_=-1,B_=-1;const zl={};let Mv=Al("");if(Me.allowVerticalPlacement&&yi.vertical){const go=lr.layout.get("text-rotate").evaluate(Sn,{},_r)+90;Js=new Em(Rr,gn,Qr,Lo,Mo,yi.vertical,dr,mr,po,go),To&&(Ts=new Em(Rr,gn,Qr,Lo,Mo,To,fo,jo,po,go))}if(fr){const go=lr.layout.get("icon-rotate").evaluate(Sn,{}),Ls=lr.layout.get("icon-text-fit")!=="none",fc=vv(fr,go,$r,Ls),Na=To?vv(To,go,$r,Ls):void 0;Rl=new Em(Rr,gn,Qr,Lo,Mo,fr,fo,jo,!1,go),Wo=4*fc.length;const dc=Me.iconSizeData;let nl=null;dc.kind==="source"?(nl=[el*lr.layout.get("icon-size").evaluate(Sn,{})],nl[0]>bu&&kt(`${Me.layerIds[0]}: Value for "icon-size" is >= ${df}. Reduce your "icon-size".`)):dc.kind==="composite"&&(nl=[el*mo.compositeIconSizes[0].evaluate(Sn,{},_r),el*mo.compositeIconSizes[1].evaluate(Sn,{},_r)],(nl[0]>bu||nl[1]>bu)&&kt(`${Me.layerIds[0]}: Value for "icon-size" is >= ${df}. Reduce your "icon-size".`)),Me.addSymbols(Me.icon,fc,nl,gr,Zo,Sn,a.ai.none,gn,Pa.lineStartIndex,Pa.lineLength,-1,_r),F_=Me.icon.placedSymbolArray.length-1,Na&&(Ol=4*Na.length,Me.addSymbols(Me.icon,Na,nl,gr,Zo,Sn,a.ai.vertical,gn,Pa.lineStartIndex,Pa.lineLength,-1,_r),B_=Me.icon.placedSymbolArray.length-1)}const Pv=Object.keys(yi.horizontal);for(const go of Pv){const Ls=yi.horizontal[go];if(!Aa){Mv=Al(Ls.text);const Na=lr.layout.get("text-rotate").evaluate(Sn,{},_r);Aa=new Em(Rr,gn,Qr,Lo,Mo,Ls,dr,mr,po,Na)}const fc=Ls.positionedLines.length===1;if(yf+=Sv(Me,gn,Ls,hs,lr,po,Sn,Po,Pa,yi.vertical?a.ai.horizontal:a.ai.horizontalOnly,fc?Pv:[go],zl,F_,mo,_r),fc)break}yi.vertical&&(Lv+=Sv(Me,gn,yi.vertical,hs,lr,po,Sn,Po,Pa,a.ai.vertical,["vertical"],zl,B_,mo,_r));const oS=Aa?Aa.boxStartIndex:Me.collisionBoxArray.length,sS=Aa?Aa.boxEndIndex:Me.collisionBoxArray.length,aS=Js?Js.boxStartIndex:Me.collisionBoxArray.length,lS=Js?Js.boxEndIndex:Me.collisionBoxArray.length,uS=Rl?Rl.boxStartIndex:Me.collisionBoxArray.length,cS=Rl?Rl.boxEndIndex:Me.collisionBoxArray.length,hS=Ts?Ts.boxStartIndex:Me.collisionBoxArray.length,pS=Ts?Ts.boxEndIndex:Me.collisionBoxArray.length;let ka=-1;const Cm=(go,Ls)=>go&&go.circleDiameter?Math.max(go.circleDiameter,Ls):Ls;ka=Cm(Aa,ka),ka=Cm(Js,ka),ka=Cm(Rl,ka),ka=Cm(Ts,ka);const Av=ka>-1?1:0;Av&&(ka*=Ks/pr),Me.glyphOffsetArray.length>=vh.MAX_GLYPHS&&kt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Sn.sortKey!==void 0&&Me.addToSortKeyRanges(Me.symbolInstances.length,Sn.sortKey);const fS=wv(lr,Sn,_r),[dS,mS]=function(go,Ls){const fc=go.length,Na=Ls==null?void 0:Ls.values;if((Na==null?void 0:Na.length)>0)for(let dc=0;dc<Na.length;dc+=2){const nl=Na[dc+1];go.emplaceBack(a.aq[Na[dc]],nl[0],nl[1])}return[fc,go.length]}(Me.textAnchorOffsets,fS);Me.symbolInstances.emplaceBack(gn.x,gn.y,zl.right>=0?zl.right:-1,zl.center>=0?zl.center:-1,zl.left>=0?zl.left:-1,zl.vertical||-1,F_,B_,Mv,oS,sS,aS,lS,uS,cS,hS,pS,Qr,yf,Lv,Wo,Ol,Av,0,dr,ka,dS,mS)}(l,Re,ie,c,f,m,we,l.layers[0],l.collisionBoxArray,o.index,o.sourceLayerIndex,l.index,lt,[Mt,Mt,Mt,Mt],ye,T,Tt,zt,Te,Z,o,v,P,N,w)};if(ge==="line")for(const ie of fv(o.geometry,0,0,ar,ar)){const Re=J2(ie,yt,Ht,c.vertical||H,f,24,ft,l.overscaling,ar);for(const Me of Re)H&&iS(l,H.text,de,Me)||he(ie,Me)}else if(ge==="line-center"){for(const ie of o.geometry)if(ie.length>1){const Re=K2(ie,Ht,c.vertical||H,f,24,ft);Re&&he(ie,Re)}}else if(o.type==="Polygon")for(const ie of l_(o.geometry,0)){const Re=tS(ie,16);he(ie[0],new wu(Re.x,Re.y,0))}else if(o.type==="LineString")for(const ie of o.geometry)he(ie,new wu(ie[0].x,ie[0].y,0));else if(o.type==="Point")for(const ie of o.geometry)for(const Re of ie)he([Re],new wu(Re.x,Re.y,0))}function Sv(l,o,c,f,m,v,w,E,T,P,N,z,V,Z,H){const tt=function(Tt,yt,Mt,zt,Ht,ye,Te,ge){const de=zt.layout.get("text-rotate").evaluate(ye,{})*Math.PI/180,le=[];for(const we of yt.positionedLines)for(const he of we.positionedGlyphs){if(!he.rect)continue;const ie=he.rect||{};let Re=B0+1,Me=!0,gn=1,fi=0;const yi=(Ht||ge)&&he.vertical,fr=he.metrics.advance*he.scale/2;if(ge&&yt.verticalizable&&(fi=we.lineOffset/2-(he.imageName?-(pr-he.metrics.width*he.scale)/2:(he.scale-1)*pr)),he.imageName){const gr=Te[he.imageName];Me=gr.sdf,gn=gr.pixelRatio,Re=qo/gn}const hs=Ht?[he.x+fr,he.y]:[0,0];let To=Ht?[0,0]:[he.x+fr+Mt[0],he.y+Mt[1]-fi],lr=[0,0];yi&&(lr=To,To=[0,0]);const Rr=he.metrics.isDoubleResolution?2:1,Qr=(he.metrics.left-Re)*he.scale-fr+To[0],Lo=(-he.metrics.top-Re)*he.scale+To[1],Mo=Qr+ie.w/Rr*he.scale/gn,dr=Lo+ie.h/Rr*he.scale/gn,mr=new k(Qr,Lo),po=new k(Mo,Lo),Po=new k(Qr,dr),fo=new k(Mo,dr);if(yi){const gr=new k(-fr,fr-pf),Sn=-Math.PI/2,mo=pr/2-fr,$r=new k(5-pf-mo,-(he.imageName?mo:0)),_r=new k(...lr);mr._rotateAround(Sn,gr)._add($r)._add(_r),po._rotateAround(Sn,gr)._add($r)._add(_r),Po._rotateAround(Sn,gr)._add($r)._add(_r),fo._rotateAround(Sn,gr)._add($r)._add(_r)}if(de){const gr=Math.sin(de),Sn=Math.cos(de),mo=[Sn,-gr,gr,Sn];mr._matMult(mo),po._matMult(mo),Po._matMult(mo),fo._matMult(mo)}const jo=new k(0,0),Zo=new k(0,0);le.push({tl:mr,tr:po,bl:Po,br:fo,tex:ie,writingMode:yt.writingMode,glyphOffset:hs,sectionIndex:he.sectionIndex,isSDF:Me,pixelOffsetTL:jo,pixelOffsetBR:Zo,minFontScaleX:0,minFontScaleY:0})}return le}(0,c,E,m,v,w,f,l.allowVerticalPlacement),lt=l.textSizeData;let ft=null;lt.kind==="source"?(ft=[el*m.layout.get("text-size").evaluate(w,{})],ft[0]>bu&&kt(`${l.layerIds[0]}: Value for "text-size" is >= ${df}. Reduce your "text-size".`)):lt.kind==="composite"&&(ft=[el*Z.compositeTextSizes[0].evaluate(w,{},H),el*Z.compositeTextSizes[1].evaluate(w,{},H)],(ft[0]>bu||ft[1]>bu)&&kt(`${l.layerIds[0]}: Value for "text-size" is >= ${df}. Reduce your "text-size".`)),l.addSymbols(l.text,tt,ft,E,v,w,P,o,T.lineStartIndex,T.lineLength,V,H);for(const Tt of N)z[Tt]=l.text.placedSymbolArray.length-1;return 4*tt.length}function Ev(l){for(const o in l)return l[o];return null}function iS(l,o,c,f){const m=l.compareText;if(o in m){const v=m[o];for(let w=v.length-1;w>=0;w--)if(f.dist(v[w])<c)return!0}else m[o]=[];return m[o].push(f),!1}const Iv=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class A_{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,f]=new Uint8Array(o,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const m=f>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);const v=Iv[15&f];if(!v)throw new Error("Unrecognized array type.");const[w]=new Uint16Array(o,2,1),[E]=new Uint32Array(o,4,1);return new A_(E,w,v,o)}constructor(o,c=64,f=Float64Array,m){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=f,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const v=Iv.indexOf(this.ArrayType),w=2*o*this.ArrayType.BYTES_PER_ELEMENT,E=o*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-E%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${f}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+E+T,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+w+E+T),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+E+T,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=o)}add(o,c){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=o,this.coords[this._pos++]=c,f}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return k_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,c,f,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:w,nodeSize:E}=this,T=[0,v.length-1,0],P=[];for(;T.length;){const N=T.pop()||0,z=T.pop()||0,V=T.pop()||0;if(z-V<=E){for(let lt=V;lt<=z;lt++){const ft=w[2*lt],Tt=w[2*lt+1];ft>=o&&ft<=f&&Tt>=c&&Tt<=m&&P.push(v[lt])}continue}const Z=V+z>>1,H=w[2*Z],tt=w[2*Z+1];H>=o&&H<=f&&tt>=c&&tt<=m&&P.push(v[Z]),(N===0?o<=H:c<=tt)&&(T.push(V),T.push(Z-1),T.push(1-N)),(N===0?f>=H:m>=tt)&&(T.push(Z+1),T.push(z),T.push(1-N))}return P}within(o,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:v,nodeSize:w}=this,E=[0,m.length-1,0],T=[],P=f*f;for(;E.length;){const N=E.pop()||0,z=E.pop()||0,V=E.pop()||0;if(z-V<=w){for(let lt=V;lt<=z;lt++)Tv(v[2*lt],v[2*lt+1],o,c)<=P&&T.push(m[lt]);continue}const Z=V+z>>1,H=v[2*Z],tt=v[2*Z+1];Tv(H,tt,o,c)<=P&&T.push(m[Z]),(N===0?o-f<=H:c-f<=tt)&&(E.push(V),E.push(Z-1),E.push(1-N)),(N===0?o+f>=H:c+f>=tt)&&(E.push(Z+1),E.push(z),E.push(1-N))}return T}}function k_(l,o,c,f,m,v){if(m-f<=c)return;const w=f+m>>1;Cv(l,o,w,f,m,v),k_(l,o,c,f,w-1,1-v),k_(l,o,c,w+1,m,1-v)}function Cv(l,o,c,f,m,v){for(;m>f;){if(m-f>600){const P=m-f+1,N=c-f+1,z=Math.log(P),V=.5*Math.exp(2*z/3),Z=.5*Math.sqrt(z*V*(P-V)/P)*(N-P/2<0?-1:1);Cv(l,o,c,Math.max(f,Math.floor(c-N*V/P+Z)),Math.min(m,Math.floor(c+(P-N)*V/P+Z)),v)}const w=o[2*c+v];let E=f,T=m;for(gf(l,o,f,c),o[2*m+v]>w&&gf(l,o,f,m);E<T;){for(gf(l,o,E,T),E++,T--;o[2*E+v]<w;)E++;for(;o[2*T+v]>w;)T--}o[2*f+v]===w?gf(l,o,f,T):(T++,gf(l,o,T,m)),T<=c&&(f=T+1),c<=T&&(m=T-1)}}function gf(l,o,c,f){N_(l,c,f),N_(o,2*c,2*f),N_(o,2*c+1,2*f+1)}function N_(l,o,c){const f=l[o];l[o]=l[c],l[c]=f}function Tv(l,o,c,f){const m=l-c,v=o-f;return m*m+v*v}var D_;a.bh=void 0,(D_=a.bh||(a.bh={})).create="create",D_.load="load",D_.fullLoad="fullLoad";let Im=null,_f=[];const R_=1e3/60,O_="loadTime",z_="fullLoadTime",rS={mark(l){performance.mark(l)},frame(l){const o=l;Im!=null&&_f.push(o-Im),Im=o},clearMetrics(){Im=null,_f=[],performance.clearMeasures(O_),performance.clearMeasures(z_);for(const l in a.bh)performance.clearMarks(a.bh[l])},getPerformanceMetrics(){performance.measure(O_,a.bh.create,a.bh.load),performance.measure(z_,a.bh.create,a.bh.fullLoad);const l=performance.getEntriesByName(O_)[0].duration,o=performance.getEntriesByName(z_)[0].duration,c=_f.length,f=1/(_f.reduce((v,w)=>v+w,0)/c/1e3),m=_f.filter(v=>v>R_).reduce((v,w)=>v+(w-R_)/R_,0);return{loadTime:l,fullLoadTime:o,fps:f,percentDroppedFrames:m/(c+m)*100,totalFrames:c}}};a.$=function(l,o,c){var f,m,v,w,E,T,P,N,z,V,Z,H,tt=c[0],lt=c[1],ft=c[2];return o===l?(l[12]=o[0]*tt+o[4]*lt+o[8]*ft+o[12],l[13]=o[1]*tt+o[5]*lt+o[9]*ft+o[13],l[14]=o[2]*tt+o[6]*lt+o[10]*ft+o[14],l[15]=o[3]*tt+o[7]*lt+o[11]*ft+o[15]):(m=o[1],v=o[2],w=o[3],E=o[4],T=o[5],P=o[6],N=o[7],z=o[8],V=o[9],Z=o[10],H=o[11],l[0]=f=o[0],l[1]=m,l[2]=v,l[3]=w,l[4]=E,l[5]=T,l[6]=P,l[7]=N,l[8]=z,l[9]=V,l[10]=Z,l[11]=H,l[12]=f*tt+E*lt+z*ft+o[12],l[13]=m*tt+T*lt+V*ft+o[13],l[14]=v*tt+P*lt+Z*ft+o[14],l[15]=w*tt+N*lt+H*ft+o[15]),l},a.A=fh,a.B=Fo,a.C=class{constructor(l,o,c){this.receive=f=>{const m=f.data,v=m.id;if(v&&(!m.targetMapId||this.mapId===m.targetMapId))if(m.type==="<cancel>"){delete this.tasks[v];const w=this.cancelCallbacks[v];delete this.cancelCallbacks[v],w&&w()}else be()||m.mustQueue?(this.tasks[v]=m,this.taskQueue.push(v),this.invoker.trigger()):this.processTask(v,m)},this.process=()=>{if(!this.taskQueue.length)return;const f=this.taskQueue.shift(),m=this.tasks[f];delete this.tasks[f],this.taskQueue.length&&this.invoker.trigger(),m&&this.processTask(f,m)},this.target=l,this.parent=o,this.mapId=c,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new H2(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=be()?l:window}send(l,o,c,f,m=!1){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(this.callbacks[v]=c);const w=[],E={id:v,type:l,hasCallback:!!c,targetMapId:f,mustQueue:m,sourceMapId:this.mapId,data:Qa(o,w)};return this.target.postMessage(E,{transfer:w}),{cancel:()=>{c&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}processTask(l,o){if(o.type==="<response>"){const c=this.callbacks[l];delete this.callbacks[l],c&&(o.error?c(du(o.error)):c(null,du(o.data)))}else{let c=!1;const f=[],m=o.hasCallback?(E,T)=>{c=!0,delete this.cancelCallbacks[l];const P={id:l,type:"<response>",sourceMapId:this.mapId,error:E?Qa(E):null,data:Qa(T,f)};this.target.postMessage(P,{transfer:f})}:E=>{c=!0};let v=null;const w=du(o.data);if(this.parent[o.type])v=this.parent[o.type](o.sourceMapId,w,m);else if("getWorkerSource"in this.parent){const E=o.type.split(".");v=this.parent.getWorkerSource(o.sourceMapId,E[0],w.source)[E[1]](w,m)}else m(new Error(`Could not find function ${o.type}`));!c&&v&&v.cancel&&(this.cancelCallbacks[l]=v.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.D=Ae,a.E=Gn,a.F=function(l,o){const c={};for(let f=0;f<o.length;f++){const m=o[f];m in l&&(c[m]=l[m])}return c},a.G=ev,a.H=nv,a.I=y_,a.J=U,a.K=X,a.L=xu,a.M=Ze,a.N=ar,a.O=Cs,a.P=k,a.Q=Ii,a.R=Is,a.S=pi,a.T=tm,a.U=bm,a.V=class extends Ml{},a.W=L_,a.X=function(l,o){const c=window.document.createElement("video");c.muted=!0,c.onloadstart=function(){o(null,c)};for(let f=0;f<l.length;f++){const m=window.document.createElement("source");De(l[f])||(c.crossOrigin="Anonymous"),m.src=l[f],c.appendChild(m)}return{cancel:()=>{}}},a.Y=ae,a.Z=function(){var l=new fh(16);return fh!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l},a._=_,a.a=$e,a.a$=class extends j{},a.a0=function(l,o,c){var f=c[0],m=c[1],v=c[2];return l[0]=o[0]*f,l[1]=o[1]*f,l[2]=o[2]*f,l[3]=o[3]*f,l[4]=o[4]*m,l[5]=o[5]*m,l[6]=o[6]*m,l[7]=o[7]*m,l[8]=o[8]*v,l[9]=o[9]*v,l[10]=o[10]*v,l[11]=o[11]*v,l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15],l},a.a1=s0,a.a2=function(){return rt++},a.a3=at,a.a4=vh,a.a5=function(){Uo.isLoading()||Uo.isLoaded()||jp()!=="deferred"||$d()},a.a6=Np,a.a7=hc,a.a8=hi,a.a9=uv,a.aA=oc,a.aB=function(l){l=l.slice();const o=Object.create(null);for(let c=0;c<l.length;c++)o[l[c].id]=l[c];for(let c=0;c<l.length;c++)"ref"in l[c]&&(l[c]=qi(l[c],o[l[c].ref]));return l},a.aC=function(l){if(l.type==="custom")return new X2(l);switch(l.type){case"background":return new j2(l);case"circle":return new Mw(l);case"fill":return new Yw(l);case"fill-extrusion":return new c2(l);case"heatmap":return new Aw(l);case"hillshade":return new Nw(l);case"line":return new y2(l);case"raster":return new W2(l);case"symbol":return new vm(l)}},a.aD=dt,a.aE=function(l,o){if(!l)return[{command:en.setStyle,args:[o]}];let c=[];try{if(!In(l.version,o.version))return[{command:en.setStyle,args:[o]}];In(l.center,o.center)||c.push({command:en.setCenter,args:[o.center]}),In(l.zoom,o.zoom)||c.push({command:en.setZoom,args:[o.zoom]}),In(l.bearing,o.bearing)||c.push({command:en.setBearing,args:[o.bearing]}),In(l.pitch,o.pitch)||c.push({command:en.setPitch,args:[o.pitch]}),In(l.sprite,o.sprite)||c.push({command:en.setSprite,args:[o.sprite]}),In(l.glyphs,o.glyphs)||c.push({command:en.setGlyphs,args:[o.glyphs]}),In(l.transition,o.transition)||c.push({command:en.setTransition,args:[o.transition]}),In(l.light,o.light)||c.push({command:en.setLight,args:[o.light]});const f={},m=[];(function(w,E,T,P){let N;for(N in E=E||{},w=w||{})Object.prototype.hasOwnProperty.call(w,N)&&(Object.prototype.hasOwnProperty.call(E,N)||or(N,T,P));for(N in E)Object.prototype.hasOwnProperty.call(E,N)&&(Object.prototype.hasOwnProperty.call(w,N)?In(w[N],E[N])||(w[N].type==="geojson"&&E[N].type==="geojson"&&ii(w,E,N)?T.push({command:en.setGeoJSONSourceData,args:[N,E[N].data]}):Ni(N,E,T,P)):uo(N,E,T))})(l.sources,o.sources,m,f);const v=[];l.layers&&l.layers.forEach(w=>{f[w.source]?c.push({command:en.removeLayer,args:[w.id]}):v.push(w)}),c=c.concat(m),function(w,E,T){E=E||[];const P=(w=w||[]).map(gi),N=E.map(gi),z=w.reduce(wa,{}),V=E.reduce(wa,{}),Z=P.slice(),H=Object.create(null);let tt,lt,ft,Tt,yt,Mt,zt;for(tt=0,lt=0;tt<P.length;tt++)ft=P[tt],Object.prototype.hasOwnProperty.call(V,ft)?lt++:(T.push({command:en.removeLayer,args:[ft]}),Z.splice(Z.indexOf(ft,lt),1));for(tt=0,lt=0;tt<N.length;tt++)ft=N[N.length-1-tt],Z[Z.length-1-tt]!==ft&&(Object.prototype.hasOwnProperty.call(z,ft)?(T.push({command:en.removeLayer,args:[ft]}),Z.splice(Z.lastIndexOf(ft,Z.length-lt),1)):lt++,Mt=Z[Z.length-tt],T.push({command:en.addLayer,args:[V[ft],Mt]}),Z.splice(Z.length-tt,0,ft),H[ft]=!0);for(tt=0;tt<N.length;tt++)if(ft=N[tt],Tt=z[ft],yt=V[ft],!H[ft]&&!In(Tt,yt))if(In(Tt.source,yt.source)&&In(Tt["source-layer"],yt["source-layer"])&&In(Tt.type,yt.type)){for(zt in vn(Tt.layout,yt.layout,T,ft,null,en.setLayoutProperty),vn(Tt.paint,yt.paint,T,ft,null,en.setPaintProperty),In(Tt.filter,yt.filter)||T.push({command:en.setFilter,args:[ft,yt.filter]}),In(Tt.minzoom,yt.minzoom)&&In(Tt.maxzoom,yt.maxzoom)||T.push({command:en.setLayerZoomRange,args:[ft,yt.minzoom,yt.maxzoom]}),Tt)Object.prototype.hasOwnProperty.call(Tt,zt)&&zt!=="layout"&&zt!=="paint"&&zt!=="filter"&&zt!=="metadata"&&zt!=="minzoom"&&zt!=="maxzoom"&&(zt.indexOf("paint.")===0?vn(Tt[zt],yt[zt],T,ft,zt.slice(6),en.setPaintProperty):In(Tt[zt],yt[zt])||T.push({command:en.setLayerProperty,args:[ft,zt,yt[zt]]}));for(zt in yt)Object.prototype.hasOwnProperty.call(yt,zt)&&!Object.prototype.hasOwnProperty.call(Tt,zt)&&zt!=="layout"&&zt!=="paint"&&zt!=="filter"&&zt!=="metadata"&&zt!=="minzoom"&&zt!=="maxzoom"&&(zt.indexOf("paint.")===0?vn(Tt[zt],yt[zt],T,ft,zt.slice(6),en.setPaintProperty):In(Tt[zt],yt[zt])||T.push({command:en.setLayerProperty,args:[ft,zt,yt[zt]]}))}else T.push({command:en.removeLayer,args:[ft]}),Mt=Z[Z.lastIndexOf(ft)+1],T.push({command:en.addLayer,args:[yt,Mt]})}(v,o.layers,c)}catch(f){console.warn("Unable to compute style diff:",f),c=[{command:en.setStyle,args:[o]}]}return c},a.aF=function(l){const o=[],c=l.id;return c===void 0&&o.push({message:`layers.${c}: missing required property "id"`}),l.render===void 0&&o.push({message:`layers.${c}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&o.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),o},a.aG=function l(o,c){if(Array.isArray(o)){if(!Array.isArray(c)||o.length!==c.length)return!1;for(let f=0;f<o.length;f++)if(!l(o[f],c[f]))return!1;return!0}if(typeof o=="object"&&o!==null&&c!==null){if(typeof c!="object"||Object.keys(o).length!==Object.keys(c).length)return!1;for(const f in o)if(!l(o[f],c[f]))return!1;return!0}return o===c},a.aH=Et,a.aI=mt,a.aJ=sc,a.aK=function(l){return l({pluginStatus:Eo,pluginURL:$a}),sc.on("pluginStateChange",l),l},a.aL=class extends kl{constructor(l,o){super(l,o),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},a.aM=hh,a.aN=class extends kl{constructor(l,o){super(l,o),this.current=Kg}set(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let o=1;o<16;o++)if(l[o]!==this.current[o]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}},a.aO=rm,a.aP=class extends kl{constructor(l,o){super(l,o),this.current=[0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))}},a.aQ=class extends kl{constructor(l,o){super(l,o),this.current=[0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))}},a.aR=om,a.aS=function(l,o,c,f,m,v,w){var E=1/(o-c),T=1/(f-m),P=1/(v-w);return l[0]=-2*E,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*T,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*P,l[11]=0,l[12]=(o+c)*E,l[13]=(m+f)*T,l[14]=(w+v)*P,l[15]=1,l},a.aT=Hn,a.aU=Lw,a.aV=class extends d{},a.aW=w2,a.aX=class extends b{},a.aY=function(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))},a.aZ=h0,a.a_=se,a.aa=function(l){const o={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,f,m,v)=>{const w=m||v;return o[f]=!w||w.toLowerCase(),""}),o["max-age"]){const c=parseInt(o["max-age"],10);isNaN(c)?delete o["max-age"]:o["max-age"]=c}return o},a.ab=function(l,o){const c=[];for(const f in l)f in o||c.push(f);return c},a.ac=function(l){if(ce==null){const o=l.navigator?l.navigator.userAgent:null;ce=!!l.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return ce},a.ad=gt,a.ae=function(l,o,c){var f=Math.sin(c),m=Math.cos(c),v=o[0],w=o[1],E=o[2],T=o[3],P=o[4],N=o[5],z=o[6],V=o[7];return o!==l&&(l[8]=o[8],l[9]=o[9],l[10]=o[10],l[11]=o[11],l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15]),l[0]=v*m+P*f,l[1]=w*m+N*f,l[2]=E*m+z*f,l[3]=T*m+V*f,l[4]=P*m-v*f,l[5]=N*m-w*f,l[6]=z*m-E*f,l[7]=V*m-T*f,l},a.af=function(l){var o=new fh(16);return o[0]=l[0],o[1]=l[1],o[2]=l[2],o[3]=l[3],o[4]=l[4],o[5]=l[5],o[6]=l[6],o[7]=l[7],o[8]=l[8],o[9]=l[9],o[10]=l[10],o[11]=l[11],o[12]=l[12],o[13]=l[13],o[14]=l[14],o[15]=l[15],o},a.ag=um,a.ah=function(l,o){let c=0,f=0;if(l.kind==="constant")f=l.layoutSize;else if(l.kind!=="source"){const{interpolationType:m,minZoom:v,maxZoom:w}=l,E=m?gt(Bo.interpolationFactor(m,o,v,w),0,1):0;l.kind==="camera"?f=Fo.number(l.minSize,l.maxSize,E):c=E}return{uSizeT:c,uSize:f}},a.aj=function(l,{uSize:o,uSizeT:c},{lowerSize:f,upperSize:m}){return l.kind==="source"?f/el:l.kind==="composite"?Fo.number(f/el,m/el,c):o},a.ak=w_,a.al=function(l,o,c,f){const m=o.y-l.y,v=o.x-l.x,w=f.y-c.y,E=f.x-c.x,T=w*v-E*m;if(T===0)return null;const P=(E*(l.y-c.y)-w*(l.x-c.x))/T;return new k(l.x+P*v,l.y+P*m)},a.am=fv,a.an=t0,a.ao=e_,a.ap=pr,a.ar=x_,a.as=function(l,o){var c=o[0],f=o[1],m=o[2],v=o[3],w=o[4],E=o[5],T=o[6],P=o[7],N=o[8],z=o[9],V=o[10],Z=o[11],H=o[12],tt=o[13],lt=o[14],ft=o[15],Tt=c*E-f*w,yt=c*T-m*w,Mt=c*P-v*w,zt=f*T-m*E,Ht=f*P-v*E,ye=m*P-v*T,Te=N*tt-z*H,ge=N*lt-V*H,de=N*ft-Z*H,le=z*lt-V*tt,we=z*ft-Z*tt,he=V*ft-Z*lt,ie=Tt*he-yt*we+Mt*le+zt*de-Ht*ge+ye*Te;return ie?(l[0]=(E*he-T*we+P*le)*(ie=1/ie),l[1]=(m*we-f*he-v*le)*ie,l[2]=(tt*ye-lt*Ht+ft*zt)*ie,l[3]=(V*Ht-z*ye-Z*zt)*ie,l[4]=(T*de-w*he-P*ge)*ie,l[5]=(c*he-m*de+v*ge)*ie,l[6]=(lt*Mt-H*ye-ft*yt)*ie,l[7]=(N*ye-V*Mt+Z*yt)*ie,l[8]=(w*we-E*de+P*Te)*ie,l[9]=(f*de-c*we-v*Te)*ie,l[10]=(H*Ht-tt*Mt+ft*Tt)*ie,l[11]=(z*Mt-N*Ht-Z*Tt)*ie,l[12]=(E*ge-w*le-T*Te)*ie,l[13]=(c*le-f*ge+m*Te)*ie,l[14]=(tt*yt-H*zt-lt*Tt)*ie,l[15]=(N*zt-z*yt+V*Tt)*ie,l):null},a.at=P_,a.au=b_,a.av=A_,a.aw=function(){const l={},o=qt.$version;for(const c in qt.$root){const f=qt.$root[c];if(f.required){let m=null;m=c==="version"?o:f.type==="array"?[]:{},m!=null&&(l[c]=m)}}return l},a.ax=en,a.ay=Yd,a.az=fn,a.b=function(l,o){const c=new Blob([new Uint8Array(l)],{type:"image/png"});createImageBitmap(c).then(f=>{o(null,f)}).catch(f=>{o(new Error(`Could not load image because of ${f.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},a.b0=Nr,a.b1=function(l,o){var c=l[0],f=l[1],m=l[2],v=l[3],w=l[4],E=l[5],T=l[6],P=l[7],N=l[8],z=l[9],V=l[10],Z=l[11],H=l[12],tt=l[13],lt=l[14],ft=l[15],Tt=o[0],yt=o[1],Mt=o[2],zt=o[3],Ht=o[4],ye=o[5],Te=o[6],ge=o[7],de=o[8],le=o[9],we=o[10],he=o[11],ie=o[12],Re=o[13],Me=o[14],gn=o[15];return Math.abs(c-Tt)<=Co*Math.max(1,Math.abs(c),Math.abs(Tt))&&Math.abs(f-yt)<=Co*Math.max(1,Math.abs(f),Math.abs(yt))&&Math.abs(m-Mt)<=Co*Math.max(1,Math.abs(m),Math.abs(Mt))&&Math.abs(v-zt)<=Co*Math.max(1,Math.abs(v),Math.abs(zt))&&Math.abs(w-Ht)<=Co*Math.max(1,Math.abs(w),Math.abs(Ht))&&Math.abs(E-ye)<=Co*Math.max(1,Math.abs(E),Math.abs(ye))&&Math.abs(T-Te)<=Co*Math.max(1,Math.abs(T),Math.abs(Te))&&Math.abs(P-ge)<=Co*Math.max(1,Math.abs(P),Math.abs(ge))&&Math.abs(N-de)<=Co*Math.max(1,Math.abs(N),Math.abs(de))&&Math.abs(z-le)<=Co*Math.max(1,Math.abs(z),Math.abs(le))&&Math.abs(V-we)<=Co*Math.max(1,Math.abs(V),Math.abs(we))&&Math.abs(Z-he)<=Co*Math.max(1,Math.abs(Z),Math.abs(he))&&Math.abs(H-ie)<=Co*Math.max(1,Math.abs(H),Math.abs(ie))&&Math.abs(tt-Re)<=Co*Math.max(1,Math.abs(tt),Math.abs(Re))&&Math.abs(lt-Me)<=Co*Math.max(1,Math.abs(lt),Math.abs(Me))&&Math.abs(ft-gn)<=Co*Math.max(1,Math.abs(ft),Math.abs(gn))},a.b2=function(l,o){return l[0]=o[0],l[1]=o[1],l[2]=o[2],l[3]=o[3],l[4]=o[4],l[5]=o[5],l[6]=o[6],l[7]=o[7],l[8]=o[8],l[9]=o[9],l[10]=o[10],l[11]=o[11],l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15],l},a.b3=function(l,o,c){return l[0]=o[0]*c[0],l[1]=o[1]*c[1],l[2]=o[2]*c[2],l[3]=o[3]*c[3],l},a.b4=function(l,o){return l[0]*o[0]+l[1]*o[1]+l[2]*o[2]+l[3]*o[3]},a.b5=ct,a.b6=sv,a.b7=iv,a.b8=function(l,o,c,f,m){var v,w=1/Math.tan(o/2);return l[0]=w/c,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=w,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,m!=null&&m!==1/0?(l[10]=(m+f)*(v=1/(f-m)),l[14]=2*m*f*v):(l[10]=-1,l[14]=-2*f),l},a.b9=function(l,o,c){var f=Math.sin(c),m=Math.cos(c),v=o[4],w=o[5],E=o[6],T=o[7],P=o[8],N=o[9],z=o[10],V=o[11];return o!==l&&(l[0]=o[0],l[1]=o[1],l[2]=o[2],l[3]=o[3],l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15]),l[4]=v*m+P*f,l[5]=w*m+N*f,l[6]=E*m+z*f,l[7]=T*m+V*f,l[8]=P*m-v*f,l[9]=N*m-w*f,l[10]=z*m-E*f,l[11]=V*m-T*f,l},a.bA=S,a.bB=k0,a.bC=th,a.bD=Uo,a.ba=Y,a.bb=pt,a.bc=function(l,o){return l[0]=o[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=o[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=o[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},a.bd=class extends uc{},a.be=C_,a.bf=rv,a.bg=rS,a.bi=Be,a.bj=function(l,o,c=!1){if(Eo===Bp||Eo===Vp||Eo===Up)throw new Error("setRTLTextPlugin cannot be called multiple times.");$a=Zn.resolveURL(l),Eo=Bp,Gp=o,qp(),c||$d()},a.bk=jp,a.bl=function(l,o){const c={};for(let m=0;m<l.length;m++){const v=o&&o[l[m].id]||rh(l[m]);o&&(o[l[m].id]=v);let w=c[v];w||(w=c[v]=[]),w.push(l[m])}const f=[];for(const m in c)f.push(c[m]);return f},a.bm=xe,a.bn=lv,a.bo=cv,a.bp=U0,a.bq=function(l){l.bucket.createArrays(),l.bucket.tilePixelRatio=ar/(512*l.bucket.overscaling),l.bucket.compareText={},l.bucket.iconsNeedLinear=!1;const o=l.bucket.layers[0],c=o.layout,f=o._unevaluatedLayout._values,m={layoutIconSize:f["icon-size"].possiblyEvaluate(new hi(l.bucket.zoom+1),l.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new hi(l.bucket.zoom+1),l.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new hi(18))};if(l.bucket.textSizeData.kind==="composite"){const{minZoom:P,maxZoom:N}=l.bucket.textSizeData;m.compositeTextSizes=[f["text-size"].possiblyEvaluate(new hi(P),l.canonical),f["text-size"].possiblyEvaluate(new hi(N),l.canonical)]}if(l.bucket.iconSizeData.kind==="composite"){const{minZoom:P,maxZoom:N}=l.bucket.iconSizeData;m.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new hi(P),l.canonical),f["icon-size"].possiblyEvaluate(new hi(N),l.canonical)]}const v=c.get("text-line-height")*pr,w=c.get("text-rotation-alignment")!=="viewport"&&c.get("symbol-placement")!=="point",E=c.get("text-keep-upright"),T=c.get("text-size");for(const P of l.bucket.features){const N=c.get("text-font").evaluate(P,{},l.canonical).join(","),z=T.evaluate(P,{},l.canonical),V=m.layoutTextSize.evaluate(P,{},l.canonical),Z=m.layoutIconSize.evaluate(P,{},l.canonical),H={horizontal:{},vertical:void 0},tt=P.text;let lt,ft=[0,0];if(tt){const Mt=tt.toString(),zt=c.get("text-letter-spacing").evaluate(P,{},l.canonical)*pr,Ht=zp(Mt)?zt:0,ye=c.get("text-anchor").evaluate(P,{},l.canonical),Te=wv(o,P,l.canonical);if(!Te){const he=c.get("text-radial-offset").evaluate(P,{},l.canonical);ft=he?xv(ye,[he*pr,M_]):c.get("text-offset").evaluate(P,{},l.canonical).map(ie=>ie*pr)}let ge=w?"center":c.get("text-justify").evaluate(P,{},l.canonical);const de=c.get("symbol-placement"),le=de==="point"?c.get("text-max-width").evaluate(P,{},l.canonical)*pr:0,we=()=>{l.bucket.allowVerticalPlacement&&Op(Mt)&&(H.vertical=gm(tt,l.glyphMap,l.glyphPositions,l.imagePositions,N,le,v,ye,"left",Ht,ft,a.ai.vertical,!0,de,V,z))};if(!w&&Te){const he=new Set;if(ge==="auto")for(let Re=0;Re<Te.values.length;Re+=2)he.add(P_(Te.values[Re]));else he.add(ge);let ie=!1;for(const Re of he)if(!H.horizontal[Re])if(ie)H.horizontal[Re]=H.horizontal[0];else{const Me=gm(tt,l.glyphMap,l.glyphPositions,l.imagePositions,N,le,v,"center",Re,Ht,ft,a.ai.horizontal,!1,de,V,z);Me&&(H.horizontal[Re]=Me,ie=Me.positionedLines.length===1)}we()}else{ge==="auto"&&(ge=P_(ye));const he=gm(tt,l.glyphMap,l.glyphPositions,l.imagePositions,N,le,v,ye,ge,Ht,ft,a.ai.horizontal,!1,de,V,z);he&&(H.horizontal[ge]=he),we(),Op(Mt)&&w&&E&&(H.vertical=gm(tt,l.glyphMap,l.glyphPositions,l.imagePositions,N,le,v,ye,ge,Ht,ft,a.ai.vertical,!1,de,V,z))}}let Tt=!1;if(P.icon&&P.icon.name){const Mt=l.imageMap[P.icon.name];Mt&&(lt=B2(l.imagePositions[P.icon.name],c.get("icon-offset").evaluate(P,{},l.canonical),c.get("icon-anchor").evaluate(P,{},l.canonical)),Tt=!!Mt.sdf,l.bucket.sdfIcons===void 0?l.bucket.sdfIcons=Tt:l.bucket.sdfIcons!==Tt&&kt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Mt.pixelRatio!==l.bucket.pixelRatio||c.get("icon-rotate").constantOr(1)!==0)&&(l.bucket.iconsNeedLinear=!0))}const yt=Ev(H.horizontal)||H.vertical;l.bucket.iconsInText=!!yt&&yt.iconsInText,(yt||lt)&&nS(l.bucket,P,H,lt,l.imageMap,m,V,Z,ft,Tt,l.canonical)}l.showCollisionBoxes&&l.bucket.generateCollisionDebugBuffers()},a.br=d_,a.bs=h_,a.bt=f_,a.bu=class{constructor(l){this._marks={start:[l.url,"start"].join("#"),end:[l.url,"end"].join("#"),measure:l.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let l=performance.getEntriesByName(this._marks.measure);return l.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),l=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),l}},a.bv=g_,a.bw=yu,a.bx=function(l,o,c,f,m){return _(this,void 0,void 0,function*(){if(X())try{return yield Ze(l,o,c,f,m)}catch{}return function(v,w,E,T,P){const N=v.width,z=v.height;ze&&Ue||(ze=new OffscreenCanvas(N,z),Ue=ze.getContext("2d",{willReadFrequently:!0})),ze.width=N,ze.height=z,Ue.drawImage(v,0,0,N,z);const V=Ue.getImageData(w,E,T,P);return Ue.clearRect(0,0,N,z),V.data}(l,o,c,f,m)})},a.by=av,a.bz=x,a.c=re,a.d=function(l,o){const c=new Image;c.onload=()=>{o(null,c),URL.revokeObjectURL(c.src),c.onload=null,window.requestAnimationFrame(()=>{c.src=jn})},c.onerror=()=>o(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const f=new Blob([new Uint8Array(l)],{type:"image/png"});c.src=l.byteLength?URL.createObjectURL(f):jn},a.e=ht,a.f=function(l,o){return Ai(ht(l,{type:"json"}),o)},a.g=Un,a.h=Zn,a.i=be,a.j=tn,a.k=On,a.l=wt,a.m=Ai,a.n=function(l){return new g_(l).readFields(N2,[])},a.o=function(l,o,c){if(!l.length)return c(null,[]);let f=l.length;const m=new Array(l.length);let v=null;l.forEach((w,E)=>{o(w,(T,P)=>{T&&(v=T),m[E]=P,--f==0&&c(v,m)})})},a.p=V0,a.q=rf,a.r=Ji,a.s=De,a.t=Wg,a.u=_e,a.v=qt,a.w=kt,a.x=ah,a.y=Ta,a.z=function([l,o,c]){return o+=90,o*=Math.PI/180,c*=Math.PI/180,{x:l*Math.cos(o)*Math.sin(c),y:l*Math.sin(o)*Math.sin(c),z:l*Math.cos(c)}}}),u(["./shared"],function(a){class _{constructor(B){this.keyCache={},B&&this.replace(B)}replace(B){this._layerConfigs={},this._layers={},this.update(B,[])}update(B,G){for(const q of B){this._layerConfigs[q.id]=q;const ot=this._layers[q.id]=a.aC(q);ot._featureFilter=a.a6(ot.filter),this.keyCache[q.id]&&delete this.keyCache[q.id]}for(const q of G)delete this.keyCache[q],delete this._layerConfigs[q],delete this._layers[q];this.familiesBySource={};const J=a.bl(Object.values(this._layerConfigs),this.keyCache);for(const q of J){const ot=q.map(Zt=>this._layers[Zt.id]),St=ot[0];if(St.visibility==="none")continue;const _t=St.source||"";let it=this.familiesBySource[_t];it||(it=this.familiesBySource[_t]={});const bt=St.sourceLayer||"_geojsonTileLayer";let jt=it[bt];jt||(jt=it[bt]=[]),jt.push(ot)}}}class x{constructor(B){const G={},J=[];for(const _t in B){const it=B[_t],bt=G[_t]={};for(const jt in it){const Zt=it[+jt];if(!Zt||Zt.bitmap.width===0||Zt.bitmap.height===0)continue;const Xt={x:0,y:0,w:Zt.bitmap.width+2,h:Zt.bitmap.height+2};J.push(Xt),bt[jt]={rect:Xt,metrics:Zt.metrics}}}const{w:q,h:ot}=a.p(J),St=new a.q({width:q||1,height:ot||1});for(const _t in B){const it=B[_t];for(const bt in it){const jt=it[+bt];if(!jt||jt.bitmap.width===0||jt.bitmap.height===0)continue;const Zt=G[_t][bt].rect;a.q.copy(jt.bitmap,St,{x:0,y:0},{x:Zt.x+1,y:Zt.y+1},jt.bitmap)}}this.image=St,this.positions=G}}a.bm("GlyphAtlas",x);class S{constructor(B){this.tileID=new a.O(B.tileID.overscaledZ,B.tileID.wrap,B.tileID.canonical.z,B.tileID.canonical.x,B.tileID.canonical.y),this.uid=B.uid,this.zoom=B.zoom,this.pixelRatio=B.pixelRatio,this.tileSize=B.tileSize,this.source=B.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=B.showCollisionBoxes,this.collectResourceTiming=!!B.collectResourceTiming,this.returnDependencies=!!B.returnDependencies,this.promoteId=B.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(B,G,J,q,ot){this.status="parsing",this.data=B,this.collisionBoxArray=new a.a3;const St=new a.bn(Object.keys(B.layers).sort()),_t=new a.bo(this.tileID,this.promoteId);_t.bucketLayerIDs=[];const it={},bt={featureIndex:_t,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:J},jt=G.familiesBySource[this.source];for(const An in jt){const Pn=B.layers[An];if(!Pn)continue;Pn.version===1&&a.w(`Vector tile source "${this.source}" layer "${An}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Hr=St.encode(An),oi=[];for(let sr=0;sr<Pn.length;sr++){const Ar=Pn.feature(sr),rs=_t.getId(Ar,An);oi.push({feature:Ar,id:rs,index:sr,sourceLayerIndex:Hr})}for(const sr of jt[An]){const Ar=sr[0];Ar.source!==this.source&&a.w(`layer.source = ${Ar.source} does not equal this.source = ${this.source}`),Ar.minzoom&&this.zoom<Math.floor(Ar.minzoom)||Ar.maxzoom&&this.zoom>=Ar.maxzoom||Ar.visibility!=="none"&&(L(sr,this.zoom,J),(it[Ar.id]=Ar.createBucket({index:_t.bucketLayerIDs.length,layers:sr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Hr,sourceID:this.source})).populate(oi,bt,this.tileID.canonical),_t.bucketLayerIDs.push(sr.map(rs=>rs.id)))}}let Zt,Xt,Pe,Ye;const Ie=a.aH(bt.glyphDependencies,An=>Object.keys(An).map(Number));this.inFlightDependencies.forEach(An=>An==null?void 0:An.cancel()),this.inFlightDependencies=[];const Fe=++this.dependencySentinel;Object.keys(Ie).length?this.inFlightDependencies.push(q.send("getGlyphs",{uid:this.uid,stacks:Ie,source:this.source,tileID:this.tileID,type:"glyphs"},(An,Pn)=>{Fe===this.dependencySentinel&&(Zt||(Zt=An,Xt=Pn,Qn.call(this)))})):Xt={};const nn=Object.keys(bt.iconDependencies);nn.length?this.inFlightDependencies.push(q.send("getImages",{icons:nn,source:this.source,tileID:this.tileID,type:"icons"},(An,Pn)=>{Fe===this.dependencySentinel&&(Zt||(Zt=An,Pe=Pn,Qn.call(this)))})):Pe={};const qn=Object.keys(bt.patternDependencies);function Qn(){if(Zt)return ot(Zt);if(Xt&&Pe&&Ye){const An=new x(Xt),Pn=new a.bp(Pe,Ye);for(const Hr in it){const oi=it[Hr];oi instanceof a.a4?(L(oi.layers,this.zoom,J),a.bq({bucket:oi,glyphMap:Xt,glyphPositions:An.positions,imageMap:Pe,imagePositions:Pn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):oi.hasPattern&&(oi instanceof a.br||oi instanceof a.bs||oi instanceof a.bt)&&(L(oi.layers,this.zoom,J),oi.addFeatures(bt,this.tileID.canonical,Pn.patternPositions))}this.status="done",ot(null,{buckets:Object.values(it).filter(Hr=>!Hr.isEmpty()),featureIndex:_t,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:An.image,imageAtlas:Pn,glyphMap:this.returnDependencies?Xt:null,iconMap:this.returnDependencies?Pe:null,glyphPositions:this.returnDependencies?An.positions:null})}}qn.length?this.inFlightDependencies.push(q.send("getImages",{icons:qn,source:this.source,tileID:this.tileID,type:"patterns"},(An,Pn)=>{Fe===this.dependencySentinel&&(Zt||(Zt=An,Ye=Pn,Qn.call(this)))})):Ye={},Qn.call(this)}}function L(st,B,G){const J=new a.a8(B);for(const q of st)q.recalculate(J,G)}function k(st,B){const G=a.l(st.request,(J,q,ot,St)=>{if(J)B(J);else if(q)try{const _t=new a.bw.VectorTile(new a.bv(q));B(null,{vectorTile:_t,rawData:q,cacheControl:ot,expires:St})}catch(_t){const it=new Uint8Array(q);let bt=`Unable to parse the tile at ${st.request.url}, `;bt+=it[0]===31&&it[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${_t.messge}`,B(new Error(bt))}});return()=>{G.cancel(),B()}}class D{constructor(B,G,J,q){this.actor=B,this.layerIndex=G,this.availableImages=J,this.loadVectorData=q||k,this.fetching={},this.loading={},this.loaded={}}loadTile(B,G){const J=B.uid;this.loading||(this.loading={});const q=!!(B&&B.request&&B.request.collectResourceTiming)&&new a.bu(B.request),ot=this.loading[J]=new S(B);ot.abort=this.loadVectorData(B,(St,_t)=>{if(delete this.loading[J],St||!_t)return ot.status="done",this.loaded[J]=ot,G(St);const it=_t.rawData,bt={};_t.expires&&(bt.expires=_t.expires),_t.cacheControl&&(bt.cacheControl=_t.cacheControl);const jt={};if(q){const Zt=q.finish();Zt&&(jt.resourceTiming=JSON.parse(JSON.stringify(Zt)))}ot.vectorTile=_t.vectorTile,ot.parse(_t.vectorTile,this.layerIndex,this.availableImages,this.actor,(Zt,Xt)=>{if(delete this.fetching[J],Zt||!Xt)return G(Zt);G(null,a.e({rawTileData:it.slice(0)},Xt,bt,jt))}),this.loaded=this.loaded||{},this.loaded[J]=ot,this.fetching[J]={rawTileData:it,cacheControl:bt,resourceTiming:jt}})}reloadTile(B,G){const J=this.loaded,q=B.uid;if(J&&J[q]){const ot=J[q];ot.showCollisionBoxes=B.showCollisionBoxes,ot.status==="parsing"?ot.parse(ot.vectorTile,this.layerIndex,this.availableImages,this.actor,(St,_t)=>{if(St||!_t)return G(St,_t);let it;if(this.fetching[q]){const{rawTileData:bt,cacheControl:jt,resourceTiming:Zt}=this.fetching[q];delete this.fetching[q],it=a.e({rawTileData:bt.slice(0)},_t,jt,Zt)}else it=_t;G(null,it)}):ot.status==="done"&&(ot.vectorTile?ot.parse(ot.vectorTile,this.layerIndex,this.availableImages,this.actor,G):G())}}abortTile(B,G){const J=this.loading,q=B.uid;J&&J[q]&&J[q].abort&&(J[q].abort(),delete J[q]),G()}removeTile(B,G){const J=this.loaded,q=B.uid;J&&J[q]&&delete J[q],G()}}class F{constructor(){this.loaded={}}loadTile(B,G){return a._(this,void 0,void 0,function*(){const{uid:J,encoding:q,rawImageData:ot,redFactor:St,greenFactor:_t,blueFactor:it,baseShift:bt}=B,jt=ot.width+2,Zt=ot.height+2,Xt=a.a(ot)?new a.R({width:jt,height:Zt},yield a.bx(ot,-1,-1,jt,Zt)):ot,Pe=new a.by(J,Xt,q,St,_t,it,bt);this.loaded=this.loaded||{},this.loaded[J]=Pe,G(null,Pe)})}removeTile(B){const G=this.loaded,J=B.uid;G&&G[J]&&delete G[J]}}function K(st,B){if(st.length!==0){W(st[0],B);for(var G=1;G<st.length;G++)W(st[G],!B)}}function W(st,B){for(var G=0,J=0,q=0,ot=st.length,St=ot-1;q<ot;St=q++){var _t=(st[q][0]-st[St][0])*(st[St][1]+st[q][1]),it=G+_t;J+=Math.abs(G)>=Math.abs(_t)?G-it+_t:_t-it+G,G=it}G+J>=0!=!!B&&st.reverse()}var Q=a.bz(function st(B,G){var J,q=B&&B.type;if(q==="FeatureCollection")for(J=0;J<B.features.length;J++)st(B.features[J],G);else if(q==="GeometryCollection")for(J=0;J<B.geometries.length;J++)st(B.geometries[J],G);else if(q==="Feature")st(B.geometry,G);else if(q==="Polygon")K(B.coordinates,G);else if(q==="MultiPolygon")for(J=0;J<B.coordinates.length;J++)K(B.coordinates[J],G);return B});const U=a.bw.VectorTileFeature.prototype.toGeoJSON;var X={exports:{}},Y=a.bA,pt=a.bw.VectorTileFeature,gt=ct;function ct(st,B){this.options=B||{},this.features=st,this.length=st.length}function ht(st,B){this.id=typeof st.id=="number"?st.id:void 0,this.type=st.type,this.rawGeometry=st.type===1?[st.geometry]:st.geometry,this.properties=st.tags,this.extent=B||4096}ct.prototype.feature=function(st){return new ht(this.features[st],this.options.extent)},ht.prototype.loadGeometry=function(){var st=this.rawGeometry;this.geometry=[];for(var B=0;B<st.length;B++){for(var G=st[B],J=[],q=0;q<G.length;q++)J.push(new Y(G[q][0],G[q][1]));this.geometry.push(J)}return this.geometry},ht.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var st=this.geometry,B=1/0,G=-1/0,J=1/0,q=-1/0,ot=0;ot<st.length;ot++)for(var St=st[ot],_t=0;_t<St.length;_t++){var it=St[_t];B=Math.min(B,it.x),G=Math.max(G,it.x),J=Math.min(J,it.y),q=Math.max(q,it.y)}return[B,J,G,q]},ht.prototype.toGeoJSON=pt.prototype.toGeoJSON;var rt=a.bB,Et=gt;function mt(st){var B=new rt;return function(G,J){for(var q in G.layers)J.writeMessage(3,dt,G.layers[q])}(st,B),B.finish()}function dt(st,B){var G;B.writeVarintField(15,st.version||1),B.writeStringField(1,st.name||""),B.writeVarintField(5,st.extent||4096);var J={keys:[],values:[],keycache:{},valuecache:{}};for(G=0;G<st.length;G++)J.feature=st.feature(G),B.writeMessage(2,Jt,J);var q=J.keys;for(G=0;G<q.length;G++)B.writeStringField(3,q[G]);var ot=J.values;for(G=0;G<ot.length;G++)B.writeMessage(4,ce,ot[G])}function Jt(st,B){var G=st.feature;G.id!==void 0&&B.writeVarintField(1,G.id),B.writeMessage(2,kt,st),B.writeVarintField(3,G.type),B.writeMessage(4,be,G)}function kt(st,B){var G=st.feature,J=st.keys,q=st.values,ot=st.keycache,St=st.valuecache;for(var _t in G.properties){var it=G.properties[_t],bt=ot[_t];if(it!==null){bt===void 0&&(J.push(_t),ot[_t]=bt=J.length-1),B.writeVarint(bt);var jt=typeof it;jt!=="string"&&jt!=="boolean"&&jt!=="number"&&(it=JSON.stringify(it));var Zt=jt+":"+it,Xt=St[Zt];Xt===void 0&&(q.push(it),St[Zt]=Xt=q.length-1),B.writeVarint(Xt)}}}function Gt(st,B){return(B<<3)+(7&st)}function Kt(st){return st<<1^st>>31}function be(st,B){for(var G=st.loadGeometry(),J=st.type,q=0,ot=0,St=G.length,_t=0;_t<St;_t++){var it=G[_t],bt=1;J===1&&(bt=it.length),B.writeVarint(Gt(1,bt));for(var jt=J===3?it.length-1:it.length,Zt=0;Zt<jt;Zt++){Zt===1&&J!==1&&B.writeVarint(Gt(2,jt-1));var Xt=it[Zt].x-q,Pe=it[Zt].y-ot;B.writeVarint(Kt(Xt)),B.writeVarint(Kt(Pe)),q+=Xt,ot+=Pe}J===3&&B.writeVarint(Gt(7,1))}}function ce(st,B){var G=typeof st;G==="string"?B.writeStringField(1,st):G==="boolean"?B.writeBooleanField(7,st):G==="number"&&(st%1!=0?B.writeDoubleField(3,st):st<0?B.writeSVarintField(6,st):B.writeVarintField(5,st))}X.exports=mt,X.exports.fromVectorTileJs=mt,X.exports.fromGeojsonVt=function(st,B){B=B||{};var G={};for(var J in st)G[J]=new Et(st[J].features,B),G[J].name=J,G[J].version=B.version,G[J].extent=B.extent;return mt({layers:G})},X.exports.GeoJSONWrapper=Et;var $e=a.bz(X.exports);const jn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:st=>st},Ze=Math.fround||(ze=new Float32Array(1),st=>(ze[0]=+st,ze[0]));var ze;const Ue=3,dn=5,Jn=6;class Zn{constructor(B){this.options=Object.assign(Object.create(jn),B),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(B){const{log:G,minZoom:J,maxZoom:q}=this.options;G&&console.time("total time");const ot=`prepare ${B.length} points`;G&&console.time(ot),this.points=B;const St=[];for(let it=0;it<B.length;it++){const bt=B[it];if(!bt.geometry)continue;const[jt,Zt]=bt.geometry.coordinates,Xt=Ze(fn(jt)),Pe=Ze(Un(Zt));St.push(Xt,Pe,1/0,it,-1,1),this.options.reduce&&St.push(0)}let _t=this.trees[q+1]=this._createTree(St);G&&console.timeEnd(ot);for(let it=q;it>=J;it--){const bt=+Date.now();_t=this.trees[it]=this._createTree(this._cluster(_t,it)),G&&console.log("z%d: %d clusters in %dms",it,_t.numItems,+Date.now()-bt)}return G&&console.timeEnd("total time"),this}getClusters(B,G){let J=((B[0]+180)%360+360)%360-180;const q=Math.max(-90,Math.min(90,B[1]));let ot=B[2]===180?180:((B[2]+180)%360+360)%360-180;const St=Math.max(-90,Math.min(90,B[3]));if(B[2]-B[0]>=360)J=-180,ot=180;else if(J>ot){const Zt=this.getClusters([J,q,180,St],G),Xt=this.getClusters([-180,q,ot,St],G);return Zt.concat(Xt)}const _t=this.trees[this._limitZoom(G)],it=_t.range(fn(J),Un(St),fn(ot),Un(q)),bt=_t.data,jt=[];for(const Zt of it){const Xt=this.stride*Zt;jt.push(bt[Xt+dn]>1?re(bt,Xt,this.clusterProps):this.points[bt[Xt+Ue]])}return jt}getChildren(B){const G=this._getOriginId(B),J=this._getOriginZoom(B),q="No cluster with the specified id.",ot=this.trees[J];if(!ot)throw new Error(q);const St=ot.data;if(G*this.stride>=St.length)throw new Error(q);const _t=this.options.radius/(this.options.extent*Math.pow(2,J-1)),it=ot.within(St[G*this.stride],St[G*this.stride+1],_t),bt=[];for(const jt of it){const Zt=jt*this.stride;St[Zt+4]===B&&bt.push(St[Zt+dn]>1?re(St,Zt,this.clusterProps):this.points[St[Zt+Ue]])}if(bt.length===0)throw new Error(q);return bt}getLeaves(B,G,J){const q=[];return this._appendLeaves(q,B,G=G||10,J=J||0,0),q}getTile(B,G,J){const q=this.trees[this._limitZoom(B)],ot=Math.pow(2,B),{extent:St,radius:_t}=this.options,it=_t/St,bt=(J-it)/ot,jt=(J+1+it)/ot,Zt={features:[]};return this._addTileFeatures(q.range((G-it)/ot,bt,(G+1+it)/ot,jt),q.data,G,J,ot,Zt),G===0&&this._addTileFeatures(q.range(1-it/ot,bt,1,jt),q.data,ot,J,ot,Zt),G===ot-1&&this._addTileFeatures(q.range(0,bt,it/ot,jt),q.data,-1,J,ot,Zt),Zt.features.length?Zt:null}getClusterExpansionZoom(B){let G=this._getOriginZoom(B)-1;for(;G<=this.options.maxZoom;){const J=this.getChildren(B);if(G++,J.length!==1)break;B=J[0].properties.cluster_id}return G}_appendLeaves(B,G,J,q,ot){const St=this.getChildren(G);for(const _t of St){const it=_t.properties;if(it&&it.cluster?ot+it.point_count<=q?ot+=it.point_count:ot=this._appendLeaves(B,it.cluster_id,J,q,ot):ot<q?ot++:B.push(_t),B.length===J)break}return ot}_createTree(B){const G=new a.av(B.length/this.stride|0,this.options.nodeSize,Float32Array);for(let J=0;J<B.length;J+=this.stride)G.add(B[J],B[J+1]);return G.finish(),G.data=B,G}_addTileFeatures(B,G,J,q,ot,St){for(const _t of B){const it=_t*this.stride,bt=G[it+dn]>1;let jt,Zt,Xt;if(bt)jt=Be(G,it,this.clusterProps),Zt=G[it],Xt=G[it+1];else{const Ie=this.points[G[it+Ue]];jt=Ie.properties;const[Fe,nn]=Ie.geometry.coordinates;Zt=fn(Fe),Xt=Un(nn)}const Pe={type:1,geometry:[[Math.round(this.options.extent*(Zt*ot-J)),Math.round(this.options.extent*(Xt*ot-q))]],tags:jt};let Ye;Ye=bt||this.options.generateId?G[it+Ue]:this.points[G[it+Ue]].id,Ye!==void 0&&(Pe.id=Ye),St.features.push(Pe)}}_limitZoom(B){return Math.max(this.options.minZoom,Math.min(Math.floor(+B),this.options.maxZoom+1))}_cluster(B,G){const{radius:J,extent:q,reduce:ot,minPoints:St}=this.options,_t=J/(q*Math.pow(2,G)),it=B.data,bt=[],jt=this.stride;for(let Zt=0;Zt<it.length;Zt+=jt){if(it[Zt+2]<=G)continue;it[Zt+2]=G;const Xt=it[Zt],Pe=it[Zt+1],Ye=B.within(it[Zt],it[Zt+1],_t),Ie=it[Zt+dn];let Fe=Ie;for(const nn of Ye){const qn=nn*jt;it[qn+2]>G&&(Fe+=it[qn+dn])}if(Fe>Ie&&Fe>=St){let nn,qn=Xt*Ie,Qn=Pe*Ie,An=-1;const Pn=((Zt/jt|0)<<5)+(G+1)+this.points.length;for(const Hr of Ye){const oi=Hr*jt;if(it[oi+2]<=G)continue;it[oi+2]=G;const sr=it[oi+dn];qn+=it[oi]*sr,Qn+=it[oi+1]*sr,it[oi+4]=Pn,ot&&(nn||(nn=this._map(it,Zt,!0),An=this.clusterProps.length,this.clusterProps.push(nn)),ot(nn,this._map(it,oi)))}it[Zt+4]=Pn,bt.push(qn/Fe,Qn/Fe,1/0,Pn,-1,Fe),ot&&bt.push(An)}else{for(let nn=0;nn<jt;nn++)bt.push(it[Zt+nn]);if(Fe>1)for(const nn of Ye){const qn=nn*jt;if(!(it[qn+2]<=G)){it[qn+2]=G;for(let Qn=0;Qn<jt;Qn++)bt.push(it[qn+Qn])}}}}return bt}_getOriginId(B){return B-this.points.length>>5}_getOriginZoom(B){return(B-this.points.length)%32}_map(B,G,J){if(B[G+dn]>1){const St=this.clusterProps[B[G+Jn]];return J?Object.assign({},St):St}const q=this.points[B[G+Ue]].properties,ot=this.options.map(q);return J&&ot===q?Object.assign({},ot):ot}}function re(st,B,G){return{type:"Feature",id:st[B+Ue],properties:Be(st,B,G),geometry:{type:"Point",coordinates:[(J=st[B],360*(J-.5)),ur(st[B+1])]}};var J}function Be(st,B,G){const J=st[B+dn],q=J>=1e4?`${Math.round(J/1e3)}k`:J>=1e3?Math.round(J/100)/10+"k":J,ot=st[B+Jn],St=ot===-1?{}:Object.assign({},G[ot]);return Object.assign(St,{cluster:!0,cluster_id:st[B+Ue],point_count:J,point_count_abbreviated:q})}function fn(st){return st/360+.5}function Un(st){const B=Math.sin(st*Math.PI/180),G=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return G<0?0:G>1?1:G}function ur(st){const B=(180-360*st)*Math.PI/180;return 360*Math.atan(Math.exp(B))/Math.PI-90}function Ai(st,B,G,J){for(var q,ot=J,St=G-B>>1,_t=G-B,it=st[B],bt=st[B+1],jt=st[G],Zt=st[G+1],Xt=B+3;Xt<G;Xt+=3){var Pe=wt(st[Xt],st[Xt+1],it,bt,jt,Zt);if(Pe>ot)q=Xt,ot=Pe;else if(Pe===ot){var Ye=Math.abs(Xt-St);Ye<_t&&(q=Xt,_t=Ye)}}ot>J&&(q-B>3&&Ai(st,B,q,J),st[q+2]=ot,G-q>3&&Ai(st,q,G,J))}function wt(st,B,G,J,q,ot){var St=q-G,_t=ot-J;if(St!==0||_t!==0){var it=((st-G)*St+(B-J)*_t)/(St*St+_t*_t);it>1?(G=q,J=ot):it>0&&(G+=St*it,J+=_t*it)}return(St=st-G)*St+(_t=B-J)*_t}function De(st,B,G,J){var q={id:st===void 0?null:st,type:B,geometry:G,tags:J,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ot){var St=ot.geometry,_t=ot.type;if(_t==="Point"||_t==="MultiPoint"||_t==="LineString")Ve(ot,St);else if(_t==="Polygon"||_t==="MultiLineString")for(var it=0;it<St.length;it++)Ve(ot,St[it]);else if(_t==="MultiPolygon")for(it=0;it<St.length;it++)for(var bt=0;bt<St[it].length;bt++)Ve(ot,St[it][bt])}(q),q}function Ve(st,B){for(var G=0;G<B.length;G+=3)st.minX=Math.min(st.minX,B[G]),st.minY=Math.min(st.minY,B[G+1]),st.maxX=Math.max(st.maxX,B[G]),st.maxY=Math.max(st.maxY,B[G+1])}function ki(st,B,G,J){if(B.geometry){var q=B.geometry.coordinates,ot=B.geometry.type,St=Math.pow(G.tolerance/((1<<G.maxZoom)*G.extent),2),_t=[],it=B.id;if(G.promoteId?it=B.properties[G.promoteId]:G.generateId&&(it=J||0),ot==="Point")On(q,_t);else if(ot==="MultiPoint")for(var bt=0;bt<q.length;bt++)On(q[bt],_t);else if(ot==="LineString")tn(q,_t,St,!1);else if(ot==="MultiLineString"){if(G.lineMetrics){for(bt=0;bt<q.length;bt++)tn(q[bt],_t=[],St,!1),st.push(De(it,"LineString",_t,B.properties));return}Gn(q,_t,St,!1)}else if(ot==="Polygon")Gn(q,_t,St,!0);else{if(ot!=="MultiPolygon"){if(ot==="GeometryCollection"){for(bt=0;bt<B.geometry.geometries.length;bt++)ki(st,{id:it,geometry:B.geometry.geometries[bt],properties:B.properties},G,J);return}throw new Error("Input data is not a valid GeoJSON object.")}for(bt=0;bt<q.length;bt++){var jt=[];Gn(q[bt],jt,St,!0),_t.push(jt)}}st.push(De(it,ot,_t,B.properties))}}function On(st,B){B.push(qt(st[0])),B.push(mi(st[1])),B.push(0)}function tn(st,B,G,J){for(var q,ot,St=0,_t=0;_t<st.length;_t++){var it=qt(st[_t][0]),bt=mi(st[_t][1]);B.push(it),B.push(bt),B.push(0),_t>0&&(St+=J?(q*bt-it*ot)/2:Math.sqrt(Math.pow(it-q,2)+Math.pow(bt-ot,2))),q=it,ot=bt}var jt=B.length-3;B[2]=1,Ai(B,0,jt,G),B[jt+2]=1,B.size=Math.abs(St),B.start=0,B.end=B.size}function Gn(st,B,G,J){for(var q=0;q<st.length;q++){var ot=[];tn(st[q],ot,G,J),B.push(ot)}}function qt(st){return st/360+.5}function mi(st){var B=Math.sin(st*Math.PI/180),G=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return G<0?0:G>1?1:G}function qi(st,B,G,J,q,ot,St,_t){if(J/=B,ot>=(G/=B)&&St<J)return st;if(St<G||ot>=J)return null;for(var it=[],bt=0;bt<st.length;bt++){var jt=st[bt],Zt=jt.geometry,Xt=jt.type,Pe=q===0?jt.minX:jt.minY,Ye=q===0?jt.maxX:jt.maxY;if(Pe>=G&&Ye<J)it.push(jt);else if(!(Ye<G||Pe>=J)){var Ie=[];if(Xt==="Point"||Xt==="MultiPoint")In(Zt,Ie,G,J,q);else if(Xt==="LineString")en(Zt,Ie,G,J,q,!1,_t.lineMetrics);else if(Xt==="MultiLineString")or(Zt,Ie,G,J,q,!1);else if(Xt==="Polygon")or(Zt,Ie,G,J,q,!0);else if(Xt==="MultiPolygon")for(var Fe=0;Fe<Zt.length;Fe++){var nn=[];or(Zt[Fe],nn,G,J,q,!0),nn.length&&Ie.push(nn)}if(Ie.length){if(_t.lineMetrics&&Xt==="LineString"){for(Fe=0;Fe<Ie.length;Fe++)it.push(De(jt.id,Xt,Ie[Fe],jt.tags));continue}Xt!=="LineString"&&Xt!=="MultiLineString"||(Ie.length===1?(Xt="LineString",Ie=Ie[0]):Xt="MultiLineString"),Xt!=="Point"&&Xt!=="MultiPoint"||(Xt=Ie.length===3?"Point":"MultiPoint"),it.push(De(jt.id,Xt,Ie,jt.tags))}}}return it.length?it:null}function In(st,B,G,J,q){for(var ot=0;ot<st.length;ot+=3){var St=st[ot+q];St>=G&&St<=J&&(B.push(st[ot]),B.push(st[ot+1]),B.push(st[ot+2]))}}function en(st,B,G,J,q,ot,St){for(var _t,it,bt=uo(st),jt=q===0?ii:vn,Zt=st.start,Xt=0;Xt<st.length-3;Xt+=3){var Pe=st[Xt],Ye=st[Xt+1],Ie=st[Xt+2],Fe=st[Xt+3],nn=st[Xt+4],qn=q===0?Pe:Ye,Qn=q===0?Fe:nn,An=!1;St&&(_t=Math.sqrt(Math.pow(Pe-Fe,2)+Math.pow(Ye-nn,2))),qn<G?Qn>G&&(it=jt(bt,Pe,Ye,Fe,nn,G),St&&(bt.start=Zt+_t*it)):qn>J?Qn<J&&(it=jt(bt,Pe,Ye,Fe,nn,J),St&&(bt.start=Zt+_t*it)):Ni(bt,Pe,Ye,Ie),Qn<G&&qn>=G&&(it=jt(bt,Pe,Ye,Fe,nn,G),An=!0),Qn>J&&qn<=J&&(it=jt(bt,Pe,Ye,Fe,nn,J),An=!0),!ot&&An&&(St&&(bt.end=Zt+_t*it),B.push(bt),bt=uo(st)),St&&(Zt+=_t)}var Pn=st.length-3;Pe=st[Pn],Ye=st[Pn+1],Ie=st[Pn+2],(qn=q===0?Pe:Ye)>=G&&qn<=J&&Ni(bt,Pe,Ye,Ie),Pn=bt.length-3,ot&&Pn>=3&&(bt[Pn]!==bt[0]||bt[Pn+1]!==bt[1])&&Ni(bt,bt[0],bt[1],bt[2]),bt.length&&B.push(bt)}function uo(st){var B=[];return B.size=st.size,B.start=st.start,B.end=st.end,B}function or(st,B,G,J,q,ot){for(var St=0;St<st.length;St++)en(st[St],B,G,J,q,ot,!1)}function Ni(st,B,G,J){st.push(B),st.push(G),st.push(J)}function ii(st,B,G,J,q,ot){var St=(ot-B)/(J-B);return st.push(ot),st.push(G+(q-G)*St),st.push(1),St}function vn(st,B,G,J,q,ot){var St=(ot-G)/(q-G);return st.push(B+(J-B)*St),st.push(ot),st.push(1),St}function gi(st,B){for(var G=[],J=0;J<st.length;J++){var q,ot=st[J],St=ot.type;if(St==="Point"||St==="MultiPoint"||St==="LineString")q=wa(ot.geometry,B);else if(St==="MultiLineString"||St==="Polygon"){q=[];for(var _t=0;_t<ot.geometry.length;_t++)q.push(wa(ot.geometry[_t],B))}else if(St==="MultiPolygon")for(q=[],_t=0;_t<ot.geometry.length;_t++){for(var it=[],bt=0;bt<ot.geometry[_t].length;bt++)it.push(wa(ot.geometry[_t][bt],B));q.push(it)}G.push(De(ot.id,St,q,ot.tags))}return G}function wa(st,B){var G=[];G.size=st.size,st.start!==void 0&&(G.start=st.start,G.end=st.end);for(var J=0;J<st.length;J+=3)G.push(st[J]+B,st[J+1],st[J+2]);return G}function ae(st,B){if(st.transformed)return st;var G,J,q,ot=1<<st.z,St=st.x,_t=st.y;for(G=0;G<st.features.length;G++){var it=st.features[G],bt=it.geometry,jt=it.type;if(it.geometry=[],jt===1)for(J=0;J<bt.length;J+=2)it.geometry.push(wo(bt[J],bt[J+1],B,ot,St,_t));else for(J=0;J<bt.length;J++){var Zt=[];for(q=0;q<bt[J].length;q+=2)Zt.push(wo(bt[J][q],bt[J][q+1],B,ot,St,_t));it.geometry.push(Zt)}}return st.transformed=!0,st}function wo(st,B,G,J,q,ot){return[Math.round(G*(st*J-q)),Math.round(G*(B*J-ot))]}function ri(st,B,G,J,q){for(var ot=B===q.maxZoom?0:q.tolerance/((1<<B)*q.extent),St={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:G,y:J,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},_t=0;_t<st.length;_t++){St.numFeatures++,Sa(St,st[_t],ot,q);var it=st[_t].minX,bt=st[_t].minY,jt=st[_t].maxX,Zt=st[_t].maxY;it<St.minX&&(St.minX=it),bt<St.minY&&(St.minY=bt),jt>St.maxX&&(St.maxX=jt),Zt>St.maxY&&(St.maxY=Zt)}return St}function Sa(st,B,G,J){var q=B.geometry,ot=B.type,St=[];if(ot==="Point"||ot==="MultiPoint")for(var _t=0;_t<q.length;_t+=3)St.push(q[_t]),St.push(q[_t+1]),st.numPoints++,st.numSimplified++;else if(ot==="LineString")Ss(St,q,st,G,!1,!1);else if(ot==="MultiLineString"||ot==="Polygon")for(_t=0;_t<q.length;_t++)Ss(St,q[_t],st,G,ot==="Polygon",_t===0);else if(ot==="MultiPolygon")for(var it=0;it<q.length;it++){var bt=q[it];for(_t=0;_t<bt.length;_t++)Ss(St,bt[_t],st,G,!0,_t===0)}if(St.length){var jt=B.tags||null;if(ot==="LineString"&&J.lineMetrics){for(var Zt in jt={},B.tags)jt[Zt]=B.tags[Zt];jt.mapbox_clip_start=q.start/q.size,jt.mapbox_clip_end=q.end/q.size}var Xt={geometry:St,type:ot==="Polygon"||ot==="MultiPolygon"?3:ot==="LineString"||ot==="MultiLineString"?2:1,tags:jt};B.id!==null&&(Xt.id=B.id),st.features.push(Xt)}}function Ss(st,B,G,J,q,ot){var St=J*J;if(J>0&&B.size<(q?St:J))G.numPoints+=B.length/3;else{for(var _t=[],it=0;it<B.length;it+=3)(J===0||B[it+2]>St)&&(G.numSimplified++,_t.push(B[it]),_t.push(B[it+1])),G.numPoints++;q&&function(bt,jt){for(var Zt=0,Xt=0,Pe=bt.length,Ye=Pe-2;Xt<Pe;Ye=Xt,Xt+=2)Zt+=(bt[Xt]-bt[Ye])*(bt[Xt+1]+bt[Ye+1]);if(Zt>0===jt)for(Xt=0,Pe=bt.length;Xt<Pe/2;Xt+=2){var Ie=bt[Xt],Fe=bt[Xt+1];bt[Xt]=bt[Pe-2-Xt],bt[Xt+1]=bt[Pe-1-Xt],bt[Pe-2-Xt]=Ie,bt[Pe-1-Xt]=Fe}}(_t,ot),st.push(_t)}}function ue(st,B){var G=(B=this.options=function(q,ot){for(var St in ot)q[St]=ot[St];return q}(Object.create(this.options),B)).debug;if(G&&console.time("preprocess data"),B.maxZoom<0||B.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(B.promoteId&&B.generateId)throw new Error("promoteId and generateId cannot be used together.");var J=function(q,ot){var St=[];if(q.type==="FeatureCollection")for(var _t=0;_t<q.features.length;_t++)ki(St,q.features[_t],ot,_t);else ki(St,q.type==="Feature"?q:{geometry:q},ot);return St}(st,B);this.tiles={},this.tileCoords=[],G&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",B.indexMaxZoom,B.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),J=function(q,ot){var St=ot.buffer/ot.extent,_t=q,it=qi(q,1,-1-St,St,0,-1,2,ot),bt=qi(q,1,1-St,2+St,0,-1,2,ot);return(it||bt)&&(_t=qi(q,1,-St,1+St,0,-1,2,ot)||[],it&&(_t=gi(it,1).concat(_t)),bt&&(_t=_t.concat(gi(bt,-1)))),_t}(J,B),J.length&&this.splitTile(J,0,0,0),G&&(J.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ln(st,B,G){return 32*((1<<st)*G+B)+st}function Ke(st,B){return B?st.properties[B]:st.id}function Pr(st,B){if(st==null)return!0;if(st.type==="Feature")return Ke(st,B)!=null;if(st.type==="FeatureCollection"){const G=new Set;for(const J of st.features){const q=Ke(J,B);if(q==null||G.has(q))return!1;G.add(q)}return!0}return!1}function is(st,B){const G=new Map;if(st!=null)if(st.type==="Feature")G.set(Ke(st,B),st);else for(const J of st.features)G.set(Ke(J,B),J);return G}ue.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ue.prototype.splitTile=function(st,B,G,J,q,ot,St){for(var _t=[st,B,G,J],it=this.options,bt=it.debug;_t.length;){J=_t.pop(),G=_t.pop(),B=_t.pop(),st=_t.pop();var jt=1<<B,Zt=ln(B,G,J),Xt=this.tiles[Zt];if(!Xt&&(bt>1&&console.time("creation"),Xt=this.tiles[Zt]=ri(st,B,G,J,it),this.tileCoords.push({z:B,x:G,y:J}),bt)){bt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",B,G,J,Xt.numFeatures,Xt.numPoints,Xt.numSimplified),console.timeEnd("creation"));var Pe="z"+B;this.stats[Pe]=(this.stats[Pe]||0)+1,this.total++}if(Xt.source=st,q){if(B===it.maxZoom||B===q)continue;var Ye=1<<q-B;if(G!==Math.floor(ot/Ye)||J!==Math.floor(St/Ye))continue}else if(B===it.indexMaxZoom||Xt.numPoints<=it.indexMaxPoints)continue;if(Xt.source=null,st.length!==0){bt>1&&console.time("clipping");var Ie,Fe,nn,qn,Qn,An,Pn=.5*it.buffer/it.extent,Hr=.5-Pn,oi=.5+Pn,sr=1+Pn;Ie=Fe=nn=qn=null,Qn=qi(st,jt,G-Pn,G+oi,0,Xt.minX,Xt.maxX,it),An=qi(st,jt,G+Hr,G+sr,0,Xt.minX,Xt.maxX,it),st=null,Qn&&(Ie=qi(Qn,jt,J-Pn,J+oi,1,Xt.minY,Xt.maxY,it),Fe=qi(Qn,jt,J+Hr,J+sr,1,Xt.minY,Xt.maxY,it),Qn=null),An&&(nn=qi(An,jt,J-Pn,J+oi,1,Xt.minY,Xt.maxY,it),qn=qi(An,jt,J+Hr,J+sr,1,Xt.minY,Xt.maxY,it),An=null),bt>1&&console.timeEnd("clipping"),_t.push(Ie||[],B+1,2*G,2*J),_t.push(Fe||[],B+1,2*G,2*J+1),_t.push(nn||[],B+1,2*G+1,2*J),_t.push(qn||[],B+1,2*G+1,2*J+1)}}},ue.prototype.getTile=function(st,B,G){var J=this.options,q=J.extent,ot=J.debug;if(st<0||st>24)return null;var St=1<<st,_t=ln(st,B=(B%St+St)%St,G);if(this.tiles[_t])return ae(this.tiles[_t],q);ot>1&&console.log("drilling down to z%d-%d-%d",st,B,G);for(var it,bt=st,jt=B,Zt=G;!it&&bt>0;)bt--,jt=Math.floor(jt/2),Zt=Math.floor(Zt/2),it=this.tiles[ln(bt,jt,Zt)];return it&&it.source?(ot>1&&console.log("found parent tile z%d-%d-%d",bt,jt,Zt),ot>1&&console.time("drilling down"),this.splitTile(it.source,bt,jt,Zt,st,B,G),ot>1&&console.timeEnd("drilling down"),this.tiles[_t]?ae(this.tiles[_t],q):null):null};class on extends D{constructor(B,G,J,q){super(B,G,J),this._dataUpdateable=new Map,this.loadGeoJSON=(ot,St)=>{const{promoteId:_t}=ot;if(ot.request)return a.f(ot.request,(it,bt,jt,Zt)=>{this._dataUpdateable=Pr(bt,_t)?is(bt,_t):void 0,St(it,bt,jt,Zt)});if(typeof ot.data=="string")try{const it=JSON.parse(ot.data);this._dataUpdateable=Pr(it,_t)?is(it,_t):void 0,St(null,it)}catch{St(new Error(`Input data given to '${ot.source}' is not a valid GeoJSON object.`))}else ot.dataDiff?this._dataUpdateable?(function(it,bt,jt){var Zt,Xt,Pe,Ye;if(bt.removeAll&&it.clear(),bt.remove)for(const Ie of bt.remove)it.delete(Ie);if(bt.add)for(const Ie of bt.add){const Fe=Ke(Ie,jt);Fe!=null&&it.set(Fe,Ie)}if(bt.update)for(const Ie of bt.update){let Fe=it.get(Ie.id);if(Fe==null)continue;const nn=!Ie.removeAllProperties&&(((Zt=Ie.removeProperties)===null||Zt===void 0?void 0:Zt.length)>0||((Xt=Ie.addOrUpdateProperties)===null||Xt===void 0?void 0:Xt.length)>0);if((Ie.newGeometry||Ie.removeAllProperties||nn)&&(Fe=Object.assign({},Fe),it.set(Ie.id,Fe),nn&&(Fe.properties=Object.assign({},Fe.properties))),Ie.newGeometry&&(Fe.geometry=Ie.newGeometry),Ie.removeAllProperties)Fe.properties={};else if(((Pe=Ie.removeProperties)===null||Pe===void 0?void 0:Pe.length)>0)for(const qn of Ie.removeProperties)Object.prototype.hasOwnProperty.call(Fe.properties,qn)&&delete Fe.properties[qn];if(((Ye=Ie.addOrUpdateProperties)===null||Ye===void 0?void 0:Ye.length)>0)for(const{key:qn,value:Qn}of Ie.addOrUpdateProperties)Fe.properties[qn]=Qn}}(this._dataUpdateable,ot.dataDiff,_t),St(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):St(new Error(`Cannot update existing geojson data in ${ot.source}`)):St(new Error(`Input data given to '${ot.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,q&&(this.loadGeoJSON=q)}loadGeoJSONTile(B,G){const J=B.tileID.canonical;if(!this._geoJSONIndex)return G(null,null);const q=this._geoJSONIndex.getTile(J.z,J.x,J.y);if(!q)return G(null,null);const ot=new class{constructor(_t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.N,this.length=_t.length,this._features=_t}feature(_t){return new class{constructor(it){this._feature=it,this.extent=a.N,this.type=it.type,this.properties=it.tags,"id"in it&&!isNaN(it.id)&&(this.id=parseInt(it.id,10))}loadGeometry(){if(this._feature.type===1){const it=[];for(const bt of this._feature.geometry)it.push([new a.P(bt[0],bt[1])]);return it}{const it=[];for(const bt of this._feature.geometry){const jt=[];for(const Zt of bt)jt.push(new a.P(Zt[0],Zt[1]));it.push(jt)}return it}}toGeoJSON(it,bt,jt){return U.call(this,it,bt,jt)}}(this._features[_t])}}(q.features);let St=$e(ot);St.byteOffset===0&&St.byteLength===St.buffer.byteLength||(St=new Uint8Array(St)),G(null,{vectorTile:ot,rawData:St.buffer})}loadData(B,G){var J;(J=this._pendingRequest)===null||J===void 0||J.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const q=!!(B&&B.request&&B.request.collectResourceTiming)&&new a.bu(B.request);this._pendingCallback=G,this._pendingRequest=this.loadGeoJSON(B,(ot,St)=>{if(delete this._pendingCallback,delete this._pendingRequest,ot||!St)return G(ot);if(typeof St!="object")return G(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));{Q(St,!0);try{if(B.filter){const it=a.bC(B.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(it.result==="error")throw new Error(it.value.map(jt=>`${jt.key}: ${jt.message}`).join(", "));St={type:"FeatureCollection",features:St.features.filter(jt=>it.value.evaluate({zoom:0},jt))}}this._geoJSONIndex=B.cluster?new Zn(function({superclusterOptions:it,clusterProperties:bt}){if(!bt||!it)return it;const jt={},Zt={},Xt={accumulated:null,zoom:0},Pe={properties:null},Ye=Object.keys(bt);for(const Ie of Ye){const[Fe,nn]=bt[Ie],qn=a.bC(nn),Qn=a.bC(typeof Fe=="string"?[Fe,["accumulated"],["get",Ie]]:Fe);jt[Ie]=qn.value,Zt[Ie]=Qn.value}return it.map=Ie=>{Pe.properties=Ie;const Fe={};for(const nn of Ye)Fe[nn]=jt[nn].evaluate(Xt,Pe);return Fe},it.reduce=(Ie,Fe)=>{Pe.properties=Fe;for(const nn of Ye)Xt.accumulated=Ie[nn],Ie[nn]=Zt[nn].evaluate(Xt,Pe)},it}(B)).load(St.features):function(it,bt){return new ue(it,bt)}(St,B.geojsonVtOptions)}catch(it){return G(it)}this.loaded={};const _t={};if(q){const it=q.finish();it&&(_t.resourceTiming={},_t.resourceTiming[B.source]=JSON.parse(JSON.stringify(it)))}G(null,_t)}})}reloadTile(B,G){const J=this.loaded;return J&&J[B.uid]?super.reloadTile(B,G):this.loadTile(B,G)}removeSource(B,G){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),G()}getClusterExpansionZoom(B,G){try{G(null,this._geoJSONIndex.getClusterExpansionZoom(B.clusterId))}catch(J){G(J)}}getClusterChildren(B,G){try{G(null,this._geoJSONIndex.getChildren(B.clusterId))}catch(J){G(J)}}getClusterLeaves(B,G){try{G(null,this._geoJSONIndex.getLeaves(B.clusterId,B.limit,B.offset))}catch(J){G(J)}}}class Es{constructor(B){this.self=B,this.actor=new a.C(B,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:D,geojson:on},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(G,J)=>{if(this.workerSourceTypes[G])throw new Error(`Worker source with name "${G}" already registered.`);this.workerSourceTypes[G]=J},this.self.registerRTLTextPlugin=G=>{if(a.bD.isParsed())throw new Error("RTL text plugin already registered.");a.bD.applyArabicShaping=G.applyArabicShaping,a.bD.processBidirectionalText=G.processBidirectionalText,a.bD.processStyledBidirectionalText=G.processStyledBidirectionalText}}setReferrer(B,G){this.referrer=G}setImages(B,G,J){this.availableImages[B]=G;for(const q in this.workerSources[B]){const ot=this.workerSources[B][q];for(const St in ot)ot[St].availableImages=G}J()}setLayers(B,G,J){this.getLayerIndex(B).replace(G),J()}updateLayers(B,G,J){this.getLayerIndex(B).update(G.layers,G.removedIds),J()}loadTile(B,G,J){this.getWorkerSource(B,G.type,G.source).loadTile(G,J)}loadDEMTile(B,G,J){this.getDEMWorkerSource(B,G.source).loadTile(G,J)}reloadTile(B,G,J){this.getWorkerSource(B,G.type,G.source).reloadTile(G,J)}abortTile(B,G,J){this.getWorkerSource(B,G.type,G.source).abortTile(G,J)}removeTile(B,G,J){this.getWorkerSource(B,G.type,G.source).removeTile(G,J)}removeDEMTile(B,G){this.getDEMWorkerSource(B,G.source).removeTile(G)}removeSource(B,G,J){if(!this.workerSources[B]||!this.workerSources[B][G.type]||!this.workerSources[B][G.type][G.source])return;const q=this.workerSources[B][G.type][G.source];delete this.workerSources[B][G.type][G.source],q.removeSource!==void 0?q.removeSource(G,J):J()}loadWorkerSource(B,G,J){try{this.self.importScripts(G.url),J()}catch(q){J(q.toString())}}syncRTLPluginState(B,G,J){try{a.bD.setState(G);const q=a.bD.getPluginURL();if(a.bD.isLoaded()&&!a.bD.isParsed()&&q!=null){this.self.importScripts(q);const ot=a.bD.isParsed();J(ot?void 0:new Error(`RTL Text Plugin failed to import scripts from ${q}`),ot)}}catch(q){J(q.toString())}}getAvailableImages(B){let G=this.availableImages[B];return G||(G=[]),G}getLayerIndex(B){let G=this.layerIndexes[B];return G||(G=this.layerIndexes[B]=new _),G}getWorkerSource(B,G,J){return this.workerSources[B]||(this.workerSources[B]={}),this.workerSources[B][G]||(this.workerSources[B][G]={}),this.workerSources[B][G][J]||(this.workerSources[B][G][J]=new this.workerSourceTypes[G]({send:(q,ot,St)=>{this.actor.send(q,ot,St,B)}},this.getLayerIndex(B),this.getAvailableImages(B))),this.workerSources[B][G][J]}getDEMWorkerSource(B,G){return this.demWorkerSources[B]||(this.demWorkerSources[B]={}),this.demWorkerSources[B][G]||(this.demWorkerSources[B][G]=new F),this.demWorkerSources[B][G]}}return a.i()&&(self.worker=new Es(self)),Es}),u(["./shared"],function(a){var _="3.6.2";class x{static testProp(s){if(!x.docStyle)return s[0];for(let h=0;h<s.length;h++)if(s[h]in x.docStyle)return s[h];return s[0]}static create(s,h,d){const g=window.document.createElement(s);return h!==void 0&&(g.className=h),d&&d.appendChild(g),g}static createNS(s,h){return window.document.createElementNS(s,h)}static disableDrag(){x.docStyle&&x.selectProp&&(x.userSelect=x.docStyle[x.selectProp],x.docStyle[x.selectProp]="none")}static enableDrag(){x.docStyle&&x.selectProp&&(x.docStyle[x.selectProp]=x.userSelect)}static setTransform(s,h){s.style[x.transformProp]=h}static addEventListener(s,h,d,g={}){s.addEventListener(h,d,"passive"in g?g:g.capture)}static removeEventListener(s,h,d,g={}){s.removeEventListener(h,d,"passive"in g?g:g.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",x.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",x.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",x.suppressClickInternal,!0)},0)}static mousePos(s,h){const d=s.getBoundingClientRect();return new a.P(h.clientX-d.left-s.clientLeft,h.clientY-d.top-s.clientTop)}static touchPos(s,h){const d=s.getBoundingClientRect(),g=[];for(let b=0;b<h.length;b++)g.push(new a.P(h[b].clientX-d.left-s.clientLeft,h[b].clientY-d.top-s.clientTop));return g}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}}x.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,x.selectProp=x.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),x.transformProp=x.testProp(["transform","WebkitTransform"]);const S={supported:!1,testSupport:function(y){!D&&k&&(F?K(y):L=y)}};let L,k,D=!1,F=!1;function K(y){const s=y.createTexture();y.bindTexture(y.TEXTURE_2D,s);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,k),y.isContextLost())return;S.supported=!0}catch{}y.deleteTexture(s),D=!0}var W,Q;typeof document<"u"&&(k=document.createElement("img"),k.onload=function(){L&&K(L),L=null,F=!0},k.onerror=function(){D=!0,L=null},k.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let s,h,d,g;y.resetRequestQueue=()=>{s=[],h=0,d=0,g={}},y.addThrottleControl=A=>{const R=d++;return g[R]=A,R},y.removeThrottleControl=A=>{delete g[A],C()},y.getImage=(A,R,O=!0)=>{S.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*");const j={requestParameters:A,supportImageRefresh:O,callback:R,cancelled:!1,completed:!1,cancel:()=>{j.completed||j.cancelled||(j.cancelled=!0,j.innerRequest&&(j.innerRequest.cancel(),h--),C())}};return s.push(j),C(),j};const b=A=>{const{requestParameters:R,supportImageRefresh:O,callback:j}=A;return a.e(R,{type:"image"}),(O!==!1||a.i()||a.g(R.url)||R.headers&&!Object.keys(R.headers).reduce((nt,et)=>nt&&et==="accept",!0)?a.m:M)(R,(nt,et,at,$)=>{I(A,j,nt,et,at,$)})},I=(A,R,O,j,nt,et)=>{O?R(O):j instanceof HTMLImageElement||a.a(j)?R(null,j):j&&((at,$)=>{typeof createImageBitmap=="function"?a.b(at,$):a.d(at,$)})(j,(at,$)=>{at!=null?R(at):$!=null&&R(null,$,{cacheControl:nt,expires:et})}),A.cancelled||(A.completed=!0,h--,C())},C=()=>{const A=(()=>{const R=Object.keys(g);let O=!1;if(R.length>0){for(const j of R)if(O=g[j](),O)break}return O})()?a.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let R=h;R<A&&s.length>0;R++){const O=s.shift();if(O.cancelled){R--;continue}const j=b(O);h++,O.innerRequest=j}},M=(A,R)=>{const O=new Image,j=A.url;let nt=!1;const et=A.credentials;return et&&et==="include"?O.crossOrigin="use-credentials":(et&&et==="same-origin"||!a.s(j))&&(O.crossOrigin="anonymous"),O.fetchPriority="high",O.onload=()=>{R(null,O),O.onerror=O.onload=null},O.onerror=()=>{nt||R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),O.onerror=O.onload=null},O.src=j,{cancel:()=>{nt=!0,O.src=""}}}}(W||(W={})),W.resetRequestQueue(),function(y){y.Glyphs="Glyphs",y.Image="Image",y.Source="Source",y.SpriteImage="SpriteImage",y.SpriteJSON="SpriteJSON",y.Style="Style",y.Tile="Tile",y.Unknown="Unknown"}(Q||(Q={}));class U{constructor(s){this._transformRequestFn=s}transformRequest(s,h){return this._transformRequestFn&&this._transformRequestFn(s,h)||{url:s}}normalizeSpriteURL(s,h,d){const g=function(b){const I=b.match(X);if(!I)throw new Error(`Unable to parse URL "${b}"`);return{protocol:I[1],authority:I[2],path:I[3]||"/",params:I[4]?I[4].split("&"):[]}}(s);return g.path+=`${h}${d}`,function(b){const I=b.params.length?`?${b.params.join("&")}`:"";return`${b.protocol}://${b.authority}${b.path}${I}`}(g)}setTransformRequest(s){this._transformRequestFn=s}}const X=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Y(y){var s=new a.A(3);return s[0]=y[0],s[1]=y[1],s[2]=y[2],s}var pt,gt=function(y,s,h){return y[0]=s[0]-h[0],y[1]=s[1]-h[1],y[2]=s[2]-h[2],y};pt=new a.A(3),a.A!=Float32Array&&(pt[0]=0,pt[1]=0,pt[2]=0);var ct=function(y){var s=y[0],h=y[1];return s*s+h*h};function ht(y){const s=[];if(typeof y=="string")s.push({id:"default",url:y});else if(y&&y.length>0){const h=[];for(const{id:d,url:g}of y){const b=`${d}${g}`;h.indexOf(b)===-1&&(h.push(b),s.push({id:d,url:g}))}}return s}function rt(y,s,h,d,g){if(d)return void y(d);if(g!==Object.values(s).length||g!==Object.values(h).length)return;const b={};for(const I in s){b[I]={};const C=a.h.getImageCanvasContext(h[I]),M=s[I];for(const A in M){const{width:R,height:O,x:j,y:nt,sdf:et,pixelRatio:at,stretchX:$,stretchY:xt,content:Nt}=M[A];b[I][A]={data:null,pixelRatio:at,sdf:et,stretchX:$,stretchY:xt,content:Nt,spriteData:{width:R,height:O,x:j,y:nt,context:C}}}}y(null,b)}(function(){var y=new a.A(2);a.A!=Float32Array&&(y[0]=0,y[1]=0)})();class Et{constructor(s,h,d,g){this.context=s,this.format=d,this.texture=s.gl.createTexture(),this.update(h,g)}update(s,h,d){const{width:g,height:b}=s,I=!(this.size&&this.size[0]===g&&this.size[1]===b||d),{context:C}=this,{gl:M}=C;if(this.useMipmap=!!(h&&h.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),C.pixelStoreUnpackFlipY.set(!1),C.pixelStoreUnpack.set(1),C.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!h||h.premultiply!==!1)),I)this.size=[g,b],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||a.a(s)?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,s):M.texImage2D(M.TEXTURE_2D,0,this.format,g,b,0,this.format,M.UNSIGNED_BYTE,s.data);else{const{x:A,y:R}=d||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||a.a(s)?M.texSubImage2D(M.TEXTURE_2D,0,A,R,M.RGBA,M.UNSIGNED_BYTE,s):M.texSubImage2D(M.TEXTURE_2D,0,A,R,g,b,M.RGBA,M.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)}bind(s,h,d){const{context:g}=this,{gl:b}=g;b.bindTexture(b.TEXTURE_2D,this.texture),d!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(d=b.LINEAR),s!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,s),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,d||s),this.filter=s),h!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,h),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}function mt(y){const{userImage:s}=y;return!!(s&&s.render&&s.render())&&(y.data.replace(new Uint8Array(s.data.buffer)),!0)}class dt extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:h,callback:d}of this.requestors)this._notify(h,d);this.requestors=[]}}getImage(s){const h=this.images[s];if(h&&!h.data&&h.spriteData){const d=h.spriteData;h.data=new a.R({width:d.width,height:d.height},d.context.getImageData(d.x,d.y,d.width,d.height).data),h.spriteData=null}return h}addImage(s,h){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,h)&&(this.images[s]=h)}_validate(s,h){let d=!0;const g=h.data||h.spriteData;return this._validateStretch(h.stretchX,g&&g.width)||(this.fire(new a.j(new Error(`Image "${s}" has invalid "stretchX" value`))),d=!1),this._validateStretch(h.stretchY,g&&g.height)||(this.fire(new a.j(new Error(`Image "${s}" has invalid "stretchY" value`))),d=!1),this._validateContent(h.content,h)||(this.fire(new a.j(new Error(`Image "${s}" has invalid "content" value`))),d=!1),d}_validateStretch(s,h){if(!s)return!0;let d=0;for(const g of s){if(g[0]<d||g[1]<g[0]||h<g[1])return!1;d=g[1]}return!0}_validateContent(s,h){if(!s)return!0;if(s.length!==4)return!1;const d=h.spriteData,g=d&&d.width||h.data.width,b=d&&d.height||h.data.height;return!(s[0]<0||g<s[0]||s[1]<0||b<s[1]||s[2]<0||g<s[2]||s[3]<0||b<s[3]||s[2]<s[0]||s[3]<s[1])}updateImage(s,h,d=!0){const g=this.getImage(s);if(d&&(g.data.width!==h.data.width||g.data.height!==h.data.height))throw new Error(`size mismatch between old image (${g.data.width}x${g.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=g.version+1,this.images[s]=h,this.updatedImages[s]=!0}removeImage(s){const h=this.images[s];delete this.images[s],delete this.patterns[s],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s,h){let d=!0;if(!this.isLoaded())for(const g of s)this.images[g]||(d=!1);this.isLoaded()||d?this._notify(s,h):this.requestors.push({ids:s,callback:h})}_notify(s,h){const d={};for(const g of s){let b=this.getImage(g);b||(this.fire(new a.k("styleimagemissing",{id:g})),b=this.getImage(g)),b?d[g]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:a.w(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,d)}getPixelSize(){const{width:s,height:h}=this.atlasImage;return{width:s,height:h}}getPattern(s){const h=this.patterns[s],d=this.getImage(s);if(!d)return null;if(h&&h.position.version===d.version)return h.position;if(h)h.position.version=d.version;else{const g={w:d.data.width+2,h:d.data.height+2,x:0,y:0},b=new a.I(g,d);this.patterns[s]={bin:g,position:b}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const h=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Et(s,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const b in this.patterns)s.push(this.patterns[b].bin);const{w:h,h:d}=a.p(s),g=this.atlasImage;g.resize({width:h||1,height:d||1});for(const b in this.patterns){const{bin:I}=this.patterns[b],C=I.x+1,M=I.y+1,A=this.getImage(b).data,R=A.width,O=A.height;a.R.copy(A,g,{x:0,y:0},{x:C,y:M},{width:R,height:O}),a.R.copy(A,g,{x:0,y:O-1},{x:C,y:M-1},{width:R,height:1}),a.R.copy(A,g,{x:0,y:0},{x:C,y:M+O},{width:R,height:1}),a.R.copy(A,g,{x:R-1,y:0},{x:C-1,y:M},{width:1,height:O}),a.R.copy(A,g,{x:0,y:0},{x:C+R,y:M},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const h of s){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const d=this.getImage(h);d||a.w(`Image with ID: "${h}" was not found`),mt(d)&&this.updateImage(h,d)}}}const Jt=1e20;function kt(y,s,h,d,g,b,I,C,M){for(let A=s;A<s+d;A++)Gt(y,h*b+A,b,g,I,C,M);for(let A=h;A<h+g;A++)Gt(y,A*b+s,1,d,I,C,M)}function Gt(y,s,h,d,g,b,I){b[0]=0,I[0]=-Jt,I[1]=Jt,g[0]=y[s];for(let C=1,M=0,A=0;C<d;C++){g[C]=y[s+C*h];const R=C*C;do{const O=b[M];A=(g[C]-g[O]+R-O*O)/(C-O)/2}while(A<=I[M]&&--M>-1);M++,b[M]=C,I[M]=A,I[M+1]=Jt}for(let C=0,M=0;C<d;C++){for(;I[M+1]<C;)M++;const A=b[M],R=C-A;y[s+C*h]=g[A]+R*R}}class Kt{constructor(s,h){this.requestManager=s,this.localIdeographFontFamily=h,this.entries={}}setURL(s){this.url=s}getGlyphs(s,h){const d=[];for(const g in s)for(const b of s[g])d.push({stack:g,id:b});a.o(d,({stack:g,id:b},I)=>{let C=this.entries[g];C||(C=this.entries[g]={glyphs:{},requests:{},ranges:{}});let M=C.glyphs[b];if(M!==void 0)return void I(null,{stack:g,id:b,glyph:M});if(M=this._tinySDF(C,g,b),M)return C.glyphs[b]=M,void I(null,{stack:g,id:b,glyph:M});const A=Math.floor(b/256);if(256*A>65535)return void I(new Error("glyphs > 65535 not supported"));if(C.ranges[A])return void I(null,{stack:g,id:b,glyph:M});if(!this.url)return void I(new Error("glyphsUrl is not set"));let R=C.requests[A];R||(R=C.requests[A]=[],Kt.loadGlyphRange(g,A,this.url,this.requestManager,(O,j)=>{if(j){for(const nt in j)this._doesCharSupportLocalGlyph(+nt)||(C.glyphs[+nt]=j[+nt]);C.ranges[A]=!0}for(const nt of R)nt(O,j);delete C.requests[A]})),R.push((O,j)=>{O?I(O):j&&I(null,{stack:g,id:b,glyph:j[b]||null})})},(g,b)=>{if(g)h(g);else if(b){const I={};for(const{stack:C,id:M,glyph:A}of b)(I[C]||(I[C]={}))[M]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics};h(null,I)}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&(a.u["CJK Unified Ideographs"](s)||a.u["Hangul Syllables"](s)||a.u.Hiragana(s)||a.u.Katakana(s))}_tinySDF(s,h,d){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(d))return;let b=s.tinySDF;if(!b){let C="400";/bold/i.test(h)?C="900":/medium/i.test(h)?C="500":/light/i.test(h)&&(C="200"),b=s.tinySDF=new Kt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:g,fontWeight:C})}const I=b.draw(String.fromCharCode(d));return{id:d,bitmap:new a.q({width:I.width||60,height:I.height||60},I.data),metrics:{width:I.glyphWidth/2||24,height:I.glyphHeight/2||24,left:I.glyphLeft/2+.5||0,top:I.glyphTop/2-27.5||-8,advance:I.glyphAdvance/2||24,isDoubleResolution:!0}}}}Kt.loadGlyphRange=function(y,s,h,d,g){const b=256*s,I=b+255,C=d.transformRequest(h.replace("{fontstack}",y).replace("{range}",`${b}-${I}`),Q.Glyphs);a.l(C,(M,A)=>{if(M)g(M);else if(A){const R={};for(const O of a.n(A))R[O.id]=O;g(null,R)}})},Kt.TinySDF=class{constructor({fontSize:y=24,buffer:s=3,radius:h=8,cutoff:d=.25,fontFamily:g="sans-serif",fontWeight:b="normal",fontStyle:I="normal"}={}){this.buffer=s,this.cutoff=d,this.radius=h;const C=this.size=y+4*s,M=this._createCanvas(C),A=this.ctx=M.getContext("2d",{willReadFrequently:!0});A.font=`${I} ${b} ${y}px ${g}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(y){const s=document.createElement("canvas");return s.width=s.height=y,s}draw(y){const{width:s,actualBoundingBoxAscent:h,actualBoundingBoxDescent:d,actualBoundingBoxLeft:g,actualBoundingBoxRight:b}=this.ctx.measureText(y),I=Math.ceil(h),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-g))),M=Math.min(this.size-this.buffer,I+Math.ceil(d)),A=C+2*this.buffer,R=M+2*this.buffer,O=Math.max(A*R,0),j=new Uint8ClampedArray(O),nt={data:j,width:A,height:R,glyphWidth:C,glyphHeight:M,glyphTop:I,glyphLeft:0,glyphAdvance:s};if(C===0||M===0)return nt;const{ctx:et,buffer:at,gridInner:$,gridOuter:xt}=this;et.clearRect(at,at,C,M),et.fillText(y,at,at+I);const Nt=et.getImageData(at,at,C,M);xt.fill(Jt,0,O),$.fill(0,0,O);for(let ut=0;ut<M;ut++)for(let It=0;It<C;It++){const Ft=Nt.data[4*(ut*C+It)+3]/255;if(Ft===0)continue;const Bt=(ut+at)*A+It+at;if(Ft===1)xt[Bt]=0,$[Bt]=Jt;else{const Wt=.5-Ft;xt[Bt]=Wt>0?Wt*Wt:0,$[Bt]=Wt<0?Wt*Wt:0}}kt(xt,0,0,A,R,A,this.f,this.v,this.z),kt($,at,at,C,M,A,this.f,this.v,this.z);for(let ut=0;ut<O;ut++){const It=Math.sqrt(xt[ut])-Math.sqrt($[ut]);j[ut]=Math.round(255-255*(It/this.radius+this.cutoff))}return nt}};class be{constructor(){this.specification=a.v.light.position}possiblyEvaluate(s,h){return a.z(s.expression.evaluate(h))}interpolate(s,h,d){return{x:a.B.number(s.x,h.x,d),y:a.B.number(s.y,h.y,d),z:a.B.number(s.z,h.z,d)}}}let ce;class $e extends a.E{constructor(s){super(),ce=ce||new a.r({anchor:new a.D(a.v.light.anchor),position:new be,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(ce),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h={}){if(!this._validate(a.t,s,h))for(const d in s){const g=s[d];d.endsWith("-transition")?this._transitionable.setTransition(d.slice(0,-11),g):this._transitionable.setValue(d,g)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,d){return(!d||d.validate!==!1)&&a.x(this,s.call(a.y,a.e({value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}}class jn{constructor(s,h){this.width=s,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,h){const d=s.join(",")+String(h);return this.dashEntry[d]||(this.dashEntry[d]=this.addDash(s,h)),this.dashEntry[d]}getDashRanges(s,h,d){const g=[];let b=s.length%2==1?-s[s.length-1]*d:0,I=s[0]*d,C=!0;g.push({left:b,right:I,isDash:C,zeroLength:s[0]===0});let M=s[0];for(let A=1;A<s.length;A++){C=!C;const R=s[A];b=M*d,M+=R,I=M*d,g.push({left:b,right:I,isDash:C,zeroLength:R===0})}return g}addRoundDash(s,h,d){const g=h/2;for(let b=-d;b<=d;b++){const I=this.width*(this.nextRow+d+b);let C=0,M=s[C];for(let A=0;A<this.width;A++){A/M.right>1&&(M=s[++C]);const R=Math.abs(A-M.left),O=Math.abs(A-M.right),j=Math.min(R,O);let nt;const et=b/d*(g+1);if(M.isDash){const at=g-Math.abs(et);nt=Math.sqrt(j*j+at*at)}else nt=g-Math.sqrt(j*j+et*et);this.data[I+A]=Math.max(0,Math.min(255,nt+128))}}}addRegularDash(s){for(let C=s.length-1;C>=0;--C){const M=s[C],A=s[C+1];M.zeroLength?s.splice(C,1):A&&A.isDash===M.isDash&&(A.left=M.left,s.splice(C,1))}const h=s[0],d=s[s.length-1];h.isDash===d.isDash&&(h.left=d.left-this.width,d.right=h.right+this.width);const g=this.width*this.nextRow;let b=0,I=s[b];for(let C=0;C<this.width;C++){C/I.right>1&&(I=s[++b]);const M=Math.abs(C-I.left),A=Math.abs(C-I.right),R=Math.min(M,A);this.data[g+C]=Math.max(0,Math.min(255,(I.isDash?R:-R)+128))}}addDash(s,h){const d=h?7:0,g=2*d+1;if(this.nextRow+g>this.height)return a.w("LineAtlas out of space"),null;let b=0;for(let C=0;C<s.length;C++)b+=s[C];if(b!==0){const C=this.width/b,M=this.getDashRanges(s,this.width,C);h?this.addRoundDash(M,C,d):this.addRegularDash(M)}const I={y:(this.nextRow+d+.5)/this.height,height:2*d/this.height,width:b};return this.nextRow+=g,this.dirty=!0,I}bind(s){const h=s.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}class Ze{constructor(s,h,d){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=d;const g=this.workerPool.acquire(d);for(let b=0;b<g.length;b++){const I=new a.C(g[b],h,d);I.name=`Worker ${b}`,this.actors.push(I)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,h,d){a.o(this.actors,(g,b)=>{g.send(s,h,b)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(s=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],s&&this.workerPool.release(this.id)}}function ze(y,s,h){const d=function(g,b){if(g)return h(g);if(b){const I=a.F(a.e(b,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(I.vectorLayers=b.vector_layers,I.vectorLayerIds=I.vectorLayers.map(C=>C.id)),h(null,I)}};return y.url?a.f(s.transformRequest(y.url,Q.Source),d):a.h.frame(()=>d(null,y))}class Ue{constructor(s,h){s&&(h?this.setSouthWest(s).setNorthEast(h):Array.isArray(s)&&(s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1])))}setNorthEast(s){return this._ne=s instanceof a.L?new a.L(s.lng,s.lat):a.L.convert(s),this}setSouthWest(s){return this._sw=s instanceof a.L?new a.L(s.lng,s.lat):a.L.convert(s),this}extend(s){const h=this._sw,d=this._ne;let g,b;if(s instanceof a.L)g=s,b=s;else{if(!(s instanceof Ue))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(Ue.convert(s)):this.extend(a.L.convert(s)):s&&("lng"in s||"lon"in s)&&"lat"in s?this.extend(a.L.convert(s)):this;if(g=s._sw,b=s._ne,!g||!b)return this}return h||d?(h.lng=Math.min(g.lng,h.lng),h.lat=Math.min(g.lat,h.lat),d.lng=Math.max(b.lng,d.lng),d.lat=Math.max(b.lat,d.lat)):(this._sw=new a.L(g.lng,g.lat),this._ne=new a.L(b.lng,b.lat)),this}getCenter(){return new a.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.L(this.getWest(),this.getNorth())}getSouthEast(){return new a.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:h,lat:d}=a.L.convert(s);let g=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&g}static convert(s){return s instanceof Ue?s:s&&new Ue(s)}static fromLngLat(s,h=0){const d=360*h/40075017,g=d/Math.cos(Math.PI/180*s.lat);return new Ue(new a.L(s.lng-g,s.lat-d),new a.L(s.lng+g,s.lat+d))}}class dn{constructor(s,h,d){this.bounds=Ue.convert(this.validateBounds(s)),this.minzoom=h||0,this.maxzoom=d||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const h=Math.pow(2,s.z),d=Math.floor(a.G(this.bounds.getWest())*h),g=Math.floor(a.H(this.bounds.getNorth())*h),b=Math.ceil(a.G(this.bounds.getEast())*h),I=Math.ceil(a.H(this.bounds.getSouth())*h);return s.x>=d&&s.x<b&&s.y>=g&&s.y<I}}class Jn extends a.E{constructor(s,h,d,g){if(super(),this.load=()=>{this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=ze(this._options,this.map._requestManager,(b,I)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),b?this.fire(new a.j(b)):I&&(a.e(this,I),I.bounds&&(this.tileBounds=new dn(I.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>a.e({},this._options),this.id=s,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.F(h,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.cancel(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(s,h){const d=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g={request:this.map._requestManager.transformRequest(d,Q.Tile),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function b(I,C){return delete s.request,s.aborted?h(null):I&&I.status!==404?h(I):(C&&C.resourceTiming&&(s.resourceTiming=C.resourceTiming),this.map._refreshExpiredTiles&&C&&s.setExpiryData(C),s.loadVectorData(C,this.map.painter),h(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}g.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired"?s.state==="loading"?s.reloadCallback=h:s.request=s.actor.send("reloadTile",g,b.bind(this)):(s.actor=this.dispatcher.getActor(),s.request=s.actor.send("loadTile",g,b.bind(this)))}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id},void 0)}unloadTile(s){s.unloadVectorData(),s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Zn extends a.E{constructor(s,h,d,g){super(),this.id=s,this.dispatcher=d,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},h),a.e(this,a.F(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=ze(this._options,this.map._requestManager,(s,h)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new a.j(s)):h&&(a.e(this,h),h.bounds&&(this.tileBounds=new dn(h.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.cancel(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}serialize(){return a.e({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,h){const d=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.request=W.getImage(this.map._requestManager.transformRequest(d,Q.Tile),(g,b,I)=>{if(delete s.request,s.aborted)s.state="unloaded",h(null);else if(g)s.state="errored",h(g);else if(b){this.map._refreshExpiredTiles&&I&&s.setExpiryData(I);const C=this.map.painter.context,M=C.gl;s.texture=this.map.painter.getTileTexture(b.width),s.texture?s.texture.update(b,{useMipmap:!0}):(s.texture=new Et(C,b,M.RGBA,{useMipmap:!0}),s.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),C.extTextureFilterAnisotropic&&M.texParameterf(M.TEXTURE_2D,C.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,C.extTextureFilterAnisotropicMax)),s.state="loaded",h(null)}},this.map._refreshExpiredTiles)}abortTile(s,h){s.request&&(s.request.cancel(),delete s.request),h()}unloadTile(s,h){s.texture&&this.map.painter.saveTileTexture(s.texture),h()}hasTransition(){return!1}}class re extends Zn{constructor(s,h,d,g){super(s,h,d,g),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(s,h){const d=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g=this.map._requestManager.transformRequest(d,Q.Tile);function b(I,C){I&&(s.state="errored",h(I)),C&&(s.dem=C,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded",h(null))}s.neighboringTiles=this._getNeighboringTiles(s.tileID),s.request=W.getImage(g,(I,C,M)=>a._(this,void 0,void 0,function*(){if(delete s.request,s.aborted)s.state="unloaded",h(null);else if(I)s.state="errored",h(I);else if(C){this.map._refreshExpiredTiles&&s.setExpiryData(M);const A=a.a(C)&&a.J()?C:yield function(O){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.K()){const j=O.width+2,nt=O.height+2;try{return new a.R({width:j,height:nt},yield a.M(O,-1,-1,j,nt))}catch{}}return a.h.getImageData(O,1)})}(C),R={uid:s.uid,coord:s.tileID,source:this.id,rawImageData:A,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};s.actor&&s.state!=="expired"||(s.actor=this.dispatcher.getActor(),s.actor.send("loadDEMTile",R,b))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(s){const h=s.canonical,d=Math.pow(2,h.z),g=(h.x-1+d)%d,b=h.x===0?s.wrap-1:s.wrap,I=(h.x+1+d)%d,C=h.x+1===d?s.wrap+1:s.wrap,M={};return M[new a.O(s.overscaledZ,b,h.z,g,h.y).key]={backfilled:!1},M[new a.O(s.overscaledZ,C,h.z,I,h.y).key]={backfilled:!1},h.y>0&&(M[new a.O(s.overscaledZ,b,h.z,g,h.y-1).key]={backfilled:!1},M[new a.O(s.overscaledZ,s.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},M[new a.O(s.overscaledZ,C,h.z,I,h.y-1).key]={backfilled:!1}),h.y+1<d&&(M[new a.O(s.overscaledZ,b,h.z,g,h.y+1).key]={backfilled:!1},M[new a.O(s.overscaledZ,s.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},M[new a.O(s.overscaledZ,C,h.z,I,h.y+1).key]={backfilled:!1}),M}unloadTile(s){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&s.actor.send("removeDEMTile",{uid:s.uid,source:this.id})}}class Be extends a.E{constructor(s,h,d,g){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>a.e({},this._options,{type:this.type,data:this._data}),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=d.getActor(),this.setEventedParent(g),this._data=h.data,this._options=a.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const b=a.N/this.tileSize;this.workerOptions=a.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*b,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*b,extent:a.N,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:a.N,radius:(h.clusterRadius||50)*b,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._updateWorkerData(),this}updateData(s){return this._updateWorkerData(s),this}setClusterOptions(s){return this.workerOptions.cluster=s.cluster,s&&(s.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=s.clusterRadius),s.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=s.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(s,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:s,source:this.id},h),this}getClusterChildren(s,h){return this.actor.send("geojson.getClusterChildren",{clusterId:s,source:this.id},h),this}getClusterLeaves(s,h,d,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:s,limit:h,offset:d},g),this}_updateWorkerData(s){const h=a.e({},this.workerOptions);s?h.dataDiff=s:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(a.h.resolveURL(this._data),Q.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,h,(d,g)=>{if(this._pendingLoads--,this._removed||g&&g.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let b=null;if(g&&g.resourceTiming&&g.resourceTiming[this.id]&&(b=g.resourceTiming[this.id].slice(0)),d)return void this.fire(new a.j(d));const I={dataType:"source"};this._collectResourceTiming&&b&&b.length>0&&a.e(I,{resourceTiming:b}),this.fire(new a.k("data",Object.assign(Object.assign({},I),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},I),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(s,h){const d=s.actor?"reloadTile":"loadTile";s.actor=this.actor;const g={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};s.request=this.actor.send(d,g,(b,I)=>(delete s.request,s.unloadVectorData(),s.aborted?h(null):b?h(b):(s.loadVectorData(I,this.map.painter,d==="reloadTile"),h(null))))}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.aborted=!0}unloadTile(s){s.unloadVectorData(),this.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var fn=a.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Un extends a.E{constructor(s,h,d,g){super(),this.load=(b,I)=>{this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=W.getImage(this.map._requestManager.transformRequest(this.url,Q.Image),(C,M)=>{this._request=null,this._loaded=!0,C?this.fire(new a.j(C)):M&&(this.image=M,b&&(this.coordinates=b),I&&I(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const b=this.map.painter.context,I=b.gl;this.boundsBuffer||(this.boundsBuffer=b.createVertexBuffer(this._boundsArray,fn.members)),this.boundsSegments||(this.boundsSegments=a.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Et(b,this.image,I.RGBA),this.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE));let C=!1;for(const M in this.tiles){const A=this.tiles[M];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,C=!0)}C&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=s,this.dispatcher=d,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=h}loaded(){return this._loaded}updateImage(s){return s.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=s.url,this.load(s.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(s){this.coordinates=s;const h=s.map(a.U.fromLngLat);this.tileID=function(g){let b=1/0,I=1/0,C=-1/0,M=-1/0;for(const j of g)b=Math.min(b,j.x),I=Math.min(I,j.y),C=Math.max(C,j.x),M=Math.max(M,j.y);const A=Math.max(C-b,M-I),R=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),O=Math.pow(2,R);return new a.W(R,Math.floor((b+C)/2*O),Math.floor((I+M)/2*O))}(h),this.minzoom=this.maxzoom=this.tileID.z;const d=h.map(g=>this.tileID.getTilePoint(g)._round());return this._boundsArray=new a.V,this._boundsArray.emplaceBack(d[0].x,d[0].y,0,0),this._boundsArray.emplaceBack(d[1].x,d[1].y,a.N,0),this._boundsArray.emplaceBack(d[3].x,d[3].y,0,a.N),this._boundsArray.emplaceBack(d[2].x,d[2].y,a.N,a.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(s,h){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},h(null)):(s.state="errored",h(null))}hasTransition(){return!1}}class ur extends Un{constructor(s,h,d,g){super(s,h,d,g),this.load=()=>{this._loaded=!1;const b=this.options;this.urls=[];for(const I of b.urls)this.urls.push(this.map._requestManager.transformRequest(I,Q.Source).url);a.X(this.urls,(I,C)=>{this._loaded=!0,I?this.fire(new a.j(I)):C&&(this.video=C,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const b=this.map.painter.context,I=b.gl;this.boundsBuffer||(this.boundsBuffer=b.createVertexBuffer(this._boundsArray,fn.members)),this.boundsSegments||(this.boundsSegments=a.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE),I.texSubImage2D(I.TEXTURE_2D,0,0,0,I.RGBA,I.UNSIGNED_BYTE,this.video)):(this.texture=new Et(b,this.video,I.RGBA),this.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE));let C=!1;for(const M in this.tiles){const A=this.tiles[M];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,C=!0)}C&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=h}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const h=this.video.seekable;s<h.start(0)||s>h.end(0)?this.fire(new a.j(new a.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class Ai extends Un{constructor(s,h,d,g){super(s,h,d,g),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let b=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,b=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,b=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const I=this.map.painter.context,C=I.gl;this.boundsBuffer||(this.boundsBuffer=I.createVertexBuffer(this._boundsArray,fn.members)),this.boundsSegments||(this.boundsSegments=a.S.simpleSegment(0,0,4,2)),this.texture?(b||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Et(I,this.canvas,C.RGBA,{premultiply:!0});let M=!1;for(const A in this.tiles){const R=this.tiles[A];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture,M=!0)}M&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(I=>typeof I!="number"))||this.fire(new a.j(new a.Y(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.Y(`sources.${s}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new a.j(new a.Y(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.Y(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.Y(`sources.${s}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const wt={},De=y=>{switch(y){case"geojson":return Be;case"image":return Un;case"raster":return Zn;case"raster-dem":return re;case"vector":return Jn;case"video":return ur;case"canvas":return Ai}return wt[y]};function Ve(y,s){const h=a.Z();return a.$(h,h,[1,1,0]),a.a0(h,h,[.5*y.width,.5*y.height,1]),a.a1(h,h,y.calculatePosMatrix(s.toUnwrapped()))}function ki(y,s,h,d,g,b){const I=function(O,j,nt){if(O)for(const et of O){const at=j[et];if(at&&at.source===nt&&at.type==="fill-extrusion")return!0}else for(const et in j){const at=j[et];if(at.source===nt&&at.type==="fill-extrusion")return!0}return!1}(g&&g.layers,s,y.id),C=b.maxPitchScaleFactor(),M=y.tilesIn(d,C,I);M.sort(On);const A=[];for(const O of M)A.push({wrappedTileID:O.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(s,h,y._state,O.queryGeometry,O.cameraQueryGeometry,O.scale,g,b,C,Ve(y.transform,O.tileID))});const R=function(O){const j={},nt={};for(const et of O){const at=et.queryResults,$=et.wrappedTileID,xt=nt[$]=nt[$]||{};for(const Nt in at){const ut=at[Nt],It=xt[Nt]=xt[Nt]||{},Ft=j[Nt]=j[Nt]||[];for(const Bt of ut)It[Bt.featureIndex]||(It[Bt.featureIndex]=!0,Ft.push(Bt))}}return j}(A);for(const O in R)R[O].forEach(j=>{const nt=j.feature,et=y.getFeatureState(nt.layer["source-layer"],nt.id);nt.source=nt.layer.source,nt.layer["source-layer"]&&(nt.sourceLayer=nt.layer["source-layer"]),nt.state=et});return R}function On(y,s){const h=y.tileID,d=s.tileID;return h.overscaledZ-d.overscaledZ||h.canonical.y-d.canonical.y||h.wrap-d.wrap||h.canonical.x-d.canonical.x}class tn{constructor(s,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=s,this.uid=a.a2(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){const h=s+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(s,h,d){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(g,b){const I={};if(!b)return I;for(const C of g){const M=C.layerIds.map(A=>b.getLayer(A)).filter(Boolean);if(M.length!==0){C.layers=M,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(A=>M.filter(R=>R.id===A)[0]));for(const A of M)I[A.id]=C}}return I}(s.buckets,h.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const b=this.buckets[g];if(b instanceof a.a4){if(this.hasSymbolBuckets=!0,!d)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const b=this.buckets[g];if(b instanceof a.a4&&b.hasRTLText){this.hasRTLText=!0,a.a5();break}}this.queryPadding=0;for(const g in this.buckets){const b=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(g).queryRadius(b))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new a.a3}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const d in this.buckets){const g=this.buckets[d];g.uploadPending()&&g.upload(s)}const h=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Et(s,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Et(s,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,h,d,g,b,I,C,M,A,R){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:b,scale:I,tileSize:this.tileSize,pixelPosMatrix:R,transform:M,params:C,queryPadding:this.queryPadding*A},s,h,d):{}}querySourceFeatures(s,h){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const g=d.loadVTLayers(),b=h&&h.sourceLayer?h.sourceLayer:"",I=g._geojsonTileLayer||g[b];if(!I)return;const C=a.a6(h&&h.filter),{z:M,x:A,y:R}=this.tileID.canonical,O={z:M,x:A,y:R};for(let j=0;j<I.length;j++){const nt=I.feature(j);if(C.needGeometry){const $=a.a7(nt,!0);if(!C.filter(new a.a8(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!C.filter(new a.a8(this.tileID.overscaledZ),nt))continue;const et=d.getId(nt,b),at=new a.a9(nt,M,A,R,et);at.tile=O,s.push(at)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const h=this.expirationTime;if(s.cacheControl){const d=a.aa(s.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const d=Date.now();let g=!1;if(this.expirationTime>d)g=!1;else if(h)if(this.expirationTime<h)g=!0;else{const b=this.expirationTime-h;b?this.expirationTime=d+Math.max(b,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(s).length===0)return;const d=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!h.style.hasLayer(g))continue;const b=this.buckets[g],I=b.layers[0].sourceLayer||"_geojsonTileLayer",C=d[I],M=s[I];if(!C||!M||Object.keys(M).length===0)continue;b.update(M,C,this.imageAtlas&&this.imageAtlas.patternPositions||{});const A=h&&h.style&&h.style.getLayer(g);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=a.h.now()+s}setDependencies(s,h){const d={};for(const g of h)d[g]=!0;this.dependencies[s]=d}hasDependency(s,h){for(const d of s){const g=this.dependencies[d];if(g){for(const b of h)if(g[b])return!0}}return!1}}class Gn{constructor(s,h){this.max=s,this.onRemove=h,this.reset()}reset(){for(const s in this.data)for(const h of this.data[s])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(s,h,d){const g=s.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const b={value:h,timeout:void 0};if(d!==void 0&&(b.timeout=setTimeout(()=>{this.remove(s,b)},d)),this.data[g].push(b),this.order.push(g),this.order.length>this.max){const I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const h=this.data[s].shift();return h.timeout&&clearTimeout(h.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),h.value}getByKey(s){const h=this.data[s];return h?h[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,h){if(!this.has(s))return this;const d=s.wrapped().key,g=h===void 0?0:this.data[d].indexOf(h),b=this.data[d][g];return this.data[d].splice(g,1),b.timeout&&clearTimeout(b.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(b.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(s){const h=[];for(const d in this.data)for(const g of this.data[d])s(g.value)||h.push(g);for(const d of h)this.remove(d.value.tileID,d)}}class qt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,h,d){const g=String(h);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][g]=this.stateChanges[s][g]||{},a.e(this.stateChanges[s][g],d),this.deletedStates[s]===null){this.deletedStates[s]={};for(const b in this.state[s])b!==g&&(this.deletedStates[s][b]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][g]===null){this.deletedStates[s][g]={};for(const b in this.state[s][g])d[b]||(this.deletedStates[s][g][b]=null)}else for(const b in d)this.deletedStates[s]&&this.deletedStates[s][g]&&this.deletedStates[s][g][b]===null&&delete this.deletedStates[s][g][b]}removeFeatureState(s,h,d){if(this.deletedStates[s]===null)return;const g=String(h);if(this.deletedStates[s]=this.deletedStates[s]||{},d&&h!==void 0)this.deletedStates[s][g]!==null&&(this.deletedStates[s][g]=this.deletedStates[s][g]||{},this.deletedStates[s][g][d]=null);else if(h!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][g])for(d in this.deletedStates[s][g]={},this.stateChanges[s][g])this.deletedStates[s][g][d]=null;else this.deletedStates[s][g]=null;else this.deletedStates[s]=null}getState(s,h){const d=String(h),g=a.e({},(this.state[s]||{})[d],(this.stateChanges[s]||{})[d]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){const b=this.deletedStates[s][h];if(b===null)return{};for(const I in b)delete g[I]}return g}initializeTileState(s,h){s.setFeatureState(this.state,h)}coalesceChanges(s,h){const d={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const b={};for(const I in this.stateChanges[g])this.state[g][I]||(this.state[g][I]={}),a.e(this.state[g][I],this.stateChanges[g][I]),b[I]=this.state[g][I];d[g]=b}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const b={};if(this.deletedStates[g]===null)for(const I in this.state[g])b[I]={},this.state[g][I]={};else for(const I in this.deletedStates[g]){if(this.deletedStates[g][I]===null)this.state[g][I]={};else for(const C of Object.keys(this.deletedStates[g][I]))delete this.state[g][I][C];b[I]=this.state[g][I]}d[g]=d[g]||{},a.e(d[g],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const g in s)s[g].setFeatureState(d,h)}}class mi extends a.E{constructor(s,h,d){super(),this.id=s,this.dispatcher=d,this.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((g,b,I,C)=>{const M=new(De(b.type))(g,b,I,C);if(M.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${M.id}`);return M})(s,h,d,this),this._tiles={},this._cache=new Gn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new qt,this._didEmitContent=!1,this._updated=!1}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._maxTileCacheZoomLevels=s?s._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const s in this._tiles){const h=this._tiles[s];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,h){return this._source.loadTile(s,h)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s,()=>{})}_abortTile(s){this._source.abortTile&&this._source.abortTile(s,()=>{}),this._source.fire(new a.k("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const d=this._tiles[h];d.upload(s),d.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(qi).map(s=>s.key)}getRenderableIds(s){const h=[];for(const d in this._tiles)this._isIdRenderable(d,s)&&h.push(this._tiles[d]);return s?h.sort((d,g)=>{const b=d.tileID,I=g.tileID,C=new a.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),M=new a.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-I.overscaledZ||M.y-C.y||M.x-C.x}).map(d=>d.tileID.key):h.map(d=>d.tileID).sort(qi).map(d=>d.key)}hasRenderableParent(s){const h=this.findLoadedParent(s,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(s,h){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(h||!this._tiles[s].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(s,"reloading")}}_reloadTile(s,h){const d=this._tiles[s];d&&(d.state!=="loading"&&(d.state=h),this._loadTile(d,this._tileLoaded.bind(this,d,s,h)))}_tileLoaded(s,h,d,g){if(g)return s.state="errored",void(g.status!==404?this._source.fire(new a.j(g,{tile:s})):this.update(this.transform,this.terrain));s.timeAdded=a.h.now(),d==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(h,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const h=this.getRenderableIds();for(let g=0;g<h.length;g++){const b=h[g];if(s.neighboringTiles&&s.neighboringTiles[b]){const I=this.getTileByID(b);d(s,I),d(I,s)}}function d(g,b){g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let I=b.tileID.canonical.x-g.tileID.canonical.x;const C=b.tileID.canonical.y-g.tileID.canonical.y,M=Math.pow(2,g.tileID.canonical.z),A=b.tileID.key;I===0&&C===0||Math.abs(C)>1||(Math.abs(I)>1&&(Math.abs(I+M)===1?I+=M:Math.abs(I-M)===1&&(I-=M)),b.dem&&g.dem&&(g.dem.backfillBorder(b.dem,I,C),g.neighboringTiles&&g.neighboringTiles[A]&&(g.neighboringTiles[A].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,h,d,g){for(const b in this._tiles){let I=this._tiles[b];if(g[b]||!I.hasData()||I.tileID.overscaledZ<=h||I.tileID.overscaledZ>d)continue;let C=I.tileID;for(;I&&I.tileID.overscaledZ>h+1;){const A=I.tileID.scaledTo(I.tileID.overscaledZ-1);I=this._tiles[A.key],I&&I.hasData()&&(C=A)}let M=C;for(;M.overscaledZ>h;)if(M=M.scaledTo(M.overscaledZ-1),s[M.key]){g[C.key]=C;break}}}findLoadedParent(s,h){if(s.key in this._loadedParentTiles){const d=this._loadedParentTiles[s.key];return d&&d.tileID.overscaledZ>=h?d:null}for(let d=s.overscaledZ-1;d>=h;d--){const g=s.scaledTo(d),b=this._getLoadedTile(g);if(b)return b}}_getLoadedTile(s){const h=this._tiles[s.key];return h&&h.hasData()?h:this._cache.getByKey(s.wrapped().key)}updateCacheSize(s){const h=Math.ceil(s.width/this._source.tileSize)+1,d=Math.ceil(s.height/this._source.tileSize)+1,g=Math.floor(h*d*(this._maxTileCacheZoomLevels===null?a.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(b)}handleWrapJump(s){const h=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,h){const d={};for(const g in this._tiles){const b=this._tiles[g];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+h),d[b.tileID.key]=b}this._tiles=d;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}update(s,h){if(this.transform=s,this.terrain=h,!this._sourceLoaded||this._paused)return;let d;this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(R=>new a.O(R.canonical.z,R.wrap,R.canonical.z,R.canonical.x,R.canonical.y)):(d=s.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(d=d.filter(R=>this._source.hasTile(R)))):d=[];const g=s.coveringZoomLevel(this._source),b=Math.max(g-mi.maxOverzooming,this._source.minzoom),I=Math.max(g+mi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const R={};for(const O of d)if(O.canonical.z>this._source.minzoom){const j=O.scaledTo(O.canonical.z-1);R[j.key]=j;const nt=O.scaledTo(Math.max(this._source.minzoom,Math.min(O.canonical.z,5)));R[nt.key]=nt}d=d.concat(Object.values(R))}const C=d.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,C&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const M=this._updateRetainedTiles(d,g);if(In(this._source.type)){const R={},O={},j=Object.keys(M),nt=a.h.now();for(const et of j){const at=M[et],$=this._tiles[et];if(!$||$.fadeEndTime!==0&&$.fadeEndTime<=nt)continue;const xt=this.findLoadedParent(at,b);xt&&(this._addTile(xt.tileID),R[xt.tileID.key]=xt.tileID),O[et]=at}this._retainLoadedChildren(O,g,I,M);for(const et in R)M[et]||(this._coveredTiles[et]=!0,M[et]=R[et]);if(h){const et={},at={};for(const $ of d)this._tiles[$.key].hasData()?et[$.key]=$:at[$.key]=$;for(const $ in at){const xt=at[$].children(this._source.maxzoom);this._tiles[xt[0].key]&&this._tiles[xt[1].key]&&this._tiles[xt[2].key]&&this._tiles[xt[3].key]&&(et[xt[0].key]=M[xt[0].key]=xt[0],et[xt[1].key]=M[xt[1].key]=xt[1],et[xt[2].key]=M[xt[2].key]=xt[2],et[xt[3].key]=M[xt[3].key]=xt[3],delete at[$])}for(const $ in at){const xt=this.findLoadedParent(at[$],this._source.minzoom);if(xt){et[xt.tileID.key]=M[xt.tileID.key]=xt.tileID;for(const Nt in et)et[Nt].isChildOf(xt.tileID)&&delete et[Nt]}}for(const $ in this._tiles)et[$]||(this._coveredTiles[$]=!0)}}for(const R in M)this._tiles[R].clearFadeHold();const A=a.ab(this._tiles,M);for(const R of A){const O=this._tiles[R];O.hasSymbolBuckets&&!O.holdingForFade()?O.setHoldDuration(this.map._fadeDuration):O.hasSymbolBuckets&&!O.symbolFadeFinished()||this._removeTile(R)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,h){const d={},g={},b=Math.max(h-mi.maxOverzooming,this._source.minzoom),I=Math.max(h+mi.maxUnderzooming,this._source.minzoom),C={};for(const M of s){const A=this._addTile(M);d[M.key]=M,A.hasData()||h<this._source.maxzoom&&(C[M.key]=M)}this._retainLoadedChildren(C,h,I,d);for(const M of s){let A=this._tiles[M.key];if(A.hasData())continue;if(h+1>this._source.maxzoom){const O=M.children(this._source.maxzoom)[0],j=this.getTile(O);if(j&&j.hasData()){d[O.key]=O;continue}}else{const O=M.children(this._source.maxzoom);if(d[O[0].key]&&d[O[1].key]&&d[O[2].key]&&d[O[3].key])continue}let R=A.wasRequested();for(let O=M.overscaledZ-1;O>=b;--O){const j=M.scaledTo(O);if(g[j.key])break;if(g[j.key]=!0,A=this.getTile(j),!A&&R&&(A=this._addTile(j)),A){const nt=A.hasData();if((R||nt)&&(d[j.key]=j),R=A.wasRequested(),nt)break}}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const h=[];let d,g=this._tiles[s].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){d=this._loadedParentTiles[g.key];break}h.push(g.key);const b=g.scaledTo(g.overscaledZ-1);if(d=this._getLoadedTile(b),d)break;g=b}for(const b of h)this._loadedParentTiles[b]=d}}_addTile(s){let h=this._tiles[s.key];if(h)return h;h=this._cache.getAndRemove(s),h&&(this._setTileReloadTimer(s.key,h),h.tileID=s,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,h)));const d=h;return h||(h=new tn(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,s.key,h.state))),h.uses++,this._tiles[s.key]=h,d||this._source.fire(new a.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(s,h){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const d=h.getExpiryTimeout();d&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},d))}_removeTile(s){const h=this._tiles[s];h&&(h.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,h,d){const g=[],b=this.transform;if(!b)return g;const I=d?b.getCameraQueryGeometry(s):s,C=s.map(et=>b.pointCoordinate(et,this.terrain)),M=I.map(et=>b.pointCoordinate(et,this.terrain)),A=this.getIds();let R=1/0,O=1/0,j=-1/0,nt=-1/0;for(const et of M)R=Math.min(R,et.x),O=Math.min(O,et.y),j=Math.max(j,et.x),nt=Math.max(nt,et.y);for(let et=0;et<A.length;et++){const at=this._tiles[A[et]];if(at.holdingForFade())continue;const $=at.tileID,xt=Math.pow(2,b.zoom-at.tileID.overscaledZ),Nt=h*at.queryPadding*a.N/at.tileSize/xt,ut=[$.getTilePoint(new a.U(R,O)),$.getTilePoint(new a.U(j,nt))];if(ut[0].x-Nt<a.N&&ut[0].y-Nt<a.N&&ut[1].x+Nt>=0&&ut[1].y+Nt>=0){const It=C.map(Bt=>$.getTilePoint(Bt)),Ft=M.map(Bt=>$.getTilePoint(Bt));g.push({tile:at,tileID:$,queryGeometry:It,cameraQueryGeometry:Ft,scale:xt})}}return g}getVisibleCoordinates(s){const h=this.getRenderableIds(s).map(d=>this._tiles[d].tileID);for(const d of h)d.posMatrix=this.transform.calculatePosMatrix(d.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(In(this._source.type)){const s=a.h.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=s)return!0}return!1}setFeatureState(s,h,d){this._state.updateState(s=s||"_geojsonTileLayer",h,d)}removeFeatureState(s,h,d){this._state.removeFeatureState(s=s||"_geojsonTileLayer",h,d)}getFeatureState(s,h){return this._state.getState(s=s||"_geojsonTileLayer",h)}setDependencies(s,h,d){const g=this._tiles[s];g&&g.setDependencies(h,d)}reloadTilesForDependencies(s,h){for(const d in this._tiles)this._tiles[d].hasDependency(s,h)&&this._reloadTile(d,"reloading");this._cache.filter(d=>!d.hasDependency(s,h))}}function qi(y,s){const h=Math.abs(2*y.wrap)-+(y.wrap<0),d=Math.abs(2*s.wrap)-+(s.wrap<0);return y.overscaledZ-s.overscaledZ||d-h||s.canonical.y-y.canonical.y||s.canonical.x-y.canonical.x}function In(y){return y==="raster"||y==="image"||y==="video"}mi.maxOverzooming=10,mi.maxUnderzooming=3;const en="mapboxgl_preloaded_worker_pool";class uo{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<uo.workerCount;)this.workers.push(new Worker(a.c.WORKER_URL));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[en]}numActive(){return Object.keys(this.active).length}}const or=Math.floor(a.h.hardwareConcurrency/2);let Ni;function ii(){return Ni||(Ni=new uo),Ni}uo.workerCount=a.ac(globalThis)?Math.max(Math.min(or,3),1):1;class vn{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=a.ad(s,0,1);let h=1,d=this._distances[h];const g=s*this.paddedLength+this.padding;for(;d<g&&h<this._distances.length;)d=this._distances[++h];const b=h-1,I=this._distances[b],C=d-I,M=C>0?(g-I)/C:0;return this.points[b].mult(1-M).add(this.points[h].mult(M))}}function gi(y,s){let h=!0;return y==="always"||y!=="never"&&s!=="never"||(h=!1),h}class wa{constructor(s,h,d){const g=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(s/d),this.yCellCount=Math.ceil(h/d);for(let I=0;I<this.xCellCount*this.yCellCount;I++)g.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,d,g,b){this._forEachCell(h,d,g,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(b)}insertCircle(s,h,d,g){this._forEachCell(h-g,d-g,h+g,d+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(d),this.circles.push(g)}_insertBoxCell(s,h,d,g,b,I){this.boxCells[b].push(I)}_insertCircleCell(s,h,d,g,b,I){this.circleCells[b].push(I)}_query(s,h,d,g,b,I,C){if(d<0||s>this.width||g<0||h>this.height)return[];const M=[];if(s<=0&&h<=0&&this.width<=d&&this.height<=g){if(b)return[{key:null,x1:s,y1:h,x2:d,y2:g}];for(let A=0;A<this.boxKeys.length;A++)M.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const R=this.circles[3*A],O=this.circles[3*A+1],j=this.circles[3*A+2];M.push({key:this.circleKeys[A],x1:R-j,y1:O-j,x2:R+j,y2:O+j})}}else this._forEachCell(s,h,d,g,this._queryCell,M,{hitTest:b,overlapMode:I,seenUids:{box:{},circle:{}}},C);return M}query(s,h,d,g){return this._query(s,h,d,g,!1,null)}hitTest(s,h,d,g,b,I){return this._query(s,h,d,g,!0,b,I).length>0}hitTestCircle(s,h,d,g,b){const I=s-d,C=s+d,M=h-d,A=h+d;if(C<0||I>this.width||A<0||M>this.height)return!1;const R=[];return this._forEachCell(I,M,C,A,this._queryCellCircle,R,{hitTest:!0,overlapMode:g,circle:{x:s,y:h,radius:d},seenUids:{box:{},circle:{}}},b),R.length>0}_queryCell(s,h,d,g,b,I,C,M){const{seenUids:A,hitTest:R,overlapMode:O}=C,j=this.boxCells[b];if(j!==null){const et=this.bboxes;for(const at of j)if(!A.box[at]){A.box[at]=!0;const $=4*at,xt=this.boxKeys[at];if(s<=et[$+2]&&h<=et[$+3]&&d>=et[$+0]&&g>=et[$+1]&&(!M||M(xt))&&(!R||!gi(O,xt.overlapMode))&&(I.push({key:xt,x1:et[$],y1:et[$+1],x2:et[$+2],y2:et[$+3]}),R))return!0}}const nt=this.circleCells[b];if(nt!==null){const et=this.circles;for(const at of nt)if(!A.circle[at]){A.circle[at]=!0;const $=3*at,xt=this.circleKeys[at];if(this._circleAndRectCollide(et[$],et[$+1],et[$+2],s,h,d,g)&&(!M||M(xt))&&(!R||!gi(O,xt.overlapMode))){const Nt=et[$],ut=et[$+1],It=et[$+2];if(I.push({key:xt,x1:Nt-It,y1:ut-It,x2:Nt+It,y2:ut+It}),R)return!0}}}return!1}_queryCellCircle(s,h,d,g,b,I,C,M){const{circle:A,seenUids:R,overlapMode:O}=C,j=this.boxCells[b];if(j!==null){const et=this.bboxes;for(const at of j)if(!R.box[at]){R.box[at]=!0;const $=4*at,xt=this.boxKeys[at];if(this._circleAndRectCollide(A.x,A.y,A.radius,et[$+0],et[$+1],et[$+2],et[$+3])&&(!M||M(xt))&&!gi(O,xt.overlapMode))return I.push(!0),!0}}const nt=this.circleCells[b];if(nt!==null){const et=this.circles;for(const at of nt)if(!R.circle[at]){R.circle[at]=!0;const $=3*at,xt=this.circleKeys[at];if(this._circlesCollide(et[$],et[$+1],et[$+2],A.x,A.y,A.radius)&&(!M||M(xt))&&!gi(O,xt.overlapMode))return I.push(!0),!0}}}_forEachCell(s,h,d,g,b,I,C,M){const A=this._convertToXCellCoord(s),R=this._convertToYCellCoord(h),O=this._convertToXCellCoord(d),j=this._convertToYCellCoord(g);for(let nt=A;nt<=O;nt++)for(let et=R;et<=j;et++)if(b.call(this,s,h,d,g,this.xCellCount*et+nt,I,C,M))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,d,g,b,I){const C=g-s,M=b-h,A=d+I;return A*A>C*C+M*M}_circleAndRectCollide(s,h,d,g,b,I,C){const M=(I-g)/2,A=Math.abs(s-(g+M));if(A>M+d)return!1;const R=(C-b)/2,O=Math.abs(h-(b+R));if(O>R+d)return!1;if(A<=M||O<=R)return!0;const j=A-M,nt=O-R;return j*j+nt*nt<=d*d}}function ae(y,s,h,d,g){const b=a.Z();return s?(a.a0(b,b,[1/g,1/g,1]),h||a.ae(b,b,d.angle)):a.a1(b,d.labelPlaneMatrix,y),b}function wo(y,s,h,d,g){if(s){const b=a.af(y);return a.a0(b,b,[g,g,1]),h||a.ae(b,b,-d.angle),b}return d.glCoordMatrix}function ri(y,s,h){let d;h?(d=[y.x,y.y,h(y.x,y.y),1],a.ag(d,d,s)):(d=[y.x,y.y,0,1],q(d,d,s));const g=d[3];return{point:new a.P(d[0]/g,d[1]/g),signedDistanceFromCamera:g}}function Sa(y,s){return .5+y/s*.5}function Ss(y,s){const h=y[0]/y[3],d=y[1]/y[3];return h>=-s[0]&&h<=s[0]&&d>=-s[1]&&d<=s[1]}function ue(y,s,h,d,g,b,I,C,M,A){const R=d?y.textSizeData:y.iconSizeData,O=a.ah(R,h.transform.zoom),j=[256/h.width*2+1,256/h.height*2+1],nt=d?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;nt.clear();const et=y.lineVertexArray,at=d?y.text.placedSymbolArray:y.icon.placedSymbolArray,$=h.transform.width/h.transform.height;let xt=!1;for(let Nt=0;Nt<at.length;Nt++){const ut=at.get(Nt);if(ut.hidden||ut.writingMode===a.ai.vertical&&!xt){J(ut.numGlyphs,nt);continue}let It;if(xt=!1,A?(It=[ut.anchorX,ut.anchorY,A(ut.anchorX,ut.anchorY),1],a.ag(It,It,s)):(It=[ut.anchorX,ut.anchorY,0,1],q(It,It,s)),!Ss(It,j)){J(ut.numGlyphs,nt);continue}const Ft=Sa(h.transform.cameraToCenterDistance,It[3]),Bt=a.aj(R,O,ut),Wt=I?Bt/Ft:Bt*Ft,ne=new a.P(ut.anchorX,ut.anchorY),Yt=ri(ne,g,A).point,se={projections:{},offsets:{}},Ce=Pr(ut,Wt,!1,C,s,g,b,y.glyphOffsetArray,et,nt,Yt,ne,se,$,M,A);xt=Ce.useVertical,(Ce.notEnoughRoom||xt||Ce.needsFlipping&&Pr(ut,Wt,!0,C,s,g,b,y.glyphOffsetArray,et,nt,Yt,ne,se,$,M,A).notEnoughRoom)&&J(ut.numGlyphs,nt)}d?y.text.dynamicLayoutVertexBuffer.updateData(nt):y.icon.dynamicLayoutVertexBuffer.updateData(nt)}function ln(y,s,h,d,g,b,I,C,M,A,R,O,j){const nt=C.glyphStartIndex+C.numGlyphs,et=C.lineStartIndex,at=C.lineStartIndex+C.lineLength,$=s.getoffsetX(C.glyphStartIndex),xt=s.getoffsetX(nt-1),Nt=B(y*$,h,d,g,b,I,C.segment,et,at,M,A,R,O,j);if(!Nt)return null;const ut=B(y*xt,h,d,g,b,I,C.segment,et,at,M,A,R,O,j);return ut?{first:Nt,last:ut}:null}function Ke(y,s,h,d){return y===a.ai.horizontal&&Math.abs(h.y-s.y)>Math.abs(h.x-s.x)*d?{useVertical:!0}:(y===a.ai.vertical?s.y<h.y:s.x>h.x)?{needsFlipping:!0}:null}function Pr(y,s,h,d,g,b,I,C,M,A,R,O,j,nt,et,at){const $=s/24,xt=y.lineOffsetX*$,Nt=y.lineOffsetY*$;let ut;if(y.numGlyphs>1){const It=y.glyphStartIndex+y.numGlyphs,Ft=y.lineStartIndex,Bt=y.lineStartIndex+y.lineLength,Wt=ln($,C,xt,Nt,h,R,O,y,M,b,j,et,at);if(!Wt)return{notEnoughRoom:!0};const ne=ri(Wt.first.point,I,at).point,Yt=ri(Wt.last.point,I,at).point;if(d&&!h){const se=Ke(y.writingMode,ne,Yt,nt);if(se)return se}ut=[Wt.first];for(let se=y.glyphStartIndex+1;se<It-1;se++)ut.push(B($*C.getoffsetX(se),xt,Nt,h,R,O,y.segment,Ft,Bt,M,b,j,et,at));ut.push(Wt.last)}else{if(d&&!h){const Ft=ri(O,g,at).point,Bt=y.lineStartIndex+y.segment+1,Wt=new a.P(M.getx(Bt),M.gety(Bt)),ne=ri(Wt,g,at),Yt=ne.signedDistanceFromCamera>0?ne.point:is(O,Wt,Ft,1,g,at),se=Ke(y.writingMode,Ft,Yt,nt);if(se)return se}const It=B($*C.getoffsetX(y.glyphStartIndex),xt,Nt,h,R,O,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,M,b,j,et,at);if(!It)return{notEnoughRoom:!0};ut=[It]}for(const It of ut)a.ak(A,It.point,It.angle);return{}}function is(y,s,h,d,g,b){const I=ri(y.add(y.sub(s)._unit()),g,b).point,C=h.sub(I);return h.add(C._mult(d/C.mag()))}function on(y,s){const{projectionCache:h,lineVertexArray:d,labelPlaneMatrix:g,tileAnchorPoint:b,distanceFromAnchor:I,getElevation:C,previousVertex:M,direction:A,absOffsetX:R}=s;if(h.projections[y])return h.projections[y];const O=new a.P(d.getx(y),d.gety(y)),j=ri(O,g,C);if(j.signedDistanceFromCamera>0)return h.projections[y]=j.point,j.point;const nt=y-A;return is(I===0?b:new a.P(d.getx(nt),d.gety(nt)),O,M,R-I+1,g,C)}function Es(y,s,h){return y._unit()._perp()._mult(s*h)}function st(y,s,h,d,g,b,I,C){const{projectionCache:M,direction:A}=C;if(M.offsets[y])return M.offsets[y];const R=h.add(s);if(y+A<d||y+A>=g)return M.offsets[y]=R,R;const O=on(y+A,C),j=Es(O.sub(h),I,A),nt=h.add(j),et=O.add(j);return M.offsets[y]=a.al(b,R,nt,et)||R,M.offsets[y]}function B(y,s,h,d,g,b,I,C,M,A,R,O,j,nt){const et=d?y-s:y+s;let at=et>0?1:-1,$=0;d&&(at*=-1,$=Math.PI),at<0&&($+=Math.PI);let xt,Nt,ut=at>0?C+I:C+I+1,It=g,Ft=g,Bt=0,Wt=0;const ne=Math.abs(et),Yt=[];let se;for(;Bt+Wt<=ne;){if(ut+=at,ut<C||ut>=M)return null;Bt+=Wt,Ft=It,Nt=xt;const fe={projectionCache:O,lineVertexArray:A,labelPlaneMatrix:R,tileAnchorPoint:b,distanceFromAnchor:Bt,getElevation:nt,previousVertex:Ft,direction:at,absOffsetX:ne};if(It=on(ut,fe),h===0)Yt.push(Ft),se=It.sub(Ft);else{let qe;const Le=It.sub(Ft);qe=Le.mag()===0?Es(on(ut+at,fe).sub(It),h,at):Es(Le,h,at),Nt||(Nt=Ft.add(qe)),xt=st(ut,qe,It,C,M,Nt,h,fe),Yt.push(Nt),se=xt.sub(Nt)}Wt=se.mag()}const Ce=se._mult((ne-Bt)/Wt)._add(Nt||Ft),xn=$+Math.atan2(It.y-Ft.y,It.x-Ft.x);return Yt.push(Ce),{point:Ce,angle:j?xn:0,path:Yt}}const G=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function J(y,s){for(let h=0;h<y;h++){const d=s.length;s.resize(d+4),s.float32.set(G,3*d)}}function q(y,s,h){const d=s[0],g=s[1];return y[0]=h[0]*d+h[4]*g+h[12],y[1]=h[1]*d+h[5]*g+h[13],y[3]=h[3]*d+h[7]*g+h[15],y}const ot=100;class St{constructor(s,h=new wa(s.width+200,s.height+200,25),d=new wa(s.width+200,s.height+200,25)){this.transform=s,this.grid=h,this.ignoredGrid=d,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+ot,this.screenBottomBoundary=s.height+ot,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,h,d,g,b,I){const C=this.projectAndGetPerspectiveRatio(g,s.anchorPointX,s.anchorPointY,I),M=d*C.perspectiveRatio,A=s.x1*M+C.point.x,R=s.y1*M+C.point.y,O=s.x2*M+C.point.x,j=s.y2*M+C.point.y;return!this.isInsideGrid(A,R,O,j)||h!=="always"&&this.grid.hitTest(A,R,O,j,h,b)||C.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[A,R,O,j],offscreen:this.isOffscreen(A,R,O,j)}}placeCollisionCircles(s,h,d,g,b,I,C,M,A,R,O,j,nt,et){const at=[],$=new a.P(h.anchorX,h.anchorY),xt=ri($,I,et),Nt=Sa(this.transform.cameraToCenterDistance,xt.signedDistanceFromCamera),ut=(R?b/Nt:b*Nt)/a.ap,It=ri($,C,et).point,Ft=ln(ut,g,h.lineOffsetX*ut,h.lineOffsetY*ut,!1,It,$,h,d,C,{projections:{},offsets:{}},!1,et);let Bt=!1,Wt=!1,ne=!0;if(Ft){const Yt=.5*j*Nt+nt,se=new a.P(-100,-100),Ce=new a.P(this.screenRightBoundary,this.screenBottomBoundary),xn=new vn,fe=Ft.first,qe=Ft.last;let Le=[];for(let hn=fe.path.length-1;hn>=1;hn--)Le.push(fe.path[hn]);for(let hn=1;hn<qe.path.length;hn++)Le.push(qe.path[hn]);const Yn=2.5*Yt;if(M){const hn=Le.map(wn=>ri(wn,M,et));Le=hn.some(wn=>wn.signedDistanceFromCamera<=0)?[]:hn.map(wn=>wn.point)}let bn=[];if(Le.length>0){const hn=Le[0].clone(),wn=Le[0].clone();for(let ji=1;ji<Le.length;ji++)hn.x=Math.min(hn.x,Le[ji].x),hn.y=Math.min(hn.y,Le[ji].y),wn.x=Math.max(wn.x,Le[ji].x),wn.y=Math.max(wn.y,Le[ji].y);bn=hn.x>=se.x&&wn.x<=Ce.x&&hn.y>=se.y&&wn.y<=Ce.y?[Le]:wn.x<se.x||hn.x>Ce.x||wn.y<se.y||hn.y>Ce.y?[]:a.am([Le],se.x,se.y,Ce.x,Ce.y)}for(const hn of bn){xn.reset(hn,.25*Yt);let wn=0;wn=xn.length<=.5*Yt?1:Math.ceil(xn.paddedLength/Yn)+1;for(let ji=0;ji<wn;ji++){const si=ji/Math.max(wn-1,1),Nr=xn.lerp(si),cr=Nr.x+ot,Qi=Nr.y+ot;at.push(cr,Qi,Yt,0);const Go=cr-Yt,pi=Qi-Yt,Zs=cr+Yt,Ws=Qi+Yt;if(ne=ne&&this.isOffscreen(Go,pi,Zs,Ws),Wt=Wt||this.isInsideGrid(Go,pi,Zs,Ws),s!=="always"&&this.grid.hitTestCircle(cr,Qi,Yt,s,O)&&(Bt=!0,!A))return{circles:[],offscreen:!1,collisionDetected:Bt}}}}return{circles:!A&&Bt||!Wt||Nt<this.perspectiveRatioCutoff?[]:at,offscreen:ne,collisionDetected:Bt}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let d=1/0,g=1/0,b=-1/0,I=-1/0;for(const R of s){const O=new a.P(R.x+ot,R.y+ot);d=Math.min(d,O.x),g=Math.min(g,O.y),b=Math.max(b,O.x),I=Math.max(I,O.y),h.push(O)}const C=this.grid.query(d,g,b,I).concat(this.ignoredGrid.query(d,g,b,I)),M={},A={};for(const R of C){const O=R.key;if(M[O.bucketInstanceId]===void 0&&(M[O.bucketInstanceId]={}),M[O.bucketInstanceId][O.featureIndex])continue;const j=[new a.P(R.x1,R.y1),new a.P(R.x2,R.y1),new a.P(R.x2,R.y2),new a.P(R.x1,R.y2)];a.an(h,j)&&(M[O.bucketInstanceId][O.featureIndex]=!0,A[O.bucketInstanceId]===void 0&&(A[O.bucketInstanceId]=[]),A[O.bucketInstanceId].push(O.featureIndex))}return A}insertCollisionBox(s,h,d,g,b,I){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:b,collisionGroupID:I,overlapMode:h},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,d,g,b,I){const C=d?this.ignoredGrid:this.grid,M={bucketInstanceId:g,featureIndex:b,collisionGroupID:I,overlapMode:h};for(let A=0;A<s.length;A+=4)C.insertCircle(M,s[A],s[A+1],s[A+2])}projectAndGetPerspectiveRatio(s,h,d,g){let b;return g?(b=[h,d,g(h,d),1],a.ag(b,b,s)):(b=[h,d,0,1],q(b,b,s)),{point:new a.P((b[0]/b[3]+1)/2*this.transform.width+ot,(-b[1]/b[3]+1)/2*this.transform.height+ot),perspectiveRatio:.5+this.transform.cameraToCenterDistance/b[3]*.5}}isOffscreen(s,h,d,g){return d<ot||s>=this.screenRightBoundary||g<ot||h>this.screenBottomBoundary}isInsideGrid(s,h,d,g){return d>=0&&s<this.gridRightBoundary&&g>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const s=a.ao([]);return a.$(s,s,[-100,-100,0]),s}}function _t(y,s,h){return s*(a.N/(y.tileSize*Math.pow(2,h-y.tileID.overscaledZ)))}class it{constructor(s,h,d,g){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):g&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class bt{constructor(s,h,d,g,b){this.text=new it(s?s.text:null,h,d,b),this.icon=new it(s?s.icon:null,h,g,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class jt{constructor(s,h,d){this.text=s,this.icon=h,this.skipFade=d}}class Zt{constructor(){this.invProjMatrix=a.Z(),this.viewportMatrix=a.Z(),this.circles=[]}}class Xt{constructor(s,h,d,g,b){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=d,this.bucketIndex=g,this.tileID=b}}class Pe{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:d=>d.collisionGroupID===h}}return this.collisionGroups[s]}}function Ye(y,s,h,d,g){const{horizontalAlign:b,verticalAlign:I}=a.au(y);return new a.P(-(b-.5)*s+d[0]*g,-(I-.5)*h+d[1]*g)}function Ie(y,s,h,d,g,b){const{x1:I,x2:C,y1:M,y2:A,anchorPointX:R,anchorPointY:O}=y,j=new a.P(s,h);return d&&j._rotate(g?b:-b),{x1:I+j.x,y1:M+j.y,x2:C+j.x,y2:A+j.y,anchorPointX:R,anchorPointY:O}}class Fe{constructor(s,h,d,g,b){this.transform=s.clone(),this.terrain=h,this.collisionIndex=new St(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Pe(g),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,h,d,g){const b=d.getBucket(h),I=d.latestFeatureIndex;if(!b||!I||h.id!==b.layerIds[0])return;const C=d.collisionBoxArray,M=b.layers[0].layout,A=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),R=d.tileSize/a.N,O=this.transform.calculatePosMatrix(d.tileID.toUnwrapped()),j=M.get("text-pitch-alignment")==="map",nt=M.get("text-rotation-alignment")==="map",et=_t(d,1,this.transform.zoom),at=ae(O,j,nt,this.transform,et);let $=null;if(j){const Nt=wo(O,j,nt,this.transform,et);$=a.a1([],this.transform.labelPlaneMatrix,Nt)}this.retainedQueryData[b.bucketInstanceId]=new Xt(b.bucketInstanceId,I,b.sourceLayerIndex,b.index,d.tileID);const xt={bucket:b,layout:M,posMatrix:O,textLabelPlaneMatrix:at,labelToScreenMatrix:$,scale:A,textPixelRatio:R,holdingForFade:d.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:a.ah(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(g)for(const Nt of b.sortKeyRanges){const{sortKey:ut,symbolInstanceStart:It,symbolInstanceEnd:Ft}=Nt;s.push({sortKey:ut,symbolInstanceStart:It,symbolInstanceEnd:Ft,parameters:xt})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:xt})}attemptAnchorPlacement(s,h,d,g,b,I,C,M,A,R,O,j,nt,et,at,$){const xt=a.aq[s.textAnchor],Nt=[s.textOffset0,s.textOffset1],ut=Ye(xt,d,g,Nt,b),It=this.collisionIndex.placeCollisionBox(Ie(h,ut.x,ut.y,I,C,this.transform.angle),O,M,A,R.predicate,$);if((!at||this.collisionIndex.placeCollisionBox(Ie(at,ut.x,ut.y,I,C,this.transform.angle),O,M,A,R.predicate,$).box.length!==0)&&It.box.length>0){let Ft;if(this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(Ft=this.prevPlacement.variableOffsets[j.crossTileID].anchor),j.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[j.crossTileID]={textOffset:Nt,width:d,height:g,anchor:xt,textBoxScale:b,prevAnchor:Ft},this.markUsedJustification(nt,xt,j,et),nt.allowVerticalPlacement&&(this.markUsedOrientation(nt,et,j),this.placedOrientations[j.crossTileID]=et),{shift:ut,placedGlyphBoxes:It}}}placeLayerBucketPart(s,h,d){const{bucket:g,layout:b,posMatrix:I,textLabelPlaneMatrix:C,labelToScreenMatrix:M,textPixelRatio:A,holdingForFade:R,collisionBoxArray:O,partiallyEvaluatedTextSize:j,collisionGroup:nt}=s.parameters,et=b.get("text-optional"),at=b.get("icon-optional"),$=a.ar(b,"text-overlap","text-allow-overlap"),xt=$==="always",Nt=a.ar(b,"icon-overlap","icon-allow-overlap"),ut=Nt==="always",It=b.get("text-rotation-alignment")==="map",Ft=b.get("text-pitch-alignment")==="map",Bt=b.get("icon-text-fit")!=="none",Wt=b.get("symbol-z-order")==="viewport-y",ne=xt&&(ut||!g.hasIconData()||at),Yt=ut&&(xt||!g.hasTextData()||et);!g.collisionArrays&&O&&g.deserializeCollisionBoxes(O);const se=this.retainedQueryData[g.bucketInstanceId].tileID,Ce=this.terrain?(fe,qe)=>this.terrain.getElevation(se,fe,qe):null,xn=(fe,qe)=>{var Le,Yn;if(h[fe.crossTileID])return;if(R)return void(this.placements[fe.crossTileID]=new jt(!1,!1,!1));let bn=!1,hn=!1,wn=!0,ji=null,si={box:null,offscreen:null},Nr={box:null,offscreen:null},cr=null,Qi=null,Go=null,pi=0,Zs=0,Ws=0;qe.textFeatureIndex?pi=qe.textFeatureIndex:fe.useRuntimeCollisionCircles&&(pi=fe.featureIndex),qe.verticalTextFeatureIndex&&(Zs=qe.verticalTextFeatureIndex);const tl=qe.textBox;if(tl){const Kr=Zi=>{let hr=a.ai.horizontal;if(g.allowVerticalPlacement&&!Zi&&this.prevPlacement){const Io=this.prevPlacement.placedOrientations[fe.crossTileID];Io&&(this.placedOrientations[fe.crossTileID]=Io,hr=Io,this.markUsedOrientation(g,hr,fe))}return hr},Dr=(Zi,hr)=>{if(g.allowVerticalPlacement&&fe.numVerticalGlyphVertices>0&&qe.verticalTextBox){for(const Io of g.writingModes)if(Io===a.ai.vertical?(si=hr(),Nr=si):si=Zi(),si&&si.box&&si.box.length)break}else si=Zi()},ho=fe.textAnchorOffsetStartIndex,Al=fe.textAnchorOffsetEndIndex;if(Al===ho){const Zi=(hr,Io)=>{const Wi=this.collisionIndex.placeCollisionBox(hr,$,A,I,nt.predicate,Ce);return Wi&&Wi.box&&Wi.box.length&&(this.markUsedOrientation(g,Io,fe),this.placedOrientations[fe.crossTileID]=Io),Wi};Dr(()=>Zi(tl,a.ai.horizontal),()=>{const hr=qe.verticalTextBox;return g.allowVerticalPlacement&&fe.numVerticalGlyphVertices>0&&hr?Zi(hr,a.ai.vertical):{box:null,offscreen:null}}),Kr(si&&si.box&&si.box.length)}else{let Zi=a.aq[(Yn=(Le=this.prevPlacement)===null||Le===void 0?void 0:Le.variableOffsets[fe.crossTileID])===null||Yn===void 0?void 0:Yn.anchor];const hr=(Wi,kl,hh)=>{const rm=Wi.x2-Wi.x1,om=Wi.y2-Wi.y1,Kg=fe.textBoxScale,$p=Bt&&Nt==="never"?kl:null;let Xs={box:[],offscreen:!1},Nl=$==="never"?1:2,Hs="never";Zi&&Nl++;for(let cs=0;cs<Nl;cs++){for(let Ys=ho;Ys<Al;Ys++){const tf=g.textAnchorOffsets.get(Ys);if(Zi&&tf.textAnchor!==Zi)continue;const Ma=this.attemptAnchorPlacement(tf,Wi,rm,om,Kg,It,Ft,A,I,nt,Hs,fe,g,hh,$p,Ce);if(Ma&&(Xs=Ma.placedGlyphBoxes,Xs&&Xs.box&&Xs.box.length))return bn=!0,ji=Ma.shift,Xs}Zi?Zi=null:Hs=$}return Xs};Dr(()=>hr(tl,qe.iconBox,a.ai.horizontal),()=>{const Wi=qe.verticalTextBox;return g.allowVerticalPlacement&&!(si&&si.box&&si.box.length)&&fe.numVerticalGlyphVertices>0&&Wi?hr(Wi,qe.verticalIconBox,a.ai.vertical):{box:null,offscreen:null}}),si&&(bn=si.box,wn=si.offscreen);const Io=Kr(si&&si.box);if(!bn&&this.prevPlacement){const Wi=this.prevPlacement.variableOffsets[fe.crossTileID];Wi&&(this.variableOffsets[fe.crossTileID]=Wi,this.markUsedJustification(g,Wi.anchor,fe,Io))}}}if(cr=si,bn=cr&&cr.box&&cr.box.length>0,wn=cr&&cr.offscreen,fe.useRuntimeCollisionCircles){const Kr=g.text.placedSymbolArray.get(fe.centerJustifiedTextSymbolIndex),Dr=a.aj(g.textSizeData,j,Kr),ho=b.get("text-padding");Qi=this.collisionIndex.placeCollisionCircles($,Kr,g.lineVertexArray,g.glyphOffsetArray,Dr,I,C,M,d,Ft,nt.predicate,fe.collisionCircleDiameter,ho,Ce),Qi.circles.length&&Qi.collisionDetected&&!d&&a.w("Collisions detected, but collision boxes are not shown"),bn=xt||Qi.circles.length>0&&!Qi.collisionDetected,wn=wn&&Qi.offscreen}if(qe.iconFeatureIndex&&(Ws=qe.iconFeatureIndex),qe.iconBox){const Kr=Dr=>{const ho=Bt&&ji?Ie(Dr,ji.x,ji.y,It,Ft,this.transform.angle):Dr;return this.collisionIndex.placeCollisionBox(ho,Nt,A,I,nt.predicate,Ce)};Nr&&Nr.box&&Nr.box.length&&qe.verticalIconBox?(Go=Kr(qe.verticalIconBox),hn=Go.box.length>0):(Go=Kr(qe.iconBox),hn=Go.box.length>0),wn=wn&&Go.offscreen}const Pl=et||fe.numHorizontalGlyphVertices===0&&fe.numVerticalGlyphVertices===0,_u=at||fe.numIconVertices===0;if(Pl||_u?_u?Pl||(hn=hn&&bn):bn=hn&&bn:hn=bn=hn&&bn,bn&&cr&&cr.box&&this.collisionIndex.insertCollisionBox(cr.box,$,b.get("text-ignore-placement"),g.bucketInstanceId,Nr&&Nr.box&&Zs?Zs:pi,nt.ID),hn&&Go&&this.collisionIndex.insertCollisionBox(Go.box,Nt,b.get("icon-ignore-placement"),g.bucketInstanceId,Ws,nt.ID),Qi&&(bn&&this.collisionIndex.insertCollisionCircles(Qi.circles,$,b.get("text-ignore-placement"),g.bucketInstanceId,pi,nt.ID),d)){const Kr=g.bucketInstanceId;let Dr=this.collisionCircleArrays[Kr];Dr===void 0&&(Dr=this.collisionCircleArrays[Kr]=new Zt);for(let ho=0;ho<Qi.circles.length;ho+=4)Dr.circles.push(Qi.circles[ho+0]),Dr.circles.push(Qi.circles[ho+1]),Dr.circles.push(Qi.circles[ho+2]),Dr.circles.push(Qi.collisionDetected?1:0)}if(fe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[fe.crossTileID]=new jt(bn||ne,hn||Yt,wn||g.justReloaded),h[fe.crossTileID]=!0};if(Wt){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const fe=g.getSortedSymbolIndexes(this.transform.angle);for(let qe=fe.length-1;qe>=0;--qe){const Le=fe[qe];xn(g.symbolInstances.get(Le),g.collisionArrays[Le])}}else for(let fe=s.symbolInstanceStart;fe<s.symbolInstanceEnd;fe++)xn(g.symbolInstances.get(fe),g.collisionArrays[fe]);if(d&&g.bucketInstanceId in this.collisionCircleArrays){const fe=this.collisionCircleArrays[g.bucketInstanceId];a.as(fe.invProjMatrix,I),fe.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(s,h,d,g){let b;b=g===a.ai.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[a.at(h)];const I=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const C of I)C>=0&&(s.text.placedSymbolArray.get(C).crossTileID=b>=0&&C!==b?0:d.crossTileID)}markUsedOrientation(s,h,d){const g=h===a.ai.horizontal||h===a.ai.horizontalOnly?h:0,b=h===a.ai.vertical?h:0,I=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const C of I)s.text.placedSymbolArray.get(C).placedOrientation=g;d.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let d=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const g=h?h.symbolFadeChange(s):1,b=h?h.opacities:{},I=h?h.variableOffsets:{},C=h?h.placedOrientations:{};for(const M in this.placements){const A=this.placements[M],R=b[M];R?(this.opacities[M]=new bt(R,g,A.text,A.icon),d=d||A.text!==R.text.placed||A.icon!==R.icon.placed):(this.opacities[M]=new bt(null,g,A.text,A.icon,A.skipFade),d=d||A.text||A.icon)}for(const M in b){const A=b[M];if(!this.opacities[M]){const R=new bt(A,g,!1,!1);R.isHidden()||(this.opacities[M]=R,d=d||A.text.placed||A.icon.placed)}}for(const M in I)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=I[M]);for(const M in C)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=C[M]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");d?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h){const d={};for(const g of h){const b=g.getBucket(s);b&&g.latestFeatureIndex&&s.id===b.layerIds[0]&&this.updateBucketOpacities(b,d,g.collisionBoxArray)}}updateBucketOpacities(s,h,d){s.hasTextData()&&(s.text.opacityVertexArray.clear(),s.text.hasVisibleVertices=!1),s.hasIconData()&&(s.icon.opacityVertexArray.clear(),s.icon.hasVisibleVertices=!1),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const g=s.layers[0],b=g.layout,I=new bt(null,0,!1,!1,!0),C=b.get("text-allow-overlap"),M=b.get("icon-allow-overlap"),A=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),R=b.get("text-rotation-alignment")==="map",O=b.get("text-pitch-alignment")==="map",j=b.get("icon-text-fit")!=="none",nt=new bt(null,0,C&&(M||!s.hasIconData()||b.get("icon-optional")),M&&(C||!s.hasTextData()||b.get("text-optional")),!0);!s.collisionArrays&&d&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(d);const et=(at,$,xt)=>{for(let Nt=0;Nt<$/4;Nt++)at.opacityVertexArray.emplaceBack(xt);at.hasVisibleVertices=at.hasVisibleVertices||xt!==rs};for(let at=0;at<s.symbolInstances.length;at++){const $=s.symbolInstances.get(at),{numHorizontalGlyphVertices:xt,numVerticalGlyphVertices:Nt,crossTileID:ut}=$;let It=this.opacities[ut];h[ut]?It=I:It||(It=nt,this.opacities[ut]=It),h[ut]=!0;const Ft=$.numIconVertices>0,Bt=this.placedOrientations[$.crossTileID],Wt=Bt===a.ai.vertical,ne=Bt===a.ai.horizontal||Bt===a.ai.horizontalOnly;if(xt>0||Nt>0){const Yt=Ar(It.text);et(s.text,xt,Wt?rs:Yt),et(s.text,Nt,ne?rs:Yt);const se=It.text.isHidden();[$.rightJustifiedTextSymbolIndex,$.centerJustifiedTextSymbolIndex,$.leftJustifiedTextSymbolIndex].forEach(fe=>{fe>=0&&(s.text.placedSymbolArray.get(fe).hidden=se||Wt?1:0)}),$.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get($.verticalPlacedTextSymbolIndex).hidden=se||ne?1:0);const Ce=this.variableOffsets[$.crossTileID];Ce&&this.markUsedJustification(s,Ce.anchor,$,Bt);const xn=this.placedOrientations[$.crossTileID];xn&&(this.markUsedJustification(s,"left",$,xn),this.markUsedOrientation(s,xn,$))}if(Ft){const Yt=Ar(It.icon),se=!(j&&$.verticalPlacedIconSymbolIndex&&Wt);$.placedIconSymbolIndex>=0&&(et(s.icon,$.numIconVertices,se?Yt:rs),s.icon.placedSymbolArray.get($.placedIconSymbolIndex).hidden=It.icon.isHidden()),$.verticalPlacedIconSymbolIndex>=0&&(et(s.icon,$.numVerticalIconVertices,se?rs:Yt),s.icon.placedSymbolArray.get($.verticalPlacedIconSymbolIndex).hidden=It.icon.isHidden())}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Yt=s.collisionArrays[at];if(Yt){let se=new a.P(0,0);if(Yt.textBox||Yt.verticalTextBox){let xn=!0;if(A){const fe=this.variableOffsets[ut];fe?(se=Ye(fe.anchor,fe.width,fe.height,fe.textOffset,fe.textBoxScale),R&&se._rotate(O?this.transform.angle:-this.transform.angle)):xn=!1}Yt.textBox&&nn(s.textCollisionBox.collisionVertexArray,It.text.placed,!xn||Wt,se.x,se.y),Yt.verticalTextBox&&nn(s.textCollisionBox.collisionVertexArray,It.text.placed,!xn||ne,se.x,se.y)}const Ce=!!(!ne&&Yt.verticalIconBox);Yt.iconBox&&nn(s.iconCollisionBox.collisionVertexArray,It.icon.placed,Ce,j?se.x:0,j?se.y:0),Yt.verticalIconBox&&nn(s.iconCollisionBox.collisionVertexArray,It.icon.placed,!Ce,j?se.x:0,j?se.y:0)}}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);if(s.bucketInstanceId in this.collisionCircleArrays){const at=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=at.invProjMatrix,s.placementViewportMatrix=at.viewportMatrix,s.collisionCircleArray=at.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){const d=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*d>s}setStale(){this.stale=!0}}function nn(y,s,h,d,g){y.emplaceBack(s?1:0,h?1:0,d||0,g||0),y.emplaceBack(s?1:0,h?1:0,d||0,g||0),y.emplaceBack(s?1:0,h?1:0,d||0,g||0),y.emplaceBack(s?1:0,h?1:0,d||0,g||0)}const qn=Math.pow(2,25),Qn=Math.pow(2,24),An=Math.pow(2,17),Pn=Math.pow(2,16),Hr=Math.pow(2,9),oi=Math.pow(2,8),sr=Math.pow(2,1);function Ar(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const s=y.placed?1:0,h=Math.floor(127*y.opacity);return h*qn+s*Qn+h*An+s*Pn+h*Hr+s*oi+h*sr+s}const rs=0;class bd{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,h,d,g,b){const I=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(I,g,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((C,M)=>C.sortKey-M.sortKey));this._currentPartIndex<I.length;)if(h.placeLayerBucketPart(I[this._currentPartIndex],this._seenCrossTileIDs,d),this._currentPartIndex++,b())return!0;return!1}}class ru{constructor(s,h,d,g,b,I,C,M){this.placement=new Fe(s,h,I,C,M),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(s,h,d){const g=a.h.now(),b=()=>!this._forceFullPlacement&&a.h.now()-g>2;for(;this._currentPlacementIndex>=0;){const I=h[s[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=C)&&(!I.maxzoom||I.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new bd(I)),this._inProgressLayer.continuePlacement(d[I.source],this.placement,this._showCollisionBoxes,I,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const ou=512/a.N/2;class Ng{constructor(s,h,d){this.tileID=s,this.bucketInstanceId=d,this._symbolsByKey={};const g=new Map;for(let b=0;b<h.length;b++){const I=h.get(b),C=I.key,M=g.get(C);M?M.push(I):g.set(C,[I])}for(const[b,I]of g){const C={positions:I.map(M=>({x:Math.floor(M.anchorX*ou),y:Math.floor(M.anchorY*ou)})),crossTileIDs:I.map(M=>M.crossTileID)};if(C.positions.length>128){const M=new a.av(C.positions.length,16,Uint16Array);for(const{x:A,y:R}of C.positions)M.add(A,R);M.finish(),delete C.positions,C.index=M}this._symbolsByKey[b]=C}}getScaledCoordinates(s,h){const{x:d,y:g,z:b}=this.tileID.canonical,{x:I,y:C,z:M}=h.canonical,A=ou/Math.pow(2,M-b),R=(C*a.N+s.anchorY)*A,O=g*a.N*ou;return{x:Math.floor((I*a.N+s.anchorX)*A-d*a.N*ou),y:Math.floor(R-O)}}findMatches(s,h,d){const g=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let b=0;b<s.length;b++){const I=s.get(b);if(I.crossTileID)continue;const C=this._symbolsByKey[I.key];if(!C)continue;const M=this.getScaledCoordinates(I,h);if(C.index){const A=C.index.range(M.x-g,M.y-g,M.x+g,M.y+g).sort();for(const R of A){const O=C.crossTileIDs[R];if(!d[O]){d[O]=!0,I.crossTileID=O;break}}}else if(C.positions)for(let A=0;A<C.positions.length;A++){const R=C.positions[A],O=C.crossTileIDs[A];if(Math.abs(R.x-M.x)<=g&&Math.abs(R.y-M.y)<=g&&!d[O]){d[O]=!0,I.crossTileID=O;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:s})=>s)}}class Hn{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class pp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const h=Math.round((s-this.lng)/360);if(h!==0)for(const d in this.indexes){const g=this.indexes[d],b={};for(const I in g){const C=g[I];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+h),b[C.tileID.key]=C}this.indexes[d]=b}this.lng=s}addBucket(s,h,d){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let b=0;b<h.symbolInstances.length;b++)h.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const g=this.usedCrossTileIDs[s.overscaledZ];for(const b in this.indexes){const I=this.indexes[b];if(Number(b)>s.overscaledZ)for(const C in I){const M=I[C];M.tileID.isChildOf(s)&&M.findMatches(h.symbolInstances,s,g)}else{const C=I[s.scaledTo(Number(b)).key];C&&C.findMatches(h.symbolInstances,s,g)}}for(let b=0;b<h.symbolInstances.length;b++){const I=h.symbolInstances.get(b);I.crossTileID||(I.crossTileID=d.generate(),g[I.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Ng(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(const d of h.getCrossTileIDsLists())for(const g of d)delete this.usedCrossTileIDs[s][g]}removeStaleBuckets(s){let h=!1;for(const d in this.indexes){const g=this.indexes[d];for(const b in g)s[g[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,g[b]),delete g[b],h=!0)}return h}}class zc{constructor(){this.layerIndexes={},this.crossTileIDs=new Hn,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,d){let g=this.layerIndexes[s.id];g===void 0&&(g=this.layerIndexes[s.id]=new pp);let b=!1;const I={};g.handleWrapJump(d);for(const C of h){const M=C.getBucket(s);M&&s.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(C.tileID,M,this.crossTileIDs)&&(b=!0),I[M.bucketInstanceId]=!0)}return g.removeStaleBuckets(I)&&(b=!0),b}pruneUnusedLayers(s){const h={};s.forEach(d=>{h[d]=!0});for(const d in this.layerIndexes)h[d]||delete this.layerIndexes[d]}}const Yr=(y,s)=>a.x(y,s&&s.filter(h=>h.identifier!=="source.canvas")),zo=a.F(a.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),Dg=a.F(a.ax,["setCenter","setZoom","setBearing","setPitch"]),os=a.aw();class kr extends a.E{constructor(s,h={}){super(),this.map=s,this.dispatcher=new Ze(ii(),this,s._getMapId()),this.imageManager=new dt,this.imageManager.setEventedParent(this),this.glyphManager=new Kt(s._requestManager,h.localIdeographFontFamily),this.lineAtlas=new jn(256,512),this.crossTileSymbolIndex=new zc,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.az());const d=this;this._rtlTextPluginCallback=kr.registerForPluginStateChange(g=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(b,I)=>{if(a.aA(b),I&&I.every(C=>C))for(const C in d.sourceCaches){const M=d.sourceCaches[C].getSource().type;M!=="vector"&&M!=="geojson"||d.sourceCaches[C].reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const b=this.sourceCaches[g.sourceId];if(!b)return;const I=b.getSource();if(I&&I.vectorLayerIds)for(const C in this._layers){const M=this._layers[C];M.source===I.id&&this._validateLayer(M)}})}loadURL(s,h={},d){this.fire(new a.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const g=this.map._requestManager.transformRequest(s,Q.Style);this._request=a.f(g,(b,I)=>{this._request=null,b?this.fire(new a.j(b)):I&&this._load(I,h,d)})}loadJSON(s,h={},d){this.fire(new a.k("dataloading",{dataType:"style"})),this._request=a.h.frame(()=>{this._request=null,h.validate=h.validate!==!1,this._load(s,h,d)})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(os,{validate:!1})}_load(s,h,d){var g;const b=h.transformStyle?h.transformStyle(d,s):s;if(!h.validate||!Yr(this,a.y(b))){this._loaded=!0,this.stylesheet=b;for(const I in b.sources)this.addSource(I,b.sources[I],{validate:!1});b.sprite?this._loadSprite(b.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(b.glyphs),this._createLayers(),this.light=new $e(this.stylesheet.light),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const s=a.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",s),this._order=s.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of s){const d=a.aC(h);d.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=d}}_loadSprite(s,h=!1,d=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(g,b,I,C){const M=ht(g),A=M.length,R=I>1?"@2x":"",O={},j={},nt={};for(const{id:et,url:at}of M){const $=b.transformRequest(b.normalizeSpriteURL(at,R,".json"),Q.SpriteJSON),xt=`${et}_${$.url}`;O[xt]=a.f($,(It,Ft)=>{delete O[xt],j[et]=Ft,rt(C,j,nt,It,A)});const Nt=b.transformRequest(b.normalizeSpriteURL(at,R,".png"),Q.SpriteImage),ut=`${et}_${Nt.url}`;O[ut]=W.getImage(Nt,(It,Ft)=>{delete O[ut],nt[et]=Ft,rt(C,j,nt,It,A)})}return{cancel(){for(const et of Object.values(O))et.cancel()}}}(s,this.map._requestManager,this.map.getPixelRatio(),(g,b)=>{if(this._spriteRequest=null,g)this.fire(new a.j(g));else if(b)for(const I in b){this._spritesImagesIds[I]=[];const C=this._spritesImagesIds[I]?this._spritesImagesIds[I].filter(M=>!(M in b)):[];for(const M of C)this.imageManager.removeImage(M),this._changedImages[M]=!0;for(const M in b[I]){const A=I==="default"?M:`${I}:${M}`;this._spritesImagesIds[I].push(A),A in this.imageManager.images?this.imageManager.updateImage(A,b[I][M],!1):this.imageManager.addImage(A,b[I][M]),h&&(this._changedImages[A]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),d&&d(g)})}_unloadSprite(){for(const s of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(s),this._changedImages[s]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(s){const h=this.sourceCaches[s.source];if(!h)return;const d=s.sourceLayer;if(!d)return;const g=h.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(d)===-1)&&this.fire(new a.j(new Error(`Source layer "${d}" does not exist on source "${g.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(s){const h=this._serializedAllLayers();if(!s||s.length===0)return Object.values(h);const d=[];for(const g of s)h[g]&&d.push(h[g]);return d}_serializedAllLayers(){let s=this._serializedLayers;if(s)return s;s=this._serializedLayers={};const h=Object.keys(this._layers);for(const d of h){const g=this._layers[d];g.type!=="custom"&&(s[d]=g.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const h=this._changed;if(this._changed){const g=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(g.length||b.length)&&this._updateWorkerLayers(g,b);for(const I in this._updatedSources){const C=this._updatedSources[I];if(C==="reload")this._reloadSource(I);else{if(C!=="clear")throw new Error(`Invalid action ${C}`);this._clearSource(I)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(s);this.light.updateTransitions(s),this._resetUpdates()}const d={};for(const g in this.sourceCaches){const b=this.sourceCaches[g];d[g]=b.used,b.used=!1}for(const g of this._order){const b=this._layers[g];b.recalculate(s,this._availableImages),!b.isHidden(s.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const g in d){const b=this.sourceCaches[g];d[g]!==b.used&&b.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(s),this.z=s.zoom,h&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(s,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(s),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(s,h={}){this._checkLoaded();const d=this.serialize();if(s=h.transformStyle?h.transformStyle(d,s):s,Yr(this,a.y(s)))return!1;(s=a.aD(s)).layers=a.aB(s.layers);const g=a.aE(d,s).filter(I=>!(I.command in Dg));if(g.length===0)return!1;const b=g.filter(I=>!(I.command in zo));if(b.length>0)throw new Error(`Unimplemented: ${b.map(I=>I.command).join(", ")}.`);for(const I of g)I.command!=="setTransition"&&this[I.command].apply(this,I.args);return this.stylesheet=s,this._serializedLayers=null,!0}addImage(s,h){if(this.getImage(s))return this.fire(new a.j(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,h),this._afterImageUpdated(s)}updateImage(s,h){this.imageManager.updateImage(s,h)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new a.j(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,h,d={}){if(this._checkLoaded(),this.sourceCaches[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(a.y.source,`sources.${s}`,h,null,d))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const g=this.sourceCaches[s]=new mi(s,h,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:g.loaded(),source:g.serialize(),sourceId:s})),g.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===s)return this.fire(new a.j(new Error(`Source "${s}" cannot be removed while layer "${d}" is using it.`)));const h=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],h.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,h){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error(`There is no source with this ID=${s}`);const d=this.sourceCaches[s].getSource();if(d.type!=="geojson")throw new Error(`geojsonSource.type is ${d.type}, which is !== 'geojson`);d.setData(h),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,h,d={}){this._checkLoaded();const g=s.id;if(this.getLayer(g))return void this.fire(new a.j(new Error(`Layer "${g}" already exists on this map.`)));let b;if(s.type==="custom"){if(Yr(this,a.aF(s)))return;b=a.aC(s)}else{if("source"in s&&typeof s.source=="object"&&(this.addSource(g,s.source),s=a.aD(s),s=a.e(s,{source:g})),this._validate(a.y.layer,`layers.${g}`,s,{arrayIndex:-1},d))return;b=a.aC(s),this._validateLayer(b),b.setEventedParent(this,{layer:{id:g}})}const I=h?this._order.indexOf(h):this._order.length;if(h&&I===-1)this.fire(new a.j(new Error(`Cannot add layer "${g}" before non-existing layer "${h}".`)));else{if(this._order.splice(I,0,g),this._layerOrderChanged=!0,this._layers[g]=b,this._removedLayers[g]&&b.source&&b.type!=="custom"){const C=this._removedLayers[g];delete this._removedLayers[g],C.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(s,h){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new a.j(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===h)return;const d=this._order.indexOf(s);this._order.splice(d,1);const g=h?this._order.indexOf(h):this._order.length;h&&g===-1?this.fire(new a.j(new Error(`Cannot move layer "${s}" before non-existing layer "${h}".`))):(this._order.splice(g,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const h=this._layers[s];if(!h)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${s}".`)));h.setEventedParent(null);const d=this._order.indexOf(s);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=h,delete this._layers[s],this._serializedLayers&&delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],h.onRemove&&h.onRemove(this.map)}getLayer(s){return this._layers[s]}getLayersOrder(){return[...this._order]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,h,d){this._checkLoaded();const g=this.getLayer(s);g?g.minzoom===h&&g.maxzoom===d||(h!=null&&(g.minzoom=h),d!=null&&(g.maxzoom=d),this._updateLayer(g)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,h,d={}){this._checkLoaded();const g=this.getLayer(s);if(g){if(!a.aG(g.filter,h))return h==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(a.y.filter,`layers.${g.id}.filter`,h,null,d)||(g.filter=a.aD(h),this._updateLayer(g)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return a.aD(this.getLayer(s).filter)}setLayoutProperty(s,h,d,g={}){this._checkLoaded();const b=this.getLayer(s);b?a.aG(b.getLayoutProperty(h),d)||(b.setLayoutProperty(h,d,g),this._updateLayer(b)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,h){const d=this.getLayer(s);if(d)return d.getLayoutProperty(h);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,h,d,g={}){this._checkLoaded();const b=this.getLayer(s);b?a.aG(b.getPaintProperty(h),d)||(b.setPaintProperty(h,d,g)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new a.j(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,h){return this.getLayer(s).getPaintProperty(h)}setFeatureState(s,h){this._checkLoaded();const d=s.source,g=s.sourceLayer,b=this.sourceCaches[d];if(b===void 0)return void this.fire(new a.j(new Error(`The source '${d}' does not exist in the map's style.`)));const I=b.getSource().type;I==="geojson"&&g?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):I!=="vector"||g?(s.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),b.setFeatureState(g,s.id,h)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,h){this._checkLoaded();const d=s.source,g=this.sourceCaches[d];if(g===void 0)return void this.fire(new a.j(new Error(`The source '${d}' does not exist in the map's style.`)));const b=g.getSource().type,I=b==="vector"?s.sourceLayer:void 0;b!=="vector"||I?h&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(I,s.id,h):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const h=s.source,d=s.sourceLayer,g=this.sourceCaches[h];if(g!==void 0)return g.getSource().type!=="vector"||d?(s.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),g.getFeatureState(d,s.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const s=a.aH(this.sourceCaches,b=>b.serialize()),h=this._serializeByIds(this._order),d=this.map.getTerrain()||void 0,g=this.stylesheet;return a.aI({version:g.version,name:g.name,metadata:g.metadata,light:g.light,center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,sprite:g.sprite,glyphs:g.glyphs,transition:g.transition,sources:s,layers:h,terrain:d},b=>b!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.sourceCaches[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(s){const h=I=>this._layers[I].type==="fill-extrusion",d={},g=[];for(let I=this._order.length-1;I>=0;I--){const C=this._order[I];if(h(C)){d[C]=I;for(const M of s){const A=M[C];if(A)for(const R of A)g.push(R)}}}g.sort((I,C)=>C.intersectionZ-I.intersectionZ);const b=[];for(let I=this._order.length-1;I>=0;I--){const C=this._order[I];if(h(C))for(let M=g.length-1;M>=0;M--){const A=g[M].feature;if(d[A.layer.id]<I)break;b.push(A),g.pop()}else for(const M of s){const A=M[C];if(A)for(const R of A)b.push(R.feature)}}return b}queryRenderedFeatures(s,h,d){h&&h.filter&&this._validate(a.y.filter,"queryRenderedFeatures.filter",h.filter,null,h);const g={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const C of h.layers){const M=this._layers[C];if(!M)return this.fire(new a.j(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];g[M.source]=!0}}const b=[];h.availableImages=this._availableImages;const I=this._serializedAllLayers();for(const C in this.sourceCaches)h.layers&&!g[C]||b.push(ki(this.sourceCaches[C],this._layers,I,s,h,d));return this.placement&&b.push(function(C,M,A,R,O,j,nt){const et={},at=j.queryRenderedSymbols(R),$=[];for(const xt of Object.keys(at).map(Number))$.push(nt[xt]);$.sort(On);for(const xt of $){const Nt=xt.featureIndex.lookupSymbolFeatures(at[xt.bucketInstanceId],M,xt.bucketIndex,xt.sourceLayerIndex,O.filter,O.layers,O.availableImages,C);for(const ut in Nt){const It=et[ut]=et[ut]||[],Ft=Nt[ut];Ft.sort((Bt,Wt)=>{const ne=xt.featureSortOrder;if(ne){const Yt=ne.indexOf(Bt.featureIndex);return ne.indexOf(Wt.featureIndex)-Yt}return Wt.featureIndex-Bt.featureIndex});for(const Bt of Ft)It.push(Bt)}}for(const xt in et)et[xt].forEach(Nt=>{const ut=Nt.feature,It=A[C[xt].source].getFeatureState(ut.layer["source-layer"],ut.id);ut.source=ut.layer.source,ut.layer["source-layer"]&&(ut.sourceLayer=ut.layer["source-layer"]),ut.state=It});return et}(this._layers,I,this.sourceCaches,s,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(s,h){h&&h.filter&&this._validate(a.y.filter,"querySourceFeatures.filter",h.filter,null,h);const d=this.sourceCaches[s];return d?function(g,b){const I=g.getRenderableIds().map(A=>g.getTileByID(A)),C=[],M={};for(let A=0;A<I.length;A++){const R=I[A],O=R.tileID.canonical.key;M[O]||(M[O]=!0,R.querySourceFeatures(C,b))}return C}(d,h):[]}addSourceType(s,h,d){return De(s)?d(new Error(`A source type called "${s}" already exists.`)):(((g,b)=>{wt[g]=b})(s,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:h.workerSourceURL},d):d(null,null))}getLight(){return this.light.getLight()}setLight(s,h={}){this._checkLoaded();const d=this.light.getLight();let g=!1;for(const I in s)if(!a.aG(s[I],d[I])){g=!0;break}if(!g)return;const b={now:a.h.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,h),this.light.updateTransitions(b)}_validate(s,h,d,g,b={}){return(!b||b.validate!==!1)&&Yr(this,s.call(a.y,a.e({key:h,style:this.serialize(),value:d,styleSpec:a.v},g)))}_remove(s=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const d=this.sourceCaches[h];d.setEventedParent(null),d.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(s)}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const h in this.sourceCaches)this.sourceCaches[h].update(s,this.map.terrain)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,h,d,g,b=!1){let I=!1,C=!1;const M={};for(const A of this._order){const R=this._layers[A];if(R.type!=="symbol")continue;if(!M[R.source]){const j=this.sourceCaches[R.source];M[R.source]=j.getRenderableIds(!0).map(nt=>j.getTileByID(nt)).sort((nt,et)=>et.tileID.overscaledZ-nt.tileID.overscaledZ||(nt.tileID.isLessThan(et.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(R,M[R.source],s.center.lng);I=I||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||d===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.h.now(),s.zoom))&&(this.pauseablePlacement=new ru(s,this.map.terrain,this._order,b,h,d,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.h.now()),C=!0),I&&this.pauseablePlacement.placement.setStale()),C||I)for(const A of this._order){const R=this._layers[A];R.type==="symbol"&&this.placement.updateLayerOpacities(R,M[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.h.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,h,d){this.imageManager.getImages(h.icons,d),this._updateTilesForChangedImages();const g=this.sourceCaches[h.source];g&&g.setDependencies(h.tileID.key,h.type,h.icons)}getGlyphs(s,h,d){this.glyphManager.getGlyphs(h.stacks,d);const g=this.sourceCaches[h.source];g&&g.setDependencies(h.tileID.key,h.type,[""])}getResource(s,h,d){return a.m(h,d)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(s,h={}){this._checkLoaded(),s&&this._validate(a.y.glyphs,"glyphs",s,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=s,this.glyphManager.entries={},this.glyphManager.setURL(s))}addSprite(s,h,d={},g){this._checkLoaded();const b=[{id:s,url:h}],I=[...ht(this.stylesheet.sprite),...b];this._validate(a.y.sprite,"sprite",I,null,d)||(this.stylesheet.sprite=I,this._loadSprite(b,!0,g))}removeSprite(s){this._checkLoaded();const h=ht(this.stylesheet.sprite);if(h.find(d=>d.id===s)){if(this._spritesImagesIds[s])for(const d of this._spritesImagesIds[s])this.imageManager.removeImage(d),this._changedImages[d]=!0;h.splice(h.findIndex(d=>d.id===s),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[s],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${s}" doesn't exists on this map.`)))}getSprite(){return ht(this.stylesheet.sprite)}setSprite(s,h={},d){this._checkLoaded(),s&&this._validate(a.y.sprite,"sprite",s,null,h)||(this.stylesheet.sprite=s,s?this._loadSprite(s,!0,d):(this._unloadSprite(),d&&d(null)))}}kr.registerForPluginStateChange=a.aK;var Fc=a.Q([{name:"a_pos",type:"Int16",components:2}]),su="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const wi={prelude:zn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:zn(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:zn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:zn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:zn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:zn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:zn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:zn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:zn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:zn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:zn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:zn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:zn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:zn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:zn(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:zn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:zn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:zn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:zn(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:zn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:zn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:zn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:zn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:zn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:zn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:zn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:zn("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",su),terrainDepth:zn("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",su),terrainCoords:zn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",su)};function zn(y,s){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=s.match(/attribute ([\w]+) ([\w]+)/g),g=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=b?b.concat(g):g,C={};return{fragmentSource:y=y.replace(h,(M,A,R,O,j)=>(C[j]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${j}
varying ${R} ${O} ${j};
#else
uniform ${R} ${O} u_${j};
#endif
`:`
#ifdef HAS_UNIFORM_u_${j}
    ${R} ${O} ${j} = u_${j};
#endif
`)),vertexSource:s=s.replace(h,(M,A,R,O,j)=>{const nt=O==="float"?"vec2":"vec4",et=j.match(/color/)?"color":nt;return C[j]?A==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${R} ${nt} a_${j};
varying ${R} ${O} ${j};
#else
uniform ${R} ${O} u_${j};
#endif
`:et==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${R} ${O} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${et}(a_${j}, u_${j}_t);
#else
    ${R} ${O} ${j} = u_${j};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${R} ${nt} a_${j};
#else
uniform ${R} ${O} u_${j};
#endif
`:et==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${R} ${O} ${j} = a_${j};
#else
    ${R} ${O} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${R} ${O} ${j} = unpack_mix_${et}(a_${j}, u_${j}_t);
#else
    ${R} ${O} ${j} = u_${j};
#endif
`}),staticAttributes:d,staticUniforms:I}}class wl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,h,d,g,b,I,C,M,A){this.context=s;let R=this.boundPaintVertexBuffers.length!==g.length;for(let O=0;!R&&O<g.length;O++)this.boundPaintVertexBuffers[O]!==g[O]&&(R=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==d||R||this.boundIndexBuffer!==b||this.boundVertexOffset!==I||this.boundDynamicVertexBuffer!==C||this.boundDynamicVertexBuffer2!==M||this.boundDynamicVertexBuffer3!==A?this.freshBind(h,d,g,b,I,C,M,A):(s.bindVertexArray.set(this.vao),C&&C.bind(),b&&b.dynamicDraw&&b.bind(),M&&M.bind(),A&&A.bind())}freshBind(s,h,d,g,b,I,C,M){const A=s.numAttributes,R=this.context,O=R.gl;this.vao&&this.destroy(),this.vao=R.createVertexArray(),R.bindVertexArray.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=g,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=C,this.boundDynamicVertexBuffer3=M,h.enableAttributes(O,s);for(const j of d)j.enableAttributes(O,s);I&&I.enableAttributes(O,s),C&&C.enableAttributes(O,s),M&&M.enableAttributes(O,s),h.bind(),h.setVertexAttribPointers(O,s,b);for(const j of d)j.bind(),j.setVertexAttribPointers(O,s,b);I&&(I.bind(),I.setVertexAttribPointers(O,s,b)),g&&g.bind(),C&&(C.bind(),C.setVertexAttribPointers(O,s,b)),M&&(M.bind(),M.setVertexAttribPointers(O,s,b)),R.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Di(y){const s=[];for(let h=0;h<y.length;h++){if(y[h]===null)continue;const d=y[h].split(" ");s.push(d.pop())}return s}class Bc{constructor(s,h,d,g,b,I){const C=s.gl;this.program=C.createProgram();const M=Di(h.staticAttributes),A=d?d.getBinderAttributes():[],R=M.concat(A),O=wi.prelude.staticUniforms?Di(wi.prelude.staticUniforms):[],j=h.staticUniforms?Di(h.staticUniforms):[],nt=d?d.getBinderUniforms():[],et=O.concat(j).concat(nt),at=[];for(const Bt of et)at.indexOf(Bt)<0&&at.push(Bt);const $=d?d.defines():[];b&&$.push("#define OVERDRAW_INSPECTOR;"),I&&$.push("#define TERRAIN3D;");const xt=$.concat(wi.prelude.fragmentSource,h.fragmentSource).join(`
`),Nt=$.concat(wi.prelude.vertexSource,h.vertexSource).join(`
`),ut=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(ut,xt),C.compileShader(ut),!C.getShaderParameter(ut,C.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${C.getShaderInfoLog(ut)}`);C.attachShader(this.program,ut);const It=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(It,Nt),C.compileShader(It),!C.getShaderParameter(It,C.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${C.getShaderInfoLog(It)}`);C.attachShader(this.program,It),this.attributes={};const Ft={};this.numAttributes=R.length;for(let Bt=0;Bt<this.numAttributes;Bt++)R[Bt]&&(C.bindAttribLocation(this.program,Bt,R[Bt]),this.attributes[R[Bt]]=Bt);if(C.linkProgram(this.program),!C.getProgramParameter(this.program,C.LINK_STATUS))throw new Error(`Program failed to link: ${C.getProgramInfoLog(this.program)}`);C.deleteShader(It),C.deleteShader(ut);for(let Bt=0;Bt<at.length;Bt++){const Wt=at[Bt];if(Wt&&!Ft[Wt]){const ne=C.getUniformLocation(this.program,Wt);ne&&(Ft[Wt]=ne)}}this.fixedUniforms=g(s,Ft),this.terrainUniforms=((Bt,Wt)=>({u_depth:new a.aL(Bt,Wt.u_depth),u_terrain:new a.aL(Bt,Wt.u_terrain),u_terrain_dim:new a.aM(Bt,Wt.u_terrain_dim),u_terrain_matrix:new a.aN(Bt,Wt.u_terrain_matrix),u_terrain_unpack:new a.aO(Bt,Wt.u_terrain_unpack),u_terrain_exaggeration:new a.aM(Bt,Wt.u_terrain_exaggeration)}))(s,Ft),this.binderUniforms=d?d.getUniforms(s,Ft):[]}draw(s,h,d,g,b,I,C,M,A,R,O,j,nt,et,at,$,xt,Nt){const ut=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(d),s.setStencilMode(g),s.setColorMode(b),s.setCullFace(I),M){s.activeTexture.set(ut.TEXTURE2),ut.bindTexture(ut.TEXTURE_2D,M.depthTexture),s.activeTexture.set(ut.TEXTURE3),ut.bindTexture(ut.TEXTURE_2D,M.texture);for(const Ft in this.terrainUniforms)this.terrainUniforms[Ft].set(M[Ft])}for(const Ft in this.fixedUniforms)this.fixedUniforms[Ft].set(C[Ft]);at&&at.setUniforms(s,this.binderUniforms,nt,{zoom:et});let It=0;switch(h){case ut.LINES:It=2;break;case ut.TRIANGLES:It=3;break;case ut.LINE_STRIP:It=1}for(const Ft of j.get()){const Bt=Ft.vaos||(Ft.vaos={});(Bt[A]||(Bt[A]=new wl)).bind(s,this,R,at?at.getPaintVertexBuffers():[],O,Ft.vertexOffset,$,xt,Nt),ut.drawElements(h,Ft.primitiveLength*It,ut.UNSIGNED_SHORT,Ft.primitiveOffset*It*2)}}}function ss(y,s,h){const d=1/_t(h,1,s.transform.tileZoom),g=Math.pow(2,h.tileID.overscaledZ),b=h.tileSize*Math.pow(2,s.transform.tileZoom)/g,I=b*(h.tileID.canonical.x+h.tileID.wrap*g),C=b*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[d,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[I>>16,C>>16],u_pixel_coord_lower:[65535&I,65535&C]}}const fp=(y,s,h,d)=>{const g=s.style.light,b=g.properties.get("position"),I=[b.x,b.y,b.z],C=function(){var A=new a.A(9);return a.A!=Float32Array&&(A[1]=0,A[2]=0,A[3]=0,A[5]=0,A[6]=0,A[7]=0),A[0]=1,A[4]=1,A[8]=1,A}();g.properties.get("anchor")==="viewport"&&function(A,R){var O=Math.sin(R),j=Math.cos(R);A[0]=j,A[1]=O,A[2]=0,A[3]=-O,A[4]=j,A[5]=0,A[6]=0,A[7]=0,A[8]=1}(C,-s.transform.angle),function(A,R,O){var j=R[0],nt=R[1],et=R[2];A[0]=j*O[0]+nt*O[3]+et*O[6],A[1]=j*O[1]+nt*O[4]+et*O[7],A[2]=j*O[2]+nt*O[5]+et*O[8]}(I,I,C);const M=g.properties.get("color");return{u_matrix:y,u_lightpos:I,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+h,u_opacity:d}},Ha=(y,s,h,d,g,b,I)=>a.e(fp(y,s,h,d),ss(b,s,I),{u_height_factor:-Math.pow(2,g.overscaledZ)/I.tileSize/8}),xd=y=>({u_matrix:y}),dp=(y,s,h,d)=>a.e(xd(y),ss(h,s,d)),Vc=(y,s)=>({u_matrix:y,u_world:s}),Uc=(y,s,h,d,g)=>a.e(dp(y,s,h,d),{u_world:g}),Ya=(y,s,h,d)=>{const g=y.transform;let b,I;if(d.paint.get("circle-pitch-alignment")==="map"){const C=_t(h,1,g.zoom);b=!0,I=[C,C]}else b=!1,I=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(s.posMatrix,h,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:I}},mp=(y,s,h)=>{const d=_t(h,1,s.zoom),g=Math.pow(2,s.zoom-h.tileID.overscaledZ),b=h.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:s.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[s.pixelsToGLUnits[0]/(d*g),s.pixelsToGLUnits[1]/(d*g)],u_overscale_factor:b}},Hu=(y,s,h=1)=>({u_matrix:y,u_color:s,u_overlay:0,u_overlay_scale:h}),wd=y=>({u_matrix:y}),Rg=(y,s,h,d)=>({u_matrix:y,u_extrude_scale:_t(s,1,h),u_intensity:d});function gp(y,s){const h=Math.pow(2,s.canonical.z),d=s.canonical.y;return[new a.U(0,d/h).toLngLat().lat,new a.U(0,(d+1)/h).toLngLat().lat]}const _p=(y,s,h,d)=>{const g=y.transform;return{u_matrix:Gc(y,s,h,d),u_ratio:1/_t(s,1,g.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Sd=(y,s,h,d,g)=>a.e(_p(y,s,h,g),{u_image:0,u_image_height:d}),Og=(y,s,h,d,g)=>{const b=y.transform,I=Id(s,b);return{u_matrix:Gc(y,s,h,g),u_texsize:s.imageAtlasTexture.size,u_ratio:1/_t(s,1,b.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[I,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Ed=(y,s,h,d,g,b)=>{const I=y.lineAtlas,C=Id(s,y.transform),M=h.layout.get("line-cap")==="round",A=I.getDash(d.from,M),R=I.getDash(d.to,M),O=A.width*g.fromScale,j=R.width*g.toScale;return a.e(_p(y,s,h,b),{u_patternscale_a:[C/O,-A.height/2],u_patternscale_b:[C/j,-R.height/2],u_sdfgamma:I.width/(256*Math.min(O,j)*y.pixelRatio)/2,u_image:0,u_tex_y_a:A.y,u_tex_y_b:R.y,u_mix:g.t})};function Id(y,s){return 1/_t(y,1,s.tileZoom)}function Gc(y,s,h,d){return y.translatePosMatrix(d?d.posMatrix:s.tileID.posMatrix,s,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Cd=(y,s,h,d,g)=>{return{u_matrix:y,u_tl_parent:s,u_scale_parent:h,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(I=g.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(b=g.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:Td(g.paint.get("raster-hue-rotate"))};var b,I};function Td(y){y*=Math.PI/180;const s=Math.sin(y),h=Math.cos(y);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}const yp=(y,s,h,d,g,b,I,C,M,A)=>{const R=g.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:R.cameraToCenterDistance,u_pitch:R.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:R.width/R.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:I,u_coord_matrix:C,u_is_text:+M,u_pitch_with_map:+d,u_texsize:A,u_texture:0}},vp=(y,s,h,d,g,b,I,C,M,A,R)=>{const O=g.transform;return a.e(yp(y,s,h,d,g,b,I,C,M,A),{u_gamma_scale:d?Math.cos(O._pitch)*O.cameraToCenterDistance:1,u_device_pixel_ratio:g.pixelRatio,u_is_halo:+R})},Sl=(y,s,h,d,g,b,I,C,M,A)=>a.e(vp(y,s,h,d,g,b,I,C,!0,M,!0),{u_texsize_icon:A,u_texture_icon:1}),qc=(y,s,h)=>({u_matrix:y,u_opacity:s,u_color:h}),as=(y,s,h,d,g,b)=>a.e(function(I,C,M,A){const R=M.imageManager.getPattern(I.from.toString()),O=M.imageManager.getPattern(I.to.toString()),{width:j,height:nt}=M.imageManager.getPixelSize(),et=Math.pow(2,A.tileID.overscaledZ),at=A.tileSize*Math.pow(2,M.transform.tileZoom)/et,$=at*(A.tileID.canonical.x+A.tileID.wrap*et),xt=at*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:O.tl,u_pattern_br_b:O.br,u_texsize:[j,nt],u_mix:C.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:O.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/_t(A,1,M.transform.tileZoom),u_pixel_coord_upper:[$>>16,xt>>16],u_pixel_coord_lower:[65535&$,65535&xt]}}(d,b,h,g),{u_matrix:y,u_opacity:s}),jc={fillExtrusion:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_lightpos:new a.aP(y,s.u_lightpos),u_lightintensity:new a.aM(y,s.u_lightintensity),u_lightcolor:new a.aP(y,s.u_lightcolor),u_vertical_gradient:new a.aM(y,s.u_vertical_gradient),u_opacity:new a.aM(y,s.u_opacity)}),fillExtrusionPattern:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_lightpos:new a.aP(y,s.u_lightpos),u_lightintensity:new a.aM(y,s.u_lightintensity),u_lightcolor:new a.aP(y,s.u_lightcolor),u_vertical_gradient:new a.aM(y,s.u_vertical_gradient),u_height_factor:new a.aM(y,s.u_height_factor),u_image:new a.aL(y,s.u_image),u_texsize:new a.aQ(y,s.u_texsize),u_pixel_coord_upper:new a.aQ(y,s.u_pixel_coord_upper),u_pixel_coord_lower:new a.aQ(y,s.u_pixel_coord_lower),u_scale:new a.aP(y,s.u_scale),u_fade:new a.aM(y,s.u_fade),u_opacity:new a.aM(y,s.u_opacity)}),fill:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix)}),fillPattern:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_image:new a.aL(y,s.u_image),u_texsize:new a.aQ(y,s.u_texsize),u_pixel_coord_upper:new a.aQ(y,s.u_pixel_coord_upper),u_pixel_coord_lower:new a.aQ(y,s.u_pixel_coord_lower),u_scale:new a.aP(y,s.u_scale),u_fade:new a.aM(y,s.u_fade)}),fillOutline:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_world:new a.aQ(y,s.u_world)}),fillOutlinePattern:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_world:new a.aQ(y,s.u_world),u_image:new a.aL(y,s.u_image),u_texsize:new a.aQ(y,s.u_texsize),u_pixel_coord_upper:new a.aQ(y,s.u_pixel_coord_upper),u_pixel_coord_lower:new a.aQ(y,s.u_pixel_coord_lower),u_scale:new a.aP(y,s.u_scale),u_fade:new a.aM(y,s.u_fade)}),circle:(y,s)=>({u_camera_to_center_distance:new a.aM(y,s.u_camera_to_center_distance),u_scale_with_map:new a.aL(y,s.u_scale_with_map),u_pitch_with_map:new a.aL(y,s.u_pitch_with_map),u_extrude_scale:new a.aQ(y,s.u_extrude_scale),u_device_pixel_ratio:new a.aM(y,s.u_device_pixel_ratio),u_matrix:new a.aN(y,s.u_matrix)}),collisionBox:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_camera_to_center_distance:new a.aM(y,s.u_camera_to_center_distance),u_pixels_to_tile_units:new a.aM(y,s.u_pixels_to_tile_units),u_extrude_scale:new a.aQ(y,s.u_extrude_scale),u_overscale_factor:new a.aM(y,s.u_overscale_factor)}),collisionCircle:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_inv_matrix:new a.aN(y,s.u_inv_matrix),u_camera_to_center_distance:new a.aM(y,s.u_camera_to_center_distance),u_viewport_size:new a.aQ(y,s.u_viewport_size)}),debug:(y,s)=>({u_color:new a.aR(y,s.u_color),u_matrix:new a.aN(y,s.u_matrix),u_overlay:new a.aL(y,s.u_overlay),u_overlay_scale:new a.aM(y,s.u_overlay_scale)}),clippingMask:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix)}),heatmap:(y,s)=>({u_extrude_scale:new a.aM(y,s.u_extrude_scale),u_intensity:new a.aM(y,s.u_intensity),u_matrix:new a.aN(y,s.u_matrix)}),heatmapTexture:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_world:new a.aQ(y,s.u_world),u_image:new a.aL(y,s.u_image),u_color_ramp:new a.aL(y,s.u_color_ramp),u_opacity:new a.aM(y,s.u_opacity)}),hillshade:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_image:new a.aL(y,s.u_image),u_latrange:new a.aQ(y,s.u_latrange),u_light:new a.aQ(y,s.u_light),u_shadow:new a.aR(y,s.u_shadow),u_highlight:new a.aR(y,s.u_highlight),u_accent:new a.aR(y,s.u_accent)}),hillshadePrepare:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_image:new a.aL(y,s.u_image),u_dimension:new a.aQ(y,s.u_dimension),u_zoom:new a.aM(y,s.u_zoom),u_unpack:new a.aO(y,s.u_unpack)}),line:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_ratio:new a.aM(y,s.u_ratio),u_device_pixel_ratio:new a.aM(y,s.u_device_pixel_ratio),u_units_to_pixels:new a.aQ(y,s.u_units_to_pixels)}),lineGradient:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_ratio:new a.aM(y,s.u_ratio),u_device_pixel_ratio:new a.aM(y,s.u_device_pixel_ratio),u_units_to_pixels:new a.aQ(y,s.u_units_to_pixels),u_image:new a.aL(y,s.u_image),u_image_height:new a.aM(y,s.u_image_height)}),linePattern:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_texsize:new a.aQ(y,s.u_texsize),u_ratio:new a.aM(y,s.u_ratio),u_device_pixel_ratio:new a.aM(y,s.u_device_pixel_ratio),u_image:new a.aL(y,s.u_image),u_units_to_pixels:new a.aQ(y,s.u_units_to_pixels),u_scale:new a.aP(y,s.u_scale),u_fade:new a.aM(y,s.u_fade)}),lineSDF:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_ratio:new a.aM(y,s.u_ratio),u_device_pixel_ratio:new a.aM(y,s.u_device_pixel_ratio),u_units_to_pixels:new a.aQ(y,s.u_units_to_pixels),u_patternscale_a:new a.aQ(y,s.u_patternscale_a),u_patternscale_b:new a.aQ(y,s.u_patternscale_b),u_sdfgamma:new a.aM(y,s.u_sdfgamma),u_image:new a.aL(y,s.u_image),u_tex_y_a:new a.aM(y,s.u_tex_y_a),u_tex_y_b:new a.aM(y,s.u_tex_y_b),u_mix:new a.aM(y,s.u_mix)}),raster:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_tl_parent:new a.aQ(y,s.u_tl_parent),u_scale_parent:new a.aM(y,s.u_scale_parent),u_buffer_scale:new a.aM(y,s.u_buffer_scale),u_fade_t:new a.aM(y,s.u_fade_t),u_opacity:new a.aM(y,s.u_opacity),u_image0:new a.aL(y,s.u_image0),u_image1:new a.aL(y,s.u_image1),u_brightness_low:new a.aM(y,s.u_brightness_low),u_brightness_high:new a.aM(y,s.u_brightness_high),u_saturation_factor:new a.aM(y,s.u_saturation_factor),u_contrast_factor:new a.aM(y,s.u_contrast_factor),u_spin_weights:new a.aP(y,s.u_spin_weights)}),symbolIcon:(y,s)=>({u_is_size_zoom_constant:new a.aL(y,s.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aL(y,s.u_is_size_feature_constant),u_size_t:new a.aM(y,s.u_size_t),u_size:new a.aM(y,s.u_size),u_camera_to_center_distance:new a.aM(y,s.u_camera_to_center_distance),u_pitch:new a.aM(y,s.u_pitch),u_rotate_symbol:new a.aL(y,s.u_rotate_symbol),u_aspect_ratio:new a.aM(y,s.u_aspect_ratio),u_fade_change:new a.aM(y,s.u_fade_change),u_matrix:new a.aN(y,s.u_matrix),u_label_plane_matrix:new a.aN(y,s.u_label_plane_matrix),u_coord_matrix:new a.aN(y,s.u_coord_matrix),u_is_text:new a.aL(y,s.u_is_text),u_pitch_with_map:new a.aL(y,s.u_pitch_with_map),u_texsize:new a.aQ(y,s.u_texsize),u_texture:new a.aL(y,s.u_texture)}),symbolSDF:(y,s)=>({u_is_size_zoom_constant:new a.aL(y,s.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aL(y,s.u_is_size_feature_constant),u_size_t:new a.aM(y,s.u_size_t),u_size:new a.aM(y,s.u_size),u_camera_to_center_distance:new a.aM(y,s.u_camera_to_center_distance),u_pitch:new a.aM(y,s.u_pitch),u_rotate_symbol:new a.aL(y,s.u_rotate_symbol),u_aspect_ratio:new a.aM(y,s.u_aspect_ratio),u_fade_change:new a.aM(y,s.u_fade_change),u_matrix:new a.aN(y,s.u_matrix),u_label_plane_matrix:new a.aN(y,s.u_label_plane_matrix),u_coord_matrix:new a.aN(y,s.u_coord_matrix),u_is_text:new a.aL(y,s.u_is_text),u_pitch_with_map:new a.aL(y,s.u_pitch_with_map),u_texsize:new a.aQ(y,s.u_texsize),u_texture:new a.aL(y,s.u_texture),u_gamma_scale:new a.aM(y,s.u_gamma_scale),u_device_pixel_ratio:new a.aM(y,s.u_device_pixel_ratio),u_is_halo:new a.aL(y,s.u_is_halo)}),symbolTextAndIcon:(y,s)=>({u_is_size_zoom_constant:new a.aL(y,s.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aL(y,s.u_is_size_feature_constant),u_size_t:new a.aM(y,s.u_size_t),u_size:new a.aM(y,s.u_size),u_camera_to_center_distance:new a.aM(y,s.u_camera_to_center_distance),u_pitch:new a.aM(y,s.u_pitch),u_rotate_symbol:new a.aL(y,s.u_rotate_symbol),u_aspect_ratio:new a.aM(y,s.u_aspect_ratio),u_fade_change:new a.aM(y,s.u_fade_change),u_matrix:new a.aN(y,s.u_matrix),u_label_plane_matrix:new a.aN(y,s.u_label_plane_matrix),u_coord_matrix:new a.aN(y,s.u_coord_matrix),u_is_text:new a.aL(y,s.u_is_text),u_pitch_with_map:new a.aL(y,s.u_pitch_with_map),u_texsize:new a.aQ(y,s.u_texsize),u_texsize_icon:new a.aQ(y,s.u_texsize_icon),u_texture:new a.aL(y,s.u_texture),u_texture_icon:new a.aL(y,s.u_texture_icon),u_gamma_scale:new a.aM(y,s.u_gamma_scale),u_device_pixel_ratio:new a.aM(y,s.u_device_pixel_ratio),u_is_halo:new a.aL(y,s.u_is_halo)}),background:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_opacity:new a.aM(y,s.u_opacity),u_color:new a.aR(y,s.u_color)}),backgroundPattern:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_opacity:new a.aM(y,s.u_opacity),u_image:new a.aL(y,s.u_image),u_pattern_tl_a:new a.aQ(y,s.u_pattern_tl_a),u_pattern_br_a:new a.aQ(y,s.u_pattern_br_a),u_pattern_tl_b:new a.aQ(y,s.u_pattern_tl_b),u_pattern_br_b:new a.aQ(y,s.u_pattern_br_b),u_texsize:new a.aQ(y,s.u_texsize),u_mix:new a.aM(y,s.u_mix),u_pattern_size_a:new a.aQ(y,s.u_pattern_size_a),u_pattern_size_b:new a.aQ(y,s.u_pattern_size_b),u_scale_a:new a.aM(y,s.u_scale_a),u_scale_b:new a.aM(y,s.u_scale_b),u_pixel_coord_upper:new a.aQ(y,s.u_pixel_coord_upper),u_pixel_coord_lower:new a.aQ(y,s.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aM(y,s.u_tile_units_to_pixels)}),terrain:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_texture:new a.aL(y,s.u_texture),u_ele_delta:new a.aM(y,s.u_ele_delta)}),terrainDepth:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_ele_delta:new a.aM(y,s.u_ele_delta)}),terrainCoords:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_texture:new a.aL(y,s.u_texture),u_terrain_coords_id:new a.aM(y,s.u_terrain_coords_id),u_ele_delta:new a.aM(y,s.u_ele_delta)})};class Zc{constructor(s,h,d){this.context=s;const g=s.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Yu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Wc{constructor(s,h,d,g){this.length=h.length,this.attributes=d,this.itemSize=h.bytesPerElement,this.dynamicDraw=g,this.context=s;const b=s.gl;this.buffer=b.createBuffer(),s.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let d=0;d<this.attributes.length;d++){const g=h.attributes[this.attributes[d].name];g!==void 0&&s.enableVertexAttribArray(g)}}setVertexAttribPointers(s,h,d){for(let g=0;g<this.attributes.length;g++){const b=this.attributes[g],I=h.attributes[b.name];I!==void 0&&s.vertexAttribPointer(I,b.components,s[Yu[b.type]],!1,this.itemSize,b.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const au=new WeakMap;function Ka(y){var s;if(au.has(y))return au.get(y);{const h=(s=y.getParameter(y.VERSION))===null||s===void 0?void 0:s.startsWith("WebGL 2.0");return au.set(y,h),h}}class Cn{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Xc extends Cn{getDefault(){return a.aT.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Fo extends Cn{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Bo extends Cn{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class bp extends Cn{getDefault(){return[!0,!0,!0,!0]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Hc extends Cn{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class Yc extends Cn{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class xp extends Cn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class wp extends Cn{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Kc extends Cn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class Sp extends Cn{getDefault(){return[0,1]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class Ep extends Cn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class Jc extends Cn{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Ld extends Cn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class Md extends Cn{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class lu extends Cn{getDefault(){return a.aT.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class zg extends Cn{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class Fg extends Cn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class Bg extends Cn{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Vg extends Cn{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class Ug extends Cn{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class Gg extends Cn{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class Ip extends Cn{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Qc extends Cn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Cp extends Cn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Tp extends Cn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class uu extends Cn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Pd extends Cn{getDefault(){return null}set(s){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Ad extends Cn{getDefault(){return null}set(s){var h;if(s===this.current&&!this.dirty)return;const d=this.gl;Ka(d)?d.bindVertexArray(s):(h=d.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(s),this.current=s,this.dirty=!1}}class Lp extends Cn{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class El extends Cn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class kd extends Cn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Ja extends Cn{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class cu extends Ja{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Nd extends Ja{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Mp extends Ja{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Fn{constructor(s,h,d,g,b){this.context=s,this.width=h,this.height=d;const I=s.gl,C=this.framebuffer=I.createFramebuffer();if(this.colorAttachment=new cu(s,C),g)this.depthAttachment=b?new Mp(s,C):new Nd(s,C);else if(b)throw new Error("Stencil cannot be setted without depth");if(I.checkFramebufferStatus(I.FRAMEBUFFER)!==I.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const s=this.context.gl,h=this.colorAttachment.get();if(h&&s.deleteTexture(h),this.depthAttachment){const d=this.depthAttachment.get();d&&s.deleteRenderbuffer(d)}s.deleteFramebuffer(this.framebuffer)}}class Si{constructor(s,h,d){this.blendFunction=s,this.blendColor=h,this.mask=d}}Si.Replace=[1,0],Si.disabled=new Si(Si.Replace,a.aT.transparent,[!1,!1,!1,!1]),Si.unblended=new Si(Si.Replace,a.aT.transparent,[!0,!0,!0,!0]),Si.alphaBlended=new Si([1,771],a.aT.transparent,[!0,!0,!0,!0]);class qg{constructor(s){var h,d;if(this.gl=s,this.clearColor=new Xc(this),this.clearDepth=new Fo(this),this.clearStencil=new Bo(this),this.colorMask=new bp(this),this.depthMask=new Hc(this),this.stencilMask=new Yc(this),this.stencilFunc=new xp(this),this.stencilOp=new wp(this),this.stencilTest=new Kc(this),this.depthRange=new Sp(this),this.depthTest=new Ep(this),this.depthFunc=new Jc(this),this.blend=new Ld(this),this.blendFunc=new Md(this),this.blendColor=new lu(this),this.blendEquation=new zg(this),this.cullFace=new Fg(this),this.cullFaceSide=new Bg(this),this.frontFace=new Vg(this),this.program=new Ug(this),this.activeTexture=new Gg(this),this.viewport=new Ip(this),this.bindFramebuffer=new Qc(this),this.bindRenderbuffer=new Cp(this),this.bindTexture=new Tp(this),this.bindVertexBuffer=new uu(this),this.bindElementBuffer=new Pd(this),this.bindVertexArray=new Ad(this),this.pixelStoreUnpack=new Lp(this),this.pixelStoreUnpackPremultiplyAlpha=new El(this),this.pixelStoreUnpackFlipY=new kd(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),Ka(s)){this.HALF_FLOAT=s.HALF_FLOAT;const g=s.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=s.RGBA16F)!==null&&h!==void 0?h:g==null?void 0:g.RGBA16F_EXT,this.RGB16F=(d=s.RGB16F)!==null&&d!==void 0?d:g==null?void 0:g.RGB16F_EXT,s.getExtension("EXT_color_buffer_float")}else{s.getExtension("EXT_color_buffer_half_float"),s.getExtension("OES_texture_half_float_linear");const g=s.getExtension("OES_texture_half_float");this.HALF_FLOAT=g==null?void 0:g.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h){return new Zc(this,s,h)}createVertexBuffer(s,h,d){return new Wc(this,s,h,d)}createRenderbuffer(s,h,d){const g=this.gl,b=g.createRenderbuffer();return this.bindRenderbuffer.set(b),g.renderbufferStorage(g.RENDERBUFFER,s,h,d),this.bindRenderbuffer.set(null),b}createFramebuffer(s,h,d,g){return new Fn(this,s,h,d,g)}clear({color:s,depth:h,stencil:d}){const g=this.gl;let b=0;s&&(b|=g.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(b|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),d!==void 0&&(b|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),g.clear(b)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){a.aG(s.blendFunction,Si.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}createVertexArray(){var s;return Ka(this.gl)?this.gl.createVertexArray():(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.createVertexArrayOES()}deleteVertexArray(s){var h;return Ka(this.gl)?this.gl.deleteVertexArray(s):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(s)}unbindVAO(){this.bindVertexArray.set(null)}}class Tn{constructor(s,h,d){this.func=s,this.mask=h,this.range=d}}Tn.ReadOnly=!1,Tn.ReadWrite=!0,Tn.disabled=new Tn(519,Tn.ReadOnly,[0,1]);const Il=7680;class Ei{constructor(s,h,d,g,b,I){this.test=s,this.ref=h,this.mask=d,this.fail=g,this.depthFail=b,this.pass=I}}Ei.disabled=new Ei({func:519,mask:0},0,0,Il,Il,Il);class _i{constructor(s,h,d){this.enable=s,this.mode=h,this.frontFace=d}}let Ku;function Dd(y,s,h,d,g,b,I){const C=y.context,M=C.gl,A=y.useProgram("collisionBox"),R=[];let O=0,j=0;for(let ut=0;ut<d.length;ut++){const It=d[ut],Ft=s.getTile(It),Bt=Ft.getBucket(h);if(!Bt)continue;let Wt=It.posMatrix;g[0]===0&&g[1]===0||(Wt=y.translatePosMatrix(It.posMatrix,Ft,g,b));const ne=I?Bt.textCollisionBox:Bt.iconCollisionBox,Yt=Bt.collisionCircleArray;if(Yt.length>0){const se=a.Z(),Ce=Wt;a.aU(se,Bt.placementInvProjMatrix,y.transform.glCoordMatrix),a.aU(se,se,Bt.placementViewportMatrix),R.push({circleArray:Yt,circleOffset:j,transform:Ce,invTransform:se,coord:It}),O+=Yt.length/4,j=O}ne&&A.draw(C,M.LINES,Tn.disabled,Ei.disabled,y.colorModeForRenderPass(),_i.disabled,mp(Wt,y.transform,Ft),y.style.map.terrain&&y.style.map.terrain.getTerrainData(It),h.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,null,y.transform.zoom,null,null,ne.collisionVertexBuffer)}if(!I||!R.length)return;const nt=y.useProgram("collisionCircle"),et=new a.aV;et.resize(4*O),et._trim();let at=0;for(const ut of R)for(let It=0;It<ut.circleArray.length/4;It++){const Ft=4*It,Bt=ut.circleArray[Ft+0],Wt=ut.circleArray[Ft+1],ne=ut.circleArray[Ft+2],Yt=ut.circleArray[Ft+3];et.emplace(at++,Bt,Wt,ne,Yt,0),et.emplace(at++,Bt,Wt,ne,Yt,1),et.emplace(at++,Bt,Wt,ne,Yt,2),et.emplace(at++,Bt,Wt,ne,Yt,3)}(!Ku||Ku.length<2*O)&&(Ku=function(ut){const It=2*ut,Ft=new a.aX;Ft.resize(It),Ft._trim();for(let Bt=0;Bt<It;Bt++){const Wt=6*Bt;Ft.uint16[Wt+0]=4*Bt+0,Ft.uint16[Wt+1]=4*Bt+1,Ft.uint16[Wt+2]=4*Bt+2,Ft.uint16[Wt+3]=4*Bt+2,Ft.uint16[Wt+4]=4*Bt+3,Ft.uint16[Wt+5]=4*Bt+0}return Ft}(O));const $=C.createIndexBuffer(Ku,!0),xt=C.createVertexBuffer(et,a.aW.members,!0);for(const ut of R){const It={u_matrix:ut.transform,u_inv_matrix:ut.invTransform,u_camera_to_center_distance:(Nt=y.transform).cameraToCenterDistance,u_viewport_size:[Nt.width,Nt.height]};nt.draw(C,M.TRIANGLES,Tn.disabled,Ei.disabled,y.colorModeForRenderPass(),_i.disabled,It,y.style.map.terrain&&y.style.map.terrain.getTerrainData(ut.coord),h.id,xt,$,a.S.simpleSegment(0,2*ut.circleOffset,ut.circleArray.length,ut.circleArray.length/2),null,y.transform.zoom,null,null,null)}var Nt;xt.destroy(),$.destroy()}_i.disabled=new _i(!1,1029,2305),_i.backCCW=new _i(!0,1029,2305);const Pp=a.ao(new Float32Array(16));function $c(y,s,h,d,g,b){const{horizontalAlign:I,verticalAlign:C}=a.au(y);return new a.P((-(I-.5)*s/g+d[0])*b,(-(C-.5)*h/g+d[1])*b)}function th(y,s,h,d,g,b,I,C,M,A,R){const O=y.text.placedSymbolArray,j=y.text.dynamicLayoutVertexArray,nt=y.icon.dynamicLayoutVertexArray,et={};j.clear();for(let at=0;at<O.length;at++){const $=O.get(at),xt=$.hidden||!$.crossTileID||y.allowVerticalPlacement&&!$.placedOrientation?null:d[$.crossTileID];if(xt){const Nt=new a.P($.anchorX,$.anchorY),ut=ri(Nt,h?I:b,R),It=Sa(g.cameraToCenterDistance,ut.signedDistanceFromCamera);let Ft=a.aj(y.textSizeData,M,$)*It/a.ap;h&&(Ft*=y.tilePixelRatio/C);const{width:Bt,height:Wt,anchor:ne,textOffset:Yt,textBoxScale:se}=xt,Ce=$c(ne,Bt,Wt,Yt,se,Ft),xn=h?ri(Nt.add(Ce),b,R).point:ut.point.add(s?Ce.rotate(-g.angle):Ce),fe=y.allowVerticalPlacement&&$.placedOrientation===a.ai.vertical?Math.PI/2:0;for(let qe=0;qe<$.numGlyphs;qe++)a.ak(j,xn,fe);A&&$.associatedIconIndex>=0&&(et[$.associatedIconIndex]={shiftedAnchor:xn,angle:fe})}else J($.numGlyphs,j)}if(A){nt.clear();const at=y.icon.placedSymbolArray;for(let $=0;$<at.length;$++){const xt=at.get($);if(xt.hidden)J(xt.numGlyphs,nt);else{const Nt=et[$];if(Nt)for(let ut=0;ut<xt.numGlyphs;ut++)a.ak(nt,Nt.shiftedAnchor,Nt.angle);else J(xt.numGlyphs,nt)}}y.icon.dynamicLayoutVertexBuffer.updateData(nt)}y.text.dynamicLayoutVertexBuffer.updateData(j)}function Ap(y,s,h){return h.iconsInText&&s?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function eh(y,s,h,d,g,b,I,C,M,A,R,O){const j=y.context,nt=j.gl,et=y.transform,at=C==="map",$=M==="map",xt=C!=="viewport"&&h.layout.get("symbol-placement")!=="point",Nt=at&&!$&&!xt,ut=!h.layout.get("symbol-sort-key").isConstant();let It=!1;const Ft=y.depthModeForSublayer(0,Tn.ReadOnly),Bt=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Wt=[];for(const ne of d){const Yt=s.getTile(ne),se=Yt.getBucket(h);if(!se)continue;const Ce=g?se.text:se.icon;if(!Ce||!Ce.segments.get().length||!Ce.hasVisibleVertices)continue;const xn=Ce.programConfigurations.get(h.id),fe=g||se.sdfIcons,qe=g?se.textSizeData:se.iconSizeData,Le=$||et.pitch!==0,Yn=y.useProgram(Ap(fe,g,se),xn),bn=a.ah(qe,et.zoom),hn=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ne);let wn,ji,si,Nr,cr=[0,0],Qi=null;if(g)ji=Yt.glyphAtlasTexture,si=nt.LINEAR,wn=Yt.glyphAtlasTexture.size,se.iconsInText&&(cr=Yt.imageAtlasTexture.size,Qi=Yt.imageAtlasTexture,Nr=Le||y.options.rotating||y.options.zooming||qe.kind==="composite"||qe.kind==="camera"?nt.LINEAR:nt.NEAREST);else{const Zi=h.layout.get("icon-size").constantOr(0)!==1||se.iconsNeedLinear;ji=Yt.imageAtlasTexture,si=fe||y.options.rotating||y.options.zooming||Zi||Le?nt.LINEAR:nt.NEAREST,wn=Yt.imageAtlasTexture.size}const Go=_t(Yt,1,y.transform.zoom),pi=ae(ne.posMatrix,$,at,y.transform,Go),Zs=wo(ne.posMatrix,$,at,y.transform,Go),Ws=Bt&&se.hasTextData(),tl=h.layout.get("icon-text-fit")!=="none"&&Ws&&se.hasIconData();if(xt){const Zi=y.style.map.terrain?(Io,Wi)=>y.style.map.terrain.getElevation(ne,Io,Wi):null,hr=h.layout.get("text-rotation-alignment")==="map";ue(se,ne.posMatrix,y,g,pi,Zs,$,A,hr,Zi)}const Pl=y.translatePosMatrix(ne.posMatrix,Yt,b,I),_u=xt||g&&Bt||tl?Pp:pi,Kr=y.translatePosMatrix(Zs,Yt,b,I,!0),Dr=fe&&h.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ho;ho=fe?se.iconsInText?Sl(qe.kind,bn,Nt,$,y,Pl,_u,Kr,wn,cr):vp(qe.kind,bn,Nt,$,y,Pl,_u,Kr,g,wn,!0):yp(qe.kind,bn,Nt,$,y,Pl,_u,Kr,g,wn);const Al={program:Yn,buffers:Ce,uniformValues:ho,atlasTexture:ji,atlasTextureIcon:Qi,atlasInterpolation:si,atlasInterpolationIcon:Nr,isSDF:fe,hasHalo:Dr};if(ut&&se.canOverlap){It=!0;const Zi=Ce.segments.get();for(const hr of Zi)Wt.push({segments:new a.S([hr]),sortKey:hr.sortKey,state:Al,terrainData:hn})}else Wt.push({segments:Ce.segments,sortKey:0,state:Al,terrainData:hn})}It&&Wt.sort((ne,Yt)=>ne.sortKey-Yt.sortKey);for(const ne of Wt){const Yt=ne.state;if(j.activeTexture.set(nt.TEXTURE0),Yt.atlasTexture.bind(Yt.atlasInterpolation,nt.CLAMP_TO_EDGE),Yt.atlasTextureIcon&&(j.activeTexture.set(nt.TEXTURE1),Yt.atlasTextureIcon&&Yt.atlasTextureIcon.bind(Yt.atlasInterpolationIcon,nt.CLAMP_TO_EDGE)),Yt.isSDF){const se=Yt.uniformValues;Yt.hasHalo&&(se.u_is_halo=1,kp(Yt.buffers,ne.segments,h,y,Yt.program,Ft,R,O,se,ne.terrainData)),se.u_is_halo=0}kp(Yt.buffers,ne.segments,h,y,Yt.program,Ft,R,O,Yt.uniformValues,ne.terrainData)}}function kp(y,s,h,d,g,b,I,C,M,A){const R=d.context;g.draw(R,R.gl.TRIANGLES,b,I,C,_i.disabled,M,A,h.id,y.layoutVertexBuffer,y.indexBuffer,s,h.paint,d.transform.zoom,y.programConfigurations.get(h.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function Ju(y,s,h,d,g){if(!h||!d||!d.imageAtlas)return;const b=d.imageAtlas.patternPositions;let I=b[h.to.toString()],C=b[h.from.toString()];if(!I&&C&&(I=C),!C&&I&&(C=I),!I||!C){const M=g.getPaintProperty(s);I=b[M],C=b[M]}I&&C&&y.setConstantPatternPositions(I,C)}function Qu(y,s,h,d,g,b,I){const C=y.context.gl,M="fill-pattern",A=h.paint.get(M),R=A&&A.constantOr(1),O=h.getCrossfadeParameters();let j,nt,et,at,$;I?(nt=R&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=C.LINES):(nt=R?"fillPattern":"fill",j=C.TRIANGLES);const xt=A.constantOr(null);for(const Nt of d){const ut=s.getTile(Nt);if(R&&!ut.patternsLoaded())continue;const It=ut.getBucket(h);if(!It)continue;const Ft=It.programConfigurations.get(h.id),Bt=y.useProgram(nt,Ft),Wt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Nt);R&&(y.context.activeTexture.set(C.TEXTURE0),ut.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),Ft.updatePaintBuffers(O)),Ju(Ft,M,xt,ut,h);const ne=Wt?Nt:null,Yt=y.translatePosMatrix(ne?ne.posMatrix:Nt.posMatrix,ut,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(I){at=It.indexBuffer2,$=It.segments2;const se=[C.drawingBufferWidth,C.drawingBufferHeight];et=nt==="fillOutlinePattern"&&R?Uc(Yt,y,O,ut,se):Vc(Yt,se)}else at=It.indexBuffer,$=It.segments,et=R?dp(Yt,y,O,ut):xd(Yt);Bt.draw(y.context,j,g,y.stencilModeForClipping(Nt),b,_i.disabled,et,Wt,h.id,It.layoutVertexBuffer,at,$,h.paint,y.transform.zoom,Ft)}}function $u(y,s,h,d,g,b,I){const C=y.context,M=C.gl,A="fill-extrusion-pattern",R=h.paint.get(A),O=R.constantOr(1),j=h.getCrossfadeParameters(),nt=h.paint.get("fill-extrusion-opacity"),et=R.constantOr(null);for(const at of d){const $=s.getTile(at),xt=$.getBucket(h);if(!xt)continue;const Nt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(at),ut=xt.programConfigurations.get(h.id),It=y.useProgram(O?"fillExtrusionPattern":"fillExtrusion",ut);O&&(y.context.activeTexture.set(M.TEXTURE0),$.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),ut.updatePaintBuffers(j)),Ju(ut,A,et,$,h);const Ft=y.translatePosMatrix(at.posMatrix,$,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Bt=h.paint.get("fill-extrusion-vertical-gradient"),Wt=O?Ha(Ft,y,Bt,nt,at,j,$):fp(Ft,y,Bt,nt);It.draw(C,C.gl.TRIANGLES,g,b,I,_i.backCCW,Wt,Nt,h.id,xt.layoutVertexBuffer,xt.indexBuffer,xt.segments,h.paint,y.transform.zoom,ut,y.style.map.terrain&&xt.centroidVertexBuffer)}}function jg(y,s,h,d,g,b,I){const C=y.context,M=C.gl,A=h.fbo;if(!A)return;const R=y.useProgram("hillshade"),O=y.style.map.terrain&&y.style.map.terrain.getTerrainData(s);C.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,A.colorAttachment.get()),R.draw(C,M.TRIANGLES,g,b,I,_i.disabled,((j,nt,et,at)=>{const $=et.paint.get("hillshade-shadow-color"),xt=et.paint.get("hillshade-highlight-color"),Nt=et.paint.get("hillshade-accent-color");let ut=et.paint.get("hillshade-illumination-direction")*(Math.PI/180);et.paint.get("hillshade-illumination-anchor")==="viewport"&&(ut-=j.transform.angle);const It=!j.options.moving;return{u_matrix:at?at.posMatrix:j.transform.calculatePosMatrix(nt.tileID.toUnwrapped(),It),u_image:0,u_latrange:gp(0,nt.tileID),u_light:[et.paint.get("hillshade-exaggeration"),ut],u_shadow:$,u_highlight:xt,u_accent:Nt}})(y,h,d,O?s:null),O,d.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function Np(y,s,h,d,g,b){const I=y.context,C=I.gl,M=s.dem;if(M&&M.data){const A=M.dim,R=M.stride,O=M.getPixels();if(I.activeTexture.set(C.TEXTURE1),I.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||y.getTileTexture(R),s.demTexture){const nt=s.demTexture;nt.update(O,{premultiply:!1}),nt.bind(C.NEAREST,C.CLAMP_TO_EDGE)}else s.demTexture=new Et(I,O,C.RGBA,{premultiply:!1}),s.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);I.activeTexture.set(C.TEXTURE0);let j=s.fbo;if(!j){const nt=new Et(I,{width:A,height:A,data:null},C.RGBA);nt.bind(C.LINEAR,C.CLAMP_TO_EDGE),j=s.fbo=I.createFramebuffer(A,A,!0,!1),j.colorAttachment.set(nt.texture)}I.bindFramebuffer.set(j.framebuffer),I.viewport.set([0,0,A,A]),y.useProgram("hillshadePrepare").draw(I,C.TRIANGLES,d,g,b,_i.disabled,((nt,et)=>{const at=et.stride,$=a.Z();return a.aS($,0,a.N,-a.N,0,0,1),a.$($,$,[0,-a.N,0]),{u_matrix:$,u_image:1,u_dimension:[at,at],u_zoom:nt.overscaledZ,u_unpack:et.getUnpackVector()}})(s.tileID,M),null,h.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),s.needsHillshadePrepare=!1}}function Zg(y,s,h,d,g,b){const I=d.paint.get("raster-fade-duration");if(!b&&I>0){const C=a.h.now(),M=(C-y.timeAdded)/I,A=s?(C-s.timeAdded)/I:-1,R=h.getSource(),O=g.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),j=!s||Math.abs(s.tileID.overscaledZ-O)>Math.abs(y.tileID.overscaledZ-O),nt=j&&y.refreshedUponExpiration?1:a.ad(j?M:1-A,0,1);return y.refreshedUponExpiration&&M>=1&&(y.refreshedUponExpiration=!1),s?{opacity:1,mix:1-nt}:{opacity:nt,mix:0}}return{opacity:1,mix:0}}const Rd=new a.aT(1,0,0,1),nh=new a.aT(0,1,0,1),Dp=new a.aT(0,0,1,1),Od=new a.aT(1,0,1,1),zd=new a.aT(0,1,1,1);function tc(y,s,h,d){rh(y,0,s+h/2,y.transform.width,h,d)}function ih(y,s,h,d){rh(y,s-h/2,0,h,y.transform.height,d)}function rh(y,s,h,d,g,b){const I=y.context,C=I.gl;C.enable(C.SCISSOR_TEST),C.scissor(s*y.pixelRatio,h*y.pixelRatio,d*y.pixelRatio,g*y.pixelRatio),I.clear({color:b}),C.disable(C.SCISSOR_TEST)}function Fd(y,s,h){const d=y.context,g=d.gl,b=h.posMatrix,I=y.useProgram("debug"),C=Tn.disabled,M=Ei.disabled,A=y.colorModeForRenderPass(),R="$debug",O=y.style.map.terrain&&y.style.map.terrain.getTerrainData(h);d.activeTexture.set(g.TEXTURE0);const j=s.getTileByID(h.key).latestRawTileData,nt=Math.floor((j&&j.byteLength||0)/1024),et=s.getTile(h).tileSize,at=512/Math.min(et,512)*(h.overscaledZ/y.transform.zoom)*.5;let $=h.canonical.toString();h.overscaledZ!==h.canonical.z&&($+=` => ${h.overscaledZ}`),function(xt,Nt){xt.initDebugOverlayCanvas();const ut=xt.debugOverlayCanvas,It=xt.context.gl,Ft=xt.debugOverlayCanvas.getContext("2d");Ft.clearRect(0,0,ut.width,ut.height),Ft.shadowColor="white",Ft.shadowBlur=2,Ft.lineWidth=1.5,Ft.strokeStyle="white",Ft.textBaseline="top",Ft.font="bold 36px Open Sans, sans-serif",Ft.fillText(Nt,5,5),Ft.strokeText(Nt,5,5),xt.debugOverlayTexture.update(ut),xt.debugOverlayTexture.bind(It.LINEAR,It.CLAMP_TO_EDGE)}(y,`${$} ${nt}kB`),I.draw(d,g.TRIANGLES,C,M,Si.alphaBlended,_i.disabled,Hu(b,a.aT.transparent,at),null,R,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),I.draw(d,g.LINE_STRIP,C,M,A,_i.disabled,Hu(b,a.aT.red),O,R,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function Ri(y,s,h){const d=y.context,g=d.gl,b=y.colorModeForRenderPass(),I=new Tn(g.LEQUAL,Tn.ReadWrite,y.depthRangeFor3D),C=y.useProgram("terrain"),M=s.getTerrainMesh();d.bindFramebuffer.set(null),d.viewport.set([0,0,y.width,y.height]);for(const A of h){const R=y.renderToTexture.getTexture(A),O=s.getTerrainData(A.tileID);d.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,R.texture);const j={u_matrix:y.transform.calculatePosMatrix(A.tileID.toUnwrapped()),u_texture:0,u_ele_delta:s.getMeshFrameDelta(y.transform.zoom)};C.draw(d,g.TRIANGLES,I,Ei.disabled,b,_i.backCCW,j,O,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}}class Cl{constructor(s,h){this.context=new qg(s),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.Z(),renderTime:0},this.setup(),this.numSublayers=mi.maxUnderzooming+mi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new zc}resize(s,h,d){if(this.width=Math.floor(s*d),this.height=Math.floor(h*d),this.pixelRatio=d,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const s=this.context,h=new a.a_;h.emplaceBack(0,0),h.emplaceBack(a.N,0),h.emplaceBack(0,a.N),h.emplaceBack(a.N,a.N),this.tileExtentBuffer=s.createVertexBuffer(h,Fc.members),this.tileExtentSegments=a.S.simpleSegment(0,0,4,2);const d=new a.a_;d.emplaceBack(0,0),d.emplaceBack(a.N,0),d.emplaceBack(0,a.N),d.emplaceBack(a.N,a.N),this.debugBuffer=s.createVertexBuffer(d,Fc.members),this.debugSegments=a.S.simpleSegment(0,0,4,5);const g=new a.V;g.emplaceBack(0,0,0,0),g.emplaceBack(a.N,0,a.N,0),g.emplaceBack(0,a.N,0,a.N),g.emplaceBack(a.N,a.N,a.N,a.N),this.rasterBoundsBuffer=s.createVertexBuffer(g,fn.members),this.rasterBoundsSegments=a.S.simpleSegment(0,0,4,2);const b=new a.a_;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(b,Fc.members),this.viewportSegments=a.S.simpleSegment(0,0,4,2);const I=new a.a$;I.emplaceBack(0),I.emplaceBack(1),I.emplaceBack(3),I.emplaceBack(2),I.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(I);const C=new a.b0;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(C);const M=this.context.gl;this.stencilClearMode=new Ei({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO)}clearStencil(){const s=this.context,h=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const d=a.Z();a.aS(d,0,this.width,this.height,0,0,1),a.a0(d,d,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,h.TRIANGLES,Tn.disabled,this.stencilClearMode,Si.disabled,_i.disabled,wd(d),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,h){if(this.currentStencilSource===s.source||!s.isTileClipped()||!h||!h.length)return;this.currentStencilSource=s.source;const d=this.context,g=d.gl;this.nextStencilID+h.length>256&&this.clearStencil(),d.setColorMode(Si.disabled),d.setDepthMode(Tn.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of h){const C=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,M=this.style.map.terrain&&this.style.map.terrain.getTerrainData(I);b.draw(d,g.TRIANGLES,Tn.disabled,new Ei({func:g.ALWAYS,mask:0},C,255,g.KEEP,g.KEEP,g.REPLACE),Si.disabled,_i.disabled,wd(I.posMatrix),M,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,h=this.context.gl;return new Ei({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){const h=this.context.gl;return new Ei({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(s){const h=this.context.gl,d=s.sort((I,C)=>C.overscaledZ-I.overscaledZ),g=d[d.length-1].overscaledZ,b=d[0].overscaledZ-g+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const I={};for(let C=0;C<b;C++)I[C+g]=new Ei({func:h.GEQUAL,mask:255},C+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=b,[I,d]}return[{[g]:Ei.disabled},d]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new Si([s.CONSTANT_COLOR,s.ONE],new a.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Si.unblended:Si.alphaBlended}depthModeForSublayer(s,h,d){if(!this.opaquePassEnabledForLayer())return Tn.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new Tn(d||this.context.gl.LEQUAL,h,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,h){this.style=s,this.options=h,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(a.h.now()),this.imageManager.beginFrame();const d=this.style._order,g=this.style.sourceCaches,b={},I={},C={};for(const M in g){const A=g[M];A.used&&A.prepare(this.context),b[M]=A.getVisibleCoordinates(),I[M]=b[M].slice().reverse(),C[M]=A.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let M=0;M<d.length;M++)if(this.style._layers[d[M]].is3D()){this.opaquePassCutoff=M;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const M=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!a.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||M.length)&&(a.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(A,R){const O=A.context,j=O.gl,nt=Si.unblended,et=new Tn(j.LEQUAL,Tn.ReadWrite,[0,1]),at=R.getTerrainMesh(),$=R.sourceCache.getRenderableTiles(),xt=A.useProgram("terrainDepth");O.bindFramebuffer.set(R.getFramebuffer("depth").framebuffer),O.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),O.clear({color:a.aT.transparent,depth:1});for(const Nt of $){const ut=R.getTerrainData(Nt.tileID),It={u_matrix:A.transform.calculatePosMatrix(Nt.tileID.toUnwrapped()),u_ele_delta:R.getMeshFrameDelta(A.transform.zoom)};xt.draw(O,j.TRIANGLES,et,Ei.disabled,nt,_i.backCCW,It,ut,"terrain",at.vertexBuffer,at.indexBuffer,at.segments)}O.bindFramebuffer.set(null),O.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain),function(A,R){const O=A.context,j=O.gl,nt=Si.unblended,et=new Tn(j.LEQUAL,Tn.ReadWrite,[0,1]),at=R.getTerrainMesh(),$=R.getCoordsTexture(),xt=R.sourceCache.getRenderableTiles(),Nt=A.useProgram("terrainCoords");O.bindFramebuffer.set(R.getFramebuffer("coords").framebuffer),O.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),O.clear({color:a.aT.transparent,depth:1}),R.coordsIndex=[];for(const ut of xt){const It=R.getTerrainData(ut.tileID);O.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,$.texture);const Ft={u_matrix:A.transform.calculatePosMatrix(ut.tileID.toUnwrapped()),u_terrain_coords_id:(255-R.coordsIndex.length)/255,u_texture:0,u_ele_delta:R.getMeshFrameDelta(A.transform.zoom)};Nt.draw(O,j.TRIANGLES,et,Ei.disabled,nt,_i.backCCW,Ft,It,"terrain",at.vertexBuffer,at.indexBuffer,at.segments),R.coordsIndex.push(ut.tileID.key)}O.bindFramebuffer.set(null),O.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const M of d){const A=this.style._layers[M];if(!A.hasOffscreenPass()||A.isHidden(this.transform.zoom))continue;const R=I[A.source];(A.type==="custom"||R.length)&&this.renderLayer(this,g[A.source],A,R)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?a.aT.black:a.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const M=this.style._layers[d[this.currentLayer]],A=g[M.source],R=b[M.source];this._renderTileClippingMasks(M,R),this.renderLayer(this,A,M,R)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const M=this.style._layers[d[this.currentLayer]],A=g[M.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(M))continue;const R=(M.type==="symbol"?C:I)[M.source];this._renderTileClippingMasks(M,b[M.source]),this.renderLayer(this,A,M,R)}if(this.options.showTileBoundaries){const M=function(A,R){let O=null;const j=Object.values(A._layers).flatMap($=>$.source&&!$.isHidden(R)?[A.sourceCaches[$.source]]:[]),nt=j.filter($=>$.getSource().type==="vector"),et=j.filter($=>$.getSource().type!=="vector"),at=$=>{(!O||O.getSource().maxzoom<$.getSource().maxzoom)&&(O=$)};return nt.forEach($=>at($)),O||et.forEach($=>at($)),O}(this.style,this.transform.zoom);M&&function(A,R,O){for(let j=0;j<O.length;j++)Fd(A,R,O[j])}(this,M,M.getVisibleCoordinates())}this.options.showPadding&&function(M){const A=M.transform.padding;tc(M,M.transform.height-(A.top||0),3,Rd),tc(M,A.bottom||0,3,nh),ih(M,A.left||0,3,Dp),ih(M,M.transform.width-(A.right||0),3,Od);const R=M.transform.centerPoint;(function(O,j,nt,et){rh(O,j-1,nt-10,2,20,et),rh(O,j-10,nt-1,20,2,et)})(M,R.x,M.transform.height-R.y,zd)}(this),this.context.setDefault()}renderLayer(s,h,d,g){if(!d.isHidden(this.transform.zoom)&&(d.type==="background"||d.type==="custom"||(g||[]).length))switch(this.id=d.id,d.type){case"symbol":(function(b,I,C,M,A){if(b.renderPass!=="translucent")return;const R=Ei.disabled,O=b.colorModeForRenderPass();(C._unevaluatedLayout.hasValue("text-variable-anchor")||C._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(j,nt,et,at,$,xt,Nt){const ut=nt.transform,It=$==="map",Ft=xt==="map";for(const Bt of j){const Wt=at.getTile(Bt),ne=Wt.getBucket(et);if(!ne||!ne.text||!ne.text.segments.get().length)continue;const Yt=a.ah(ne.textSizeData,ut.zoom),se=_t(Wt,1,nt.transform.zoom),Ce=ae(Bt.posMatrix,Ft,It,nt.transform,se),xn=et.layout.get("icon-text-fit")!=="none"&&ne.hasIconData();if(Yt){const fe=Math.pow(2,ut.zoom-Wt.tileID.overscaledZ);th(ne,It,Ft,Nt,ut,Ce,Bt.posMatrix,fe,Yt,xn,nt.style.map.terrain?(qe,Le)=>nt.style.map.terrain.getElevation(Bt,qe,Le):null)}}}(M,b,C,I,C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),A),C.paint.get("icon-opacity").constantOr(1)!==0&&eh(b,I,C,M,!1,C.paint.get("icon-translate"),C.paint.get("icon-translate-anchor"),C.layout.get("icon-rotation-alignment"),C.layout.get("icon-pitch-alignment"),C.layout.get("icon-keep-upright"),R,O),C.paint.get("text-opacity").constantOr(1)!==0&&eh(b,I,C,M,!0,C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.layout.get("text-keep-upright"),R,O),I.map.showCollisionBoxes&&(Dd(b,I,C,M,C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),!0),Dd(b,I,C,M,C.paint.get("icon-translate"),C.paint.get("icon-translate-anchor"),!1))})(s,h,d,g,this.style.placement.variableOffsets);break;case"circle":(function(b,I,C,M){if(b.renderPass!=="translucent")return;const A=C.paint.get("circle-opacity"),R=C.paint.get("circle-stroke-width"),O=C.paint.get("circle-stroke-opacity"),j=!C.layout.get("circle-sort-key").isConstant();if(A.constantOr(1)===0&&(R.constantOr(1)===0||O.constantOr(1)===0))return;const nt=b.context,et=nt.gl,at=b.depthModeForSublayer(0,Tn.ReadOnly),$=Ei.disabled,xt=b.colorModeForRenderPass(),Nt=[];for(let ut=0;ut<M.length;ut++){const It=M[ut],Ft=I.getTile(It),Bt=Ft.getBucket(C);if(!Bt)continue;const Wt=Bt.programConfigurations.get(C.id),ne=b.useProgram("circle",Wt),Yt=Bt.layoutVertexBuffer,se=Bt.indexBuffer,Ce=b.style.map.terrain&&b.style.map.terrain.getTerrainData(It),xn={programConfiguration:Wt,program:ne,layoutVertexBuffer:Yt,indexBuffer:se,uniformValues:Ya(b,It,Ft,C),terrainData:Ce};if(j){const fe=Bt.segments.get();for(const qe of fe)Nt.push({segments:new a.S([qe]),sortKey:qe.sortKey,state:xn})}else Nt.push({segments:Bt.segments,sortKey:0,state:xn})}j&&Nt.sort((ut,It)=>ut.sortKey-It.sortKey);for(const ut of Nt){const{programConfiguration:It,program:Ft,layoutVertexBuffer:Bt,indexBuffer:Wt,uniformValues:ne,terrainData:Yt}=ut.state;Ft.draw(nt,et.TRIANGLES,at,$,xt,_i.disabled,ne,Yt,C.id,Bt,Wt,ut.segments,C.paint,b.transform.zoom,It)}})(s,h,d,g);break;case"heatmap":(function(b,I,C,M){if(C.paint.get("heatmap-opacity")!==0)if(b.renderPass==="offscreen"){const A=b.context,R=A.gl,O=Ei.disabled,j=new Si([R.ONE,R.ONE],a.aT.transparent,[!0,!0,!0,!0]);(function(nt,et,at){const $=nt.gl;nt.activeTexture.set($.TEXTURE1),nt.viewport.set([0,0,et.width/4,et.height/4]);let xt=at.heatmapFbo;if(xt)$.bindTexture($.TEXTURE_2D,xt.colorAttachment.get()),nt.bindFramebuffer.set(xt.framebuffer);else{const Nt=$.createTexture();$.bindTexture($.TEXTURE_2D,Nt),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.LINEAR),xt=at.heatmapFbo=nt.createFramebuffer(et.width/4,et.height/4,!1,!1),function(ut,It,Ft,Bt){var Wt,ne;const Yt=ut.gl,se=(Wt=ut.HALF_FLOAT)!==null&&Wt!==void 0?Wt:Yt.UNSIGNED_BYTE,Ce=(ne=ut.RGBA16F)!==null&&ne!==void 0?ne:Yt.RGBA;Yt.texImage2D(Yt.TEXTURE_2D,0,Ce,It.width/4,It.height/4,0,Yt.RGBA,se,null),Bt.colorAttachment.set(Ft)}(nt,et,Nt,xt)}})(A,b,C),A.clear({color:a.aT.transparent});for(let nt=0;nt<M.length;nt++){const et=M[nt];if(I.hasRenderableParent(et))continue;const at=I.getTile(et),$=at.getBucket(C);if(!$)continue;const xt=$.programConfigurations.get(C.id),Nt=b.useProgram("heatmap",xt),{zoom:ut}=b.transform;Nt.draw(A,R.TRIANGLES,Tn.disabled,O,j,_i.disabled,Rg(et.posMatrix,at,ut,C.paint.get("heatmap-intensity")),null,C.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,C.paint,b.transform.zoom,xt)}A.viewport.set([0,0,b.width,b.height])}else b.renderPass==="translucent"&&(b.context.setColorMode(b.colorModeForRenderPass()),function(A,R){const O=A.context,j=O.gl,nt=R.heatmapFbo;if(!nt)return;O.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,nt.colorAttachment.get()),O.activeTexture.set(j.TEXTURE1);let et=R.colorRampTexture;et||(et=R.colorRampTexture=new Et(O,R.colorRamp,j.RGBA)),et.bind(j.LINEAR,j.CLAMP_TO_EDGE),A.useProgram("heatmapTexture").draw(O,j.TRIANGLES,Tn.disabled,Ei.disabled,A.colorModeForRenderPass(),_i.disabled,((at,$,xt,Nt)=>{const ut=a.Z();a.aS(ut,0,at.width,at.height,0,0,1);const It=at.context.gl;return{u_matrix:ut,u_world:[It.drawingBufferWidth,It.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:$.paint.get("heatmap-opacity")}})(A,R),null,R.id,A.viewportBuffer,A.quadTriangleIndexBuffer,A.viewportSegments,R.paint,A.transform.zoom)}(b,C))})(s,h,d,g);break;case"line":(function(b,I,C,M){if(b.renderPass!=="translucent")return;const A=C.paint.get("line-opacity"),R=C.paint.get("line-width");if(A.constantOr(1)===0||R.constantOr(1)===0)return;const O=b.depthModeForSublayer(0,Tn.ReadOnly),j=b.colorModeForRenderPass(),nt=C.paint.get("line-dasharray"),et=C.paint.get("line-pattern"),at=et.constantOr(1),$=C.paint.get("line-gradient"),xt=C.getCrossfadeParameters(),Nt=at?"linePattern":nt?"lineSDF":$?"lineGradient":"line",ut=b.context,It=ut.gl;let Ft=!0;for(const Bt of M){const Wt=I.getTile(Bt);if(at&&!Wt.patternsLoaded())continue;const ne=Wt.getBucket(C);if(!ne)continue;const Yt=ne.programConfigurations.get(C.id),se=b.context.program.get(),Ce=b.useProgram(Nt,Yt),xn=Ft||Ce.program!==se,fe=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Bt),qe=et.constantOr(null);if(qe&&Wt.imageAtlas){const bn=Wt.imageAtlas,hn=bn.patternPositions[qe.to.toString()],wn=bn.patternPositions[qe.from.toString()];hn&&wn&&Yt.setConstantPatternPositions(hn,wn)}const Le=fe?Bt:null,Yn=at?Og(b,Wt,C,xt,Le):nt?Ed(b,Wt,C,nt,xt,Le):$?Sd(b,Wt,C,ne.lineClipsArray.length,Le):_p(b,Wt,C,Le);if(at)ut.activeTexture.set(It.TEXTURE0),Wt.imageAtlasTexture.bind(It.LINEAR,It.CLAMP_TO_EDGE),Yt.updatePaintBuffers(xt);else if(nt&&(xn||b.lineAtlas.dirty))ut.activeTexture.set(It.TEXTURE0),b.lineAtlas.bind(ut);else if($){const bn=ne.gradients[C.id];let hn=bn.texture;if(C.gradientVersion!==bn.version){let wn=256;if(C.stepInterpolant){const ji=I.getSource().maxzoom,si=Bt.canonical.z===ji?Math.ceil(1<<b.transform.maxZoom-Bt.canonical.z):1;wn=a.ad(a.aY(ne.maxLineLength/a.N*1024*si),256,ut.maxTextureSize)}bn.gradient=a.aZ({expression:C.gradientExpression(),evaluationKey:"lineProgress",resolution:wn,image:bn.gradient||void 0,clips:ne.lineClipsArray}),bn.texture?bn.texture.update(bn.gradient):bn.texture=new Et(ut,bn.gradient,It.RGBA),bn.version=C.gradientVersion,hn=bn.texture}ut.activeTexture.set(It.TEXTURE0),hn.bind(C.stepInterpolant?It.NEAREST:It.LINEAR,It.CLAMP_TO_EDGE)}Ce.draw(ut,It.TRIANGLES,O,b.stencilModeForClipping(Bt),j,_i.disabled,Yn,fe,C.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,C.paint,b.transform.zoom,Yt,ne.layoutVertexBuffer2),Ft=!1}})(s,h,d,g);break;case"fill":(function(b,I,C,M){const A=C.paint.get("fill-color"),R=C.paint.get("fill-opacity");if(R.constantOr(1)===0)return;const O=b.colorModeForRenderPass(),j=C.paint.get("fill-pattern"),nt=b.opaquePassEnabledForLayer()&&!j.constantOr(1)&&A.constantOr(a.aT.transparent).a===1&&R.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===nt){const et=b.depthModeForSublayer(1,b.renderPass==="opaque"?Tn.ReadWrite:Tn.ReadOnly);Qu(b,I,C,M,et,O,!1)}if(b.renderPass==="translucent"&&C.paint.get("fill-antialias")){const et=b.depthModeForSublayer(C.getPaintProperty("fill-outline-color")?2:0,Tn.ReadOnly);Qu(b,I,C,M,et,O,!0)}})(s,h,d,g);break;case"fill-extrusion":(function(b,I,C,M){const A=C.paint.get("fill-extrusion-opacity");if(A!==0&&b.renderPass==="translucent"){const R=new Tn(b.context.gl.LEQUAL,Tn.ReadWrite,b.depthRangeFor3D);if(A!==1||C.paint.get("fill-extrusion-pattern").constantOr(1))$u(b,I,C,M,R,Ei.disabled,Si.disabled),$u(b,I,C,M,R,b.stencilModeFor3D(),b.colorModeForRenderPass());else{const O=b.colorModeForRenderPass();$u(b,I,C,M,R,Ei.disabled,O)}}})(s,h,d,g);break;case"hillshade":(function(b,I,C,M){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const A=b.context,R=b.depthModeForSublayer(0,Tn.ReadOnly),O=b.colorModeForRenderPass(),[j,nt]=b.renderPass==="translucent"?b.stencilConfigForOverlap(M):[{},M];for(const et of nt){const at=I.getTile(et);at.needsHillshadePrepare!==void 0&&at.needsHillshadePrepare&&b.renderPass==="offscreen"?Np(b,at,C,R,Ei.disabled,O):b.renderPass==="translucent"&&jg(b,et,at,C,R,j[et.overscaledZ],O)}A.viewport.set([0,0,b.width,b.height])})(s,h,d,g);break;case"raster":(function(b,I,C,M){if(b.renderPass!=="translucent"||C.paint.get("raster-opacity")===0||!M.length)return;const A=b.context,R=A.gl,O=I.getSource(),j=b.useProgram("raster"),nt=b.colorModeForRenderPass(),[et,at]=O instanceof Un?[{},M]:b.stencilConfigForOverlap(M),$=at[at.length-1].overscaledZ,xt=!b.options.moving;for(const Nt of at){const ut=b.depthModeForSublayer(Nt.overscaledZ-$,C.paint.get("raster-opacity")===1?Tn.ReadWrite:Tn.ReadOnly,R.LESS),It=I.getTile(Nt);It.registerFadeDuration(C.paint.get("raster-fade-duration"));const Ft=I.findLoadedParent(Nt,0),Bt=Zg(It,Ft,I,C,b.transform,b.style.map.terrain);let Wt,ne;const Yt=C.paint.get("raster-resampling")==="nearest"?R.NEAREST:R.LINEAR;A.activeTexture.set(R.TEXTURE0),It.texture.bind(Yt,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),A.activeTexture.set(R.TEXTURE1),Ft?(Ft.texture.bind(Yt,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),Wt=Math.pow(2,Ft.tileID.overscaledZ-It.tileID.overscaledZ),ne=[It.tileID.canonical.x*Wt%1,It.tileID.canonical.y*Wt%1]):It.texture.bind(Yt,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST);const se=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Nt),Ce=se?Nt:null,xn=Ce?Ce.posMatrix:b.transform.calculatePosMatrix(Nt.toUnwrapped(),xt),fe=Cd(xn,ne||[0,0],Wt||1,Bt,C);O instanceof Un?j.draw(A,R.TRIANGLES,ut,Ei.disabled,nt,_i.disabled,fe,se,C.id,O.boundsBuffer,b.quadTriangleIndexBuffer,O.boundsSegments):j.draw(A,R.TRIANGLES,ut,et[Nt.overscaledZ],nt,_i.disabled,fe,se,C.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}})(s,h,d,g);break;case"background":(function(b,I,C,M){const A=C.paint.get("background-color"),R=C.paint.get("background-opacity");if(R===0)return;const O=b.context,j=O.gl,nt=b.transform,et=nt.tileSize,at=C.paint.get("background-pattern");if(b.isPatternMissing(at))return;const $=!at&&A.a===1&&R===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==$)return;const xt=Ei.disabled,Nt=b.depthModeForSublayer(0,$==="opaque"?Tn.ReadWrite:Tn.ReadOnly),ut=b.colorModeForRenderPass(),It=b.useProgram(at?"backgroundPattern":"background"),Ft=M||nt.coveringTiles({tileSize:et,terrain:b.style.map.terrain});at&&(O.activeTexture.set(j.TEXTURE0),b.imageManager.bind(b.context));const Bt=C.getCrossfadeParameters();for(const Wt of Ft){const ne=M?Wt.posMatrix:b.transform.calculatePosMatrix(Wt.toUnwrapped()),Yt=at?as(ne,R,b,at,{tileID:Wt,tileSize:et},Bt):qc(ne,R,A),se=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Wt);It.draw(O,j.TRIANGLES,Nt,xt,ut,_i.disabled,Yt,se,C.id,b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}})(s,0,d,g);break;case"custom":(function(b,I,C){const M=b.context,A=C.implementation;if(b.renderPass==="offscreen"){const R=A.prerender;R&&(b.setCustomLayerDefaults(),M.setColorMode(b.colorModeForRenderPass()),R.call(A,M.gl,b.transform.customLayerMatrix()),M.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),M.setColorMode(b.colorModeForRenderPass()),M.setStencilMode(Ei.disabled);const R=A.renderingMode==="3d"?new Tn(b.context.gl.LEQUAL,Tn.ReadWrite,b.depthRangeFor3D):b.depthModeForSublayer(0,Tn.ReadOnly);M.setDepthMode(R),A.render(M.gl,b.transform.customLayerMatrix()),M.setDirty(),b.setBaseState(),M.bindFramebuffer.set(null)}})(s,0,d)}}translatePosMatrix(s,h,d,g,b){if(!d[0]&&!d[1])return s;const I=b?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(I){const A=Math.sin(I),R=Math.cos(I);d=[d[0]*R-d[1]*A,d[0]*A+d[1]*R]}const C=[b?d[0]:_t(h,d[0],this.transform.zoom),b?d[1]:_t(h,d[1],this.transform.zoom),0],M=new Float32Array(16);return a.$(M,s,C),M}saveTileTexture(s){const h=this._tileTextures[s.size[0]];h?h.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const h=this._tileTextures[s];return h&&h.length>0?h.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const h=this.imageManager.getPattern(s.from.toString()),d=this.imageManager.getPattern(s.to.toString());return!h||!d}useProgram(s,h){this.cache=this.cache||{};const d=s+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[d]||(this.cache[d]=new Bc(this.context,wi[s],h,jc[s],this._showOverdrawInspector,this.style.map.terrain)),this.cache[d]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Et(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:s,drawingBufferHeight:h}=this.context.gl;return this.width!==s||this.height!==h}}class So{constructor(s,h){this.points=s,this.planes=h}static fromInvProjectionMatrix(s,h,d){const g=Math.pow(2,d),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const M=1/(C=a.ag([],C,s))[3]/h*g;return a.b3(C,C,[M,M,1/C[3],M])}),I=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const M=function(j,nt){var et=nt[0],at=nt[1],$=nt[2],xt=et*et+at*at+$*$;return xt>0&&(xt=1/Math.sqrt(xt)),j[0]=nt[0]*xt,j[1]=nt[1]*xt,j[2]=nt[2]*xt,j}([],function(j,nt,et){var at=nt[0],$=nt[1],xt=nt[2],Nt=et[0],ut=et[1],It=et[2];return j[0]=$*It-xt*ut,j[1]=xt*Nt-at*It,j[2]=at*ut-$*Nt,j}([],gt([],b[C[0]],b[C[1]]),gt([],b[C[2]],b[C[1]]))),A=-((R=M)[0]*(O=b[C[1]])[0]+R[1]*O[1]+R[2]*O[2]);var R,O;return M.concat(A)});return new So(b,I)}}class hu{constructor(s,h){this.min=s,this.max=h,this.center=function(d,g,b){return d[0]=.5*g[0],d[1]=.5*g[1],d[2]=.5*g[2],d}([],function(d,g,b){return d[0]=g[0]+b[0],d[1]=g[1]+b[1],d[2]=g[2]+b[2],d}([],this.min,this.max))}quadrant(s){const h=[s%2==0,s<2],d=Y(this.min),g=Y(this.max);for(let b=0;b<h.length;b++)d[b]=h[b]?this.min[b]:this.center[b],g[b]=h[b]?this.center[b]:this.max[b];return g[2]=this.max[2],new hu(d,g)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersects(s){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let d=!0;for(let g=0;g<s.planes.length;g++){const b=s.planes[g];let I=0;for(let C=0;C<h.length;C++)a.b4(b,h[C])>=0&&I++;if(I===0)return 0;I!==h.length&&(d=!1)}if(d)return 2;for(let g=0;g<3;g++){let b=Number.MAX_VALUE,I=-Number.MAX_VALUE;for(let C=0;C<s.points.length;C++){const M=s.points[C][g]-this.min[g];b=Math.min(b,M),I=Math.max(I,M)}if(I<0||b>this.max[g]-this.min[g])return 0}return 1}}class ec{constructor(s=0,h=0,d=0,g=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(d)||d<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=d,this.right=g}interpolate(s,h,d){return h.top!=null&&s.top!=null&&(this.top=a.B.number(s.top,h.top,d)),h.bottom!=null&&s.bottom!=null&&(this.bottom=a.B.number(s.bottom,h.bottom,d)),h.left!=null&&s.left!=null&&(this.left=a.B.number(s.left,h.left,d)),h.right!=null&&s.right!=null&&(this.right=a.B.number(s.right,h.right,d)),this}getCenter(s,h){const d=a.ad((this.left+s-this.right)/2,0,s),g=a.ad((this.top+h-this.bottom)/2,0,h);return new a.P(d,g)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new ec(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class oh{constructor(s,h,d,g,b){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=b===void 0||!!b,this._minZoom=s||0,this._maxZoom=h||22,this._minPitch=d??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ec,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const s=new oh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.apply(this),s}apply(s){this.tileSize=s.tileSize,this.latRange=s.latRange,this.width=s.width,this.height=s.height,this._center=s._center,this._elevation=s._elevation,this._minEleveationForCurrentTile=s._minEleveationForCurrentTile,this.zoom=s.zoom,this.angle=s.angle,this._fov=s._fov,this._pitch=s._pitch,this._unmodified=s._unmodified,this._edgeInsets=s._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){const h=-a.b5(s,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var d=new a.A(4);return a.A!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d}(),function(d,g,b){var I=g[0],C=g[1],M=g[2],A=g[3],R=Math.sin(b),O=Math.cos(b);d[0]=I*O+M*R,d[1]=C*O+A*R,d[2]=I*-R+M*O,d[3]=C*-R+A*O}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const h=a.ad(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(s){const h=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,d){this._unmodified=!1,this._edgeInsets.interpolate(s,h,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const h=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(s){const h=[new a.b6(0,s)];if(this._renderWorldCopies){const d=this.pointCoordinate(new a.P(0,0)),g=this.pointCoordinate(new a.P(this.width,0)),b=this.pointCoordinate(new a.P(this.width,this.height)),I=this.pointCoordinate(new a.P(0,this.height)),C=Math.floor(Math.min(d.x,g.x,b.x,I.x)),M=Math.floor(Math.max(d.x,g.x,b.x,I.x)),A=1;for(let R=C-A;R<=M+A;R++)R!==0&&h.push(new a.b6(R,s))}return h}coveringTiles(s){var h,d;let g=this.coveringZoomLevel(s);const b=g;if(s.minzoom!==void 0&&g<s.minzoom)return[];s.maxzoom!==void 0&&g>s.maxzoom&&(g=s.maxzoom);const I=this.pointCoordinate(this.getCameraPoint()),C=a.U.fromLngLat(this.center),M=Math.pow(2,g),A=[M*I.x,M*I.y,0],R=[M*C.x,M*C.y,0],O=So.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g);let j=s.minzoom||0;!s.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(j=g);const nt=s.terrain?2/Math.min(this.tileSize,s.tileSize)*this.tileSize:3,et=ut=>({aabb:new hu([ut*M,0,0],[(ut+1)*M,M,0]),zoom:0,x:0,y:0,wrap:ut,fullyVisible:!1}),at=[],$=[],xt=g,Nt=s.reparseOverscaled?b:g;if(this._renderWorldCopies)for(let ut=1;ut<=3;ut++)at.push(et(-ut)),at.push(et(ut));for(at.push(et(0));at.length>0;){const ut=at.pop(),It=ut.x,Ft=ut.y;let Bt=ut.fullyVisible;if(!Bt){const Ce=ut.aabb.intersects(O);if(Ce===0)continue;Bt=Ce===2}const Wt=s.terrain?A:R,ne=ut.aabb.distanceX(Wt),Yt=ut.aabb.distanceY(Wt),se=Math.max(Math.abs(ne),Math.abs(Yt));if(ut.zoom===xt||se>nt+(1<<xt-ut.zoom)-2&&ut.zoom>=j){const Ce=xt-ut.zoom,xn=A[0]-.5-(It<<Ce),fe=A[1]-.5-(Ft<<Ce);$.push({tileID:new a.O(ut.zoom===xt?Nt:ut.zoom,ut.wrap,ut.zoom,It,Ft),distanceSq:ct([R[0]-.5-It,R[1]-.5-Ft]),tileDistanceToCamera:Math.sqrt(xn*xn+fe*fe)})}else for(let Ce=0;Ce<4;Ce++){const xn=(It<<1)+Ce%2,fe=(Ft<<1)+(Ce>>1),qe=ut.zoom+1;let Le=ut.aabb.quadrant(Ce);if(s.terrain){const Yn=new a.O(qe,ut.wrap,qe,xn,fe),bn=s.terrain.getMinMaxElevation(Yn),hn=(h=bn.minElevation)!==null&&h!==void 0?h:this.elevation,wn=(d=bn.maxElevation)!==null&&d!==void 0?d:this.elevation;Le=new hu([Le.min[0],Le.min[1],hn],[Le.max[0],Le.max[1],wn])}at.push({aabb:Le,zoom:qe,x:xn,y:fe,wrap:ut.wrap,fullyVisible:Bt})}}return $.sort((ut,It)=>ut.distanceSq-It.distanceSq).map(ut=>ut.tileID)}resize(s,h){this.width=s,this.height=h,this.pixelsToGLUnits=[2/s,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const h=a.ad(s.lat,-this.maxValidLatitude,this.maxValidLatitude);return new a.P(a.G(s.lng)*this.worldSize,a.H(h)*this.worldSize)}unproject(s){return new a.U(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(s){const h=this.pointLocation(this.centerPoint,s),d=s.getElevationForLngLatZoom(h,this.tileZoom);if(!(this.elevation-d))return;const g=this.getCameraPosition(),b=a.U.fromLngLat(g.lngLat,g.altitude),I=a.U.fromLngLat(h,d),C=b.x-I.x,M=b.y-I.y,A=b.z-I.z,R=Math.sqrt(C*C+M*M+A*A),O=this.scaleZoom(this.cameraToCenterDistance/R/this.tileSize);this._elevation=d,this._center=h,this.zoom=O}setLocationAtPoint(s,h){const d=this.pointCoordinate(h),g=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(s),I=new a.U(b.x-(d.x-g.x),b.y-(d.y-g.y));this.center=this.coordinateLocation(I),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s,h){return h?this.coordinatePoint(this.locationCoordinate(s),h.getElevationForLngLatZoom(s,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(s))}pointLocation(s,h){return this.coordinateLocation(this.pointCoordinate(s,h))}locationCoordinate(s){return a.U.fromLngLat(s)}coordinateLocation(s){return s&&s.toLngLat()}pointCoordinate(s,h){if(h){const j=h.pointCoordinate(s);if(j!=null)return j}const d=[s.x,s.y,0,1],g=[s.x,s.y,1,1];a.ag(d,d,this.pixelMatrixInverse),a.ag(g,g,this.pixelMatrixInverse);const b=d[3],I=g[3],C=d[1]/b,M=g[1]/I,A=d[2]/b,R=g[2]/I,O=A===R?0:(0-A)/(R-A);return new a.U(a.B.number(d[0]/b,g[0]/I,O)/this.worldSize,a.B.number(C,M,O)/this.worldSize)}coordinatePoint(s,h=0,d=this.pixelMatrix){const g=[s.x*this.worldSize,s.y*this.worldSize,h,1];return a.ag(g,g,d),new a.P(g[0]/g[3],g[1]/g[3])}getBounds(){const s=Math.max(0,this.height/2-this.getHorizon());return new Ue().extend(this.pointLocation(new a.P(0,s))).extend(this.pointLocation(new a.P(this.width,s))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ue([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(s,h=!1){const d=s.key,g=h?this._alignedPosMatrixCache:this._posMatrixCache;if(g[d])return g[d];const b=s.canonical,I=this.worldSize/this.zoomScale(b.z),C=b.x+Math.pow(2,b.z)*s.wrap,M=a.ao(new Float64Array(16));return a.$(M,M,[C*I,b.y*I,0]),a.a0(M,M,[I/a.N,I/a.N,1]),a.a1(M,h?this.alignedProjMatrix:this.projMatrix,M),g[d]=new Float32Array(M),g[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let s,h,d,g,b=-90,I=90,C=-180,M=180;const A=this.size,R=this._unmodified;if(this.latRange){const nt=this.latRange;b=a.H(nt[1])*this.worldSize,I=a.H(nt[0])*this.worldSize,s=I-b<A.y?A.y/(I-b):0}if(this.lngRange){const nt=this.lngRange;C=a.b5(a.G(nt[0])*this.worldSize,0,this.worldSize),M=a.b5(a.G(nt[1])*this.worldSize,0,this.worldSize),M<C&&(M+=this.worldSize),h=M-C<A.x?A.x/(M-C):0}const O=this.point,j=Math.max(h||0,s||0);if(j)return this.center=this.unproject(new a.P(h?(M+C)/2:O.x,s?(I+b)/2:O.y)),this.zoom+=this.scaleZoom(j),this._unmodified=R,void(this._constraining=!1);if(this.latRange){const nt=O.y,et=A.y/2;nt-et<b&&(g=b+et),nt+et>I&&(g=I-et)}if(this.lngRange){const nt=(C+M)/2,et=a.b5(O.x,nt-this.worldSize/2,nt+this.worldSize/2),at=A.x/2;et-at<C&&(d=C+at),et+at>M&&(d=M-at)}d===void 0&&g===void 0||(this.center=this.unproject(new a.P(d!==void 0?d:O.x,g!==void 0?g:O.y)).wrap()),this._unmodified=R,this._constraining=!1}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,h=this.point.x,d=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b7(1,this.center.lat)*this.worldSize;let g=a.ao(new Float64Array(16));a.a0(g,g,[this.width/2,-this.height/2,1]),a.$(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=a.ao(new Float64Array(16)),a.a0(g,g,[1,-1,1]),a.$(g,g,[-1,-1,0]),a.a0(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g;const b=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),I=Math.min(this.elevation,this._minEleveationForCurrentTile),C=b-I*this._pixelPerMeter/Math.cos(this._pitch),M=I<0?C:b,A=Math.PI/2+this._pitch,R=this._fov*(.5+s.y/this.height),O=Math.sin(R)*M/Math.sin(a.ad(Math.PI-A-R,.01,Math.PI-.01)),j=this.getHorizon(),nt=2*Math.atan(j/this.cameraToCenterDistance)*(.5+s.y/(2*j)),et=Math.sin(nt)*M/Math.sin(a.ad(Math.PI-A-nt,.01,Math.PI-.01)),at=Math.min(O,et),$=1.01*(Math.cos(Math.PI/2-this._pitch)*at+M),xt=this.height/50;g=new Float64Array(16),a.b8(g,this._fov,this.width/this.height,xt,$),g[8]=2*-s.x/this.width,g[9]=2*s.y/this.height,a.a0(g,g,[1,-1,1]),a.$(g,g,[0,0,-this.cameraToCenterDistance]),a.b9(g,g,this._pitch),a.ae(g,g,this.angle),a.$(g,g,[-h,-d,0]),this.mercatorMatrix=a.a0([],g,[this.worldSize,this.worldSize,this.worldSize]),a.a0(g,g,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.a1(new Float64Array(16),this.labelPlaneMatrix,g),a.$(g,g,[0,0,-this.elevation]),this.projMatrix=g,this.invProjMatrix=a.as([],g),this.pixelMatrix3D=a.a1(new Float64Array(16),this.labelPlaneMatrix,g);const Nt=this.width%2/2,ut=this.height%2/2,It=Math.cos(this.angle),Ft=Math.sin(this.angle),Bt=h-Math.round(h)+It*Nt+Ft*ut,Wt=d-Math.round(d)+It*ut+Ft*Nt,ne=new Float64Array(g);if(a.$(ne,ne,[Bt>.5?Bt-1:Bt,Wt>.5?Wt-1:Wt,0]),this.alignedProjMatrix=ne,g=a.as(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");this.pixelMatrixInverse=g,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const s=this.pointCoordinate(new a.P(0,0)),h=[s.x*this.worldSize,s.y*this.worldSize,0,1];return a.ag(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,s))}getCameraQueryGeometry(s){const h=this.getCameraPoint();if(s.length===1)return[s[0],h];{let d=h.x,g=h.y,b=h.x,I=h.y;for(const C of s)d=Math.min(d,C.x),g=Math.min(g,C.y),b=Math.max(b,C.x),I=Math.max(I,C.y);return[new a.P(d,g),new a.P(b,g),new a.P(b,I),new a.P(d,I),new a.P(d,g)]}}}function Tl(y,s){let h,d=!1,g=null,b=null;const I=()=>{g=null,d&&(y.apply(b,h),g=setTimeout(I,s),d=!1)};return(...C)=>(d=!0,b=this,h=C,g||I(),g)}class nc{constructor(s){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let d;return h.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(d=g)}),(d&&d[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(d=>isNaN(d))){const d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:d,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,h)}catch{}},this._updateHash=Tl(this._updateHashUnthrottled,300),this._hashName=s&&encodeURIComponent(s)}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(s){const h=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,g=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,g),I=Math.round(h.lng*b)/b,C=Math.round(h.lat*b)/b,M=this._map.getBearing(),A=this._map.getPitch();let R="";if(R+=s?`/${I}/${C}/${d}`:`${d}/${C}/${I}`,(M||A)&&(R+="/"+Math.round(10*M)/10),A&&(R+=`/${Math.round(A)}`),this._hashName){const O=this._hashName;let j=!1;const nt=window.location.hash.slice(1).split("&").map(et=>{const at=et.split("=")[0];return at===O?(j=!0,`${at}=${R}`):et}).filter(et=>et);return j||nt.push(`${O}=${R}`),`#${nt.join("&")}`}return`#${R}`}}const pu={linearity:.3,easing:a.ba(0,0,.3,1)},Bd=a.e({deceleration:2500,maxSpeed:1400},pu),Vd=a.e({deceleration:20,maxSpeed:1400},pu),Ud=a.e({deceleration:1e3,maxSpeed:360},pu),Gd=a.e({deceleration:1e3,maxSpeed:90},pu);class qd{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.h.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,h=a.h.now();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)h.zoom+=b.zoomDelta||0,h.bearing+=b.bearingDelta||0,h.pitch+=b.pitchDelta||0,b.panDelta&&h.pan._add(b.panDelta),b.around&&(h.around=b.around),b.pinchAround&&(h.pinchAround=b.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(h.pan.mag()){const b=ic(h.pan.mag(),d,a.e({},Bd,s||{}));g.offset=h.pan.mult(b.amount/h.pan.mag()),g.center=this._map.transform.center,js(g,b)}if(h.zoom){const b=ic(h.zoom,d,Vd);g.zoom=this._map.transform.zoom+b.amount,js(g,b)}if(h.bearing){const b=ic(h.bearing,d,Ud);g.bearing=this._map.transform.bearing+a.ad(b.amount,-179,179),js(g,b)}if(h.pitch){const b=ic(h.pitch,d,Gd);g.pitch=this._map.transform.pitch+b.amount,js(g,b)}if(g.zoom||g.bearing){const b=h.pinchAround===void 0?h.around:h.pinchAround;g.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),a.e(g,{noMoveStart:!0})}}function js(y,s){(!y.duration||y.duration<s.duration)&&(y.duration=s.duration,y.easing=s.easing)}function ic(y,s,h){const{maxSpeed:d,linearity:g,deceleration:b}=h,I=a.ad(y*g/(s/1e3),-d,d),C=Math.abs(I)/(b*g);return{easing:h.easing,duration:1e3*C,amount:I*(C/2)}}class Vo extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,d,g={}){const b=x.mousePos(h.getCanvasContainer(),d),I=h.unproject(b);super(s,a.e({point:b,lngLat:I,originalEvent:d},g)),this._defaultPrevented=!1,this.target=h}}class rc extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,d){const g=s==="touchend"?d.changedTouches:d.touches,b=x.touchPos(h.getCanvasContainer(),g),I=b.map(M=>h.unproject(M)),C=b.reduce((M,A,R,O)=>M.add(A.div(O.length)),new a.P(0,0));super(s,{points:b,point:C,lngLats:I,lngLat:h.unproject(C),originalEvent:d}),this._defaultPrevented=!1}}class jd extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,d){super(s,{originalEvent:d}),this._defaultPrevented=!1}}class Zd{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new jd(s.type,this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new Vo(s.type,this._map,s))}mouseup(s){this._map.fire(new Vo(s.type,this._map,s))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new Vo(s.type,this._map,s))}dblclick(s){return this._firePreventable(new Vo(s.type,this._map,s))}mouseover(s){this._map.fire(new Vo(s.type,this._map,s))}mouseout(s){this._map.fire(new Vo(s.type,this._map,s))}touchstart(s){return this._firePreventable(new rc(s.type,this._map,s))}touchmove(s){this._map.fire(new rc(s.type,this._map,s))}touchend(s){this._map.fire(new rc(s.type,this._map,s))}touchcancel(s){this._map.fire(new rc(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wd{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new Vo(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Vo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new Vo(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ea{constructor(s){this._map=s}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(s){return this.transform.pointLocation(a.P.convert(s),this._map.terrain)}}class Xd{constructor(s,h){this._map=s,this._tr=new Ea(s),this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&s.button===0&&(x.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;const d=h;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=d,this._box||(this._box=x.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",s));const b=Math.min(g.x,d.x),I=Math.max(g.x,d.x),C=Math.min(g.y,d.y),M=Math.max(g.y,d.y);x.setTransform(this._box,`translate(${b}px,${C}px)`),this._box.style.width=I-b+"px",this._box.style.height=M-C+"px"}mouseupWindow(s,h){if(!this._active||s.button!==0)return;const d=this._startPos,g=h;if(this.reset(),x.suppressClick(),d.x!==g.x||d.y!==g.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:s})),{cameraAnimation:b=>b.fitScreenCoordinates(d,g,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(x.remove(this._box),this._box=null),x.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new a.k(s,{originalEvent:h}))}}function ls(y,s){if(y.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${s.length}`);const h={};for(let d=0;d<y.length;d++)h[y[d].identifier]=s[d];return h}class Ia{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,h,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),d.length===this.numTouches&&(this.centroid=function(g){const b=new a.P(0,0);for(const I of g)b._add(I);return b.div(g.length)}(h),this.touches=ls(d,h)))}touchmove(s,h,d){if(this.aborted||!this.centroid)return;const g=ls(d,h);for(const b in this.touches){const I=g[b];(!I||I.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(s,h,d){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class sh{constructor(s){this.singleTap=new Ia(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,h,d){this.singleTap.touchstart(s,h,d)}touchmove(s,h,d){this.singleTap.touchmove(s,h,d)}touchend(s,h,d){const g=this.singleTap.touchend(s,h,d);if(g){const b=s.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(g)<30;if(b&&I||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Ca{constructor(s){this._tr=new Ea(s),this._zoomIn=new sh({numTouches:1,numTaps:2}),this._zoomOut=new sh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,d){this._zoomIn.touchstart(s,h,d),this._zoomOut.touchstart(s,h,d)}touchmove(s,h,d){this._zoomIn.touchmove(s,h,d),this._zoomOut.touchmove(s,h,d)}touchend(s,h,d){const g=this._zoomIn.touchend(s,h,d),b=this._zoomOut.touchend(s,h,d),I=this._tr;return g?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:I.zoom+1,around:I.unproject(g)},{originalEvent:s})}):b?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:I.zoom-1,around:I.unproject(b)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ta{constructor(s){this._enabled=!!s.enable,this._moveStateManager=s.moveStateManager,this._clickTolerance=s.clickTolerance||1,this._moveFunction=s.move,this._activateOnStart=!!s.activateOnStart,s.assignEvents(this),this.reset()}reset(s){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(s)}_move(...s){const h=this._moveFunction(...s);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(s,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(s)&&(this._moveStateManager.startMove(s),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(s,h){if(!this.isEnabled())return;const d=this._lastPoint;if(!d)return;if(s.preventDefault(),!this._moveStateManager.isValidMoveEvent(s))return void this.reset(s);const g=h.length?h[0]:h;return!this._moved&&g.dist(d)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=g,this._move(d,g))}dragEnd(s){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(s)&&(this._moved&&x.suppressClick(),this.reset(s))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Wg={0:1,2:2};class Rp{constructor(s){this._correctEvent=s.checkCorrectEvent}startMove(s){const h=x.mouseButton(s);this._eventButton=h}endMove(s){delete this._eventButton}isValidStartEvent(s){return this._correctEvent(s)}isValidMoveEvent(s){return!function(h,d){const g=Wg[d];return h.buttons===void 0||(h.buttons&g)!==g}(s,this._eventButton)}isValidEndEvent(s){return x.mouseButton(s)===this._eventButton}}class Hd{constructor(){this._firstTouch=void 0}_isOneFingerTouch(s){return s.targetTouches.length===1}_isSameTouchEvent(s){return s.targetTouches[0].identifier===this._firstTouch}startMove(s){this._firstTouch=s.targetTouches[0].identifier}endMove(s){delete this._firstTouch}isValidStartEvent(s){return this._isOneFingerTouch(s)}isValidMoveEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}isValidEndEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}}const ah=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=function(s){s.preventDefault()}},fu=({enable:y,clickTolerance:s,bearingDegreesPerPixelMoved:h=.8})=>{const d=new Rp({checkCorrectEvent:g=>x.mouseButton(g)===0&&g.ctrlKey||x.mouseButton(g)===2});return new Ta({clickTolerance:s,move:(g,b)=>({bearingDelta:(b.x-g.x)*h}),moveStateManager:d,enable:y,assignEvents:ah})},La=({enable:y,clickTolerance:s,pitchDegreesPerPixelMoved:h=-.5})=>{const d=new Rp({checkCorrectEvent:g=>x.mouseButton(g)===0&&g.ctrlKey||x.mouseButton(g)===2});return new Ta({clickTolerance:s,move:(g,b)=>({pitchDelta:(b.y-g.y)*h}),moveStateManager:d,enable:y,assignEvents:ah})};class xe{constructor(s,h){this._minTouches=s.cooperativeGestures?2:1,this._clickTolerance=s.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(s,h,d){return this._calculateTransform(s,h,d)}touchmove(s,h,d){if(this._map._cooperativeGestures&&(this._minTouches===2&&d.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(s,!1,d.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(d.length<this._minTouches))return s.preventDefault(),this._calculateTransform(s,h,d)}touchend(s,h,d){this._calculateTransform(s,h,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,d){d.length>0&&(this._active=!0);const g=ls(d,h),b=new a.P(0,0),I=new a.P(0,0);let C=0;for(const A in g){const R=g[A],O=this._touches[A];O&&(b._add(R),I._add(R.sub(O)),C++,g[A]=R)}if(this._touches=g,C<this._minTouches||!I.mag())return;const M=I.div(C);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(C),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lh{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(s,h,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,d){if(!this._firstTwoTouches)return;s.preventDefault();const[g,b]=this._firstTwoTouches,I=Qa(d,h,g),C=Qa(d,h,b);if(!I||!C)return;const M=this._aroundCenter?null:I.add(C).div(2);return this._move([I,C],M,s)}touchend(s,h,d){if(!this._firstTwoTouches)return;const[g,b]=this._firstTwoTouches,I=Qa(d,h,g),C=Qa(d,h,b);I&&C||(this._active&&x.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Qa(y,s,h){for(let d=0;d<y.length;d++)if(y[d].identifier===h)return s[d]}function du(y,s){return Math.log(y/s)/Math.LN2}class Yd extends lh{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){const d=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(du(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:du(this._distance,d),pinchAround:h}}}function _e(y,s){return 180*y.angleWith(s)/Math.PI}class Op extends lh{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h){const d=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:_e(this._vector,d),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const h=25/(Math.PI*this._minDiameter)*360,d=_e(s,this._startVector);return Math.abs(d)<h}}function zp(y){return Math.abs(y.y)>Math.abs(y.x)}class Xg extends lh{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,h,d){super.touchstart(s,h,d),this._currentTouchCount=d.length}_start(s){this._lastPoints=s,zp(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,d){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const g=s[0].sub(this._lastPoints[0]),b=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,b,d.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(g.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(s,h,d){if(this._valid!==void 0)return this._valid;const g=s.mag()>=2,b=h.mag()>=2;if(!g&&!b)return;if(!g||!b)return this._firstMove===void 0&&(this._firstMove=d),d-this._firstMove<100&&void 0;const I=s.y>0==h.y>0;return zp(s)&&zp(h)&&I}}const Fp={panStep:100,bearingStep:15,pitchStep:10};class Kd{constructor(s){this._tr=new Ea(s);const h=Fp;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,d=0,g=0,b=0,I=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?d=-1:(s.preventDefault(),b=-1);break;case 39:s.shiftKey?d=1:(s.preventDefault(),b=1);break;case 38:s.shiftKey?g=1:(s.preventDefault(),I=-1);break;case 40:s.shiftKey?g=-1:(s.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(d=0,g=0),{cameraAnimation:C=>{const M=this._tr;C.easeTo({duration:300,easeId:"keyboardHandler",easing:Jd,zoom:h?Math.round(M.zoom)+h*(s.shiftKey?2:1):M.zoom,bearing:M.bearing+d*this._bearingStep,pitch:M.pitch+g*this._pitchStep,offset:[-b*this._panStep,-I*this._panStep],center:M.center},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Jd(y){return y*(2-y)}const Qd=4.000244140625;class Hg{constructor(s,h){this._onTimeout=d=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(d)},this._map=s,this._tr=new Ea(s),this._el=s.getCanvasContainer(),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!s[this._map._metaKey])return;s.preventDefault()}let h=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const d=a.h.now(),g=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,h!==0&&h%Qd==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(g*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=x.mousePos(this._el,s),d=this._tr;this._around=a.L.convert(this._aroundCenter?d.center:d.unproject(h)),this._aroundPoint=d.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._tr.transform;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>Qd?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&M!==0&&(M=1/M);const A=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):s.scale;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(A*M))),this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:s.zoom,d=this._startZoom,g=this._easing;let b,I=!1;if(this._type==="wheel"&&d&&g){const C=Math.min((a.h.now()-this._lastWheelEventTime)/200,1),M=g(C);b=a.B.number(d,h,M),C<1?this._frameId||(this._frameId=!0):I=!0}else b=h,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!I,zoomDelta:b-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=a.bb;if(this._prevEase){const d=this._prevEase,g=(a.h.now()-d.start)/d.duration,b=d.easing(g+.01)-d.easing(g),I=.27/Math.sqrt(b*b+1e-4)*.01,C=Math.sqrt(.0729-I*I);h=a.ba(I,C,.25,1)}return this._prevEase={start:a.h.now(),duration:s,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Bp{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Vp{constructor(s){this._tr=new Ea(s),this.reset()}reset(){this._active=!1}dblclick(s,h){return s.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:this._tr.zoom+(s.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Up{constructor(){this._tap=new sh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(s,h,d){if(!this._swipePoint)if(this._tapTime){const g=h[0],b=s.timeStamp-this._tapTime<500,I=this._tapPoint.dist(g)<30;b&&I?d.length>0&&(this._swipePoint=g,this._swipeTouch=d[0].identifier):this.reset()}else this._tap.touchstart(s,h,d)}touchmove(s,h,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const g=h[0],b=g.y-this._swipePoint.y;return this._swipePoint=g,s.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(s,h,d)}touchend(s,h,d){if(this._tapTime)this._swipePoint&&d.length===0&&this.reset();else{const g=this._tap.touchend(s,h,d);g&&(this._tapTime=s.timeStamp,this._tapPoint=g)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gp{constructor(s,h,d){this._el=s,this._mousePan=h,this._touchPan=d}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Eo{constructor(s,h,d){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=h,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class $a{constructor(s,h,d,g){this._el=s,this._touchZoom=h,this._touchRotate=d,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const oc=y=>y.zoom||y.drag||y.pitch||y.rotate;class qp extends a.k{}function sc(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class jp{constructor(s,h){this.handleWindowEvent=g=>{this.handleEvent(g,`${g.type}Window`)},this.handleEvent=(g,b)=>{if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const I=g.type==="renderFrame"?void 0:g,C={needsRenderFrame:!1},M={},A={},R=g.touches,O=R?this._getMapTouches(R):void 0,j=O?x.touchPos(this._el,O):x.mousePos(this._el,g);for(const{handlerName:at,handler:$,allowed:xt}of this._handlers){if(!$.isEnabled())continue;let Nt;this._blockedByActive(A,xt,at)?$.reset():$[b||g.type]&&(Nt=$[b||g.type](g,j,O),this.mergeHandlerResult(C,M,Nt,at,I),Nt&&Nt.needsRenderFrame&&this._triggerRenderFrame()),(Nt||$.isActive())&&(A[at]=$)}const nt={};for(const at in this._previousActiveHandlers)A[at]||(nt[at]=I);this._previousActiveHandlers=A,(Object.keys(nt).length||sc(C))&&(this._changes.push([C,M,nt]),this._triggerRenderFrame()),(Object.keys(A).length||sc(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:et}=C;et&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],et(this._map))},this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new qd(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,b,I]of this._listeners)x.addEventListener(g,b,g===document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[s,h,d]of this._listeners)x.removeEventListener(s,h,s===document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(s){const h=this._map,d=h.getCanvasContainer();this._add("mapEvent",new Zd(h,s));const g=h.boxZoom=new Xd(h,s);this._add("boxZoom",g),s.interactive&&s.boxZoom&&g.enable();const b=new Ca(h),I=new Vp(h);h.doubleClickZoom=new Bp(I,b),this._add("tapZoom",b),this._add("clickZoom",I),s.interactive&&s.doubleClickZoom&&h.doubleClickZoom.enable();const C=new Up;this._add("tapDragZoom",C);const M=h.touchPitch=new Xg(h);this._add("touchPitch",M),s.interactive&&s.touchPitch&&h.touchPitch.enable(s.touchPitch);const A=fu(s),R=La(s);h.dragRotate=new Eo(s,A,R),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]),s.interactive&&s.dragRotate&&h.dragRotate.enable();const O=(({enable:xt,clickTolerance:Nt})=>{const ut=new Rp({checkCorrectEvent:It=>x.mouseButton(It)===0&&!It.ctrlKey});return new Ta({clickTolerance:Nt,move:(It,Ft)=>({around:Ft,panDelta:Ft.sub(It)}),activateOnStart:!0,moveStateManager:ut,enable:xt,assignEvents:ah})})(s),j=new xe(s,h);h.dragPan=new Gp(d,O,j),this._add("mousePan",O),this._add("touchPan",j,["touchZoom","touchRotate"]),s.interactive&&s.dragPan&&h.dragPan.enable(s.dragPan);const nt=new Op,et=new Yd;h.touchZoomRotate=new $a(d,et,nt,C),this._add("touchRotate",nt,["touchPan","touchZoom"]),this._add("touchZoom",et,["touchPan","touchRotate"]),s.interactive&&s.touchZoomRotate&&h.touchZoomRotate.enable(s.touchZoomRotate);const at=h.scrollZoom=new Hg(h,()=>this._triggerRenderFrame());this._add("scrollZoom",at,["mousePan"]),s.interactive&&s.scrollZoom&&h.scrollZoom.enable(s.scrollZoom);const $=h.keyboard=new Kd(h);this._add("keyboard",$),s.interactive&&s.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new Wd(h))}_add(s,h,d){this._handlers.push({handlerName:s,handler:h,allowed:d}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!oc(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,h,d){for(const g in s)if(g!==d&&(!h||h.indexOf(g)<0))return!0;return!1}_getMapTouches(s){const h=[];for(const d of s)this._el.contains(d.target)&&h.push(d);return h}mergeHandlerResult(s,h,d,g,b){if(!d)return;a.e(s,d);const I={handlerName:g,originalEvent:d.originalEvent||b};d.zoomDelta!==void 0&&(h.zoom=I),d.panDelta!==void 0&&(h.drag=I),d.pitchDelta!==void 0&&(h.pitch=I),d.bearingDelta!==void 0&&(h.rotate=I)}_applyChanges(){const s={},h={},d={};for(const[g,b,I]of this._changes)g.panDelta&&(s.panDelta=(s.panDelta||new a.P(0,0))._add(g.panDelta)),g.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(s.around=g.around),g.pinchAround!==void 0&&(s.pinchAround=g.pinchAround),g.noInertia&&(s.noInertia=g.noInertia),a.e(h,b),a.e(d,I);this._updateMapTransform(s,h,d),this._changes=[]}_updateMapTransform(s,h,d){const g=this._map,b=g._getTransformForUpdate(),I=g.terrain;if(!(sc(s)||I&&this._terrainMovement))return this._fireEvents(h,d,!0);let{panDelta:C,zoomDelta:M,bearingDelta:A,pitchDelta:R,around:O,pinchAround:j}=s;j!==void 0&&(O=j),g._stop(!0),O=O||g.transform.centerPoint;const nt=b.pointLocation(C?O.sub(C):O);A&&(b.bearing+=A),R&&(b.pitch+=R),M&&(b.zoom+=M),I?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?b.center=b.pointLocation(b.centerPoint.sub(C)):b.setLocationAtPoint(nt,O):(this._terrainMovement=!0,this._map._elevationFreeze=!0,b.setLocationAtPoint(nt,O),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,b.recalculateZoom(g.terrain)})):b.setLocationAtPoint(nt,O),g._applyUpdatedTransform(b),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,d,!0)}_fireEvents(s,h,d){const g=oc(this._eventsInProgress),b=oc(s),I={};for(const R in s){const{originalEvent:O}=s[R];this._eventsInProgress[R]||(I[`${R}start`]=O),this._eventsInProgress[R]=s[R]}!g&&b&&this._fireEvent("movestart",b.originalEvent);for(const R in I)this._fireEvent(R,I[R]);b&&this._fireEvent("move",b.originalEvent);for(const R in s){const{originalEvent:O}=s[R];this._fireEvent(R,O)}const C={};let M;for(const R in this._eventsInProgress){const{handlerName:O,originalEvent:j}=this._eventsInProgress[R];this._handlersById[O].isActive()||(delete this._eventsInProgress[R],M=h[O]||j,C[`${R}end`]=M)}for(const R in C)this._fireEvent(R,C[R]);const A=oc(this._eventsInProgress);if(d&&(g||b)&&!A){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;!R||!R.essential&&a.h.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:M})),O(this._map.getBearing())&&this._map.resetNorth()):(O(R.bearing||this._map.getBearing())&&(R.bearing=0),R.freezeElevation=!0,this._map.easeTo(R,{originalEvent:M})),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new a.k(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new qp("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class $d extends a.E{constructor(s,h){super(),this._renderFrameCallback=()=>{const d=Math.min((a.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.L(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}panBy(s,h,d){return s=a.P.convert(s).mult(-1),this.panTo(this.transform.center,a.e({offset:s},h),d)}panTo(s,h,d){return this.easeTo(a.e({center:s},h),d)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,d){return this.easeTo(a.e({zoom:s},h),d)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,d){return this.easeTo(a.e({bearing:s},h),d)}resetNorth(s,h){return this.rotateTo(0,a.e({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}cameraForBounds(s,h){s=Ue.convert(s);const d=h&&h.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),d,h)}_cameraForBoxAndBearing(s,h,d,g){const b={top:0,bottom:0,right:0,left:0};if(typeof(g=a.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding=="number"){const Ft=g.padding;g.padding={top:Ft,bottom:Ft,right:Ft,left:Ft}}g.padding=a.e(b,g.padding);const I=this.transform,C=I.padding,M=I.project(a.L.convert(s)),A=I.project(a.L.convert(h)),R=M.rotate(-d*Math.PI/180),O=A.rotate(-d*Math.PI/180),j=new a.P(Math.max(R.x,O.x),Math.max(R.y,O.y)),nt=new a.P(Math.min(R.x,O.x),Math.min(R.y,O.y)),et=j.sub(nt),at=(I.width-(C.left+C.right+g.padding.left+g.padding.right))/et.x,$=(I.height-(C.top+C.bottom+g.padding.top+g.padding.bottom))/et.y;if($<0||at<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const xt=Math.min(I.scaleZoom(I.scale*Math.min(at,$)),g.maxZoom),Nt=a.P.convert(g.offset),ut=new a.P((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(d*Math.PI/180),It=Nt.add(ut).mult(I.scale/I.zoomScale(xt));return{center:I.unproject(M.add(A).div(2).sub(It)),zoom:xt,bearing:d}}fitBounds(s,h,d){return this._fitInternal(this.cameraForBounds(s,h),h,d)}fitScreenCoordinates(s,h,d,g,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(s)),this.transform.pointLocation(a.P.convert(h)),d,g),g,b)}_fitInternal(s,h,d){return s?(delete(h=a.e(s,h)).padding,h.linear?this.easeTo(h,d):this.flyTo(h,d)):this}jumpTo(s,h){this.stop();const d=this._getTransformForUpdate();let g=!1,b=!1,I=!1;return"zoom"in s&&d.zoom!==+s.zoom&&(g=!0,d.zoom=+s.zoom),s.center!==void 0&&(d.center=a.L.convert(s.center)),"bearing"in s&&d.bearing!==+s.bearing&&(b=!0,d.bearing=+s.bearing),"pitch"in s&&d.pitch!==+s.pitch&&(I=!0,d.pitch=+s.pitch),s.padding==null||d.isPaddingEqual(s.padding)||(d.padding=s.padding),this._applyUpdatedTransform(d),this.fire(new a.k("movestart",h)).fire(new a.k("move",h)),g&&this.fire(new a.k("zoomstart",h)).fire(new a.k("zoom",h)).fire(new a.k("zoomend",h)),b&&this.fire(new a.k("rotatestart",h)).fire(new a.k("rotate",h)).fire(new a.k("rotateend",h)),I&&this.fire(new a.k("pitchstart",h)).fire(new a.k("pitch",h)).fire(new a.k("pitchend",h)),this.fire(new a.k("moveend",h))}calculateCameraOptionsFromTo(s,h,d,g=0){const b=a.U.fromLngLat(s,h),I=a.U.fromLngLat(d,g),C=I.x-b.x,M=I.y-b.y,A=I.z-b.z,R=Math.hypot(C,M,A);if(R===0)throw new Error("Can't calculate camera options with same From and To");const O=Math.hypot(C,M),j=this.transform.scaleZoom(this.transform.cameraToCenterDistance/R/this.transform.tileSize),nt=180*Math.atan2(C,-M)/Math.PI;let et=180*Math.acos(O/R)/Math.PI;return et=A<0?90-et:90+et,{center:I.toLngLat(),zoom:j,pitch:et,bearing:nt}}easeTo(s,h){this._stop(!1,s.easeId),((s=a.e({offset:[0,0],duration:500,easing:a.bb},s)).animate===!1||!s.essential&&a.h.prefersReducedMotion)&&(s.duration=0);const d=this._getTransformForUpdate(),g=this.getZoom(),b=this.getBearing(),I=this.getPitch(),C=this.getPadding(),M="zoom"in s?+s.zoom:g,A="bearing"in s?this._normalizeBearing(s.bearing,b):b,R="pitch"in s?+s.pitch:I,O="padding"in s?s.padding:d.padding,j=a.P.convert(s.offset);let nt=d.centerPoint.add(j);const et=d.pointLocation(nt),at=a.L.convert(s.center||et);this._normalizeCenter(at);const $=d.project(et),xt=d.project(at).sub($),Nt=d.zoomScale(M-g);let ut,It;s.around&&(ut=a.L.convert(s.around),It=d.locationPoint(ut));const Ft={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||M!==g,this._rotating=this._rotating||b!==A,this._pitching=this._pitching||R!==I,this._padding=!d.isPaddingEqual(O),this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,Ft),this.terrain&&this._prepareElevation(at),this._ease(Bt=>{if(this._zooming&&(d.zoom=a.B.number(g,M,Bt)),this._rotating&&(d.bearing=a.B.number(b,A,Bt)),this._pitching&&(d.pitch=a.B.number(I,R,Bt)),this._padding&&(d.interpolatePadding(C,O,Bt),nt=d.centerPoint.add(j)),this.terrain&&!s.freezeElevation&&this._updateElevation(Bt),ut)d.setLocationAtPoint(ut,It);else{const Wt=d.zoomScale(d.zoom-g),ne=M>g?Math.min(2,Nt):Math.max(.5,Nt),Yt=Math.pow(ne,1-Bt),se=d.unproject($.add(xt.mult(Bt*Yt)).mult(Wt));d.setLocationAtPoint(d.renderWorldCopies?se.wrap():se,nt)}this._applyUpdatedTransform(d),this._fireMoveEvents(h)},Bt=>{this.terrain&&this._finalizeElevation(),this._afterEase(h,Bt)},s),this}_prepareEase(s,h,d={}){this._moving=!0,h||d.moving||this.fire(new a.k("movestart",s)),this._zooming&&!d.zooming&&this.fire(new a.k("zoomstart",s)),this._rotating&&!d.rotating&&this.fire(new a.k("rotatestart",s)),this._pitching&&!d.pitching&&this.fire(new a.k("pitchstart",s))}_prepareElevation(s){this._elevationCenter=s,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(s){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(s<1&&h!==this._elevationTarget){const d=this._elevationTarget-this._elevationStart;this._elevationStart+=s*(d-(h-(d*s+this._elevationStart))/(1-s)),this._elevationTarget=h}this.transform.elevation=a.B.number(this._elevationStart,this._elevationTarget,s)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(s){if(!this.transformCameraUpdate)return;const h=s.clone(),{center:d,zoom:g,pitch:b,bearing:I,elevation:C}=this.transformCameraUpdate(h);d&&(h.center=d),g!==void 0&&(h.zoom=g),b!==void 0&&(h.pitch=b),I!==void 0&&(h.bearing=I),C!==void 0&&(h.elevation=C),this.transform.apply(h)}_fireMoveEvents(s){this.fire(new a.k("move",s)),this._zooming&&this.fire(new a.k("zoom",s)),this._rotating&&this.fire(new a.k("rotate",s)),this._pitching&&this.fire(new a.k("pitch",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const d=this._zooming,g=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new a.k("zoomend",s)),g&&this.fire(new a.k("rotateend",s)),b&&this.fire(new a.k("pitchend",s)),this.fire(new a.k("moveend",s))}flyTo(s,h){if(!s.essential&&a.h.prefersReducedMotion){const Le=a.F(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Le,h)}this.stop(),s=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.bb},s);const d=this._getTransformForUpdate(),g=this.getZoom(),b=this.getBearing(),I=this.getPitch(),C=this.getPadding(),M="zoom"in s?a.ad(+s.zoom,d.minZoom,d.maxZoom):g,A="bearing"in s?this._normalizeBearing(s.bearing,b):b,R="pitch"in s?+s.pitch:I,O="padding"in s?s.padding:d.padding,j=d.zoomScale(M-g),nt=a.P.convert(s.offset);let et=d.centerPoint.add(nt);const at=d.pointLocation(et),$=a.L.convert(s.center||at);this._normalizeCenter($);const xt=d.project(at),Nt=d.project($).sub(xt);let ut=s.curve;const It=Math.max(d.width,d.height),Ft=It/j,Bt=Nt.mag();if("minZoom"in s){const Le=a.ad(Math.min(s.minZoom,g,M),d.minZoom,d.maxZoom),Yn=It/d.zoomScale(Le-g);ut=Math.sqrt(Yn/Bt*2)}const Wt=ut*ut;function ne(Le){const Yn=(Ft*Ft-It*It+(Le?-1:1)*Wt*Wt*Bt*Bt)/(2*(Le?Ft:It)*Wt*Bt);return Math.log(Math.sqrt(Yn*Yn+1)-Yn)}function Yt(Le){return(Math.exp(Le)-Math.exp(-Le))/2}function se(Le){return(Math.exp(Le)+Math.exp(-Le))/2}const Ce=ne(!1);let xn=function(Le){return se(Ce)/se(Ce+ut*Le)},fe=function(Le){return It*((se(Ce)*(Yt(Yn=Ce+ut*Le)/se(Yn))-Yt(Ce))/Wt)/Bt;var Yn},qe=(ne(!0)-Ce)/ut;if(Math.abs(Bt)<1e-6||!isFinite(qe)){if(Math.abs(It-Ft)<1e-6)return this.easeTo(s,h);const Le=Ft<It?-1:1;qe=Math.abs(Math.log(Ft/It))/ut,fe=function(){return 0},xn=function(Yn){return Math.exp(Le*ut*Yn)}}return s.duration="duration"in s?+s.duration:1e3*qe/("screenSpeed"in s?+s.screenSpeed/ut:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=b!==A,this._pitching=R!==I,this._padding=!d.isPaddingEqual(O),this._prepareEase(h,!1),this.terrain&&this._prepareElevation($),this._ease(Le=>{const Yn=Le*qe,bn=1/xn(Yn);d.zoom=Le===1?M:g+d.scaleZoom(bn),this._rotating&&(d.bearing=a.B.number(b,A,Le)),this._pitching&&(d.pitch=a.B.number(I,R,Le)),this._padding&&(d.interpolatePadding(C,O,Le),et=d.centerPoint.add(nt)),this.terrain&&!s.freezeElevation&&this._updateElevation(Le);const hn=Le===1?$:d.unproject(xt.add(Nt.mult(fe(Yn))).mult(bn));d.setLocationAtPoint(d.renderWorldCopies?hn.wrap():hn,et),this._applyUpdatedTransform(d),this._fireMoveEvents(h)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(h)},s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,h)}if(!s){const d=this.handlers;d&&d.stop(!1)}return this}_ease(s,h,d){d.animate===!1||d.duration===0?(s(1),h()):(this._easeStart=a.h.now(),this._easeOptions=d,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(s,h){s=a.b5(s,-180,180);const d=Math.abs(s-h);return Math.abs(s-360-h)<d&&(s-=360),Math.abs(s+360-h)<d&&(s+=360),s}_normalizeCenter(s){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const d=s.lng-h.center.lng;s.lng+=d>180?-360:d<-180?360:0}queryTerrainElevation(s){return this.terrain?this.terrain.getElevationForLngLatZoom(a.L.convert(s),this.transform.tileZoom)-this.transform.elevation:null}}class Uo{constructor(s={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=s}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options&&this.options.compact,this._container=x.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=x.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=x.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){x.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,h){const d=this._map._getUIString(`AttributionControl.${h}`);s.title=d,s.setAttribute("aria-label",d)}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const h=this._map.style.sourceCaches;for(const g in h){const b=h[g];if(b.used||b.usedForTerrain){const I=b.getSource();I.attribution&&s.indexOf(I.attribution)<0&&s.push(I.attribution)}}s=s.filter(g=>String(g).trim()),s.sort((g,b)=>g.length-b.length),s=s.filter((g,b)=>{for(let I=b+1;I<s.length;I++)if(s[I].indexOf(g)>=0)return!1;return!0});const d=s.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,s.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class hi{constructor(s={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const d=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&d.classList.add("maplibregl-compact"):d.classList.remove("maplibregl-compact")}},this.options=s}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=x.create("div","maplibregl-ctrl");const h=x.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){x.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class uh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){const h=this._currentlyRunning,d=h?this._queue.concat(h):this._queue;for(const g of d)if(g.id===s)return void(g.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const d of h)if(!d.cancelled&&(d.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Zp={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var tm=a.Q([{name:"a_pos3d",type:"Int16",components:3}]);class em extends a.E{constructor(s){super(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,s.usedForTerrain=!0,s.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(s,h){this.sourceCache.update(s,h),this._renderableTilesKeys=[];const d={};for(const g of s.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))d[g.key]=!0,this._renderableTilesKeys.push(g.key),this._tiles[g.key]||(g.posMatrix=new Float64Array(16),a.aS(g.posMatrix,0,a.N,0,a.N,0,1),this._tiles[g.key]=new tn(g,this.tileSize));for(const g in this._tiles)d[g]||delete this._tiles[g]}freeRtt(s){for(const h in this._tiles){const d=this._tiles[h];(!s||d.tileID.equals(s)||d.tileID.isChildOf(s)||s.isChildOf(d.tileID))&&(d.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(s=>this.getTileByID(s))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s){const h={};for(const d of this._renderableTilesKeys){const g=this._tiles[d].tileID;if(g.canonical.equals(s.canonical)){const b=s.clone();b.posMatrix=new Float64Array(16),a.aS(b.posMatrix,0,a.N,0,a.N,0,1),h[d]=b}else if(g.canonical.isChildOf(s.canonical)){const b=s.clone();b.posMatrix=new Float64Array(16);const I=g.canonical.z-s.canonical.z,C=g.canonical.x-(g.canonical.x>>I<<I),M=g.canonical.y-(g.canonical.y>>I<<I),A=a.N>>I;a.aS(b.posMatrix,0,A,0,A,0,1),a.$(b.posMatrix,b.posMatrix,[-C*A,-M*A,0]),h[d]=b}else if(s.canonical.isChildOf(g.canonical)){const b=s.clone();b.posMatrix=new Float64Array(16);const I=s.canonical.z-g.canonical.z,C=s.canonical.x-(s.canonical.x>>I<<I),M=s.canonical.y-(s.canonical.y>>I<<I),A=a.N>>I;a.aS(b.posMatrix,0,a.N,0,a.N,0,1),a.$(b.posMatrix,b.posMatrix,[C*A,M*A,0]),a.a0(b.posMatrix,b.posMatrix,[1/2**I,1/2**I,0]),h[d]=b}}return h}getSourceTile(s,h){const d=this.sourceCache._source;let g=s.overscaledZ-this.deltaZoom;if(g>d.maxzoom&&(g=d.maxzoom),g<d.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(g).key);let b=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!b||!b.dem)&&h)for(;g>=d.minzoom&&(!b||!b.dem);)b=this.sourceCache.getTileByID(s.scaledTo(g--).key);return b}tilesAfterTime(s=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=s)}}class nm{constructor(s,h,d){this.painter=s,this.sourceCache=new em(h),this.options=d,this.exaggeration=typeof d.exaggeration=="number"?d.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(s,h,d,g=a.N){var b;if(!(h>=0&&h<g&&d>=0&&d<g))return 0;const I=this.getTerrainData(s),C=(b=I.tile)===null||b===void 0?void 0:b.dem;if(!C)return 0;const M=function(et,at,$){var xt=at[0],Nt=at[1];return et[0]=$[0]*xt+$[4]*Nt+$[12],et[1]=$[1]*xt+$[5]*Nt+$[13],et}([],[h/g*a.N,d/g*a.N],I.u_terrain_matrix),A=[M[0]*C.dim,M[1]*C.dim],R=Math.floor(A[0]),O=Math.floor(A[1]),j=A[0]-R,nt=A[1]-O;return C.get(R,O)*(1-j)*(1-nt)+C.get(R+1,O)*j*(1-nt)+C.get(R,O+1)*(1-j)*nt+C.get(R+1,O+1)*j*nt}getElevationForLngLatZoom(s,h){const{tileID:d,mercatorX:g,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(s,h);return this.getElevation(d,g%a.N,b%a.N,a.N)}getElevation(s,h,d,g=a.N){return this.getDEMElevation(s,h,d,g)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const g=this.painter.context,b=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Et(g,b,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Et(g,new a.R({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.ao([])}const h=this.sourceCache.getSourceTile(s,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const g=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new Et(g,h.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),h.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const d=h&&h+h.tileID.key+s.key;if(d&&!this._demMatrixCache[d]){const g=this.sourceCache.sourceCache._source.maxzoom;let b=s.canonical.z-h.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=g?b=s.canonical.z-g:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const I=s.canonical.x-(s.canonical.x>>b<<b),C=s.canonical.y-(s.canonical.y>>b<<b),M=a.bc(new Float64Array(16),[1/(a.N<<b),1/(a.N<<b),0]);a.$(M,M,[I*a.N,C*a.N,0]),this._demMatrixCache[s.key]={matrix:M,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:d?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(s){const h=this.painter,d=h.width/devicePixelRatio,g=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===d&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Et(h.context,{width:d,height:g,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Et(h.context,{width:d,height:g,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(d,g,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,d,g))),this._fbo.colorAttachment.set(s==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,I=0;b<this._coordsTextureSize;b++)for(let C=0;C<this._coordsTextureSize;C++,I+=4)h[I+0]=255&C,h[I+1]=255&b,h[I+2]=C>>8<<4|b>>8,h[I+3]=0;const d=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),g=new Et(s,d,s.gl.RGBA,{premultiply:!1});return g.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(s){const h=new Uint8Array(4),d=this.painter.context,g=d.gl;d.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,h),d.bindFramebuffer.set(null);const b=h[0]+(h[2]>>4<<8),I=h[1]+((15&h[2])<<8),C=this.coordsIndex[255-h[3]],M=C&&this.sourceCache.getTileByID(C);if(!M)return null;const A=this._coordsTextureSize,R=(1<<M.tileID.canonical.z)*A;return new a.U(this._allowMercatorOverflow(s,(M.tileID.canonical.x*A+b)/R),(M.tileID.canonical.y*A+I)/R,this.getElevation(M.tileID,b,I,A))}getTerrainMesh(){if(this._mesh)return this._mesh;const s=this.painter.context,h=new a.bd,d=new a.b0,g=this.meshSize,b=a.N/g,I=g*g;for(let O=0;O<=g;O++)for(let j=0;j<=g;j++)h.emplaceBack(j*b,O*b,0);for(let O=0;O<I;O+=g+1)for(let j=0;j<g;j++)d.emplaceBack(j+O,g+j+O+1,g+j+O+2),d.emplaceBack(j+O,g+j+O+2,j+O+1);const C=h.length,M=C+2*(g+1);for(const O of[0,1])for(let j=0;j<=g;j++)for(const nt of[0,1])h.emplaceBack(j*b,O*a.N,nt);for(let O=0;O<2*g;O+=2)d.emplaceBack(M+O,M+O+1,M+O+3),d.emplaceBack(M+O,M+O+3,M+O+2),d.emplaceBack(C+O,C+O+3,C+O+1),d.emplaceBack(C+O,C+O+2,C+O+3);const A=h.length,R=A+2*(g+1);for(const O of[0,1])for(let j=0;j<=g;j++)for(const nt of[0,1])h.emplaceBack(O*a.N,j*b,nt);for(let O=0;O<2*g;O+=2)d.emplaceBack(A+O,A+O+1,A+O+3),d.emplaceBack(A+O,A+O+3,A+O+2),d.emplaceBack(R+O,R+O+3,R+O+1),d.emplaceBack(R+O,R+O+2,R+O+3);return this._mesh={indexBuffer:s.createIndexBuffer(d),vertexBuffer:s.createVertexBuffer(h,tm.members),segments:a.S.simpleSegment(0,0,h.length,d.length)},this._mesh}getMeshFrameDelta(s){return 2*Math.PI*a.be/Math.pow(2,s)/5}getMinTileElevationForLngLatZoom(s,h){var d;const{tileID:g}=this._getOverscaledTileIDFromLngLatZoom(s,h);return(d=this.getMinMaxElevation(g).minElevation)!==null&&d!==void 0?d:0}getMinMaxElevation(s){const h=this.getTerrainData(s).tile,d={minElevation:null,maxElevation:null};return h&&h.dem&&(d.minElevation=h.dem.min*this.exaggeration,d.maxElevation=h.dem.max*this.exaggeration),d}_getOverscaledTileIDFromLngLatZoom(s,h){const d=a.U.fromLngLat(s.wrap()),g=(1<<h)*a.N,b=d.x*g,I=d.y*g,C=Math.floor(b/a.N),M=Math.floor(I/a.N);return{tileID:new a.O(h,0,h,C,M),mercatorX:b,mercatorY:I}}_allowMercatorOverflow(s,h){const d=s.x<this.painter.width/2;let g=a.bf(h);const b=this.painter.transform.center.lng;return d&&Math.sign(g)>0&&Math.sign(b)<0||!d&&Math.sign(g)<0&&Math.sign(b)>0?(g=360*Math.sign(b)+g,a.G(g)):h}}class Yg{constructor(s,h,d){this._context=s,this._size=h,this._tileSize=d,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const s of this._objects)s.texture.destroy(),s.fbo.destroy()}_createObject(s){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),d=new Et(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return d.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(d.texture),{id:s,fbo:h,texture:d,stamp:-1,inUse:!1}}getObjectForId(s){return this._objects[s]}useObject(s){s.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>s.id!==h),this._recentlyUsed.push(s.id)}stampObject(s){s.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const s=this._createObject(this._objects.length);return this._objects.push(s),s}freeObject(s){s.inUse=!1}freeAllObjects(){for(const s of this._objects)this.freeObject(s)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(s=>!s.inUse)===!1}}const co={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class ch{constructor(s,h){this.painter=s,this.terrain=h,this.pool=new Yg(s.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(s){return this.pool.getObjectForId(s.rtt[this._stacks.length-1].id).texture}prepareForRender(s,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=s._order.filter(d=>!s._layers[d].isHidden(h)),this._coordsDescendingInv={};for(const d in s.sourceCaches){this._coordsDescendingInv[d]={};const g=s.sourceCaches[d].getVisibleCoordinates();for(const b of g){const I=this.terrain.sourceCache.getTerrainCoords(b);for(const C in I)this._coordsDescendingInv[d][C]||(this._coordsDescendingInv[d][C]=[]),this._coordsDescendingInv[d][C].push(I[C])}}this._coordsDescendingInvStr={};for(const d of s._order){const g=s._layers[d],b=g.source;if(co[g.type]&&!this._coordsDescendingInvStr[b]){this._coordsDescendingInvStr[b]={};for(const I in this._coordsDescendingInv[b])this._coordsDescendingInvStr[b][I]=this._coordsDescendingInv[b][I].map(C=>C.key).sort().join()}}for(const d of this._renderableTiles)for(const g in this._coordsDescendingInvStr){const b=this._coordsDescendingInvStr[g][d.tileID.key];b&&b!==d.rttCoords[g]&&(d.rtt=[])}}renderLayer(s){if(s.isHidden(this.painter.transform.zoom))return!1;const h=s.type,d=this.painter,g=this._renderableLayerIds[this._renderableLayerIds.length-1]===s.id;if(co[h]&&(this._prevType&&co[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(s.id),!g))return!0;if(co[this._prevType]||co[h]&&g){this._prevType=h;const b=this._stacks.length-1,I=this._stacks[b]||[];for(const C of this._renderableTiles){if(this.pool.isFull()&&(Ri(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(C),C.rtt[b]){const A=this.pool.getObjectForId(C.rtt[b].id);if(A.stamp===C.rtt[b].stamp){this.pool.useObject(A);continue}}const M=this.pool.getOrCreateFreeObject();this.pool.useObject(M),this.pool.stampObject(M),C.rtt[b]={id:M.id,stamp:M.stamp},d.context.bindFramebuffer.set(M.fbo.framebuffer),d.context.clear({color:a.aT.transparent,stencil:0}),d.currentStencilSource=void 0;for(let A=0;A<I.length;A++){const R=d.style._layers[I[A]],O=R.source?this._coordsDescendingInv[R.source][C.tileID.key]:[C.tileID];d.context.viewport.set([0,0,M.fbo.width,M.fbo.height]),d._renderTileClippingMasks(R,O),d.renderLayer(d,d.style.sourceCaches[R.source],R,O),R.source&&(C.rttCoords[R.source]=this._coordsDescendingInvStr[R.source][C.tileID.key])}}return Ri(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),co[h]}return!1}}const Ae=_,Ge={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},ac=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},Wp={showCompass:!0,showZoom:!0,visualizePitch:!1};class Xp{constructor(s,h,d=!1){this.mousedown=I=>{this.startMouse(a.e({},I,{ctrlKey:!0,preventDefault:()=>I.preventDefault()}),x.mousePos(this.element,I)),x.addEventListener(window,"mousemove",this.mousemove),x.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=I=>{this.moveMouse(I,x.mousePos(this.element,I))},this.mouseup=I=>{this.mouseRotate.dragEnd(I),this.mousePitch&&this.mousePitch.dragEnd(I),this.offTemp()},this.touchstart=I=>{I.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=x.touchPos(this.element,I.targetTouches)[0],this.startTouch(I,this._startPos),x.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.addEventListener(window,"touchend",this.touchend))},this.touchmove=I=>{I.targetTouches.length!==1?this.reset():(this._lastPos=x.touchPos(this.element,I.targetTouches)[0],this.moveTouch(I,this._lastPos))},this.touchend=I=>{I.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const g=s.dragRotate._mouseRotate.getClickTolerance(),b=s.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=fu({clickTolerance:g,enable:!0}),this.touchRotate=(({enable:I,clickTolerance:C,bearingDegreesPerPixelMoved:M=.8})=>{const A=new Hd;return new Ta({clickTolerance:C,move:(R,O)=>({bearingDelta:(O.x-R.x)*M}),moveStateManager:A,enable:I,assignEvents:ac})})({clickTolerance:g,enable:!0}),this.map=s,d&&(this.mousePitch=La({clickTolerance:b,enable:!0}),this.touchPitch=(({enable:I,clickTolerance:C,pitchDegreesPerPixelMoved:M=-.5})=>{const A=new Hd;return new Ta({clickTolerance:C,move:(R,O)=>({pitchDelta:(O.y-R.y)*M}),moveStateManager:A,enable:I,assignEvents:ac})})({clickTolerance:b,enable:!0})),x.addEventListener(h,"mousedown",this.mousedown),x.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),x.addEventListener(h,"touchcancel",this.reset)}startMouse(s,h){this.mouseRotate.dragStart(s,h),this.mousePitch&&this.mousePitch.dragStart(s,h),x.disableDrag()}startTouch(s,h){this.touchRotate.dragStart(s,h),this.touchPitch&&this.touchPitch.dragStart(s,h),x.disableDrag()}moveMouse(s,h){const d=this.map,{bearingDelta:g}=this.mouseRotate.dragMove(s,h)||{};if(g&&d.setBearing(d.getBearing()+g),this.mousePitch){const{pitchDelta:b}=this.mousePitch.dragMove(s,h)||{};b&&d.setPitch(d.getPitch()+b)}}moveTouch(s,h){const d=this.map,{bearingDelta:g}=this.touchRotate.dragMove(s,h)||{};if(g&&d.setBearing(d.getBearing()+g),this.touchPitch){const{pitchDelta:b}=this.touchPitch.dragMove(s,h)||{};b&&d.setPitch(d.getPitch()+b)}}off(){const s=this.element;x.removeEventListener(s,"mousedown",this.mousedown),x.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),x.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.removeEventListener(window,"touchend",this.touchend),x.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){x.enableDrag(),x.removeEventListener(window,"mousemove",this.mousemove),x.removeEventListener(window,"mouseup",this.mouseup),x.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.removeEventListener(window,"touchend",this.touchend)}}let Ji;function Hp(y,s,h){if(y=new a.L(y.lng,y.lat),s){const d=new a.L(y.lng-360,y.lat),g=new a.L(y.lng+360,y.lat),b=h.locationPoint(y).distSqr(s);h.locationPoint(d).distSqr(s)<b?y=d:h.locationPoint(g).distSqr(s)<b&&(y=g)}for(;Math.abs(y.lng-h.center.lng)>180;){const d=h.locationPoint(y);if(d.x>=0&&d.y>=0&&d.x<=h.width&&d.y<=h.height)break;y.lng>h.center.lng?y.lng-=360:y.lng+=360}return y}const us={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function im(y,s,h){const d=y.classList;for(const g in us)d.remove(`maplibregl-${h}-anchor-${g}`);d.add(`maplibregl-${h}-anchor-${s}`)}class Ll extends a.E{constructor(s){if(super(),this._onKeyPress=h=>{const d=h.code,g=h.charCode||h.keyCode;d!=="Space"&&d!=="Enter"&&g!==32&&g!==13||this.togglePopup()},this._onMapClick=h=>{const d=h.originalEvent.target,g=this._element;this._popup&&(d===g||g.contains(d))&&this.togglePopup()},this._update=h=>{if(!this._map)return;const d=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!d)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=Hp(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(g=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let b="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?b="rotateX(0deg)":this._pitchAlignment==="map"&&(b=`rotateX(${this._map.getPitch()}deg)`),h&&h.type!=="moveend"||(this._pos=this._pos.round()),x.setTransform(this._element,`${us[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${b} ${g}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const I=this._map.unproject(this._pos),C=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=I.distanceTo(this._lngLat)>20*C?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=h=>{if(!this._isDragging){const d=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,s&&s.element)this._element=s.element,this._offset=a.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=x.create("div"),this._element.setAttribute("aria-label","Map marker");const h=x.createNS("http://www.w3.org/2000/svg","svg"),d=41,g=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${d}px`),h.setAttributeNS(null,"width",`${g}px`),h.setAttributeNS(null,"viewBox",`0 0 ${g} ${d}`);const b=x.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const I=x.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");const C=x.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"transform","translate(3.0, 29.0)"),C.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const xt of M){const Nt=x.createNS("http://www.w3.org/2000/svg","ellipse");Nt.setAttributeNS(null,"opacity","0.04"),Nt.setAttributeNS(null,"cx","10.5"),Nt.setAttributeNS(null,"cy","5.80029008"),Nt.setAttributeNS(null,"rx",xt.rx),Nt.setAttributeNS(null,"ry",xt.ry),C.appendChild(Nt)}const A=x.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const R=x.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(R);const O=x.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"opacity","0.25"),O.setAttributeNS(null,"fill","#000000");const j=x.createNS("http://www.w3.org/2000/svg","path");j.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),O.appendChild(j);const nt=x.createNS("http://www.w3.org/2000/svg","g");nt.setAttributeNS(null,"transform","translate(6.0, 7.0)"),nt.setAttributeNS(null,"fill","#FFFFFF");const et=x.createNS("http://www.w3.org/2000/svg","g");et.setAttributeNS(null,"transform","translate(8.0, 8.0)");const at=x.createNS("http://www.w3.org/2000/svg","circle");at.setAttributeNS(null,"fill","#000000"),at.setAttributeNS(null,"opacity","0.25"),at.setAttributeNS(null,"cx","5.5"),at.setAttributeNS(null,"cy","5.5"),at.setAttributeNS(null,"r","5.4999962");const $=x.createNS("http://www.w3.org/2000/svg","circle");$.setAttributeNS(null,"fill","#FFFFFF"),$.setAttributeNS(null,"cx","5.5"),$.setAttributeNS(null,"cy","5.5"),$.setAttributeNS(null,"r","5.4999962"),et.appendChild(at),et.appendChild($),I.appendChild(C),I.appendChild(A),I.appendChild(O),I.appendChild(nt),I.appendChild(et),h.appendChild(I),h.setAttributeNS(null,"height",d*this._scale+"px"),h.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(h),this._offset=a.P.convert(s&&s.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),im(this._element,this._anchor,"marker"),s&&s.className)for(const h of s.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(s){return this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),x.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=a.L.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const g=Math.abs(13.5)/Math.SQRT2;s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?s.remove():s.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(s){return this._offset=a.P.convert(s),this._update(),this}addClassName(s){this._element.classList.add(s)}removeClassName(s){this._element.classList.remove(s)}toggleClassName(s){return this._element.classList.toggle(s)}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Oi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ii=0,mu=!1;const lc={maxWidth:100,unit:"metric"};function uc(y,s,h){const d=h&&h.maxWidth||100,g=y._container.clientHeight/2,b=y.unproject([0,g]),I=y.unproject([d,g]),C=b.distanceTo(I);if(h&&h.unit==="imperial"){const M=3.2808*C;M>5280?Ml(s,d,M/5280,y._getUIString("ScaleControl.Miles")):Ml(s,d,M,y._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Ml(s,d,C/1852,y._getUIString("ScaleControl.NauticalMiles")):C>=1e3?Ml(s,d,C/1e3,y._getUIString("ScaleControl.Kilometers")):Ml(s,d,C,y._getUIString("ScaleControl.Meters"))}function Ml(y,s,h,d){const g=function(b){const I=Math.pow(10,`${Math.floor(b)}`.length-1);let C=b/I;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(M){const A=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*A)/A}(C),I*C}(h);y.style.width=s*(g/h)+"px",y.innerHTML=`${g}&nbsp;${d}`}const Yp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Kp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function gu(y){if(y){if(typeof y=="number"){const s=Math.round(Math.abs(y)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,y),"top-left":new a.P(s,s),"top-right":new a.P(-s,s),bottom:new a.P(0,-y),"bottom-left":new a.P(s,-s),"bottom-right":new a.P(-s,-s),left:new a.P(y,0),right:new a.P(-y,0)}}if(y instanceof a.P||Array.isArray(y)){const s=a.P.convert(y);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:a.P.convert(y.center||[0,0]),top:a.P.convert(y.top||[0,0]),"top-left":a.P.convert(y["top-left"]||[0,0]),"top-right":a.P.convert(y["top-right"]||[0,0]),bottom:a.P.convert(y.bottom||[0,0]),"bottom-left":a.P.convert(y["bottom-left"]||[0,0]),"bottom-right":a.P.convert(y["bottom-right"]||[0,0]),left:a.P.convert(y.left||[0,0]),right:a.P.convert(y.right||[0,0])}}return gu(new a.P(0,0))}const Jp={extend:(y,...s)=>a.e(y,...s),run(y){y()},logToElement(y,s=!1,h="log"){const d=window.document.getElementById(h);d&&(s&&(d.innerHTML=""),d.innerHTML+=`<br>${y}`)}},Qp=_;class Bn{static get version(){return Qp}static get workerCount(){return uo.workerCount}static set workerCount(s){uo.workerCount=s}static get maxParallelImageRequests(){return a.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(s){a.c.MAX_PARALLEL_IMAGE_REQUESTS=s}static get workerUrl(){return a.c.WORKER_URL}static set workerUrl(s){a.c.WORKER_URL=s}static addProtocol(s,h){a.c.REGISTERED_PROTOCOLS[s]=h}static removeProtocol(s){delete a.c.REGISTERED_PROTOCOLS[s]}}return Bn.Map=class extends $d{constructor(y){if(a.bg.mark(a.bh.create),(y=a.e({},Ge,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new oh(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),{bearingSnap:y.bearingSnap}),this._cooperativeGesturesOnWheel=s=>{this._onCooperativeGesture(s,s[this._metaKey],1)},this._contextLost=s=>{s.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._cooperativeGestures=y.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new uh,this._controls=[],this._mapId=a.a2(),this._locale=a.e({},Zp,y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this._imageQueueHandle=W.addThrottleControl(()=>this.isMoving()),this._requestManager=new U(y.transformRequest),typeof y.container=="string"){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const h=Tl(d=>{this._trackResize&&!this._removed&&this.resize(d)._update()},50);this._resizeObserver=new ResizeObserver(d=>{s?h(d):s=!0}),this._resizeObserver.observe(this._container)}this.handlers=new jp(this,y),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=y.hash&&new nc(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,a.e({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new Uo({customAttribution:y.customAttribution})),y.maplibreLogo&&this.addControl(new hi,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new a.k(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new a.k(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new a.k("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(y,s){if(s===void 0&&(s=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=y.onAdd(this);this._controls.push(y);const d=this._controlPositions[s];return s.indexOf("bottom")!==-1?d.insertBefore(h,d.firstChild):d.appendChild(h),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(y);return s>-1&&this._controls.splice(s,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,s,h,d){return d==null&&this.terrain&&(d=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,s,h,d)}resize(y){var s;const h=this._containerDimensions(),d=h[0],g=h[1],b=this._getClampedPixelRatio(d,g);if(this._resizeCanvas(d,g,b),this.painter.resize(d,g,b),this.painter.overLimit()){const C=this.painter.context.gl;this._maxCanvasSize=[C.drawingBufferWidth,C.drawingBufferHeight];const M=this._getClampedPixelRatio(d,g);this._resizeCanvas(d,g,M),this.painter.resize(d,g,M)}this.transform.resize(d,g),(s=this._requestedCameraState)===null||s===void 0||s.resize(d,g);const I=!this._moving;return I&&(this.stop(),this.fire(new a.k("movestart",y)).fire(new a.k("move",y))),this.fire(new a.k("resize",y)),I&&this.fire(new a.k("moveend",y)),this}_getClampedPixelRatio(y,s){const{0:h,1:d}=this._maxCanvasSize,g=this.getPixelRatio(),b=y*g,I=s*g;return Math.min(b>h?h/b:1,I>d?d/I:1)*g}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(Ue.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(y){return this._cooperativeGestures=y,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(y){return this.transform.locationPoint(a.L.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(a.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,s,h){if(y==="mouseenter"||y==="mouseover"){let d=!1;return{layer:s,listener:h,delegates:{mousemove:b=>{const I=this.getLayer(s)?this.queryRenderedFeatures(b.point,{layers:[s]}):[];I.length?d||(d=!0,h.call(this,new Vo(y,this,b.originalEvent,{features:I}))):d=!1},mouseout:()=>{d=!1}}}}if(y==="mouseleave"||y==="mouseout"){let d=!1;return{layer:s,listener:h,delegates:{mousemove:I=>{(this.getLayer(s)?this.queryRenderedFeatures(I.point,{layers:[s]}):[]).length?d=!0:d&&(d=!1,h.call(this,new Vo(y,this,I.originalEvent)))},mouseout:I=>{d&&(d=!1,h.call(this,new Vo(y,this,I.originalEvent)))}}}}{const d=g=>{const b=this.getLayer(s)?this.queryRenderedFeatures(g.point,{layers:[s]}):[];b.length&&(g.features=b,h.call(this,g),delete g.features)};return{layer:s,listener:h,delegates:{[y]:d}}}}on(y,s,h){if(h===void 0)return super.on(y,s);const d=this._createDelegatedListener(y,s,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(d);for(const g in d.delegates)this.on(g,d.delegates[g]);return this}once(y,s,h){if(h===void 0)return super.once(y,s);const d=this._createDelegatedListener(y,s,h);for(const g in d.delegates)this.once(g,d.delegates[g]);return this}off(y,s,h){return h===void 0?super.off(y,s):(this._delegatedListeners&&this._delegatedListeners[y]&&(d=>{const g=this._delegatedListeners[y];for(let b=0;b<g.length;b++){const I=g[b];if(I.layer===s&&I.listener===h){for(const C in I.delegates)this.off(C,I.delegates[C]);return g.splice(b,1),this}}})(),this)}queryRenderedFeatures(y,s){if(!this.style)return[];let h;const d=y instanceof a.P||Array.isArray(y),g=d?y:[[0,0],[this.transform.width,this.transform.height]];if(s=s||(d?{}:y)||{},g instanceof a.P||typeof g[0]=="number")h=[a.P.convert(g)];else{const b=a.P.convert(g[0]),I=a.P.convert(g[1]);h=[b,new a.P(I.x,b.y),I,new a.P(b.x,I.y),b]}return this.style.queryRenderedFeatures(h,s,this.transform)}querySourceFeatures(y,s){return this.style.querySourceFeatures(y,s)}setStyle(y,s){return(s=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(y,s))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const s=this._locale[y];if(s==null)throw new Error(`Missing UI string '${y}'`);return s}_updateStyle(y,s){if(s.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,s));const h=this.style&&s.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new kr(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,s,h):this.style.loadJSON(y,s,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new kr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,s){if(typeof y=="string"){const h=this._requestManager.transformRequest(y,Q.Style);a.f(h,(d,g)=>{d?this.fire(new a.j(d)):g&&this._updateDiff(g,s)})}else typeof y=="object"&&this._updateDiff(y,s)}_updateDiff(y,s){try{this.style.setState(y,s)&&this._update(!0)}catch(h){a.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(y,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(y,s){return this._lazyInitEmptyStyle(),this.style.addSource(y,s),this._update(!0)}isSourceLoaded(y){const s=this.style&&this.style.sourceCaches[y];if(s!==void 0)return s.loaded();this.fire(new a.j(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const s=this.style.sourceCaches[y.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);for(const h in this.style._layers){const d=this.style._layers[h];d.type==="hillshade"&&d.source===y.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new nm(this.painter,s,y),this.painter.renderToTexture=new ch(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==y.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:y})),this}getTerrain(){var y,s;return(s=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&s!==void 0?s:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const s in y){const h=y[s]._tiles;for(const d in h){const g=h[d];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}addSourceType(y,s,h){return this._lazyInitEmptyStyle(),this.style.addSourceType(y,s,h)}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,s,h={}){const{pixelRatio:d=1,sdf:g=!1,stretchX:b,stretchY:I,content:C}=h;if(this._lazyInitEmptyStyle(),!(s instanceof HTMLImageElement||a.a(s))){if(s.width===void 0||s.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:M,height:A,data:R}=s,O=s;return this.style.addImage(y,{data:new a.R({width:M,height:A},new Uint8Array(R)),pixelRatio:d,stretchX:b,stretchY:I,content:C,sdf:g,version:0,userImage:O}),O.onAdd&&O.onAdd(this,y),this}}{const{width:M,height:A,data:R}=a.h.getImageData(s);this.style.addImage(y,{data:new a.R({width:M,height:A},R),pixelRatio:d,stretchX:b,stretchY:I,content:C,sdf:g,version:0})}}updateImage(y,s){const h=this.style.getImage(y);if(!h)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=s instanceof HTMLImageElement||a.a(s)?a.h.getImageData(s):s,{width:g,height:b,data:I}=d;if(g===void 0||b===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==h.data.width||b!==h.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const C=!(s instanceof HTMLImageElement||a.a(s));return h.data.replace(I,C),this.style.updateImage(y,h),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y,s){W.getImage(this._requestManager.transformRequest(y,Q.Image),s)}listImages(){return this.style.listImages()}addLayer(y,s){return this._lazyInitEmptyStyle(),this.style.addLayer(y,s),this._update(!0)}moveLayer(y,s){return this.style.moveLayer(y,s),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,s,h){return this.style.setLayerZoomRange(y,s,h),this._update(!0)}setFilter(y,s,h={}){return this.style.setFilter(y,s,h),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,s,h,d={}){return this.style.setPaintProperty(y,s,h,d),this._update(!0)}getPaintProperty(y,s){return this.style.getPaintProperty(y,s)}setLayoutProperty(y,s,h,d={}){return this.style.setLayoutProperty(y,s,h,d),this._update(!0)}getLayoutProperty(y,s){return this.style.getLayoutProperty(y,s)}setGlyphs(y,s={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,s),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,s,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,s,h,d=>{d||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,s={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,s,h=>{h||this._update(!0)}),this}setLight(y,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,s),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(y,s){return this.style.setFeatureState(y,s),this._update()}removeFeatureState(y,s){return this.style.removeFeatureState(y,s),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,s=0;return this._container&&(y=this._container.clientWidth||400,s=this._container.clientHeight||300),[y,s]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const s=this._canvasContainer=x.create("div","maplibregl-canvas-container",y);this._interactive&&s.classList.add("maplibregl-interactive"),this._canvas=x.create("canvas","maplibregl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),d=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],d);const g=this._controlContainer=x.create("div","maplibregl-control-container",y),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(I=>{b[I]=x.create("div",`maplibregl-ctrl-${I} `,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=x.create("div","maplibregl-cooperative-gesture-screen",this._container);let y=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(y=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${y}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){x.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(y,s,h){this._canvas.width=Math.floor(h*y),this._canvas.height=Math.floor(h*s),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let s=null;this._canvas.addEventListener("webglcontextcreationerror",d=>{s={requestedAttributes:y},d&&(s.statusMessage=d.statusMessage,s.type=d.type)},{once:!0});const h=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!h){const d="Failed to initialize WebGL";throw s?(s.message=d,new Error(JSON.stringify(s))):new Error(d)}this.painter=new Cl(h,this.transform),S.testSupport(h)}_onCooperativeGesture(y,s,h){return!s&&h<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const s=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const g=this.transform.zoom,b=a.h.now();this.style.zoomHistory.update(g,b);const I=new a.a8(g,{now:b,fadeDuration:s,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),C=I.crossFadingFactor();C===1&&C===this._crossFadingFactor||(h=!0,this._crossFadingFactor=C),this.style.update(I)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bg.mark(a.bh.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,a.bg.mark(a.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),W.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const s=this.painter.context.gl.getExtension("WEBGL_lose_context");s&&s.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),x.remove(this._canvasContainer),x.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),a.bg.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=a.h.frame(y=>{a.bg.frame(y),this._frame=null,this._render(y)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return Ae}getCameraTargetElevation(){return this.transform.elevation}},Bn.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const s=this._map.getZoom(),h=s===this._map.getMaxZoom(),d=s===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())},this._rotateCompassArrow=()=>{const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=s},this._setButtonTitle=(s,h)=>{const d=this._map._getUIString(`NavigationControl.${h}`);s.title=d,s.setAttribute("aria-label",d)},this.options=a.e({},Wp,y),this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),x.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),x.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=x.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Xp(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){x.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,s){const h=x.create("button",y,this._container);return h.type="button",h.addEventListener("click",s),h}},Bn.GeolocateControl=class extends a.E{constructor(y){super(),this._onSuccess=s=>{if(this._map){if(this._isOutOfMapMaxBounds(s))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",s)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=s,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(s),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(s),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",s)),this._finish()}},this._updateCamera=s=>{const h=new a.L(s.coords.longitude,s.coords.latitude),d=s.coords.accuracy,g=this._map.getBearing(),b=a.e({bearing:g},this.options.fitBoundsOptions),I=Ue.fromLngLat(h,d);this._map.fitBounds(I,b,{geolocateSource:!0})},this._updateMarker=s=>{if(s){const h=new a.L(s.coords.longitude,s.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=s.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=s=>{if(this._map){if(this.options.trackUserLocation)if(s.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(s.code===3&&mu)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",s)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=s=>{if(this._map){if(this._container.addEventListener("contextmenu",h=>h.preventDefault()),this._geolocateButton=x.create("button","maplibregl-ctrl-geolocate",this._container),x.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",s===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=x.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ll({element:this._dotElement}),this._circleElement=x.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ll({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")))})}},this.options=a.e({},Oi,y)}onAdd(y){return this._map=y,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(s,h=!1){Ji===void 0||h?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(d=>{Ji=d.state!=="denied",s(Ji)}).catch(()=>{Ji=!!window.navigator.geolocation,s(Ji)}):(Ji=!!window.navigator.geolocation,s(Ji)):s(Ji)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),x.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ii=0,mu=!1}_isOutOfMapMaxBounds(y){const s=this._map.getMaxBounds(),h=y.coords;return s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),s=y.getSouthEast(),h=y.getNorthEast(),d=s.distanceTo(h),g=Math.ceil(this._accuracy/(d/this._map._container.clientHeight)*2);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ii--,mu=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ii++,Ii>1?(y={maximumAge:6e5,timeout:0},mu=!0):(y=this.options.positionOptions,mu=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Bn.AttributionControl=Uo,Bn.LogoControl=hi,Bn.ScaleControl=class{constructor(y){this._onMove=()=>{uc(this._map,this._container,this.options)},this.setUnit=s=>{this.options.unit=s,uc(this._map,this._container,this.options)},this.options=a.e({},lc,y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){x.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Bn.FullscreenControl=class extends a.E{constructor(y={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){x.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=x.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);x.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Bn.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=y}onAdd(y){return this._map=y,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=x.create("button","maplibregl-ctrl-terrain",this._container),x.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){x.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Bn.Popup=class extends a.E{constructor(y){super(),this.remove=()=>(this._content&&x.remove(this._content),this._container&&(x.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new a.k("close")),this),this._onMouseUp=s=>{this._update(s.point)},this._onMouseMove=s=>{this._update(s.point)},this._onDrag=s=>{this._update(s.point)},this._update=s=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=x.create("div","maplibregl-popup",this._map.getContainer()),this._tip=x.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const I of this.options.className.split(" "))this._container.classList.add(I);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Hp(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!s)return;const h=this._pos=this._trackPointer&&s?s:this._map.project(this._lngLat);let d=this.options.anchor;const g=gu(this.options.offset);if(!d){const I=this._container.offsetWidth,C=this._container.offsetHeight;let M;M=h.y+g.bottom.y<C?["top"]:h.y>this._map.transform.height-C?["bottom"]:[],h.x<I/2?M.push("left"):h.x>this._map.transform.width-I/2&&M.push("right"),d=M.length===0?"bottom":M.join("-")}const b=h.add(g[d]).round();x.setTransform(this._container,`${us[d]} translate(${b.x}px,${b.y}px)`),im(this._container,d,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(Yp),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=a.L.convert(y),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const s=document.createDocumentFragment(),h=document.createElement("body");let d;for(h.innerHTML=y;d=h.firstChild,d;)s.appendChild(d);return this.setDOMContent(s)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=x.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){this._container&&this._container.classList.add(y)}removeClassName(y){this._container&&this._container.classList.remove(y)}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}_createCloseButton(){this.options.closeButton&&(this._closeButton=x.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Kp);y&&y.focus()}},Bn.Marker=Ll,Bn.Style=kr,Bn.LngLat=a.L,Bn.LngLatBounds=Ue,Bn.Point=a.P,Bn.MercatorCoordinate=a.U,Bn.Evented=a.E,Bn.AJAXError=a.bi,Bn.config=a.c,Bn.CanvasSource=Ai,Bn.GeoJSONSource=Be,Bn.ImageSource=Un,Bn.RasterDEMTileSource=re,Bn.RasterTileSource=Zn,Bn.VectorTileSource=Jn,Bn.VideoSource=ur,Bn.setRTLTextPlugin=a.bj,Bn.getRTLTextPluginStatus=a.bk,Bn.prewarm=function(){ii().acquire(en)},Bn.clearPrewarmedResources=function(){const y=Ni;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(en),Ni=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},Jp.extend(Bn,{isSafari:a.ac,getPerformanceMetrics:a.bg.getPerformanceMetrics}),Bn});var p=r;return p})})(Zb);var fg=Zb.exports;const Ps=qb(fg);function Rv(e){let t;return n=>{if(n)for(let i in n){let r=t==null?void 0:t[i],u=n[i];r!==u&&e(i,u,r)}else if(t)for(let i in t)e(i,void 0,t[i]);t=n}}function iE(e,...t){let n=[e];for(let i of t)if(i)Array.isArray(i)&&i[0]===e?n.push(...i.slice(1)):n.push(i);else continue;if(n.length!==1)return n.length===2?n[1]:n}function rE(e){return e===!0?["has","point_count"]:e===!1?["!",["has","point_count"]]:void 0}function ey(e,t){return["case",["boolean",["feature-state","hover"],!1],t,e]}var Xm=oE;function oE(e){var t,n,i;if(e){if(Array.isArray(e)){for(t=[],n=e.length,i=0;i<n;i++){var r=e[i];r!=null&&t.push(r)}return t}if(typeof e=="object"){t={};var u=Object.keys(e);for(n=u.length,i=0;i<n;i++){var p=u[i],a=e[p];a!=null&&(t[p]=a)}return t}}}function Ov(e){let t=e[0],n,i,r=zv(e);return{c(){r.c(),n=bs()},m(u,p){r.m(u,p),Ot(u,n,p),i=!0},p(u,p){p[0]&1&&rn(t,t=u[0])?(Bi(),At(r,1,1,Oe),Vi(),r=zv(u),r.c(),Ct(r,1),r.m(n.parentNode,n)):r.p(u,p)},i(u){i||(Ct(r),i=!0)},o(u){At(r),i=!1},d(u){u&&Rt(n),r.d(u)}}}function zv(e){let t;const n=e[36].default,i=Vr(n,e,e[35],null);return{c(){i&&i.c()},m(r,u){i&&i.m(r,u),t=!0},p(r,u){i&&i.p&&(!t||u[1]&16)&&Gr(i,n,r,r[35],t?Ur(n,r[35],u,null):qr(r[35]),null)},i(r){t||(Ct(i,r),t=!0)},o(r){At(i,r),t=!1},d(r){i&&i.d(r)}}}function sE(e){let t,n,i=e[0]&&Ov(e);return{c(){i&&i.c(),t=bs()},m(r,u){i&&i.m(r,u),Ot(r,t,u),n=!0},p(r,u){r[0]?i?(i.p(r,u),u[0]&1&&Ct(i,1)):(i=Ov(r),i.c(),Ct(i,1),i.m(t.parentNode,t)):i&&(Bi(),At(i,1,1,()=>{i=null}),Vi())},i(r){n||(Ct(i),n=!0)},o(r){At(i),n=!1},d(r){r&&Rt(t),i&&i.d(r)}}}function aE(e,t,n){let i,r,u,p,a,_,x,S,L,k,D,F,{$$slots:K={},$$scope:W}=t,{id:Q=np("layer")}=t,{source:U=void 0}=t,{sourceLayer:X=void 0}=t,{beforeId:Y=void 0}=t,{beforeLayerType:pt=void 0}=t,{type:gt}=t,{paint:ct=void 0}=t,{layout:ht=void 0}=t,{filter:rt=void 0}=t,{applyToClusters:Et=void 0}=t,{minzoom:mt=void 0}=t,{maxzoom:dt=void 0}=t,{manageHoverState:Jt=!1}=t,{hovered:kt=null}=t,{interactive:Gt=!0}=t,{hoverCursor:Kt=void 0}=t,{eventsIfTopMost:be=!1}=t;const ce=ep(),{map:$e,source:jn,self:Ze,minzoom:ze,maxzoom:Ue,eventTopMost:dn,layerInfo:Jn}=tE();Ee(e,$e,wt=>n(31,L=wt)),Ee(e,jn,wt=>n(32,k=wt)),Ee(e,Ze,wt=>n(0,S=wt)),Ee(e,ze,wt=>n(34,F=wt)),Ee(e,Ue,wt=>n(33,D=wt)),Ds(()=>{S&&L&&(Jn.delete(S),L==null||L.removeLayer(S))});let Zn;function re(wt){var On,tn;if(!Gt||!S||!L||be&&dn(wt)!==S)return;let De=wt.features??[],Ve=(tn=(On=De[0])==null?void 0:On.properties)==null?void 0:tn.cluster_id,ki={event:wt,map:L,clusterId:Ve,layer:S,source:a,features:De};ce(wt.type,ki)}function Be(wt){var On,tn;if(!Gt||!S||!L||be&&dn(wt)!==S)return;Kt&&(L.getCanvas().style.cursor=Kt);let De=wt.features??[];n(6,kt=De[0]??null);let Ve=(tn=(On=De[0])==null?void 0:On.properties)==null?void 0:tn.cluster_id;ce("mouseenter",{event:wt,map:L,clusterId:Ve,layer:S,source:a,features:De})}function fn(wt){var On,tn,Gn;if(!Gt||!L)return;if(be&&dn(wt)!==S){n(6,kt=null),Jt&&Zn!==void 0&&(L==null||L.setFeatureState({source:a,sourceLayer:X,id:Zn},{hover:!1}),Zn=void 0);return}L.getCanvas().style.cursor=Kt;let De=wt.features??[],Ve=(tn=(On=De[0])==null?void 0:On.properties)==null?void 0:tn.cluster_id,ki=(Gn=De[0])==null?void 0:Gn.id;ki!==Zn&&(Jt&&(Zn!==void 0&&(L==null||L.setFeatureState({source:a,id:Zn,sourceLayer:X},{hover:!1})),L==null||L.setFeatureState({source:a,id:ki,sourceLayer:X},{hover:!0})),Zn=ki,n(6,kt=De[0]??null)),ce("mousemove",{event:wt,map:L,clusterId:Ve,layer:S,source:a,features:De})}function Un(wt){if(!(!Gt||!S||!L)){if(Kt&&(L.getCanvas().style.cursor=""),n(6,kt=null),Jt&&Zn!==void 0){const De={source:a,id:Zn,sourceLayer:X};L==null||L.setFeatureState(De,{hover:!1}),Zn=void 0}ce("mouseleave",{map:L,layer:S,source:a})}}let ur=!0;function Ai(wt){L&&(L.off("click",wt,re),L.off("dblclick",wt,re),L.off("contextmenu",wt,re),L.off("mouseenter",wt,Be),L.off("mousemove",wt,fn),L.off("mouseleave",wt,Un))}return Ds(()=>{L&&S&&Ai(S)}),e.$$set=wt=>{"id"in wt&&n(7,Q=wt.id),"source"in wt&&n(8,U=wt.source),"sourceLayer"in wt&&n(9,X=wt.sourceLayer),"beforeId"in wt&&n(10,Y=wt.beforeId),"beforeLayerType"in wt&&n(11,pt=wt.beforeLayerType),"type"in wt&&n(12,gt=wt.type),"paint"in wt&&n(13,ct=wt.paint),"layout"in wt&&n(14,ht=wt.layout),"filter"in wt&&n(15,rt=wt.filter),"applyToClusters"in wt&&n(16,Et=wt.applyToClusters),"minzoom"in wt&&n(17,mt=wt.minzoom),"maxzoom"in wt&&n(18,dt=wt.maxzoom),"manageHoverState"in wt&&n(19,Jt=wt.manageHoverState),"hovered"in wt&&n(6,kt=wt.hovered),"interactive"in wt&&n(20,Gt=wt.interactive),"hoverCursor"in wt&&n(21,Kt=wt.hoverCursor),"eventsIfTopMost"in wt&&n(22,be=wt.eventsIfTopMost),"$$scope"in wt&&n(35,W=wt.$$scope)},e.$$.update=()=>{if(e.$$.dirty[0]&65536&&n(30,i=rE(Et)),e.$$.dirty[0]&1073774592&&n(24,r=iE("all",i,rt)),e.$$.dirty[0]&131072|e.$$.dirty[1]&8&&n(26,u=mt??F),e.$$.dirty[0]&262144|e.$$.dirty[1]&4&&n(25,p=dt??D),e.$$.dirty[0]&256|e.$$.dirty[1]&2&&n(29,a=U||k),e.$$.dirty[0]&654343809|e.$$.dirty[1]&1&&L&&S!==Q&&a){S&&(Ai(S),Jn.delete(S));let wt=Y;if(!Y&&pt){let De=L.getStyle().layers,Ve=typeof pt=="function"?pt:On=>On.type===pt,ki=De==null?void 0:De.find(Ve);ki&&(wt=ki.id)}mn(Ze,S=Q,S),L.addLayer(Xm({id:S,type:gt,source:a,"source-layer":X,filter:r,paint:ct,layout:ht,minzoom:u,maxzoom:p}),wt),n(23,ur=!0),L.on("click",S,re),L.on("dblclick",S,re),L.on("contextmenu",S,re),L.on("mouseenter",S,Be),L.on("mousemove",S,fn),L.on("mouseleave",S,Un)}e.$$.dirty[0]&1048577&&S&&Jn.set(S,{interactive:Gt}),e.$$.dirty[0]&1|e.$$.dirty[1]&1&&n(28,_=S?Rv((wt,De)=>L==null?void 0:L.setPaintProperty(S,wt,De)):void 0),e.$$.dirty[0]&1|e.$$.dirty[1]&1&&n(27,x=S?Rv((wt,De)=>L==null?void 0:L.setLayoutProperty(S,wt,De)):void 0),e.$$.dirty[0]&268443648&&(_==null||_(ct)),e.$$.dirty[0]&134234112&&(x==null||x(ht)),e.$$.dirty[0]&100663297|e.$$.dirty[1]&1&&S&&(L==null||L.setLayerZoomRange(S,u,p)),e.$$.dirty[0]&25165825|e.$$.dirty[1]&1&&S&&(ur?n(23,ur=!1):L==null||L.setFilter(S,r))},[S,$e,jn,Ze,ze,Ue,kt,Q,U,X,Y,pt,gt,ct,ht,rt,Et,mt,dt,Jt,Gt,Kt,be,ur,r,p,u,x,_,a,i,L,k,D,F,W,K]}class dg extends cn{constructor(t){super(),un(this,t,aE,sE,rn,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function lE(e){let t;const n=e[16].default,i=Vr(n,e,e[24],null);return{c(){i&&i.c()},m(r,u){i&&i.m(r,u),t=!0},p(r,u){i&&i.p&&(!t||u&16777216)&&Gr(i,n,r,r[24],t?Ur(n,r[24],u,null):qr(r[24]),null)},i(r){t||(Ct(i,r),t=!0)},o(r){At(i,r),t=!1},d(r){i&&i.d(r)}}}function uE(e){let t,n,i;function r(p){e[17](p)}let u={id:e[1],type:"circle",source:e[2],sourceLayer:e[3],beforeId:e[4],beforeLayerType:e[5],paint:e[6],layout:e[7],filter:e[8],applyToClusters:e[9],minzoom:e[10],maxzoom:e[11],hoverCursor:e[12],manageHoverState:e[13],eventsIfTopMost:e[14],interactive:e[15],$$slots:{default:[lE]},$$scope:{ctx:e}};return e[0]!==void 0&&(u.hovered=e[0]),t=new dg({props:u}),yr.push(()=>Du(t,"hovered",r)),t.$on("click",e[18]),t.$on("dblclick",e[19]),t.$on("contextmenu",e[20]),t.$on("mouseenter",e[21]),t.$on("mousemove",e[22]),t.$on("mouseleave",e[23]),{c(){ee(t.$$.fragment)},m(p,a){Qt(t,p,a),i=!0},p(p,[a]){const _={};a&2&&(_.id=p[1]),a&4&&(_.source=p[2]),a&8&&(_.sourceLayer=p[3]),a&16&&(_.beforeId=p[4]),a&32&&(_.beforeLayerType=p[5]),a&64&&(_.paint=p[6]),a&128&&(_.layout=p[7]),a&256&&(_.filter=p[8]),a&512&&(_.applyToClusters=p[9]),a&1024&&(_.minzoom=p[10]),a&2048&&(_.maxzoom=p[11]),a&4096&&(_.hoverCursor=p[12]),a&8192&&(_.manageHoverState=p[13]),a&16384&&(_.eventsIfTopMost=p[14]),a&32768&&(_.interactive=p[15]),a&16777216&&(_.$$scope={dirty:a,ctx:p}),!n&&a&1&&(n=!0,_.hovered=p[0],Nu(()=>n=!1)),t.$set(_)},i(p){i||(Ct(t.$$.fragment,p),i=!0)},o(p){At(t.$$.fragment,p),i=!1},d(p){$t(t,p)}}}function cE(e,t,n){let{$$slots:i={},$$scope:r}=t,{id:u=np("circle")}=t,{source:p=void 0}=t,{sourceLayer:a=void 0}=t,{beforeId:_=void 0}=t,{beforeLayerType:x=void 0}=t,{paint:S}=t,{layout:L=void 0}=t,{filter:k=void 0}=t,{applyToClusters:D=void 0}=t,{minzoom:F=void 0}=t,{maxzoom:K=void 0}=t,{hoverCursor:W=void 0}=t,{manageHoverState:Q=!1}=t,{hovered:U=null}=t,{eventsIfTopMost:X=!1}=t,{interactive:Y=!0}=t;function pt(dt){U=dt,n(0,U)}function gt(dt){ui.call(this,e,dt)}function ct(dt){ui.call(this,e,dt)}function ht(dt){ui.call(this,e,dt)}function rt(dt){ui.call(this,e,dt)}function Et(dt){ui.call(this,e,dt)}function mt(dt){ui.call(this,e,dt)}return e.$$set=dt=>{"id"in dt&&n(1,u=dt.id),"source"in dt&&n(2,p=dt.source),"sourceLayer"in dt&&n(3,a=dt.sourceLayer),"beforeId"in dt&&n(4,_=dt.beforeId),"beforeLayerType"in dt&&n(5,x=dt.beforeLayerType),"paint"in dt&&n(6,S=dt.paint),"layout"in dt&&n(7,L=dt.layout),"filter"in dt&&n(8,k=dt.filter),"applyToClusters"in dt&&n(9,D=dt.applyToClusters),"minzoom"in dt&&n(10,F=dt.minzoom),"maxzoom"in dt&&n(11,K=dt.maxzoom),"hoverCursor"in dt&&n(12,W=dt.hoverCursor),"manageHoverState"in dt&&n(13,Q=dt.manageHoverState),"hovered"in dt&&n(0,U=dt.hovered),"eventsIfTopMost"in dt&&n(14,X=dt.eventsIfTopMost),"interactive"in dt&&n(15,Y=dt.interactive),"$$scope"in dt&&n(24,r=dt.$$scope)},[U,u,p,a,_,x,S,L,k,D,F,K,W,Q,X,Y,i,pt,gt,ct,ht,rt,Et,mt,r]}class cd extends cn{constructor(t){super(),un(this,t,cE,uE,rn,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function hE(e){let t;const n=e[15].default,i=Vr(n,e,e[23],null);return{c(){i&&i.c()},m(r,u){i&&i.m(r,u),t=!0},p(r,u){i&&i.p&&(!t||u&8388608)&&Gr(i,n,r,r[23],t?Ur(n,r[23],u,null):qr(r[23]),null)},i(r){t||(Ct(i,r),t=!0)},o(r){At(i,r),t=!1},d(r){i&&i.d(r)}}}function pE(e){let t,n,i;function r(p){e[16](p)}let u={id:e[1],type:"fill",source:e[2],sourceLayer:e[3],beforeId:e[4],beforeLayerType:e[5],paint:e[6],layout:e[7],filter:e[8],minzoom:e[9],maxzoom:e[10],hoverCursor:e[11],manageHoverState:e[12],eventsIfTopMost:e[13],interactive:e[14],$$slots:{default:[hE]},$$scope:{ctx:e}};return e[0]!==void 0&&(u.hovered=e[0]),t=new dg({props:u}),yr.push(()=>Du(t,"hovered",r)),t.$on("click",e[17]),t.$on("dblclick",e[18]),t.$on("contextmenu",e[19]),t.$on("mouseenter",e[20]),t.$on("mousemove",e[21]),t.$on("mouseleave",e[22]),{c(){ee(t.$$.fragment)},m(p,a){Qt(t,p,a),i=!0},p(p,[a]){const _={};a&2&&(_.id=p[1]),a&4&&(_.source=p[2]),a&8&&(_.sourceLayer=p[3]),a&16&&(_.beforeId=p[4]),a&32&&(_.beforeLayerType=p[5]),a&64&&(_.paint=p[6]),a&128&&(_.layout=p[7]),a&256&&(_.filter=p[8]),a&512&&(_.minzoom=p[9]),a&1024&&(_.maxzoom=p[10]),a&2048&&(_.hoverCursor=p[11]),a&4096&&(_.manageHoverState=p[12]),a&8192&&(_.eventsIfTopMost=p[13]),a&16384&&(_.interactive=p[14]),a&8388608&&(_.$$scope={dirty:a,ctx:p}),!n&&a&1&&(n=!0,_.hovered=p[0],Nu(()=>n=!1)),t.$set(_)},i(p){i||(Ct(t.$$.fragment,p),i=!0)},o(p){At(t.$$.fragment,p),i=!1},d(p){$t(t,p)}}}function fE(e,t,n){let{$$slots:i={},$$scope:r}=t,{id:u=np("fill")}=t,{source:p=void 0}=t,{sourceLayer:a=void 0}=t,{beforeId:_=void 0}=t,{beforeLayerType:x=void 0}=t,{paint:S}=t,{layout:L=void 0}=t,{filter:k=void 0}=t,{minzoom:D=void 0}=t,{maxzoom:F=void 0}=t,{hoverCursor:K=void 0}=t,{manageHoverState:W=!1}=t,{hovered:Q=null}=t,{eventsIfTopMost:U=!1}=t,{interactive:X=!0}=t;function Y(mt){Q=mt,n(0,Q)}function pt(mt){ui.call(this,e,mt)}function gt(mt){ui.call(this,e,mt)}function ct(mt){ui.call(this,e,mt)}function ht(mt){ui.call(this,e,mt)}function rt(mt){ui.call(this,e,mt)}function Et(mt){ui.call(this,e,mt)}return e.$$set=mt=>{"id"in mt&&n(1,u=mt.id),"source"in mt&&n(2,p=mt.source),"sourceLayer"in mt&&n(3,a=mt.sourceLayer),"beforeId"in mt&&n(4,_=mt.beforeId),"beforeLayerType"in mt&&n(5,x=mt.beforeLayerType),"paint"in mt&&n(6,S=mt.paint),"layout"in mt&&n(7,L=mt.layout),"filter"in mt&&n(8,k=mt.filter),"minzoom"in mt&&n(9,D=mt.minzoom),"maxzoom"in mt&&n(10,F=mt.maxzoom),"hoverCursor"in mt&&n(11,K=mt.hoverCursor),"manageHoverState"in mt&&n(12,W=mt.manageHoverState),"hovered"in mt&&n(0,Q=mt.hovered),"eventsIfTopMost"in mt&&n(13,U=mt.eventsIfTopMost),"interactive"in mt&&n(14,X=mt.interactive),"$$scope"in mt&&n(23,r=mt.$$scope)},[Q,u,p,a,_,x,S,L,k,D,F,K,W,U,X,i,Y,pt,gt,ct,ht,rt,Et,r]}class rp extends cn{constructor(t){super(),un(this,t,fE,pE,rn,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function dE(e,t,n){let i;const{map:r}=ip();Ee(e,r,_=>n(4,i=_));let{position:u="top-left"}=t,{container:p=void 0}=t,a=null;return Ds(()=>{i!=null&&i.loaded()&&a&&i.removeControl(a)}),e.$$set=_=>{"position"in _&&n(1,u=_.position),"container"in _&&n(2,p=_.container)},e.$$.update=()=>{if(e.$$.dirty&30&&i&&!a){let _;typeof p=="string"?_=document.querySelector(p)??void 0:_=p,n(3,a=new Ps.FullscreenControl({container:_})),i.addControl(a,u)}},[r,u,p,a,i]}class mE extends cn{constructor(t){super(),un(this,t,dE,null,rn,{position:1,container:2})}}function gE(e,t,n,i,r){let u=!1;e.getSource(t)&&(u=!0,e.removeSource(t));const p=()=>{i(t)&&(e.addSource(t,n),r())};if(u){const a=()=>{t&&(e.getSource(t)?setTimeout(a,1):p())};a()}else p()}function _E(e,t,n){CS().then(()=>{let i=Pb(e);if(!i)return;i.getSource(t)===n&&i.removeSource(t)})}function Fv(e){let t=e[0],n,i,r=Bv(e);return{c(){r.c(),n=bs()},m(u,p){r.m(u,p),Ot(u,n,p),i=!0},p(u,p){p&1&&rn(t,t=u[0])?(Bi(),At(r,1,1,Oe),Vi(),r=Bv(u),r.c(),Ct(r,1),r.m(n.parentNode,n)):r.p(u,p)},i(u){i||(Ct(r),i=!0)},o(u){At(r),i=!1},d(u){u&&Rt(n),r.d(u)}}}function Bv(e){let t;const n=e[15].default,i=Vr(n,e,e[14],null);return{c(){i&&i.c()},m(r,u){i&&i.m(r,u),t=!0},p(r,u){i&&i.p&&(!t||u&16384)&&Gr(i,n,r,r[14],t?Ur(n,r[14],u,null):qr(r[14]),null)},i(r){t||(Ct(i,r),t=!0)},o(r){At(i,r),t=!1},d(r){i&&i.d(r)}}}function yE(e){let t,n,i=e[0]&&Fv(e);return{c(){i&&i.c(),t=bs()},m(r,u){i&&i.m(r,u),Ot(r,t,u),n=!0},p(r,[u]){r[0]?i?(i.p(r,u),u&1&&Ct(i,1)):(i=Fv(r),i.c(),Ct(i,1),i.m(t.parentNode,t)):i&&(Bi(),At(i,1,1,()=>{i=null}),Vi())},i(r){n||(Ct(i),n=!0)},o(r){At(i),n=!1},d(r){r&&Rt(t),i&&i.d(r)}}}function vE(e,t,n){let i,r,u,{$$slots:p={},$$scope:a}=t,{id:_=np("geojson")}=t,{data:x}=t,{generateId:S=!1}=t,{promoteId:L=void 0}=t,{filter:k=void 0}=t,{lineMetrics:D=void 0}=t,{cluster:F=void 0}=t;const{map:K,cluster:W,self:Q}=$S();Ee(e,K,Y=>n(13,r=Y)),Ee(e,W,Y=>n(16,u=Y)),Ee(e,Q,Y=>n(0,i=Y));let U,X=!0;return Ds(()=>{i&&U&&r&&(_E(K,i,U),mn(Q,i=null,i),n(11,U=void 0))}),e.$$set=Y=>{"id"in Y&&n(4,_=Y.id),"data"in Y&&n(5,x=Y.data),"generateId"in Y&&n(6,S=Y.generateId),"promoteId"in Y&&n(7,L=Y.promoteId),"filter"in Y&&n(8,k=Y.filter),"lineMetrics"in Y&&n(9,D=Y.lineMetrics),"cluster"in Y&&n(10,F=Y.cluster),"$$scope"in Y&&n(14,a=Y.$$scope)},e.$$.update=()=>{e.$$.dirty&1024&&mn(W,u=F,u),e.$$.dirty&12273&&r&&i!==_&&(mn(Q,i=_,i),gE(r,i,Xm({type:"geojson",data:x,filter:k,lineMetrics:D,generateId:S,promoteId:L,cluster:!!F,clusterMinPoints:F==null?void 0:F.minPoints,clusterMaxZoom:F==null?void 0:F.maxZoom,clusterRadius:F==null?void 0:F.radius,clusterProperties:F==null?void 0:F.properties}),Y=>r&&Y===i,()=>{i&&(n(11,U=r==null?void 0:r.getSource(i)),n(12,X=!0))})),e.$$.dirty&8208&&(r==null||r.on("style.load",()=>{n(11,U=r==null?void 0:r.getSource(_))})),e.$$.dirty&6176&&U&&(X?n(12,X=!1):U.setData(x)),e.$$.dirty&3072&&(U==null||U.setClusterOptions(Xm({cluster:!!F,clusterMaxZoom:F==null?void 0:F.maxZoom,clusterRadius:F==null?void 0:F.radius})))},[i,K,W,Q,_,x,S,L,k,D,F,U,X,r,a,p]}class As extends cn{constructor(t){super(),un(this,t,vE,yE,rn,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function bE(e,t,n){let i;const{map:r}=ip();Ee(e,r,k=>n(8,i=k));let{position:u="top-left"}=t,{positionOptions:p=void 0}=t,{fitBoundsOptions:a=void 0}=t,{trackUserLocation:_=!1}=t,{showAccuracyCircle:x=!0}=t,{showUserLocation:S=!0}=t,L=null;return Ds(()=>{i!=null&&i.loaded()&&L&&i.removeControl(L)}),e.$$set=k=>{"position"in k&&n(1,u=k.position),"positionOptions"in k&&n(2,p=k.positionOptions),"fitBoundsOptions"in k&&n(3,a=k.fitBoundsOptions),"trackUserLocation"in k&&n(4,_=k.trackUserLocation),"showAccuracyCircle"in k&&n(5,x=k.showAccuracyCircle),"showUserLocation"in k&&n(6,S=k.showUserLocation)},e.$$.update=()=>{e.$$.dirty&510&&i&&!L&&(n(7,L=new Ps.GeolocateControl({positionOptions:p,fitBoundsOptions:a,trackUserLocation:_,showAccuracyCircle:x,showUserLocation:S})),i.addControl(L,u))},[r,u,p,a,_,x,S,L,i]}class xE extends cn{constructor(t){super(),un(this,t,bE,null,rn,{position:1,positionOptions:2,fitBoundsOptions:3,trackUserLocation:4,showAccuracyCircle:5,showUserLocation:6})}}function wE(e){let t;const n=e[15].default,i=Vr(n,e,e[23],null);return{c(){i&&i.c()},m(r,u){i&&i.m(r,u),t=!0},p(r,u){i&&i.p&&(!t||u&8388608)&&Gr(i,n,r,r[23],t?Ur(n,r[23],u,null):qr(r[23]),null)},i(r){t||(Ct(i,r),t=!0)},o(r){At(i,r),t=!1},d(r){i&&i.d(r)}}}function SE(e){let t,n,i;function r(p){e[16](p)}let u={id:e[1],type:"line",source:e[2],sourceLayer:e[3],beforeId:e[4],beforeLayerType:e[5],paint:e[6],layout:e[7],filter:e[8],minzoom:e[9],maxzoom:e[10],hoverCursor:e[11],manageHoverState:e[12],eventsIfTopMost:e[13],interactive:e[14],$$slots:{default:[wE]},$$scope:{ctx:e}};return e[0]!==void 0&&(u.hovered=e[0]),t=new dg({props:u}),yr.push(()=>Du(t,"hovered",r)),t.$on("click",e[17]),t.$on("dblclick",e[18]),t.$on("contextmenu",e[19]),t.$on("mouseenter",e[20]),t.$on("mousemove",e[21]),t.$on("mouseleave",e[22]),{c(){ee(t.$$.fragment)},m(p,a){Qt(t,p,a),i=!0},p(p,[a]){const _={};a&2&&(_.id=p[1]),a&4&&(_.source=p[2]),a&8&&(_.sourceLayer=p[3]),a&16&&(_.beforeId=p[4]),a&32&&(_.beforeLayerType=p[5]),a&64&&(_.paint=p[6]),a&128&&(_.layout=p[7]),a&256&&(_.filter=p[8]),a&512&&(_.minzoom=p[9]),a&1024&&(_.maxzoom=p[10]),a&2048&&(_.hoverCursor=p[11]),a&4096&&(_.manageHoverState=p[12]),a&8192&&(_.eventsIfTopMost=p[13]),a&16384&&(_.interactive=p[14]),a&8388608&&(_.$$scope={dirty:a,ctx:p}),!n&&a&1&&(n=!0,_.hovered=p[0],Nu(()=>n=!1)),t.$set(_)},i(p){i||(Ct(t.$$.fragment,p),i=!0)},o(p){At(t.$$.fragment,p),i=!1},d(p){$t(t,p)}}}function EE(e,t,n){let{$$slots:i={},$$scope:r}=t,{id:u=np("line")}=t,{source:p=void 0}=t,{sourceLayer:a=void 0}=t,{beforeId:_=void 0}=t,{beforeLayerType:x=void 0}=t,{paint:S}=t,{layout:L=void 0}=t,{filter:k=void 0}=t,{minzoom:D=void 0}=t,{maxzoom:F=void 0}=t,{hoverCursor:K=void 0}=t,{manageHoverState:W=!1}=t,{hovered:Q=null}=t,{eventsIfTopMost:U=!1}=t,{interactive:X=!0}=t;function Y(mt){Q=mt,n(0,Q)}function pt(mt){ui.call(this,e,mt)}function gt(mt){ui.call(this,e,mt)}function ct(mt){ui.call(this,e,mt)}function ht(mt){ui.call(this,e,mt)}function rt(mt){ui.call(this,e,mt)}function Et(mt){ui.call(this,e,mt)}return e.$$set=mt=>{"id"in mt&&n(1,u=mt.id),"source"in mt&&n(2,p=mt.source),"sourceLayer"in mt&&n(3,a=mt.sourceLayer),"beforeId"in mt&&n(4,_=mt.beforeId),"beforeLayerType"in mt&&n(5,x=mt.beforeLayerType),"paint"in mt&&n(6,S=mt.paint),"layout"in mt&&n(7,L=mt.layout),"filter"in mt&&n(8,k=mt.filter),"minzoom"in mt&&n(9,D=mt.minzoom),"maxzoom"in mt&&n(10,F=mt.maxzoom),"hoverCursor"in mt&&n(11,K=mt.hoverCursor),"manageHoverState"in mt&&n(12,W=mt.manageHoverState),"hovered"in mt&&n(0,Q=mt.hovered),"eventsIfTopMost"in mt&&n(13,U=mt.eventsIfTopMost),"interactive"in mt&&n(14,X=mt.interactive),"$$scope"in mt&&n(23,r=mt.$$scope)},[Q,u,p,a,_,x,S,L,k,D,F,K,W,U,X,i,Y,pt,gt,ct,ht,rt,Et,r]}class iu extends cn{constructor(t){super(),un(this,t,EE,SE,rn,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function IE(e){let t=e.getCenter(),n=Math.round(e.getZoom()*100)/100,i=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),r=Math.pow(10,i),u=Math.round(t.lat*r)/r,p=Math.round(t.lng*r)/r,a=`${n}/${u}/${p}`,_=e.getBearing(),x=e.getPitch();return(_||x)&&(a+=`/${Math.round(_*10)/10}`),x&&(a+=`/${Math.round(x)}`),`#${a}`}function CE(e){return e.replace("#","").split("/").map(parseFloat)}var Mm=Iy;function Iy(e,t){return e===t||e!==e&&t!==t?!0:typeof e!=typeof t||{}.toString.call(e)!={}.toString.call(t)||e!==Object(e)||!e?!1:Array.isArray(e)?Vv(e,t):{}.toString.call(e)=="[object Set]"?Vv(Array.from(e),Array.from(t)):{}.toString.call(e)=="[object Object]"?LE(e,t):TE(e,t)}function TE(e,t){return e.toString()===t.toString()}function Vv(e,t){var n=e.length;if(n!=t.length)return!1;for(var i=0;i<n;i++)if(!Iy(e[i],t[i]))return!1;return!0}function LE(e,t){var n=Object.keys(e),i=n.length;if(i!=Object.keys(t).length)return!1;for(var r=0;r<i;r++){var u=n[r];if(!(t.hasOwnProperty(u)&&Iy(e[u],t[u])))return!1}return!0}function ME(e,t,n){let i;const{map:r}=ip();Ee(e,r,S=>n(6,i=S));let{position:u="top-left"}=t,{showCompass:p=!0}=t,{showZoom:a=!0}=t,{visualizePitch:_=!1}=t,x=null;return Ds(()=>{i!=null&&i.loaded()&&x&&i.removeControl(x)}),e.$$set=S=>{"position"in S&&n(1,u=S.position),"showCompass"in S&&n(2,p=S.showCompass),"showZoom"in S&&n(3,a=S.showZoom),"visualizePitch"in S&&n(4,_=S.visualizePitch)},e.$$.update=()=>{e.$$.dirty&126&&i&&!x&&(n(5,x=new Ps.NavigationControl({showCompass:p,showZoom:a,visualizePitch:_})),i.addControl(x,u))},[r,u,p,a,_,x,i]}class PE extends cn{constructor(t){super(),un(this,t,ME,null,rn,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function AE(e,t,n){let i;const{map:r}=ip();Ee(e,r,x=>n(5,i=x));let{position:u="bottom-left"}=t,{maxWidth:p=void 0}=t,{unit:a="metric"}=t,_=null;return Ds(()=>{i!=null&&i.loaded()&&_&&i.removeControl(_)}),e.$$set=x=>{"position"in x&&n(1,u=x.position),"maxWidth"in x&&n(2,p=x.maxWidth),"unit"in x&&n(3,a=x.unit)},e.$$.update=()=>{e.$$.dirty&62&&i&&!_&&(n(4,_=new Ps.ScaleControl({maxWidth:p,unit:a})),i.addControl(_,u))},[r,u,p,a,_,i]}class kE extends cn{constructor(t){super(),un(this,t,AE,null,rn,{position:1,maxWidth:2,unit:3})}}const NE=e=>({map:e[0]&8,loadedImages:e[0]&16,allImagesLoaded:e[0]&32}),Uv=e=>({map:e[3],loadedImages:e[4],allImagesLoaded:e[5]});function Gv(e){let t,n,i=e[2]&&qv(e);const r=e[34].default,u=Vr(r,e,e[33],Uv);return{c(){i&&i.c(),t=te(),u&&u.c()},m(p,a){i&&i.m(p,a),Ot(p,t,a),u&&u.m(p,a),n=!0},p(p,a){p[2]?i?(i.p(p,a),a[0]&4&&Ct(i,1)):(i=qv(p),i.c(),Ct(i,1),i.m(t.parentNode,t)):i&&(Bi(),At(i,1,1,()=>{i=null}),Vi()),u&&u.p&&(!n||a[0]&56|a[1]&4)&&Gr(u,r,p,p[33],n?Ur(r,p[33],a,NE):qr(p[33]),Uv)},i(p){n||(Ct(i),Ct(u,p),n=!0)},o(p){At(i),At(u,p),n=!1},d(p){p&&Rt(t),i&&i.d(p),u&&u.d(p)}}}function qv(e){let t,n,i,r,u,p,a,_;return t=new PE({props:{position:e[6]}}),i=new xE({props:{position:e[6],fitBoundsOptions:{maxZoom:12}}}),u=new mE({props:{position:e[6]}}),a=new kE({props:{position:e[6]}}),{c(){ee(t.$$.fragment),n=te(),ee(i.$$.fragment),r=te(),ee(u.$$.fragment),p=te(),ee(a.$$.fragment)},m(x,S){Qt(t,x,S),Ot(x,n,S),Qt(i,x,S),Ot(x,r,S),Qt(u,x,S),Ot(x,p,S),Qt(a,x,S),_=!0},p(x,S){const L={};S[0]&64&&(L.position=x[6]),t.$set(L);const k={};S[0]&64&&(k.position=x[6]),i.$set(k);const D={};S[0]&64&&(D.position=x[6]),u.$set(D);const F={};S[0]&64&&(F.position=x[6]),a.$set(F)},i(x){_||(Ct(t.$$.fragment,x),Ct(i.$$.fragment,x),Ct(u.$$.fragment,x),Ct(a.$$.fragment,x),_=!0)},o(x){At(t.$$.fragment,x),At(i.$$.fragment,x),At(u.$$.fragment,x),At(a.$$.fragment,x),_=!1},d(x){x&&(Rt(n),Rt(r),Rt(p)),$t(t,x),$t(i,x),$t(u,x),$t(a,x)}}}function DE(e){let t,n,i,r,u,p=e[3]&&e[0]&&Gv(e);return{c(){t=Lt("div"),p&&p.c(),Vt(t,"class",n=jm(e[1])+" svelte-p00lfq"),cl(t,"expand-map",!e[1])},m(a,_){Ot(a,t,_),p&&p.m(t,null),i=!0,r||(u=K_(e[9].call(null,t)),r=!0)},p(a,_){a[3]&&a[0]?p?(p.p(a,_),_[0]&9&&Ct(p,1)):(p=Gv(a),p.c(),Ct(p,1),p.m(t,null)):p&&(Bi(),At(p,1,1,()=>{p=null}),Vi()),(!i||_[0]&2&&n!==(n=jm(a[1])+" svelte-p00lfq"))&&Vt(t,"class",n),(!i||_[0]&2)&&cl(t,"expand-map",!a[1])},i(a){i||(Ct(p),i=!0)},o(a){At(p),i=!1},d(a){a&&Rt(t),p&&p.d(),r=!1,u()}}}function RE(e,t,n){let i,r,u,p,{$$slots:a={},$$scope:_}=t,{map:x=null}=t,{class:S=void 0}=t,{style:L}=t,{diffStyleUpdates:k=!1}=t,{center:D=void 0}=t,{zoom:F=void 0}=t,{pitch:K=0}=t,{bearing:W=0}=t,{bounds:Q=void 0}=t,{hash:U=!1}=t,{loaded:X=!1}=t,{minZoom:Y=0}=t,{maxZoom:pt=22}=t,{zoomOnDoubleClick:gt=!0}=t,{interactive:ct=!0}=t,{attributionControl:ht=!0}=t,{cooperativeGestures:rt=!1}=t,{preserveDrawingBuffer:Et=!1}=t,{maxBounds:mt=void 0}=t,{images:dt=[]}=t,{standardControls:Jt=!1}=t,{filterLayers:kt=void 0}=t,{transformRequest:Gt=void 0}=t;const Kt=ep(),{map:be,loadedImages:ce}=QS();Ee(e,be,re=>n(3,u=re)),Ee(e,ce,re=>n(4,p=re));let $e=new Set;function jn(re){u!=null&&u.loaded()&&("url"in re?($e.add(re.id),u.loadImage(re.url,(Be,fn)=>{$e.delete(re.id),Be?Kt("error",Be):fn&&(u==null||u.addImage(re.id,fn,re.options),p.add(re.id),ce.set(p))})):(u.addImage(re.id,re.data,re.options),p.add(re.id),ce.set(p)))}let Ze,ze,Ue,dn;function Jn(re){if(U){let Be=CE(window.location.hash);Be.length>=3&&(n(11,F=Be[0]),n(10,D=[Be[2],Be[1]])),Be.length==5&&(n(15,W=Be[3]),n(14,K=Be[4]))}return mn(be,u=new Ps.Map(Xm({container:re,style:L,center:D,zoom:F,pitch:K,bearing:W,minZoom:Y,maxZoom:pt,interactive:ct,preserveDrawingBuffer:Et,maxBounds:mt,bounds:Q,attributionControl:ht,transformRequest:Gt,cooperativeGestures:rt})),u),u.on("load",Be=>{n(0,X=!0),Kt("load",u)}),u.on("error",Be=>Kt("error",{...Be,map:u})),u.on("movestart",Be=>Kt("movestart",{...Be,map:u})),u.on("moveend",Be=>{if(n(10,D=Be.target.getCenter()),n(11,F=Be.target.getZoom()),n(12,Q=Be.target.getBounds()),Kt("moveend",{...Be,map:u}),U){let fn=window.location.href.replace(/(#.+)?$/,IE(u));window.history.replaceState(window.history.state,"",fn)}}),u.on("zoomstart",Be=>Kt("zoomstart",{...Be,map:u})),u.on("zoom",Be=>{n(11,F=Be.target.getZoom()),Kt("zoom",{...Be,map:u})}),u.on("zoomend",Be=>{n(11,F=Be.target.getZoom()),Kt("zoomend",{...Be,map:u})}),u.on("style.load",()=>{if(u){const Be=u.getStyle();if(n(30,Ze=Be.layers.map(fn=>fn.id)),n(31,ze=Object.keys(Be.sources)),dn)for(const[fn,Un]of Object.entries(dn))u.addSource(fn,Un);if(Ue)for(const fn of Ue)u.addLayer(fn)}}),u.on("styledata",Be=>{if(u&&kt){const fn=u.getStyle().layers;if(fn)for(let Un of fn)kt(Un)||u.setLayoutProperty(Un.id,"visibility","none")}Kt("styledata",{...Be,map:u})}),{destroy(){n(0,X=!1),u==null||u.remove(),mn(be,u=null,u)}}}let Zn=L;return e.$$set=re=>{"map"in re&&n(13,x=re.map),"class"in re&&n(1,S=re.class),"style"in re&&n(16,L=re.style),"diffStyleUpdates"in re&&n(17,k=re.diffStyleUpdates),"center"in re&&n(10,D=re.center),"zoom"in re&&n(11,F=re.zoom),"pitch"in re&&n(14,K=re.pitch),"bearing"in re&&n(15,W=re.bearing),"bounds"in re&&n(12,Q=re.bounds),"hash"in re&&n(18,U=re.hash),"loaded"in re&&n(0,X=re.loaded),"minZoom"in re&&n(19,Y=re.minZoom),"maxZoom"in re&&n(20,pt=re.maxZoom),"zoomOnDoubleClick"in re&&n(21,gt=re.zoomOnDoubleClick),"interactive"in re&&n(22,ct=re.interactive),"attributionControl"in re&&n(23,ht=re.attributionControl),"cooperativeGestures"in re&&n(24,rt=re.cooperativeGestures),"preserveDrawingBuffer"in re&&n(25,Et=re.preserveDrawingBuffer),"maxBounds"in re&&n(26,mt=re.maxBounds),"images"in re&&n(27,dt=re.images),"standardControls"in re&&n(2,Jt=re.standardControls),"filterLayers"in re&&n(28,kt=re.filterLayers),"transformRequest"in re&&n(29,Gt=re.transformRequest),"$$scope"in re&&n(33,_=re.$$scope)},e.$$.update=()=>{if(e.$$.dirty[0]&4&&n(6,i=typeof Jt=="boolean"?void 0:Jt),e.$$.dirty[0]&8&&n(13,x=u),e.$$.dirty[0]&134217737&&X&&u!=null&&u.loaded())for(let re of dt)!$e.has(re.id)&&!u.hasImage(re.id)&&jn(re);if(e.$$.dirty[0]&134217744&&n(5,r=dt.every(re=>p.has(re.id))),e.$$.dirty[0]&1073938440|e.$$.dirty[1]&3&&u&&!Mm(L,Zn)){const re=u.getStyle();if(Ze&&(Ue=re.layers.filter(Be=>!Ze.includes(Be.id))),ze){const Be=Object.keys(re.sources).filter(fn=>!ze.includes(fn));dn={};for(const fn of Be)dn[fn]=re.sources[fn]}n(32,Zn=L),u.setStyle(L,{diff:k})}e.$$.dirty[0]&1032&&D&&!Mm(D,u==null?void 0:u.getCenter())&&(u==null||u.panTo(D)),e.$$.dirty[0]&2056&&F&&!Mm(F,u==null?void 0:u.getZoom())&&(u==null||u.zoomTo(F)),e.$$.dirty[0]&4104&&Q&&!Mm(Q,u==null?void 0:u.getBounds())&&(u==null||u.fitBounds(Q)),e.$$.dirty[0]&2097160&&(gt?u==null||u.doubleClickZoom.enable():u==null||u.doubleClickZoom.disable())},[X,S,Jt,u,p,r,i,be,ce,Jn,D,F,Q,x,K,W,L,k,U,Y,pt,gt,ct,ht,rt,Et,mt,dt,kt,Gt,Ze,ze,Zn,_,a]}class OE extends cn{constructor(t){super(),un(this,t,RE,DE,rn,{map:13,class:1,style:16,diffStyleUpdates:17,center:10,zoom:11,pitch:14,bearing:15,bounds:12,hash:18,loaded:0,minZoom:19,maxZoom:20,zoomOnDoubleClick:21,interactive:22,attributionControl:23,cooperativeGestures:24,preserveDrawingBuffer:25,maxBounds:26,images:27,standardControls:2,filterLayers:28,transformRequest:29},null,[-1,-1])}}function zE(e){let t,n,i,r,u,p,a;const _=e[17].default,x=Vr(_,e,e[16],null);return{c(){t=Lt("div"),x&&x.c(),Vt(t,"tabindex",n=e[1]?0:void 0),Vt(t,"role",i=e[1]?"button":void 0),ul(t,"z-index",e[2])},m(S,L){Ot(S,t,L),x&&x.m(t,null),u=!0,p||(a=[K_(e[6].call(null,t)),K_(r=FE.call(null,t,e[0])),Se(t,"click",e[18]),Se(t,"dblclick",e[19]),Se(t,"contextmenu",e[20]),Se(t,"mouseenter",e[21]),Se(t,"mouseleave",e[22]),Se(t,"mousemove",e[23]),Se(t,"keydown",e[7])],p=!0)},p(S,[L]){x&&x.p&&(!u||L&65536)&&Gr(x,_,S,S[16],u?Ur(_,S[16],L,null):qr(S[16]),null),(!u||L&2&&n!==(n=S[1]?0:void 0))&&Vt(t,"tabindex",n),(!u||L&2&&i!==(i=S[1]?"button":void 0))&&Vt(t,"role",i),r&&pg(r.update)&&L&1&&r.update.call(null,S[0]),L&4&&ul(t,"z-index",S[2])},i(S){u||(Ct(x,S),u=!0)},o(S){At(x,S),u=!1},d(S){S&&Rt(t),x&&x.d(S),p=!1,Xr(a)}}}function FE(e,t){const n=e.className;function i(r){r?e.className=`${n} ${r}`:e.className=n}return i(t),{update:i}}function BE(e,t,n){let i,r,u,{$$slots:p={},$$scope:a}=t,{lngLat:_}=t,{class:x=void 0}=t,{interactive:S=!0}=t,{asButton:L=!1}=t,{draggable:k=!1}=t,{feature:D=null}=t,{offset:F=void 0}=t,{zIndex:K=void 0}=t,{rotation:W=0}=t;const Q=ep(),{map:U,layerEvent:X,self:Y}=eE();Ee(e,U,Gt=>n(25,u=Gt)),Ee(e,X,Gt=>n(24,i=Gt)),Ee(e,Y,Gt=>n(15,r=Gt));function pt(Gt){mn(Y,r=new Ps.Marker({element:Gt,rotation:W,draggable:k,offset:F}).setLngLat(_).addTo(u),r);const Kt=()=>ht("dragstart"),be=()=>{gt(),ht("drag")},ce=()=>{gt(),ht("dragend")};return k&&(r.on("dragstart",Kt),r.on("drag",be),r.on("dragend",ce)),{destroy(){k&&(r==null||r.off("dragstart",Kt),r==null||r.off("drag",be),r==null||r.off("dragend",ce)),r==null||r.remove()}}}function gt(){let Gt=r==null?void 0:r.getLngLat();Gt&&(Array.isArray(_)?n(9,_=[Gt.lng,Gt.lat]):_&&"lon"in _?n(9,_={lon:Gt.lng,lat:Gt.lat}):n(9,_=Gt))}function ct(Gt){Gt.key===" "&&(Gt.preventDefault(),Gt.stopPropagation(),ht("click"))}function ht(Gt){if(!S)return;let Kt=r==null?void 0:r.getLngLat();if(!Kt)return;const be=[Kt.lng,Kt.lat];let ce={map:u,marker:r,lngLat:be,features:[{type:"Feature",properties:(D==null?void 0:D.properties)??{},geometry:{type:"Point",coordinates:be}}]};mn(X,i={...ce,layerType:"marker",type:Gt},i),Q(Gt,ce)}const rt=()=>ht("click"),Et=()=>ht("dblclick"),mt=()=>ht("contextmenu"),dt=Gt=>{ht("mouseenter")},Jt=()=>{ht("mouseleave")},kt=()=>ht("mousemove");return e.$$set=Gt=>{"lngLat"in Gt&&n(9,_=Gt.lngLat),"class"in Gt&&n(0,x=Gt.class),"interactive"in Gt&&n(10,S=Gt.interactive),"asButton"in Gt&&n(1,L=Gt.asButton),"draggable"in Gt&&n(11,k=Gt.draggable),"feature"in Gt&&n(12,D=Gt.feature),"offset"in Gt&&n(13,F=Gt.offset),"zIndex"in Gt&&n(2,K=Gt.zIndex),"rotation"in Gt&&n(14,W=Gt.rotation),"$$scope"in Gt&&n(16,a=Gt.$$scope)},e.$$.update=()=>{e.$$.dirty&33280&&(r==null||r.setLngLat(_)),e.$$.dirty&40960&&(r==null||r.setOffset(F??[0,0])),e.$$.dirty&49152&&(r==null||r.setRotation(W))},[x,L,K,U,X,Y,pt,ct,ht,_,S,k,D,F,W,r,a,p,rt,Et,mt,dt,Jt,kt]}class jv extends cn{constructor(t){super(),un(this,t,BE,zE,rn,{lngLat:9,class:0,interactive:10,asButton:1,draggable:11,feature:12,offset:13,zIndex:2,rotation:14})}}const VE=e=>({features:e[0]&16,data:e[0]&16,map:e[0]&4,close:e[0]&1}),Zv=e=>{var t;return{features:e[4],data:(t=e[4])==null?void 0:t[0],map:e[2],close:e[31]}};function Wv(e){let t,n,i=(e[4]||e[3]instanceof Ps.Marker)&&Xv(e);return{c(){t=Lt("div"),i&&i.c()},m(r,u){Ot(r,t,u),i&&i.m(t,null),e[32](t),n=!0},p(r,u){r[4]||r[3]instanceof Ps.Marker?i?(i.p(r,u),u[0]&24&&Ct(i,1)):(i=Xv(r),i.c(),Ct(i,1),i.m(t,null)):i&&(Bi(),At(i,1,1,()=>{i=null}),Vi())},i(r){n||(Ct(i),n=!0)},o(r){At(i),n=!1},d(r){r&&Rt(t),i&&i.d(),e[32](null)}}}function Xv(e){let t;const n=e[30].default,i=Vr(n,e,e[29],Zv);return{c(){i&&i.c()},m(r,u){i&&i.m(r,u),t=!0},p(r,u){i&&i.p&&(!t||u[0]&536870933)&&Gr(i,n,r,r[29],t?Ur(n,r[29],u,VE):qr(r[29]),Zv)},i(r){t||(Ct(i,r),t=!0)},o(r){At(i,r),t=!1},d(r){i&&i.d(r)}}}function UE(e){let t,n,i=e[9].default&&Wv(e);return{c(){i&&i.c(),t=bs()},m(r,u){i&&i.m(r,u),Ot(r,t,u),n=!0},p(r,u){r[9].default?i?(i.p(r,u),u[0]&512&&Ct(i,1)):(i=Wv(r),i.c(),Ct(i,1),i.m(t.parentNode,t)):i&&(Bi(),At(i,1,1,()=>{i=null}),Vi())},i(r){n||(Ct(i),n=!0)},o(r){At(i),n=!1},d(r){r&&Rt(t),i&&i.d(r)}}}function GE(e,t,n){let i,r,u,p,a,_,{$$slots:x={},$$scope:S}=t;const L=vS(x);let{closeButton:k=void 0}=t,{closeOnClickOutside:D=!0}=t,{closeOnClickInside:F=!1}=t,{closeOnMove:K=!1}=t,{openOn:W="click"}=t,{openIfTopMost:Q=!0}=t,{focusAfterOpen:U=!0}=t,{anchor:X=void 0}=t,{offset:Y=void 0}=t,{popupClass:pt=void 0}=t,{maxWidth:gt=void 0}=t,{lngLat:ct=void 0}=t,{html:ht=void 0}=t,{open:rt=!1}=t;const{map:Et,popupTarget:mt,layerEvent:dt,layer:Jt,eventTopMost:kt}=ip();Ee(e,Et,wt=>n(2,u=wt)),Ee(e,mt,wt=>n(3,a=wt)),Ee(e,dt,wt=>n(28,p=wt)),Ee(e,Jt,wt=>n(35,_=wt));const Gt=["click","dblclick","contextmenu"];let Kt,be=!1,ce;function $e(){if(!Kt)return;let wt=Kt.getElement();!wt||wt===ce||(ce=wt,W==="hover"&&(ce.style.pointerEvents="none"),ce.addEventListener("mouseenter",()=>{n(24,be=!0)},{passive:!0}),ce.addEventListener("mouseleave",()=>{n(24,be=!1)},{passive:!0}),ce.addEventListener("click",()=>{F&&n(0,rt=!1)},{passive:!0}))}ud(()=>{if(u)return u.on("click",fn),u.on("contextmenu",fn),typeof a=="string"&&(u.on("click",a,Ue),u.on("dblclick",a,Ue),u.on("contextmenu",a,Ue),u.on("mousemove",a,Be),u.on("mouseleave",a,re),u.on("touchstart",a,Jn),u.on("touchend",a,Zn)),()=>{u!=null&&u.loaded()&&(Kt==null||Kt.remove(),u.off("click",fn),u.off("contextmenu",fn),a instanceof Ps.Marker?a.getPopup()===Kt&&a.setPopup(void 0):typeof a=="string"&&(u.off("click",a,Ue),u.off("dblclick",a,Ue),u.off("contextmenu",a,Ue),u.off("mousemove",a,Be),u.off("mouseleave",a,re),u.off("touchstart",a,Jn),u.off("touchend",a,Zn)))}});function jn(wt){return Q?!("marker"in wt)&&!nE(wt)&&kt(wt)!==_:!1}let Ze=null,ze="normal";function Ue(wt){wt.type===W&&(jn(wt)||("layerType"in wt?wt.layerType==="deckgl"?(n(10,ct=wt.coordinate),n(4,Ze=wt.object?[wt.object]:null)):(n(10,ct=wt.lngLat),n(4,Ze=wt.features??[])):(n(10,ct=wt.lngLat),n(4,Ze=wt.features??[])),setTimeout(()=>n(0,rt=!0))))}let dn=null;function Jn(wt){dn=wt.point}function Zn(wt){if(!dn||W!=="hover")return;let De=dn.dist(wt.point);dn=null,De<3&&(n(10,ct=wt.lngLat),n(4,Ze=wt.features??[]),Kt.isOpen()?n(25,ze="justOpened"):(n(25,ze="opening"),n(0,rt=!0)))}function re(wt){W!=="hover"||dn||ze!=="normal"||(n(0,rt=!1),n(4,Ze=null))}function Be(wt){if(!(W!=="hover"||dn||ze!=="normal")){if(jn(wt)){n(0,rt=!1),n(4,Ze=null);return}n(0,rt=!0),n(4,Ze=wt.features??[]),n(10,ct=wt.lngLat)}}function fn(wt){if(ze==="justOpened"){n(25,ze="normal");return}if(!D)return;let De=[ce,a instanceof Ps.Marker?a==null?void 0:a.getElement():null];rt&&Kt.isOpen()&&!De.some(Ve=>Ve==null?void 0:Ve.contains(wt.originalEvent.target))&&(wt.type==="contextmenu"&&W==="contextmenu"||wt.type!=="contextmenu")&&n(0,rt=!1)}Ds(()=>{u&&(Kt!=null&&Kt.isOpen())&&Kt.remove()});let Un;const ur=()=>n(0,rt=!1);function Ai(wt){yr[wt?"unshift":"push"](()=>{Un=wt,n(1,Un)})}return e.$$set=wt=>{"closeButton"in wt&&n(11,k=wt.closeButton),"closeOnClickOutside"in wt&&n(12,D=wt.closeOnClickOutside),"closeOnClickInside"in wt&&n(13,F=wt.closeOnClickInside),"closeOnMove"in wt&&n(14,K=wt.closeOnMove),"openOn"in wt&&n(15,W=wt.openOn),"openIfTopMost"in wt&&n(16,Q=wt.openIfTopMost),"focusAfterOpen"in wt&&n(17,U=wt.focusAfterOpen),"anchor"in wt&&n(18,X=wt.anchor),"offset"in wt&&n(19,Y=wt.offset),"popupClass"in wt&&n(20,pt=wt.popupClass),"maxWidth"in wt&&n(21,gt=wt.maxWidth),"lngLat"in wt&&n(10,ct=wt.lngLat),"html"in wt&&n(22,ht=wt.html),"open"in wt&&n(0,rt=wt.open),"$$scope"in wt&&n(29,S=wt.$$scope)},e.$$.update=()=>{if(e.$$.dirty[0]&14336&&n(27,i=k??(!D&&!F)),e.$$.dirty[0]&146685952&&(Kt||(n(23,Kt=new Ps.Popup({closeButton:i,closeOnClick:!1,closeOnMove:K,focusAfterOpen:U,maxWidth:gt,className:pt,anchor:X,offset:Y})),ce=Kt.getElement(),Kt.on("open",()=>{n(0,rt=!0),$e()}),Kt.on("close",wt=>{n(0,rt=!1)}))),e.$$.dirty[0]&8421384&&Kt&&a instanceof Ps.Marker&&(W==="click"?a.setPopup(Kt):a.getPopup()===Kt&&a.setPopup(void 0)),e.$$.dirty[0]&268468224&&Gt.includes(W)&&(p==null?void 0:p.type)===W&&(Ue(p),mn(dt,p=null,p)),e.$$.dirty[0]&268468224&&n(26,r=W==="hover"&&((p==null?void 0:p.type)==="mousemove"||(p==null?void 0:p.type)==="mouseenter")),e.$$.dirty[0]&352354304&&W==="hover"&&dt&&(r&&p&&(p.layerType==="deckgl"?(n(10,ct=p.coordinate),n(4,Ze=p.object?[p.object]:null)):(n(10,ct=p.lngLat),n(4,Ze=p.features??[]))),n(0,rt=(r||be)??!1)),e.$$.dirty[0]&12582914&&(Un?Kt.setDOMContent(Un):ht&&Kt.setHTML(ht)),e.$$.dirty[0]&8389632&&ct&&Kt.setLngLat(ct),e.$$.dirty[0]&41943045&&u){let wt=Kt.isOpen();rt&&!wt?(Kt.addTo(u),ze==="opening"&&n(25,ze="justOpened")):!rt&&wt&&Kt.remove()}},[rt,Un,u,a,Ze,Et,mt,dt,Jt,L,ct,k,D,F,K,W,Q,U,X,Y,pt,gt,ht,Kt,be,ze,r,i,p,S,x,ur,Ai]}class qE extends cn{constructor(t){super(),un(this,t,GE,UE,rn,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function jE(e){let t;const n=e[16].default,i=Vr(n,e,e[24],null);return{c(){i&&i.c()},m(r,u){i&&i.m(r,u),t=!0},p(r,u){i&&i.p&&(!t||u&16777216)&&Gr(i,n,r,r[24],t?Ur(n,r[24],u,null):qr(r[24]),null)},i(r){t||(Ct(i,r),t=!0)},o(r){At(i,r),t=!1},d(r){i&&i.d(r)}}}function ZE(e){let t,n,i;function r(p){e[17](p)}let u={id:e[1],type:"symbol",source:e[2],sourceLayer:e[3],beforeId:e[4],beforeLayerType:e[5],paint:e[6],layout:e[7],filter:e[8],applyToClusters:e[9],minzoom:e[10],maxzoom:e[11],hoverCursor:e[12],manageHoverState:e[13],eventsIfTopMost:e[14],interactive:e[15],$$slots:{default:[jE]},$$scope:{ctx:e}};return e[0]!==void 0&&(u.hovered=e[0]),t=new dg({props:u}),yr.push(()=>Du(t,"hovered",r)),t.$on("click",e[18]),t.$on("dblclick",e[19]),t.$on("contextmenu",e[20]),t.$on("mouseenter",e[21]),t.$on("mousemove",e[22]),t.$on("mouseleave",e[23]),{c(){ee(t.$$.fragment)},m(p,a){Qt(t,p,a),i=!0},p(p,[a]){const _={};a&2&&(_.id=p[1]),a&4&&(_.source=p[2]),a&8&&(_.sourceLayer=p[3]),a&16&&(_.beforeId=p[4]),a&32&&(_.beforeLayerType=p[5]),a&64&&(_.paint=p[6]),a&128&&(_.layout=p[7]),a&256&&(_.filter=p[8]),a&512&&(_.applyToClusters=p[9]),a&1024&&(_.minzoom=p[10]),a&2048&&(_.maxzoom=p[11]),a&4096&&(_.hoverCursor=p[12]),a&8192&&(_.manageHoverState=p[13]),a&16384&&(_.eventsIfTopMost=p[14]),a&32768&&(_.interactive=p[15]),a&16777216&&(_.$$scope={dirty:a,ctx:p}),!n&&a&1&&(n=!0,_.hovered=p[0],Nu(()=>n=!1)),t.$set(_)},i(p){i||(Ct(t.$$.fragment,p),i=!0)},o(p){At(t.$$.fragment,p),i=!1},d(p){$t(t,p)}}}function WE(e,t,n){let{$$slots:i={},$$scope:r}=t,{id:u=np("symbol")}=t,{source:p=void 0}=t,{sourceLayer:a=void 0}=t,{beforeId:_=void 0}=t,{beforeLayerType:x=void 0}=t,{paint:S=void 0}=t,{layout:L=void 0}=t,{filter:k=void 0}=t,{applyToClusters:D=void 0}=t,{minzoom:F=void 0}=t,{maxzoom:K=void 0}=t,{hoverCursor:W=void 0}=t,{manageHoverState:Q=!1}=t,{hovered:U=null}=t,{eventsIfTopMost:X=!1}=t,{interactive:Y=!0}=t;function pt(dt){U=dt,n(0,U)}function gt(dt){ui.call(this,e,dt)}function ct(dt){ui.call(this,e,dt)}function ht(dt){ui.call(this,e,dt)}function rt(dt){ui.call(this,e,dt)}function Et(dt){ui.call(this,e,dt)}function mt(dt){ui.call(this,e,dt)}return e.$$set=dt=>{"id"in dt&&n(1,u=dt.id),"source"in dt&&n(2,p=dt.source),"sourceLayer"in dt&&n(3,a=dt.sourceLayer),"beforeId"in dt&&n(4,_=dt.beforeId),"beforeLayerType"in dt&&n(5,x=dt.beforeLayerType),"paint"in dt&&n(6,S=dt.paint),"layout"in dt&&n(7,L=dt.layout),"filter"in dt&&n(8,k=dt.filter),"applyToClusters"in dt&&n(9,D=dt.applyToClusters),"minzoom"in dt&&n(10,F=dt.minzoom),"maxzoom"in dt&&n(11,K=dt.maxzoom),"hoverCursor"in dt&&n(12,W=dt.hoverCursor),"manageHoverState"in dt&&n(13,Q=dt.manageHoverState),"hovered"in dt&&n(0,U=dt.hovered),"eventsIfTopMost"in dt&&n(14,X=dt.eventsIfTopMost),"interactive"in dt&&n(15,Y=dt.interactive),"$$scope"in dt&&n(24,r=dt.$$scope)},[U,u,p,a,_,x,S,L,k,D,F,K,W,Q,X,Y,i,pt,gt,ct,ht,rt,Et,mt,r]}class XE extends cn{constructor(t){super(),un(this,t,WE,ZE,rn,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var hd=Uint8Array,Xb=Uint16Array,HE=Int32Array,YE=new hd([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),KE=new hd([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Hb=function(e,t){for(var n=new Xb(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];for(var r=new HE(n[30]),i=1;i<30;++i)for(var u=n[i];u<n[i+1];++u)r[u]=u-n[i]<<5|i;return{b:n,r}},Yb=Hb(YE,2),JE=Yb.b,QE=Yb.r;JE[28]=258,QE[258]=28;Hb(KE,0);var $E=new Xb(32768);for(ni=0;ni<32768;++ni)Fl=(ni&43690)>>1|(ni&21845)<<1,Fl=(Fl&52428)>>2|(Fl&13107)<<2,Fl=(Fl&61680)>>4|(Fl&3855)<<4,$E[ni]=((Fl&65280)>>8|(Fl&255)<<8)>>1;var Fl,ni,mg=new hd(288);for(ni=0;ni<144;++ni)mg[ni]=8;var ni;for(ni=144;ni<256;++ni)mg[ni]=9;var ni;for(ni=256;ni<280;++ni)mg[ni]=7;var ni;for(ni=280;ni<288;++ni)mg[ni]=8;var ni,tI=new hd(32);for(ni=0;ni<32;++ni)tI[ni]=5;var ni,eI=new hd(0),nI=typeof TextDecoder<"u"&&new TextDecoder,iI=0;try{nI.decode(eI,{stream:!0}),iI=1}catch{}var rI=Object.defineProperty,oI=(e,t,n)=>t in e?rI(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Hv=(e,t,n)=>(oI(e,typeof t!="symbol"?t+"":t,n),n);function Gf(){}function Kb(e){return e()}function Yv(){return Object.create(null)}function gg(e){e.forEach(Kb)}function Jb(e){return typeof e=="function"}function sI(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function aI(e){return Object.keys(e).length===0}function lI(e,t){e.appendChild(t)}function uI(e,t,n){e.insertBefore(t,n||null)}function Qb(e){e.parentNode&&e.parentNode.removeChild(e)}function Kv(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Eu(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function cI(e){return Array.from(e.childNodes)}function Pm(e,t,n){e.classList.toggle(t,!!n)}let Cy;function Ff(e){Cy=e}const Lh=[],Jv=[];let kh=[];const Qv=[],hI=Promise.resolve();let ny=!1;function pI(){ny||(ny=!0,hI.then($b))}function iy(e){kh.push(e)}const j_=new Set;let Eh=0;function $b(){if(Eh!==0)return;const e=Cy;do{try{for(;Eh<Lh.length;){const t=Lh[Eh];Eh++,Ff(t),fI(t.$$)}}catch(t){throw Lh.length=0,Eh=0,t}for(Ff(null),Lh.length=0,Eh=0;Jv.length;)Jv.pop()();for(let t=0;t<kh.length;t+=1){const n=kh[t];j_.has(n)||(j_.add(n),n())}kh.length=0}while(Lh.length);for(;Qv.length;)Qv.pop()();ny=!1,j_.clear(),Ff(e)}function fI(e){if(e.fragment!==null){e.update(),gg(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(iy)}}function dI(e){const t=[],n=[];kh.forEach(i=>e.indexOf(i)===-1?t.push(i):n.push(i)),n.forEach(i=>i()),kh=t}const mI=new Set;function gI(e,t){e&&e.i&&(mI.delete(e),e.i(t))}function _I(e,t,n){const{fragment:i,after_update:r}=e.$$;i&&i.m(t,n),iy(()=>{const u=e.$$.on_mount.map(Kb).filter(Jb);e.$$.on_destroy?e.$$.on_destroy.push(...u):gg(u),e.$$.on_mount=[]}),r.forEach(iy)}function yI(e,t){const n=e.$$;n.fragment!==null&&(dI(n.after_update),gg(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function vI(e,t){e.$$.dirty[0]===-1&&(Lh.push(e),pI(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function bI(e,t,n,i,r,u,p=null,a=[-1]){const _=Cy;Ff(e);const x=e.$$={fragment:null,ctx:[],props:u,update:Gf,not_equal:r,bound:Yv(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(_?_.$$.context:[])),callbacks:Yv(),dirty:a,skip_bound:!1,root:t.target||_.$$.root};p&&p(x.root);let S=!1;if(x.ctx=n?n(e,t.props||{},(L,k,...D)=>{const F=D.length?D[0]:k;return x.ctx&&r(x.ctx[L],x.ctx[L]=F)&&(!x.skip_bound&&x.bound[L]&&x.bound[L](F),S&&vI(e,L)),k}):[],x.update(),S=!0,gg(x.before_update),x.fragment=i?i(x.ctx):!1,t.target){if(t.hydrate){const L=cI(t.target);x.fragment&&x.fragment.l(L),L.forEach(Qb)}else x.fragment&&x.fragment.c();t.intro&&gI(e.$$.fragment),_I(e,t.target,t.anchor),$b()}Ff(_)}class xI{constructor(){Hv(this,"$$"),Hv(this,"$$set")}$destroy(){yI(this,1),this.$destroy=Gf}$on(t,n){if(!Jb(n))return Gf;const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(n),()=>{const r=i.indexOf(n);r!==-1&&i.splice(r,1)}}$set(t){this.$$set&&!aI(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const wI="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(wI);function SI(e){let t,n,i;return{c(){t=Kv("svg"),n=Kv("path"),Eu(n,"stroke-width","4"),Eu(n,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),Eu(n,"class","svelte-gzo3ar"),Eu(t,"width",i=e[0]==="list"?20:void 0),Eu(t,"viewBox","0 0 70 85"),Eu(t,"fill","none"),Eu(t,"class","svelte-gzo3ar"),Pm(t,"in-map",e[0]!=="list"),Pm(t,"list-icon",e[0]==="list")},m(r,u){uI(r,t,u),lI(t,n)},p(r,[u]){u&1&&i!==(i=r[0]==="list"?20:void 0)&&Eu(t,"width",i),u&1&&Pm(t,"in-map",r[0]!=="list"),u&1&&Pm(t,"list-icon",r[0]==="list")},i:Gf,o:Gf,d(r){r&&Qb(t)}}}function EI(e,t,n){let{displayIn:i}=t;return e.$$set=r=>{"displayIn"in r&&n(0,i=r.displayIn)},[i]}class II extends xI{constructor(t){super(),bI(this,t,EI,SI,sI,{displayIn:0})}}const CI=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],TI={decimalLatitude:40.123,decimalLongitude:-74.123},LI=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],MI=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222}];function PI(){const e=[];return CI.forEach(t=>{t.decimalLatitude?e.push(t):e.push({...t,...TI})}),[...e,...LI,...MI]}const AI=PI();AI.map(e=>e.verbatimCoordinates);/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function kI(e,t){var n={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},i,r,u,p;return p={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function a(x){return function(S){return _([x,S])}}function _(x){if(i)throw new TypeError("Generator is already executing.");for(;n;)try{if(i=1,r&&(u=x[0]&2?r.return:x[0]?r.throw||((u=r.return)&&u.call(r),0):r.next)&&!(u=u.call(r,x[1])).done)return u;switch(r=0,u&&(x=[x[0]&2,u.value]),x[0]){case 0:case 1:u=x;break;case 4:return n.label++,{value:x[1],done:!1};case 5:n.label++,r=x[1],x=[0];continue;case 7:x=n.ops.pop(),n.trys.pop();continue;default:if(u=n.trys,!(u=u.length>0&&u[u.length-1])&&(x[0]===6||x[0]===2)){n=0;continue}if(x[0]===3&&(!u||x[1]>u[0]&&x[1]<u[3])){n.label=x[1];break}if(x[0]===6&&n.label<u[1]){n.label=u[1],u=x;break}if(u&&n.label<u[2]){n.label=u[2],n.ops.push(x);break}u[2]&&n.ops.pop(),n.trys.pop();continue}x=t.call(e,n)}catch(S){x=[6,S],r=0}finally{i=u=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}var Ru=function(){function e(t,n){this.next=null,this.key=t,this.data=n,this.left=null,this.right=null}return e}();function NI(e,t){return e>t?1:e<t?-1:0}function Tu(e,t,n){for(var i=new Ru(null,null),r=i,u=i;;){var p=n(e,t.key);if(p<0){if(t.left===null)break;if(n(e,t.left.key)<0){var a=t.left;if(t.left=a.right,a.right=t,t=a,t.left===null)break}u.left=t,u=t,t=t.left}else if(p>0){if(t.right===null)break;if(n(e,t.right.key)>0){var a=t.right;if(t.right=a.left,a.left=t,t=a,t.right===null)break}r.right=t,r=t,t=t.right}else break}return r.right=t.left,u.left=t.right,t.left=i.right,t.right=i.left,t}function Z_(e,t,n,i){var r=new Ru(e,t);if(n===null)return r.left=r.right=null,r;n=Tu(e,n,i);var u=i(e,n.key);return u<0?(r.left=n.left,r.right=n,n.left=null):u>=0&&(r.right=n.right,r.left=n,n.right=null),r}function $v(e,t,n){var i=null,r=null;if(t){t=Tu(e,t,n);var u=n(t.key,e);u===0?(i=t.left,r=t.right):u<0?(r=t.right,t.right=null,i=t):(i=t.left,t.left=null,r=t)}return{left:i,right:r}}function DI(e,t,n){return t===null?e:(e===null||(t=Tu(e.key,t,n),t.left=e),t)}function ry(e,t,n,i,r){if(e){i(""+t+(n?" ":" ")+r(e)+`
`);var u=t+(n?"    ":"   ");e.left&&ry(e.left,u,!1,i,r),e.right&&ry(e.right,u,!0,i,r)}}var Ty=function(){function e(t){t===void 0&&(t=NI),this._root=null,this._size=0,this._comparator=t}return e.prototype.insert=function(t,n){return this._size++,this._root=Z_(t,n,this._root,this._comparator)},e.prototype.add=function(t,n){var i=new Ru(t,n);this._root===null&&(i.left=i.right=null,this._size++,this._root=i);var r=this._comparator,u=Tu(t,this._root,r),p=r(t,u.key);return p===0?this._root=u:(p<0?(i.left=u.left,i.right=u,u.left=null):p>0&&(i.right=u.right,i.left=u,u.right=null),this._size++,this._root=i),this._root},e.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},e.prototype._remove=function(t,n,i){var r;if(n===null)return null;n=Tu(t,n,i);var u=i(t,n.key);return u===0?(n.left===null?r=n.right:(r=Tu(t,n.left,i),r.right=n.right),this._size--,r):n},e.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=Tu(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},e.prototype.findStatic=function(t){for(var n=this._root,i=this._comparator;n;){var r=i(t,n.key);if(r===0)return n;r<0?n=n.left:n=n.right}return null},e.prototype.find=function(t){return this._root&&(this._root=Tu(t,this._root,this._comparator),this._comparator(t,this._root.key)!==0)?null:this._root},e.prototype.contains=function(t){for(var n=this._root,i=this._comparator;n;){var r=i(t,n.key);if(r===0)return!0;r<0?n=n.left:n=n.right}return!1},e.prototype.forEach=function(t,n){for(var i=this._root,r=[],u=!1;!u;)i!==null?(r.push(i),i=i.left):r.length!==0?(i=r.pop(),t.call(n,i),i=i.right):u=!0;return this},e.prototype.range=function(t,n,i,r){for(var u=[],p=this._comparator,a=this._root,_;u.length!==0||a;)if(a)u.push(a),a=a.left;else{if(a=u.pop(),_=p(a.key,n),_>0)break;if(p(a.key,t)>=0&&i.call(r,a))return this;a=a.right}return this},e.prototype.keys=function(){var t=[];return this.forEach(function(n){var i=n.key;return t.push(i)}),t},e.prototype.values=function(){var t=[];return this.forEach(function(n){var i=n.data;return t.push(i)}),t},e.prototype.min=function(){return this._root?this.minNode(this._root).key:null},e.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},e.prototype.minNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.left;)t=t.left;return t},e.prototype.maxNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.right;)t=t.right;return t},e.prototype.at=function(t){for(var n=this._root,i=!1,r=0,u=[];!i;)if(n)u.push(n),n=n.left;else if(u.length>0){if(n=u.pop(),r===t)return n;r++,n=n.right}else i=!0;return null},e.prototype.next=function(t){var n=this._root,i=null;if(t.right){for(i=t.right;i.left;)i=i.left;return i}for(var r=this._comparator;n;){var u=r(t.key,n.key);if(u===0)break;u<0?(i=n,n=n.left):n=n.right}return i},e.prototype.prev=function(t){var n=this._root,i=null;if(t.left!==null){for(i=t.left;i.right;)i=i.right;return i}for(var r=this._comparator;n;){var u=r(t.key,n.key);if(u===0)break;u<0?n=n.left:(i=n,n=n.right)}return i},e.prototype.clear=function(){return this._root=null,this._size=0,this},e.prototype.toList=function(){return OI(this._root)},e.prototype.load=function(t,n,i){n===void 0&&(n=[]),i===void 0&&(i=!1);var r=t.length,u=this._comparator;if(i&&ay(t,n,0,r-1,u),this._root===null)this._root=oy(t,n,0,r),this._size=r;else{var p=zI(this.toList(),RI(t,n),u);r=this._size+r,this._root=sy({head:p},0,r)}return this},e.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.toString=function(t){t===void 0&&(t=function(i){return String(i.key)});var n=[];return ry(this._root,"",!0,function(i){return n.push(i)},t),n.join("")},e.prototype.update=function(t,n,i){var r=this._comparator,u=$v(t,this._root,r),p=u.left,a=u.right;r(t,n)<0?a=Z_(n,i,a,r):p=Z_(n,i,p,r),this._root=DI(p,a,r)},e.prototype.split=function(t){return $v(t,this._root,this._comparator)},e.prototype[Symbol.iterator]=function(){var t,n,i;return kI(this,function(r){switch(r.label){case 0:t=this._root,n=[],i=!1,r.label=1;case 1:return i?[3,6]:t===null?[3,2]:(n.push(t),t=t.left,[3,5]);case 2:return n.length===0?[3,4]:(t=n.pop(),[4,t]);case 3:return r.sent(),t=t.right,[3,5];case 4:i=!0,r.label=5;case 5:return[3,1];case 6:return[2]}})},e}();function oy(e,t,n,i){var r=i-n;if(r>0){var u=n+Math.floor(r/2),p=e[u],a=t[u],_=new Ru(p,a);return _.left=oy(e,t,n,u),_.right=oy(e,t,u+1,i),_}return null}function RI(e,t){for(var n=new Ru(null,null),i=n,r=0;r<e.length;r++)i=i.next=new Ru(e[r],t[r]);return i.next=null,n.next}function OI(e){for(var t=e,n=[],i=!1,r=new Ru(null,null),u=r;!i;)t?(n.push(t),t=t.left):n.length>0?(t=u=u.next=n.pop(),t=t.right):i=!0;return u.next=null,r.next}function sy(e,t,n){var i=n-t;if(i>0){var r=t+Math.floor(i/2),u=sy(e,t,r),p=e.head;return p.left=u,e.head=e.head.next,p.right=sy(e,r+1,n),p}return null}function zI(e,t,n){for(var i=new Ru(null,null),r=i,u=e,p=t;u!==null&&p!==null;)n(u.key,p.key)<0?(r.next=u,u=u.next):(r.next=p,p=p.next),r=r.next;return u!==null?r.next=u:p!==null&&(r.next=p),i.next}function ay(e,t,n,i,r){if(!(n>=i)){for(var u=e[n+i>>1],p=n-1,a=i+1;;){do p++;while(r(e[p],u)<0);do a--;while(r(e[a],u)>0);if(p>=a)break;var _=e[p];e[p]=e[a],e[a]=_,_=t[p],t[p]=t[a],t[a]=_}ay(e,t,n,a,r),ay(e,t,a+1,i,r)}}function va(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t1(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ko(e,t,n){return t&&t1(e.prototype,t),n&&t1(e,n),e}var vf=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},ly=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,r=e.ll.y<t.ll.y?t.ll.y:e.ll.y,u=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:r},ur:{x:i,y:u}}},Mu=Number.EPSILON;Mu===void 0&&(Mu=Math.pow(2,-52));var FI=Mu*Mu,uy=function(e,t){if(-Mu<e&&e<Mu&&-Mu<t&&t<Mu)return 0;var n=e-t;return n*n<FI*e*t?0:e<t?-1:1},BI=function(){function e(){va(this,e),this.reset()}return Ko(e,[{key:"reset",value:function(){this.xRounder=new e1,this.yRounder=new e1}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),e}(),e1=function(){function e(){va(this,e),this.tree=new Ty,this.round(0)}return Ko(e,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&uy(n.key,i.key)===0)return this.tree.remove(t),i.key;var r=this.tree.next(n);return r!==null&&uy(n.key,r.key)===0?(this.tree.remove(t),r.key):t}}]),e}(),qf=new BI,Bf=function(e,t){return e.x*t.y-e.y*t.x},tx=function(e,t){return e.x*t.x+e.y*t.y},n1=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},r={x:n.x-e.x,y:n.y-e.y},u=Bf(i,r);return uy(u,0)},Hm=function(e){return Math.sqrt(tx(e,e))},VI=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},r={x:n.x-e.x,y:n.y-e.y};return Bf(r,i)/Hm(r)/Hm(i)},UI=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},r={x:n.x-e.x,y:n.y-e.y};return tx(r,i)/Hm(r)/Hm(i)},i1=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},r1=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},GI=function(e,t,n,i){if(t.x===0)return r1(n,i,e.x);if(i.x===0)return r1(e,t,n.x);if(t.y===0)return i1(n,i,e.y);if(i.y===0)return i1(e,t,n.y);var r=Bf(t,i);if(r==0)return null;var u={x:n.x-e.x,y:n.y-e.y},p=Bf(u,t)/r,a=Bf(u,i)/r,_=e.x+a*t.x,x=n.x+p*i.x,S=e.y+a*t.y,L=n.y+p*i.y,k=(_+x)/2,D=(S+L)/2;return{x:k,y:D}},al=function(){Ko(e,null,[{key:"compare",value:function(t,n){var i=e.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:Ym.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function e(t,n){va(this,e),t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=n}return Ko(e,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,r=n.length;i<r;i++){var u=n[i];this.point.events.push(u),u.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var r=n+1;r<t;r++){var u=this.point.events[r];u.consumedBy===void 0&&i.otherSE.point.events===u.otherSE.point.events&&i.segment.consume(u.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var r=this.point.events[n];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&t.push(r)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,r=function(u){var p=u.otherSE;i.set(u,{sine:VI(n.point,t.point,p.point),cosine:UI(n.point,t.point,p.point)})};return function(u,p){i.has(u)||r(u),i.has(p)||r(p);var a=i.get(u),_=a.sine,x=a.cosine,S=i.get(p),L=S.sine,k=S.cosine;return _>=0&&L>=0?x<k?1:x>k?-1:0:_<0&&L<0?x<k?-1:x>k?1:0:L<_?-1:L>_?1:0}}}]),e}(),qI=0,Ym=function(){Ko(e,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,r=n.leftSE.point.x,u=t.rightSE.point.x,p=n.rightSE.point.x;if(p<i)return 1;if(u<r)return-1;var a=t.leftSE.point.y,_=n.leftSE.point.y,x=t.rightSE.point.y,S=n.rightSE.point.y;if(i<r){if(_<a&&_<x)return 1;if(_>a&&_>x)return-1;var L=t.comparePoint(n.leftSE.point);if(L<0)return 1;if(L>0)return-1;var k=n.comparePoint(t.rightSE.point);return k!==0?k:-1}if(i>r){if(a<_&&a<S)return-1;if(a>_&&a>S)return 1;var D=n.comparePoint(t.leftSE.point);if(D!==0)return D;var F=t.comparePoint(n.rightSE.point);return F<0?1:F>0?-1:1}if(a<_)return-1;if(a>_)return 1;if(u<p){var K=n.comparePoint(t.rightSE.point);if(K!==0)return K}if(u>p){var W=t.comparePoint(n.rightSE.point);if(W<0)return 1;if(W>0)return-1}if(u!==p){var Q=x-a,U=u-i,X=S-_,Y=p-r;if(Q>U&&X<Y)return 1;if(Q<U&&X>Y)return-1}return u>p?1:u<p||x<S?-1:x>S?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function e(t,n,i,r){va(this,e),this.id=++qI,this.leftSE=t,t.segment=this,t.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=t,this.rings=i,this.windings=r}return Ko(e,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,r=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var u=(t.y-n.y)/r.y,p=n.x+u*r.x;if(t.x===p)return 0;var a=(t.x-n.x)/r.x,_=n.y+a*r.y;return t.y===_?0:t.y<_?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),r=ly(n,i);if(r===null)return null;var u=this.leftSE.point,p=this.rightSE.point,a=t.leftSE.point,_=t.rightSE.point,x=vf(n,a)&&this.comparePoint(a)===0,S=vf(i,u)&&t.comparePoint(u)===0,L=vf(n,_)&&this.comparePoint(_)===0,k=vf(i,p)&&t.comparePoint(p)===0;if(S&&x)return k&&!L?p:!k&&L?_:null;if(S)return L&&u.x===_.x&&u.y===_.y?null:u;if(x)return k&&p.x===a.x&&p.y===a.y?null:a;if(k&&L)return null;if(k)return p;if(L)return _;var D=GI(u,this.vector(),a,t.vector());return D===null||!vf(r,D)?null:qf.round(D.x,D.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,r=new al(t,!0),u=new al(t,!1),p=this.rightSE;this.replaceRightSE(u),n.push(u),n.push(r);var a=new e(r,p,this.rings.slice(),this.windings.slice());return al.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),al.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(r.checkForConsuming(),u.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var r=e.compare(n,i);if(r!==0){if(r>0){var u=n;n=i,i=u}if(n.prev===i){var p=n;n=i,i=p}for(var a=0,_=i.rings.length;a<_;a++){var x=i.rings[a],S=i.windings[a],L=n.rings.indexOf(x);L===-1?(n.rings.push(x),n.windings.push(S)):n.windings[L]+=S}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,r=this._afterState.multiPolys,u=0,p=this.rings.length;u<p;u++){var a=this.rings[u],_=this.windings[u],x=n.indexOf(a);x===-1?(n.push(a),i.push(_)):i[x]+=_}for(var S=[],L=[],k=0,D=n.length;k<D;k++)if(i[k]!==0){var F=n[k],K=F.poly;if(L.indexOf(K)===-1)if(F.isExterior)S.push(K);else{L.indexOf(K)===-1&&L.push(K);var W=S.indexOf(F.poly);W!==-1&&S.splice(W,1)}}for(var Q=0,U=S.length;Q<U;Q++){var X=S[Q].multiPoly;r.indexOf(X)===-1&&r.push(X)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Ra.type){case"union":{var i=t.length===0,r=n.length===0;this._isInResult=i!==r;break}case"intersection":{var u,p;t.length<n.length?(u=t.length,p=n.length):(u=n.length,p=t.length),this._isInResult=p===Ra.numMultiPolys&&u<p;break}case"xor":{var a=Math.abs(t.length-n.length);this._isInResult=a%2===1;break}case"difference":{var _=function(x){return x.length===1&&x[0].isSubject};this._isInResult=_(t)!==_(n);break}default:throw new Error("Unrecognized operation type found ".concat(Ra.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var r,u,p,a=al.comparePoints(t,n);if(a<0)r=t,u=n,p=1;else if(a>0)r=n,u=t,p=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var _=new al(r,!0),x=new al(u,!1);return new e(_,x,[i],[p])}}]),e}(),o1=function(){function e(t,n,i){if(va(this,e),!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=i,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var r=qf.round(t[0][0],t[0][1]);this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};for(var u=r,p=1,a=t.length;p<a;p++){if(typeof t[p][0]!="number"||typeof t[p][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var _=qf.round(t[p][0],t[p][1]);_.x===u.x&&_.y===u.y||(this.segments.push(Ym.fromRing(u,_,this)),_.x<this.bbox.ll.x&&(this.bbox.ll.x=_.x),_.y<this.bbox.ll.y&&(this.bbox.ll.y=_.y),_.x>this.bbox.ur.x&&(this.bbox.ur.x=_.x),_.y>this.bbox.ur.y&&(this.bbox.ur.y=_.y),u=_)}(r.x!==u.x||r.y!==u.y)&&this.segments.push(Ym.fromRing(u,r,this))}return Ko(e,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var r=this.segments[n];t.push(r.leftSE),t.push(r.rightSE)}return t}}]),e}(),jI=function(){function e(t,n){if(va(this,e),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new o1(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var i=1,r=t.length;i<r;i++){var u=new o1(t[i],this,!1);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.interiorRings.push(u)}this.multiPoly=n}return Ko(e,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var r=this.interiorRings[n].getSweepEvents(),u=0,p=r.length;u<p;u++)t.push(r[u]);return t}}]),e}(),s1=function(){function e(t,n){if(va(this,e),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var i=0,r=t.length;i<r;i++){var u=new jI(t[i],this);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.polys.push(u)}this.isSubject=n}return Ko(e,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var r=this.polys[n].getSweepEvents(),u=0,p=r.length;u<p;u++)t.push(r[u]);return t}}]),e}(),ZI=function(){Ko(e,null,[{key:"factory",value:function(t){for(var n=[],i=0,r=t.length;i<r;i++){var u=t[i];if(!(!u.isInResult()||u.ringOut)){for(var p=null,a=u.leftSE,_=u.rightSE,x=[a],S=a.point,L=[];p=a,a=_,x.push(a),a.point!==S;)for(;;){var k=a.getAvailableLinkedEvents();if(k.length===0){var D=x[0].point,F=x[x.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(D.x,",")+" ".concat(D.y,"]. Last matching segment found ends at")+" [".concat(F.x,", ").concat(F.y,"]."))}if(k.length===1){_=k[0].otherSE;break}for(var K=null,W=0,Q=L.length;W<Q;W++)if(L[W].point===a.point){K=W;break}if(K!==null){var U=L.splice(K)[0],X=x.splice(U.index);X.unshift(X[0].otherSE),n.push(new e(X.reverse()));continue}L.push({index:x.length,point:a.point});var Y=a.getLeftmostComparator(p);_=k.sort(Y)[0].otherSE;break}n.push(new e(x))}}return n}}]);function e(t){va(this,e),this.events=t;for(var n=0,i=t.length;n<i;n++)t[n].segment.ringOut=this;this.poly=null}return Ko(e,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,r=this.events.length-1;i<r;i++){var u=this.events[i].point,p=this.events[i+1].point;n1(u,t,p)!==0&&(n.push(u),t=u)}if(n.length===1)return null;var a=n[0],_=n[1];n1(a,t,_)===0&&n.shift(),n.push(n[0]);for(var x=this.isExteriorRing()?1:-1,S=this.isExteriorRing()?0:n.length-1,L=this.isExteriorRing()?n.length:-1,k=[],D=S;D!=L;D+=x)k.push([n[D].x,n[D].y]);return k}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var r=this.events[n];al.compare(t,r)>0&&(t=r)}for(var u=t.segment.prevInResult(),p=u?u.prevInResult():null;;){if(!u)return null;if(!p)return u.ringOut;if(p.ringOut!==u.ringOut)return p.ringOut.enclosingRing()!==u.ringOut?u.ringOut:u.ringOut.enclosingRing();u=p.prevInResult(),p=u?u.prevInResult():null}}}]),e}(),a1=function(){function e(t){va(this,e),this.exteriorRing=t,t.poly=this,this.interiorRings=[]}return Ko(e,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var r=this.interiorRings[n].getGeom();r!==null&&t.push(r)}return t}}]),e}(),WI=function(){function e(t){va(this,e),this.rings=t,this.polys=this._composePolys(t)}return Ko(e,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var r=this.polys[n].getGeom();r!==null&&t.push(r)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,r=t.length;i<r;i++){var u=t[i];if(!u.poly)if(u.isExteriorRing())n.push(new a1(u));else{var p=u.enclosingRing();p.poly||n.push(new a1(p)),p.poly.addInterior(u)}}return n}}]),e}(),XI=function(){function e(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ym.compare;va(this,e),this.queue=t,this.tree=new Ty(n),this.segments=[]}return Ko(e,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var r=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!r)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var u=r,p=r,a=void 0,_=void 0;a===void 0;)u=this.tree.prev(u),u===null?a=null:u.key.consumedBy===void 0&&(a=u.key);for(;_===void 0;)p=this.tree.next(p),p===null?_=null:p.key.consumedBy===void 0&&(_=p.key);if(t.isLeft){var x=null;if(a){var S=a.getIntersection(n);if(S!==null&&(n.isAnEndpoint(S)||(x=S),!a.isAnEndpoint(S)))for(var L=this._splitSafely(a,S),k=0,D=L.length;k<D;k++)i.push(L[k])}var F=null;if(_){var K=_.getIntersection(n);if(K!==null&&(n.isAnEndpoint(K)||(F=K),!_.isAnEndpoint(K)))for(var W=this._splitSafely(_,K),Q=0,U=W.length;Q<U;Q++)i.push(W[Q])}if(x!==null||F!==null){var X=null;if(x===null)X=F;else if(F===null)X=x;else{var Y=al.comparePoints(x,F);X=Y<=0?x:F}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var pt=n.split(X),gt=0,ct=pt.length;gt<ct;gt++)i.push(pt[gt])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=a)}else{if(a&&_){var ht=a.getIntersection(_);if(ht!==null){if(!a.isAnEndpoint(ht))for(var rt=this._splitSafely(a,ht),Et=0,mt=rt.length;Et<mt;Et++)i.push(rt[Et]);if(!_.isAnEndpoint(ht))for(var dt=this._splitSafely(_,ht),Jt=0,kt=dt.length;Jt<kt;Jt++)i.push(dt[Jt])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var r=t.split(n);return r.push(i),t.consumedBy===void 0&&this.tree.insert(t),r}}]),e}(),l1=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,HI=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,YI=function(){function e(){va(this,e)}return Ko(e,[{key:"run",value:function(t,n,i){Ra.type=t,qf.reset();for(var r=[new s1(n,!0)],u=0,p=i.length;u<p;u++)r.push(new s1(i[u],!1));if(Ra.numMultiPolys=r.length,Ra.type==="difference")for(var a=r[0],_=1;_<r.length;)ly(r[_].bbox,a.bbox)!==null?_++:r.splice(_,1);if(Ra.type==="intersection"){for(var x=0,S=r.length;x<S;x++)for(var L=r[x],k=x+1,D=r.length;k<D;k++)if(ly(L.bbox,r[k].bbox)===null)return[]}for(var F=new Ty(al.compare),K=0,W=r.length;K<W;K++)for(var Q=r[K].getSweepEvents(),U=0,X=Q.length;U<X;U++)if(F.insert(Q[U]),F.size>l1)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var Y=new XI(F),pt=F.size,gt=F.pop();gt;){var ct=gt.key;if(F.size===pt){var ht=ct.segment;throw new Error("Unable to pop() ".concat(ct.isLeft?"left":"right"," SweepEvent ")+"[".concat(ct.point.x,", ").concat(ct.point.y,"] from segment #").concat(ht.id," ")+"[".concat(ht.leftSE.point.x,", ").concat(ht.leftSE.point.y,"] -> ")+"[".concat(ht.rightSE.point.x,", ").concat(ht.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(F.size>l1)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(Y.segments.length>HI)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var rt=Y.process(ct),Et=0,mt=rt.length;Et<mt;Et++){var dt=rt[Et];dt.consumedBy===void 0&&F.insert(dt)}pt=F.size,gt=F.pop()}qf.reset();var Jt=ZI.factory(Y.segments),kt=new WI(Jt);return kt.getGeom()}}]),e}(),Ra=new YI,KI=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ra.run("union",e,n)},JI=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ra.run("intersection",e,n)},QI=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ra.run("xor",e,n)},$I=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ra.run("difference",e,n)},ex={union:KI,intersection:JI,xor:QI,difference:$I},Xo=63710088e-1,nx={centimeters:Xo*100,centimetres:Xo*100,degrees:Xo/111325,feet:Xo*3.28084,inches:Xo*39.37,kilometers:Xo/1e3,kilometres:Xo/1e3,meters:Xo,metres:Xo,miles:Xo/1609.344,millimeters:Xo*1e3,millimetres:Xo*1e3,nauticalmiles:Xo/1852,radians:1,yards:Xo*1.0936};function _g(e,t,n){n===void 0&&(n={});var i={type:"Feature"};return(n.id===0||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=t||{},i.geometry=e,i}function tC(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!u1(e[0])||!u1(e[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:e};return _g(i,t,n)}function ix(e,t,n){n===void 0&&(n={});for(var i=0,r=e;i<r.length;i++){var u=r[i];if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var p=0;p<u[u.length-1].length;p++)if(u[u.length-1][p]!==u[0][p])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:e};return _g(a,t,n)}function cy(e,t){t===void 0&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function rx(e,t,n){n===void 0&&(n={});var i={type:"MultiPolygon",coordinates:e};return _g(i,t,n)}function eC(e,t){t===void 0&&(t="kilometers");var n=nx[t];if(!n)throw new Error(t+" units is invalid");return e*n}function nC(e,t){t===void 0&&(t="kilometers");var n=nx[t];if(!n)throw new Error(t+" units is invalid");return e/n}function u1(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Km(e){return e.type==="Feature"?e.geometry:e}function iC(e,t,n){n===void 0&&(n={});var i=Km(e),r=Km(t),u=ex.union(i.coordinates,r.coordinates);return u.length===0?null:u.length===1?ix(u[0],n.properties):rx(u,n.properties)}function ox(e,t,n){if(e!==null)for(var i,r,u,p,a,_,x,S=0,L=0,k,D=e.type,F=D==="FeatureCollection",K=D==="Feature",W=F?e.features.length:1,Q=0;Q<W;Q++){x=F?e.features[Q].geometry:K?e.geometry:e,k=x?x.type==="GeometryCollection":!1,a=k?x.geometries.length:1;for(var U=0;U<a;U++){var X=0,Y=0;if(p=k?x.geometries[U]:x,p!==null){_=p.coordinates;var pt=p.type;switch(S=n&&(pt==="Polygon"||pt==="MultiPolygon")?1:0,pt){case null:break;case"Point":if(t(_,L,Q,X,Y)===!1)return!1;L++,X++;break;case"LineString":case"MultiPoint":for(i=0;i<_.length;i++){if(t(_[i],L,Q,X,Y)===!1)return!1;L++,pt==="MultiPoint"&&X++}pt==="LineString"&&X++;break;case"Polygon":case"MultiLineString":for(i=0;i<_.length;i++){for(r=0;r<_[i].length-S;r++){if(t(_[i][r],L,Q,X,Y)===!1)return!1;L++}pt==="MultiLineString"&&X++,pt==="Polygon"&&Y++}pt==="Polygon"&&X++;break;case"MultiPolygon":for(i=0;i<_.length;i++){for(Y=0,r=0;r<_[i].length;r++){for(u=0;u<_[i][r].length-S;u++){if(t(_[i][r][u],L,Q,X,Y)===!1)return!1;L++}Y++}X++}break;case"GeometryCollection":for(i=0;i<p.geometries.length;i++)if(ox(p.geometries[i],t,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function c1(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var n=0;n<e.features.length&&t(e.features[n],n)!==!1;n++);}function sx(e,t){var n,i,r,u,p,a,_,x,S,L,k=0,D=e.type==="FeatureCollection",F=e.type==="Feature",K=D?e.features.length:1;for(n=0;n<K;n++){for(a=D?e.features[n].geometry:F?e.geometry:e,x=D?e.features[n].properties:F?e.properties:{},S=D?e.features[n].bbox:F?e.bbox:void 0,L=D?e.features[n].id:F?e.id:void 0,_=a?a.type==="GeometryCollection":!1,p=_?a.geometries.length:1,r=0;r<p;r++){if(u=_?a.geometries[r]:a,u===null){if(t(null,k,x,S,L)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(u,k,x,S,L)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<u.geometries.length;i++)if(t(u.geometries[i],k,x,S,L)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}k++}}function hy(e){var t=[1/0,1/0,-1/0,-1/0];return ox(e,function(n){t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}hy.default=hy;function rC(e,t){t===void 0&&(t={});var n=hy(e),i=(n[0]+n[2])/2,r=(n[1]+n[3])/2;return tC([i,r],t.properties,t)}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(e){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var t=Object(this),n=Math.max(Math.min(t.length,9007199254740991),0)||0,i=1 in arguments&&parseInt(Number(arguments[1]),10)||0;i=i<0?Math.max(n+i,0):Math.min(i,n);var r=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:n;for(r=r<0?Math.max(n+arguments[2],0):Math.min(r,n);i<r;)t[i]=e,++i;return t},writable:!0});Number.isFinite=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)};Number.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(e){return e!==e};Math.trunc=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};var yc=function(){};yc.prototype.interfaces_=function(){return[]};yc.prototype.getClass=function(){return yc};yc.prototype.equalsWithTolerance=function(e,t,n){return Math.abs(e-t)<=n};var di=function(e){function t(n){e.call(this,n),this.name="IllegalArgumentException",this.message=n,this.stack=new e().stack}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),Qe=function(){},ax={MAX_VALUE:{configurable:!0}};Qe.isNaN=function(e){return Number.isNaN(e)};Qe.doubleToLongBits=function(e){return e};Qe.longBitsToDouble=function(e){return e};Qe.isInfinite=function(e){return!Number.isFinite(e)};ax.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(Qe,ax);var xs=function(){},yg=function(){},Nh=function(){};function ws(){}var Pt=function e(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=e.NULL_ORDINATE;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.z=t.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=e.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},kc={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};Pt.prototype.setOrdinate=function(e,t){switch(e){case Pt.X:this.x=t;break;case Pt.Y:this.y=t;break;case Pt.Z:this.z=t;break;default:throw new di("Invalid ordinate index: "+e)}};Pt.prototype.equals2D=function(){if(arguments.length===1){var e=arguments[0];return!(this.x!==e.x||this.y!==e.y)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return!(!yc.equalsWithTolerance(this.x,t.x,n)||!yc.equalsWithTolerance(this.y,t.y,n))}};Pt.prototype.getOrdinate=function(e){switch(e){case Pt.X:return this.x;case Pt.Y:return this.y;case Pt.Z:return this.z}throw new di("Invalid ordinate index: "+e)};Pt.prototype.equals3D=function(e){return this.x===e.x&&this.y===e.y&&(this.z===e.z||Qe.isNaN(this.z))&&Qe.isNaN(e.z)};Pt.prototype.equals=function(e){return e instanceof Pt?this.equals2D(e):!1};Pt.prototype.equalInZ=function(e,t){return yc.equalsWithTolerance(this.z,e.z,t)};Pt.prototype.compareTo=function(e){var t=e;return this.x<t.x?-1:this.x>t.x?1:this.y<t.y?-1:this.y>t.y?1:0};Pt.prototype.clone=function(){};Pt.prototype.copy=function(){return new Pt(this)};Pt.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};Pt.prototype.distance3D=function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return Math.sqrt(t*t+n*n+i*i)};Pt.prototype.distance=function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)};Pt.prototype.hashCode=function(){var e=17;return e=37*e+Pt.hashCode(this.x),e=37*e+Pt.hashCode(this.y),e};Pt.prototype.setCoordinate=function(e){this.x=e.x,this.y=e.y,this.z=e.z};Pt.prototype.interfaces_=function(){return[xs,yg,ws]};Pt.prototype.getClass=function(){return Pt};Pt.hashCode=function(){if(arguments.length===1){var e=arguments[0],t=Qe.doubleToLongBits(e);return Math.trunc((t^t)>>>32)}};kc.DimensionalComparator.get=function(){return ql};kc.serialVersionUID.get=function(){return 6683108902428367e3};kc.NULL_ORDINATE.get=function(){return Qe.NaN};kc.X.get=function(){return 0};kc.Y.get=function(){return 1};kc.Z.get=function(){return 2};Object.defineProperties(Pt,kc);var ql=function(e){if(this._dimensionsToTest=2,arguments.length!==0&&arguments.length===1){var t=arguments[0];if(t!==2&&t!==3)throw new di("only 2 or 3 dimensions may be specified");this._dimensionsToTest=t}};ql.prototype.compare=function(e,t){var n=e,i=t,r=ql.compare(n.x,i.x);if(r!==0)return r;var u=ql.compare(n.y,i.y);if(u!==0)return u;if(this._dimensionsToTest<=2)return 0;var p=ql.compare(n.z,i.z);return p};ql.prototype.interfaces_=function(){return[Nh]};ql.prototype.getClass=function(){return ql};ql.compare=function(e,t){return e<t?-1:e>t?1:Qe.isNaN(e)?Qe.isNaN(t)?0:-1:Qe.isNaN(t)?1:0};var Dh=function(){};Dh.prototype.create=function(){};Dh.prototype.interfaces_=function(){return[]};Dh.prototype.getClass=function(){return Dh};var Dt=function(){},pd={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};Dt.prototype.interfaces_=function(){return[]};Dt.prototype.getClass=function(){return Dt};Dt.toLocationSymbol=function(e){switch(e){case Dt.EXTERIOR:return"e";case Dt.BOUNDARY:return"b";case Dt.INTERIOR:return"i";case Dt.NONE:return"-"}throw new di("Unknown location value: "+e)};pd.INTERIOR.get=function(){return 0};pd.BOUNDARY.get=function(){return 1};pd.EXTERIOR.get=function(){return 2};pd.NONE.get=function(){return-1};Object.defineProperties(Dt,pd);var We=function(e,t){return e.interfaces_&&e.interfaces_().indexOf(t)>-1},Jo=function(){},lx={LOG_10:{configurable:!0}};Jo.prototype.interfaces_=function(){return[]};Jo.prototype.getClass=function(){return Jo};Jo.log10=function(e){var t=Math.log(e);return Qe.isInfinite(t)||Qe.isNaN(t)?t:t/Jo.LOG_10};Jo.min=function(e,t,n,i){var r=e;return t<r&&(r=t),n<r&&(r=n),i<r&&(r=i),r};Jo.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1],n=arguments[2];return e<t?t:e>n?n:e}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var i=arguments[0],r=arguments[1],u=arguments[2];return i<r?r:i>u?u:i}};Jo.wrap=function(e,t){return e<0?t- -e%t:e%t};Jo.max=function(){if(arguments.length===3){var e=arguments[0],t=arguments[1],n=arguments[2],i=e;return t>i&&(i=t),n>i&&(i=n),i}else if(arguments.length===4){var r=arguments[0],u=arguments[1],p=arguments[2],a=arguments[3],_=r;return u>_&&(_=u),p>_&&(_=p),a>_&&(_=a),_}};Jo.average=function(e,t){return(e+t)/2};lx.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(Jo,lx);var ba=function(e){this.str=e};ba.prototype.append=function(e){this.str+=e};ba.prototype.setCharAt=function(e,t){this.str=this.str.substr(0,e)+t+this.str.substr(e+1)};ba.prototype.toString=function(e){return this.str};var la=function(e){this.value=e};la.prototype.intValue=function(){return this.value};la.prototype.compareTo=function(e){return this.value<e?-1:this.value>e?1:0};la.isNaN=function(e){return Number.isNaN(e)};var jf=function(){};jf.isWhitespace=function(e){return e<=32&&e>=0||e===127};jf.toUpperCase=function(e){return e.toUpperCase()};var Ut=function e(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof e){var n=arguments[0];this.init(n)}else if(typeof arguments[0]=="string"){var i=arguments[0];e.call(this,e.parse(i))}}else if(arguments.length===2){var r=arguments[0],u=arguments[1];this.init(r,u)}},Gs={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Ut.prototype.le=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<=e._lo};Ut.prototype.extractSignificantDigits=function(e,t){var n=this.abs(),i=Ut.magnitude(n._hi),r=Ut.TEN.pow(i);n=n.divide(r),n.gt(Ut.TEN)?(n=n.divide(Ut.TEN),i+=1):n.lt(Ut.ONE)&&(n=n.multiply(Ut.TEN),i-=1);for(var u=i+1,p=new ba,a=Ut.MAX_PRINT_DIGITS-1,_=0;_<=a;_++){e&&_===u&&p.append(".");var x=Math.trunc(n._hi);if(x<0)break;var S=!1,L=0;x>9?(S=!0,L="9"):L="0"+x,p.append(L),n=n.subtract(Ut.valueOf(x)).multiply(Ut.TEN),S&&n.selfAdd(Ut.TEN);var k=!0,D=Ut.magnitude(n._hi);if(D<0&&Math.abs(D)>=a-_&&(k=!1),!k)break}return t[0]=i,p.toString()};Ut.prototype.sqr=function(){return this.multiply(this)};Ut.prototype.doubleValue=function(){return this._hi+this._lo};Ut.prototype.subtract=function(){if(arguments[0]instanceof Ut){var e=arguments[0];return this.add(e.negate())}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.add(-t)}};Ut.prototype.equals=function(){if(arguments.length===1){var e=arguments[0];return this._hi===e._hi&&this._lo===e._lo}};Ut.prototype.isZero=function(){return this._hi===0&&this._lo===0};Ut.prototype.selfSubtract=function(){if(arguments[0]instanceof Ut){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e._hi,-e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t,0)}};Ut.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};Ut.prototype.min=function(e){return this.le(e)?this:e};Ut.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof Ut){var e=arguments[0];return this.selfDivide(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.selfDivide(t,0)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1],r=null,u=null,p=null,a=null,_=null,x=null,S=null,L=null;return _=this._hi/n,x=Ut.SPLIT*_,r=x-_,L=Ut.SPLIT*n,r=x-r,u=_-r,p=L-n,S=_*n,p=L-p,a=n-p,L=r*p-S+r*a+u*p+u*a,x=(this._hi-S-L+this._lo-_*i)/n,L=_+x,this._hi=L,this._lo=_-L+x,this}};Ut.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};Ut.prototype.divide=function(){if(arguments[0]instanceof Ut){var e=arguments[0],t=null,n=null,i=null,r=null,u=null,p=null,a=null,_=null;u=this._hi/e._hi,p=Ut.SPLIT*u,t=p-u,_=Ut.SPLIT*e._hi,t=p-t,n=u-t,i=_-e._hi,a=u*e._hi,i=_-i,r=e._hi-i,_=t*i-a+t*r+n*i+n*r,p=(this._hi-a-_+this._lo-u*e._lo)/e._hi,_=u+p;var x=_,S=u-_+p;return new Ut(x,S)}else if(typeof arguments[0]=="number"){var L=arguments[0];return Qe.isNaN(L)?Ut.createNaN():Ut.copy(this).selfDivide(L,0)}};Ut.prototype.ge=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>=e._lo};Ut.prototype.pow=function(e){if(e===0)return Ut.valueOf(1);var t=new Ut(this),n=Ut.valueOf(1),i=Math.abs(e);if(i>1)for(;i>0;)i%2===1&&n.selfMultiply(t),i/=2,i>0&&(t=t.sqr());else n=t;return e<0?n.reciprocal():n};Ut.prototype.ceil=function(){if(this.isNaN())return Ut.NaN;var e=Math.ceil(this._hi),t=0;return e===this._hi&&(t=Math.ceil(this._lo)),new Ut(e,t)};Ut.prototype.compareTo=function(e){var t=e;return this._hi<t._hi?-1:this._hi>t._hi?1:this._lo<t._lo?-1:this._lo>t._lo?1:0};Ut.prototype.rint=function(){if(this.isNaN())return this;var e=this.add(.5);return e.floor()};Ut.prototype.setValue=function(){if(arguments[0]instanceof Ut){var e=arguments[0];return this.init(e),this}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.init(t),this}};Ut.prototype.max=function(e){return this.ge(e)?this:e};Ut.prototype.sqrt=function(){if(this.isZero())return Ut.valueOf(0);if(this.isNegative())return Ut.NaN;var e=1/Math.sqrt(this._hi),t=this._hi*e,n=Ut.valueOf(t),i=this.subtract(n.sqr()),r=i._hi*(e*.5);return n.add(r)};Ut.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof Ut){var e=arguments[0];return this.selfAdd(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0],n=null,i=null,r=null,u=null,p=null,a=null;return r=this._hi+t,p=r-this._hi,u=r-p,u=t-p+(this._hi-u),a=u+this._lo,n=r+a,i=a+(r-n),this._hi=n+i,this._lo=i+(n-this._hi),this}}else if(arguments.length===2){var _=arguments[0],x=arguments[1],S=null,L=null,k=null,D=null,F=null,K=null,W=null,Q=null;F=this._hi+_,k=this._lo+x,W=F-this._hi,Q=k-this._lo,K=F-W,D=k-Q,K=_-W+(this._hi-K),D=x-Q+(this._lo-D),W=K+k,S=F+W,L=W+(F-S),W=D+L;var U=S+W,X=W+(S-U);return this._hi=U,this._lo=X,this}};Ut.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof Ut){var e=arguments[0];return this.selfMultiply(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.selfMultiply(t,0)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1],r=null,u=null,p=null,a=null,_=null,x=null;_=Ut.SPLIT*this._hi,r=_-this._hi,x=Ut.SPLIT*n,r=_-r,u=this._hi-r,p=x-n,_=this._hi*n,p=x-p,a=n-p,x=r*p-_+r*a+u*p+u*a+(this._hi*i+this._lo*n);var S=_+x;r=_-S;var L=x+r;return this._hi=S,this._lo=L,this}};Ut.prototype.selfSqr=function(){return this.selfMultiply(this)};Ut.prototype.floor=function(){if(this.isNaN())return Ut.NaN;var e=Math.floor(this._hi),t=0;return e===this._hi&&(t=Math.floor(this._lo)),new Ut(e,t)};Ut.prototype.negate=function(){return this.isNaN()?this:new Ut(-this._hi,-this._lo)};Ut.prototype.clone=function(){};Ut.prototype.multiply=function(){if(arguments[0]instanceof Ut){var e=arguments[0];return e.isNaN()?Ut.createNaN():Ut.copy(this).selfMultiply(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return Qe.isNaN(t)?Ut.createNaN():Ut.copy(this).selfMultiply(t,0)}};Ut.prototype.isNaN=function(){return Qe.isNaN(this._hi)};Ut.prototype.intValue=function(){return Math.trunc(this._hi)};Ut.prototype.toString=function(){var e=Ut.magnitude(this._hi);return e>=-3&&e<=20?this.toStandardNotation():this.toSciNotation()};Ut.prototype.toStandardNotation=function(){var e=this.getSpecialNumberString();if(e!==null)return e;var t=new Array(1).fill(null),n=this.extractSignificantDigits(!0,t),i=t[0]+1,r=n;if(n.charAt(0)===".")r="0"+n;else if(i<0)r="0."+Ut.stringOfChar("0",-i)+n;else if(n.indexOf(".")===-1){var u=i-n.length,p=Ut.stringOfChar("0",u);r=n+p+".0"}return this.isNegative()?"-"+r:r};Ut.prototype.reciprocal=function(){var e=null,t=null,n=null,i=null,r=null,u=null,p=null,a=null;r=1/this._hi,u=Ut.SPLIT*r,e=u-r,a=Ut.SPLIT*this._hi,e=u-e,t=r-e,n=a-this._hi,p=r*this._hi,n=a-n,i=this._hi-n,a=e*n-p+e*i+t*n+t*i,u=(1-p-a-r*this._lo)/this._hi;var _=r+u,x=r-_+u;return new Ut(_,x)};Ut.prototype.toSciNotation=function(){if(this.isZero())return Ut.SCI_NOT_ZERO;var e=this.getSpecialNumberString();if(e!==null)return e;var t=new Array(1).fill(null),n=this.extractSignificantDigits(!1,t),i=Ut.SCI_NOT_EXPONENT_CHAR+t[0];if(n.charAt(0)==="0")throw new Error("Found leading zero: "+n);var r="";n.length>1&&(r=n.substring(1));var u=n.charAt(0)+"."+r;return this.isNegative()?"-"+u+i:u+i};Ut.prototype.abs=function(){return this.isNaN()?Ut.NaN:this.isNegative()?this.negate():new Ut(this)};Ut.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};Ut.prototype.lt=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<e._lo};Ut.prototype.add=function(){if(arguments[0]instanceof Ut){var e=arguments[0];return Ut.copy(this).selfAdd(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return Ut.copy(this).selfAdd(t)}};Ut.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this._hi=e,this._lo=0}else if(arguments[0]instanceof Ut){var t=arguments[0];this._hi=t._hi,this._lo=t._lo}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this._hi=n,this._lo=i}};Ut.prototype.gt=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>e._lo};Ut.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};Ut.prototype.trunc=function(){return this.isNaN()?Ut.NaN:this.isPositive()?this.floor():this.ceil()};Ut.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};Ut.prototype.interfaces_=function(){return[ws,xs,yg]};Ut.prototype.getClass=function(){return Ut};Ut.sqr=function(e){return Ut.valueOf(e).selfMultiply(e)};Ut.valueOf=function(){if(typeof arguments[0]=="string"){var e=arguments[0];return Ut.parse(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return new Ut(t)}};Ut.sqrt=function(e){return Ut.valueOf(e).sqrt()};Ut.parse=function(e){for(var t=0,n=e.length;jf.isWhitespace(e.charAt(t));)t++;var i=!1;if(t<n){var r=e.charAt(t);(r==="-"||r==="+")&&(t++,r==="-"&&(i=!0))}for(var u=new Ut,p=0,a=0,_=0;!(t>=n);){var x=e.charAt(t);if(t++,jf.isDigit(x)){var S=x-"0";u.selfMultiply(Ut.TEN),u.selfAdd(S),p++;continue}if(x==="."){a=p;continue}if(x==="e"||x==="E"){var L=e.substring(t);try{_=la.parseInt(L)}catch(W){throw W instanceof Error?new Error("Invalid exponent "+L+" in string "+e):W}finally{}break}throw new Error("Unexpected character '"+x+"' at position "+t+" in string "+e)}var k=u,D=p-a-_;if(D===0)k=u;else if(D>0){var F=Ut.TEN.pow(D);k=u.divide(F)}else if(D<0){var K=Ut.TEN.pow(-D);k=u.multiply(K)}return i?k.negate():k};Ut.createNaN=function(){return new Ut(Qe.NaN,Qe.NaN)};Ut.copy=function(e){return new Ut(e)};Ut.magnitude=function(e){var t=Math.abs(e),n=Math.log(t)/Math.log(10),i=Math.trunc(Math.floor(n)),r=Math.pow(10,i);return r*10<=t&&(i+=1),i};Ut.stringOfChar=function(e,t){for(var n=new ba,i=0;i<t;i++)n.append(e);return n.toString()};Gs.PI.get=function(){return new Ut(3.141592653589793,12246467991473532e-32)};Gs.TWO_PI.get=function(){return new Ut(6.283185307179586,24492935982947064e-32)};Gs.PI_2.get=function(){return new Ut(1.5707963267948966,6123233995736766e-32)};Gs.E.get=function(){return new Ut(2.718281828459045,14456468917292502e-32)};Gs.NaN.get=function(){return new Ut(Qe.NaN,Qe.NaN)};Gs.EPS.get=function(){return 123259516440783e-46};Gs.SPLIT.get=function(){return 134217729};Gs.MAX_PRINT_DIGITS.get=function(){return 32};Gs.TEN.get=function(){return Ut.valueOf(10)};Gs.ONE.get=function(){return Ut.valueOf(1)};Gs.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};Gs.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(Ut,Gs);var yo=function(){},ux={DP_SAFE_EPSILON:{configurable:!0}};yo.prototype.interfaces_=function(){return[]};yo.prototype.getClass=function(){return yo};yo.orientationIndex=function(e,t,n){var i=yo.orientationIndexFilter(e,t,n);if(i<=1)return i;var r=Ut.valueOf(t.x).selfAdd(-e.x),u=Ut.valueOf(t.y).selfAdd(-e.y),p=Ut.valueOf(n.x).selfAdd(-t.x),a=Ut.valueOf(n.y).selfAdd(-t.y);return r.selfMultiply(a).selfSubtract(u.selfMultiply(p)).signum()};yo.signOfDet2x2=function(e,t,n,i){var r=e.multiply(i).selfSubtract(t.multiply(n));return r.signum()};yo.intersection=function(e,t,n,i){var r=Ut.valueOf(i.y).selfSubtract(n.y).selfMultiply(Ut.valueOf(t.x).selfSubtract(e.x)),u=Ut.valueOf(i.x).selfSubtract(n.x).selfMultiply(Ut.valueOf(t.y).selfSubtract(e.y)),p=r.subtract(u),a=Ut.valueOf(i.x).selfSubtract(n.x).selfMultiply(Ut.valueOf(e.y).selfSubtract(n.y)),_=Ut.valueOf(i.y).selfSubtract(n.y).selfMultiply(Ut.valueOf(e.x).selfSubtract(n.x)),x=a.subtract(_),S=x.selfDivide(p).doubleValue(),L=Ut.valueOf(e.x).selfAdd(Ut.valueOf(t.x).selfSubtract(e.x).selfMultiply(S)).doubleValue(),k=Ut.valueOf(t.x).selfSubtract(e.x).selfMultiply(Ut.valueOf(e.y).selfSubtract(n.y)),D=Ut.valueOf(t.y).selfSubtract(e.y).selfMultiply(Ut.valueOf(e.x).selfSubtract(n.x)),F=k.subtract(D),K=F.selfDivide(p).doubleValue(),W=Ut.valueOf(n.y).selfAdd(Ut.valueOf(i.y).selfSubtract(n.y).selfMultiply(K)).doubleValue();return new Pt(L,W)};yo.orientationIndexFilter=function(e,t,n){var i=null,r=(e.x-n.x)*(t.y-n.y),u=(e.y-n.y)*(t.x-n.x),p=r-u;if(r>0){if(u<=0)return yo.signum(p);i=r+u}else if(r<0){if(u>=0)return yo.signum(p);i=-r-u}else return yo.signum(p);var a=yo.DP_SAFE_EPSILON*i;return p>=a||-p>=a?yo.signum(p):2};yo.signum=function(e){return e>0?1:e<0?-1:0};ux.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(yo,ux);var Mn=function(){},fd={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};fd.X.get=function(){return 0};fd.Y.get=function(){return 1};fd.Z.get=function(){return 2};fd.M.get=function(){return 3};Mn.prototype.setOrdinate=function(e,t,n){};Mn.prototype.size=function(){};Mn.prototype.getOrdinate=function(e,t){};Mn.prototype.getCoordinate=function(){};Mn.prototype.getCoordinateCopy=function(e){};Mn.prototype.getDimension=function(){};Mn.prototype.getX=function(e){};Mn.prototype.clone=function(){};Mn.prototype.expandEnvelope=function(e){};Mn.prototype.copy=function(){};Mn.prototype.getY=function(e){};Mn.prototype.toCoordinateArray=function(){};Mn.prototype.interfaces_=function(){return[yg]};Mn.prototype.getClass=function(){return Mn};Object.defineProperties(Mn,fd);var cx=function(){},op=function(e){function t(){e.call(this,"Projective point not representable on the Cartesian plane.")}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(cx),Cr=function(){};Cr.arraycopy=function(e,t,n,i,r){for(var u=0,p=t;p<t+r;p++)n[i+u]=e[p],u++};Cr.getProperty=function(e){return{"line.separator":`
`}[e]};var ks=function e(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],i=arguments[1];this.x=n,this.y=i,this.w=1}else if(arguments[0]instanceof e&&arguments[1]instanceof e){var r=arguments[0],u=arguments[1];this.x=r.y*u.w-u.y*r.w,this.y=u.x*r.w-r.x*u.w,this.w=r.x*u.y-u.x*r.y}else if(arguments[0]instanceof Pt&&arguments[1]instanceof Pt){var p=arguments[0],a=arguments[1];this.x=p.y-a.y,this.y=a.x-p.x,this.w=p.x*a.y-a.x*p.y}}else if(arguments.length===3){var _=arguments[0],x=arguments[1],S=arguments[2];this.x=_,this.y=x,this.w=S}else if(arguments.length===4){var L=arguments[0],k=arguments[1],D=arguments[2],F=arguments[3],K=L.y-k.y,W=k.x-L.x,Q=L.x*k.y-k.x*L.y,U=D.y-F.y,X=F.x-D.x,Y=D.x*F.y-F.x*D.y;this.x=W*Y-X*Q,this.y=U*Q-K*Y,this.w=K*X-U*W}};ks.prototype.getY=function(){var e=this.y/this.w;if(Qe.isNaN(e)||Qe.isInfinite(e))throw new op;return e};ks.prototype.getX=function(){var e=this.x/this.w;if(Qe.isNaN(e)||Qe.isInfinite(e))throw new op;return e};ks.prototype.getCoordinate=function(){var e=new Pt;return e.x=this.getX(),e.y=this.getY(),e};ks.prototype.interfaces_=function(){return[]};ks.prototype.getClass=function(){return ks};ks.intersection=function(e,t,n,i){var r=e.y-t.y,u=t.x-e.x,p=e.x*t.y-t.x*e.y,a=n.y-i.y,_=i.x-n.x,x=n.x*i.y-i.x*n.y,S=u*x-_*p,L=a*p-r*x,k=r*_-a*u,D=S/k,F=L/k;if(Qe.isNaN(D)||Qe.isInfinite(D)||Qe.isNaN(F)||Qe.isInfinite(F))throw new op;return new Pt(D,F)};var ke=function e(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof Pt){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof e){var n=arguments[0];this.init(n)}}else if(arguments.length===2){var i=arguments[0],r=arguments[1];this.init(i.x,r.x,i.y,r.y)}else if(arguments.length===4){var u=arguments[0],p=arguments[1],a=arguments[2],_=arguments[3];this.init(u,p,a,_)}},hx={serialVersionUID:{configurable:!0}};ke.prototype.getArea=function(){return this.getWidth()*this.getHeight()};ke.prototype.equals=function(e){if(!(e instanceof ke))return!1;var t=e;return this.isNull()?t.isNull():this._maxx===t.getMaxX()&&this._maxy===t.getMaxY()&&this._minx===t.getMinX()&&this._miny===t.getMinY()};ke.prototype.intersection=function(e){if(this.isNull()||e.isNull()||!this.intersects(e))return new ke;var t=this._minx>e._minx?this._minx:e._minx,n=this._miny>e._miny?this._miny:e._miny,i=this._maxx<e._maxx?this._maxx:e._maxx,r=this._maxy<e._maxy?this._maxy:e._maxy;return new ke(t,i,n,r)};ke.prototype.isNull=function(){return this._maxx<this._minx};ke.prototype.getMaxX=function(){return this._maxx};ke.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof Pt){var e=arguments[0];return this.covers(e.x,e.y)}else if(arguments[0]instanceof ke){var t=arguments[0];return this.isNull()||t.isNull()?!1:t.getMinX()>=this._minx&&t.getMaxX()<=this._maxx&&t.getMinY()>=this._miny&&t.getMaxY()<=this._maxy}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.isNull()?!1:n>=this._minx&&n<=this._maxx&&i>=this._miny&&i<=this._maxy}};ke.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof ke){var e=arguments[0];return this.isNull()||e.isNull()?!1:!(e._minx>this._maxx||e._maxx<this._minx||e._miny>this._maxy||e._maxy<this._miny)}else if(arguments[0]instanceof Pt){var t=arguments[0];return this.intersects(t.x,t.y)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.isNull()?!1:!(n>this._maxx||n<this._minx||i>this._maxy||i<this._miny)}};ke.prototype.getMinY=function(){return this._miny};ke.prototype.getMinX=function(){return this._minx};ke.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof Pt){var e=arguments[0];this.expandToInclude(e.x,e.y)}else if(arguments[0]instanceof ke){var t=arguments[0];if(t.isNull())return null;this.isNull()?(this._minx=t.getMinX(),this._maxx=t.getMaxX(),this._miny=t.getMinY(),this._maxy=t.getMaxY()):(t._minx<this._minx&&(this._minx=t._minx),t._maxx>this._maxx&&(this._maxx=t._maxx),t._miny<this._miny&&(this._miny=t._miny),t._maxy>this._maxy&&(this._maxy=t._maxy))}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.isNull()?(this._minx=n,this._maxx=n,this._miny=i,this._maxy=i):(n<this._minx&&(this._minx=n),n>this._maxx&&(this._maxx=n),i<this._miny&&(this._miny=i),i>this._maxy&&(this._maxy=i))}};ke.prototype.minExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e<t?e:t};ke.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};ke.prototype.compareTo=function(e){var t=e;return this.isNull()?t.isNull()?0:-1:t.isNull()?1:this._minx<t._minx?-1:this._minx>t._minx?1:this._miny<t._miny?-1:this._miny>t._miny?1:this._maxx<t._maxx?-1:this._maxx>t._maxx?1:this._maxy<t._maxy?-1:this._maxy>t._maxy?1:0};ke.prototype.translate=function(e,t){if(this.isNull())return null;this.init(this.getMinX()+e,this.getMaxX()+e,this.getMinY()+t,this.getMaxY()+t)};ke.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};ke.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};ke.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};ke.prototype.maxExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e>t?e:t};ke.prototype.expandBy=function(){if(arguments.length===1){var e=arguments[0];this.expandBy(e,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=t,this._maxx+=t,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};ke.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof ke){var e=arguments[0];return this.covers(e)}else if(arguments[0]instanceof Pt){var t=arguments[0];return this.covers(t)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.covers(n,i)}};ke.prototype.centre=function(){return this.isNull()?null:new Pt((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};ke.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof Pt){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof ke){var t=arguments[0];this._minx=t._minx,this._maxx=t._maxx,this._miny=t._miny,this._maxy=t._maxy}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.init(n.x,i.x,n.y,i.y)}else if(arguments.length===4){var r=arguments[0],u=arguments[1],p=arguments[2],a=arguments[3];r<u?(this._minx=r,this._maxx=u):(this._minx=u,this._maxx=r),p<a?(this._miny=p,this._maxy=a):(this._miny=a,this._maxy=p)}};ke.prototype.getMaxY=function(){return this._maxy};ke.prototype.distance=function(e){if(this.intersects(e))return 0;var t=0;this._maxx<e._minx?t=e._minx-this._maxx:this._minx>e._maxx&&(t=this._minx-e._maxx);var n=0;return this._maxy<e._miny?n=e._miny-this._maxy:this._miny>e._maxy&&(n=this._miny-e._maxy),t===0?n:n===0?t:Math.sqrt(t*t+n*n)};ke.prototype.hashCode=function(){var e=17;return e=37*e+Pt.hashCode(this._minx),e=37*e+Pt.hashCode(this._maxx),e=37*e+Pt.hashCode(this._miny),e=37*e+Pt.hashCode(this._maxy),e};ke.prototype.interfaces_=function(){return[xs,ws]};ke.prototype.getClass=function(){return ke};ke.intersects=function(){if(arguments.length===3){var e=arguments[0],t=arguments[1],n=arguments[2];return n.x>=(e.x<t.x?e.x:t.x)&&n.x<=(e.x>t.x?e.x:t.x)&&n.y>=(e.y<t.y?e.y:t.y)&&n.y<=(e.y>t.y?e.y:t.y)}else if(arguments.length===4){var i=arguments[0],r=arguments[1],u=arguments[2],p=arguments[3],a=Math.min(u.x,p.x),_=Math.max(u.x,p.x),x=Math.min(i.x,r.x),S=Math.max(i.x,r.x);return!(x>_||S<a||(a=Math.min(u.y,p.y),_=Math.max(u.y,p.y),x=Math.min(i.y,r.y),S=Math.max(i.y,r.y),x>_)||S<a)}};hx.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties(ke,hx);var Qs={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},vg=function(e){this.geometryFactory=e||new _n};vg.prototype.read=function(e){var t,n,i;e=e.replace(/[\n\r]/g," ");var r=Qs.typeStr.exec(e);if(e.search("EMPTY")!==-1&&(r=Qs.emptyTypeStr.exec(e),r[2]=void 0),r&&(n=r[1].toLowerCase(),i=r[2],Mh[n]&&(t=Mh[n].apply(this,[i]))),t===void 0)throw new Error("Could not parse WKT "+e);return t};vg.prototype.write=function(e){return this.extractGeometry(e)};vg.prototype.extractGeometry=function(e){var t=e.getGeometryType().toLowerCase();if(!ol[t])return null;var n=t.toUpperCase(),i;return e.isEmpty()?i=n+" EMPTY":i=n+"("+ol[t].apply(this,[e])+")",i};var ol={coordinate:function(e){return e.x+" "+e.y},point:function(e){return ol.coordinate.call(this,e._coordinates._coordinates[0])},multipoint:function(e){for(var t=this,n=[],i=0,r=e._geometries.length;i<r;++i)n.push("("+ol.point.apply(t,[e._geometries[i]])+")");return n.join(",")},linestring:function(e){for(var t=this,n=[],i=0,r=e._points._coordinates.length;i<r;++i)n.push(ol.coordinate.apply(t,[e._points._coordinates[i]]));return n.join(",")},linearring:function(e){for(var t=this,n=[],i=0,r=e._points._coordinates.length;i<r;++i)n.push(ol.coordinate.apply(t,[e._points._coordinates[i]]));return n.join(",")},multilinestring:function(e){for(var t=this,n=[],i=0,r=e._geometries.length;i<r;++i)n.push("("+ol.linestring.apply(t,[e._geometries[i]])+")");return n.join(",")},polygon:function(e){var t=this,n=[];n.push("("+ol.linestring.apply(this,[e._shell])+")");for(var i=0,r=e._holes.length;i<r;++i)n.push("("+ol.linestring.apply(t,[e._holes[i]])+")");return n.join(",")},multipolygon:function(e){for(var t=this,n=[],i=0,r=e._geometries.length;i<r;++i)n.push("("+ol.polygon.apply(t,[e._geometries[i]])+")");return n.join(",")},geometrycollection:function(e){for(var t=this,n=[],i=0,r=e._geometries.length;i<r;++i)n.push(t.extractGeometry(e._geometries[i]));return n.join(",")}},Mh={point:function(e){if(e===void 0)return this.geometryFactory.createPoint();var t=e.trim().split(Qs.spaces);return this.geometryFactory.createPoint(new Pt(Number.parseFloat(t[0]),Number.parseFloat(t[1])))},multipoint:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiPoint();for(var n,i=e.trim().split(","),r=[],u=0,p=i.length;u<p;++u)n=i[u].replace(Qs.trimParens,"$1"),r.push(Mh.point.apply(t,[n]));return this.geometryFactory.createMultiPoint(r)},linestring:function(e){if(e===void 0)return this.geometryFactory.createLineString();for(var t=e.trim().split(","),n=[],i,r=0,u=t.length;r<u;++r)i=t[r].trim().split(Qs.spaces),n.push(new Pt(Number.parseFloat(i[0]),Number.parseFloat(i[1])));return this.geometryFactory.createLineString(n)},linearring:function(e){if(e===void 0)return this.geometryFactory.createLinearRing();for(var t=e.trim().split(","),n=[],i,r=0,u=t.length;r<u;++r)i=t[r].trim().split(Qs.spaces),n.push(new Pt(Number.parseFloat(i[0]),Number.parseFloat(i[1])));return this.geometryFactory.createLinearRing(n)},multilinestring:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiLineString();for(var n,i=e.trim().split(Qs.parenComma),r=[],u=0,p=i.length;u<p;++u)n=i[u].replace(Qs.trimParens,"$1"),r.push(Mh.linestring.apply(t,[n]));return this.geometryFactory.createMultiLineString(r)},polygon:function(e){var t=this;if(e===void 0)return this.geometryFactory.createPolygon();for(var n,i,r,u=e.trim().split(Qs.parenComma),p,a=[],_=0,x=u.length;_<x;++_)n=u[_].replace(Qs.trimParens,"$1"),i=Mh.linestring.apply(t,[n]),r=t.geometryFactory.createLinearRing(i._points),_===0?p=r:a.push(r);return this.geometryFactory.createPolygon(p,a)},multipolygon:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiPolygon();for(var n,i=e.trim().split(Qs.doubleParenComma),r=[],u=0,p=i.length;u<p;++u)n=i[u].replace(Qs.trimParens,"$1"),r.push(Mh.polygon.apply(t,[n]));return this.geometryFactory.createMultiPolygon(r)},geometrycollection:function(e){var t=this;if(e===void 0)return this.geometryFactory.createGeometryCollection();e=e.replace(/,\s*([A-Za-z])/g,"|$1");for(var n=e.trim().split("|"),i=[],r=0,u=n.length;r<u;++r)i.push(t.read(n[r]));return this.geometryFactory.createGeometryCollection(i)}},Rs=function(e){this.parser=new vg(e)};Rs.prototype.write=function(e){return this.parser.write(e)};Rs.toLineString=function(e,t){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+e.x+" "+e.y+", "+t.x+" "+t.y+" )"};var fl=function(e){function t(n){e.call(this,n),this.name="RuntimeException",this.message=n,this.stack=new e().stack}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),Jm=function(e){function t(){if(e.call(this),arguments.length===0)e.call(this);else if(arguments.length===1){var n=arguments[0];e.call(this,n)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(fl),an=function(){};an.prototype.interfaces_=function(){return[]};an.prototype.getClass=function(){return an};an.shouldNeverReachHere=function(){if(arguments.length===0)an.shouldNeverReachHere(null);else if(arguments.length===1){var e=arguments[0];throw new Jm("Should never reach here"+(e!==null?": "+e:""))}};an.isTrue=function(){var e,t;if(arguments.length===1)e=arguments[0],an.isTrue(e,null);else if(arguments.length===2&&(e=arguments[0],t=arguments[1],!e))throw t===null?new Jm:new Jm(t)};an.equals=function(){var e,t,n;if(arguments.length===2)e=arguments[0],t=arguments[1],an.equals(e,t,null);else if(arguments.length===3&&(e=arguments[0],t=arguments[1],n=arguments[2],!t.equals(e)))throw new Jm("Expected "+e+" but encountered "+t+(n!==null?": "+n:""))};var bi=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Pt,this._intPt[1]=new Pt,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},Nc={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};bi.prototype.getIndexAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intLineIndex[e][t]};bi.prototype.getTopologySummary=function(){var e=new ba;return this.isEndPoint()&&e.append(" endpoint"),this._isProper&&e.append(" proper"),this.isCollinear()&&e.append(" collinear"),e.toString()};bi.prototype.computeIntersection=function(e,t,n,i){this._inputLines[0][0]=e,this._inputLines[0][1]=t,this._inputLines[1][0]=n,this._inputLines[1][1]=i,this._result=this.computeIntersect(e,t,n,i)};bi.prototype.getIntersectionNum=function(){return this._result};bi.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var e=arguments[0],t=this.getEdgeDistance(e,0),n=this.getEdgeDistance(e,1);t>n?(this._intLineIndex[e][0]=0,this._intLineIndex[e][1]=1):(this._intLineIndex[e][0]=1,this._intLineIndex[e][1]=0)}};bi.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};bi.prototype.setPrecisionModel=function(e){this._precisionModel=e};bi.prototype.isInteriorIntersection=function(){var e=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var t=arguments[0],n=0;n<this._result;n++)if(!(e._intPt[n].equals2D(e._inputLines[t][0])||e._intPt[n].equals2D(e._inputLines[t][1])))return!0;return!1}};bi.prototype.getIntersection=function(e){return this._intPt[e]};bi.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};bi.prototype.hasIntersection=function(){return this._result!==bi.NO_INTERSECTION};bi.prototype.getEdgeDistance=function(e,t){var n=bi.computeEdgeDistance(this._intPt[t],this._inputLines[e][0],this._inputLines[e][1]);return n};bi.prototype.isCollinear=function(){return this._result===bi.COLLINEAR_INTERSECTION};bi.prototype.toString=function(){return Rs.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Rs.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};bi.prototype.getEndpoint=function(e,t){return this._inputLines[e][t]};bi.prototype.isIntersection=function(e){for(var t=this,n=0;n<this._result;n++)if(t._intPt[n].equals2D(e))return!0;return!1};bi.prototype.getIntersectionAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[e][t]]};bi.prototype.interfaces_=function(){return[]};bi.prototype.getClass=function(){return bi};bi.computeEdgeDistance=function(e,t,n){var i=Math.abs(n.x-t.x),r=Math.abs(n.y-t.y),u=-1;if(e.equals(t))u=0;else if(e.equals(n))i>r?u=i:u=r;else{var p=Math.abs(e.x-t.x),a=Math.abs(e.y-t.y);i>r?u=p:u=a,u===0&&!e.equals(t)&&(u=Math.max(p,a))}return an.isTrue(!(u===0&&!e.equals(t)),"Bad distance calculation"),u};bi.nonRobustComputeEdgeDistance=function(e,t,n){var i=e.x-t.x,r=e.y-t.y,u=Math.sqrt(i*i+r*r);return an.isTrue(!(u===0&&!e.equals(t)),"Invalid distance calculation"),u};Nc.DONT_INTERSECT.get=function(){return 0};Nc.DO_INTERSECT.get=function(){return 1};Nc.COLLINEAR.get=function(){return 2};Nc.NO_INTERSECTION.get=function(){return 0};Nc.POINT_INTERSECTION.get=function(){return 1};Nc.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(bi,Nc);var Zu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isInSegmentEnvelopes=function(n){var i=new ke(this._inputLines[0][0],this._inputLines[0][1]),r=new ke(this._inputLines[1][0],this._inputLines[1][1]);return i.contains(n)&&r.contains(n)},t.prototype.computeIntersection=function(){if(arguments.length===3){var n=arguments[0],i=arguments[1],r=arguments[2];if(this._isProper=!1,ke.intersects(i,r,n)&&ve.orientationIndex(i,r,n)===0&&ve.orientationIndex(r,i,n)===0)return this._isProper=!0,(n.equals(i)||n.equals(r))&&(this._isProper=!1),this._result=e.POINT_INTERSECTION,null;this._result=e.NO_INTERSECTION}else return e.prototype.computeIntersection.apply(this,arguments)},t.prototype.normalizeToMinimum=function(n,i,r,u,p){p.x=this.smallestInAbsValue(n.x,i.x,r.x,u.x),p.y=this.smallestInAbsValue(n.y,i.y,r.y,u.y),n.x-=p.x,n.y-=p.y,i.x-=p.x,i.y-=p.y,r.x-=p.x,r.y-=p.y,u.x-=p.x,u.y-=p.y},t.prototype.safeHCoordinateIntersection=function(n,i,r,u){var p=null;try{p=ks.intersection(n,i,r,u)}catch(a){if(a instanceof op)p=t.nearestEndpoint(n,i,r,u);else throw a}finally{}return p},t.prototype.intersection=function(n,i,r,u){var p=this.intersectionWithNormalization(n,i,r,u);return this.isInSegmentEnvelopes(p)||(p=new Pt(t.nearestEndpoint(n,i,r,u))),this._precisionModel!==null&&this._precisionModel.makePrecise(p),p},t.prototype.smallestInAbsValue=function(n,i,r,u){var p=n,a=Math.abs(p);return Math.abs(i)<a&&(p=i,a=Math.abs(i)),Math.abs(r)<a&&(p=r,a=Math.abs(r)),Math.abs(u)<a&&(p=u),p},t.prototype.checkDD=function(n,i,r,u,p){var a=yo.intersection(n,i,r,u),_=this.isInSegmentEnvelopes(a);Cr.out.println("DD in env = "+_+"  --------------------- "+a),p.distance(a)>1e-4&&Cr.out.println("Distance = "+p.distance(a))},t.prototype.intersectionWithNormalization=function(n,i,r,u){var p=new Pt(n),a=new Pt(i),_=new Pt(r),x=new Pt(u),S=new Pt;this.normalizeToEnvCentre(p,a,_,x,S);var L=this.safeHCoordinateIntersection(p,a,_,x);return L.x+=S.x,L.y+=S.y,L},t.prototype.computeCollinearIntersection=function(n,i,r,u){var p=ke.intersects(n,i,r),a=ke.intersects(n,i,u),_=ke.intersects(r,u,n),x=ke.intersects(r,u,i);return p&&a?(this._intPt[0]=r,this._intPt[1]=u,e.COLLINEAR_INTERSECTION):_&&x?(this._intPt[0]=n,this._intPt[1]=i,e.COLLINEAR_INTERSECTION):p&&_?(this._intPt[0]=r,this._intPt[1]=n,r.equals(n)&&!a&&!x?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):p&&x?(this._intPt[0]=r,this._intPt[1]=i,r.equals(i)&&!a&&!_?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):a&&_?(this._intPt[0]=u,this._intPt[1]=n,u.equals(n)&&!p&&!x?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):a&&x?(this._intPt[0]=u,this._intPt[1]=i,u.equals(i)&&!p&&!_?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):e.NO_INTERSECTION},t.prototype.normalizeToEnvCentre=function(n,i,r,u,p){var a=n.x<i.x?n.x:i.x,_=n.y<i.y?n.y:i.y,x=n.x>i.x?n.x:i.x,S=n.y>i.y?n.y:i.y,L=r.x<u.x?r.x:u.x,k=r.y<u.y?r.y:u.y,D=r.x>u.x?r.x:u.x,F=r.y>u.y?r.y:u.y,K=a>L?a:L,W=x<D?x:D,Q=_>k?_:k,U=S<F?S:F,X=(K+W)/2,Y=(Q+U)/2;p.x=X,p.y=Y,n.x-=p.x,n.y-=p.y,i.x-=p.x,i.y-=p.y,r.x-=p.x,r.y-=p.y,u.x-=p.x,u.y-=p.y},t.prototype.computeIntersect=function(n,i,r,u){if(this._isProper=!1,!ke.intersects(n,i,r,u))return e.NO_INTERSECTION;var p=ve.orientationIndex(n,i,r),a=ve.orientationIndex(n,i,u);if(p>0&&a>0||p<0&&a<0)return e.NO_INTERSECTION;var _=ve.orientationIndex(r,u,n),x=ve.orientationIndex(r,u,i);if(_>0&&x>0||_<0&&x<0)return e.NO_INTERSECTION;var S=p===0&&a===0&&_===0&&x===0;return S?this.computeCollinearIntersection(n,i,r,u):(p===0||a===0||_===0||x===0?(this._isProper=!1,n.equals2D(r)||n.equals2D(u)?this._intPt[0]=n:i.equals2D(r)||i.equals2D(u)?this._intPt[0]=i:p===0?this._intPt[0]=new Pt(r):a===0?this._intPt[0]=new Pt(u):_===0?this._intPt[0]=new Pt(n):x===0&&(this._intPt[0]=new Pt(i))):(this._isProper=!0,this._intPt[0]=this.intersection(n,i,r,u)),e.POINT_INTERSECTION)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.nearestEndpoint=function(n,i,r,u){var p=n,a=ve.distancePointLine(n,r,u),_=ve.distancePointLine(i,r,u);return _<a&&(a=_,p=i),_=ve.distancePointLine(r,n,i),_<a&&(a=_,p=r),_=ve.distancePointLine(u,n,i),_<a&&(a=_,p=u),p},t}(bi),vc=function(){};vc.prototype.interfaces_=function(){return[]};vc.prototype.getClass=function(){return vc};vc.orientationIndex=function(e,t,n){var i=t.x-e.x,r=t.y-e.y,u=n.x-t.x,p=n.y-t.y;return vc.signOfDet2x2(i,r,u,p)};vc.signOfDet2x2=function(e,t,n,i){var r=null,u=null,p=null;if(r=1,e===0||i===0)return t===0||n===0?0:t>0?n>0?-r:r:n>0?r:-r;if(t===0||n===0)return i>0?e>0?r:-r:e>0?-r:r;if(t>0?i>0?t<=i||(r=-r,u=e,e=n,n=u,u=t,t=i,i=u):t<=-i?(r=-r,n=-n,i=-i):(u=e,e=-n,n=u,u=t,t=-i,i=u):i>0?-t<=i?(r=-r,e=-e,t=-t):(u=-e,e=n,n=u,u=-t,t=i,i=u):t>=i?(e=-e,t=-t,n=-n,i=-i):(r=-r,u=-e,e=-n,n=u,u=-t,t=-i,i=u),e>0)if(n>0){if(!(e<=n))return r}else return r;else{if(n>0)return-r;if(e>=n)r=-r,e=-e,n=-n;else return-r}for(;;){if(p=Math.floor(n/e),n=n-p*e,i=i-p*t,i<0)return-r;if(i>t)return r;if(e>n+n){if(t<i+i)return r}else{if(t>i+i)return-r;n=e-n,i=t-i,r=-r}if(i===0)return n===0?0:-r;if(n===0||(p=Math.floor(e/n),e=e-p*n,t=t-p*i,t<0))return r;if(t>i)return-r;if(n>e+e){if(i<t+t)return-r}else{if(i>t+t)return r;e=n-e,t=i-t,r=-r}if(t===0)return e===0?0:r;if(e===0)return-r}};var oa=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var e=arguments[0];this._p=e};oa.prototype.countSegment=function(e,t){if(e.x<this._p.x&&t.x<this._p.x)return null;if(this._p.x===t.x&&this._p.y===t.y)return this._isPointOnSegment=!0,null;if(e.y===this._p.y&&t.y===this._p.y){var n=e.x,i=t.x;return n>i&&(n=t.x,i=e.x),this._p.x>=n&&this._p.x<=i&&(this._isPointOnSegment=!0),null}if(e.y>this._p.y&&t.y<=this._p.y||t.y>this._p.y&&e.y<=this._p.y){var r=e.x-this._p.x,u=e.y-this._p.y,p=t.x-this._p.x,a=t.y-this._p.y,_=vc.signOfDet2x2(r,u,p,a);if(_===0)return this._isPointOnSegment=!0,null;a<u&&(_=-_),_>0&&this._crossingCount++}};oa.prototype.isPointInPolygon=function(){return this.getLocation()!==Dt.EXTERIOR};oa.prototype.getLocation=function(){return this._isPointOnSegment?Dt.BOUNDARY:this._crossingCount%2===1?Dt.INTERIOR:Dt.EXTERIOR};oa.prototype.isOnSegment=function(){return this._isPointOnSegment};oa.prototype.interfaces_=function(){return[]};oa.prototype.getClass=function(){return oa};oa.locatePointInRing=function(){if(arguments[0]instanceof Pt&&We(arguments[1],Mn)){for(var e=arguments[0],t=arguments[1],n=new oa(e),i=new Pt,r=new Pt,u=1;u<t.size();u++)if(t.getCoordinate(u,i),t.getCoordinate(u-1,r),n.countSegment(i,r),n.isOnSegment())return n.getLocation();return n.getLocation()}else if(arguments[0]instanceof Pt&&arguments[1]instanceof Array){for(var p=arguments[0],a=arguments[1],_=new oa(p),x=1;x<a.length;x++){var S=a[x],L=a[x-1];if(_.countSegment(S,L),_.isOnSegment())return _.getLocation()}return _.getLocation()}};var ve=function(){},Dc={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};ve.prototype.interfaces_=function(){return[]};ve.prototype.getClass=function(){return ve};ve.orientationIndex=function(e,t,n){return yo.orientationIndex(e,t,n)};ve.signedArea=function(){if(arguments[0]instanceof Array){var e=arguments[0];if(e.length<3)return 0;for(var t=0,n=e[0].x,i=1;i<e.length-1;i++){var r=e[i].x-n,u=e[i+1].y,p=e[i-1].y;t+=r*(p-u)}return t/2}else if(We(arguments[0],Mn)){var a=arguments[0],_=a.size();if(_<3)return 0;var x=new Pt,S=new Pt,L=new Pt;a.getCoordinate(0,S),a.getCoordinate(1,L);var k=S.x;L.x-=k;for(var D=0,F=1;F<_-1;F++)x.y=S.y,S.x=L.x,S.y=L.y,a.getCoordinate(F+1,L),L.x-=k,D+=S.x*(x.y-L.y);return D/2}};ve.distanceLineLine=function(e,t,n,i){if(e.equals(t))return ve.distancePointLine(e,n,i);if(n.equals(i))return ve.distancePointLine(i,e,t);var r=!1;if(!ke.intersects(e,t,n,i))r=!0;else{var u=(t.x-e.x)*(i.y-n.y)-(t.y-e.y)*(i.x-n.x);if(u===0)r=!0;else{var p=(e.y-n.y)*(i.x-n.x)-(e.x-n.x)*(i.y-n.y),a=(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y),_=a/u,x=p/u;(x<0||x>1||_<0||_>1)&&(r=!0)}}return r?Jo.min(ve.distancePointLine(e,n,i),ve.distancePointLine(t,n,i),ve.distancePointLine(n,e,t),ve.distancePointLine(i,e,t)):0};ve.isPointInRing=function(e,t){return ve.locatePointInRing(e,t)!==Dt.EXTERIOR};ve.computeLength=function(e){var t=e.size();if(t<=1)return 0;var n=0,i=new Pt;e.getCoordinate(0,i);for(var r=i.x,u=i.y,p=1;p<t;p++){e.getCoordinate(p,i);var a=i.x,_=i.y,x=a-r,S=_-u;n+=Math.sqrt(x*x+S*S),r=a,u=_}return n};ve.isCCW=function(e){var t=e.length-1;if(t<3)throw new di("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=e[0],i=0,r=1;r<=t;r++){var u=e[r];u.y>n.y&&(n=u,i=r)}var p=i;do p=p-1,p<0&&(p=t);while(e[p].equals2D(n)&&p!==i);var a=i;do a=(a+1)%t;while(e[a].equals2D(n)&&a!==i);var _=e[p],x=e[a];if(_.equals2D(n)||x.equals2D(n)||_.equals2D(x))return!1;var S=ve.computeOrientation(_,n,x),L=!1;return S===0?L=_.x>x.x:L=S>0,L};ve.locatePointInRing=function(e,t){return oa.locatePointInRing(e,t)};ve.distancePointLinePerpendicular=function(e,t,n){var i=(n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y),r=((t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y))/i;return Math.abs(r)*Math.sqrt(i)};ve.computeOrientation=function(e,t,n){return ve.orientationIndex(e,t,n)};ve.distancePointLine=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];if(t.length===0)throw new di("Line array must contain at least one vertex");for(var n=e.distance(t[0]),i=0;i<t.length-1;i++){var r=ve.distancePointLine(e,t[i],t[i+1]);r<n&&(n=r)}return n}else if(arguments.length===3){var u=arguments[0],p=arguments[1],a=arguments[2];if(p.x===a.x&&p.y===a.y)return u.distance(p);var _=(a.x-p.x)*(a.x-p.x)+(a.y-p.y)*(a.y-p.y),x=((u.x-p.x)*(a.x-p.x)+(u.y-p.y)*(a.y-p.y))/_;if(x<=0)return u.distance(p);if(x>=1)return u.distance(a);var S=((p.y-u.y)*(a.x-p.x)-(p.x-u.x)*(a.y-p.y))/_;return Math.abs(S)*Math.sqrt(_)}};ve.isOnLine=function(e,t){for(var n=new Zu,i=1;i<t.length;i++){var r=t[i-1],u=t[i];if(n.computeIntersection(e,r,u),n.hasIntersection())return!0}return!1};Dc.CLOCKWISE.get=function(){return-1};Dc.RIGHT.get=function(){return ve.CLOCKWISE};Dc.COUNTERCLOCKWISE.get=function(){return 1};Dc.LEFT.get=function(){return ve.COUNTERCLOCKWISE};Dc.COLLINEAR.get=function(){return 0};Dc.STRAIGHT.get=function(){return ve.COLLINEAR};Object.defineProperties(ve,Dc);var dl=function(){};dl.prototype.filter=function(e){};dl.prototype.interfaces_=function(){return[]};dl.prototype.getClass=function(){return dl};var je=function(){var e=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=e,this._SRID=e.getSRID()},Xa={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};je.prototype.isGeometryCollection=function(){return this.getSortIndex()===je.SORTINDEX_GEOMETRYCOLLECTION};je.prototype.getFactory=function(){return this._factory};je.prototype.getGeometryN=function(e){return this};je.prototype.getArea=function(){return 0};je.prototype.isRectangle=function(){return!1};je.prototype.equals=function(){if(arguments[0]instanceof je){var e=arguments[0];return e===null?!1:this.equalsTopo(e)}else if(arguments[0]instanceof Object){var t=arguments[0];if(!(t instanceof je))return!1;var n=t;return this.equalsExact(n)}};je.prototype.equalsExact=function(e){return this===e||this.equalsExact(e,0)};je.prototype.geometryChanged=function(){this.apply(je.geometryChangedFilter)};je.prototype.geometryChangedAction=function(){this._envelope=null};je.prototype.equalsNorm=function(e){return e===null?!1:this.norm().equalsExact(e.norm())};je.prototype.getLength=function(){return 0};je.prototype.getNumGeometries=function(){return 1};je.prototype.compareTo=function(){if(arguments.length===1){var e=arguments[0],t=e;return this.getSortIndex()!==t.getSortIndex()?this.getSortIndex()-t.getSortIndex():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(e)}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(n,i)}};je.prototype.getUserData=function(){return this._userData};je.prototype.getSRID=function(){return this._SRID};je.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};je.prototype.checkNotGeometryCollection=function(e){if(e.getSortIndex()===je.SORTINDEX_GEOMETRYCOLLECTION)throw new di("This method does not support GeometryCollection arguments")};je.prototype.equal=function(e,t,n){return n===0?e.equals(t):e.distance(t)<=n};je.prototype.norm=function(){var e=this.copy();return e.normalize(),e};je.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};je.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new ke(this._envelope)};je.prototype.setSRID=function(e){this._SRID=e};je.prototype.setUserData=function(e){this._userData=e};je.prototype.compare=function(e,t){for(var n=e.iterator(),i=t.iterator();n.hasNext()&&i.hasNext();){var r=n.next(),u=i.next(),p=r.compareTo(u);if(p!==0)return p}return n.hasNext()?1:i.hasNext()?-1:0};je.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};je.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===je.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===je.SORTINDEX_MULTIPOINT||this.getSortIndex()===je.SORTINDEX_MULTILINESTRING||this.getSortIndex()===je.SORTINDEX_MULTIPOLYGON};je.prototype.interfaces_=function(){return[yg,xs,ws]};je.prototype.getClass=function(){return je};je.hasNonEmptyElements=function(e){for(var t=0;t<e.length;t++)if(!e[t].isEmpty())return!0;return!1};je.hasNullElements=function(e){for(var t=0;t<e.length;t++)if(e[t]===null)return!0;return!1};Xa.serialVersionUID.get=function(){return 8763622679187377e3};Xa.SORTINDEX_POINT.get=function(){return 0};Xa.SORTINDEX_MULTIPOINT.get=function(){return 1};Xa.SORTINDEX_LINESTRING.get=function(){return 2};Xa.SORTINDEX_LINEARRING.get=function(){return 3};Xa.SORTINDEX_MULTILINESTRING.get=function(){return 4};Xa.SORTINDEX_POLYGON.get=function(){return 5};Xa.SORTINDEX_MULTIPOLYGON.get=function(){return 6};Xa.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};Xa.geometryChangedFilter.get=function(){return Ly};Object.defineProperties(je,Xa);var Ly=function(){};Ly.interfaces_=function(){return[dl]};Ly.filter=function(e){e.geometryChangedAction()};var Fa=function(){};Fa.prototype.filter=function(e){};Fa.prototype.interfaces_=function(){return[]};Fa.prototype.getClass=function(){return Fa};var _s=function(){},vl={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};_s.prototype.isInBoundary=function(e){};_s.prototype.interfaces_=function(){return[]};_s.prototype.getClass=function(){return _s};vl.Mod2BoundaryNodeRule.get=function(){return Rh};vl.EndPointBoundaryNodeRule.get=function(){return Oh};vl.MultiValentEndPointBoundaryNodeRule.get=function(){return zh};vl.MonoValentEndPointBoundaryNodeRule.get=function(){return Fh};vl.MOD2_BOUNDARY_RULE.get=function(){return new Rh};vl.ENDPOINT_BOUNDARY_RULE.get=function(){return new Oh};vl.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new zh};vl.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Fh};vl.OGC_SFS_BOUNDARY_RULE.get=function(){return _s.MOD2_BOUNDARY_RULE};Object.defineProperties(_s,vl);var Rh=function(){};Rh.prototype.isInBoundary=function(e){return e%2===1};Rh.prototype.interfaces_=function(){return[_s]};Rh.prototype.getClass=function(){return Rh};var Oh=function(){};Oh.prototype.isInBoundary=function(e){return e>0};Oh.prototype.interfaces_=function(){return[_s]};Oh.prototype.getClass=function(){return Oh};var zh=function(){};zh.prototype.isInBoundary=function(e){return e>1};zh.prototype.interfaces_=function(){return[_s]};zh.prototype.getClass=function(){return zh};var Fh=function(){};Fh.prototype.isInBoundary=function(e){return e===1};Fh.prototype.interfaces_=function(){return[_s]};Fh.prototype.getClass=function(){return Fh};var tr=function(){};tr.prototype.add=function(){};tr.prototype.addAll=function(){};tr.prototype.isEmpty=function(){};tr.prototype.iterator=function(){};tr.prototype.size=function(){};tr.prototype.toArray=function(){};tr.prototype.remove=function(){};function My(e){this.message=e||""}My.prototype=new Error;My.prototype.name="IndexOutOfBoundsException";var sp=function(){};sp.prototype.hasNext=function(){};sp.prototype.next=function(){};sp.prototype.remove=function(){};var Ns=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(){},t.prototype.set=function(){},t.prototype.isEmpty=function(){},t}(tr);function ap(e){this.message=e||""}ap.prototype=new Error;ap.prototype.name="NoSuchElementException";var pe=function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof tr&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.ensureCapacity=function(){},t.prototype.interfaces_=function(){return[e,tr]},t.prototype.add=function(n){return arguments.length===1?this.array_.push(n):this.array_.splice(arguments[0],arguments[1]),!0},t.prototype.clear=function(){this.array_=[]},t.prototype.addAll=function(n){for(var i=this,r=n.iterator();r.hasNext();)i.add(r.next());return!0},t.prototype.set=function(n,i){var r=this.array_[n];return this.array_[n]=i,r},t.prototype.iterator=function(){return new oC(this)},t.prototype.get=function(n){if(n<0||n>=this.size())throw new My;return this.array_[n]},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.size=function(){return this.array_.length},t.prototype.toArray=function(){for(var n=this,i=[],r=0,u=this.array_.length;r<u;r++)i.push(n.array_[r]);return i},t.prototype.remove=function(n){for(var i=this,r=!1,u=0,p=this.array_.length;u<p;u++)if(i.array_[u]===n){i.array_.splice(u,1),r=!0;break}return r},t}(Ns),oC=function(e){function t(n){e.call(this),this.arrayList_=n,this.position_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new ap;return this.arrayList_.get(this.position_++)},t.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},t.prototype.set=function(n){return this.arrayList_.set(this.position_-1,n)},t.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},t}(sp),dd=function(e){function t(){if(e.call(this),arguments.length!==0){if(arguments.length===1){var i=arguments[0];this.ensureCapacity(i.length),this.add(i,!0)}else if(arguments.length===2){var r=arguments[0],u=arguments[1];this.ensureCapacity(r.length),this.add(r,u)}}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return new Array(0).fill(null)},t.prototype.getCoordinate=function(i){return this.get(i)},t.prototype.addAll=function(){var i=this;if(arguments.length===2){for(var r=arguments[0],u=arguments[1],p=!1,a=r.iterator();a.hasNext();)i.add(a.next(),u),p=!0;return p}else return e.prototype.addAll.apply(this,arguments)},t.prototype.clone=function(){for(var i=this,r=e.prototype.clone.call(this),u=0;u<this.size();u++)r.add(u,i.get(u).copy());return r},t.prototype.toCoordinateArray=function(){return this.toArray(t.coordArrayType)},t.prototype.add=function(){var i=this;if(arguments.length===1){var r=arguments[0];e.prototype.add.call(this,r)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var u=arguments[0],p=arguments[1];return this.add(u,p,!0),!0}else if(arguments[0]instanceof Pt&&typeof arguments[1]=="boolean"){var a=arguments[0],_=arguments[1];if(!_&&this.size()>=1){var x=this.get(this.size()-1);if(x.equals2D(a))return null}e.prototype.add.call(this,a)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var S=arguments[0],L=arguments[1];return this.add(S,L),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var k=arguments[0],D=arguments[1],F=arguments[2];if(F)for(var K=0;K<k.length;K++)i.add(k[K],D);else for(var W=k.length-1;W>=0;W--)i.add(k[W],D);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof Pt){var Q=arguments[0],U=arguments[1],X=arguments[2];if(!X){var Y=this.size();if(Y>0){if(Q>0){var pt=this.get(Q-1);if(pt.equals2D(U))return null}if(Q<Y){var gt=this.get(Q);if(gt.equals2D(U))return null}}}e.prototype.add.call(this,Q,U)}}else if(arguments.length===4){var ct=arguments[0],ht=arguments[1],rt=arguments[2],Et=arguments[3],mt=1;rt>Et&&(mt=-1);for(var dt=rt;dt!==Et;dt+=mt)i.add(ct[dt],ht);return!0}},t.prototype.closeRing=function(){this.size()>0&&this.add(new Pt(this.get(0)),!1)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},Object.defineProperties(t,n),t}(pe),yn=function(){},bg={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};bg.ForwardComparator.get=function(){return Zf};bg.BidirectionalComparator.get=function(){return Bh};bg.coordArrayType.get=function(){return new Array(0).fill(null)};yn.prototype.interfaces_=function(){return[]};yn.prototype.getClass=function(){return yn};yn.isRing=function(e){return!(e.length<4||!e[0].equals2D(e[e.length-1]))};yn.ptNotInList=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(yn.indexOf(i,t)<0)return i}return null};yn.scroll=function(e,t){var n=yn.indexOf(t,e);if(n<0)return null;var i=new Array(e.length).fill(null);Cr.arraycopy(e,n,i,0,e.length-n),Cr.arraycopy(e,0,i,e.length-n,n),Cr.arraycopy(i,0,e,0,e.length)};yn.equals=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];if(e===t)return!0;if(e===null||t===null||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!e[n].equals(t[n]))return!1;return!0}else if(arguments.length===3){var i=arguments[0],r=arguments[1],u=arguments[2];if(i===r)return!0;if(i===null||r===null||i.length!==r.length)return!1;for(var p=0;p<i.length;p++)if(u.compare(i[p],r[p])!==0)return!1;return!0}};yn.intersection=function(e,t){for(var n=new dd,i=0;i<e.length;i++)t.intersects(e[i])&&n.add(e[i],!0);return n.toCoordinateArray()};yn.hasRepeatedPoints=function(e){for(var t=1;t<e.length;t++)if(e[t-1].equals(e[t]))return!0;return!1};yn.removeRepeatedPoints=function(e){if(!yn.hasRepeatedPoints(e))return e;var t=new dd(e,!1);return t.toCoordinateArray()};yn.reverse=function(e){for(var t=e.length-1,n=Math.trunc(t/2),i=0;i<=n;i++){var r=e[i];e[i]=e[t-i],e[t-i]=r}};yn.removeNull=function(e){for(var t=0,n=0;n<e.length;n++)e[n]!==null&&t++;var i=new Array(t).fill(null);if(t===0)return i;for(var r=0,u=0;u<e.length;u++)e[u]!==null&&(i[r++]=e[u]);return i};yn.copyDeep=function(){if(arguments.length===1){for(var e=arguments[0],t=new Array(e.length).fill(null),n=0;n<e.length;n++)t[n]=new Pt(e[n]);return t}else if(arguments.length===5)for(var i=arguments[0],r=arguments[1],u=arguments[2],p=arguments[3],a=arguments[4],_=0;_<a;_++)u[p+_]=new Pt(i[r+_])};yn.isEqualReversed=function(e,t){for(var n=0;n<e.length;n++){var i=e[n],r=t[e.length-n-1];if(i.compareTo(r)!==0)return!1}return!0};yn.envelope=function(e){for(var t=new ke,n=0;n<e.length;n++)t.expandToInclude(e[n]);return t};yn.toCoordinateArray=function(e){return e.toArray(yn.coordArrayType)};yn.atLeastNCoordinatesOrNothing=function(e,t){return t.length>=e?t:[]};yn.indexOf=function(e,t){for(var n=0;n<t.length;n++)if(e.equals(t[n]))return n;return-1};yn.increasingDirection=function(e){for(var t=0;t<Math.trunc(e.length/2);t++){var n=e.length-1-t,i=e[t].compareTo(e[n]);if(i!==0)return i}return 1};yn.compare=function(e,t){for(var n=0;n<e.length&&n<t.length;){var i=e[n].compareTo(t[n]);if(i!==0)return i;n++}return n<t.length?-1:n<e.length?1:0};yn.minCoordinate=function(e){for(var t=null,n=0;n<e.length;n++)(t===null||t.compareTo(e[n])>0)&&(t=e[n]);return t};yn.extract=function(e,t,n){t=Jo.clamp(t,0,e.length),n=Jo.clamp(n,-1,e.length);var i=n-t+1;n<0&&(i=0),t>=e.length&&(i=0),n<t&&(i=0);var r=new Array(i).fill(null);if(i===0)return r;for(var u=0,p=t;p<=n;p++)r[u++]=e[p];return r};Object.defineProperties(yn,bg);var Zf=function(){};Zf.prototype.compare=function(e,t){var n=e,i=t;return yn.compare(n,i)};Zf.prototype.interfaces_=function(){return[Nh]};Zf.prototype.getClass=function(){return Zf};var Bh=function(){};Bh.prototype.compare=function(e,t){var n=e,i=t;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(n.length===0)return 0;var r=yn.compare(n,i),u=yn.isEqualReversed(n,i);return u?0:r};Bh.prototype.OLDcompare=function(e,t){var n=e,i=t;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(n.length===0)return 0;for(var r=yn.increasingDirection(n),u=yn.increasingDirection(i),p=r>0?0:n.length-1,a=u>0?0:n.length-1,_=0;_<n.length;_++){var x=n[p].compareTo(i[a]);if(x!==0)return x;p+=r,a+=u}return 0};Bh.prototype.interfaces_=function(){return[Nh]};Bh.prototype.getClass=function(){return Bh};var Rc=function(){};Rc.prototype.get=function(){};Rc.prototype.put=function(){};Rc.prototype.size=function(){};Rc.prototype.values=function(){};Rc.prototype.entrySet=function(){};var sC=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Rc);function md(e){this.message=e||""}md.prototype=new Error;md.prototype.name="OperationNotSupported";function xg(){}xg.prototype=new tr;xg.prototype.contains=function(){};var Py=function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof tr&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.contains=function(n){for(var i=this,r=0,u=this.array_.length;r<u;r++){var p=i.array_[r];if(p===n)return!0}return!1},t.prototype.add=function(n){return this.contains(n)?!1:(this.array_.push(n),!0)},t.prototype.addAll=function(n){for(var i=this,r=n.iterator();r.hasNext();)i.add(r.next());return!0},t.prototype.remove=function(n){throw new Error},t.prototype.size=function(){return this.array_.length},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.toArray=function(){for(var n=this,i=[],r=0,u=this.array_.length;r<u;r++)i.push(n.array_[r]);return i},t.prototype.iterator=function(){return new aC(this)},t}(xg),aC=function(e){function t(n){e.call(this),this.hashSet_=n,this.position_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new ap;return this.hashSet_.array_[this.position_++]},t.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},t.prototype.remove=function(){throw new md},t}(sp),ll=0,Iu=1;function h1(e){return e===null?ll:e.color}function ti(e){return e===null?null:e.parent}function il(e,t){e!==null&&(e.color=t)}function W_(e){return e===null?null:e.left}function p1(e){return e===null?null:e.right}function jr(){this.root_=null,this.size_=0}jr.prototype=new sC;jr.prototype.get=function(e){for(var t=this.root_;t!==null;){var n=e.compareTo(t.key);if(n<0)t=t.left;else if(n>0)t=t.right;else return t.value}return null};jr.prototype.put=function(e,t){if(this.root_===null)return this.root_={key:e,value:t,left:null,right:null,parent:null,color:ll,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n=this.root_,i,r;do if(i=n,r=e.compareTo(n.key),r<0)n=n.left;else if(r>0)n=n.right;else{var u=n.value;return n.value=t,u}while(n!==null);var p={key:e,left:null,right:null,value:t,parent:i,color:ll,getValue:function(){return this.value},getKey:function(){return this.key}};return r<0?i.left=p:i.right=p,this.fixAfterInsertion(p),this.size_++,null};jr.prototype.fixAfterInsertion=function(e){var t=this;for(e.color=Iu;e!=null&&e!==this.root_&&e.parent.color===Iu;)if(ti(e)===W_(ti(ti(e)))){var n=p1(ti(ti(e)));h1(n)===Iu?(il(ti(e),ll),il(n,ll),il(ti(ti(e)),Iu),e=ti(ti(e))):(e===p1(ti(e))&&(e=ti(e),t.rotateLeft(e)),il(ti(e),ll),il(ti(ti(e)),Iu),t.rotateRight(ti(ti(e))))}else{var i=W_(ti(ti(e)));h1(i)===Iu?(il(ti(e),ll),il(i,ll),il(ti(ti(e)),Iu),e=ti(ti(e))):(e===W_(ti(e))&&(e=ti(e),t.rotateRight(e)),il(ti(e),ll),il(ti(ti(e)),Iu),t.rotateLeft(ti(ti(e))))}this.root_.color=ll};jr.prototype.values=function(){var e=new pe,t=this.getFirstEntry();if(t!==null)for(e.add(t.value);(t=jr.successor(t))!==null;)e.add(t.value);return e};jr.prototype.entrySet=function(){var e=new Py,t=this.getFirstEntry();if(t!==null)for(e.add(t);(t=jr.successor(t))!==null;)e.add(t);return e};jr.prototype.rotateLeft=function(e){if(e!=null){var t=e.right;e.right=t.left,t.left!=null&&(t.left.parent=e),t.parent=e.parent,e.parent===null?this.root_=t:e.parent.left===e?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t}};jr.prototype.rotateRight=function(e){if(e!=null){var t=e.left;e.left=t.right,t.right!=null&&(t.right.parent=e),t.parent=e.parent,e.parent===null?this.root_=t:e.parent.right===e?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t}};jr.prototype.getFirstEntry=function(){var e=this.root_;if(e!=null)for(;e.left!=null;)e=e.left;return e};jr.successor=function(e){if(e===null)return null;if(e.right!==null){for(var t=e.right;t.left!==null;)t=t.left;return t}else{for(var n=e.parent,i=e;n!==null&&i===n.right;)i=n,n=n.parent;return n}};jr.prototype.size=function(){return this.size_};var Wf=function(){};Wf.prototype.interfaces_=function(){return[]};Wf.prototype.getClass=function(){return Wf};function px(){}px.prototype=new xg;function ua(){this.array_=[],arguments[0]instanceof tr&&this.addAll(arguments[0])}ua.prototype=new px;ua.prototype.contains=function(e){for(var t=this,n=0,i=this.array_.length;n<i;n++){var r=t.array_[n];if(r.compareTo(e)===0)return!0}return!1};ua.prototype.add=function(e){var t=this;if(this.contains(e))return!1;for(var n=0,i=this.array_.length;n<i;n++){var r=t.array_[n];if(r.compareTo(e)===1)return t.array_.splice(n,0,e),!0}return this.array_.push(e),!0};ua.prototype.addAll=function(e){for(var t=this,n=e.iterator();n.hasNext();)t.add(n.next());return!0};ua.prototype.remove=function(e){throw new md};ua.prototype.size=function(){return this.array_.length};ua.prototype.isEmpty=function(){return this.array_.length===0};ua.prototype.toArray=function(){for(var e=this,t=[],n=0,i=this.array_.length;n<i;n++)t.push(e.array_[n]);return t};ua.prototype.iterator=function(){return new wg(this)};var wg=function(e){this.treeSet_=e,this.position_=0};wg.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new ap;return this.treeSet_.array_[this.position_++]};wg.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};wg.prototype.remove=function(){throw new md};var Au=function(){};Au.sort=function(){var e=arguments[0],t,n,i,r;if(arguments.length===1)r=function(p,a){return p.compareTo(a)},e.sort(r);else if(arguments.length===2)i=arguments[1],r=function(p,a){return i.compare(p,a)},e.sort(r);else if(arguments.length===3){n=e.slice(arguments[1],arguments[2]),n.sort();var u=e.slice(0,arguments[1]).concat(n,e.slice(arguments[2],e.length));for(e.splice(0,e.length),t=0;t<u.length;t++)e.push(u[t])}else if(arguments.length===4)for(n=e.slice(arguments[1],arguments[2]),i=arguments[3],r=function(p,a){return i.compare(p,a)},n.sort(r),u=e.slice(0,arguments[1]).concat(n,e.slice(arguments[2],e.length)),e.splice(0,e.length),t=0;t<u.length;t++)e.push(u[t])};Au.asList=function(e){for(var t=new pe,n=0,i=e.length;n<i;n++)t.add(e[n]);return t};var kn=function(){},qs={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};qs.P.get=function(){return 0};qs.L.get=function(){return 1};qs.A.get=function(){return 2};qs.FALSE.get=function(){return-1};qs.TRUE.get=function(){return-2};qs.DONTCARE.get=function(){return-3};qs.SYM_FALSE.get=function(){return"F"};qs.SYM_TRUE.get=function(){return"T"};qs.SYM_DONTCARE.get=function(){return"*"};qs.SYM_P.get=function(){return"0"};qs.SYM_L.get=function(){return"1"};qs.SYM_A.get=function(){return"2"};kn.prototype.interfaces_=function(){return[]};kn.prototype.getClass=function(){return kn};kn.toDimensionSymbol=function(e){switch(e){case kn.FALSE:return kn.SYM_FALSE;case kn.TRUE:return kn.SYM_TRUE;case kn.DONTCARE:return kn.SYM_DONTCARE;case kn.P:return kn.SYM_P;case kn.L:return kn.SYM_L;case kn.A:return kn.SYM_A}throw new di("Unknown dimension value: "+e)};kn.toDimensionValue=function(e){switch(jf.toUpperCase(e)){case kn.SYM_FALSE:return kn.FALSE;case kn.SYM_TRUE:return kn.TRUE;case kn.SYM_DONTCARE:return kn.DONTCARE;case kn.SYM_P:return kn.P;case kn.SYM_L:return kn.L;case kn.SYM_A:return kn.A}throw new di("Unknown dimension symbol: "+e)};Object.defineProperties(kn,qs);var ca=function(){};ca.prototype.filter=function(e){};ca.prototype.interfaces_=function(){return[]};ca.prototype.getClass=function(){return ca};var Os=function(){};Os.prototype.filter=function(e,t){};Os.prototype.isDone=function(){};Os.prototype.isGeometryChanged=function(){};Os.prototype.interfaces_=function(){return[]};Os.prototype.getClass=function(){return Os};var oo=function(e){function t(i,r){if(e.call(this,r),this._geometries=i||[],e.hasNullElements(this._geometries))throw new di("geometries must not contain null elements")}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){for(var i=this,r=new ke,u=0;u<this._geometries.length;u++)r.expandToInclude(i._geometries[u].getEnvelopeInternal());return r},t.prototype.getGeometryN=function(i){return this._geometries[i]},t.prototype.getSortIndex=function(){return e.SORTINDEX_GEOMETRYCOLLECTION},t.prototype.getCoordinates=function(){for(var i=this,r=new Array(this.getNumPoints()).fill(null),u=-1,p=0;p<this._geometries.length;p++)for(var a=i._geometries[p].getCoordinates(),_=0;_<a.length;_++)u++,r[u]=a[_];return r},t.prototype.getArea=function(){for(var i=this,r=0,u=0;u<this._geometries.length;u++)r+=i._geometries[u].getArea();return r},t.prototype.equalsExact=function(){var i=this;if(arguments.length===2){var r=arguments[0],u=arguments[1];if(!this.isEquivalentClass(r))return!1;var p=r;if(this._geometries.length!==p._geometries.length)return!1;for(var a=0;a<this._geometries.length;a++)if(!i._geometries[a].equalsExact(p._geometries[a],u))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var i=this,r=0;r<this._geometries.length;r++)i._geometries[r].normalize();Au.sort(this._geometries)},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},t.prototype.getBoundaryDimension=function(){for(var i=this,r=kn.FALSE,u=0;u<this._geometries.length;u++)r=Math.max(r,i._geometries[u].getBoundaryDimension());return r},t.prototype.getDimension=function(){for(var i=this,r=kn.FALSE,u=0;u<this._geometries.length;u++)r=Math.max(r,i._geometries[u].getDimension());return r},t.prototype.getLength=function(){for(var i=this,r=0,u=0;u<this._geometries.length;u++)r+=i._geometries[u].getLength();return r},t.prototype.getNumPoints=function(){for(var i=this,r=0,u=0;u<this._geometries.length;u++)r+=i._geometries[u].getNumPoints();return r},t.prototype.getNumGeometries=function(){return this._geometries.length},t.prototype.reverse=function(){for(var i=this,r=this._geometries.length,u=new Array(r).fill(null),p=0;p<this._geometries.length;p++)u[p]=i._geometries[p].reverse();return this.getFactory().createGeometryCollection(u)},t.prototype.compareToSameClass=function(){var i=this;if(arguments.length===1){var r=arguments[0],u=new ua(Au.asList(this._geometries)),p=new ua(Au.asList(r._geometries));return this.compare(u,p)}else if(arguments.length===2){for(var a=arguments[0],_=arguments[1],x=a,S=this.getNumGeometries(),L=x.getNumGeometries(),k=0;k<S&&k<L;){var D=i.getGeometryN(k),F=x.getGeometryN(k),K=D.compareToSameClass(F,_);if(K!==0)return K;k++}return k<S?1:k<L?-1:0}},t.prototype.apply=function(){var i=this;if(We(arguments[0],Fa))for(var r=arguments[0],u=0;u<this._geometries.length;u++)i._geometries[u].apply(r);else if(We(arguments[0],Os)){var p=arguments[0];if(this._geometries.length===0)return null;for(var a=0;a<this._geometries.length&&(i._geometries[a].apply(p),!p.isDone());a++);p.isGeometryChanged()&&this.geometryChanged()}else if(We(arguments[0],ca)){var _=arguments[0];_.filter(this);for(var x=0;x<this._geometries.length;x++)i._geometries[x].apply(_)}else if(We(arguments[0],dl)){var S=arguments[0];S.filter(this);for(var L=0;L<this._geometries.length;L++)i._geometries[L].apply(S)}},t.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),an.shouldNeverReachHere(),null},t.prototype.clone=function(){var i=this,r=e.prototype.clone.call(this);r._geometries=new Array(this._geometries.length).fill(null);for(var u=0;u<this._geometries.length;u++)r._geometries[u]=i._geometries[u].clone();return r},t.prototype.getGeometryType=function(){return"GeometryCollection"},t.prototype.copy=function(){for(var i=this,r=new Array(this._geometries.length).fill(null),u=0;u<r.length;u++)r[u]=i._geometries[u].copy();return new t(r,this._factory)},t.prototype.isEmpty=function(){for(var i=this,r=0;r<this._geometries.length;r++)if(!i._geometries[r].isEmpty())return!1;return!0},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(t,n),t}(je),Ou=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return je.SORTINDEX_MULTILINESTRING},t.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],r=arguments[1];return this.isEquivalentClass(i)?e.prototype.equalsExact.call(this,i,r):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?kn.FALSE:0},t.prototype.isClosed=function(){var i=this;if(this.isEmpty())return!1;for(var r=0;r<this._geometries.length;r++)if(!i._geometries[r].isClosed())return!1;return!0},t.prototype.getDimension=function(){return 1},t.prototype.reverse=function(){for(var i=this,r=this._geometries.length,u=new Array(r).fill(null),p=0;p<this._geometries.length;p++)u[r-1-p]=i._geometries[p].reverse();return this.getFactory().createMultiLineString(u)},t.prototype.getBoundary=function(){return new ds(this).getBoundary()},t.prototype.getGeometryType=function(){return"MultiLineString"},t.prototype.copy=function(){for(var i=this,r=new Array(this._geometries.length).fill(null),u=0;u<r.length;u++)r[u]=i._geometries[u].copy();return new t(r,this._factory)},t.prototype.interfaces_=function(){return[Wf]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(t,n),t}(oo),ds=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var e=arguments[0],t=_s.MOD2_BOUNDARY_RULE;this._geom=e,this._geomFact=e.getFactory(),this._bnRule=t}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this._geom=n,this._geomFact=n.getFactory(),this._bnRule=i}};ds.prototype.boundaryMultiLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var t=this.computeBoundaryCoordinates(e);return t.length===1?this._geomFact.createPoint(t[0]):this._geomFact.createMultiPointFromCoords(t)};ds.prototype.getBoundary=function(){return this._geom instanceof Mi?this.boundaryLineString(this._geom):this._geom instanceof Ou?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};ds.prototype.boundaryLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(e.isClosed()){var t=this._bnRule.isInBoundary(2);return t?e.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([e.getStartPoint(),e.getEndPoint()])};ds.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};ds.prototype.computeBoundaryCoordinates=function(e){var t=this,n=new pe;this._endpointMap=new jr;for(var i=0;i<e.getNumGeometries();i++){var r=e.getGeometryN(i);r.getNumPoints()!==0&&(t.addEndpoint(r.getCoordinateN(0)),t.addEndpoint(r.getCoordinateN(r.getNumPoints()-1)))}for(var u=this._endpointMap.entrySet().iterator();u.hasNext();){var p=u.next(),a=p.getValue(),_=a.count;t._bnRule.isInBoundary(_)&&n.add(p.getKey())}return yn.toCoordinateArray(n)};ds.prototype.addEndpoint=function(e){var t=this._endpointMap.get(e);t===null&&(t=new Qm,this._endpointMap.put(e,t)),t.count++};ds.prototype.interfaces_=function(){return[]};ds.prototype.getClass=function(){return ds};ds.getBoundary=function(){if(arguments.length===1){var e=arguments[0],t=new ds(e);return t.getBoundary()}else if(arguments.length===2){var n=arguments[0],i=arguments[1],r=new ds(n,i);return r.getBoundary()}};var Qm=function(){this.count=null};Qm.prototype.interfaces_=function(){return[]};Qm.prototype.getClass=function(){return Qm};function lC(){}function uC(){}var cC=function(){};function hC(){}function pC(){}function fC(){}var ms=function(){},Ay={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};ms.prototype.interfaces_=function(){return[]};ms.prototype.getClass=function(){return ms};ms.chars=function(e,t){for(var n=new Array(t).fill(null),i=0;i<t;i++)n[i]=e;return String(n)};ms.getStackTrace=function(){if(arguments.length===1){var e=arguments[0],t=new hC,n=new lC;return e.printStackTrace(n),t.toString()}else if(arguments.length===2){var i=arguments[0],r=arguments[1],u="";new uC(ms.getStackTrace(i));for(var p=new fC,a=0;a<r;a++)try{u+=p.readLine()+ms.NEWLINE}catch(_){if(_ instanceof pC)an.shouldNeverReachHere();else throw _}finally{}return u}};ms.split=function(e,t){for(var n=t.length,i=new pe,r=""+e,u=r.indexOf(t);u>=0;){var p=r.substring(0,u);i.add(p),r=r.substring(u+n),u=r.indexOf(t)}r.length>0&&i.add(r);for(var a=new Array(i.size()).fill(null),_=0;_<a.length;_++)a[_]=i.get(_);return a};ms.toString=function(){if(arguments.length===1){var e=arguments[0];return ms.SIMPLE_ORDINATE_FORMAT.format(e)}};ms.spaces=function(e){return ms.chars(" ",e)};Ay.NEWLINE.get=function(){return Cr.getProperty("line.separator")};Ay.SIMPLE_ORDINATE_FORMAT.get=function(){return new cC};Object.defineProperties(ms,Ay);var Ui=function(){};Ui.prototype.interfaces_=function(){return[]};Ui.prototype.getClass=function(){return Ui};Ui.copyCoord=function(e,t,n,i){for(var r=Math.min(e.getDimension(),n.getDimension()),u=0;u<r;u++)n.setOrdinate(i,u,e.getOrdinate(t,u))};Ui.isRing=function(e){var t=e.size();return t===0?!0:t<=3?!1:e.getOrdinate(0,Mn.X)===e.getOrdinate(t-1,Mn.X)&&e.getOrdinate(0,Mn.Y)===e.getOrdinate(t-1,Mn.Y)};Ui.isEqual=function(e,t){var n=e.size(),i=t.size();if(n!==i)return!1;for(var r=Math.min(e.getDimension(),t.getDimension()),u=0;u<n;u++)for(var p=0;p<r;p++){var a=e.getOrdinate(u,p),_=t.getOrdinate(u,p);if(e.getOrdinate(u,p)!==t.getOrdinate(u,p)&&!(Qe.isNaN(a)&&Qe.isNaN(_)))return!1}return!0};Ui.extend=function(e,t,n){var i=e.create(n,t.getDimension()),r=t.size();if(Ui.copy(t,0,i,0,r),r>0)for(var u=r;u<n;u++)Ui.copy(t,r-1,i,u,1);return i};Ui.reverse=function(e){for(var t=e.size()-1,n=Math.trunc(t/2),i=0;i<=n;i++)Ui.swap(e,i,t-i)};Ui.swap=function(e,t,n){if(t===n)return null;for(var i=0;i<e.getDimension();i++){var r=e.getOrdinate(t,i);e.setOrdinate(t,i,e.getOrdinate(n,i)),e.setOrdinate(n,i,r)}};Ui.copy=function(e,t,n,i,r){for(var u=0;u<r;u++)Ui.copyCoord(e,t+u,n,i+u)};Ui.toString=function(){if(arguments.length===1){var e=arguments[0],t=e.size();if(t===0)return"()";var n=e.getDimension(),i=new ba;i.append("(");for(var r=0;r<t;r++){r>0&&i.append(" ");for(var u=0;u<n;u++)u>0&&i.append(","),i.append(ms.toString(e.getOrdinate(r,u)))}return i.append(")"),i.toString()}};Ui.ensureValidRing=function(e,t){var n=t.size();if(n===0)return t;if(n<=3)return Ui.createClosedRing(e,t,4);var i=t.getOrdinate(0,Mn.X)===t.getOrdinate(n-1,Mn.X)&&t.getOrdinate(0,Mn.Y)===t.getOrdinate(n-1,Mn.Y);return i?t:Ui.createClosedRing(e,t,n+1)};Ui.createClosedRing=function(e,t,n){var i=e.create(n,t.getDimension()),r=t.size();Ui.copy(t,0,i,0,r);for(var u=r;u<n;u++)Ui.copy(t,0,i,u,1);return i};var Mi=function(e){function t(i,r){e.call(this,r),this._points=null,this.init(i)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new ke:this._points.expandEnvelope(new ke)},t.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},t.prototype.getSortIndex=function(){return e.SORTINDEX_LINESTRING},t.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},t.prototype.equalsExact=function(){var i=this;if(arguments.length===2){var r=arguments[0],u=arguments[1];if(!this.isEquivalentClass(r))return!1;var p=r;if(this._points.size()!==p._points.size())return!1;for(var a=0;a<this._points.size();a++)if(!i.equal(i._points.getCoordinate(a),p._points.getCoordinate(a),u))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var i=this,r=0;r<Math.trunc(this._points.size()/2);r++){var u=i._points.size()-1-r;if(!i._points.getCoordinate(r).equals(i._points.getCoordinate(u)))return i._points.getCoordinate(r).compareTo(i._points.getCoordinate(u))>0&&Ui.reverse(i._points),null}},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?kn.FALSE:0},t.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},t.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},t.prototype.getDimension=function(){return 1},t.prototype.getLength=function(){return ve.computeLength(this._points)},t.prototype.getNumPoints=function(){return this._points.size()},t.prototype.reverse=function(){var i=this._points.copy();Ui.reverse(i);var r=this.getFactory().createLineString(i);return r},t.prototype.compareToSameClass=function(){var i=this;if(arguments.length===1){for(var r=arguments[0],u=r,p=0,a=0;p<this._points.size()&&a<u._points.size();){var _=i._points.getCoordinate(p).compareTo(u._points.getCoordinate(a));if(_!==0)return _;p++,a++}return p<this._points.size()?1:a<u._points.size()?-1:0}else if(arguments.length===2){var x=arguments[0],S=arguments[1],L=x;return S.compare(this._points,L._points)}},t.prototype.apply=function(){var i=this;if(We(arguments[0],Fa))for(var r=arguments[0],u=0;u<this._points.size();u++)r.filter(i._points.getCoordinate(u));else if(We(arguments[0],Os)){var p=arguments[0];if(this._points.size()===0)return null;for(var a=0;a<this._points.size()&&(p.filter(i._points,a),!p.isDone());a++);p.isGeometryChanged()&&this.geometryChanged()}else if(We(arguments[0],ca)){var _=arguments[0];_.filter(this)}else if(We(arguments[0],dl)){var x=arguments[0];x.filter(this)}},t.prototype.getBoundary=function(){return new ds(this).getBoundary()},t.prototype.isEquivalentClass=function(i){return i instanceof t},t.prototype.clone=function(){var i=e.prototype.clone.call(this);return i._points=this._points.clone(),i},t.prototype.getCoordinateN=function(i){return this._points.getCoordinate(i)},t.prototype.getGeometryType=function(){return"LineString"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._points},t.prototype.isEmpty=function(){return this._points.size()===0},t.prototype.init=function(i){if(i===null&&(i=this.getFactory().getCoordinateSequenceFactory().create([])),i.size()===1)throw new di("Invalid number of points in LineString (found "+i.size()+" - must be 0 or >= 2)");this._points=i},t.prototype.isCoordinate=function(i){for(var r=this,u=0;u<this._points.size();u++)if(r._points.getCoordinate(u).equals(i))return!0;return!1},t.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},t.prototype.getPointN=function(i){return this.getFactory().createPoint(this._points.getCoordinate(i))},t.prototype.interfaces_=function(){return[Wf]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(t,n),t}(je),Xf=function(){};Xf.prototype.interfaces_=function(){return[]};Xf.prototype.getClass=function(){return Xf};var No=function(e){function t(i,r){e.call(this,r),this._coordinates=i||null,this.init(this._coordinates)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new ke;var i=new ke;return i.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),i},t.prototype.getSortIndex=function(){return e.SORTINDEX_POINT},t.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},t.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],r=arguments[1];return this.isEquivalentClass(i)?this.isEmpty()&&i.isEmpty()?!0:this.isEmpty()!==i.isEmpty()?!1:this.equal(i.getCoordinate(),this.getCoordinate(),r):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){},t.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},t.prototype.getBoundaryDimension=function(){return kn.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getNumPoints=function(){return this.isEmpty()?0:1},t.prototype.reverse=function(){return this.copy()},t.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},t.prototype.compareToSameClass=function(){if(arguments.length===1){var i=arguments[0],r=i;return this.getCoordinate().compareTo(r.getCoordinate())}else if(arguments.length===2){var u=arguments[0],p=arguments[1],a=u;return p.compare(this._coordinates,a._coordinates)}},t.prototype.apply=function(){if(We(arguments[0],Fa)){var i=arguments[0];if(this.isEmpty())return null;i.filter(this.getCoordinate())}else if(We(arguments[0],Os)){var r=arguments[0];if(this.isEmpty())return null;r.filter(this._coordinates,0),r.isGeometryChanged()&&this.geometryChanged()}else if(We(arguments[0],ca)){var u=arguments[0];u.filter(this)}else if(We(arguments[0],dl)){var p=arguments[0];p.filter(this)}},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.clone=function(){var i=e.prototype.clone.call(this);return i._coordinates=this._coordinates.clone(),i},t.prototype.getGeometryType=function(){return"Point"},t.prototype.copy=function(){return new t(this._coordinates.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._coordinates},t.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},t.prototype.isEmpty=function(){return this._coordinates.size()===0},t.prototype.init=function(i){i===null&&(i=this.getFactory().getCoordinateSequenceFactory().create([])),an.isTrue(i.size()<=1),this._coordinates=i},t.prototype.isSimple=function(){return!0},t.prototype.interfaces_=function(){return[Xf]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(t,n),t}(je),Xl=function(){};Xl.prototype.interfaces_=function(){return[]};Xl.prototype.getClass=function(){return Xl};var rr=function(e){function t(i,r,u){if(e.call(this,u),this._shell=null,this._holes=null,i===null&&(i=this.getFactory().createLinearRing()),r===null&&(r=[]),e.hasNullElements(r))throw new di("holes must not contain null elements");if(i.isEmpty()&&e.hasNonEmptyElements(r))throw new di("shell is empty but holes are not");this._shell=i,this._holes=r}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},t.prototype.getSortIndex=function(){return e.SORTINDEX_POLYGON},t.prototype.getCoordinates=function(){var i=this;if(this.isEmpty())return[];for(var r=new Array(this.getNumPoints()).fill(null),u=-1,p=this._shell.getCoordinates(),a=0;a<p.length;a++)u++,r[u]=p[a];for(var _=0;_<this._holes.length;_++)for(var x=i._holes[_].getCoordinates(),S=0;S<x.length;S++)u++,r[u]=x[S];return r},t.prototype.getArea=function(){var i=this,r=0;r+=Math.abs(ve.signedArea(this._shell.getCoordinateSequence()));for(var u=0;u<this._holes.length;u++)r-=Math.abs(ve.signedArea(i._holes[u].getCoordinateSequence()));return r},t.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var i=this._shell.getCoordinateSequence(),r=this.getEnvelopeInternal(),u=0;u<5;u++){var p=i.getX(u);if(!(p===r.getMinX()||p===r.getMaxX()))return!1;var a=i.getY(u);if(!(a===r.getMinY()||a===r.getMaxY()))return!1}for(var _=i.getX(0),x=i.getY(0),S=1;S<=4;S++){var L=i.getX(S),k=i.getY(S),D=L!==_,F=k!==x;if(D===F)return!1;_=L,x=k}return!0},t.prototype.equalsExact=function(){var i=this;if(arguments.length===2){var r=arguments[0],u=arguments[1];if(!this.isEquivalentClass(r))return!1;var p=r,a=this._shell,_=p._shell;if(!a.equalsExact(_,u)||this._holes.length!==p._holes.length)return!1;for(var x=0;x<this._holes.length;x++)if(!i._holes[x].equalsExact(p._holes[x],u))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){var i=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var r=0;r<this._holes.length;r++)i.normalize(i._holes[r],!1);Au.sort(this._holes)}else if(arguments.length===2){var u=arguments[0],p=arguments[1];if(u.isEmpty())return null;var a=new Array(u.getCoordinates().length-1).fill(null);Cr.arraycopy(u.getCoordinates(),0,a,0,a.length);var _=yn.minCoordinate(u.getCoordinates());yn.scroll(a,_),Cr.arraycopy(a,0,u.getCoordinates(),0,a.length),u.getCoordinates()[a.length]=a[0],ve.isCCW(u.getCoordinates())===p&&yn.reverse(u.getCoordinates())}},t.prototype.getCoordinate=function(){return this._shell.getCoordinate()},t.prototype.getNumInteriorRing=function(){return this._holes.length},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.getLength=function(){var i=this,r=0;r+=this._shell.getLength();for(var u=0;u<this._holes.length;u++)r+=i._holes[u].getLength();return r},t.prototype.getNumPoints=function(){for(var i=this,r=this._shell.getNumPoints(),u=0;u<this._holes.length;u++)r+=i._holes[u].getNumPoints();return r},t.prototype.reverse=function(){var i=this,r=this.copy();r._shell=this._shell.copy().reverse(),r._holes=new Array(this._holes.length).fill(null);for(var u=0;u<this._holes.length;u++)r._holes[u]=i._holes[u].copy().reverse();return r},t.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},t.prototype.compareToSameClass=function(){var i=this;if(arguments.length===1){var r=arguments[0],u=this._shell,p=r._shell;return u.compareToSameClass(p)}else if(arguments.length===2){var a=arguments[0],_=arguments[1],x=a,S=this._shell,L=x._shell,k=S.compareToSameClass(L,_);if(k!==0)return k;for(var D=this.getNumInteriorRing(),F=x.getNumInteriorRing(),K=0;K<D&&K<F;){var W=i.getInteriorRingN(K),Q=x.getInteriorRingN(K),U=W.compareToSameClass(Q,_);if(U!==0)return U;K++}return K<D?1:K<F?-1:0}},t.prototype.apply=function(i){var r=this;if(We(i,Fa)){this._shell.apply(i);for(var u=0;u<this._holes.length;u++)r._holes[u].apply(i)}else if(We(i,Os)){if(this._shell.apply(i),!i.isDone())for(var p=0;p<this._holes.length&&(r._holes[p].apply(i),!i.isDone());p++);i.isGeometryChanged()&&this.geometryChanged()}else if(We(i,ca))i.filter(this);else if(We(i,dl)){i.filter(this),this._shell.apply(i);for(var a=0;a<this._holes.length;a++)r._holes[a].apply(i)}},t.prototype.getBoundary=function(){var i=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var r=new Array(this._holes.length+1).fill(null);r[0]=this._shell;for(var u=0;u<this._holes.length;u++)r[u+1]=i._holes[u];return r.length<=1?this.getFactory().createLinearRing(r[0].getCoordinateSequence()):this.getFactory().createMultiLineString(r)},t.prototype.clone=function(){var i=this,r=e.prototype.clone.call(this);r._shell=this._shell.clone(),r._holes=new Array(this._holes.length).fill(null);for(var u=0;u<this._holes.length;u++)r._holes[u]=i._holes[u].clone();return r},t.prototype.getGeometryType=function(){return"Polygon"},t.prototype.copy=function(){for(var i=this,r=this._shell.copy(),u=new Array(this._holes.length).fill(null),p=0;p<u.length;p++)u[p]=i._holes[p].copy();return new t(r,u,this._factory)},t.prototype.getExteriorRing=function(){return this._shell},t.prototype.isEmpty=function(){return this._shell.isEmpty()},t.prototype.getInteriorRingN=function(i){return this._holes[i]},t.prototype.interfaces_=function(){return[Xl]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(t,n),t}(je),Vh=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return je.SORTINDEX_MULTIPOINT},t.prototype.isValid=function(){return!0},t.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],r=arguments[1];return this.isEquivalentClass(i)?e.prototype.equalsExact.call(this,i,r):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getCoordinate=function(){if(arguments.length===1){var i=arguments[0];return this._geometries[i].getCoordinate()}else return e.prototype.getCoordinate.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return kn.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.getGeometryType=function(){return"MultiPoint"},t.prototype.copy=function(){for(var i=this,r=new Array(this._geometries.length).fill(null),u=0;u<r.length;u++)r[u]=i._geometries[u].copy();return new t(r,this._factory)},t.prototype.interfaces_=function(){return[Xf]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(t,n),t}(oo),Ba=function(e){function t(i,r){i instanceof Pt&&r instanceof _n&&(i=r.getCoordinateSequenceFactory().create(i)),e.call(this,i,r),this.validateConstruction()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return je.SORTINDEX_LINEARRING},t.prototype.getBoundaryDimension=function(){return kn.FALSE},t.prototype.isClosed=function(){return this.isEmpty()?!0:e.prototype.isClosed.call(this)},t.prototype.reverse=function(){var i=this._points.copy();Ui.reverse(i);var r=this.getFactory().createLinearRing(i);return r},t.prototype.validateConstruction=function(){if(!this.isEmpty()&&!e.prototype.isClosed.call(this))throw new di("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<t.MINIMUM_VALID_SIZE)throw new di("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},t.prototype.getGeometryType=function(){return"LinearRing"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(t,n),t}(Mi),Oa=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return je.SORTINDEX_MULTIPOLYGON},t.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],r=arguments[1];return this.isEquivalentClass(i)?e.prototype.equalsExact.call(this,i,r):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.reverse=function(){for(var i=this,r=this._geometries.length,u=new Array(r).fill(null),p=0;p<this._geometries.length;p++)u[p]=i._geometries[p].reverse();return this.getFactory().createMultiPolygon(u)},t.prototype.getBoundary=function(){var i=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var r=new pe,u=0;u<this._geometries.length;u++)for(var p=i._geometries[u],a=p.getBoundary(),_=0;_<a.getNumGeometries();_++)r.add(a.getGeometryN(_));var x=new Array(r.size()).fill(null);return this.getFactory().createMultiLineString(r.toArray(x))},t.prototype.getGeometryType=function(){return"MultiPolygon"},t.prototype.copy=function(){for(var i=this,r=new Array(this._geometries.length).fill(null),u=0;u<r.length;u++)r[u]=i._geometries[u].copy();return new t(r,this._factory)},t.prototype.interfaces_=function(){return[Xl]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(t,n),t}(oo),ys=function(e){this._factory=e||null,this._isUserDataCopied=!1},Sg={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};ys.prototype.setCopyUserData=function(e){this._isUserDataCopied=e};ys.prototype.edit=function(e,t){if(e===null)return null;var n=this.editInternal(e,t);return this._isUserDataCopied&&n.setUserData(e.getUserData()),n};ys.prototype.editInternal=function(e,t){return this._factory===null&&(this._factory=e.getFactory()),e instanceof oo?this.editGeometryCollection(e,t):e instanceof rr?this.editPolygon(e,t):e instanceof No?t.edit(e,this._factory):e instanceof Mi?t.edit(e,this._factory):(an.shouldNeverReachHere("Unsupported Geometry class: "+e.getClass().getName()),null)};ys.prototype.editGeometryCollection=function(e,t){for(var n=this,i=t.edit(e,this._factory),r=new pe,u=0;u<i.getNumGeometries();u++){var p=n.edit(i.getGeometryN(u),t);p===null||p.isEmpty()||r.add(p)}return i.getClass()===Vh?this._factory.createMultiPoint(r.toArray([])):i.getClass()===Ou?this._factory.createMultiLineString(r.toArray([])):i.getClass()===Oa?this._factory.createMultiPolygon(r.toArray([])):this._factory.createGeometryCollection(r.toArray([]))};ys.prototype.editPolygon=function(e,t){var n=this,i=t.edit(e,this._factory);if(i===null&&(i=this._factory.createPolygon(null)),i.isEmpty())return i;var r=this.edit(i.getExteriorRing(),t);if(r===null||r.isEmpty())return this._factory.createPolygon();for(var u=new pe,p=0;p<i.getNumInteriorRing();p++){var a=n.edit(i.getInteriorRingN(p),t);a===null||a.isEmpty()||u.add(a)}return this._factory.createPolygon(r,u.toArray([]))};ys.prototype.interfaces_=function(){return[]};ys.prototype.getClass=function(){return ys};ys.GeometryEditorOperation=function(){};Sg.NoOpGeometryOperation.get=function(){return Hf};Sg.CoordinateOperation.get=function(){return Yf};Sg.CoordinateSequenceOperation.get=function(){return Kf};Object.defineProperties(ys,Sg);var Hf=function(){};Hf.prototype.edit=function(e,t){return e};Hf.prototype.interfaces_=function(){return[ys.GeometryEditorOperation]};Hf.prototype.getClass=function(){return Hf};var Yf=function(){};Yf.prototype.edit=function(e,t){var n=this.editCoordinates(e.getCoordinates(),e);return n===null?e:e instanceof Ba?t.createLinearRing(n):e instanceof Mi?t.createLineString(n):e instanceof No?n.length>0?t.createPoint(n[0]):t.createPoint():e};Yf.prototype.interfaces_=function(){return[ys.GeometryEditorOperation]};Yf.prototype.getClass=function(){return Yf};var Kf=function(){};Kf.prototype.edit=function(e,t){return e instanceof Ba?t.createLinearRing(this.edit(e.getCoordinateSequence(),e)):e instanceof Mi?t.createLineString(this.edit(e.getCoordinateSequence(),e)):e instanceof No?t.createPoint(this.edit(e.getCoordinateSequence(),e)):e};Kf.prototype.interfaces_=function(){return[ys.GeometryEditorOperation]};Kf.prototype.getClass=function(){return Kf};var zi=function(){var e=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var t=arguments[0];this._coordinates=new Array(t).fill(null);for(var n=0;n<t;n++)e._coordinates[n]=new Pt}else if(We(arguments[0],Mn)){var i=arguments[0];if(i===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=i.getDimension(),this._coordinates=new Array(i.size()).fill(null);for(var r=0;r<this._coordinates.length;r++)e._coordinates[r]=i.getCoordinateCopy(r)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var u=arguments[0],p=arguments[1];this._coordinates=u,this._dimension=p,u===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var a=arguments[0],_=arguments[1];this._coordinates=new Array(a).fill(null),this._dimension=_;for(var x=0;x<a;x++)e._coordinates[x]=new Pt}}},fx={serialVersionUID:{configurable:!0}};zi.prototype.setOrdinate=function(e,t,n){switch(t){case Mn.X:this._coordinates[e].x=n;break;case Mn.Y:this._coordinates[e].y=n;break;case Mn.Z:this._coordinates[e].z=n;break;default:throw new di("invalid ordinateIndex")}};zi.prototype.size=function(){return this._coordinates.length};zi.prototype.getOrdinate=function(e,t){switch(t){case Mn.X:return this._coordinates[e].x;case Mn.Y:return this._coordinates[e].y;case Mn.Z:return this._coordinates[e].z}return Qe.NaN};zi.prototype.getCoordinate=function(){if(arguments.length===1){var e=arguments[0];return this._coordinates[e]}else if(arguments.length===2){var t=arguments[0],n=arguments[1];n.x=this._coordinates[t].x,n.y=this._coordinates[t].y,n.z=this._coordinates[t].z}};zi.prototype.getCoordinateCopy=function(e){return new Pt(this._coordinates[e])};zi.prototype.getDimension=function(){return this._dimension};zi.prototype.getX=function(e){return this._coordinates[e].x};zi.prototype.clone=function(){for(var e=this,t=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)t[n]=e._coordinates[n].clone();return new zi(t,this._dimension)};zi.prototype.expandEnvelope=function(e){for(var t=this,n=0;n<this._coordinates.length;n++)e.expandToInclude(t._coordinates[n]);return e};zi.prototype.copy=function(){for(var e=this,t=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)t[n]=e._coordinates[n].copy();return new zi(t,this._dimension)};zi.prototype.toString=function(){var e=this;if(this._coordinates.length>0){var t=new ba(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(var n=1;n<this._coordinates.length;n++)t.append(", "),t.append(e._coordinates[n]);return t.append(")"),t.toString()}else return"()"};zi.prototype.getY=function(e){return this._coordinates[e].y};zi.prototype.toCoordinateArray=function(){return this._coordinates};zi.prototype.interfaces_=function(){return[Mn,ws]};zi.prototype.getClass=function(){return zi};fx.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties(zi,fx);var Va=function(){},ky={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};Va.prototype.readResolve=function(){return Va.instance()};Va.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return new zi(e)}else if(We(arguments[0],Mn)){var t=arguments[0];return new zi(t)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return i>3&&(i=3),i<2?new zi(n):new zi(n,i)}};Va.prototype.interfaces_=function(){return[Dh,ws]};Va.prototype.getClass=function(){return Va};Va.instance=function(){return Va.instanceObject};ky.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};ky.instanceObject.get=function(){return new Va};Object.defineProperties(Va,ky);var dx=function(e){function t(){e.call(this),this.map_=new Map}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n){return this.map_.get(n)||null},t.prototype.put=function(n,i){return this.map_.set(n,i),i},t.prototype.values=function(){for(var n=new pe,i=this.map_.values(),r=i.next();!r.done;)n.add(r.value),r=i.next();return n},t.prototype.entrySet=function(){var n=new Py;return this.map_.entries().forEach(function(i){return n.add(i)}),n},t.prototype.size=function(){return this.map_.size()},t}(Rc),Dn=function e(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=e.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof ha){var t=arguments[0];this._modelType=t,t===e.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var n=arguments[0];this._modelType=e.FIXED,this.setScale(n)}else if(arguments[0]instanceof e){var i=arguments[0];this._modelType=i._modelType,this._scale=i._scale}}},Ny={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};Dn.prototype.equals=function(e){if(!(e instanceof Dn))return!1;var t=e;return this._modelType===t._modelType&&this._scale===t._scale};Dn.prototype.compareTo=function(e){var t=e,n=this.getMaximumSignificantDigits(),i=t.getMaximumSignificantDigits();return new la(n).compareTo(new la(i))};Dn.prototype.getScale=function(){return this._scale};Dn.prototype.isFloating=function(){return this._modelType===Dn.FLOATING||this._modelType===Dn.FLOATING_SINGLE};Dn.prototype.getType=function(){return this._modelType};Dn.prototype.toString=function(){var e="UNKNOWN";return this._modelType===Dn.FLOATING?e="Floating":this._modelType===Dn.FLOATING_SINGLE?e="Floating-Single":this._modelType===Dn.FIXED&&(e="Fixed (Scale="+this.getScale()+")"),e};Dn.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var e=arguments[0];if(Qe.isNaN(e))return e;if(this._modelType===Dn.FLOATING_SINGLE){var t=e;return t}return this._modelType===Dn.FIXED?Math.round(e*this._scale)/this._scale:e}else if(arguments[0]instanceof Pt){var n=arguments[0];if(this._modelType===Dn.FLOATING)return null;n.x=this.makePrecise(n.x),n.y=this.makePrecise(n.y)}};Dn.prototype.getMaximumSignificantDigits=function(){var e=16;return this._modelType===Dn.FLOATING?e=16:this._modelType===Dn.FLOATING_SINGLE?e=6:this._modelType===Dn.FIXED&&(e=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),e};Dn.prototype.setScale=function(e){this._scale=Math.abs(e)};Dn.prototype.interfaces_=function(){return[ws,xs]};Dn.prototype.getClass=function(){return Dn};Dn.mostPrecise=function(e,t){return e.compareTo(t)>=0?e:t};Ny.serialVersionUID.get=function(){return 7777263578777804e3};Ny.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties(Dn,Ny);var ha=function e(t){this._name=t||null,e.nameToTypeMap.put(t,this)},Dy={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};ha.prototype.readResolve=function(){return ha.nameToTypeMap.get(this._name)};ha.prototype.toString=function(){return this._name};ha.prototype.interfaces_=function(){return[ws]};ha.prototype.getClass=function(){return ha};Dy.serialVersionUID.get=function(){return-552860263173159e4};Dy.nameToTypeMap.get=function(){return new dx};Object.defineProperties(ha,Dy);Dn.Type=ha;Dn.FIXED=new ha("FIXED");Dn.FLOATING=new ha("FLOATING");Dn.FLOATING_SINGLE=new ha("FLOATING SINGLE");var _n=function e(){this._precisionModel=new Dn,this._SRID=0,this._coordinateSequenceFactory=e.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?We(arguments[0],Dh)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof Dn&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},mx={serialVersionUID:{configurable:!0}};_n.prototype.toGeometry=function(e){return e.isNull()?this.createPoint(null):e.getMinX()===e.getMaxX()&&e.getMinY()===e.getMaxY()?this.createPoint(new Pt(e.getMinX(),e.getMinY())):e.getMinX()===e.getMaxX()||e.getMinY()===e.getMaxY()?this.createLineString([new Pt(e.getMinX(),e.getMinY()),new Pt(e.getMaxX(),e.getMaxY())]):this.createPolygon(this.createLinearRing([new Pt(e.getMinX(),e.getMinY()),new Pt(e.getMinX(),e.getMaxY()),new Pt(e.getMaxX(),e.getMaxY()),new Pt(e.getMaxX(),e.getMinY()),new Pt(e.getMinX(),e.getMinY())]),null)};_n.prototype.createLineString=function(e){if(e){if(e instanceof Array)return new Mi(this.getCoordinateSequenceFactory().create(e),this);if(We(e,Mn))return new Mi(e,this)}else return new Mi(this.getCoordinateSequenceFactory().create([]),this)};_n.prototype.createMultiLineString=function(){if(arguments.length===0)return new Ou(null,this);if(arguments.length===1){var e=arguments[0];return new Ou(e,this)}};_n.prototype.buildGeometry=function(e){for(var t=null,n=!1,i=!1,r=e.iterator();r.hasNext();){var u=r.next(),p=u.getClass();t===null&&(t=p),p!==t&&(n=!0),u.isGeometryCollectionOrDerived()&&(i=!0)}if(t===null)return this.createGeometryCollection();if(n||i)return this.createGeometryCollection(_n.toGeometryArray(e));var a=e.iterator().next(),_=e.size()>1;if(_){if(a instanceof rr)return this.createMultiPolygon(_n.toPolygonArray(e));if(a instanceof Mi)return this.createMultiLineString(_n.toLineStringArray(e));if(a instanceof No)return this.createMultiPoint(_n.toPointArray(e));an.shouldNeverReachHere("Unhandled class: "+a.getClass().getName())}return a};_n.prototype.createMultiPointFromCoords=function(e){return this.createMultiPoint(e!==null?this.getCoordinateSequenceFactory().create(e):null)};_n.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Pt){var e=arguments[0];return this.createPoint(e!==null?this.getCoordinateSequenceFactory().create([e]):null)}else if(We(arguments[0],Mn)){var t=arguments[0];return new No(t,this)}}};_n.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};_n.prototype.createPolygon=function(){if(arguments.length===0)return new rr(null,null,this);if(arguments.length===1){if(We(arguments[0],Mn)){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}else if(arguments[0]instanceof Array){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}else if(arguments[0]instanceof Ba){var n=arguments[0];return this.createPolygon(n,null)}}else if(arguments.length===2){var i=arguments[0],r=arguments[1];return new rr(i,r,this)}};_n.prototype.getSRID=function(){return this._SRID};_n.prototype.createGeometryCollection=function(){if(arguments.length===0)return new oo(null,this);if(arguments.length===1){var e=arguments[0];return new oo(e,this)}};_n.prototype.createGeometry=function(e){var t=new ys(this);return t.edit(e,{edit:function(){if(arguments.length===2){var n=arguments[0];return this._coordinateSequenceFactory.create(n)}}})};_n.prototype.getPrecisionModel=function(){return this._precisionModel};_n.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLinearRing(e!==null?this.getCoordinateSequenceFactory().create(e):null)}else if(We(arguments[0],Mn)){var t=arguments[0];return new Ba(t,this)}}};_n.prototype.createMultiPolygon=function(){if(arguments.length===0)return new Oa(null,this);if(arguments.length===1){var e=arguments[0];return new Oa(e,this)}};_n.prototype.createMultiPoint=function(){var e=this;if(arguments.length===0)return new Vh(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return new Vh(t,this)}else if(arguments[0]instanceof Array){var n=arguments[0];return this.createMultiPoint(n!==null?this.getCoordinateSequenceFactory().create(n):null)}else if(We(arguments[0],Mn)){var i=arguments[0];if(i===null)return this.createMultiPoint(new Array(0).fill(null));for(var r=new Array(i.size()).fill(null),u=0;u<i.size();u++){var p=e.getCoordinateSequenceFactory().create(1,i.getDimension());Ui.copy(i,u,p,0,1),r[u]=e.createPoint(p)}return this.createMultiPoint(r)}}};_n.prototype.interfaces_=function(){return[ws]};_n.prototype.getClass=function(){return _n};_n.toMultiPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};_n.toGeometryArray=function(e){if(e===null)return null;var t=new Array(e.size()).fill(null);return e.toArray(t)};_n.getDefaultCoordinateSequenceFactory=function(){return Va.instance()};_n.toMultiLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};_n.toLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};_n.toMultiPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};_n.toLinearRingArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};_n.toPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};_n.toPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};_n.createPointFromInternalCoord=function(e,t){return t.getPrecisionModel().makePrecise(e),t.getFactory().createPoint(e)};mx.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties(_n,mx);var dC=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Eg=function(e){this.geometryFactory=e||new _n};Eg.prototype.read=function(e){var t;typeof e=="string"?t=JSON.parse(e):t=e;var n=t.type;if(!ta[n])throw new Error("Unknown GeoJSON type: "+t.type);return dC.indexOf(n)!==-1?ta[n].apply(this,[t.coordinates]):n==="GeometryCollection"?ta[n].apply(this,[t.geometries]):ta[n].apply(this,[t])};Eg.prototype.write=function(e){var t=e.getGeometryType();if(!sl[t])throw new Error("Geometry is not supported");return sl[t].apply(this,[e])};var ta={Feature:function(e){var t={};for(var n in e)t[n]=e[n];if(e.geometry){var i=e.geometry.type;if(!ta[i])throw new Error("Unknown GeoJSON type: "+e.type);t.geometry=this.read(e.geometry)}return e.bbox&&(t.bbox=ta.bbox.apply(this,[e.bbox])),t},FeatureCollection:function(e){var t=this,n={};if(e.features){n.features=[];for(var i=0;i<e.features.length;++i)n.features.push(t.read(e.features[i]))}return e.bbox&&(n.bbox=this.parse.bbox.apply(this,[e.bbox])),n},coordinates:function(e){for(var t=[],n=0;n<e.length;++n){var i=e[n];t.push(new Pt(i[0],i[1]))}return t},bbox:function(e){return this.geometryFactory.createLinearRing([new Pt(e[0],e[1]),new Pt(e[2],e[1]),new Pt(e[2],e[3]),new Pt(e[0],e[3]),new Pt(e[0],e[1])])},Point:function(e){var t=new Pt(e[0],e[1]);return this.geometryFactory.createPoint(t)},MultiPoint:function(e){for(var t=this,n=[],i=0;i<e.length;++i)n.push(ta.Point.apply(t,[e[i]]));return this.geometryFactory.createMultiPoint(n)},LineString:function(e){var t=ta.coordinates.apply(this,[e]);return this.geometryFactory.createLineString(t)},MultiLineString:function(e){for(var t=this,n=[],i=0;i<e.length;++i)n.push(ta.LineString.apply(t,[e[i]]));return this.geometryFactory.createMultiLineString(n)},Polygon:function(e){for(var t=this,n=ta.coordinates.apply(this,[e[0]]),i=this.geometryFactory.createLinearRing(n),r=[],u=1;u<e.length;++u){var p=e[u],a=ta.coordinates.apply(t,[p]),_=t.geometryFactory.createLinearRing(a);r.push(_)}return this.geometryFactory.createPolygon(i,r)},MultiPolygon:function(e){for(var t=this,n=[],i=0;i<e.length;++i){var r=e[i];n.push(ta.Polygon.apply(t,[r]))}return this.geometryFactory.createMultiPolygon(n)},GeometryCollection:function(e){for(var t=this,n=[],i=0;i<e.length;++i){var r=e[i];n.push(t.read(r))}return this.geometryFactory.createGeometryCollection(n)}},sl={coordinate:function(e){return[e.x,e.y]},Point:function(e){var t=sl.coordinate.apply(this,[e.getCoordinate()]);return{type:"Point",coordinates:t}},MultiPoint:function(e){for(var t=this,n=[],i=0;i<e._geometries.length;++i){var r=e._geometries[i],u=sl.Point.apply(t,[r]);n.push(u.coordinates)}return{type:"MultiPoint",coordinates:n}},LineString:function(e){for(var t=this,n=[],i=e.getCoordinates(),r=0;r<i.length;++r){var u=i[r];n.push(sl.coordinate.apply(t,[u]))}return{type:"LineString",coordinates:n}},MultiLineString:function(e){for(var t=this,n=[],i=0;i<e._geometries.length;++i){var r=e._geometries[i],u=sl.LineString.apply(t,[r]);n.push(u.coordinates)}return{type:"MultiLineString",coordinates:n}},Polygon:function(e){var t=this,n=[],i=sl.LineString.apply(this,[e._shell]);n.push(i.coordinates);for(var r=0;r<e._holes.length;++r){var u=e._holes[r],p=sl.LineString.apply(t,[u]);n.push(p.coordinates)}return{type:"Polygon",coordinates:n}},MultiPolygon:function(e){for(var t=this,n=[],i=0;i<e._geometries.length;++i){var r=e._geometries[i],u=sl.Polygon.apply(t,[r]);n.push(u.coordinates)}return{type:"MultiPolygon",coordinates:n}},GeometryCollection:function(e){for(var t=this,n=[],i=0;i<e._geometries.length;++i){var r=e._geometries[i],u=r.getGeometryType();n.push(sl[u].apply(t,[r]))}return{type:"GeometryCollection",geometries:n}}},Ry=function(e){this.geometryFactory=e||new _n,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new Eg(this.geometryFactory)};Ry.prototype.read=function(e){var t=this.parser.read(e);return this.precisionModel.getType()===Dn.FIXED&&this.reducePrecision(t),t};Ry.prototype.reducePrecision=function(e){var t=this,n,i;if(e.coordinate)this.precisionModel.makePrecise(e.coordinate);else if(e.points)for(n=0,i=e.points.length;n<i;n++)t.precisionModel.makePrecise(e.points[n]);else if(e.geometries)for(n=0,i=e.geometries.length;n<i;n++)t.reducePrecision(e.geometries[n])};var gx=function(){this.parser=new Eg(this.geometryFactory)};gx.prototype.write=function(e){return this.parser.write(e)};var oe=function(){},Ig={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};oe.prototype.interfaces_=function(){return[]};oe.prototype.getClass=function(){return oe};oe.opposite=function(e){return e===oe.LEFT?oe.RIGHT:e===oe.RIGHT?oe.LEFT:e};Ig.ON.get=function(){return 0};Ig.LEFT.get=function(){return 1};Ig.RIGHT.get=function(){return 2};Object.defineProperties(oe,Ig);function Cg(e){this.message=e||""}Cg.prototype=new Error;Cg.prototype.name="EmptyStackException";function xa(){this.array_=[]}xa.prototype=new Ns;xa.prototype.add=function(e){return this.array_.push(e),!0};xa.prototype.get=function(e){if(e<0||e>=this.size())throw new Error;return this.array_[e]};xa.prototype.push=function(e){return this.array_.push(e),e};xa.prototype.pop=function(e){if(this.array_.length===0)throw new Cg;return this.array_.pop()};xa.prototype.peek=function(){if(this.array_.length===0)throw new Cg;return this.array_[this.array_.length-1]};xa.prototype.empty=function(){return this.array_.length===0};xa.prototype.isEmpty=function(){return this.empty()};xa.prototype.search=function(e){return this.array_.indexOf(e)};xa.prototype.size=function(){return this.array_.length};xa.prototype.toArray=function(){for(var e=this,t=[],n=0,i=this.array_.length;n<i;n++)t.push(e.array_[n]);return t};var pa=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};pa.prototype.getCoordinate=function(){return this._minCoord};pa.prototype.getRightmostSide=function(e,t){var n=this.getRightmostSideOfSegment(e,t);return n<0&&(n=this.getRightmostSideOfSegment(e,t-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(e)),n};pa.prototype.findRightmostEdgeAtVertex=function(){var e=this._minDe.getEdge().getCoordinates();an.isTrue(this._minIndex>0&&this._minIndex<e.length,"rightmost point expected to be interior vertex of edge");var t=e[this._minIndex-1],n=e[this._minIndex+1],i=ve.computeOrientation(this._minCoord,n,t),r=!1;(t.y<this._minCoord.y&&n.y<this._minCoord.y&&i===ve.COUNTERCLOCKWISE||t.y>this._minCoord.y&&n.y>this._minCoord.y&&i===ve.CLOCKWISE)&&(r=!0),r&&(this._minIndex=this._minIndex-1)};pa.prototype.getRightmostSideOfSegment=function(e,t){var n=e.getEdge(),i=n.getCoordinates();if(t<0||t+1>=i.length||i[t].y===i[t+1].y)return-1;var r=oe.LEFT;return i[t].y<i[t+1].y&&(r=oe.RIGHT),r};pa.prototype.getEdge=function(){return this._orientedDe};pa.prototype.checkForRightmostCoordinate=function(e){for(var t=this,n=e.getEdge().getCoordinates(),i=0;i<n.length-1;i++)(t._minCoord===null||n[i].x>t._minCoord.x)&&(t._minDe=e,t._minIndex=i,t._minCoord=n[i])};pa.prototype.findRightmostEdgeAtNode=function(){var e=this._minDe.getNode(),t=e.getEdges();this._minDe=t.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};pa.prototype.findEdge=function(e){for(var t=this,n=e.iterator();n.hasNext();){var i=n.next();i.isForward()&&t.checkForRightmostCoordinate(i)}an.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var r=this.getRightmostSide(this._minDe,this._minIndex);r===oe.LEFT&&(this._orientedDe=this._minDe.getSym())};pa.prototype.interfaces_=function(){return[]};pa.prototype.getClass=function(){return pa};var ml=function(e){function t(n,i){e.call(this,t.msgWithCoord(n,i)),this.pt=i?new Pt(i):null,this.name="TopologyException"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getCoordinate=function(){return this.pt},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.msgWithCoord=function(n,i){return i?n:n+" [ "+i+" ]"},t}(fl),Tg=function(){this.array_=[]};Tg.prototype.addLast=function(e){this.array_.push(e)};Tg.prototype.removeFirst=function(){return this.array_.shift()};Tg.prototype.isEmpty=function(){return this.array_.length===0};var so=function(){this._finder=null,this._dirEdgeList=new pe,this._nodes=new pe,this._rightMostCoord=null,this._env=null,this._finder=new pa};so.prototype.clearVisitedEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();t.setVisited(!1)}};so.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};so.prototype.computeNodeDepth=function(e){for(var t=this,n=null,i=e.getEdges().iterator();i.hasNext();){var r=i.next();if(r.isVisited()||r.getSym().isVisited()){n=r;break}}if(n===null)throw new ml("unable to find edge to compute depths at "+e.getCoordinate());e.getEdges().computeDepths(n);for(var u=e.getEdges().iterator();u.hasNext();){var p=u.next();p.setVisited(!0),t.copySymDepths(p)}};so.prototype.computeDepth=function(e){this.clearVisitedEdges();var t=this._finder.getEdge();t.setEdgeDepths(oe.RIGHT,e),this.copySymDepths(t),this.computeDepths(t)};so.prototype.create=function(e){this.addReachable(e),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};so.prototype.findResultEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();t.getDepth(oe.RIGHT)>=1&&t.getDepth(oe.LEFT)<=0&&!t.isInteriorAreaEdge()&&t.setInResult(!0)}};so.prototype.computeDepths=function(e){var t=this,n=new Py,i=new Tg,r=e.getNode();for(i.addLast(r),n.add(r),e.setVisited(!0);!i.isEmpty();){var u=i.removeFirst();n.add(u),t.computeNodeDepth(u);for(var p=u.getEdges().iterator();p.hasNext();){var a=p.next(),_=a.getSym();if(!_.isVisited()){var x=_.getNode();n.contains(x)||(i.addLast(x),n.add(x))}}}};so.prototype.compareTo=function(e){var t=e;return this._rightMostCoord.x<t._rightMostCoord.x?-1:this._rightMostCoord.x>t._rightMostCoord.x?1:0};so.prototype.getEnvelope=function(){if(this._env===null){for(var e=new ke,t=this._dirEdgeList.iterator();t.hasNext();)for(var n=t.next(),i=n.getEdge().getCoordinates(),r=0;r<i.length-1;r++)e.expandToInclude(i[r]);this._env=e}return this._env};so.prototype.addReachable=function(e){var t=this,n=new xa;for(n.add(e);!n.empty();){var i=n.pop();t.add(i,n)}};so.prototype.copySymDepths=function(e){var t=e.getSym();t.setDepth(oe.LEFT,e.getDepth(oe.RIGHT)),t.setDepth(oe.RIGHT,e.getDepth(oe.LEFT))};so.prototype.add=function(e,t){var n=this;e.setVisited(!0),this._nodes.add(e);for(var i=e.getEdges().iterator();i.hasNext();){var r=i.next();n._dirEdgeList.add(r);var u=r.getSym(),p=u.getNode();p.isVisited()||t.push(p)}};so.prototype.getNodes=function(){return this._nodes};so.prototype.getDirectedEdges=function(){return this._dirEdgeList};so.prototype.interfaces_=function(){return[xs]};so.prototype.getClass=function(){return so};var ei=function e(){var t=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];this.init(n.length)}else if(Number.isInteger(arguments[0])){var i=arguments[0];this.init(1),this.location[oe.ON]=i}else if(arguments[0]instanceof e){var r=arguments[0];if(this.init(r.location.length),r!==null)for(var u=0;u<this.location.length;u++)t.location[u]=r.location[u]}}else if(arguments.length===3){var p=arguments[0],a=arguments[1],_=arguments[2];this.init(3),this.location[oe.ON]=p,this.location[oe.LEFT]=a,this.location[oe.RIGHT]=_}};ei.prototype.setAllLocations=function(e){for(var t=this,n=0;n<this.location.length;n++)t.location[n]=e};ei.prototype.isNull=function(){for(var e=this,t=0;t<this.location.length;t++)if(e.location[t]!==Dt.NONE)return!1;return!0};ei.prototype.setAllLocationsIfNull=function(e){for(var t=this,n=0;n<this.location.length;n++)t.location[n]===Dt.NONE&&(t.location[n]=e)};ei.prototype.isLine=function(){return this.location.length===1};ei.prototype.merge=function(e){var t=this;if(e.location.length>this.location.length){var n=new Array(3).fill(null);n[oe.ON]=this.location[oe.ON],n[oe.LEFT]=Dt.NONE,n[oe.RIGHT]=Dt.NONE,this.location=n}for(var i=0;i<this.location.length;i++)t.location[i]===Dt.NONE&&i<e.location.length&&(t.location[i]=e.location[i])};ei.prototype.getLocations=function(){return this.location};ei.prototype.flip=function(){if(this.location.length<=1)return null;var e=this.location[oe.LEFT];this.location[oe.LEFT]=this.location[oe.RIGHT],this.location[oe.RIGHT]=e};ei.prototype.toString=function(){var e=new ba;return this.location.length>1&&e.append(Dt.toLocationSymbol(this.location[oe.LEFT])),e.append(Dt.toLocationSymbol(this.location[oe.ON])),this.location.length>1&&e.append(Dt.toLocationSymbol(this.location[oe.RIGHT])),e.toString()};ei.prototype.setLocations=function(e,t,n){this.location[oe.ON]=e,this.location[oe.LEFT]=t,this.location[oe.RIGHT]=n};ei.prototype.get=function(e){return e<this.location.length?this.location[e]:Dt.NONE};ei.prototype.isArea=function(){return this.location.length>1};ei.prototype.isAnyNull=function(){for(var e=this,t=0;t<this.location.length;t++)if(e.location[t]===Dt.NONE)return!0;return!1};ei.prototype.setLocation=function(){if(arguments.length===1){var e=arguments[0];this.setLocation(oe.ON,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.location[t]=n}};ei.prototype.init=function(e){this.location=new Array(e).fill(null),this.setAllLocations(Dt.NONE)};ei.prototype.isEqualOnSide=function(e,t){return this.location[t]===e.location[t]};ei.prototype.allPositionsEqual=function(e){for(var t=this,n=0;n<this.location.length;n++)if(t.location[n]!==e)return!1;return!0};ei.prototype.interfaces_=function(){return[]};ei.prototype.getClass=function(){return ei};var Vn=function e(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new ei(t),this.elt[1]=new ei(t)}else if(arguments[0]instanceof e){var n=arguments[0];this.elt[0]=new ei(n.elt[0]),this.elt[1]=new ei(n.elt[1])}}else if(arguments.length===2){var i=arguments[0],r=arguments[1];this.elt[0]=new ei(Dt.NONE),this.elt[1]=new ei(Dt.NONE),this.elt[i].setLocation(r)}else if(arguments.length===3){var u=arguments[0],p=arguments[1],a=arguments[2];this.elt[0]=new ei(u,p,a),this.elt[1]=new ei(u,p,a)}else if(arguments.length===4){var _=arguments[0],x=arguments[1],S=arguments[2],L=arguments[3];this.elt[0]=new ei(Dt.NONE,Dt.NONE,Dt.NONE),this.elt[1]=new ei(Dt.NONE,Dt.NONE,Dt.NONE),this.elt[_].setLocations(x,S,L)}};Vn.prototype.getGeometryCount=function(){var e=0;return this.elt[0].isNull()||e++,this.elt[1].isNull()||e++,e};Vn.prototype.setAllLocations=function(e,t){this.elt[e].setAllLocations(t)};Vn.prototype.isNull=function(e){return this.elt[e].isNull()};Vn.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var e=arguments[0];this.setAllLocationsIfNull(0,e),this.setAllLocationsIfNull(1,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.elt[t].setAllLocationsIfNull(n)}};Vn.prototype.isLine=function(e){return this.elt[e].isLine()};Vn.prototype.merge=function(e){for(var t=this,n=0;n<2;n++)t.elt[n]===null&&e.elt[n]!==null?t.elt[n]=new ei(e.elt[n]):t.elt[n].merge(e.elt[n])};Vn.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};Vn.prototype.getLocation=function(){if(arguments.length===1){var e=arguments[0];return this.elt[e].get(oe.ON)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return this.elt[t].get(n)}};Vn.prototype.toString=function(){var e=new ba;return this.elt[0]!==null&&(e.append("A:"),e.append(this.elt[0].toString())),this.elt[1]!==null&&(e.append(" B:"),e.append(this.elt[1].toString())),e.toString()};Vn.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var e=arguments[0];return this.elt[e].isArea()}};Vn.prototype.isAnyNull=function(e){return this.elt[e].isAnyNull()};Vn.prototype.setLocation=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];this.elt[e].setLocation(oe.ON,t)}else if(arguments.length===3){var n=arguments[0],i=arguments[1],r=arguments[2];this.elt[n].setLocation(i,r)}};Vn.prototype.isEqualOnSide=function(e,t){return this.elt[0].isEqualOnSide(e.elt[0],t)&&this.elt[1].isEqualOnSide(e.elt[1],t)};Vn.prototype.allPositionsEqual=function(e,t){return this.elt[e].allPositionsEqual(t)};Vn.prototype.toLine=function(e){this.elt[e].isArea()&&(this.elt[e]=new ei(this.elt[e].location[0]))};Vn.prototype.interfaces_=function(){return[]};Vn.prototype.getClass=function(){return Vn};Vn.toLineLabel=function(e){for(var t=new Vn(Dt.NONE),n=0;n<2;n++)t.setLocation(n,e.getLocation(n));return t};var Ki=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new pe,this._pts=new pe,this._label=new Vn(Dt.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new pe,this._geometryFactory=null;var e=arguments[0],t=arguments[1];this._geometryFactory=t,this.computePoints(e),this.computeRing()};Ki.prototype.computeRing=function(){var e=this;if(this._ring!==null)return null;for(var t=new Array(this._pts.size()).fill(null),n=0;n<this._pts.size();n++)t[n]=e._pts.get(n);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=ve.isCCW(this._ring.getCoordinates())};Ki.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};Ki.prototype.computePoints=function(e){var t=this;this._startDe=e;var n=e,i=!0;do{if(n===null)throw new ml("Found null DirectedEdge");if(n.getEdgeRing()===t)throw new ml("Directed Edge visited twice during ring-building at "+n.getCoordinate());t._edges.add(n);var r=n.getLabel();an.isTrue(r.isArea()),t.mergeLabel(r),t.addPoints(n.getEdge(),n.isForward(),i),i=!1,t.setEdgeRing(n,t),n=t.getNext(n)}while(n!==this._startDe)};Ki.prototype.getLinearRing=function(){return this._ring};Ki.prototype.getCoordinate=function(e){return this._pts.get(e)};Ki.prototype.computeMaxNodeDegree=function(){var e=this;this._maxNodeDegree=0;var t=this._startDe;do{var n=t.getNode(),i=n.getEdges().getOutgoingDegree(e);i>e._maxNodeDegree&&(e._maxNodeDegree=i),t=e.getNext(t)}while(t!==this._startDe);this._maxNodeDegree*=2};Ki.prototype.addPoints=function(e,t,n){var i=this,r=e.getCoordinates();if(t){var u=1;n&&(u=0);for(var p=u;p<r.length;p++)i._pts.add(r[p])}else{var a=r.length-2;n&&(a=r.length-1);for(var _=a;_>=0;_--)i._pts.add(r[_])}};Ki.prototype.isHole=function(){return this._isHole};Ki.prototype.setInResult=function(){var e=this._startDe;do e.getEdge().setInResult(!0),e=e.getNext();while(e!==this._startDe)};Ki.prototype.containsPoint=function(e){var t=this.getLinearRing(),n=t.getEnvelopeInternal();if(!n.contains(e)||!ve.isPointInRing(e,t.getCoordinates()))return!1;for(var i=this._holes.iterator();i.hasNext();){var r=i.next();if(r.containsPoint(e))return!1}return!0};Ki.prototype.addHole=function(e){this._holes.add(e)};Ki.prototype.isShell=function(){return this._shell===null};Ki.prototype.getLabel=function(){return this._label};Ki.prototype.getEdges=function(){return this._edges};Ki.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};Ki.prototype.getShell=function(){return this._shell};Ki.prototype.mergeLabel=function(){if(arguments.length===1){var e=arguments[0];this.mergeLabel(e,0),this.mergeLabel(e,1)}else if(arguments.length===2){var t=arguments[0],n=arguments[1],i=t.getLocation(n,oe.RIGHT);if(i===Dt.NONE)return null;if(this._label.getLocation(n)===Dt.NONE)return this._label.setLocation(n,i),null}};Ki.prototype.setShell=function(e){this._shell=e,e!==null&&e.addHole(this)};Ki.prototype.toPolygon=function(e){for(var t=this,n=new Array(this._holes.size()).fill(null),i=0;i<this._holes.size();i++)n[i]=t._holes.get(i).getLinearRing();var r=e.createPolygon(this.getLinearRing(),n);return r};Ki.prototype.interfaces_=function(){return[]};Ki.prototype.getClass=function(){return Ki};var mC=function(e){function t(){var n=arguments[0],i=arguments[1];e.call(this,n,i)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setEdgeRing=function(n,i){n.setMinEdgeRing(i)},t.prototype.getNext=function(n){return n.getNextMin()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Ki),gC=function(e){function t(){var n=arguments[0],i=arguments[1];e.call(this,n,i)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.buildMinimalRings=function(){var n=this,i=new pe,r=this._startDe;do{if(r.getMinEdgeRing()===null){var u=new mC(r,n._geometryFactory);i.add(u)}r=r.getNext()}while(r!==this._startDe);return i},t.prototype.setEdgeRing=function(n,i){n.setEdgeRing(i)},t.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var n=this,i=this._startDe;do{var r=i.getNode();r.getEdges().linkMinimalDirectedEdges(n),i=i.getNext()}while(i!==this._startDe)},t.prototype.getNext=function(n){return n.getNext()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Ki),Qo=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0&&arguments.length===1){var e=arguments[0];this._label=e}};Qo.prototype.setVisited=function(e){this._isVisited=e};Qo.prototype.setInResult=function(e){this._isInResult=e};Qo.prototype.isCovered=function(){return this._isCovered};Qo.prototype.isCoveredSet=function(){return this._isCoveredSet};Qo.prototype.setLabel=function(e){this._label=e};Qo.prototype.getLabel=function(){return this._label};Qo.prototype.setCovered=function(e){this._isCovered=e,this._isCoveredSet=!0};Qo.prototype.updateIM=function(e){an.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(e)};Qo.prototype.isInResult=function(){return this._isInResult};Qo.prototype.isVisited=function(){return this._isVisited};Qo.prototype.interfaces_=function(){return[]};Qo.prototype.getClass=function(){return Qo};var Lg=function(e){function t(){e.call(this),this._coord=null,this._edges=null;var n=arguments[0],i=arguments[1];this._coord=n,this._edges=i,this._label=new Vn(0,Dt.NONE)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isIncidentEdgeInResult=function(){for(var n=this.getEdges().getEdges().iterator();n.hasNext();){var i=n.next();if(i.getEdge().isInResult())return!0}return!1},t.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},t.prototype.getCoordinate=function(){return this._coord},t.prototype.print=function(n){n.println("node "+this._coord+" lbl: "+this._label)},t.prototype.computeIM=function(n){},t.prototype.computeMergedLocation=function(n,i){var r=Dt.NONE;if(r=this._label.getLocation(i),!n.isNull(i)){var u=n.getLocation(i);r!==Dt.BOUNDARY&&(r=u)}return r},t.prototype.setLabel=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];this._label===null?this._label=new Vn(n,i):this._label.setLocation(n,i)}else return e.prototype.setLabel.apply(this,arguments)},t.prototype.getEdges=function(){return this._edges},t.prototype.mergeLabel=function(){var n=this;if(arguments[0]instanceof t){var i=arguments[0];this.mergeLabel(i._label)}else if(arguments[0]instanceof Vn)for(var r=arguments[0],u=0;u<2;u++){var p=n.computeMergedLocation(r,u),a=n._label.getLocation(u);a===Dt.NONE&&n._label.setLocation(u,p)}},t.prototype.add=function(n){this._edges.insert(n),n.setNode(this)},t.prototype.setLabelBoundary=function(n){if(this._label===null)return null;var i=Dt.NONE;this._label!==null&&(i=this._label.getLocation(n));var r=null;switch(i){case Dt.BOUNDARY:r=Dt.INTERIOR;break;case Dt.INTERIOR:r=Dt.BOUNDARY;break;default:r=Dt.BOUNDARY;break}this._label.setLocation(n,r)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Qo),fa=function(){this.nodeMap=new jr,this.nodeFact=null;var e=arguments[0];this.nodeFact=e};fa.prototype.find=function(e){return this.nodeMap.get(e)};fa.prototype.addNode=function(){if(arguments[0]instanceof Pt){var e=arguments[0],t=this.nodeMap.get(e);return t===null&&(t=this.nodeFact.createNode(e),this.nodeMap.put(e,t)),t}else if(arguments[0]instanceof Lg){var n=arguments[0],i=this.nodeMap.get(n.getCoordinate());return i===null?(this.nodeMap.put(n.getCoordinate(),n),n):(i.mergeLabel(n),i)}};fa.prototype.print=function(e){for(var t=this.iterator();t.hasNext();){var n=t.next();n.print(e)}};fa.prototype.iterator=function(){return this.nodeMap.values().iterator()};fa.prototype.values=function(){return this.nodeMap.values()};fa.prototype.getBoundaryNodes=function(e){for(var t=new pe,n=this.iterator();n.hasNext();){var i=n.next();i.getLabel().getLocation(e)===Dt.BOUNDARY&&t.add(i)}return t};fa.prototype.add=function(e){var t=e.getCoordinate(),n=this.addNode(t);n.add(e)};fa.prototype.interfaces_=function(){return[]};fa.prototype.getClass=function(){return fa};var Xn=function(){},gd={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Xn.prototype.interfaces_=function(){return[]};Xn.prototype.getClass=function(){return Xn};Xn.isNorthern=function(e){return e===Xn.NE||e===Xn.NW};Xn.isOpposite=function(e,t){if(e===t)return!1;var n=(e-t+4)%4;return n===2};Xn.commonHalfPlane=function(e,t){if(e===t)return e;var n=(e-t+4)%4;if(n===2)return-1;var i=e<t?e:t,r=e>t?e:t;return i===0&&r===3?3:i};Xn.isInHalfPlane=function(e,t){return t===Xn.SE?e===Xn.SE||e===Xn.SW:e===t||e===t+1};Xn.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1];if(e===0&&t===0)throw new di("Cannot compute the quadrant for point ( "+e+", "+t+" )");return e>=0?t>=0?Xn.NE:Xn.SE:t>=0?Xn.NW:Xn.SW}else if(arguments[0]instanceof Pt&&arguments[1]instanceof Pt){var n=arguments[0],i=arguments[1];if(i.x===n.x&&i.y===n.y)throw new di("Cannot compute the quadrant for two identical points "+n);return i.x>=n.x?i.y>=n.y?Xn.NE:Xn.SE:i.y>=n.y?Xn.NW:Xn.SW}};gd.NE.get=function(){return 0};gd.NW.get=function(){return 1};gd.SW.get=function(){return 2};gd.SE.get=function(){return 3};Object.defineProperties(Xn,gd);var Zr=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var e=arguments[0];this._edge=e}else if(arguments.length===3){var t=arguments[0],n=arguments[1],i=arguments[2],r=null;this._edge=t,this.init(n,i),this._label=r}else if(arguments.length===4){var u=arguments[0],p=arguments[1],a=arguments[2],_=arguments[3];this._edge=u,this.init(p,a),this._label=_}};Zr.prototype.compareDirection=function(e){return this._dx===e._dx&&this._dy===e._dy?0:this._quadrant>e._quadrant?1:this._quadrant<e._quadrant?-1:ve.computeOrientation(e._p0,e._p1,this._p1)};Zr.prototype.getDy=function(){return this._dy};Zr.prototype.getCoordinate=function(){return this._p0};Zr.prototype.setNode=function(e){this._node=e};Zr.prototype.print=function(e){var t=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),i=n.lastIndexOf("."),r=n.substring(i+1);e.print("  "+r+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label)};Zr.prototype.compareTo=function(e){var t=e;return this.compareDirection(t)};Zr.prototype.getDirectedCoordinate=function(){return this._p1};Zr.prototype.getDx=function(){return this._dx};Zr.prototype.getLabel=function(){return this._label};Zr.prototype.getEdge=function(){return this._edge};Zr.prototype.getQuadrant=function(){return this._quadrant};Zr.prototype.getNode=function(){return this._node};Zr.prototype.toString=function(){var e=Math.atan2(this._dy,this._dx),t=this.getClass().getName(),n=t.lastIndexOf("."),i=t.substring(n+1);return"  "+i+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label};Zr.prototype.computeLabel=function(e){};Zr.prototype.init=function(e,t){this._p0=e,this._p1=t,this._dx=t.x-e.x,this._dy=t.y-e.y,this._quadrant=Xn.quadrant(this._dx,this._dy),an.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};Zr.prototype.interfaces_=function(){return[xs]};Zr.prototype.getClass=function(){return Zr};var py=function(e){function t(){var n=arguments[0],i=arguments[1];if(e.call(this,n),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=i,i)this.init(n.getCoordinate(0),n.getCoordinate(1));else{var r=n.getNumPoints()-1;this.init(n.getCoordinate(r),n.getCoordinate(r-1))}this.computeDirectedLabel()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getNextMin=function(){return this._nextMin},t.prototype.getDepth=function(n){return this._depth[n]},t.prototype.setVisited=function(n){this._isVisited=n},t.prototype.computeDirectedLabel=function(){this._label=new Vn(this._edge.getLabel()),this._isForward||this._label.flip()},t.prototype.getNext=function(){return this._next},t.prototype.setDepth=function(n,i){if(this._depth[n]!==-999&&this._depth[n]!==i)throw new ml("assigned depths do not match",this.getCoordinate());this._depth[n]=i},t.prototype.isInteriorAreaEdge=function(){for(var n=this,i=!0,r=0;r<2;r++)n._label.isArea(r)&&n._label.getLocation(r,oe.LEFT)===Dt.INTERIOR&&n._label.getLocation(r,oe.RIGHT)===Dt.INTERIOR||(i=!1);return i},t.prototype.setNextMin=function(n){this._nextMin=n},t.prototype.print=function(n){e.prototype.print.call(this,n),n.print(" "+this._depth[oe.LEFT]+"/"+this._depth[oe.RIGHT]),n.print(" ("+this.getDepthDelta()+")"),this._isInResult&&n.print(" inResult")},t.prototype.setMinEdgeRing=function(n){this._minEdgeRing=n},t.prototype.isLineEdge=function(){var n=this._label.isLine(0)||this._label.isLine(1),i=!this._label.isArea(0)||this._label.allPositionsEqual(0,Dt.EXTERIOR),r=!this._label.isArea(1)||this._label.allPositionsEqual(1,Dt.EXTERIOR);return n&&i&&r},t.prototype.setEdgeRing=function(n){this._edgeRing=n},t.prototype.getMinEdgeRing=function(){return this._minEdgeRing},t.prototype.getDepthDelta=function(){var n=this._edge.getDepthDelta();return this._isForward||(n=-n),n},t.prototype.setInResult=function(n){this._isInResult=n},t.prototype.getSym=function(){return this._sym},t.prototype.isForward=function(){return this._isForward},t.prototype.getEdge=function(){return this._edge},t.prototype.printEdge=function(n){this.print(n),n.print(" "),this._isForward?this._edge.print(n):this._edge.printReverse(n)},t.prototype.setSym=function(n){this._sym=n},t.prototype.setVisitedEdge=function(n){this.setVisited(n),this._sym.setVisited(n)},t.prototype.setEdgeDepths=function(n,i){var r=this.getEdge().getDepthDelta();this._isForward||(r=-r);var u=1;n===oe.LEFT&&(u=-1);var p=oe.opposite(n),a=r*u,_=i+a;this.setDepth(n,i),this.setDepth(p,_)},t.prototype.getEdgeRing=function(){return this._edgeRing},t.prototype.isInResult=function(){return this._isInResult},t.prototype.setNext=function(n){this._next=n},t.prototype.isVisited=function(){return this._isVisited},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.depthFactor=function(n,i){return n===Dt.EXTERIOR&&i===Dt.INTERIOR?1:n===Dt.INTERIOR&&i===Dt.EXTERIOR?-1:0},t}(Zr),Uh=function(){};Uh.prototype.createNode=function(e){return new Lg(e,null)};Uh.prototype.interfaces_=function(){return[]};Uh.prototype.getClass=function(){return Uh};var xi=function(){if(this._edges=new pe,this._nodes=null,this._edgeEndList=new pe,arguments.length===0)this._nodes=new fa(new Uh);else if(arguments.length===1){var e=arguments[0];this._nodes=new fa(e)}};xi.prototype.printEdges=function(e){var t=this;e.println("Edges:");for(var n=0;n<this._edges.size();n++){e.println("edge "+n+":");var i=t._edges.get(n);i.print(e),i.eiList.print(e)}};xi.prototype.find=function(e){return this._nodes.find(e)};xi.prototype.addNode=function(){if(arguments[0]instanceof Lg){var e=arguments[0];return this._nodes.addNode(e)}else if(arguments[0]instanceof Pt){var t=arguments[0];return this._nodes.addNode(t)}};xi.prototype.getNodeIterator=function(){return this._nodes.iterator()};xi.prototype.linkResultDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){var t=e.next();t.getEdges().linkResultDirectedEdges()}};xi.prototype.debugPrintln=function(e){Cr.out.println(e)};xi.prototype.isBoundaryNode=function(e,t){var n=this._nodes.find(t);if(n===null)return!1;var i=n.getLabel();return i!==null&&i.getLocation(e)===Dt.BOUNDARY};xi.prototype.linkAllDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){var t=e.next();t.getEdges().linkAllDirectedEdges()}};xi.prototype.matchInSameDirection=function(e,t,n,i){return e.equals(n)?ve.computeOrientation(e,t,i)===ve.COLLINEAR&&Xn.quadrant(e,t)===Xn.quadrant(n,i):!1};xi.prototype.getEdgeEnds=function(){return this._edgeEndList};xi.prototype.debugPrint=function(e){Cr.out.print(e)};xi.prototype.getEdgeIterator=function(){return this._edges.iterator()};xi.prototype.findEdgeInSameDirection=function(e,t){for(var n=this,i=0;i<this._edges.size();i++){var r=n._edges.get(i),u=r.getCoordinates();if(n.matchInSameDirection(e,t,u[0],u[1])||n.matchInSameDirection(e,t,u[u.length-1],u[u.length-2]))return r}return null};xi.prototype.insertEdge=function(e){this._edges.add(e)};xi.prototype.findEdgeEnd=function(e){for(var t=this.getEdgeEnds().iterator();t.hasNext();){var n=t.next();if(n.getEdge()===e)return n}return null};xi.prototype.addEdges=function(e){for(var t=this,n=e.iterator();n.hasNext();){var i=n.next();t._edges.add(i);var r=new py(i,!0),u=new py(i,!1);r.setSym(u),u.setSym(r),t.add(r),t.add(u)}};xi.prototype.add=function(e){this._nodes.add(e),this._edgeEndList.add(e)};xi.prototype.getNodes=function(){return this._nodes.values()};xi.prototype.findEdge=function(e,t){for(var n=this,i=0;i<this._edges.size();i++){var r=n._edges.get(i),u=r.getCoordinates();if(e.equals(u[0])&&t.equals(u[1]))return r}return null};xi.prototype.interfaces_=function(){return[]};xi.prototype.getClass=function(){return xi};xi.linkResultDirectedEdges=function(e){for(var t=e.iterator();t.hasNext();){var n=t.next();n.getEdges().linkResultDirectedEdges()}};var Do=function(){this._geometryFactory=null,this._shellList=new pe;var e=arguments[0];this._geometryFactory=e};Do.prototype.sortShellsAndHoles=function(e,t,n){for(var i=e.iterator();i.hasNext();){var r=i.next();r.isHole()?n.add(r):t.add(r)}};Do.prototype.computePolygons=function(e){for(var t=this,n=new pe,i=e.iterator();i.hasNext();){var r=i.next(),u=r.toPolygon(t._geometryFactory);n.add(u)}return n};Do.prototype.placeFreeHoles=function(e,t){for(var n=this,i=t.iterator();i.hasNext();){var r=i.next();if(r.getShell()===null){var u=n.findEdgeRingContaining(r,e);if(u===null)throw new ml("unable to assign hole to a shell",r.getCoordinate(0));r.setShell(u)}}};Do.prototype.buildMinimalEdgeRings=function(e,t,n){for(var i=this,r=new pe,u=e.iterator();u.hasNext();){var p=u.next();if(p.getMaxNodeDegree()>2){p.linkDirectedEdgesForMinimalEdgeRings();var a=p.buildMinimalRings(),_=i.findShell(a);_!==null?(i.placePolygonHoles(_,a),t.add(_)):n.addAll(a)}else r.add(p)}return r};Do.prototype.containsPoint=function(e){for(var t=this._shellList.iterator();t.hasNext();){var n=t.next();if(n.containsPoint(e))return!0}return!1};Do.prototype.buildMaximalEdgeRings=function(e){for(var t=this,n=new pe,i=e.iterator();i.hasNext();){var r=i.next();if(r.isInResult()&&r.getLabel().isArea()&&r.getEdgeRing()===null){var u=new gC(r,t._geometryFactory);n.add(u),u.setInResult()}}return n};Do.prototype.placePolygonHoles=function(e,t){for(var n=t.iterator();n.hasNext();){var i=n.next();i.isHole()&&i.setShell(e)}};Do.prototype.getPolygons=function(){var e=this.computePolygons(this._shellList);return e};Do.prototype.findEdgeRingContaining=function(e,t){for(var n=e.getLinearRing(),i=n.getEnvelopeInternal(),r=n.getCoordinateN(0),u=null,p=null,a=t.iterator();a.hasNext();){var _=a.next(),x=_.getLinearRing(),S=x.getEnvelopeInternal();u!==null&&(p=u.getLinearRing().getEnvelopeInternal());var L=!1;S.contains(i)&&ve.isPointInRing(r,x.getCoordinates())&&(L=!0),L&&(u===null||p.contains(S))&&(u=_)}return u};Do.prototype.findShell=function(e){for(var t=0,n=null,i=e.iterator();i.hasNext();){var r=i.next();r.isHole()||(n=r,t++)}return an.isTrue(t<=1,"found two shells in MinimalEdgeRing list"),n};Do.prototype.add=function(){if(arguments.length===1){var e=arguments[0];this.add(e.getEdgeEnds(),e.getNodes())}else if(arguments.length===2){var t=arguments[0],n=arguments[1];xi.linkResultDirectedEdges(n);var i=this.buildMaximalEdgeRings(t),r=new pe,u=this.buildMinimalEdgeRings(i,this._shellList,r);this.sortShellsAndHoles(u,this._shellList,r),this.placeFreeHoles(this._shellList,r)}};Do.prototype.interfaces_=function(){return[]};Do.prototype.getClass=function(){return Do};var Gh=function(){};Gh.prototype.getBounds=function(){};Gh.prototype.interfaces_=function(){return[]};Gh.prototype.getClass=function(){return Gh};var zs=function(){this._bounds=null,this._item=null;var e=arguments[0],t=arguments[1];this._bounds=e,this._item=t};zs.prototype.getItem=function(){return this._item};zs.prototype.getBounds=function(){return this._bounds};zs.prototype.interfaces_=function(){return[Gh,ws]};zs.prototype.getClass=function(){return zs};var gl=function(){this._size=null,this._items=null,this._size=0,this._items=new pe,this._items.add(null)};gl.prototype.poll=function(){if(this.isEmpty())return null;var e=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),e};gl.prototype.size=function(){return this._size};gl.prototype.reorder=function(e){for(var t=this,n=null,i=this._items.get(e);e*2<=this._size&&(n=e*2,n!==t._size&&t._items.get(n+1).compareTo(t._items.get(n))<0&&n++,t._items.get(n).compareTo(i)<0);e=n)t._items.set(e,t._items.get(n));this._items.set(e,i)};gl.prototype.clear=function(){this._size=0,this._items.clear()};gl.prototype.isEmpty=function(){return this._size===0};gl.prototype.add=function(e){var t=this;this._items.add(null),this._size+=1;var n=this._size;for(this._items.set(0,e);e.compareTo(this._items.get(Math.trunc(n/2)))<0;n/=2)t._items.set(n,t._items.get(Math.trunc(n/2)));this._items.set(n,e)};gl.prototype.interfaces_=function(){return[]};gl.prototype.getClass=function(){return gl};var Hl=function(){};Hl.prototype.visitItem=function(e){};Hl.prototype.interfaces_=function(){return[]};Hl.prototype.getClass=function(){return Hl};var bc=function(){};bc.prototype.insert=function(e,t){};bc.prototype.remove=function(e,t){};bc.prototype.query=function(){};bc.prototype.interfaces_=function(){return[]};bc.prototype.getClass=function(){return bc};var ir=function(){if(this._childBoundables=new pe,this._bounds=null,this._level=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];this._level=e}},_x={serialVersionUID:{configurable:!0}};ir.prototype.getLevel=function(){return this._level};ir.prototype.size=function(){return this._childBoundables.size()};ir.prototype.getChildBoundables=function(){return this._childBoundables};ir.prototype.addChildBoundable=function(e){an.isTrue(this._bounds===null),this._childBoundables.add(e)};ir.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};ir.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};ir.prototype.interfaces_=function(){return[Gh,ws]};ir.prototype.getClass=function(){return ir};_x.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(ir,_x);var Fs=function(){};Fs.reverseOrder=function(){return{compare:function(e,t){return t.compareTo(e)}}};Fs.min=function(e){return Fs.sort(e),e.get(0)};Fs.sort=function(e,t){var n=e.toArray();t?Au.sort(n,t):Au.sort(n);for(var i=e.iterator(),r=0,u=n.length;r<u;r++)i.next(),i.set(n[r])};Fs.singletonList=function(e){var t=new pe;return t.add(e),t};var Xi=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var e=arguments[0],t=arguments[1],n=arguments[2];this._boundable1=e,this._boundable2=t,this._itemDistance=n,this._distance=this.distance()};Xi.prototype.expandToQueue=function(e,t){var n=Xi.isComposite(this._boundable1),i=Xi.isComposite(this._boundable2);if(n&&i)return Xi.area(this._boundable1)>Xi.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,e,t),null):(this.expand(this._boundable2,this._boundable1,e,t),null);if(n)return this.expand(this._boundable1,this._boundable2,e,t),null;if(i)return this.expand(this._boundable2,this._boundable1,e,t),null;throw new di("neither boundable is composite")};Xi.prototype.isLeaves=function(){return!(Xi.isComposite(this._boundable1)||Xi.isComposite(this._boundable2))};Xi.prototype.compareTo=function(e){var t=e;return this._distance<t._distance?-1:this._distance>t._distance?1:0};Xi.prototype.expand=function(e,t,n,i){for(var r=this,u=e.getChildBoundables(),p=u.iterator();p.hasNext();){var a=p.next(),_=new Xi(a,t,r._itemDistance);_.getDistance()<i&&n.add(_)}};Xi.prototype.getBoundable=function(e){return e===0?this._boundable1:this._boundable2};Xi.prototype.getDistance=function(){return this._distance};Xi.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};Xi.prototype.interfaces_=function(){return[xs]};Xi.prototype.getClass=function(){return Xi};Xi.area=function(e){return e.getBounds().getArea()};Xi.isComposite=function(e){return e instanceof ir};var vr=function e(){if(this._root=null,this._built=!1,this._itemBoundables=new pe,this._nodeCapacity=null,arguments.length===0){var t=e.DEFAULT_NODE_CAPACITY;this._nodeCapacity=t}else if(arguments.length===1){var n=arguments[0];an.isTrue(n>1,"Node capacity must be greater than 1"),this._nodeCapacity=n}},Mg={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};vr.prototype.getNodeCapacity=function(){return this._nodeCapacity};vr.prototype.lastNode=function(e){return e.get(e.size()-1)};vr.prototype.size=function(){var e=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var t=arguments[0],n=0,i=t.getChildBoundables().iterator();i.hasNext();){var r=i.next();r instanceof ir?n+=e.size(r):r instanceof zs&&(n+=1)}return n}};vr.prototype.removeItem=function(e,t){for(var n=null,i=e.getChildBoundables().iterator();i.hasNext();){var r=i.next();r instanceof zs&&r.getItem()===t&&(n=r)}return n!==null?(e.getChildBoundables().remove(n),!0):!1};vr.prototype.itemsTree=function(){var e=this;if(arguments.length===0){this.build();var t=this.itemsTree(this._root);return t===null?new pe:t}else if(arguments.length===1){for(var n=arguments[0],i=new pe,r=n.getChildBoundables().iterator();r.hasNext();){var u=r.next();if(u instanceof ir){var p=e.itemsTree(u);p!==null&&i.add(p)}else u instanceof zs?i.add(u.getItem()):an.shouldNeverReachHere()}return i.size()<=0?null:i}};vr.prototype.insert=function(e,t){an.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new zs(e,t))};vr.prototype.boundablesAtLevel=function(){var e=this;if(arguments.length===1){var t=arguments[0],n=new pe;return this.boundablesAtLevel(t,this._root,n),n}else if(arguments.length===3){var i=arguments[0],r=arguments[1],u=arguments[2];if(an.isTrue(i>-2),r.getLevel()===i)return u.add(r),null;for(var p=r.getChildBoundables().iterator();p.hasNext();){var a=p.next();a instanceof ir?e.boundablesAtLevel(i,a,u):(an.isTrue(a instanceof zs),i===-1&&u.add(a))}return null}};vr.prototype.query=function(){var e=this;if(arguments.length===1){var t=arguments[0];this.build();var n=new pe;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.query(t,this._root,n),n}else if(arguments.length===2){var i=arguments[0],r=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),i)&&this.query(i,this._root,r)}else if(arguments.length===3){if(We(arguments[2],Hl)&&arguments[0]instanceof Object&&arguments[1]instanceof ir)for(var u=arguments[0],p=arguments[1],a=arguments[2],_=p.getChildBoundables(),x=0;x<_.size();x++){var S=_.get(x);e.getIntersectsOp().intersects(S.getBounds(),u)&&(S instanceof ir?e.query(u,S,a):S instanceof zs?a.visitItem(S.getItem()):an.shouldNeverReachHere())}else if(We(arguments[2],Ns)&&arguments[0]instanceof Object&&arguments[1]instanceof ir)for(var L=arguments[0],k=arguments[1],D=arguments[2],F=k.getChildBoundables(),K=0;K<F.size();K++){var W=F.get(K);e.getIntersectsOp().intersects(W.getBounds(),L)&&(W instanceof ir?e.query(L,W,D):W instanceof zs?D.add(W.getItem()):an.shouldNeverReachHere())}}};vr.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};vr.prototype.getRoot=function(){return this.build(),this._root};vr.prototype.remove=function(){var e=this;if(arguments.length===2){var t=arguments[0],n=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),t)?this.remove(t,this._root,n):!1}else if(arguments.length===3){var i=arguments[0],r=arguments[1],u=arguments[2],p=this.removeItem(r,u);if(p)return!0;for(var a=null,_=r.getChildBoundables().iterator();_.hasNext();){var x=_.next();if(e.getIntersectsOp().intersects(x.getBounds(),i)&&x instanceof ir&&(p=e.remove(i,x,u),p)){a=x;break}}return a!==null&&a.getChildBoundables().isEmpty()&&r.getChildBoundables().remove(a),p}};vr.prototype.createHigherLevels=function(e,t){an.isTrue(!e.isEmpty());var n=this.createParentBoundables(e,t+1);return n.size()===1?n.get(0):this.createHigherLevels(n,t+1)};vr.prototype.depth=function(){var e=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var t=arguments[0],n=0,i=t.getChildBoundables().iterator();i.hasNext();){var r=i.next();if(r instanceof ir){var u=e.depth(r);u>n&&(n=u)}}return n+1}};vr.prototype.createParentBoundables=function(e,t){var n=this;an.isTrue(!e.isEmpty());var i=new pe;i.add(this.createNode(t));var r=new pe(e);Fs.sort(r,this.getComparator());for(var u=r.iterator();u.hasNext();){var p=u.next();n.lastNode(i).getChildBoundables().size()===n.getNodeCapacity()&&i.add(n.createNode(t)),n.lastNode(i).addChildBoundable(p)}return i};vr.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};vr.prototype.interfaces_=function(){return[ws]};vr.prototype.getClass=function(){return vr};vr.compareDoubles=function(e,t){return e>t?1:e<t?-1:0};Mg.IntersectsOp.get=function(){return _C};Mg.serialVersionUID.get=function(){return-3886435814360241e3};Mg.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(vr,Mg);var _C=function(){},qh=function(){};qh.prototype.distance=function(e,t){};qh.prototype.interfaces_=function(){return[]};qh.prototype.getClass=function(){return qh};var yx=function(e){function t(i){i=i||t.DEFAULT_NODE_CAPACITY,e.call(this,i)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return t.prototype.createParentBoundablesFromVerticalSlices=function(i,r){var u=this;an.isTrue(i.length>0);for(var p=new pe,a=0;a<i.length;a++)p.addAll(u.createParentBoundablesFromVerticalSlice(i[a],r));return p},t.prototype.createNode=function(i){return new f1(i)},t.prototype.size=function(){return arguments.length===0?e.prototype.size.call(this):e.prototype.size.apply(this,arguments)},t.prototype.insert=function(){if(arguments.length===2){var i=arguments[0],r=arguments[1];if(i.isNull())return null;e.prototype.insert.call(this,i,r)}else return e.prototype.insert.apply(this,arguments)},t.prototype.getIntersectsOp=function(){return t.intersectsOp},t.prototype.verticalSlices=function(i,r){for(var u=Math.trunc(Math.ceil(i.size()/r)),p=new Array(r).fill(null),a=i.iterator(),_=0;_<r;_++){p[_]=new pe;for(var x=0;a.hasNext()&&x<u;){var S=a.next();p[_].add(S),x++}}return p},t.prototype.query=function(){if(arguments.length===1){var i=arguments[0];return e.prototype.query.call(this,i)}else if(arguments.length===2){var r=arguments[0],u=arguments[1];e.prototype.query.call(this,r,u)}else if(arguments.length===3){if(We(arguments[2],Hl)&&arguments[0]instanceof Object&&arguments[1]instanceof ir){var p=arguments[0],a=arguments[1],_=arguments[2];e.prototype.query.call(this,p,a,_)}else if(We(arguments[2],Ns)&&arguments[0]instanceof Object&&arguments[1]instanceof ir){var x=arguments[0],S=arguments[1],L=arguments[2];e.prototype.query.call(this,x,S,L)}}},t.prototype.getComparator=function(){return t.yComparator},t.prototype.createParentBoundablesFromVerticalSlice=function(i,r){return e.prototype.createParentBoundables.call(this,i,r)},t.prototype.remove=function(){if(arguments.length===2){var i=arguments[0],r=arguments[1];return e.prototype.remove.call(this,i,r)}else return e.prototype.remove.apply(this,arguments)},t.prototype.depth=function(){return arguments.length===0?e.prototype.depth.call(this):e.prototype.depth.apply(this,arguments)},t.prototype.createParentBoundables=function(i,r){an.isTrue(!i.isEmpty());var u=Math.trunc(Math.ceil(i.size()/this.getNodeCapacity())),p=new pe(i);Fs.sort(p,t.xComparator);var a=this.verticalSlices(p,Math.trunc(Math.ceil(Math.sqrt(u))));return this.createParentBoundablesFromVerticalSlices(a,r)},t.prototype.nearestNeighbour=function(){if(arguments.length===1){if(We(arguments[0],qh)){var i=arguments[0],r=new Xi(this.getRoot(),this.getRoot(),i);return this.nearestNeighbour(r)}else if(arguments[0]instanceof Xi){var u=arguments[0];return this.nearestNeighbour(u,Qe.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof t&&We(arguments[1],qh)){var p=arguments[0],a=arguments[1],_=new Xi(this.getRoot(),p.getRoot(),a);return this.nearestNeighbour(_)}else if(arguments[0]instanceof Xi&&typeof arguments[1]=="number"){var x=arguments[0],S=arguments[1],L=S,k=null,D=new gl;for(D.add(x);!D.isEmpty()&&L>0;){var F=D.poll(),K=F.getDistance();if(K>=L)break;F.isLeaves()?(L=K,k=F):F.expandToQueue(D,L)}return[k.getBoundable(0).getItem(),k.getBoundable(1).getItem()]}}else if(arguments.length===3){var W=arguments[0],Q=arguments[1],U=arguments[2],X=new zs(W,Q),Y=new Xi(this.getRoot(),X,U);return this.nearestNeighbour(Y)[0]}},t.prototype.interfaces_=function(){return[bc,ws]},t.prototype.getClass=function(){return t},t.centreX=function(i){return t.avg(i.getMinX(),i.getMaxX())},t.avg=function(i,r){return(i+r)/2},t.centreY=function(i){return t.avg(i.getMinY(),i.getMaxY())},n.STRtreeNode.get=function(){return f1},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[Nh]},compare:function(i,r){return e.compareDoubles(t.centreX(i.getBounds()),t.centreX(r.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[Nh]},compare:function(i,r){return e.compareDoubles(t.centreY(i.getBounds()),t.centreY(r.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[e.IntersectsOp]},intersects:function(i,r){return i.intersects(r)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(t,n),t}(vr),f1=function(e){function t(){var n=arguments[0];e.call(this,n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.computeBounds=function(){for(var n=null,i=this.getChildBoundables().iterator();i.hasNext();){var r=i.next();n===null?n=new ke(r.getBounds()):n.expandToInclude(r.getBounds())}return n},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ir),_o=function(){};_o.prototype.interfaces_=function(){return[]};_o.prototype.getClass=function(){return _o};_o.relativeSign=function(e,t){return e<t?-1:e>t?1:0};_o.compare=function(e,t,n){if(t.equals2D(n))return 0;var i=_o.relativeSign(t.x,n.x),r=_o.relativeSign(t.y,n.y);switch(e){case 0:return _o.compareValue(i,r);case 1:return _o.compareValue(r,i);case 2:return _o.compareValue(r,-i);case 3:return _o.compareValue(-i,r);case 4:return _o.compareValue(-i,-r);case 5:return _o.compareValue(-r,-i);case 6:return _o.compareValue(-r,i);case 7:return _o.compareValue(i,-r)}return an.shouldNeverReachHere("invalid octant value"),0};_o.compareValue=function(e,t){return e<0?-1:e>0?1:t<0?-1:t>0?1:0};var Yl=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var e=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];this._segString=e,this.coord=new Pt(t),this.segmentIndex=n,this._segmentOctant=i,this._isInterior=!t.equals2D(e.getCoordinate(n))};Yl.prototype.getCoordinate=function(){return this.coord};Yl.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex)};Yl.prototype.compareTo=function(e){var t=e;return this.segmentIndex<t.segmentIndex?-1:this.segmentIndex>t.segmentIndex?1:this.coord.equals2D(t.coord)?0:_o.compare(this._segmentOctant,this.coord,t.coord)};Yl.prototype.isEndPoint=function(e){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===e};Yl.prototype.isInterior=function(){return this._isInterior};Yl.prototype.interfaces_=function(){return[xs]};Yl.prototype.getClass=function(){return Yl};var ao=function(){this._nodeMap=new jr,this._edge=null;var e=arguments[0];this._edge=e};ao.prototype.getSplitCoordinates=function(){var e=this,t=new dd;this.addEndpoints();for(var n=this.iterator(),i=n.next();n.hasNext();){var r=n.next();e.addEdgeCoordinates(i,r,t),i=r}return t.toCoordinateArray()};ao.prototype.addCollapsedNodes=function(){var e=this,t=new pe;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var n=t.iterator();n.hasNext();){var i=n.next().intValue();e.add(e._edge.getCoordinate(i),i)}};ao.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();){var n=t.next();n.print(e)}};ao.prototype.findCollapsesFromExistingVertices=function(e){for(var t=this,n=0;n<this._edge.size()-2;n++){var i=t._edge.getCoordinate(n),r=t._edge.getCoordinate(n+2);i.equals2D(r)&&e.add(new la(n+1))}};ao.prototype.addEdgeCoordinates=function(e,t,n){var i=this,r=this._edge.getCoordinate(t.segmentIndex),u=t.isInterior()||!t.coord.equals2D(r);n.add(new Pt(e.coord),!1);for(var p=e.segmentIndex+1;p<=t.segmentIndex;p++)n.add(i._edge.getCoordinate(p));u&&n.add(new Pt(t.coord))};ao.prototype.iterator=function(){return this._nodeMap.values().iterator()};ao.prototype.addSplitEdges=function(e){var t=this;this.addEndpoints(),this.addCollapsedNodes();for(var n=this.iterator(),i=n.next();n.hasNext();){var r=n.next(),u=t.createSplitEdge(i,r);e.add(u),i=r}};ao.prototype.findCollapseIndex=function(e,t,n){if(!e.coord.equals2D(t.coord))return!1;var i=t.segmentIndex-e.segmentIndex;return t.isInterior()||i--,i===1?(n[0]=e.segmentIndex+1,!0):!1};ao.prototype.findCollapsesFromInsertedNodes=function(e){for(var t=this,n=new Array(1).fill(null),i=this.iterator(),r=i.next();i.hasNext();){var u=i.next(),p=t.findCollapseIndex(r,u,n);p&&e.add(new la(n[0])),r=u}};ao.prototype.getEdge=function(){return this._edge};ao.prototype.addEndpoints=function(){var e=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(e),e)};ao.prototype.createSplitEdge=function(e,t){var n=this,i=t.segmentIndex-e.segmentIndex+2,r=this._edge.getCoordinate(t.segmentIndex),u=t.isInterior()||!t.coord.equals2D(r);u||i--;var p=new Array(i).fill(null),a=0;p[a++]=new Pt(e.coord);for(var _=e.segmentIndex+1;_<=t.segmentIndex;_++)p[a++]=n._edge.getCoordinate(_);return u&&(p[a]=new Pt(t.coord)),new Gi(p,this._edge.getData())};ao.prototype.add=function(e,t){var n=new Yl(this._edge,e,t,this._edge.getSegmentOctant(t)),i=this._nodeMap.get(n);return i!==null?(an.isTrue(i.coord.equals2D(e),"Found equal nodes with different coordinates"),i):(this._nodeMap.put(n,n),n)};ao.prototype.checkSplitEdgesCorrectness=function(e){var t=this._edge.getCoordinates(),n=e.get(0),i=n.getCoordinate(0);if(!i.equals2D(t[0]))throw new fl("bad split edge start point at "+i);var r=e.get(e.size()-1),u=r.getCoordinates(),p=u[u.length-1];if(!p.equals2D(t[t.length-1]))throw new fl("bad split edge end point at "+p)};ao.prototype.interfaces_=function(){return[]};ao.prototype.getClass=function(){return ao};var xc=function(){};xc.prototype.interfaces_=function(){return[]};xc.prototype.getClass=function(){return xc};xc.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1];if(e===0&&t===0)throw new di("Cannot compute the octant for point ( "+e+", "+t+" )");var n=Math.abs(e),i=Math.abs(t);return e>=0?t>=0?n>=i?0:1:n>=i?7:6:t>=0?n>=i?3:2:n>=i?4:5}else if(arguments[0]instanceof Pt&&arguments[1]instanceof Pt){var r=arguments[0],u=arguments[1],p=u.x-r.x,a=u.y-r.y;if(p===0&&a===0)throw new di("Cannot compute the octant for two identical points "+r);return xc.octant(p,a)}};var Ua=function(){};Ua.prototype.getCoordinates=function(){};Ua.prototype.size=function(){};Ua.prototype.getCoordinate=function(e){};Ua.prototype.isClosed=function(){};Ua.prototype.setData=function(e){};Ua.prototype.getData=function(){};Ua.prototype.interfaces_=function(){return[]};Ua.prototype.getClass=function(){return Ua};var Jf=function(){};Jf.prototype.addIntersection=function(e,t){};Jf.prototype.interfaces_=function(){return[Ua]};Jf.prototype.getClass=function(){return Jf};var Gi=function(){this._nodeList=new ao(this),this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t};Gi.prototype.getCoordinates=function(){return this._pts};Gi.prototype.size=function(){return this._pts.length};Gi.prototype.getCoordinate=function(e){return this._pts[e]};Gi.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};Gi.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(e),this.getCoordinate(e+1))};Gi.prototype.setData=function(e){this._data=e};Gi.prototype.safeOctant=function(e,t){return e.equals2D(t)?0:xc.octant(e,t)};Gi.prototype.getData=function(){return this._data};Gi.prototype.addIntersection=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];this.addIntersectionNode(e,t)}else if(arguments.length===4){var n=arguments[0],i=arguments[1],r=arguments[3],u=new Pt(n.getIntersection(r));this.addIntersection(u,i)}};Gi.prototype.toString=function(){return Rs.toLineString(new zi(this._pts))};Gi.prototype.getNodeList=function(){return this._nodeList};Gi.prototype.addIntersectionNode=function(e,t){var n=t,i=n+1;if(i<this._pts.length){var r=this._pts[i];e.equals2D(r)&&(n=i)}var u=this._nodeList.add(e,n);return u};Gi.prototype.addIntersections=function(e,t,n){for(var i=this,r=0;r<e.getIntersectionNum();r++)i.addIntersection(e,t,n,r)};Gi.prototype.interfaces_=function(){return[Jf]};Gi.prototype.getClass=function(){return Gi};Gi.getNodedSubstrings=function(){if(arguments.length===1){var e=arguments[0],t=new pe;return Gi.getNodedSubstrings(e,t),t}else if(arguments.length===2)for(var n=arguments[0],i=arguments[1],r=n.iterator();r.hasNext();){var u=r.next();u.getNodeList().addSplitEdges(i)}};var Ne=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new Pt,this.p1=new Pt;else if(arguments.length===1){var e=arguments[0];this.p0=new Pt(e.p0),this.p1=new Pt(e.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var t=arguments[0],n=arguments[1],i=arguments[2],r=arguments[3];this.p0=new Pt(t,n),this.p1=new Pt(i,r)}},vx={serialVersionUID:{configurable:!0}};Ne.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};Ne.prototype.orientationIndex=function(){if(arguments[0]instanceof Ne){var e=arguments[0],t=ve.orientationIndex(this.p0,this.p1,e.p0),n=ve.orientationIndex(this.p0,this.p1,e.p1);return t>=0&&n>=0||t<=0&&n<=0?Math.max(t,n):0}else if(arguments[0]instanceof Pt){var i=arguments[0];return ve.orientationIndex(this.p0,this.p1,i)}};Ne.prototype.toGeometry=function(e){return e.createLineString([this.p0,this.p1])};Ne.prototype.isVertical=function(){return this.p0.x===this.p1.x};Ne.prototype.equals=function(e){if(!(e instanceof Ne))return!1;var t=e;return this.p0.equals(t.p0)&&this.p1.equals(t.p1)};Ne.prototype.intersection=function(e){var t=new Zu;return t.computeIntersection(this.p0,this.p1,e.p0,e.p1),t.hasIntersection()?t.getIntersection(0):null};Ne.prototype.project=function(){if(arguments[0]instanceof Pt){var e=arguments[0];if(e.equals(this.p0)||e.equals(this.p1))return new Pt(e);var t=this.projectionFactor(e),n=new Pt;return n.x=this.p0.x+t*(this.p1.x-this.p0.x),n.y=this.p0.y+t*(this.p1.y-this.p0.y),n}else if(arguments[0]instanceof Ne){var i=arguments[0],r=this.projectionFactor(i.p0),u=this.projectionFactor(i.p1);if(r>=1&&u>=1||r<=0&&u<=0)return null;var p=this.project(i.p0);r<0&&(p=this.p0),r>1&&(p=this.p1);var a=this.project(i.p1);return u<0&&(a=this.p0),u>1&&(a=this.p1),new Ne(p,a)}};Ne.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};Ne.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};Ne.prototype.getCoordinate=function(e){return e===0?this.p0:this.p1};Ne.prototype.distancePerpendicular=function(e){return ve.distancePointLinePerpendicular(e,this.p0,this.p1)};Ne.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};Ne.prototype.midPoint=function(){return Ne.midPoint(this.p0,this.p1)};Ne.prototype.projectionFactor=function(e){if(e.equals(this.p0))return 0;if(e.equals(this.p1))return 1;var t=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,i=t*t+n*n;if(i<=0)return Qe.NaN;var r=((e.x-this.p0.x)*t+(e.y-this.p0.y)*n)/i;return r};Ne.prototype.closestPoints=function(e){var t=this.intersection(e);if(t!==null)return[t,t];var n=new Array(2).fill(null),i=Qe.MAX_VALUE,r=null,u=this.closestPoint(e.p0);i=u.distance(e.p0),n[0]=u,n[1]=e.p0;var p=this.closestPoint(e.p1);r=p.distance(e.p1),r<i&&(i=r,n[0]=p,n[1]=e.p1);var a=e.closestPoint(this.p0);r=a.distance(this.p0),r<i&&(i=r,n[0]=this.p0,n[1]=a);var _=e.closestPoint(this.p1);return r=_.distance(this.p1),r<i&&(i=r,n[0]=this.p1,n[1]=_),n};Ne.prototype.closestPoint=function(e){var t=this.projectionFactor(e);if(t>0&&t<1)return this.project(e);var n=this.p0.distance(e),i=this.p1.distance(e);return n<i?this.p0:this.p1};Ne.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};Ne.prototype.getLength=function(){return this.p0.distance(this.p1)};Ne.prototype.compareTo=function(e){var t=e,n=this.p0.compareTo(t.p0);return n!==0?n:this.p1.compareTo(t.p1)};Ne.prototype.reverse=function(){var e=this.p0;this.p0=this.p1,this.p1=e};Ne.prototype.equalsTopo=function(e){return this.p0.equals(e.p0)&&(this.p1.equals(e.p1)||this.p0.equals(e.p1))&&this.p1.equals(e.p0)};Ne.prototype.lineIntersection=function(e){try{var t=ks.intersection(this.p0,this.p1,e.p0,e.p1);return t}catch(n){if(!(n instanceof op))throw n}finally{}return null};Ne.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};Ne.prototype.pointAlongOffset=function(e,t){var n=this.p0.x+e*(this.p1.x-this.p0.x),i=this.p0.y+e*(this.p1.y-this.p0.y),r=this.p1.x-this.p0.x,u=this.p1.y-this.p0.y,p=Math.sqrt(r*r+u*u),a=0,_=0;if(t!==0){if(p<=0)throw new Error("Cannot compute offset from zero-length line segment");a=t*r/p,_=t*u/p}var x=n-_,S=i+a,L=new Pt(x,S);return L};Ne.prototype.setCoordinates=function(){if(arguments.length===1){var e=arguments[0];this.setCoordinates(e.p0,e.p1)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.p0.x=t.x,this.p0.y=t.y,this.p1.x=n.x,this.p1.y=n.y}};Ne.prototype.segmentFraction=function(e){var t=this.projectionFactor(e);return t<0?t=0:(t>1||Qe.isNaN(t))&&(t=1),t};Ne.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};Ne.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};Ne.prototype.distance=function(){if(arguments[0]instanceof Ne){var e=arguments[0];return ve.distanceLineLine(this.p0,this.p1,e.p0,e.p1)}else if(arguments[0]instanceof Pt){var t=arguments[0];return ve.distancePointLine(t,this.p0,this.p1)}};Ne.prototype.pointAlong=function(e){var t=new Pt;return t.x=this.p0.x+e*(this.p1.x-this.p0.x),t.y=this.p0.y+e*(this.p1.y-this.p0.y),t};Ne.prototype.hashCode=function(){var e=Qe.doubleToLongBits(this.p0.x);e^=Qe.doubleToLongBits(this.p0.y)*31;var t=Math.trunc(e)^Math.trunc(e>>32),n=Qe.doubleToLongBits(this.p1.x);n^=Qe.doubleToLongBits(this.p1.y)*31;var i=Math.trunc(n)^Math.trunc(n>>32);return t^i};Ne.prototype.interfaces_=function(){return[xs,ws]};Ne.prototype.getClass=function(){return Ne};Ne.midPoint=function(e,t){return new Pt((e.x+t.x)/2,(e.y+t.y)/2)};vx.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(Ne,vx);var Qf=function(){this.tempEnv1=new ke,this.tempEnv2=new ke,this._overlapSeg1=new Ne,this._overlapSeg2=new Ne};Qf.prototype.overlap=function(){if(arguments.length!==2&&arguments.length===4){var e=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];e.getLineSegment(t,this._overlapSeg1),n.getLineSegment(i,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}};Qf.prototype.interfaces_=function(){return[]};Qf.prototype.getClass=function(){return Qf};var Ro=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var e=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];this._pts=e,this._start=t,this._end=n,this._context=i};Ro.prototype.getLineSegment=function(e,t){t.p0=this._pts[e],t.p1=this._pts[e+1]};Ro.prototype.computeSelect=function(e,t,n,i){var r=this._pts[t],u=this._pts[n];if(i.tempEnv1.init(r,u),n-t===1)return i.select(this,t),null;if(!e.intersects(i.tempEnv1))return null;var p=Math.trunc((t+n)/2);t<p&&this.computeSelect(e,t,p,i),p<n&&this.computeSelect(e,p,n,i)};Ro.prototype.getCoordinates=function(){for(var e=this,t=new Array(this._end-this._start+1).fill(null),n=0,i=this._start;i<=this._end;i++)t[n++]=e._pts[i];return t};Ro.prototype.computeOverlaps=function(e,t){this.computeOverlapsInternal(this._start,this._end,e,e._start,e._end,t)};Ro.prototype.setId=function(e){this._id=e};Ro.prototype.select=function(e,t){this.computeSelect(e,this._start,this._end,t)};Ro.prototype.getEnvelope=function(){if(this._env===null){var e=this._pts[this._start],t=this._pts[this._end];this._env=new ke(e,t)}return this._env};Ro.prototype.getEndIndex=function(){return this._end};Ro.prototype.getStartIndex=function(){return this._start};Ro.prototype.getContext=function(){return this._context};Ro.prototype.getId=function(){return this._id};Ro.prototype.computeOverlapsInternal=function(e,t,n,i,r,u){var p=this._pts[e],a=this._pts[t],_=n._pts[i],x=n._pts[r];if(t-e===1&&r-i===1)return u.overlap(this,e,n,i),null;if(u.tempEnv1.init(p,a),u.tempEnv2.init(_,x),!u.tempEnv1.intersects(u.tempEnv2))return null;var S=Math.trunc((e+t)/2),L=Math.trunc((i+r)/2);e<S&&(i<L&&this.computeOverlapsInternal(e,S,n,i,L,u),L<r&&this.computeOverlapsInternal(e,S,n,L,r,u)),S<t&&(i<L&&this.computeOverlapsInternal(S,t,n,i,L,u),L<r&&this.computeOverlapsInternal(S,t,n,L,r,u))};Ro.prototype.interfaces_=function(){return[]};Ro.prototype.getClass=function(){return Ro};var sa=function(){};sa.prototype.interfaces_=function(){return[]};sa.prototype.getClass=function(){return sa};sa.getChainStartIndices=function(e){var t=0,n=new pe;n.add(new la(t));do{var i=sa.findChainEnd(e,t);n.add(new la(i)),t=i}while(t<e.length-1);var r=sa.toIntArray(n);return r};sa.findChainEnd=function(e,t){for(var n=t;n<e.length-1&&e[n].equals2D(e[n+1]);)n++;if(n>=e.length-1)return e.length-1;for(var i=Xn.quadrant(e[n],e[n+1]),r=t+1;r<e.length;){if(!e[r-1].equals2D(e[r])){var u=Xn.quadrant(e[r-1],e[r]);if(u!==i)break}r++}return r-1};sa.getChains=function(){if(arguments.length===1){var e=arguments[0];return sa.getChains(e,null)}else if(arguments.length===2){for(var t=arguments[0],n=arguments[1],i=new pe,r=sa.getChainStartIndices(t),u=0;u<r.length-1;u++){var p=new Ro(t,r[u],r[u+1],n);i.add(p)}return i}};sa.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),n=0;n<t.length;n++)t[n]=e.get(n).intValue();return t};var zu=function(){};zu.prototype.computeNodes=function(e){};zu.prototype.getNodedSubstrings=function(){};zu.prototype.interfaces_=function(){return[]};zu.prototype.getClass=function(){return zu};var $f=function(){if(this._segInt=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];this.setSegmentIntersector(e)}};$f.prototype.setSegmentIntersector=function(e){this._segInt=e};$f.prototype.interfaces_=function(){return[zu]};$f.prototype.getClass=function(){return $f};var Oy=function(e){function t(i){i?e.call(this,i):e.call(this),this._monoChains=new pe,this._index=new yx,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={SegmentOverlapAction:{configurable:!0}};return t.prototype.getMonotoneChains=function(){return this._monoChains},t.prototype.getNodedSubstrings=function(){return Gi.getNodedSubstrings(this._nodedSegStrings)},t.prototype.getIndex=function(){return this._index},t.prototype.add=function(i){for(var r=this,u=sa.getChains(i.getCoordinates(),i),p=u.iterator();p.hasNext();){var a=p.next();a.setId(r._idCounter++),r._index.insert(a.getEnvelope(),a),r._monoChains.add(a)}},t.prototype.computeNodes=function(i){var r=this;this._nodedSegStrings=i;for(var u=i.iterator();u.hasNext();)r.add(u.next());this.intersectChains()},t.prototype.intersectChains=function(){for(var i=this,r=new d1(this._segInt),u=this._monoChains.iterator();u.hasNext();)for(var p=u.next(),a=i._index.query(p.getEnvelope()),_=a.iterator();_.hasNext();){var x=_.next();if(x.getId()>p.getId()&&(p.computeOverlaps(x,r),i._nOverlaps++),i._segInt.isDone())return null}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.SegmentOverlapAction.get=function(){return d1},Object.defineProperties(t,n),t}($f),d1=function(e){function t(){e.call(this),this._si=null;var n=arguments[0];this._si=n}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.overlap=function(){if(arguments.length===4){var n=arguments[0],i=arguments[1],r=arguments[2],u=arguments[3],p=n.getContext(),a=r.getContext();this._si.processIntersections(p,i,a,u)}else return e.prototype.overlap.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Qf),Nn=function e(){if(this._quadrantSegments=e.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=e.CAP_ROUND,this._joinStyle=e.JOIN_ROUND,this._mitreLimit=e.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=e.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var t=arguments[0];this.setQuadrantSegments(t)}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(i)}else if(arguments.length===4){var r=arguments[0],u=arguments[1],p=arguments[2],a=arguments[3];this.setQuadrantSegments(r),this.setEndCapStyle(u),this.setJoinStyle(p),this.setMitreLimit(a)}}},bl={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Nn.prototype.getEndCapStyle=function(){return this._endCapStyle};Nn.prototype.isSingleSided=function(){return this._isSingleSided};Nn.prototype.setQuadrantSegments=function(e){this._quadrantSegments=e,this._quadrantSegments===0&&(this._joinStyle=Nn.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Nn.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),e<=0&&(this._quadrantSegments=1),this._joinStyle!==Nn.JOIN_ROUND&&(this._quadrantSegments=Nn.DEFAULT_QUADRANT_SEGMENTS)};Nn.prototype.getJoinStyle=function(){return this._joinStyle};Nn.prototype.setJoinStyle=function(e){this._joinStyle=e};Nn.prototype.setSimplifyFactor=function(e){this._simplifyFactor=e<0?0:e};Nn.prototype.getSimplifyFactor=function(){return this._simplifyFactor};Nn.prototype.getQuadrantSegments=function(){return this._quadrantSegments};Nn.prototype.setEndCapStyle=function(e){this._endCapStyle=e};Nn.prototype.getMitreLimit=function(){return this._mitreLimit};Nn.prototype.setMitreLimit=function(e){this._mitreLimit=e};Nn.prototype.setSingleSided=function(e){this._isSingleSided=e};Nn.prototype.interfaces_=function(){return[]};Nn.prototype.getClass=function(){return Nn};Nn.bufferDistanceError=function(e){var t=Math.PI/2/e;return 1-Math.cos(t/2)};bl.CAP_ROUND.get=function(){return 1};bl.CAP_FLAT.get=function(){return 2};bl.CAP_SQUARE.get=function(){return 3};bl.JOIN_ROUND.get=function(){return 1};bl.JOIN_MITRE.get=function(){return 2};bl.JOIN_BEVEL.get=function(){return 3};bl.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};bl.DEFAULT_MITRE_LIMIT.get=function(){return 5};bl.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(Nn,bl);var Pi=function(e){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=ve.COUNTERCLOCKWISE,this._inputLine=e||null},_d={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Pi.prototype.isDeletable=function(e,t,n,i){var r=this._inputLine[e],u=this._inputLine[t],p=this._inputLine[n];return!this.isConcave(r,u,p)||!this.isShallow(r,u,p,i)?!1:this.isShallowSampled(r,u,e,n,i)};Pi.prototype.deleteShallowConcavities=function(){for(var e=this,t=1,n=this.findNextNonDeletedIndex(t),i=this.findNextNonDeletedIndex(n),r=!1;i<this._inputLine.length;){var u=!1;e.isDeletable(t,n,i,e._distanceTol)&&(e._isDeleted[n]=Pi.DELETE,u=!0,r=!0),u?t=i:t=n,n=e.findNextNonDeletedIndex(t),i=e.findNextNonDeletedIndex(n)}return r};Pi.prototype.isShallowConcavity=function(e,t,n,i){var r=ve.computeOrientation(e,t,n),u=r===this._angleOrientation;if(!u)return!1;var p=ve.distancePointLine(t,e,n);return p<i};Pi.prototype.isShallowSampled=function(e,t,n,i,r){var u=this,p=Math.trunc((i-n)/Pi.NUM_PTS_TO_CHECK);p<=0&&(p=1);for(var a=n;a<i;a+=p)if(!u.isShallow(e,t,u._inputLine[a],r))return!1;return!0};Pi.prototype.isConcave=function(e,t,n){var i=ve.computeOrientation(e,t,n),r=i===this._angleOrientation;return r};Pi.prototype.simplify=function(e){var t=this;this._distanceTol=Math.abs(e),e<0&&(this._angleOrientation=ve.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var n=!1;do n=t.deleteShallowConcavities();while(n);return this.collapseLine()};Pi.prototype.findNextNonDeletedIndex=function(e){for(var t=e+1;t<this._inputLine.length&&this._isDeleted[t]===Pi.DELETE;)t++;return t};Pi.prototype.isShallow=function(e,t,n,i){var r=ve.distancePointLine(t,e,n);return r<i};Pi.prototype.collapseLine=function(){for(var e=this,t=new dd,n=0;n<this._inputLine.length;n++)e._isDeleted[n]!==Pi.DELETE&&t.add(e._inputLine[n]);return t.toCoordinateArray()};Pi.prototype.interfaces_=function(){return[]};Pi.prototype.getClass=function(){return Pi};Pi.simplify=function(e,t){var n=new Pi(e);return n.simplify(t)};_d.INIT.get=function(){return 0};_d.DELETE.get=function(){return 1};_d.KEEP.get=function(){return 1};_d.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(Pi,_d);var $o=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new pe},bx={COORDINATE_ARRAY_TYPE:{configurable:!0}};$o.prototype.getCoordinates=function(){var e=this._ptList.toArray($o.COORDINATE_ARRAY_TYPE);return e};$o.prototype.setPrecisionModel=function(e){this._precisionModel=e};$o.prototype.addPt=function(e){var t=new Pt(e);if(this._precisionModel.makePrecise(t),this.isRedundant(t))return null;this._ptList.add(t)};$o.prototype.revere=function(){};$o.prototype.addPts=function(e,t){var n=this;if(t)for(var i=0;i<e.length;i++)n.addPt(e[i]);else for(var r=e.length-1;r>=0;r--)n.addPt(e[r])};$o.prototype.isRedundant=function(e){if(this._ptList.size()<1)return!1;var t=this._ptList.get(this._ptList.size()-1),n=e.distance(t);return n<this._minimimVertexDistance};$o.prototype.toString=function(){var e=new _n,t=e.createLineString(this.getCoordinates());return t.toString()};$o.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var e=new Pt(this._ptList.get(0)),t=this._ptList.get(this._ptList.size()-1);if(e.equals(t))return null;this._ptList.add(e)};$o.prototype.setMinimumVertexDistance=function(e){this._minimimVertexDistance=e};$o.prototype.interfaces_=function(){return[]};$o.prototype.getClass=function(){return $o};bx.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties($o,bx);var En=function(){},Oc={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};En.prototype.interfaces_=function(){return[]};En.prototype.getClass=function(){return En};En.toDegrees=function(e){return e*180/Math.PI};En.normalize=function(e){for(;e>Math.PI;)e-=En.PI_TIMES_2;for(;e<=-Math.PI;)e+=En.PI_TIMES_2;return e};En.angle=function(){if(arguments.length===1){var e=arguments[0];return Math.atan2(e.y,e.x)}else if(arguments.length===2){var t=arguments[0],n=arguments[1],i=n.x-t.x,r=n.y-t.y;return Math.atan2(r,i)}};En.isAcute=function(e,t,n){var i=e.x-t.x,r=e.y-t.y,u=n.x-t.x,p=n.y-t.y,a=i*u+r*p;return a>0};En.isObtuse=function(e,t,n){var i=e.x-t.x,r=e.y-t.y,u=n.x-t.x,p=n.y-t.y,a=i*u+r*p;return a<0};En.interiorAngle=function(e,t,n){var i=En.angle(t,e),r=En.angle(t,n);return Math.abs(r-i)};En.normalizePositive=function(e){if(e<0){for(;e<0;)e+=En.PI_TIMES_2;e>=En.PI_TIMES_2&&(e=0)}else{for(;e>=En.PI_TIMES_2;)e-=En.PI_TIMES_2;e<0&&(e=0)}return e};En.angleBetween=function(e,t,n){var i=En.angle(t,e),r=En.angle(t,n);return En.diff(i,r)};En.diff=function(e,t){var n=null;return e<t?n=t-e:n=e-t,n>Math.PI&&(n=2*Math.PI-n),n};En.toRadians=function(e){return e*Math.PI/180};En.getTurn=function(e,t){var n=Math.sin(t-e);return n>0?En.COUNTERCLOCKWISE:n<0?En.CLOCKWISE:En.NONE};En.angleBetweenOriented=function(e,t,n){var i=En.angle(t,e),r=En.angle(t,n),u=r-i;return u<=-Math.PI?u+En.PI_TIMES_2:u>Math.PI?u-En.PI_TIMES_2:u};Oc.PI_TIMES_2.get=function(){return 2*Math.PI};Oc.PI_OVER_2.get=function(){return Math.PI/2};Oc.PI_OVER_4.get=function(){return Math.PI/4};Oc.COUNTERCLOCKWISE.get=function(){return ve.COUNTERCLOCKWISE};Oc.CLOCKWISE.get=function(){return ve.CLOCKWISE};Oc.NONE.get=function(){return ve.COLLINEAR};Object.defineProperties(En,Oc);var ci=function e(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Ne,this._seg1=new Ne,this._offset0=new Ne,this._offset1=new Ne,this._side=0,this._hasNarrowConcaveAngle=!1;var t=arguments[0],n=arguments[1],i=arguments[2];this._precisionModel=t,this._bufParams=n,this._li=new Zu,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===Nn.JOIN_ROUND&&(this._closingSegLengthFactor=e.MAX_CLOSING_SEG_LEN_FACTOR),this.init(i)},yd={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};ci.prototype.addNextSegment=function(e,t){if(this._s0=this._s1,this._s1=this._s2,this._s2=e,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=ve.computeOrientation(this._s0,this._s1,this._s2),i=n===ve.CLOCKWISE&&this._side===oe.LEFT||n===ve.COUNTERCLOCKWISE&&this._side===oe.RIGHT;n===0?this.addCollinear(t):i?this.addOutsideTurn(n,t):this.addInsideTurn(n,t)};ci.prototype.addLineEndCap=function(e,t){var n=new Ne(e,t),i=new Ne;this.computeOffsetSegment(n,oe.LEFT,this._distance,i);var r=new Ne;this.computeOffsetSegment(n,oe.RIGHT,this._distance,r);var u=t.x-e.x,p=t.y-e.y,a=Math.atan2(p,u);switch(this._bufParams.getEndCapStyle()){case Nn.CAP_ROUND:this._segList.addPt(i.p1),this.addFilletArc(t,a+Math.PI/2,a-Math.PI/2,ve.CLOCKWISE,this._distance),this._segList.addPt(r.p1);break;case Nn.CAP_FLAT:this._segList.addPt(i.p1),this._segList.addPt(r.p1);break;case Nn.CAP_SQUARE:var _=new Pt;_.x=Math.abs(this._distance)*Math.cos(a),_.y=Math.abs(this._distance)*Math.sin(a);var x=new Pt(i.p1.x+_.x,i.p1.y+_.y),S=new Pt(r.p1.x+_.x,r.p1.y+_.y);this._segList.addPt(x),this._segList.addPt(S);break}};ci.prototype.getCoordinates=function(){var e=this._segList.getCoordinates();return e};ci.prototype.addMitreJoin=function(e,t,n,i){var r=!0,u=null;try{u=ks.intersection(t.p0,t.p1,n.p0,n.p1);var p=i<=0?1:u.distance(e)/Math.abs(i);p>this._bufParams.getMitreLimit()&&(r=!1)}catch(a){if(a instanceof op)u=new Pt(0,0),r=!1;else throw a}finally{}r?this._segList.addPt(u):this.addLimitedMitreJoin(t,n,i,this._bufParams.getMitreLimit())};ci.prototype.addFilletCorner=function(e,t,n,i,r){var u=t.x-e.x,p=t.y-e.y,a=Math.atan2(p,u),_=n.x-e.x,x=n.y-e.y,S=Math.atan2(x,_);i===ve.CLOCKWISE?a<=S&&(a+=2*Math.PI):a>=S&&(a-=2*Math.PI),this._segList.addPt(t),this.addFilletArc(e,a,S,i,r),this._segList.addPt(n)};ci.prototype.addOutsideTurn=function(e,t){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*ci.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Nn.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Nn.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(t&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,e,this._distance),this._segList.addPt(this._offset1.p0))};ci.prototype.createSquare=function(e){this._segList.addPt(new Pt(e.x+this._distance,e.y+this._distance)),this._segList.addPt(new Pt(e.x+this._distance,e.y-this._distance)),this._segList.addPt(new Pt(e.x-this._distance,e.y-this._distance)),this._segList.addPt(new Pt(e.x-this._distance,e.y+this._distance)),this._segList.closeRing()};ci.prototype.addSegments=function(e,t){this._segList.addPts(e,t)};ci.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};ci.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};ci.prototype.initSideSegments=function(e,t,n){this._s1=e,this._s2=t,this._side=n,this._seg1.setCoordinates(e,t),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)};ci.prototype.addLimitedMitreJoin=function(e,t,n,i){var r=this._seg0.p1,u=En.angle(r,this._seg0.p0),p=En.angleBetweenOriented(this._seg0.p0,r,this._seg1.p1),a=p/2,_=En.normalize(u+a),x=En.normalize(_+Math.PI),S=i*n,L=S*Math.abs(Math.sin(a)),k=n-L,D=r.x+S*Math.cos(x),F=r.y+S*Math.sin(x),K=new Pt(D,F),W=new Ne(r,K),Q=W.pointAlongOffset(1,k),U=W.pointAlongOffset(1,-k);this._side===oe.LEFT?(this._segList.addPt(Q),this._segList.addPt(U)):(this._segList.addPt(U),this._segList.addPt(Q))};ci.prototype.computeOffsetSegment=function(e,t,n,i){var r=t===oe.LEFT?1:-1,u=e.p1.x-e.p0.x,p=e.p1.y-e.p0.y,a=Math.sqrt(u*u+p*p),_=r*n*u/a,x=r*n*p/a;i.p0.x=e.p0.x-x,i.p0.y=e.p0.y+_,i.p1.x=e.p1.x-x,i.p1.y=e.p1.y+_};ci.prototype.addFilletArc=function(e,t,n,i,r){var u=this,p=i===ve.CLOCKWISE?-1:1,a=Math.abs(t-n),_=Math.trunc(a/this._filletAngleQuantum+.5);if(_<1)return null;for(var x=0,S=a/_,L=x,k=new Pt;L<a;){var D=t+p*L;k.x=e.x+r*Math.cos(D),k.y=e.y+r*Math.sin(D),u._segList.addPt(k),L+=S}};ci.prototype.addInsideTurn=function(e,t){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*ci.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var n=new Pt((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n);var i=new Pt((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(i)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};ci.prototype.createCircle=function(e){var t=new Pt(e.x+this._distance,e.y);this._segList.addPt(t),this.addFilletArc(e,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};ci.prototype.addBevelJoin=function(e,t){this._segList.addPt(e.p1),this._segList.addPt(t.p0)};ci.prototype.init=function(e){this._distance=e,this._maxCurveSegmentError=e*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new $o,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(e*ci.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};ci.prototype.addCollinear=function(e){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var t=this._li.getIntersectionNum();t>=2&&(this._bufParams.getJoinStyle()===Nn.JOIN_BEVEL||this._bufParams.getJoinStyle()===Nn.JOIN_MITRE?(e&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,ve.CLOCKWISE,this._distance))};ci.prototype.closeRing=function(){this._segList.closeRing()};ci.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};ci.prototype.interfaces_=function(){return[]};ci.prototype.getClass=function(){return ci};yd.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};yd.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};yd.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};yd.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(ci,yd);var vo=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var e=arguments[0],t=arguments[1];this._precisionModel=e,this._bufParams=t};vo.prototype.getOffsetCurve=function(e,t){if(this._distance=t,t===0)return null;var n=t<0,i=Math.abs(t),r=this.getSegGen(i);e.length<=1?this.computePointCurve(e[0],r):this.computeOffsetCurve(e,n,r);var u=r.getCoordinates();return n&&yn.reverse(u),u};vo.prototype.computeSingleSidedBufferCurve=function(e,t,n){var i=this.simplifyTolerance(this._distance);if(t){n.addSegments(e,!0);var r=Pi.simplify(e,-i),u=r.length-1;n.initSideSegments(r[u],r[u-1],oe.LEFT),n.addFirstSegment();for(var p=u-2;p>=0;p--)n.addNextSegment(r[p],!0)}else{n.addSegments(e,!1);var a=Pi.simplify(e,i),_=a.length-1;n.initSideSegments(a[0],a[1],oe.LEFT),n.addFirstSegment();for(var x=2;x<=_;x++)n.addNextSegment(a[x],!0)}n.addLastSegment(),n.closeRing()};vo.prototype.computeRingBufferCurve=function(e,t,n){var i=this.simplifyTolerance(this._distance);t===oe.RIGHT&&(i=-i);var r=Pi.simplify(e,i),u=r.length-1;n.initSideSegments(r[u-1],r[0],t);for(var p=1;p<=u;p++){var a=p!==1;n.addNextSegment(r[p],a)}n.closeRing()};vo.prototype.computeLineBufferCurve=function(e,t){var n=this.simplifyTolerance(this._distance),i=Pi.simplify(e,n),r=i.length-1;t.initSideSegments(i[0],i[1],oe.LEFT);for(var u=2;u<=r;u++)t.addNextSegment(i[u],!0);t.addLastSegment(),t.addLineEndCap(i[r-1],i[r]);var p=Pi.simplify(e,-n),a=p.length-1;t.initSideSegments(p[a],p[a-1],oe.LEFT);for(var _=a-2;_>=0;_--)t.addNextSegment(p[_],!0);t.addLastSegment(),t.addLineEndCap(p[1],p[0]),t.closeRing()};vo.prototype.computePointCurve=function(e,t){switch(this._bufParams.getEndCapStyle()){case Nn.CAP_ROUND:t.createCircle(e);break;case Nn.CAP_SQUARE:t.createSquare(e);break}};vo.prototype.getLineCurve=function(e,t){if(this._distance=t,t<0&&!this._bufParams.isSingleSided()||t===0)return null;var n=Math.abs(t),i=this.getSegGen(n);if(e.length<=1)this.computePointCurve(e[0],i);else if(this._bufParams.isSingleSided()){var r=t<0;this.computeSingleSidedBufferCurve(e,r,i)}else this.computeLineBufferCurve(e,i);var u=i.getCoordinates();return u};vo.prototype.getBufferParameters=function(){return this._bufParams};vo.prototype.simplifyTolerance=function(e){return e*this._bufParams.getSimplifyFactor()};vo.prototype.getRingCurve=function(e,t,n){if(this._distance=n,e.length<=2)return this.getLineCurve(e,n);if(n===0)return vo.copyCoordinates(e);var i=this.getSegGen(n);return this.computeRingBufferCurve(e,t,i),i.getCoordinates()};vo.prototype.computeOffsetCurve=function(e,t,n){var i=this.simplifyTolerance(this._distance);if(t){var r=Pi.simplify(e,-i),u=r.length-1;n.initSideSegments(r[u],r[u-1],oe.LEFT),n.addFirstSegment();for(var p=u-2;p>=0;p--)n.addNextSegment(r[p],!0)}else{var a=Pi.simplify(e,i),_=a.length-1;n.initSideSegments(a[0],a[1],oe.LEFT),n.addFirstSegment();for(var x=2;x<=_;x++)n.addNextSegment(a[x],!0)}n.addLastSegment()};vo.prototype.getSegGen=function(e){return new ci(this._precisionModel,this._bufParams,e)};vo.prototype.interfaces_=function(){return[]};vo.prototype.getClass=function(){return vo};vo.copyCoordinates=function(e){for(var t=new Array(e.length).fill(null),n=0;n<t.length;n++)t[n]=new Pt(e[n]);return t};var wc=function(){this._subgraphs=null,this._seg=new Ne,this._cga=new ve;var e=arguments[0];this._subgraphs=e},xx={DepthSegment:{configurable:!0}};wc.prototype.findStabbedSegments=function(){var e=this;if(arguments.length===1){for(var t=arguments[0],n=new pe,i=this._subgraphs.iterator();i.hasNext();){var r=i.next(),u=r.getEnvelope();t.y<u.getMinY()||t.y>u.getMaxY()||e.findStabbedSegments(t,r.getDirectedEdges(),n)}return n}else if(arguments.length===3){if(We(arguments[2],Ns)&&arguments[0]instanceof Pt&&arguments[1]instanceof py)for(var p=arguments[0],a=arguments[1],_=arguments[2],x=a.getEdge().getCoordinates(),S=0;S<x.length-1;S++){e._seg.p0=x[S],e._seg.p1=x[S+1],e._seg.p0.y>e._seg.p1.y&&e._seg.reverse();var L=Math.max(e._seg.p0.x,e._seg.p1.x);if(!(L<p.x)&&!e._seg.isHorizontal()&&!(p.y<e._seg.p0.y||p.y>e._seg.p1.y)&&ve.computeOrientation(e._seg.p0,e._seg.p1,p)!==ve.RIGHT){var k=a.getDepth(oe.LEFT);e._seg.p0.equals(x[S])||(k=a.getDepth(oe.RIGHT));var D=new Fu(e._seg,k);_.add(D)}}else if(We(arguments[2],Ns)&&arguments[0]instanceof Pt&&We(arguments[1],Ns))for(var F=arguments[0],K=arguments[1],W=arguments[2],Q=K.iterator();Q.hasNext();){var U=Q.next();U.isForward()&&e.findStabbedSegments(F,U,W)}}};wc.prototype.getDepth=function(e){var t=this.findStabbedSegments(e);if(t.size()===0)return 0;var n=Fs.min(t);return n._leftDepth};wc.prototype.interfaces_=function(){return[]};wc.prototype.getClass=function(){return wc};xx.DepthSegment.get=function(){return Fu};Object.defineProperties(wc,xx);var Fu=function(){this._upwardSeg=null,this._leftDepth=null;var e=arguments[0],t=arguments[1];this._upwardSeg=new Ne(e),this._leftDepth=t};Fu.prototype.compareTo=function(e){var t=e;if(this._upwardSeg.minX()>=t._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=t._upwardSeg.minX())return-1;var n=this._upwardSeg.orientationIndex(t._upwardSeg);return n!==0||(n=-1*t._upwardSeg.orientationIndex(this._upwardSeg),n!==0)?n:this._upwardSeg.compareTo(t._upwardSeg)};Fu.prototype.compareX=function(e,t){var n=e.p0.compareTo(t.p0);return n!==0?n:e.p1.compareTo(t.p1)};Fu.prototype.toString=function(){return this._upwardSeg.toString()};Fu.prototype.interfaces_=function(){return[xs]};Fu.prototype.getClass=function(){return Fu};var Rn=function(e,t,n){this.p0=e||null,this.p1=t||null,this.p2=n||null};Rn.prototype.area=function(){return Rn.area(this.p0,this.p1,this.p2)};Rn.prototype.signedArea=function(){return Rn.signedArea(this.p0,this.p1,this.p2)};Rn.prototype.interpolateZ=function(e){if(e===null)throw new di("Supplied point is null.");return Rn.interpolateZ(e,this.p0,this.p1,this.p2)};Rn.prototype.longestSideLength=function(){return Rn.longestSideLength(this.p0,this.p1,this.p2)};Rn.prototype.isAcute=function(){return Rn.isAcute(this.p0,this.p1,this.p2)};Rn.prototype.circumcentre=function(){return Rn.circumcentre(this.p0,this.p1,this.p2)};Rn.prototype.area3D=function(){return Rn.area3D(this.p0,this.p1,this.p2)};Rn.prototype.centroid=function(){return Rn.centroid(this.p0,this.p1,this.p2)};Rn.prototype.inCentre=function(){return Rn.inCentre(this.p0,this.p1,this.p2)};Rn.prototype.interfaces_=function(){return[]};Rn.prototype.getClass=function(){return Rn};Rn.area=function(e,t,n){return Math.abs(((n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y))/2)};Rn.signedArea=function(e,t,n){return((n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y))/2};Rn.det=function(e,t,n,i){return e*i-t*n};Rn.interpolateZ=function(e,t,n,i){var r=t.x,u=t.y,p=n.x-r,a=i.x-r,_=n.y-u,x=i.y-u,S=p*x-a*_,L=e.x-r,k=e.y-u,D=(x*L-a*k)/S,F=(-_*L+p*k)/S,K=t.z+D*(n.z-t.z)+F*(i.z-t.z);return K};Rn.longestSideLength=function(e,t,n){var i=e.distance(t),r=t.distance(n),u=n.distance(e),p=i;return r>p&&(p=r),u>p&&(p=u),p};Rn.isAcute=function(e,t,n){return!(!En.isAcute(e,t,n)||!En.isAcute(t,n,e)||!En.isAcute(n,e,t))};Rn.circumcentre=function(e,t,n){var i=n.x,r=n.y,u=e.x-i,p=e.y-r,a=t.x-i,_=t.y-r,x=2*Rn.det(u,p,a,_),S=Rn.det(p,u*u+p*p,_,a*a+_*_),L=Rn.det(u,u*u+p*p,a,a*a+_*_),k=i-S/x,D=r+L/x;return new Pt(k,D)};Rn.perpendicularBisector=function(e,t){var n=t.x-e.x,i=t.y-e.y,r=new ks(e.x+n/2,e.y+i/2,1),u=new ks(e.x-i+n/2,e.y+n+i/2,1);return new ks(r,u)};Rn.angleBisector=function(e,t,n){var i=t.distance(e),r=t.distance(n),u=i/(i+r),p=n.x-e.x,a=n.y-e.y,_=new Pt(e.x+u*p,e.y+u*a);return _};Rn.area3D=function(e,t,n){var i=t.x-e.x,r=t.y-e.y,u=t.z-e.z,p=n.x-e.x,a=n.y-e.y,_=n.z-e.z,x=r*_-u*a,S=u*p-i*_,L=i*a-r*p,k=x*x+S*S+L*L,D=Math.sqrt(k)/2;return D};Rn.centroid=function(e,t,n){var i=(e.x+t.x+n.x)/3,r=(e.y+t.y+n.y)/3;return new Pt(i,r)};Rn.inCentre=function(e,t,n){var i=t.distance(n),r=e.distance(n),u=e.distance(t),p=i+r+u,a=(i*e.x+r*t.x+u*n.x)/p,_=(i*e.y+r*t.y+u*n.y)/p;return new Pt(a,_)};var vs=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new pe;var e=arguments[0],t=arguments[1],n=arguments[2];this._inputGeom=e,this._distance=t,this._curveBuilder=n};vs.prototype.addPoint=function(e){if(this._distance<=0)return null;var t=e.getCoordinates(),n=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(n,Dt.EXTERIOR,Dt.INTERIOR)};vs.prototype.addPolygon=function(e){var t=this,n=this._distance,i=oe.LEFT;this._distance<0&&(n=-this._distance,i=oe.RIGHT);var r=e.getExteriorRing(),u=yn.removeRepeatedPoints(r.getCoordinates());if(this._distance<0&&this.isErodedCompletely(r,this._distance)||this._distance<=0&&u.length<3)return null;this.addPolygonRing(u,n,i,Dt.EXTERIOR,Dt.INTERIOR);for(var p=0;p<e.getNumInteriorRing();p++){var a=e.getInteriorRingN(p),_=yn.removeRepeatedPoints(a.getCoordinates());t._distance>0&&t.isErodedCompletely(a,-t._distance)||t.addPolygonRing(_,n,oe.opposite(i),Dt.INTERIOR,Dt.EXTERIOR)}};vs.prototype.isTriangleErodedCompletely=function(e,t){var n=new Rn(e[0],e[1],e[2]),i=n.inCentre(),r=ve.distancePointLine(i,n.p0,n.p1);return r<Math.abs(t)};vs.prototype.addLineString=function(e){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var t=yn.removeRepeatedPoints(e.getCoordinates()),n=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(n,Dt.EXTERIOR,Dt.INTERIOR)};vs.prototype.addCurve=function(e,t,n){if(e===null||e.length<2)return null;var i=new Gi(e,new Vn(0,Dt.BOUNDARY,t,n));this._curveList.add(i)};vs.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};vs.prototype.addPolygonRing=function(e,t,n,i,r){if(t===0&&e.length<Ba.MINIMUM_VALID_SIZE)return null;var u=i,p=r;e.length>=Ba.MINIMUM_VALID_SIZE&&ve.isCCW(e)&&(u=r,p=i,n=oe.opposite(n));var a=this._curveBuilder.getRingCurve(e,n,t);this.addCurve(a,u,p)};vs.prototype.add=function(e){if(e.isEmpty())return null;e instanceof rr?this.addPolygon(e):e instanceof Mi?this.addLineString(e):e instanceof No?this.addPoint(e):e instanceof Vh?this.addCollection(e):e instanceof Ou?this.addCollection(e):e instanceof Oa?this.addCollection(e):e instanceof oo&&this.addCollection(e)};vs.prototype.isErodedCompletely=function(e,t){var n=e.getCoordinates();if(n.length<4)return t<0;if(n.length===4)return this.isTriangleErodedCompletely(n,t);var i=e.getEnvelopeInternal(),r=Math.min(i.getHeight(),i.getWidth());return t<0&&2*Math.abs(t)>r};vs.prototype.addCollection=function(e){for(var t=this,n=0;n<e.getNumGeometries();n++){var i=e.getGeometryN(n);t.add(i)}};vs.prototype.interfaces_=function(){return[]};vs.prototype.getClass=function(){return vs};var jh=function(){};jh.prototype.locate=function(e){};jh.prototype.interfaces_=function(){return[]};jh.prototype.getClass=function(){return jh};var za=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var e=arguments[0];this._parent=e,this._atStart=!0,this._index=0,this._max=e.getNumGeometries()};za.prototype.next=function(){if(this._atStart)return this._atStart=!1,za.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new ap;var e=this._parent.getGeometryN(this._index++);return e instanceof oo?(this._subcollectionIterator=new za(e),this._subcollectionIterator.next()):e};za.prototype.remove=function(){throw new Error(this.getClass().getName())};za.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};za.prototype.interfaces_=function(){return[sp]};za.prototype.getClass=function(){return za};za.isAtomic=function(e){return!(e instanceof oo)};var Yo=function(){this._geom=null;var e=arguments[0];this._geom=e};Yo.prototype.locate=function(e){return Yo.locate(e,this._geom)};Yo.prototype.interfaces_=function(){return[jh]};Yo.prototype.getClass=function(){return Yo};Yo.isPointInRing=function(e,t){return t.getEnvelopeInternal().intersects(e)?ve.isPointInRing(e,t.getCoordinates()):!1};Yo.containsPointInPolygon=function(e,t){if(t.isEmpty())return!1;var n=t.getExteriorRing();if(!Yo.isPointInRing(e,n))return!1;for(var i=0;i<t.getNumInteriorRing();i++){var r=t.getInteriorRingN(i);if(Yo.isPointInRing(e,r))return!1}return!0};Yo.containsPoint=function(e,t){if(t instanceof rr)return Yo.containsPointInPolygon(e,t);if(t instanceof oo)for(var n=new za(t);n.hasNext();){var i=n.next();if(i!==t&&Yo.containsPoint(e,i))return!0}return!1};Yo.locate=function(e,t){return t.isEmpty()?Dt.EXTERIOR:Yo.containsPoint(e,t)?Dt.INTERIOR:Dt.EXTERIOR};var Wr=function(){this._edgeMap=new jr,this._edgeList=null,this._ptInAreaLocation=[Dt.NONE,Dt.NONE]};Wr.prototype.getNextCW=function(e){this.getEdges();var t=this._edgeList.indexOf(e),n=t-1;return t===0&&(n=this._edgeList.size()-1),this._edgeList.get(n)};Wr.prototype.propagateSideLabels=function(e){for(var t=Dt.NONE,n=this.iterator();n.hasNext();){var i=n.next(),r=i.getLabel();r.isArea(e)&&r.getLocation(e,oe.LEFT)!==Dt.NONE&&(t=r.getLocation(e,oe.LEFT))}if(t===Dt.NONE)return null;for(var u=t,p=this.iterator();p.hasNext();){var a=p.next(),_=a.getLabel();if(_.getLocation(e,oe.ON)===Dt.NONE&&_.setLocation(e,oe.ON,u),_.isArea(e)){var x=_.getLocation(e,oe.LEFT),S=_.getLocation(e,oe.RIGHT);if(S!==Dt.NONE){if(S!==u)throw new ml("side location conflict",a.getCoordinate());x===Dt.NONE&&an.shouldNeverReachHere("found single null side (at "+a.getCoordinate()+")"),u=x}else an.isTrue(_.getLocation(e,oe.LEFT)===Dt.NONE,"found single null side"),_.setLocation(e,oe.RIGHT,u),_.setLocation(e,oe.LEFT,u)}}};Wr.prototype.getCoordinate=function(){var e=this.iterator();if(!e.hasNext())return null;var t=e.next();return t.getCoordinate()};Wr.prototype.print=function(e){Cr.out.println("EdgeEndStar:   "+this.getCoordinate());for(var t=this.iterator();t.hasNext();){var n=t.next();n.print(e)}};Wr.prototype.isAreaLabelsConsistent=function(e){return this.computeEdgeEndLabels(e.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};Wr.prototype.checkAreaLabelsConsistent=function(e){var t=this.getEdges();if(t.size()<=0)return!0;var n=t.size()-1,i=t.get(n).getLabel(),r=i.getLocation(e,oe.LEFT);an.isTrue(r!==Dt.NONE,"Found unlabelled area edge");for(var u=r,p=this.iterator();p.hasNext();){var a=p.next(),_=a.getLabel();an.isTrue(_.isArea(e),"Found non-area edge");var x=_.getLocation(e,oe.LEFT),S=_.getLocation(e,oe.RIGHT);if(x===S||S!==u)return!1;u=x}return!0};Wr.prototype.findIndex=function(e){var t=this;this.iterator();for(var n=0;n<this._edgeList.size();n++){var i=t._edgeList.get(n);if(i===e)return n}return-1};Wr.prototype.iterator=function(){return this.getEdges().iterator()};Wr.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new pe(this._edgeMap.values())),this._edgeList};Wr.prototype.getLocation=function(e,t,n){return this._ptInAreaLocation[e]===Dt.NONE&&(this._ptInAreaLocation[e]=Yo.locate(t,n[e].getGeometry())),this._ptInAreaLocation[e]};Wr.prototype.toString=function(){var e=new ba;e.append("EdgeEndStar:   "+this.getCoordinate()),e.append(`
`);for(var t=this.iterator();t.hasNext();){var n=t.next();e.append(n),e.append(`
`)}return e.toString()};Wr.prototype.computeEdgeEndLabels=function(e){for(var t=this.iterator();t.hasNext();){var n=t.next();n.computeLabel(e)}};Wr.prototype.computeLabelling=function(e){var t=this;this.computeEdgeEndLabels(e[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var n=[!1,!1],i=this.iterator();i.hasNext();)for(var r=i.next(),u=r.getLabel(),p=0;p<2;p++)u.isLine(p)&&u.getLocation(p)===Dt.BOUNDARY&&(n[p]=!0);for(var a=this.iterator();a.hasNext();)for(var _=a.next(),x=_.getLabel(),S=0;S<2;S++)if(x.isAnyNull(S)){var L=Dt.NONE;if(n[S])L=Dt.EXTERIOR;else{var k=_.getCoordinate();L=t.getLocation(S,k,e)}x.setAllLocationsIfNull(S,L)}};Wr.prototype.getDegree=function(){return this._edgeMap.size()};Wr.prototype.insertEdgeEnd=function(e,t){this._edgeMap.put(e,t),this._edgeList=null};Wr.prototype.interfaces_=function(){return[]};Wr.prototype.getClass=function(){return Wr};var yC=function(e){function t(){e.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.linkResultDirectedEdges=function(){var n=this;this.getResultAreaEdges();for(var i=null,r=null,u=this._SCANNING_FOR_INCOMING,p=0;p<this._resultAreaEdgeList.size();p++){var a=n._resultAreaEdgeList.get(p),_=a.getSym();if(a.getLabel().isArea())switch(i===null&&a.isInResult()&&(i=a),u){case n._SCANNING_FOR_INCOMING:if(!_.isInResult())continue;r=_,u=n._LINKING_TO_OUTGOING;break;case n._LINKING_TO_OUTGOING:if(!a.isInResult())continue;r.setNext(a),u=n._SCANNING_FOR_INCOMING;break}}if(u===this._LINKING_TO_OUTGOING){if(i===null)throw new ml("no outgoing dirEdge found",this.getCoordinate());an.isTrue(i.isInResult(),"unable to link last incoming dirEdge"),r.setNext(i)}},t.prototype.insert=function(n){var i=n;this.insertEdgeEnd(i,i)},t.prototype.getRightmostEdge=function(){var n=this.getEdges(),i=n.size();if(i<1)return null;var r=n.get(0);if(i===1)return r;var u=n.get(i-1),p=r.getQuadrant(),a=u.getQuadrant();return Xn.isNorthern(p)&&Xn.isNorthern(a)?r:!Xn.isNorthern(p)&&!Xn.isNorthern(a)?u:r.getDy()!==0?r:u.getDy()!==0?u:(an.shouldNeverReachHere("found two horizontal edges incident on node"),null)},t.prototype.print=function(n){Cr.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var i=this.iterator();i.hasNext();){var r=i.next();n.print("out "),r.print(n),n.println(),n.print("in "),r.getSym().print(n),n.println()}},t.prototype.getResultAreaEdges=function(){var n=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new pe;for(var i=this.iterator();i.hasNext();){var r=i.next();(r.isInResult()||r.getSym().isInResult())&&n._resultAreaEdgeList.add(r)}return this._resultAreaEdgeList},t.prototype.updateLabelling=function(n){for(var i=this.iterator();i.hasNext();){var r=i.next(),u=r.getLabel();u.setAllLocationsIfNull(0,n.getLocation(0)),u.setAllLocationsIfNull(1,n.getLocation(1))}},t.prototype.linkAllDirectedEdges=function(){var n=this;this.getEdges();for(var i=null,r=null,u=this._edgeList.size()-1;u>=0;u--){var p=n._edgeList.get(u),a=p.getSym();r===null&&(r=a),i!==null&&a.setNext(i),i=p}r.setNext(i)},t.prototype.computeDepths=function(){var n=this;if(arguments.length===1){var i=arguments[0],r=this.findIndex(i),u=i.getDepth(oe.LEFT),p=i.getDepth(oe.RIGHT),a=this.computeDepths(r+1,this._edgeList.size(),u),_=this.computeDepths(0,r,a);if(_!==p)throw new ml("depth mismatch at "+i.getCoordinate())}else if(arguments.length===3){for(var x=arguments[0],S=arguments[1],L=arguments[2],k=L,D=x;D<S;D++){var F=n._edgeList.get(D);F.setEdgeDepths(oe.RIGHT,k),k=F.getDepth(oe.LEFT)}return k}},t.prototype.mergeSymLabels=function(){for(var n=this.iterator();n.hasNext();){var i=n.next(),r=i.getLabel();r.merge(i.getSym().getLabel())}},t.prototype.linkMinimalDirectedEdges=function(n){for(var i=this,r=null,u=null,p=this._SCANNING_FOR_INCOMING,a=this._resultAreaEdgeList.size()-1;a>=0;a--){var _=i._resultAreaEdgeList.get(a),x=_.getSym();switch(r===null&&_.getEdgeRing()===n&&(r=_),p){case i._SCANNING_FOR_INCOMING:if(x.getEdgeRing()!==n)continue;u=x,p=i._LINKING_TO_OUTGOING;break;case i._LINKING_TO_OUTGOING:if(_.getEdgeRing()!==n)continue;u.setNextMin(_),p=i._SCANNING_FOR_INCOMING;break}}p===this._LINKING_TO_OUTGOING&&(an.isTrue(r!==null,"found null for first outgoing dirEdge"),an.isTrue(r.getEdgeRing()===n,"unable to link last incoming dirEdge"),u.setNextMin(r))},t.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var n=0,i=this.iterator();i.hasNext();){var r=i.next();r.isInResult()&&n++}return n}else if(arguments.length===1){for(var u=arguments[0],p=0,a=this.iterator();a.hasNext();){var _=a.next();_.getEdgeRing()===u&&p++}return p}},t.prototype.getLabel=function(){return this._label},t.prototype.findCoveredLineEdges=function(){for(var n=Dt.NONE,i=this.iterator();i.hasNext();){var r=i.next(),u=r.getSym();if(!r.isLineEdge()){if(r.isInResult()){n=Dt.INTERIOR;break}if(u.isInResult()){n=Dt.EXTERIOR;break}}}if(n===Dt.NONE)return null;for(var p=n,a=this.iterator();a.hasNext();){var _=a.next(),x=_.getSym();_.isLineEdge()?_.getEdge().setCovered(p===Dt.INTERIOR):(_.isInResult()&&(p=Dt.EXTERIOR),x.isInResult()&&(p=Dt.INTERIOR))}},t.prototype.computeLabelling=function(n){var i=this;e.prototype.computeLabelling.call(this,n),this._label=new Vn(Dt.NONE);for(var r=this.iterator();r.hasNext();)for(var u=r.next(),p=u.getEdge(),a=p.getLabel(),_=0;_<2;_++){var x=a.getLocation(_);(x===Dt.INTERIOR||x===Dt.BOUNDARY)&&i._label.setLocation(_,Dt.INTERIOR)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Wr),wx=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createNode=function(n){return new Lg(n,new yC)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Uh),Kl=function e(){this._pts=null,this._orientation=null;var t=arguments[0];this._pts=t,this._orientation=e.orientation(t)};Kl.prototype.compareTo=function(e){var t=e,n=Kl.compareOriented(this._pts,this._orientation,t._pts,t._orientation);return n};Kl.prototype.interfaces_=function(){return[xs]};Kl.prototype.getClass=function(){return Kl};Kl.orientation=function(e){return yn.increasingDirection(e)===1};Kl.compareOriented=function(e,t,n,i){for(var r=t?1:-1,u=i?1:-1,p=t?e.length:-1,a=i?n.length:-1,_=t?0:e.length-1,x=i?0:n.length-1;;){var S=e[_].compareTo(n[x]);if(S!==0)return S;_+=r,x+=u;var L=_===p,k=x===a;if(L&&!k)return-1;if(!L&&k)return 1;if(L&&k)return 0}};var Bs=function(){this._edges=new pe,this._ocaMap=new jr};Bs.prototype.print=function(e){var t=this;e.print("MULTILINESTRING ( ");for(var n=0;n<this._edges.size();n++){var i=t._edges.get(n);n>0&&e.print(","),e.print("(");for(var r=i.getCoordinates(),u=0;u<r.length;u++)u>0&&e.print(","),e.print(r[u].x+" "+r[u].y);e.println(")")}e.print(")  ")};Bs.prototype.addAll=function(e){for(var t=this,n=e.iterator();n.hasNext();)t.add(n.next())};Bs.prototype.findEdgeIndex=function(e){for(var t=this,n=0;n<this._edges.size();n++)if(t._edges.get(n).equals(e))return n;return-1};Bs.prototype.iterator=function(){return this._edges.iterator()};Bs.prototype.getEdges=function(){return this._edges};Bs.prototype.get=function(e){return this._edges.get(e)};Bs.prototype.findEqualEdge=function(e){var t=new Kl(e.getCoordinates()),n=this._ocaMap.get(t);return n};Bs.prototype.add=function(e){this._edges.add(e);var t=new Kl(e.getCoordinates());this._ocaMap.put(t,e)};Bs.prototype.interfaces_=function(){return[]};Bs.prototype.getClass=function(){return Bs};var Bu=function(){};Bu.prototype.processIntersections=function(e,t,n,i){};Bu.prototype.isDone=function(){};Bu.prototype.interfaces_=function(){return[]};Bu.prototype.getClass=function(){return Bu};var ts=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var e=arguments[0];this._li=e};ts.prototype.isTrivialIntersection=function(e,t,n,i){if(e===n&&this._li.getIntersectionNum()===1){if(ts.isAdjacentSegments(t,i))return!0;if(e.isClosed()){var r=e.size()-1;if(t===0&&i===r||i===0&&t===r)return!0}}return!1};ts.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};ts.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};ts.prototype.getLineIntersector=function(){return this._li};ts.prototype.hasProperIntersection=function(){return this._hasProper};ts.prototype.processIntersections=function(e,t,n,i){if(e===n&&t===i)return null;this.numTests++;var r=e.getCoordinates()[t],u=e.getCoordinates()[t+1],p=n.getCoordinates()[i],a=n.getCoordinates()[i+1];this._li.computeIntersection(r,u,p,a),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(e,t,n,i)||(this._hasIntersection=!0,e.addIntersections(this._li,t,0),n.addIntersections(this._li,i,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};ts.prototype.hasIntersection=function(){return this._hasIntersection};ts.prototype.isDone=function(){return!1};ts.prototype.hasInteriorIntersection=function(){return this._hasInterior};ts.prototype.interfaces_=function(){return[Bu]};ts.prototype.getClass=function(){return ts};ts.isAdjacentSegments=function(e,t){return Math.abs(e-t)===1};var da=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var e=arguments[0],t=arguments[1],n=arguments[2];this.coord=new Pt(e),this.segmentIndex=t,this.dist=n};da.prototype.getSegmentIndex=function(){return this.segmentIndex};da.prototype.getCoordinate=function(){return this.coord};da.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex),e.println(" dist = "+this.dist)};da.prototype.compareTo=function(e){var t=e;return this.compare(t.segmentIndex,t.dist)};da.prototype.isEndPoint=function(e){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===e};da.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};da.prototype.getDistance=function(){return this.dist};da.prototype.compare=function(e,t){return this.segmentIndex<e?-1:this.segmentIndex>e?1:this.dist<t?-1:this.dist>t?1:0};da.prototype.interfaces_=function(){return[xs]};da.prototype.getClass=function(){return da};var Ga=function(){this._nodeMap=new jr,this.edge=null;var e=arguments[0];this.edge=e};Ga.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();){var n=t.next();n.print(e)}};Ga.prototype.iterator=function(){return this._nodeMap.values().iterator()};Ga.prototype.addSplitEdges=function(e){var t=this;this.addEndpoints();for(var n=this.iterator(),i=n.next();n.hasNext();){var r=n.next(),u=t.createSplitEdge(i,r);e.add(u),i=r}};Ga.prototype.addEndpoints=function(){var e=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[e],e,0)};Ga.prototype.createSplitEdge=function(e,t){var n=this,i=t.segmentIndex-e.segmentIndex+2,r=this.edge.pts[t.segmentIndex],u=t.dist>0||!t.coord.equals2D(r);u||i--;var p=new Array(i).fill(null),a=0;p[a++]=new Pt(e.coord);for(var _=e.segmentIndex+1;_<=t.segmentIndex;_++)p[a++]=n.edge.pts[_];return u&&(p[a]=t.coord),new $m(p,new Vn(this.edge._label))};Ga.prototype.add=function(e,t,n){var i=new da(e,t,n),r=this._nodeMap.get(i);return r!==null?r:(this._nodeMap.put(i,i),i)};Ga.prototype.isIntersection=function(e){for(var t=this.iterator();t.hasNext();){var n=t.next();if(n.coord.equals(e))return!0}return!1};Ga.prototype.interfaces_=function(){return[]};Ga.prototype.getClass=function(){return Ga};var Vu=function(){};Vu.prototype.getChainStartIndices=function(e){var t=this,n=0,i=new pe;i.add(new la(n));do{var r=t.findChainEnd(e,n);i.add(new la(r)),n=r}while(n<e.length-1);var u=Vu.toIntArray(i);return u};Vu.prototype.findChainEnd=function(e,t){for(var n=Xn.quadrant(e[t],e[t+1]),i=t+1;i<e.length;){var r=Xn.quadrant(e[i-1],e[i]);if(r!==n)break;i++}return i-1};Vu.prototype.interfaces_=function(){return[]};Vu.prototype.getClass=function(){return Vu};Vu.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),n=0;n<t.length;n++)t[n]=e.get(n).intValue();return t};var _l=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new ke,this.env2=new ke;var e=arguments[0];this.e=e,this.pts=e.getCoordinates();var t=new Vu;this.startIndex=t.getChainStartIndices(this.pts)};_l.prototype.getCoordinates=function(){return this.pts};_l.prototype.getMaxX=function(e){var t=this.pts[this.startIndex[e]].x,n=this.pts[this.startIndex[e+1]].x;return t>n?t:n};_l.prototype.getMinX=function(e){var t=this.pts[this.startIndex[e]].x,n=this.pts[this.startIndex[e+1]].x;return t<n?t:n};_l.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var e=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];this.computeIntersectsForChain(this.startIndex[e],this.startIndex[e+1],t,t.startIndex[n],t.startIndex[n+1],i)}else if(arguments.length===6){var r=arguments[0],u=arguments[1],p=arguments[2],a=arguments[3],_=arguments[4],x=arguments[5],S=this.pts[r],L=this.pts[u],k=p.pts[a],D=p.pts[_];if(u-r===1&&_-a===1)return x.addIntersections(this.e,r,p.e,a),null;if(this.env1.init(S,L),this.env2.init(k,D),!this.env1.intersects(this.env2))return null;var F=Math.trunc((r+u)/2),K=Math.trunc((a+_)/2);r<F&&(a<K&&this.computeIntersectsForChain(r,F,p,a,K,x),K<_&&this.computeIntersectsForChain(r,F,p,K,_,x)),F<u&&(a<K&&this.computeIntersectsForChain(F,u,p,a,K,x),K<_&&this.computeIntersectsForChain(F,u,p,K,_,x))}};_l.prototype.getStartIndexes=function(){return this.startIndex};_l.prototype.computeIntersects=function(e,t){for(var n=this,i=0;i<this.startIndex.length-1;i++)for(var r=0;r<e.startIndex.length-1;r++)n.computeIntersectsForChain(i,e,r,t)};_l.prototype.interfaces_=function(){return[]};_l.prototype.getClass=function(){return _l};var Er=function e(){var t=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var n=0;n<2;n++)for(var i=0;i<3;i++)t._depth[n][i]=e.NULL_VALUE},Sx={NULL_VALUE:{configurable:!0}};Er.prototype.getDepth=function(e,t){return this._depth[e][t]};Er.prototype.setDepth=function(e,t,n){this._depth[e][t]=n};Er.prototype.isNull=function(){var e=this;if(arguments.length===0){for(var t=0;t<2;t++)for(var n=0;n<3;n++)if(e._depth[t][n]!==Er.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var i=arguments[0];return this._depth[i][1]===Er.NULL_VALUE}else if(arguments.length===2){var r=arguments[0],u=arguments[1];return this._depth[r][u]===Er.NULL_VALUE}};Er.prototype.normalize=function(){for(var e=this,t=0;t<2;t++)if(!e.isNull(t)){var n=e._depth[t][1];e._depth[t][2]<n&&(n=e._depth[t][2]),n<0&&(n=0);for(var i=1;i<3;i++){var r=0;e._depth[t][i]>n&&(r=1),e._depth[t][i]=r}}};Er.prototype.getDelta=function(e){return this._depth[e][oe.RIGHT]-this._depth[e][oe.LEFT]};Er.prototype.getLocation=function(e,t){return this._depth[e][t]<=0?Dt.EXTERIOR:Dt.INTERIOR};Er.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};Er.prototype.add=function(){var e=this;if(arguments.length===1)for(var t=arguments[0],n=0;n<2;n++)for(var i=1;i<3;i++){var r=t.getLocation(n,i);(r===Dt.EXTERIOR||r===Dt.INTERIOR)&&(e.isNull(n,i)?e._depth[n][i]=Er.depthAtLocation(r):e._depth[n][i]+=Er.depthAtLocation(r))}else if(arguments.length===3){var u=arguments[0],p=arguments[1],a=arguments[2];a===Dt.INTERIOR&&this._depth[u][p]++}};Er.prototype.interfaces_=function(){return[]};Er.prototype.getClass=function(){return Er};Er.depthAtLocation=function(e){return e===Dt.EXTERIOR?0:e===Dt.INTERIOR?1:Er.NULL_VALUE};Sx.NULL_VALUE.get=function(){return-1};Object.defineProperties(Er,Sx);var $m=function(e){function t(){if(e.call(this),this.pts=null,this._env=null,this.eiList=new Ga(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Er,this._depthDelta=0,arguments.length===1){var n=arguments[0];t.call(this,n,null)}else if(arguments.length===2){var i=arguments[0],r=arguments[1];this.pts=i,this._label=r}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getDepth=function(){return this._depth},t.prototype.getCollapsedEdge=function(){var n=new Array(2).fill(null);n[0]=this.pts[0],n[1]=this.pts[1];var i=new t(n,Vn.toLineLabel(this._label));return i},t.prototype.isIsolated=function(){return this._isIsolated},t.prototype.getCoordinates=function(){return this.pts},t.prototype.setIsolated=function(n){this._isIsolated=n},t.prototype.setName=function(n){this._name=n},t.prototype.equals=function(n){var i=this;if(!(n instanceof t))return!1;var r=n;if(this.pts.length!==r.pts.length)return!1;for(var u=!0,p=!0,a=this.pts.length,_=0;_<this.pts.length;_++)if(i.pts[_].equals2D(r.pts[_])||(u=!1),i.pts[_].equals2D(r.pts[--a])||(p=!1),!u&&!p)return!1;return!0},t.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var n=arguments[0];return this.pts[n]}},t.prototype.print=function(n){var i=this;n.print("edge "+this._name+": "),n.print("LINESTRING (");for(var r=0;r<this.pts.length;r++)r>0&&n.print(","),n.print(i.pts[r].x+" "+i.pts[r].y);n.print(")  "+this._label+" "+this._depthDelta)},t.prototype.computeIM=function(n){t.updateIM(this._label,n)},t.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},t.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},t.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},t.prototype.getDepthDelta=function(){return this._depthDelta},t.prototype.getNumPoints=function(){return this.pts.length},t.prototype.printReverse=function(n){var i=this;n.print("edge "+this._name+": ");for(var r=this.pts.length-1;r>=0;r--)n.print(i.pts[r]+" ");n.println("")},t.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new _l(this)),this._mce},t.prototype.getEnvelope=function(){var n=this;if(this._env===null){this._env=new ke;for(var i=0;i<this.pts.length;i++)n._env.expandToInclude(n.pts[i])}return this._env},t.prototype.addIntersection=function(n,i,r,u){var p=new Pt(n.getIntersection(u)),a=i,_=n.getEdgeDistance(r,u),x=a+1;if(x<this.pts.length){var S=this.pts[x];p.equals2D(S)&&(a=x,_=0)}this.eiList.add(p,a,_)},t.prototype.toString=function(){var n=this,i=new ba;i.append("edge "+this._name+": "),i.append("LINESTRING (");for(var r=0;r<this.pts.length;r++)r>0&&i.append(","),i.append(n.pts[r].x+" "+n.pts[r].y);return i.append(")  "+this._label+" "+this._depthDelta),i.toString()},t.prototype.isPointwiseEqual=function(n){var i=this;if(this.pts.length!==n.pts.length)return!1;for(var r=0;r<this.pts.length;r++)if(!i.pts[r].equals2D(n.pts[r]))return!1;return!0},t.prototype.setDepthDelta=function(n){this._depthDelta=n},t.prototype.getEdgeIntersectionList=function(){return this.eiList},t.prototype.addIntersections=function(n,i,r){for(var u=this,p=0;p<n.getIntersectionNum();p++)u.addIntersection(n,i,r,p)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.updateIM=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];i.setAtLeastIfValid(n.getLocation(0,oe.ON),n.getLocation(1,oe.ON),1),n.isArea()&&(i.setAtLeastIfValid(n.getLocation(0,oe.LEFT),n.getLocation(1,oe.LEFT),2),i.setAtLeastIfValid(n.getLocation(0,oe.RIGHT),n.getLocation(1,oe.RIGHT),2))}else return e.prototype.updateIM.apply(this,arguments)},t}(Qo),ro=function(e){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Bs,this._bufParams=e||null};ro.prototype.setWorkingPrecisionModel=function(e){this._workingPrecisionModel=e};ro.prototype.insertUniqueEdge=function(e){var t=this._edgeList.findEqualEdge(e);if(t!==null){var n=t.getLabel(),i=e.getLabel();t.isPointwiseEqual(e)||(i=new Vn(e.getLabel()),i.flip()),n.merge(i);var r=ro.depthDelta(i),u=t.getDepthDelta(),p=u+r;t.setDepthDelta(p)}else this._edgeList.add(e),e.setDepthDelta(ro.depthDelta(e.getLabel()))};ro.prototype.buildSubgraphs=function(e,t){for(var n=new pe,i=e.iterator();i.hasNext();){var r=i.next(),u=r.getRightmostCoordinate(),p=new wc(n),a=p.getDepth(u);r.computeDepth(a),r.findResultEdges(),n.add(r),t.add(r.getDirectedEdges(),r.getNodes())}};ro.prototype.createSubgraphs=function(e){for(var t=new pe,n=e.getNodes().iterator();n.hasNext();){var i=n.next();if(!i.isVisited()){var r=new so;r.create(i),t.add(r)}}return Fs.sort(t,Fs.reverseOrder()),t};ro.prototype.createEmptyResultGeometry=function(){var e=this._geomFact.createPolygon();return e};ro.prototype.getNoder=function(e){if(this._workingNoder!==null)return this._workingNoder;var t=new Oy,n=new Zu;return n.setPrecisionModel(e),t.setSegmentIntersector(new ts(n)),t};ro.prototype.buffer=function(e,t){var n=this._workingPrecisionModel;n===null&&(n=e.getPrecisionModel()),this._geomFact=e.getFactory();var i=new vo(n,this._bufParams),r=new vs(e,t,i),u=r.getCurves();if(u.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(u,n),this._graph=new xi(new wx),this._graph.addEdges(this._edgeList.getEdges());var p=this.createSubgraphs(this._graph),a=new Do(this._geomFact);this.buildSubgraphs(p,a);var _=a.getPolygons();if(_.size()<=0)return this.createEmptyResultGeometry();var x=this._geomFact.buildGeometry(_);return x};ro.prototype.computeNodedEdges=function(e,t){var n=this,i=this.getNoder(t);i.computeNodes(e);for(var r=i.getNodedSubstrings(),u=r.iterator();u.hasNext();){var p=u.next(),a=p.getCoordinates();if(!(a.length===2&&a[0].equals2D(a[1]))){var _=p.getData(),x=new $m(p.getCoordinates(),new Vn(_));n.insertUniqueEdge(x)}}};ro.prototype.setNoder=function(e){this._workingNoder=e};ro.prototype.interfaces_=function(){return[]};ro.prototype.getClass=function(){return ro};ro.depthDelta=function(e){var t=e.getLocation(0,oe.LEFT),n=e.getLocation(0,oe.RIGHT);return t===Dt.INTERIOR&&n===Dt.EXTERIOR?1:t===Dt.EXTERIOR&&n===Dt.INTERIOR?-1:0};ro.convertSegStrings=function(e){for(var t=new _n,n=new pe;e.hasNext();){var i=e.next(),r=t.createLineString(i.getCoordinates());n.add(r)}return t.buildGeometry(n)};var Jl=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var e=arguments[0],t=arguments[1];this._noder=e,this._scaleFactor=t,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var n=arguments[0],i=arguments[1],r=arguments[2],u=arguments[3];this._noder=n,this._scaleFactor=i,this._offsetX=r,this._offsetY=u,this._isScaled=!this.isIntegerPrecision()}};Jl.prototype.rescale=function(){var e=this;if(We(arguments[0],tr))for(var t=arguments[0],n=t.iterator();n.hasNext();){var i=n.next();e.rescale(i.getCoordinates())}else if(arguments[0]instanceof Array){for(var r=arguments[0],u=0;u<r.length;u++)r[u].x=r[u].x/e._scaleFactor+e._offsetX,r[u].y=r[u].y/e._scaleFactor+e._offsetY;r.length===2&&r[0].equals2D(r[1])&&Cr.out.println(r)}};Jl.prototype.scale=function(){var e=this;if(We(arguments[0],tr)){for(var t=arguments[0],n=new pe,i=t.iterator();i.hasNext();){var r=i.next();n.add(new Gi(e.scale(r.getCoordinates()),r.getData()))}return n}else if(arguments[0]instanceof Array){for(var u=arguments[0],p=new Array(u.length).fill(null),a=0;a<u.length;a++)p[a]=new Pt(Math.round((u[a].x-e._offsetX)*e._scaleFactor),Math.round((u[a].y-e._offsetY)*e._scaleFactor),u[a].z);var _=yn.removeRepeatedPoints(p);return _}};Jl.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};Jl.prototype.getNodedSubstrings=function(){var e=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(e),e};Jl.prototype.computeNodes=function(e){var t=e;this._isScaled&&(t=this.scale(e)),this._noder.computeNodes(t)};Jl.prototype.interfaces_=function(){return[zu]};Jl.prototype.getClass=function(){return Jl};var ma=function(){this._li=new Zu,this._segStrings=null;var e=arguments[0];this._segStrings=e},Ex={fact:{configurable:!0}};ma.prototype.checkEndPtVertexIntersections=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();){var n=t.next(),i=n.getCoordinates();e.checkEndPtVertexIntersections(i[0],e._segStrings),e.checkEndPtVertexIntersections(i[i.length-1],e._segStrings)}else if(arguments.length===2){for(var r=arguments[0],u=arguments[1],p=u.iterator();p.hasNext();)for(var a=p.next(),_=a.getCoordinates(),x=1;x<_.length-1;x++)if(_[x].equals(r))throw new fl("found endpt/interior pt intersection at index "+x+" :pt "+r)}};ma.prototype.checkInteriorIntersections=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();)for(var n=t.next(),i=this._segStrings.iterator();i.hasNext();){var r=i.next();e.checkInteriorIntersections(n,r)}else if(arguments.length===2)for(var u=arguments[0],p=arguments[1],a=u.getCoordinates(),_=p.getCoordinates(),x=0;x<a.length-1;x++)for(var S=0;S<_.length-1;S++)e.checkInteriorIntersections(u,x,p,S);else if(arguments.length===4){var L=arguments[0],k=arguments[1],D=arguments[2],F=arguments[3];if(L===D&&k===F)return null;var K=L.getCoordinates()[k],W=L.getCoordinates()[k+1],Q=D.getCoordinates()[F],U=D.getCoordinates()[F+1];if(this._li.computeIntersection(K,W,Q,U),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,K,W)||this.hasInteriorIntersection(this._li,Q,U)))throw new fl("found non-noded intersection at "+K+"-"+W+" and "+Q+"-"+U)}};ma.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};ma.prototype.checkCollapses=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();){var n=t.next();e.checkCollapses(n)}else if(arguments.length===1)for(var i=arguments[0],r=i.getCoordinates(),u=0;u<r.length-2;u++)e.checkCollapse(r[u],r[u+1],r[u+2])};ma.prototype.hasInteriorIntersection=function(e,t,n){for(var i=0;i<e.getIntersectionNum();i++){var r=e.getIntersection(i);if(!(r.equals(t)||r.equals(n)))return!0}return!1};ma.prototype.checkCollapse=function(e,t,n){if(e.equals(n))throw new fl("found non-noded collapse at "+ma.fact.createLineString([e,t,n]))};ma.prototype.interfaces_=function(){return[]};ma.prototype.getClass=function(){return ma};Ex.fact.get=function(){return new _n};Object.defineProperties(ma,Ex);var bo=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var e=arguments[0],t=arguments[1],n=arguments[2];if(this._originalPt=e,this._pt=e,this._scaleFactor=t,this._li=n,t<=0)throw new di("Scale factor must be non-zero");t!==1&&(this._pt=new Pt(this.scale(e.x),this.scale(e.y)),this._p0Scaled=new Pt,this._p1Scaled=new Pt),this.initCorners(this._pt)},Ix={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};bo.prototype.intersectsScaled=function(e,t){var n=Math.min(e.x,t.x),i=Math.max(e.x,t.x),r=Math.min(e.y,t.y),u=Math.max(e.y,t.y),p=this._maxx<n||this._minx>i||this._maxy<r||this._miny>u;if(p)return!1;var a=this.intersectsToleranceSquare(e,t);return an.isTrue(!(p&&a),"Found bad envelope test"),a};bo.prototype.initCorners=function(e){var t=.5;this._minx=e.x-t,this._maxx=e.x+t,this._miny=e.y-t,this._maxy=e.y+t,this._corner[0]=new Pt(this._maxx,this._maxy),this._corner[1]=new Pt(this._minx,this._maxy),this._corner[2]=new Pt(this._minx,this._miny),this._corner[3]=new Pt(this._maxx,this._miny)};bo.prototype.intersects=function(e,t){return this._scaleFactor===1?this.intersectsScaled(e,t):(this.copyScaled(e,this._p0Scaled),this.copyScaled(t,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};bo.prototype.scale=function(e){return Math.round(e*this._scaleFactor)};bo.prototype.getCoordinate=function(){return this._originalPt};bo.prototype.copyScaled=function(e,t){t.x=this.scale(e.x),t.y=this.scale(e.y)};bo.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var e=bo.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new ke(this._originalPt.x-e,this._originalPt.x+e,this._originalPt.y-e,this._originalPt.y+e)}return this._safeEnv};bo.prototype.intersectsPixelClosure=function(e,t){return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),this._li.hasIntersection()))};bo.prototype.intersectsToleranceSquare=function(e,t){var n=!1,i=!1;return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(i=!0),this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),this._li.isProper())||n&&i||e.equals(this._pt)||t.equals(this._pt))};bo.prototype.addSnappedNode=function(e,t){var n=e.getCoordinate(t),i=e.getCoordinate(t+1);return this.intersects(n,i)?(e.addIntersection(this.getCoordinate(),t),!0):!1};bo.prototype.interfaces_=function(){return[]};bo.prototype.getClass=function(){return bo};Ix.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties(bo,Ix);var td=function(){this.tempEnv1=new ke,this.selectedSegment=new Ne};td.prototype.select=function(){if(arguments.length!==1&&arguments.length===2){var e=arguments[0],t=arguments[1];e.getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment)}};td.prototype.interfaces_=function(){return[]};td.prototype.getClass=function(){return td};var Zh=function(){this._index=null;var e=arguments[0];this._index=e},Cx={HotPixelSnapAction:{configurable:!0}};Zh.prototype.snap=function(){if(arguments.length===1){var e=arguments[0];return this.snap(e,null,-1)}else if(arguments.length===3){var t=arguments[0],n=arguments[1],i=arguments[2],r=t.getSafeEnvelope(),u=new Tx(t,n,i);return this._index.query(r,{interfaces_:function(){return[Hl]},visitItem:function(p){var a=p;a.select(r,u)}}),u.isNodeAdded()}};Zh.prototype.interfaces_=function(){return[]};Zh.prototype.getClass=function(){return Zh};Cx.HotPixelSnapAction.get=function(){return Tx};Object.defineProperties(Zh,Cx);var Tx=function(e){function t(){e.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var n=arguments[0],i=arguments[1],r=arguments[2];this._hotPixel=n,this._parentEdge=i,this._hotPixelVertexIndex=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isNodeAdded=function(){return this._isNodeAdded},t.prototype.select=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1],r=n.getContext();if(this._parentEdge!==null&&r===this._parentEdge&&i===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(r,i)}else return e.prototype.select.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(td),Sc=function(){this._li=null,this._interiorIntersections=null;var e=arguments[0];this._li=e,this._interiorIntersections=new pe};Sc.prototype.processIntersections=function(e,t,n,i){var r=this;if(e===n&&t===i)return null;var u=e.getCoordinates()[t],p=e.getCoordinates()[t+1],a=n.getCoordinates()[i],_=n.getCoordinates()[i+1];if(this._li.computeIntersection(u,p,a,_),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var x=0;x<this._li.getIntersectionNum();x++)r._interiorIntersections.add(r._li.getIntersection(x));e.addIntersections(this._li,t,0),n.addIntersections(this._li,i,1)}};Sc.prototype.isDone=function(){return!1};Sc.prototype.getInteriorIntersections=function(){return this._interiorIntersections};Sc.prototype.interfaces_=function(){return[Bu]};Sc.prototype.getClass=function(){return Sc};var qa=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var e=arguments[0];this._pm=e,this._li=new Zu,this._li.setPrecisionModel(e),this._scaleFactor=e.getScale()};qa.prototype.checkCorrectness=function(e){var t=Gi.getNodedSubstrings(e),n=new ma(t);try{n.checkValid()}catch(i){if(i instanceof cx)i.printStackTrace();else throw i}finally{}};qa.prototype.getNodedSubstrings=function(){return Gi.getNodedSubstrings(this._nodedSegStrings)};qa.prototype.snapRound=function(e,t){var n=this.findInteriorIntersections(e,t);this.computeIntersectionSnaps(n),this.computeVertexSnaps(e)};qa.prototype.findInteriorIntersections=function(e,t){var n=new Sc(t);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(e),n.getInteriorIntersections()};qa.prototype.computeVertexSnaps=function(){var e=this;if(We(arguments[0],tr))for(var t=arguments[0],n=t.iterator();n.hasNext();){var i=n.next();e.computeVertexSnaps(i)}else if(arguments[0]instanceof Gi)for(var r=arguments[0],u=r.getCoordinates(),p=0;p<u.length;p++){var a=new bo(u[p],e._scaleFactor,e._li),_=e._pointSnapper.snap(a,r,p);_&&r.addIntersection(u[p],p)}};qa.prototype.computeNodes=function(e){this._nodedSegStrings=e,this._noder=new Oy,this._pointSnapper=new Zh(this._noder.getIndex()),this.snapRound(e,this._li)};qa.prototype.computeIntersectionSnaps=function(e){for(var t=this,n=e.iterator();n.hasNext();){var i=n.next(),r=new bo(i,t._scaleFactor,t._li);t._pointSnapper.snap(r)}};qa.prototype.interfaces_=function(){return[zu]};qa.prototype.getClass=function(){return qa};var Sr=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Nn,this._resultGeometry=null,this._saveException=null,arguments.length===1){var e=arguments[0];this._argGeom=e}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this._argGeom=t,this._bufParams=n}},lp={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};Sr.prototype.bufferFixedPrecision=function(e){var t=new Jl(new qa(new Dn(1)),e.getScale()),n=new ro(this._bufParams);n.setWorkingPrecisionModel(e),n.setNoder(t),this._resultGeometry=n.buffer(this._argGeom,this._distance)};Sr.prototype.bufferReducedPrecision=function(){var e=this;if(arguments.length===0){for(var t=Sr.MAX_PRECISION_DIGITS;t>=0;t--){try{e.bufferReducedPrecision(t)}catch(u){if(u instanceof ml)e._saveException=u;else throw u}finally{}if(e._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var n=arguments[0],i=Sr.precisionScaleFactor(this._argGeom,this._distance,n),r=new Dn(i);this.bufferFixedPrecision(r)}};Sr.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var e=this._argGeom.getFactory().getPrecisionModel();e.getType()===Dn.FIXED?this.bufferFixedPrecision(e):this.bufferReducedPrecision()};Sr.prototype.setQuadrantSegments=function(e){this._bufParams.setQuadrantSegments(e)};Sr.prototype.bufferOriginalPrecision=function(){try{var e=new ro(this._bufParams);this._resultGeometry=e.buffer(this._argGeom,this._distance)}catch(t){if(t instanceof fl)this._saveException=t;else throw t}finally{}};Sr.prototype.getResultGeometry=function(e){return this._distance=e,this.computeGeometry(),this._resultGeometry};Sr.prototype.setEndCapStyle=function(e){this._bufParams.setEndCapStyle(e)};Sr.prototype.interfaces_=function(){return[]};Sr.prototype.getClass=function(){return Sr};Sr.bufferOp=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=new Sr(e),i=n.getResultGeometry(t);return i}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof je&&typeof arguments[1]=="number"){var r=arguments[0],u=arguments[1],p=arguments[2],a=new Sr(r);a.setQuadrantSegments(p);var _=a.getResultGeometry(u);return _}else if(arguments[2]instanceof Nn&&arguments[0]instanceof je&&typeof arguments[1]=="number"){var x=arguments[0],S=arguments[1],L=arguments[2],k=new Sr(x,L),D=k.getResultGeometry(S);return D}}else if(arguments.length===4){var F=arguments[0],K=arguments[1],W=arguments[2],Q=arguments[3],U=new Sr(F);U.setQuadrantSegments(W),U.setEndCapStyle(Q);var X=U.getResultGeometry(K);return X}};Sr.precisionScaleFactor=function(e,t,n){var i=e.getEnvelopeInternal(),r=Jo.max(Math.abs(i.getMaxX()),Math.abs(i.getMaxY()),Math.abs(i.getMinX()),Math.abs(i.getMinY())),u=t>0?t:0,p=r+2*u,a=Math.trunc(Math.log(p)/Math.log(10)+1),_=n-a,x=Math.pow(10,_);return x};lp.CAP_ROUND.get=function(){return Nn.CAP_ROUND};lp.CAP_BUTT.get=function(){return Nn.CAP_FLAT};lp.CAP_FLAT.get=function(){return Nn.CAP_FLAT};lp.CAP_SQUARE.get=function(){return Nn.CAP_SQUARE};lp.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(Sr,lp);var eo=function(){this._pt=[new Pt,new Pt],this._distance=Qe.NaN,this._isNull=!0};eo.prototype.getCoordinates=function(){return this._pt};eo.prototype.getCoordinate=function(e){return this._pt[e]};eo.prototype.setMinimum=function(){if(arguments.length===1){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var i=t.distance(n);i<this._distance&&this.initialize(t,n,i)}};eo.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var e=arguments[0],t=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(t),this._distance=e.distance(t),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],i=arguments[1],r=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(i),this._distance=r,this._isNull=!1}};eo.prototype.getDistance=function(){return this._distance};eo.prototype.setMaximum=function(){if(arguments.length===1){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var i=t.distance(n);i>this._distance&&this.initialize(t,n,i)}};eo.prototype.interfaces_=function(){return[]};eo.prototype.getClass=function(){return eo};var Da=function(){};Da.prototype.interfaces_=function(){return[]};Da.prototype.getClass=function(){return Da};Da.computeDistance=function(){if(arguments[2]instanceof eo&&arguments[0]instanceof Mi&&arguments[1]instanceof Pt)for(var e=arguments[0],t=arguments[1],n=arguments[2],i=e.getCoordinates(),r=new Ne,u=0;u<i.length-1;u++){r.setCoordinates(i[u],i[u+1]);var p=r.closestPoint(t);n.setMinimum(p,t)}else if(arguments[2]instanceof eo&&arguments[0]instanceof rr&&arguments[1]instanceof Pt){var a=arguments[0],_=arguments[1],x=arguments[2];Da.computeDistance(a.getExteriorRing(),_,x);for(var S=0;S<a.getNumInteriorRing();S++)Da.computeDistance(a.getInteriorRingN(S),_,x)}else if(arguments[2]instanceof eo&&arguments[0]instanceof je&&arguments[1]instanceof Pt){var L=arguments[0],k=arguments[1],D=arguments[2];if(L instanceof Mi)Da.computeDistance(L,k,D);else if(L instanceof rr)Da.computeDistance(L,k,D);else if(L instanceof oo)for(var F=L,K=0;K<F.getNumGeometries();K++){var W=F.getGeometryN(K);Da.computeDistance(W,k,D)}else D.setMinimum(L.getCoordinate(),k)}else if(arguments[2]instanceof eo&&arguments[0]instanceof Ne&&arguments[1]instanceof Pt){var Q=arguments[0],U=arguments[1],X=arguments[2],Y=Q.closestPoint(U);X.setMinimum(Y,U)}};var Uu=function(e){this._maxPtDist=new eo,this._inputGeom=e||null},zy={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};Uu.prototype.computeMaxMidpointDistance=function(e){var t=new Ql(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())};Uu.prototype.computeMaxVertexDistance=function(e){var t=new Ec(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())};Uu.prototype.findDistance=function(e){return this.computeMaxVertexDistance(e),this.computeMaxMidpointDistance(e),this._maxPtDist.getDistance()};Uu.prototype.getDistancePoints=function(){return this._maxPtDist};Uu.prototype.interfaces_=function(){return[]};Uu.prototype.getClass=function(){return Uu};zy.MaxPointDistanceFilter.get=function(){return Ec};zy.MaxMidpointDistanceFilter.get=function(){return Ql};Object.defineProperties(Uu,zy);var Ec=function(e){this._maxPtDist=new eo,this._minPtDist=new eo,this._geom=e||null};Ec.prototype.filter=function(e){this._minPtDist.initialize(),Da.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Ec.prototype.getMaxPointDistance=function(){return this._maxPtDist};Ec.prototype.interfaces_=function(){return[Fa]};Ec.prototype.getClass=function(){return Ec};var Ql=function(e){this._maxPtDist=new eo,this._minPtDist=new eo,this._geom=e||null};Ql.prototype.filter=function(e,t){if(t===0)return null;var n=e.getCoordinate(t-1),i=e.getCoordinate(t),r=new Pt((n.x+i.x)/2,(n.y+i.y)/2);this._minPtDist.initialize(),Da.computeDistance(this._geom,r,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Ql.prototype.isDone=function(){return!1};Ql.prototype.isGeometryChanged=function(){return!1};Ql.prototype.getMaxPointDistance=function(){return this._maxPtDist};Ql.prototype.interfaces_=function(){return[Os]};Ql.prototype.getClass=function(){return Ql};var pl=function(e){this._comps=e||null};pl.prototype.filter=function(e){e instanceof rr&&this._comps.add(e)};pl.prototype.interfaces_=function(){return[ca]};pl.prototype.getClass=function(){return pl};pl.getPolygons=function(){if(arguments.length===1){var e=arguments[0];return pl.getPolygons(e,new pe)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return t instanceof rr?n.add(t):t instanceof oo&&t.apply(new pl(n)),n}};var wr=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var e=arguments[0];this._lines=e}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this._lines=t,this._isForcedToLineString=n}};wr.prototype.filter=function(e){if(this._isForcedToLineString&&e instanceof Ba){var t=e.getFactory().createLineString(e.getCoordinateSequence());return this._lines.add(t),null}e instanceof Mi&&this._lines.add(e)};wr.prototype.setForceToLineString=function(e){this._isForcedToLineString=e};wr.prototype.interfaces_=function(){return[dl]};wr.prototype.getClass=function(){return wr};wr.getGeometry=function(){if(arguments.length===1){var e=arguments[0];return e.getFactory().buildGeometry(wr.getLines(e))}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return t.getFactory().buildGeometry(wr.getLines(t,n))}};wr.getLines=function(){if(arguments.length===1){var e=arguments[0];return wr.getLines(e,!1)}else if(arguments.length===2){if(We(arguments[0],tr)&&We(arguments[1],tr)){for(var t=arguments[0],n=arguments[1],i=t.iterator();i.hasNext();){var r=i.next();wr.getLines(r,n)}return n}else if(arguments[0]instanceof je&&typeof arguments[1]=="boolean"){var u=arguments[0],p=arguments[1],a=new pe;return u.apply(new wr(a,p)),a}else if(arguments[0]instanceof je&&We(arguments[1],tr)){var _=arguments[0],x=arguments[1];return _ instanceof Mi?x.add(_):_.apply(new wr(x)),x}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&We(arguments[0],tr)&&We(arguments[1],tr)){for(var S=arguments[0],L=arguments[1],k=arguments[2],D=S.iterator();D.hasNext();){var F=D.next();wr.getLines(F,L,k)}return L}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof je&&We(arguments[1],tr)){var K=arguments[0],W=arguments[1],Q=arguments[2];return K.apply(new wr(W,Q)),W}}};var Vs=function(){if(this._boundaryRule=_s.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];if(e===null)throw new di("Rule must be non-null");this._boundaryRule=e}};Vs.prototype.locateInternal=function(){var e=this;if(arguments[0]instanceof Pt&&arguments[1]instanceof rr){var t=arguments[0],n=arguments[1];if(n.isEmpty())return Dt.EXTERIOR;var i=n.getExteriorRing(),r=this.locateInPolygonRing(t,i);if(r===Dt.EXTERIOR)return Dt.EXTERIOR;if(r===Dt.BOUNDARY)return Dt.BOUNDARY;for(var u=0;u<n.getNumInteriorRing();u++){var p=n.getInteriorRingN(u),a=e.locateInPolygonRing(t,p);if(a===Dt.INTERIOR)return Dt.EXTERIOR;if(a===Dt.BOUNDARY)return Dt.BOUNDARY}return Dt.INTERIOR}else if(arguments[0]instanceof Pt&&arguments[1]instanceof Mi){var _=arguments[0],x=arguments[1];if(!x.getEnvelopeInternal().intersects(_))return Dt.EXTERIOR;var S=x.getCoordinates();return!x.isClosed()&&(_.equals(S[0])||_.equals(S[S.length-1]))?Dt.BOUNDARY:ve.isOnLine(_,S)?Dt.INTERIOR:Dt.EXTERIOR}else if(arguments[0]instanceof Pt&&arguments[1]instanceof No){var L=arguments[0],k=arguments[1],D=k.getCoordinate();return D.equals2D(L)?Dt.INTERIOR:Dt.EXTERIOR}};Vs.prototype.locateInPolygonRing=function(e,t){return t.getEnvelopeInternal().intersects(e)?ve.locatePointInRing(e,t.getCoordinates()):Dt.EXTERIOR};Vs.prototype.intersects=function(e,t){return this.locate(e,t)!==Dt.EXTERIOR};Vs.prototype.updateLocationInfo=function(e){e===Dt.INTERIOR&&(this._isIn=!0),e===Dt.BOUNDARY&&this._numBoundaries++};Vs.prototype.computeLocation=function(e,t){var n=this;if(t instanceof No&&this.updateLocationInfo(this.locateInternal(e,t)),t instanceof Mi)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof rr)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof Ou)for(var i=t,r=0;r<i.getNumGeometries();r++){var u=i.getGeometryN(r);n.updateLocationInfo(n.locateInternal(e,u))}else if(t instanceof Oa)for(var p=t,a=0;a<p.getNumGeometries();a++){var _=p.getGeometryN(a);n.updateLocationInfo(n.locateInternal(e,_))}else if(t instanceof oo)for(var x=new za(t);x.hasNext();){var S=x.next();S!==t&&n.computeLocation(e,S)}};Vs.prototype.locate=function(e,t){return t.isEmpty()?Dt.EXTERIOR:t instanceof Mi?this.locateInternal(e,t):t instanceof rr?this.locateInternal(e,t):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(e,t),this._boundaryRule.isInBoundary(this._numBoundaries)?Dt.BOUNDARY:this._numBoundaries>0||this._isIn?Dt.INTERIOR:Dt.EXTERIOR)};Vs.prototype.interfaces_=function(){return[]};Vs.prototype.getClass=function(){return Vs};var no=function e(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var t=arguments[0],n=arguments[1];e.call(this,t,e.INSIDE_AREA,n)}else if(arguments.length===3){var i=arguments[0],r=arguments[1],u=arguments[2];this._component=i,this._segIndex=r,this._pt=u}},Lx={INSIDE_AREA:{configurable:!0}};no.prototype.isInsideArea=function(){return this._segIndex===no.INSIDE_AREA};no.prototype.getCoordinate=function(){return this._pt};no.prototype.getGeometryComponent=function(){return this._component};no.prototype.getSegmentIndex=function(){return this._segIndex};no.prototype.interfaces_=function(){return[]};no.prototype.getClass=function(){return no};Lx.INSIDE_AREA.get=function(){return-1};Object.defineProperties(no,Lx);var Zl=function(e){this._pts=e||null};Zl.prototype.filter=function(e){e instanceof No&&this._pts.add(e)};Zl.prototype.interfaces_=function(){return[ca]};Zl.prototype.getClass=function(){return Zl};Zl.getPoints=function(){if(arguments.length===1){var e=arguments[0];return e instanceof No?Fs.singletonList(e):Zl.getPoints(e,new pe)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return t instanceof No?n.add(t):t instanceof oo&&t.apply(new Zl(n)),n}};var Ic=function(){this._locations=null;var e=arguments[0];this._locations=e};Ic.prototype.filter=function(e){(e instanceof No||e instanceof Mi||e instanceof rr)&&this._locations.add(new no(e,0,e.getCoordinate()))};Ic.prototype.interfaces_=function(){return[ca]};Ic.prototype.getClass=function(){return Ic};Ic.getLocations=function(e){var t=new pe;return e.apply(new Ic(t)),t};var Tr=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Vs,this._minDistanceLocation=null,this._minDistance=Qe.MAX_VALUE,arguments.length===2){var e=arguments[0],t=arguments[1];this._geom=[e,t],this._terminateDistance=0}else if(arguments.length===3){var n=arguments[0],i=arguments[1],r=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=n,this._geom[1]=i,this._terminateDistance=r}};Tr.prototype.computeContainmentDistance=function(){var e=this;if(arguments.length===0){var t=new Array(2).fill(null);if(this.computeContainmentDistance(0,t),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,t)}else if(arguments.length===2){var n=arguments[0],i=arguments[1],r=1-n,u=pl.getPolygons(this._geom[n]);if(u.size()>0){var p=Ic.getLocations(this._geom[r]);if(this.computeContainmentDistance(p,u,i),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[r]=i[0],this._minDistanceLocation[n]=i[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&We(arguments[0],Ns)&&We(arguments[1],Ns)){for(var a=arguments[0],_=arguments[1],x=arguments[2],S=0;S<a.size();S++)for(var L=a.get(S),k=0;k<_.size();k++)if(e.computeContainmentDistance(L,_.get(k),x),e._minDistance<=e._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof no&&arguments[1]instanceof rr){var D=arguments[0],F=arguments[1],K=arguments[2],W=D.getCoordinate();if(Dt.EXTERIOR!==this._ptLocator.locate(W,F))return this._minDistance=0,K[0]=D,K[1]=new no(F,W),null}}};Tr.prototype.computeMinDistanceLinesPoints=function(e,t,n){for(var i=this,r=0;r<e.size();r++)for(var u=e.get(r),p=0;p<t.size();p++){var a=t.get(p);if(i.computeMinDistance(u,a,n),i._minDistance<=i._terminateDistance)return null}};Tr.prototype.computeFacetDistance=function(){var e=new Array(2).fill(null),t=wr.getLines(this._geom[0]),n=wr.getLines(this._geom[1]),i=Zl.getPoints(this._geom[0]),r=Zl.getPoints(this._geom[1]);if(this.computeMinDistanceLines(t,n,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance||(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(t,r,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance)||(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(n,i,e),this.updateMinDistance(e,!0),this._minDistance<=this._terminateDistance))return null;e[0]=null,e[1]=null,this.computeMinDistancePoints(i,r,e),this.updateMinDistance(e,!1)};Tr.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};Tr.prototype.updateMinDistance=function(e,t){if(e[0]===null)return null;t?(this._minDistanceLocation[0]=e[1],this._minDistanceLocation[1]=e[0]):(this._minDistanceLocation[0]=e[0],this._minDistanceLocation[1]=e[1])};Tr.prototype.nearestPoints=function(){this.computeMinDistance();var e=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return e};Tr.prototype.computeMinDistance=function(){var e=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof Mi&&arguments[1]instanceof No){var t=arguments[0],n=arguments[1],i=arguments[2];if(t.getEnvelopeInternal().distance(n.getEnvelopeInternal())>this._minDistance)return null;for(var r=t.getCoordinates(),u=n.getCoordinate(),p=0;p<r.length-1;p++){var a=ve.distancePointLine(u,r[p],r[p+1]);if(a<e._minDistance){e._minDistance=a;var _=new Ne(r[p],r[p+1]),x=_.closestPoint(u);i[0]=new no(t,p,x),i[1]=new no(n,0,u)}if(e._minDistance<=e._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Mi&&arguments[1]instanceof Mi){var S=arguments[0],L=arguments[1],k=arguments[2];if(S.getEnvelopeInternal().distance(L.getEnvelopeInternal())>this._minDistance)return null;for(var D=S.getCoordinates(),F=L.getCoordinates(),K=0;K<D.length-1;K++)for(var W=0;W<F.length-1;W++){var Q=ve.distanceLineLine(D[K],D[K+1],F[W],F[W+1]);if(Q<e._minDistance){e._minDistance=Q;var U=new Ne(D[K],D[K+1]),X=new Ne(F[W],F[W+1]),Y=U.closestPoints(X);k[0]=new no(S,K,Y[0]),k[1]=new no(L,W,Y[1])}if(e._minDistance<=e._terminateDistance)return null}}}};Tr.prototype.computeMinDistancePoints=function(e,t,n){for(var i=this,r=0;r<e.size();r++)for(var u=e.get(r),p=0;p<t.size();p++){var a=t.get(p),_=u.getCoordinate().distance(a.getCoordinate());if(_<i._minDistance&&(i._minDistance=_,n[0]=new no(u,0,u.getCoordinate()),n[1]=new no(a,0,a.getCoordinate())),i._minDistance<=i._terminateDistance)return null}};Tr.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new di("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};Tr.prototype.computeMinDistanceLines=function(e,t,n){for(var i=this,r=0;r<e.size();r++)for(var u=e.get(r),p=0;p<t.size();p++){var a=t.get(p);if(i.computeMinDistance(u,a,n),i._minDistance<=i._terminateDistance)return null}};Tr.prototype.interfaces_=function(){return[]};Tr.prototype.getClass=function(){return Tr};Tr.distance=function(e,t){var n=new Tr(e,t);return n.distance()};Tr.isWithinDistance=function(e,t,n){var i=new Tr(e,t,n);return i.distance()<=n};Tr.nearestPoints=function(e,t){var n=new Tr(e,t);return n.nearestPoints()};var zr=function(){this._pt=[new Pt,new Pt],this._distance=Qe.NaN,this._isNull=!0};zr.prototype.getCoordinates=function(){return this._pt};zr.prototype.getCoordinate=function(e){return this._pt[e]};zr.prototype.setMinimum=function(){if(arguments.length===1){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var i=t.distance(n);i<this._distance&&this.initialize(t,n,i)}};zr.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var e=arguments[0],t=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(t),this._distance=e.distance(t),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],i=arguments[1],r=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(i),this._distance=r,this._isNull=!1}};zr.prototype.toString=function(){return Rs.toLineString(this._pt[0],this._pt[1])};zr.prototype.getDistance=function(){return this._distance};zr.prototype.setMaximum=function(){if(arguments.length===1){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var i=t.distance(n);i>this._distance&&this.initialize(t,n,i)}};zr.prototype.interfaces_=function(){return[]};zr.prototype.getClass=function(){return zr};var na=function(){};na.prototype.interfaces_=function(){return[]};na.prototype.getClass=function(){return na};na.computeDistance=function(){if(arguments[2]instanceof zr&&arguments[0]instanceof Mi&&arguments[1]instanceof Pt)for(var e=arguments[0],t=arguments[1],n=arguments[2],i=new Ne,r=e.getCoordinates(),u=0;u<r.length-1;u++){i.setCoordinates(r[u],r[u+1]);var p=i.closestPoint(t);n.setMinimum(p,t)}else if(arguments[2]instanceof zr&&arguments[0]instanceof rr&&arguments[1]instanceof Pt){var a=arguments[0],_=arguments[1],x=arguments[2];na.computeDistance(a.getExteriorRing(),_,x);for(var S=0;S<a.getNumInteriorRing();S++)na.computeDistance(a.getInteriorRingN(S),_,x)}else if(arguments[2]instanceof zr&&arguments[0]instanceof je&&arguments[1]instanceof Pt){var L=arguments[0],k=arguments[1],D=arguments[2];if(L instanceof Mi)na.computeDistance(L,k,D);else if(L instanceof rr)na.computeDistance(L,k,D);else if(L instanceof oo)for(var F=L,K=0;K<F.getNumGeometries();K++){var W=F.getGeometryN(K);na.computeDistance(W,k,D)}else D.setMinimum(L.getCoordinate(),k)}else if(arguments[2]instanceof zr&&arguments[0]instanceof Ne&&arguments[1]instanceof Pt){var Q=arguments[0],U=arguments[1],X=arguments[2],Y=Q.closestPoint(U);X.setMinimum(Y,U)}};var gs=function(){this._g0=null,this._g1=null,this._ptDist=new zr,this._densifyFrac=0;var e=arguments[0],t=arguments[1];this._g0=e,this._g1=t},Fy={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};gs.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};gs.prototype.setDensifyFraction=function(e){if(e>1||e<=0)throw new di("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=e};gs.prototype.compute=function(e,t){this.computeOrientedDistance(e,t,this._ptDist),this.computeOrientedDistance(t,e,this._ptDist)};gs.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};gs.prototype.computeOrientedDistance=function(e,t,n){var i=new Cc(t);if(e.apply(i),n.setMaximum(i.getMaxPointDistance()),this._densifyFrac>0){var r=new $l(t,this._densifyFrac);e.apply(r),n.setMaximum(r.getMaxPointDistance())}};gs.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};gs.prototype.interfaces_=function(){return[]};gs.prototype.getClass=function(){return gs};gs.distance=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=new gs(e,t);return n.distance()}else if(arguments.length===3){var i=arguments[0],r=arguments[1],u=arguments[2],p=new gs(i,r);return p.setDensifyFraction(u),p.distance()}};Fy.MaxPointDistanceFilter.get=function(){return Cc};Fy.MaxDensifiedByFractionDistanceFilter.get=function(){return $l};Object.defineProperties(gs,Fy);var Cc=function(){this._maxPtDist=new zr,this._minPtDist=new zr,this._euclideanDist=new na,this._geom=null;var e=arguments[0];this._geom=e};Cc.prototype.filter=function(e){this._minPtDist.initialize(),na.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Cc.prototype.getMaxPointDistance=function(){return this._maxPtDist};Cc.prototype.interfaces_=function(){return[Fa]};Cc.prototype.getClass=function(){return Cc};var $l=function(){this._maxPtDist=new zr,this._minPtDist=new zr,this._geom=null,this._numSubSegs=0;var e=arguments[0],t=arguments[1];this._geom=e,this._numSubSegs=Math.trunc(Math.round(1/t))};$l.prototype.filter=function(e,t){var n=this;if(t===0)return null;for(var i=e.getCoordinate(t-1),r=e.getCoordinate(t),u=(r.x-i.x)/this._numSubSegs,p=(r.y-i.y)/this._numSubSegs,a=0;a<this._numSubSegs;a++){var _=i.x+a*u,x=i.y+a*p,S=new Pt(_,x);n._minPtDist.initialize(),na.computeDistance(n._geom,S,n._minPtDist),n._maxPtDist.setMaximum(n._minPtDist)}};$l.prototype.isDone=function(){return!1};$l.prototype.isGeometryChanged=function(){return!1};$l.prototype.getMaxPointDistance=function(){return this._maxPtDist};$l.prototype.interfaces_=function(){return[Os]};$l.prototype.getClass=function(){return $l};var ko=function(e,t,n){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._bufDistance=t||null,this._result=n||null},By={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};ko.prototype.checkMaximumDistance=function(e,t,n){var i=new gs(t,e);if(i.setDensifyFraction(.25),this._maxDistanceFound=i.orientedDistance(),this._maxDistanceFound>n){this._isValid=!1;var r=i.getCoordinates();this._errorLocation=r[1],this._errorIndicator=e.getFactory().createLineString(r),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+Rs.toLineString(r[0],r[1])+")"}};ko.prototype.isValid=function(){var e=Math.abs(this._bufDistance),t=ko.MAX_DISTANCE_DIFF_FRAC*e;return this._minValidDistance=e-t,this._maxValidDistance=e+t,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),ko.VERBOSE&&Cr.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};ko.prototype.checkNegativeValid=function(){if(!(this._input instanceof rr||this._input instanceof Oa||this._input instanceof oo))return null;var e=this.getPolygonLines(this._input);if(this.checkMinimumDistance(e,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(e,this._result,this._maxValidDistance)};ko.prototype.getErrorIndicator=function(){return this._errorIndicator};ko.prototype.checkMinimumDistance=function(e,t,n){var i=new Tr(e,t,n);if(this._minDistanceFound=i.distance(),this._minDistanceFound<n){this._isValid=!1;var r=i.nearestPoints();this._errorLocation=i.nearestPoints()[1],this._errorIndicator=e.getFactory().createLineString(r),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+Rs.toLineString(r[0],r[1])+" )"}};ko.prototype.checkPositiveValid=function(){var e=this._result.getBoundary();if(this.checkMinimumDistance(this._input,e,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,e,this._maxValidDistance)};ko.prototype.getErrorLocation=function(){return this._errorLocation};ko.prototype.getPolygonLines=function(e){for(var t=new pe,n=new wr(t),i=pl.getPolygons(e),r=i.iterator();r.hasNext();){var u=r.next();u.apply(n)}return e.getFactory().buildGeometry(t)};ko.prototype.getErrorMessage=function(){return this._errMsg};ko.prototype.interfaces_=function(){return[]};ko.prototype.getClass=function(){return ko};By.VERBOSE.get=function(){return!1};By.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties(ko,By);var Lr=function(e,t,n){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._distance=t||null,this._result=n||null},Vy={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Lr.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};Lr.prototype.checkEnvelope=function(){if(this._distance<0)return null;var e=this._distance*Lr.MAX_ENV_DIFF_FRAC;e===0&&(e=.001);var t=new ke(this._input.getEnvelopeInternal());t.expandBy(this._distance);var n=new ke(this._result.getEnvelopeInternal());n.expandBy(e),n.contains(t)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(n)),this.report("Envelope")};Lr.prototype.checkDistance=function(){var e=new ko(this._input,this._distance,this._result);e.isValid()||(this._isValid=!1,this._errorMsg=e.getErrorMessage(),this._errorLocation=e.getErrorLocation(),this._errorIndicator=e.getErrorIndicator()),this.report("Distance")};Lr.prototype.checkArea=function(){var e=this._input.getArea(),t=this._result.getArea();this._distance>0&&e>t&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&e<t&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};Lr.prototype.checkPolygonal=function(){this._result instanceof rr||this._result instanceof Oa||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};Lr.prototype.getErrorIndicator=function(){return this._errorIndicator};Lr.prototype.getErrorLocation=function(){return this._errorLocation};Lr.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};Lr.prototype.report=function(e){if(!Lr.VERBOSE)return null;Cr.out.println("Check "+e+": "+(this._isValid?"passed":"FAILED"))};Lr.prototype.getErrorMessage=function(){return this._errorMsg};Lr.prototype.interfaces_=function(){return[]};Lr.prototype.getClass=function(){return Lr};Lr.isValidMsg=function(e,t,n){var i=new Lr(e,t,n);return i.isValid()?null:i.getErrorMessage()};Lr.isValid=function(e,t,n){var i=new Lr(e,t,n);return!!i.isValid()};Vy.VERBOSE.get=function(){return!1};Vy.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(Lr,Vy);var ga=function(){this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t};ga.prototype.getCoordinates=function(){return this._pts};ga.prototype.size=function(){return this._pts.length};ga.prototype.getCoordinate=function(e){return this._pts[e]};ga.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};ga.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:xc.octant(this.getCoordinate(e),this.getCoordinate(e+1))};ga.prototype.setData=function(e){this._data=e};ga.prototype.getData=function(){return this._data};ga.prototype.toString=function(){return Rs.toLineString(new zi(this._pts))};ga.prototype.interfaces_=function(){return[Ua]};ga.prototype.getClass=function(){return ga};var br=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new pe,this._intersectionCount=0,this._keepIntersections=!0;var e=arguments[0];this._li=e,this._interiorIntersection=null};br.prototype.getInteriorIntersection=function(){return this._interiorIntersection};br.prototype.setCheckEndSegmentsOnly=function(e){this._isCheckEndSegmentsOnly=e};br.prototype.getIntersectionSegments=function(){return this._intSegments};br.prototype.count=function(){return this._intersectionCount};br.prototype.getIntersections=function(){return this._intersections};br.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e};br.prototype.setKeepIntersections=function(e){this._keepIntersections=e};br.prototype.processIntersections=function(e,t,n,i){if(!this._findAllIntersections&&this.hasIntersection()||e===n&&t===i)return null;if(this._isCheckEndSegmentsOnly){var r=this.isEndSegment(e,t)||this.isEndSegment(n,i);if(!r)return null}var u=e.getCoordinates()[t],p=e.getCoordinates()[t+1],a=n.getCoordinates()[i],_=n.getCoordinates()[i+1];this._li.computeIntersection(u,p,a,_),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=u,this._intSegments[1]=p,this._intSegments[2]=a,this._intSegments[3]=_,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};br.prototype.isEndSegment=function(e,t){return t===0||t>=e.size()-2};br.prototype.hasIntersection=function(){return this._interiorIntersection!==null};br.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};br.prototype.interfaces_=function(){return[Bu]};br.prototype.getClass=function(){return br};br.createAllIntersectionsFinder=function(e){var t=new br(e);return t.setFindAllIntersections(!0),t};br.createAnyIntersectionFinder=function(e){return new br(e)};br.createIntersectionCounter=function(e){var t=new br(e);return t.setFindAllIntersections(!0),t.setKeepIntersections(!1),t};var Us=function(){this._li=new Zu,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var e=arguments[0];this._segStrings=e};Us.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};Us.prototype.getIntersections=function(){return this._segInt.getIntersections()};Us.prototype.isValid=function(){return this.execute(),this._isValid};Us.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e};Us.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new br(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var e=new Oy;if(e.setSegmentIntersector(this._segInt),e.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};Us.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new ml(this.getErrorMessage(),this._segInt.getInteriorIntersection())};Us.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var e=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+Rs.toLineString(e[0],e[1])+" and "+Rs.toLineString(e[2],e[3])};Us.prototype.interfaces_=function(){return[]};Us.prototype.getClass=function(){return Us};Us.computeIntersections=function(e){var t=new Us(e);return t.setFindAllIntersections(!0),t.isValid(),t.getIntersections()};var Gu=function e(){this._nv=null;var t=arguments[0];this._nv=new Us(e.toSegmentStrings(t))};Gu.prototype.checkValid=function(){this._nv.checkValid()};Gu.prototype.interfaces_=function(){return[]};Gu.prototype.getClass=function(){return Gu};Gu.toSegmentStrings=function(e){for(var t=new pe,n=e.iterator();n.hasNext();){var i=n.next();t.add(new ga(i.getCoordinates(),i))}return t};Gu.checkValid=function(e){var t=new Gu(e);t.checkValid()};var Tc=function(e){this._mapOp=e};Tc.prototype.map=function(e){for(var t=this,n=new pe,i=0;i<e.getNumGeometries();i++){var r=t._mapOp.map(e.getGeometryN(i));r.isEmpty()||n.add(r)}return e.getFactory().createGeometryCollection(_n.toGeometryArray(n))};Tc.prototype.interfaces_=function(){return[]};Tc.prototype.getClass=function(){return Tc};Tc.map=function(e,t){var n=new Tc(t);return n.map(e)};var _a=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new pe,this._resultLineList=new pe;var e=arguments[0],t=arguments[1],n=arguments[2];this._op=e,this._geometryFactory=t,this._ptLocator=n};_a.prototype.collectLines=function(e){for(var t=this,n=this._op.getGraph().getEdgeEnds().iterator();n.hasNext();){var i=n.next();t.collectLineEdge(i,e,t._lineEdgesList),t.collectBoundaryTouchEdge(i,e,t._lineEdgesList)}};_a.prototype.labelIsolatedLine=function(e,t){var n=this._ptLocator.locate(e.getCoordinate(),this._op.getArgGeometry(t));e.getLabel().setLocation(t,n)};_a.prototype.build=function(e){return this.findCoveredLineEdges(),this.collectLines(e),this.buildLines(e),this._resultLineList};_a.prototype.collectLineEdge=function(e,t,n){var i=e.getLabel(),r=e.getEdge();e.isLineEdge()&&!e.isVisited()&&sn.isResultOfOp(i,t)&&!r.isCovered()&&(n.add(r),e.setVisitedEdge(!0))};_a.prototype.findCoveredLineEdges=function(){for(var e=this,t=this._op.getGraph().getNodes().iterator();t.hasNext();){var n=t.next();n.getEdges().findCoveredLineEdges()}for(var i=this._op.getGraph().getEdgeEnds().iterator();i.hasNext();){var r=i.next(),u=r.getEdge();if(r.isLineEdge()&&!u.isCoveredSet()){var p=e._op.isCoveredByA(r.getCoordinate());u.setCovered(p)}}};_a.prototype.labelIsolatedLines=function(e){for(var t=this,n=e.iterator();n.hasNext();){var i=n.next(),r=i.getLabel();i.isIsolated()&&(r.isNull(0)?t.labelIsolatedLine(i,0):t.labelIsolatedLine(i,1))}};_a.prototype.buildLines=function(e){for(var t=this,n=this._lineEdgesList.iterator();n.hasNext();){var i=n.next(),r=t._geometryFactory.createLineString(i.getCoordinates());t._resultLineList.add(r),i.setInResult(!0)}};_a.prototype.collectBoundaryTouchEdge=function(e,t,n){var i=e.getLabel();if(e.isLineEdge()||e.isVisited()||e.isInteriorAreaEdge()||e.getEdge().isInResult())return null;an.isTrue(!(e.isInResult()||e.getSym().isInResult())||!e.getEdge().isInResult()),sn.isResultOfOp(i,t)&&t===sn.INTERSECTION&&(n.add(e.getEdge()),e.setVisitedEdge(!0))};_a.prototype.interfaces_=function(){return[]};_a.prototype.getClass=function(){return _a};var Lc=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new pe;var e=arguments[0],t=arguments[1];this._op=e,this._geometryFactory=t};Lc.prototype.filterCoveredNodeToPoint=function(e){var t=e.getCoordinate();if(!this._op.isCoveredByLA(t)){var n=this._geometryFactory.createPoint(t);this._resultPointList.add(n)}};Lc.prototype.extractNonCoveredResultNodes=function(e){for(var t=this,n=this._op.getGraph().getNodes().iterator();n.hasNext();){var i=n.next();if(!i.isInResult()&&!i.isIncidentEdgeInResult()&&(i.getEdges().getDegree()===0||e===sn.INTERSECTION)){var r=i.getLabel();sn.isResultOfOp(r,e)&&t.filterCoveredNodeToPoint(i)}}};Lc.prototype.build=function(e){return this.extractNonCoveredResultNodes(e),this._resultPointList};Lc.prototype.interfaces_=function(){return[]};Lc.prototype.getClass=function(){return Lc};var xo=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};xo.prototype.transformPoint=function(e,t){return this._factory.createPoint(this.transformCoordinates(e.getCoordinateSequence(),e))};xo.prototype.transformPolygon=function(e,t){var n=this,i=!0,r=this.transformLinearRing(e.getExteriorRing(),e);(r===null||!(r instanceof Ba)||r.isEmpty())&&(i=!1);for(var u=new pe,p=0;p<e.getNumInteriorRing();p++){var a=n.transformLinearRing(e.getInteriorRingN(p),e);a===null||a.isEmpty()||(a instanceof Ba||(i=!1),u.add(a))}if(i)return this._factory.createPolygon(r,u.toArray([]));var _=new pe;return r!==null&&_.add(r),_.addAll(u),this._factory.buildGeometry(_)};xo.prototype.createCoordinateSequence=function(e){return this._factory.getCoordinateSequenceFactory().create(e)};xo.prototype.getInputGeometry=function(){return this._inputGeom};xo.prototype.transformMultiLineString=function(e,t){for(var n=this,i=new pe,r=0;r<e.getNumGeometries();r++){var u=n.transformLineString(e.getGeometryN(r),e);u!==null&&(u.isEmpty()||i.add(u))}return this._factory.buildGeometry(i)};xo.prototype.transformCoordinates=function(e,t){return this.copy(e)};xo.prototype.transformLineString=function(e,t){return this._factory.createLineString(this.transformCoordinates(e.getCoordinateSequence(),e))};xo.prototype.transformMultiPoint=function(e,t){for(var n=this,i=new pe,r=0;r<e.getNumGeometries();r++){var u=n.transformPoint(e.getGeometryN(r),e);u!==null&&(u.isEmpty()||i.add(u))}return this._factory.buildGeometry(i)};xo.prototype.transformMultiPolygon=function(e,t){for(var n=this,i=new pe,r=0;r<e.getNumGeometries();r++){var u=n.transformPolygon(e.getGeometryN(r),e);u!==null&&(u.isEmpty()||i.add(u))}return this._factory.buildGeometry(i)};xo.prototype.copy=function(e){return e.copy()};xo.prototype.transformGeometryCollection=function(e,t){for(var n=this,i=new pe,r=0;r<e.getNumGeometries();r++){var u=n.transform(e.getGeometryN(r));u!==null&&(n._pruneEmptyGeometry&&u.isEmpty()||i.add(u))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(_n.toGeometryArray(i)):this._factory.buildGeometry(i)};xo.prototype.transform=function(e){if(this._inputGeom=e,this._factory=e.getFactory(),e instanceof No)return this.transformPoint(e,null);if(e instanceof Vh)return this.transformMultiPoint(e,null);if(e instanceof Ba)return this.transformLinearRing(e,null);if(e instanceof Mi)return this.transformLineString(e,null);if(e instanceof Ou)return this.transformMultiLineString(e,null);if(e instanceof rr)return this.transformPolygon(e,null);if(e instanceof Oa)return this.transformMultiPolygon(e,null);if(e instanceof oo)return this.transformGeometryCollection(e,null);throw new di("Unknown Geometry subtype: "+e.getClass().getName())};xo.prototype.transformLinearRing=function(e,t){var n=this.transformCoordinates(e.getCoordinateSequence(),e);if(n===null)return this._factory.createLinearRing(null);var i=n.size();return i>0&&i<4&&!this._preserveType?this._factory.createLineString(n):this._factory.createLinearRing(n)};xo.prototype.interfaces_=function(){return[]};xo.prototype.getClass=function(){return xo};var ja=function e(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new Ne,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof Mi&&typeof arguments[1]=="number"){var t=arguments[0],n=arguments[1];e.call(this,t.getCoordinates(),n)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var i=arguments[0],r=arguments[1];this._srcPts=i,this._isClosed=e.isClosed(i),this._snapTolerance=r}};ja.prototype.snapVertices=function(e,t){for(var n=this,i=this._isClosed?e.size()-1:e.size(),r=0;r<i;r++){var u=e.get(r),p=n.findSnapForVertex(u,t);p!==null&&(e.set(r,new Pt(p)),r===0&&n._isClosed&&e.set(e.size()-1,new Pt(p)))}};ja.prototype.findSnapForVertex=function(e,t){for(var n=this,i=0;i<t.length;i++){if(e.equals2D(t[i]))return null;if(e.distance(t[i])<n._snapTolerance)return t[i]}return null};ja.prototype.snapTo=function(e){var t=new dd(this._srcPts);this.snapVertices(t,e),this.snapSegments(t,e);var n=t.toCoordinateArray();return n};ja.prototype.snapSegments=function(e,t){var n=this;if(t.length===0)return null;var i=t.length;t[0].equals2D(t[t.length-1])&&(i=t.length-1);for(var r=0;r<i;r++){var u=t[r],p=n.findSegmentIndexToSnap(u,e);p>=0&&e.add(p+1,new Pt(u),!1)}};ja.prototype.findSegmentIndexToSnap=function(e,t){for(var n=this,i=Qe.MAX_VALUE,r=-1,u=0;u<t.size()-1;u++){if(n._seg.p0=t.get(u),n._seg.p1=t.get(u+1),n._seg.p0.equals2D(e)||n._seg.p1.equals2D(e)){if(n._allowSnappingToSourceVertices)continue;return-1}var p=n._seg.distance(e);p<n._snapTolerance&&p<i&&(i=p,r=u)}return r};ja.prototype.setAllowSnappingToSourceVertices=function(e){this._allowSnappingToSourceVertices=e};ja.prototype.interfaces_=function(){return[]};ja.prototype.getClass=function(){return ja};ja.isClosed=function(e){return e.length<=1?!1:e[0].equals2D(e[e.length-1])};var Fi=function(e){this._srcGeom=e||null},Mx={SNAP_PRECISION_FACTOR:{configurable:!0}};Fi.prototype.snapTo=function(e,t){var n=this.extractTargetCoordinates(e),i=new Px(t,n);return i.transform(this._srcGeom)};Fi.prototype.snapToSelf=function(e,t){var n=this.extractTargetCoordinates(this._srcGeom),i=new Px(e,n,!0),r=i.transform(this._srcGeom),u=r;return t&&We(u,Xl)&&(u=r.buffer(0)),u};Fi.prototype.computeSnapTolerance=function(e){var t=this.computeMinimumSegmentLength(e),n=t/10;return n};Fi.prototype.extractTargetCoordinates=function(e){for(var t=new ua,n=e.getCoordinates(),i=0;i<n.length;i++)t.add(n[i]);return t.toArray(new Array(0).fill(null))};Fi.prototype.computeMinimumSegmentLength=function(e){for(var t=Qe.MAX_VALUE,n=0;n<e.length-1;n++){var i=e[n].distance(e[n+1]);i<t&&(t=i)}return t};Fi.prototype.interfaces_=function(){return[]};Fi.prototype.getClass=function(){return Fi};Fi.snap=function(e,t,n){var i=new Array(2).fill(null),r=new Fi(e);i[0]=r.snapTo(t,n);var u=new Fi(t);return i[1]=u.snapTo(i[0],n),i};Fi.computeOverlaySnapTolerance=function(){if(arguments.length===1){var e=arguments[0],t=Fi.computeSizeBasedSnapTolerance(e),n=e.getPrecisionModel();if(n.getType()===Dn.FIXED){var i=1/n.getScale()*2/1.415;i>t&&(t=i)}return t}else if(arguments.length===2){var r=arguments[0],u=arguments[1];return Math.min(Fi.computeOverlaySnapTolerance(r),Fi.computeOverlaySnapTolerance(u))}};Fi.computeSizeBasedSnapTolerance=function(e){var t=e.getEnvelopeInternal(),n=Math.min(t.getHeight(),t.getWidth()),i=n*Fi.SNAP_PRECISION_FACTOR;return i};Fi.snapToSelf=function(e,t,n){var i=new Fi(e);return i.snapToSelf(t,n)};Mx.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(Fi,Mx);var Px=function(e){function t(n,i,r){e.call(this),this._snapTolerance=n||null,this._snapPts=i||null,this._isSelfSnap=r!==void 0?r:!1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.snapLine=function(n,i){var r=new ja(n,this._snapTolerance);return r.setAllowSnappingToSourceVertices(this._isSelfSnap),r.snapTo(i)},t.prototype.transformCoordinates=function(n,i){var r=n.toCoordinateArray(),u=this.snapLine(r,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(u)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(xo),to=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};to.prototype.getCommon=function(){return Qe.longBitsToDouble(this._commonBits)};to.prototype.add=function(e){var t=Qe.doubleToLongBits(e);if(this._isFirst)return this._commonBits=t,this._commonSignExp=to.signExpBits(this._commonBits),this._isFirst=!1,null;var n=to.signExpBits(t);if(n!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=to.numCommonMostSigMantissaBits(this._commonBits,t),this._commonBits=to.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};to.prototype.toString=function(){if(arguments.length===1){var e=arguments[0],t=Qe.longBitsToDouble(e),n=Qe.toBinaryString(e),i="0000000000000000000000000000000000000000000000000000000000000000"+n,r=i.substring(i.length-64),u=r.substring(0,1)+"  "+r.substring(1,12)+"(exp) "+r.substring(12)+" [ "+t+" ]";return u}};to.prototype.interfaces_=function(){return[]};to.prototype.getClass=function(){return to};to.getBit=function(e,t){var n=1<<t;return e&n?1:0};to.signExpBits=function(e){return e>>52};to.zeroLowerBits=function(e,t){var n=(1<<t)-1,i=~n,r=e&i;return r};to.numCommonMostSigMantissaBits=function(e,t){for(var n=0,i=52;i>=0;i--){if(to.getBit(e,i)!==to.getBit(t,i))return n;n++}return 52};var tu=function(){this._commonCoord=null,this._ccFilter=new Mc},Uy={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};tu.prototype.addCommonBits=function(e){var t=new eu(this._commonCoord);e.apply(t),e.geometryChanged()};tu.prototype.removeCommonBits=function(e){if(this._commonCoord.x===0&&this._commonCoord.y===0)return e;var t=new Pt(this._commonCoord);t.x=-t.x,t.y=-t.y;var n=new eu(t);return e.apply(n),e.geometryChanged(),e};tu.prototype.getCommonCoordinate=function(){return this._commonCoord};tu.prototype.add=function(e){e.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};tu.prototype.interfaces_=function(){return[]};tu.prototype.getClass=function(){return tu};Uy.CommonCoordinateFilter.get=function(){return Mc};Uy.Translater.get=function(){return eu};Object.defineProperties(tu,Uy);var Mc=function(){this._commonBitsX=new to,this._commonBitsY=new to};Mc.prototype.filter=function(e){this._commonBitsX.add(e.x),this._commonBitsY.add(e.y)};Mc.prototype.getCommonCoordinate=function(){return new Pt(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};Mc.prototype.interfaces_=function(){return[Fa]};Mc.prototype.getClass=function(){return Mc};var eu=function(){this.trans=null;var e=arguments[0];this.trans=e};eu.prototype.filter=function(e,t){var n=e.getOrdinate(t,0)+this.trans.x,i=e.getOrdinate(t,1)+this.trans.y;e.setOrdinate(t,0,n),e.setOrdinate(t,1,i)};eu.prototype.isDone=function(){return!1};eu.prototype.isGeometryChanged=function(){return!0};eu.prototype.interfaces_=function(){return[Os]};eu.prototype.getClass=function(){return eu};var xr=function(e,t){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=e,this._geom[1]=t,this.computeSnapTolerance()};xr.prototype.selfSnap=function(e){var t=new Fi(e),n=t.snapTo(e,this._snapTolerance);return n};xr.prototype.removeCommonBits=function(e){this._cbr=new tu,this._cbr.add(e[0]),this._cbr.add(e[1]);var t=new Array(2).fill(null);return t[0]=this._cbr.removeCommonBits(e[0].copy()),t[1]=this._cbr.removeCommonBits(e[1].copy()),t};xr.prototype.prepareResult=function(e){return this._cbr.addCommonBits(e),e};xr.prototype.getResultGeometry=function(e){var t=this.snap(this._geom),n=sn.overlayOp(t[0],t[1],e);return this.prepareResult(n)};xr.prototype.checkValid=function(e){e.isValid()||Cr.out.println("Snapped geometry is invalid")};xr.prototype.computeSnapTolerance=function(){this._snapTolerance=Fi.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};xr.prototype.snap=function(e){var t=this.removeCommonBits(e),n=Fi.snap(t[0],t[1],this._snapTolerance);return n};xr.prototype.interfaces_=function(){return[]};xr.prototype.getClass=function(){return xr};xr.overlayOp=function(e,t,n){var i=new xr(e,t);return i.getResultGeometry(n)};xr.union=function(e,t){return xr.overlayOp(e,t,sn.UNION)};xr.intersection=function(e,t){return xr.overlayOp(e,t,sn.INTERSECTION)};xr.symDifference=function(e,t){return xr.overlayOp(e,t,sn.SYMDIFFERENCE)};xr.difference=function(e,t){return xr.overlayOp(e,t,sn.DIFFERENCE)};var lo=function(e,t){this._geom=new Array(2).fill(null),this._geom[0]=e,this._geom[1]=t};lo.prototype.getResultGeometry=function(e){var t=null,n=!1,i=null;try{t=sn.overlayOp(this._geom[0],this._geom[1],e);var r=!0;r&&(n=!0)}catch(u){if(u instanceof fl)i=u;else throw u}finally{}if(!n)try{t=xr.overlayOp(this._geom[0],this._geom[1],e)}catch(u){throw u instanceof fl?i:u}finally{}return t};lo.prototype.interfaces_=function(){return[]};lo.prototype.getClass=function(){return lo};lo.overlayOp=function(e,t,n){var i=new lo(e,t);return i.getResultGeometry(n)};lo.union=function(e,t){return lo.overlayOp(e,t,sn.UNION)};lo.intersection=function(e,t){return lo.overlayOp(e,t,sn.INTERSECTION)};lo.symDifference=function(e,t){return lo.overlayOp(e,t,sn.SYMDIFFERENCE)};lo.difference=function(e,t){return lo.overlayOp(e,t,sn.DIFFERENCE)};var ed=function(){this.mce=null,this.chainIndex=null;var e=arguments[0],t=arguments[1];this.mce=e,this.chainIndex=t};ed.prototype.computeIntersections=function(e,t){this.mce.computeIntersectsForChain(this.chainIndex,e.mce,e.chainIndex,t)};ed.prototype.interfaces_=function(){return[]};ed.prototype.getClass=function(){return ed};var Oo=function e(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var t=arguments[0],n=arguments[1];this._eventType=e.DELETE,this._xValue=t,this._insertEvent=n}else if(arguments.length===3){var i=arguments[0],r=arguments[1],u=arguments[2];this._eventType=e.INSERT,this._label=i,this._xValue=r,this._obj=u}},Gy={INSERT:{configurable:!0},DELETE:{configurable:!0}};Oo.prototype.isDelete=function(){return this._eventType===Oo.DELETE};Oo.prototype.setDeleteEventIndex=function(e){this._deleteEventIndex=e};Oo.prototype.getObject=function(){return this._obj};Oo.prototype.compareTo=function(e){var t=e;return this._xValue<t._xValue?-1:this._xValue>t._xValue?1:this._eventType<t._eventType?-1:this._eventType>t._eventType?1:0};Oo.prototype.getInsertEvent=function(){return this._insertEvent};Oo.prototype.isInsert=function(){return this._eventType===Oo.INSERT};Oo.prototype.isSameLabel=function(e){return this._label===null?!1:this._label===e._label};Oo.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};Oo.prototype.interfaces_=function(){return[xs]};Oo.prototype.getClass=function(){return Oo};Gy.INSERT.get=function(){return 1};Gy.DELETE.get=function(){return 2};Object.defineProperties(Oo,Gy);var tg=function(){};tg.prototype.interfaces_=function(){return[]};tg.prototype.getClass=function(){return tg};var Mr=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var e=arguments[0],t=arguments[1],n=arguments[2];this._li=e,this._includeProper=t,this._recordIsolated=n};Mr.prototype.isTrivialIntersection=function(e,t,n,i){if(e===n&&this._li.getIntersectionNum()===1){if(Mr.isAdjacentSegments(t,i))return!0;if(e.isClosed()){var r=e.getNumPoints()-1;if(t===0&&i===r||i===0&&t===r)return!0}}return!1};Mr.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Mr.prototype.setIsDoneIfProperInt=function(e){this._isDoneWhenProperInt=e};Mr.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Mr.prototype.isBoundaryPointInternal=function(e,t){for(var n=t.iterator();n.hasNext();){var i=n.next(),r=i.getCoordinate();if(e.isIntersection(r))return!0}return!1};Mr.prototype.hasProperIntersection=function(){return this._hasProper};Mr.prototype.hasIntersection=function(){return this._hasIntersection};Mr.prototype.isDone=function(){return this._isDone};Mr.prototype.isBoundaryPoint=function(e,t){return t===null?!1:!!(this.isBoundaryPointInternal(e,t[0])||this.isBoundaryPointInternal(e,t[1]))};Mr.prototype.setBoundaryNodes=function(e,t){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=e,this._bdyNodes[1]=t};Mr.prototype.addIntersections=function(e,t,n,i){if(e===n&&t===i)return null;this.numTests++;var r=e.getCoordinates()[t],u=e.getCoordinates()[t+1],p=n.getCoordinates()[i],a=n.getCoordinates()[i+1];this._li.computeIntersection(r,u,p,a),this._li.hasIntersection()&&(this._recordIsolated&&(e.setIsolated(!1),n.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(e,t,n,i)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(e.addIntersections(this._li,t,0),n.addIntersections(this._li,i,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};Mr.prototype.interfaces_=function(){return[]};Mr.prototype.getClass=function(){return Mr};Mr.isAdjacentSegments=function(e,t){return Math.abs(e-t)===1};var vC=function(e){function t(){e.call(this),this.events=new pe,this.nOverlaps=null}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.prepareEvents=function(){var n=this;Fs.sort(this.events);for(var i=0;i<this.events.size();i++){var r=n.events.get(i);r.isDelete()&&r.getInsertEvent().setDeleteEventIndex(i)}},t.prototype.computeIntersections=function(){var n=this;if(arguments.length===1){var i=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var r=0;r<this.events.size();r++){var u=n.events.get(r);if(u.isInsert()&&n.processOverlaps(r,u.getDeleteEventIndex(),u,i),i.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof Mr&&We(arguments[0],Ns)&&We(arguments[1],Ns)){var p=arguments[0],a=arguments[1],_=arguments[2];this.addEdges(p,p),this.addEdges(a,a),this.computeIntersections(_)}else if(typeof arguments[2]=="boolean"&&We(arguments[0],Ns)&&arguments[1]instanceof Mr){var x=arguments[0],S=arguments[1],L=arguments[2];L?this.addEdges(x,null):this.addEdges(x),this.computeIntersections(S)}}},t.prototype.addEdge=function(n,i){for(var r=this,u=n.getMonotoneChainEdge(),p=u.getStartIndexes(),a=0;a<p.length-1;a++){var _=new ed(u,a),x=new Oo(i,u.getMinX(a),_);r.events.add(x),r.events.add(new Oo(u.getMaxX(a),x))}},t.prototype.processOverlaps=function(n,i,r,u){for(var p=this,a=r.getObject(),_=n;_<i;_++){var x=p.events.get(_);if(x.isInsert()){var S=x.getObject();r.isSameLabel(x)||(a.computeIntersections(S,u),p.nOverlaps++)}}},t.prototype.addEdges=function(){var n=this;if(arguments.length===1)for(var i=arguments[0],r=i.iterator();r.hasNext();){var u=r.next();n.addEdge(u,u)}else if(arguments.length===2)for(var p=arguments[0],a=arguments[1],_=p.iterator();_.hasNext();){var x=_.next();n.addEdge(x,a)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(tg),Za=function(){this._min=Qe.POSITIVE_INFINITY,this._max=Qe.NEGATIVE_INFINITY},Ax={NodeComparator:{configurable:!0}};Za.prototype.getMin=function(){return this._min};Za.prototype.intersects=function(e,t){return!(this._min>t||this._max<e)};Za.prototype.getMax=function(){return this._max};Za.prototype.toString=function(){return Rs.toLineString(new Pt(this._min,0),new Pt(this._max,0))};Za.prototype.interfaces_=function(){return[]};Za.prototype.getClass=function(){return Za};Ax.NodeComparator.get=function(){return nd};Object.defineProperties(Za,Ax);var nd=function(){};nd.prototype.compare=function(e,t){var n=e,i=t,r=(n._min+n._max)/2,u=(i._min+i._max)/2;return r<u?-1:r>u?1:0};nd.prototype.interfaces_=function(){return[Nh]};nd.prototype.getClass=function(){return nd};var bC=function(e){function t(){e.call(this),this._item=null;var n=arguments[0],i=arguments[1],r=arguments[2];this._min=n,this._max=i,this._item=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.query=function(n,i,r){if(!this.intersects(n,i))return null;r.visitItem(this._item)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Za),xC=function(e){function t(){e.call(this),this._node1=null,this._node2=null;var n=arguments[0],i=arguments[1];this._node1=n,this._node2=i,this.buildExtent(this._node1,this._node2)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.buildExtent=function(n,i){this._min=Math.min(n._min,i._min),this._max=Math.max(n._max,i._max)},t.prototype.query=function(n,i,r){if(!this.intersects(n,i))return null;this._node1!==null&&this._node1.query(n,i,r),this._node2!==null&&this._node2.query(n,i,r)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Za),Wa=function(){this._leaves=new pe,this._root=null,this._level=0};Wa.prototype.buildTree=function(){var e=this;Fs.sort(this._leaves,new Za.NodeComparator);for(var t=this._leaves,n=null,i=new pe;;){if(e.buildLevel(t,i),i.size()===1)return i.get(0);n=t,t=i,i=n}};Wa.prototype.insert=function(e,t,n){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new bC(e,t,n))};Wa.prototype.query=function(e,t,n){this.init(),this._root.query(e,t,n)};Wa.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};Wa.prototype.printNode=function(e){Cr.out.println(Rs.toLineString(new Pt(e._min,this._level),new Pt(e._max,this._level)))};Wa.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};Wa.prototype.buildLevel=function(e,t){this._level++,t.clear();for(var n=0;n<e.size();n+=2){var i=e.get(n),r=n+1<e.size()?e.get(n):null;if(r===null)t.add(i);else{var u=new xC(e.get(n),e.get(n+1));t.add(u)}}};Wa.prototype.interfaces_=function(){return[]};Wa.prototype.getClass=function(){return Wa};var Wh=function(){this._items=new pe};Wh.prototype.visitItem=function(e){this._items.add(e)};Wh.prototype.getItems=function(){return this._items};Wh.prototype.interfaces_=function(){return[Hl]};Wh.prototype.getClass=function(){return Wh};var Xh=function(){this._index=null;var e=arguments[0];if(!We(e,Xl))throw new di("Argument must be Polygonal");this._index=new qu(e)},qy={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};Xh.prototype.locate=function(e){var t=new oa(e),n=new Hh(t);return this._index.query(e.y,e.y,n),t.getLocation()};Xh.prototype.interfaces_=function(){return[jh]};Xh.prototype.getClass=function(){return Xh};qy.SegmentVisitor.get=function(){return Hh};qy.IntervalIndexedGeometry.get=function(){return qu};Object.defineProperties(Xh,qy);var Hh=function(){this._counter=null;var e=arguments[0];this._counter=e};Hh.prototype.visitItem=function(e){var t=e;this._counter.countSegment(t.getCoordinate(0),t.getCoordinate(1))};Hh.prototype.interfaces_=function(){return[Hl]};Hh.prototype.getClass=function(){return Hh};var qu=function(){this._index=new Wa;var e=arguments[0];this.init(e)};qu.prototype.init=function(e){for(var t=this,n=wr.getLines(e),i=n.iterator();i.hasNext();){var r=i.next(),u=r.getCoordinates();t.addLine(u)}};qu.prototype.addLine=function(e){for(var t=this,n=1;n<e.length;n++){var i=new Ne(e[n-1],e[n]),r=Math.min(i.p0.y,i.p1.y),u=Math.max(i.p0.y,i.p1.y);t._index.insert(r,u,i)}};qu.prototype.query=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=new Wh;return this._index.query(e,t,n),n.getItems()}else if(arguments.length===3){var i=arguments[0],r=arguments[1],u=arguments[2];this._index.query(i,r,u)}};qu.prototype.interfaces_=function(){return[]};qu.prototype.getClass=function(){return qu};var bf=function(e){function t(){if(e.call(this),this._parentGeom=null,this._lineEdgeMap=new dx,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Vs,arguments.length===2){var n=arguments[0],i=arguments[1],r=_s.OGC_SFS_BOUNDARY_RULE;this._argIndex=n,this._parentGeom=i,this._boundaryNodeRule=r,i!==null&&this.add(i)}else if(arguments.length===3){var u=arguments[0],p=arguments[1],a=arguments[2];this._argIndex=u,this._parentGeom=p,this._boundaryNodeRule=a,p!==null&&this.add(p)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.insertBoundaryPoint=function(n,i){var r=this._nodes.addNode(i),u=r.getLabel(),p=1,a=Dt.NONE;a=u.getLocation(n,oe.ON),a===Dt.BOUNDARY&&p++;var _=t.determineBoundary(this._boundaryNodeRule,p);u.setLocation(n,_)},t.prototype.computeSelfNodes=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.computeSelfNodes(n,i,!1)}else if(arguments.length===3){var r=arguments[0],u=arguments[1],p=arguments[2],a=new Mr(r,!0,!1);a.setIsDoneIfProperInt(p);var _=this.createEdgeSetIntersector(),x=this._parentGeom instanceof Ba||this._parentGeom instanceof rr||this._parentGeom instanceof Oa,S=u||!x;return _.computeIntersections(this._edges,a,S),this.addSelfIntersectionNodes(this._argIndex),a}},t.prototype.computeSplitEdges=function(n){for(var i=this._edges.iterator();i.hasNext();){var r=i.next();r.eiList.addSplitEdges(n)}},t.prototype.computeEdgeIntersections=function(n,i,r){var u=new Mr(i,r,!0);u.setBoundaryNodes(this.getBoundaryNodes(),n.getBoundaryNodes());var p=this.createEdgeSetIntersector();return p.computeIntersections(this._edges,n._edges,u),u},t.prototype.getGeometry=function(){return this._parentGeom},t.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},t.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},t.prototype.addPoint=function(){if(arguments[0]instanceof No){var n=arguments[0],i=n.getCoordinate();this.insertPoint(this._argIndex,i,Dt.INTERIOR)}else if(arguments[0]instanceof Pt){var r=arguments[0];this.insertPoint(this._argIndex,r,Dt.INTERIOR)}},t.prototype.addPolygon=function(n){var i=this;this.addPolygonRing(n.getExteriorRing(),Dt.EXTERIOR,Dt.INTERIOR);for(var r=0;r<n.getNumInteriorRing();r++){var u=n.getInteriorRingN(r);i.addPolygonRing(u,Dt.INTERIOR,Dt.EXTERIOR)}},t.prototype.addEdge=function(n){this.insertEdge(n);var i=n.getCoordinates();this.insertPoint(this._argIndex,i[0],Dt.BOUNDARY),this.insertPoint(this._argIndex,i[i.length-1],Dt.BOUNDARY)},t.prototype.addLineString=function(n){var i=yn.removeRepeatedPoints(n.getCoordinates());if(i.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=i[0],null;var r=new $m(i,new Vn(this._argIndex,Dt.INTERIOR));this._lineEdgeMap.put(n,r),this.insertEdge(r),an.isTrue(i.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,i[0]),this.insertBoundaryPoint(this._argIndex,i[i.length-1])},t.prototype.getInvalidPoint=function(){return this._invalidPoint},t.prototype.getBoundaryPoints=function(){for(var n=this.getBoundaryNodes(),i=new Array(n.size()).fill(null),r=0,u=n.iterator();u.hasNext();){var p=u.next();i[r++]=p.getCoordinate().copy()}return i},t.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},t.prototype.addSelfIntersectionNode=function(n,i,r){if(this.isBoundaryNode(n,i))return null;r===Dt.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(n,i):this.insertPoint(n,i,r)},t.prototype.addPolygonRing=function(n,i,r){if(n.isEmpty())return null;var u=yn.removeRepeatedPoints(n.getCoordinates());if(u.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=u[0],null;var p=i,a=r;ve.isCCW(u)&&(p=r,a=i);var _=new $m(u,new Vn(this._argIndex,Dt.BOUNDARY,p,a));this._lineEdgeMap.put(n,_),this.insertEdge(_),this.insertPoint(this._argIndex,u[0],Dt.BOUNDARY)},t.prototype.insertPoint=function(n,i,r){var u=this._nodes.addNode(i),p=u.getLabel();p===null?u._label=new Vn(n,r):p.setLocation(n,r)},t.prototype.createEdgeSetIntersector=function(){return new vC},t.prototype.addSelfIntersectionNodes=function(n){for(var i=this,r=this._edges.iterator();r.hasNext();)for(var u=r.next(),p=u.getLabel().getLocation(n),a=u.eiList.iterator();a.hasNext();){var _=a.next();i.addSelfIntersectionNode(n,_.coord,p)}},t.prototype.add=function(){if(arguments.length===1){var n=arguments[0];if(n.isEmpty())return null;if(n instanceof Oa&&(this._useBoundaryDeterminationRule=!1),n instanceof rr)this.addPolygon(n);else if(n instanceof Mi)this.addLineString(n);else if(n instanceof No)this.addPoint(n);else if(n instanceof Vh)this.addCollection(n);else if(n instanceof Ou)this.addCollection(n);else if(n instanceof Oa)this.addCollection(n);else if(n instanceof oo)this.addCollection(n);else throw new Error(n.getClass().getName())}else return e.prototype.add.apply(this,arguments)},t.prototype.addCollection=function(n){for(var i=this,r=0;r<n.getNumGeometries();r++){var u=n.getGeometryN(r);i.add(u)}},t.prototype.locate=function(n){return We(this._parentGeom,Xl)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new Xh(this._parentGeom)),this._areaPtLocator.locate(n)):this._ptLocator.locate(n,this._parentGeom)},t.prototype.findEdge=function(){if(arguments.length===1){var n=arguments[0];return this._lineEdgeMap.get(n)}else return e.prototype.findEdge.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.determineBoundary=function(n,i){return n.isInBoundary(i)?Dt.BOUNDARY:Dt.INTERIOR},t}(xi),Yh=function(){if(this._li=new Zu,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var e=arguments[0];this.setComputationPrecision(e.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new bf(0,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1],i=_s.OGC_SFS_BOUNDARY_RULE;t.getPrecisionModel().compareTo(n.getPrecisionModel())>=0?this.setComputationPrecision(t.getPrecisionModel()):this.setComputationPrecision(n.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new bf(0,t,i),this._arg[1]=new bf(1,n,i)}else if(arguments.length===3){var r=arguments[0],u=arguments[1],p=arguments[2];r.getPrecisionModel().compareTo(u.getPrecisionModel())>=0?this.setComputationPrecision(r.getPrecisionModel()):this.setComputationPrecision(u.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new bf(0,r,p),this._arg[1]=new bf(1,u,p)}};Yh.prototype.getArgGeometry=function(e){return this._arg[e].getGeometry()};Yh.prototype.setComputationPrecision=function(e){this._resultPrecisionModel=e,this._li.setPrecisionModel(this._resultPrecisionModel)};Yh.prototype.interfaces_=function(){return[]};Yh.prototype.getClass=function(){return Yh};var ku=function(){};ku.prototype.interfaces_=function(){return[]};ku.prototype.getClass=function(){return ku};ku.map=function(){if(arguments[0]instanceof je&&We(arguments[1],ku.MapOp)){for(var e=arguments[0],t=arguments[1],n=new pe,i=0;i<e.getNumGeometries();i++){var r=t.map(e.getGeometryN(i));r!==null&&n.add(r)}return e.getFactory().buildGeometry(n)}else if(We(arguments[0],tr)&&We(arguments[1],ku.MapOp)){for(var u=arguments[0],p=arguments[1],a=new pe,_=u.iterator();_.hasNext();){var x=_.next(),S=p.map(x);S!==null&&a.add(S)}return a}};ku.MapOp=function(){};var sn=function(e){function t(){var n=arguments[0],i=arguments[1];e.call(this,n,i),this._ptLocator=new Vs,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new Bs,this._resultPolyList=new pe,this._resultLineList=new pe,this._resultPointList=new pe,this._graph=new xi(new wx),this._geomFact=n.getFactory()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.insertUniqueEdge=function(n){var i=this._edgeList.findEqualEdge(n);if(i!==null){var r=i.getLabel(),u=n.getLabel();i.isPointwiseEqual(n)||(u=new Vn(n.getLabel()),u.flip());var p=i.getDepth();p.isNull()&&p.add(r),p.add(u),r.merge(u)}else this._edgeList.add(n)},t.prototype.getGraph=function(){return this._graph},t.prototype.cancelDuplicateResultEdges=function(){for(var n=this._graph.getEdgeEnds().iterator();n.hasNext();){var i=n.next(),r=i.getSym();i.isInResult()&&r.isInResult()&&(i.setInResult(!1),r.setInResult(!1))}},t.prototype.isCoveredByLA=function(n){return!!(this.isCovered(n,this._resultLineList)||this.isCovered(n,this._resultPolyList))},t.prototype.computeGeometry=function(n,i,r,u){var p=new pe;return p.addAll(n),p.addAll(i),p.addAll(r),p.isEmpty()?t.createEmptyResult(u,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(p)},t.prototype.mergeSymLabels=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var i=n.next();i.getEdges().mergeSymLabels()}},t.prototype.isCovered=function(n,i){for(var r=this,u=i.iterator();u.hasNext();){var p=u.next(),a=r._ptLocator.locate(n,p);if(a!==Dt.EXTERIOR)return!0}return!1},t.prototype.replaceCollapsedEdges=function(){for(var n=new pe,i=this._edgeList.iterator();i.hasNext();){var r=i.next();r.isCollapsed()&&(i.remove(),n.add(r.getCollapsedEdge()))}this._edgeList.addAll(n)},t.prototype.updateNodeLabelling=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var i=n.next(),r=i.getEdges().getLabel();i.getLabel().merge(r)}},t.prototype.getResultGeometry=function(n){return this.computeOverlay(n),this._resultGeom},t.prototype.insertUniqueEdges=function(n){for(var i=this,r=n.iterator();r.hasNext();){var u=r.next();i.insertUniqueEdge(u)}},t.prototype.computeOverlay=function(n){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var i=new pe;this._arg[0].computeSplitEdges(i),this._arg[1].computeSplitEdges(i),this.insertUniqueEdges(i),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Gu.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(n),this.cancelDuplicateResultEdges();var r=new Do(this._geomFact);r.add(this._graph),this._resultPolyList=r.getPolygons();var u=new _a(this,this._geomFact,this._ptLocator);this._resultLineList=u.build(n);var p=new Lc(this,this._geomFact,this._ptLocator);this._resultPointList=p.build(n),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,n)},t.prototype.labelIncompleteNode=function(n,i){var r=this._ptLocator.locate(n.getCoordinate(),this._arg[i].getGeometry());n.getLabel().setLocation(i,r)},t.prototype.copyPoints=function(n){for(var i=this,r=this._arg[n].getNodeIterator();r.hasNext();){var u=r.next(),p=i._graph.addNode(u.getCoordinate());p.setLabel(n,u.getLabel().getLocation(n))}},t.prototype.findResultAreaEdges=function(n){for(var i=this._graph.getEdgeEnds().iterator();i.hasNext();){var r=i.next(),u=r.getLabel();u.isArea()&&!r.isInteriorAreaEdge()&&t.isResultOfOp(u.getLocation(0,oe.RIGHT),u.getLocation(1,oe.RIGHT),n)&&r.setInResult(!0)}},t.prototype.computeLabelsFromDepths=function(){for(var n=this._edgeList.iterator();n.hasNext();){var i=n.next(),r=i.getLabel(),u=i.getDepth();if(!u.isNull()){u.normalize();for(var p=0;p<2;p++)!r.isNull(p)&&r.isArea()&&!u.isNull(p)&&(u.getDelta(p)===0?r.toLine(p):(an.isTrue(!u.isNull(p,oe.LEFT),"depth of LEFT side has not been initialized"),r.setLocation(p,oe.LEFT,u.getLocation(p,oe.LEFT)),an.isTrue(!u.isNull(p,oe.RIGHT),"depth of RIGHT side has not been initialized"),r.setLocation(p,oe.RIGHT,u.getLocation(p,oe.RIGHT))))}}},t.prototype.computeLabelling=function(){for(var n=this,i=this._graph.getNodes().iterator();i.hasNext();){var r=i.next();r.getEdges().computeLabelling(n._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},t.prototype.labelIncompleteNodes=function(){for(var n=this,i=this._graph.getNodes().iterator();i.hasNext();){var r=i.next(),u=r.getLabel();r.isIsolated()&&(u.isNull(0)?n.labelIncompleteNode(r,0):n.labelIncompleteNode(r,1)),r.getEdges().updateLabelling(u)}},t.prototype.isCoveredByA=function(n){return!!this.isCovered(n,this._resultPolyList)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Yh);sn.overlayOp=function(e,t,n){var i=new sn(e,t),r=i.getResultGeometry(n);return r};sn.intersection=function(e,t){if(e.isEmpty()||t.isEmpty())return sn.createEmptyResult(sn.INTERSECTION,e,t,e.getFactory());if(e.isGeometryCollection()){var n=t;return Tc.map(e,{interfaces_:function(){return[ku.MapOp]},map:function(i){return i.intersection(n)}})}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),lo.overlayOp(e,t,sn.INTERSECTION)};sn.symDifference=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return sn.createEmptyResult(sn.SYMDIFFERENCE,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),lo.overlayOp(e,t,sn.SYMDIFFERENCE)};sn.resultDimension=function(e,t,n){var i=t.getDimension(),r=n.getDimension(),u=-1;switch(e){case sn.INTERSECTION:u=Math.min(i,r);break;case sn.UNION:u=Math.max(i,r);break;case sn.DIFFERENCE:u=i;break;case sn.SYMDIFFERENCE:u=Math.max(i,r);break}return u};sn.createEmptyResult=function(e,t,n,i){var r=null;switch(sn.resultDimension(e,t,n)){case-1:r=i.createGeometryCollection(new Array(0).fill(null));break;case 0:r=i.createPoint();break;case 1:r=i.createLineString();break;case 2:r=i.createPolygon();break}return r};sn.difference=function(e,t){return e.isEmpty()?sn.createEmptyResult(sn.DIFFERENCE,e,t,e.getFactory()):t.isEmpty()?e.copy():(e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),lo.overlayOp(e,t,sn.DIFFERENCE))};sn.isResultOfOp=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=e.getLocation(0),i=e.getLocation(1);return sn.isResultOfOp(n,i,t)}else if(arguments.length===3){var r=arguments[0],u=arguments[1],p=arguments[2];switch(r===Dt.BOUNDARY&&(r=Dt.INTERIOR),u===Dt.BOUNDARY&&(u=Dt.INTERIOR),p){case sn.INTERSECTION:return r===Dt.INTERIOR&&u===Dt.INTERIOR;case sn.UNION:return r===Dt.INTERIOR||u===Dt.INTERIOR;case sn.DIFFERENCE:return r===Dt.INTERIOR&&u!==Dt.INTERIOR;case sn.SYMDIFFERENCE:return r===Dt.INTERIOR&&u!==Dt.INTERIOR||r!==Dt.INTERIOR&&u===Dt.INTERIOR}return!1}};sn.INTERSECTION=1;sn.UNION=2;sn.DIFFERENCE=3;sn.SYMDIFFERENCE=4;var Wl=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Vs,this._seg=new Ne;var e=arguments[0],t=arguments[1];this._g=e,this._boundaryDistanceTolerance=t,this._linework=this.extractLinework(e)};Wl.prototype.isWithinToleranceOfBoundary=function(e){for(var t=this,n=0;n<this._linework.getNumGeometries();n++)for(var i=t._linework.getGeometryN(n),r=i.getCoordinateSequence(),u=0;u<r.size()-1;u++){r.getCoordinate(u,t._seg.p0),r.getCoordinate(u+1,t._seg.p1);var p=t._seg.distance(e);if(p<=t._boundaryDistanceTolerance)return!0}return!1};Wl.prototype.getLocation=function(e){return this.isWithinToleranceOfBoundary(e)?Dt.BOUNDARY:this._ptLocator.locate(e,this._g)};Wl.prototype.extractLinework=function(e){var t=new Kh;e.apply(t);var n=t.getLinework(),i=_n.toLineStringArray(n);return e.getFactory().createMultiLineString(i)};Wl.prototype.interfaces_=function(){return[]};Wl.prototype.getClass=function(){return Wl};var Kh=function(){this._linework=null,this._linework=new pe};Kh.prototype.getLinework=function(){return this._linework};Kh.prototype.filter=function(e){var t=this;if(e instanceof rr){var n=e;this._linework.add(n.getExteriorRing());for(var i=0;i<n.getNumInteriorRing();i++)t._linework.add(n.getInteriorRingN(i))}};Kh.prototype.interfaces_=function(){return[ca]};Kh.prototype.getClass=function(){return Kh};var ju=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var e=arguments[0];this._g=e};ju.prototype.extractPoints=function(e,t,n){for(var i=this,r=e.getCoordinates(),u=0;u<r.length-1;u++)i.computeOffsetPoints(r[u],r[u+1],t,n)};ju.prototype.setSidesToGenerate=function(e,t){this._doLeft=e,this._doRight=t};ju.prototype.getPoints=function(e){for(var t=this,n=new pe,i=wr.getLines(this._g),r=i.iterator();r.hasNext();){var u=r.next();t.extractPoints(u,e,n)}return n};ju.prototype.computeOffsetPoints=function(e,t,n,i){var r=t.x-e.x,u=t.y-e.y,p=Math.sqrt(r*r+u*u),a=n*r/p,_=n*u/p,x=(t.x+e.x)/2,S=(t.y+e.y)/2;if(this._doLeft){var L=new Pt(x-_,S+a);i.add(L)}if(this._doRight){var k=new Pt(x+_,S-a);i.add(k)}};ju.prototype.interfaces_=function(){return[]};ju.prototype.getClass=function(){return ju};var es=function e(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=e.TOLERANCE,this._testCoords=new pe;var t=arguments[0],n=arguments[1],i=arguments[2];this._boundaryDistanceTolerance=e.computeBoundaryDistanceTolerance(t,n),this._geom=[t,n,i],this._locFinder=[new Wl(this._geom[0],this._boundaryDistanceTolerance),new Wl(this._geom[1],this._boundaryDistanceTolerance),new Wl(this._geom[2],this._boundaryDistanceTolerance)]},kx={TOLERANCE:{configurable:!0}};es.prototype.reportResult=function(e,t,n){Cr.out.println("Overlay result invalid - A:"+Dt.toLocationSymbol(t[0])+" B:"+Dt.toLocationSymbol(t[1])+" expected:"+(n?"i":"e")+" actual:"+Dt.toLocationSymbol(t[2]))};es.prototype.isValid=function(e){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var t=this.checkValid(e);return t};es.prototype.checkValid=function(){var e=this;if(arguments.length===1){for(var t=arguments[0],n=0;n<this._testCoords.size();n++){var i=e._testCoords.get(n);if(!e.checkValid(t,i))return e._invalidLocation=i,!1}return!0}else if(arguments.length===2){var r=arguments[0],u=arguments[1];return this._location[0]=this._locFinder[0].getLocation(u),this._location[1]=this._locFinder[1].getLocation(u),this._location[2]=this._locFinder[2].getLocation(u),es.hasLocation(this._location,Dt.BOUNDARY)?!0:this.isValidResult(r,this._location)}};es.prototype.addTestPts=function(e){var t=new ju(e);this._testCoords.addAll(t.getPoints(5*this._boundaryDistanceTolerance))};es.prototype.isValidResult=function(e,t){var n=sn.isResultOfOp(t[0],t[1],e),i=t[2]===Dt.INTERIOR,r=!(n^i);return r||this.reportResult(e,t,n),r};es.prototype.getInvalidLocation=function(){return this._invalidLocation};es.prototype.interfaces_=function(){return[]};es.prototype.getClass=function(){return es};es.hasLocation=function(e,t){for(var n=0;n<3;n++)if(e[n]===t)return!0;return!1};es.computeBoundaryDistanceTolerance=function(e,t){return Math.min(Fi.computeSizeBasedSnapTolerance(e),Fi.computeSizeBasedSnapTolerance(t))};es.isValid=function(e,t,n,i){var r=new es(e,t,i);return r.isValid(n)};kx.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(es,kx);var Ho=function e(t){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=e.extractFactory(t),this._inputGeoms=t};Ho.prototype.extractElements=function(e,t){var n=this;if(e===null)return null;for(var i=0;i<e.getNumGeometries();i++){var r=e.getGeometryN(i);n._skipEmpty&&r.isEmpty()||t.add(r)}};Ho.prototype.combine=function(){for(var e=this,t=new pe,n=this._inputGeoms.iterator();n.hasNext();){var i=n.next();e.extractElements(i,t)}return t.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(t)};Ho.prototype.interfaces_=function(){return[]};Ho.prototype.getClass=function(){return Ho};Ho.combine=function(){if(arguments.length===1){var e=arguments[0],t=new Ho(e);return t.combine()}else if(arguments.length===2){var n=arguments[0],i=arguments[1],r=new Ho(Ho.createList(n,i));return r.combine()}else if(arguments.length===3){var u=arguments[0],p=arguments[1],a=arguments[2],_=new Ho(Ho.createList(u,p,a));return _.combine()}};Ho.extractFactory=function(e){return e.isEmpty()?null:e.iterator().next().getFactory()};Ho.createList=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=new pe;return n.add(e),n.add(t),n}else if(arguments.length===3){var i=arguments[0],r=arguments[1],u=arguments[2],p=new pe;return p.add(i),p.add(r),p.add(u),p}};var Hi=function(){this._inputPolys=null,this._geomFactory=null;var e=arguments[0];this._inputPolys=e,this._inputPolys===null&&(this._inputPolys=new pe)},Nx={STRTREE_NODE_CAPACITY:{configurable:!0}};Hi.prototype.reduceToGeometries=function(e){for(var t=this,n=new pe,i=e.iterator();i.hasNext();){var r=i.next(),u=null;We(r,Ns)?u=t.unionTree(r):r instanceof je&&(u=r),n.add(u)}return n};Hi.prototype.extractByEnvelope=function(e,t,n){for(var i=new pe,r=0;r<t.getNumGeometries();r++){var u=t.getGeometryN(r);u.getEnvelopeInternal().intersects(e)?i.add(u):n.add(u)}return this._geomFactory.buildGeometry(i)};Hi.prototype.unionOptimized=function(e,t){var n=e.getEnvelopeInternal(),i=t.getEnvelopeInternal();if(!n.intersects(i)){var r=Ho.combine(e,t);return r}if(e.getNumGeometries()<=1&&t.getNumGeometries()<=1)return this.unionActual(e,t);var u=n.intersection(i);return this.unionUsingEnvelopeIntersection(e,t,u)};Hi.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var e=new yx(Hi.STRTREE_NODE_CAPACITY),t=this._inputPolys.iterator();t.hasNext();){var n=t.next();e.insert(n.getEnvelopeInternal(),n)}this._inputPolys=null;var i=e.itemsTree(),r=this.unionTree(i);return r};Hi.prototype.binaryUnion=function(){if(arguments.length===1){var e=arguments[0];return this.binaryUnion(e,0,e.size())}else if(arguments.length===3){var t=arguments[0],n=arguments[1],i=arguments[2];if(i-n<=1){var r=Hi.getGeometry(t,n);return this.unionSafe(r,null)}else{if(i-n===2)return this.unionSafe(Hi.getGeometry(t,n),Hi.getGeometry(t,n+1));var u=Math.trunc((i+n)/2),p=this.binaryUnion(t,n,u),a=this.binaryUnion(t,u,i);return this.unionSafe(p,a)}}};Hi.prototype.repeatedUnion=function(e){for(var t=null,n=e.iterator();n.hasNext();){var i=n.next();t===null?t=i.copy():t=t.union(i)}return t};Hi.prototype.unionSafe=function(e,t){return e===null&&t===null?null:e===null?t.copy():t===null?e.copy():this.unionOptimized(e,t)};Hi.prototype.unionActual=function(e,t){return Hi.restrictToPolygons(e.union(t))};Hi.prototype.unionTree=function(e){var t=this.reduceToGeometries(e),n=this.binaryUnion(t);return n};Hi.prototype.unionUsingEnvelopeIntersection=function(e,t,n){var i=new pe,r=this.extractByEnvelope(n,e,i),u=this.extractByEnvelope(n,t,i),p=this.unionActual(r,u);i.add(p);var a=Ho.combine(i);return a};Hi.prototype.bufferUnion=function(){if(arguments.length===1){var e=arguments[0],t=e.get(0).getFactory(),n=t.buildGeometry(e),i=n.buffer(0);return i}else if(arguments.length===2){var r=arguments[0],u=arguments[1],p=r.getFactory(),a=p.createGeometryCollection([r,u]),_=a.buffer(0);return _}};Hi.prototype.interfaces_=function(){return[]};Hi.prototype.getClass=function(){return Hi};Hi.restrictToPolygons=function(e){if(We(e,Xl))return e;var t=pl.getPolygons(e);return t.size()===1?t.get(0):e.getFactory().createMultiPolygon(_n.toPolygonArray(t))};Hi.getGeometry=function(e,t){return t>=e.size()?null:e.get(t)};Hi.union=function(e){var t=new Hi(e);return t.union()};Nx.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties(Hi,Nx);var eg=function(){};eg.prototype.interfaces_=function(){return[]};eg.prototype.getClass=function(){return eg};eg.union=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return sn.createEmptyResult(sn.UNION,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),lo.overlayOp(e,t,sn.UNION)};function Wu(){return new ng}function ng(){this.reset()}ng.prototype={constructor:ng,reset:function(){this.s=this.t=0},add:function(e){m1(Am,e,this.t),m1(this,Am.s,this.s),this.s?this.t+=Am.t:this.s=Am.t},valueOf:function(){return this.s}};var Am=new ng;function m1(e,t,n){var i=e.s=t+n,r=i-t,u=i-r;e.t=t-u+(n-r)}var Li=1e-6,Kn=Math.PI,hl=Kn/2,g1=Kn/4,yl=Kn*2,Cu=180/Kn,$s=Kn/180,io=Math.abs,wC=Math.atan,Jh=Math.atan2,er=Math.cos,nr=Math.sin,up=Math.sqrt;function Dx(e){return e>1?0:e<-1?Kn:Math.acos(e)}function Pc(e){return e>1?hl:e<-1?-hl:Math.asin(e)}function Af(){}function ig(e,t){e&&y1.hasOwnProperty(e.type)&&y1[e.type](e,t)}var _1={Feature:function(e,t){ig(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)ig(n[i].geometry,t)}},y1={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){fy(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)fy(n[i],t,0)},Polygon:function(e,t){v1(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)v1(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)ig(n[i],t)}};function fy(e,t,n){var i=-1,r=e.length-n,u;for(t.lineStart();++i<r;)u=e[i],t.point(u[0],u[1],u[2]);t.lineEnd()}function v1(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)fy(e[n],t,1);t.polygonEnd()}function SC(e,t){e&&_1.hasOwnProperty(e.type)?_1[e.type](e,t):ig(e,t)}Wu();Wu();function dy(e){return[Jh(e[1],e[0]),Pc(e[2])]}function Qh(e){var t=e[0],n=e[1],i=er(n);return[i*er(t),i*nr(t),nr(n)]}function km(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function rg(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function X_(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Nm(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function my(e){var t=up(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}Wu();function Rx(e,t){function n(i,r){return i=e(i,r),t(i[0],i[1])}return e.invert&&t.invert&&(n.invert=function(i,r){return i=t.invert(i,r),i&&e.invert(i[0],i[1])}),n}function gy(e,t){return[e>Kn?e-yl:e<-Kn?e+yl:e,t]}gy.invert=gy;function EC(e,t,n){return(e%=yl)?t||n?Rx(x1(e),w1(t,n)):x1(e):t||n?w1(t,n):gy}function b1(e){return function(t,n){return t+=e,[t>Kn?t-yl:t<-Kn?t+yl:t,n]}}function x1(e){var t=b1(e);return t.invert=b1(-e),t}function w1(e,t){var n=er(e),i=nr(e),r=er(t),u=nr(t);function p(a,_){var x=er(_),S=er(a)*x,L=nr(a)*x,k=nr(_),D=k*n+S*i;return[Jh(L*r-D*u,S*n-k*i),Pc(D*r+L*u)]}return p.invert=function(a,_){var x=er(_),S=er(a)*x,L=nr(a)*x,k=nr(_),D=k*r-L*u;return[Jh(L*r+k*u,S*n+D*i),Pc(D*n-S*i)]},p}function IC(e,t,n,i,r,u){if(n){var p=er(t),a=nr(t),_=i*n;r==null?(r=t+i*yl,u=t-_/2):(r=S1(p,r),u=S1(p,u),(i>0?r<u:r>u)&&(r+=i*yl));for(var x,S=r;i>0?S>u:S<u;S-=_)x=dy([p,-a*er(S),-a*nr(S)]),e.point(x[0],x[1])}}function S1(e,t){t=Qh(t),t[0]-=e,my(t);var n=Dx(-t[1]);return((-t[2]<0?-n:n)+yl-Li)%yl}function Ox(){var e=[],t;return{point:function(n,i){t.push([n,i])},lineStart:function(){e.push(t=[])},lineEnd:Af,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function CC(e,t,n,i,r,u){var p=e[0],a=e[1],_=t[0],x=t[1],S=0,L=1,k=_-p,D=x-a,F;if(F=n-p,!(!k&&F>0)){if(F/=k,k<0){if(F<S)return;F<L&&(L=F)}else if(k>0){if(F>L)return;F>S&&(S=F)}if(F=r-p,!(!k&&F<0)){if(F/=k,k<0){if(F>L)return;F>S&&(S=F)}else if(k>0){if(F<S)return;F<L&&(L=F)}if(F=i-a,!(!D&&F>0)){if(F/=D,D<0){if(F<S)return;F<L&&(L=F)}else if(D>0){if(F>L)return;F>S&&(S=F)}if(F=u-a,!(!D&&F<0)){if(F/=D,D<0){if(F>L)return;F>S&&(S=F)}else if(D>0){if(F<S)return;F<L&&(L=F)}return S>0&&(e[0]=p+S*k,e[1]=a+S*D),L<1&&(t[0]=p+L*k,t[1]=a+L*D),!0}}}}}function Gm(e,t){return io(e[0]-t[0])<Li&&io(e[1]-t[1])<Li}function Dm(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function zx(e,t,n,i,r){var u=[],p=[],a,_;if(e.forEach(function(F){if(!((K=F.length-1)<=0)){var K,W=F[0],Q=F[K],U;if(Gm(W,Q)){for(r.lineStart(),a=0;a<K;++a)r.point((W=F[a])[0],W[1]);r.lineEnd();return}u.push(U=new Dm(W,F,null,!0)),p.push(U.o=new Dm(W,null,U,!1)),u.push(U=new Dm(Q,F,null,!1)),p.push(U.o=new Dm(Q,null,U,!0))}}),!!u.length){for(p.sort(t),E1(u),E1(p),a=0,_=p.length;a<_;++a)p[a].e=n=!n;for(var x=u[0],S,L;;){for(var k=x,D=!0;k.v;)if((k=k.n)===x)return;S=k.z,r.lineStart();do{if(k.v=k.o.v=!0,k.e){if(D)for(a=0,_=S.length;a<_;++a)r.point((L=S[a])[0],L[1]);else i(k.x,k.n.x,1,r);k=k.n}else{if(D)for(S=k.p.z,a=S.length-1;a>=0;--a)r.point((L=S[a])[0],L[1]);else i(k.x,k.p.x,-1,r);k=k.p}k=k.o,S=k.z,D=!D}while(!k.v);r.lineEnd()}}}function E1(e){if(t=e.length){for(var t,n=0,i=e[0],r;++n<t;)i.n=r=e[n],r.p=i,i=r;i.n=r=e[0],r.p=i}}function Fx(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function TC(e){return e.length===1&&(e=LC(e)),{left:function(t,n,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){var u=i+r>>>1;e(t[u],n)<0?i=u+1:r=u}return i},right:function(t,n,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){var u=i+r>>>1;e(t[u],n)>0?r=u:i=u+1}return i}}}function LC(e){return function(t,n){return Fx(e(t),n)}}TC(Fx);function Bx(e){for(var t=e.length,n,i=-1,r=0,u,p;++i<t;)r+=e[i].length;for(u=new Array(r);--t>=0;)for(p=e[t],n=p.length;--n>=0;)u[--r]=p[n];return u}var kf=1e9,Rm=-kf;function MC(e,t,n,i){function r(x,S){return e<=x&&x<=n&&t<=S&&S<=i}function u(x,S,L,k){var D=0,F=0;if(x==null||(D=p(x,L))!==(F=p(S,L))||_(x,S)<0^L>0)do k.point(D===0||D===3?e:n,D>1?i:t);while((D=(D+L+4)%4)!==F);else k.point(S[0],S[1])}function p(x,S){return io(x[0]-e)<Li?S>0?0:3:io(x[0]-n)<Li?S>0?2:1:io(x[1]-t)<Li?S>0?1:0:S>0?3:2}function a(x,S){return _(x.x,S.x)}function _(x,S){var L=p(x,1),k=p(S,1);return L!==k?L-k:L===0?S[1]-x[1]:L===1?x[0]-S[0]:L===2?x[1]-S[1]:S[0]-x[0]}return function(x){var S=x,L=Ox(),k,D,F,K,W,Q,U,X,Y,pt,gt,ct={point:ht,lineStart:dt,lineEnd:Jt,polygonStart:Et,polygonEnd:mt};function ht(Gt,Kt){r(Gt,Kt)&&S.point(Gt,Kt)}function rt(){for(var Gt=0,Kt=0,be=D.length;Kt<be;++Kt)for(var ce=D[Kt],$e=1,jn=ce.length,Ze=ce[0],ze,Ue,dn=Ze[0],Jn=Ze[1];$e<jn;++$e)ze=dn,Ue=Jn,Ze=ce[$e],dn=Ze[0],Jn=Ze[1],Ue<=i?Jn>i&&(dn-ze)*(i-Ue)>(Jn-Ue)*(e-ze)&&++Gt:Jn<=i&&(dn-ze)*(i-Ue)<(Jn-Ue)*(e-ze)&&--Gt;return Gt}function Et(){S=L,k=[],D=[],gt=!0}function mt(){var Gt=rt(),Kt=gt&&Gt,be=(k=Bx(k)).length;(Kt||be)&&(x.polygonStart(),Kt&&(x.lineStart(),u(null,null,1,x),x.lineEnd()),be&&zx(k,a,Gt,u,x),x.polygonEnd()),S=x,k=D=F=null}function dt(){ct.point=kt,D&&D.push(F=[]),pt=!0,Y=!1,U=X=NaN}function Jt(){k&&(kt(K,W),Q&&Y&&L.rejoin(),k.push(L.result())),ct.point=ht,Y&&S.lineEnd()}function kt(Gt,Kt){var be=r(Gt,Kt);if(D&&F.push([Gt,Kt]),pt)K=Gt,W=Kt,Q=be,pt=!1,be&&(S.lineStart(),S.point(Gt,Kt));else if(be&&Y)S.point(Gt,Kt);else{var ce=[U=Math.max(Rm,Math.min(kf,U)),X=Math.max(Rm,Math.min(kf,X))],$e=[Gt=Math.max(Rm,Math.min(kf,Gt)),Kt=Math.max(Rm,Math.min(kf,Kt))];CC(ce,$e,e,t,n,i)?(Y||(S.lineStart(),S.point(ce[0],ce[1])),S.point($e[0],$e[1]),be||S.lineEnd(),gt=!1):be&&(S.lineStart(),S.point(Gt,Kt),gt=!1)}U=Gt,X=Kt,Y=be}return ct}}var H_=Wu();function PC(e,t){var n=t[0],i=t[1],r=[nr(n),-er(n),0],u=0,p=0;H_.reset();for(var a=0,_=e.length;a<_;++a)if(S=(x=e[a]).length)for(var x,S,L=x[S-1],k=L[0],D=L[1]/2+g1,F=nr(D),K=er(D),W=0;W<S;++W,k=U,F=Y,K=pt,L=Q){var Q=x[W],U=Q[0],X=Q[1]/2+g1,Y=nr(X),pt=er(X),gt=U-k,ct=gt>=0?1:-1,ht=ct*gt,rt=ht>Kn,Et=F*Y;if(H_.add(Jh(Et*ct*nr(ht),K*pt+Et*er(ht))),u+=rt?gt+ct*yl:gt,rt^k>=n^U>=n){var mt=rg(Qh(L),Qh(Q));my(mt);var dt=rg(r,mt);my(dt);var Jt=(rt^gt>=0?-1:1)*Pc(dt[2]);(i>Jt||i===Jt&&(mt[0]||mt[1]))&&(p+=rt^gt>=0?1:-1)}}return(u<-Li||u<Li&&H_<-Li)^p&1}Wu();function I1(e){return e}Wu();Wu();var $h=1/0,og=$h,id=-$h,sg=id,C1={point:AC,lineStart:Af,lineEnd:Af,polygonStart:Af,polygonEnd:Af,result:function(){var e=[[$h,og],[id,sg]];return id=sg=-(og=$h=1/0),e}};function AC(e,t){e<$h&&($h=e),e>id&&(id=e),t<og&&(og=t),t>sg&&(sg=t)}Wu();function Vx(e,t,n,i){return function(r,u){var p=t(u),a=r.invert(i[0],i[1]),_=Ox(),x=t(_),S=!1,L,k,D,F={point:K,lineStart:Q,lineEnd:U,polygonStart:function(){F.point=X,F.lineStart=Y,F.lineEnd=pt,k=[],L=[]},polygonEnd:function(){F.point=K,F.lineStart=Q,F.lineEnd=U,k=Bx(k);var gt=PC(L,a);k.length?(S||(u.polygonStart(),S=!0),zx(k,NC,gt,n,u)):gt&&(S||(u.polygonStart(),S=!0),u.lineStart(),n(null,null,1,u),u.lineEnd()),S&&(u.polygonEnd(),S=!1),k=L=null},sphere:function(){u.polygonStart(),u.lineStart(),n(null,null,1,u),u.lineEnd(),u.polygonEnd()}};function K(gt,ct){var ht=r(gt,ct);e(gt=ht[0],ct=ht[1])&&u.point(gt,ct)}function W(gt,ct){var ht=r(gt,ct);p.point(ht[0],ht[1])}function Q(){F.point=W,p.lineStart()}function U(){F.point=K,p.lineEnd()}function X(gt,ct){D.push([gt,ct]);var ht=r(gt,ct);x.point(ht[0],ht[1])}function Y(){x.lineStart(),D=[]}function pt(){X(D[0][0],D[0][1]),x.lineEnd();var gt=x.clean(),ct=_.result(),ht,rt=ct.length,Et,mt,dt;if(D.pop(),L.push(D),D=null,!!rt){if(gt&1){if(mt=ct[0],(Et=mt.length-1)>0){for(S||(u.polygonStart(),S=!0),u.lineStart(),ht=0;ht<Et;++ht)u.point((dt=mt[ht])[0],dt[1]);u.lineEnd()}return}rt>1&&gt&2&&ct.push(ct.pop().concat(ct.shift())),k.push(ct.filter(kC))}}return F}}function kC(e){return e.length>1}function NC(e,t){return((e=e.x)[0]<0?e[1]-hl-Li:hl-e[1])-((t=t.x)[0]<0?t[1]-hl-Li:hl-t[1])}const T1=Vx(function(){return!0},DC,OC,[-Kn,-hl]);function DC(e){var t=NaN,n=NaN,i=NaN,r;return{lineStart:function(){e.lineStart(),r=1},point:function(u,p){var a=u>0?Kn:-Kn,_=io(u-t);io(_-Kn)<Li?(e.point(t,n=(n+p)/2>0?hl:-hl),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(a,n),e.point(u,n),r=0):i!==a&&_>=Kn&&(io(t-i)<Li&&(t-=i*Li),io(u-a)<Li&&(u-=a*Li),n=RC(t,n,u,p),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(a,n),r=0),e.point(t=u,n=p),i=a},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-r}}}function RC(e,t,n,i){var r,u,p=nr(e-n);return io(p)>Li?wC((nr(t)*(u=er(i))*nr(n)-nr(i)*(r=er(t))*nr(e))/(r*u*p)):(t+i)/2}function OC(e,t,n,i){var r;if(e==null)r=n*hl,i.point(-Kn,r),i.point(0,r),i.point(Kn,r),i.point(Kn,0),i.point(Kn,-r),i.point(0,-r),i.point(-Kn,-r),i.point(-Kn,0),i.point(-Kn,r);else if(io(e[0]-t[0])>Li){var u=e[0]<t[0]?Kn:-Kn;r=n*u/2,i.point(-u,r),i.point(0,r),i.point(u,r)}else i.point(t[0],t[1])}function zC(e,t){var n=er(e),i=n>0,r=io(n)>Li;function u(S,L,k,D){IC(D,e,t,k,S,L)}function p(S,L){return er(S)*er(L)>n}function a(S){var L,k,D,F,K;return{lineStart:function(){F=D=!1,K=1},point:function(W,Q){var U=[W,Q],X,Y=p(W,Q),pt=i?Y?0:x(W,Q):Y?x(W+(W<0?Kn:-Kn),Q):0;if(!L&&(F=D=Y)&&S.lineStart(),Y!==D&&(X=_(L,U),(!X||Gm(L,X)||Gm(U,X))&&(U[0]+=Li,U[1]+=Li,Y=p(U[0],U[1]))),Y!==D)K=0,Y?(S.lineStart(),X=_(U,L),S.point(X[0],X[1])):(X=_(L,U),S.point(X[0],X[1]),S.lineEnd()),L=X;else if(r&&L&&i^Y){var gt;!(pt&k)&&(gt=_(U,L,!0))&&(K=0,i?(S.lineStart(),S.point(gt[0][0],gt[0][1]),S.point(gt[1][0],gt[1][1]),S.lineEnd()):(S.point(gt[1][0],gt[1][1]),S.lineEnd(),S.lineStart(),S.point(gt[0][0],gt[0][1])))}Y&&(!L||!Gm(L,U))&&S.point(U[0],U[1]),L=U,D=Y,k=pt},lineEnd:function(){D&&S.lineEnd(),L=null},clean:function(){return K|(F&&D)<<1}}}function _(S,L,k){var D=Qh(S),F=Qh(L),K=[1,0,0],W=rg(D,F),Q=km(W,W),U=W[0],X=Q-U*U;if(!X)return!k&&S;var Y=n*Q/X,pt=-n*U/X,gt=rg(K,W),ct=Nm(K,Y),ht=Nm(W,pt);X_(ct,ht);var rt=gt,Et=km(ct,rt),mt=km(rt,rt),dt=Et*Et-mt*(km(ct,ct)-1);if(!(dt<0)){var Jt=up(dt),kt=Nm(rt,(-Et-Jt)/mt);if(X_(kt,ct),kt=dy(kt),!k)return kt;var Gt=S[0],Kt=L[0],be=S[1],ce=L[1],$e;Kt<Gt&&($e=Gt,Gt=Kt,Kt=$e);var jn=Kt-Gt,Ze=io(jn-Kn)<Li,ze=Ze||jn<Li;if(!Ze&&ce<be&&($e=be,be=ce,ce=$e),ze?Ze?be+ce>0^kt[1]<(io(kt[0]-Gt)<Li?be:ce):be<=kt[1]&&kt[1]<=ce:jn>Kn^(Gt<=kt[0]&&kt[0]<=Kt)){var Ue=Nm(rt,(-Et+Jt)/mt);return X_(Ue,ct),[kt,dy(Ue)]}}}function x(S,L){var k=i?e:Kn-e,D=0;return S<-k?D|=1:S>k&&(D|=2),L<-k?D|=4:L>k&&(D|=8),D}return Vx(p,a,u,i?[0,-e]:[-Kn,e-Kn])}function Ux(e){return function(t){var n=new _y;for(var i in e)n[i]=e[i];return n.stream=t,n}}function _y(){}_y.prototype={constructor:_y,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Gx(e,t,n){var i=t[1][0]-t[0][0],r=t[1][1]-t[0][1],u=e.clipExtent&&e.clipExtent();e.scale(150).translate([0,0]),u!=null&&e.clipExtent(null),SC(n,e.stream(C1));var p=C1.result(),a=Math.min(i/(p[1][0]-p[0][0]),r/(p[1][1]-p[0][1])),_=+t[0][0]+(i-a*(p[1][0]+p[0][0]))/2,x=+t[0][1]+(r-a*(p[1][1]+p[0][1]))/2;return u!=null&&e.clipExtent(u),e.scale(a*150).translate([_,x])}function FC(e,t,n){return Gx(e,[[0,0],t],n)}var L1=16,BC=er(30*$s);function M1(e,t){return+t?UC(e,t):VC(e)}function VC(e){return Ux({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function UC(e,t){function n(i,r,u,p,a,_,x,S,L,k,D,F,K,W){var Q=x-i,U=S-r,X=Q*Q+U*U;if(X>4*t&&K--){var Y=p+k,pt=a+D,gt=_+F,ct=up(Y*Y+pt*pt+gt*gt),ht=Pc(gt/=ct),rt=io(io(gt)-1)<Li||io(u-L)<Li?(u+L)/2:Jh(pt,Y),Et=e(rt,ht),mt=Et[0],dt=Et[1],Jt=mt-i,kt=dt-r,Gt=U*Jt-Q*kt;(Gt*Gt/X>t||io((Q*Jt+U*kt)/X-.5)>.3||p*k+a*D+_*F<BC)&&(n(i,r,u,p,a,_,mt,dt,rt,Y/=ct,pt/=ct,gt,K,W),W.point(mt,dt),n(mt,dt,rt,Y,pt,gt,x,S,L,k,D,F,K,W))}}return function(i){var r,u,p,a,_,x,S,L,k,D,F,K,W={point:Q,lineStart:U,lineEnd:Y,polygonStart:function(){i.polygonStart(),W.lineStart=pt},polygonEnd:function(){i.polygonEnd(),W.lineStart=U}};function Q(ht,rt){ht=e(ht,rt),i.point(ht[0],ht[1])}function U(){L=NaN,W.point=X,i.lineStart()}function X(ht,rt){var Et=Qh([ht,rt]),mt=e(ht,rt);n(L,k,S,D,F,K,L=mt[0],k=mt[1],S=ht,D=Et[0],F=Et[1],K=Et[2],L1,i),i.point(L,k)}function Y(){W.point=Q,i.lineEnd()}function pt(){U(),W.point=gt,W.lineEnd=ct}function gt(ht,rt){X(r=ht,rt),u=L,p=k,a=D,_=F,x=K,W.point=X}function ct(){n(L,k,S,D,F,K,u,p,r,a,_,x,L1,i),W.lineEnd=Y,Y()}return W}}var GC=Ux({point:function(e,t){this.stream.point(e*$s,t*$s)}});function qC(e){return jC(function(){return e})()}function jC(e){var t,n=150,i=480,r=250,u,p,a=0,_=0,x=0,S=0,L=0,k,D,F=null,K=T1,W=null,Q,U,X,Y=I1,pt=.5,gt=M1(mt,pt),ct,ht;function rt(kt){return kt=D(kt[0]*$s,kt[1]*$s),[kt[0]*n+u,p-kt[1]*n]}function Et(kt){return kt=D.invert((kt[0]-u)/n,(p-kt[1])/n),kt&&[kt[0]*Cu,kt[1]*Cu]}function mt(kt,Gt){return kt=t(kt,Gt),[kt[0]*n+u,p-kt[1]*n]}rt.stream=function(kt){return ct&&ht===kt?ct:ct=GC(K(k,gt(Y(ht=kt))))},rt.clipAngle=function(kt){return arguments.length?(K=+kt?zC(F=kt*$s,6*$s):(F=null,T1),Jt()):F*Cu},rt.clipExtent=function(kt){return arguments.length?(Y=kt==null?(W=Q=U=X=null,I1):MC(W=+kt[0][0],Q=+kt[0][1],U=+kt[1][0],X=+kt[1][1]),Jt()):W==null?null:[[W,Q],[U,X]]},rt.scale=function(kt){return arguments.length?(n=+kt,dt()):n},rt.translate=function(kt){return arguments.length?(i=+kt[0],r=+kt[1],dt()):[i,r]},rt.center=function(kt){return arguments.length?(a=kt[0]%360*$s,_=kt[1]%360*$s,dt()):[a*Cu,_*Cu]},rt.rotate=function(kt){return arguments.length?(x=kt[0]%360*$s,S=kt[1]%360*$s,L=kt.length>2?kt[2]%360*$s:0,dt()):[x*Cu,S*Cu,L*Cu]},rt.precision=function(kt){return arguments.length?(gt=M1(mt,pt=kt*kt),Jt()):up(pt)},rt.fitExtent=function(kt,Gt){return Gx(rt,kt,Gt)},rt.fitSize=function(kt,Gt){return FC(rt,kt,Gt)};function dt(){D=Rx(k=EC(x,S,L),t);var kt=t(a,_);return u=i-kt[0]*n,p=r+kt[1]*n,Jt()}function Jt(){return ct=ht=null,rt}return function(){return t=e.apply(this,arguments),rt.invert=t.invert&&Et,dt()}}function qx(e){return function(t,n){var i=er(t),r=er(n),u=e(i*r);return[u*r*nr(t),u*nr(n)]}}function jx(e){return function(t,n){var i=up(t*t+n*n),r=e(i),u=nr(r),p=er(r);return[Jh(t*u,i*p),Pc(i&&n*u/i)]}}var ZC=qx(function(e){return up(2/(1+e))});ZC.invert=jx(function(e){return 2*Pc(e/2)});var Zx=qx(function(e){return(e=Dx(e))&&e/nr(e)});Zx.invert=jx(function(e){return e});function WC(){return qC(Zx).scale(79.4188).clipAngle(180-.001)}function P1(e,t){return[e,t]}P1.invert=P1;function XC(e,t,n){n=n||{};var i=n.units||"kilometers",r=n.steps||8;if(!e)throw new Error("geojson is required");if(typeof n!="object")throw new Error("options must be an object");if(typeof r!="number")throw new Error("steps must be an number");if(t===void 0)throw new Error("radius is required");if(r<=0)throw new Error("steps must be greater than 0");var u=[];switch(e.type){case"GeometryCollection":return sx(e,function(p){var a=qm(p,t,i,r);a&&u.push(a)}),cy(u);case"FeatureCollection":return c1(e,function(p){var a=qm(p,t,i,r);a&&c1(a,function(_){_&&u.push(_)})}),cy(u)}return qm(e,t,i,r)}function qm(e,t,n,i){var r=e.properties||{},u=e.type==="Feature"?e.geometry:e;if(u.type==="GeometryCollection"){var p=[];return sx(e,function(K){var W=qm(K,t,n,i);W&&p.push(W)}),cy(p)}var a=HC(u),_={type:u.type,coordinates:Xx(u.coordinates,a)},x=new Ry,S=x.read(_),L=eC(nC(t,n),"meters"),k=Sr.bufferOp(S,L,i),D=new gx;if(k=D.write(k),!Wx(k.coordinates)){var F={type:k.type,coordinates:Hx(k.coordinates,a)};return _g(F,r)}}function Wx(e){return Array.isArray(e[0])?Wx(e[0]):isNaN(e[0])}function Xx(e,t){return typeof e[0]!="object"?t(e):e.map(function(n){return Xx(n,t)})}function Hx(e,t){return typeof e[0]!="object"?t.invert(e):e.map(function(n){return Hx(n,t)})}function HC(e){var t=rC(e).geometry.coordinates,n=[-t[0],-t[1]];return WC().rotate(n).scale(Xo)}function YC(e,t){var n=Km(e),i=Km(t),r=e.properties||{},u=ex.difference(n.coordinates,i.coordinates);return u.length===0?null:u.length===1?ix(u[0],r):rx(u,r)}function A1(e){let t;for(const n of e)t&&n[0]-t[0]>=180?n[0]-=360:t&&n[0]-t[0]<-180&&(n[0]+=360),t=n}function k1(e,t){const n=YC({type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]},e);if(!n)return;n.properties={isMask:"y"};const i=XC(e,0);if(i.geometry.type==="Polygon")for(const r of i.geometry.coordinates)A1(r);else for(const r of i.geometry.coordinates)for(const u of r)A1(u);t({type:"FeatureCollection",features:[i,n]})}let N1={type:"FeatureCollection",features:[]};function KC(e,t,n=!0,i=!0,r={},u={},p={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}}){let a,_=[],x,S;function L(){(p!=null&&p.fill||p!=null&&p.line)&&e.addSource("full-geom",{type:"geojson",data:N1}),p!=null&&p.fill&&e.addLayer({...p==null?void 0:p.fill,id:"full-geom-fill",type:"fill",source:"full-geom"}),p!=null&&p.line&&e.addLayer({...p==null?void 0:p.line,id:"full-geom-line",type:"line",source:"full-geom"})}e.loaded()?L():e.once("load",()=>{L()});const k=F=>{a==null||a({type:"mapClick",coordinates:[F.lngLat.lng,F.lngLat.lat]})};function D(F=!1){if(!t)throw new Error;const K=document.createElement("div");return F&&K.classList.add("marker-interactive"),new II({props:{displayIn:"maplibre"},target:K}),new t.Marker({element:K,offset:[1,-13]})}return{setEventHandler(F){F?(a=F,e.on("click",k)):(a=void 0,e.off("click",k))},flyTo(F,K){e.flyTo({center:F,zoom:K,...r})},fitBounds(F,K,W){e.fitBounds([[F[0],F[1]],[F[2],F[3]]],{padding:K,maxZoom:W,...u})},indicateReverse(F){e.getCanvasContainer().style.cursor=F?"crosshair":""},setReverseMarker(F){!t||!n||(S?F?S.setLngLat(F):(S.remove(),S=void 0):F&&(S=(typeof n=="object"?new t.Marker(n):D()).setLngLat(F).addTo(e),S.getElement().classList.add("marker-reverse")))},setMarkers(F,K){if(!n)return;function W(Q){var U;(U=e.getSource("full-geom"))==null||U.setData(Q)}for(const Q of _)Q.remove();if(_.length=0,W(N1),!!t){if(K){let Q=!1;if(K.geometry.type==="GeometryCollection"){const U=K.geometry.geometries.filter(X=>X.type==="Polygon"||X.type==="MultiPolygon");if(U.length>0){let X=U.pop();for(const Y of U)X=iC(X,Y);k1({...K,geometry:X},W),Q=!0}else{const X=K.geometry.geometries.filter(Y=>Y.type==="LineString"||Y.type==="MultiLineString");X.length>0&&(W({...K,geometry:{type:"GeometryCollection",geometries:X}}),Q=!0)}}if(!Q){if(K.geometry.type==="Polygon"||K.geometry.type==="MultiPolygon")k1(K,W);else if(K.geometry.type==="LineString"||K.geometry.type==="MultiLineString"){W(K);return}}n&&_.push((typeof n=="object"?new t.Marker(n):D()).setLngLat(K.center).addTo(e))}if(i)for(const Q of F??[]){if(Q===K)continue;const U=(typeof i=="object"?new t.Marker(i):D(!0)).setLngLat(Q.center).setPopup(new t.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(Q.place_type[0]==="reverse"?Q.place_name:Q.place_name.replace(/,.*/,""))).addTo(e),X=U.getElement();X.addEventListener("click",Y=>{Y.stopPropagation(),a==null||a({type:"markerClick",id:Q.id})}),X.addEventListener("mouseenter",()=>{a==null||a({type:"markerMouseEnter",id:Q.id}),U.togglePopup()}),X.addEventListener("mouseleave",()=>{a==null||a({type:"markerMouseLeave",id:Q.id}),U.togglePopup()}),_.push(U)}}},setSelectedMarker(F){x&&x.getElement().classList.toggle("marker-selected",!1),x=F>-1?_[F]:void 0,x==null||x.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const F=e.getCenter();return[e.getZoom(),F.lng,F.lat]}}}function JC(e){let t,n;return{c(){t=jl("svg"),n=jl("path"),Vt(n,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Vt(t,"viewBox","0 0 14 14"),Vt(t,"width","13"),Vt(t,"height","13"),Vt(t,"class","svelte-en2qvf")},m(i,r){Ot(i,t,r),vt(t,n)},p:Oe,i:Oe,o:Oe,d(i){i&&Rt(t)}}}class Yx extends cn{constructor(t){super(),un(this,t,null,JC,rn,{})}}function QC(e){let t,n;return{c(){t=jl("svg"),n=jl("path"),Vt(n,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Vt(t,"viewBox","0 0 30 30"),Vt(t,"fill","none"),Vt(t,"xmlns","http://www.w3.org/2000/svg"),Vt(t,"class","svelte-d2loi5")},m(i,r){Ot(i,t,r),vt(t,n)},p:Oe,i:Oe,o:Oe,d(i){i&&Rt(t)}}}class Kx extends cn{constructor(t){super(),un(this,t,null,QC,rn,{})}}function $C(e){let t,n;return{c(){t=Lt("img"),Br(t.src,n=e[3]+"area.svg")||Vt(t,"src",n),Vt(t,"alt",e[6]),Vt(t,"class","svelte-ltkwvy")},m(i,r){Ot(i,t,r)},p(i,r){r&8&&!Br(t.src,n=i[3]+"area.svg")&&Vt(t,"src",n),r&64&&Vt(t,"alt",i[6])},d(i){i&&Rt(t)}}}function tT(e){let t,n;return{c(){t=Lt("img"),Br(t.src,n=e[3]+"reverse.svg")||Vt(t,"src",n),Vt(t,"alt",e[6]),Vt(t,"class","svelte-ltkwvy")},m(i,r){Ot(i,t,r)},p(i,r){r&8&&!Br(t.src,n=i[3]+"reverse.svg")&&Vt(t,"src",n),r&64&&Vt(t,"alt",i[6])},d(i){i&&Rt(t)}}}function eT(e){let t,n;return{c(){t=Lt("img"),Br(t.src,n=e[3]+"poi.svg")||Vt(t,"src",n),Vt(t,"alt",e[6]),Vt(t,"class","svelte-ltkwvy")},m(i,r){Ot(i,t,r)},p(i,r){r&8&&!Br(t.src,n=i[3]+"poi.svg")&&Vt(t,"src",n),r&64&&Vt(t,"alt",i[6])},d(i){i&&Rt(t)}}}function nT(e){let t,n;return{c(){t=Lt("img"),Br(t.src,n=e[3]+"postal_code.svg")||Vt(t,"src",n),Vt(t,"alt",e[6]),Vt(t,"class","svelte-ltkwvy")},m(i,r){Ot(i,t,r)},p(i,r){r&8&&!Br(t.src,n=i[3]+"postal_code.svg")&&Vt(t,"src",n),r&64&&Vt(t,"alt",i[6])},d(i){i&&Rt(t)}}}function iT(e){let t,n;return{c(){t=Lt("img"),Br(t.src,n=e[3]+"street.svg")||Vt(t,"src",n),Vt(t,"alt",e[6]),Vt(t,"class","svelte-ltkwvy")},m(i,r){Ot(i,t,r)},p(i,r){r&8&&!Br(t.src,n=i[3]+"street.svg")&&Vt(t,"src",n),r&64&&Vt(t,"alt",i[6])},d(i){i&&Rt(t)}}}function rT(e){let t,n;return{c(){t=Lt("img"),Br(t.src,n=e[3]+"road.svg")||Vt(t,"src",n),Vt(t,"alt",e[6]),Vt(t,"class","svelte-ltkwvy")},m(i,r){Ot(i,t,r)},p(i,r){r&8&&!Br(t.src,n=i[3]+"road.svg")&&Vt(t,"src",n),r&64&&Vt(t,"alt",i[6])},d(i){i&&Rt(t)}}}function oT(e){let t,n;return{c(){t=Lt("img"),Br(t.src,n=e[3]+"housenumber.svg")||Vt(t,"src",n),Vt(t,"alt",e[6]),Vt(t,"class","svelte-ltkwvy")},m(i,r){Ot(i,t,r)},p(i,r){r&8&&!Br(t.src,n=i[3]+"housenumber.svg")&&Vt(t,"src",n),r&64&&Vt(t,"alt",i[6])},d(i){i&&Rt(t)}}}function sT(e){let t,n,i,r;return{c(){t=Lt("img"),Br(t.src,n=e[5])||Vt(t,"src",n),Vt(t,"alt",e[4]),Vt(t,"class","svelte-ltkwvy")},m(u,p){Ot(u,t,p),i||(r=Se(t,"error",e[14]),i=!0)},p(u,p){p&32&&!Br(t.src,n=u[5])&&Vt(t,"src",n),p&16&&Vt(t,"alt",u[4])},d(u){u&&Rt(t),i=!1,r()}}}function D1(e){let t,n;return{c(){t=Lt("span"),n=He(e[6]),Vt(t,"class","secondary svelte-ltkwvy")},m(i,r){Ot(i,t,r),vt(t,n)},p(i,r){r&64&&Yi(n,i[6])},d(i){i&&Rt(t)}}}function aT(e){var ct,ht;let t,n,i,r,u,p,a,_,x=(e[7]?e[0].place_name:e[0].place_name.replace(/,.*/,""))+"",S,L,k=e[2]==="always"||e[2]&&!e[0].address&&((ct=e[0].properties)==null?void 0:ct.kind)!=="road"&&((ht=e[0].properties)==null?void 0:ht.kind)!=="road_relation"&&!e[0].id.startsWith("address.")&&!e[0].id.startsWith("postal_code.")&&(!e[0].id.startsWith("poi.")||!e[5])&&!e[7],D,F,K=(e[7]?"":e[0].place_name.replace(/[^,]*,?\s*/,""))+"",W,Q,U;function X(rt,Et){var mt,dt;return Et&1&&(n=null),Et&1&&(i=null),Et&1&&(r=null),rt[5]?sT:rt[0].address?oT:((mt=rt[0].properties)==null?void 0:mt.kind)==="road"||((dt=rt[0].properties)==null?void 0:dt.kind)==="road_relation"?rT:(n==null&&(n=!!rt[0].id.startsWith("address.")),n?iT:(i==null&&(i=!!rt[0].id.startsWith("postal_code.")),i?nT:(r==null&&(r=!!rt[0].id.startsWith("poi.")),r?eT:rt[7]?tT:$C)))}let Y=X(e,-1),pt=Y(e),gt=k&&D1(e);return{c(){t=Lt("li"),pt.c(),u=te(),p=Lt("span"),a=Lt("span"),_=Lt("span"),S=He(x),L=te(),gt&&gt.c(),D=te(),F=Lt("span"),W=He(K),Vt(_,"class","primary svelte-ltkwvy"),Vt(a,"class","svelte-ltkwvy"),Vt(F,"class","line2 svelte-ltkwvy"),Vt(p,"class","texts svelte-ltkwvy"),Vt(t,"tabindex","0"),Vt(t,"data-selected",e[1]),Vt(t,"class","svelte-ltkwvy"),cl(t,"selected",e[1])},m(rt,Et){Ot(rt,t,Et),pt.m(t,null),vt(t,u),vt(t,p),vt(p,a),vt(a,_),vt(_,S),vt(a,L),gt&&gt.m(a,null),vt(p,D),vt(p,F),vt(F,W),Q||(U=[Se(t,"mouseenter",e[12]),Se(t,"focus",e[13])],Q=!0)},p(rt,[Et]){var mt,dt;Y===(Y=X(rt,Et))&&pt?pt.p(rt,Et):(pt.d(1),pt=Y(rt),pt&&(pt.c(),pt.m(t,u))),Et&1&&x!==(x=(rt[7]?rt[0].place_name:rt[0].place_name.replace(/,.*/,""))+"")&&Yi(S,x),Et&37&&(k=rt[2]==="always"||rt[2]&&!rt[0].address&&((mt=rt[0].properties)==null?void 0:mt.kind)!=="road"&&((dt=rt[0].properties)==null?void 0:dt.kind)!=="road_relation"&&!rt[0].id.startsWith("address.")&&!rt[0].id.startsWith("postal_code.")&&(!rt[0].id.startsWith("poi.")||!rt[5])&&!rt[7]),k?gt?gt.p(rt,Et):(gt=D1(rt),gt.c(),gt.m(a,null)):gt&&(gt.d(1),gt=null),Et&1&&K!==(K=(rt[7]?"":rt[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Yi(W,K),Et&2&&Vt(t,"data-selected",rt[1]),Et&2&&cl(t,"selected",rt[1])},i:Oe,o:Oe,d(rt){rt&&Rt(t),pt.d(),gt&&gt.d(),Q=!1,Xr(U)}}}function lT(e,t,n){var X;let i,r,{feature:u}=t,{selected:p=!1}=t,{showPlaceType:a}=t,{missingIconsCache:_}=t,{iconsBaseUrl:x}=t;const S=(X=u.properties)==null?void 0:X.categories;let L,k,D=0,F=u.place_type[0]==="reverse";function K(Y){k&&_.add(k),n(10,D++,D)}function W(Y){ui.call(this,e,Y)}function Q(Y){ui.call(this,e,Y)}const U=Y=>K(Y.currentTarget);return e.$$set=Y=>{"feature"in Y&&n(0,u=Y.feature),"selected"in Y&&n(1,p=Y.selected),"showPlaceType"in Y&&n(2,a=Y.showPlaceType),"missingIconsCache"in Y&&n(9,_=Y.missingIconsCache),"iconsBaseUrl"in Y&&n(3,x=Y.iconsBaseUrl)},e.$$.update=()=>{var Y,pt,gt,ct;if(e.$$.dirty&3640)do n(11,i--,i),n(4,L=S==null?void 0:S[i]),n(5,k=L?x+L.replace(/ /g,"_")+".svg":void 0);while(i>-1&&(!k||_.has(k)));e.$$.dirty&1&&n(6,r=u.id.startsWith("poi.")?(pt=(Y=u.properties)==null?void 0:Y.categories)==null?void 0:pt.join(", "):((ct=(gt=u.properties)==null?void 0:gt.place_type_name)==null?void 0:ct[0])??u.place_type[0])},n(11,i=(S==null?void 0:S.length)??0),[u,p,a,x,L,k,r,F,K,_,D,i,W,Q,U]}class uT extends cn{constructor(t){super(),un(this,t,lT,aT,rn,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function cT(e){let t;return{c(){t=Lt("div"),t.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Vt(t,"class","svelte-7cmwmc")},m(n,i){Ot(n,t,i)},p:Oe,i:Oe,o:Oe,d(n){n&&Rt(t)}}}class hT extends cn{constructor(t){super(),un(this,t,null,cT,rn,{})}}function pT(e){let t,n;return{c(){t=jl("svg"),n=jl("path"),Vt(n,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Vt(t,"viewBox","0 0 60.006 21.412"),Vt(t,"width","14"),Vt(t,"height","20"),Vt(t,"class","svelte-en2qvf")},m(i,r){Ot(i,t,r),vt(t,n)},p:Oe,i:Oe,o:Oe,d(i){i&&Rt(t)}}}class fT extends cn{constructor(t){super(),un(this,t,null,pT,rn,{})}}function dT(e){let t,n,i;return{c(){t=jl("svg"),n=jl("circle"),i=jl("path"),Vt(n,"cx","4.789"),Vt(n,"cy","4.787"),Vt(n,"r","3.85"),ul(n,"stroke-width","1.875"),ul(n,"fill","none"),Vt(i,"d","M12.063 12.063 7.635 7.635"),ul(i,"stroke-width","1.875"),ul(i,"stroke-linecap","round"),Vt(t,"xmlns","http://www.w3.org/2000/svg"),Vt(t,"width","13"),Vt(t,"height","13"),Vt(t,"viewBox","0 0 13 13"),Vt(t,"class","svelte-1bpbt60")},m(r,u){Ot(r,t,u),vt(t,n),vt(t,i)},p:Oe,i:Oe,o:Oe,d(r){r&&Rt(t)}}}class mT extends cn{constructor(t){super(),un(this,t,null,dT,rn,{})}}function gT(e,t,n){const i=t[1],r=t[0],u=i-r;return e===i&&n?e:((e-r)%u+u)%u+r}function R1(e){const t=[...e];return t[2]<t[0]&&(t[2]+=360),t}let xf;async function _T(e,t,n){const i=e==null?void 0:e.getCenterAndZoom();for(const r of t??[])if(!(i&&(r.minZoom!=null&&r.minZoom>i[0]||r.maxZoom!=null&&r.maxZoom<i[0]))){if(r.type==="fixed")return r.coordinates.join(",");t:if(r.type==="client-geolocation"){if(xf&&r.cachedLocationExpiry&&xf.time+r.cachedLocationExpiry>Date.now()){if(!xf.coords)break t;return xf.coords}let u;try{return u=await new Promise((p,a)=>{n.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(_=>{p([_.coords.longitude,_.coords.latitude].map(x=>x.toFixed(6)).join(","))},_=>{a(_)},r)}),u}catch{}finally{r.cachedLocationExpiry&&(xf={time:Date.now(),coords:u})}if(n.signal.aborted)return}if(r.type==="server-geolocation")return"ip";if(i&&r.type==="map-center")return i[1].toFixed(6)+","+i[2].toFixed(6)}}const O1=/(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?/i,z1=/(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?/i,F1=/(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?/i,B1=/(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?/i;function yT(e){if(!["DMS","DM","DD"].includes(e))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){if(e=="DD")return this.decimalCoordinates;const t=this.decimalCoordinates.split(",").map(p=>Number(p.trim()));let n=V1(t[0],e),i=V1(t[1],e);n.endsWith('.0"')&&i.endsWith('.0"')&&(n=n.replace(/\.0"$/,'"'),i=i.replace(/\.0"$/,'"'));const r=t[0]>=0?" N":" S",u=t[1]>=0?" E":" W";return`${n+r}, ${i+u}`}else throw new Error("no decimal coordinates to convert")}function V1(e,t){const n=Math.abs(e),i=Math.floor(n),r=(n-i)*60;if(t=="DM"){let a=vT(r,3).toFixed(3).padStart(6,"0");return`${i} ${a}'`}let u=Math.floor(r),p=((r-u)*60).toFixed(1).padStart(4,"0");return u=u.toString().padStart(2,"0"),`${i} ${u}' ${p}"`}function vT(e,t){const n=Math.pow(10,t);return Math.round((e+Number.EPSILON)*n)/n}function jy(e,t){t||(t=5),e=e.replace(/\s+/g," ").trim();let n=null,i=null,r="",u="",p=[],a=!1;if(O1.test(e))if(p=O1.exec(e),a=Om(p),a){if(n=p[2],i=p[6],n.includes(",")&&(n=n.replace(",",".")),i.includes(",")&&(i=i.replace(",",".")),Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");if(Number(Math.round(i))==Number(i))throw new Error("integer only coordinate provided");p[1]?(r=p[1],u=p[5]):p[4]&&(r=p[4],u=p[8])}else throw new Error("invalid decimal coordinate format");else if(z1.test(e))if(p=z1.exec(e),a=Om(p),a)n=Math.abs(parseInt(p[2])),p[4]&&(n+=p[4]/60),p[6]&&(n+=p[6].replace(",",".")/3600),parseInt(p[2])<0&&(n=-1*n),i=Math.abs(parseInt(p[9])),p[11]&&(i+=p[11]/60),p[13]&&(i+=p[13].replace(",",".")/3600),parseInt(p[9])<0&&(i=-1*i),p[1]?(r=p[1],u=p[8]):p[7]&&(r=p[7],u=p[14]);else throw new Error("invalid DMS coordinates format");else if(F1.test(e))if(p=F1.exec(e),a=Om(p),a)n=Math.abs(parseInt(p[2])),p[4]&&(n+=p[4]/60),p[6]&&(n+=p[6]/3600),parseInt(p[2])<0&&(n=-1*n),i=Math.abs(parseInt(p[10])),p[12]&&(i+=p[12]/60),p[14]&&(i+=p[14]/3600),parseInt(p[10])<0&&(i=-1*i),p[1]?(r=p[1],u=p[9]):p[8]&&(r=p[8],u=p[16]);else throw new Error("invalid DMS coordinates format");else if(B1.test(e))if(p=B1.exec(e),a=Om(p),a)n=Math.abs(parseInt(p[2])),p[4]&&(n+=p[4]/60),p[6]&&(n+=p[6]/3600),parseInt(p[2])<0&&(n=-1*n),i=Math.abs(parseInt(p[10])),p[12]&&(i+=p[12]/60),p[14]&&(i+=p[14]/3600),parseInt(p[10])<0&&(i=-1*i),p[1]?(r=p[1],u=p[9]):p[8]&&(r=p[8],u=p[16]);else throw new Error("invalid coordinates format");if(a){if(Math.abs(i)>=180)throw new Error("invalid longitude value");if(Math.abs(n)>=90)throw new Error("invalid latitude value");if((r||u)&&(!r||!u))throw new Error("invalid coordinates format");if(r&&r==u)throw new Error("invalid coordinates format");let _=/S|SOUTH/i;_.test(r)&&n>0&&(n=-1*n),_=/W|WEST/i,_.test(u)&&i>0&&(i=-1*i);const x=p[0].trim();let S,L;const k=/[,/;\u0020]/g,D=x.match(k);if(D==null){const W=Math.floor(e.length/2);S=x.substring(0,W).trim(),L=x.substring(W).trim()}else{let W;D.length%2==1?W=Math.floor(D.length/2):W=D.length/2-1;let Q=0;if(W==0)Q=x.indexOf(D[0]),S=x.substring(0,Q).trim(),L=x.substring(Q+1).trim();else{let U=0,X=0;for(;U<=W;)Q=x.indexOf(D[U],X),X=Q+1,U++;S=x.substring(0,Q).trim(),L=x.substring(Q+1).trim()}}const F=S.split(".");if(F.length==2&&F[1]==0&&F[1].length!=2)throw new Error("invalid coordinates format");const K=L.split(".");if(K.length==2&&K[1]==0&&K[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(S)||/^\d+$/.test(L))throw new Error("degree only coordinate/s provided");return isNaN(n)&&n.includes(",")&&(n=n.replace(",",".")),n=Number(Number(n).toFixed(t)),isNaN(i)&&i.includes(",")&&(i=i.replace(",",".")),i=Number(Number(i).toFixed(t)),Object.freeze({verbatimCoordinates:x,verbatimLatitude:S,verbatimLongitude:L,decimalLatitude:n,decimalLongitude:i,decimalCoordinates:`${n},${i}`,closeEnough:bT,toCoordinateFormat:yT})}else throw new Error("coordinates pattern match failed")}function Om(e){if(!isNaN(e[0]))return!1;const t=[...e];if(t.shift(),t.length%2>0)return!1;const n=/^[-+]?\d+([\.,]\d+)?$/,i=/[eastsouthnorthwest]+/i,r=t.length/2;for(let u=0;u<r;u++){const p=t[u],a=t[u+r],_=n.test(p)&&n.test(a),x=i.test(p)&&i.test(a),S=p==a;if(!(p==null&&a==null)){if(p==null||a==null)return!1;if(_||x||S)continue;return!1}}return!0}function U1(e,t){const n=Math.abs(e-t);return Number(n.toFixed(6))<=1e-5}function bT(e){if(e.includes(",")){const t=e.split(",");if(Number(t[0])==NaN||Number(t[1])==NaN)throw new Error("coords are not valid decimals");return U1(this.decimalLatitude,Number(t[0]))&&U1(this.decimalLongitude,t[1])}else throw new Error("coords being tested must be separated by a comma")}const xT=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});jy.to=xT;const wT=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],ST={decimalLatitude:40.123,decimalLongitude:-74.123},ET=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],IT=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222}];function CT(){const e=[];return wT.forEach(t=>{t.decimalLatitude?e.push(t):e.push({...t,...ST})}),[...e,...ET,...IT]}const TT=CT();jy.formats=TT.map(e=>e.verbatimCoordinates);const LT=jy;function G1(e,t,n){const i=e.slice();return i[81]=t[n],i[83]=n,i}function q1(e){let t,n;return t=new hT({}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function j1(e){let t,n,i,r,u;return n=new fT({}),{c(){t=Lt("button"),ee(n.$$.fragment),Vt(t,"type","button"),Vt(t,"title",e[9]),Vt(t,"class","svelte-zh3kmv"),cl(t,"active",e[0])},m(p,a){Ot(p,t,a),Qt(n,t,null),i=!0,r||(u=Se(t,"click",e[67]),r=!0)},p(p,a){(!i||a[0]&512)&&Vt(t,"title",p[9]),(!i||a[0]&1)&&cl(t,"active",p[0])},i(p){i||(Ct(n.$$.fragment,p),i=!0)},o(p){At(n.$$.fragment,p),i=!1},d(p){p&&Rt(t),$t(n),r=!1,u()}}}function MT(e){let t,n=[],i=new Map,r,u,p,a=aa(e[14]);const _=x=>x[81].id+(x[81].address?","+x[81].address:"");for(let x=0;x<a.length;x+=1){let S=G1(e,a,x),L=_(S);i.set(L,n[x]=Z1(L,S))}return{c(){t=Lt("ul");for(let x=0;x<n.length;x+=1)n[x].c();Vt(t,"class","svelte-zh3kmv")},m(x,S){Ot(x,t,S);for(let L=0;L<n.length;L+=1)n[L]&&n[L].m(t,null);r=!0,u||(p=[Se(t,"mouseleave",e[71]),Se(t,"blur",e[72])],u=!0)},p(x,S){S[0]&17880064&&(a=aa(x[14]),Bi(),n=PS(n,S,_,1,x,a,i,t,MS,Z1,null,G1),Vi())},i(x){if(!r){for(let S=0;S<a.length;S+=1)Ct(n[S]);r=!0}},o(x){for(let S=0;S<n.length;S+=1)At(n[S]);r=!1},d(x){x&&Rt(t);for(let S=0;S<n.length;S+=1)n[S].d();u=!1,Xr(p)}}}function PT(e){let t,n,i,r,u,p;return n=new Kx({}),{c(){t=Lt("div"),ee(n.$$.fragment),i=te(),r=Lt("div"),u=He(e[7]),Vt(r,"class","svelte-zh3kmv"),Vt(t,"class","no-results svelte-zh3kmv")},m(a,_){Ot(a,t,_),Qt(n,t,null),vt(t,i),vt(t,r),vt(r,u),p=!0},p(a,_){(!p||_[0]&128)&&Yi(u,a[7])},i(a){p||(Ct(n.$$.fragment,a),p=!0)},o(a){At(n.$$.fragment,a),p=!1},d(a){a&&Rt(t),$t(n)}}}function AT(e){let t="",n;return{c(){n=He(t)},m(i,r){Ot(i,n,r)},p:Oe,i:Oe,o:Oe,d(i){i&&Rt(n)}}}function kT(e){let t,n,i,r,u,p,a,_,x,S,L;return n=new Kx({}),_=new Yx({}),{c(){t=Lt("div"),ee(n.$$.fragment),i=te(),r=Lt("div"),u=He(e[6]),p=te(),a=Lt("button"),ee(_.$$.fragment),Vt(r,"class","svelte-zh3kmv"),Vt(a,"class","svelte-zh3kmv"),Vt(t,"class","error svelte-zh3kmv")},m(k,D){Ot(k,t,D),Qt(n,t,null),vt(t,i),vt(t,r),vt(r,u),vt(t,p),vt(t,a),Qt(_,a,null),x=!0,S||(L=Se(a,"click",e[68]),S=!0)},p(k,D){(!x||D[0]&64)&&Yi(u,k[6])},i(k){x||(Ct(n.$$.fragment,k),Ct(_.$$.fragment,k),x=!0)},o(k){At(n.$$.fragment,k),At(_.$$.fragment,k),x=!1},d(k){k&&Rt(t),$t(n),$t(_),S=!1,L()}}}function Z1(e,t){let n,i,r;function u(){return t[69](t[83])}function p(){return t[70](t[81])}return i=new uT({props:{feature:t[81],showPlaceType:t[10],selected:t[15]===t[83],missingIconsCache:t[20],iconsBaseUrl:t[12]}}),i.$on("mouseenter",u),i.$on("focus",p),{key:e,first:null,c(){n=bs(),ee(i.$$.fragment),this.first=n},m(a,_){Ot(a,n,_),Qt(i,a,_),r=!0},p(a,_){t=a;const x={};_[0]&16384&&(x.feature=t[81]),_[0]&1024&&(x.showPlaceType=t[10]),_[0]&49152&&(x.selected=t[15]===t[83]),_[0]&4096&&(x.iconsBaseUrl=t[12]),i.$set(x)},i(a){r||(Ct(i.$$.fragment,a),r=!0)},o(a){At(i.$$.fragment,a),r=!1},d(a){a&&Rt(n),$t(i,a)}}}function NT(e){let t,n,i,r,u,p,a,_,x,S,L,k,D,F,K,W,Q,U,X,Y,pt,gt=!1;u=new mT({}),L=new Yx({});let ct=e[19]&&q1(),ht=e[5]===!0&&j1(e);const rt=e[59].default,Et=Vr(rt,e,e[58],null),mt=[kT,AT,PT,MT],dt=[];function Jt(kt,Gt){var Kt,be;return kt[18]?0:kt[16]?((Kt=kt[14])==null?void 0:Kt.length)===0?2:kt[16]&&((be=kt[14])!=null&&be.length)?3:-1:1}return~(W=Jt(e))&&(Q=dt[W]=mt[W](e)),{c(){t=te(),n=Lt("form"),i=Lt("div"),r=Lt("button"),ee(u.$$.fragment),p=te(),a=Lt("input"),_=te(),x=Lt("div"),S=Lt("button"),ee(L.$$.fragment),k=te(),ct&&ct.c(),D=te(),ht&&ht.c(),F=te(),Et&&Et.c(),K=te(),Q&&Q.c(),Vt(r,"class","search-button svelte-zh3kmv"),Vt(r,"type","button"),Vt(a,"placeholder",e[8]),Vt(a,"aria-label",e[8]),Vt(a,"class","svelte-zh3kmv"),Vt(S,"type","button"),Vt(S,"title",e[3]),Vt(S,"class","svelte-zh3kmv"),Vt(x,"class","clear-button-container svelte-zh3kmv"),cl(x,"displayable",e[1]!==""),Vt(i,"class","input-group svelte-zh3kmv"),Vt(n,"tabindex","0"),Vt(n,"class",U=jm(e[2])+" svelte-zh3kmv"),cl(n,"can-collapse",e[4]&&e[1]==="")},m(kt,Gt){Ot(kt,t,Gt),Ot(kt,n,Gt),vt(n,i),vt(i,r),Qt(u,r,null),vt(i,p),vt(i,a),e[61](a),Vf(a,e[1]),vt(i,_),vt(i,x),vt(x,S),Qt(L,S,null),vt(x,k),ct&&ct.m(x,null),vt(i,D),ht&&ht.m(i,null),vt(i,F),Et&&Et.m(i,null),vt(n,K),~W&&dt[W].m(n,null),X=!0,Y||(pt=[Se(r,"click",e[60]),Se(a,"input",e[62]),Se(a,"focus",e[63]),Se(a,"blur",e[64]),Se(a,"keydown",e[22]),Se(a,"input",e[65]),Se(S,"click",e[66]),Se(n,"submit",xS(e[21]))],Y=!0)},p(kt,Gt){(!X||Gt[0]&256)&&Vt(a,"placeholder",kt[8]),(!X||Gt[0]&256)&&Vt(a,"aria-label",kt[8]),Gt[0]&2&&a.value!==kt[1]&&Vf(a,kt[1]),(!X||Gt[0]&8)&&Vt(S,"title",kt[3]),kt[19]?ct?Gt[0]&524288&&Ct(ct,1):(ct=q1(),ct.c(),Ct(ct,1),ct.m(x,null)):ct&&(Bi(),At(ct,1,1,()=>{ct=null}),Vi()),(!X||Gt[0]&2)&&cl(x,"displayable",kt[1]!==""),kt[5]===!0?ht?(ht.p(kt,Gt),Gt[0]&32&&Ct(ht,1)):(ht=j1(kt),ht.c(),Ct(ht,1),ht.m(i,F)):ht&&(Bi(),At(ht,1,1,()=>{ht=null}),Vi()),Et&&Et.p&&(!X||Gt[1]&134217728)&&Gr(Et,rt,kt,kt[58],X?Ur(rt,kt[58],Gt,null):qr(kt[58]),null);let Kt=W;W=Jt(kt),W===Kt?~W&&dt[W].p(kt,Gt):(Q&&(Bi(),At(dt[Kt],1,1,()=>{dt[Kt]=null}),Vi()),~W?(Q=dt[W],Q?Q.p(kt,Gt):(Q=dt[W]=mt[W](kt),Q.c()),Ct(Q,1),Q.m(n,null)):Q=null),(!X||Gt[0]&4&&U!==(U=jm(kt[2])+" svelte-zh3kmv"))&&Vt(n,"class",U),(!X||Gt[0]&22)&&cl(n,"can-collapse",kt[4]&&kt[1]==="")},i(kt){X||(Ct(gt),Ct(u.$$.fragment,kt),Ct(L.$$.fragment,kt),Ct(ct),Ct(ht),Ct(Et,kt),Ct(Q),X=!0)},o(kt){At(gt),At(u.$$.fragment,kt),At(L.$$.fragment,kt),At(ct),At(ht),At(Et,kt),At(Q),X=!1},d(kt){kt&&(Rt(t),Rt(n)),$t(u),e[61](null),$t(L),ct&&ct.d(),ht&&ht.d(),Et&&Et.d(kt),~W&&dt[W].d(),Y=!1,Xr(pt)}}}function DT(e,t,n){let i,{$$slots:r={},$$scope:u}=t,{class:p=void 0}=t,{apiKey:a}=t,{bbox:_=void 0}=t,{clearButtonTitle:x="clear"}=t,{clearOnBlur:S=!1}=t,{collapsed:L=!1}=t,{country:k=void 0}=t,{debounceSearch:D=200}=t,{enableReverse:F=!1}=t,{errorMessage:K="Something went wrong"}=t,{filter:W=()=>!0}=t,{flyTo:Q=!0}=t,{fuzzyMatch:U=!0}=t,{language:X=void 0}=t,{limit:Y=void 0}=t,{mapController:pt=void 0}=t,{minLength:gt=2}=t,{noResultsMessage:ct="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=t,{placeholder:ht="Search"}=t,{proximity:rt=[{type:"server-geolocation"}]}=t,{reverseActive:Et=F==="always"}=t,{reverseButtonTitle:mt="toggle reverse geocoding"}=t,{searchValue:dt=""}=t,{showFullGeometry:Jt=!0}=t,{showPlaceType:kt="ifNeeded"}=t,{showResultsWhileTyping:Gt=!0}=t,{selectFirst:Kt=!0}=t,{flyToSelected:be=!1}=t,{markerOnSelected:ce=!0}=t,{types:$e=void 0}=t,{excludeTypes:jn=!1}=t,{zoom:Ze=16}=t,{maxZoom:ze=18}=t,{apiUrl:Ue="https://api.maptiler.com/geocoding"}=t,{fetchParameters:dn={}}=t,{iconsBaseUrl:Jn="https://cdn.maptiler.com/maptiler-geocoding-control/v1.2.1/icons/"}=t,{adjustUrlQuery:Zn=q=>{}}=t;function re(){On.focus()}function Be(){On.blur()}function fn(q,ot=!0){n(1,dt=q),ot?(n(15,tn=-1),Ni()):(wo(),setTimeout(()=>{On.focus(),On.select()}))}function Un(){n(14,wt=void 0),n(55,Ve=void 0),n(15,tn=-1)}function ur(){n(54,De=[]),n(55,Ve=void 0)}let Ai=!1,wt,De,Ve,ki="",On,tn=-1,Gn,qt=[],mi,qi,In,en;const uo=new Set,or=ep();Ds(()=>{pt&&(pt.setEventHandler(void 0),pt.indicateReverse(!1),pt.setSelectedMarker(-1),pt.setMarkers(void 0,void 0))});function Ni(q){if(qi&&(clearTimeout(qi),qi=void 0),tn>-1&&wt)n(55,Ve=wt[tn]),n(1,dt=Ve.place_type[0]==="reverse"?Ve.place_name:Ve.place_name.replace(/,.*/,"")),n(18,Gn=void 0),n(54,De=void 0),n(15,tn=-1);else if(dt){const ot=q||!ii(dt);vn(dt,{exact:!0}).then(()=>{n(54,De=wt),n(55,Ve=void 0),ot&&gi()}).catch(St=>n(18,Gn=St))}}function ii(q){try{return LT(q,6)}catch{return!1}}async function vn(q,{byId:ot=!1,exact:St=!1}={}){n(18,Gn=void 0),mi==null||mi.abort();const _t=new AbortController;n(19,mi=_t);try{const it=ii(q),bt=new URLSearchParams;if(X!==void 0&&bt.set("language",Array.isArray(X)?X.join(","):X??""),$e&&bt.set("types",$e.join(",")),jn&&bt.set("excludeTypes",String(jn)),_&&bt.set("bbox",_.map(Pe=>Pe.toFixed(6)).join(",")),k&&bt.set("country",Array.isArray(k)?k.join(","):k),!ot&&!it){const Pe=await _T(pt,rt,_t);Pe&&bt.set("proximity",Pe),(St||!Gt)&&bt.set("autocomplete","false"),bt.set("fuzzyMatch",String(U))}Y!==void 0&&(!it||($e==null?void 0:$e.length)===1)&&bt.set("limit",String(Y)),bt.set("key",a),Zn(bt);const jt=Ue+"/"+encodeURIComponent(it?it.decimalLongitude+","+it.decimalLatitude:q)+".json?"+bt.toString();if(jt===ki){ot?(n(14,wt=void 0),n(55,Ve=qt[0])):n(14,wt=qt);return}ki=jt;const Zt=await fetch(jt,{signal:_t.signal,...dn});if(!Zt.ok)throw new Error(await Zt.text());const Xt=await Zt.json();or("response",{url:jt,featureCollection:Xt}),ot?(n(14,wt=void 0),n(55,Ve=Xt.features[0]),qt=[Ve]):(n(14,wt=Xt.features.filter(W)),it&&wt.unshift({type:"Feature",properties:{},id:"reverse_"+it.decimalLongitude+"_"+it.decimalLatitude,text:it.decimalLatitude+", "+it.decimalLongitude,place_name:it.decimalLatitude+", "+it.decimalLongitude,place_type:["reverse"],center:[it.decimalLongitude,it.decimalLatitude],bbox:[it.decimalLongitude,it.decimalLatitude,it.decimalLongitude,it.decimalLatitude],geometry:{type:"Point",coordinates:[it.decimalLongitude,it.decimalLatitude]}}),qt=wt,it&&On.focus())}catch(it){if(it&&typeof it=="object"&&"name"in it&&it.name==="AbortError")return;throw it}finally{_t===mi&&n(19,mi=void 0)}}function gi(){var St;if(!(De!=null&&De.length)||!Q)return;const q=[180,90,-180,-90],ot=!De.some(_t=>!_t.matching_text);for(const _t of De)if(ot||!_t.matching_text)for(const it of[0,1,2,3])q[it]=Math[it<2?"min":"max"](q[it],((St=_t.bbox)==null?void 0:St[it])??_t.center[it%2]);pt&&De.length>0&&(Ve&&q[0]===q[2]&&q[1]===q[3]?pt.flyTo(Ve.center,Ze):pt.fitBounds(R1(q),50,ze))}function wa(q){n(0,Et=F==="always"),n(14,wt=void 0),n(55,Ve=void 0),n(15,tn=-1),fn(q[1].toFixed(6)+", "+gT(q[0],[-180,180],!0).toFixed(6),!1)}function ae(q){if(!wt)return;let ot=q.key==="ArrowDown"?1:q.key==="ArrowUp"?-1:0;ot&&(tn===(Kt?0:-1)&&ot===-1&&n(15,tn=wt.length),n(15,tn+=ot),tn>=wt.length&&n(15,tn=-1),tn<0&&Kt&&n(15,tn=0),q.preventDefault())}function wo(q=!0){if(n(18,Gn=void 0),Gt){if(qi&&clearTimeout(qi),dt.length<gt)return;const ot=dt;qi=window.setTimeout(()=>{vn(ot).catch(St=>n(18,Gn=St))},q?D:0)}else n(14,wt=void 0),n(18,Gn=void 0)}function ri(q){n(55,Ve=q),n(1,dt=q.place_name),n(15,tn=-1)}const Sa=()=>On.focus();function Ss(q){yr[q?"unshift":"push"](()=>{On=q,n(17,On)})}function ue(){dt=this.value,n(1,dt),n(13,Ai),n(27,S)}const ln=()=>n(13,Ai=!0),Ke=()=>n(13,Ai=!1),Pr=()=>wo(),is=()=>{n(1,dt=""),On.focus()},on=()=>n(0,Et=!Et),Es=()=>n(18,Gn=void 0),st=q=>n(15,tn=q),B=q=>ri(q),G=()=>{Kt||n(15,tn=-1)},J=()=>{};return e.$$set=q=>{"class"in q&&n(2,p=q.class),"apiKey"in q&&n(25,a=q.apiKey),"bbox"in q&&n(26,_=q.bbox),"clearButtonTitle"in q&&n(3,x=q.clearButtonTitle),"clearOnBlur"in q&&n(27,S=q.clearOnBlur),"collapsed"in q&&n(4,L=q.collapsed),"country"in q&&n(28,k=q.country),"debounceSearch"in q&&n(29,D=q.debounceSearch),"enableReverse"in q&&n(5,F=q.enableReverse),"errorMessage"in q&&n(6,K=q.errorMessage),"filter"in q&&n(30,W=q.filter),"flyTo"in q&&n(31,Q=q.flyTo),"fuzzyMatch"in q&&n(32,U=q.fuzzyMatch),"language"in q&&n(33,X=q.language),"limit"in q&&n(34,Y=q.limit),"mapController"in q&&n(35,pt=q.mapController),"minLength"in q&&n(36,gt=q.minLength),"noResultsMessage"in q&&n(7,ct=q.noResultsMessage),"placeholder"in q&&n(8,ht=q.placeholder),"proximity"in q&&n(37,rt=q.proximity),"reverseActive"in q&&n(0,Et=q.reverseActive),"reverseButtonTitle"in q&&n(9,mt=q.reverseButtonTitle),"searchValue"in q&&n(1,dt=q.searchValue),"showFullGeometry"in q&&n(38,Jt=q.showFullGeometry),"showPlaceType"in q&&n(10,kt=q.showPlaceType),"showResultsWhileTyping"in q&&n(39,Gt=q.showResultsWhileTyping),"selectFirst"in q&&n(11,Kt=q.selectFirst),"flyToSelected"in q&&n(40,be=q.flyToSelected),"markerOnSelected"in q&&n(41,ce=q.markerOnSelected),"types"in q&&n(42,$e=q.types),"excludeTypes"in q&&n(43,jn=q.excludeTypes),"zoom"in q&&n(44,Ze=q.zoom),"maxZoom"in q&&n(45,ze=q.maxZoom),"apiUrl"in q&&n(46,Ue=q.apiUrl),"fetchParameters"in q&&n(47,dn=q.fetchParameters),"iconsBaseUrl"in q&&n(12,Jn=q.iconsBaseUrl),"adjustUrlQuery"in q&&n(48,Zn=q.adjustUrlQuery),"$$scope"in q&&n(58,u=q.$$scope)},e.$$.update=()=>{if(e.$$.dirty[0]&134225920&&setTimeout(()=>{n(16,In=Ai),S&&!Ai&&n(1,dt="")}),e.$$.dirty[0]&16386|e.$$.dirty[1]&32&&dt.length<gt&&(n(55,Ve=void 0),n(14,wt=void 0),n(18,Gn=void 0),n(54,De=wt)),e.$$.dirty[1]&16777344&&Jt&&Ve&&!Ve.address&&Ve.geometry.type==="Point"&&Ve.place_type[0]!=="reverse"&&vn(Ve.id,{byId:!0}).catch(q=>n(18,Gn=q)),e.$$.dirty[1]&50356241&&(pt&&Ve&&Ve.id!==en&&Q&&(!Ve.bbox||Ve.bbox[0]===Ve.bbox[2]&&Ve.bbox[1]===Ve.bbox[3]?pt.flyTo(Ve.center,Ve.id.startsWith("poi.")||Ve.id.startsWith("address.")?ze:Ze):pt.fitBounds(R1(Ve.bbox),50,ze),n(14,wt=void 0),n(54,De=void 0),n(15,tn=-1)),n(56,en=Ve==null?void 0:Ve.id)),e.$$.dirty[0]&18432&&Kt&&wt!=null&&wt.length&&n(15,tn=0),e.$$.dirty[0]&2050&&(Kt||n(15,tn=-1)),e.$$.dirty[0]&16384|e.$$.dirty[1]&8388608&&De!==wt&&n(54,De=void 0),e.$$.dirty[0]&81921|e.$$.dirty[1]&8388624&&pt&&pt.setEventHandler(q=>{switch(q.type){case"mapClick":Et&&wa(q.coordinates);break;case"markerClick":{const ot=wt==null?void 0:wt.find(St=>St.id===q.id);ot&&ri(ot)}break;case"markerMouseEnter":De&&n(15,tn=In?(wt==null?void 0:wt.findIndex(ot=>ot.id===q.id))??-1:-1);break;case"markerMouseLeave":De&&n(15,tn=-1);break}}),e.$$.dirty[0]&49152&&n(57,i=wt==null?void 0:wt[tn]),e.$$.dirty[1]&67133969&&pt&&i&&Q&&be&&pt.flyTo(i.center,i.id.startsWith("poi.")||i.id.startsWith("address.")?ze:Ze),e.$$.dirty[1]&1040&&(ce||pt==null||pt.setMarkers(void 0,void 0)),e.$$.dirty[1]&75498512&&pt&&ce&&!De&&(pt.setMarkers(i?[i]:void 0,void 0),pt.setSelectedMarker(i?0:-1)),e.$$.dirty[1]&25165840&&pt&&pt.setMarkers(De,Ve),e.$$.dirty[0]&32768|e.$$.dirty[1]&8388624&&De&&pt&&pt.setSelectedMarker(tn),e.$$.dirty[0]&2|e.$$.dirty[1]&16&&pt){const q=ii(dt);pt.setReverseMarker(q?[q.decimalLongitude,q.decimalLatitude]:void 0)}e.$$.dirty[1]&67108864&&or("select",i),e.$$.dirty[1]&16777216&&or("pick",Ve),e.$$.dirty[0]&81920&&or("optionsVisibilityChange",In&&!!wt),e.$$.dirty[0]&16384&&or("featuresListed",wt),e.$$.dirty[1]&8388608&&or("featuresMarked",De),e.$$.dirty[0]&1&&or("reverseToggle",Et),e.$$.dirty[0]&2&&or("queryChange",dt),e.$$.dirty[0]&1|e.$$.dirty[1]&16&&pt&&pt.indicateReverse(Et)},[Et,dt,p,x,L,F,K,ct,ht,mt,kt,Kt,Jn,Ai,wt,tn,In,On,Gn,mi,uo,Ni,ae,wo,ri,a,_,S,k,D,W,Q,U,X,Y,pt,gt,rt,Jt,Gt,be,ce,$e,jn,Ze,ze,Ue,dn,Zn,re,Be,fn,Un,ur,De,Ve,en,i,u,r,Sa,Ss,ue,ln,Ke,Pr,is,on,Es,st,B,G,J]}class RT extends cn{constructor(t){super(),un(this,t,DT,NT,rn,{class:2,apiKey:25,bbox:26,clearButtonTitle:3,clearOnBlur:27,collapsed:4,country:28,debounceSearch:29,enableReverse:5,errorMessage:6,filter:30,flyTo:31,fuzzyMatch:32,language:33,limit:34,mapController:35,minLength:36,noResultsMessage:7,placeholder:8,proximity:37,reverseActive:0,reverseButtonTitle:9,searchValue:1,showFullGeometry:38,showPlaceType:10,showResultsWhileTyping:39,selectFirst:11,flyToSelected:40,markerOnSelected:41,types:42,excludeTypes:43,zoom:44,maxZoom:45,apiUrl:46,fetchParameters:47,iconsBaseUrl:12,adjustUrlQuery:48,focus:49,blur:50,setQuery:51,clearList:52,clearMap:53},null,[-1,-1,-1])}get focus(){return this.$$.ctx[49]}get blur(){return this.$$.ctx[50]}get setQuery(){return this.$$.ctx[51]}get clearList(){return this.$$.ctx[52]}get clearMap(){return this.$$.ctx[53]}}const Jx=Ti({type:"FeatureCollection",features:[]}),OT=Ti(!0),Qx=Ti(0),zT=30;class FT{constructor(t,n){Wn(this,"map");Wn(this,"inner");Wn(this,"active");Wn(this,"eventListenersSuccess");Wn(this,"eventListenersUpdated");Wn(this,"eventListenersFailure");Wn(this,"onMouseMove",t=>{if(!this.active)return;const n=[t.point.x-zT,t.point.y],i=this.map.unproject(t.point).distanceTo(this.map.unproject(n));this.inner.onMouseMove(t.lngLat.lng,t.lngLat.lat,i)&&(this.redraw(),this.dataUpdated())});Wn(this,"onClick",()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())});Wn(this,"onDoubleClick",t=>{this.active&&(t.preventDefault(),this.inner.onClick(),this.finish())});Wn(this,"onDragStart",()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()});Wn(this,"onMouseUp",()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()});Wn(this,"onKeyDown",t=>{this.active&&t.key=="Escape"&&(t.stopPropagation(),this.cancel())});Wn(this,"onKeyPress",t=>{this.active&&t.target.tagName!="INPUT"&&(t.key=="Enter"?(t.stopPropagation(),this.finish()):t.key=="s"?(t.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):t.key=="z"&&t.ctrlKey&&this.undo())});this.map=t,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Wm(n),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(t){t.properties??(t.properties={}),this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),t.properties.waypoints||(t.properties.waypoints=[{lon:t.geometry.coordinates[0][0],lat:t.geometry.coordinates[0][1],snapped:!0},{lon:t.geometry.coordinates[t.geometry.coordinates.length-1][0],lat:t.geometry.coordinates[t.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(t.properties.waypoints),this.redraw()}editExistingArea(t){t.properties??(t.properties={}),this.active&&window.alert("Bug: editExistingArea called when tool is already active"),t.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(t.properties.waypoints),this.redraw()}addEventListenerSuccess(t){this.eventListenersSuccess.push(t)}addEventListenerUpdated(t){this.eventListenersUpdated.push(t)}addEventListenerFailure(t){this.eventListenersFailure.push(t)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let t=this.inner.toFinalFeature();if(t)for(let n of this.eventListenersSuccess)n(JSON.parse(t));else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(t){this.inner.setRouteConfig(t),this.redraw()}addSnappedWaypoint(t){this.inner.addSnappedWaypoint(t[0],t[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}redraw(){let t=JSON.parse(this.inner.renderGeojson());Jx.set(t),this.map.getCanvas().style.cursor=t.cursor,OT.set(t.snap_mode),Qx.set(t.undo_length)}dataUpdated(){let t=this.inner.toFinalFeature();if(t)for(let n of this.eventListenersUpdated)n(JSON.parse(t))}}const $x="MZEJTanw3WpxRvt7qDfo";let nu=Ti(null),Pu=Ti(""),ag=Ti(!0),yy=Ti(null),vy=Ti(null),ns=Ti(null),rd=Ti(null),lg=Ti(new fg.LngLat(0,0)),ug=Ti(new fg.LngLat(0,0)),gc=Ti(1),li=Ti({mode:"title"});function W1(e){let t,n,i;return n=new RT({props:{mapController:e[0],apiKey:$x}}),{c(){t=Lt("div"),ee(n.$$.fragment),Vt(t,"class","svelte-ixhnie")},m(r,u){Ot(r,t,u),Qt(n,t,null),i=!0},p(r,u){const p={};u&1&&(p.mapController=r[0]),n.$set(p)},i(r){i||(Ct(n.$$.fragment,r),i=!0)},o(r){At(n.$$.fragment,r),i=!1},d(r){r&&Rt(t),$t(n)}}}function BT(e){let t,n,i=e[0]&&W1(e);return{c(){i&&i.c(),t=bs()},m(r,u){i&&i.m(r,u),Ot(r,t,u),n=!0},p(r,[u]){r[0]?i?(i.p(r,u),u&1&&Ct(i,1)):(i=W1(r),i.c(),Ct(i,1),i.m(t.parentNode,t)):i&&(Bi(),At(i,1,1,()=>{i=null}),Vi())},i(r){n||(Ct(i),n=!0)},o(r){At(i),n=!1},d(r){r&&Rt(t),i&&i.d(r)}}}function VT(e,t,n){let i,r;return Ee(e,nu,u=>n(1,r=u)),e.$$.update=()=>{e.$$.dirty&2&&n(0,i=r?KC(r,Ps):null)},[i,r]}class UT extends cn{constructor(t){super(),un(this,t,VT,BT,rn,{})}}const GT=e=>({}),X1=e=>({}),qT=e=>({}),H1=e=>({});function jT(e){let t,n,i,r;const u=e[1].left,p=Vr(u,e,e[0],H1),a=e[1].main,_=Vr(a,e,e[0],X1);return{c(){t=Lt("div"),p&&p.c(),n=te(),i=Lt("div"),_&&_.c(),Vt(t,"class","left svelte-6kzmjs"),Vt(i,"class","main svelte-6kzmjs")},m(x,S){Ot(x,t,S),p&&p.m(t,null),Ot(x,n,S),Ot(x,i,S),_&&_.m(i,null),r=!0},p(x,[S]){p&&p.p&&(!r||S&1)&&Gr(p,u,x,x[0],r?Ur(u,x[0],S,qT):qr(x[0]),H1),_&&_.p&&(!r||S&1)&&Gr(_,a,x,x[0],r?Ur(a,x[0],S,GT):qr(x[0]),X1)},i(x){r||(Ct(p,x),Ct(_,x),r=!0)},o(x){At(p,x),At(_,x),r=!1},d(x){x&&(Rt(t),Rt(n),Rt(i)),p&&p.d(x),_&&_.d(x)}}}function ZT(e,t,n){let{$$slots:i={},$$scope:r}=t;return e.$$set=u=>{"$$scope"in u&&n(0,r=u.$$scope)},[r,i]}class WT extends cn{constructor(t){super(),un(this,t,ZT,jT,rn,{})}}function Y1(e){let t,n;return{c(){t=Lt("div"),n=He(e[0]),Vt(t,"class","svelte-1uuov7f")},m(i,r){Ot(i,t,r),vt(t,n)},p(i,r){r&1&&Yi(n,i[0])},d(i){i&&Rt(t)}}}function XT(e){let t,n=e[0]&&Y1(e);return{c(){n&&n.c(),t=bs()},m(i,r){n&&n.m(i,r),Ot(i,t,r)},p(i,[r]){i[0]?n?n.p(i,r):(n=Y1(i),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},i:Oe,o:Oe,d(i){i&&Rt(t),n&&n.d(i)}}}function HT(e,t,n){let{msg:i=null}=t;return e.$$set=r=>{"msg"in r&&n(0,i=r.msg)},[i]}class tw extends cn{constructor(t){super(),un(this,t,HT,XT,rn,{msg:0})}}const YT=e=>({dialog:e&1}),K1=e=>({dialog:e[0]});function KT(e){let t,n,i,r,u;const p=e[4].default,a=Vr(p,e,e[3],K1);return{c(){t=Lt("dialog"),n=Lt("div"),a&&a.c(),Vt(n,"class","svelte-4ltw9q"),t.open=!0,Vt(t,"class","svelte-4ltw9q")},m(_,x){Ot(_,t,x),vt(t,n),a&&a.m(n,null),e[6](t),i=!0,r||(u=[Se(window,"click",e[1]),Se(window,"keydown",e[2]),Se(t,"close",e[5])],r=!0)},p(_,[x]){a&&a.p&&(!i||x&9)&&Gr(a,p,_,_[3],i?Ur(p,_[3],x,YT):qr(_[3]),K1)},i(_){i||(Ct(a,_),i=!0)},o(_){At(a,_),i=!1},d(_){_&&Rt(t),a&&a.d(_),e[6](null),r=!1,Xr(u)}}}function JT(e,t,n){let{$$slots:i={},$$scope:r}=t,u;function p(S){u.open&&S.target==u&&u.close()}function a(S){(S.key=="Escape"||S.key=="Enter")&&(S.stopPropagation(),u.close())}function _(S){ui.call(this,e,S)}function x(S){yr[S?"unshift":"push"](()=>{u=S,n(0,u)})}return e.$$set=S=>{"$$scope"in S&&n(3,r=S.$$scope)},[u,p,a,r,i,_,x]}class ew extends cn{constructor(t){super(),un(this,t,JT,KT,rn,{})}}var Ao=63710088e-1,Zy={centimeters:Ao*100,centimetres:Ao*100,degrees:Ao/111325,feet:Ao*3.28084,inches:Ao*39.37,kilometers:Ao/1e3,kilometres:Ao/1e3,meters:Ao,metres:Ao,miles:Ao/1609.344,millimeters:Ao*1e3,millimetres:Ao*1e3,nauticalmiles:Ao/1852,radians:1,yards:Ao*1.0936},QT={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Ao,yards:1.0936133},by={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ya(e,t,n){n===void 0&&(n={});var i={type:"Feature"};return(n.id===0||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=t||{},i.geometry=e,i}function $T(e,t,n){switch(e){case"Point":return fs(t).geometry;case"LineString":return ia(t).geometry;case"Polygon":return Wy(t).geometry;case"MultiPoint":return iw(t).geometry;case"MultiLineString":return nw(t).geometry;case"MultiPolygon":return rw(t).geometry;default:throw new Error(e+" is invalid")}}function fs(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!cg(e[0])||!cg(e[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:e};return ya(i,t,n)}function tL(e,t,n){return n===void 0&&(n={}),Ac(e.map(function(i){return fs(i,t)}),n)}function Wy(e,t,n){n===void 0&&(n={});for(var i=0,r=e;i<r.length;i++){var u=r[i];if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var p=0;p<u[u.length-1].length;p++)if(u[u.length-1][p]!==u[0][p])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:e};return ya(a,t,n)}function eL(e,t,n){return n===void 0&&(n={}),Ac(e.map(function(i){return Wy(i,t)}),n)}function ia(e,t,n){if(n===void 0&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var i={type:"LineString",coordinates:e};return ya(i,t,n)}function nL(e,t,n){return n===void 0&&(n={}),Ac(e.map(function(i){return ia(i,t)}),n)}function Ac(e,t){t===void 0&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function nw(e,t,n){n===void 0&&(n={});var i={type:"MultiLineString",coordinates:e};return ya(i,t,n)}function iw(e,t,n){n===void 0&&(n={});var i={type:"MultiPoint",coordinates:e};return ya(i,t,n)}function rw(e,t,n){n===void 0&&(n={});var i={type:"MultiPolygon",coordinates:e};return ya(i,t,n)}function iL(e,t,n){n===void 0&&(n={});var i={type:"GeometryCollection",geometries:e};return ya(i,t,n)}function rL(e,t){if(t===void 0&&(t=0),t&&!(t>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,t||0);return Math.round(e*n)/n}function Xy(e,t){t===void 0&&(t="kilometers");var n=Zy[t];if(!n)throw new Error(t+" units is invalid");return e*n}function Pg(e,t){t===void 0&&(t="kilometers");var n=Zy[t];if(!n)throw new Error(t+" units is invalid");return e/n}function oL(e,t){return od(Pg(e,t))}function sL(e){var t=e%360;return t<0&&(t+=360),t}function od(e){var t=e%(2*Math.PI);return t*180/Math.PI}function ra(e){var t=e%360;return t*Math.PI/180}function aL(e,t,n){if(t===void 0&&(t="kilometers"),n===void 0&&(n="kilometers"),!(e>=0))throw new Error("length must be a positive number");return Xy(Pg(e,t),n)}function lL(e,t,n){if(t===void 0&&(t="meters"),n===void 0&&(n="kilometers"),!(e>=0))throw new Error("area must be a positive number");var i=by[t];if(!i)throw new Error("invalid original units");var r=by[n];if(!r)throw new Error("invalid final units");return e/i*r}function cg(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Hy(e){return!!e&&e.constructor===Object}function uL(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(t){if(!cg(t))throw new Error("bbox must only contain numbers")})}function cL(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}const hL=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:by,bearingToAzimuth:sL,convertArea:lL,convertLength:aL,degreesToRadians:ra,earthRadius:Ao,factors:Zy,feature:ya,featureCollection:Ac,geometry:$T,geometryCollection:iL,isNumber:cg,isObject:Hy,lengthToDegrees:oL,lengthToRadians:Pg,lineString:ia,lineStrings:nL,multiLineString:nw,multiPoint:iw,multiPolygon:rw,point:fs,points:tL,polygon:Wy,polygons:eL,radiansToDegrees:od,radiansToLength:Xy,round:rL,unitsFactors:QT,validateBBox:uL,validateId:cL},Symbol.toStringTag,{value:"Module"}));function sd(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function tp(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function ow(e,t,n){if(n===void 0&&(n={}),n.final===!0)return pL(e,t);var i=sd(e),r=sd(t),u=ra(i[0]),p=ra(r[0]),a=ra(i[1]),_=ra(r[1]),x=Math.sin(p-u)*Math.cos(_),S=Math.cos(a)*Math.sin(_)-Math.sin(a)*Math.cos(_)*Math.cos(p-u);return od(Math.atan2(x,S))}function pL(e,t){var n=ow(t,e);return n=(n+180)%360,n}function wf(e,t,n){n===void 0&&(n={});var i=sd(e),r=sd(t),u=ra(r[1]-i[1]),p=ra(r[0]-i[0]),a=ra(i[1]),_=ra(r[1]),x=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(p/2),2)*Math.cos(a)*Math.cos(_);return Xy(2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x)),n.units)}function J1(e,t,n,i){i===void 0&&(i={});var r=sd(e),u=ra(r[0]),p=ra(r[1]),a=ra(n),_=Pg(t,i.units),x=Math.asin(Math.sin(p)*Math.cos(_)+Math.cos(p)*Math.sin(_)*Math.cos(a)),S=u+Math.atan2(Math.sin(a)*Math.sin(_)*Math.cos(p),Math.cos(_)-Math.sin(p)*Math.sin(x)),L=od(S),k=od(x);return fs([L,k],i.properties)}function vd(e,t,n){if(e!==null)for(var i,r,u,p,a,_,x,S=0,L=0,k,D=e.type,F=D==="FeatureCollection",K=D==="Feature",W=F?e.features.length:1,Q=0;Q<W;Q++){x=F?e.features[Q].geometry:K?e.geometry:e,k=x?x.type==="GeometryCollection":!1,a=k?x.geometries.length:1;for(var U=0;U<a;U++){var X=0,Y=0;if(p=k?x.geometries[U]:x,p!==null){_=p.coordinates;var pt=p.type;switch(S=n&&(pt==="Polygon"||pt==="MultiPolygon")?1:0,pt){case null:break;case"Point":if(t(_,L,Q,X,Y)===!1)return!1;L++,X++;break;case"LineString":case"MultiPoint":for(i=0;i<_.length;i++){if(t(_[i],L,Q,X,Y)===!1)return!1;L++,pt==="MultiPoint"&&X++}pt==="LineString"&&X++;break;case"Polygon":case"MultiLineString":for(i=0;i<_.length;i++){for(r=0;r<_[i].length-S;r++){if(t(_[i][r],L,Q,X,Y)===!1)return!1;L++}pt==="MultiLineString"&&X++,pt==="Polygon"&&Y++}pt==="Polygon"&&X++;break;case"MultiPolygon":for(i=0;i<_.length;i++){for(Y=0,r=0;r<_[i].length;r++){for(u=0;u<_[i][r].length-S;u++){if(t(_[i][r][u],L,Q,X,Y)===!1)return!1;L++}Y++}X++}break;case"GeometryCollection":for(i=0;i<p.geometries.length;i++)if(vd(p.geometries[i],t,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function fL(e,t,n,i){var r=n;return vd(e,function(u,p,a,_,x){p===0&&n===void 0?r=u:r=t(r,u,p,a,_,x)},i),r}function sw(e,t){var n;switch(e.type){case"FeatureCollection":for(n=0;n<e.features.length&&t(e.features[n].properties,n)!==!1;n++);break;case"Feature":t(e.properties,0);break}}function dL(e,t,n){var i=n;return sw(e,function(r,u){u===0&&n===void 0?i=r:i=t(i,r,u)}),i}function hg(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var n=0;n<e.features.length&&t(e.features[n],n)!==!1;n++);}function mL(e,t,n){var i=n;return hg(e,function(r,u){u===0&&n===void 0?i=r:i=t(i,r,u)}),i}function gL(e){var t=[];return vd(e,function(n){t.push(n)}),t}function Yy(e,t){var n,i,r,u,p,a,_,x,S,L,k=0,D=e.type==="FeatureCollection",F=e.type==="Feature",K=D?e.features.length:1;for(n=0;n<K;n++){for(a=D?e.features[n].geometry:F?e.geometry:e,x=D?e.features[n].properties:F?e.properties:{},S=D?e.features[n].bbox:F?e.bbox:void 0,L=D?e.features[n].id:F?e.id:void 0,_=a?a.type==="GeometryCollection":!1,p=_?a.geometries.length:1,r=0;r<p;r++){if(u=_?a.geometries[r]:a,u===null){if(t(null,k,x,S,L)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(u,k,x,S,L)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<u.geometries.length;i++)if(t(u.geometries[i],k,x,S,L)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}k++}}function _L(e,t,n){var i=n;return Yy(e,function(r,u,p,a,_){u===0&&n===void 0?i=r:i=t(i,r,u,p,a,_)}),i}function cp(e,t){Yy(e,function(n,i,r,u,p){var a=n===null?null:n.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return t(ya(n,r,{bbox:u,id:p}),i,0)===!1?!1:void 0}var _;switch(a){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var x=0;x<n.coordinates.length;x++){var S=n.coordinates[x],L={type:_,coordinates:S};if(t(ya(L,r),i,x)===!1)return!1}})}function yL(e,t,n){var i=n;return cp(e,function(r,u,p){u===0&&p===0&&n===void 0?i=r:i=t(i,r,u,p)}),i}function aw(e,t){cp(e,function(n,i,r){var u=0;if(n.geometry){var p=n.geometry.type;if(!(p==="Point"||p==="MultiPoint")){var a,_=0,x=0,S=0;if(vd(n,function(L,k,D,F,K){if(a===void 0||i>_||F>x||K>S){a=L,_=i,x=F,S=K,u=0;return}var W=ia([a,L],n.properties);if(t(W,i,r,K,u)===!1)return!1;u++,a=L})===!1)return!1}}})}function vL(e,t,n){var i=n,r=!1;return aw(e,function(u,p,a,_,x){r===!1&&n===void 0?i=u:i=t(i,u,p,a,_,x),r=!0}),i}function lw(e,t){if(!e)throw new Error("geojson is required");cp(e,function(n,i,r){if(n.geometry!==null){var u=n.geometry.type,p=n.geometry.coordinates;switch(u){case"LineString":if(t(n,i,r,0,0)===!1)return!1;break;case"Polygon":for(var a=0;a<p.length;a++)if(t(ia(p[a],n.properties),i,r,a)===!1)return!1;break}}})}function bL(e,t,n){var i=n;return lw(e,function(r,u,p,a){u===0&&n===void 0?i=r:i=t(i,r,u,p,a)}),i}function xL(e,t){if(t=t||{},!Hy(t))throw new Error("options is invalid");var n=t.featureIndex||0,i=t.multiFeatureIndex||0,r=t.geometryIndex||0,u=t.segmentIndex||0,p=t.properties,a;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),p=p||e.features[n].properties,a=e.features[n].geometry;break;case"Feature":p=p||e.properties,a=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=e;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var _=a.coordinates;switch(a.type){case"Point":case"MultiPoint":return null;case"LineString":return u<0&&(u=_.length+u-1),ia([_[u],_[u+1]],p,t);case"Polygon":return r<0&&(r=_.length+r),u<0&&(u=_[r].length+u-1),ia([_[r][u],_[r][u+1]],p,t);case"MultiLineString":return i<0&&(i=_.length+i),u<0&&(u=_[i].length+u-1),ia([_[i][u],_[i][u+1]],p,t);case"MultiPolygon":return i<0&&(i=_.length+i),r<0&&(r=_[i].length+r),u<0&&(u=_[i][r].length-u-1),ia([_[i][r][u],_[i][r][u+1]],p,t)}throw new Error("geojson is invalid")}function wL(e,t){if(t=t||{},!Hy(t))throw new Error("options is invalid");var n=t.featureIndex||0,i=t.multiFeatureIndex||0,r=t.geometryIndex||0,u=t.coordIndex||0,p=t.properties,a;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),p=p||e.features[n].properties,a=e.features[n].geometry;break;case"Feature":p=p||e.properties,a=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=e;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var _=a.coordinates;switch(a.type){case"Point":return fs(_,p,t);case"MultiPoint":return i<0&&(i=_.length+i),fs(_[i],p,t);case"LineString":return u<0&&(u=_.length+u),fs(_[u],p,t);case"Polygon":return r<0&&(r=_.length+r),u<0&&(u=_[r].length+u),fs(_[r][u],p,t);case"MultiLineString":return i<0&&(i=_.length+i),u<0&&(u=_[i].length+u),fs(_[i][u],p,t);case"MultiPolygon":return i<0&&(i=_.length+i),r<0&&(r=_[i].length+r),u<0&&(u=_[i][r].length-u),fs(_[i][r][u],p,t)}throw new Error("geojson is invalid")}const SL=Object.freeze(Object.defineProperty({__proto__:null,coordAll:gL,coordEach:vd,coordReduce:fL,featureEach:hg,featureReduce:mL,findPoint:wL,findSegment:xL,flattenEach:cp,flattenReduce:yL,geomEach:Yy,geomReduce:_L,lineEach:lw,lineReduce:bL,propEach:sw,propReduce:dL,segmentEach:aw,segmentReduce:vL},Symbol.toStringTag,{value:"Module"}));function Q1(e){if(!e)throw new Error("geojson is required");var t=[];return cp(e,function(n){EL(n,t)}),Ac(t)}function EL(e,t){var n=[],i=e.geometry;if(i!==null){switch(i.type){case"Polygon":n=tp(i);break;case"LineString":n=[tp(i)]}n.forEach(function(r){var u=IL(r,e.properties);u.forEach(function(p){p.id=t.length,t.push(p)})})}}function IL(e,t){var n=[];return e.reduce(function(i,r){var u=ia([i,r],t);return u.bbox=CL(i,r),n.push(u),r}),n}function CL(e,t){var n=e[0],i=e[1],r=t[0],u=t[1],p=n<r?n:r,a=i<u?i:u,_=n>r?n:r,x=i>u?i:u;return[p,a,_,x]}var Ky={exports:{}},uw={exports:{}};(function(e,t){(function(n,i){e.exports=i()})(Gb,function(){function n(U,X,Y,pt,gt){(function ct(ht,rt,Et,mt,dt){for(;mt>Et;){if(mt-Et>600){var Jt=mt-Et+1,kt=rt-Et+1,Gt=Math.log(Jt),Kt=.5*Math.exp(2*Gt/3),be=.5*Math.sqrt(Gt*Kt*(Jt-Kt)/Jt)*(kt-Jt/2<0?-1:1),ce=Math.max(Et,Math.floor(rt-kt*Kt/Jt+be)),$e=Math.min(mt,Math.floor(rt+(Jt-kt)*Kt/Jt+be));ct(ht,rt,ce,$e,dt)}var jn=ht[rt],Ze=Et,ze=mt;for(i(ht,Et,rt),dt(ht[mt],jn)>0&&i(ht,Et,mt);Ze<ze;){for(i(ht,Ze,ze),Ze++,ze--;dt(ht[Ze],jn)<0;)Ze++;for(;dt(ht[ze],jn)>0;)ze--}dt(ht[Et],jn)===0?i(ht,Et,ze):i(ht,++ze,mt),ze<=rt&&(Et=ze+1),rt<=ze&&(mt=ze-1)}})(U,X,Y||0,pt||U.length-1,gt||r)}function i(U,X,Y){var pt=U[X];U[X]=U[Y],U[Y]=pt}function r(U,X){return U<X?-1:U>X?1:0}var u=function(U){U===void 0&&(U=9),this._maxEntries=Math.max(4,U),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function p(U,X,Y){if(!Y)return X.indexOf(U);for(var pt=0;pt<X.length;pt++)if(Y(U,X[pt]))return pt;return-1}function a(U,X){_(U,0,U.children.length,X,U)}function _(U,X,Y,pt,gt){gt||(gt=W(null)),gt.minX=1/0,gt.minY=1/0,gt.maxX=-1/0,gt.maxY=-1/0;for(var ct=X;ct<Y;ct++){var ht=U.children[ct];x(gt,U.leaf?pt(ht):ht)}return gt}function x(U,X){return U.minX=Math.min(U.minX,X.minX),U.minY=Math.min(U.minY,X.minY),U.maxX=Math.max(U.maxX,X.maxX),U.maxY=Math.max(U.maxY,X.maxY),U}function S(U,X){return U.minX-X.minX}function L(U,X){return U.minY-X.minY}function k(U){return(U.maxX-U.minX)*(U.maxY-U.minY)}function D(U){return U.maxX-U.minX+(U.maxY-U.minY)}function F(U,X){return U.minX<=X.minX&&U.minY<=X.minY&&X.maxX<=U.maxX&&X.maxY<=U.maxY}function K(U,X){return X.minX<=U.maxX&&X.minY<=U.maxY&&X.maxX>=U.minX&&X.maxY>=U.minY}function W(U){return{children:U,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Q(U,X,Y,pt,gt){for(var ct=[X,Y];ct.length;)if(!((Y=ct.pop())-(X=ct.pop())<=pt)){var ht=X+Math.ceil((Y-X)/pt/2)*pt;n(U,ht,X,Y,gt),ct.push(X,ht,ht,Y)}}return u.prototype.all=function(){return this._all(this.data,[])},u.prototype.search=function(U){var X=this.data,Y=[];if(!K(U,X))return Y;for(var pt=this.toBBox,gt=[];X;){for(var ct=0;ct<X.children.length;ct++){var ht=X.children[ct],rt=X.leaf?pt(ht):ht;K(U,rt)&&(X.leaf?Y.push(ht):F(U,rt)?this._all(ht,Y):gt.push(ht))}X=gt.pop()}return Y},u.prototype.collides=function(U){var X=this.data;if(!K(U,X))return!1;for(var Y=[];X;){for(var pt=0;pt<X.children.length;pt++){var gt=X.children[pt],ct=X.leaf?this.toBBox(gt):gt;if(K(U,ct)){if(X.leaf||F(U,ct))return!0;Y.push(gt)}}X=Y.pop()}return!1},u.prototype.load=function(U){if(!U||!U.length)return this;if(U.length<this._minEntries){for(var X=0;X<U.length;X++)this.insert(U[X]);return this}var Y=this._build(U.slice(),0,U.length-1,0);if(this.data.children.length)if(this.data.height===Y.height)this._splitRoot(this.data,Y);else{if(this.data.height<Y.height){var pt=this.data;this.data=Y,Y=pt}this._insert(Y,this.data.height-Y.height-1,!0)}else this.data=Y;return this},u.prototype.insert=function(U){return U&&this._insert(U,this.data.height-1),this},u.prototype.clear=function(){return this.data=W([]),this},u.prototype.remove=function(U,X){if(!U)return this;for(var Y,pt,gt,ct=this.data,ht=this.toBBox(U),rt=[],Et=[];ct||rt.length;){if(ct||(ct=rt.pop(),pt=rt[rt.length-1],Y=Et.pop(),gt=!0),ct.leaf){var mt=p(U,ct.children,X);if(mt!==-1)return ct.children.splice(mt,1),rt.push(ct),this._condense(rt),this}gt||ct.leaf||!F(ct,ht)?pt?(Y++,ct=pt.children[Y],gt=!1):ct=null:(rt.push(ct),Et.push(Y),Y=0,pt=ct,ct=ct.children[0])}return this},u.prototype.toBBox=function(U){return U},u.prototype.compareMinX=function(U,X){return U.minX-X.minX},u.prototype.compareMinY=function(U,X){return U.minY-X.minY},u.prototype.toJSON=function(){return this.data},u.prototype.fromJSON=function(U){return this.data=U,this},u.prototype._all=function(U,X){for(var Y=[];U;)U.leaf?X.push.apply(X,U.children):Y.push.apply(Y,U.children),U=Y.pop();return X},u.prototype._build=function(U,X,Y,pt){var gt,ct=Y-X+1,ht=this._maxEntries;if(ct<=ht)return a(gt=W(U.slice(X,Y+1)),this.toBBox),gt;pt||(pt=Math.ceil(Math.log(ct)/Math.log(ht)),ht=Math.ceil(ct/Math.pow(ht,pt-1))),(gt=W([])).leaf=!1,gt.height=pt;var rt=Math.ceil(ct/ht),Et=rt*Math.ceil(Math.sqrt(ht));Q(U,X,Y,Et,this.compareMinX);for(var mt=X;mt<=Y;mt+=Et){var dt=Math.min(mt+Et-1,Y);Q(U,mt,dt,rt,this.compareMinY);for(var Jt=mt;Jt<=dt;Jt+=rt){var kt=Math.min(Jt+rt-1,dt);gt.children.push(this._build(U,Jt,kt,pt-1))}}return a(gt,this.toBBox),gt},u.prototype._chooseSubtree=function(U,X,Y,pt){for(;pt.push(X),!X.leaf&&pt.length-1!==Y;){for(var gt=1/0,ct=1/0,ht=void 0,rt=0;rt<X.children.length;rt++){var Et=X.children[rt],mt=k(Et),dt=(Jt=U,kt=Et,(Math.max(kt.maxX,Jt.maxX)-Math.min(kt.minX,Jt.minX))*(Math.max(kt.maxY,Jt.maxY)-Math.min(kt.minY,Jt.minY))-mt);dt<ct?(ct=dt,gt=mt<gt?mt:gt,ht=Et):dt===ct&&mt<gt&&(gt=mt,ht=Et)}X=ht||X.children[0]}var Jt,kt;return X},u.prototype._insert=function(U,X,Y){var pt=Y?U:this.toBBox(U),gt=[],ct=this._chooseSubtree(pt,this.data,X,gt);for(ct.children.push(U),x(ct,pt);X>=0&&gt[X].children.length>this._maxEntries;)this._split(gt,X),X--;this._adjustParentBBoxes(pt,gt,X)},u.prototype._split=function(U,X){var Y=U[X],pt=Y.children.length,gt=this._minEntries;this._chooseSplitAxis(Y,gt,pt);var ct=this._chooseSplitIndex(Y,gt,pt),ht=W(Y.children.splice(ct,Y.children.length-ct));ht.height=Y.height,ht.leaf=Y.leaf,a(Y,this.toBBox),a(ht,this.toBBox),X?U[X-1].children.push(ht):this._splitRoot(Y,ht)},u.prototype._splitRoot=function(U,X){this.data=W([U,X]),this.data.height=U.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},u.prototype._chooseSplitIndex=function(U,X,Y){for(var pt,gt,ct,ht,rt,Et,mt,dt=1/0,Jt=1/0,kt=X;kt<=Y-X;kt++){var Gt=_(U,0,kt,this.toBBox),Kt=_(U,kt,Y,this.toBBox),be=(gt=Gt,ct=Kt,ht=void 0,rt=void 0,Et=void 0,mt=void 0,ht=Math.max(gt.minX,ct.minX),rt=Math.max(gt.minY,ct.minY),Et=Math.min(gt.maxX,ct.maxX),mt=Math.min(gt.maxY,ct.maxY),Math.max(0,Et-ht)*Math.max(0,mt-rt)),ce=k(Gt)+k(Kt);be<dt?(dt=be,pt=kt,Jt=ce<Jt?ce:Jt):be===dt&&ce<Jt&&(Jt=ce,pt=kt)}return pt||Y-X},u.prototype._chooseSplitAxis=function(U,X,Y){var pt=U.leaf?this.compareMinX:S,gt=U.leaf?this.compareMinY:L;this._allDistMargin(U,X,Y,pt)<this._allDistMargin(U,X,Y,gt)&&U.children.sort(pt)},u.prototype._allDistMargin=function(U,X,Y,pt){U.children.sort(pt);for(var gt=this.toBBox,ct=_(U,0,X,gt),ht=_(U,Y-X,Y,gt),rt=D(ct)+D(ht),Et=X;Et<Y-X;Et++){var mt=U.children[Et];x(ct,U.leaf?gt(mt):mt),rt+=D(ct)}for(var dt=Y-X-1;dt>=X;dt--){var Jt=U.children[dt];x(ht,U.leaf?gt(Jt):Jt),rt+=D(ht)}return rt},u.prototype._adjustParentBBoxes=function(U,X,Y){for(var pt=Y;pt>=0;pt--)x(X[pt],U)},u.prototype._condense=function(U){for(var X=U.length-1,Y=void 0;X>=0;X--)U[X].children.length===0?X>0?(Y=U[X-1].children).splice(Y.indexOf(U[X]),1):this.clear():a(U[X],this.toBBox)},u})})(uw);var TL=uw.exports;const LL=jb(hL),cw=jb(SL);var Jy={};Object.defineProperty(Jy,"__esModule",{value:!0});var ML=cw;function xy(e){var t=[1/0,1/0,-1/0,-1/0];return ML.coordEach(e,function(n){t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}xy.default=xy;Jy.default=xy;var rl=TL,hw=LL,pw=cw,Ih=Jy.default,PL=pw.featureEach;pw.coordEach;hw.polygon;var $1=hw.featureCollection;function fw(e){var t=new rl(e);return t.insert=function(n){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:Ih(n),rl.prototype.insert.call(this,n)},t.load=function(n){var i=[];return Array.isArray(n)?n.forEach(function(r){if(r.type!=="Feature")throw new Error("invalid features");r.bbox=r.bbox?r.bbox:Ih(r),i.push(r)}):PL(n,function(r){if(r.type!=="Feature")throw new Error("invalid features");r.bbox=r.bbox?r.bbox:Ih(r),i.push(r)}),rl.prototype.load.call(this,i)},t.remove=function(n,i){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:Ih(n),rl.prototype.remove.call(this,n,i)},t.clear=function(){return rl.prototype.clear.call(this)},t.search=function(n){var i=rl.prototype.search.call(this,this.toBBox(n));return $1(i)},t.collides=function(n){return rl.prototype.collides.call(this,this.toBBox(n))},t.all=function(){var n=rl.prototype.all.call(this);return $1(n)},t.toJSON=function(){return rl.prototype.toJSON.call(this)},t.fromJSON=function(n){return rl.prototype.fromJSON.call(this,n)},t.toBBox=function(n){var i;if(n.bbox)i=n.bbox;else if(Array.isArray(n)&&n.length===4)i=n;else if(Array.isArray(n)&&n.length===6)i=[n[0],n[1],n[3],n[4]];else if(n.type==="Feature")i=Ih(n);else if(n.type==="FeatureCollection")i=Ih(n);else throw new Error("invalid geojson");return{minX:i[0],minY:i[1],maxX:i[2],maxY:i[3]}},t}Ky.exports=fw;Ky.exports.default=fw;var AL=Ky.exports;const kL=qb(AL);function NL(e,t){var n={},i=[];if(e.type==="LineString"&&(e=ya(e)),t.type==="LineString"&&(t=ya(t)),e.type==="Feature"&&t.type==="Feature"&&e.geometry!==null&&t.geometry!==null&&e.geometry.type==="LineString"&&t.geometry.type==="LineString"&&e.geometry.coordinates.length===2&&t.geometry.coordinates.length===2){var r=tb(e,t);return r&&i.push(r),Ac(i)}var u=kL();return u.load(Q1(t)),hg(Q1(e),function(p){hg(u.search(p),function(a){var _=tb(p,a);if(_){var x=tp(_).join(",");n[x]||(n[x]=!0,i.push(_))}})}),Ac(i)}function tb(e,t){var n=tp(e),i=tp(t);if(n.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(i.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var r=n[0][0],u=n[0][1],p=n[1][0],a=n[1][1],_=i[0][0],x=i[0][1],S=i[1][0],L=i[1][1],k=(L-x)*(p-r)-(S-_)*(a-u),D=(S-_)*(u-x)-(L-x)*(r-_),F=(p-r)*(u-x)-(a-u)*(r-_);if(k===0)return null;var K=D/k,W=F/k;if(K>=0&&K<=1&&W>=0&&W<=1){var Q=r+K*(p-r),U=u+K*(a-u);return fs([Q,U])}return null}function DL(e,t,n){n===void 0&&(n={});var i=fs([1/0,1/0],{dist:1/0}),r=0;return cp(e,function(u){for(var p=tp(u),a=0;a<p.length-1;a++){var _=fs(p[a]);_.properties.dist=wf(t,_,n);var x=fs(p[a+1]);x.properties.dist=wf(t,x,n);var S=wf(_,x,n),L=Math.max(_.properties.dist,x.properties.dist),k=ow(_,x),D=J1(t,L,k+90,n),F=J1(t,L,k-90,n),K=NL(ia([D.geometry.coordinates,F.geometry.coordinates]),ia([_.geometry.coordinates,x.geometry.coordinates])),W=null;K.features.length>0&&(W=K.features[0],W.properties.dist=wf(t,W,n),W.properties.location=r+wf(_,W,n)),_.properties.dist<i.properties.dist&&(i=_,i.properties.index=a,i.properties.location=r),x.properties.dist<i.properties.dist&&(i=x,i.properties.index=a+1,i.properties.location=r+S),W&&W.properties.dist<i.properties.dist&&(i=W,i.properties.index=a),r+=S}}),i}const dw=Ti({type:"FeatureCollection",features:[]}),mw=Ti(0),RL=100;class OL{constructor(t){Wn(this,"map");Wn(this,"active");Wn(this,"eventListenersSuccess");Wn(this,"eventListenersUpdated");Wn(this,"eventListenersFailure");Wn(this,"points");Wn(this,"cursor");Wn(this,"hover");Wn(this,"dragFrom");Wn(this,"previousStates");Wn(this,"onMouseMove",t=>{if(this.active&&!this.dragFrom)this.recalculateHovering(t);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let n=this.dragFrom[0]-t.lngLat.lng,i=this.dragFrom[1]-t.lngLat.lat;for(let r of this.points)r[0]-=n,r[1]-=i}else this.points[this.hover]=t.lngLat.toArray();this.dragFrom=t.lngLat.toArray(),this.redraw()}});Wn(this,"onClick",t=>{if(this.beforeUpdate(),this.active&&this.cursor){let n=[];if(eb(this.points).forEach((i,r)=>{n.push([r+1,DL(i,this.cursor).properties.dist])}),n.sort((i,r)=>i[1]-r[1]),n.length>0){let i=n[0][0];this.points.splice(i,0,this.cursor.geometry.coordinates),this.hover=i}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(t))});Wn(this,"onDoubleClick",t=>{this.active&&(t.preventDefault(),this.cursor=Y_(t.lngLat.toArray()),this.onClick(t),this.finish())});Wn(this,"onMouseDown",t=>{this.active&&!this.dragFrom&&this.hover!=null&&(t.preventDefault(),this.cursor=null,this.dragFrom=t.lngLat.toArray(),this.beforeUpdate(),this.redraw())});Wn(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});Wn(this,"onKeypress",t=>{this.active&&(t.key=="Enter"?(t.stopPropagation(),this.finish()):t.key=="z"&&t.ctrlKey&&this.undo())});Wn(this,"onKeyDown",t=>{this.active&&t.key=="Escape"&&(t.stopPropagation(),this.cancel())});this.map=t,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let t=this.polygonFeature();if(t)for(let n of this.eventListenersSuccess)n(t);else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){for(let t of this.eventListenersFailure)t();this.stop()}addEventListenerSuccess(t){this.eventListenersSuccess.push(t)}addEventListenerUpdated(t){this.eventListenersUpdated.push(t)}addEventListenerFailure(t){this.eventListenersFailure.push(t)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(t){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(t.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let t={type:"FeatureCollection",features:[]};this.points.forEach((r,u)=>{let p=Y_(r);p.properties.hover=this.hover==u,p.properties.idx=u,t.features.push(p)}),t.features=t.features.concat(eb(this.points));let n=this.polygonFeature();n&&(n.properties.hover=this.hover=="polygon",t.features.push(n)),dw.set(t);let i="crosshair";this.hover!=null&&(i=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=i,mw.set(this.previousStates.length)}pointsUpdated(){let t=this.polygonFeature();if(t)for(let n of this.eventListenersUpdated)n(t)}recalculateHovering(t){this.cursor=null,this.hover=null;for(let n of this.map.queryRenderedFeatures(t.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(n.geometry.type=="Polygon"){this.hover="polygon";break}else if(n.geometry.type=="Point"&&Object.hasOwn(n.properties,"idx")){this.hover=n.properties.idx;break}this.hover==null&&(this.cursor=Y_(t.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let t=this.points.map(vw),n=[JSON.parse(JSON.stringify(t))];return n[0].push(JSON.parse(JSON.stringify(n[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:n},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>RL&&this.previousStates.shift()}}function eb(e){let t=[];for(let n=0;n<e.length-1;n++)t.push({type:"Feature",geometry:{type:"LineString",coordinates:[e[n],e[n+1]]},properties:{}});return e.length>=3&&t.push({type:"Feature",geometry:{type:"LineString",coordinates:[e[e.length-1],e[0]]},properties:{}}),t}function zL(e){let t,n,i;return{c(){t=He("Undo ("),n=He(e[1]),i=He(")")},m(r,u){Ot(r,t,u),Ot(r,n,u),Ot(r,i,u)},p(r,u){u&2&&Yi(n,r[1])},d(r){r&&(Rt(t),Rt(n),Rt(i))}}}function FL(e){let t;return{c(){t=He("Undo")},m(n,i){Ot(n,t,i)},p:Oe,d(n){n&&Rt(t)}}}function BL(e){let t,n,i,r,u,p;function a(S,L){return S[1]==0?FL:zL}let _=a(e),x=_(e);return{c(){t=Lt("button"),x.c(),i=te(),r=Lt("ul"),r.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,t.disabled=n=e[1]==0},m(S,L){Ot(S,t,L),x.m(t,null),Ot(S,i,L),Ot(S,r,L),u||(p=Se(t,"click",e[2]),u=!0)},p(S,[L]){_===(_=a(S))&&x?x.p(S,L):(x.d(1),x=_(S),x&&(x.c(),x.m(t,null))),L&2&&n!==(n=S[1]==0)&&(t.disabled=n)},i:Oe,o:Oe,d(S){S&&(Rt(t),Rt(i),Rt(r)),x.d(),u=!1,p()}}}function VL(e,t,n){let i;Ee(e,mw,p=>n(1,i=p));let{polygonTool:r}=t;const u=()=>r.undo();return e.$$set=p=>{"polygonTool"in p&&n(0,r=p.polygonTool)},[r,i,u]}class UL extends cn{constructor(t){super(),un(this,t,VL,BL,rn,{polygonTool:0})}}function GL(e){let t,n,i,r,u,p,a,_,x;return{c(){t=Lt("div"),n=Lt("button"),n.textContent="Import current view",i=te(),r=Lt("i"),r.textContent="or...",u=te(),p=Lt("div"),a=Lt("button"),a.textContent="Draw an area to import on the map",Vt(n,"type","button"),Vt(a,"type","button")},m(S,L){Ot(S,t,L),vt(t,n),Ot(S,i,L),Ot(S,r,L),Ot(S,u,L),Ot(S,p,L),vt(p,a),_||(x=[Se(n,"click",e[1]),Se(a,"click",e[2])],_=!0)},p:Oe,i:Oe,o:Oe,d(S){S&&(Rt(t),Rt(i),Rt(r),Rt(u),Rt(p)),_=!1,Xr(x)}}}function qL(e){let t,n;return t=new UL({props:{polygonTool:e[0]}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,r){const u={};r&1&&(u.polygonTool=i[0]),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function jL(e){let t,n,i,r;const u=[qL,GL],p=[];function a(_,x){return _[0]?0:1}return t=a(e),n=p[t]=u[t](e),{c(){n.c(),i=bs()},m(_,x){p[t].m(_,x),Ot(_,i,x),r=!0},p(_,[x]){let S=t;t=a(_),t===S?p[t].p(_,x):(Bi(),At(p[S],1,1,()=>{p[S]=null}),Vi(),n=p[t],n?n.p(_,x):(n=p[t]=u[t](_),n.c()),Ct(n,1),n.m(i.parentNode,i))},i(_){r||(Ct(n),r=!0)},o(_){At(n),r=!1},d(_){_&&Rt(i),p[t].d(_)}}}function Sf(e){return[e.lng,e.lat]}function ZL(e,t,n){let{map:i}=t;const r=ep();let u=null;async function p(S){try{r("loading","Loading from Overpass");let k=await(await fetch(bw(S))).text();r("gotXml",k)}catch(L){r("error",L.toString())}}function a(){let S=i.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[Sf(S.getSouthWest()),Sf(S.getNorthWest()),Sf(S.getNorthEast()),Sf(S.getSouthEast()),Sf(S.getSouthWest())]],type:"Polygon"}}}async function _(){if(i){if(i.getZoom()<13){r("error","Zoom in more to import");return}await p(a())}}function x(){i&&(n(0,u=new OL(i)),u.startNew(),u.addEventListenerSuccess(async S=>{n(0,u=null),await p(S)}),u.addEventListenerFailure(()=>{n(0,u=null)}))}return e.$$set=S=>{"map"in S&&n(3,i=S.map)},[u,_,x,i]}class WL extends cn{constructor(t){super(),un(this,t,ZL,jL,rn,{map:3})}}const XL=e=>({props:e&8}),nb=e=>({props:KL(e[3])});function HL(e){let t;const n=e[1].default,i=Vr(n,e,e[2],nb);return{c(){i&&i.c()},m(r,u){i&&i.m(r,u),t=!0},p(r,u){i&&i.p&&(!t||u&12)&&Gr(i,n,r,r[2],t?Ur(n,r[2],u,XL):qr(r[2]),nb)},i(r){t||(Ct(i,r),t=!0)},o(r){At(i,r),t=!1},d(r){i&&i.d(r)}}}function YL(e){let t,n;return t=new qE({props:{openOn:e[0],$$slots:{default:[HL,({features:i})=>({3:i}),({features:i})=>i?8:0]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,[r]){const u={};r&1&&(u.openOn=i[0]),r&12&&(u.$$scope={dirty:r,ctx:i}),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function KL(e){return e?e[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function JL(e,t,n){let{$$slots:i={},$$scope:r}=t,{openOn:u="hover"}=t;return e.$$set=p=>{"openOn"in p&&n(0,u=p.openOn),"$$scope"in p&&n(2,r=p.$$scope)},[u,i,r]}class xl extends cn{constructor(t){super(),un(this,t,JL,YL,rn,{openOn:0})}}function ib(e,t,n){const i=e.slice();return i[1]=t[n][0],i[2]=t[n][1],i}function rb(e){let t,n,i=e[1]+"",r,u,p=e[2]+"",a;return{c(){t=Lt("tr"),n=Lt("td"),r=He(i),u=Lt("td"),a=He(p)},m(_,x){Ot(_,t,x),vt(t,n),vt(n,r),vt(t,u),vt(u,a)},p(_,x){x&1&&i!==(i=_[1]+"")&&Yi(r,i),x&1&&p!==(p=_[2]+"")&&Yi(a,p)},d(_){_&&Rt(t)}}}function QL(e){let t,n,i=aa(Object.entries(e[0])),r=[];for(let u=0;u<i.length;u+=1)r[u]=rb(ib(e,i,u));return{c(){t=Lt("table"),n=Lt("tbody");for(let u=0;u<r.length;u+=1)r[u].c();Vt(t,"class","svelte-lh2o9l")},m(u,p){Ot(u,t,p),vt(t,n);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(n,null)},p(u,[p]){if(p&1){i=aa(Object.entries(u[0]));let a;for(a=0;a<i.length;a+=1){const _=ib(u,i,a);r[a]?r[a].p(_,p):(r[a]=rb(_),r[a].c(),r[a].m(n,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}},i:Oe,o:Oe,d(u){u&&Rt(t),ad(r,u)}}}function $L(e,t,n){let{properties:i}=t;return e.$$set=r=>{"properties"in r&&n(0,i=r.properties)},[i]}class hp extends cn{constructor(t){super(),un(this,t,$L,QL,rn,{properties:0})}}function Fr(e){return{id:e,beforeId:tM(e)}}function tM(e){let t=Pb(nu);if(!t){console.warn(`getBeforeId(${e}) called before map is ready. Z-ordering may be incorrect.`);return}let n,i=!1;for(let r=ob.length-1;r>=0;r--){let u=ob[r];if(u==e){i=!0;break}t.getLayer(u)&&(n=u)}if(!i)throw new Error(`Layer ID ${e} not defined in layerZorder`);return n}const ob=["Background","neighbourhood-boundaries","Residential","debug-borders","debug-crosses","debug-filters","cells","interior-roads","compare-route","shortcuts","shortcuts-focus","Building","route-points","route-lines","route-polygons","Road labels","modal-filters","boundary","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"],gw=["==",["geometry-type"],"Polygon"],_w=["==",["geometry-type"],"LineString"],yw=["==",["geometry-type"],"Point"];function Nf(e,t,n){let i=["match",e];for(let[r,u]of Object.entries(t))i.push(r),i.push(u);return i.push(n),i}function eM(e,t){let n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(t)),n.setAttribute("download",e),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function vi(e){if(e==null||e==null)throw new Error("Oops, notNull given something null");return e}function Y_(e){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:vw(e)}}}function vw(e){return[Math.round(e[0]*1e7)/1e7,Math.round(e[1]*1e7)/1e7]}function bw(e){let t='poly:"';for(let[i,r]of e.geometry.coordinates[0])t+=`${r} ${i} `;return t=t.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${t}); node(w)->.x; <;); out meta;`}`}function wy(e){let t=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];for(let n of e.features)n.properties??(n.properties={}),n.properties.cell_color=="disconnected"?n.properties.color="red":Object.hasOwn(n.properties,"cell_color")&&(n.properties.color=t[n.properties.cell_color%t.length]);return e}const nM=e=>({}),sb=e=>({}),iM=e=>({}),ab=e=>({});function lb(e){let t;const n=e[5]["line-popup"],i=Vr(n,e,e[7],ab);return{c(){i&&i.c()},m(r,u){i&&i.m(r,u),t=!0},p(r,u){i&&i.p&&(!t||u&128)&&Gr(i,n,r,r[7],t?Ur(n,r[7],u,iM):qr(r[7]),ab)},i(r){t||(Ct(i,r),t=!0)},o(r){At(i,r),t=!1},d(r){i&&i.d(r)}}}function rM(e){let t,n,i=e[0]&&lb(e);return{c(){i&&i.c(),t=bs()},m(r,u){i&&i.m(r,u),Ot(r,t,u),n=!0},p(r,u){r[0]?i?(i.p(r,u),u&1&&Ct(i,1)):(i=lb(r),i.c(),Ct(i,1),i.m(t.parentNode,t)):i&&(Bi(),At(i,1,1,()=>{i=null}),Vi())},i(r){n||(Ct(i),n=!0)},o(r){At(i),n=!1},d(r){r&&Rt(t),i&&i.d(r)}}}function oM(e){let t,n,i,r,u;const p=[Fr("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.3}}];let a={};for(let k=0;k<p.length;k+=1)a=Ir(a,p[k]);t=new rp({props:a});const _=[Fr("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":5,"line-color":["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",e[2],"#A32015"]}},{hoverCursor:e[0]?"pointer":void 0}];let x={$$slots:{default:[rM]},$$scope:{ctx:e}};for(let k=0;k<_.length;k+=1)x=Ir(x,_[k]);i=new iu({props:x}),i.$on("click",e[6]);const S=e[5]["more-layers"],L=Vr(S,e,e[7],sb);return{c(){ee(t.$$.fragment),n=te(),ee(i.$$.fragment),r=te(),L&&L.c()},m(k,D){Qt(t,k,D),Ot(k,n,D),Qt(i,k,D),Ot(k,r,D),L&&L.m(k,D),u=!0},p(k,D){const F={};t.$set(F);const K=D&5?Ob(_,[_[0],_[1],D&4&&{paint:{"line-width":5,"line-color":["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",k[2],"#A32015"]}},D&1&&{hoverCursor:k[0]?"pointer":void 0}]):{};D&129&&(K.$$scope={dirty:D,ctx:k}),i.$set(K),L&&L.p&&(!u||D&128)&&Gr(L,S,k,k[7],u?Ur(S,k[7],D,nM):qr(k[7]),sb)},i(k){u||(Ct(t.$$.fragment,k),Ct(i.$$.fragment,k),Ct(L,k),u=!0)},o(k){At(t.$$.fragment,k),At(i.$$.fragment,k),At(L,k),u=!1},d(k){k&&(Rt(n),Rt(r)),$t(t,k),$t(i,k),L&&L.d(k)}}}function sM(e){let t,n;return t=new As({props:{data:e[3],generateId:!0,$$slots:{default:[oM]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,[r]){const u={};r&8&&(u.data=i[3]),r&135&&(u.$$scope={dirty:r,ctx:i}),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function aM(e,t,n){let i,r,{$$slots:u={},$$scope:p}=t,{gjInput:a}=t,{interactive:_=!0}=t,{onClickLine:x=L=>{}}=t;const S=L=>_&&x(L.detail.features[0]);return e.$$set=L=>{"gjInput"in L&&n(4,a=L.gjInput),"interactive"in L&&n(0,_=L.interactive),"onClickLine"in L&&n(1,x=L.onClickLine),"$$scope"in L&&n(7,p=L.$$scope)},e.$$.update=()=>{e.$$.dirty&16&&n(3,i=wy(a)),e.$$.dirty&16&&n(2,r=Math.max(...a.features.map(L=>L.properties.shortcuts??0)))},[_,x,r,i,a,u,S,p]}class Ag extends cn{constructor(t){super(),un(this,t,aM,sM,rn,{gjInput:4,interactive:0,onClickLine:1})}}const lM=e=>({}),ub=e=>({}),uM=e=>({}),cb=e=>({});function cM(e){let t,n,i,r;const u=e[3].sidebar,p=Vr(u,e,e[2],cb),a=e[3].map,_=Vr(a,e,e[2],ub);return{c(){t=Lt("div"),p&&p.c(),n=te(),i=Lt("div"),_&&_.c()},m(x,S){Ot(x,t,S),p&&p.m(t,null),e[4](t),Ot(x,n,S),Ot(x,i,S),_&&_.m(i,null),e[5](i),r=!0},p(x,[S]){p&&p.p&&(!r||S&4)&&Gr(p,u,x,x[2],r?Ur(u,x[2],S,uM):qr(x[2]),cb),_&&_.p&&(!r||S&4)&&Gr(_,a,x,x[2],r?Ur(a,x[2],S,lM):qr(x[2]),ub)},i(x){r||(Ct(p,x),Ct(_,x),r=!0)},o(x){At(p,x),At(_,x),r=!1},d(x){x&&(Rt(t),Rt(n),Rt(i)),p&&p.d(x),e[4](null),_&&_.d(x),e[5](null)}}}function hM(e,t,n){let i,r;Ee(e,yy,x=>n(0,i=x)),Ee(e,vy,x=>n(1,r=x));let{$$slots:u={},$$scope:p}=t;function a(x){yr[x?"unshift":"push"](()=>{i=x,yy.set(i)})}function _(x){yr[x?"unshift":"push"](()=>{r=x,vy.set(r)})}return e.$$set=x=>{"$$scope"in x&&n(2,p=x.$$scope)},[i,r,p,u,a,_]}class Xu extends cn{constructor(t){super(),un(this,t,hM,cM,rn,{})}}function pM(e){let t,n,i,r,u,p,a;return{c(){t=Lt("div"),n=Lt("h1"),n.textContent="Debug mode",i=te(),r=Lt("div"),u=Lt("button"),u.textContent="Back to editing",Vt(t,"slot","sidebar")},m(_,x){Ot(_,t,x),vt(t,n),vt(t,i),vt(t,r),vt(r,u),p||(a=Se(u,"click",e[3]),p=!0)},p:Oe,d(_){_&&Rt(t),p=!1,a()}}}function fM(e){let t,n;return t=new hp({props:{properties:e[4]}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,r){const u={};r&16&&(u.properties=i[4]),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function dM(e){let t,n,i;return n=new xl({props:{openOn:"hover",$$slots:{default:[fM,({props:r})=>({4:r}),({props:r})=>r?16:0]},$$scope:{ctx:e}}}),{c(){t=Lt("div"),ee(n.$$.fragment),Vt(t,"slot","line-popup")},m(r,u){Ot(r,t,u),Qt(n,t,null),i=!0},p(r,u){const p={};u&48&&(p.$$scope={dirty:u,ctx:r}),n.$set(p)},i(r){i||(Ct(n.$$.fragment,r),i=!0)},o(r){At(n.$$.fragment,r),i=!1},d(r){r&&Rt(t),$t(n)}}}function mM(e){let t,n;return t=new hp({props:{properties:e[4]}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,r){const u={};r&16&&(u.properties=i[4]),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function gM(e){let t,n;return t=new xl({props:{openOn:"hover",$$slots:{default:[mM,({props:i})=>({4:i}),({props:i})=>i?16:0]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,r){const u={};r&48&&(u.$$scope={dirty:r,ctx:i}),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function _M(e){let t,n;return t=new hp({props:{properties:e[4]}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,r){const u={};r&16&&(u.properties=i[4]),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function yM(e){let t,n;return t=new xl({props:{openOn:"hover",$$slots:{default:[_M,({props:i})=>({4:i}),({props:i})=>i?16:0]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,r){const u={};r&48&&(u.$$scope={dirty:r,ctx:i}),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function vM(e){let t,n,i,r;const u=[Fr("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let p={$$slots:{default:[gM]},$$scope:{ctx:e}};for(let x=0;x<u.length;x+=1)p=Ir(p,u[x]);t=new cd({props:p});const a=[Fr("debug-crosses"),{filter:["==",["get","kind"],"crosses"]},{paint:{"line-width":5,"line-color":"blue"}}];let _={$$slots:{default:[yM]},$$scope:{ctx:e}};for(let x=0;x<a.length;x+=1)_=Ir(_,a[x]);return i=new iu({props:_}),{c(){ee(t.$$.fragment),n=te(),ee(i.$$.fragment)},m(x,S){Qt(t,x,S),Ot(x,n,S),Qt(i,x,S),r=!0},p(x,S){const L={};S&32&&(L.$$scope={dirty:S,ctx:x}),t.$set(L);const k={};S&32&&(k.$$scope={dirty:S,ctx:x}),i.$set(k)},i(x){r||(Ct(t.$$.fragment,x),Ct(i.$$.fragment,x),r=!0)},o(x){At(t.$$.fragment,x),At(i.$$.fragment,x),r=!1},d(x){x&&Rt(n),$t(t,x),$t(i,x)}}}function bM(e){let t,n;return t=new hp({props:{properties:e[4]}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,r){const u={};r&16&&(u.properties=i[4]),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function xM(e){let t,n;return t=new xl({props:{openOn:"hover",$$slots:{default:[bM,({props:i})=>({4:i}),({props:i})=>i?16:0]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,r){const u={};r&48&&(u.$$scope={dirty:r,ctx:i}),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function wM(e){let t,n;const i=[Fr("debug-filters"),{paint:{"circle-radius":15,"circle-color":"black"}}];let r={$$slots:{default:[xM]},$$scope:{ctx:e}};for(let u=0;u<i.length;u+=1)r=Ir(r,i[u]);return t=new cd({props:r}),{c(){ee(t.$$.fragment)},m(u,p){Qt(t,u,p),n=!0},p(u,p){const a={};p&32&&(a.$$scope={dirty:p,ctx:u}),t.$set(a)},i(u){n||(Ct(t.$$.fragment,u),n=!0)},o(u){At(t.$$.fragment,u),n=!1},d(u){$t(t,u)}}}function SM(e){let t,n,i,r,u;return n=new Ag({props:{gjInput:JSON.parse(vi(e[0]).renderNeighbourhood()),interactive:!0,onClickLine:e[2],$$slots:{"more-layers":[vM],"line-popup":[dM]},$$scope:{ctx:e}}}),r=new As({props:{data:JSON.parse(vi(e[0]).renderModalFilters()),generateId:!0,$$slots:{default:[wM]},$$scope:{ctx:e}}}),{c(){t=Lt("div"),ee(n.$$.fragment),i=te(),ee(r.$$.fragment),Vt(t,"slot","map")},m(p,a){Ot(p,t,a),Qt(n,t,null),vt(t,i),Qt(r,t,null),u=!0},p(p,a){const _={};a&1&&(_.gjInput=JSON.parse(vi(p[0]).renderNeighbourhood())),a&32&&(_.$$scope={dirty:a,ctx:p}),n.$set(_);const x={};a&1&&(x.data=JSON.parse(vi(p[0]).renderModalFilters())),a&32&&(x.$$scope={dirty:a,ctx:p}),r.$set(x)},i(p){u||(Ct(n.$$.fragment,p),Ct(r.$$.fragment,p),u=!0)},o(p){At(n.$$.fragment,p),At(r.$$.fragment,p),u=!1},d(p){p&&Rt(t),$t(n),$t(r)}}}function EM(e){let t,n;return t=new Xu({props:{$$slots:{map:[SM],sidebar:[pM]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,[r]){const u={};r&35&&(u.$$scope={dirty:r,ctx:i}),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function IM(e,t,n){let i,r;return Ee(e,ns,a=>n(0,i=a)),Ee(e,li,a=>n(1,r=a)),[i,r,a=>window.open(vi(a.properties).way,"_blank"),()=>mn(li,r={mode:"neighbourhood"},r)]}class CM extends cn{constructor(t){super(),un(this,t,IM,EM,rn,{})}}function TM(e){let t,n,i,r,u,p,a;return{c(){t=Lt("div"),n=Lt("h1"),n.textContent="Debug GJ",i=te(),r=Lt("div"),u=Lt("button"),u.textContent="Back",Vt(t,"slot","sidebar")},m(_,x){Ot(_,t,x),vt(t,n),vt(t,i),vt(t,r),vt(r,u),p||(a=Se(u,"click",e[2]),p=!0)},p:Oe,d(_){_&&Rt(t),p=!1,a()}}}function LM(e){let t,n;return t=new hp({props:{properties:e[3]}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,r){const u={};r&8&&(u.properties=i[3]),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function MM(e){let t,n;return t=new xl({props:{openOn:"hover",$$slots:{default:[LM,({props:i})=>({3:i}),({props:i})=>i?8:0]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,r){const u={};r&24&&(u.$$scope={dirty:r,ctx:i}),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function PM(e){let t,n;return t=new hp({props:{properties:e[3]}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,r){const u={};r&8&&(u.properties=i[3]),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function AM(e){let t,n;return t=new xl({props:{openOn:"hover",$$slots:{default:[PM,({props:i})=>({3:i}),({props:i})=>i?8:0]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,r){const u={};r&24&&(u.$$scope={dirty:r,ctx:i}),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function kM(e){let t,n,i,r;return t=new iu({props:{manageHoverState:!0,paint:{"line-width":8,"line-color":"black","line-opacity":ey(.5,1)},$$slots:{default:[MM]},$$scope:{ctx:e}}}),i=new cd({props:{manageHoverState:!0,paint:{"circle-radius":10,"circle-color":"black","circle-opacity":ey(.5,1)},$$slots:{default:[AM]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment),n=te(),ee(i.$$.fragment)},m(u,p){Qt(t,u,p),Ot(u,n,p),Qt(i,u,p),r=!0},p(u,p){const a={};p&16&&(a.$$scope={dirty:p,ctx:u}),t.$set(a);const _={};p&16&&(_.$$scope={dirty:p,ctx:u}),i.$set(_)},i(u){r||(Ct(t.$$.fragment,u),Ct(i.$$.fragment,u),r=!0)},o(u){At(t.$$.fragment,u),At(i.$$.fragment,u),r=!1},d(u){u&&Rt(n),$t(t,u),$t(i,u)}}}function NM(e){let t,n,i;return n=new As({props:{data:JSON.parse(vi(e[0]).toRouteSnapperGj()),generateId:!0,$$slots:{default:[kM]},$$scope:{ctx:e}}}),{c(){t=Lt("div"),ee(n.$$.fragment),Vt(t,"slot","map")},m(r,u){Ot(r,t,u),Qt(n,t,null),i=!0},p(r,u){const p={};u&1&&(p.data=JSON.parse(vi(r[0]).toRouteSnapperGj())),u&16&&(p.$$scope={dirty:u,ctx:r}),n.$set(p)},i(r){i||(Ct(n.$$.fragment,r),i=!0)},o(r){At(n.$$.fragment,r),i=!1},d(r){r&&Rt(t),$t(n)}}}function DM(e){let t,n;return t=new Xu({props:{$$slots:{map:[NM],sidebar:[TM]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,[r]){const u={};r&19&&(u.$$scope={dirty:r,ctx:i}),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function RM(e,t,n){let i,r;return Ee(e,ns,p=>n(0,i=p)),Ee(e,li,p=>n(1,r=p)),[i,r,()=>mn(li,r={mode:"network"},r)]}class OM extends cn{constructor(t){super(),un(this,t,RM,DM,rn,{})}}function zM(e){let t,n,i,r,u,p,a,_,x,S,L,k,D,F,K,W,Q,U,X;return W=new tw({props:{msg:e[0]}}),{c(){t=Lt("details"),n=Lt("summary"),n.textContent="Save / load project",i=te(),r=Lt("div"),u=Lt("button"),u.textContent="Save to GJ",p=te(),a=Lt("div"),_=Lt("label"),x=He(`Load edits from GJ
      `),S=Lt("input"),L=te(),k=Lt("div"),D=Lt("button"),D.textContent="Save to local storage",F=Lt("button"),F.textContent="Load from local storage",K=te(),ee(W.$$.fragment),Vt(S,"type","file")},m(Y,pt){Ot(Y,t,pt),vt(t,n),vt(t,i),vt(t,r),vt(r,u),vt(t,p),vt(t,a),vt(a,_),vt(_,x),vt(_,S),e[7](S),vt(t,L),vt(t,k),vt(k,D),vt(k,F),Ot(Y,K,pt),Qt(W,Y,pt),Q=!0,U||(X=[Se(u,"click",e[2]),Se(S,"change",e[3]),Se(D,"click",e[5]),Se(F,"click",e[4])],U=!0)},p(Y,[pt]){const gt={};pt&1&&(gt.msg=Y[0]),W.$set(gt)},i(Y){Q||(Ct(W.$$.fragment,Y),Q=!0)},o(Y){At(W.$$.fragment,Y),Q=!1},d(Y){Y&&(Rt(t),Rt(K)),e[7](null),$t(W,Y),U=!1,Xr(X)}}}function FM(e,t,n){let i,r,u,p;Ee(e,ns,K=>n(9,r=K)),Ee(e,li,K=>n(10,u=K)),Ee(e,Pu,K=>n(6,p=K));let a=null;function _(){eM(i,r.toSavefile())}let x;async function S(K){n(0,a="Loading project from file");try{D(await x.files[0].text())}catch(W){window.alert(`Couldn't open this file: ${W}`)}n(0,a=null)}function L(){n(0,a="Loading projects from local storage");try{let K=window.localStorage.getItem(i);K?D(K):window.alert("Nothing was saved in local storage")}catch(K){window.alert(`Couldn't load from local storage: ${K}`)}n(0,a=null)}function k(){window.localStorage.setItem(i,r.toSavefile())}function D(K){r.loadSavefile(JSON.parse(K)),mn(li,u={mode:"network"},u),ns.set(r)}function F(K){yr[K?"unshift":"push"](()=>{x=K,n(1,x)})}return e.$$.update=()=>{e.$$.dirty&64&&(i=`ltn_${p||"custom"}.geojson`)},[a,x,_,S,L,k,p,F]}class xw extends cn{constructor(t){super(),un(this,t,FM,zM,rn,{})}}function hb(e,t,n){const i=e.slice();return i[7]=t[n][0],i[8]=t[n][1],i[9]=t[n][2],i}function pb(e){let t,n,i,r,u,p=e[8]+"",a,_,x,S,L;function k(){return e[3](e[7])}return{c(){t=Lt("div"),n=Lt("button"),i=Lt("img"),u=Lt("br"),a=He(p),x=te(),Br(i.src,r=`/ltn//filters/${e[7]}_icon.gif`)||Vt(i,"src",r),Vt(i,"width","80"),Vt(i,"alt",e[8]),ul(n,"width","100%"),n.disabled=_=e[0]==e[7]},m(D,F){Ot(D,t,F),vt(t,n),vt(n,i),vt(n,u),vt(n,a),vt(t,x),S||(L=Se(n,"click",k),S=!0)},p(D,F){e=D,F&1&&_!==(_=e[0]==e[7])&&(n.disabled=_)},d(D){D&&Rt(t),S=!1,L()}}}function BM(e){let t,n,i,r,u,p,a,_,x,S,L,k,D=e[1][2]+"",F,K,W,Q,U,X,Y=aa(e[2]),pt=[];for(let ct=0;ct<Y.length;ct+=1)pt[ct]=pb(hb(e,Y,ct));function gt(){return e[4](e[6])}return{c(){t=Lt("h3"),t.textContent="Choose a modal filter to place on streets",n=te(),i=Lt("table"),r=Lt("tr"),u=Lt("td");for(let ct=0;ct<pt.length;ct+=1)pt[ct].c();p=te(),a=Lt("td"),_=Lt("img"),L=te(),k=Lt("p"),F=He(D),K=te(),W=Lt("center"),Q=Lt("button"),Q.textContent="Confirm",Br(_.src,x=`/ltn//filters/${e[0]}.gif`)||Vt(_,"src",x),Vt(_,"height","300"),Vt(_,"alt",S=e[1][1])},m(ct,ht){Ot(ct,t,ht),Ot(ct,n,ht),Ot(ct,i,ht),vt(i,r),vt(r,u);for(let rt=0;rt<pt.length;rt+=1)pt[rt]&&pt[rt].m(u,null);vt(r,p),vt(r,a),vt(a,_),vt(a,L),vt(a,k),vt(k,F),Ot(ct,K,ht),Ot(ct,W,ht),vt(W,Q),U||(X=Se(Q,"click",gt),U=!0)},p(ct,ht){if(e=ct,ht&5){Y=aa(e[2]);let rt;for(rt=0;rt<Y.length;rt+=1){const Et=hb(e,Y,rt);pt[rt]?pt[rt].p(Et,ht):(pt[rt]=pb(Et),pt[rt].c(),pt[rt].m(u,null))}for(;rt<pt.length;rt+=1)pt[rt].d(1);pt.length=Y.length}ht&1&&!Br(_.src,x=`/ltn//filters/${e[0]}.gif`)&&Vt(_,"src",x),ht&2&&S!==(S=e[1][1])&&Vt(_,"alt",S),ht&2&&D!==(D=e[1][2]+"")&&Yi(F,D)},d(ct){ct&&(Rt(t),Rt(n),Rt(i),Rt(K),Rt(W)),ad(pt,ct),U=!1,X()}}}function VM(e){let t,n;return t=new ew({props:{$$slots:{default:[BM,({dialog:i})=>({6:i}),({dialog:i})=>i?64:0]},$$scope:{ctx:e}}}),t.$on("close",e[5]),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,[r]){const u={};r&4163&&(u.$$scope={dirty:r,ctx:i}),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function UM(e,t,n){let i,{filterType:r}=t,u=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]];const p=x=>n(0,r=x),a=x=>vi(x).close();function _(x){ui.call(this,e,x)}return e.$$set=x=>{"filterType"in x&&n(0,r=x.filterType)},e.$$.update=()=>{e.$$.dirty&1&&n(1,i=u.find(x=>x[0]==r))},[r,i,u,p,a,_]}class GM extends cn{constructor(t){super(),un(this,t,UM,VM,rn,{filterType:0})}}function fb(e){let t,n;return t=new As({props:{data:e[0],$$slots:{default:[qM]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,r){const u={};r&1&&(u.data=i[0]),r&64&&(u.$$scope={dirty:r,ctx:i}),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function qM(e){let t,n;const i=[Fr("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let r={};for(let u=0;u<i.length;u+=1)r=Ir(r,i[u]);return t=new iu({props:r}),{c(){ee(t.$$.fragment)},m(u,p){Qt(t,u,p),n=!0},p(u,p){const a={};t.$set(a)},i(u){n||(Ct(t.$$.fragment,u),n=!0)},o(u){At(t.$$.fragment,u),n=!1},d(u){$t(t,u)}}}function jM(e){let t,n,i=e[0]&&fb(e);return{c(){i&&i.c(),t=bs()},m(r,u){i&&i.m(r,u),Ot(r,t,u),n=!0},p(r,[u]){r[0]?i?(i.p(r,u),u&1&&Ct(i,1)):(i=fb(r),i.c(),Ct(i,1),i.m(t.parentNode,t)):i&&(Bi(),At(i,1,1,()=>{i=null}),Vi())},i(r){n||(Ct(i),n=!0)},o(r){At(i),n=!1},d(r){r&&Rt(t),i&&i.d(r)}}}function ZM(e,t,n){let{map:i}=t,r=null;const u=ep();i.on("dragstart",p),i.on("mousemove",a),i.on("mouseup",_),Ds(()=>{i.dragPan.enable(),i.off("dragstart",p),i.off("mousemove",a),i.off("mouseup",_)});function p(){i.dragPan.disable(),n(0,r={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function a(x){r&&(r.geometry.coordinates.push(x.lngLat.toArray()),n(0,r))}function _(){r&&(u("done",r),n(0,r=null))}return e.$$set=x=>{"map"in x&&n(1,i=x.map)},[r,i]}class WM extends cn{constructor(t){super(),un(this,t,ZM,jM,rn,{map:1})}}function XM(e){let t;const n=e[3].default,i=Vr(n,e,e[5],null);return{c(){i&&i.c()},m(r,u){i&&i.m(r,u),t=!0},p(r,u){i&&i.p&&(!t||u&32)&&Gr(i,n,r,r[5],t?Ur(n,r[5],u,null):qr(r[5]),null)},i(r){t||(Ct(i,r),t=!0)},o(r){At(i,r),t=!1},d(r){i&&i.d(r)}}}function HM(e){let t,n;const i=[Fr("modal-filters"),{layout:{"icon-image":["get","filter_kind"],"icon-allow-overlap":!0,"icon-size":.1}}];let r={$$slots:{default:[XM]},$$scope:{ctx:e}};for(let u=0;u<i.length;u+=1)r=Ir(r,i[u]);return t=new XE({props:r}),t.$on("click",e[4]),{c(){ee(t.$$.fragment)},m(u,p){Qt(t,u,p),n=!0},p(u,p){const a={};p&32&&(a.$$scope={dirty:p,ctx:u}),t.$set(a)},i(u){n||(Ct(t.$$.fragment,u),n=!0)},o(u){At(t.$$.fragment,u),n=!1},d(u){$t(t,u)}}}function YM(e){let t,n;return t=new As({props:{data:e[0],generateId:!0,$$slots:{default:[HM]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,[r]){const u={};r&1&&(u.data=i[0]),r&32&&(u.$$scope={dirty:r,ctx:i}),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function KM(e,t,n){let i,r,u;Ee(e,ns,x=>n(1,r=x)),Ee(e,gc,x=>n(2,u=x));let{$$slots:p={},$$scope:a}=t;function _(x){ui.call(this,e,x)}return e.$$set=x=>{"$$scope"in x&&n(5,a=x.$$scope)},e.$$.update=()=>{e.$$.dirty&6&&n(0,i=u>0?JSON.parse(r.renderModalFilters()):null)},[i,r,u,p,_,a]}class kg extends cn{constructor(t){super(),un(this,t,KM,YM,rn,{})}}function JM(e){let t,n,i;return{c(){t=He("Undo ("),n=He(e[5]),i=He(")")},m(r,u){Ot(r,t,u),Ot(r,n,u),Ot(r,i,u)},p(r,u){u[0]&32&&Yi(n,r[5])},d(r){r&&(Rt(t),Rt(n),Rt(i))}}}function QM(e){let t;return{c(){t=He("Undo")},m(n,i){Ot(n,t,i)},p:Oe,d(n){n&&Rt(t)}}}function $M(e){let t,n,i;return{c(){t=He("Redo ("),n=He(e[6]),i=He(")")},m(r,u){Ot(r,t,u),Ot(r,n,u),Ot(r,i,u)},p(r,u){u[0]&64&&Yi(n,r[6])},d(r){r&&(Rt(t),Rt(n),Rt(i))}}}function tP(e){let t;return{c(){t=He("Redo")},m(n,i){Ot(n,t,i)},p:Oe,d(n){n&&Rt(t)}}}function db(e){let t,n,i;function r(p){e[22](p)}let u={};return e[2]!==void 0&&(u.filterType=e[2]),t=new GM({props:u}),yr.push(()=>Du(t,"filterType",r)),t.$on("close",e[23]),{c(){ee(t.$$.fragment)},m(p,a){Qt(t,p,a),i=!0},p(p,a){const _={};!n&&a[0]&4&&(n=!0,_.filterType=p[2],Nu(()=>n=!1)),t.$set(_)},i(p){i||(Ct(t.$$.fragment,p),i=!0)},o(p){At(t.$$.fragment,p),i=!1},d(p){$t(t,p)}}}function eP(e){let t,n,i,r=vi(vi(e[7]).properties).name+"",u,p,a,_,x,S,L,k,D,F,K,W,Q,U,X,Y,pt,gt,ct,ht,rt,Et,mt,dt,Jt,kt,Gt,Kt,be,ce,$e,jn,Ze,ze,Ue,dn,Jn,Zn,re,Be,fn,Un,ur,Ai,wt,De,Ve,ki,On,tn,Gn,qt,mi;function qi(vn,gi){return vn[5]==0?QM:JM}let In=qi(e),en=In(e);function uo(vn,gi){return vn[6]==0?tP:$M}let or=uo(e),Ni=or(e),ii=e[4]&&db(e);return tn=new xw({}),{c(){t=Lt("div"),n=Lt("h1"),i=He("Editing modal filters in "),u=He(r),p=te(),a=Lt("p"),a.textContent=`Now that you've defined a neighbourhood boundary, you can see the possible
      shortcuts that vehicles are currently able to take through it. You can add
      a new modal filter to try and solve this. The colored "cell" areas show
      what's reachable for drivers without leaving the boundary you've drawn.`,_=te(),x=Lt("div"),S=Lt("button"),S.textContent="Start over and change your study area",L=te(),k=Lt("div"),D=Lt("button"),D.textContent="Pick a different neighbourhood boundary",F=te(),K=Lt("div"),W=Lt("button"),W.textContent="Change this neighbourhood boundary",Q=te(),U=Lt("hr"),X=te(),Y=Lt("div"),pt=Lt("button"),gt=He("Add a modal filter"),ht=te(),rt=Lt("button"),Et=He("Add many modal filters along line"),dt=te(),Jt=Lt("button"),kt=He("Change modal filter type"),Kt=te(),be=Lt("div"),ce=Lt("button"),en.c(),jn=te(),Ze=Lt("button"),Ni.c(),Ue=te(),ii&&ii.c(),dn=te(),Jn=Lt("hr"),Zn=te(),re=Lt("div"),Be=Lt("button"),Be.textContent="View shortcuts",fn=te(),Un=Lt("div"),ur=Lt("button"),ur.textContent="Route",Ai=te(),wt=Lt("div"),De=Lt("button"),De.textContent="Debug",Ve=te(),ki=Lt("hr"),On=te(),ee(tn.$$.fragment),pt.disabled=ct=e[0]||e[3],rt.disabled=mt=e[0]||e[3],Jt.disabled=Gt=e[0]||e[3],ce.disabled=$e=e[5]==0,Ze.disabled=ze=e[6]==0,Vt(t,"slot","sidebar")},m(vn,gi){Ot(vn,t,gi),vt(t,n),vt(n,i),vt(n,u),vt(t,p),vt(t,a),vt(t,_),vt(t,x),vt(x,S),vt(t,L),vt(t,k),vt(k,D),vt(t,F),vt(t,K),vt(K,W),vt(t,Q),vt(t,U),vt(t,X),vt(t,Y),vt(Y,pt),vt(pt,gt),vt(Y,ht),vt(Y,rt),vt(rt,Et),vt(Y,dt),vt(Y,Jt),vt(Jt,kt),vt(t,Kt),vt(t,be),vt(be,ce),en.m(ce,null),vt(be,jn),vt(be,Ze),Ni.m(Ze,null),vt(t,Ue),ii&&ii.m(t,null),vt(t,dn),vt(t,Jn),vt(t,Zn),vt(t,re),vt(re,Be),vt(t,fn),vt(t,Un),vt(Un,ur),vt(t,Ai),vt(t,wt),vt(wt,De),vt(t,Ve),vt(t,ki),vt(t,On),Qt(tn,t,null),Gn=!0,qt||(mi=[Se(S,"click",e[17]),Se(D,"click",e[14]),Se(W,"click",e[18]),Se(pt,"click",e[19]),Se(rt,"click",e[20]),Se(Jt,"click",e[21]),Se(ce,"click",e[12]),Se(Ze,"click",e[13]),Se(Be,"click",e[24]),Se(ur,"click",e[25]),Se(De,"click",e[26])],qt=!0)},p(vn,gi){(!Gn||gi[0]&128)&&r!==(r=vi(vi(vn[7]).properties).name+"")&&Yi(u,r),(!Gn||gi[0]&9&&ct!==(ct=vn[0]||vn[3]))&&(pt.disabled=ct),(!Gn||gi[0]&9&&mt!==(mt=vn[0]||vn[3]))&&(rt.disabled=mt),(!Gn||gi[0]&9&&Gt!==(Gt=vn[0]||vn[3]))&&(Jt.disabled=Gt),In===(In=qi(vn))&&en?en.p(vn,gi):(en.d(1),en=In(vn),en&&(en.c(),en.m(ce,null))),(!Gn||gi[0]&32&&$e!==($e=vn[5]==0))&&(ce.disabled=$e),or===(or=uo(vn))&&Ni?Ni.p(vn,gi):(Ni.d(1),Ni=or(vn),Ni&&(Ni.c(),Ni.m(Ze,null))),(!Gn||gi[0]&64&&ze!==(ze=vn[6]==0))&&(Ze.disabled=ze),vn[4]?ii?(ii.p(vn,gi),gi[0]&16&&Ct(ii,1)):(ii=db(vn),ii.c(),Ct(ii,1),ii.m(t,dn)):ii&&(Bi(),At(ii,1,1,()=>{ii=null}),Vi())},i(vn){Gn||(Ct(ii),Ct(tn.$$.fragment,vn),Gn=!0)},o(vn){At(ii),At(tn.$$.fragment,vn),Gn=!1},d(vn){vn&&Rt(t),en.d(),Ni.d(),ii&&ii.d(),$t(tn),qt=!1,Xr(mi)}}}function nP(e){let t,n=e[31].shortcuts+"",i,r,u=(e[31].name??"unnamed road")+"",p;return{c(){t=Lt("p"),i=He(n),r=He(" shortcuts through "),p=He(u)},m(a,_){Ot(a,t,_),vt(t,i),vt(t,r),vt(t,p)},p(a,_){_[1]&1&&n!==(n=a[31].shortcuts+"")&&Yi(i,n),_[1]&1&&u!==(u=(a[31].name??"unnamed road")+"")&&Yi(p,u)},d(a){a&&Rt(t)}}}function iP(e){let t,n,i;return n=new xl({props:{openOn:"hover",$$slots:{default:[nP,({props:r})=>({31:r}),({props:r})=>[0,r?1:0]]},$$scope:{ctx:e}}}),{c(){t=Lt("div"),ee(n.$$.fragment),Vt(t,"slot","line-popup")},m(r,u){Ot(r,t,u),Qt(n,t,null),i=!0},p(r,u){const p={};u[1]&3&&(p.$$scope={dirty:u,ctx:r}),n.$set(p)},i(r){i||(Ct(n.$$.fragment,r),i=!0)},o(r){At(n.$$.fragment,r),i=!1},d(r){r&&Rt(t),$t(n)}}}function rP(e){let t;return{c(){t=He("Click to delete")},m(n,i){Ot(n,t,i)},d(n){n&&Rt(t)}}}function oP(e){let t,n;return t=new xl({props:{openOn:"hover",$$slots:{default:[rP]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,r){const u={};r[1]&2&&(u.$$scope={dirty:r,ctx:i}),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function mb(e){let t,n;return t=new WM({props:{map:vi(e[1])}}),t.$on("done",e[15]),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,r){const u={};r[0]&2&&(u.map=vi(i[1])),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function sP(e){let t,n,i,r,u,p;n=new Ag({props:{gjInput:e[8],interactive:!e[0]&&!e[3],$$slots:{"line-popup":[iP]},$$scope:{ctx:e}}}),r=new kg({props:{$$slots:{default:[oP]},$$scope:{ctx:e}}}),r.$on("click",e[10]);let a=e[3]&&mb(e);return{c(){t=Lt("div"),ee(n.$$.fragment),i=te(),ee(r.$$.fragment),u=te(),a&&a.c(),Vt(t,"slot","map")},m(_,x){Ot(_,t,x),Qt(n,t,null),vt(t,i),Qt(r,t,null),vt(t,u),a&&a.m(t,null),p=!0},p(_,x){const S={};x[0]&256&&(S.gjInput=_[8]),x[0]&9&&(S.interactive=!_[0]&&!_[3]),x[1]&2&&(S.$$scope={dirty:x,ctx:_}),n.$set(S);const L={};x[1]&2&&(L.$$scope={dirty:x,ctx:_}),r.$set(L),_[3]?a?(a.p(_,x),x[0]&8&&Ct(a,1)):(a=mb(_),a.c(),Ct(a,1),a.m(t,null)):a&&(Bi(),At(a,1,1,()=>{a=null}),Vi())},i(_){p||(Ct(n.$$.fragment,_),Ct(r.$$.fragment,_),Ct(a),p=!0)},o(_){At(n.$$.fragment,_),At(r.$$.fragment,_),At(a),p=!1},d(_){_&&Rt(t),$t(n),$t(r),a&&a.d()}}}function aP(e){let t,n,i,r;return t=new Xu({props:{$$slots:{map:[sP],sidebar:[eP]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment)},m(u,p){Qt(t,u,p),n=!0,i||(r=Se(window,"keydown",e[11]),i=!0)},p(u,p){const a={};p[0]&1023|p[1]&2&&(a.$$scope={dirty:p,ctx:u}),t.$set(a)},i(u){n||(Ct(t.$$.fragment,u),n=!0)},o(u){At(t.$$.fragment,u),n=!1},d(u){$t(t,u),i=!1,r()}}}function lP(e,t,n){let i,r,u,p;Ee(e,gc,ce=>n(16,i=ce)),Ee(e,ns,ce=>n(27,r=ce)),Ee(e,li,ce=>n(9,u=ce)),Ee(e,nu,ce=>n(1,p=ce));let a="walk_cycle_only",_=!1,x=!1,S=!1,L=0,k=0,D,F;function K(ce){n(8,F=JSON.parse(r.renderNeighbourhood())),n(7,D=F.features.find($e=>$e.properties.kind=="boundary")),n(5,L=F.undo_length),n(6,k=F.redo_length)}Ds(()=>{Q()});function W(ce){r.addModalFilter(ce.lngLat,a),mn(gc,i++,i),Q()}function Q(){n(0,_=!1),p.off("click",W),p.getCanvas().style.cursor="inherit"}function U(ce){let $e=ce.detail.features[0];r.deleteModalFilter($e.properties.road),mn(gc,i++,i)}function X(ce){ce.key=="a"&&!_&&!x&&n(0,_=!0),ce.key=="z"&&ce.ctrlKey&&Y(),ce.key=="y"&&ce.ctrlKey&&pt()}function Y(){r.undo(),mn(gc,i++,i)}function pt(){r.redo(),mn(gc,i++,i)}function gt(){mn(li,u={mode:"network"},u)}function ct(ce){let $e=ce.detail;$e&&(r.addManyModalFilters($e,a),mn(gc,i++,i)),n(3,x=!1)}const ht=()=>mn(li,u={mode:"title"},u),rt=()=>mn(li,u={mode:"set-boundary",name:vi(vi(D).properties).name,existing:D},u),Et=()=>n(0,_=!0),mt=()=>n(3,x=!0),dt=()=>n(4,S=!0);function Jt(ce){a=ce,n(2,a)}const kt=()=>n(4,S=!1),Gt=()=>mn(li,u={mode:"view-shortcuts"},u),Kt=()=>mn(li,u={mode:"route",prevMode:"neighbourhood"},u),be=()=>mn(li,u={mode:"debug"},u);return e.$$.update=()=>{e.$$.dirty[0]&65536&&K(),e.$$.dirty[0]&3&&_&&(p.on("click",W),p.getCanvas().style.cursor="crosshair")},[_,p,a,x,S,L,k,D,F,u,U,X,Y,pt,gt,ct,i,ht,rt,Et,mt,dt,Jt,kt,Gt,Kt,be]}class uP extends cn{constructor(t){super(),un(this,t,lP,aP,rn,{},null,[-1,-1])}}function gb(e,t,n){const i=e.slice();return i[14]=t[n],i}function _b(e){let t,n,i=e[14]+"",r,u,p,a,_;function x(){return e[9](e[14])}function S(){return e[10](e[14])}return{c(){t=Lt("div"),n=Lt("button"),r=He(i),u=te(),p=Lt("button"),p.textContent="X"},m(L,k){Ot(L,t,k),vt(t,n),vt(n,r),vt(t,u),vt(t,p),a||(_=[Se(n,"click",x),Se(p,"click",S)],a=!0)},p(L,k){e=L,k&2&&i!==(i=e[14]+"")&&Yi(r,i)},d(L){L&&Rt(t),a=!1,Xr(_)}}}function cP(e){let t,n,i,r,u,p,a,_,x,S,L,k,D,F,K,W,Q,U,X,Y,pt,gt,ct,ht,rt=aa(e[1]),Et=[];for(let mt=0;mt<rt.length;mt+=1)Et[mt]=_b(gb(e,rt,mt));return pt=new xw({}),{c(){t=Lt("div"),n=Lt("h1"),n.textContent="Define neighbourhood boundaries",i=te(),r=Lt("p"),r.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
      deliberately permit) through-traffic. An appropriate neighbourhood
      boundary depends on many factors. The simplest approach is to find the
      area bounded on all sides by "main" roads, which are designed for higher
      traffic volumes. There are many other considerations, though -- maybe
      severances like rivers or rail should be part of a boundary. Bridges and
      tunnels near a boundary may be confusing as well. And note that your
      boundary may not match the conventional definition of "neighbourhood."`,u=te(),p=Lt("div"),a=Lt("button"),a.textContent="Start over and change your study area",_=te(),x=Lt("div"),S=Lt("button"),S.textContent="Draw a new boundary",L=te();for(let mt=0;mt<Et.length;mt+=1)Et[mt].c();k=te(),D=Lt("div"),F=Lt("button"),F.textContent="Route",K=te(),W=Lt("div"),Q=Lt("button"),Q.textContent="Debug route snapper",U=te(),X=Lt("hr"),Y=te(),ee(pt.$$.fragment),Vt(t,"slot","sidebar")},m(mt,dt){Ot(mt,t,dt),vt(t,n),vt(t,i),vt(t,r),vt(t,u),vt(t,p),vt(p,a),vt(t,_),vt(t,x),vt(x,S),vt(t,L);for(let Jt=0;Jt<Et.length;Jt+=1)Et[Jt]&&Et[Jt].m(t,null);vt(t,k),vt(t,D),vt(D,F),vt(t,K),vt(t,W),vt(W,Q),vt(t,U),vt(t,X),vt(t,Y),Qt(pt,t,null),gt=!0,ct||(ht=[Se(a,"click",e[8]),Se(S,"click",e[5]),Se(F,"click",e[11]),Se(Q,"click",e[12])],ct=!0)},p(mt,dt){if(dt&26){rt=aa(mt[1]);let Jt;for(Jt=0;Jt<rt.length;Jt+=1){const kt=gb(mt,rt,Jt);Et[Jt]?Et[Jt].p(kt,dt):(Et[Jt]=_b(kt),Et[Jt].c(),Et[Jt].m(t,k))}for(;Jt<Et.length;Jt+=1)Et[Jt].d(1);Et.length=rt.length}},i(mt){gt||(Ct(pt.$$.fragment,mt),gt=!0)},o(mt){At(pt.$$.fragment,mt),gt=!1},d(mt){mt&&Rt(t),ad(Et,mt),$t(pt),ct=!1,Xr(ht)}}}function hP(e){let t,n=e[13].name+"",i;return{c(){t=Lt("p"),i=He(n)},m(r,u){Ot(r,t,u),vt(t,i)},p(r,u){u&8192&&n!==(n=r[13].name+"")&&Yi(i,n)},d(r){r&&Rt(t)}}}function pP(e){let t,n;return t=new xl({props:{openOn:"hover",$$slots:{default:[hP,({props:i})=>({13:i}),({props:i})=>i?8192:0]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,r){const u={};r&139264&&(u.$$scope={dirty:r,ctx:i}),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function fP(e){let t,n,i,r;const u=[Fr("neighbourhood-boundaries"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"red","fill-opacity":ey(.3,.5)}},{manageHoverState:!0},{hoverCursor:"pointer"}];let p={$$slots:{default:[pP]},$$scope:{ctx:e}};for(let a=0;a<u.length;a+=1)p=Ir(p,u[a]);return t=new rp({props:p}),t.$on("click",e[7]),i=new kg({}),{c(){ee(t.$$.fragment),n=te(),ee(i.$$.fragment)},m(a,_){Qt(t,a,_),Ot(a,n,_),Qt(i,a,_),r=!0},p(a,_){const x={};_&131072&&(x.$$scope={dirty:_,ctx:a}),t.$set(x)},i(a){r||(Ct(t.$$.fragment,a),Ct(i.$$.fragment,a),r=!0)},o(a){At(t.$$.fragment,a),At(i.$$.fragment,a),r=!1},d(a){a&&Rt(n),$t(t,a),$t(i,a)}}}function dP(e){let t,n,i;return n=new As({props:{data:e[0],generateId:!0,$$slots:{default:[fP]},$$scope:{ctx:e}}}),{c(){t=Lt("div"),ee(n.$$.fragment),Vt(t,"slot","map")},m(r,u){Ot(r,t,u),Qt(n,t,null),i=!0},p(r,u){const p={};u&1&&(p.data=r[0]),u&131072&&(p.$$scope={dirty:u,ctx:r}),n.$set(p)},i(r){i||(Ct(n.$$.fragment,r),i=!0)},o(r){At(n.$$.fragment,r),i=!1},d(r){r&&Rt(t),$t(n)}}}function mP(e){let t,n;return t=new Xu({props:{$$slots:{map:[dP],sidebar:[cP]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,[r]){const u={};r&131079&&(u.$$scope={dirty:r,ctx:i}),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function gP(e,t,n){let i,r,u,p;Ee(e,li,W=>n(2,u=W)),Ee(e,ns,W=>n(6,p=W));function a(W){p.setCurrentNeighbourhood(W),mn(li,u={mode:"neighbourhood"},u)}function _(W){p.deleteNeighbourhoodBoundary(W),n(0,i=JSON.parse(p.toSavefile()))}function x(){let W=window.prompt("What do you want to name the neighbourhood?");W&&mn(li,u={mode:"set-boundary",name:W,existing:null},u)}const S=W=>a(vi(W.detail.features[0].properties).name),L=()=>mn(li,u={mode:"title"},u),k=W=>a(W),D=W=>_(W),F=()=>mn(li,u={mode:"route",prevMode:"network"},u),K=()=>mn(li,u={mode:"debug-gj"},u);return e.$$.update=()=>{e.$$.dirty&64&&n(0,i=JSON.parse(p.toSavefile())),e.$$.dirty&1&&n(1,r=i.features.filter(W=>W.properties.kind=="boundary").map(W=>W.properties.name))},[i,r,u,a,_,x,p,S,L,k,D,F,K]}class _P extends cn{constructor(t){super(),un(this,t,gP,mP,rn,{})}}function yP(e){let t,n,i,r,u,p,a,_,x;return{c(){t=Lt("div"),n=Lt("div"),i=Lt("button"),i.textContent="Back",r=te(),u=Lt("p"),u.textContent="Drag markers for a route",p=te(),a=Lt("p"),a.innerHTML=`<span style="color: red">Route before</span>,
      <span style="color: blue">route after</span>`,Vt(t,"slot","sidebar")},m(S,L){Ot(S,t,L),vt(t,n),vt(n,i),vt(t,r),vt(t,u),vt(t,p),vt(t,a),_||(x=Se(i,"click",e[6]),_=!0)},p:Oe,d(S){S&&Rt(t),_=!1,x()}}}function yb(e){let t,n;return t=new Ag({props:{gjInput:JSON.parse(vi(e[3]).renderNeighbourhood()),interactive:!1}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,r){const u={};r&8&&(u.gjInput=JSON.parse(vi(i[3]).renderNeighbourhood())),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function vP(e){let t,n;const i=[Fr("compare-route"),{paint:{"line-width":10,"line-color":Nf(["get","kind"],{before:"red",after:"blue"},"red")}}];let r={};for(let u=0;u<i.length;u+=1)r=Ir(r,i[u]);return t=new iu({props:r}),{c(){ee(t.$$.fragment)},m(u,p){Qt(t,u,p),n=!0},p(u,p){const a={};t.$set(a)},i(u){n||(Ct(t.$$.fragment,u),n=!0)},o(u){At(t.$$.fragment,u),n=!1},d(u){$t(t,u)}}}function bP(e){let t;return{c(){t=Lt("span"),t.textContent="A",Vt(t,"class","dot svelte-1ukzawy")},m(n,i){Ot(n,t,i)},p:Oe,d(n){n&&Rt(t)}}}function xP(e){let t;return{c(){t=Lt("span"),t.textContent="B",Vt(t,"class","dot svelte-1ukzawy")},m(n,i){Ot(n,t,i)},p:Oe,d(n){n&&Rt(t)}}}function wP(e){let t,n,i,r,u,p,a,_,x,S,L,k,D=e[0]=="neighbourhood"&&yb(e);i=new kg({}),u=new As({props:{data:e[4],$$slots:{default:[vP]},$$scope:{ctx:e}}});function F(U){e[7](U)}let K={draggable:!0,$$slots:{default:[bP]},$$scope:{ctx:e}};e[2]!==void 0&&(K.lngLat=e[2]),a=new jv({props:K}),yr.push(()=>Du(a,"lngLat",F));function W(U){e[8](U)}let Q={draggable:!0,$$slots:{default:[xP]},$$scope:{ctx:e}};return e[1]!==void 0&&(Q.lngLat=e[1]),S=new jv({props:Q}),yr.push(()=>Du(S,"lngLat",W)),{c(){t=Lt("div"),D&&D.c(),n=te(),ee(i.$$.fragment),r=te(),ee(u.$$.fragment),p=te(),ee(a.$$.fragment),x=te(),ee(S.$$.fragment),Vt(t,"slot","map")},m(U,X){Ot(U,t,X),D&&D.m(t,null),vt(t,n),Qt(i,t,null),vt(t,r),Qt(u,t,null),vt(t,p),Qt(a,t,null),vt(t,x),Qt(S,t,null),k=!0},p(U,X){U[0]=="neighbourhood"?D?(D.p(U,X),X&1&&Ct(D,1)):(D=yb(U),D.c(),Ct(D,1),D.m(t,n)):D&&(Bi(),At(D,1,1,()=>{D=null}),Vi());const Y={};X&16&&(Y.data=U[4]),X&2048&&(Y.$$scope={dirty:X,ctx:U}),u.$set(Y);const pt={};X&2048&&(pt.$$scope={dirty:X,ctx:U}),!_&&X&4&&(_=!0,pt.lngLat=U[2],Nu(()=>_=!1)),a.$set(pt);const gt={};X&2048&&(gt.$$scope={dirty:X,ctx:U}),!L&&X&2&&(L=!0,gt.lngLat=U[1],Nu(()=>L=!1)),S.$set(gt)},i(U){k||(Ct(D),Ct(i.$$.fragment,U),Ct(u.$$.fragment,U),Ct(a.$$.fragment,U),Ct(S.$$.fragment,U),k=!0)},o(U){At(D),At(i.$$.fragment,U),At(u.$$.fragment,U),At(a.$$.fragment,U),At(S.$$.fragment,U),k=!1},d(U){U&&Rt(t),D&&D.d(),$t(i),$t(u),$t(a),$t(S)}}}function SP(e){let t,n,i,r;return t=new Xu({props:{$$slots:{map:[wP],sidebar:[yP]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment)},m(u,p){Qt(t,u,p),n=!0,i||(r=Se(window,"keydown",e[5]),i=!0)},p(u,[p]){const a={};p&2079&&(a.$$scope={dirty:p,ctx:u}),t.$set(a)},i(u){n||(Ct(t.$$.fragment,u),n=!0)},o(u){At(t.$$.fragment,u),n=!1},d(u){$t(t,u),i=!1,r()}}}function EP(e,t,n){let i,r,u,p,a,_;Ee(e,li,F=>n(9,r=F)),Ee(e,nu,F=>n(10,u=F)),Ee(e,ug,F=>n(1,p=F)),Ee(e,lg,F=>n(2,a=F)),Ee(e,ns,F=>n(3,_=F));let{prevMode:x}=t;ud(()=>{u==null||u.keyboard.disable()}),Ds(()=>{u==null||u.keyboard.enable()});function S(F){F.key=="Escape"&&(F.stopPropagation(),L())}function L(){mn(li,r={mode:x},r)}function k(F){a=F,lg.set(a)}function D(F){p=F,ug.set(p)}return e.$$set=F=>{"prevMode"in F&&n(0,x=F.prevMode)},e.$$.update=()=>{e.$$.dirty&14&&n(4,i=JSON.parse(_.compareRoute(a.lng,a.lat,p.lng,p.lat)))},[x,p,a,_,i,S,L,k,D]}class IP extends cn{constructor(t){super(),un(this,t,EP,SP,rn,{prevMode:0})}}function CP(e){let t,n,i,r,u,p;const a=[Fr("route-points"),{filter:yw},{paint:{"circle-color":Nf(["get","type"],{"snapped-waypoint":"red","free-waypoint":"blue"},"black"),"circle-opacity":["case",["has","hovered"],.5,1],"circle-radius":Nf(["get","type"],{node:zm/2},zm)}}];let _={};for(let D=0;D<a.length;D+=1)_=Ir(_,a[D]);t=new cd({props:_});const x=[Fr("route-lines"),{filter:_w},{paint:{"line-color":["case",["get","snapped"],"red","blue"],"line-width":2.5}}];let S={};for(let D=0;D<x.length;D+=1)S=Ir(S,x[D]);i=new iu({props:S});const L=[Fr("route-polygons"),{filter:gw},{paint:{"fill-color":"black","fill-opacity":.5}}];let k={};for(let D=0;D<L.length;D+=1)k=Ir(k,L[D]);return u=new rp({props:k}),{c(){ee(t.$$.fragment),n=te(),ee(i.$$.fragment),r=te(),ee(u.$$.fragment)},m(D,F){Qt(t,D,F),Ot(D,n,F),Qt(i,D,F),Ot(D,r,F),Qt(u,D,F),p=!0},p(D,F){const K=F&0?Ob(a,[a[0],a[1],{paint:{"circle-color":Nf(["get","type"],{"snapped-waypoint":"red","free-waypoint":"blue"},"black"),"circle-opacity":["case",["has","hovered"],.5,1],"circle-radius":Nf(["get","type"],{node:zm/2},zm)}}]):{};t.$set(K);const W={};i.$set(W);const Q={};u.$set(Q)},i(D){p||(Ct(t.$$.fragment,D),Ct(i.$$.fragment,D),Ct(u.$$.fragment,D),p=!0)},o(D){At(t.$$.fragment,D),At(i.$$.fragment,D),At(u.$$.fragment,D),p=!1},d(D){D&&(Rt(n),Rt(r)),$t(t,D),$t(i,D),$t(u,D)}}}function TP(e){let t,n;return t=new As({props:{data:e[0],$$slots:{default:[CP]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,[r]){const u={};r&1&&(u.data=i[0]),r&2&&(u.$$scope={dirty:r,ctx:i}),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}const zm=10;function LP(e,t,n){let i;return Ee(e,Jx,r=>n(0,i=r)),[i]}class MP extends cn{constructor(t){super(),un(this,t,LP,TP,rn,{})}}function PP(e){let t,n,i;return{c(){t=He("Undo ("),n=He(e[1]),i=He(")")},m(r,u){Ot(r,t,u),Ot(r,n,u),Ot(r,i,u)},p(r,u){u&2&&Yi(n,r[1])},d(r){r&&(Rt(t),Rt(n),Rt(i))}}}function AP(e){let t;return{c(){t=He("Undo")},m(n,i){Ot(n,t,i)},p:Oe,d(n){n&&Rt(t)}}}function kP(e){let t,n,i,r,u,p;function a(S,L){return S[1]==0?AP:PP}let _=a(e),x=_(e);return{c(){t=Lt("button"),x.c(),i=te(),r=Lt("ul"),r.innerHTML=`<li><b>Click</b>
    the map to add points</li> <li><b>Click and drag</b>
    any point to move it</li> <li><b>Click</b>
    a waypoint to delete it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,t.disabled=n=e[1]==0},m(S,L){Ot(S,t,L),x.m(t,null),Ot(S,i,L),Ot(S,r,L),u||(p=Se(t,"click",e[2]),u=!0)},p(S,[L]){_===(_=a(S))&&x?x.p(S,L):(x.d(1),x=_(S),x&&(x.c(),x.m(t,null))),L&2&&n!==(n=S[1]==0)&&(t.disabled=n)},i:Oe,o:Oe,d(S){S&&(Rt(t),Rt(i),Rt(r)),x.d(),u=!1,p()}}}function NP(e,t,n){let i;Ee(e,Qx,p=>n(1,i=p));let{route_tool:r}=t;const u=()=>r.undo();return e.$$set=p=>{"route_tool"in p&&n(0,r=p.route_tool)},[r,i,u]}class DP extends cn{constructor(t){super(),un(this,t,NP,kP,rn,{route_tool:0})}}function RP(e){let t,n,i,r,u,p,a,_,x,S,L,k,D,F,K,W;return _=new DP({props:{route_tool:vi(e[1])}}),{c(){t=Lt("div"),n=Lt("h1"),i=He("Draw your neighbourhood boundary for "),r=He(e[0]),u=te(),p=Lt("p"),p.textContent="TODO: maybe move the instructions from the previous screen to here...",a=te(),ee(_.$$.fragment),x=te(),S=Lt("div"),L=Lt("button"),L.textContent="Finish",k=te(),D=Lt("button"),D.textContent="Cancel",Vt(t,"slot","sidebar")},m(Q,U){Ot(Q,t,U),vt(t,n),vt(n,i),vt(n,r),vt(t,u),vt(t,p),vt(t,a),Qt(_,t,null),vt(t,x),vt(t,S),vt(S,L),vt(S,k),vt(S,D),F=!0,K||(W=[Se(L,"click",e[4]),Se(D,"click",e[2])],K=!0)},p(Q,U){(!F||U&1)&&Yi(r,Q[0]);const X={};U&2&&(X.route_tool=vi(Q[1])),_.$set(X)},i(Q){F||(Ct(_.$$.fragment,Q),F=!0)},o(Q){At(_.$$.fragment,Q),F=!1},d(Q){Q&&Rt(t),$t(_),K=!1,Xr(W)}}}function OP(e){let t,n,i;return n=new MP({}),{c(){t=Lt("div"),ee(n.$$.fragment),Vt(t,"slot","map")},m(r,u){Ot(r,t,u),Qt(n,t,null),i=!0},p:Oe,i(r){i||(Ct(n.$$.fragment,r),i=!0)},o(r){At(n.$$.fragment,r),i=!1},d(r){r&&Rt(t),$t(n)}}}function zP(e){let t,n;return t=new Xu({props:{$$slots:{map:[OP],sidebar:[RP]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,[r]){const u={};r&131&&(u.$$scope={dirty:r,ctx:i}),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function FP(e,t,n){let i,r,u;Ee(e,rd,S=>n(1,i=S)),Ee(e,li,S=>n(5,r=S)),Ee(e,ns,S=>n(6,u=S));let{name:p}=t,{existing:a}=t;a?i.editExistingArea(a):i.startArea();function _(){mn(li,r={mode:"network"},r),i.clearEventListeners()}i.addEventListenerSuccess(S=>{try{u.setNeighbourhoodBoundary(p,S),u.setCurrentNeighbourhood(p),mn(li,r={mode:"neighbourhood"},r),i.clearEventListeners()}catch{window.alert("Known georust bug hit, sorry. You may need to just refresh the page now."),_()}}),i.addEventListenerFailure(_);const x=()=>vi(i).finish();return e.$$set=S=>{"name"in S&&n(0,p=S.name),"existing"in S&&n(3,a=S.existing)},[p,i,_,a,x]}class BP extends cn{constructor(t){super(),un(this,t,FP,zP,rn,{name:0,existing:3})}}function VP(e){let t,n,i,r,u,p;const a=[Fr("edit-polygon-fill"),{filter:gw},{paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}];let _={};for(let D=0;D<a.length;D+=1)_=Ir(_,a[D]);t=new rp({props:_});const x=[Fr("edit-polygon-lines"),{filter:_w},{paint:{"line-color":"black","line-width":8,"line-opacity":.5}}];let S={};for(let D=0;D<x.length;D+=1)S=Ir(S,x[D]);i=new iu({props:S});const L=[Fr("edit-polygon-vertices"),{filter:yw},{paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}];let k={};for(let D=0;D<L.length;D+=1)k=Ir(k,L[D]);return u=new cd({props:k}),{c(){ee(t.$$.fragment),n=te(),ee(i.$$.fragment),r=te(),ee(u.$$.fragment)},m(D,F){Qt(t,D,F),Ot(D,n,F),Qt(i,D,F),Ot(D,r,F),Qt(u,D,F),p=!0},p(D,F){const K={};t.$set(K);const W={};i.$set(W);const Q={};u.$set(Q)},i(D){p||(Ct(t.$$.fragment,D),Ct(i.$$.fragment,D),Ct(u.$$.fragment,D),p=!0)},o(D){At(t.$$.fragment,D),At(i.$$.fragment,D),At(u.$$.fragment,D),p=!1},d(D){D&&(Rt(n),Rt(r)),$t(t,D),$t(i,D),$t(u,D)}}}function UP(e){let t,n;return t=new As({props:{data:e[0],$$slots:{default:[VP]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,[r]){const u={};r&1&&(u.data=i[0]),r&2&&(u.$$scope={dirty:r,ctx:i}),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function GP(e,t,n){let i;return Ee(e,dw,r=>n(0,i=r)),[i]}class qP extends cn{constructor(t){super(),un(this,t,GP,UP,rn,{})}}function vb(e){let t,n;return t=new ew({props:{$$slots:{default:[jP,({dialog:i})=>({3:i}),({dialog:i})=>i?8:0]},$$scope:{ctx:e}}}),t.$on("close",e[2]),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,r){const u={};r&24&&(u.$$scope={dirty:r,ctx:i}),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function jP(e){let t,n,i,r,u,p,a,_,x,S,L,k,D,F;function K(){return e[1](e[3])}return{c(){t=Lt("h1"),t.textContent="The Low-traffic neighbourhood (LTN) tool, v2",n=te(),i=Lt("p"),i.innerHTML=`This is an <b>experimental</b> version of the
      <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>. Most parts of it do not work yet, and you should probably use the other
      version of the tool instead.`,r=te(),u=Lt("p"),u.textContent="To use this tool, you need to:",p=te(),a=Lt("ol"),a.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, to fix the basemap data on existing modal filters, turn
        restrictions, one-ways, etc</li> <li>To create one or more proposals with new modal filters, and explore
        their effects</li>`,_=te(),x=Lt("p"),x.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
      and relies heavily on
      <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a> data.`,S=te(),L=Lt("center"),k=Lt("button"),k.textContent="Start!"},m(W,Q){Ot(W,t,Q),Ot(W,n,Q),Ot(W,i,Q),Ot(W,r,Q),Ot(W,u,Q),Ot(W,p,Q),Ot(W,a,Q),Ot(W,_,Q),Ot(W,x,Q),Ot(W,S,Q),Ot(W,L,Q),vt(L,k),D||(F=Se(k,"click",K),D=!0)},p(W,Q){e=W},d(W){W&&(Rt(t),Rt(n),Rt(i),Rt(r),Rt(u),Rt(p),Rt(a),Rt(_),Rt(x),Rt(S),Rt(L)),D=!1,F()}}}function ZP(e){let t,n,i=e[0]&&vb(e);return{c(){i&&i.c(),t=bs()},m(r,u){i&&i.m(r,u),Ot(r,t,u),n=!0},p(r,[u]){r[0]?i?(i.p(r,u),u&1&&Ct(i,1)):(i=vb(r),i.c(),Ct(i,1),i.m(t.parentNode,t)):i&&(Bi(),At(i,1,1,()=>{i=null}),Vi())},i(r){n||(Ct(i),n=!0)},o(r){At(i),n=!1},d(r){r&&Rt(t),i&&i.d(r)}}}function WP(e,t,n){let i;return Ee(e,ag,p=>n(0,i=p)),[i,p=>vi(p).close(),()=>mn(ag,i=!1,i)]}class XP extends cn{constructor(t){super(),un(this,t,WP,ZP,rn,{})}}function bb(e,t,n){const i=e.slice();return i[22]=t[n][0],i[23]=t[n][1],i}function xb(e,t,n){const i=e.slice();return i[26]=t[n][0],i[27]=t[n][1],i}function wb(e){let t,n=e[27]+"",i,r;return{c(){t=Lt("option"),i=He(n),t.__value=r=e[26],Vf(t,t.__value)},m(u,p){Ot(u,t,p),vt(t,i)},p(u,p){p&4&&n!==(n=u[27]+"")&&Yi(i,n),p&4&&r!==(r=u[26])&&(t.__value=r,Vf(t,t.__value))},d(u){u&&Rt(t)}}}function Sb(e){let t,n,i=aa(e[23]),r=[];for(let u=0;u<i.length;u+=1)r[u]=wb(xb(e,i,u));return{c(){t=Lt("optgroup");for(let u=0;u<r.length;u+=1)r[u].c();Vt(t,"label",n=e[22])},m(u,p){Ot(u,t,p);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(t,null)},p(u,p){if(p&4){i=aa(u[23]);let a;for(a=0;a<i.length;a+=1){const _=xb(u,i,a);r[a]?r[a].p(_,p):(r[a]=wb(_),r[a].c(),r[a].m(t,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}p&4&&n!==(n=u[22])&&Vt(t,"label",n)},d(u){u&&Rt(t),ad(r,u)}}}function HP(e){let t,n,i,r,u,p,a,_,x,S,L,k,D,F,K,W,Q,U,X,Y,pt;t=new tw({props:{msg:e[1]}});let gt=aa(e[2]),ct=[];for(let ht=0;ht<gt.length;ht+=1)ct[ht]=Sb(bb(e,gt,ht));return U=new WL({props:{map:e[5]}}),U.$on("gotXml",e[7]),U.$on("loading",e[12]),U.$on("error",e[13]),{c(){ee(t.$$.fragment),n=te(),i=Lt("div"),r=Lt("label"),u=He(`Load an example:
    `),p=Lt("select"),a=Lt("option"),a.textContent="Custom file loaded";for(let ht=0;ht<ct.length;ht+=1)ct[ht].c();_=te(),x=Lt("i"),x.textContent="or...",S=te(),L=Lt("div"),k=Lt("label"),D=He(`Load an osm.xml or a .pbf file:
    `),F=Lt("input"),K=te(),W=Lt("i"),W.textContent="or...",Q=te(),ee(U.$$.fragment),a.__value="",Vf(a,a.__value),e[4]===void 0&&Zm(()=>e[9].call(p)),Vt(F,"type","file")},m(ht,rt){Qt(t,ht,rt),Ot(ht,n,rt),Ot(ht,i,rt),vt(i,r),vt(r,u),vt(r,p),vt(p,a);for(let Et=0;Et<ct.length;Et+=1)ct[Et]&&ct[Et].m(p,null);Nv(p,e[4],!0),Ot(ht,_,rt),Ot(ht,x,rt),Ot(ht,S,rt),Ot(ht,L,rt),vt(L,k),vt(k,D),vt(k,F),e[11](F),Ot(ht,K,rt),Ot(ht,W,rt),Ot(ht,Q,rt),Qt(U,ht,rt),X=!0,Y||(pt=[Se(p,"change",e[9]),Se(p,"change",e[10]),Se(F,"change",e[6])],Y=!0)},p(ht,[rt]){const Et={};if(rt&2&&(Et.msg=ht[1]),t.$set(Et),rt&4){gt=aa(ht[2]);let dt;for(dt=0;dt<gt.length;dt+=1){const Jt=bb(ht,gt,dt);ct[dt]?ct[dt].p(Jt,rt):(ct[dt]=Sb(Jt),ct[dt].c(),ct[dt].m(p,null))}for(;dt<ct.length;dt+=1)ct[dt].d(1);ct.length=gt.length}rt&20&&Nv(p,ht[4]);const mt={};rt&32&&(mt.map=ht[5]),U.$set(mt)},i(ht){X||(Ct(t.$$.fragment,ht),Ct(U.$$.fragment,ht),X=!0)},o(ht){At(t.$$.fragment,ht),At(U.$$.fragment,ht),X=!1},d(ht){ht&&(Rt(n),Rt(i),Rt(_),Rt(x),Rt(S),Rt(L),Rt(K),Rt(W),Rt(Q)),$t(t,ht),ad(ct,ht),e[11](null),$t(U,ht),Y=!1,Xr(pt)}}}function YP(e,t,n){let i,r,u,p,a,_,x;Ee(e,ns,rt=>n(15,i=rt)),Ee(e,Pu,rt=>n(4,r=rt)),Ee(e,ug,rt=>n(16,u=rt)),Ee(e,lg,rt=>n(17,p=rt)),Ee(e,nu,rt=>n(5,a=rt)),Ee(e,rd,rt=>n(18,_=rt)),Ee(e,li,rt=>n(19,x=rt));let S=null,L=!1,k=[];ud(async()=>{try{let rt=await fetch("/osm/areas.json");if(rt.ok)L=!0,console.log("Using local cache, not od2net.org"),n(2,k=await rt.json());else{let Et=await fetch("https://assets.od2net.org/severance_pbfs/areas.json");n(2,k=await Et.json())}}catch{}});let D;async function F(rt){try{K(await D.files[0].arrayBuffer()),mn(Pu,r="",r)}catch(Et){window.alert(`Couldn't open this file: ${Et}`)}n(1,S=null)}function K(rt){n(1,S="Building map model from OSM input"),console.time("load"),mn(ns,i=new BS(new Uint8Array(rt),r==""?void 0:r),i),console.timeEnd("load");let Et=`ltn_${r||"custom"}.geojson`,mt=window.localStorage.getItem(Et);if(mt)try{i.loadSavefile(JSON.parse(mt))}catch(dt){console.log(`Didn't restore from local storage ${Et}: ${dt}`)}mn(li,x={mode:"network"},x),mn(rd,_=new FT(a,i.toRouteSnapper()),_),a.fitBounds(Array.from(i.getBounds()),{animate:!1}),mn(lg,p=X(),p),mn(ug,u=X(),u)}function W(rt){try{K(new TextEncoder().encode(rt.detail)),mn(Pu,r="",r)}catch(Et){window.alert(`Couldn't import from Overpass: ${Et}`)}n(1,S=null)}async function Q(rt){rt!=""&&(L?await U(`/osm/${rt}.pbf`):await U(`https://assets.od2net.org/severance_pbfs/${rt}.pbf`))}async function U(rt){try{n(1,S=`Downloading ${rt}`);let Et=await fetch(rt);K(await Et.arrayBuffer())}catch(Et){window.alert(`Couldn't open from URL ${rt}: ${Et}`)}n(1,S=null)}function X(){let rt=i.getBounds(),Et=rt[0]+Math.random()*(rt[2]-rt[0]),mt=rt[1]+Math.random()*(rt[3]-rt[1]);return new fg.LngLat(Et,mt)}function Y(){r=SS(this),Pu.set(r),n(2,k)}const pt=()=>Q(r);function gt(rt){yr[rt?"unshift":"push"](()=>{D=rt,n(3,D)})}return[Q,S,k,D,r,a,F,W,K,Y,pt,gt,rt=>n(1,S=rt.detail),rt=>window.alert(rt.detail)]}class KP extends cn{constructor(t){super(),un(this,t,YP,HP,rn,{loadMap:8,loadExample:0})}get loadMap(){return this.$$.ctx[8]}get loadExample(){return this.$$.ctx[0]}}function Eb(e){let t,n,i,r,u,p;return{c(){t=Lt("div"),n=Lt("label"),i=He(`Load a project from a file
          `),r=Lt("input"),Vt(r,"type","file")},m(a,_){Ot(a,t,_),vt(t,n),vt(n,i),vt(n,r),e[7](r),u||(p=Se(r,"change",e[5]),u=!0)},p:Oe,d(a){a&&Rt(t),e[7](null),u=!1,p()}}}function JP(e){let t;return{c(){t=Lt("p"),t.textContent="Waiting for MapLibre and WASM to load..."},m(n,i){Ot(n,t,i)},p:Oe,i:Oe,o:Oe,d(n){n&&Rt(t)}}}function QP(e){let t,n,i={};return t=new KP({props:i}),e[8](t),{c(){ee(t.$$.fragment)},m(r,u){Qt(t,r,u),n=!0},p(r,u){const p={};t.$set(p)},i(r){n||(Ct(t.$$.fragment,r),n=!0)},o(r){At(t.$$.fragment,r),n=!1},d(r){e[8](null),$t(t,r)}}}function $P(e){let t,n,i,r,u,p,a,_,x,S,L,k,D,F,K;n=new XP({});let W=e[1]&&Eb(e);const Q=[QP,JP],U=[];function X(Y,pt){return Y[4]&&Y[0]?0:1}return L=X(e),k=U[L]=Q[L](e),{c(){t=Lt("div"),ee(n.$$.fragment),i=te(),r=Lt("h1"),r.textContent="Choose your study area",u=te(),p=Lt("button"),p.textContent="About the LTN tool",a=te(),W&&W.c(),_=te(),x=Lt("hr"),S=te(),k.c(),Vt(t,"slot","sidebar")},m(Y,pt){Ot(Y,t,pt),Qt(n,t,null),vt(t,i),vt(t,r),vt(t,u),vt(t,p),vt(t,a),W&&W.m(t,null),vt(t,_),vt(t,x),vt(t,S),U[L].m(t,null),D=!0,F||(K=Se(p,"click",e[6]),F=!0)},p(Y,pt){Y[1]?W?W.p(Y,pt):(W=Eb(Y),W.c(),W.m(t,_)):W&&(W.d(1),W=null);let gt=L;L=X(Y),L===gt?U[L].p(Y,pt):(Bi(),At(U[gt],1,1,()=>{U[gt]=null}),Vi(),k=U[L],k?k.p(Y,pt):(k=U[L]=Q[L](Y),k.c()),Ct(k,1),k.m(t,null))},i(Y){D||(Ct(n.$$.fragment,Y),Ct(k),D=!0)},o(Y){At(n.$$.fragment,Y),At(k),D=!1},d(Y){Y&&Rt(t),$t(n),W&&W.d(),U[L].d(),F=!1,K()}}}function tA(e){let t,n,i;return n=new qP({}),{c(){t=Lt("div"),ee(n.$$.fragment),Vt(t,"slot","map")},m(r,u){Ot(r,t,u),Qt(n,t,null),i=!0},p:Oe,i(r){i||(Ct(n.$$.fragment,r),i=!0)},o(r){At(n.$$.fragment,r),i=!1},d(r){r&&Rt(t),$t(n)}}}function eA(e){let t,n;return t=new Xu({props:{$$slots:{map:[tA],sidebar:[$P]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,[r]){const u={};r&4127&&(u.$$scope={dirty:r,ctx:i}),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function nA(e,t,n){let i,r,u,p,a;Ee(e,Pu,K=>n(9,i=K)),Ee(e,rd,K=>n(10,r=K)),Ee(e,ns,K=>n(11,u=K)),Ee(e,ag,K=>n(3,p=K)),Ee(e,nu,K=>n(4,a=K));let{wasmReady:_}=t;mn(ns,u=null,u),mn(rd,r=null,r);let x,S;async function L(K){try{let W=JSON.parse(await S.files[0].text());if(W.study_area_name)mn(Pu,i=W.study_area_name,i),window.localStorage.setItem(`ltn_${W.study_area_name}.geojson`,JSON.stringify(W)),await x.loadExample(W.study_area_name);else{mn(Pu,i="",i);let Q=W.features.find(Y=>Y.properties.kind=="study_area_boundary"),X=await(await fetch(bw(Q))).arrayBuffer();window.localStorage.setItem("ltn_custom.geojson",JSON.stringify(W)),x.loadMap(X)}}catch(W){window.alert(`Couldn't open this file: ${W}`)}}const k=()=>mn(ag,p=!0,p);function D(K){yr[K?"unshift":"push"](()=>{S=K,n(2,S)})}function F(K){yr[K?"unshift":"push"](()=>{x=K,n(1,x)})}return e.$$set=K=>{"wasmReady"in K&&n(0,_=K.wasmReady)},[_,x,S,p,a,L,k,D,F]}class iA extends cn{constructor(t){super(),un(this,t,nA,eA,rn,{wasmReady:0})}}const{window:rA}=bS;function oA(e){let t,n,i,r,u,p,a,_,x,S,L=e[0].shortcutIndex+1+"",k,D,F=e[0].gj.features.length+"",K,W,Q,U,X,Y,pt;return{c(){t=Lt("p"),t.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending outside the
        neighbourhood, but cutting through it. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,n=te(),i=Lt("div"),r=Lt("button"),r.textContent="Pick a different road",u=te(),p=Lt("div"),a=Lt("button"),_=He("Prev"),S=te(),k=He(L),D=He(" / "),K=He(F),W=te(),Q=Lt("button"),U=He("Next"),a.disabled=x=e[0].shortcutIndex==0,Q.disabled=X=e[0].shortcutIndex==e[0].gj.features.length-1},m(gt,ct){Ot(gt,t,ct),Ot(gt,n,ct),Ot(gt,i,ct),vt(i,r),Ot(gt,u,ct),Ot(gt,p,ct),vt(p,a),vt(a,_),vt(p,S),vt(p,k),vt(p,D),vt(p,K),vt(p,W),vt(p,Q),vt(Q,U),Y||(pt=[Se(r,"click",e[7]),Se(a,"click",e[5]),Se(Q,"click",e[6])],Y=!0)},p(gt,ct){ct&1&&x!==(x=gt[0].shortcutIndex==0)&&(a.disabled=x),ct&1&&L!==(L=gt[0].shortcutIndex+1+"")&&Yi(k,L),ct&1&&F!==(F=gt[0].gj.features.length+"")&&Yi(K,F),ct&1&&X!==(X=gt[0].shortcutIndex==gt[0].gj.features.length-1)&&(Q.disabled=X)},d(gt){gt&&(Rt(t),Rt(n),Rt(i),Rt(u),Rt(p)),Y=!1,Xr(pt)}}}function sA(e){let t;return{c(){t=Lt("p"),t.textContent="Click a road to see shortcuts"},m(n,i){Ot(n,t,i)},p:Oe,d(n){n&&Rt(t)}}}function aA(e){let t,n,i,r,u,p;function a(S,L){if(S[0].state=="neutral")return sA;if(S[0].state=="chose-road")return oA}let _=a(e),x=_&&_(e);return{c(){t=Lt("div"),n=Lt("div"),i=Lt("button"),i.textContent="Back to editing",r=te(),x&&x.c(),Vt(t,"slot","sidebar")},m(S,L){Ot(S,t,L),vt(t,n),vt(n,i),vt(t,r),x&&x.m(t,null),u||(p=Se(i,"click",e[4]),u=!0)},p(S,L){_===(_=a(S))&&x?x.p(S,L):(x&&x.d(1),x=_&&_(S),x&&(x.c(),x.m(t,null)))},d(S){S&&Rt(t),x&&x.d(),u=!1,p()}}}function lA(e){let t,n,i,r,u,p;return t=new As({props:{data:wy(JSON.parse(vi(e[1]).renderNeighbourhood())),$$slots:{default:[cA]},$$scope:{ctx:e}}}),i=new As({props:{data:e[0].gj.features[e[0].shortcutIndex],$$slots:{default:[hA]},$$scope:{ctx:e}}}),u=new As({props:{data:e[0].roadGj,$$slots:{default:[pA]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment),n=te(),ee(i.$$.fragment),r=te(),ee(u.$$.fragment)},m(a,_){Qt(t,a,_),Ot(a,n,_),Qt(i,a,_),Ot(a,r,_),Qt(u,a,_),p=!0},p(a,_){const x={};_&2&&(x.data=wy(JSON.parse(vi(a[1]).renderNeighbourhood()))),_&2048&&(x.$$scope={dirty:_,ctx:a}),t.$set(x);const S={};_&1&&(S.data=a[0].gj.features[a[0].shortcutIndex]),_&2048&&(S.$$scope={dirty:_,ctx:a}),i.$set(S);const L={};_&1&&(L.data=a[0].roadGj),_&2048&&(L.$$scope={dirty:_,ctx:a}),u.$set(L)},i(a){p||(Ct(t.$$.fragment,a),Ct(i.$$.fragment,a),Ct(u.$$.fragment,a),p=!0)},o(a){At(t.$$.fragment,a),At(i.$$.fragment,a),At(u.$$.fragment,a),p=!1},d(a){a&&(Rt(n),Rt(r)),$t(t,a),$t(i,a),$t(u,a)}}}function uA(e){let t,n;return t=new Ag({props:{gjInput:JSON.parse(vi(e[1]).renderNeighbourhood()),onClickLine:e[2],$$slots:{"line-popup":[dA]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,r){const u={};r&2&&(u.gjInput=JSON.parse(vi(i[1]).renderNeighbourhood())),r&2048&&(u.$$scope={dirty:r,ctx:i}),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function cA(e){let t,n;const i=[Fr("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.3}}];let r={};for(let u=0;u<i.length;u+=1)r=Ir(r,i[u]);return t=new rp({props:r}),{c(){ee(t.$$.fragment)},m(u,p){Qt(t,u,p),n=!0},p(u,p){const a={};t.$set(a)},i(u){n||(Ct(t.$$.fragment,u),n=!0)},o(u){At(t.$$.fragment,u),n=!1},d(u){$t(t,u)}}}function hA(e){let t,n;const i=[Fr("shortcuts"),{paint:{"line-width":5,"line-color":"red"}}];let r={};for(let u=0;u<i.length;u+=1)r=Ir(r,i[u]);return t=new iu({props:r}),{c(){ee(t.$$.fragment)},m(u,p){Qt(t,u,p),n=!0},p(u,p){const a={};t.$set(a)},i(u){n||(Ct(t.$$.fragment,u),n=!0)},o(u){At(t.$$.fragment,u),n=!1},d(u){$t(t,u)}}}function pA(e){let t,n;const i=[Fr("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let r={};for(let u=0;u<i.length;u+=1)r=Ir(r,i[u]);return t=new iu({props:r}),{c(){ee(t.$$.fragment)},m(u,p){Qt(t,u,p),n=!0},p(u,p){const a={};t.$set(a)},i(u){n||(Ct(t.$$.fragment,u),n=!0)},o(u){At(t.$$.fragment,u),n=!1},d(u){$t(t,u)}}}function fA(e){let t,n=e[10].shortcuts+"",i,r,u=(e[10].name??"unnamed road")+"",p;return{c(){t=Lt("p"),i=He(n),r=He(" shortcuts through "),p=He(u)},m(a,_){Ot(a,t,_),vt(t,i),vt(t,r),vt(t,p)},p(a,_){_&1024&&n!==(n=a[10].shortcuts+"")&&Yi(i,n),_&1024&&u!==(u=(a[10].name??"unnamed road")+"")&&Yi(p,u)},d(a){a&&Rt(t)}}}function dA(e){let t,n,i;return n=new xl({props:{openOn:"hover",$$slots:{default:[fA,({props:r})=>({10:r}),({props:r})=>r?1024:0]},$$scope:{ctx:e}}}),{c(){t=Lt("div"),ee(n.$$.fragment),Vt(t,"slot","line-popup")},m(r,u){Ot(r,t,u),Qt(n,t,null),i=!0},p(r,u){const p={};u&3072&&(p.$$scope={dirty:u,ctx:r}),n.$set(p)},i(r){i||(Ct(n.$$.fragment,r),i=!0)},o(r){At(n.$$.fragment,r),i=!1},d(r){r&&Rt(t),$t(n)}}}function mA(e){let t,n,i,r,u,p;const a=[uA,lA],_=[];function x(S,L){return S[0].state=="neutral"?0:S[0].state=="chose-road"?1:-1}return~(n=x(e))&&(i=_[n]=a[n](e)),u=new kg({}),{c(){t=Lt("div"),i&&i.c(),r=te(),ee(u.$$.fragment),Vt(t,"slot","map")},m(S,L){Ot(S,t,L),~n&&_[n].m(t,null),vt(t,r),Qt(u,t,null),p=!0},p(S,L){let k=n;n=x(S),n===k?~n&&_[n].p(S,L):(i&&(Bi(),At(_[k],1,1,()=>{_[k]=null}),Vi()),~n?(i=_[n],i?i.p(S,L):(i=_[n]=a[n](S),i.c()),Ct(i,1),i.m(t,r)):i=null)},i(S){p||(Ct(i),Ct(u.$$.fragment,S),p=!0)},o(S){At(i),At(u.$$.fragment,S),p=!1},d(S){S&&Rt(t),~n&&_[n].d(),$t(u)}}}function gA(e){let t,n,i,r;return t=new Xu({props:{$$slots:{map:[mA],sidebar:[aA]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment)},m(u,p){Qt(t,u,p),n=!0,i||(r=Se(rA,"keydown",e[3]),i=!0)},p(u,[p]){const a={};p&2051&&(a.$$scope={dirty:p,ctx:u}),t.$set(a)},i(u){n||(Ct(t.$$.fragment,u),n=!0)},o(u){At(t.$$.fragment,u),n=!1},d(u){$t(t,u),i=!1,r()}}}function _A(e,t,n){let i,r,u;Ee(e,li,D=>n(8,i=D)),Ee(e,nu,D=>n(9,r=D)),Ee(e,ns,D=>n(1,u=D));let p={state:"neutral"};function a(D){let F=JSON.parse(u.getShortcutsCrossingRoad(D.properties.id));if(F.features.length==0){window.alert("No shortcuts here");return}n(0,p={state:"chose-road",roadGj:D,gj:F,shortcutIndex:0})}ud(()=>{r==null||r.keyboard.disable()}),Ds(()=>{r==null||r.keyboard.enable()});function _(D){p.state=="chose-road"&&(D.key=="ArrowLeft"&&p.shortcutIndex>0&&(D.stopPropagation(),n(0,p.shortcutIndex--,p)),D.key=="ArrowRight"&&(D.stopPropagation(),p.shortcutIndex!=p.gj.features.length-1&&n(0,p.shortcutIndex++,p)),D.key=="Escape"&&(D.stopPropagation(),x()))}function x(){mn(li,i={mode:"neighbourhood"},i)}function S(){p.state=="chose-road"&&n(0,p.shortcutIndex--,p)}function L(){p.state=="chose-road"&&n(0,p.shortcutIndex++,p)}return[p,u,a,_,x,S,L,()=>n(0,p={state:"neutral"})]}class yA extends cn{constructor(t){super(),un(this,t,_A,gA,rn,{})}}function Ib(e){let t,n,i,r;return{c(){t=Lt("div"),n=Lt("button"),n.textContent="Zoom to fit study area"},m(u,p){Ot(u,t,p),vt(t,n),i||(r=Se(n,"click",e[8]),i=!0)},p:Oe,d(u){u&&Rt(t),i=!1,r()}}}function vA(e){let t,n,i,r,u,p,a,_,x,S,L,k,D=e[6]&&Ib(e);return{c(){t=Lt("div"),n=Lt("div"),i=te(),r=Lt("hr"),u=te(),D&&D.c(),p=te(),a=Lt("div"),_=Lt("label"),x=Lt("input"),S=He("Show basemap"),Vt(x,"type","checkbox"),Vt(t,"slot","left")},m(F,K){Ot(F,t,K),vt(t,n),e[14](n),vt(t,i),vt(t,r),vt(t,u),D&&D.m(t,null),vt(t,p),vt(t,a),vt(a,_),vt(_,x),x.checked=e[0],vt(_,S),L||(k=Se(x,"change",e[15]),L=!0)},p(F,K){F[6]?D?D.p(F,K):(D=Ib(F),D.c(),D.m(t,p)):D&&(D.d(1),D=null),K&1&&(x.checked=F[0])},d(F){F&&Rt(t),e[14](null),D&&D.d(),L=!1,k()}}}function Cb(e){let t,n;return t=new iA({props:{wasmReady:e[4]}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,r){const u={};r&16&&(u.wasmReady=i[4]),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function Tb(e){let t,n,i,r,u,p;t=new As({props:{data:JSON.parse(e[6].getInvertedBoundary()),$$slots:{default:[bA]},$$scope:{ctx:e}}});const a=[TA,CA,IA,EA,SA,wA,xA],_=[];function x(S,L){return S[7].mode=="network"?0:S[7].mode=="set-boundary"?1:S[7].mode=="neighbourhood"?2:S[7].mode=="view-shortcuts"?3:S[7].mode=="route"?4:S[7].mode=="debug"?5:S[7].mode=="debug-gj"?6:-1}return~(i=x(e))&&(r=_[i]=a[i](e)),{c(){ee(t.$$.fragment),n=te(),r&&r.c(),u=bs()},m(S,L){Qt(t,S,L),Ot(S,n,L),~i&&_[i].m(S,L),Ot(S,u,L),p=!0},p(S,L){const k={};L&64&&(k.data=JSON.parse(S[6].getInvertedBoundary())),L&131072&&(k.$$scope={dirty:L,ctx:S}),t.$set(k);let D=i;i=x(S),i===D?~i&&_[i].p(S,L):(r&&(Bi(),At(_[D],1,1,()=>{_[D]=null}),Vi()),~i?(r=_[i],r?r.p(S,L):(r=_[i]=a[i](S),r.c()),Ct(r,1),r.m(u.parentNode,u)):r=null)},i(S){p||(Ct(t.$$.fragment,S),Ct(r),p=!0)},o(S){At(t.$$.fragment,S),At(r),p=!1},d(S){S&&(Rt(n),Rt(u)),$t(t,S),~i&&_[i].d(S)}}}function bA(e){let t,n;const i=[Fr("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let r={};for(let u=0;u<i.length;u+=1)r=Ir(r,i[u]);return t=new rp({props:r}),{c(){ee(t.$$.fragment)},m(u,p){Qt(t,u,p),n=!0},p(u,p){const a={};t.$set(a)},i(u){n||(Ct(t.$$.fragment,u),n=!0)},o(u){At(t.$$.fragment,u),n=!1},d(u){$t(t,u)}}}function xA(e){let t,n;return t=new OM({}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p:Oe,i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function wA(e){let t,n;return t=new CM({}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p:Oe,i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function SA(e){let t,n;return t=new IP({props:{prevMode:e[7].prevMode}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,r){const u={};r&128&&(u.prevMode=i[7].prevMode),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function EA(e){let t,n;return t=new yA({}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p:Oe,i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function IA(e){let t,n;return t=new uP({}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p:Oe,i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function CA(e){let t,n;return t=new BP({props:{name:e[7].name,existing:e[7].existing}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,r){const u={};r&128&&(u.name=i[7].name),r&128&&(u.existing=i[7].existing),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function TA(e){let t,n;return t=new _P({}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p:Oe,i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function LA(e){let t,n,i,r,u,p,a;t=new UT({});let _=e[7].mode=="title"&&Cb(e),x=e[6]&&Tb(e);return{c(){ee(t.$$.fragment),n=te(),i=Lt("div"),r=te(),_&&_.c(),u=te(),x&&x.c(),p=bs()},m(S,L){Qt(t,S,L),Ot(S,n,L),Ot(S,i,L),e[11](i),Ot(S,r,L),_&&_.m(S,L),Ot(S,u,L),x&&x.m(S,L),Ot(S,p,L),a=!0},p(S,L){S[7].mode=="title"?_?(_.p(S,L),L&128&&Ct(_,1)):(_=Cb(S),_.c(),Ct(_,1),_.m(u.parentNode,u)):_&&(Bi(),At(_,1,1,()=>{_=null}),Vi()),S[6]?x?(x.p(S,L),L&64&&Ct(x,1)):(x=Tb(S),x.c(),Ct(x,1),x.m(p.parentNode,p)):x&&(Bi(),At(x,1,1,()=>{x=null}),Vi())},i(S){a||(Ct(t.$$.fragment,S),Ct(_),Ct(x),a=!0)},o(S){At(t.$$.fragment,S),At(_),At(x),a=!1},d(S){S&&(Rt(n),Rt(i),Rt(r),Rt(u),Rt(p)),$t(t,S),e[11](null),_&&_.d(S),x&&x.d(S)}}}function MA(e){let t,n,i,r;function u(a){e[12](a)}let p={style:e[5],standardControls:!0,hash:!0,images:[{id:"walk_cycle_only",url:"/ltn//filters/walk_cycle_only_icon.gif"},{id:"no_entry",url:"/ltn//filters/no_entry_icon.gif"},{id:"bus_gate",url:"/ltn//filters/bus_gate_icon.gif"},{id:"school_street",url:"/ltn//filters/school_street_icon.gif"}],$$slots:{default:[LA]},$$scope:{ctx:e}};return e[1]!==void 0&&(p.map=e[1]),n=new OE({props:p}),yr.push(()=>Du(n,"map",u)),n.$on("error",e[13]),{c(){t=Lt("div"),ee(n.$$.fragment),Vt(t,"slot","main"),ul(t,"position","relative"),ul(t,"width","100%"),ul(t,"height","100vh")},m(a,_){Ot(a,t,_),Qt(n,t,null),r=!0},p(a,_){const x={};_&32&&(x.style=a[5]),_&131288&&(x.$$scope={dirty:_,ctx:a}),!i&&_&2&&(i=!0,x.map=a[1],Nu(()=>i=!1)),n.$set(x)},i(a){r||(Ct(n.$$.fragment,a),r=!0)},o(a){At(n.$$.fragment,a),r=!1},d(a){a&&Rt(t),$t(n)}}}function PA(e){let t,n;return t=new WT({props:{$$slots:{main:[MA],left:[vA]},$$scope:{ctx:e}}}),{c(){ee(t.$$.fragment)},m(i,r){Qt(t,i,r),n=!0},p(i,[r]){const u={};r&131327&&(u.$$scope={dirty:r,ctx:i}),t.$set(u)},i(i){n||(Ct(t.$$.fragment,i),n=!0)},o(i){At(t.$$.fragment,i),n=!1},d(i){$t(t,i)}}}function AA(e,t,n){let i,r,u,p,a,_;Ee(e,vy,Y=>n(9,r=Y)),Ee(e,yy,Y=>n(10,u=Y)),Ee(e,ns,Y=>n(6,p=Y)),Ee(e,nu,Y=>n(16,a=Y)),Ee(e,li,Y=>n(7,_=Y));let x=!1;ud(async()=>{await Bb(),await Ub(),n(4,x=!0)});let S=!0,L;function k(){a.fitBounds(Array.from(p.getBounds()),{animate:!1})}let D,F;function K(Y){yr[Y?"unshift":"push"](()=>{F=Y,n(3,F),n(9,r)})}function W(Y){L=Y,n(1,L)}const Q=Y=>{console.log(Y.detail.error)};function U(Y){yr[Y?"unshift":"push"](()=>{D=Y,n(2,D),n(10,u)})}function X(){S=this.checked,n(0,S)}return e.$$.update=()=>{e.$$.dirty&1&&n(5,i=S?`https://api.maptiler.com/maps/dataviz/style.json?key=${$x}`:{version:8,sources:{},layers:[]}),e.$$.dirty&2&&L&&nu.set(L),e.$$.dirty&1028&&D&&u&&(n(2,D.innerHTML="",D),D.appendChild(u)),e.$$.dirty&520&&F&&r&&(n(3,F.innerHTML="",F),F.appendChild(r))},[S,L,D,F,x,i,p,_,k,r,u,K,W,Q,U,X]}class kA extends cn{constructor(t){super(),un(this,t,AA,PA,rn,{})}}new kA({target:document.getElementById("app")});
