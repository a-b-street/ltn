var N2=Object.defineProperty;var j2=(r,e,t)=>e in r?N2(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Lr=(r,e,t)=>(j2(r,typeof e!="symbol"?e+"":e,t),t);function U2(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in r)){const o=Object.getOwnPropertyDescriptor(n,i);o&&Object.defineProperty(r,i,o.get?o:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function rt(){}function Gt(r,e){for(const t in e)r[t]=e[t];return r}function V2(r){return!!r&&(typeof r=="object"||typeof r=="function")&&typeof r.then=="function"}function hb(r){return r()}function Ag(){return Object.create(null)}function mr(r){r.forEach(hb)}function zc(r){return typeof r=="function"}function xt(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let Bf;function cr(r,e){return r===e?!0:(Bf||(Bf=document.createElement("a")),Bf.href=e,r===Bf.href)}function q2(r){return Object.keys(r).length===0}function fb(r,...e){if(r==null){for(const n of e)n(void 0);return rt}const t=r.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function pi(r){let e;return fb(r,t=>e=t)(),e}function st(r,e,t){r.$$.on_destroy.push(fb(e,t))}function En(r,e,t,n){if(r){const i=db(r,e,t,n);return r[0](i)}}function db(r,e,t,n){return r[1]&&n?Gt(t.ctx.slice(),r[1](n(e))):t.ctx}function In(r,e,t,n){if(r[2]&&n){const i=r[2](n(t));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],u=Math.max(e.dirty.length,i.length);for(let a=0;a<u;a+=1)o[a]=e.dirty[a]|i[a];return o}return e.dirty|i}return e.dirty}function An(r,e,t,n,i,o){if(i){const u=db(e,t,n,o);r.p(u,i)}}function Pn(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function mo(r){const e={};for(const t in r)t[0]!=="$"&&(e[t]=r[t]);return e}function Pg(r,e){const t={};e=new Set(e);for(const n in r)!e.has(n)&&n[0]!=="$"&&(t[n]=r[n]);return t}function Im(r){const e={};for(const t in r)e[t]=!0;return e}function nd(r){return r??""}function Ot(r,e,t){return r.set(t),e}function Jp(r){return r&&zc(r.destroy)?r.destroy:rt}const pb=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function $(r,e){r.appendChild(e)}function q(r,e,t){r.insertBefore(e,t||null)}function V(r){r.parentNode&&r.parentNode.removeChild(r)}function mi(r,e){for(let t=0;t<r.length;t+=1)r[t]&&r[t].d(e)}function U(r){return document.createElement(r)}function hs(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function xe(r){return document.createTextNode(r)}function oe(){return xe(" ")}function Jn(){return xe("")}function yt(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function Am(r){return function(e){return e.preventDefault(),r.call(this,e)}}function eh(r){return function(e){return e.stopPropagation(),r.call(this,e)}}function ue(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function rd(r,e){for(const t in e)ue(r,t,e[t])}function Z2(r,e,t){const n=new Set;for(let i=0;i<r.length;i+=1)r[i].checked&&n.add(r[i].__value);return t||n.delete(e),Array.from(n)}function Pm(r){let e;return{p(...t){e=t,e.forEach(n=>r.push(n))},r(){e.forEach(t=>r.splice(r.indexOf(t),1))}}}function hl(r){return r===""?null:+r}function G2(r){return Array.from(r.childNodes)}function St(r,e){e=""+e,r.data!==e&&(r.data=e)}function qn(r,e){r.value=e??""}function ut(r,e,t,n){t==null?r.style.removeProperty(e):r.style.setProperty(e,t,n?"important":"")}function qi(r,e,t){for(let n=0;n<r.options.length;n+=1){const i=r.options[n];if(i.__value===e){i.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function va(r){const e=r.querySelector(":checked");return e&&e.__value}function Yt(r,e,t){r.classList.toggle(e,!!t)}function H2(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}let uh;function Zs(r){uh=r}function Dc(){if(!uh)throw new Error("Function called outside component initialization");return uh}function Ts(r){Dc().$$.on_mount.push(r)}function ti(r){Dc().$$.on_destroy.push(r)}function ds(){const r=Dc();return(e,t,{cancelable:n=!1}={})=>{const i=r.$$.callbacks[e];if(i){const o=H2(e,t,{cancelable:n});return i.slice().forEach(u=>{u.call(r,o)}),!o.defaultPrevented}return!0}}function md(r,e){return Dc().$$.context.set(r,e),e}function xh(r){return Dc().$$.context.get(r)}function Mn(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const xc=[],un=[];let Mc=[];const Yp=[],mb=Promise.resolve();let Qp=!1;function _b(){Qp||(Qp=!0,mb.then(zm))}function gb(){return _b(),mb}function ls(r){Mc.push(r)}function Sn(r){Yp.push(r)}const $p=new Set;let mc=0;function zm(){if(mc!==0)return;const r=uh;do{try{for(;mc<xc.length;){const e=xc[mc];mc++,Zs(e),W2(e.$$)}}catch(e){throw xc.length=0,mc=0,e}for(Zs(null),xc.length=0,mc=0;un.length;)un.pop()();for(let e=0;e<Mc.length;e+=1){const t=Mc[e];$p.has(t)||($p.add(t),t())}Mc.length=0}while(xc.length);for(;Yp.length;)Yp.pop()();Qp=!1,$p.clear(),Zs(r)}function W2(r){if(r.fragment!==null){r.update(),mr(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(ls)}}function K2(r){const e=[],t=[];Mc.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Mc=e}const Gf=new Set;let cl;function tn(){cl={r:0,c:[],p:cl}}function nn(){cl.r||mr(cl.c),cl=cl.p}function j(r,e){r&&r.i&&(Gf.delete(r),r.i(e))}function G(r,e,t,n){if(r&&r.o){if(Gf.has(r))return;Gf.add(r),cl.c.push(()=>{Gf.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function zg(r,e){const t=e.token={};function n(i,o,u,a){if(e.token!==t)return;e.resolved=a;let d=e.ctx;u!==void 0&&(d=d.slice(),d[u]=a);const p=i&&(e.current=i)(d);let g=!1;e.block&&(e.blocks?e.blocks.forEach((y,w)=>{w!==o&&y&&(tn(),G(y,1,1,()=>{e.blocks[w]===y&&(e.blocks[w]=null)}),nn())}):e.block.d(1),p.c(),j(p,1),p.m(e.mount(),e.anchor),g=!0),e.block=p,e.blocks&&(e.blocks[o]=p),g&&zm()}if(V2(r)){const i=Dc();if(r.then(o=>{Zs(i),n(e.then,1,e.value,o),Zs(null)},o=>{if(Zs(i),n(e.catch,2,e.error,o),Zs(null),!e.hasCatch)throw o}),e.current!==e.pending)return n(e.pending,0),!0}else{if(e.current!==e.then)return n(e.then,1,e.value,r),!0;e.resolved=r}}function X2(r,e,t){const n=e.slice(),{resolved:i}=r;r.current===r.then&&(n[r.value]=i),r.current===r.catch&&(n[r.error]=i),r.block.p(n,t)}function $n(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function J2(r,e){G(r,1,1,()=>{e.delete(r.key)})}function Y2(r,e,t,n,i,o,u,a,d,p,g,y){let w=r.length,T=o.length,L=w;const D={};for(;L--;)D[r[L].key]=L;const R=[],z=new Map,I=new Map,F=[];for(L=T;L--;){const J=y(i,o,L),Y=t(J);let _e=u.get(Y);_e?n&&F.push(()=>_e.p(J,e)):(_e=p(Y,J),_e.c()),z.set(Y,R[L]=_e),Y in D&&I.set(Y,Math.abs(L-D[Y]))}const N=new Set,W=new Set;function se(J){j(J,1),J.m(a,g),u.set(J.key,J),g=J.first,T--}for(;w&&T;){const J=R[T-1],Y=r[w-1],_e=J.key,ze=Y.key;J===Y?(g=J.first,w--,T--):z.has(ze)?!u.has(_e)||N.has(_e)?se(J):W.has(ze)?w--:I.get(_e)>I.get(ze)?(W.add(_e),se(J)):(N.add(ze),w--):(d(Y,u),w--)}for(;w--;){const J=r[w];z.has(J.key)||d(J,u)}for(;T;)se(R[T-1]);return mr(F),R}function Zn(r,e){const t={},n={},i={$$scope:1};let o=r.length;for(;o--;){const u=r[o],a=e[o];if(a){for(const d in u)d in a||(n[d]=1);for(const d in a)i[d]||(t[d]=a[d],i[d]=1);r[o]=a}else for(const d in u)i[d]=1}for(const u in n)u in t||(t[u]=void 0);return t}function Rc(r){return typeof r=="object"&&r!==null?r:{}}function Cn(r,e,t){const n=r.$$.props[e];n!==void 0&&(r.$$.bound[n]=t,t(r.$$.ctx[n]))}function de(r){r&&r.c()}function he(r,e,t){const{fragment:n,after_update:i}=r.$$;n&&n.m(e,t),ls(()=>{const o=r.$$.on_mount.map(hb).filter(zc);r.$$.on_destroy?r.$$.on_destroy.push(...o):mr(o),r.$$.on_mount=[]}),i.forEach(ls)}function fe(r,e){const t=r.$$;t.fragment!==null&&(K2(t.after_update),mr(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Q2(r,e){r.$$.dirty[0]===-1&&(xc.push(r),_b(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Et(r,e,t,n,i,o,u=null,a=[-1]){const d=uh;Zs(r);const p=r.$$={fragment:null,ctx:[],props:o,update:rt,not_equal:i,bound:Ag(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:Ag(),dirty:a,skip_bound:!1,root:e.target||d.$$.root};u&&u(p.root);let g=!1;if(p.ctx=t?t(r,e.props||{},(y,w,...T)=>{const L=T.length?T[0]:w;return p.ctx&&i(p.ctx[y],p.ctx[y]=L)&&(!p.skip_bound&&p.bound[y]&&p.bound[y](L),g&&Q2(r,y)),w}):[],p.update(),g=!0,mr(p.before_update),p.fragment=n?n(p.ctx):!1,e.target){if(e.hydrate){const y=G2(e.target);p.fragment&&p.fragment.l(y),y.forEach(V)}else p.fragment&&p.fragment.c();e.intro&&j(r.$$.fragment),he(r,e.target,e.anchor),zm()}Zs(d)}class It{constructor(){Lr(this,"$$");Lr(this,"$$set")}$destroy(){fe(this,1),this.$destroy=rt}$on(e,t){if(!zc(t))return rt;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!q2(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const ex="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ex);const tx="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",nx="/ltn/assets/logo-97f2d067.svg",yb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAJCAYAAAACTR1pAAAACXBIWXMAAANVAAADaAEorMqLAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAPtJREFUKJF9kT1LwwAURc+NAQsdtFYHa8HBSAcHJ0HBUVz0n7i4ObkoKAV/gYObm5ubu7OKFMQPECFuoQgWRJtch9aSYvSO770D53Flm58kM401BdkesAJcYw4m4scz8kf9qGBGe3ZuNcuCHcEmcGv7qBo/nWKnAzCpR8+/yMGWUWAcU0L6wn4DOgAhcFHEGEoBLGAqoK7te6Eb406h6vv0/NRnyBawDYyATzKFzcmXu9chmaQeHfesVDZeFGqAU0QrMy3BR5FRCKz31FxGGrMdIrpATVD98/0hVSlo16INB9oFLyEuldKsxA/n/4O59DvdB5YNVzKH+U6/AaiZavkY71DDAAAAAElFTkSuQmCC";function Dg(r){let e,t,n,i=r[1]!=null&&Rg(r);return{c(){e=U("div"),t=xe(r[0]),n=oe(),i&&i.c(),ue(e,"class","cover svelte-1w7hi45")},m(o,u){q(o,e,u),$(e,t),$(e,n),i&&i.m(e,null)},p(o,u){u&1&&St(t,o[0]),o[1]!=null?i?i.p(o,u):(i=Rg(o),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},d(o){o&&V(e),i&&i.d()}}}function Rg(r){let e,t;return{c(){e=U("div"),t=U("progress"),t.value=r[1],ut(t,"width","100%")},m(n,i){q(n,e,i),$(e,t)},p(n,i){i&2&&(t.value=n[1])},d(n){n&&V(e)}}}function rx(r){let e,t=r[0]&&Dg(r);return{c(){t&&t.c(),e=Jn()},m(n,i){t&&t.m(n,i),q(n,e,i)},p(n,[i]){n[0]?t?t.p(n,i):(t=Dg(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:rt,o:rt,d(n){n&&V(e),t&&t.d(n)}}}function ix(r,e,t){let{loading:n}=e,{progress:i=null}=e;return r.$$set=o=>{"loading"in o&&t(0,n=o.loading),"progress"in o&&t(1,i=o.progress)},[n,i]}class kh extends It{constructor(e){super(),Et(this,e,ix,rx,xt,{loading:0,progress:1})}}function ox(r){let e,t,n,i,o;const u=r[5].default,a=En(u,r,r[4],null);return{c(){e=U("dialog"),t=U("article"),a&&a.c()},m(d,p){q(d,e,p),$(e,t),a&&a.m(t,null),r[6](e),n=!0,i||(o=[yt(e,"click",eh(r[1])),yt(e,"keydown",r[2])],i=!0)},p(d,[p]){a&&a.p&&(!n||p&16)&&An(a,u,d,d[4],n?In(u,d[4],p,null):Pn(d[4]),null)},i(d){n||(j(a,d),n=!0)},o(d){G(a,d),n=!1},d(d){d&&V(e),a&&a.d(d),r[6](null),i=!1,mr(o)}}}function sx(r,e,t){let{$$slots:n={},$$scope:i}=e,{show:o=!1}=e,u;function a(g){g.target==u&&t(3,o=!1)}function d(g){(g.key=="Escape"||g.key=="Enter")&&(g.stopPropagation(),t(3,o=!1))}function p(g){un[g?"unshift":"push"](()=>{u=g,t(0,u)})}return r.$$set=g=>{"show"in g&&t(3,o=g.show),"$$scope"in g&&t(4,i=g.$$scope)},r.$$.update=()=>{r.$$.dirty&9&&u&&(o?u.showModal():u.close())},[u,a,d,o,i,n,p]}class _d extends It{constructor(e){super(),Et(this,e,sx,ox,xt,{show:3})}}function $g(r,e,t){const n=r.slice();return n[1]=e[t][0],n[2]=e[t][1],n}function Fg(r){let e,t,n=r[1]+"",i,o,u,a=r[2]+"",d,p;return{c(){e=U("tr"),t=U("td"),i=xe(n),o=oe(),u=U("td"),d=xe(a),p=oe()},m(g,y){q(g,e,y),$(e,t),$(t,i),$(e,o),$(e,u),$(u,d),$(e,p)},p(g,y){y&1&&n!==(n=g[1]+"")&&St(i,n),y&1&&a!==(a=g[2]+"")&&St(d,a)},d(g){g&&V(e)}}}function ax(r){let e,t,n=$n(Object.entries(r[0])),i=[];for(let o=0;o<n.length;o+=1)i[o]=Fg($g(r,n,o));return{c(){e=U("table"),t=U("tbody");for(let o=0;o<i.length;o+=1)i[o].c();ue(e,"class","svelte-lh2o9l")},m(o,u){q(o,e,u),$(e,t);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(t,null)},p(o,[u]){if(u&1){n=$n(Object.entries(o[0]));let a;for(a=0;a<n.length;a+=1){const d=$g(o,n,a);i[a]?i[a].p(d,u):(i[a]=Fg(d),i[a].c(),i[a].m(t,null))}for(;a<i.length;a+=1)i[a].d(1);i.length=n.length}},i:rt,o:rt,d(o){o&&V(e),mi(i,o)}}}function lx(r,e,t){let{properties:n}=e;return r.$$set=i=>{"properties"in i&&t(0,n=i.properties)},[n]}class Sh extends It{constructor(e){super(),Et(this,e,lx,ax,xt,{properties:0})}}function gd(r,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Er(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}var bb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vb(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Dm(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var wb={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(r,e){(function(t,n){r.exports=n()})(bb,function(){var t={},n={};function i(u,a,d){if(n[u]=d,u==="index"){var p="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",g={};return n.shared(g),n.index(t,g),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([p],{type:"text/javascript"}))),t}}i("shared",["exports"],function(u){function a(c,s,h,m){return new(h||(h=Promise))(function(v,S){function C(O){try{P(m.next(O))}catch(H){S(H)}}function M(O){try{P(m.throw(O))}catch(H){S(H)}}function P(O){var H;O.done?v(O.value):(H=O.value,H instanceof h?H:new h(function(K){K(H)})).then(C,M)}P((m=m.apply(c,s||[])).next())})}function d(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}typeof SuppressedError=="function"&&SuppressedError;var p=g;function g(c,s){this.x=c,this.y=s}g.prototype={clone:function(){return new g(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,s){return this.clone()._rotateAround(c,s)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var s=c.x-this.x,h=c.y-this.y;return s*s+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,s){return Math.atan2(this.x*s-this.y*c,this.x*c+this.y*s)},_matMult:function(c){var s=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=s,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var s=Math.cos(c),h=Math.sin(c),m=h*this.x+s*this.y;return this.x=s*this.x-h*this.y,this.y=m,this},_rotateAround:function(c,s){var h=Math.cos(c),m=Math.sin(c),v=s.y+m*(this.x-s.x)+h*(this.y-s.y);return this.x=s.x+h*(this.x-s.x)-m*(this.y-s.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},g.convert=function(c){return c instanceof g?c:Array.isArray(c)?new g(c[0],c[1]):c};var y=d(p),w=T;function T(c,s,h,m){this.cx=3*c,this.bx=3*(h-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(m-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=s,this.p2x=h,this.p2y=m}T.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,s){if(s===void 0&&(s=1e-6),c<0)return 0;if(c>1)return 1;for(var h=c,m=0;m<8;m++){var v=this.sampleCurveX(h)-c;if(Math.abs(v)<s)return h;var S=this.sampleCurveDerivativeX(h);if(Math.abs(S)<1e-6)break;h-=v/S}var C=0,M=1;for(h=c,m=0;m<20&&(v=this.sampleCurveX(h),!(Math.abs(v-c)<s));m++)c>v?C=h:M=h,h=.5*(M-C)+C;return h},solve:function(c,s){return this.sampleCurveY(this.solveCurveX(c,s))}};var L=d(w);let D,R;function z(){return D==null&&(D=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),D}function I(){if(R==null&&(R=!1,z())){const s=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(s){for(let m=0;m<5*5;m++){const v=4*m;s.fillStyle=`rgb(${v},${v+1},${v+2})`,s.fillRect(m%5,Math.floor(m/5),1,1)}const h=s.getImageData(0,0,5,5).data;for(let m=0;m<5*5*4;m++)if(m%4!=3&&h[m]!==m){R=!0;break}}}return R||!1}function F(c,s,h,m){const v=new L(c,s,h,m);return function(S){return v.solve(S)}}const N=F(.25,.1,.25,1);function W(c,s,h){return Math.min(h,Math.max(s,c))}function se(c,s,h){const m=h-s,v=((c-s)%m+m)%m+s;return v===s?h:v}function J(c,...s){for(const h of s)for(const m in h)c[m]=h[m];return c}let Y=1;function _e(c,s,h){const m={};for(const v in c)m[v]=s.call(h||this,c[v],v,c);return m}function ze(c,s,h){const m={};for(const v in c)s.call(h||this,c[v],v,c)&&(m[v]=c[v]);return m}function ee(c){return Array.isArray(c)?c.map(ee):typeof c=="object"&&c?_e(c,ee):c}const ae={};function Ee(c){ae[c]||(typeof console<"u"&&console.warn(c),ae[c]=!0)}function we(c,s,h){return(h.y-c.y)*(s.x-c.x)>(s.y-c.y)*(h.x-c.x)}function it(c){let s=0;for(let h,m,v=0,S=c.length,C=S-1;v<S;C=v++)h=c[v],m=c[C],s+=(m.x-h.x)*(h.y+m.y);return s}function Ge(c){return typeof WorkerGlobalScope<"u"&&c!==void 0&&c instanceof WorkerGlobalScope}let Ie=null;function De(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const Ct="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function nt(c,s,h,m,v){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const S=new VideoFrame(c,{timestamp:0});try{const C=S==null?void 0:S.format;if(!C||!C.startsWith("BGR")&&!C.startsWith("RGB"))throw new Error(`Unrecognized format ${C}`);const M=C.startsWith("BGR"),P=new Uint8ClampedArray(m*v*4);if(yield S.copyTo(P,function(O,H,K,re,ce){const me=4*Math.max(-H,0),ve=(Math.max(0,K)-K)*re*4+me,Te=4*re,Pe=Math.max(0,H),Ze=Math.max(0,K);return{rect:{x:Pe,y:Ze,width:Math.min(O.width,H+re)-Pe,height:Math.min(O.height,K+ce)-Ze},layout:[{offset:ve,stride:Te}]}}(c,s,h,m,v)),M)for(let O=0;O<P.length;O+=4){const H=P[O];P[O]=P[O+2],P[O+2]=H}return P}finally{S.close()}})}let lt,mt;const ht="AbortError";function We(){return new Error(ht)}const Bt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Lt(c){return Bt.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))]}const Nt="global-dispatcher";class Mt extends Error{constructor(s,h,m,v){super(`AJAXError: ${h} (${s}): ${m}`),this.status=s,this.statusText=h,this.url=m,this.body=v}}const Qt=()=>Ge(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,bt=function(c,s){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){const m=Lt(c.url);if(m)return m(c,s);if(Ge(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,targetMapId:Nt},s)}if(!(/^file:/.test(h=c.url)||/^file:/.test(Qt())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(m,v){return a(this,void 0,void 0,function*(){const S=new Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,cache:m.cache,referrer:Qt(),signal:v.signal});m.type==="json"&&S.headers.set("Accept","application/json");const C=yield fetch(S);if(!C.ok){const O=yield C.blob();throw new Mt(C.status,C.statusText,m.url,O)}let M;M=m.type==="arrayBuffer"||m.type==="image"?C.arrayBuffer():m.type==="json"?C.json():C.text();const P=yield M;if(v.signal.aborted)throw We();return{data:P,cacheControl:C.headers.get("Cache-Control"),expires:C.headers.get("Expires")}})}(c,s);if(Ge(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,mustQueue:!0,targetMapId:Nt},s)}var h;return function(m,v){return new Promise((S,C)=>{const M=new XMLHttpRequest;M.open(m.method||"GET",m.url,!0),m.type!=="arrayBuffer"&&m.type!=="image"||(M.responseType="arraybuffer");for(const P in m.headers)M.setRequestHeader(P,m.headers[P]);m.type==="json"&&(M.responseType="text",M.setRequestHeader("Accept","application/json")),M.withCredentials=m.credentials==="include",M.onerror=()=>{C(new Error(M.statusText))},M.onload=()=>{if(!v.signal.aborted)if((M.status>=200&&M.status<300||M.status===0)&&M.response!==null){let P=M.response;if(m.type==="json")try{P=JSON.parse(M.response)}catch(O){return void C(O)}S({data:P,cacheControl:M.getResponseHeader("Cache-Control"),expires:M.getResponseHeader("Expires")})}else{const P=new Blob([M.response],{type:M.getResponseHeader("Content-Type")});C(new Mt(M.status,M.statusText,m.url,P))}},v.signal.addEventListener("abort",()=>{M.abort(),C(We())}),M.send(m.body)})}(c,s)};function Dt(c){if(!c||c.indexOf("://")<=0||c.indexOf("data:image/")===0||c.indexOf("blob:")===0)return!0;const s=new URL(c),h=window.location;return s.protocol===h.protocol&&s.host===h.host}function pn(c,s,h){h[c]&&h[c].indexOf(s)!==-1||(h[c]=h[c]||[],h[c].push(s))}function qe(c,s,h){if(h&&h[c]){const m=h[c].indexOf(s);m!==-1&&h[c].splice(m,1)}}class Ve{constructor(s,h={}){J(this,h),this.type=s}}class kt extends Ve{constructor(s,h={}){super("error",J({error:s},h))}}class Ut{on(s,h){return this._listeners=this._listeners||{},pn(s,h,this._listeners),this}off(s,h){return qe(s,h,this._listeners),qe(s,h,this._oneTimeListeners),this}once(s,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},pn(s,h,this._oneTimeListeners),this):new Promise(m=>this.once(s,m))}fire(s,h){typeof s=="string"&&(s=new Ve(s,h||{}));const m=s.type;if(this.listens(m)){s.target=this;const v=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const M of v)M.call(this,s);const S=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const M of S)qe(m,M,this._oneTimeListeners),M.call(this,s);const C=this._eventedParent;C&&(J(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),C.fire(s))}else s instanceof kt&&console.error(s.error);return this}listens(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)}setEventedParent(s,h){return this._eventedParent=s,this._eventedParentData=h,this}}var ye={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const zn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Oe(c,s){const h={};for(const m in c)m!=="ref"&&(h[m]=c[m]);return zn.forEach(m=>{m in s&&(h[m]=s[m])}),h}function tt(c,s){if(Array.isArray(c)){if(!Array.isArray(s)||c.length!==s.length)return!1;for(let h=0;h<c.length;h++)if(!tt(c[h],s[h]))return!1;return!0}if(typeof c=="object"&&c!==null&&s!==null){if(typeof s!="object"||Object.keys(c).length!==Object.keys(s).length)return!1;for(const h in c)if(!tt(c[h],s[h]))return!1;return!0}return c===s}function Kt(c,s){c.push(s)}function Un(c,s,h){Kt(h,{command:"addSource",args:[c,s[c]]})}function ur(c,s,h){Kt(s,{command:"removeSource",args:[c]}),h[c]=!0}function pr(c,s,h,m){ur(c,h,m),Un(c,s,h)}function Ar(c,s,h){let m;for(m in c[h])if(Object.prototype.hasOwnProperty.call(c[h],m)&&m!=="data"&&!tt(c[h][m],s[h][m]))return!1;for(m in s[h])if(Object.prototype.hasOwnProperty.call(s[h],m)&&m!=="data"&&!tt(c[h][m],s[h][m]))return!1;return!0}function Pr(c,s,h,m,v,S){c=c||{},s=s||{};for(const C in c)Object.prototype.hasOwnProperty.call(c,C)&&(tt(c[C],s[C])||h.push({command:S,args:[m,C,s[C],v]}));for(const C in s)Object.prototype.hasOwnProperty.call(s,C)&&!Object.prototype.hasOwnProperty.call(c,C)&&(tt(c[C],s[C])||h.push({command:S,args:[m,C,s[C],v]}))}function go(c){return c.id}function hr(c,s){return c[s.id]=s,c}class vt{constructor(s,h,m,v){this.message=(s?`${s}: `:"")+m,v&&(this.identifier=v),h!=null&&h.__line__&&(this.line=h.__line__)}}function Vr(c,...s){for(const h of s)for(const m in h)c[m]=h[m];return c}class or extends Error{constructor(s,h){super(h),this.message=h,this.key=s}}class Kn{constructor(s,h=[]){this.parent=s,this.bindings={};for(const[m,v]of h)this.bindings[m]=v}concat(s){return new Kn(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const Yn={kind:"null"},Pt={kind:"number"},sn={kind:"string"},mn={kind:"boolean"},Qn={kind:"color"},_i={kind:"object"},_n={kind:"value"},Nr={kind:"collator"},_r={kind:"formatted"},Ce={kind:"padding"},te={kind:"resolvedImage"},ie={kind:"variableAnchorOffsetCollection"};function le(c,s){return{kind:"array",itemType:c,N:s}}function ge(c){if(c.kind==="array"){const s=ge(c.itemType);return typeof c.N=="number"?`array<${s}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${s}>`}return c.kind}const Ae=[Yn,Pt,sn,mn,Qn,_r,_i,le(_n),Ce,te,ie];function Be(c,s){if(s.kind==="error")return null;if(c.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Be(c.itemType,s.itemType))&&(typeof c.N!="number"||c.N===s.N))return null}else{if(c.kind===s.kind)return null;if(c.kind==="value"){for(const h of Ae)if(!Be(h,s))return null}}return`Expected ${ge(c)} but found ${ge(s)} instead.`}function je(c,s){return s.some(h=>h.kind===c.kind)}function Re(c,s){return s.some(h=>h==="null"?c===null:h==="array"?Array.isArray(c):h==="object"?c&&!Array.isArray(c)&&typeof c=="object":h===typeof c)}function ne(c,s){return c.kind==="array"&&s.kind==="array"?c.itemType.kind===s.itemType.kind&&typeof c.N=="number":c.kind===s.kind}const He=.96422,Xe=.82521,Ye=4/29,at=6/29,Tt=3*at*at,Xt=at*at*at,hn=Math.PI/180,vn=180/Math.PI;function Fn(c){return(c%=360)<0&&(c+=360),c}function vr([c,s,h,m]){let v,S;const C=wn((.2225045*(c=Hr(c))+.7168786*(s=Hr(s))+.0606169*(h=Hr(h)))/1);c===s&&s===h?v=S=C:(v=wn((.4360747*c+.3850649*s+.1430804*h)/He),S=wn((.0139322*c+.0971045*s+.7141733*h)/Xe));const M=116*C-16;return[M<0?0:M,500*(v-C),200*(C-S),m]}function Hr(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function wn(c){return c>Xt?Math.pow(c,1/3):c/Tt+Ye}function zr([c,s,h,m]){let v=(c+16)/116,S=isNaN(s)?v:v+s/500,C=isNaN(h)?v:v-h/200;return v=1*Ci(v),S=He*Ci(S),C=Xe*Ci(C),[ni(3.1338561*S-1.6168667*v-.4906146*C),ni(-.9787684*S+1.9161415*v+.033454*C),ni(.0719453*S-.2289914*v+1.4052427*C),m]}function ni(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function Ci(c){return c>at?c*c*c:Tt*(c-Ye)}function zi(c){return parseInt(c.padEnd(2,c),16)/255}function di(c,s){return Bo(s?c/100:c,0,1)}function Bo(c,s,h){return Math.min(Math.max(s,c),h)}function Ph(c){return!c.some(Number.isNaN)}const Ad={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class nr{constructor(s,h,m,v=1,S=!0){this.r=s,this.g=h,this.b=m,this.a=v,S||(this.r*=v,this.g*=v,this.b*=v,v||this.overwriteGetter("rgb",[s,h,m,v]))}static parse(s){if(s instanceof nr)return s;if(typeof s!="string")return;const h=function(m){if((m=m.toLowerCase().trim())==="transparent")return[0,0,0,0];const v=Ad[m];if(v){const[C,M,P]=v;return[C/255,M/255,P/255,1]}if(m.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(m)){const C=m.length<6?1:2;let M=1;return[zi(m.slice(M,M+=C)),zi(m.slice(M,M+=C)),zi(m.slice(M,M+=C)),zi(m.slice(M,M+C)||"ff")]}if(m.startsWith("rgb")){const C=m.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(C){const[M,P,O,H,K,re,ce,me,ve,Te,Pe,Ze]=C,$e=[H||" ",ce||" ",Te].join("");if($e==="  "||$e==="  /"||$e===",,"||$e===",,,"){const Ne=[O,re,ve].join(""),ct=Ne==="%%%"?100:Ne===""?255:0;if(ct){const ft=[Bo(+P/ct,0,1),Bo(+K/ct,0,1),Bo(+me/ct,0,1),Pe?di(+Pe,Ze):1];if(Ph(ft))return ft}}return}}const S=m.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(S){const[C,M,P,O,H,K,re,ce,me]=S,ve=[P||" ",H||" ",re].join("");if(ve==="  "||ve==="  /"||ve===",,"||ve===",,,"){const Te=[+M,Bo(+O,0,100),Bo(+K,0,100),ce?di(+ce,me):1];if(Ph(Te))return function([Pe,Ze,$e,Ne]){function ct(ft){const Zt=(ft+Pe/30)%12,Jt=Ze*Math.min($e,1-$e);return $e-Jt*Math.max(-1,Math.min(Zt-3,9-Zt,1))}return Pe=Fn(Pe),Ze/=100,$e/=100,[ct(0),ct(8),ct(4),Ne]}(Te)}}}(s);return h?new nr(...h,!1):void 0}get rgb(){const{r:s,g:h,b:m,a:v}=this,S=v||1/0;return this.overwriteGetter("rgb",[s/S,h/S,m/S,v])}get hcl(){return this.overwriteGetter("hcl",function(s){const[h,m,v,S]=vr(s),C=Math.sqrt(m*m+v*v);return[Math.round(1e4*C)?Fn(Math.atan2(v,m)*vn):NaN,C,h,S]}(this.rgb))}get lab(){return this.overwriteGetter("lab",vr(this.rgb))}overwriteGetter(s,h){return Object.defineProperty(this,s,{value:h}),h}toString(){const[s,h,m,v]=this.rgb;return`rgba(${[s,h,m].map(S=>Math.round(255*S)).join(",")},${v})`}}nr.black=new nr(0,0,0,1),nr.white=new nr(1,1,1,1),nr.transparent=new nr(0,0,0,0),nr.red=new nr(1,0,0,1);class Bc{constructor(s,h,m){this.sensitivity=s?h?"variant":"case":h?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,h){return this.collator.compare(s,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Oc{constructor(s,h,m,v,S){this.text=s,this.image=h,this.scale=m,this.fontStack=v,this.textColor=S}}class Wi{constructor(s){this.sections=s}static fromString(s){return new Wi([new Oc(s,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||s.image&&s.image.name.length!==0)}static factory(s){return s instanceof Wi?s:Wi.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}}class Di{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof Di)return s;if(typeof s=="number")return new Di([s,s,s,s]);if(Array.isArray(s)&&!(s.length<1||s.length>4)){for(const h of s)if(typeof h!="number")return;switch(s.length){case 1:s=[s[0],s[0],s[0],s[0]];break;case 2:s=[s[0],s[1],s[0],s[1]];break;case 3:s=[s[0],s[1],s[2],s[1]]}return new Di(s)}}toString(){return JSON.stringify(this.values)}}const $a=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ao{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof ao)return s;if(Array.isArray(s)&&!(s.length<1)&&s.length%2==0){for(let h=0;h<s.length;h+=2){const m=s[h],v=s[h+1];if(typeof m!="string"||!$a.has(m)||!Array.isArray(v)||v.length!==2||typeof v[0]!="number"||typeof v[1]!="number")return}return new ao(s)}}toString(){return JSON.stringify(this.values)}}class lo{constructor(s){this.name=s.name,this.available=s.available}toString(){return this.name}static fromString(s){return s?new lo({name:s,available:!1}):null}}function Qs(c,s,h,m){return typeof c=="number"&&c>=0&&c<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof h=="number"&&h>=0&&h<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:`Invalid rgba value [${[c,s,h,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[c,s,h,m]:[c,s,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function yl(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof nr||c instanceof Bc||c instanceof Wi||c instanceof Di||c instanceof ao||c instanceof lo)return!0;if(Array.isArray(c)){for(const s of c)if(!yl(s))return!1;return!0}if(typeof c=="object"){for(const s in c)if(!yl(c[s]))return!1;return!0}return!1}function Wr(c){if(c===null)return Yn;if(typeof c=="string")return sn;if(typeof c=="boolean")return mn;if(typeof c=="number")return Pt;if(c instanceof nr)return Qn;if(c instanceof Bc)return Nr;if(c instanceof Wi)return _r;if(c instanceof Di)return Ce;if(c instanceof ao)return ie;if(c instanceof lo)return te;if(Array.isArray(c)){const s=c.length;let h;for(const m of c){const v=Wr(m);if(h){if(h===v)continue;h=_n;break}h=v}return le(h||_n,s)}return _i}function Fa(c){const s=typeof c;return c===null?"":s==="string"||s==="number"||s==="boolean"?String(c):c instanceof nr||c instanceof Wi||c instanceof Di||c instanceof ao||c instanceof lo?c.toString():JSON.stringify(c)}class ps{constructor(s,h){this.type=s,this.value=h}static parse(s,h){if(s.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!yl(s[1]))return h.error("invalid value");const m=s[1];let v=Wr(m);const S=h.expectedType;return v.kind!=="array"||v.N!==0||!S||S.kind!=="array"||typeof S.N=="number"&&S.N!==0||(v=S),new ps(v,m)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Sr{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}}const bl={string:sn,number:Pt,boolean:mn,object:_i};class Ki{constructor(s,h){this.type=s,this.args=h}static parse(s,h){if(s.length<2)return h.error("Expected at least one argument.");let m,v=1;const S=s[0];if(S==="array"){let M,P;if(s.length>2){const O=s[1];if(typeof O!="string"||!(O in bl)||O==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);M=bl[O],v++}else M=_n;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return h.error('The length argument to "array" must be a positive integer literal',2);P=s[2],v++}m=le(M,P)}else{if(!bl[S])throw new Error(`Types doesn't contain name = ${S}`);m=bl[S]}const C=[];for(;v<s.length;v++){const M=h.parse(s[v],v,_n);if(!M)return null;C.push(M)}return new Ki(m,C)}evaluate(s){for(let h=0;h<this.args.length;h++){const m=this.args[h].evaluate(s);if(!Be(this.type,Wr(m)))return m;if(h===this.args.length-1)throw new Sr(`Expected value to be of type ${ge(this.type)}, but found ${ge(Wr(m))} instead.`)}throw new Error}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const vl={"to-boolean":mn,"to-color":Qn,"to-number":Pt,"to-string":sn};class Oo{constructor(s,h){this.type=s,this.args=h}static parse(s,h){if(s.length<2)return h.error("Expected at least one argument.");const m=s[0];if(!vl[m])throw new Error(`Can't parse ${m} as it is not part of the known types`);if((m==="to-boolean"||m==="to-string")&&s.length!==2)return h.error("Expected one argument.");const v=vl[m],S=[];for(let C=1;C<s.length;C++){const M=h.parse(s[C],C,_n);if(!M)return null;S.push(M)}return new Oo(v,S)}evaluate(s){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(s);case"color":{let h,m;for(const v of this.args){if(h=v.evaluate(s),m=null,h instanceof nr)return h;if(typeof h=="string"){const S=s.parseColor(h);if(S)return S}else if(Array.isArray(h)&&(m=h.length<3||h.length>4?`Invalid rbga value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:Qs(h[0],h[1],h[2],h[3]),!m))return new nr(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new Sr(m||`Could not parse color from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"padding":{let h;for(const m of this.args){h=m.evaluate(s);const v=Di.parse(h);if(v)return v}throw new Sr(`Could not parse padding from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"variableAnchorOffsetCollection":{let h;for(const m of this.args){h=m.evaluate(s);const v=ao.parse(h);if(v)return v}throw new Sr(`Could not parse variableAnchorOffsetCollection from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"number":{let h=null;for(const m of this.args){if(h=m.evaluate(s),h===null)return 0;const v=Number(h);if(!isNaN(v))return v}throw new Sr(`Could not convert ${JSON.stringify(h)} to number.`)}case"formatted":return Wi.fromString(Fa(this.args[0].evaluate(s)));case"resolvedImage":return lo.fromString(Fa(this.args[0].evaluate(s)));default:return Fa(this.args[0].evaluate(s))}}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const Ba=["Unknown","Point","LineString","Polygon"];class rr{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ba[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(s){let h=this._parseColorCache[s];return h||(h=this._parseColorCache[s]=nr.parse(s)),h}}class wl{constructor(s,h,m=[],v,S=new Kn,C=[]){this.registry=s,this.path=m,this.key=m.map(M=>`[${M}]`).join(""),this.scope=S,this.errors=C,this.expectedType=v,this._isConstant=h}parse(s,h,m,v,S={}){return h?this.concat(h,m,v)._parse(s,S):this._parse(s,S)}_parse(s,h){function m(v,S,C){return C==="assert"?new Ki(S,[v]):C==="coerce"?new Oo(S,[v]):v}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const v=s[0];if(typeof v!="string")return this.error(`Expression name must be a string, but found ${typeof v} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const S=this.registry[v];if(S){let C=S.parse(s,this);if(!C)return null;if(this.expectedType){const M=this.expectedType,P=C.type;if(M.kind!=="string"&&M.kind!=="number"&&M.kind!=="boolean"&&M.kind!=="object"&&M.kind!=="array"||P.kind!=="value")if(M.kind!=="color"&&M.kind!=="formatted"&&M.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string")if(M.kind!=="padding"||P.kind!=="value"&&P.kind!=="number"&&P.kind!=="array")if(M.kind!=="variableAnchorOffsetCollection"||P.kind!=="value"&&P.kind!=="array"){if(this.checkSubtype(M,P))return null}else C=m(C,M,h.typeAnnotation||"coerce");else C=m(C,M,h.typeAnnotation||"coerce");else C=m(C,M,h.typeAnnotation||"coerce");else C=m(C,M,h.typeAnnotation||"assert")}if(!(C instanceof ps)&&C.type.kind!=="resolvedImage"&&this._isConstant(C)){const M=new rr;try{C=new ps(C.type,C.evaluate(M))}catch(P){return this.error(P.message),null}}return C}return this.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,h,m){const v=typeof s=="number"?this.path.concat(s):this.path,S=m?this.scope.concat(m):this.scope;return new wl(this.registry,this._isConstant,v,h||null,S,this.errors)}error(s,...h){const m=`${this.key}${h.map(v=>`[${v}]`).join("")}`;this.errors.push(new or(m,s))}checkSubtype(s,h){const m=Be(s,h);return m&&this.error(m),m}}class ea{constructor(s,h,m){this.type=Nr,this.locale=m,this.caseSensitive=s,this.diacriticSensitive=h}static parse(s,h){if(s.length!==2)return h.error("Expected one argument.");const m=s[1];if(typeof m!="object"||Array.isArray(m))return h.error("Collator options argument must be an object.");const v=h.parse(m["case-sensitive"]!==void 0&&m["case-sensitive"],1,mn);if(!v)return null;const S=h.parse(m["diacritic-sensitive"]!==void 0&&m["diacritic-sensitive"],1,mn);if(!S)return null;let C=null;return m.locale&&(C=h.parse(m.locale,1,sn),!C)?null:new ea(v,S,C)}evaluate(s){return new Bc(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}}const ms=8192;function xl(c,s){c[0]=Math.min(c[0],s[0]),c[1]=Math.min(c[1],s[1]),c[2]=Math.max(c[2],s[0]),c[3]=Math.max(c[3],s[1])}function Oa(c,s){return!(c[0]<=s[0]||c[2]>=s[2]||c[1]<=s[1]||c[3]>=s[3])}function Pd(c,s){const h=(180+c[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,v=Math.pow(2,s.z);return[Math.round(h*v*ms),Math.round(m*v*ms)]}function zh(c,s,h){const m=c[0]-s[0],v=c[1]-s[1],S=c[0]-h[0],C=c[1]-h[1];return m*C-S*v==0&&m*S<=0&&v*C<=0}function kl(c,s){let h=!1;for(let C=0,M=s.length;C<M;C++){const P=s[C];for(let O=0,H=P.length;O<H-1;O++){if(zh(c,P[O],P[O+1]))return!1;(v=P[O])[1]>(m=c)[1]!=(S=P[O+1])[1]>m[1]&&m[0]<(S[0]-v[0])*(m[1]-v[1])/(S[1]-v[1])+v[0]&&(h=!h)}}var m,v,S;return h}function zd(c,s){for(let h=0;h<s.length;h++)if(kl(c,s[h]))return!0;return!1}function Dh(c,s,h,m){const v=m[0]-h[0],S=m[1]-h[1],C=(c[0]-h[0])*S-v*(c[1]-h[1]),M=(s[0]-h[0])*S-v*(s[1]-h[1]);return C>0&&M<0||C<0&&M>0}function Dd(c,s,h){for(const O of h)for(let H=0;H<O.length-1;++H)if((M=[(C=O[H+1])[0]-(S=O[H])[0],C[1]-S[1]])[0]*(P=[(v=s)[0]-(m=c)[0],v[1]-m[1]])[1]-M[1]*P[0]!=0&&Dh(m,v,S,C)&&Dh(S,C,m,v))return!0;var m,v,S,C,M,P;return!1}function Rh(c,s){for(let h=0;h<c.length;++h)if(!kl(c[h],s))return!1;for(let h=0;h<c.length-1;++h)if(Dd(c[h],c[h+1],s))return!1;return!0}function $h(c,s){for(let h=0;h<s.length;h++)if(Rh(c,s[h]))return!0;return!1}function Sl(c,s,h){const m=[];for(let v=0;v<c.length;v++){const S=[];for(let C=0;C<c[v].length;C++){const M=Pd(c[v][C],h);xl(s,M),S.push(M)}m.push(S)}return m}function Fh(c,s,h){const m=[];for(let v=0;v<c.length;v++){const S=Sl(c[v],s,h);m.push(S)}return m}function Bh(c,s,h,m){if(c[0]<h[0]||c[0]>h[2]){const v=.5*m;let S=c[0]-h[0]>v?-m:h[0]-c[0]>v?m:0;S===0&&(S=c[0]-h[2]>v?-m:h[2]-c[0]>v?m:0),c[0]+=S}xl(s,c)}function Cl(c,s,h,m){const v=Math.pow(2,m.z)*ms,S=[m.x*ms,m.y*ms],C=[];for(const M of c)for(const P of M){const O=[P.x+S[0],P.y+S[1]];Bh(O,s,h,v),C.push(O)}return C}function Oh(c,s,h,m){const v=Math.pow(2,m.z)*ms,S=[m.x*ms,m.y*ms],C=[];for(const P of c){const O=[];for(const H of P){const K=[H.x+S[0],H.y+S[1]];xl(s,K),O.push(K)}C.push(O)}if(s[2]-s[0]<=v/2){(M=s)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const P of C)for(const O of P)Bh(O,s,h,v)}var M;return C}class Ms{constructor(s,h){this.type=mn,this.geojson=s,this.geometries=h}static parse(s,h){if(s.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(yl(s[1])){const m=s[1];if(m.type==="FeatureCollection"){const v=[];for(const S of m.features){const{type:C,coordinates:M}=S.geometry;C==="Polygon"&&v.push(M),C==="MultiPolygon"&&v.push(...M)}if(v.length)return new Ms(m,{type:"MultiPolygon",coordinates:v})}else if(m.type==="Feature"){const v=m.geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Ms(m,m.geometry)}else if(m.type==="Polygon"||m.type==="MultiPolygon")return new Ms(m,m)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(h,m){const v=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],C=h.canonicalID();if(m.type==="Polygon"){const M=Sl(m.coordinates,S,C),P=Cl(h.geometry(),v,S,C);if(!Oa(v,S))return!1;for(const O of P)if(!kl(O,M))return!1}if(m.type==="MultiPolygon"){const M=Fh(m.coordinates,S,C),P=Cl(h.geometry(),v,S,C);if(!Oa(v,S))return!1;for(const O of P)if(!zd(O,M))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(h,m){const v=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],C=h.canonicalID();if(m.type==="Polygon"){const M=Sl(m.coordinates,S,C),P=Oh(h.geometry(),v,S,C);if(!Oa(v,S))return!1;for(const O of P)if(!Rh(O,M))return!1}if(m.type==="MultiPolygon"){const M=Fh(m.coordinates,S,C),P=Oh(h.geometry(),v,S,C);if(!Oa(v,S))return!1;for(const O of P)if(!$h(O,M))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Tl{constructor(s,h){this.type=h.type,this.name=s,this.boundExpression=h}static parse(s,h){if(s.length!==2||typeof s[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const m=s[1];return h.scope.has(m)?new Tl(m,h.scope.get(m)):h.error(`Unknown variable "${m}". Make sure "${m}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}}class Xi{constructor(s,h,m,v){this.name=s,this.type=h,this._evaluate=m,this.args=v}evaluate(s){return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}static parse(s,h){const m=s[0],v=Xi.definitions[m];if(!v)return h.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);const S=Array.isArray(v)?v[0]:v.type,C=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,M=C.filter(([O])=>!Array.isArray(O)||O.length===s.length-1);let P=null;for(const[O,H]of M){P=new wl(h.registry,Na,h.path,null,h.scope);const K=[];let re=!1;for(let ce=1;ce<s.length;ce++){const me=s[ce],ve=Array.isArray(O)?O[ce-1]:O.type,Te=P.parse(me,1+K.length,ve);if(!Te){re=!0;break}K.push(Te)}if(!re)if(Array.isArray(O)&&O.length!==K.length)P.error(`Expected ${O.length} arguments, but found ${K.length} instead.`);else{for(let ce=0;ce<K.length;ce++){const me=Array.isArray(O)?O[ce]:O.type,ve=K[ce];P.concat(ce+1).checkSubtype(me,ve.type)}if(P.errors.length===0)return new Xi(m,S,H,K)}}if(M.length===1)h.errors.push(...P.errors);else{const O=(M.length?M:C).map(([K])=>{return re=K,Array.isArray(re)?`(${re.map(ge).join(", ")})`:`(${ge(re.type)}...)`;var re}).join(" | "),H=[];for(let K=1;K<s.length;K++){const re=h.parse(s[K],1+H.length);if(!re)return null;H.push(ge(re.type))}h.error(`Expected arguments of type ${O}, but found (${H.join(", ")}) instead.`)}return null}static register(s,h){Xi.definitions=h;for(const m in h)s[m]=Xi}}function Na(c){if(c instanceof Tl)return Na(c.boundExpression);if(c instanceof Xi&&c.name==="error"||c instanceof ea||c instanceof Ms)return!1;const s=c instanceof Oo||c instanceof Ki;let h=!0;return c.eachChild(m=>{h=s?h&&Na(m):h&&m instanceof ps}),!!h&&Ml(c)&&Ua(c,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ml(c){if(c instanceof Xi&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof Ms)return!1;let s=!0;return c.eachChild(h=>{s&&!Ml(h)&&(s=!1)}),s}function ja(c){if(c instanceof Xi&&c.name==="feature-state")return!1;let s=!0;return c.eachChild(h=>{s&&!ja(h)&&(s=!1)}),s}function Ua(c,s){if(c instanceof Xi&&s.indexOf(c.name)>=0)return!1;let h=!0;return c.eachChild(m=>{h&&!Ua(m,s)&&(h=!1)}),h}function Va(c,s){const h=c.length-1;let m,v,S=0,C=h,M=0;for(;S<=C;)if(M=Math.floor((S+C)/2),m=c[M],v=c[M+1],m<=s){if(M===h||s<v)return M;S=M+1}else{if(!(m>s))throw new Sr("Input is not a number.");C=M-1}return 0}class qa{constructor(s,h,m){this.type=s,this.input=h,this.labels=[],this.outputs=[];for(const[v,S]of m)this.labels.push(v),this.outputs.push(S)}static parse(s,h){if(s.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return h.error("Expected an even number of arguments.");const m=h.parse(s[1],1,Pt);if(!m)return null;const v=[];let S=null;h.expectedType&&h.expectedType.kind!=="value"&&(S=h.expectedType);for(let C=1;C<s.length;C+=2){const M=C===1?-1/0:s[C],P=s[C+1],O=C,H=C+1;if(typeof M!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(v.length&&v[v.length-1][0]>=M)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',O);const K=h.parse(P,H,S);if(!K)return null;S=S||K.type,v.push([M,K])}return new qa(S,m,v)}evaluate(s){const h=this.labels,m=this.outputs;if(h.length===1)return m[0].evaluate(s);const v=this.input.evaluate(s);if(v<=h[0])return m[0].evaluate(s);const S=h.length;return v>=h[S-1]?m[S-1].evaluate(s):m[Va(h,v)].evaluate(s)}eachChild(s){s(this.input);for(const h of this.outputs)s(h)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Rd(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var $d=Nh;function Nh(c,s,h,m){this.cx=3*c,this.bx=3*(h-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(m-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=s,this.p2x=h,this.p2y=m}Nh.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,s){if(s===void 0&&(s=1e-6),c<0)return 0;if(c>1)return 1;for(var h=c,m=0;m<8;m++){var v=this.sampleCurveX(h)-c;if(Math.abs(v)<s)return h;var S=this.sampleCurveDerivativeX(h);if(Math.abs(S)<1e-6)break;h-=v/S}var C=0,M=1;for(h=c,m=0;m<20&&(v=this.sampleCurveX(h),!(Math.abs(v-c)<s));m++)c>v?C=h:M=h,h=.5*(M-C)+C;return h},solve:function(c,s){return this.sampleCurveY(this.solveCurveX(c,s))}};var Fd=Rd($d);function Ls(c,s,h){return c+h*(s-c)}function Ll(c,s,h){return c.map((m,v)=>Ls(m,s[v],h))}const Ti={number:Ls,color:function(c,s,h,m="rgb"){switch(m){case"rgb":{const[v,S,C,M]=Ll(c.rgb,s.rgb,h);return new nr(v,S,C,M,!1)}case"hcl":{const[v,S,C,M]=c.hcl,[P,O,H,K]=s.hcl;let re,ce;if(isNaN(v)||isNaN(P))isNaN(v)?isNaN(P)?re=NaN:(re=P,C!==1&&C!==0||(ce=O)):(re=v,H!==1&&H!==0||(ce=S));else{let Ze=P-v;P>v&&Ze>180?Ze-=360:P<v&&v-P>180&&(Ze+=360),re=v+h*Ze}const[me,ve,Te,Pe]=function([Ze,$e,Ne,ct]){return Ze=isNaN(Ze)?0:Ze*hn,zr([Ne,Math.cos(Ze)*$e,Math.sin(Ze)*$e,ct])}([re,ce??Ls(S,O,h),Ls(C,H,h),Ls(M,K,h)]);return new nr(me,ve,Te,Pe,!1)}case"lab":{const[v,S,C,M]=zr(Ll(c.lab,s.lab,h));return new nr(v,S,C,M,!1)}}},array:Ll,padding:function(c,s,h){return new Di(Ll(c.values,s.values,h))},variableAnchorOffsetCollection:function(c,s,h){const m=c.values,v=s.values;if(m.length!==v.length)throw new Sr(`Cannot interpolate values of different length. from: ${c.toString()}, to: ${s.toString()}`);const S=[];for(let C=0;C<m.length;C+=2){if(m[C]!==v[C])throw new Sr(`Cannot interpolate values containing mismatched anchors. from[${C}]: ${m[C]}, to[${C}]: ${v[C]}`);S.push(m[C]);const[M,P]=m[C+1],[O,H]=v[C+1];S.push([Ls(M,O,h),Ls(P,H,h)])}return new ao(S)}};class vi{constructor(s,h,m,v,S){this.type=s,this.operator=h,this.interpolation=m,this.input=v,this.labels=[],this.outputs=[];for(const[C,M]of S)this.labels.push(C),this.outputs.push(M)}static interpolationFactor(s,h,m,v){let S=0;if(s.name==="exponential")S=Gn(h,s.base,m,v);else if(s.name==="linear")S=Gn(h,1,m,v);else if(s.name==="cubic-bezier"){const C=s.controlPoints;S=new Fd(C[0],C[1],C[2],C[3]).solve(Gn(h,1,m,v))}return S}static parse(s,h){let[m,v,S,...C]=s;if(!Array.isArray(v)||v.length===0)return h.error("Expected an interpolation type expression.",1);if(v[0]==="linear")v={name:"linear"};else if(v[0]==="exponential"){const O=v[1];if(typeof O!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);v={name:"exponential",base:O}}else{if(v[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(v[0])}`,1,0);{const O=v.slice(1);if(O.length!==4||O.some(H=>typeof H!="number"||H<0||H>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);v={name:"cubic-bezier",controlPoints:O}}}if(s.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(S=h.parse(S,2,Pt),!S)return null;const M=[];let P=null;m==="interpolate-hcl"||m==="interpolate-lab"?P=Qn:h.expectedType&&h.expectedType.kind!=="value"&&(P=h.expectedType);for(let O=0;O<C.length;O+=2){const H=C[O],K=C[O+1],re=O+3,ce=O+4;if(typeof H!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',re);if(M.length&&M[M.length-1][0]>=H)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',re);const me=h.parse(K,ce,P);if(!me)return null;P=P||me.type,M.push([H,me])}return ne(P,Pt)||ne(P,Qn)||ne(P,Ce)||ne(P,ie)||ne(P,le(Pt))?new vi(P,m,v,S,M):h.error(`Type ${ge(P)} is not interpolatable.`)}evaluate(s){const h=this.labels,m=this.outputs;if(h.length===1)return m[0].evaluate(s);const v=this.input.evaluate(s);if(v<=h[0])return m[0].evaluate(s);const S=h.length;if(v>=h[S-1])return m[S-1].evaluate(s);const C=Va(h,v),M=vi.interpolationFactor(this.interpolation,v,h[C],h[C+1]),P=m[C].evaluate(s),O=m[C+1].evaluate(s);switch(this.operator){case"interpolate":return Ti[this.type.kind](P,O,M);case"interpolate-hcl":return Ti.color(P,O,M,"hcl");case"interpolate-lab":return Ti.color(P,O,M,"lab")}}eachChild(s){s(this.input);for(const h of this.outputs)s(h)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Gn(c,s,h,m){const v=m-h,S=c-h;return v===0?0:s===1?S/v:(Math.pow(s,S)-1)/(Math.pow(s,v)-1)}class El{constructor(s,h){this.type=s,this.args=h}static parse(s,h){if(s.length<2)return h.error("Expectected at least one argument.");let m=null;const v=h.expectedType;v&&v.kind!=="value"&&(m=v);const S=[];for(const M of s.slice(1)){const P=h.parse(M,1+S.length,m,void 0,{typeAnnotation:"omit"});if(!P)return null;m=m||P.type,S.push(P)}if(!m)throw new Error("No output type");const C=v&&S.some(M=>Be(v,M.type));return new El(C?_n:m,S)}evaluate(s){let h,m=null,v=0;for(const S of this.args)if(v++,m=S.evaluate(s),m&&m instanceof lo&&!m.available&&(h||(h=m.name),m=null,v===this.args.length&&(m=h)),m!==null)break;return m}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}class Il{constructor(s,h){this.type=h.type,this.bindings=[].concat(s),this.result=h}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const h of this.bindings)s(h[1]);s(this.result)}static parse(s,h){if(s.length<4)return h.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const m=[];for(let S=1;S<s.length-1;S+=2){const C=s[S];if(typeof C!="string")return h.error(`Expected string, but found ${typeof C} instead.`,S);if(/[^a-zA-Z0-9_]/.test(C))return h.error("Variable names must contain only alphanumeric characters or '_'.",S);const M=h.parse(s[S+1],S+1);if(!M)return null;m.push([C,M])}const v=h.parse(s[s.length-1],s.length-1,h.expectedType,m);return v?new Il(m,v):null}outputDefined(){return this.result.outputDefined()}}class Nc{constructor(s,h,m){this.type=s,this.index=h,this.input=m}static parse(s,h){if(s.length!==3)return h.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const m=h.parse(s[1],1,Pt),v=h.parse(s[2],2,le(h.expectedType||_n));return m&&v?new Nc(v.type.itemType,m,v):null}evaluate(s){const h=this.index.evaluate(s),m=this.input.evaluate(s);if(h<0)throw new Sr(`Array index out of bounds: ${h} < 0.`);if(h>=m.length)throw new Sr(`Array index out of bounds: ${h} > ${m.length-1}.`);if(h!==Math.floor(h))throw new Sr(`Array index must be an integer, but found ${h} instead.`);return m[h]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}}class jc{constructor(s,h){this.type=mn,this.needle=s,this.haystack=h}static parse(s,h){if(s.length!==3)return h.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const m=h.parse(s[1],1,_n),v=h.parse(s[2],2,_n);return m&&v?je(m.type,[mn,sn,Pt,Yn,_n])?new jc(m,v):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${ge(m.type)} instead`):null}evaluate(s){const h=this.needle.evaluate(s),m=this.haystack.evaluate(s);if(!m)return!1;if(!Re(h,["boolean","string","number","null"]))throw new Sr(`Expected first argument to be of type boolean, string, number or null, but found ${ge(Wr(h))} instead.`);if(!Re(m,["string","array"]))throw new Sr(`Expected second argument to be of type array or string, but found ${ge(Wr(m))} instead.`);return m.indexOf(h)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}}class Al{constructor(s,h,m){this.type=Pt,this.needle=s,this.haystack=h,this.fromIndex=m}static parse(s,h){if(s.length<=2||s.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const m=h.parse(s[1],1,_n),v=h.parse(s[2],2,_n);if(!m||!v)return null;if(!je(m.type,[mn,sn,Pt,Yn,_n]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${ge(m.type)} instead`);if(s.length===4){const S=h.parse(s[3],3,Pt);return S?new Al(m,v,S):null}return new Al(m,v)}evaluate(s){const h=this.needle.evaluate(s),m=this.haystack.evaluate(s);if(!Re(h,["boolean","string","number","null"]))throw new Sr(`Expected first argument to be of type boolean, string, number or null, but found ${ge(Wr(h))} instead.`);if(!Re(m,["string","array"]))throw new Sr(`Expected second argument to be of type array or string, but found ${ge(Wr(m))} instead.`);if(this.fromIndex){const v=this.fromIndex.evaluate(s);return m.indexOf(h,v)}return m.indexOf(h)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}}class Uc{constructor(s,h,m,v,S,C){this.inputType=s,this.type=h,this.input=m,this.cases=v,this.outputs=S,this.otherwise=C}static parse(s,h){if(s.length<5)return h.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return h.error("Expected an even number of arguments.");let m,v;h.expectedType&&h.expectedType.kind!=="value"&&(v=h.expectedType);const S={},C=[];for(let O=2;O<s.length-1;O+=2){let H=s[O];const K=s[O+1];Array.isArray(H)||(H=[H]);const re=h.concat(O);if(H.length===0)return re.error("Expected at least one branch label.");for(const me of H){if(typeof me!="number"&&typeof me!="string")return re.error("Branch labels must be numbers or strings.");if(typeof me=="number"&&Math.abs(me)>Number.MAX_SAFE_INTEGER)return re.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof me=="number"&&Math.floor(me)!==me)return re.error("Numeric branch labels must be integer values.");if(m){if(re.checkSubtype(m,Wr(me)))return null}else m=Wr(me);if(S[String(me)]!==void 0)return re.error("Branch labels must be unique.");S[String(me)]=C.length}const ce=h.parse(K,O,v);if(!ce)return null;v=v||ce.type,C.push(ce)}const M=h.parse(s[1],1,_n);if(!M)return null;const P=h.parse(s[s.length-1],s.length-1,v);return P?M.type.kind!=="value"&&h.concat(1).checkSubtype(m,M.type)?null:new Uc(m,v,M,S,C,P):null}evaluate(s){const h=this.input.evaluate(s);return(Wr(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}}class Vc{constructor(s,h,m){this.type=s,this.branches=h,this.otherwise=m}static parse(s,h){if(s.length<4)return h.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return h.error("Expected an odd number of arguments.");let m;h.expectedType&&h.expectedType.kind!=="value"&&(m=h.expectedType);const v=[];for(let C=1;C<s.length-1;C+=2){const M=h.parse(s[C],C,mn);if(!M)return null;const P=h.parse(s[C+1],C+1,m);if(!P)return null;v.push([M,P]),m=m||P.type}const S=h.parse(s[s.length-1],s.length-1,m);if(!S)return null;if(!m)throw new Error("Can't infer output type");return new Vc(m,v,S)}evaluate(s){for(const[h,m]of this.branches)if(h.evaluate(s))return m.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[h,m]of this.branches)s(h),s(m);s(this.otherwise)}outputDefined(){return this.branches.every(([s,h])=>h.outputDefined())&&this.otherwise.outputDefined()}}class Pl{constructor(s,h,m,v){this.type=s,this.input=h,this.beginIndex=m,this.endIndex=v}static parse(s,h){if(s.length<=2||s.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const m=h.parse(s[1],1,_n),v=h.parse(s[2],2,Pt);if(!m||!v)return null;if(!je(m.type,[le(_n),sn,_n]))return h.error(`Expected first argument to be of type array or string, but found ${ge(m.type)} instead`);if(s.length===4){const S=h.parse(s[3],3,Pt);return S?new Pl(m.type,m,v,S):null}return new Pl(m.type,m,v)}evaluate(s){const h=this.input.evaluate(s),m=this.beginIndex.evaluate(s);if(!Re(h,["string","array"]))throw new Sr(`Expected first argument to be of type array or string, but found ${ge(Wr(h))} instead.`);if(this.endIndex){const v=this.endIndex.evaluate(s);return h.slice(m,v)}return h.slice(m)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}}function jh(c,s){return c==="=="||c==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function Uh(c,s,h,m){return m.compare(s,h)===0}function ta(c,s,h){const m=c!=="=="&&c!=="!=";return class xb{constructor(S,C,M){this.type=mn,this.lhs=S,this.rhs=C,this.collator=M,this.hasUntypedArgument=S.type.kind==="value"||C.type.kind==="value"}static parse(S,C){if(S.length!==3&&S.length!==4)return C.error("Expected two or three arguments.");const M=S[0];let P=C.parse(S[1],1,_n);if(!P)return null;if(!jh(M,P.type))return C.concat(1).error(`"${M}" comparisons are not supported for type '${ge(P.type)}'.`);let O=C.parse(S[2],2,_n);if(!O)return null;if(!jh(M,O.type))return C.concat(2).error(`"${M}" comparisons are not supported for type '${ge(O.type)}'.`);if(P.type.kind!==O.type.kind&&P.type.kind!=="value"&&O.type.kind!=="value")return C.error(`Cannot compare types '${ge(P.type)}' and '${ge(O.type)}'.`);m&&(P.type.kind==="value"&&O.type.kind!=="value"?P=new Ki(O.type,[P]):P.type.kind!=="value"&&O.type.kind==="value"&&(O=new Ki(P.type,[O])));let H=null;if(S.length===4){if(P.type.kind!=="string"&&O.type.kind!=="string"&&P.type.kind!=="value"&&O.type.kind!=="value")return C.error("Cannot use collator to compare non-string types.");if(H=C.parse(S[3],3,Nr),!H)return null}return new xb(P,O,H)}evaluate(S){const C=this.lhs.evaluate(S),M=this.rhs.evaluate(S);if(m&&this.hasUntypedArgument){const P=Wr(C),O=Wr(M);if(P.kind!==O.kind||P.kind!=="string"&&P.kind!=="number")throw new Sr(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${P.kind}, ${O.kind}) instead.`)}if(this.collator&&!m&&this.hasUntypedArgument){const P=Wr(C),O=Wr(M);if(P.kind!=="string"||O.kind!=="string")return s(S,C,M)}return this.collator?h(S,C,M,this.collator.evaluate(S)):s(S,C,M)}eachChild(S){S(this.lhs),S(this.rhs),this.collator&&S(this.collator)}outputDefined(){return!0}}}const Bd=ta("==",function(c,s,h){return s===h},Uh),Od=ta("!=",function(c,s,h){return s!==h},function(c,s,h,m){return!Uh(0,s,h,m)}),Nd=ta("<",function(c,s,h){return s<h},function(c,s,h,m){return m.compare(s,h)<0}),jd=ta(">",function(c,s,h){return s>h},function(c,s,h,m){return m.compare(s,h)>0}),Ud=ta("<=",function(c,s,h){return s<=h},function(c,s,h,m){return m.compare(s,h)<=0}),Vd=ta(">=",function(c,s,h){return s>=h},function(c,s,h,m){return m.compare(s,h)>=0});class qc{constructor(s,h,m,v,S){this.type=sn,this.number=s,this.locale=h,this.currency=m,this.minFractionDigits=v,this.maxFractionDigits=S}static parse(s,h){if(s.length!==3)return h.error("Expected two arguments.");const m=h.parse(s[1],1,Pt);if(!m)return null;const v=s[2];if(typeof v!="object"||Array.isArray(v))return h.error("NumberFormat options argument must be an object.");let S=null;if(v.locale&&(S=h.parse(v.locale,1,sn),!S))return null;let C=null;if(v.currency&&(C=h.parse(v.currency,1,sn),!C))return null;let M=null;if(v["min-fraction-digits"]&&(M=h.parse(v["min-fraction-digits"],1,Pt),!M))return null;let P=null;return v["max-fraction-digits"]&&(P=h.parse(v["max-fraction-digits"],1,Pt),!P)?null:new qc(m,S,C,M,P)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}}class zl{constructor(s){this.type=_r,this.sections=s}static parse(s,h){if(s.length<2)return h.error("Expected at least one argument.");const m=s[1];if(!Array.isArray(m)&&typeof m=="object")return h.error("First argument must be an image or text section.");const v=[];let S=!1;for(let C=1;C<=s.length-1;++C){const M=s[C];if(S&&typeof M=="object"&&!Array.isArray(M)){S=!1;let P=null;if(M["font-scale"]&&(P=h.parse(M["font-scale"],1,Pt),!P))return null;let O=null;if(M["text-font"]&&(O=h.parse(M["text-font"],1,le(sn)),!O))return null;let H=null;if(M["text-color"]&&(H=h.parse(M["text-color"],1,Qn),!H))return null;const K=v[v.length-1];K.scale=P,K.font=O,K.textColor=H}else{const P=h.parse(s[C],1,_n);if(!P)return null;const O=P.type.kind;if(O!=="string"&&O!=="value"&&O!=="null"&&O!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");S=!0,v.push({content:P,scale:null,font:null,textColor:null})}}return new zl(v)}evaluate(s){return new Wi(this.sections.map(h=>{const m=h.content.evaluate(s);return Wr(m)===te?new Oc("",m,null,null,null):new Oc(Fa(m),null,h.scale?h.scale.evaluate(s):null,h.font?h.font.evaluate(s).join(","):null,h.textColor?h.textColor.evaluate(s):null)}))}eachChild(s){for(const h of this.sections)s(h.content),h.scale&&s(h.scale),h.font&&s(h.font),h.textColor&&s(h.textColor)}outputDefined(){return!1}}class Zc{constructor(s){this.type=te,this.input=s}static parse(s,h){if(s.length!==2)return h.error("Expected two arguments.");const m=h.parse(s[1],1,sn);return m?new Zc(m):h.error("No image name provided.")}evaluate(s){const h=this.input.evaluate(s),m=lo.fromString(h);return m&&s.availableImages&&(m.available=s.availableImages.indexOf(h)>-1),m}eachChild(s){s(this.input)}outputDefined(){return!1}}class Gc{constructor(s){this.type=Pt,this.input=s}static parse(s,h){if(s.length!==2)return h.error(`Expected 1 argument, but found ${s.length-1} instead.`);const m=h.parse(s[1],1);return m?m.type.kind!=="array"&&m.type.kind!=="string"&&m.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${ge(m.type)} instead.`):new Gc(m):null}evaluate(s){const h=this.input.evaluate(s);if(typeof h=="string"||Array.isArray(h))return h.length;throw new Sr(`Expected value to be of type string or array, but found ${ge(Wr(h))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}}const na={"==":Bd,"!=":Od,">":jd,"<":Nd,">=":Vd,"<=":Ud,array:Ki,at:Nc,boolean:Ki,case:Vc,coalesce:El,collator:ea,format:zl,image:Zc,in:jc,"index-of":Al,interpolate:vi,"interpolate-hcl":vi,"interpolate-lab":vi,length:Gc,let:Il,literal:ps,match:Uc,number:Ki,"number-format":qc,object:Ki,slice:Pl,step:qa,string:Ki,"to-boolean":Oo,"to-color":Oo,"to-number":Oo,"to-string":Oo,var:Tl,within:Ms};function Vh(c,[s,h,m,v]){s=s.evaluate(c),h=h.evaluate(c),m=m.evaluate(c);const S=v?v.evaluate(c):1,C=Qs(s,h,m,S);if(C)throw new Sr(C);return new nr(s/255,h/255,m/255,S,!1)}function qh(c,s){return c in s}function Hc(c,s){const h=s[c];return h===void 0?null:h}function Es(c){return{type:c}}function Zh(c){return{result:"success",value:c}}function ra(c){return{result:"error",value:c}}function ia(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function Gh(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function Wc(c){return!!c.expression&&c.expression.interpolated}function Vn(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function Dl(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function qd(c){return c}function Hh(c,s){const h=s.type==="color",m=c.stops&&typeof c.stops[0][0]=="object",v=m||!(m||c.property!==void 0),S=c.type||(Wc(s)?"exponential":"interval");if(h||s.type==="padding"){const H=h?nr.parse:Di.parse;(c=Vr({},c)).stops&&(c.stops=c.stops.map(K=>[K[0],H(K[1])])),c.default=H(c.default?c.default:s.default)}if(c.colorSpace&&(C=c.colorSpace)!=="rgb"&&C!=="hcl"&&C!=="lab")throw new Error(`Unknown color space: "${c.colorSpace}"`);var C;let M,P,O;if(S==="exponential")M=On;else if(S==="interval")M=Zd;else if(S==="categorical"){M=qr,P=Object.create(null);for(const H of c.stops)P[H[0]]=H[1];O=typeof c.stops[0][0]}else{if(S!=="identity")throw new Error(`Unknown function type "${S}"`);M=Kc}if(m){const H={},K=[];for(let me=0;me<c.stops.length;me++){const ve=c.stops[me],Te=ve[0].zoom;H[Te]===void 0&&(H[Te]={zoom:Te,type:c.type,property:c.property,default:c.default,stops:[]},K.push(Te)),H[Te].stops.push([ve[0].value,ve[1]])}const re=[];for(const me of K)re.push([H[me].zoom,Hh(H[me],s)]);const ce={name:"linear"};return{kind:"composite",interpolationType:ce,interpolationFactor:vi.interpolationFactor.bind(void 0,ce),zoomStops:re.map(me=>me[0]),evaluate:({zoom:me},ve)=>On({stops:re,base:c.base},s,me).evaluate(me,ve)}}if(v){const H=S==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:H,interpolationFactor:vi.interpolationFactor.bind(void 0,H),zoomStops:c.stops.map(K=>K[0]),evaluate:({zoom:K})=>M(c,s,K,P,O)}}return{kind:"source",evaluate(H,K){const re=K&&K.properties?K.properties[c.property]:void 0;return re===void 0?Za(c.default,s.default):M(c,s,re,P,O)}}}function Za(c,s,h){return c!==void 0?c:s!==void 0?s:h!==void 0?h:void 0}function qr(c,s,h,m,v){return Za(typeof h===v?m[h]:void 0,c.default,s.default)}function Zd(c,s,h){if(Vn(h)!=="number")return Za(c.default,s.default);const m=c.stops.length;if(m===1||h<=c.stops[0][0])return c.stops[0][1];if(h>=c.stops[m-1][0])return c.stops[m-1][1];const v=Va(c.stops.map(S=>S[0]),h);return c.stops[v][1]}function On(c,s,h){const m=c.base!==void 0?c.base:1;if(Vn(h)!=="number")return Za(c.default,s.default);const v=c.stops.length;if(v===1||h<=c.stops[0][0])return c.stops[0][1];if(h>=c.stops[v-1][0])return c.stops[v-1][1];const S=Va(c.stops.map(H=>H[0]),h),C=function(H,K,re,ce){const me=ce-re,ve=H-re;return me===0?0:K===1?ve/me:(Math.pow(K,ve)-1)/(Math.pow(K,me)-1)}(h,m,c.stops[S][0],c.stops[S+1][0]),M=c.stops[S][1],P=c.stops[S+1][1],O=Ti[s.type]||qd;return typeof M.evaluate=="function"?{evaluate(...H){const K=M.evaluate.apply(void 0,H),re=P.evaluate.apply(void 0,H);if(K!==void 0&&re!==void 0)return O(K,re,C,c.colorSpace)}}:O(M,P,C,c.colorSpace)}function Kc(c,s,h){switch(s.type){case"color":h=nr.parse(h);break;case"formatted":h=Wi.fromString(h.toString());break;case"resolvedImage":h=lo.fromString(h.toString());break;case"padding":h=Di.parse(h);break;default:Vn(h)===s.type||s.type==="enum"&&s.values[h]||(h=void 0)}return Za(h,c.default,s.default)}Xi.register(na,{error:[{kind:"error"},[sn],(c,[s])=>{throw new Sr(s.evaluate(c))}],typeof:[sn,[_n],(c,[s])=>ge(Wr(s.evaluate(c)))],"to-rgba":[le(Pt,4),[Qn],(c,[s])=>{const[h,m,v,S]=s.evaluate(c).rgb;return[255*h,255*m,255*v,S]}],rgb:[Qn,[Pt,Pt,Pt],Vh],rgba:[Qn,[Pt,Pt,Pt,Pt],Vh],has:{type:mn,overloads:[[[sn],(c,[s])=>qh(s.evaluate(c),c.properties())],[[sn,_i],(c,[s,h])=>qh(s.evaluate(c),h.evaluate(c))]]},get:{type:_n,overloads:[[[sn],(c,[s])=>Hc(s.evaluate(c),c.properties())],[[sn,_i],(c,[s,h])=>Hc(s.evaluate(c),h.evaluate(c))]]},"feature-state":[_n,[sn],(c,[s])=>Hc(s.evaluate(c),c.featureState||{})],properties:[_i,[],c=>c.properties()],"geometry-type":[sn,[],c=>c.geometryType()],id:[_n,[],c=>c.id()],zoom:[Pt,[],c=>c.globals.zoom],"heatmap-density":[Pt,[],c=>c.globals.heatmapDensity||0],"line-progress":[Pt,[],c=>c.globals.lineProgress||0],accumulated:[_n,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[Pt,Es(Pt),(c,s)=>{let h=0;for(const m of s)h+=m.evaluate(c);return h}],"*":[Pt,Es(Pt),(c,s)=>{let h=1;for(const m of s)h*=m.evaluate(c);return h}],"-":{type:Pt,overloads:[[[Pt,Pt],(c,[s,h])=>s.evaluate(c)-h.evaluate(c)],[[Pt],(c,[s])=>-s.evaluate(c)]]},"/":[Pt,[Pt,Pt],(c,[s,h])=>s.evaluate(c)/h.evaluate(c)],"%":[Pt,[Pt,Pt],(c,[s,h])=>s.evaluate(c)%h.evaluate(c)],ln2:[Pt,[],()=>Math.LN2],pi:[Pt,[],()=>Math.PI],e:[Pt,[],()=>Math.E],"^":[Pt,[Pt,Pt],(c,[s,h])=>Math.pow(s.evaluate(c),h.evaluate(c))],sqrt:[Pt,[Pt],(c,[s])=>Math.sqrt(s.evaluate(c))],log10:[Pt,[Pt],(c,[s])=>Math.log(s.evaluate(c))/Math.LN10],ln:[Pt,[Pt],(c,[s])=>Math.log(s.evaluate(c))],log2:[Pt,[Pt],(c,[s])=>Math.log(s.evaluate(c))/Math.LN2],sin:[Pt,[Pt],(c,[s])=>Math.sin(s.evaluate(c))],cos:[Pt,[Pt],(c,[s])=>Math.cos(s.evaluate(c))],tan:[Pt,[Pt],(c,[s])=>Math.tan(s.evaluate(c))],asin:[Pt,[Pt],(c,[s])=>Math.asin(s.evaluate(c))],acos:[Pt,[Pt],(c,[s])=>Math.acos(s.evaluate(c))],atan:[Pt,[Pt],(c,[s])=>Math.atan(s.evaluate(c))],min:[Pt,Es(Pt),(c,s)=>Math.min(...s.map(h=>h.evaluate(c)))],max:[Pt,Es(Pt),(c,s)=>Math.max(...s.map(h=>h.evaluate(c)))],abs:[Pt,[Pt],(c,[s])=>Math.abs(s.evaluate(c))],round:[Pt,[Pt],(c,[s])=>{const h=s.evaluate(c);return h<0?-Math.round(-h):Math.round(h)}],floor:[Pt,[Pt],(c,[s])=>Math.floor(s.evaluate(c))],ceil:[Pt,[Pt],(c,[s])=>Math.ceil(s.evaluate(c))],"filter-==":[mn,[sn,_n],(c,[s,h])=>c.properties()[s.value]===h.value],"filter-id-==":[mn,[_n],(c,[s])=>c.id()===s.value],"filter-type-==":[mn,[sn],(c,[s])=>c.geometryType()===s.value],"filter-<":[mn,[sn,_n],(c,[s,h])=>{const m=c.properties()[s.value],v=h.value;return typeof m==typeof v&&m<v}],"filter-id-<":[mn,[_n],(c,[s])=>{const h=c.id(),m=s.value;return typeof h==typeof m&&h<m}],"filter->":[mn,[sn,_n],(c,[s,h])=>{const m=c.properties()[s.value],v=h.value;return typeof m==typeof v&&m>v}],"filter-id->":[mn,[_n],(c,[s])=>{const h=c.id(),m=s.value;return typeof h==typeof m&&h>m}],"filter-<=":[mn,[sn,_n],(c,[s,h])=>{const m=c.properties()[s.value],v=h.value;return typeof m==typeof v&&m<=v}],"filter-id-<=":[mn,[_n],(c,[s])=>{const h=c.id(),m=s.value;return typeof h==typeof m&&h<=m}],"filter->=":[mn,[sn,_n],(c,[s,h])=>{const m=c.properties()[s.value],v=h.value;return typeof m==typeof v&&m>=v}],"filter-id->=":[mn,[_n],(c,[s])=>{const h=c.id(),m=s.value;return typeof h==typeof m&&h>=m}],"filter-has":[mn,[_n],(c,[s])=>s.value in c.properties()],"filter-has-id":[mn,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[mn,[le(sn)],(c,[s])=>s.value.indexOf(c.geometryType())>=0],"filter-id-in":[mn,[le(_n)],(c,[s])=>s.value.indexOf(c.id())>=0],"filter-in-small":[mn,[sn,le(_n)],(c,[s,h])=>h.value.indexOf(c.properties()[s.value])>=0],"filter-in-large":[mn,[sn,le(_n)],(c,[s,h])=>function(m,v,S,C){for(;S<=C;){const M=S+C>>1;if(v[M]===m)return!0;v[M]>m?C=M-1:S=M+1}return!1}(c.properties()[s.value],h.value,0,h.value.length-1)],all:{type:mn,overloads:[[[mn,mn],(c,[s,h])=>s.evaluate(c)&&h.evaluate(c)],[Es(mn),(c,s)=>{for(const h of s)if(!h.evaluate(c))return!1;return!0}]]},any:{type:mn,overloads:[[[mn,mn],(c,[s,h])=>s.evaluate(c)||h.evaluate(c)],[Es(mn),(c,s)=>{for(const h of s)if(h.evaluate(c))return!0;return!1}]]},"!":[mn,[mn],(c,[s])=>!s.evaluate(c)],"is-supported-script":[mn,[sn],(c,[s])=>{const h=c.globals&&c.globals.isSupportedScript;return!h||h(s.evaluate(c))}],upcase:[sn,[sn],(c,[s])=>s.evaluate(c).toUpperCase()],downcase:[sn,[sn],(c,[s])=>s.evaluate(c).toLowerCase()],concat:[sn,Es(_n),(c,s)=>s.map(h=>Fa(h.evaluate(c))).join("")],"resolved-locale":[sn,[Nr],(c,[s])=>s.evaluate(c).resolvedLocale()]});class gr{constructor(s,h){var m;this.expression=s,this._warningHistory={},this._evaluator=new rr,this._defaultValue=h?(m=h).type==="color"&&Dl(m.default)?new nr(0,0,0,0):m.type==="color"?nr.parse(m.default)||null:m.type==="padding"?Di.parse(m.default)||null:m.type==="variableAnchorOffsetCollection"?ao.parse(m.default)||null:m.default===void 0?null:m.default:null,this._enumValues=h&&h.type==="enum"?h.values:null}evaluateWithoutErrorHandling(s,h,m,v,S,C){return this._evaluator.globals=s,this._evaluator.feature=h,this._evaluator.featureState=m,this._evaluator.canonical=v,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=C,this.expression.evaluate(this._evaluator)}evaluate(s,h,m,v,S,C){this._evaluator.globals=s,this._evaluator.feature=h||null,this._evaluator.featureState=m||null,this._evaluator.canonical=v,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=C||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Sr(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function fr(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in na}function Is(c,s){const h=new wl(na,Na,[],s?function(v){const S={color:Qn,string:sn,number:Pt,enum:sn,boolean:mn,formatted:_r,padding:Ce,resolvedImage:te,variableAnchorOffsetCollection:ie};return v.type==="array"?le(S[v.value]||_n,v.length):S[v.type]}(s):void 0),m=h.parse(c,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?Zh(new gr(m,s)):ra(h.errors)}class Rl{constructor(s,h){this.kind=s,this._styleExpression=h,this.isStateDependent=s!=="constant"&&!ja(h.expression)}evaluateWithoutErrorHandling(s,h,m,v,S,C){return this._styleExpression.evaluateWithoutErrorHandling(s,h,m,v,S,C)}evaluate(s,h,m,v,S,C){return this._styleExpression.evaluate(s,h,m,v,S,C)}}class Xc{constructor(s,h,m,v){this.kind=s,this.zoomStops=m,this._styleExpression=h,this.isStateDependent=s!=="camera"&&!ja(h.expression),this.interpolationType=v}evaluateWithoutErrorHandling(s,h,m,v,S,C){return this._styleExpression.evaluateWithoutErrorHandling(s,h,m,v,S,C)}evaluate(s,h,m,v,S,C){return this._styleExpression.evaluate(s,h,m,v,S,C)}interpolationFactor(s,h,m){return this.interpolationType?vi.interpolationFactor(this.interpolationType,s,h,m):0}}function Wh(c,s){const h=Is(c,s);if(h.result==="error")return h;const m=h.value.expression,v=Ml(m);if(!v&&!ia(s))return ra([new or("","data expressions not supported")]);const S=Ua(m,["zoom"]);if(!S&&!Gh(s))return ra([new or("","zoom expressions not supported")]);const C=Fl(m);return C||S?C instanceof or?ra([C]):C instanceof vi&&!Wc(s)?ra([new or("",'"interpolate" expressions cannot be used with this property')]):Zh(C?new Xc(v?"camera":"composite",h.value,C.labels,C instanceof vi?C.interpolation:void 0):new Rl(v?"constant":"source",h.value)):ra([new or("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class $l{constructor(s,h){this._parameters=s,this._specification=h,Vr(this,Hh(this._parameters,this._specification))}static deserialize(s){return new $l(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function Fl(c){let s=null;if(c instanceof Il)s=Fl(c.result);else if(c instanceof El){for(const h of c.args)if(s=Fl(h),s)break}else(c instanceof qa||c instanceof vi)&&c.input instanceof Xi&&c.input.name==="zoom"&&(s=c);return s instanceof or||c.eachChild(h=>{const m=Fl(h);m instanceof or?s=m:!s&&m?s=new or("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):s&&m&&s!==m&&(s=new or("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}function Bl(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const s of c.slice(1))if(!Bl(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}const Kh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ol(c){if(c==null)return{filter:()=>!0,needGeometry:!1};Bl(c)||(c=jl(c));const s=Is(c,Kh);if(s.result==="error")throw new Error(s.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,m,v)=>s.value.evaluate(h,m,{},v),needGeometry:Nl(c)}}function Xh(c,s){return c<s?-1:c>s?1:0}function Nl(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(let s=1;s<c.length;s++)if(Nl(c[s]))return!0;return!1}function jl(c){if(!c)return!0;const s=c[0];return c.length<=1?s!=="any":s==="=="?Jc(c[1],c[2],"=="):s==="!="?Ul(Jc(c[1],c[2],"==")):s==="<"||s===">"||s==="<="||s===">="?Jc(c[1],c[2],s):s==="any"?(h=c.slice(1),["any"].concat(h.map(jl))):s==="all"?["all"].concat(c.slice(1).map(jl)):s==="none"?["all"].concat(c.slice(1).map(jl).map(Ul)):s==="in"?Jh(c[1],c.slice(2)):s==="!in"?Ul(Jh(c[1],c.slice(2))):s==="has"?Yh(c[1]):s==="!has"?Ul(Yh(c[1])):s!=="within"||c;var h}function Jc(c,s,h){switch(c){case"$type":return[`filter-type-${h}`,s];case"$id":return[`filter-id-${h}`,s];default:return[`filter-${h}`,c,s]}}function Jh(c,s){if(s.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(h=>typeof h!=typeof s[0])?["filter-in-large",c,["literal",s.sort(Xh)]]:["filter-in-small",c,["literal",s]]}}function Yh(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Ul(c){return["!",c]}function Yc(c){const s=typeof c;if(s==="number"||s==="boolean"||s==="string"||c==null)return JSON.stringify(c);if(Array.isArray(c)){let v="[";for(const S of c)v+=`${Yc(S)},`;return`${v}]`}const h=Object.keys(c).sort();let m="{";for(let v=0;v<h.length;v++)m+=`${JSON.stringify(h[v])}:${Yc(c[h[v]])},`;return`${m}}`}function Gd(c){let s="";for(const h of zn)s+=`/${Yc(c[h])}`;return s}function Qh(c){const s=c.value;return s?[new vt(c.key,s,"constants have been deprecated as of v8")]:[]}function Dr(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function _s(c){if(Array.isArray(c))return c.map(_s);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const s={};for(const h in c)s[h]=_s(c[h]);return s}return Dr(c)}function Mi(c){const s=c.key,h=c.value,m=c.valueSpec||{},v=c.objectElementValidators||{},S=c.style,C=c.styleSpec,M=c.validateSpec;let P=[];const O=Vn(h);if(O!=="object")return[new vt(s,h,`object expected, ${O} found`)];for(const H in h){const K=H.split(".")[0],re=m[K]||m["*"];let ce;if(v[K])ce=v[K];else if(m[K])ce=M;else if(v["*"])ce=v["*"];else{if(!m["*"]){P.push(new vt(s,h[H],`unknown property "${H}"`));continue}ce=M}P=P.concat(ce({key:(s&&`${s}.`)+H,value:h[H],valueSpec:re,style:S,styleSpec:C,object:h,objectKey:H,validateSpec:M},h))}for(const H in m)v[H]||m[H].required&&m[H].default===void 0&&h[H]===void 0&&P.push(new vt(s,h,`missing required property "${H}"`));return P}function Qc(c){const s=c.value,h=c.valueSpec,m=c.style,v=c.styleSpec,S=c.key,C=c.arrayElementValidator||c.validateSpec;if(Vn(s)!=="array")return[new vt(S,s,`array expected, ${Vn(s)} found`)];if(h.length&&s.length!==h.length)return[new vt(S,s,`array length ${h.length} expected, length ${s.length} found`)];if(h["min-length"]&&s.length<h["min-length"])return[new vt(S,s,`array length at least ${h["min-length"]} expected, length ${s.length} found`)];let M={type:h.value,values:h.values};v.$version<7&&(M.function=h.function),Vn(h.value)==="object"&&(M=h.value);let P=[];for(let O=0;O<s.length;O++)P=P.concat(C({array:s,arrayIndex:O,value:s[O],valueSpec:M,validateSpec:c.validateSpec,style:m,styleSpec:v,key:`${S}[${O}]`}));return P}function Vl(c){const s=c.key,h=c.value,m=c.valueSpec;let v=Vn(h);return v==="number"&&h!=h&&(v="NaN"),v!=="number"?[new vt(s,h,`number expected, ${v} found`)]:"minimum"in m&&h<m.minimum?[new vt(s,h,`${h} is less than the minimum value ${m.minimum}`)]:"maximum"in m&&h>m.maximum?[new vt(s,h,`${h} is greater than the maximum value ${m.maximum}`)]:[]}function ef(c){const s=c.valueSpec,h=Dr(c.value.type);let m,v,S,C={};const M=h!=="categorical"&&c.value.property===void 0,P=!M,O=Vn(c.value.stops)==="array"&&Vn(c.value.stops[0])==="array"&&Vn(c.value.stops[0][0])==="object",H=Mi({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(ce){if(h==="identity")return[new vt(ce.key,ce.value,'identity function may not have a "stops" property')];let me=[];const ve=ce.value;return me=me.concat(Qc({key:ce.key,value:ve,valueSpec:ce.valueSpec,validateSpec:ce.validateSpec,style:ce.style,styleSpec:ce.styleSpec,arrayElementValidator:K})),Vn(ve)==="array"&&ve.length===0&&me.push(new vt(ce.key,ve,"array must have at least one stop")),me},default:function(ce){return ce.validateSpec({key:ce.key,value:ce.value,valueSpec:s,validateSpec:ce.validateSpec,style:ce.style,styleSpec:ce.styleSpec})}}});return h==="identity"&&M&&H.push(new vt(c.key,c.value,'missing required property "property"')),h==="identity"||c.value.stops||H.push(new vt(c.key,c.value,'missing required property "stops"')),h==="exponential"&&c.valueSpec.expression&&!Wc(c.valueSpec)&&H.push(new vt(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(P&&!ia(c.valueSpec)?H.push(new vt(c.key,c.value,"property functions not supported")):M&&!Gh(c.valueSpec)&&H.push(new vt(c.key,c.value,"zoom functions not supported"))),h!=="categorical"&&!O||c.value.property!==void 0||H.push(new vt(c.key,c.value,'"property" property is required')),H;function K(ce){let me=[];const ve=ce.value,Te=ce.key;if(Vn(ve)!=="array")return[new vt(Te,ve,`array expected, ${Vn(ve)} found`)];if(ve.length!==2)return[new vt(Te,ve,`array length 2 expected, length ${ve.length} found`)];if(O){if(Vn(ve[0])!=="object")return[new vt(Te,ve,`object expected, ${Vn(ve[0])} found`)];if(ve[0].zoom===void 0)return[new vt(Te,ve,"object stop key must have zoom")];if(ve[0].value===void 0)return[new vt(Te,ve,"object stop key must have value")];if(S&&S>Dr(ve[0].zoom))return[new vt(Te,ve[0].zoom,"stop zoom values must appear in ascending order")];Dr(ve[0].zoom)!==S&&(S=Dr(ve[0].zoom),v=void 0,C={}),me=me.concat(Mi({key:`${Te}[0]`,value:ve[0],valueSpec:{zoom:{}},validateSpec:ce.validateSpec,style:ce.style,styleSpec:ce.styleSpec,objectElementValidators:{zoom:Vl,value:re}}))}else me=me.concat(re({key:`${Te}[0]`,value:ve[0],valueSpec:{},validateSpec:ce.validateSpec,style:ce.style,styleSpec:ce.styleSpec},ve));return fr(_s(ve[1]))?me.concat([new vt(`${Te}[1]`,ve[1],"expressions are not allowed in function stops.")]):me.concat(ce.validateSpec({key:`${Te}[1]`,value:ve[1],valueSpec:s,validateSpec:ce.validateSpec,style:ce.style,styleSpec:ce.styleSpec}))}function re(ce,me){const ve=Vn(ce.value),Te=Dr(ce.value),Pe=ce.value!==null?ce.value:me;if(m){if(ve!==m)return[new vt(ce.key,Pe,`${ve} stop domain type must match previous stop domain type ${m}`)]}else m=ve;if(ve!=="number"&&ve!=="string"&&ve!=="boolean")return[new vt(ce.key,Pe,"stop domain value must be a number, string, or boolean")];if(ve!=="number"&&h!=="categorical"){let Ze=`number expected, ${ve} found`;return ia(s)&&h===void 0&&(Ze+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new vt(ce.key,Pe,Ze)]}return h!=="categorical"||ve!=="number"||isFinite(Te)&&Math.floor(Te)===Te?h!=="categorical"&&ve==="number"&&v!==void 0&&Te<v?[new vt(ce.key,Pe,"stop domain values must appear in ascending order")]:(v=Te,h==="categorical"&&Te in C?[new vt(ce.key,Pe,"stop domain values must be unique")]:(C[Te]=!0,[])):[new vt(ce.key,Pe,`integer expected, found ${Te}`)]}}function gs(c){const s=(c.expressionContext==="property"?Wh:Is)(_s(c.value),c.valueSpec);if(s.result==="error")return s.value.map(m=>new vt(`${c.key}${m.key}`,c.value,m.message));const h=s.value.expression||s.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!h.outputDefined())return[new vt(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!ja(h))return[new vt(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!ja(h))return[new vt(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!Ua(h,["zoom","feature-state"]))return[new vt(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!Ml(h))return[new vt(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ys(c){const s=c.key,h=c.value,m=c.valueSpec,v=[];return Array.isArray(m.values)?m.values.indexOf(Dr(h))===-1&&v.push(new vt(s,h,`expected one of [${m.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(m.values).indexOf(Dr(h))===-1&&v.push(new vt(s,h,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(h)} found`)),v}function oa(c){return Bl(_s(c.value))?gs(Vr({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):eu(c)}function eu(c){const s=c.value,h=c.key;if(Vn(s)!=="array")return[new vt(h,s,`array expected, ${Vn(s)} found`)];const m=c.styleSpec;let v,S=[];if(s.length<1)return[new vt(h,s,"filter array must have at least 1 element")];switch(S=S.concat(ys({key:`${h}[0]`,value:s[0],valueSpec:m.filter_operator,style:c.style,styleSpec:c.styleSpec})),Dr(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&Dr(s[1])==="$type"&&S.push(new vt(h,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&S.push(new vt(h,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(v=Vn(s[1]),v!=="string"&&S.push(new vt(`${h}[1]`,s[1],`string expected, ${v} found`)));for(let C=2;C<s.length;C++)v=Vn(s[C]),Dr(s[1])==="$type"?S=S.concat(ys({key:`${h}[${C}]`,value:s[C],valueSpec:m.geometry_type,style:c.style,styleSpec:c.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&S.push(new vt(`${h}[${C}]`,s[C],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let C=1;C<s.length;C++)S=S.concat(eu({key:`${h}[${C}]`,value:s[C],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":v=Vn(s[1]),s.length!==2?S.push(new vt(h,s,`filter array for "${s[0]}" operator must have 2 elements`)):v!=="string"&&S.push(new vt(`${h}[1]`,s[1],`string expected, ${v} found`));break;case"within":v=Vn(s[1]),s.length!==2?S.push(new vt(h,s,`filter array for "${s[0]}" operator must have 2 elements`)):v!=="object"&&S.push(new vt(`${h}[1]`,s[1],`object expected, ${v} found`))}return S}function ql(c,s){const h=c.key,m=c.validateSpec,v=c.style,S=c.styleSpec,C=c.value,M=c.objectKey,P=S[`${s}_${c.layerType}`];if(!P)return[];const O=M.match(/^(.*)-transition$/);if(s==="paint"&&O&&P[O[1]]&&P[O[1]].transition)return m({key:h,value:C,valueSpec:S.transition,style:v,styleSpec:S});const H=c.valueSpec||P[M];if(!H)return[new vt(h,C,`unknown property "${M}"`)];let K;if(Vn(C)==="string"&&ia(H)&&!H.tokens&&(K=/^{([^}]+)}$/.exec(C)))return[new vt(h,C,`"${M}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(K[1])} }\`.`)];const re=[];return c.layerType==="symbol"&&(M==="text-field"&&v&&!v.glyphs&&re.push(new vt(h,C,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&Dl(_s(C))&&Dr(C.type)==="identity"&&re.push(new vt(h,C,'"text-font" does not support identity functions'))),re.concat(m({key:c.key,value:C,valueSpec:H,style:v,styleSpec:S,expressionContext:"property",propertyType:s,propertyKey:M}))}function tu(c){return ql(c,"paint")}function nu(c){return ql(c,"layout")}function Ga(c){let s=[];const h=c.value,m=c.key,v=c.style,S=c.styleSpec;h.type||h.ref||s.push(new vt(m,h,'either "type" or "ref" is required'));let C=Dr(h.type);const M=Dr(h.ref);if(h.id){const P=Dr(h.id);for(let O=0;O<c.arrayIndex;O++){const H=v.layers[O];Dr(H.id)===P&&s.push(new vt(m,h.id,`duplicate layer id "${h.id}", previously used at line ${H.id.__line__}`))}}if("ref"in h){let P;["type","source","source-layer","filter","layout"].forEach(O=>{O in h&&s.push(new vt(m,h[O],`"${O}" is prohibited for ref layers`))}),v.layers.forEach(O=>{Dr(O.id)===M&&(P=O)}),P?P.ref?s.push(new vt(m,h.ref,"ref cannot reference another ref layer")):C=Dr(P.type):s.push(new vt(m,h.ref,`ref layer "${M}" not found`))}else if(C!=="background")if(h.source){const P=v.sources&&v.sources[h.source],O=P&&Dr(P.type);P?O==="vector"&&C==="raster"?s.push(new vt(m,h.source,`layer "${h.id}" requires a raster source`)):O!=="raster-dem"&&C==="hillshade"?s.push(new vt(m,h.source,`layer "${h.id}" requires a raster-dem source`)):O==="raster"&&C!=="raster"?s.push(new vt(m,h.source,`layer "${h.id}" requires a vector source`)):O!=="vector"||h["source-layer"]?O==="raster-dem"&&C!=="hillshade"?s.push(new vt(m,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):C!=="line"||!h.paint||!h.paint["line-gradient"]||O==="geojson"&&P.lineMetrics||s.push(new vt(m,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new vt(m,h,`layer "${h.id}" must specify a "source-layer"`)):s.push(new vt(m,h.source,`source "${h.source}" not found`))}else s.push(new vt(m,h,'missing required property "source"'));return s=s.concat(Mi({key:m,value:h,valueSpec:S.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${m}.type`,value:h.type,valueSpec:S.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:h,objectKey:"type"}),filter:oa,layout:P=>Mi({layer:h,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":O=>nu(Vr({layerType:C},O))}}),paint:P=>Mi({layer:h,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":O=>tu(Vr({layerType:C},O))}})}})),s}function As(c){const s=c.value,h=c.key,m=Vn(s);return m!=="string"?[new vt(h,s,`string expected, ${m} found`)]:[]}const tf={promoteId:function({key:c,value:s}){if(Vn(s)==="string")return As({key:c,value:s});{const h=[];for(const m in s)h.push(...As({key:`${c}.${m}`,value:s[m]}));return h}}};function nf(c){const s=c.value,h=c.key,m=c.styleSpec,v=c.style,S=c.validateSpec;if(!s.type)return[new vt(h,s,'"type" is required')];const C=Dr(s.type);let M;switch(C){case"vector":case"raster":return M=Mi({key:h,value:s,valueSpec:m[`source_${C.replace("-","_")}`],style:c.style,styleSpec:m,objectElementValidators:tf,validateSpec:S}),M;case"raster-dem":return M=function(P){var O;const H=(O=P.sourceName)!==null&&O!==void 0?O:"",K=P.value,re=P.styleSpec,ce=re.source_raster_dem,me=P.style;let ve=[];const Te=Vn(K);if(K===void 0)return ve;if(Te!=="object")return ve.push(new vt("source_raster_dem",K,`object expected, ${Te} found`)),ve;const Pe=Dr(K.encoding)==="custom",Ze=["redFactor","greenFactor","blueFactor","baseShift"],$e=P.value.encoding?`"${P.value.encoding}"`:"Default";for(const Ne in K)!Pe&&Ze.includes(Ne)?ve.push(new vt(Ne,K[Ne],`In "${H}": "${Ne}" is only valid when "encoding" is set to "custom". ${$e} encoding found`)):ce[Ne]?ve=ve.concat(P.validateSpec({key:Ne,value:K[Ne],valueSpec:ce[Ne],validateSpec:P.validateSpec,style:me,styleSpec:re})):ve.push(new vt(Ne,K[Ne],`unknown property "${Ne}"`));return ve}({sourceName:h,value:s,style:c.style,styleSpec:m,validateSpec:S}),M;case"geojson":if(M=Mi({key:h,value:s,valueSpec:m.source_geojson,style:v,styleSpec:m,validateSpec:S,objectElementValidators:tf}),s.cluster)for(const P in s.clusterProperties){const[O,H]=s.clusterProperties[P],K=typeof O=="string"?[O,["accumulated"],["get",P]]:O;M.push(...gs({key:`${h}.${P}.map`,value:H,validateSpec:S,expressionContext:"cluster-map"})),M.push(...gs({key:`${h}.${P}.reduce`,value:K,validateSpec:S,expressionContext:"cluster-reduce"}))}return M;case"video":return Mi({key:h,value:s,valueSpec:m.source_video,style:v,validateSpec:S,styleSpec:m});case"image":return Mi({key:h,value:s,valueSpec:m.source_image,style:v,validateSpec:S,styleSpec:m});case"canvas":return[new vt(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ys({key:`${h}.type`,value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,validateSpec:S,styleSpec:m})}}function rf(c){const s=c.value,h=c.styleSpec,m=h.light,v=c.style;let S=[];const C=Vn(s);if(s===void 0)return S;if(C!=="object")return S=S.concat([new vt("light",s,`object expected, ${C} found`)]),S;for(const M in s){const P=M.match(/^(.*)-transition$/);S=S.concat(P&&m[P[1]]&&m[P[1]].transition?c.validateSpec({key:M,value:s[M],valueSpec:h.transition,validateSpec:c.validateSpec,style:v,styleSpec:h}):m[M]?c.validateSpec({key:M,value:s[M],valueSpec:m[M],validateSpec:c.validateSpec,style:v,styleSpec:h}):[new vt(M,s[M],`unknown property "${M}"`)])}return S}function of(c){const s=c.value,h=c.styleSpec,m=h.sky,v=c.style,S=Vn(s);if(s===void 0)return[];if(S!=="object")return[new vt("sky",s,`object expected, ${S} found`)];let C=[];for(const M in s)C=C.concat(m[M]?No({key:M,value:s[M],valueSpec:m[M],style:v,styleSpec:h}):[new vt(M,s[M],`unknown property "${M}"`)]);return C}function Ha(c){const s=c.value,h=c.styleSpec,m=h.terrain,v=c.style;let S=[];const C=Vn(s);if(s===void 0)return S;if(C!=="object")return S=S.concat([new vt("terrain",s,`object expected, ${C} found`)]),S;for(const M in s)S=S.concat(m[M]?c.validateSpec({key:M,value:s[M],valueSpec:m[M],validateSpec:c.validateSpec,style:v,styleSpec:h}):[new vt(M,s[M],`unknown property "${M}"`)]);return S}function Wa(c){let s=[];const h=c.value,m=c.key;if(Array.isArray(h)){const v=[],S=[];for(const C in h)h[C].id&&v.includes(h[C].id)&&s.push(new vt(m,h,`all the sprites' ids must be unique, but ${h[C].id} is duplicated`)),v.push(h[C].id),h[C].url&&S.includes(h[C].url)&&s.push(new vt(m,h,`all the sprites' URLs must be unique, but ${h[C].url} is duplicated`)),S.push(h[C].url),s=s.concat(Mi({key:`${m}[${C}]`,value:h[C],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return s}return As({key:m,value:h})}const Ri={"*":()=>[],array:Qc,boolean:function(c){const s=c.value,h=c.key,m=Vn(s);return m!=="boolean"?[new vt(h,s,`boolean expected, ${m} found`)]:[]},number:Vl,color:function(c){const s=c.key,h=c.value,m=Vn(h);return m!=="string"?[new vt(s,h,`color expected, ${m} found`)]:nr.parse(String(h))?[]:[new vt(s,h,`color expected, "${h}" found`)]},constants:Qh,enum:ys,filter:oa,function:ef,layer:Ga,object:Mi,source:nf,light:rf,sky:of,terrain:Ha,string:As,formatted:function(c){return As(c).length===0?[]:gs(c)},resolvedImage:function(c){return As(c).length===0?[]:gs(c)},padding:function(c){const s=c.key,h=c.value;if(Vn(h)==="array"){if(h.length<1||h.length>4)return[new vt(s,h,`padding requires 1 to 4 values; ${h.length} values found`)];const m={type:"number"};let v=[];for(let S=0;S<h.length;S++)v=v.concat(c.validateSpec({key:`${s}[${S}]`,value:h[S],validateSpec:c.validateSpec,valueSpec:m}));return v}return Vl({key:s,value:h,valueSpec:{}})},variableAnchorOffsetCollection:function(c){const s=c.key,h=c.value,m=Vn(h),v=c.styleSpec;if(m!=="array"||h.length<1||h.length%2!=0)return[new vt(s,h,"variableAnchorOffsetCollection requires a non-empty array of even length")];let S=[];for(let C=0;C<h.length;C+=2)S=S.concat(ys({key:`${s}[${C}]`,value:h[C],valueSpec:v.layout_symbol["text-anchor"]})),S=S.concat(Qc({key:`${s}[${C+1}]`,value:h[C+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:v}));return S},sprite:Wa};function No(c){const s=c.value,h=c.valueSpec,m=c.styleSpec;return c.validateSpec=No,h.expression&&Dl(Dr(s))?ef(c):h.expression&&fr(_s(s))?gs(c):h.type&&Ri[h.type]?Ri[h.type](c):Mi(Vr({},c,{valueSpec:h.type?m[h.type]:h}))}function ru(c){const s=c.value,h=c.key,m=As(c);return m.length||(s.indexOf("{fontstack}")===-1&&m.push(new vt(h,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&m.push(new vt(h,s,'"glyphs" url must include a "{range}" token'))),m}function yo(c,s=ye){let h=[];return h=h.concat(No({key:"",value:c,valueSpec:s.$root,styleSpec:s,style:c,validateSpec:No,objectElementValidators:{glyphs:ru,"*":()=>[]}})),c.constants&&(h=h.concat(Qh({key:"constants",value:c.constants,style:c,styleSpec:s,validateSpec:No}))),sa(h)}function jo(c){return function(s){return c({...s,validateSpec:No})}}function sa(c){return[].concat(c).sort((s,h)=>s.line-h.line)}function bo(c){return function(...s){return sa(c.apply(this,s))}}yo.source=bo(jo(nf)),yo.sprite=bo(jo(Wa)),yo.glyphs=bo(jo(ru)),yo.light=bo(jo(rf)),yo.sky=bo(jo(of)),yo.terrain=bo(jo(Ha)),yo.layer=bo(jo(Ga)),yo.filter=bo(jo(oa)),yo.paintProperty=bo(jo(tu)),yo.layoutProperty=bo(jo(nu));const Ps=yo,Hd=Ps.light,iu=Ps.paintProperty,Wd=Ps.layoutProperty;function aa(c,s){let h=!1;if(s&&s.length)for(const m of s)c.fire(new kt(new Error(m.message))),h=!0;return h}class Ka{constructor(s,h,m){const v=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;const C=new Int32Array(this.arrayBuffer);s=C[0],this.d=(h=C[1])+2*(m=C[2]);for(let P=0;P<this.d*this.d;P++){const O=C[3+P],H=C[3+P+1];v.push(O===H?null:C.subarray(O,H))}const M=C[3+v.length+1];this.keys=C.subarray(C[3+v.length],M),this.bboxes=C.subarray(M),this.insert=this._insertReadonly}else{this.d=h+2*m;for(let C=0;C<this.d*this.d;C++)v.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=s,this.padding=m,this.scale=h/s,this.uid=0;const S=m/h*s;this.min=-S,this.max=s+S}insert(s,h,m,v,S){this._forEachCell(h,m,v,S,this._insertCell,this.uid++,void 0,void 0),this.keys.push(s),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(S)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(s,h,m,v,S,C){this.cells[S].push(C)}query(s,h,m,v,S){const C=this.min,M=this.max;if(s<=C&&h<=C&&M<=m&&M<=v&&!S)return Array.prototype.slice.call(this.keys);{const P=[];return this._forEachCell(s,h,m,v,this._queryCell,P,{},S),P}}_queryCell(s,h,m,v,S,C,M,P){const O=this.cells[S];if(O!==null){const H=this.keys,K=this.bboxes;for(let re=0;re<O.length;re++){const ce=O[re];if(M[ce]===void 0){const me=4*ce;(P?P(K[me+0],K[me+1],K[me+2],K[me+3]):s<=K[me+2]&&h<=K[me+3]&&m>=K[me+0]&&v>=K[me+1])?(M[ce]=!0,C.push(H[ce])):M[ce]=!1}}}}_forEachCell(s,h,m,v,S,C,M,P){const O=this._convertToCellCoord(s),H=this._convertToCellCoord(h),K=this._convertToCellCoord(m),re=this._convertToCellCoord(v);for(let ce=O;ce<=K;ce++)for(let me=H;me<=re;me++){const ve=this.d*me+ce;if((!P||P(this._convertFromCellCoord(ce),this._convertFromCellCoord(me),this._convertFromCellCoord(ce+1),this._convertFromCellCoord(me+1)))&&S.call(this,s,h,m,v,ve,C,M,P))return}}_convertFromCellCoord(s){return(s-this.padding)/this.scale}_convertToCellCoord(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const s=this.cells,h=3+this.cells.length+1+1;let m=0;for(let C=0;C<this.cells.length;C++)m+=this.cells[C].length;const v=new Int32Array(h+m+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;let S=h;for(let C=0;C<s.length;C++){const M=s[C];v[3+C]=S,v.set(M,S),S+=M.length}return v[3+s.length]=S,v.set(this.keys,S),S+=this.keys.length,v[3+s.length+1]=S,v.set(this.bboxes,S),S+=this.bboxes.length,v.buffer}static serialize(s,h){const m=s.toArrayBuffer();return h&&h.push(m),{buffer:m}}static deserialize(s){return new Ka(s.buffer)}}const Uo={};function Ht(c,s,h={}){if(Uo[c])throw new Error(`${c} is already registered.`);Object.defineProperty(s,"_classRegistryKey",{value:c,writeable:!1}),Uo[c]={klass:s,omit:h.omit||[],shallow:h.shallow||[]}}Ht("Object",Object),Ht("TransferableGridIndex",Ka),Ht("Color",nr),Ht("Error",Error),Ht("AJAXError",Mt),Ht("ResolvedImage",lo),Ht("StylePropertyFunction",$l),Ht("StyleExpression",gr,{omit:["_evaluator"]}),Ht("ZoomDependentExpression",Xc),Ht("ZoomConstantExpression",Rl),Ht("CompoundExpression",Xi,{omit:["_evaluate"]});for(const c in na)na[c]._classRegistryKey||Ht(`Expression_${c}`,na[c]);function Zl(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function la(c,s){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error)return c;if(Zl(c)||De(c))return s&&s.push(c),c;if(ArrayBuffer.isView(c)){const h=c;return s&&s.push(h.buffer),h}if(c instanceof ImageData)return s&&s.push(c.data.buffer),c;if(Array.isArray(c)){const h=[];for(const m of c)h.push(la(m,s));return h}if(typeof c=="object"){const h=c.constructor,m=h._classRegistryKey;if(!m)throw new Error(`can't serialize object of unregistered class ${h.name}`);if(!Uo[m])throw new Error(`${m} is not registered.`);const v=h.serialize?h.serialize(c,s):{};if(h.serialize){if(s&&v===s[s.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const S in c){if(!c.hasOwnProperty(S)||Uo[m].omit.indexOf(S)>=0)continue;const C=c[S];v[S]=Uo[m].shallow.indexOf(S)>=0?C:la(C,s)}c instanceof Error&&(v.message=c.message)}if(v.$name)throw new Error("$name property is reserved for worker serialization logic.");return m!=="Object"&&(v.$name=m),v}throw new Error("can't serialize object of type "+typeof c)}function ca(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error||Zl(c)||De(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(ca);if(typeof c=="object"){const s=c.$name||"Object";if(!Uo[s])throw new Error(`can't deserialize unregistered class ${s}`);const{klass:h}=Uo[s];if(!h)throw new Error(`can't deserialize unregistered class ${s}`);if(h.deserialize)return h.deserialize(c);const m=Object.create(h.prototype);for(const v of Object.keys(c)){if(v==="$name")continue;const S=c[v];m[v]=Uo[s].shallow.indexOf(v)>=0?S:ca(S)}return m}throw new Error("can't deserialize object of type "+typeof c)}class sf{constructor(){this.first=!0}update(s,h){const m=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=m,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=m,!0):(this.lastFloorZoom>m?(this.lastIntegerZoom=m+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<m&&(this.lastIntegerZoom=m,this.lastIntegerZoomTime=h),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=m,!0))}}const Vt={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function ua(c){for(const s of c)if(Gl(s.charCodeAt(0)))return!0;return!1}function af(c){for(const s of c)if(!lf(s.charCodeAt(0)))return!1;return!0}function lf(c){return!(Vt.Arabic(c)||Vt["Arabic Supplement"](c)||Vt["Arabic Extended-A"](c)||Vt["Arabic Presentation Forms-A"](c)||Vt["Arabic Presentation Forms-B"](c))}function Gl(c){return!(c!==746&&c!==747&&(c<4352||!(Vt["Bopomofo Extended"](c)||Vt.Bopomofo(c)||Vt["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||Vt["CJK Compatibility Ideographs"](c)||Vt["CJK Compatibility"](c)||Vt["CJK Radicals Supplement"](c)||Vt["CJK Strokes"](c)||!(!Vt["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||Vt["CJK Unified Ideographs Extension A"](c)||Vt["CJK Unified Ideographs"](c)||Vt["Enclosed CJK Letters and Months"](c)||Vt["Hangul Compatibility Jamo"](c)||Vt["Hangul Jamo Extended-A"](c)||Vt["Hangul Jamo Extended-B"](c)||Vt["Hangul Jamo"](c)||Vt["Hangul Syllables"](c)||Vt.Hiragana(c)||Vt["Ideographic Description Characters"](c)||Vt.Kanbun(c)||Vt["Kangxi Radicals"](c)||Vt["Katakana Phonetic Extensions"](c)||Vt.Katakana(c)&&c!==12540||!(!Vt["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!Vt["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||Vt["Unified Canadian Aboriginal Syllabics"](c)||Vt["Unified Canadian Aboriginal Syllabics Extended"](c)||Vt["Vertical Forms"](c)||Vt["Yijing Hexagram Symbols"](c)||Vt["Yi Syllables"](c)||Vt["Yi Radicals"](c))))}function ou(c){return!(Gl(c)||function(s){return!!(Vt["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||Vt["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||Vt["Letterlike Symbols"](s)||Vt["Number Forms"](s)||Vt["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||Vt["Control Pictures"](s)&&s!==9251||Vt["Optical Character Recognition"](s)||Vt["Enclosed Alphanumerics"](s)||Vt["Geometric Shapes"](s)||Vt["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||Vt["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||Vt["CJK Symbols and Punctuation"](s)||Vt.Katakana(s)||Vt["Private Use Area"](s)||Vt["CJK Compatibility Forms"](s)||Vt["Small Form Variants"](s)||Vt["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(c))}function Hl(c){return c>=1424&&c<=2303||Vt["Arabic Presentation Forms-A"](c)||Vt["Arabic Presentation Forms-B"](c)}function cf(c,s){return!(!s&&Hl(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||Vt.Khmer(c))}function Kd(c){for(const s of c)if(Hl(s.charCodeAt(0)))return!0;return!1}const bs=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(c){this.pluginStatus=c.pluginStatus,this.pluginURL=c.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(c){this.applyArabicShaping=c.applyArabicShaping,this.processBidirectionalText=c.processBidirectionalText,this.processStyledBidirectionalText=c.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class wr{constructor(s,h){this.zoom=s,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new sf,this.transition={})}isSupportedScript(s){return function(h,m){for(const v of h)if(!cf(v.charCodeAt(0),m))return!1;return!0}(s,bs.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const s=this.zoom,h=s-Math.floor(s),m=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*m}:{fromScale:.5,toScale:1,t:1-(1-m)*h}}}class Xa{constructor(s,h){this.property=s,this.value=h,this.expression=function(m,v){if(Dl(m))return new $l(m,v);if(fr(m)){const S=Wh(m,v);if(S.result==="error")throw new Error(S.value.map(C=>`${C.key}: ${C.message}`).join(", "));return S.value}{let S=m;return v.type==="color"&&typeof m=="string"?S=nr.parse(m):v.type!=="padding"||typeof m!="number"&&!Array.isArray(m)?v.type==="variableAnchorOffsetCollection"&&Array.isArray(m)&&(S=ao.parse(m)):S=Di.parse(m),{kind:"constant",evaluate:()=>S}}}(h===void 0?s.specification.default:h,s.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(s,h,m){return this.property.possiblyEvaluate(this,s,h,m)}}class Wl{constructor(s){this.property=s,this.value=new Xa(s,void 0)}transitioned(s,h){return new uf(this.property,this.value,h,J({},s.transition,this.transition),s.now)}untransitioned(){return new uf(this.property,this.value,null,{},0)}}class su{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues)}getValue(s){return ee(this._values[s].value.value)}setValue(s,h){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new Wl(this._values[s].property)),this._values[s].value=new Xa(this._values[s].property,h===null?void 0:ee(h))}getTransition(s){return ee(this._values[s].transition)}setTransition(s,h){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new Wl(this._values[s].property)),this._values[s].transition=ee(h)||void 0}serialize(){const s={};for(const h of Object.keys(this._values)){const m=this.getValue(h);m!==void 0&&(s[h]=m);const v=this.getTransition(h);v!==void 0&&(s[`${h}-transition`]=v)}return s}transitioned(s,h){const m=new hf(this._properties);for(const v of Object.keys(this._values))m._values[v]=this._values[v].transitioned(s,h._values[v]);return m}untransitioned(){const s=new hf(this._properties);for(const h of Object.keys(this._values))s._values[h]=this._values[h].untransitioned();return s}}class uf{constructor(s,h,m,v,S){this.property=s,this.value=h,this.begin=S+v.delay||0,this.end=this.begin+v.duration||0,s.specification.transition&&(v.delay||v.duration)&&(this.prior=m)}possiblyEvaluate(s,h,m){const v=s.now||0,S=this.value.possiblyEvaluate(s,h,m),C=this.prior;if(C){if(v>this.end)return this.prior=null,S;if(this.value.isDataDriven())return this.prior=null,S;if(v<this.begin)return C.possiblyEvaluate(s,h,m);{const M=(v-this.begin)/(this.end-this.begin);return this.property.interpolate(C.possiblyEvaluate(s,h,m),S,function(P){if(P<=0)return 0;if(P>=1)return 1;const O=P*P,H=O*P;return 4*(P<.5?H:3*(P-O)+H-.75)}(M))}}return S}}class hf{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,h,m){const v=new Ja(this._properties);for(const S of Object.keys(this._values))v._values[S]=this._values[S].possiblyEvaluate(s,h,m);return v}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class ff{constructor(s){this._properties=s,this._values=Object.create(s.defaultPropertyValues)}hasValue(s){return this._values[s].value!==void 0}getValue(s){return ee(this._values[s].value)}setValue(s,h){this._values[s]=new Xa(this._values[s].property,h===null?void 0:ee(h))}serialize(){const s={};for(const h of Object.keys(this._values)){const m=this.getValue(h);m!==void 0&&(s[h]=m)}return s}possiblyEvaluate(s,h,m){const v=new Ja(this._properties);for(const S of Object.keys(this._values))v._values[S]=this._values[S].possiblyEvaluate(s,h,m);return v}}class vo{constructor(s,h,m){this.property=s,this.value=h,this.parameters=m}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,h,m,v){return this.property.evaluate(this.value,this.parameters,s,h,m,v)}}class Ja{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class rn{constructor(s){this.specification=s}possiblyEvaluate(s,h){if(s.isDataDriven())throw new Error("Value should not be data driven");return s.expression.evaluate(h)}interpolate(s,h,m){const v=Ti[this.specification.type];return v?v(s,h,m):s}}class cn{constructor(s,h){this.specification=s,this.overrides=h}possiblyEvaluate(s,h,m,v){return new vo(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(h,null,{},m,v)}:s.expression,h)}interpolate(s,h,m){if(s.value.kind!=="constant"||h.value.kind!=="constant")return s;if(s.value.value===void 0||h.value.value===void 0)return new vo(this,{kind:"constant",value:void 0},s.parameters);const v=Ti[this.specification.type];if(v){const S=v(s.value.value,h.value.value,m);return new vo(this,{kind:"constant",value:S},s.parameters)}return s}evaluate(s,h,m,v,S,C){return s.kind==="constant"?s.value:s.evaluate(h,m,v,S,C)}}class Kl extends cn{possiblyEvaluate(s,h,m,v){if(s.value===void 0)return new vo(this,{kind:"constant",value:void 0},h);if(s.expression.kind==="constant"){const S=s.expression.evaluate(h,null,{},m,v),C=s.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,M=this._calculate(C,C,C,h);return new vo(this,{kind:"constant",value:M},h)}if(s.expression.kind==="camera"){const S=this._calculate(s.expression.evaluate({zoom:h.zoom-1}),s.expression.evaluate({zoom:h.zoom}),s.expression.evaluate({zoom:h.zoom+1}),h);return new vo(this,{kind:"constant",value:S},h)}return new vo(this,s.expression,h)}evaluate(s,h,m,v,S,C){if(s.kind==="source"){const M=s.evaluate(h,m,v,S,C);return this._calculate(M,M,M,h)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(h.zoom)-1},m,v),s.evaluate({zoom:Math.floor(h.zoom)},m,v),s.evaluate({zoom:Math.floor(h.zoom)+1},m,v),h):s.value}_calculate(s,h,m,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:s,to:h}:{from:m,to:h}}interpolate(s){return s}}class Ya{constructor(s){this.specification=s}possiblyEvaluate(s,h,m,v){if(s.value!==void 0){if(s.expression.kind==="constant"){const S=s.expression.evaluate(h,null,{},m,v);return this._calculate(S,S,S,h)}return this._calculate(s.expression.evaluate(new wr(Math.floor(h.zoom-1),h)),s.expression.evaluate(new wr(Math.floor(h.zoom),h)),s.expression.evaluate(new wr(Math.floor(h.zoom+1),h)),h)}}_calculate(s,h,m,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:s,to:h}:{from:m,to:h}}interpolate(s){return s}}class au{constructor(s){this.specification=s}possiblyEvaluate(s,h,m,v){return!!s.expression.evaluate(h,null,{},m,v)}interpolate(){return!1}}class $i{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in s){const m=s[h];m.specification.overridable&&this.overridableProperties.push(h);const v=this.defaultPropertyValues[h]=new Xa(m,void 0),S=this.defaultTransitionablePropertyValues[h]=new Wl(m);this.defaultTransitioningPropertyValues[h]=S.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=v.possiblyEvaluate({})}}}Ht("DataDrivenProperty",cn),Ht("DataConstantProperty",rn),Ht("CrossFadedDataDrivenProperty",Kl),Ht("CrossFadedProperty",Ya),Ht("ColorRampProperty",au);const lu="-transition";class wo extends Ut{constructor(s,h){if(super(),this.id=s.id,this.type=s.type,this._featureFilter={filter:()=>!0,needGeometry:!1},s.type!=="custom"&&(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),h.layout&&(this._unevaluatedLayout=new ff(h.layout)),h.paint)){this._transitionablePaint=new su(h.paint);for(const m in s.paint)this.setPaintProperty(m,s.paint[m],{validate:!1});for(const m in s.layout)this.setLayoutProperty(m,s.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ja(h.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}setLayoutProperty(s,h,m={}){h!=null&&this._validate(Wd,`layers.${this.id}.layout.${s}`,s,h,m)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,h):this.visibility=h)}getPaintProperty(s){return s.endsWith(lu)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}setPaintProperty(s,h,m={}){if(h!=null&&this._validate(iu,`layers.${this.id}.paint.${s}`,s,h,m))return!1;if(s.endsWith(lu))return this._transitionablePaint.setTransition(s.slice(0,-11),h||void 0),!1;{const v=this._transitionablePaint._values[s],S=v.property.specification["property-type"]==="cross-faded-data-driven",C=v.value.isDataDriven(),M=v.value;this._transitionablePaint.setValue(s,h),this._handleSpecialPaintPropertyUpdate(s);const P=this._transitionablePaint._values[s].value;return P.isDataDriven()||C||S||this._handleOverridablePaintPropertyUpdate(s,M,P)}}_handleSpecialPaintPropertyUpdate(s){}_handleOverridablePaintPropertyUpdate(s,h,m){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,h){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,h)}serialize(){const s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),ze(s,(h,m)=>!(h===void 0||m==="layout"&&!Object.keys(h).length||m==="paint"&&!Object.keys(h).length))}_validate(s,h,m,v,S={}){return(!S||S.validate!==!1)&&aa(this,s.call(Ps,{key:h,layerType:this.type,objectKey:m,value:v,styleSpec:ye,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const s in this.paint._values){const h=this.paint.get(s);if(h instanceof vo&&ia(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}}const df={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Qa{constructor(s,h){this._structArray=s,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Rr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(s,h){return s._trim(),h&&(s.isTransferred=!0,h.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const h=Object.create(this.prototype);return h.arrayBuffer=s.arrayBuffer,h.length=s.length,h.capacity=s.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Zr(c,s=1){let h=0,m=0;return{members:c.map(v=>{const S=df[v.type].BYTES_PER_ELEMENT,C=h=pf(h,Math.max(s,S)),M=v.components||1;return m=Math.max(m,S),h+=S*M,{name:v.name,type:v.type,components:M,offset:C}}),size:pf(h,Math.max(m,s)),alignment:s}}function pf(c,s){return Math.ceil(c/s)*s}class el extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h){const m=this.length;return this.resize(m+1),this.emplace(m,s,h)}emplace(s,h,m){const v=2*s;return this.int16[v+0]=h,this.int16[v+1]=m,s}}el.prototype.bytesPerElement=4,Ht("StructArrayLayout2i4",el);class es extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,s,h,m)}emplace(s,h,m,v){const S=3*s;return this.int16[S+0]=h,this.int16[S+1]=m,this.int16[S+2]=v,s}}es.prototype.bytesPerElement=6,Ht("StructArrayLayout3i6",es);class cu extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,s,h,m,v)}emplace(s,h,m,v,S){const C=4*s;return this.int16[C+0]=h,this.int16[C+1]=m,this.int16[C+2]=v,this.int16[C+3]=S,s}}cu.prototype.bytesPerElement=8,Ht("StructArrayLayout4i8",cu);class uu extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,C){const M=this.length;return this.resize(M+1),this.emplace(M,s,h,m,v,S,C)}emplace(s,h,m,v,S,C,M){const P=6*s;return this.int16[P+0]=h,this.int16[P+1]=m,this.int16[P+2]=v,this.int16[P+3]=S,this.int16[P+4]=C,this.int16[P+5]=M,s}}uu.prototype.bytesPerElement=12,Ht("StructArrayLayout2i4i12",uu);class hu extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,C){const M=this.length;return this.resize(M+1),this.emplace(M,s,h,m,v,S,C)}emplace(s,h,m,v,S,C,M){const P=4*s,O=8*s;return this.int16[P+0]=h,this.int16[P+1]=m,this.uint8[O+4]=v,this.uint8[O+5]=S,this.uint8[O+6]=C,this.uint8[O+7]=M,s}}hu.prototype.bytesPerElement=8,Ht("StructArrayLayout2i4ub8",hu);class tl extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h){const m=this.length;return this.resize(m+1),this.emplace(m,s,h)}emplace(s,h,m){const v=2*s;return this.float32[v+0]=h,this.float32[v+1]=m,s}}tl.prototype.bytesPerElement=8,Ht("StructArrayLayout2f8",tl);class Xl extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,C,M,P,O,H){const K=this.length;return this.resize(K+1),this.emplace(K,s,h,m,v,S,C,M,P,O,H)}emplace(s,h,m,v,S,C,M,P,O,H,K){const re=10*s;return this.uint16[re+0]=h,this.uint16[re+1]=m,this.uint16[re+2]=v,this.uint16[re+3]=S,this.uint16[re+4]=C,this.uint16[re+5]=M,this.uint16[re+6]=P,this.uint16[re+7]=O,this.uint16[re+8]=H,this.uint16[re+9]=K,s}}Xl.prototype.bytesPerElement=20,Ht("StructArrayLayout10ui20",Xl);class fu extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,C,M,P,O,H,K,re){const ce=this.length;return this.resize(ce+1),this.emplace(ce,s,h,m,v,S,C,M,P,O,H,K,re)}emplace(s,h,m,v,S,C,M,P,O,H,K,re,ce){const me=12*s;return this.int16[me+0]=h,this.int16[me+1]=m,this.int16[me+2]=v,this.int16[me+3]=S,this.uint16[me+4]=C,this.uint16[me+5]=M,this.uint16[me+6]=P,this.uint16[me+7]=O,this.int16[me+8]=H,this.int16[me+9]=K,this.int16[me+10]=re,this.int16[me+11]=ce,s}}fu.prototype.bytesPerElement=24,Ht("StructArrayLayout4i4ui4i24",fu);class du extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,s,h,m)}emplace(s,h,m,v){const S=3*s;return this.float32[S+0]=h,this.float32[S+1]=m,this.float32[S+2]=v,s}}du.prototype.bytesPerElement=12,Ht("StructArrayLayout3f12",du);class ts extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const h=this.length;return this.resize(h+1),this.emplace(h,s)}emplace(s,h){return this.uint32[1*s+0]=h,s}}ts.prototype.bytesPerElement=4,Ht("StructArrayLayout1ul4",ts);class Jl extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,C,M,P,O){const H=this.length;return this.resize(H+1),this.emplace(H,s,h,m,v,S,C,M,P,O)}emplace(s,h,m,v,S,C,M,P,O,H){const K=10*s,re=5*s;return this.int16[K+0]=h,this.int16[K+1]=m,this.int16[K+2]=v,this.int16[K+3]=S,this.int16[K+4]=C,this.int16[K+5]=M,this.uint32[re+3]=P,this.uint16[K+8]=O,this.uint16[K+9]=H,s}}Jl.prototype.bytesPerElement=20,Ht("StructArrayLayout6i1ul2ui20",Jl);class nl extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,C){const M=this.length;return this.resize(M+1),this.emplace(M,s,h,m,v,S,C)}emplace(s,h,m,v,S,C,M){const P=6*s;return this.int16[P+0]=h,this.int16[P+1]=m,this.int16[P+2]=v,this.int16[P+3]=S,this.int16[P+4]=C,this.int16[P+5]=M,s}}nl.prototype.bytesPerElement=12,Ht("StructArrayLayout2i2i2i12",nl);class Yl extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S){const C=this.length;return this.resize(C+1),this.emplace(C,s,h,m,v,S)}emplace(s,h,m,v,S,C){const M=4*s,P=8*s;return this.float32[M+0]=h,this.float32[M+1]=m,this.float32[M+2]=v,this.int16[P+6]=S,this.int16[P+7]=C,s}}Yl.prototype.bytesPerElement=16,Ht("StructArrayLayout2f1f2i16",Yl);class rl extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,s,h,m,v)}emplace(s,h,m,v,S){const C=12*s,M=3*s;return this.uint8[C+0]=h,this.uint8[C+1]=m,this.float32[M+1]=v,this.float32[M+2]=S,s}}rl.prototype.bytesPerElement=12,Ht("StructArrayLayout2ub2f12",rl);class Ql extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,s,h,m)}emplace(s,h,m,v){const S=3*s;return this.uint16[S+0]=h,this.uint16[S+1]=m,this.uint16[S+2]=v,s}}Ql.prototype.bytesPerElement=6,Ht("StructArrayLayout3ui6",Ql);class ha extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,C,M,P,O,H,K,re,ce,me,ve,Te,Pe){const Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,s,h,m,v,S,C,M,P,O,H,K,re,ce,me,ve,Te,Pe)}emplace(s,h,m,v,S,C,M,P,O,H,K,re,ce,me,ve,Te,Pe,Ze){const $e=24*s,Ne=12*s,ct=48*s;return this.int16[$e+0]=h,this.int16[$e+1]=m,this.uint16[$e+2]=v,this.uint16[$e+3]=S,this.uint32[Ne+2]=C,this.uint32[Ne+3]=M,this.uint32[Ne+4]=P,this.uint16[$e+10]=O,this.uint16[$e+11]=H,this.uint16[$e+12]=K,this.float32[Ne+7]=re,this.float32[Ne+8]=ce,this.uint8[ct+36]=me,this.uint8[ct+37]=ve,this.uint8[ct+38]=Te,this.uint32[Ne+10]=Pe,this.int16[$e+22]=Ze,s}}ha.prototype.bytesPerElement=48,Ht("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ha);class zs extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,C,M,P,O,H,K,re,ce,me,ve,Te,Pe,Ze,$e,Ne,ct,ft,Zt,Jt,qt,jt,zt,Wt){const Ft=this.length;return this.resize(Ft+1),this.emplace(Ft,s,h,m,v,S,C,M,P,O,H,K,re,ce,me,ve,Te,Pe,Ze,$e,Ne,ct,ft,Zt,Jt,qt,jt,zt,Wt)}emplace(s,h,m,v,S,C,M,P,O,H,K,re,ce,me,ve,Te,Pe,Ze,$e,Ne,ct,ft,Zt,Jt,qt,jt,zt,Wt,Ft){const wt=32*s,ln=16*s;return this.int16[wt+0]=h,this.int16[wt+1]=m,this.int16[wt+2]=v,this.int16[wt+3]=S,this.int16[wt+4]=C,this.int16[wt+5]=M,this.int16[wt+6]=P,this.int16[wt+7]=O,this.uint16[wt+8]=H,this.uint16[wt+9]=K,this.uint16[wt+10]=re,this.uint16[wt+11]=ce,this.uint16[wt+12]=me,this.uint16[wt+13]=ve,this.uint16[wt+14]=Te,this.uint16[wt+15]=Pe,this.uint16[wt+16]=Ze,this.uint16[wt+17]=$e,this.uint16[wt+18]=Ne,this.uint16[wt+19]=ct,this.uint16[wt+20]=ft,this.uint16[wt+21]=Zt,this.uint16[wt+22]=Jt,this.uint32[ln+12]=qt,this.float32[ln+13]=jt,this.float32[ln+14]=zt,this.uint16[wt+30]=Wt,this.uint16[wt+31]=Ft,s}}zs.prototype.bytesPerElement=64,Ht("StructArrayLayout8i15ui1ul2f2ui64",zs);class ec extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const h=this.length;return this.resize(h+1),this.emplace(h,s)}emplace(s,h){return this.float32[1*s+0]=h,s}}ec.prototype.bytesPerElement=4,Ht("StructArrayLayout1f4",ec);class tc extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,s,h,m)}emplace(s,h,m,v){const S=3*s;return this.uint16[6*s+0]=h,this.float32[S+1]=m,this.float32[S+2]=v,s}}tc.prototype.bytesPerElement=12,Ht("StructArrayLayout1ui2f12",tc);class Ds extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,s,h,m)}emplace(s,h,m,v){const S=4*s;return this.uint32[2*s+0]=h,this.uint16[S+2]=m,this.uint16[S+3]=v,s}}Ds.prototype.bytesPerElement=8,Ht("StructArrayLayout1ul2ui8",Ds);class pu extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h){const m=this.length;return this.resize(m+1),this.emplace(m,s,h)}emplace(s,h,m){const v=2*s;return this.uint16[v+0]=h,this.uint16[v+1]=m,s}}pu.prototype.bytesPerElement=4,Ht("StructArrayLayout2ui4",pu);class mu extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const h=this.length;return this.resize(h+1),this.emplace(h,s)}emplace(s,h){return this.uint16[1*s+0]=h,s}}mu.prototype.bytesPerElement=2,Ht("StructArrayLayout1ui2",mu);class nc extends Rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,s,h,m,v)}emplace(s,h,m,v,S){const C=4*s;return this.float32[C+0]=h,this.float32[C+1]=m,this.float32[C+2]=v,this.float32[C+3]=S,s}}nc.prototype.bytesPerElement=16,Ht("StructArrayLayout4f16",nc);class mf extends Qa{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new y(this.anchorPointX,this.anchorPointY)}}mf.prototype.size=20;class x extends Jl{get(s){return new mf(this,s)}}Ht("CollisionBoxArray",x);class l extends Qa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(s){this._structArray.uint8[this._pos1+37]=s}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(s){this._structArray.uint8[this._pos1+38]=s}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(s){this._structArray.uint32[this._pos4+10]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}l.prototype.size=48;class f extends ha{get(s){return new l(this,s)}}Ht("PlacedSymbolArray",f);class _ extends Qa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(s){this._structArray.uint32[this._pos4+12]=s}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}_.prototype.size=64;class b extends zs{get(s){return new _(this,s)}}Ht("SymbolInstanceArray",b);class k extends ec{getoffsetX(s){return this.float32[1*s+0]}}Ht("GlyphOffsetArray",k);class E extends es{getx(s){return this.int16[3*s+0]}gety(s){return this.int16[3*s+1]}gettileUnitDistanceFromAnchor(s){return this.int16[3*s+2]}}Ht("SymbolLineVertexArray",E);class A extends Qa{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}A.prototype.size=12;class B extends tc{get(s){return new A(this,s)}}Ht("TextAnchorOffsetArray",B);class Z extends Qa{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Z.prototype.size=8;class X extends Ds{get(s){return new Z(this,s)}}Ht("FeatureIndexArray",X);class Q extends el{}class pe extends el{}class Se extends el{}class ke extends uu{}class Me extends hu{}class be extends tl{}class Fe extends Xl{}class Je extends fu{}class Le extends du{}class Ue extends ts{}class Qe extends nl{}class et extends rl{}class ot extends Ql{}class _t extends pu{}const dt=Zr([{name:"a_pos",components:2,type:"Int16"}],4),{members:At}=dt;class Rt{constructor(s=[]){this.segments=s}prepareSegment(s,h,m,v){let S=this.segments[this.segments.length-1];return s>Rt.MAX_VERTEX_ARRAY_LENGTH&&Ee(`Max vertices per segment is ${Rt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}`),(!S||S.vertexLength+s>Rt.MAX_VERTEX_ARRAY_LENGTH||S.sortKey!==v)&&(S={vertexOffset:h.length,primitiveOffset:m.length,vertexLength:0,primitiveLength:0},v!==void 0&&(S.sortKey=v),this.segments.push(S)),S}get(){return this.segments}destroy(){for(const s of this.segments)for(const h in s.vaos)s.vaos[h].destroy()}static simpleSegment(s,h,m,v){return new Rt([{vertexOffset:s,primitiveOffset:h,vertexLength:m,primitiveLength:v,vaos:{},sortKey:0}])}}function yn(c,s){return 256*(c=W(Math.floor(c),0,255))+W(Math.floor(s),0,255)}Rt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ht("SegmentVector",Rt);const $t=Zr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var fn={exports:{}},bn={exports:{}};bn.exports=function(c,s){var h,m,v,S,C,M,P,O;for(m=c.length-(h=3&c.length),v=s,C=3432918353,M=461845907,O=0;O<m;)P=255&c.charCodeAt(O)|(255&c.charCodeAt(++O))<<8|(255&c.charCodeAt(++O))<<16|(255&c.charCodeAt(++O))<<24,++O,v=27492+(65535&(S=5*(65535&(v=(v^=P=(65535&(P=(P=(65535&P)*C+(((P>>>16)*C&65535)<<16)&4294967295)<<15|P>>>17))*M+(((P>>>16)*M&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(P=0,h){case 3:P^=(255&c.charCodeAt(O+2))<<16;case 2:P^=(255&c.charCodeAt(O+1))<<8;case 1:v^=P=(65535&(P=(P=(65535&(P^=255&c.charCodeAt(O)))*C+(((P>>>16)*C&65535)<<16)&4294967295)<<15|P>>>17))*M+(((P>>>16)*M&65535)<<16)&4294967295}return v^=c.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0};var Nn=bn.exports,gn={exports:{}};gn.exports=function(c,s){for(var h,m=c.length,v=s^m,S=0;m>=4;)h=1540483477*(65535&(h=255&c.charCodeAt(S)|(255&c.charCodeAt(++S))<<8|(255&c.charCodeAt(++S))<<16|(255&c.charCodeAt(++S))<<24))+((1540483477*(h>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),m-=4,++S;switch(m){case 3:v^=(255&c.charCodeAt(S+2))<<16;case 2:v^=(255&c.charCodeAt(S+1))<<8;case 1:v=1540483477*(65535&(v^=255&c.charCodeAt(S)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0};var xn=Nn,Tn=gn.exports;fn.exports=xn,fn.exports.murmur3=xn,fn.exports.murmur2=Tn;var $r=d(fn.exports);class ir{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(s,h,m,v){this.ids.push(Ji(s)),this.positions.push(h,m,v)}getPositions(s){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const h=Ji(s);let m=0,v=this.ids.length-1;for(;m<v;){const C=m+v>>1;this.ids[C]>=h?v=C:m=C+1}const S=[];for(;this.ids[m]===h;)S.push({index:this.positions[3*m],start:this.positions[3*m+1],end:this.positions[3*m+2]}),m++;return S}static serialize(s,h){const m=new Float64Array(s.ids),v=new Uint32Array(s.positions);return ri(m,v,0,m.length-1),h&&h.push(m.buffer,v.buffer),{ids:m,positions:v}}static deserialize(s){const h=new ir;return h.ids=s.ids,h.positions=s.positions,h.indexed=!0,h}}function Ji(c){const s=+c;return!isNaN(s)&&s<=Number.MAX_SAFE_INTEGER?s:$r(String(c))}function ri(c,s,h,m){for(;h<m;){const v=c[h+m>>1];let S=h-1,C=m+1;for(;;){do S++;while(c[S]<v);do C--;while(c[C]>v);if(S>=C)break;Cr(c,S,C),Cr(s,3*S,3*C),Cr(s,3*S+1,3*C+1),Cr(s,3*S+2,3*C+2)}C-h<m-C?(ri(c,s,h,C),h=C+1):(ri(c,s,C+1,m),m=C)}}function Cr(c,s,h){const m=c[s];c[s]=c[h],c[h]=m}Ht("FeaturePositionMap",ir);class ii{constructor(s,h){this.gl=s.gl,this.location=h}}class Yi extends ii{constructor(s,h){super(s,h),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Vo extends ii{constructor(s,h){super(s,h),this.current=[0,0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))}}class vs extends ii{constructor(s,h){super(s,h),this.current=nr.transparent}set(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))}}const il=new Float32Array(16);function ws(c){return[yn(255*c.r,255*c.g),yn(255*c.b,255*c.a)]}class qo{constructor(s,h,m){this.value=s,this.uniformNames=h.map(v=>`u_${v}`),this.type=m}setUniform(s,h,m){s.set(m.constantOr(this.value))}getBinding(s,h,m){return this.type==="color"?new vs(s,h):new Yi(s,h)}}class Kr{constructor(s,h){this.uniformNames=h.map(m=>`u_${m}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(s,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=s.tlbr}setUniform(s,h,m,v){const S=v==="u_pattern_to"?this.patternTo:v==="u_pattern_from"?this.patternFrom:v==="u_pixel_ratio_to"?this.pixelRatioTo:v==="u_pixel_ratio_from"?this.pixelRatioFrom:null;S&&s.set(S)}getBinding(s,h,m){return m.substr(0,9)==="u_pattern"?new Vo(s,h):new Yi(s,h)}}class Tr{constructor(s,h,m,v){this.expression=s,this.type=m,this.maxValue=0,this.paintVertexAttributes=h.map(S=>({name:`a_${S}`,type:"Float32",components:m==="color"?2:1,offset:0})),this.paintVertexArray=new v}populatePaintArray(s,h,m,v,S){const C=this.paintVertexArray.length,M=this.expression.evaluate(new wr(0),h,{},v,[],S);this.paintVertexArray.resize(s),this._setPaintValue(C,s,M)}updatePaintArray(s,h,m,v){const S=this.expression.evaluate({zoom:0},m,v);this._setPaintValue(s,h,S)}_setPaintValue(s,h,m){if(this.type==="color"){const v=ws(m);for(let S=s;S<h;S++)this.paintVertexArray.emplace(S,v[0],v[1])}else{for(let v=s;v<h;v++)this.paintVertexArray.emplace(v,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class xr{constructor(s,h,m,v,S,C){this.expression=s,this.uniformNames=h.map(M=>`u_${M}_t`),this.type=m,this.useIntegerZoom=v,this.zoom=S,this.maxValue=0,this.paintVertexAttributes=h.map(M=>({name:`a_${M}`,type:"Float32",components:m==="color"?4:2,offset:0})),this.paintVertexArray=new C}populatePaintArray(s,h,m,v,S){const C=this.expression.evaluate(new wr(this.zoom),h,{},v,[],S),M=this.expression.evaluate(new wr(this.zoom+1),h,{},v,[],S),P=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(P,s,C,M)}updatePaintArray(s,h,m,v){const S=this.expression.evaluate({zoom:this.zoom},m,v),C=this.expression.evaluate({zoom:this.zoom+1},m,v);this._setPaintValue(s,h,S,C)}_setPaintValue(s,h,m,v){if(this.type==="color"){const S=ws(m),C=ws(v);for(let M=s;M<h;M++)this.paintVertexArray.emplace(M,S[0],S[1],C[0],C[1])}else{for(let S=s;S<h;S++)this.paintVertexArray.emplace(S,m,v);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(v))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,h){const m=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,v=W(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);s.set(v)}getBinding(s,h,m){return new Yi(s,h)}}class co{constructor(s,h,m,v,S,C){this.expression=s,this.type=h,this.useIntegerZoom=m,this.zoom=v,this.layerId=C,this.zoomInPaintVertexArray=new S,this.zoomOutPaintVertexArray=new S}populatePaintArray(s,h,m){const v=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(v,s,h.patterns&&h.patterns[this.layerId],m)}updatePaintArray(s,h,m,v,S){this._setPaintValues(s,h,m.patterns&&m.patterns[this.layerId],S)}_setPaintValues(s,h,m,v){if(!v||!m)return;const{min:S,mid:C,max:M}=m,P=v[S],O=v[C],H=v[M];if(P&&O&&H)for(let K=s;K<h;K++)this.zoomInPaintVertexArray.emplace(K,O.tl[0],O.tl[1],O.br[0],O.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],O.pixelRatio,P.pixelRatio),this.zoomOutPaintVertexArray.emplace(K,O.tl[0],O.tl[1],O.br[0],O.br[1],H.tl[0],H.tl[1],H.br[0],H.br[1],O.pixelRatio,H.pixelRatio)}upload(s){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,$t.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,$t.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Xr{constructor(s,h,m){this.binders={},this._buffers=[];const v=[];for(const S in s.paint._values){if(!m(S))continue;const C=s.paint.get(S);if(!(C instanceof vo&&ia(C.property.specification)))continue;const M=uo(S,s.type),P=C.value,O=C.property.specification.type,H=C.property.useIntegerZoom,K=C.property.specification["property-type"],re=K==="cross-faded"||K==="cross-faded-data-driven";if(P.kind==="constant")this.binders[S]=re?new Kr(P.value,M):new qo(P.value,M,O),v.push(`/u_${S}`);else if(P.kind==="source"||re){const ce=Jr(S,O,"source");this.binders[S]=re?new co(P,O,H,h,ce,s.id):new Tr(P,M,O,ce),v.push(`/a_${S}`)}else{const ce=Jr(S,O,"composite");this.binders[S]=new xr(P,M,O,H,h,ce),v.push(`/z_${S}`)}}this.cacheKey=v.sort().join("")}getMaxValue(s){const h=this.binders[s];return h instanceof Tr||h instanceof xr?h.maxValue:0}populatePaintArrays(s,h,m,v,S){for(const C in this.binders){const M=this.binders[C];(M instanceof Tr||M instanceof xr||M instanceof co)&&M.populatePaintArray(s,h,m,v,S)}}setConstantPatternPositions(s,h){for(const m in this.binders){const v=this.binders[m];v instanceof Kr&&v.setConstantPatternPositions(s,h)}}updatePaintArrays(s,h,m,v,S){let C=!1;for(const M in s){const P=h.getPositions(M);for(const O of P){const H=m.feature(O.index);for(const K in this.binders){const re=this.binders[K];if((re instanceof Tr||re instanceof xr||re instanceof co)&&re.expression.isStateDependent===!0){const ce=v.paint.get(K);re.expression=ce.value,re.updatePaintArray(O.start,O.end,H,s[M],S),C=!0}}}}return C}defines(){const s=[];for(const h in this.binders){const m=this.binders[h];(m instanceof qo||m instanceof Kr)&&s.push(...m.uniformNames.map(v=>`#define HAS_UNIFORM_${v}`))}return s}getBinderAttributes(){const s=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof Tr||m instanceof xr)for(let v=0;v<m.paintVertexAttributes.length;v++)s.push(m.paintVertexAttributes[v].name);else if(m instanceof co)for(let v=0;v<$t.members.length;v++)s.push($t.members[v].name)}return s}getBinderUniforms(){const s=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof qo||m instanceof Kr||m instanceof xr)for(const v of m.uniformNames)s.push(v)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s,h){const m=[];for(const v in this.binders){const S=this.binders[v];if(S instanceof qo||S instanceof Kr||S instanceof xr){for(const C of S.uniformNames)if(h[C]){const M=S.getBinding(s,h[C],C);m.push({name:C,property:v,binding:M})}}}return m}setUniforms(s,h,m,v){for(const{name:S,property:C,binding:M}of h)this.binders[C].setUniform(M,v,m.get(C),S)}updatePaintBuffers(s){this._buffers=[];for(const h in this.binders){const m=this.binders[h];if(s&&m instanceof co){const v=s.fromScale===2?m.zoomInPaintVertexBuffer:m.zoomOutPaintVertexBuffer;v&&this._buffers.push(v)}else(m instanceof Tr||m instanceof xr)&&m.paintVertexBuffer&&this._buffers.push(m.paintVertexBuffer)}}upload(s){for(const h in this.binders){const m=this.binders[h];(m instanceof Tr||m instanceof xr||m instanceof co)&&m.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const h=this.binders[s];(h instanceof Tr||h instanceof xr||h instanceof co)&&h.destroy()}}}class Mr{constructor(s,h,m=()=>!0){this.programConfigurations={};for(const v of s)this.programConfigurations[v.id]=new Xr(v,h,m);this.needsUpload=!1,this._featureMap=new ir,this._bufferOffset=0}populatePaintArrays(s,h,m,v,S,C){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(s,h,v,S,C);h.id!==void 0&&this._featureMap.add(h.id,m,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,h,m,v){for(const S of m)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(s,this._featureMap,h,S,v)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}function uo(c,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${s}-`,"").replace(/-/g,"_")]}function Jr(c,s,h){const m={color:{source:tl,composite:nc},number:{source:ec,composite:tl}},v=function(S){return{"line-pattern":{source:Fe,composite:Fe},"fill-pattern":{source:Fe,composite:Fe},"fill-extrusion-pattern":{source:Fe,composite:Fe}}[S]}(c);return v&&v[h]||m[s][h]}Ht("ConstantBinder",qo),Ht("CrossFadedConstantBinder",Kr),Ht("SourceExpressionBinder",Tr),Ht("CrossFadedCompositeBinder",co),Ht("CompositeExpressionBinder",xr),Ht("ProgramConfiguration",Xr,{omit:["_buffers"]}),Ht("ProgramConfigurationSet",Mr);const jr=8192,_u=Math.pow(2,14)-1,_f=-_u-1;function Rs(c){const s=jr/c.extent,h=c.loadGeometry();for(let m=0;m<h.length;m++){const v=h[m];for(let S=0;S<v.length;S++){const C=v[S],M=Math.round(C.x*s),P=Math.round(C.y*s);C.x=W(M,_f,_u),C.y=W(P,_f,_u),(M<C.x||M>C.x+1||P<C.y||P>C.y+1)&&Ee("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function $s(c,s){return{type:c.type,id:c.id,properties:c.properties,geometry:s?Rs(c):[]}}function rc(c,s,h,m,v){c.emplaceBack(2*s+(m+1)/2,2*h+(v+1)/2)}class xs{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(h=>h.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new pe,this.indexArray=new ot,this.segments=new Rt,this.programConfigurations=new Mr(s.layers,s.zoom),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(s,h,m){const v=this.layers[0],S=[];let C=null,M=!1;v.type==="circle"&&(C=v.layout.get("circle-sort-key"),M=!C.isConstant());for(const{feature:P,id:O,index:H,sourceLayerIndex:K}of s){const re=this.layers[0]._featureFilter.needGeometry,ce=$s(P,re);if(!this.layers[0]._featureFilter.filter(new wr(this.zoom),ce,m))continue;const me=M?C.evaluate(ce,{},m):void 0,ve={id:O,properties:P.properties,type:P.type,sourceLayerIndex:K,index:H,geometry:re?ce.geometry:Rs(P),patterns:{},sortKey:me};S.push(ve)}M&&S.sort((P,O)=>P.sortKey-O.sortKey);for(const P of S){const{geometry:O,index:H,sourceLayerIndex:K}=P,re=s[H].feature;this.addFeature(P,O,H,m),h.featureIndex.insert(re,O,H,K,this.index)}}update(s,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,At),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,h,m,v){for(const S of h)for(const C of S){const M=C.x,P=C.y;if(M<0||M>=jr||P<0||P>=jr)continue;const O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),H=O.vertexLength;rc(this.layoutVertexArray,M,P,-1,-1),rc(this.layoutVertexArray,M,P,1,-1),rc(this.layoutVertexArray,M,P,1,1),rc(this.layoutVertexArray,M,P,-1,1),this.indexArray.emplaceBack(H,H+1,H+2),this.indexArray.emplaceBack(H,H+3,H+2),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,m,{},v)}}function gu(c,s){for(let h=0;h<c.length;h++)if(oc(s,c[h]))return!0;for(let h=0;h<s.length;h++)if(oc(c,s[h]))return!0;return!!ic(c,s)}function gf(c,s,h){return!!oc(c,s)||!!Xd(s,c,h)}function yu(c,s){if(c.length===1)return r_(s,c[0]);for(let h=0;h<s.length;h++){const m=s[h];for(let v=0;v<m.length;v++)if(oc(c,m[v]))return!0}for(let h=0;h<c.length;h++)if(r_(s,c[h]))return!0;for(let h=0;h<s.length;h++)if(ic(c,s[h]))return!0;return!1}function bu(c,s,h){if(c.length>1){if(ic(c,s))return!0;for(let m=0;m<s.length;m++)if(Xd(s[m],c,h))return!0}for(let m=0;m<c.length;m++)if(Xd(c[m],s,h))return!0;return!1}function ic(c,s){if(c.length===0||s.length===0)return!1;for(let h=0;h<c.length-1;h++){const m=c[h],v=c[h+1];for(let S=0;S<s.length-1;S++)if(vu(m,v,s[S],s[S+1]))return!0}return!1}function vu(c,s,h,m){return we(c,h,m)!==we(s,h,m)&&we(c,s,h)!==we(c,s,m)}function Xd(c,s,h){const m=h*h;if(s.length===1)return c.distSqr(s[0])<m;for(let v=1;v<s.length;v++)if(n_(c,s[v-1],s[v])<m)return!0;return!1}function n_(c,s,h){const m=s.distSqr(h);if(m===0)return c.distSqr(s);const v=((c.x-s.x)*(h.x-s.x)+(c.y-s.y)*(h.y-s.y))/m;return c.distSqr(v<0?s:v>1?h:h.sub(s)._mult(v)._add(s))}function r_(c,s){let h,m,v,S=!1;for(let C=0;C<c.length;C++){h=c[C];for(let M=0,P=h.length-1;M<h.length;P=M++)m=h[M],v=h[P],m.y>s.y!=v.y>s.y&&s.x<(v.x-m.x)*(s.y-m.y)/(v.y-m.y)+m.x&&(S=!S)}return S}function oc(c,s){let h=!1;for(let m=0,v=c.length-1;m<c.length;v=m++){const S=c[m],C=c[v];S.y>s.y!=C.y>s.y&&s.x<(C.x-S.x)*(s.y-S.y)/(C.y-S.y)+S.x&&(h=!h)}return h}function Xv(c,s,h){const m=h[0],v=h[2];if(c.x<m.x&&s.x<m.x||c.x>v.x&&s.x>v.x||c.y<m.y&&s.y<m.y||c.y>v.y&&s.y>v.y)return!1;const S=we(c,s,h[0]);return S!==we(c,s,h[1])||S!==we(c,s,h[2])||S!==we(c,s,h[3])}function wu(c,s,h){const m=s.paint.get(c).value;return m.kind==="constant"?m.value:h.programConfigurations.get(s.id).getMaxValue(c)}function yf(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function bf(c,s,h,m,v){if(!s[0]&&!s[1])return c;const S=y.convert(s)._mult(v);h==="viewport"&&S._rotate(-m);const C=[];for(let M=0;M<c.length;M++)C.push(c[M].sub(S));return C}let i_,o_;Ht("CircleBucket",xs,{omit:["layers"]});var Jv={get paint(){return o_=o_||new $i({"circle-radius":new cn(ye.paint_circle["circle-radius"]),"circle-color":new cn(ye.paint_circle["circle-color"]),"circle-blur":new cn(ye.paint_circle["circle-blur"]),"circle-opacity":new cn(ye.paint_circle["circle-opacity"]),"circle-translate":new rn(ye.paint_circle["circle-translate"]),"circle-translate-anchor":new rn(ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new rn(ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new rn(ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new cn(ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new cn(ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new cn(ye.paint_circle["circle-stroke-opacity"])})},get layout(){return i_=i_||new $i({"circle-sort-key":new cn(ye.layout_circle["circle-sort-key"])})}},Fi=1e-6,sc=typeof Float32Array<"u"?Float32Array:Array;function Jd(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function s_(c,s,h){var m=s[0],v=s[1],S=s[2],C=s[3],M=s[4],P=s[5],O=s[6],H=s[7],K=s[8],re=s[9],ce=s[10],me=s[11],ve=s[12],Te=s[13],Pe=s[14],Ze=s[15],$e=h[0],Ne=h[1],ct=h[2],ft=h[3];return c[0]=$e*m+Ne*M+ct*K+ft*ve,c[1]=$e*v+Ne*P+ct*re+ft*Te,c[2]=$e*S+Ne*O+ct*ce+ft*Pe,c[3]=$e*C+Ne*H+ct*me+ft*Ze,c[4]=($e=h[4])*m+(Ne=h[5])*M+(ct=h[6])*K+(ft=h[7])*ve,c[5]=$e*v+Ne*P+ct*re+ft*Te,c[6]=$e*S+Ne*O+ct*ce+ft*Pe,c[7]=$e*C+Ne*H+ct*me+ft*Ze,c[8]=($e=h[8])*m+(Ne=h[9])*M+(ct=h[10])*K+(ft=h[11])*ve,c[9]=$e*v+Ne*P+ct*re+ft*Te,c[10]=$e*S+Ne*O+ct*ce+ft*Pe,c[11]=$e*C+Ne*H+ct*me+ft*Ze,c[12]=($e=h[12])*m+(Ne=h[13])*M+(ct=h[14])*K+(ft=h[15])*ve,c[13]=$e*v+Ne*P+ct*re+ft*Te,c[14]=$e*S+Ne*O+ct*ce+ft*Pe,c[15]=$e*C+Ne*H+ct*me+ft*Ze,c}Math.hypot||(Math.hypot=function(){for(var c=0,s=arguments.length;s--;)c+=arguments[s]*arguments[s];return Math.sqrt(c)});var xu,Yv=s_;function vf(c,s,h){var m=s[0],v=s[1],S=s[2],C=s[3];return c[0]=h[0]*m+h[4]*v+h[8]*S+h[12]*C,c[1]=h[1]*m+h[5]*v+h[9]*S+h[13]*C,c[2]=h[2]*m+h[6]*v+h[10]*S+h[14]*C,c[3]=h[3]*m+h[7]*v+h[11]*S+h[15]*C,c}xu=new sc(4),sc!=Float32Array&&(xu[0]=0,xu[1]=0,xu[2]=0,xu[3]=0);class Qv extends wo{constructor(s){super(s,Jv)}createBucket(s){return new xs(s)}queryRadius(s){const h=s;return wu("circle-radius",this,h)+wu("circle-stroke-width",this,h)+yf(this.paint.get("circle-translate"))}queryIntersectsFeature(s,h,m,v,S,C,M,P){const O=bf(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),C.angle,M),H=this.paint.get("circle-radius").evaluate(h,m)+this.paint.get("circle-stroke-width").evaluate(h,m),K=this.paint.get("circle-pitch-alignment")==="map",re=K?O:function(me,ve){return me.map(Te=>a_(Te,ve))}(O,P),ce=K?H*M:H;for(const me of v)for(const ve of me){const Te=K?ve:a_(ve,P);let Pe=ce;const Ze=vf([],[ve.x,ve.y,0,1],P);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Pe*=Ze[3]/C.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Pe*=C.cameraToCenterDistance/Ze[3]),gf(re,Te,Pe))return!0}return!1}}function a_(c,s){const h=vf([],[c.x,c.y,0,1],s);return new y(h[0]/h[3],h[1]/h[3])}class l_ extends xs{}let c_;Ht("HeatmapBucket",l_,{omit:["layers"]});var ew={get paint(){return c_=c_||new $i({"heatmap-radius":new cn(ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new cn(ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new rn(ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new au(ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new rn(ye.paint_heatmap["heatmap-opacity"])})}};function Yd(c,{width:s,height:h},m,v){if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==s*h*m)throw new RangeError(`mismatched image size. expected: ${v.length} but got: ${s*h*m}`)}else v=new Uint8Array(s*h*m);return c.width=s,c.height=h,c.data=v,c}function u_(c,{width:s,height:h},m){if(s===c.width&&h===c.height)return;const v=Yd({},{width:s,height:h},m);Qd(c,v,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,s),height:Math.min(c.height,h)},m),c.width=s,c.height=h,c.data=v.data}function Qd(c,s,h,m,v,S){if(v.width===0||v.height===0)return s;if(v.width>c.width||v.height>c.height||h.x>c.width-v.width||h.y>c.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>s.width||v.height>s.height||m.x>s.width-v.width||m.y>s.height-v.height)throw new RangeError("out of range destination coordinates for image copy");const C=c.data,M=s.data;if(C===M)throw new Error("srcData equals dstData, so image is already copied");for(let P=0;P<v.height;P++){const O=((h.y+P)*c.width+h.x)*S,H=((m.y+P)*s.width+m.x)*S;for(let K=0;K<v.width*S;K++)M[H+K]=C[O+K]}return s}class ku{constructor(s,h){Yd(this,s,1,h)}resize(s){u_(this,s,1)}clone(){return new ku({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,h,m,v,S){Qd(s,h,m,v,S,1)}}class xo{constructor(s,h){Yd(this,s,4,h)}resize(s){u_(this,s,4)}replace(s,h){h?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new xo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,h,m,v,S){Qd(s,h,m,v,S,4)}}function h_(c){const s={},h=c.resolution||256,m=c.clips?c.clips.length:1,v=c.image||new xo({width:h,height:m});if(Math.log(h)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${h}`);const S=(C,M,P)=>{s[c.evaluationKey]=P;const O=c.expression.evaluate(s);v.data[C+M+0]=Math.floor(255*O.r/O.a),v.data[C+M+1]=Math.floor(255*O.g/O.a),v.data[C+M+2]=Math.floor(255*O.b/O.a),v.data[C+M+3]=Math.floor(255*O.a)};if(c.clips)for(let C=0,M=0;C<m;++C,M+=4*h)for(let P=0,O=0;P<h;P++,O+=4){const H=P/(h-1),{start:K,end:re}=c.clips[C];S(M,O,K*(1-H)+re*H)}else for(let C=0,M=0;C<h;C++,M+=4)S(0,M,C/(h-1));return v}Ht("AlphaImage",ku),Ht("RGBAImage",xo);class tw extends wo{createBucket(s){return new l_(s)}constructor(s){super(s,ew),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=h_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let f_;var nw={get paint(){return f_=f_||new $i({"hillshade-illumination-direction":new rn(ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new rn(ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new rn(ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new rn(ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new rn(ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new rn(ye.paint_hillshade["hillshade-accent-color"])})}};class rw extends wo{constructor(s){super(s,nw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const iw=Zr([{name:"a_pos",components:2,type:"Int16"}],4),{members:ow}=iw;var ep={exports:{}};function wf(c,s,h){h=h||2;var m,v,S,C,M,P,O,H=s&&s.length,K=H?s[0]*h:c.length,re=d_(c,0,K,h,!0),ce=[];if(!re||re.next===re.prev)return ce;if(H&&(re=function(ve,Te,Pe,Ze){var $e,Ne,ct,ft=[];for($e=0,Ne=Te.length;$e<Ne;$e++)(ct=d_(ve,Te[$e]*Ze,$e<Ne-1?Te[$e+1]*Ze:ve.length,Ze,!1))===ct.next&&(ct.steiner=!0),ft.push(dw(ct));for(ft.sort(uw),$e=0;$e<ft.length;$e++)Pe=hw(ft[$e],Pe);return Pe}(c,s,re,h)),c.length>80*h){m=S=c[0],v=C=c[1];for(var me=h;me<K;me+=h)(M=c[me])<m&&(m=M),(P=c[me+1])<v&&(v=P),M>S&&(S=M),P>C&&(C=P);O=(O=Math.max(S-m,C-v))!==0?32767/O:0}return Su(re,ce,h,m,v,O,0),ce}function d_(c,s,h,m,v){var S,C;if(v===rp(c,s,h,m)>0)for(S=s;S<h;S+=m)C=__(S,c[S],c[S+1],C);else for(S=h-m;S>=s;S-=m)C=__(S,c[S],c[S+1],C);return C&&xf(C,C.next)&&(Tu(C),C=C.next),C}function ol(c,s){if(!c)return c;s||(s=c);var h,m=c;do if(h=!1,m.steiner||!xf(m,m.next)&&Gr(m.prev,m,m.next)!==0)m=m.next;else{if(Tu(m),(m=s=m.prev)===m.next)break;h=!0}while(h||m!==s);return s}function Su(c,s,h,m,v,S,C){if(c){!C&&S&&function(H,K,re,ce){var me=H;do me.z===0&&(me.z=tp(me.x,me.y,K,re,ce)),me.prevZ=me.prev,me.nextZ=me.next,me=me.next;while(me!==H);me.prevZ.nextZ=null,me.prevZ=null,function(ve){var Te,Pe,Ze,$e,Ne,ct,ft,Zt,Jt=1;do{for(Pe=ve,ve=null,Ne=null,ct=0;Pe;){for(ct++,Ze=Pe,ft=0,Te=0;Te<Jt&&(ft++,Ze=Ze.nextZ);Te++);for(Zt=Jt;ft>0||Zt>0&&Ze;)ft!==0&&(Zt===0||!Ze||Pe.z<=Ze.z)?($e=Pe,Pe=Pe.nextZ,ft--):($e=Ze,Ze=Ze.nextZ,Zt--),Ne?Ne.nextZ=$e:ve=$e,$e.prevZ=Ne,Ne=$e;Pe=Ze}Ne.nextZ=null,Jt*=2}while(ct>1)}(me)}(c,m,v,S);for(var M,P,O=c;c.prev!==c.next;)if(M=c.prev,P=c.next,S?aw(c,m,v,S):sw(c))s.push(M.i/h|0),s.push(c.i/h|0),s.push(P.i/h|0),Tu(c),c=P.next,O=P.next;else if((c=P)===O){C?C===1?Su(c=lw(ol(c),s,h),s,h,m,v,S,2):C===2&&cw(c,s,h,m,v,S):Su(ol(c),s,h,m,v,S,1);break}}}function sw(c){var s=c.prev,h=c,m=c.next;if(Gr(s,h,m)>=0)return!1;for(var v=s.x,S=h.x,C=m.x,M=s.y,P=h.y,O=m.y,H=v<S?v<C?v:C:S<C?S:C,K=M<P?M<O?M:O:P<O?P:O,re=v>S?v>C?v:C:S>C?S:C,ce=M>P?M>O?M:O:P>O?P:O,me=m.next;me!==s;){if(me.x>=H&&me.x<=re&&me.y>=K&&me.y<=ce&&ac(v,M,S,P,C,O,me.x,me.y)&&Gr(me.prev,me,me.next)>=0)return!1;me=me.next}return!0}function aw(c,s,h,m){var v=c.prev,S=c,C=c.next;if(Gr(v,S,C)>=0)return!1;for(var M=v.x,P=S.x,O=C.x,H=v.y,K=S.y,re=C.y,ce=M<P?M<O?M:O:P<O?P:O,me=H<K?H<re?H:re:K<re?K:re,ve=M>P?M>O?M:O:P>O?P:O,Te=H>K?H>re?H:re:K>re?K:re,Pe=tp(ce,me,s,h,m),Ze=tp(ve,Te,s,h,m),$e=c.prevZ,Ne=c.nextZ;$e&&$e.z>=Pe&&Ne&&Ne.z<=Ze;){if($e.x>=ce&&$e.x<=ve&&$e.y>=me&&$e.y<=Te&&$e!==v&&$e!==C&&ac(M,H,P,K,O,re,$e.x,$e.y)&&Gr($e.prev,$e,$e.next)>=0||($e=$e.prevZ,Ne.x>=ce&&Ne.x<=ve&&Ne.y>=me&&Ne.y<=Te&&Ne!==v&&Ne!==C&&ac(M,H,P,K,O,re,Ne.x,Ne.y)&&Gr(Ne.prev,Ne,Ne.next)>=0))return!1;Ne=Ne.nextZ}for(;$e&&$e.z>=Pe;){if($e.x>=ce&&$e.x<=ve&&$e.y>=me&&$e.y<=Te&&$e!==v&&$e!==C&&ac(M,H,P,K,O,re,$e.x,$e.y)&&Gr($e.prev,$e,$e.next)>=0)return!1;$e=$e.prevZ}for(;Ne&&Ne.z<=Ze;){if(Ne.x>=ce&&Ne.x<=ve&&Ne.y>=me&&Ne.y<=Te&&Ne!==v&&Ne!==C&&ac(M,H,P,K,O,re,Ne.x,Ne.y)&&Gr(Ne.prev,Ne,Ne.next)>=0)return!1;Ne=Ne.nextZ}return!0}function lw(c,s,h){var m=c;do{var v=m.prev,S=m.next.next;!xf(v,S)&&p_(v,m,m.next,S)&&Cu(v,S)&&Cu(S,v)&&(s.push(v.i/h|0),s.push(m.i/h|0),s.push(S.i/h|0),Tu(m),Tu(m.next),m=c=S),m=m.next}while(m!==c);return ol(m)}function cw(c,s,h,m,v,S){var C=c;do{for(var M=C.next.next;M!==C.prev;){if(C.i!==M.i&&pw(C,M)){var P=m_(C,M);return C=ol(C,C.next),P=ol(P,P.next),Su(C,s,h,m,v,S,0),void Su(P,s,h,m,v,S,0)}M=M.next}C=C.next}while(C!==c)}function uw(c,s){return c.x-s.x}function hw(c,s){var h=function(v,S){var C,M=S,P=v.x,O=v.y,H=-1/0;do{if(O<=M.y&&O>=M.next.y&&M.next.y!==M.y){var K=M.x+(O-M.y)*(M.next.x-M.x)/(M.next.y-M.y);if(K<=P&&K>H&&(H=K,C=M.x<M.next.x?M:M.next,K===P))return C}M=M.next}while(M!==S);if(!C)return null;var re,ce=C,me=C.x,ve=C.y,Te=1/0;M=C;do P>=M.x&&M.x>=me&&P!==M.x&&ac(O<ve?P:H,O,me,ve,O<ve?H:P,O,M.x,M.y)&&(re=Math.abs(O-M.y)/(P-M.x),Cu(M,v)&&(re<Te||re===Te&&(M.x>C.x||M.x===C.x&&fw(C,M)))&&(C=M,Te=re)),M=M.next;while(M!==ce);return C}(c,s);if(!h)return s;var m=m_(h,c);return ol(m,m.next),ol(h,h.next)}function fw(c,s){return Gr(c.prev,c,s.prev)<0&&Gr(s.next,c,c.next)<0}function tp(c,s,h,m,v){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-h)*v|0)|c<<8))|c<<4))|c<<2))|c<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-m)*v|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function dw(c){var s=c,h=c;do(s.x<h.x||s.x===h.x&&s.y<h.y)&&(h=s),s=s.next;while(s!==c);return h}function ac(c,s,h,m,v,S,C,M){return(v-C)*(s-M)>=(c-C)*(S-M)&&(c-C)*(m-M)>=(h-C)*(s-M)&&(h-C)*(S-M)>=(v-C)*(m-M)}function pw(c,s){return c.next.i!==s.i&&c.prev.i!==s.i&&!function(h,m){var v=h;do{if(v.i!==h.i&&v.next.i!==h.i&&v.i!==m.i&&v.next.i!==m.i&&p_(v,v.next,h,m))return!0;v=v.next}while(v!==h);return!1}(c,s)&&(Cu(c,s)&&Cu(s,c)&&function(h,m){var v=h,S=!1,C=(h.x+m.x)/2,M=(h.y+m.y)/2;do v.y>M!=v.next.y>M&&v.next.y!==v.y&&C<(v.next.x-v.x)*(M-v.y)/(v.next.y-v.y)+v.x&&(S=!S),v=v.next;while(v!==h);return S}(c,s)&&(Gr(c.prev,c,s.prev)||Gr(c,s.prev,s))||xf(c,s)&&Gr(c.prev,c,c.next)>0&&Gr(s.prev,s,s.next)>0)}function Gr(c,s,h){return(s.y-c.y)*(h.x-s.x)-(s.x-c.x)*(h.y-s.y)}function xf(c,s){return c.x===s.x&&c.y===s.y}function p_(c,s,h,m){var v=Sf(Gr(c,s,h)),S=Sf(Gr(c,s,m)),C=Sf(Gr(h,m,c)),M=Sf(Gr(h,m,s));return v!==S&&C!==M||!(v!==0||!kf(c,h,s))||!(S!==0||!kf(c,m,s))||!(C!==0||!kf(h,c,m))||!(M!==0||!kf(h,s,m))}function kf(c,s,h){return s.x<=Math.max(c.x,h.x)&&s.x>=Math.min(c.x,h.x)&&s.y<=Math.max(c.y,h.y)&&s.y>=Math.min(c.y,h.y)}function Sf(c){return c>0?1:c<0?-1:0}function Cu(c,s){return Gr(c.prev,c,c.next)<0?Gr(c,s,c.next)>=0&&Gr(c,c.prev,s)>=0:Gr(c,s,c.prev)<0||Gr(c,c.next,s)<0}function m_(c,s){var h=new np(c.i,c.x,c.y),m=new np(s.i,s.x,s.y),v=c.next,S=s.prev;return c.next=s,s.prev=c,h.next=v,v.prev=h,m.next=h,h.prev=m,S.next=m,m.prev=S,m}function __(c,s,h,m){var v=new np(c,s,h);return m?(v.next=m.next,v.prev=m,m.next.prev=v,m.next=v):(v.prev=v,v.next=v),v}function Tu(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function np(c,s,h){this.i=c,this.x=s,this.y=h,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function rp(c,s,h,m){for(var v=0,S=s,C=h-m;S<h;S+=m)v+=(c[C]-c[S])*(c[S+1]+c[C+1]),C=S;return v}ep.exports=wf,ep.exports.default=wf,wf.deviation=function(c,s,h,m){var v=s&&s.length,S=Math.abs(rp(c,0,v?s[0]*h:c.length,h));if(v)for(var C=0,M=s.length;C<M;C++)S-=Math.abs(rp(c,s[C]*h,C<M-1?s[C+1]*h:c.length,h));var P=0;for(C=0;C<m.length;C+=3){var O=m[C]*h,H=m[C+1]*h,K=m[C+2]*h;P+=Math.abs((c[O]-c[K])*(c[H+1]-c[O+1])-(c[O]-c[H])*(c[K+1]-c[O+1]))}return S===0&&P===0?0:Math.abs((P-S)/S)},wf.flatten=function(c){for(var s=c[0][0].length,h={vertices:[],holes:[],dimensions:s},m=0,v=0;v<c.length;v++){for(var S=0;S<c[v].length;S++)for(var C=0;C<s;C++)h.vertices.push(c[v][S][C]);v>0&&h.holes.push(m+=c[v-1].length)}return h};var g_=d(ep.exports);function mw(c,s,h,m,v){y_(c,s,h||0,m||c.length-1,v||_w)}function y_(c,s,h,m,v){for(;m>h;){if(m-h>600){var S=m-h+1,C=s-h+1,M=Math.log(S),P=.5*Math.exp(2*M/3),O=.5*Math.sqrt(M*P*(S-P)/S)*(C-S/2<0?-1:1);y_(c,s,Math.max(h,Math.floor(s-C*P/S+O)),Math.min(m,Math.floor(s+(S-C)*P/S+O)),v)}var H=c[s],K=h,re=m;for(Mu(c,h,s),v(c[m],H)>0&&Mu(c,h,m);K<re;){for(Mu(c,K,re),K++,re--;v(c[K],H)<0;)K++;for(;v(c[re],H)>0;)re--}v(c[h],H)===0?Mu(c,h,re):Mu(c,++re,m),re<=s&&(h=re+1),s<=re&&(m=re-1)}}function Mu(c,s,h){var m=c[s];c[s]=c[h],c[h]=m}function _w(c,s){return c<s?-1:c>s?1:0}function ip(c,s){const h=c.length;if(h<=1)return[c];const m=[];let v,S;for(let C=0;C<h;C++){const M=it(c[C]);M!==0&&(c[C].area=Math.abs(M),S===void 0&&(S=M<0),S===M<0?(v&&m.push(v),v=[c[C]]):v.push(c[C]))}if(v&&m.push(v),s>1)for(let C=0;C<m.length;C++)m[C].length<=s||(mw(m[C],s,1,m[C].length-1,gw),m[C]=m[C].slice(0,s));return m}function gw(c,s){return s.area-c.area}function op(c,s,h){const m=h.patternDependencies;let v=!1;for(const S of s){const C=S.paint.get(`${c}-pattern`);C.isConstant()||(v=!0);const M=C.constantOr(null);M&&(v=!0,m[M.to]=!0,m[M.from]=!0)}return v}function sp(c,s,h,m,v){const S=v.patternDependencies;for(const C of s){const M=C.paint.get(`${c}-pattern`).value;if(M.kind!=="constant"){let P=M.evaluate({zoom:m-1},h,{},v.availableImages),O=M.evaluate({zoom:m},h,{},v.availableImages),H=M.evaluate({zoom:m+1},h,{},v.availableImages);P=P&&P.name?P.name:P,O=O&&O.name?O.name:O,H=H&&H.name?H.name:H,S[P]=!0,S[O]=!0,S[H]=!0,h.patterns[C.id]={min:P,mid:O,max:H}}}return h}class ap{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(h=>h.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Se,this.indexArray=new ot,this.indexArray2=new _t,this.programConfigurations=new Mr(s.layers,s.zoom),this.segments=new Rt,this.segments2=new Rt,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(s,h,m){this.hasPattern=op("fill",this.layers,h);const v=this.layers[0].layout.get("fill-sort-key"),S=!v.isConstant(),C=[];for(const{feature:M,id:P,index:O,sourceLayerIndex:H}of s){const K=this.layers[0]._featureFilter.needGeometry,re=$s(M,K);if(!this.layers[0]._featureFilter.filter(new wr(this.zoom),re,m))continue;const ce=S?v.evaluate(re,{},m,h.availableImages):void 0,me={id:P,properties:M.properties,type:M.type,sourceLayerIndex:H,index:O,geometry:K?re.geometry:Rs(M),patterns:{},sortKey:ce};C.push(me)}S&&C.sort((M,P)=>M.sortKey-P.sortKey);for(const M of C){const{geometry:P,index:O,sourceLayerIndex:H}=M;if(this.hasPattern){const K=sp("fill",this.layers,M,this.zoom,h);this.patternFeatures.push(K)}else this.addFeature(M,P,O,m,{});h.featureIndex.insert(s[O].feature,P,O,H,this.index)}}update(s,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,m)}addFeatures(s,h,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,ow),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(s,h,m,v,S){for(const C of ip(h,500)){let M=0;for(const ce of C)M+=ce.length;const P=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray),O=P.vertexLength,H=[],K=[];for(const ce of C){if(ce.length===0)continue;ce!==C[0]&&K.push(H.length/2);const me=this.segments2.prepareSegment(ce.length,this.layoutVertexArray,this.indexArray2),ve=me.vertexLength;this.layoutVertexArray.emplaceBack(ce[0].x,ce[0].y),this.indexArray2.emplaceBack(ve+ce.length-1,ve),H.push(ce[0].x),H.push(ce[0].y);for(let Te=1;Te<ce.length;Te++)this.layoutVertexArray.emplaceBack(ce[Te].x,ce[Te].y),this.indexArray2.emplaceBack(ve+Te-1,ve+Te),H.push(ce[Te].x),H.push(ce[Te].y);me.vertexLength+=ce.length,me.primitiveLength+=ce.length}const re=g_(H,K);for(let ce=0;ce<re.length;ce+=3)this.indexArray.emplaceBack(O+re[ce],O+re[ce+1],O+re[ce+2]);P.vertexLength+=M,P.primitiveLength+=re.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,m,S,v)}}let b_,v_;Ht("FillBucket",ap,{omit:["layers","patternFeatures"]});var yw={get paint(){return v_=v_||new $i({"fill-antialias":new rn(ye.paint_fill["fill-antialias"]),"fill-opacity":new cn(ye.paint_fill["fill-opacity"]),"fill-color":new cn(ye.paint_fill["fill-color"]),"fill-outline-color":new cn(ye.paint_fill["fill-outline-color"]),"fill-translate":new rn(ye.paint_fill["fill-translate"]),"fill-translate-anchor":new rn(ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new Kl(ye.paint_fill["fill-pattern"])})},get layout(){return b_=b_||new $i({"fill-sort-key":new cn(ye.layout_fill["fill-sort-key"])})}};class bw extends wo{constructor(s){super(s,yw)}recalculate(s,h){super.recalculate(s,h);const m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new ap(s)}queryRadius(){return yf(this.paint.get("fill-translate"))}queryIntersectsFeature(s,h,m,v,S,C,M){return yu(bf(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),C.angle,M),v)}isTileClipped(){return!0}}const vw=Zr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),ww=Zr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:xw}=vw;var fa={},kw=p,w_=lc;function lc(c,s,h,m,v){this.properties={},this.extent=h,this.type=0,this._pbf=c,this._geometry=-1,this._keys=m,this._values=v,c.readFields(Sw,this,s)}function Sw(c,s,h){c==1?s.id=h.readVarint():c==2?function(m,v){for(var S=m.readVarint()+m.pos;m.pos<S;){var C=v._keys[m.readVarint()],M=v._values[m.readVarint()];v.properties[C]=M}}(h,s):c==3?s.type=h.readVarint():c==4&&(s._geometry=h.pos)}function Cw(c){for(var s,h,m=0,v=0,S=c.length,C=S-1;v<S;C=v++)m+=((h=c[C]).x-(s=c[v]).x)*(s.y+h.y);return m}lc.types=["Unknown","Point","LineString","Polygon"],lc.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var s,h=c.readVarint()+c.pos,m=1,v=0,S=0,C=0,M=[];c.pos<h;){if(v<=0){var P=c.readVarint();m=7&P,v=P>>3}if(v--,m===1||m===2)S+=c.readSVarint(),C+=c.readSVarint(),m===1&&(s&&M.push(s),s=[]),s.push(new kw(S,C));else{if(m!==7)throw new Error("unknown command "+m);s&&s.push(s[0].clone())}}return s&&M.push(s),M},lc.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var s=c.readVarint()+c.pos,h=1,m=0,v=0,S=0,C=1/0,M=-1/0,P=1/0,O=-1/0;c.pos<s;){if(m<=0){var H=c.readVarint();h=7&H,m=H>>3}if(m--,h===1||h===2)(v+=c.readSVarint())<C&&(C=v),v>M&&(M=v),(S+=c.readSVarint())<P&&(P=S),S>O&&(O=S);else if(h!==7)throw new Error("unknown command "+h)}return[C,P,M,O]},lc.prototype.toGeoJSON=function(c,s,h){var m,v,S=this.extent*Math.pow(2,h),C=this.extent*c,M=this.extent*s,P=this.loadGeometry(),O=lc.types[this.type];function H(ce){for(var me=0;me<ce.length;me++){var ve=ce[me];ce[me]=[360*(ve.x+C)/S-180,360/Math.PI*Math.atan(Math.exp((180-360*(ve.y+M)/S)*Math.PI/180))-90]}}switch(this.type){case 1:var K=[];for(m=0;m<P.length;m++)K[m]=P[m][0];H(P=K);break;case 2:for(m=0;m<P.length;m++)H(P[m]);break;case 3:for(P=function(ce){var me=ce.length;if(me<=1)return[ce];for(var ve,Te,Pe=[],Ze=0;Ze<me;Ze++){var $e=Cw(ce[Ze]);$e!==0&&(Te===void 0&&(Te=$e<0),Te===$e<0?(ve&&Pe.push(ve),ve=[ce[Ze]]):ve.push(ce[Ze]))}return ve&&Pe.push(ve),Pe}(P),m=0;m<P.length;m++)for(v=0;v<P[m].length;v++)H(P[m][v])}P.length===1?P=P[0]:O="Multi"+O;var re={type:"Feature",geometry:{type:O,coordinates:P},properties:this.properties};return"id"in this&&(re.id=this.id),re};var Tw=w_,x_=k_;function k_(c,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(Mw,this,s),this.length=this._features.length}function Mw(c,s,h){c===15?s.version=h.readVarint():c===1?s.name=h.readString():c===5?s.extent=h.readVarint():c===2?s._features.push(h.pos):c===3?s._keys.push(h.readString()):c===4&&s._values.push(function(m){for(var v=null,S=m.readVarint()+m.pos;m.pos<S;){var C=m.readVarint()>>3;v=C===1?m.readString():C===2?m.readFloat():C===3?m.readDouble():C===4?m.readVarint64():C===5?m.readVarint():C===6?m.readSVarint():C===7?m.readBoolean():null}return v}(h))}k_.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var s=this._pbf.readVarint()+this._pbf.pos;return new Tw(this._pbf,s,this.extent,this._keys,this._values)};var Lw=x_;function Ew(c,s,h){if(c===3){var m=new Lw(h,h.readVarint()+h.pos);m.length&&(s[m.name]=m)}}fa.VectorTile=function(c,s){this.layers=c.readFields(Ew,{},s)},fa.VectorTileFeature=w_,fa.VectorTileLayer=x_;const Iw=fa.VectorTileFeature.types,lp=Math.pow(2,13);function Lu(c,s,h,m,v,S,C,M){c.emplaceBack(s,h,2*Math.floor(m*lp)+C,v*lp*2,S*lp*2,Math.round(M))}class cp{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(h=>h.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new ke,this.centroidVertexArray=new Q,this.indexArray=new ot,this.programConfigurations=new Mr(s.layers,s.zoom),this.segments=new Rt,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(s,h,m){this.features=[],this.hasPattern=op("fill-extrusion",this.layers,h);for(const{feature:v,id:S,index:C,sourceLayerIndex:M}of s){const P=this.layers[0]._featureFilter.needGeometry,O=$s(v,P);if(!this.layers[0]._featureFilter.filter(new wr(this.zoom),O,m))continue;const H={id:S,sourceLayerIndex:M,index:C,geometry:P?O.geometry:Rs(v),properties:v.properties,type:v.type,patterns:{}};this.hasPattern?this.features.push(sp("fill-extrusion",this.layers,H,this.zoom,h)):this.addFeature(H,H.geometry,C,m,{}),h.featureIndex.insert(v,H.geometry,C,M,this.index,!0)}}addFeatures(s,h,m){for(const v of this.features){const{geometry:S}=v;this.addFeature(v,S,v.index,h,m)}}update(s,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,xw),this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,ww.members,!0),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(s,h,m,v,S){const C={x:0,y:0,vertexCount:0};for(const M of ip(h,500)){let P=0;for(const me of M)P+=me.length;let O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const me of M){if(me.length===0||Pw(me))continue;let ve=0;for(let Te=0;Te<me.length;Te++){const Pe=me[Te];if(Te>=1){const Ze=me[Te-1];if(!Aw(Pe,Ze)){O.vertexLength+4>Rt.MAX_VERTEX_ARRAY_LENGTH&&(O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const $e=Pe.sub(Ze)._perp()._unit(),Ne=Ze.dist(Pe);ve+Ne>32768&&(ve=0),Lu(this.layoutVertexArray,Pe.x,Pe.y,$e.x,$e.y,0,0,ve),Lu(this.layoutVertexArray,Pe.x,Pe.y,$e.x,$e.y,0,1,ve),C.x+=2*Pe.x,C.y+=2*Pe.y,C.vertexCount+=2,ve+=Ne,Lu(this.layoutVertexArray,Ze.x,Ze.y,$e.x,$e.y,0,0,ve),Lu(this.layoutVertexArray,Ze.x,Ze.y,$e.x,$e.y,0,1,ve),C.x+=2*Ze.x,C.y+=2*Ze.y,C.vertexCount+=2;const ct=O.vertexLength;this.indexArray.emplaceBack(ct,ct+2,ct+1),this.indexArray.emplaceBack(ct+1,ct+2,ct+3),O.vertexLength+=4,O.primitiveLength+=2}}}}if(O.vertexLength+P>Rt.MAX_VERTEX_ARRAY_LENGTH&&(O=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray)),Iw[s.type]!=="Polygon")continue;const H=[],K=[],re=O.vertexLength;for(const me of M)if(me.length!==0){me!==M[0]&&K.push(H.length/2);for(let ve=0;ve<me.length;ve++){const Te=me[ve];Lu(this.layoutVertexArray,Te.x,Te.y,0,0,1,1,0),C.x+=Te.x,C.y+=Te.y,C.vertexCount+=1,H.push(Te.x),H.push(Te.y)}}const ce=g_(H,K);for(let me=0;me<ce.length;me+=3)this.indexArray.emplaceBack(re+ce[me],re+ce[me+2],re+ce[me+1]);O.primitiveLength+=ce.length/3,O.vertexLength+=P}for(let M=0;M<C.vertexCount;M++)this.centroidVertexArray.emplaceBack(Math.floor(C.x/C.vertexCount),Math.floor(C.y/C.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,m,S,v)}}function Aw(c,s){return c.x===s.x&&(c.x<0||c.x>jr)||c.y===s.y&&(c.y<0||c.y>jr)}function Pw(c){return c.every(s=>s.x<0)||c.every(s=>s.x>jr)||c.every(s=>s.y<0)||c.every(s=>s.y>jr)}let S_;Ht("FillExtrusionBucket",cp,{omit:["layers","features"]});var zw={get paint(){return S_=S_||new $i({"fill-extrusion-opacity":new rn(ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new cn(ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new rn(ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new rn(ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Kl(ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new cn(ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new cn(ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new rn(ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Dw extends wo{constructor(s){super(s,zw)}createBucket(s){return new cp(s)}queryRadius(){return yf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(s,h,m,v,S,C,M,P){const O=bf(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),C.angle,M),H=this.paint.get("fill-extrusion-height").evaluate(h,m),K=this.paint.get("fill-extrusion-base").evaluate(h,m),re=function(me,ve,Te,Pe){const Ze=[];for(const $e of me){const Ne=[$e.x,$e.y,0,1];vf(Ne,Ne,ve),Ze.push(new y(Ne[0]/Ne[3],Ne[1]/Ne[3]))}return Ze}(O,P),ce=function(me,ve,Te,Pe){const Ze=[],$e=[],Ne=Pe[8]*ve,ct=Pe[9]*ve,ft=Pe[10]*ve,Zt=Pe[11]*ve,Jt=Pe[8]*Te,qt=Pe[9]*Te,jt=Pe[10]*Te,zt=Pe[11]*Te;for(const Wt of me){const Ft=[],wt=[];for(const ln of Wt){const en=ln.x,Dn=ln.y,yr=Pe[0]*en+Pe[4]*Dn+Pe[12],kr=Pe[1]*en+Pe[5]*Dn+Pe[13],si=Pe[2]*en+Pe[6]*Dn+Pe[14],ho=Pe[3]*en+Pe[7]*Dn+Pe[15],Bi=si+ft,Yr=ho+Zt,gi=yr+Jt,xi=kr+qt,Oi=si+jt,Ni=ho+zt,ai=new y((yr+Ne)/Yr,(kr+ct)/Yr);ai.z=Bi/Yr,Ft.push(ai);const li=new y(gi/Ni,xi/Ni);li.z=Oi/Ni,wt.push(li)}Ze.push(Ft),$e.push(wt)}return[Ze,$e]}(v,K,H,P);return function(me,ve,Te){let Pe=1/0;yu(Te,ve)&&(Pe=C_(Te,ve[0]));for(let Ze=0;Ze<ve.length;Ze++){const $e=ve[Ze],Ne=me[Ze];for(let ct=0;ct<$e.length-1;ct++){const ft=$e[ct],Zt=[ft,$e[ct+1],Ne[ct+1],Ne[ct],ft];gu(Te,Zt)&&(Pe=Math.min(Pe,C_(Te,Zt)))}}return Pe!==1/0&&Pe}(ce[0],ce[1],re)}}function Eu(c,s){return c.x*s.x+c.y*s.y}function C_(c,s){if(c.length===1){let h=0;const m=s[h++];let v;for(;!v||m.equals(v);)if(v=s[h++],!v)return 1/0;for(;h<s.length;h++){const S=s[h],C=c[0],M=v.sub(m),P=S.sub(m),O=C.sub(m),H=Eu(M,M),K=Eu(M,P),re=Eu(P,P),ce=Eu(O,M),me=Eu(O,P),ve=H*re-K*K,Te=(re*ce-K*me)/ve,Pe=(H*me-K*ce)/ve,Ze=m.z*(1-Te-Pe)+v.z*Te+S.z*Pe;if(isFinite(Ze))return Ze}return 1/0}{let h=1/0;for(const m of s)h=Math.min(h,m.z);return h}}const Rw=Zr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:$w}=Rw,Fw=Zr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Bw}=Fw,Ow=fa.VectorTileFeature.types,Nw=Math.cos(Math.PI/180*37.5),T_=Math.pow(2,14)/.5;class up{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(h=>h.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new Me,this.layoutVertexArray2=new be,this.indexArray=new ot,this.programConfigurations=new Mr(s.layers,s.zoom),this.segments=new Rt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(s,h,m){this.hasPattern=op("line",this.layers,h);const v=this.layers[0].layout.get("line-sort-key"),S=!v.isConstant(),C=[];for(const{feature:M,id:P,index:O,sourceLayerIndex:H}of s){const K=this.layers[0]._featureFilter.needGeometry,re=$s(M,K);if(!this.layers[0]._featureFilter.filter(new wr(this.zoom),re,m))continue;const ce=S?v.evaluate(re,{},m):void 0,me={id:P,properties:M.properties,type:M.type,sourceLayerIndex:H,index:O,geometry:K?re.geometry:Rs(M),patterns:{},sortKey:ce};C.push(me)}S&&C.sort((M,P)=>M.sortKey-P.sortKey);for(const M of C){const{geometry:P,index:O,sourceLayerIndex:H}=M;if(this.hasPattern){const K=sp("line",this.layers,M,this.zoom,h);this.patternFeatures.push(K)}else this.addFeature(M,P,O,m,{});h.featureIndex.insert(s[O].feature,P,O,H,this.index)}}update(s,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,m)}addFeatures(s,h,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,Bw)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,$w),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,h,m,v,S){const C=this.layers[0].layout,M=C.get("line-join").evaluate(s,{}),P=C.get("line-cap"),O=C.get("line-miter-limit"),H=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(const K of h)this.addLine(K,s,M,P,O,H);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,m,S,v)}addLine(s,h,m,v,S,C){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Pe=0;Pe<s.length-1;Pe++)this.totalDistance+=s[Pe].dist(s[Pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=Ow[h.type]==="Polygon";let P=s.length;for(;P>=2&&s[P-1].equals(s[P-2]);)P--;let O=0;for(;O<P-1&&s[O].equals(s[O+1]);)O++;if(P<(M?3:2))return;m==="bevel"&&(S=1.05);const H=this.overscaling<=16?15*jr/(512*this.overscaling):0,K=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let re,ce,me,ve,Te;this.e1=this.e2=-1,M&&(re=s[P-2],Te=s[O].sub(re)._unit()._perp());for(let Pe=O;Pe<P;Pe++){if(me=Pe===P-1?M?s[O+1]:void 0:s[Pe+1],me&&s[Pe].equals(me))continue;Te&&(ve=Te),re&&(ce=re),re=s[Pe],Te=me?me.sub(re)._unit()._perp():ve,ve=ve||Te;let Ze=ve.add(Te);Ze.x===0&&Ze.y===0||Ze._unit();const $e=ve.x*Te.x+ve.y*Te.y,Ne=Ze.x*Te.x+Ze.y*Te.y,ct=Ne!==0?1/Ne:1/0,ft=2*Math.sqrt(2-2*Ne),Zt=Ne<Nw&&ce&&me,Jt=ve.x*Te.y-ve.y*Te.x>0;if(Zt&&Pe>O){const zt=re.dist(ce);if(zt>2*H){const Wt=re.sub(re.sub(ce)._mult(H/zt)._round());this.updateDistance(ce,Wt),this.addCurrentVertex(Wt,ve,0,0,K),ce=Wt}}const qt=ce&&me;let jt=qt?m:M?"butt":v;if(qt&&jt==="round"&&(ct<C?jt="miter":ct<=2&&(jt="fakeround")),jt==="miter"&&ct>S&&(jt="bevel"),jt==="bevel"&&(ct>2&&(jt="flipbevel"),ct<S&&(jt="miter")),ce&&this.updateDistance(ce,re),jt==="miter")Ze._mult(ct),this.addCurrentVertex(re,Ze,0,0,K);else if(jt==="flipbevel"){if(ct>100)Ze=Te.mult(-1);else{const zt=ct*ve.add(Te).mag()/ve.sub(Te).mag();Ze._perp()._mult(zt*(Jt?-1:1))}this.addCurrentVertex(re,Ze,0,0,K),this.addCurrentVertex(re,Ze.mult(-1),0,0,K)}else if(jt==="bevel"||jt==="fakeround"){const zt=-Math.sqrt(ct*ct-1),Wt=Jt?zt:0,Ft=Jt?0:zt;if(ce&&this.addCurrentVertex(re,ve,Wt,Ft,K),jt==="fakeround"){const wt=Math.round(180*ft/Math.PI/20);for(let ln=1;ln<wt;ln++){let en=ln/wt;if(en!==.5){const yr=en-.5;en+=en*yr*(en-1)*((1.0904+$e*($e*(3.55645-1.43519*$e)-3.2452))*yr*yr+(.848013+$e*(.215638*$e-1.06021)))}const Dn=Te.sub(ve)._mult(en)._add(ve)._unit()._mult(Jt?-1:1);this.addHalfVertex(re,Dn.x,Dn.y,!1,Jt,0,K)}}me&&this.addCurrentVertex(re,Te,-Wt,-Ft,K)}else if(jt==="butt")this.addCurrentVertex(re,Ze,0,0,K);else if(jt==="square"){const zt=ce?1:-1;this.addCurrentVertex(re,Ze,zt,zt,K)}else jt==="round"&&(ce&&(this.addCurrentVertex(re,ve,0,0,K),this.addCurrentVertex(re,ve,1,1,K,!0)),me&&(this.addCurrentVertex(re,Te,-1,-1,K,!0),this.addCurrentVertex(re,Te,0,0,K)));if(Zt&&Pe<P-1){const zt=re.dist(me);if(zt>2*H){const Wt=re.add(me.sub(re)._mult(H/zt)._round());this.updateDistance(re,Wt),this.addCurrentVertex(Wt,Te,0,0,K),re=Wt}}}}addCurrentVertex(s,h,m,v,S,C=!1){const M=h.y*v-h.x,P=-h.y-h.x*v;this.addHalfVertex(s,h.x+h.y*m,h.y-h.x*m,C,!1,m,S),this.addHalfVertex(s,M,P,C,!0,-v,S),this.distance>T_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(s,h,m,v,S,C))}addHalfVertex({x:s,y:h},m,v,S,C,M,P){const O=.5*(this.lineClips?this.scaledDistance*(T_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s<<1)+(S?1:0),(h<<1)+(C?1:0),Math.round(63*m)+128,Math.round(63*v)+128,1+(M===0?0:M<0?-1:1)|(63&O)<<2,O>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const H=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,H),P.primitiveLength++),C?this.e2=H:this.e1=H}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(s,h){this.distance+=s.dist(h),this.updateScaledDistance()}}let M_,L_;Ht("LineBucket",up,{omit:["layers","patternFeatures"]});var E_={get paint(){return L_=L_||new $i({"line-opacity":new cn(ye.paint_line["line-opacity"]),"line-color":new cn(ye.paint_line["line-color"]),"line-translate":new rn(ye.paint_line["line-translate"]),"line-translate-anchor":new rn(ye.paint_line["line-translate-anchor"]),"line-width":new cn(ye.paint_line["line-width"]),"line-gap-width":new cn(ye.paint_line["line-gap-width"]),"line-offset":new cn(ye.paint_line["line-offset"]),"line-blur":new cn(ye.paint_line["line-blur"]),"line-dasharray":new Ya(ye.paint_line["line-dasharray"]),"line-pattern":new Kl(ye.paint_line["line-pattern"]),"line-gradient":new au(ye.paint_line["line-gradient"])})},get layout(){return M_=M_||new $i({"line-cap":new rn(ye.layout_line["line-cap"]),"line-join":new cn(ye.layout_line["line-join"]),"line-miter-limit":new rn(ye.layout_line["line-miter-limit"]),"line-round-limit":new rn(ye.layout_line["line-round-limit"]),"line-sort-key":new cn(ye.layout_line["line-sort-key"])})}};class jw extends cn{possiblyEvaluate(s,h){return h=new wr(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),super.possiblyEvaluate(s,h)}evaluate(s,h,m,v){return h=J({},h,{zoom:Math.floor(h.zoom)}),super.evaluate(s,h,m,v)}}let Cf;class Uw extends wo{constructor(s){super(s,E_),this.gradientVersion=0,Cf||(Cf=new jw(E_.paint.properties["line-width"].specification),Cf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const h=this.gradientExpression();this.stepInterpolant=!!function(m){return m._styleExpression!==void 0}(h)&&h._styleExpression.expression instanceof qa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,h){super.recalculate(s,h),this.paint._values["line-floorwidth"]=Cf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new up(s)}queryRadius(s){const h=s,m=I_(wu("line-width",this,h),wu("line-gap-width",this,h)),v=wu("line-offset",this,h);return m/2+Math.abs(v)+yf(this.paint.get("line-translate"))}queryIntersectsFeature(s,h,m,v,S,C,M){const P=bf(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),C.angle,M),O=M/2*I_(this.paint.get("line-width").evaluate(h,m),this.paint.get("line-gap-width").evaluate(h,m)),H=this.paint.get("line-offset").evaluate(h,m);return H&&(v=function(K,re){const ce=[];for(let me=0;me<K.length;me++){const ve=K[me],Te=[];for(let Pe=0;Pe<ve.length;Pe++){const Ze=ve[Pe-1],$e=ve[Pe],Ne=ve[Pe+1],ct=Pe===0?new y(0,0):$e.sub(Ze)._unit()._perp(),ft=Pe===ve.length-1?new y(0,0):Ne.sub($e)._unit()._perp(),Zt=ct._add(ft)._unit(),Jt=Zt.x*ft.x+Zt.y*ft.y;Jt!==0&&Zt._mult(1/Jt),Te.push(Zt._mult(re)._add($e))}ce.push(Te)}return ce}(v,H*M)),function(K,re,ce){for(let me=0;me<re.length;me++){const ve=re[me];if(K.length>=3){for(let Te=0;Te<ve.length;Te++)if(oc(K,ve[Te]))return!0}if(bu(K,ve,ce))return!0}return!1}(P,v,O)}isTileClipped(){return!0}}function I_(c,s){return s>0?s+2*c:c}const Vw=Zr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),qw=Zr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Zr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Zw=Zr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Zr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const A_=Zr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Gw=Zr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Hw(c,s,h){return c.sections.forEach(m=>{m.text=function(v,S,C){const M=S.layout.get("text-transform").evaluate(C,{});return M==="uppercase"?v=v.toLocaleUpperCase():M==="lowercase"&&(v=v.toLocaleLowerCase()),bs.applyArabicShaping&&(v=bs.applyArabicShaping(v)),v}(m.text,s,h)}),c}Zr([{name:"triangle",components:3,type:"Uint16"}]),Zr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Zr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Zr([{type:"Float32",name:"offsetX"}]),Zr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Zr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Iu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var oi=24,P_=sr,z_=function(c,s,h,m,v){var S,C,M=8*v-m-1,P=(1<<M)-1,O=P>>1,H=-7,K=h?v-1:0,re=h?-1:1,ce=c[s+K];for(K+=re,S=ce&(1<<-H)-1,ce>>=-H,H+=M;H>0;S=256*S+c[s+K],K+=re,H-=8);for(C=S&(1<<-H)-1,S>>=-H,H+=m;H>0;C=256*C+c[s+K],K+=re,H-=8);if(S===0)S=1-O;else{if(S===P)return C?NaN:1/0*(ce?-1:1);C+=Math.pow(2,m),S-=O}return(ce?-1:1)*C*Math.pow(2,S-m)},D_=function(c,s,h,m,v,S){var C,M,P,O=8*S-v-1,H=(1<<O)-1,K=H>>1,re=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,ce=m?0:S-1,me=m?1:-1,ve=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(M=isNaN(s)?1:0,C=H):(C=Math.floor(Math.log(s)/Math.LN2),s*(P=Math.pow(2,-C))<1&&(C--,P*=2),(s+=C+K>=1?re/P:re*Math.pow(2,1-K))*P>=2&&(C++,P/=2),C+K>=H?(M=0,C=H):C+K>=1?(M=(s*P-1)*Math.pow(2,v),C+=K):(M=s*Math.pow(2,K-1)*Math.pow(2,v),C=0));v>=8;c[h+ce]=255&M,ce+=me,M/=256,v-=8);for(C=C<<v|M,O+=v;O>0;c[h+ce]=255&C,ce+=me,C/=256,O-=8);c[h+ce-me]|=128*ve};function sr(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}sr.Varint=0,sr.Fixed64=1,sr.Bytes=2,sr.Fixed32=5;var hp=4294967296,R_=1/hp,$_=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Fs(c){return c.type===sr.Bytes?c.readVarint()+c.pos:c.pos+1}function cc(c,s,h){return h?4294967296*s+(c>>>0):4294967296*(s>>>0)+(c>>>0)}function F_(c,s,h){var m=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));h.realloc(m);for(var v=h.pos-1;v>=c;v--)h.buf[v+m]=h.buf[v]}function Ww(c,s){for(var h=0;h<c.length;h++)s.writeVarint(c[h])}function Kw(c,s){for(var h=0;h<c.length;h++)s.writeSVarint(c[h])}function Xw(c,s){for(var h=0;h<c.length;h++)s.writeFloat(c[h])}function Jw(c,s){for(var h=0;h<c.length;h++)s.writeDouble(c[h])}function Yw(c,s){for(var h=0;h<c.length;h++)s.writeBoolean(c[h])}function Qw(c,s){for(var h=0;h<c.length;h++)s.writeFixed32(c[h])}function e2(c,s){for(var h=0;h<c.length;h++)s.writeSFixed32(c[h])}function t2(c,s){for(var h=0;h<c.length;h++)s.writeFixed64(c[h])}function n2(c,s){for(var h=0;h<c.length;h++)s.writeSFixed64(c[h])}function Tf(c,s){return(c[s]|c[s+1]<<8|c[s+2]<<16)+16777216*c[s+3]}function uc(c,s,h){c[h]=s,c[h+1]=s>>>8,c[h+2]=s>>>16,c[h+3]=s>>>24}function B_(c,s){return(c[s]|c[s+1]<<8|c[s+2]<<16)+(c[s+3]<<24)}sr.prototype={destroy:function(){this.buf=null},readFields:function(c,s,h){for(h=h||this.length;this.pos<h;){var m=this.readVarint(),v=m>>3,S=this.pos;this.type=7&m,c(v,s,this),this.pos===S&&this.skip(m)}return s},readMessage:function(c,s){return this.readFields(c,s,this.readVarint()+this.pos)},readFixed32:function(){var c=Tf(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=B_(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=Tf(this.buf,this.pos)+Tf(this.buf,this.pos+4)*hp;return this.pos+=8,c},readSFixed64:function(){var c=Tf(this.buf,this.pos)+B_(this.buf,this.pos+4)*hp;return this.pos+=8,c},readFloat:function(){var c=z_(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=z_(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var s,h,m=this.buf;return s=127&(h=m[this.pos++]),h<128?s:(s|=(127&(h=m[this.pos++]))<<7,h<128?s:(s|=(127&(h=m[this.pos++]))<<14,h<128?s:(s|=(127&(h=m[this.pos++]))<<21,h<128?s:function(v,S,C){var M,P,O=C.buf;if(M=(112&(P=O[C.pos++]))>>4,P<128||(M|=(127&(P=O[C.pos++]))<<3,P<128)||(M|=(127&(P=O[C.pos++]))<<10,P<128)||(M|=(127&(P=O[C.pos++]))<<17,P<128)||(M|=(127&(P=O[C.pos++]))<<24,P<128)||(M|=(1&(P=O[C.pos++]))<<31,P<128))return cc(v,M,S);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(h=m[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,s=this.pos;return this.pos=c,c-s>=12&&$_?function(h,m,v){return $_.decode(h.subarray(m,v))}(this.buf,s,c):function(h,m,v){for(var S="",C=m;C<v;){var M,P,O,H=h[C],K=null,re=H>239?4:H>223?3:H>191?2:1;if(C+re>v)break;re===1?H<128&&(K=H):re===2?(192&(M=h[C+1]))==128&&(K=(31&H)<<6|63&M)<=127&&(K=null):re===3?(P=h[C+2],(192&(M=h[C+1]))==128&&(192&P)==128&&((K=(15&H)<<12|(63&M)<<6|63&P)<=2047||K>=55296&&K<=57343)&&(K=null)):re===4&&(P=h[C+2],O=h[C+3],(192&(M=h[C+1]))==128&&(192&P)==128&&(192&O)==128&&((K=(15&H)<<18|(63&M)<<12|(63&P)<<6|63&O)<=65535||K>=1114112)&&(K=null)),K===null?(K=65533,re=1):K>65535&&(K-=65536,S+=String.fromCharCode(K>>>10&1023|55296),K=56320|1023&K),S+=String.fromCharCode(K),C+=re}return S}(this.buf,s,c)},readBytes:function(){var c=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,c);return this.pos=c,s},readPackedVarint:function(c,s){if(this.type!==sr.Bytes)return c.push(this.readVarint(s));var h=Fs(this);for(c=c||[];this.pos<h;)c.push(this.readVarint(s));return c},readPackedSVarint:function(c){if(this.type!==sr.Bytes)return c.push(this.readSVarint());var s=Fs(this);for(c=c||[];this.pos<s;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==sr.Bytes)return c.push(this.readBoolean());var s=Fs(this);for(c=c||[];this.pos<s;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==sr.Bytes)return c.push(this.readFloat());var s=Fs(this);for(c=c||[];this.pos<s;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==sr.Bytes)return c.push(this.readDouble());var s=Fs(this);for(c=c||[];this.pos<s;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==sr.Bytes)return c.push(this.readFixed32());var s=Fs(this);for(c=c||[];this.pos<s;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==sr.Bytes)return c.push(this.readSFixed32());var s=Fs(this);for(c=c||[];this.pos<s;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==sr.Bytes)return c.push(this.readFixed64());var s=Fs(this);for(c=c||[];this.pos<s;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==sr.Bytes)return c.push(this.readSFixed64());var s=Fs(this);for(c=c||[];this.pos<s;)c.push(this.readSFixed64());return c},skip:function(c){var s=7&c;if(s===sr.Varint)for(;this.buf[this.pos++]>127;);else if(s===sr.Bytes)this.pos=this.readVarint()+this.pos;else if(s===sr.Fixed32)this.pos+=4;else{if(s!==sr.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(c,s){this.writeVarint(c<<3|s)},realloc:function(c){for(var s=this.length||16;s<this.pos+c;)s*=2;if(s!==this.length){var h=new Uint8Array(s);h.set(this.buf),this.buf=h,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),uc(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),uc(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),uc(this.buf,-1&c,this.pos),uc(this.buf,Math.floor(c*R_),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),uc(this.buf,-1&c,this.pos),uc(this.buf,Math.floor(c*R_),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(s,h){var m,v;if(s>=0?(m=s%4294967296|0,v=s/4294967296|0):(v=~(-s/4294967296),4294967295^(m=~(-s%4294967296))?m=m+1|0:(m=0,v=v+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),function(S,C,M){M.buf[M.pos++]=127&S|128,S>>>=7,M.buf[M.pos++]=127&S|128,S>>>=7,M.buf[M.pos++]=127&S|128,S>>>=7,M.buf[M.pos++]=127&S|128,M.buf[M.pos]=127&(S>>>=7)}(m,0,h),function(S,C){var M=(7&S)<<4;C.buf[C.pos++]|=M|((S>>>=3)?128:0),S&&(C.buf[C.pos++]=127&S|((S>>>=7)?128:0),S&&(C.buf[C.pos++]=127&S|((S>>>=7)?128:0),S&&(C.buf[C.pos++]=127&S|((S>>>=7)?128:0),S&&(C.buf[C.pos++]=127&S|((S>>>=7)?128:0),S&&(C.buf[C.pos++]=127&S)))))}(v,h)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var s=this.pos;this.pos=function(m,v,S){for(var C,M,P=0;P<v.length;P++){if((C=v.charCodeAt(P))>55295&&C<57344){if(!M){C>56319||P+1===v.length?(m[S++]=239,m[S++]=191,m[S++]=189):M=C;continue}if(C<56320){m[S++]=239,m[S++]=191,m[S++]=189,M=C;continue}C=M-55296<<10|C-56320|65536,M=null}else M&&(m[S++]=239,m[S++]=191,m[S++]=189,M=null);C<128?m[S++]=C:(C<2048?m[S++]=C>>6|192:(C<65536?m[S++]=C>>12|224:(m[S++]=C>>18|240,m[S++]=C>>12&63|128),m[S++]=C>>6&63|128),m[S++]=63&C|128)}return S}(this.buf,c,this.pos);var h=this.pos-s;h>=128&&F_(s,h,this),this.pos=s-1,this.writeVarint(h),this.pos+=h},writeFloat:function(c){this.realloc(4),D_(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),D_(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var s=c.length;this.writeVarint(s),this.realloc(s);for(var h=0;h<s;h++)this.buf[this.pos++]=c[h]},writeRawMessage:function(c,s){this.pos++;var h=this.pos;c(s,this);var m=this.pos-h;m>=128&&F_(h,m,this),this.pos=h-1,this.writeVarint(m),this.pos+=m},writeMessage:function(c,s,h){this.writeTag(c,sr.Bytes),this.writeRawMessage(s,h)},writePackedVarint:function(c,s){s.length&&this.writeMessage(c,Ww,s)},writePackedSVarint:function(c,s){s.length&&this.writeMessage(c,Kw,s)},writePackedBoolean:function(c,s){s.length&&this.writeMessage(c,Yw,s)},writePackedFloat:function(c,s){s.length&&this.writeMessage(c,Xw,s)},writePackedDouble:function(c,s){s.length&&this.writeMessage(c,Jw,s)},writePackedFixed32:function(c,s){s.length&&this.writeMessage(c,Qw,s)},writePackedSFixed32:function(c,s){s.length&&this.writeMessage(c,e2,s)},writePackedFixed64:function(c,s){s.length&&this.writeMessage(c,t2,s)},writePackedSFixed64:function(c,s){s.length&&this.writeMessage(c,n2,s)},writeBytesField:function(c,s){this.writeTag(c,sr.Bytes),this.writeBytes(s)},writeFixed32Field:function(c,s){this.writeTag(c,sr.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(c,s){this.writeTag(c,sr.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(c,s){this.writeTag(c,sr.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(c,s){this.writeTag(c,sr.Fixed64),this.writeSFixed64(s)},writeVarintField:function(c,s){this.writeTag(c,sr.Varint),this.writeVarint(s)},writeSVarintField:function(c,s){this.writeTag(c,sr.Varint),this.writeSVarint(s)},writeStringField:function(c,s){this.writeTag(c,sr.Bytes),this.writeString(s)},writeFloatField:function(c,s){this.writeTag(c,sr.Fixed32),this.writeFloat(s)},writeDoubleField:function(c,s){this.writeTag(c,sr.Fixed64),this.writeDouble(s)},writeBooleanField:function(c,s){this.writeVarintField(c,!!s)}};var fp=d(P_);const dp=3;function r2(c,s,h){c===1&&h.readMessage(i2,s)}function i2(c,s,h){if(c===3){const{id:m,bitmap:v,width:S,height:C,left:M,top:P,advance:O}=h.readMessage(o2,{});s.push({id:m,bitmap:new ku({width:S+2*dp,height:C+2*dp},v),metrics:{width:S,height:C,left:M,top:P,advance:O}})}}function o2(c,s,h){c===1?s.id=h.readVarint():c===2?s.bitmap=h.readBytes():c===3?s.width=h.readVarint():c===4?s.height=h.readVarint():c===5?s.left=h.readSVarint():c===6?s.top=h.readSVarint():c===7&&(s.advance=h.readVarint())}const O_=dp;function N_(c){let s=0,h=0;for(const C of c)s+=C.w*C.h,h=Math.max(h,C.w);c.sort((C,M)=>M.h-C.h);const m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),h),h:1/0}];let v=0,S=0;for(const C of c)for(let M=m.length-1;M>=0;M--){const P=m[M];if(!(C.w>P.w||C.h>P.h)){if(C.x=P.x,C.y=P.y,S=Math.max(S,C.y+C.h),v=Math.max(v,C.x+C.w),C.w===P.w&&C.h===P.h){const O=m.pop();M<m.length&&(m[M]=O)}else C.h===P.h?(P.x+=C.w,P.w-=C.w):C.w===P.w?(P.y+=C.h,P.h-=C.h):(m.push({x:P.x+C.w,y:P.y,w:P.w-C.w,h:C.h}),P.y+=C.h,P.h-=C.h);break}}return{w:v,h:S,fill:s/(v*S)||0}}const Qi=1;class pp{constructor(s,{pixelRatio:h,version:m,stretchX:v,stretchY:S,content:C}){this.paddedRect=s,this.pixelRatio=h,this.stretchX=v,this.stretchY=S,this.content=C,this.version=m}get tl(){return[this.paddedRect.x+Qi,this.paddedRect.y+Qi]}get br(){return[this.paddedRect.x+this.paddedRect.w-Qi,this.paddedRect.y+this.paddedRect.h-Qi]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Qi)/this.pixelRatio,(this.paddedRect.h-2*Qi)/this.pixelRatio]}}class j_{constructor(s,h){const m={},v={};this.haveRenderCallbacks=[];const S=[];this.addImages(s,m,S),this.addImages(h,v,S);const{w:C,h:M}=N_(S),P=new xo({width:C||1,height:M||1});for(const O in s){const H=s[O],K=m[O].paddedRect;xo.copy(H.data,P,{x:0,y:0},{x:K.x+Qi,y:K.y+Qi},H.data)}for(const O in h){const H=h[O],K=v[O].paddedRect,re=K.x+Qi,ce=K.y+Qi,me=H.data.width,ve=H.data.height;xo.copy(H.data,P,{x:0,y:0},{x:re,y:ce},H.data),xo.copy(H.data,P,{x:0,y:ve-1},{x:re,y:ce-1},{width:me,height:1}),xo.copy(H.data,P,{x:0,y:0},{x:re,y:ce+ve},{width:me,height:1}),xo.copy(H.data,P,{x:me-1,y:0},{x:re-1,y:ce},{width:1,height:ve}),xo.copy(H.data,P,{x:0,y:0},{x:re+me,y:ce},{width:1,height:ve})}this.image=P,this.iconPositions=m,this.patternPositions=v}addImages(s,h,m){for(const v in s){const S=s[v],C={x:0,y:0,w:S.data.width+2*Qi,h:S.data.height+2*Qi};m.push(C),h[v]=new pp(C,S),S.hasRenderCallback&&this.haveRenderCallbacks.push(v)}}patchUpdatedImages(s,h){s.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const m in s.updatedImages)this.patchUpdatedImage(this.iconPositions[m],s.getImage(m),h),this.patchUpdatedImage(this.patternPositions[m],s.getImage(m),h)}patchUpdatedImage(s,h,m){if(!s||!h||s.version===h.version)return;s.version=h.version;const[v,S]=s.tl;m.update(h.data,void 0,{x:v,y:S})}}var da;Ht("ImagePosition",pp),Ht("ImageAtlas",j_),u.ah=void 0,(da=u.ah||(u.ah={}))[da.none=0]="none",da[da.horizontal=1]="horizontal",da[da.vertical=2]="vertical",da[da.horizontalOnly=3]="horizontalOnly";const Au=-17;class Pu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(s,h){const m=new Pu;return m.scale=s||1,m.fontStack=h,m}static forImage(s){const h=new Pu;return h.imageName=s,h}}class hc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,h){const m=new hc;for(let v=0;v<s.sections.length;v++){const S=s.sections[v];S.image?m.addImageSection(S):m.addTextSection(S,h)}return m}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSectionIndex(s){return this.sectionIndex[s]}getCharCode(s){return this.text.charCodeAt(s)}verticalizePunctuation(){this.text=function(s){let h="";for(let m=0;m<s.length;m++){const v=s.charCodeAt(m+1)||null,S=s.charCodeAt(m-1)||null;h+=v&&ou(v)&&!Iu[s[m+1]]||S&&ou(S)&&!Iu[s[m-1]]||!Iu[s[m]]?s[m]:Iu[s[m]]}return h}(this.text)}trim(){let s=0;for(let m=0;m<this.text.length&&Lf[this.text.charCodeAt(m)];m++)s++;let h=this.text.length;for(let m=this.text.length-1;m>=0&&m>=s&&Lf[this.text.charCodeAt(m)];m--)h--;this.text=this.text.substring(s,h),this.sectionIndex=this.sectionIndex.slice(s,h)}substring(s,h){const m=new hc;return m.text=this.text.substring(s,h),m.sectionIndex=this.sectionIndex.slice(s,h),m.sections=this.sections,m}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,h)=>Math.max(s,this.sections[h].scale),0)}addTextSection(s,h){this.text+=s.text,this.sections.push(Pu.forText(s.scale,s.fontStack||h));const m=this.sections.length-1;for(let v=0;v<s.text.length;++v)this.sectionIndex.push(m)}addImageSection(s){const h=s.image?s.image.name:"";if(h.length===0)return void Ee("Can't add FormattedSection with an empty image.");const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCharCode(m),this.sections.push(Pu.forImage(h)),this.sectionIndex.push(this.sections.length-1)):Ee("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Mf(c,s,h,m,v,S,C,M,P,O,H,K,re,ce,me,ve){const Te=hc.fromFeature(c,v);let Pe;K===u.ah.vertical&&Te.verticalizePunctuation();const{processBidirectionalText:Ze,processStyledBidirectionalText:$e}=bs;if(Ze&&Te.sections.length===1){Pe=[];const ft=Ze(Te.toString(),mp(Te,O,S,s,m,ce,me));for(const Zt of ft){const Jt=new hc;Jt.text=Zt,Jt.sections=Te.sections;for(let qt=0;qt<Zt.length;qt++)Jt.sectionIndex.push(0);Pe.push(Jt)}}else if($e){Pe=[];const ft=$e(Te.text,Te.sectionIndex,mp(Te,O,S,s,m,ce,me));for(const Zt of ft){const Jt=new hc;Jt.text=Zt[0],Jt.sectionIndex=Zt[1],Jt.sections=Te.sections,Pe.push(Jt)}}else Pe=function(ft,Zt){const Jt=[],qt=ft.text;let jt=0;for(const zt of Zt)Jt.push(ft.substring(jt,zt)),jt=zt;return jt<qt.length&&Jt.push(ft.substring(jt,qt.length)),Jt}(Te,mp(Te,O,S,s,m,ce,me));const Ne=[],ct={positionedLines:Ne,text:Te.toString(),top:H[1],bottom:H[1],left:H[0],right:H[0],writingMode:K,iconsInText:!1,verticalizable:!1};return function(ft,Zt,Jt,qt,jt,zt,Wt,Ft,wt,ln,en,Dn){let yr=0,kr=Au,si=0,ho=0;const Bi=Ft==="right"?1:Ft==="left"?0:.5;let Yr=0;for(const ai of jt){ai.trim();const li=ai.getMaxScale(),Li=(li-1)*oi,ji={positionedGlyphs:[],lineOffset:0};ft.positionedLines[Yr]=ji;const Ei=ji.positionedGlyphs;let eo=0;if(!ai.length()){kr+=zt,++Yr;continue}for(let ci=0;ci<ai.length();ci++){const Bn=ai.getSection(ci),Ii=ai.getSectionIndex(ci),ki=ai.getCharCode(ci);let ui=0,Zo=null,ns=null,rs=null,Bs=oi;const Go=!(wt===u.ah.horizontal||!en&&!Gl(ki)||en&&(Lf[ki]||(gi=ki,Vt.Arabic(gi)||Vt["Arabic Supplement"](gi)||Vt["Arabic Extended-A"](gi)||Vt["Arabic Presentation Forms-A"](gi)||Vt["Arabic Presentation Forms-B"](gi))));if(Bn.imageName){const So=qt[Bn.imageName];if(!So)continue;rs=Bn.imageName,ft.iconsInText=ft.iconsInText||!0,ns=So.paddedRect;const no=So.displaySize;Bn.scale=Bn.scale*oi/Dn,Zo={width:no[0],height:no[1],left:Qi,top:-O_,advance:Go?no[1]:no[0]},ui=Li+(oi-no[1]*Bn.scale),Bs=Zo.advance;const Os=Go?no[0]*Bn.scale-oi*li:no[1]*Bn.scale-oi*li;Os>0&&Os>eo&&(eo=Os)}else{const So=Jt[Bn.fontStack],no=So&&So[ki];if(no&&no.rect)ns=no.rect,Zo=no.metrics;else{const Os=Zt[Bn.fontStack],Fu=Os&&Os[ki];if(!Fu)continue;Zo=Fu.metrics}ui=(li-Bn.scale)*oi}Go?(ft.verticalizable=!0,Ei.push({glyph:ki,imageName:rs,x:yr,y:kr+ui,vertical:Go,scale:Bn.scale,fontStack:Bn.fontStack,sectionIndex:Ii,metrics:Zo,rect:ns}),yr+=Bs*Bn.scale+ln):(Ei.push({glyph:ki,imageName:rs,x:yr,y:kr+ui,vertical:Go,scale:Bn.scale,fontStack:Bn.fontStack,sectionIndex:Ii,metrics:Zo,rect:ns}),yr+=Zo.advance*Bn.scale+ln)}Ei.length!==0&&(si=Math.max(yr-ln,si),l2(Ei,0,Ei.length-1,Bi,eo)),yr=0;const to=zt*li+eo;ji.lineOffset=Math.max(eo,Li),kr+=to,ho=Math.max(to,ho),++Yr}var gi;const xi=kr-Au,{horizontalAlign:Oi,verticalAlign:Ni}=_p(Wt);(function(ai,li,Li,ji,Ei,eo,to,ci,Bn){const Ii=(li-Li)*Ei;let ki=0;ki=eo!==to?-ci*ji-Au:(-ji*Bn+.5)*to;for(const ui of ai)for(const Zo of ui.positionedGlyphs)Zo.x+=Ii,Zo.y+=ki})(ft.positionedLines,Bi,Oi,Ni,si,ho,zt,xi,jt.length),ft.top+=-Ni*xi,ft.bottom=ft.top+xi,ft.left+=-Oi*si,ft.right=ft.left+si}(ct,s,h,m,Pe,C,M,P,K,O,re,ve),!function(ft){for(const Zt of ft)if(Zt.positionedGlyphs.length!==0)return!1;return!0}(Ne)&&ct}const Lf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},s2={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function U_(c,s,h,m,v,S){if(s.imageName){const C=m[s.imageName];return C?C.displaySize[0]*s.scale*oi/S+v:0}{const C=h[s.fontStack],M=C&&C[c];return M?M.metrics.advance*s.scale+v:0}}function V_(c,s,h,m){const v=Math.pow(c-s,2);return m?c<s?v/2:2*v:v+Math.abs(h)*h}function a2(c,s,h){let m=0;return c===10&&(m-=1e4),h&&(m+=150),c!==40&&c!==65288||(m+=50),s!==41&&s!==65289||(m+=50),m}function q_(c,s,h,m,v,S){let C=null,M=V_(s,h,v,S);for(const P of m){const O=V_(s-P.x,h,v,S)+P.badness;O<=M&&(C=P,M=O)}return{index:c,x:s,priorBreak:C,badness:M}}function Z_(c){return c?Z_(c.priorBreak).concat(c.index):[]}function mp(c,s,h,m,v,S,C){if(S!=="point")return[];if(!c)return[];const M=[],P=function(re,ce,me,ve,Te,Pe){let Ze=0;for(let $e=0;$e<re.length();$e++){const Ne=re.getSection($e);Ze+=U_(re.getCharCode($e),Ne,ve,Te,ce,Pe)}return Ze/Math.max(1,Math.ceil(Ze/me))}(c,s,h,m,v,C),O=c.text.indexOf("")>=0;let H=0;for(let re=0;re<c.length();re++){const ce=c.getSection(re),me=c.getCharCode(re);if(Lf[me]||(H+=U_(me,ce,m,v,s,C)),re<c.length()-1){const ve=!((K=me)<11904||!(Vt["Bopomofo Extended"](K)||Vt.Bopomofo(K)||Vt["CJK Compatibility Forms"](K)||Vt["CJK Compatibility Ideographs"](K)||Vt["CJK Compatibility"](K)||Vt["CJK Radicals Supplement"](K)||Vt["CJK Strokes"](K)||Vt["CJK Symbols and Punctuation"](K)||Vt["CJK Unified Ideographs Extension A"](K)||Vt["CJK Unified Ideographs"](K)||Vt["Enclosed CJK Letters and Months"](K)||Vt["Halfwidth and Fullwidth Forms"](K)||Vt.Hiragana(K)||Vt["Ideographic Description Characters"](K)||Vt["Kangxi Radicals"](K)||Vt["Katakana Phonetic Extensions"](K)||Vt.Katakana(K)||Vt["Vertical Forms"](K)||Vt["Yi Radicals"](K)||Vt["Yi Syllables"](K)));(s2[me]||ve||ce.imageName)&&M.push(q_(re+1,H,P,M,a2(me,c.getCharCode(re+1),ve&&O),!1))}}var K;return Z_(q_(c.length(),H,P,M,0,!0))}function _p(c){let s=.5,h=.5;switch(c){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:s,verticalAlign:h}}function l2(c,s,h,m,v){if(!m&&!v)return;const S=c[h],C=(c[h].x+S.metrics.advance*S.scale)*m;for(let M=s;M<=h;M++)c[M].x-=C,c[M].y+=v}function c2(c,s,h){const{horizontalAlign:m,verticalAlign:v}=_p(h),S=s[0]-c.displaySize[0]*m,C=s[1]-c.displaySize[1]*v;return{image:c,top:C,bottom:C+c.displaySize[1],left:S,right:S+c.displaySize[0]}}function G_(c,s,h,m,v,S){const C=c.image;let M;if(C.content){const Te=C.content,Pe=C.pixelRatio||1;M=[Te[0]/Pe,Te[1]/Pe,C.displaySize[0]-Te[2]/Pe,C.displaySize[1]-Te[3]/Pe]}const P=s.left*S,O=s.right*S;let H,K,re,ce;h==="width"||h==="both"?(ce=v[0]+P-m[3],K=v[0]+O+m[1]):(ce=v[0]+(P+O-C.displaySize[0])/2,K=ce+C.displaySize[0]);const me=s.top*S,ve=s.bottom*S;return h==="height"||h==="both"?(H=v[1]+me-m[0],re=v[1]+ve+m[2]):(H=v[1]+(me+ve-C.displaySize[1])/2,re=H+C.displaySize[1]),{image:C,top:H,right:K,bottom:re,left:ce,collisionPadding:M}}const zu=255,ks=128,pa=zu*ks;function H_(c,s){const{expression:h}=s;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new wr(c+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:v}=h;let S=0;for(;S<m.length&&m[S]<=c;)S++;S=Math.max(0,S-1);let C=S;for(;C<m.length&&m[C]<c+1;)C++;C=Math.min(m.length-1,C);const M=m[S],P=m[C];return h.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:P,interpolationType:v}:{kind:"camera",minZoom:M,maxZoom:P,minSize:h.evaluate(new wr(M)),maxSize:h.evaluate(new wr(P)),interpolationType:v}}}function gp(c,s,h){let m="never";const v=c.get(s);return v?m=v:c.get(h)&&(m="always"),m}const u2=fa.VectorTileFeature.types,h2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ef(c,s,h,m,v,S,C,M,P,O,H,K,re){const ce=M?Math.min(pa,Math.round(M[0])):0,me=M?Math.min(pa,Math.round(M[1])):0;c.emplaceBack(s,h,Math.round(32*m),Math.round(32*v),S,C,(ce<<1)+(P?1:0),me,16*O,16*H,256*K,256*re)}function yp(c,s,h){c.emplaceBack(s.x,s.y,h),c.emplaceBack(s.x,s.y,h),c.emplaceBack(s.x,s.y,h),c.emplaceBack(s.x,s.y,h)}function f2(c){for(const s of c.sections)if(Kd(s.text))return!0;return!1}class bp{constructor(s){this.layoutVertexArray=new Je,this.indexArray=new ot,this.programConfigurations=s,this.segments=new Rt,this.dynamicLayoutVertexArray=new Le,this.opacityVertexArray=new Ue,this.hasVisibleVertices=!1,this.placedSymbolArray=new f}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(s,h,m,v){this.isEmpty()||(m&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Vw.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,qw.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,h2,!0),this.opacityVertexBuffer.itemSize=1),(m||v)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ht("SymbolBuffers",bp);class vp{constructor(s,h,m){this.layoutVertexArray=new s,this.layoutAttributes=h,this.indexArray=new m,this.segments=new Rt,this.collisionVertexArray=new et}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,Zw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ht("CollisionBuffers",vp);class fc{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(C=>C.id),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Jd([]),this.placementViewportMatrix=Jd([]);const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=H_(this.zoom,h["text-size"]),this.iconSizeData=H_(this.zoom,h["icon-size"]);const m=this.layers[0].layout,v=m.get("symbol-sort-key"),S=m.get("symbol-z-order");this.canOverlap=gp(m,"text-overlap","text-allow-overlap")!=="never"||gp(m,"icon-overlap","icon-allow-overlap")!=="never"||m.get("text-ignore-placement")||m.get("icon-ignore-placement"),this.sortFeaturesByKey=S!=="viewport-y"&&!v.isConstant(),this.sortFeaturesByY=(S==="viewport-y"||S==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,m.get("symbol-placement")==="point"&&(this.writingModes=m.get("text-writing-mode").map(C=>u.ah[C])),this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id),this.sourceID=s.sourceID}createArrays(){this.text=new bp(new Mr(this.layers,this.zoom,s=>/^text/.test(s))),this.icon=new bp(new Mr(this.layers,this.zoom,s=>/^icon/.test(s))),this.glyphOffsetArray=new k,this.lineVertexArray=new E,this.symbolInstances=new b,this.textAnchorOffsets=new B}calculateGlyphDependencies(s,h,m,v,S){for(let C=0;C<s.length;C++)if(h[s.charCodeAt(C)]=!0,(m||v)&&S){const M=Iu[s.charAt(C)];M&&(h[M.charCodeAt(0)]=!0)}}populate(s,h,m){const v=this.layers[0],S=v.layout,C=S.get("text-font"),M=S.get("text-field"),P=S.get("icon-image"),O=(M.value.kind!=="constant"||M.value.value instanceof Wi&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(C.value.kind!=="constant"||C.value.value.length>0),H=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,K=S.get("symbol-sort-key");if(this.features=[],!O&&!H)return;const re=h.iconDependencies,ce=h.glyphDependencies,me=h.availableImages,ve=new wr(this.zoom);for(const{feature:Te,id:Pe,index:Ze,sourceLayerIndex:$e}of s){const Ne=v._featureFilter.needGeometry,ct=$s(Te,Ne);if(!v._featureFilter.filter(ve,ct,m))continue;let ft,Zt;if(Ne||(ct.geometry=Rs(Te)),O){const qt=v.getValueAndResolveTokens("text-field",ct,m,me),jt=Wi.factory(qt),zt=this.hasRTLText=this.hasRTLText||f2(jt);(!zt||bs.getRTLTextPluginStatus()==="unavailable"||zt&&bs.isParsed())&&(ft=Hw(jt,v,ct))}if(H){const qt=v.getValueAndResolveTokens("icon-image",ct,m,me);Zt=qt instanceof lo?qt:lo.fromString(qt)}if(!ft&&!Zt)continue;const Jt=this.sortFeaturesByKey?K.evaluate(ct,{},m):void 0;if(this.features.push({id:Pe,text:ft,icon:Zt,index:Ze,sourceLayerIndex:$e,geometry:ct.geometry,properties:Te.properties,type:u2[Te.type],sortKey:Jt}),Zt&&(re[Zt.name]=!0),ft){const qt=C.evaluate(ct,{},m).join(","),jt=S.get("text-rotation-alignment")!=="viewport"&&S.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(u.ah.vertical)>=0;for(const zt of ft.sections)if(zt.image)re[zt.image.name]=!0;else{const Wt=ua(ft.toString()),Ft=zt.fontStack||qt,wt=ce[Ft]=ce[Ft]||{};this.calculateGlyphDependencies(zt.text,wt,jt,this.allowVerticalPlacement,Wt)}}}S.get("symbol-placement")==="line"&&(this.features=function(Te){const Pe={},Ze={},$e=[];let Ne=0;function ct(qt){$e.push(Te[qt]),Ne++}function ft(qt,jt,zt){const Wt=Ze[qt];return delete Ze[qt],Ze[jt]=Wt,$e[Wt].geometry[0].pop(),$e[Wt].geometry[0]=$e[Wt].geometry[0].concat(zt[0]),Wt}function Zt(qt,jt,zt){const Wt=Pe[jt];return delete Pe[jt],Pe[qt]=Wt,$e[Wt].geometry[0].shift(),$e[Wt].geometry[0]=zt[0].concat($e[Wt].geometry[0]),Wt}function Jt(qt,jt,zt){const Wt=zt?jt[0][jt[0].length-1]:jt[0][0];return`${qt}:${Wt.x}:${Wt.y}`}for(let qt=0;qt<Te.length;qt++){const jt=Te[qt],zt=jt.geometry,Wt=jt.text?jt.text.toString():null;if(!Wt){ct(qt);continue}const Ft=Jt(Wt,zt),wt=Jt(Wt,zt,!0);if(Ft in Ze&&wt in Pe&&Ze[Ft]!==Pe[wt]){const ln=Zt(Ft,wt,zt),en=ft(Ft,wt,$e[ln].geometry);delete Pe[Ft],delete Ze[wt],Ze[Jt(Wt,$e[en].geometry,!0)]=en,$e[ln].geometry=null}else Ft in Ze?ft(Ft,wt,zt):wt in Pe?Zt(Ft,wt,zt):(ct(qt),Pe[Ft]=Ne-1,Ze[wt]=Ne-1)}return $e.filter(qt=>qt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Te,Pe)=>Te.sortKey-Pe.sortKey)}update(s,h,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,h,this.layers,m),this.icon.programConfigurations.updatePaintArrays(s,h,this.layers,m))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,h){const m=this.lineVertexArray.length;if(s.segment!==void 0){let v=s.dist(h[s.segment+1]),S=s.dist(h[s.segment]);const C={};for(let M=s.segment+1;M<h.length;M++)C[M]={x:h[M].x,y:h[M].y,tileUnitDistanceFromAnchor:v},M<h.length-1&&(v+=h[M+1].dist(h[M]));for(let M=s.segment||0;M>=0;M--)C[M]={x:h[M].x,y:h[M].y,tileUnitDistanceFromAnchor:S},M>0&&(S+=h[M-1].dist(h[M]));for(let M=0;M<h.length;M++){const P=C[M];this.lineVertexArray.emplaceBack(P.x,P.y,P.tileUnitDistanceFromAnchor)}}return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(s,h,m,v,S,C,M,P,O,H,K,re){const ce=s.indexArray,me=s.layoutVertexArray,ve=s.segments.prepareSegment(4*h.length,me,ce,this.canOverlap?C.sortKey:void 0),Te=this.glyphOffsetArray.length,Pe=ve.vertexLength,Ze=this.allowVerticalPlacement&&M===u.ah.vertical?Math.PI/2:0,$e=C.text&&C.text.sections;for(let Ne=0;Ne<h.length;Ne++){const{tl:ct,tr:ft,bl:Zt,br:Jt,tex:qt,pixelOffsetTL:jt,pixelOffsetBR:zt,minFontScaleX:Wt,minFontScaleY:Ft,glyphOffset:wt,isSDF:ln,sectionIndex:en}=h[Ne],Dn=ve.vertexLength,yr=wt[1];Ef(me,P.x,P.y,ct.x,yr+ct.y,qt.x,qt.y,m,ln,jt.x,jt.y,Wt,Ft),Ef(me,P.x,P.y,ft.x,yr+ft.y,qt.x+qt.w,qt.y,m,ln,zt.x,jt.y,Wt,Ft),Ef(me,P.x,P.y,Zt.x,yr+Zt.y,qt.x,qt.y+qt.h,m,ln,jt.x,zt.y,Wt,Ft),Ef(me,P.x,P.y,Jt.x,yr+Jt.y,qt.x+qt.w,qt.y+qt.h,m,ln,zt.x,zt.y,Wt,Ft),yp(s.dynamicLayoutVertexArray,P,Ze),ce.emplaceBack(Dn,Dn+1,Dn+2),ce.emplaceBack(Dn+1,Dn+2,Dn+3),ve.vertexLength+=4,ve.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(wt[0]),Ne!==h.length-1&&en===h[Ne+1].sectionIndex||s.programConfigurations.populatePaintArrays(me.length,C,C.index,{},re,$e&&$e[en])}s.placedSymbolArray.emplaceBack(P.x,P.y,Te,this.glyphOffsetArray.length-Te,Pe,O,H,P.segment,m?m[0]:0,m?m[1]:0,v[0],v[1],M,0,!1,0,K)}_addCollisionDebugVertex(s,h,m,v,S,C){return h.emplaceBack(0,0),s.emplaceBack(m.x,m.y,v,S,Math.round(C.x),Math.round(C.y))}addCollisionDebugVertices(s,h,m,v,S,C,M){const P=S.segments.prepareSegment(4,S.layoutVertexArray,S.indexArray),O=P.vertexLength,H=S.layoutVertexArray,K=S.collisionVertexArray,re=M.anchorX,ce=M.anchorY;this._addCollisionDebugVertex(H,K,C,re,ce,new y(s,h)),this._addCollisionDebugVertex(H,K,C,re,ce,new y(m,h)),this._addCollisionDebugVertex(H,K,C,re,ce,new y(m,v)),this._addCollisionDebugVertex(H,K,C,re,ce,new y(s,v)),P.vertexLength+=4;const me=S.indexArray;me.emplaceBack(O,O+1),me.emplaceBack(O+1,O+2),me.emplaceBack(O+2,O+3),me.emplaceBack(O+3,O),P.primitiveLength+=4}addDebugCollisionBoxes(s,h,m,v){for(let S=s;S<h;S++){const C=this.collisionBoxArray.get(S);this.addCollisionDebugVertices(C.x1,C.y1,C.x2,C.y2,v?this.textCollisionBox:this.iconCollisionBox,C.anchorPoint,m)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vp(Qe,A_.members,_t),this.iconCollisionBox=new vp(Qe,A_.members,_t);for(let s=0;s<this.symbolInstances.length;s++){const h=this.symbolInstances.get(s);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(s,h,m,v,S,C,M,P,O){const H={};for(let K=h;K<m;K++){const re=s.get(K);H.textBox={x1:re.x1,y1:re.y1,x2:re.x2,y2:re.y2,anchorPointX:re.anchorPointX,anchorPointY:re.anchorPointY},H.textFeatureIndex=re.featureIndex;break}for(let K=v;K<S;K++){const re=s.get(K);H.verticalTextBox={x1:re.x1,y1:re.y1,x2:re.x2,y2:re.y2,anchorPointX:re.anchorPointX,anchorPointY:re.anchorPointY},H.verticalTextFeatureIndex=re.featureIndex;break}for(let K=C;K<M;K++){const re=s.get(K);H.iconBox={x1:re.x1,y1:re.y1,x2:re.x2,y2:re.y2,anchorPointX:re.anchorPointX,anchorPointY:re.anchorPointY},H.iconFeatureIndex=re.featureIndex;break}for(let K=P;K<O;K++){const re=s.get(K);H.verticalIconBox={x1:re.x1,y1:re.y1,x2:re.x2,y2:re.y2,anchorPointX:re.anchorPointX,anchorPointY:re.anchorPointY},H.verticalIconFeatureIndex=re.featureIndex;break}return H}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const m=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,m.textBoxStartIndex,m.textBoxEndIndex,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(s,h){const m=s.placedSymbolArray.get(h),v=m.vertexStartIndex+4*m.numGlyphs;for(let S=m.vertexStartIndex;S<v;S+=4)s.indexArray.emplaceBack(S,S+1,S+2),s.indexArray.emplaceBack(S+1,S+2,S+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(s),m=Math.cos(s),v=[],S=[],C=[];for(let M=0;M<this.symbolInstances.length;++M){C.push(M);const P=this.symbolInstances.get(M);v.push(0|Math.round(h*P.anchorX+m*P.anchorY)),S.push(P.featureIndex)}return C.sort((M,P)=>v[M]-v[P]||S[P]-S[M]),C}addToSortKeyRanges(s,h){const m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===h?m.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const m=this.symbolInstances.get(h);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach((v,S,C)=>{v>=0&&C.indexOf(v)===S&&this.addIndicesForPlacedSymbol(this.text,v)}),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let W_,K_;Ht("SymbolBucket",fc,{omit:["layers","collisionBoxArray","features","compareText"]}),fc.MAX_GLYPHS=65535,fc.addDynamicAttributes=yp;var wp={get paint(){return K_=K_||new $i({"icon-opacity":new cn(ye.paint_symbol["icon-opacity"]),"icon-color":new cn(ye.paint_symbol["icon-color"]),"icon-halo-color":new cn(ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new cn(ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new cn(ye.paint_symbol["icon-halo-blur"]),"icon-translate":new rn(ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new rn(ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new cn(ye.paint_symbol["text-opacity"]),"text-color":new cn(ye.paint_symbol["text-color"],{runtimeType:Qn,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new cn(ye.paint_symbol["text-halo-color"]),"text-halo-width":new cn(ye.paint_symbol["text-halo-width"]),"text-halo-blur":new cn(ye.paint_symbol["text-halo-blur"]),"text-translate":new rn(ye.paint_symbol["text-translate"]),"text-translate-anchor":new rn(ye.paint_symbol["text-translate-anchor"])})},get layout(){return W_=W_||new $i({"symbol-placement":new rn(ye.layout_symbol["symbol-placement"]),"symbol-spacing":new rn(ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new rn(ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new cn(ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new rn(ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new rn(ye.layout_symbol["icon-allow-overlap"]),"icon-overlap":new rn(ye.layout_symbol["icon-overlap"]),"icon-ignore-placement":new rn(ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new rn(ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new rn(ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new cn(ye.layout_symbol["icon-size"]),"icon-text-fit":new rn(ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new rn(ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new cn(ye.layout_symbol["icon-image"]),"icon-rotate":new cn(ye.layout_symbol["icon-rotate"]),"icon-padding":new cn(ye.layout_symbol["icon-padding"]),"icon-keep-upright":new rn(ye.layout_symbol["icon-keep-upright"]),"icon-offset":new cn(ye.layout_symbol["icon-offset"]),"icon-anchor":new cn(ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new rn(ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new rn(ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new rn(ye.layout_symbol["text-rotation-alignment"]),"text-field":new cn(ye.layout_symbol["text-field"]),"text-font":new cn(ye.layout_symbol["text-font"]),"text-size":new cn(ye.layout_symbol["text-size"]),"text-max-width":new cn(ye.layout_symbol["text-max-width"]),"text-line-height":new rn(ye.layout_symbol["text-line-height"]),"text-letter-spacing":new cn(ye.layout_symbol["text-letter-spacing"]),"text-justify":new cn(ye.layout_symbol["text-justify"]),"text-radial-offset":new cn(ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new rn(ye.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new cn(ye.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new cn(ye.layout_symbol["text-anchor"]),"text-max-angle":new rn(ye.layout_symbol["text-max-angle"]),"text-writing-mode":new rn(ye.layout_symbol["text-writing-mode"]),"text-rotate":new cn(ye.layout_symbol["text-rotate"]),"text-padding":new rn(ye.layout_symbol["text-padding"]),"text-keep-upright":new rn(ye.layout_symbol["text-keep-upright"]),"text-transform":new cn(ye.layout_symbol["text-transform"]),"text-offset":new cn(ye.layout_symbol["text-offset"]),"text-allow-overlap":new rn(ye.layout_symbol["text-allow-overlap"]),"text-overlap":new rn(ye.layout_symbol["text-overlap"]),"text-ignore-placement":new rn(ye.layout_symbol["text-ignore-placement"]),"text-optional":new rn(ye.layout_symbol["text-optional"])})}};class X_{constructor(s){if(s.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=s.property.overrides?s.property.overrides.runtimeType:Yn,this.defaultValue=s}evaluate(s){if(s.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(s.formattedSection))return h.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ht("FormatSectionOverride",X_,{omit:["defaultValue"]});class If extends wo{constructor(s){super(s,wp)}recalculate(s,h){if(super.recalculate(s,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const m=this.layout.get("text-writing-mode");if(m){const v=[];for(const S of m)v.indexOf(S)<0&&v.push(S);this.layout._values["text-writing-mode"]=v}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(s,h,m,v){const S=this.layout.get(s).evaluate(h,{},m,v),C=this._unevaluatedLayout._values[s];return C.isDataDriven()||fr(C.value)||!S?S:function(M,P){return P.replace(/{([^{}]+)}/g,(O,H)=>M&&H in M?String(M[H]):"")}(h.properties,S)}createBucket(s){return new fc(s)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const s of wp.paint.overridableProperties){if(!If.hasPaintOverride(this.layout,s))continue;const h=this.paint.get(s),m=new X_(h),v=new gr(m,h.property.specification);let S=null;S=h.value.kind==="constant"||h.value.kind==="source"?new Rl("source",v):new Xc("composite",v,h.value.zoomStops),this.paint._values[s]=new vo(h.property,S,h.parameters)}}_handleOverridablePaintPropertyUpdate(s,h,m){return!(!this.layout||h.isDataDriven()||m.isDataDriven())&&If.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,h){const m=s.get("text-field"),v=wp.paint.properties[h];let S=!1;const C=M=>{for(const P of M)if(v.overrides&&v.overrides.hasOverride(P))return void(S=!0)};if(m.value.kind==="constant"&&m.value.value instanceof Wi)C(m.value.value.sections);else if(m.value.kind==="source"){const M=O=>{S||(O instanceof ps&&Wr(O.value)===_r?C(O.value.sections):O instanceof zl?C(O.sections):O.eachChild(M))},P=m.value;P._styleExpression&&M(P._styleExpression.expression)}return S}}let J_;var d2={get paint(){return J_=J_||new $i({"background-color":new rn(ye.paint_background["background-color"]),"background-pattern":new Ya(ye.paint_background["background-pattern"]),"background-opacity":new rn(ye.paint_background["background-opacity"])})}};class p2 extends wo{constructor(s){super(s,d2)}}let Y_;var m2={get paint(){return Y_=Y_||new $i({"raster-opacity":new rn(ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new rn(ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new rn(ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new rn(ye.paint_raster["raster-brightness-max"]),"raster-saturation":new rn(ye.paint_raster["raster-saturation"]),"raster-contrast":new rn(ye.paint_raster["raster-contrast"]),"raster-resampling":new rn(ye.paint_raster["raster-resampling"]),"raster-fade-duration":new rn(ye.paint_raster["raster-fade-duration"])})}};class _2 extends wo{constructor(s){super(s,m2)}}class g2 extends wo{constructor(s){super(s,{}),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=s}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class y2{constructor(s){this._methodToThrottle=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const xp=63710088e-1;class ma{constructor(s,h){if(isNaN(s)||isNaN(h))throw new Error(`Invalid LngLat object: (${s}, ${h})`);if(this.lng=+s,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ma(se(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const h=Math.PI/180,m=this.lat*h,v=s.lat*h,S=Math.sin(m)*Math.sin(v)+Math.cos(m)*Math.cos(v)*Math.cos((s.lng-this.lng)*h);return xp*Math.acos(Math.min(S,1))}static convert(s){if(s instanceof ma)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new ma(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new ma(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Q_=2*Math.PI*xp;function eg(c){return Q_*Math.cos(c*Math.PI/180)}function tg(c){return(180+c)/360}function ng(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function rg(c,s){return c/eg(s)}function kp(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}class Af{constructor(s,h,m=0){this.x=+s,this.y=+h,this.z=+m}static fromLngLat(s,h=0){const m=ma.convert(s);return new Af(tg(m.lng),ng(m.lat),rg(h,m.lat))}toLngLat(){return new ma(360*this.x-180,kp(this.y))}toAltitude(){return this.z*eg(kp(this.y))}meterInMercatorCoordinateUnits(){return 1/Q_*(s=kp(this.y),1/Math.cos(s*Math.PI/180));var s}}function ig(c,s,h){var m=2*Math.PI*6378137/256/Math.pow(2,h);return[c*m-2*Math.PI*6378137/2,s*m-2*Math.PI*6378137/2]}class Sp{constructor(s,h,m){if(s<0||s>25||m<0||m>=Math.pow(2,s)||h<0||h>=Math.pow(2,s))throw new Error(`x=${h}, y=${m}, z=${s} outside of bounds. 0<=x<${Math.pow(2,s)}, 0<=y<${Math.pow(2,s)} 0<=z<=25 `);this.z=s,this.x=h,this.y=m,this.key=Du(0,s,s,h,m)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,h,m){const v=(C=this.y,M=this.z,P=ig(256*(S=this.x),256*(C=Math.pow(2,M)-C-1),M),O=ig(256*(S+1),256*(C+1),M),P[0]+","+P[1]+","+O[0]+","+O[1]);var S,C,M,P,O;const H=function(K,re,ce){let me,ve="";for(let Te=K;Te>0;Te--)me=1<<Te-1,ve+=(re&me?1:0)+(ce&me?2:0);return ve}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(m==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,H).replace(/{bbox-epsg-3857}/g,v)}isChildOf(s){const h=this.z-s.z;return h>0&&s.x===this.x>>h&&s.y===this.y>>h}getTilePoint(s){const h=Math.pow(2,this.z);return new y((s.x*h-this.x)*jr,(s.y*h-this.y)*jr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class og{constructor(s,h){this.wrap=s,this.canonical=h,this.key=Du(s,h.z,h.z,h.x,h.y)}}class ko{constructor(s,h,m,v,S){if(s<m)throw new Error(`overscaledZ should be >= z; overscaledZ = ${s}; z = ${m}`);this.overscaledZ=s,this.wrap=h,this.canonical=new Sp(m,+v,+S),this.key=Du(h,s,m,v,S)}clone(){return new ko(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-s;return s>this.canonical.z?new ko(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ko(s,this.wrap,s,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(s,h){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-s;return s>this.canonical.z?Du(this.wrap*+h,s,this.canonical.z,this.canonical.x,this.canonical.y):Du(this.wrap*+h,s,s,this.canonical.x>>m,this.canonical.y>>m)}isChildOf(s){if(s.wrap!==this.wrap)return!1;const h=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.x===this.canonical.x>>h&&s.canonical.y===this.canonical.y>>h}children(s){if(this.overscaledZ>=s)return[new ko(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,m=2*this.canonical.x,v=2*this.canonical.y;return[new ko(h,this.wrap,h,m,v),new ko(h,this.wrap,h,m+1,v),new ko(h,this.wrap,h,m,v+1),new ko(h,this.wrap,h,m+1,v+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new ko(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new ko(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new og(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(s){return this.canonical.getTilePoint(new Af(s.x-this.wrap,s.y))}}function Du(c,s,h,m,v){(c*=2)<0&&(c=-1*c-1);const S=1<<h;return(S*S*c+S*v+m).toString(36)+h.toString(36)+s.toString(36)}Ht("CanonicalTileID",Sp),Ht("OverscaledTileID",ko,{omit:["posMatrix"]});class sg{constructor(s,h,m,v=1,S=1,C=1,M=0){if(this.uid=s,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(m&&!["mapbox","terrarium","custom"].includes(m))return void Ee(`"${m}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=h.height;const P=this.dim=h.height-2;switch(this.data=new Uint32Array(h.data.buffer),m){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=v,this.greenFactor=S,this.blueFactor=C,this.baseShift=M;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let O=0;O<P;O++)this.data[this._idx(-1,O)]=this.data[this._idx(0,O)],this.data[this._idx(P,O)]=this.data[this._idx(P-1,O)],this.data[this._idx(O,-1)]=this.data[this._idx(O,0)],this.data[this._idx(O,P)]=this.data[this._idx(O,P-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(P,-1)]=this.data[this._idx(P-1,0)],this.data[this._idx(-1,P)]=this.data[this._idx(0,P-1)],this.data[this._idx(P,P)]=this.data[this._idx(P-1,P-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let O=0;O<P;O++)for(let H=0;H<P;H++){const K=this.get(O,H);K>this.max&&(this.max=K),K<this.min&&(this.min=K)}}get(s,h){const m=new Uint8Array(this.data.buffer),v=4*this._idx(s,h);return this.unpack(m[v],m[v+1],m[v+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(s,h){if(s<-1||s>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(s+1)}unpack(s,h,m){return s*this.redFactor+h*this.greenFactor+m*this.blueFactor-this.baseShift}getPixels(){return new xo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(s,h,m){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let v=h*this.dim,S=h*this.dim+this.dim,C=m*this.dim,M=m*this.dim+this.dim;switch(h){case-1:v=S-1;break;case 1:S=v+1}switch(m){case-1:C=M-1;break;case 1:M=C+1}const P=-h*this.dim,O=-m*this.dim;for(let H=C;H<M;H++)for(let K=v;K<S;K++)this.data[this._idx(K,H)]=s.data[this._idx(K+P,H+O)]}}Ht("DEMData",sg);class ag{constructor(s){this._stringToNumber={},this._numberToString=[];for(let h=0;h<s.length;h++){const m=s[h];this._stringToNumber[m]=h,this._numberToString[h]=m}}encode(s){return this._stringToNumber[s]}decode(s){if(s>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${s} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[s]}}class lg{constructor(s,h,m,v,S){this.type="Feature",this._vectorTileFeature=s,s._z=h,s._x=m,s._y=v,this.properties=s.properties,this.id=S}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={geometry:this.geometry};for(const h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(s[h]=this[h]);return s}}class cg{constructor(s,h){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new Ka(jr,16,0),this.grid3D=new Ka(jr,16,0),this.featureIndexArray=new X,this.promoteId=h}insert(s,h,m,v,S,C){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(m,v,S);const P=C?this.grid3D:this.grid;for(let O=0;O<h.length;O++){const H=h[O],K=[1/0,1/0,-1/0,-1/0];for(let re=0;re<H.length;re++){const ce=H[re];K[0]=Math.min(K[0],ce.x),K[1]=Math.min(K[1],ce.y),K[2]=Math.max(K[2],ce.x),K[3]=Math.max(K[3],ce.y)}K[0]<jr&&K[1]<jr&&K[2]>=0&&K[3]>=0&&P.insert(M,K[0],K[1],K[2],K[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new fa.VectorTile(new fp(this.rawTileData)).layers,this.sourceLayerCoder=new ag(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(s,h,m,v){this.loadVTLayers();const S=s.params||{},C=jr/s.tileSize/s.scale,M=Ol(S.filter),P=s.queryGeometry,O=s.queryPadding*C,H=hg(P),K=this.grid.query(H.minX-O,H.minY-O,H.maxX+O,H.maxY+O),re=hg(s.cameraQueryGeometry),ce=this.grid3D.query(re.minX-O,re.minY-O,re.maxX+O,re.maxY+O,(Te,Pe,Ze,$e)=>function(Ne,ct,ft,Zt,Jt){for(const jt of Ne)if(ct<=jt.x&&ft<=jt.y&&Zt>=jt.x&&Jt>=jt.y)return!0;const qt=[new y(ct,ft),new y(ct,Jt),new y(Zt,Jt),new y(Zt,ft)];if(Ne.length>2){for(const jt of qt)if(oc(Ne,jt))return!0}for(let jt=0;jt<Ne.length-1;jt++)if(Xv(Ne[jt],Ne[jt+1],qt))return!0;return!1}(s.cameraQueryGeometry,Te-O,Pe-O,Ze+O,$e+O));for(const Te of ce)K.push(Te);K.sort(b2);const me={};let ve;for(let Te=0;Te<K.length;Te++){const Pe=K[Te];if(Pe===ve)continue;ve=Pe;const Ze=this.featureIndexArray.get(Pe);let $e=null;this.loadMatchingFeature(me,Ze.bucketIndex,Ze.sourceLayerIndex,Ze.featureIndex,M,S.layers,S.availableImages,h,m,v,(Ne,ct,ft)=>($e||($e=Rs(Ne)),ct.queryIntersectsFeature(P,Ne,ft,$e,this.z,s.transform,C,s.pixelPosMatrix)))}return me}loadMatchingFeature(s,h,m,v,S,C,M,P,O,H,K){const re=this.bucketLayerIDs[h];if(C&&!function(Te,Pe){for(let Ze=0;Ze<Te.length;Ze++)if(Pe.indexOf(Te[Ze])>=0)return!0;return!1}(C,re))return;const ce=this.sourceLayerCoder.decode(m),me=this.vtLayers[ce].feature(v);if(S.needGeometry){const Te=$s(me,!0);if(!S.filter(new wr(this.tileID.overscaledZ),Te,this.tileID.canonical))return}else if(!S.filter(new wr(this.tileID.overscaledZ),me))return;const ve=this.getId(me,ce);for(let Te=0;Te<re.length;Te++){const Pe=re[Te];if(C&&C.indexOf(Pe)<0)continue;const Ze=P[Pe];if(!Ze)continue;let $e={};ve&&H&&($e=H.getState(Ze.sourceLayer||"_geojsonTileLayer",ve));const Ne=J({},O[Pe]);Ne.paint=ug(Ne.paint,Ze.paint,me,$e,M),Ne.layout=ug(Ne.layout,Ze.layout,me,$e,M);const ct=!K||K(me,Ze,$e);if(!ct)continue;const ft=new lg(me,this.z,this.x,this.y,ve);ft.layer=Ne;let Zt=s[Pe];Zt===void 0&&(Zt=s[Pe]=[]),Zt.push({featureIndex:v,feature:ft,intersectionZ:ct})}}lookupSymbolFeatures(s,h,m,v,S,C,M,P){const O={};this.loadVTLayers();const H=Ol(S);for(const K of s)this.loadMatchingFeature(O,m,v,K,H,C,M,P,h);return O}hasLayer(s){for(const h of this.bucketLayerIDs)for(const m of h)if(s===m)return!0;return!1}getId(s,h){let m=s.id;return this.promoteId&&(m=s.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]],typeof m=="boolean"&&(m=Number(m))),m}}function ug(c,s,h,m,v){return _e(c,(S,C)=>{const M=s instanceof Ja?s.get(C):null;return M&&M.evaluate?M.evaluate(h,m,v):M})}function hg(c){let s=1/0,h=1/0,m=-1/0,v=-1/0;for(const S of c)s=Math.min(s,S.x),h=Math.min(h,S.y),m=Math.max(m,S.x),v=Math.max(v,S.y);return{minX:s,minY:h,maxX:m,maxY:v}}function b2(c,s){return s-c}function fg(c,s,h,m,v){const S=[];for(let C=0;C<c.length;C++){const M=c[C];let P;for(let O=0;O<M.length-1;O++){let H=M[O],K=M[O+1];H.x<s&&K.x<s||(H.x<s?H=new y(s,H.y+(s-H.x)/(K.x-H.x)*(K.y-H.y))._round():K.x<s&&(K=new y(s,H.y+(s-H.x)/(K.x-H.x)*(K.y-H.y))._round()),H.y<h&&K.y<h||(H.y<h?H=new y(H.x+(h-H.y)/(K.y-H.y)*(K.x-H.x),h)._round():K.y<h&&(K=new y(H.x+(h-H.y)/(K.y-H.y)*(K.x-H.x),h)._round()),H.x>=m&&K.x>=m||(H.x>=m?H=new y(m,H.y+(m-H.x)/(K.x-H.x)*(K.y-H.y))._round():K.x>=m&&(K=new y(m,H.y+(m-H.x)/(K.x-H.x)*(K.y-H.y))._round()),H.y>=v&&K.y>=v||(H.y>=v?H=new y(H.x+(v-H.y)/(K.y-H.y)*(K.x-H.x),v)._round():K.y>=v&&(K=new y(H.x+(v-H.y)/(K.y-H.y)*(K.x-H.x),v)._round()),P&&H.equals(P[P.length-1])||(P=[H],S.push(P)),P.push(K)))))}}return S}Ht("FeatureIndex",cg,{omit:["rawTileData","sourceLayerCoder"]});class _a extends y{constructor(s,h,m,v){super(s,h),this.angle=m,v!==void 0&&(this.segment=v)}clone(){return new _a(this.x,this.y,this.angle,this.segment)}}function dg(c,s,h,m,v){if(s.segment===void 0||h===0)return!0;let S=s,C=s.segment+1,M=0;for(;M>-h/2;){if(C--,C<0)return!1;M-=c[C].dist(S),S=c[C]}M+=c[C].dist(c[C+1]),C++;const P=[];let O=0;for(;M<h/2;){const H=c[C],K=c[C+1];if(!K)return!1;let re=c[C-1].angleTo(H)-H.angleTo(K);for(re=Math.abs((re+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:M,angleDelta:re}),O+=re;M-P[0].distance>m;)O-=P.shift().angleDelta;if(O>v)return!1;C++,M+=H.dist(K)}return!0}function pg(c){let s=0;for(let h=0;h<c.length-1;h++)s+=c[h].dist(c[h+1]);return s}function mg(c,s,h){return c?.6*s*h:0}function _g(c,s){return Math.max(c?c.right-c.left:0,s?s.right-s.left:0)}function v2(c,s,h,m,v,S){const C=mg(h,v,S),M=_g(h,m)*S;let P=0;const O=pg(c)/2;for(let H=0;H<c.length-1;H++){const K=c[H],re=c[H+1],ce=K.dist(re);if(P+ce>O){const me=(O-P)/ce,ve=Ti.number(K.x,re.x,me),Te=Ti.number(K.y,re.y,me),Pe=new _a(ve,Te,re.angleTo(K),H);return Pe._round(),!C||dg(c,Pe,M,C,s)?Pe:void 0}P+=ce}}function w2(c,s,h,m,v,S,C,M,P){const O=mg(m,S,C),H=_g(m,v),K=H*C,re=c[0].x===0||c[0].x===P||c[0].y===0||c[0].y===P;return s-K<s/4&&(s=K+s/4),gg(c,re?s/2*M%s:(H/2+2*S)*C*M%s,s,O,h,K,re,!1,P)}function gg(c,s,h,m,v,S,C,M,P){const O=S/2,H=pg(c);let K=0,re=s-h,ce=[];for(let me=0;me<c.length-1;me++){const ve=c[me],Te=c[me+1],Pe=ve.dist(Te),Ze=Te.angleTo(ve);for(;re+h<K+Pe;){re+=h;const $e=(re-K)/Pe,Ne=Ti.number(ve.x,Te.x,$e),ct=Ti.number(ve.y,Te.y,$e);if(Ne>=0&&Ne<P&&ct>=0&&ct<P&&re-O>=0&&re+O<=H){const ft=new _a(Ne,ct,Ze,me);ft._round(),m&&!dg(c,ft,S,m,v)||ce.push(ft)}}K+=Pe}return M||ce.length||C||(ce=gg(c,K/2,h,m,v,S,C,!0,P)),ce}Ht("Anchor",_a);const dc=Qi;function yg(c,s,h,m){const v=[],S=c.image,C=S.pixelRatio,M=S.paddedRect.w-2*dc,P=S.paddedRect.h-2*dc,O=c.right-c.left,H=c.bottom-c.top,K=S.stretchX||[[0,M]],re=S.stretchY||[[0,P]],ce=(zt,Wt)=>zt+Wt[1]-Wt[0],me=K.reduce(ce,0),ve=re.reduce(ce,0),Te=M-me,Pe=P-ve;let Ze=0,$e=me,Ne=0,ct=ve,ft=0,Zt=Te,Jt=0,qt=Pe;if(S.content&&m){const zt=S.content;Ze=Pf(K,0,zt[0]),Ne=Pf(re,0,zt[1]),$e=Pf(K,zt[0],zt[2]),ct=Pf(re,zt[1],zt[3]),ft=zt[0]-Ze,Jt=zt[1]-Ne,Zt=zt[2]-zt[0]-$e,qt=zt[3]-zt[1]-ct}const jt=(zt,Wt,Ft,wt)=>{const ln=zf(zt.stretch-Ze,$e,O,c.left),en=Df(zt.fixed-ft,Zt,zt.stretch,me),Dn=zf(Wt.stretch-Ne,ct,H,c.top),yr=Df(Wt.fixed-Jt,qt,Wt.stretch,ve),kr=zf(Ft.stretch-Ze,$e,O,c.left),si=Df(Ft.fixed-ft,Zt,Ft.stretch,me),ho=zf(wt.stretch-Ne,ct,H,c.top),Bi=Df(wt.fixed-Jt,qt,wt.stretch,ve),Yr=new y(ln,Dn),gi=new y(kr,Dn),xi=new y(kr,ho),Oi=new y(ln,ho),Ni=new y(en/C,yr/C),ai=new y(si/C,Bi/C),li=s*Math.PI/180;if(li){const Ei=Math.sin(li),eo=Math.cos(li),to=[eo,-Ei,Ei,eo];Yr._matMult(to),gi._matMult(to),Oi._matMult(to),xi._matMult(to)}const Li=zt.stretch+zt.fixed,ji=Wt.stretch+Wt.fixed;return{tl:Yr,tr:gi,bl:Oi,br:xi,tex:{x:S.paddedRect.x+dc+Li,y:S.paddedRect.y+dc+ji,w:Ft.stretch+Ft.fixed-Li,h:wt.stretch+wt.fixed-ji},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ni,pixelOffsetBR:ai,minFontScaleX:Zt/C/O,minFontScaleY:qt/C/H,isSDF:h}};if(m&&(S.stretchX||S.stretchY)){const zt=bg(K,Te,me),Wt=bg(re,Pe,ve);for(let Ft=0;Ft<zt.length-1;Ft++){const wt=zt[Ft],ln=zt[Ft+1];for(let en=0;en<Wt.length-1;en++)v.push(jt(wt,Wt[en],ln,Wt[en+1]))}}else v.push(jt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:P+1}));return v}function Pf(c,s,h){let m=0;for(const v of c)m+=Math.max(s,Math.min(h,v[1]))-Math.max(s,Math.min(h,v[0]));return m}function bg(c,s,h){const m=[{fixed:-dc,stretch:0}];for(const[v,S]of c){const C=m[m.length-1];m.push({fixed:v-C.stretch,stretch:C.stretch}),m.push({fixed:v-C.stretch,stretch:C.stretch+(S-v)})}return m.push({fixed:s+dc,stretch:h}),m}function zf(c,s,h,m){return c/s*h+m}function Df(c,s,h,m){return c-s*h/m}class Rf{constructor(s,h,m,v,S,C,M,P,O,H){if(this.boxStartIndex=s.length,O){let K=C.top,re=C.bottom;const ce=C.collisionPadding;ce&&(K-=ce[1],re+=ce[3]);let me=re-K;me>0&&(me=Math.max(10,me),this.circleDiameter=me)}else{let K=C.top*M-P[0],re=C.bottom*M+P[2],ce=C.left*M-P[3],me=C.right*M+P[1];const ve=C.collisionPadding;if(ve&&(ce-=ve[0]*M,K-=ve[1]*M,me+=ve[2]*M,re+=ve[3]*M),H){const Te=new y(ce,K),Pe=new y(me,K),Ze=new y(ce,re),$e=new y(me,re),Ne=H*Math.PI/180;Te._rotate(Ne),Pe._rotate(Ne),Ze._rotate(Ne),$e._rotate(Ne),ce=Math.min(Te.x,Pe.x,Ze.x,$e.x),me=Math.max(Te.x,Pe.x,Ze.x,$e.x),K=Math.min(Te.y,Pe.y,Ze.y,$e.y),re=Math.max(Te.y,Pe.y,Ze.y,$e.y)}s.emplaceBack(h.x,h.y,ce,K,me,re,m,v,S)}this.boxEndIndex=s.length}}class x2{constructor(s=[],h=k2){if(this.data=s,this.length=this.data.length,this.compare=h,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(s){this.data.push(s),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const s=this.data[0],h=this.data.pop();return this.length--,this.length>0&&(this.data[0]=h,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:h,compare:m}=this,v=h[s];for(;s>0;){const S=s-1>>1,C=h[S];if(m(v,C)>=0)break;h[s]=C,s=S}h[s]=v}_down(s){const{data:h,compare:m}=this,v=this.length>>1,S=h[s];for(;s<v;){let C=1+(s<<1),M=h[C];const P=C+1;if(P<this.length&&m(h[P],M)<0&&(C=P,M=h[P]),m(M,S)>=0)break;h[s]=M,s=C}h[s]=S}}function k2(c,s){return c<s?-1:c>s?1:0}function S2(c,s=1,h=!1){let m=1/0,v=1/0,S=-1/0,C=-1/0;const M=c[0];for(let ce=0;ce<M.length;ce++){const me=M[ce];(!ce||me.x<m)&&(m=me.x),(!ce||me.y<v)&&(v=me.y),(!ce||me.x>S)&&(S=me.x),(!ce||me.y>C)&&(C=me.y)}const P=Math.min(S-m,C-v);let O=P/2;const H=new x2([],C2);if(P===0)return new y(m,v);for(let ce=m;ce<S;ce+=P)for(let me=v;me<C;me+=P)H.push(new pc(ce+O,me+O,O,c));let K=function(ce){let me=0,ve=0,Te=0;const Pe=ce[0];for(let Ze=0,$e=Pe.length,Ne=$e-1;Ze<$e;Ne=Ze++){const ct=Pe[Ze],ft=Pe[Ne],Zt=ct.x*ft.y-ft.x*ct.y;ve+=(ct.x+ft.x)*Zt,Te+=(ct.y+ft.y)*Zt,me+=3*Zt}return new pc(ve/me,Te/me,0,ce)}(c),re=H.length;for(;H.length;){const ce=H.pop();(ce.d>K.d||!K.d)&&(K=ce,h&&console.log("found best %d after %d probes",Math.round(1e4*ce.d)/1e4,re)),ce.max-K.d<=s||(O=ce.h/2,H.push(new pc(ce.p.x-O,ce.p.y-O,O,c)),H.push(new pc(ce.p.x+O,ce.p.y-O,O,c)),H.push(new pc(ce.p.x-O,ce.p.y+O,O,c)),H.push(new pc(ce.p.x+O,ce.p.y+O,O,c)),re+=4)}return h&&(console.log(`num probes: ${re}`),console.log(`best distance: ${K.d}`)),K.p}function C2(c,s){return s.max-c.max}function pc(c,s,h,m){this.p=new y(c,s),this.h=h,this.d=function(v,S){let C=!1,M=1/0;for(let P=0;P<S.length;P++){const O=S[P];for(let H=0,K=O.length,re=K-1;H<K;re=H++){const ce=O[H],me=O[re];ce.y>v.y!=me.y>v.y&&v.x<(me.x-ce.x)*(v.y-ce.y)/(me.y-ce.y)+ce.x&&(C=!C),M=Math.min(M,n_(v,ce,me))}}return(C?1:-1)*Math.sqrt(M)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}var wi;u.ap=void 0,(wi=u.ap||(u.ap={}))[wi.center=1]="center",wi[wi.left=2]="left",wi[wi.right=3]="right",wi[wi.top=4]="top",wi[wi.bottom=5]="bottom",wi[wi["top-left"]=6]="top-left",wi[wi["top-right"]=7]="top-right",wi[wi["bottom-left"]=8]="bottom-left",wi[wi["bottom-right"]=9]="bottom-right";const ga=7,Cp=Number.POSITIVE_INFINITY;function vg(c,s){return s[1]!==Cp?function(h,m,v){let S=0,C=0;switch(m=Math.abs(m),v=Math.abs(v),h){case"top-right":case"top-left":case"top":C=v-ga;break;case"bottom-right":case"bottom-left":case"bottom":C=-v+ga}switch(h){case"top-right":case"bottom-right":case"right":S=-m;break;case"top-left":case"bottom-left":case"left":S=m}return[S,C]}(c,s[0],s[1]):function(h,m){let v=0,S=0;m<0&&(m=0);const C=m/Math.SQRT2;switch(h){case"top-right":case"top-left":S=C-ga;break;case"bottom-right":case"bottom-left":S=-C+ga;break;case"bottom":S=-m+ga;break;case"top":S=m-ga}switch(h){case"top-right":case"bottom-right":v=-C;break;case"top-left":case"bottom-left":v=C;break;case"left":v=m;break;case"right":v=-m}return[v,S]}(c,s[0])}function wg(c,s,h){var m;const v=c.layout,S=(m=v.get("text-variable-anchor-offset"))===null||m===void 0?void 0:m.evaluate(s,{},h);if(S){const M=S.values,P=[];for(let O=0;O<M.length;O+=2){const H=P[O]=M[O],K=M[O+1].map(re=>re*oi);H.startsWith("top")?K[1]-=ga:H.startsWith("bottom")&&(K[1]+=ga),P[O+1]=K}return new ao(P)}const C=v.get("text-variable-anchor");if(C){let M;M=c._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[v.get("text-radial-offset").evaluate(s,{},h)*oi,Cp]:v.get("text-offset").evaluate(s,{},h).map(O=>O*oi);const P=[];for(const O of C)P.push(O,vg(O,M));return new ao(P)}return null}function Tp(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function T2(c,s,h,m,v,S,C,M,P,O,H){let K=S.textMaxSize.evaluate(s,{});K===void 0&&(K=C);const re=c.layers[0].layout,ce=re.get("icon-offset").evaluate(s,{},H),me=kg(h.horizontal),ve=C/24,Te=c.tilePixelRatio*ve,Pe=c.tilePixelRatio*K/24,Ze=c.tilePixelRatio*M,$e=c.tilePixelRatio*re.get("symbol-spacing"),Ne=re.get("text-padding")*c.tilePixelRatio,ct=function(wt,ln,en,Dn=1){const yr=wt.get("icon-padding").evaluate(ln,{},en),kr=yr&&yr.values;return[kr[0]*Dn,kr[1]*Dn,kr[2]*Dn,kr[3]*Dn]}(re,s,H,c.tilePixelRatio),ft=re.get("text-max-angle")/180*Math.PI,Zt=re.get("text-rotation-alignment")!=="viewport"&&re.get("symbol-placement")!=="point",Jt=re.get("icon-rotation-alignment")==="map"&&re.get("symbol-placement")!=="point",qt=re.get("symbol-placement"),jt=$e/2,zt=re.get("icon-text-fit");let Wt;m&&zt!=="none"&&(c.allowVerticalPlacement&&h.vertical&&(Wt=G_(m,h.vertical,zt,re.get("icon-text-fit-padding"),ce,ve)),me&&(m=G_(m,me,zt,re.get("icon-text-fit-padding"),ce,ve)));const Ft=(wt,ln)=>{ln.x<0||ln.x>=jr||ln.y<0||ln.y>=jr||function(en,Dn,yr,kr,si,ho,Bi,Yr,gi,xi,Oi,Ni,ai,li,Li,ji,Ei,eo,to,ci,Bn,Ii,ki,ui,Zo){const ns=en.addToLineVertexArray(Dn,yr);let rs,Bs,Go,So,no=0,Os=0,Fu=0,Mg=0,Dp=-1,Rp=-1;const Ns={};let Lg=$r("");if(en.allowVerticalPlacement&&kr.vertical){const Ai=Yr.layout.get("text-rotate").evaluate(Bn,{},ui)+90;Go=new Rf(gi,Dn,xi,Oi,Ni,kr.vertical,ai,li,Li,Ai),Bi&&(So=new Rf(gi,Dn,xi,Oi,Ni,Bi,Ei,eo,Li,Ai))}if(si){const Ai=Yr.layout.get("icon-rotate").evaluate(Bn,{}),Co=Yr.layout.get("icon-text-fit")!=="none",sl=yg(si,Ai,ki,Co),os=Bi?yg(Bi,Ai,ki,Co):void 0;Bs=new Rf(gi,Dn,xi,Oi,Ni,si,Ei,eo,!1,Ai),no=4*sl.length;const al=en.iconSizeData;let Ss=null;al.kind==="source"?(Ss=[ks*Yr.layout.get("icon-size").evaluate(Bn,{})],Ss[0]>pa&&Ee(`${en.layerIds[0]}: Value for "icon-size" is >= ${zu}. Reduce your "icon-size".`)):al.kind==="composite"&&(Ss=[ks*Ii.compositeIconSizes[0].evaluate(Bn,{},ui),ks*Ii.compositeIconSizes[1].evaluate(Bn,{},ui)],(Ss[0]>pa||Ss[1]>pa)&&Ee(`${en.layerIds[0]}: Value for "icon-size" is >= ${zu}. Reduce your "icon-size".`)),en.addSymbols(en.icon,sl,Ss,ci,to,Bn,u.ah.none,Dn,ns.lineStartIndex,ns.lineLength,-1,ui),Dp=en.icon.placedSymbolArray.length-1,os&&(Os=4*os.length,en.addSymbols(en.icon,os,Ss,ci,to,Bn,u.ah.vertical,Dn,ns.lineStartIndex,ns.lineLength,-1,ui),Rp=en.icon.placedSymbolArray.length-1)}const Eg=Object.keys(kr.horizontal);for(const Ai of Eg){const Co=kr.horizontal[Ai];if(!rs){Lg=$r(Co.text);const os=Yr.layout.get("text-rotate").evaluate(Bn,{},ui);rs=new Rf(gi,Dn,xi,Oi,Ni,Co,ai,li,Li,os)}const sl=Co.positionedLines.length===1;if(Fu+=xg(en,Dn,Co,ho,Yr,Li,Bn,ji,ns,kr.vertical?u.ah.horizontal:u.ah.horizontalOnly,sl?Eg:[Ai],Ns,Dp,Ii,ui),sl)break}kr.vertical&&(Mg+=xg(en,Dn,kr.vertical,ho,Yr,Li,Bn,ji,ns,u.ah.vertical,["vertical"],Ns,Rp,Ii,ui));const E2=rs?rs.boxStartIndex:en.collisionBoxArray.length,I2=rs?rs.boxEndIndex:en.collisionBoxArray.length,A2=Go?Go.boxStartIndex:en.collisionBoxArray.length,P2=Go?Go.boxEndIndex:en.collisionBoxArray.length,z2=Bs?Bs.boxStartIndex:en.collisionBoxArray.length,D2=Bs?Bs.boxEndIndex:en.collisionBoxArray.length,R2=So?So.boxStartIndex:en.collisionBoxArray.length,$2=So?So.boxEndIndex:en.collisionBoxArray.length;let is=-1;const Ff=(Ai,Co)=>Ai&&Ai.circleDiameter?Math.max(Ai.circleDiameter,Co):Co;is=Ff(rs,is),is=Ff(Go,is),is=Ff(Bs,is),is=Ff(So,is);const Ig=is>-1?1:0;Ig&&(is*=Zo/oi),en.glyphOffsetArray.length>=fc.MAX_GLYPHS&&Ee("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Bn.sortKey!==void 0&&en.addToSortKeyRanges(en.symbolInstances.length,Bn.sortKey);const F2=wg(Yr,Bn,ui),[B2,O2]=function(Ai,Co){const sl=Ai.length,os=Co==null?void 0:Co.values;if((os==null?void 0:os.length)>0)for(let al=0;al<os.length;al+=2){const Ss=os[al+1];Ai.emplaceBack(u.ap[os[al]],Ss[0],Ss[1])}return[sl,Ai.length]}(en.textAnchorOffsets,F2);en.symbolInstances.emplaceBack(Dn.x,Dn.y,Ns.right>=0?Ns.right:-1,Ns.center>=0?Ns.center:-1,Ns.left>=0?Ns.left:-1,Ns.vertical||-1,Dp,Rp,Lg,E2,I2,A2,P2,z2,D2,R2,$2,xi,Fu,Mg,no,Os,Ig,0,ai,is,B2,O2)}(c,ln,wt,h,m,v,Wt,c.layers[0],c.collisionBoxArray,s.index,s.sourceLayerIndex,c.index,Te,[Ne,Ne,Ne,Ne],Zt,P,Ze,ct,Jt,ce,s,S,O,H,C)};if(qt==="line")for(const wt of fg(s.geometry,0,0,jr,jr)){const ln=w2(wt,$e,ft,h.vertical||me,m,24,Pe,c.overscaling,jr);for(const en of ln)me&&M2(c,me.text,jt,en)||Ft(wt,en)}else if(qt==="line-center"){for(const wt of s.geometry)if(wt.length>1){const ln=v2(wt,ft,h.vertical||me,m,24,Pe);ln&&Ft(wt,ln)}}else if(s.type==="Polygon")for(const wt of ip(s.geometry,0)){const ln=S2(wt,16);Ft(wt[0],new _a(ln.x,ln.y,0))}else if(s.type==="LineString")for(const wt of s.geometry)Ft(wt,new _a(wt[0].x,wt[0].y,0));else if(s.type==="Point")for(const wt of s.geometry)for(const ln of wt)Ft([ln],new _a(ln.x,ln.y,0))}function xg(c,s,h,m,v,S,C,M,P,O,H,K,re,ce,me){const ve=function(Ze,$e,Ne,ct,ft,Zt,Jt,qt){const jt=ct.layout.get("text-rotate").evaluate(Zt,{})*Math.PI/180,zt=[];for(const Wt of $e.positionedLines)for(const Ft of Wt.positionedGlyphs){if(!Ft.rect)continue;const wt=Ft.rect||{};let ln=O_+1,en=!0,Dn=1,yr=0;const kr=(ft||qt)&&Ft.vertical,si=Ft.metrics.advance*Ft.scale/2;if(qt&&$e.verticalizable&&(yr=Wt.lineOffset/2-(Ft.imageName?-(oi-Ft.metrics.width*Ft.scale)/2:(Ft.scale-1)*oi)),Ft.imageName){const ci=Jt[Ft.imageName];en=ci.sdf,Dn=ci.pixelRatio,ln=Qi/Dn}const ho=ft?[Ft.x+si,Ft.y]:[0,0];let Bi=ft?[0,0]:[Ft.x+si+Ne[0],Ft.y+Ne[1]-yr],Yr=[0,0];kr&&(Yr=Bi,Bi=[0,0]);const gi=Ft.metrics.isDoubleResolution?2:1,xi=(Ft.metrics.left-ln)*Ft.scale-si+Bi[0],Oi=(-Ft.metrics.top-ln)*Ft.scale+Bi[1],Ni=xi+wt.w/gi*Ft.scale/Dn,ai=Oi+wt.h/gi*Ft.scale/Dn,li=new y(xi,Oi),Li=new y(Ni,Oi),ji=new y(xi,ai),Ei=new y(Ni,ai);if(kr){const ci=new y(-si,si-Au),Bn=-Math.PI/2,Ii=oi/2-si,ki=new y(5-Au-Ii,-(Ft.imageName?Ii:0)),ui=new y(...Yr);li._rotateAround(Bn,ci)._add(ki)._add(ui),Li._rotateAround(Bn,ci)._add(ki)._add(ui),ji._rotateAround(Bn,ci)._add(ki)._add(ui),Ei._rotateAround(Bn,ci)._add(ki)._add(ui)}if(jt){const ci=Math.sin(jt),Bn=Math.cos(jt),Ii=[Bn,-ci,ci,Bn];li._matMult(Ii),Li._matMult(Ii),ji._matMult(Ii),Ei._matMult(Ii)}const eo=new y(0,0),to=new y(0,0);zt.push({tl:li,tr:Li,bl:ji,br:Ei,tex:wt,writingMode:$e.writingMode,glyphOffset:ho,sectionIndex:Ft.sectionIndex,isSDF:en,pixelOffsetTL:eo,pixelOffsetBR:to,minFontScaleX:0,minFontScaleY:0})}return zt}(0,h,M,v,S,C,m,c.allowVerticalPlacement),Te=c.textSizeData;let Pe=null;Te.kind==="source"?(Pe=[ks*v.layout.get("text-size").evaluate(C,{})],Pe[0]>pa&&Ee(`${c.layerIds[0]}: Value for "text-size" is >= ${zu}. Reduce your "text-size".`)):Te.kind==="composite"&&(Pe=[ks*ce.compositeTextSizes[0].evaluate(C,{},me),ks*ce.compositeTextSizes[1].evaluate(C,{},me)],(Pe[0]>pa||Pe[1]>pa)&&Ee(`${c.layerIds[0]}: Value for "text-size" is >= ${zu}. Reduce your "text-size".`)),c.addSymbols(c.text,ve,Pe,M,S,C,O,s,P.lineStartIndex,P.lineLength,re,me);for(const Ze of H)K[Ze]=c.text.placedSymbolArray.length-1;return 4*ve.length}function kg(c){for(const s in c)return c[s];return null}function M2(c,s,h,m){const v=c.compareText;if(s in v){const S=v[s];for(let C=S.length-1;C>=0;C--)if(m.dist(S[C])<h)return!0}else v[s]=[];return v[s].push(m),!1}const Sg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Mp{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[h,m]=new Uint8Array(s,0,2);if(h!==219)throw new Error("Data does not appear to be in a KDBush format.");const v=m>>4;if(v!==1)throw new Error(`Got v${v} data when expected v1.`);const S=Sg[15&m];if(!S)throw new Error("Unrecognized array type.");const[C]=new Uint16Array(s,2,1),[M]=new Uint32Array(s,4,1);return new Mp(M,C,S,s)}constructor(s,h=64,m=Float64Array,v){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+h,2),65535),this.ArrayType=m,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;const S=Sg.indexOf(this.ArrayType),C=2*s*this.ArrayType.BYTES_PER_ELEMENT,M=s*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-M%8)%8;if(S<0)throw new Error(`Unexpected typed array class: ${m}.`);v&&v instanceof ArrayBuffer?(this.data=v,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+M+P,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+C+M+P),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+M+P,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+S]),new Uint16Array(this.data,2,1)[0]=h,new Uint32Array(this.data,4,1)[0]=s)}add(s,h){const m=this._pos>>1;return this.ids[m]=m,this.coords[this._pos++]=s,this.coords[this._pos++]=h,m}finish(){const s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return Lp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,h,m,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:S,coords:C,nodeSize:M}=this,P=[0,S.length-1,0],O=[];for(;P.length;){const H=P.pop()||0,K=P.pop()||0,re=P.pop()||0;if(K-re<=M){for(let Te=re;Te<=K;Te++){const Pe=C[2*Te],Ze=C[2*Te+1];Pe>=s&&Pe<=m&&Ze>=h&&Ze<=v&&O.push(S[Te])}continue}const ce=re+K>>1,me=C[2*ce],ve=C[2*ce+1];me>=s&&me<=m&&ve>=h&&ve<=v&&O.push(S[ce]),(H===0?s<=me:h<=ve)&&(P.push(re),P.push(ce-1),P.push(1-H)),(H===0?m>=me:v>=ve)&&(P.push(ce+1),P.push(K),P.push(1-H))}return O}within(s,h,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:S,nodeSize:C}=this,M=[0,v.length-1,0],P=[],O=m*m;for(;M.length;){const H=M.pop()||0,K=M.pop()||0,re=M.pop()||0;if(K-re<=C){for(let Te=re;Te<=K;Te++)Tg(S[2*Te],S[2*Te+1],s,h)<=O&&P.push(v[Te]);continue}const ce=re+K>>1,me=S[2*ce],ve=S[2*ce+1];Tg(me,ve,s,h)<=O&&P.push(v[ce]),(H===0?s-m<=me:h-m<=ve)&&(M.push(re),M.push(ce-1),M.push(1-H)),(H===0?s+m>=me:h+m>=ve)&&(M.push(ce+1),M.push(K),M.push(1-H))}return P}}function Lp(c,s,h,m,v,S){if(v-m<=h)return;const C=m+v>>1;Cg(c,s,C,m,v,S),Lp(c,s,h,m,C-1,1-S),Lp(c,s,h,C+1,v,1-S)}function Cg(c,s,h,m,v,S){for(;v>m;){if(v-m>600){const O=v-m+1,H=h-m+1,K=Math.log(O),re=.5*Math.exp(2*K/3),ce=.5*Math.sqrt(K*re*(O-re)/O)*(H-O/2<0?-1:1);Cg(c,s,h,Math.max(m,Math.floor(h-H*re/O+ce)),Math.min(v,Math.floor(h+(O-H)*re/O+ce)),S)}const C=s[2*h+S];let M=m,P=v;for(Ru(c,s,m,h),s[2*v+S]>C&&Ru(c,s,m,v);M<P;){for(Ru(c,s,M,P),M++,P--;s[2*M+S]<C;)M++;for(;s[2*P+S]>C;)P--}s[2*m+S]===C?Ru(c,s,m,P):(P++,Ru(c,s,P,v)),P<=h&&(m=P+1),h<=P&&(v=P-1)}}function Ru(c,s,h,m){Ep(c,h,m),Ep(s,2*h,2*m),Ep(s,2*h+1,2*m+1)}function Ep(c,s,h){const m=c[s];c[s]=c[h],c[h]=m}function Tg(c,s,h,m){const v=c-h,S=s-m;return v*v+S*S}var Ip;u.bd=void 0,(Ip=u.bd||(u.bd={})).create="create",Ip.load="load",Ip.fullLoad="fullLoad";let $f=null,$u=[];const Ap=1e3/60,Pp="loadTime",zp="fullLoadTime",L2={mark(c){performance.mark(c)},frame(c){const s=c;$f!=null&&$u.push(s-$f),$f=s},clearMetrics(){$f=null,$u=[],performance.clearMeasures(Pp),performance.clearMeasures(zp);for(const c in u.bd)performance.clearMarks(u.bd[c])},getPerformanceMetrics(){performance.measure(Pp,u.bd.create,u.bd.load),performance.measure(zp,u.bd.create,u.bd.fullLoad);const c=performance.getEntriesByName(Pp)[0].duration,s=performance.getEntriesByName(zp)[0].duration,h=$u.length,m=1/($u.reduce((S,C)=>S+C,0)/h/1e3),v=$u.filter(S=>S>Ap).reduce((S,C)=>S+(C-Ap)/Ap,0);return{loadTime:c,fullLoadTime:s,fps:m,percentDroppedFrames:v/(h+v)*100,totalFrames:h}}};u.$=Rt,u.A=sc,u.B=function(c){if(Ie==null){const s=c.navigator?c.navigator.userAgent:null;Ie=!!c.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Ie},u.C=class{constructor(c,s){this.target=c,this.mapId=s,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new y2(()=>this.process()),this.subscription=function(h,m,v,S){return h.addEventListener(m,v,!1),{unsubscribe:()=>{h.removeEventListener(m,v,!1)}}}(this.target,"message",h=>this.receive(h)),this.globalScope=Ge(self)?c:window}registerMessageHandler(c,s){this.messageHandlers[c]=s}sendAsync(c,s){return new Promise((h,m)=>{const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[v]={resolve:h,reject:m},s&&s.signal.addEventListener("abort",()=>{delete this.resolveRejects[v];const M={id:v,type:"<cancel>",origin:location.origin,targetMapId:c.targetMapId,sourceMapId:this.mapId};this.target.postMessage(M)},{once:!0});const S=[],C=Object.assign(Object.assign({},c),{id:v,sourceMapId:this.mapId,origin:location.origin,data:la(c.data,S)});this.target.postMessage(C,{transfer:S})})}receive(c){const s=c.data,h=s.id;if(!(s.origin!=="file://"&&location.origin!=="file://"&&s.origin!==location.origin||s.targetMapId&&this.mapId!==s.targetMapId)){if(s.type==="<cancel>"){delete this.tasks[h];const m=this.abortControllers[h];return delete this.abortControllers[h],void(m&&m.abort())}if(Ge(self)||s.mustQueue)return this.tasks[h]=s,this.taskQueue.push(h),void this.invoker.trigger();this.processTask(h,s)}}process(){if(this.taskQueue.length===0)return;const c=this.taskQueue.shift(),s=this.tasks[c];delete this.tasks[c],this.taskQueue.length>0&&this.invoker.trigger(),s&&this.processTask(c,s)}processTask(c,s){return a(this,void 0,void 0,function*(){if(s.type==="<response>"){const v=this.resolveRejects[c];return delete this.resolveRejects[c],v?void(s.error?v.reject(ca(s.error)):v.resolve(ca(s.data))):void 0}if(!this.messageHandlers[s.type])return void this.completeTask(c,new Error(`Could not find a registered handler for ${s.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const h=ca(s.data),m=new AbortController;this.abortControllers[c]=m;try{const v=yield this.messageHandlers[s.type](s.sourceMapId,h,m);this.completeTask(c,null,v)}catch(v){this.completeTask(c,v)}})}completeTask(c,s,h){const m=[];delete this.abortControllers[c];const v={id:c,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:s?la(s):null,data:la(h,m)};this.target.postMessage(v,{transfer:m})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},u.D=rn,u.E=Ut,u.F=function(){var c=new sc(16);return sc!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},u.G=Nt,u.H=function(c,s,h){var m,v,S,C,M,P,O,H,K,re,ce,me,ve=h[0],Te=h[1],Pe=h[2];return s===c?(c[12]=s[0]*ve+s[4]*Te+s[8]*Pe+s[12],c[13]=s[1]*ve+s[5]*Te+s[9]*Pe+s[13],c[14]=s[2]*ve+s[6]*Te+s[10]*Pe+s[14],c[15]=s[3]*ve+s[7]*Te+s[11]*Pe+s[15]):(v=s[1],S=s[2],C=s[3],M=s[4],P=s[5],O=s[6],H=s[7],K=s[8],re=s[9],ce=s[10],me=s[11],c[0]=m=s[0],c[1]=v,c[2]=S,c[3]=C,c[4]=M,c[5]=P,c[6]=O,c[7]=H,c[8]=K,c[9]=re,c[10]=ce,c[11]=me,c[12]=m*ve+M*Te+K*Pe+s[12],c[13]=v*ve+P*Te+re*Pe+s[13],c[14]=S*ve+O*Te+ce*Pe+s[14],c[15]=C*ve+H*Te+me*Pe+s[15]),c},u.I=pp,u.J=function(c,s,h){var m=h[0],v=h[1],S=h[2];return c[0]=s[0]*m,c[1]=s[1]*m,c[2]=s[2]*m,c[3]=s[3]*m,c[4]=s[4]*v,c[5]=s[5]*v,c[6]=s[6]*v,c[7]=s[7]*v,c[8]=s[8]*S,c[9]=s[9]*S,c[10]=s[10]*S,c[11]=s[11]*S,c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c},u.K=s_,u.L=function(c,s){const h={};for(let m=0;m<s.length;m++){const v=s[m];v in c&&(h[v]=c[v])}return h},u.M=ma,u.N=tg,u.O=ng,u.P=y,u.Q=ko,u.R=xo,u.S=z,u.T=su,u.U=I,u.V=nt,u.W=jr,u.X=Zr,u.Y=Af,u.Z=class extends cu{},u._=a,u.a=Bt,u.a$=function(c,s,h){return c[0]=s[0]*h[0],c[1]=s[1]*h[1],c[2]=s[2]*h[2],c[3]=s[3]*h[3],c},u.a0=Sp,u.a1=vt,u.a2=c=>{const s=window.document.createElement("video");return s.muted=!0,new Promise(h=>{s.onloadstart=()=>{h(s)};for(const m of c){const v=window.document.createElement("source");Dt(m)||(s.crossOrigin="Anonymous"),v.src=m,s.appendChild(v)}})},u.a3=function(){return Y++},u.a4=x,u.a5=fc,u.a6=Ol,u.a7=$s,u.a8=wr,u.a9=lg,u.aA=ee,u.aB=function(c,s){if(!c)return[{command:"setStyle",args:[s]}];let h=[];try{if(!tt(c.version,s.version))return[{command:"setStyle",args:[s]}];tt(c.center,s.center)||h.push({command:"setCenter",args:[s.center]}),tt(c.zoom,s.zoom)||h.push({command:"setZoom",args:[s.zoom]}),tt(c.bearing,s.bearing)||h.push({command:"setBearing",args:[s.bearing]}),tt(c.pitch,s.pitch)||h.push({command:"setPitch",args:[s.pitch]}),tt(c.sprite,s.sprite)||h.push({command:"setSprite",args:[s.sprite]}),tt(c.glyphs,s.glyphs)||h.push({command:"setGlyphs",args:[s.glyphs]}),tt(c.transition,s.transition)||h.push({command:"setTransition",args:[s.transition]}),tt(c.light,s.light)||h.push({command:"setLight",args:[s.light]}),tt(c.terrain,s.terrain)||h.push({command:"setTerrain",args:[s.terrain]}),tt(c.sky,s.sky)||h.push({command:"setSky",args:[s.sky]});const m={},v=[];(function(C,M,P,O){let H;for(H in M=M||{},C=C||{})Object.prototype.hasOwnProperty.call(C,H)&&(Object.prototype.hasOwnProperty.call(M,H)||ur(H,P,O));for(H in M)Object.prototype.hasOwnProperty.call(M,H)&&(Object.prototype.hasOwnProperty.call(C,H)?tt(C[H],M[H])||(C[H].type==="geojson"&&M[H].type==="geojson"&&Ar(C,M,H)?Kt(P,{command:"setGeoJSONSourceData",args:[H,M[H].data]}):pr(H,M,P,O)):Un(H,M,P))})(c.sources,s.sources,v,m);const S=[];c.layers&&c.layers.forEach(C=>{"source"in C&&m[C.source]?h.push({command:"removeLayer",args:[C.id]}):S.push(C)}),h=h.concat(v),function(C,M,P){M=M||[];const O=(C=C||[]).map(go),H=M.map(go),K=C.reduce(hr,{}),re=M.reduce(hr,{}),ce=O.slice(),me=Object.create(null);let ve,Te,Pe,Ze,$e;for(let Ne=0,ct=0;Ne<O.length;Ne++)ve=O[Ne],Object.prototype.hasOwnProperty.call(re,ve)?ct++:(Kt(P,{command:"removeLayer",args:[ve]}),ce.splice(ce.indexOf(ve,ct),1));for(let Ne=0,ct=0;Ne<H.length;Ne++)ve=H[H.length-1-Ne],ce[ce.length-1-Ne]!==ve&&(Object.prototype.hasOwnProperty.call(K,ve)?(Kt(P,{command:"removeLayer",args:[ve]}),ce.splice(ce.lastIndexOf(ve,ce.length-ct),1)):ct++,Ze=ce[ce.length-Ne],Kt(P,{command:"addLayer",args:[re[ve],Ze]}),ce.splice(ce.length-Ne,0,ve),me[ve]=!0);for(let Ne=0;Ne<H.length;Ne++)if(ve=H[Ne],Te=K[ve],Pe=re[ve],!me[ve]&&!tt(Te,Pe))if(tt(Te.source,Pe.source)&&tt(Te["source-layer"],Pe["source-layer"])&&tt(Te.type,Pe.type)){for($e in Pr(Te.layout,Pe.layout,P,ve,null,"setLayoutProperty"),Pr(Te.paint,Pe.paint,P,ve,null,"setPaintProperty"),tt(Te.filter,Pe.filter)||Kt(P,{command:"setFilter",args:[ve,Pe.filter]}),tt(Te.minzoom,Pe.minzoom)&&tt(Te.maxzoom,Pe.maxzoom)||Kt(P,{command:"setLayerZoomRange",args:[ve,Pe.minzoom,Pe.maxzoom]}),Te)Object.prototype.hasOwnProperty.call(Te,$e)&&$e!=="layout"&&$e!=="paint"&&$e!=="filter"&&$e!=="metadata"&&$e!=="minzoom"&&$e!=="maxzoom"&&($e.indexOf("paint.")===0?Pr(Te[$e],Pe[$e],P,ve,$e.slice(6),"setPaintProperty"):tt(Te[$e],Pe[$e])||Kt(P,{command:"setLayerProperty",args:[ve,$e,Pe[$e]]}));for($e in Pe)Object.prototype.hasOwnProperty.call(Pe,$e)&&!Object.prototype.hasOwnProperty.call(Te,$e)&&$e!=="layout"&&$e!=="paint"&&$e!=="filter"&&$e!=="metadata"&&$e!=="minzoom"&&$e!=="maxzoom"&&($e.indexOf("paint.")===0?Pr(Te[$e],Pe[$e],P,ve,$e.slice(6),"setPaintProperty"):tt(Te[$e],Pe[$e])||Kt(P,{command:"setLayerProperty",args:[ve,$e,Pe[$e]]}))}else Kt(P,{command:"removeLayer",args:[ve]}),Ze=ce[ce.lastIndexOf(ve)+1],Kt(P,{command:"addLayer",args:[Pe,Ze]})}(S,s.layers,h)}catch(m){console.warn("Unable to compute style diff:",m),h=[{command:"setStyle",args:[s]}]}return h},u.aC=function(c){const s=[],h=c.id;return h===void 0&&s.push({message:`layers.${h}: missing required property "id"`}),c.render===void 0&&s.push({message:`layers.${h}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&s.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),s},u.aD=function c(s,h){if(Array.isArray(s)){if(!Array.isArray(h)||s.length!==h.length)return!1;for(let m=0;m<s.length;m++)if(!c(s[m],h[m]))return!1;return!0}if(typeof s=="object"&&s!==null&&h!==null){if(typeof h!="object"||Object.keys(s).length!==Object.keys(h).length)return!1;for(const m in s)if(!c(s[m],h[m]))return!1;return!0}return s===h},u.aE=_e,u.aF=ze,u.aG=class extends ii{constructor(c,s){super(c,s),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},u.aH=Yi,u.aI=class extends ii{constructor(c,s){super(c,s),this.current=il}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let s=1;s<16;s++)if(c[s]!==this.current[s]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},u.aJ=Vo,u.aK=class extends ii{constructor(c,s){super(c,s),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},u.aL=class extends ii{constructor(c,s){super(c,s),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},u.aM=vs,u.aN=function(c,s,h,m,v,S,C){var M=1/(s-h),P=1/(m-v),O=1/(S-C);return c[0]=-2*M,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*P,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*O,c[11]=0,c[12]=(s+h)*M,c[13]=(v+m)*P,c[14]=(C+S)*O,c[15]=1,c},u.aO=nr,u.aP=Yv,u.aQ=class extends Yl{},u.aR=Gw,u.aS=class extends Ql{},u.aT=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},u.aU=h_,u.aV=Q,u.aW=class extends mu{},u.aX=ot,u.aY=function(c,s){return c[0]===s[0]&&c[1]===s[1]&&c[2]===s[2]&&c[3]===s[3]&&c[4]===s[4]&&c[5]===s[5]&&c[6]===s[6]&&c[7]===s[7]&&c[8]===s[8]&&c[9]===s[9]&&c[10]===s[10]&&c[11]===s[11]&&c[12]===s[12]&&c[13]===s[13]&&c[14]===s[14]&&c[15]===s[15]},u.aZ=function(c,s){var h=c[0],m=c[1],v=c[2],S=c[3],C=c[4],M=c[5],P=c[6],O=c[7],H=c[8],K=c[9],re=c[10],ce=c[11],me=c[12],ve=c[13],Te=c[14],Pe=c[15],Ze=s[0],$e=s[1],Ne=s[2],ct=s[3],ft=s[4],Zt=s[5],Jt=s[6],qt=s[7],jt=s[8],zt=s[9],Wt=s[10],Ft=s[11],wt=s[12],ln=s[13],en=s[14],Dn=s[15];return Math.abs(h-Ze)<=Fi*Math.max(1,Math.abs(h),Math.abs(Ze))&&Math.abs(m-$e)<=Fi*Math.max(1,Math.abs(m),Math.abs($e))&&Math.abs(v-Ne)<=Fi*Math.max(1,Math.abs(v),Math.abs(Ne))&&Math.abs(S-ct)<=Fi*Math.max(1,Math.abs(S),Math.abs(ct))&&Math.abs(C-ft)<=Fi*Math.max(1,Math.abs(C),Math.abs(ft))&&Math.abs(M-Zt)<=Fi*Math.max(1,Math.abs(M),Math.abs(Zt))&&Math.abs(P-Jt)<=Fi*Math.max(1,Math.abs(P),Math.abs(Jt))&&Math.abs(O-qt)<=Fi*Math.max(1,Math.abs(O),Math.abs(qt))&&Math.abs(H-jt)<=Fi*Math.max(1,Math.abs(H),Math.abs(jt))&&Math.abs(K-zt)<=Fi*Math.max(1,Math.abs(K),Math.abs(zt))&&Math.abs(re-Wt)<=Fi*Math.max(1,Math.abs(re),Math.abs(Wt))&&Math.abs(ce-Ft)<=Fi*Math.max(1,Math.abs(ce),Math.abs(Ft))&&Math.abs(me-wt)<=Fi*Math.max(1,Math.abs(me),Math.abs(wt))&&Math.abs(ve-ln)<=Fi*Math.max(1,Math.abs(ve),Math.abs(ln))&&Math.abs(Te-en)<=Fi*Math.max(1,Math.abs(Te),Math.abs(en))&&Math.abs(Pe-Dn)<=Fi*Math.max(1,Math.abs(Pe),Math.abs(Dn))},u.a_=function(c,s){return c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[4]=s[4],c[5]=s[5],c[6]=s[6],c[7]=s[7],c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c},u.aa=function(c){const s={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,m,v,S)=>{const C=v||S;return s[m]=!C||C.toLowerCase(),""}),s["max-age"]){const h=parseInt(s["max-age"],10);isNaN(h)?delete s["max-age"]:s["max-age"]=h}return s},u.ab=function(c,s){const h=[];for(const m in c)m in s||h.push(m);return h},u.ac=W,u.ad=function(c,s,h){var m=Math.sin(h),v=Math.cos(h),S=s[0],C=s[1],M=s[2],P=s[3],O=s[4],H=s[5],K=s[6],re=s[7];return s!==c&&(c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[0]=S*v+O*m,c[1]=C*v+H*m,c[2]=M*v+K*m,c[3]=P*v+re*m,c[4]=O*v-S*m,c[5]=H*v-C*m,c[6]=K*v-M*m,c[7]=re*v-P*m,c},u.ae=function(c){var s=new sc(16);return s[0]=c[0],s[1]=c[1],s[2]=c[2],s[3]=c[3],s[4]=c[4],s[5]=c[5],s[6]=c[6],s[7]=c[7],s[8]=c[8],s[9]=c[9],s[10]=c[10],s[11]=c[11],s[12]=c[12],s[13]=c[13],s[14]=c[14],s[15]=c[15],s},u.af=vf,u.ag=function(c,s){let h=0,m=0;if(c.kind==="constant")m=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:v,minZoom:S,maxZoom:C}=c,M=v?W(vi.interpolationFactor(v,s,S,C),0,1):0;c.kind==="camera"?m=Ti.number(c.minSize,c.maxSize,M):h=M}return{uSizeT:h,uSize:m}},u.ai=function(c,{uSize:s,uSizeT:h},{lowerSize:m,upperSize:v}){return c.kind==="source"?m/ks:c.kind==="composite"?Ti.number(m/ks,v/ks,h):s},u.aj=yp,u.ak=function(c,s,h,m){const v=s.y-c.y,S=s.x-c.x,C=m.y-h.y,M=m.x-h.x,P=C*S-M*v;if(P===0)return null;const O=(M*(c.y-h.y)-C*(c.x-h.x))/P;return new y(c.x+O*S,c.y+O*v)},u.al=fg,u.am=gu,u.an=Jd,u.ao=oi,u.aq=gp,u.ar=function(c,s){var h=s[0],m=s[1],v=s[2],S=s[3],C=s[4],M=s[5],P=s[6],O=s[7],H=s[8],K=s[9],re=s[10],ce=s[11],me=s[12],ve=s[13],Te=s[14],Pe=s[15],Ze=h*M-m*C,$e=h*P-v*C,Ne=h*O-S*C,ct=m*P-v*M,ft=m*O-S*M,Zt=v*O-S*P,Jt=H*ve-K*me,qt=H*Te-re*me,jt=H*Pe-ce*me,zt=K*Te-re*ve,Wt=K*Pe-ce*ve,Ft=re*Pe-ce*Te,wt=Ze*Ft-$e*Wt+Ne*zt+ct*jt-ft*qt+Zt*Jt;return wt?(c[0]=(M*Ft-P*Wt+O*zt)*(wt=1/wt),c[1]=(v*Wt-m*Ft-S*zt)*wt,c[2]=(ve*Zt-Te*ft+Pe*ct)*wt,c[3]=(re*ft-K*Zt-ce*ct)*wt,c[4]=(P*jt-C*Ft-O*qt)*wt,c[5]=(h*Ft-v*jt+S*qt)*wt,c[6]=(Te*Ne-me*Zt-Pe*$e)*wt,c[7]=(H*Zt-re*Ne+ce*$e)*wt,c[8]=(C*Wt-M*jt+O*Jt)*wt,c[9]=(m*jt-h*Wt-S*Jt)*wt,c[10]=(me*ft-ve*Ne+Pe*Ze)*wt,c[11]=(K*Ne-H*ft-ce*Ze)*wt,c[12]=(M*qt-C*zt-P*Jt)*wt,c[13]=(h*zt-m*qt+v*Jt)*wt,c[14]=(ve*$e-me*ct-Te*Ze)*wt,c[15]=(H*ct-K*$e+re*Ze)*wt,c):null},u.as=Tp,u.at=_p,u.au=Mp,u.av=function(){const c={},s=ye.$version;for(const h in ye.$root){const m=ye.$root[h];if(m.required){let v=null;v=h==="version"?s:m.type==="array"?[]:{},v!=null&&(c[h]=v)}}return c},u.aw=sf,u.ax=Qt,u.ay=function(c){c=c.slice();const s=Object.create(null);for(let h=0;h<c.length;h++)s[c[h].id]=c[h];for(let h=0;h<c.length;h++)"ref"in c[h]&&(c[h]=Oe(c[h],s[c[h].ref]));return c},u.az=function(c){if(c.type==="custom")return new g2(c);switch(c.type){case"background":return new p2(c);case"circle":return new Qv(c);case"fill":return new bw(c);case"fill-extrusion":return new Dw(c);case"heatmap":return new tw(c);case"hillshade":return new rw(c);case"line":return new Uw(c);case"raster":return new _2(c);case"symbol":return new If(c)}},u.b=De,u.b0=function(c,s){return c[0]*s[0]+c[1]*s[1]+c[2]*s[2]+c[3]*s[3]},u.b1=se,u.b2=og,u.b3=rg,u.b4=function(c,s,h,m,v){var S,C=1/Math.tan(s/2);return c[0]=C/h,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=C,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,v!=null&&v!==1/0?(c[10]=(v+m)*(S=1/(m-v)),c[14]=2*v*m*S):(c[10]=-1,c[14]=-2*m),c},u.b5=function(c,s,h){var m=Math.sin(h),v=Math.cos(h),S=s[4],C=s[5],M=s[6],P=s[7],O=s[8],H=s[9],K=s[10],re=s[11];return s!==c&&(c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[4]=S*v+O*m,c[5]=C*v+H*m,c[6]=M*v+K*m,c[7]=P*v+re*m,c[8]=O*v-S*m,c[9]=H*v-C*m,c[10]=K*v-M*m,c[11]=re*v-P*m,c},u.b6=F,u.b7=N,u.b8=function(c){return c*Math.PI/180},u.b9=function(c,s){return c[0]=s[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=s[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=s[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},u.bA=bs,u.ba=class extends es{},u.bb=xp,u.bc=L2,u.be=Mt,u.bf=function(c,s){Bt.REGISTERED_PROTOCOLS[c]=s},u.bg=function(c){delete Bt.REGISTERED_PROTOCOLS[c]},u.bh=function(c,s){const h={};for(let v=0;v<c.length;v++){const S=s&&s[c[v].id]||Gd(c[v]);s&&(s[c[v].id]=S);let C=h[S];C||(C=h[S]=[]),C.push(c[v])}const m=[];for(const v in h)m.push(h[v]);return m},u.bi=Ht,u.bj=ag,u.bk=cg,u.bl=j_,u.bm=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=jr/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const s=c.bucket.layers[0],h=s.layout,m=s._unevaluatedLayout._values,v={layoutIconSize:m["icon-size"].possiblyEvaluate(new wr(c.bucket.zoom+1),c.canonical),layoutTextSize:m["text-size"].possiblyEvaluate(new wr(c.bucket.zoom+1),c.canonical),textMaxSize:m["text-size"].possiblyEvaluate(new wr(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:O,maxZoom:H}=c.bucket.textSizeData;v.compositeTextSizes=[m["text-size"].possiblyEvaluate(new wr(O),c.canonical),m["text-size"].possiblyEvaluate(new wr(H),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:O,maxZoom:H}=c.bucket.iconSizeData;v.compositeIconSizes=[m["icon-size"].possiblyEvaluate(new wr(O),c.canonical),m["icon-size"].possiblyEvaluate(new wr(H),c.canonical)]}const S=h.get("text-line-height")*oi,C=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point",M=h.get("text-keep-upright"),P=h.get("text-size");for(const O of c.bucket.features){const H=h.get("text-font").evaluate(O,{},c.canonical).join(","),K=P.evaluate(O,{},c.canonical),re=v.layoutTextSize.evaluate(O,{},c.canonical),ce=v.layoutIconSize.evaluate(O,{},c.canonical),me={horizontal:{},vertical:void 0},ve=O.text;let Te,Pe=[0,0];if(ve){const Ne=ve.toString(),ct=h.get("text-letter-spacing").evaluate(O,{},c.canonical)*oi,ft=af(Ne)?ct:0,Zt=h.get("text-anchor").evaluate(O,{},c.canonical),Jt=wg(s,O,c.canonical);if(!Jt){const Ft=h.get("text-radial-offset").evaluate(O,{},c.canonical);Pe=Ft?vg(Zt,[Ft*oi,Cp]):h.get("text-offset").evaluate(O,{},c.canonical).map(wt=>wt*oi)}let qt=C?"center":h.get("text-justify").evaluate(O,{},c.canonical);const jt=h.get("symbol-placement"),zt=jt==="point"?h.get("text-max-width").evaluate(O,{},c.canonical)*oi:0,Wt=()=>{c.bucket.allowVerticalPlacement&&ua(Ne)&&(me.vertical=Mf(ve,c.glyphMap,c.glyphPositions,c.imagePositions,H,zt,S,Zt,"left",ft,Pe,u.ah.vertical,!0,jt,re,K))};if(!C&&Jt){const Ft=new Set;if(qt==="auto")for(let ln=0;ln<Jt.values.length;ln+=2)Ft.add(Tp(Jt.values[ln]));else Ft.add(qt);let wt=!1;for(const ln of Ft)if(!me.horizontal[ln])if(wt)me.horizontal[ln]=me.horizontal[0];else{const en=Mf(ve,c.glyphMap,c.glyphPositions,c.imagePositions,H,zt,S,"center",ln,ft,Pe,u.ah.horizontal,!1,jt,re,K);en&&(me.horizontal[ln]=en,wt=en.positionedLines.length===1)}Wt()}else{qt==="auto"&&(qt=Tp(Zt));const Ft=Mf(ve,c.glyphMap,c.glyphPositions,c.imagePositions,H,zt,S,Zt,qt,ft,Pe,u.ah.horizontal,!1,jt,re,K);Ft&&(me.horizontal[qt]=Ft),Wt(),ua(Ne)&&C&&M&&(me.vertical=Mf(ve,c.glyphMap,c.glyphPositions,c.imagePositions,H,zt,S,Zt,qt,ft,Pe,u.ah.vertical,!1,jt,re,K))}}let Ze=!1;if(O.icon&&O.icon.name){const Ne=c.imageMap[O.icon.name];Ne&&(Te=c2(c.imagePositions[O.icon.name],h.get("icon-offset").evaluate(O,{},c.canonical),h.get("icon-anchor").evaluate(O,{},c.canonical)),Ze=!!Ne.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=Ze:c.bucket.sdfIcons!==Ze&&Ee("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ne.pixelRatio!==c.bucket.pixelRatio||h.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const $e=kg(me.horizontal)||me.vertical;c.bucket.iconsInText=!!$e&&$e.iconsInText,($e||Te)&&T2(c.bucket,O,me,Te,c.imageMap,v,re,ce,Pe,Ze,c.canonical)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},u.bn=up,u.bo=ap,u.bp=cp,u.bq=fa,u.br=fp,u.bs=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},u.bt=function(c,s,h,m,v){return a(this,void 0,void 0,function*(){if(I())try{return yield nt(c,s,h,m,v)}catch{}return function(S,C,M,P,O){const H=S.width,K=S.height;lt&&mt||(lt=new OffscreenCanvas(H,K),mt=lt.getContext("2d",{willReadFrequently:!0})),lt.width=H,lt.height=K,mt.drawImage(S,0,0,H,K);const re=mt.getImageData(C,M,P,O);return mt.clearRect(0,0,H,K),re.data}(c,s,h,m,v)})},u.bu=sg,u.bv=d,u.bw=p,u.bx=P_,u.by=Is,u.bz=function(c){return c.message===ht},u.c=We,u.d=c=>a(void 0,void 0,void 0,function*(){if(c.byteLength===0)return createImageBitmap(new ImageData(1,1));const s=new Blob([new Uint8Array(c)],{type:"image/png"});try{return createImageBitmap(s)}catch(h){throw new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),u.e=J,u.f=c=>new Promise((s,h)=>{const m=new Image;m.onload=()=>{s(m),URL.revokeObjectURL(m.src),m.onload=null,window.requestAnimationFrame(()=>{m.src=Ct})},m.onerror=()=>h(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const v=new Blob([new Uint8Array(c)],{type:"image/png"});m.src=c.byteLength?URL.createObjectURL(v):Ct}),u.g=Lt,u.h=(c,s)=>bt(J(c,{type:"json"}),s),u.i=Ge,u.j=kt,u.k=Ve,u.l=(c,s)=>bt(J(c,{type:"arrayBuffer"}),s),u.m=bt,u.n=function(c){return new fp(c).readFields(r2,[])},u.o=ku,u.p=N_,u.q=$i,u.r=Hd,u.s=Dt,u.t=aa,u.u=Vt,u.v=ye,u.w=Ee,u.x=Ps,u.y=function([c,s,h]){return s+=90,s*=Math.PI/180,h*=Math.PI/180,{x:c*Math.cos(s)*Math.sin(h),y:c*Math.sin(s)*Math.sin(h),z:c*Math.cos(h)}},u.z=Ti}),i("worker",["./shared"],function(u){class a{constructor(te){this.keyCache={},te&&this.replace(te)}replace(te){this._layerConfigs={},this._layers={},this.update(te,[])}update(te,ie){for(const ge of te){this._layerConfigs[ge.id]=ge;const Ae=this._layers[ge.id]=u.az(ge);Ae._featureFilter=u.a6(Ae.filter),this.keyCache[ge.id]&&delete this.keyCache[ge.id]}for(const ge of ie)delete this.keyCache[ge],delete this._layerConfigs[ge],delete this._layers[ge];this.familiesBySource={};const le=u.bh(Object.values(this._layerConfigs),this.keyCache);for(const ge of le){const Ae=ge.map(Xe=>this._layers[Xe.id]),Be=Ae[0];if(Be.visibility==="none")continue;const je=Be.source||"";let Re=this.familiesBySource[je];Re||(Re=this.familiesBySource[je]={});const ne=Be.sourceLayer||"_geojsonTileLayer";let He=Re[ne];He||(He=Re[ne]=[]),He.push(Ae)}}}class d{constructor(te){const ie={},le=[];for(const je in te){const Re=te[je],ne=ie[je]={};for(const He in Re){const Xe=Re[+He];if(!Xe||Xe.bitmap.width===0||Xe.bitmap.height===0)continue;const Ye={x:0,y:0,w:Xe.bitmap.width+2,h:Xe.bitmap.height+2};le.push(Ye),ne[He]={rect:Ye,metrics:Xe.metrics}}}const{w:ge,h:Ae}=u.p(le),Be=new u.o({width:ge||1,height:Ae||1});for(const je in te){const Re=te[je];for(const ne in Re){const He=Re[+ne];if(!He||He.bitmap.width===0||He.bitmap.height===0)continue;const Xe=ie[je][ne].rect;u.o.copy(He.bitmap,Be,{x:0,y:0},{x:Xe.x+1,y:Xe.y+1},He.bitmap)}}this.image=Be,this.positions=ie}}u.bi("GlyphAtlas",d);class p{constructor(te){this.tileID=new u.Q(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.uid=te.uid,this.zoom=te.zoom,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=te.showCollisionBoxes,this.collectResourceTiming=!!te.collectResourceTiming,this.returnDependencies=!!te.returnDependencies,this.promoteId=te.promoteId,this.inFlightDependencies=[]}parse(te,ie,le,ge){return u._(this,void 0,void 0,function*(){this.status="parsing",this.data=te,this.collisionBoxArray=new u.a4;const Ae=new u.bj(Object.keys(te.layers).sort()),Be=new u.bk(this.tileID,this.promoteId);Be.bucketLayerIDs=[];const je={},Re={featureIndex:Be,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:le},ne=ie.familiesBySource[this.source];for(const wn in ne){const zr=te.layers[wn];if(!zr)continue;zr.version===1&&u.w(`Vector tile source "${this.source}" layer "${wn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ni=Ae.encode(wn),Ci=[];for(let zi=0;zi<zr.length;zi++){const di=zr.feature(zi),Bo=Be.getId(di,wn);Ci.push({feature:di,id:Bo,index:zi,sourceLayerIndex:ni})}for(const zi of ne[wn]){const di=zi[0];di.source!==this.source&&u.w(`layer.source = ${di.source} does not equal this.source = ${this.source}`),di.minzoom&&this.zoom<Math.floor(di.minzoom)||di.maxzoom&&this.zoom>=di.maxzoom||di.visibility!=="none"&&(g(zi,this.zoom,le),(je[di.id]=di.createBucket({index:Be.bucketLayerIDs.length,layers:zi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ni,sourceID:this.source})).populate(Ci,Re,this.tileID.canonical),Be.bucketLayerIDs.push(zi.map(Bo=>Bo.id)))}}const He=u.aE(Re.glyphDependencies,wn=>Object.keys(wn).map(Number));this.inFlightDependencies.forEach(wn=>wn==null?void 0:wn.abort()),this.inFlightDependencies=[];let Xe=Promise.resolve({});if(Object.keys(He).length){const wn=new AbortController;this.inFlightDependencies.push(wn),Xe=ge.sendAsync({type:"GG",data:{stacks:He,source:this.source,tileID:this.tileID,type:"glyphs"}},wn)}const Ye=Object.keys(Re.iconDependencies);let at=Promise.resolve({});if(Ye.length){const wn=new AbortController;this.inFlightDependencies.push(wn),at=ge.sendAsync({type:"GI",data:{icons:Ye,source:this.source,tileID:this.tileID,type:"icons"}},wn)}const Tt=Object.keys(Re.patternDependencies);let Xt=Promise.resolve({});if(Tt.length){const wn=new AbortController;this.inFlightDependencies.push(wn),Xt=ge.sendAsync({type:"GI",data:{icons:Tt,source:this.source,tileID:this.tileID,type:"patterns"}},wn)}const[hn,vn,Fn]=yield Promise.all([Xe,at,Xt]),vr=new d(hn),Hr=new u.bl(vn,Fn);for(const wn in je){const zr=je[wn];zr instanceof u.a5?(g(zr.layers,this.zoom,le),u.bm({bucket:zr,glyphMap:hn,glyphPositions:vr.positions,imageMap:vn,imagePositions:Hr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):zr.hasPattern&&(zr instanceof u.bn||zr instanceof u.bo||zr instanceof u.bp)&&(g(zr.layers,this.zoom,le),zr.addFeatures(Re,this.tileID.canonical,Hr.patternPositions))}return this.status="done",{buckets:Object.values(je).filter(wn=>!wn.isEmpty()),featureIndex:Be,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:vr.image,imageAtlas:Hr,glyphMap:this.returnDependencies?hn:null,iconMap:this.returnDependencies?vn:null,glyphPositions:this.returnDependencies?vr.positions:null}})}}function g(Ce,te,ie){const le=new u.a8(te);for(const ge of Ce)ge.recalculate(le,ie)}class y{constructor(te,ie,le){this.actor=te,this.layerIndex=ie,this.availableImages=le,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(te,ie){return u._(this,void 0,void 0,function*(){const le=yield u.l(te.request,ie);try{return{vectorTile:new u.bq.VectorTile(new u.br(le.data)),rawData:le.data,cacheControl:le.cacheControl,expires:le.expires}}catch(ge){const Ae=new Uint8Array(le.data);let Be=`Unable to parse the tile at ${te.request.url}, `;throw Be+=Ae[0]===31&&Ae[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ge.messge}`,new Error(Be)}})}loadTile(te){return u._(this,void 0,void 0,function*(){const ie=te.uid,le=!!(te&&te.request&&te.request.collectResourceTiming)&&new u.bs(te.request),ge=new p(te);this.loading[ie]=ge;const Ae=new AbortController;ge.abort=Ae;try{const Be=yield this.loadVectorTile(te,Ae);if(delete this.loading[ie],!Be)return null;const je=Be.rawData,Re={};Be.expires&&(Re.expires=Be.expires),Be.cacheControl&&(Re.cacheControl=Be.cacheControl);const ne={};if(le){const Xe=le.finish();Xe&&(ne.resourceTiming=JSON.parse(JSON.stringify(Xe)))}ge.vectorTile=Be.vectorTile;const He=ge.parse(Be.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[ie]=ge,this.fetching[ie]={rawTileData:je,cacheControl:Re,resourceTiming:ne};try{const Xe=yield He;return u.e({rawTileData:je.slice(0)},Xe,Re,ne)}finally{delete this.fetching[ie]}}catch(Be){throw delete this.loading[ie],ge.status="done",this.loaded[ie]=ge,Be}})}reloadTile(te){return u._(this,void 0,void 0,function*(){const ie=te.uid;if(!this.loaded||!this.loaded[ie])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const le=this.loaded[ie];if(le.showCollisionBoxes=te.showCollisionBoxes,le.status==="parsing"){const ge=yield le.parse(le.vectorTile,this.layerIndex,this.availableImages,this.actor);let Ae;if(this.fetching[ie]){const{rawTileData:Be,cacheControl:je,resourceTiming:Re}=this.fetching[ie];delete this.fetching[ie],Ae=u.e({rawTileData:Be.slice(0)},ge,je,Re)}else Ae=ge;return Ae}if(le.status==="done"&&le.vectorTile)return le.parse(le.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(te){return u._(this,void 0,void 0,function*(){const ie=this.loading,le=te.uid;ie&&ie[le]&&ie[le].abort&&(ie[le].abort.abort(),delete ie[le])})}removeTile(te){return u._(this,void 0,void 0,function*(){this.loaded&&this.loaded[te.uid]&&delete this.loaded[te.uid]})}}class w{constructor(){this.loaded={}}loadTile(te){return u._(this,void 0,void 0,function*(){const{uid:ie,encoding:le,rawImageData:ge,redFactor:Ae,greenFactor:Be,blueFactor:je,baseShift:Re}=te,ne=ge.width+2,He=ge.height+2,Xe=u.b(ge)?new u.R({width:ne,height:He},yield u.bt(ge,-1,-1,ne,He)):ge,Ye=new u.bu(ie,Xe,le,Ae,Be,je,Re);return this.loaded=this.loaded||{},this.loaded[ie]=Ye,Ye})}removeTile(te){const ie=this.loaded,le=te.uid;ie&&ie[le]&&delete ie[le]}}function T(Ce,te){if(Ce.length!==0){L(Ce[0],te);for(var ie=1;ie<Ce.length;ie++)L(Ce[ie],!te)}}function L(Ce,te){for(var ie=0,le=0,ge=0,Ae=Ce.length,Be=Ae-1;ge<Ae;Be=ge++){var je=(Ce[ge][0]-Ce[Be][0])*(Ce[Be][1]+Ce[ge][1]),Re=ie+je;le+=Math.abs(ie)>=Math.abs(je)?ie-Re+je:je-Re+ie,ie=Re}ie+le>=0!=!!te&&Ce.reverse()}var D=u.bv(function Ce(te,ie){var le,ge=te&&te.type;if(ge==="FeatureCollection")for(le=0;le<te.features.length;le++)Ce(te.features[le],ie);else if(ge==="GeometryCollection")for(le=0;le<te.geometries.length;le++)Ce(te.geometries[le],ie);else if(ge==="Feature")Ce(te.geometry,ie);else if(ge==="Polygon")T(te.coordinates,ie);else if(ge==="MultiPolygon")for(le=0;le<te.coordinates.length;le++)T(te.coordinates[le],ie);return te});const R=u.bq.VectorTileFeature.prototype.toGeoJSON;var z={exports:{}},I=u.bw,F=u.bq.VectorTileFeature,N=W;function W(Ce,te){this.options=te||{},this.features=Ce,this.length=Ce.length}function se(Ce,te){this.id=typeof Ce.id=="number"?Ce.id:void 0,this.type=Ce.type,this.rawGeometry=Ce.type===1?[Ce.geometry]:Ce.geometry,this.properties=Ce.tags,this.extent=te||4096}W.prototype.feature=function(Ce){return new se(this.features[Ce],this.options.extent)},se.prototype.loadGeometry=function(){var Ce=this.rawGeometry;this.geometry=[];for(var te=0;te<Ce.length;te++){for(var ie=Ce[te],le=[],ge=0;ge<ie.length;ge++)le.push(new I(ie[ge][0],ie[ge][1]));this.geometry.push(le)}return this.geometry},se.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ce=this.geometry,te=1/0,ie=-1/0,le=1/0,ge=-1/0,Ae=0;Ae<Ce.length;Ae++)for(var Be=Ce[Ae],je=0;je<Be.length;je++){var Re=Be[je];te=Math.min(te,Re.x),ie=Math.max(ie,Re.x),le=Math.min(le,Re.y),ge=Math.max(ge,Re.y)}return[te,le,ie,ge]},se.prototype.toGeoJSON=F.prototype.toGeoJSON;var J=u.bx,Y=N;function _e(Ce){var te=new J;return function(ie,le){for(var ge in ie.layers)le.writeMessage(3,ze,ie.layers[ge])}(Ce,te),te.finish()}function ze(Ce,te){var ie;te.writeVarintField(15,Ce.version||1),te.writeStringField(1,Ce.name||""),te.writeVarintField(5,Ce.extent||4096);var le={keys:[],values:[],keycache:{},valuecache:{}};for(ie=0;ie<Ce.length;ie++)le.feature=Ce.feature(ie),te.writeMessage(2,ee,le);var ge=le.keys;for(ie=0;ie<ge.length;ie++)te.writeStringField(3,ge[ie]);var Ae=le.values;for(ie=0;ie<Ae.length;ie++)te.writeMessage(4,Ge,Ae[ie])}function ee(Ce,te){var ie=Ce.feature;ie.id!==void 0&&te.writeVarintField(1,ie.id),te.writeMessage(2,ae,Ce),te.writeVarintField(3,ie.type),te.writeMessage(4,it,ie)}function ae(Ce,te){var ie=Ce.feature,le=Ce.keys,ge=Ce.values,Ae=Ce.keycache,Be=Ce.valuecache;for(var je in ie.properties){var Re=ie.properties[je],ne=Ae[je];if(Re!==null){ne===void 0&&(le.push(je),Ae[je]=ne=le.length-1),te.writeVarint(ne);var He=typeof Re;He!=="string"&&He!=="boolean"&&He!=="number"&&(Re=JSON.stringify(Re));var Xe=He+":"+Re,Ye=Be[Xe];Ye===void 0&&(ge.push(Re),Be[Xe]=Ye=ge.length-1),te.writeVarint(Ye)}}}function Ee(Ce,te){return(te<<3)+(7&Ce)}function we(Ce){return Ce<<1^Ce>>31}function it(Ce,te){for(var ie=Ce.loadGeometry(),le=Ce.type,ge=0,Ae=0,Be=ie.length,je=0;je<Be;je++){var Re=ie[je],ne=1;le===1&&(ne=Re.length),te.writeVarint(Ee(1,ne));for(var He=le===3?Re.length-1:Re.length,Xe=0;Xe<He;Xe++){Xe===1&&le!==1&&te.writeVarint(Ee(2,He-1));var Ye=Re[Xe].x-ge,at=Re[Xe].y-Ae;te.writeVarint(we(Ye)),te.writeVarint(we(at)),ge+=Ye,Ae+=at}le===3&&te.writeVarint(Ee(7,1))}}function Ge(Ce,te){var ie=typeof Ce;ie==="string"?te.writeStringField(1,Ce):ie==="boolean"?te.writeBooleanField(7,Ce):ie==="number"&&(Ce%1!=0?te.writeDoubleField(3,Ce):Ce<0?te.writeSVarintField(6,Ce):te.writeVarintField(5,Ce))}z.exports=_e,z.exports.fromVectorTileJs=_e,z.exports.fromGeojsonVt=function(Ce,te){te=te||{};var ie={};for(var le in Ce)ie[le]=new Y(Ce[le].features,te),ie[le].name=le,ie[le].version=te.version,ie[le].extent=te.extent;return _e({layers:ie})},z.exports.GeoJSONWrapper=Y;var Ie=u.bv(z.exports);const De={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ce=>Ce},Ct=Math.fround||(nt=new Float32Array(1),Ce=>(nt[0]=+Ce,nt[0]));var nt;const lt=3,mt=5,ht=6;class We{constructor(te){this.options=Object.assign(Object.create(De),te),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(te){const{log:ie,minZoom:le,maxZoom:ge}=this.options;ie&&console.time("total time");const Ae=`prepare ${te.length} points`;ie&&console.time(Ae),this.points=te;const Be=[];for(let Re=0;Re<te.length;Re++){const ne=te[Re];if(!ne.geometry)continue;const[He,Xe]=ne.geometry.coordinates,Ye=Ct(Nt(He)),at=Ct(Mt(Xe));Be.push(Ye,at,1/0,Re,-1,1),this.options.reduce&&Be.push(0)}let je=this.trees[ge+1]=this._createTree(Be);ie&&console.timeEnd(Ae);for(let Re=ge;Re>=le;Re--){const ne=+Date.now();je=this.trees[Re]=this._createTree(this._cluster(je,Re)),ie&&console.log("z%d: %d clusters in %dms",Re,je.numItems,+Date.now()-ne)}return ie&&console.timeEnd("total time"),this}getClusters(te,ie){let le=((te[0]+180)%360+360)%360-180;const ge=Math.max(-90,Math.min(90,te[1]));let Ae=te[2]===180?180:((te[2]+180)%360+360)%360-180;const Be=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)le=-180,Ae=180;else if(le>Ae){const Xe=this.getClusters([le,ge,180,Be],ie),Ye=this.getClusters([-180,ge,Ae,Be],ie);return Xe.concat(Ye)}const je=this.trees[this._limitZoom(ie)],Re=je.range(Nt(le),Mt(Be),Nt(Ae),Mt(ge)),ne=je.data,He=[];for(const Xe of Re){const Ye=this.stride*Xe;He.push(ne[Ye+mt]>1?Bt(ne,Ye,this.clusterProps):this.points[ne[Ye+lt]])}return He}getChildren(te){const ie=this._getOriginId(te),le=this._getOriginZoom(te),ge="No cluster with the specified id.",Ae=this.trees[le];if(!Ae)throw new Error(ge);const Be=Ae.data;if(ie*this.stride>=Be.length)throw new Error(ge);const je=this.options.radius/(this.options.extent*Math.pow(2,le-1)),Re=Ae.within(Be[ie*this.stride],Be[ie*this.stride+1],je),ne=[];for(const He of Re){const Xe=He*this.stride;Be[Xe+4]===te&&ne.push(Be[Xe+mt]>1?Bt(Be,Xe,this.clusterProps):this.points[Be[Xe+lt]])}if(ne.length===0)throw new Error(ge);return ne}getLeaves(te,ie,le){const ge=[];return this._appendLeaves(ge,te,ie=ie||10,le=le||0,0),ge}getTile(te,ie,le){const ge=this.trees[this._limitZoom(te)],Ae=Math.pow(2,te),{extent:Be,radius:je}=this.options,Re=je/Be,ne=(le-Re)/Ae,He=(le+1+Re)/Ae,Xe={features:[]};return this._addTileFeatures(ge.range((ie-Re)/Ae,ne,(ie+1+Re)/Ae,He),ge.data,ie,le,Ae,Xe),ie===0&&this._addTileFeatures(ge.range(1-Re/Ae,ne,1,He),ge.data,Ae,le,Ae,Xe),ie===Ae-1&&this._addTileFeatures(ge.range(0,ne,Re/Ae,He),ge.data,-1,le,Ae,Xe),Xe.features.length?Xe:null}getClusterExpansionZoom(te){let ie=this._getOriginZoom(te)-1;for(;ie<=this.options.maxZoom;){const le=this.getChildren(te);if(ie++,le.length!==1)break;te=le[0].properties.cluster_id}return ie}_appendLeaves(te,ie,le,ge,Ae){const Be=this.getChildren(ie);for(const je of Be){const Re=je.properties;if(Re&&Re.cluster?Ae+Re.point_count<=ge?Ae+=Re.point_count:Ae=this._appendLeaves(te,Re.cluster_id,le,ge,Ae):Ae<ge?Ae++:te.push(je),te.length===le)break}return Ae}_createTree(te){const ie=new u.au(te.length/this.stride|0,this.options.nodeSize,Float32Array);for(let le=0;le<te.length;le+=this.stride)ie.add(te[le],te[le+1]);return ie.finish(),ie.data=te,ie}_addTileFeatures(te,ie,le,ge,Ae,Be){for(const je of te){const Re=je*this.stride,ne=ie[Re+mt]>1;let He,Xe,Ye;if(ne)He=Lt(ie,Re,this.clusterProps),Xe=ie[Re],Ye=ie[Re+1];else{const Xt=this.points[ie[Re+lt]];He=Xt.properties;const[hn,vn]=Xt.geometry.coordinates;Xe=Nt(hn),Ye=Mt(vn)}const at={type:1,geometry:[[Math.round(this.options.extent*(Xe*Ae-le)),Math.round(this.options.extent*(Ye*Ae-ge))]],tags:He};let Tt;Tt=ne||this.options.generateId?ie[Re+lt]:this.points[ie[Re+lt]].id,Tt!==void 0&&(at.id=Tt),Be.features.push(at)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(Math.floor(+te),this.options.maxZoom+1))}_cluster(te,ie){const{radius:le,extent:ge,reduce:Ae,minPoints:Be}=this.options,je=le/(ge*Math.pow(2,ie)),Re=te.data,ne=[],He=this.stride;for(let Xe=0;Xe<Re.length;Xe+=He){if(Re[Xe+2]<=ie)continue;Re[Xe+2]=ie;const Ye=Re[Xe],at=Re[Xe+1],Tt=te.within(Re[Xe],Re[Xe+1],je),Xt=Re[Xe+mt];let hn=Xt;for(const vn of Tt){const Fn=vn*He;Re[Fn+2]>ie&&(hn+=Re[Fn+mt])}if(hn>Xt&&hn>=Be){let vn,Fn=Ye*Xt,vr=at*Xt,Hr=-1;const wn=((Xe/He|0)<<5)+(ie+1)+this.points.length;for(const zr of Tt){const ni=zr*He;if(Re[ni+2]<=ie)continue;Re[ni+2]=ie;const Ci=Re[ni+mt];Fn+=Re[ni]*Ci,vr+=Re[ni+1]*Ci,Re[ni+4]=wn,Ae&&(vn||(vn=this._map(Re,Xe,!0),Hr=this.clusterProps.length,this.clusterProps.push(vn)),Ae(vn,this._map(Re,ni)))}Re[Xe+4]=wn,ne.push(Fn/hn,vr/hn,1/0,wn,-1,hn),Ae&&ne.push(Hr)}else{for(let vn=0;vn<He;vn++)ne.push(Re[Xe+vn]);if(hn>1)for(const vn of Tt){const Fn=vn*He;if(!(Re[Fn+2]<=ie)){Re[Fn+2]=ie;for(let vr=0;vr<He;vr++)ne.push(Re[Fn+vr])}}}}return ne}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,ie,le){if(te[ie+mt]>1){const Be=this.clusterProps[te[ie+ht]];return le?Object.assign({},Be):Be}const ge=this.points[te[ie+lt]].properties,Ae=this.options.map(ge);return le&&Ae===ge?Object.assign({},Ae):Ae}}function Bt(Ce,te,ie){return{type:"Feature",id:Ce[te+lt],properties:Lt(Ce,te,ie),geometry:{type:"Point",coordinates:[(le=Ce[te],360*(le-.5)),Qt(Ce[te+1])]}};var le}function Lt(Ce,te,ie){const le=Ce[te+mt],ge=le>=1e4?`${Math.round(le/1e3)}k`:le>=1e3?Math.round(le/100)/10+"k":le,Ae=Ce[te+ht],Be=Ae===-1?{}:Object.assign({},ie[Ae]);return Object.assign(Be,{cluster:!0,cluster_id:Ce[te+lt],point_count:le,point_count_abbreviated:ge})}function Nt(Ce){return Ce/360+.5}function Mt(Ce){const te=Math.sin(Ce*Math.PI/180),ie=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return ie<0?0:ie>1?1:ie}function Qt(Ce){const te=(180-360*Ce)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}function bt(Ce,te,ie,le){for(var ge,Ae=le,Be=ie-te>>1,je=ie-te,Re=Ce[te],ne=Ce[te+1],He=Ce[ie],Xe=Ce[ie+1],Ye=te+3;Ye<ie;Ye+=3){var at=Dt(Ce[Ye],Ce[Ye+1],Re,ne,He,Xe);if(at>Ae)ge=Ye,Ae=at;else if(at===Ae){var Tt=Math.abs(Ye-Be);Tt<je&&(ge=Ye,je=Tt)}}Ae>le&&(ge-te>3&&bt(Ce,te,ge,le),Ce[ge+2]=Ae,ie-ge>3&&bt(Ce,ge,ie,le))}function Dt(Ce,te,ie,le,ge,Ae){var Be=ge-ie,je=Ae-le;if(Be!==0||je!==0){var Re=((Ce-ie)*Be+(te-le)*je)/(Be*Be+je*je);Re>1?(ie=ge,le=Ae):Re>0&&(ie+=Be*Re,le+=je*Re)}return(Be=Ce-ie)*Be+(je=te-le)*je}function pn(Ce,te,ie,le){var ge={id:Ce===void 0?null:Ce,type:te,geometry:ie,tags:le,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ae){var Be=Ae.geometry,je=Ae.type;if(je==="Point"||je==="MultiPoint"||je==="LineString")qe(Ae,Be);else if(je==="Polygon"||je==="MultiLineString")for(var Re=0;Re<Be.length;Re++)qe(Ae,Be[Re]);else if(je==="MultiPolygon")for(Re=0;Re<Be.length;Re++)for(var ne=0;ne<Be[Re].length;ne++)qe(Ae,Be[Re][ne])}(ge),ge}function qe(Ce,te){for(var ie=0;ie<te.length;ie+=3)Ce.minX=Math.min(Ce.minX,te[ie]),Ce.minY=Math.min(Ce.minY,te[ie+1]),Ce.maxX=Math.max(Ce.maxX,te[ie]),Ce.maxY=Math.max(Ce.maxY,te[ie+1])}function Ve(Ce,te,ie,le){if(te.geometry){var ge=te.geometry.coordinates,Ae=te.geometry.type,Be=Math.pow(ie.tolerance/((1<<ie.maxZoom)*ie.extent),2),je=[],Re=te.id;if(ie.promoteId?Re=te.properties[ie.promoteId]:ie.generateId&&(Re=le||0),Ae==="Point")kt(ge,je);else if(Ae==="MultiPoint")for(var ne=0;ne<ge.length;ne++)kt(ge[ne],je);else if(Ae==="LineString")Ut(ge,je,Be,!1);else if(Ae==="MultiLineString"){if(ie.lineMetrics){for(ne=0;ne<ge.length;ne++)Ut(ge[ne],je=[],Be,!1),Ce.push(pn(Re,"LineString",je,te.properties));return}ye(ge,je,Be,!1)}else if(Ae==="Polygon")ye(ge,je,Be,!0);else{if(Ae!=="MultiPolygon"){if(Ae==="GeometryCollection"){for(ne=0;ne<te.geometry.geometries.length;ne++)Ve(Ce,{id:Re,geometry:te.geometry.geometries[ne],properties:te.properties},ie,le);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ne=0;ne<ge.length;ne++){var He=[];ye(ge[ne],He,Be,!0),je.push(He)}}Ce.push(pn(Re,Ae,je,te.properties))}}function kt(Ce,te){te.push(zn(Ce[0])),te.push(Oe(Ce[1])),te.push(0)}function Ut(Ce,te,ie,le){for(var ge,Ae,Be=0,je=0;je<Ce.length;je++){var Re=zn(Ce[je][0]),ne=Oe(Ce[je][1]);te.push(Re),te.push(ne),te.push(0),je>0&&(Be+=le?(ge*ne-Re*Ae)/2:Math.sqrt(Math.pow(Re-ge,2)+Math.pow(ne-Ae,2))),ge=Re,Ae=ne}var He=te.length-3;te[2]=1,bt(te,0,He,ie),te[He+2]=1,te.size=Math.abs(Be),te.start=0,te.end=te.size}function ye(Ce,te,ie,le){for(var ge=0;ge<Ce.length;ge++){var Ae=[];Ut(Ce[ge],Ae,ie,le),te.push(Ae)}}function zn(Ce){return Ce/360+.5}function Oe(Ce){var te=Math.sin(Ce*Math.PI/180),ie=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return ie<0?0:ie>1?1:ie}function tt(Ce,te,ie,le,ge,Ae,Be,je){if(le/=te,Ae>=(ie/=te)&&Be<le)return Ce;if(Be<ie||Ae>=le)return null;for(var Re=[],ne=0;ne<Ce.length;ne++){var He=Ce[ne],Xe=He.geometry,Ye=He.type,at=ge===0?He.minX:He.minY,Tt=ge===0?He.maxX:He.maxY;if(at>=ie&&Tt<le)Re.push(He);else if(!(Tt<ie||at>=le)){var Xt=[];if(Ye==="Point"||Ye==="MultiPoint")Kt(Xe,Xt,ie,le,ge);else if(Ye==="LineString")Un(Xe,Xt,ie,le,ge,!1,je.lineMetrics);else if(Ye==="MultiLineString")pr(Xe,Xt,ie,le,ge,!1);else if(Ye==="Polygon")pr(Xe,Xt,ie,le,ge,!0);else if(Ye==="MultiPolygon")for(var hn=0;hn<Xe.length;hn++){var vn=[];pr(Xe[hn],vn,ie,le,ge,!0),vn.length&&Xt.push(vn)}if(Xt.length){if(je.lineMetrics&&Ye==="LineString"){for(hn=0;hn<Xt.length;hn++)Re.push(pn(He.id,Ye,Xt[hn],He.tags));continue}Ye!=="LineString"&&Ye!=="MultiLineString"||(Xt.length===1?(Ye="LineString",Xt=Xt[0]):Ye="MultiLineString"),Ye!=="Point"&&Ye!=="MultiPoint"||(Ye=Xt.length===3?"Point":"MultiPoint"),Re.push(pn(He.id,Ye,Xt,He.tags))}}}return Re.length?Re:null}function Kt(Ce,te,ie,le,ge){for(var Ae=0;Ae<Ce.length;Ae+=3){var Be=Ce[Ae+ge];Be>=ie&&Be<=le&&(te.push(Ce[Ae]),te.push(Ce[Ae+1]),te.push(Ce[Ae+2]))}}function Un(Ce,te,ie,le,ge,Ae,Be){for(var je,Re,ne=ur(Ce),He=ge===0?Pr:go,Xe=Ce.start,Ye=0;Ye<Ce.length-3;Ye+=3){var at=Ce[Ye],Tt=Ce[Ye+1],Xt=Ce[Ye+2],hn=Ce[Ye+3],vn=Ce[Ye+4],Fn=ge===0?at:Tt,vr=ge===0?hn:vn,Hr=!1;Be&&(je=Math.sqrt(Math.pow(at-hn,2)+Math.pow(Tt-vn,2))),Fn<ie?vr>ie&&(Re=He(ne,at,Tt,hn,vn,ie),Be&&(ne.start=Xe+je*Re)):Fn>le?vr<le&&(Re=He(ne,at,Tt,hn,vn,le),Be&&(ne.start=Xe+je*Re)):Ar(ne,at,Tt,Xt),vr<ie&&Fn>=ie&&(Re=He(ne,at,Tt,hn,vn,ie),Hr=!0),vr>le&&Fn<=le&&(Re=He(ne,at,Tt,hn,vn,le),Hr=!0),!Ae&&Hr&&(Be&&(ne.end=Xe+je*Re),te.push(ne),ne=ur(Ce)),Be&&(Xe+=je)}var wn=Ce.length-3;at=Ce[wn],Tt=Ce[wn+1],Xt=Ce[wn+2],(Fn=ge===0?at:Tt)>=ie&&Fn<=le&&Ar(ne,at,Tt,Xt),wn=ne.length-3,Ae&&wn>=3&&(ne[wn]!==ne[0]||ne[wn+1]!==ne[1])&&Ar(ne,ne[0],ne[1],ne[2]),ne.length&&te.push(ne)}function ur(Ce){var te=[];return te.size=Ce.size,te.start=Ce.start,te.end=Ce.end,te}function pr(Ce,te,ie,le,ge,Ae){for(var Be=0;Be<Ce.length;Be++)Un(Ce[Be],te,ie,le,ge,Ae,!1)}function Ar(Ce,te,ie,le){Ce.push(te),Ce.push(ie),Ce.push(le)}function Pr(Ce,te,ie,le,ge,Ae){var Be=(Ae-te)/(le-te);return Ce.push(Ae),Ce.push(ie+(ge-ie)*Be),Ce.push(1),Be}function go(Ce,te,ie,le,ge,Ae){var Be=(Ae-ie)/(ge-ie);return Ce.push(te+(le-te)*Be),Ce.push(Ae),Ce.push(1),Be}function hr(Ce,te){for(var ie=[],le=0;le<Ce.length;le++){var ge,Ae=Ce[le],Be=Ae.type;if(Be==="Point"||Be==="MultiPoint"||Be==="LineString")ge=vt(Ae.geometry,te);else if(Be==="MultiLineString"||Be==="Polygon"){ge=[];for(var je=0;je<Ae.geometry.length;je++)ge.push(vt(Ae.geometry[je],te))}else if(Be==="MultiPolygon")for(ge=[],je=0;je<Ae.geometry.length;je++){for(var Re=[],ne=0;ne<Ae.geometry[je].length;ne++)Re.push(vt(Ae.geometry[je][ne],te));ge.push(Re)}ie.push(pn(Ae.id,Be,ge,Ae.tags))}return ie}function vt(Ce,te){var ie=[];ie.size=Ce.size,Ce.start!==void 0&&(ie.start=Ce.start,ie.end=Ce.end);for(var le=0;le<Ce.length;le+=3)ie.push(Ce[le]+te,Ce[le+1],Ce[le+2]);return ie}function Vr(Ce,te){if(Ce.transformed)return Ce;var ie,le,ge,Ae=1<<Ce.z,Be=Ce.x,je=Ce.y;for(ie=0;ie<Ce.features.length;ie++){var Re=Ce.features[ie],ne=Re.geometry,He=Re.type;if(Re.geometry=[],He===1)for(le=0;le<ne.length;le+=2)Re.geometry.push(or(ne[le],ne[le+1],te,Ae,Be,je));else for(le=0;le<ne.length;le++){var Xe=[];for(ge=0;ge<ne[le].length;ge+=2)Xe.push(or(ne[le][ge],ne[le][ge+1],te,Ae,Be,je));Re.geometry.push(Xe)}}return Ce.transformed=!0,Ce}function or(Ce,te,ie,le,ge,Ae){return[Math.round(ie*(Ce*le-ge)),Math.round(ie*(te*le-Ae))]}function Kn(Ce,te,ie,le,ge){for(var Ae=te===ge.maxZoom?0:ge.tolerance/((1<<te)*ge.extent),Be={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ie,y:le,z:te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},je=0;je<Ce.length;je++){Be.numFeatures++,Yn(Be,Ce[je],Ae,ge);var Re=Ce[je].minX,ne=Ce[je].minY,He=Ce[je].maxX,Xe=Ce[je].maxY;Re<Be.minX&&(Be.minX=Re),ne<Be.minY&&(Be.minY=ne),He>Be.maxX&&(Be.maxX=He),Xe>Be.maxY&&(Be.maxY=Xe)}return Be}function Yn(Ce,te,ie,le){var ge=te.geometry,Ae=te.type,Be=[];if(Ae==="Point"||Ae==="MultiPoint")for(var je=0;je<ge.length;je+=3)Be.push(ge[je]),Be.push(ge[je+1]),Ce.numPoints++,Ce.numSimplified++;else if(Ae==="LineString")Pt(Be,ge,Ce,ie,!1,!1);else if(Ae==="MultiLineString"||Ae==="Polygon")for(je=0;je<ge.length;je++)Pt(Be,ge[je],Ce,ie,Ae==="Polygon",je===0);else if(Ae==="MultiPolygon")for(var Re=0;Re<ge.length;Re++){var ne=ge[Re];for(je=0;je<ne.length;je++)Pt(Be,ne[je],Ce,ie,!0,je===0)}if(Be.length){var He=te.tags||null;if(Ae==="LineString"&&le.lineMetrics){for(var Xe in He={},te.tags)He[Xe]=te.tags[Xe];He.mapbox_clip_start=ge.start/ge.size,He.mapbox_clip_end=ge.end/ge.size}var Ye={geometry:Be,type:Ae==="Polygon"||Ae==="MultiPolygon"?3:Ae==="LineString"||Ae==="MultiLineString"?2:1,tags:He};te.id!==null&&(Ye.id=te.id),Ce.features.push(Ye)}}function Pt(Ce,te,ie,le,ge,Ae){var Be=le*le;if(le>0&&te.size<(ge?Be:le))ie.numPoints+=te.length/3;else{for(var je=[],Re=0;Re<te.length;Re+=3)(le===0||te[Re+2]>Be)&&(ie.numSimplified++,je.push(te[Re]),je.push(te[Re+1])),ie.numPoints++;ge&&function(ne,He){for(var Xe=0,Ye=0,at=ne.length,Tt=at-2;Ye<at;Tt=Ye,Ye+=2)Xe+=(ne[Ye]-ne[Tt])*(ne[Ye+1]+ne[Tt+1]);if(Xe>0===He)for(Ye=0,at=ne.length;Ye<at/2;Ye+=2){var Xt=ne[Ye],hn=ne[Ye+1];ne[Ye]=ne[at-2-Ye],ne[Ye+1]=ne[at-1-Ye],ne[at-2-Ye]=Xt,ne[at-1-Ye]=hn}}(je,Ae),Ce.push(je)}}function sn(Ce,te){var ie=(te=this.options=function(ge,Ae){for(var Be in Ae)ge[Be]=Ae[Be];return ge}(Object.create(this.options),te)).debug;if(ie&&console.time("preprocess data"),te.maxZoom<0||te.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(te.promoteId&&te.generateId)throw new Error("promoteId and generateId cannot be used together.");var le=function(ge,Ae){var Be=[];if(ge.type==="FeatureCollection")for(var je=0;je<ge.features.length;je++)Ve(Be,ge.features[je],Ae,je);else Ve(Be,ge.type==="Feature"?ge:{geometry:ge},Ae);return Be}(Ce,te);this.tiles={},this.tileCoords=[],ie&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",te.indexMaxZoom,te.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),le=function(ge,Ae){var Be=Ae.buffer/Ae.extent,je=ge,Re=tt(ge,1,-1-Be,Be,0,-1,2,Ae),ne=tt(ge,1,1-Be,2+Be,0,-1,2,Ae);return(Re||ne)&&(je=tt(ge,1,-Be,1+Be,0,-1,2,Ae)||[],Re&&(je=hr(Re,1).concat(je)),ne&&(je=je.concat(hr(ne,-1)))),je}(le,te),le.length&&this.splitTile(le,0,0,0),ie&&(le.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function mn(Ce,te,ie){return 32*((1<<Ce)*ie+te)+Ce}function Qn(Ce,te){return te?Ce.properties[te]:Ce.id}function _i(Ce,te){if(Ce==null)return!0;if(Ce.type==="Feature")return Qn(Ce,te)!=null;if(Ce.type==="FeatureCollection"){const ie=new Set;for(const le of Ce.features){const ge=Qn(le,te);if(ge==null||ie.has(ge))return!1;ie.add(ge)}return!0}return!1}function _n(Ce,te){const ie=new Map;if(Ce!=null)if(Ce.type==="Feature")ie.set(Qn(Ce,te),Ce);else for(const le of Ce.features)ie.set(Qn(le,te),le);return ie}sn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},sn.prototype.splitTile=function(Ce,te,ie,le,ge,Ae,Be){for(var je=[Ce,te,ie,le],Re=this.options,ne=Re.debug;je.length;){le=je.pop(),ie=je.pop(),te=je.pop(),Ce=je.pop();var He=1<<te,Xe=mn(te,ie,le),Ye=this.tiles[Xe];if(!Ye&&(ne>1&&console.time("creation"),Ye=this.tiles[Xe]=Kn(Ce,te,ie,le,Re),this.tileCoords.push({z:te,x:ie,y:le}),ne)){ne>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",te,ie,le,Ye.numFeatures,Ye.numPoints,Ye.numSimplified),console.timeEnd("creation"));var at="z"+te;this.stats[at]=(this.stats[at]||0)+1,this.total++}if(Ye.source=Ce,ge){if(te===Re.maxZoom||te===ge)continue;var Tt=1<<ge-te;if(ie!==Math.floor(Ae/Tt)||le!==Math.floor(Be/Tt))continue}else if(te===Re.indexMaxZoom||Ye.numPoints<=Re.indexMaxPoints)continue;if(Ye.source=null,Ce.length!==0){ne>1&&console.time("clipping");var Xt,hn,vn,Fn,vr,Hr,wn=.5*Re.buffer/Re.extent,zr=.5-wn,ni=.5+wn,Ci=1+wn;Xt=hn=vn=Fn=null,vr=tt(Ce,He,ie-wn,ie+ni,0,Ye.minX,Ye.maxX,Re),Hr=tt(Ce,He,ie+zr,ie+Ci,0,Ye.minX,Ye.maxX,Re),Ce=null,vr&&(Xt=tt(vr,He,le-wn,le+ni,1,Ye.minY,Ye.maxY,Re),hn=tt(vr,He,le+zr,le+Ci,1,Ye.minY,Ye.maxY,Re),vr=null),Hr&&(vn=tt(Hr,He,le-wn,le+ni,1,Ye.minY,Ye.maxY,Re),Fn=tt(Hr,He,le+zr,le+Ci,1,Ye.minY,Ye.maxY,Re),Hr=null),ne>1&&console.timeEnd("clipping"),je.push(Xt||[],te+1,2*ie,2*le),je.push(hn||[],te+1,2*ie,2*le+1),je.push(vn||[],te+1,2*ie+1,2*le),je.push(Fn||[],te+1,2*ie+1,2*le+1)}}},sn.prototype.getTile=function(Ce,te,ie){var le=this.options,ge=le.extent,Ae=le.debug;if(Ce<0||Ce>24)return null;var Be=1<<Ce,je=mn(Ce,te=(te%Be+Be)%Be,ie);if(this.tiles[je])return Vr(this.tiles[je],ge);Ae>1&&console.log("drilling down to z%d-%d-%d",Ce,te,ie);for(var Re,ne=Ce,He=te,Xe=ie;!Re&&ne>0;)ne--,He=Math.floor(He/2),Xe=Math.floor(Xe/2),Re=this.tiles[mn(ne,He,Xe)];return Re&&Re.source?(Ae>1&&console.log("found parent tile z%d-%d-%d",ne,He,Xe),Ae>1&&console.time("drilling down"),this.splitTile(Re.source,ne,He,Xe,Ce,te,ie),Ae>1&&console.timeEnd("drilling down"),this.tiles[je]?Vr(this.tiles[je],ge):null):null};class Nr extends y{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(te,ie){return u._(this,void 0,void 0,function*(){const le=te.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ge=this._geoJSONIndex.getTile(le.z,le.x,le.y);if(!ge)return null;const Ae=new class{constructor(je){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.W,this.length=je.length,this._features=je}feature(je){return new class{constructor(Re){this._feature=Re,this.extent=u.W,this.type=Re.type,this.properties=Re.tags,"id"in Re&&!isNaN(Re.id)&&(this.id=parseInt(Re.id,10))}loadGeometry(){if(this._feature.type===1){const Re=[];for(const ne of this._feature.geometry)Re.push([new u.P(ne[0],ne[1])]);return Re}{const Re=[];for(const ne of this._feature.geometry){const He=[];for(const Xe of ne)He.push(new u.P(Xe[0],Xe[1]));Re.push(He)}return Re}}toGeoJSON(Re,ne,He){return R.call(this,Re,ne,He)}}(this._features[je])}}(ge.features);let Be=Ie(Ae);return Be.byteOffset===0&&Be.byteLength===Be.buffer.byteLength||(Be=new Uint8Array(Be)),{vectorTile:Ae,rawData:Be.buffer}})}loadData(te){return u._(this,void 0,void 0,function*(){var ie;(ie=this._pendingRequest)===null||ie===void 0||ie.abort();const le=!!(te&&te.request&&te.request.collectResourceTiming)&&new u.bs(te.request);this._pendingRequest=new AbortController;try{let ge=yield this.loadGeoJSON(te,this._pendingRequest);if(delete this._pendingRequest,typeof ge!="object")throw new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`);if(D(ge,!0),te.filter){const Be=u.by(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Be.result==="error")throw new Error(Be.value.map(Re=>`${Re.key}: ${Re.message}`).join(", "));ge={type:"FeatureCollection",features:ge.features.filter(Re=>Be.value.evaluate({zoom:0},Re))}}this._geoJSONIndex=te.cluster?new We(function({superclusterOptions:Be,clusterProperties:je}){if(!je||!Be)return Be;const Re={},ne={},He={accumulated:null,zoom:0},Xe={properties:null},Ye=Object.keys(je);for(const at of Ye){const[Tt,Xt]=je[at],hn=u.by(Xt),vn=u.by(typeof Tt=="string"?[Tt,["accumulated"],["get",at]]:Tt);Re[at]=hn.value,ne[at]=vn.value}return Be.map=at=>{Xe.properties=at;const Tt={};for(const Xt of Ye)Tt[Xt]=Re[Xt].evaluate(He,Xe);return Tt},Be.reduce=(at,Tt)=>{Xe.properties=Tt;for(const Xt of Ye)He.accumulated=at[Xt],at[Xt]=ne[Xt].evaluate(He,Xe)},Be}(te)).load(ge.features):function(Be,je){return new sn(Be,je)}(ge,te.geojsonVtOptions),this.loaded={};const Ae={};if(le){const Be=le.finish();Be&&(Ae.resourceTiming={},Ae.resourceTiming[te.source]=JSON.parse(JSON.stringify(Be)))}return Ae}catch(ge){if(delete this._pendingRequest,u.bz(ge))return{abandoned:!0};throw ge}})}reloadTile(te){const ie=this.loaded;return ie&&ie[te.uid]?super.reloadTile(te):this.loadTile(te)}loadGeoJSON(te,ie){return u._(this,void 0,void 0,function*(){const{promoteId:le}=te;if(te.request){const ge=yield u.h(te.request,ie);return this._dataUpdateable=_i(ge.data,le)?_n(ge.data,le):void 0,ge.data}if(typeof te.data=="string")try{const ge=JSON.parse(te.data);return this._dataUpdateable=_i(ge,le)?_n(ge,le):void 0,ge}catch{throw new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`)}if(!te.dataDiff)throw new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${te.source}`);return function(ge,Ae,Be){var je,Re,ne,He;if(Ae.removeAll&&ge.clear(),Ae.remove)for(const Xe of Ae.remove)ge.delete(Xe);if(Ae.add)for(const Xe of Ae.add){const Ye=Qn(Xe,Be);Ye!=null&&ge.set(Ye,Xe)}if(Ae.update)for(const Xe of Ae.update){let Ye=ge.get(Xe.id);if(Ye==null)continue;const at=!Xe.removeAllProperties&&(((je=Xe.removeProperties)===null||je===void 0?void 0:je.length)>0||((Re=Xe.addOrUpdateProperties)===null||Re===void 0?void 0:Re.length)>0);if((Xe.newGeometry||Xe.removeAllProperties||at)&&(Ye=Object.assign({},Ye),ge.set(Xe.id,Ye),at&&(Ye.properties=Object.assign({},Ye.properties))),Xe.newGeometry&&(Ye.geometry=Xe.newGeometry),Xe.removeAllProperties)Ye.properties={};else if(((ne=Xe.removeProperties)===null||ne===void 0?void 0:ne.length)>0)for(const Tt of Xe.removeProperties)Object.prototype.hasOwnProperty.call(Ye.properties,Tt)&&delete Ye.properties[Tt];if(((He=Xe.addOrUpdateProperties)===null||He===void 0?void 0:He.length)>0)for(const{key:Tt,value:Xt}of Xe.addOrUpdateProperties)Ye.properties[Tt]=Xt}}(this._dataUpdateable,te.dataDiff,le),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(te){return u._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(te){return this._geoJSONIndex.getClusterExpansionZoom(te.clusterId)}getClusterChildren(te){return this._geoJSONIndex.getChildren(te.clusterId)}getClusterLeaves(te){return this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset)}}class _r{constructor(te){this.self=te,this.actor=new u.C(te),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ie,le)=>{if(this.externalWorkerSourceTypes[ie])throw new Error(`Worker source with name "${ie}" already registered.`);this.externalWorkerSourceTypes[ie]=le},this.self.addProtocol=u.bf,this.self.removeProtocol=u.bg,this.self.registerRTLTextPlugin=ie=>{if(u.bA.isParsed())throw new Error("RTL text plugin already registered.");u.bA.setMethods(ie)},this.actor.registerMessageHandler("LDT",(ie,le)=>this._getDEMWorkerSource(ie,le.source).loadTile(le)),this.actor.registerMessageHandler("RDT",(ie,le)=>u._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ie,le.source).removeTile(le)})),this.actor.registerMessageHandler("GCEZ",(ie,le)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(ie,le.type,le.source).getClusterExpansionZoom(le)})),this.actor.registerMessageHandler("GCC",(ie,le)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(ie,le.type,le.source).getClusterChildren(le)})),this.actor.registerMessageHandler("GCL",(ie,le)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(ie,le.type,le.source).getClusterLeaves(le)})),this.actor.registerMessageHandler("LD",(ie,le)=>this._getWorkerSource(ie,le.type,le.source).loadData(le)),this.actor.registerMessageHandler("LT",(ie,le)=>this._getWorkerSource(ie,le.type,le.source).loadTile(le)),this.actor.registerMessageHandler("RT",(ie,le)=>this._getWorkerSource(ie,le.type,le.source).reloadTile(le)),this.actor.registerMessageHandler("AT",(ie,le)=>this._getWorkerSource(ie,le.type,le.source).abortTile(le)),this.actor.registerMessageHandler("RMT",(ie,le)=>this._getWorkerSource(ie,le.type,le.source).removeTile(le)),this.actor.registerMessageHandler("RS",(ie,le)=>u._(this,void 0,void 0,function*(){if(!this.workerSources[ie]||!this.workerSources[ie][le.type]||!this.workerSources[ie][le.type][le.source])return;const ge=this.workerSources[ie][le.type][le.source];delete this.workerSources[ie][le.type][le.source],ge.removeSource!==void 0&&ge.removeSource(le)})),this.actor.registerMessageHandler("RM",ie=>u._(this,void 0,void 0,function*(){delete this.layerIndexes[ie],delete this.availableImages[ie],delete this.workerSources[ie],delete this.demWorkerSources[ie]})),this.actor.registerMessageHandler("SR",(ie,le)=>u._(this,void 0,void 0,function*(){this.referrer=le})),this.actor.registerMessageHandler("SRPS",(ie,le)=>this._syncRTLPluginState(ie,le)),this.actor.registerMessageHandler("IS",(ie,le)=>u._(this,void 0,void 0,function*(){this.self.importScripts(le)})),this.actor.registerMessageHandler("SI",(ie,le)=>this._setImages(ie,le)),this.actor.registerMessageHandler("UL",(ie,le)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(ie).update(le.layers,le.removedIds)})),this.actor.registerMessageHandler("SL",(ie,le)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(ie).replace(le)}))}_setImages(te,ie){return u._(this,void 0,void 0,function*(){this.availableImages[te]=ie;for(const le in this.workerSources[te]){const ge=this.workerSources[te][le];for(const Ae in ge)ge[Ae].availableImages=ie}})}_syncRTLPluginState(te,ie){return u._(this,void 0,void 0,function*(){if(u.bA.isParsed())return u.bA.getState();if(ie.pluginStatus!=="loading")return u.bA.setState(ie),ie;const le=ie.pluginURL;if(this.self.importScripts(le),u.bA.isParsed()){const ge={pluginStatus:"loaded",pluginURL:le};return u.bA.setState(ge),ge}throw u.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${le}`)})}_getAvailableImages(te){let ie=this.availableImages[te];return ie||(ie=[]),ie}_getLayerIndex(te){let ie=this.layerIndexes[te];return ie||(ie=this.layerIndexes[te]=new a),ie}_getWorkerSource(te,ie,le){if(this.workerSources[te]||(this.workerSources[te]={}),this.workerSources[te][ie]||(this.workerSources[te][ie]={}),!this.workerSources[te][ie][le]){const ge={sendAsync:(Ae,Be)=>(Ae.targetMapId=te,this.actor.sendAsync(Ae,Be))};switch(ie){case"vector":this.workerSources[te][ie][le]=new y(ge,this._getLayerIndex(te),this._getAvailableImages(te));break;case"geojson":this.workerSources[te][ie][le]=new Nr(ge,this._getLayerIndex(te),this._getAvailableImages(te));break;default:this.workerSources[te][ie][le]=new this.externalWorkerSourceTypes[ie](ge,this._getLayerIndex(te),this._getAvailableImages(te))}}return this.workerSources[te][ie][le]}_getDEMWorkerSource(te,ie){return this.demWorkerSources[te]||(this.demWorkerSources[te]={}),this.demWorkerSources[te][ie]||(this.demWorkerSources[te][ie]=new w),this.demWorkerSources[te][ie]}}return u.i(self)&&(self.worker=new _r(self)),_r}),i("index",["exports","./shared"],function(u,a){var d="4.1.3";let p,g;const y={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:x=>new Promise((l,f)=>{const _=requestAnimationFrame(l);x.signal.addEventListener("abort",()=>{cancelAnimationFrame(_),f(a.c())})}),getImageData(x,l=0){return this.getImageCanvasContext(x).getImageData(-l,-l,x.width+2*l,x.height+2*l)},getImageCanvasContext(x){const l=window.document.createElement("canvas"),f=l.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return l.width=x.width,l.height=x.height,f.drawImage(x,0,0,x.width,x.height),f},resolveURL:x=>(p||(p=document.createElement("a")),p.href=x,p.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(g==null&&(g=matchMedia("(prefers-reduced-motion: reduce)")),g.matches)}};class w{static testProp(l){if(!w.docStyle)return l[0];for(let f=0;f<l.length;f++)if(l[f]in w.docStyle)return l[f];return l[0]}static create(l,f,_){const b=window.document.createElement(l);return f!==void 0&&(b.className=f),_&&_.appendChild(b),b}static createNS(l,f){return window.document.createElementNS(l,f)}static disableDrag(){w.docStyle&&w.selectProp&&(w.userSelect=w.docStyle[w.selectProp],w.docStyle[w.selectProp]="none")}static enableDrag(){w.docStyle&&w.selectProp&&(w.docStyle[w.selectProp]=w.userSelect)}static setTransform(l,f){l.style[w.transformProp]=f}static addEventListener(l,f,_,b={}){l.addEventListener(f,_,"passive"in b?b:b.capture)}static removeEventListener(l,f,_,b={}){l.removeEventListener(f,_,"passive"in b?b:b.capture)}static suppressClickInternal(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",w.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",w.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",w.suppressClickInternal,!0)},0)}static getScale(l){const f=l.getBoundingClientRect();return{x:f.width/l.offsetWidth||1,y:f.height/l.offsetHeight||1,boundingClientRect:f}}static getPoint(l,f,_){const b=f.boundingClientRect;return new a.P((_.clientX-b.left)/f.x-l.clientLeft,(_.clientY-b.top)/f.y-l.clientTop)}static mousePos(l,f){const _=w.getScale(l);return w.getPoint(l,_,f)}static touchPos(l,f){const _=[],b=w.getScale(l);for(let k=0;k<f.length;k++)_.push(w.getPoint(l,b,f[k]));return _}static mouseButton(l){return l.button}static remove(l){l.parentNode&&l.parentNode.removeChild(l)}}w.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,w.selectProp=w.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),w.transformProp=w.testProp(["transform","WebkitTransform"]);const T={supported:!1,testSupport:function(x){!R&&D&&(z?I(x):L=x)}};let L,D,R=!1,z=!1;function I(x){const l=x.createTexture();x.bindTexture(x.TEXTURE_2D,l);try{if(x.texImage2D(x.TEXTURE_2D,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,D),x.isContextLost())return;T.supported=!0}catch{}x.deleteTexture(l),R=!0}var F;typeof document<"u"&&(D=document.createElement("img"),D.onload=function(){L&&I(L),L=null,z=!0},D.onerror=function(){R=!0,L=null},D.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(x){let l,f,_,b;x.resetRequestQueue=()=>{l=[],f=0,_=0,b={}},x.addThrottleControl=B=>{const Z=_++;return b[Z]=B,Z},x.removeThrottleControl=B=>{delete b[B],E()},x.getImage=(B,Z,X=!0)=>new Promise((Q,pe)=>{T.supported&&(B.headers||(B.headers={}),B.headers.accept="image/webp,*/*"),a.e(B,{type:"image"}),l.push({abortController:Z,requestParameters:B,supportImageRefresh:X,state:"queued",onError:Se=>{pe(Se)},onSuccess:Se=>{Q(Se)}}),E()});const k=B=>a._(this,void 0,void 0,function*(){B.state="running";const{requestParameters:Z,supportImageRefresh:X,onError:Q,onSuccess:pe,abortController:Se}=B,ke=X===!1&&!a.i(self)&&!a.g(Z.url)&&(!Z.headers||Object.keys(Z.headers).reduce((Fe,Je)=>Fe&&Je==="accept",!0));f++;const Me=ke?A(Z,Se):a.m(Z,Se);try{const Fe=yield Me;delete B.abortController,B.state="completed",Fe.data instanceof HTMLImageElement||a.b(Fe.data)?pe(Fe):Fe.data&&pe({data:yield(be=Fe.data,typeof createImageBitmap=="function"?a.d(be):a.f(be)),cacheControl:Fe.cacheControl,expires:Fe.expires})}catch(Fe){delete B.abortController,Q(Fe)}finally{f--,E()}var be}),E=()=>{const B=(()=>{for(const Z of Object.keys(b))if(b[Z]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let Z=f;Z<B&&l.length>0;Z++){const X=l.shift();X.abortController.signal.aborted?Z--:k(X)}},A=(B,Z)=>new Promise((X,Q)=>{const pe=new Image,Se=B.url,ke=B.credentials;ke&&ke==="include"?pe.crossOrigin="use-credentials":(ke&&ke==="same-origin"||!a.s(Se))&&(pe.crossOrigin="anonymous"),Z.signal.addEventListener("abort",()=>{pe.src="",Q(a.c())}),pe.fetchPriority="high",pe.onload=()=>{pe.onerror=pe.onload=null,X({data:pe})},pe.onerror=()=>{pe.onerror=pe.onload=null,Z.signal.aborted||Q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},pe.src=Se})}(F||(F={})),F.resetRequestQueue();class N{constructor(l){this._transformRequestFn=l}transformRequest(l,f){return this._transformRequestFn&&this._transformRequestFn(l,f)||{url:l}}normalizeSpriteURL(l,f,_){const b=function(k){const E=k.match(W);if(!E)throw new Error(`Unable to parse URL "${k}"`);return{protocol:E[1],authority:E[2],path:E[3]||"/",params:E[4]?E[4].split("&"):[]}}(l);return b.path+=`${f}${_}`,function(k){const E=k.params.length?`?${k.params.join("&")}`:"";return`${k.protocol}://${k.authority}${k.path}${E}`}(b)}setTransformRequest(l){this._transformRequestFn=l}}const W=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function se(x){var l=new a.A(3);return l[0]=x[0],l[1]=x[1],l[2]=x[2],l}var J,Y=function(x,l,f){return x[0]=l[0]-f[0],x[1]=l[1]-f[1],x[2]=l[2]-f[2],x};J=new a.A(3),a.A!=Float32Array&&(J[0]=0,J[1]=0,J[2]=0);var _e=function(x){var l=x[0],f=x[1];return l*l+f*f};function ze(x){const l=[];if(typeof x=="string")l.push({id:"default",url:x});else if(x&&x.length>0){const f=[];for(const{id:_,url:b}of x){const k=`${_}${b}`;f.indexOf(k)===-1&&(f.push(k),l.push({id:_,url:b}))}}return l}(function(){var x=new a.A(2);a.A!=Float32Array&&(x[0]=0,x[1]=0)})();class ee{constructor(l,f,_,b){this.context=l,this.format=_,this.texture=l.gl.createTexture(),this.update(f,b)}update(l,f,_){const{width:b,height:k}=l,E=!(this.size&&this.size[0]===b&&this.size[1]===k||_),{context:A}=this,{gl:B}=A;if(this.useMipmap=!!(f&&f.useMipmap),B.bindTexture(B.TEXTURE_2D,this.texture),A.pixelStoreUnpackFlipY.set(!1),A.pixelStoreUnpack.set(1),A.pixelStoreUnpackPremultiplyAlpha.set(this.format===B.RGBA&&(!f||f.premultiply!==!1)),E)this.size=[b,k],l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||a.b(l)?B.texImage2D(B.TEXTURE_2D,0,this.format,this.format,B.UNSIGNED_BYTE,l):B.texImage2D(B.TEXTURE_2D,0,this.format,b,k,0,this.format,B.UNSIGNED_BYTE,l.data);else{const{x:Z,y:X}=_||{x:0,y:0};l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||a.b(l)?B.texSubImage2D(B.TEXTURE_2D,0,Z,X,B.RGBA,B.UNSIGNED_BYTE,l):B.texSubImage2D(B.TEXTURE_2D,0,Z,X,b,k,B.RGBA,B.UNSIGNED_BYTE,l.data)}this.useMipmap&&this.isSizePowerOfTwo()&&B.generateMipmap(B.TEXTURE_2D)}bind(l,f,_){const{context:b}=this,{gl:k}=b;k.bindTexture(k.TEXTURE_2D,this.texture),_!==k.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(_=k.LINEAR),l!==this.filter&&(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,l),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,_||l),this.filter=l),f!==this.wrap&&(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,f),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,f),this.wrap=f)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}function ae(x){const{userImage:l}=x;return!!(l&&l.render&&l.render())&&(x.data.replace(new Uint8Array(l.data.buffer)),!0)}class Ee extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:f,promiseResolve:_}of this.requestors)_(this._getImagesForIds(f));this.requestors=[]}}getImage(l){const f=this.images[l];if(f&&!f.data&&f.spriteData){const _=f.spriteData;f.data=new a.R({width:_.width,height:_.height},_.context.getImageData(_.x,_.y,_.width,_.height).data),f.spriteData=null}return f}addImage(l,f){if(this.images[l])throw new Error(`Image id ${l} already exist, use updateImage instead`);this._validate(l,f)&&(this.images[l]=f)}_validate(l,f){let _=!0;const b=f.data||f.spriteData;return this._validateStretch(f.stretchX,b&&b.width)||(this.fire(new a.j(new Error(`Image "${l}" has invalid "stretchX" value`))),_=!1),this._validateStretch(f.stretchY,b&&b.height)||(this.fire(new a.j(new Error(`Image "${l}" has invalid "stretchY" value`))),_=!1),this._validateContent(f.content,f)||(this.fire(new a.j(new Error(`Image "${l}" has invalid "content" value`))),_=!1),_}_validateStretch(l,f){if(!l)return!0;let _=0;for(const b of l){if(b[0]<_||b[1]<b[0]||f<b[1])return!1;_=b[1]}return!0}_validateContent(l,f){if(!l)return!0;if(l.length!==4)return!1;const _=f.spriteData,b=_&&_.width||f.data.width,k=_&&_.height||f.data.height;return!(l[0]<0||b<l[0]||l[1]<0||k<l[1]||l[2]<0||b<l[2]||l[3]<0||k<l[3]||l[2]<l[0]||l[3]<l[1])}updateImage(l,f,_=!0){const b=this.getImage(l);if(_&&(b.data.width!==f.data.width||b.data.height!==f.data.height))throw new Error(`size mismatch between old image (${b.data.width}x${b.data.height}) and new image (${f.data.width}x${f.data.height}).`);f.version=b.version+1,this.images[l]=f,this.updatedImages[l]=!0}removeImage(l){const f=this.images[l];delete this.images[l],delete this.patterns[l],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l){return new Promise((f,_)=>{let b=!0;if(!this.isLoaded())for(const k of l)this.images[k]||(b=!1);this.isLoaded()||b?f(this._getImagesForIds(l)):this.requestors.push({ids:l,promiseResolve:f})})}_getImagesForIds(l){const f={};for(const _ of l){let b=this.getImage(_);b||(this.fire(new a.k("styleimagemissing",{id:_})),b=this.getImage(_)),b?f[_]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:a.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return f}getPixelSize(){const{width:l,height:f}=this.atlasImage;return{width:l,height:f}}getPattern(l){const f=this.patterns[l],_=this.getImage(l);if(!_)return null;if(f&&f.position.version===_.version)return f.position;if(f)f.position.version=_.version;else{const b={w:_.data.width+2,h:_.data.height+2,x:0,y:0},k=new a.I(b,_);this.patterns[l]={bin:b,position:k}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const f=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ee(l,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const k in this.patterns)l.push(this.patterns[k].bin);const{w:f,h:_}=a.p(l),b=this.atlasImage;b.resize({width:f||1,height:_||1});for(const k in this.patterns){const{bin:E}=this.patterns[k],A=E.x+1,B=E.y+1,Z=this.getImage(k).data,X=Z.width,Q=Z.height;a.R.copy(Z,b,{x:0,y:0},{x:A,y:B},{width:X,height:Q}),a.R.copy(Z,b,{x:0,y:Q-1},{x:A,y:B-1},{width:X,height:1}),a.R.copy(Z,b,{x:0,y:0},{x:A,y:B+Q},{width:X,height:1}),a.R.copy(Z,b,{x:X-1,y:0},{x:A-1,y:B},{width:1,height:Q}),a.R.copy(Z,b,{x:0,y:0},{x:A+X,y:B},{width:1,height:Q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const f of l){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const _=this.getImage(f);_||a.w(`Image with ID: "${f}" was not found`),ae(_)&&this.updateImage(f,_)}}}const we=1e20;function it(x,l,f,_,b,k,E,A,B){for(let Z=l;Z<l+_;Z++)Ge(x,f*k+Z,k,b,E,A,B);for(let Z=f;Z<f+b;Z++)Ge(x,Z*k+l,1,_,E,A,B)}function Ge(x,l,f,_,b,k,E){k[0]=0,E[0]=-we,E[1]=we,b[0]=x[l];for(let A=1,B=0,Z=0;A<_;A++){b[A]=x[l+A*f];const X=A*A;do{const Q=k[B];Z=(b[A]-b[Q]+X-Q*Q)/(A-Q)/2}while(Z<=E[B]&&--B>-1);B++,k[B]=A,E[B]=Z,E[B+1]=we}for(let A=0,B=0;A<_;A++){for(;E[B+1]<A;)B++;const Z=k[B],X=A-Z;x[l+A*f]=b[Z]+X*X}}class Ie{constructor(l,f){this.requestManager=l,this.localIdeographFontFamily=f,this.entries={}}setURL(l){this.url=l}getGlyphs(l){return a._(this,void 0,void 0,function*(){const f=[];for(const k in l)for(const E of l[k])f.push(this._getAndCacheGlyphsPromise(k,E));const _=yield Promise.all(f),b={};for(const{stack:k,id:E,glyph:A}of _)b[k]||(b[k]={}),b[k][E]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics};return b})}_getAndCacheGlyphsPromise(l,f){return a._(this,void 0,void 0,function*(){let _=this.entries[l];_||(_=this.entries[l]={glyphs:{},requests:{},ranges:{}});let b=_.glyphs[f];if(b!==void 0)return{stack:l,id:f,glyph:b};if(b=this._tinySDF(_,l,f),b)return _.glyphs[f]=b,{stack:l,id:f,glyph:b};const k=Math.floor(f/256);if(256*k>65535)throw new Error("glyphs > 65535 not supported");if(_.ranges[k])return{stack:l,id:f,glyph:b};if(!this.url)throw new Error("glyphsUrl is not set");if(!_.requests[k]){const A=Ie.loadGlyphRange(l,k,this.url,this.requestManager);_.requests[k]=A}const E=yield _.requests[k];for(const A in E)this._doesCharSupportLocalGlyph(+A)||(_.glyphs[+A]=E[+A]);return _.ranges[k]=!0,{stack:l,id:f,glyph:E[f]||null}})}_doesCharSupportLocalGlyph(l){return!!this.localIdeographFontFamily&&(a.u["CJK Unified Ideographs"](l)||a.u["Hangul Syllables"](l)||a.u.Hiragana(l)||a.u.Katakana(l))}_tinySDF(l,f,_){const b=this.localIdeographFontFamily;if(!b||!this._doesCharSupportLocalGlyph(_))return;let k=l.tinySDF;if(!k){let A="400";/bold/i.test(f)?A="900":/medium/i.test(f)?A="500":/light/i.test(f)&&(A="200"),k=l.tinySDF=new Ie.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:b,fontWeight:A})}const E=k.draw(String.fromCharCode(_));return{id:_,bitmap:new a.o({width:E.width||60,height:E.height||60},E.data),metrics:{width:E.glyphWidth/2||24,height:E.glyphHeight/2||24,left:E.glyphLeft/2+.5||0,top:E.glyphTop/2-27.5||-8,advance:E.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ie.loadGlyphRange=function(x,l,f,_){return a._(this,void 0,void 0,function*(){const b=256*l,k=b+255,E=_.transformRequest(f.replace("{fontstack}",x).replace("{range}",`${b}-${k}`),"Glyphs"),A=yield a.l(E,new AbortController);if(!A||!A.data)throw new Error(`Could not load glyph range. range: ${l}, ${b}-${k}`);const B={};for(const Z of a.n(A.data))B[Z.id]=Z;return B})},Ie.TinySDF=class{constructor({fontSize:x=24,buffer:l=3,radius:f=8,cutoff:_=.25,fontFamily:b="sans-serif",fontWeight:k="normal",fontStyle:E="normal"}={}){this.buffer=l,this.cutoff=_,this.radius=f;const A=this.size=x+4*l,B=this._createCanvas(A),Z=this.ctx=B.getContext("2d",{willReadFrequently:!0});Z.font=`${E} ${k} ${x}px ${b}`,Z.textBaseline="alphabetic",Z.textAlign="left",Z.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(x){const l=document.createElement("canvas");return l.width=l.height=x,l}draw(x){const{width:l,actualBoundingBoxAscent:f,actualBoundingBoxDescent:_,actualBoundingBoxLeft:b,actualBoundingBoxRight:k}=this.ctx.measureText(x),E=Math.ceil(f),A=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(k-b))),B=Math.min(this.size-this.buffer,E+Math.ceil(_)),Z=A+2*this.buffer,X=B+2*this.buffer,Q=Math.max(Z*X,0),pe=new Uint8ClampedArray(Q),Se={data:pe,width:Z,height:X,glyphWidth:A,glyphHeight:B,glyphTop:E,glyphLeft:0,glyphAdvance:l};if(A===0||B===0)return Se;const{ctx:ke,buffer:Me,gridInner:be,gridOuter:Fe}=this;ke.clearRect(Me,Me,A,B),ke.fillText(x,Me,Me+E);const Je=ke.getImageData(Me,Me,A,B);Fe.fill(we,0,Q),be.fill(0,0,Q);for(let Le=0;Le<B;Le++)for(let Ue=0;Ue<A;Ue++){const Qe=Je.data[4*(Le*A+Ue)+3]/255;if(Qe===0)continue;const et=(Le+Me)*Z+Ue+Me;if(Qe===1)Fe[et]=0,be[et]=we;else{const ot=.5-Qe;Fe[et]=ot>0?ot*ot:0,be[et]=ot<0?ot*ot:0}}it(Fe,0,0,Z,X,Z,this.f,this.v,this.z),it(be,Me,Me,A,B,Z,this.f,this.v,this.z);for(let Le=0;Le<Q;Le++){const Ue=Math.sqrt(Fe[Le])-Math.sqrt(be[Le]);pe[Le]=Math.round(255-255*(Ue/this.radius+this.cutoff))}return Se}};class De{constructor(){this.specification=a.v.light.position}possiblyEvaluate(l,f){return a.y(l.expression.evaluate(f))}interpolate(l,f,_){return{x:a.z.number(l.x,f.x,_),y:a.z.number(l.y,f.y,_),z:a.z.number(l.z,f.z,_)}}}let Ct;class nt extends a.E{constructor(l){super(),Ct=Ct||new a.q({anchor:new a.D(a.v.light.anchor),position:new De,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(Ct),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,f={}){if(!this._validate(a.r,l,f))for(const _ in l){const b=l[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),b):this._transitionable.setValue(_,b)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,f,_){return(!_||_.validate!==!1)&&a.t(this,l.call(a.x,{value:f,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}class lt{constructor(l,f){this.width=l,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(l,f){const _=l.join(",")+String(f);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(l,f)),this.dashEntry[_]}getDashRanges(l,f,_){const b=[];let k=l.length%2==1?-l[l.length-1]*_:0,E=l[0]*_,A=!0;b.push({left:k,right:E,isDash:A,zeroLength:l[0]===0});let B=l[0];for(let Z=1;Z<l.length;Z++){A=!A;const X=l[Z];k=B*_,B+=X,E=B*_,b.push({left:k,right:E,isDash:A,zeroLength:X===0})}return b}addRoundDash(l,f,_){const b=f/2;for(let k=-_;k<=_;k++){const E=this.width*(this.nextRow+_+k);let A=0,B=l[A];for(let Z=0;Z<this.width;Z++){Z/B.right>1&&(B=l[++A]);const X=Math.abs(Z-B.left),Q=Math.abs(Z-B.right),pe=Math.min(X,Q);let Se;const ke=k/_*(b+1);if(B.isDash){const Me=b-Math.abs(ke);Se=Math.sqrt(pe*pe+Me*Me)}else Se=b-Math.sqrt(pe*pe+ke*ke);this.data[E+Z]=Math.max(0,Math.min(255,Se+128))}}}addRegularDash(l){for(let A=l.length-1;A>=0;--A){const B=l[A],Z=l[A+1];B.zeroLength?l.splice(A,1):Z&&Z.isDash===B.isDash&&(Z.left=B.left,l.splice(A,1))}const f=l[0],_=l[l.length-1];f.isDash===_.isDash&&(f.left=_.left-this.width,_.right=f.right+this.width);const b=this.width*this.nextRow;let k=0,E=l[k];for(let A=0;A<this.width;A++){A/E.right>1&&(E=l[++k]);const B=Math.abs(A-E.left),Z=Math.abs(A-E.right),X=Math.min(B,Z);this.data[b+A]=Math.max(0,Math.min(255,(E.isDash?X:-X)+128))}}addDash(l,f){const _=f?7:0,b=2*_+1;if(this.nextRow+b>this.height)return a.w("LineAtlas out of space"),null;let k=0;for(let A=0;A<l.length;A++)k+=l[A];if(k!==0){const A=this.width/k,B=this.getDashRanges(l,this.width,A);f?this.addRoundDash(B,A,_):this.addRegularDash(B)}const E={y:(this.nextRow+_+.5)/this.height,height:2*_/this.height,width:k};return this.nextRow+=b,this.dirty=!0,E}bind(l){const f=l.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))}}const mt="maplibre_preloaded_worker_pool";class ht{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<ht.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[mt]}numActive(){return Object.keys(this.active).length}}const We=Math.floor(y.hardwareConcurrency/2);let Bt,Lt;function Nt(){return Bt||(Bt=new ht),Bt}ht.workerCount=a.B(globalThis)?Math.max(Math.min(We,3),1):1;class Mt{constructor(l,f){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=f;const _=this.workerPool.acquire(f);for(let b=0;b<_.length;b++){const k=new a.C(_[b],f);k.name=`Worker ${b}`,this.actors.push(k)}if(!this.actors.length)throw new Error("No actors found")}broadcast(l,f){const _=[];for(const b of this.actors)_.push(b.sendAsync({type:l,data:f}));return Promise.all(_)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(l=!0){this.actors.forEach(f=>{f.remove()}),this.actors=[],l&&this.workerPool.release(this.id)}registerMessageHandler(l,f){for(const _ of this.actors)_.registerMessageHandler(l,f)}}function Qt(){return Lt||(Lt=new Mt(Nt(),a.G),Lt.registerMessageHandler("GR",(x,l,f)=>a.m(l,f))),Lt}function bt(x,l){const f=a.F();return a.H(f,f,[1,1,0]),a.J(f,f,[.5*x.width,.5*x.height,1]),a.K(f,f,x.calculatePosMatrix(l.toUnwrapped()))}function Dt(x,l,f,_,b,k){const E=function(Q,pe,Se){if(Q)for(const ke of Q){const Me=pe[ke];if(Me&&Me.source===Se&&Me.type==="fill-extrusion")return!0}else for(const ke in pe){const Me=pe[ke];if(Me.source===Se&&Me.type==="fill-extrusion")return!0}return!1}(b&&b.layers,l,x.id),A=k.maxPitchScaleFactor(),B=x.tilesIn(_,A,E);B.sort(pn);const Z=[];for(const Q of B)Z.push({wrappedTileID:Q.tileID.wrapped().key,queryResults:Q.tile.queryRenderedFeatures(l,f,x._state,Q.queryGeometry,Q.cameraQueryGeometry,Q.scale,b,k,A,bt(x.transform,Q.tileID))});const X=function(Q){const pe={},Se={};for(const ke of Q){const Me=ke.queryResults,be=ke.wrappedTileID,Fe=Se[be]=Se[be]||{};for(const Je in Me){const Le=Me[Je],Ue=Fe[Je]=Fe[Je]||{},Qe=pe[Je]=pe[Je]||[];for(const et of Le)Ue[et.featureIndex]||(Ue[et.featureIndex]=!0,Qe.push(et))}}return pe}(Z);for(const Q in X)X[Q].forEach(pe=>{const Se=pe.feature,ke=x.getFeatureState(Se.layer["source-layer"],Se.id);Se.source=Se.layer.source,Se.layer["source-layer"]&&(Se.sourceLayer=Se.layer["source-layer"]),Se.state=ke});return X}function pn(x,l){const f=x.tileID,_=l.tileID;return f.overscaledZ-_.overscaledZ||f.canonical.y-_.canonical.y||f.wrap-_.wrap||f.canonical.x-_.canonical.x}function qe(x,l,f){return a._(this,void 0,void 0,function*(){let _=x;if(x.url?_=(yield a.h(l.transformRequest(x.url,"Source"),f)).data:yield y.frameAsync(f),!_)return null;const b=a.L(a.e(_,x),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in _&&_.vector_layers&&(b.vectorLayerIds=_.vector_layers.map(k=>k.id)),b})}class Ve{constructor(l,f){l&&(f?this.setSouthWest(l).setNorthEast(f):Array.isArray(l)&&(l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1])))}setNorthEast(l){return this._ne=l instanceof a.M?new a.M(l.lng,l.lat):a.M.convert(l),this}setSouthWest(l){return this._sw=l instanceof a.M?new a.M(l.lng,l.lat):a.M.convert(l),this}extend(l){const f=this._sw,_=this._ne;let b,k;if(l instanceof a.M)b=l,k=l;else{if(!(l instanceof Ve))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(Ve.convert(l)):this.extend(a.M.convert(l)):l&&("lng"in l||"lon"in l)&&"lat"in l?this.extend(a.M.convert(l)):this;if(b=l._sw,k=l._ne,!b||!k)return this}return f||_?(f.lng=Math.min(b.lng,f.lng),f.lat=Math.min(b.lat,f.lat),_.lng=Math.max(k.lng,_.lng),_.lat=Math.max(k.lat,_.lat)):(this._sw=new a.M(b.lng,b.lat),this._ne=new a.M(k.lng,k.lat)),this}getCenter(){return new a.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.M(this.getWest(),this.getNorth())}getSouthEast(){return new a.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:f,lat:_}=a.M.convert(l);let b=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(b=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&b}static convert(l){return l instanceof Ve?l:l&&new Ve(l)}static fromLngLat(l,f=0){const _=360*f/40075017,b=_/Math.cos(Math.PI/180*l.lat);return new Ve(new a.M(l.lng-b,l.lat-_),new a.M(l.lng+b,l.lat+_))}}class kt{constructor(l,f,_){this.bounds=Ve.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=_||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const f=Math.pow(2,l.z),_=Math.floor(a.N(this.bounds.getWest())*f),b=Math.floor(a.O(this.bounds.getNorth())*f),k=Math.ceil(a.N(this.bounds.getEast())*f),E=Math.ceil(a.O(this.bounds.getSouth())*f);return l.x>=_&&l.x<k&&l.y>=b&&l.y<E}}class Ut extends a.E{constructor(l,f,_,b){if(super(),this.id=l,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.L(f,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield qe(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),l&&(a.e(this,l),l.bounds&&(this.tileBounds=new kt(l.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new a.j(l))}})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.abort(),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(l){return a._(this,void 0,void 0,function*(){const f=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(f,"Tile"),uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};_.request.collectResourceTiming=this._collectResourceTiming;let b="RT";if(l.actor&&l.state!=="expired"){if(l.state==="loading")return new Promise((k,E)=>{l.reloadPromise={resolve:k,reject:E}})}else l.actor=this.dispatcher.getActor(),b="LT";l.abortController=new AbortController;try{const k=yield l.actor.sendAsync({type:b,data:_},l.abortController);if(delete l.abortController,l.aborted)return;this._afterTileLoadWorkerResponse(l,k)}catch(k){if(delete l.abortController,l.aborted)return;if(k&&k.status!==404)throw k;this._afterTileLoadWorkerResponse(l,null)}})}_afterTileLoadWorkerResponse(l,f){if(f&&f.resourceTiming&&(l.resourceTiming=f.resourceTiming),f&&this.map._refreshExpiredTiles&&l.setExpiryData(f),l.loadVectorData(f,this.map.painter),l.reloadPromise){const _=l.reloadPromise;l.reloadPromise=null,this.loadTile(l).then(_.resolve).catch(_.reject)}}abortTile(l){return a._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.actor&&(yield l.actor.sendAsync({type:"AT",data:{uid:l.uid,type:this.type,source:this.id}}))})}unloadTile(l){return a._(this,void 0,void 0,function*(){l.unloadVectorData(),l.actor&&(yield l.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ye extends a.E{constructor(l,f,_,b){super(),this.id=l,this.dispatcher=_,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},f),a.e(this,a.L(f,["url","scheme","tileSize"]))}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield qe(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,l&&(a.e(this,l),l.bounds&&(this.tileBounds=new kt(l.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new a.j(l))}})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(l){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}serialize(){return a.e({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l){return a._(this,void 0,void 0,function*(){const f=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);l.abortController=new AbortController;try{const _=yield F.getImage(this.map._requestManager.transformRequest(f,"Tile"),l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(_&&_.data){this.map._refreshExpiredTiles&&_.cacheControl&&_.expires&&l.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const b=this.map.painter.context,k=b.gl,E=_.data;l.texture=this.map.painter.getTileTexture(E.width),l.texture?l.texture.update(E,{useMipmap:!0}):(l.texture=new ee(b,E,k.RGBA,{useMipmap:!0}),l.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),b.extTextureFilterAnisotropic&&k.texParameterf(k.TEXTURE_2D,b.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,b.extTextureFilterAnisotropicMax)),l.state="loaded"}}catch(_){if(delete l.abortController,l.aborted)l.state="unloaded";else if(_)throw l.state="errored",_}})}abortTile(l){return a._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController)})}unloadTile(l){return a._(this,void 0,void 0,function*(){l.texture&&this.map.painter.saveTileTexture(l.texture)})}hasTransition(){return!1}}class zn extends ye{constructor(l,f,_,b){super(l,f,_,b),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},f),this.encoding=f.encoding||"mapbox",this.redFactor=f.redFactor,this.greenFactor=f.greenFactor,this.blueFactor=f.blueFactor,this.baseShift=f.baseShift}loadTile(l){return a._(this,void 0,void 0,function*(){const f=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_=this.map._requestManager.transformRequest(f,"Tile");l.neighboringTiles=this._getNeighboringTiles(l.tileID),l.abortController=new AbortController;try{const b=yield F.getImage(_,l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(b&&b.data){const k=b.data;this.map._refreshExpiredTiles&&b.cacheControl&&b.expires&&l.setExpiryData({cacheControl:b.cacheControl,expires:b.expires});const E=a.b(k)&&a.S()?k:yield this.readImageNow(k),A={type:this.type,uid:l.uid,source:this.id,rawImageData:E,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!l.actor||l.state==="expired"){l.actor=this.dispatcher.getActor();const B=yield l.actor.sendAsync({type:"LDT",data:A});l.dem=B,l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0,l.state="loaded"}}}catch(b){if(delete l.abortController,l.aborted)l.state="unloaded";else if(b)throw l.state="errored",b}})}readImageNow(l){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.U()){const f=l.width+2,_=l.height+2;try{return new a.R({width:f,height:_},yield a.V(l,-1,-1,f,_))}catch{}}return y.getImageData(l,1)})}_getNeighboringTiles(l){const f=l.canonical,_=Math.pow(2,f.z),b=(f.x-1+_)%_,k=f.x===0?l.wrap-1:l.wrap,E=(f.x+1+_)%_,A=f.x+1===_?l.wrap+1:l.wrap,B={};return B[new a.Q(l.overscaledZ,k,f.z,b,f.y).key]={backfilled:!1},B[new a.Q(l.overscaledZ,A,f.z,E,f.y).key]={backfilled:!1},f.y>0&&(B[new a.Q(l.overscaledZ,k,f.z,b,f.y-1).key]={backfilled:!1},B[new a.Q(l.overscaledZ,l.wrap,f.z,f.x,f.y-1).key]={backfilled:!1},B[new a.Q(l.overscaledZ,A,f.z,E,f.y-1).key]={backfilled:!1}),f.y+1<_&&(B[new a.Q(l.overscaledZ,k,f.z,b,f.y+1).key]={backfilled:!1},B[new a.Q(l.overscaledZ,l.wrap,f.z,f.x,f.y+1).key]={backfilled:!1},B[new a.Q(l.overscaledZ,A,f.z,E,f.y+1).key]={backfilled:!1}),B}unloadTile(l){return a._(this,void 0,void 0,function*(){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded",l.actor&&(yield l.actor.sendAsync({type:"RDT",data:{type:this.type,uid:l.uid,source:this.id}}))})}}class Oe extends a.E{constructor(l,f,_,b){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=_.getActor(),this.setEventedParent(b),this._data=f.data,this._options=a.e({},f),this._collectResourceTiming=f.collectResourceTiming,f.maxzoom!==void 0&&(this.maxzoom=f.maxzoom),f.type&&(this.type=f.type),f.attribution&&(this.attribution=f.attribution),this.promoteId=f.promoteId;const k=a.W/this.tileSize;this.workerOptions=a.e({source:this.id,cluster:f.cluster||!1,geojsonVtOptions:{buffer:(f.buffer!==void 0?f.buffer:128)*k,tolerance:(f.tolerance!==void 0?f.tolerance:.375)*k,extent:a.W,maxZoom:this.maxzoom,lineMetrics:f.lineMetrics||!1,generateId:f.generateId||!1},superclusterOptions:{maxZoom:f.clusterMaxZoom!==void 0?f.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,f.clusterMinPoints||2),extent:a.W,radius:(f.clusterRadius||50)*k,log:!1,generateId:f.generateId||!1},clusterProperties:f.clusterProperties,filter:f.filter},f.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(l){this.map=l,this.load()}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){return this._updateWorkerData(l),this}setClusterOptions(l){return this.workerOptions.cluster=l.cluster,l&&(l.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=l.clusterRadius),l.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=l.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(l){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:l,source:this.id}})}getClusterChildren(l){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:l,source:this.id}})}getClusterLeaves(l,f,_){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:l,limit:f,offset:_}})}_updateWorkerData(l){return a._(this,void 0,void 0,function*(){const f=a.e({type:this.type},this.workerOptions);l?f.dataDiff=l:typeof this._data=="string"?(f.request=this.map._requestManager.transformRequest(y.resolveURL(this._data),"Source"),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"}));try{const _=yield this.actor.sendAsync({type:"LD",data:f});if(this._pendingLoads--,this._removed||_.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let b=null;_.resourceTiming&&_.resourceTiming[this.id]&&(b=_.resourceTiming[this.id].slice(0));const k={dataType:"source"};this._collectResourceTiming&&b&&b.length>0&&a.e(k,{resourceTiming:b}),this.fire(new a.k("data",Object.assign(Object.assign({},k),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},k),{sourceDataType:"content"})))}catch(_){if(this._pendingLoads--,this._removed)return void this.fire(new a.k("dataabort",{dataType:"source"}));this.fire(new a.j(_))}})}loaded(){return this._pendingLoads===0}loadTile(l){return a._(this,void 0,void 0,function*(){const f=l.actor?"RT":"LT";l.actor=this.actor;const _={type:this.type,uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.abortController=new AbortController;const b=yield this.actor.sendAsync({type:f,data:_},l.abortController);delete l.abortController,l.unloadVectorData(),l.aborted||l.loadVectorData(b,this.map.painter,f==="RT")})}abortTile(l){return a._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.aborted=!0})}unloadTile(l){return a._(this,void 0,void 0,function*(){l.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var tt=a.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Kt extends a.E{constructor(l,f,_,b){super(),this.id=l,this.dispatcher=_,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=f}load(l){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const f=yield F.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,f&&f.data&&(this.image=f.data,l&&(this.coordinates=l),this._finishLoading())}catch(f){this._request=null,this._loaded=!0,this.fire(new a.j(f))}})}loaded(){return this._loaded}updateImage(l){return l.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=l.url,this.load(l.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(l){this.coordinates=l;const f=l.map(a.Y.fromLngLat);this.tileID=function(b){let k=1/0,E=1/0,A=-1/0,B=-1/0;for(const pe of b)k=Math.min(k,pe.x),E=Math.min(E,pe.y),A=Math.max(A,pe.x),B=Math.max(B,pe.y);const Z=Math.max(A-k,B-E),X=Math.max(0,Math.floor(-Math.log(Z)/Math.LN2)),Q=Math.pow(2,X);return new a.a0(X,Math.floor((k+A)/2*Q),Math.floor((E+B)/2*Q))}(f),this.minzoom=this.maxzoom=this.tileID.z;const _=f.map(b=>this.tileID.getTilePoint(b)._round());return this._boundsArray=new a.Z,this._boundsArray.emplaceBack(_[0].x,_[0].y,0,0),this._boundsArray.emplaceBack(_[1].x,_[1].y,a.W,0),this._boundsArray.emplaceBack(_[3].x,_[3].y,0,a.W),this._boundsArray.emplaceBack(_[2].x,_[2].y,a.W,a.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const l=this.map.painter.context,f=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ee(l,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let _=!1;for(const b in this.tiles){const k=this.tiles[b];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture,_=!0)}_&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(l){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={}):l.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Un extends Kt{constructor(l,f,_,b){super(l,f,_,b),this.roundZoom=!0,this.type="video",this.options=f}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const l=this.options;this.urls=[];for(const f of l.urls)this.urls.push(this.map._requestManager.transformRequest(f,"Source").url);try{const f=yield a.a2(this.urls);if(this._loaded=!0,!f)return;this.video=f,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(f){this.fire(new a.j(f))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const f=this.video.seekable;l<f.start(0)||l>f.end(0)?this.fire(new a.j(new a.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${f.start(0)} and ${f.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,f=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,f.UNSIGNED_BYTE,this.video)):(this.texture=new ee(l,this.video,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let _=!1;for(const b in this.tiles){const k=this.tiles[b];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture,_=!0)}_&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ur extends Kt{constructor(l,f,_,b){super(l,f,_,b),f.coordinates?Array.isArray(f.coordinates)&&f.coordinates.length===4&&!f.coordinates.some(k=>!Array.isArray(k)||k.length!==2||k.some(E=>typeof E!="number"))||this.fire(new a.j(new a.a1(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.a1(`sources.${l}`,null,'missing required property "coordinates"'))),f.animate&&typeof f.animate!="boolean"&&this.fire(new a.j(new a.a1(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),f.canvas?typeof f.canvas=="string"||f.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.a1(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.a1(`sources.${l}`,null,'missing required property "canvas"'))),this.options=f,this.animate=f.animate===void 0||f.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const f=this.map.painter.context,_=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ee(f,this.canvas,_.RGBA,{premultiply:!0});let b=!1;for(const k in this.tiles){const E=this.tiles[k];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,b=!0)}b&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}}const pr={},Ar=x=>{switch(x){case"geojson":return Oe;case"image":return Kt;case"raster":return ye;case"raster-dem":return zn;case"vector":return Ut;case"video":return Un;case"canvas":return ur}return pr[x]},Pr="RTLPluginLoaded";class go extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Qt()}_syncState(l){return this.status=l,this.dispatcher.broadcast("SRPS",{pluginStatus:l,pluginURL:this.url}).catch(f=>{throw this.status="error",f})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(l){return a._(this,arguments,void 0,function*(f,_=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=y.resolveURL(f),!this.url)throw new Error(`requested url ${f} is invalid`);if(this.status==="unavailable"){if(!_)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.k(Pr))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let hr=null;function vt(){return hr||(hr=new go),hr}class Vr{constructor(l,f){this.timeAdded=0,this.fadeEndTime=0,this.tileID=l,this.uid=a.a3(),this.uses=0,this.tileSize=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(l){const f=l+this.timeAdded;f<this.fadeEndTime||(this.fadeEndTime=f)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(l){this.demTexture&&l.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(l,f,_){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=function(b,k){const E={};if(!k)return E;for(const A of b){const B=A.layerIds.map(Z=>k.getLayer(Z)).filter(Boolean);if(B.length!==0){A.layers=B,A.stateDependentLayerIds&&(A.stateDependentLayers=A.stateDependentLayerIds.map(Z=>B.filter(X=>X.id===Z)[0]));for(const Z of B)E[Z.id]=A}}return E}(l.buckets,f.style),this.hasSymbolBuckets=!1;for(const b in this.buckets){const k=this.buckets[b];if(k instanceof a.a5){if(this.hasSymbolBuckets=!0,!_)break;k.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const b in this.buckets){const k=this.buckets[b];if(k instanceof a.a5&&k.hasRTLText){this.hasRTLText=!0,vt().lazyLoad();break}}this.queryPadding=0;for(const b in this.buckets){const k=this.buckets[b];this.queryPadding=Math.max(this.queryPadding,f.style.getLayer(b).queryRadius(k))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage)}else this.collisionBoxArray=new a.a4}unloadVectorData(){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(l){return this.buckets[l.id]}upload(l){for(const _ in this.buckets){const b=this.buckets[_];b.uploadPending()&&b.upload(l)}const f=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ee(l,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ee(l,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,f,_,b,k,E,A,B,Z,X){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:b,cameraQueryGeometry:k,scale:E,tileSize:this.tileSize,pixelPosMatrix:X,transform:B,params:A,queryPadding:this.queryPadding*Z},l,f,_):{}}querySourceFeatures(l,f){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const b=_.loadVTLayers(),k=f&&f.sourceLayer?f.sourceLayer:"",E=b._geojsonTileLayer||b[k];if(!E)return;const A=a.a6(f&&f.filter),{z:B,x:Z,y:X}=this.tileID.canonical,Q={z:B,x:Z,y:X};for(let pe=0;pe<E.length;pe++){const Se=E.feature(pe);if(A.needGeometry){const be=a.a7(Se,!0);if(!A.filter(new a.a8(this.tileID.overscaledZ),be,this.tileID.canonical))continue}else if(!A.filter(new a.a8(this.tileID.overscaledZ),Se))continue;const ke=_.getId(Se,k),Me=new a.a9(Se,B,Z,X,ke);Me.tile=Q,l.push(Me)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const f=this.expirationTime;if(l.cacheControl){const _=a.aa(l.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const _=Date.now();let b=!1;if(this.expirationTime>_)b=!1;else if(f)if(this.expirationTime<f)b=!0;else{const k=this.expirationTime-f;k?this.expirationTime=_+Math.max(k,3e4):b=!0}else b=!0;b?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(l,f){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(l).length===0)return;const _=this.latestFeatureIndex.loadVTLayers();for(const b in this.buckets){if(!f.style.hasLayer(b))continue;const k=this.buckets[b],E=k.layers[0].sourceLayer||"_geojsonTileLayer",A=_[E],B=l[E];if(!A||!B||Object.keys(B).length===0)continue;k.update(B,A,this.imageAtlas&&this.imageAtlas.patternPositions||{});const Z=f&&f.style&&f.style.getLayer(b);Z&&(this.queryPadding=Math.max(this.queryPadding,Z.queryRadius(k)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<y.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=y.now()+l}setDependencies(l,f){const _={};for(const b of f)_[b]=!0;this.dependencies[l]=_}hasDependency(l,f){for(const _ of l){const b=this.dependencies[_];if(b){for(const k of f)if(b[k])return!0}}return!1}}class or{constructor(l,f){this.max=l,this.onRemove=f,this.reset()}reset(){for(const l in this.data)for(const f of this.data[l])f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value);return this.data={},this.order=[],this}add(l,f,_){const b=l.wrapped().key;this.data[b]===void 0&&(this.data[b]=[]);const k={value:f,timeout:void 0};if(_!==void 0&&(k.timeout=setTimeout(()=>{this.remove(l,k)},_)),this.data[b].push(k),this.order.push(b),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value}getByKey(l){const f=this.data[l];return f?f[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,f){if(!this.has(l))return this;const _=l.wrapped().key,b=f===void 0?0:this.data[_].indexOf(f),k=this.data[_][b];return this.data[_].splice(b,1),k.timeout&&clearTimeout(k.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(k.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}filter(l){const f=[];for(const _ in this.data)for(const b of this.data[_])l(b.value)||f.push(b);for(const _ of f)this.remove(_.value.tileID,_)}}class Kn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,f,_){const b=String(f);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][b]=this.stateChanges[l][b]||{},a.e(this.stateChanges[l][b],_),this.deletedStates[l]===null){this.deletedStates[l]={};for(const k in this.state[l])k!==b&&(this.deletedStates[l][k]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][b]===null){this.deletedStates[l][b]={};for(const k in this.state[l][b])_[k]||(this.deletedStates[l][b][k]=null)}else for(const k in _)this.deletedStates[l]&&this.deletedStates[l][b]&&this.deletedStates[l][b][k]===null&&delete this.deletedStates[l][b][k]}removeFeatureState(l,f,_){if(this.deletedStates[l]===null)return;const b=String(f);if(this.deletedStates[l]=this.deletedStates[l]||{},_&&f!==void 0)this.deletedStates[l][b]!==null&&(this.deletedStates[l][b]=this.deletedStates[l][b]||{},this.deletedStates[l][b][_]=null);else if(f!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][b])for(_ in this.deletedStates[l][b]={},this.stateChanges[l][b])this.deletedStates[l][b][_]=null;else this.deletedStates[l][b]=null;else this.deletedStates[l]=null}getState(l,f){const _=String(f),b=a.e({},(this.state[l]||{})[_],(this.stateChanges[l]||{})[_]);if(this.deletedStates[l]===null)return{};if(this.deletedStates[l]){const k=this.deletedStates[l][f];if(k===null)return{};for(const E in k)delete b[E]}return b}initializeTileState(l,f){l.setFeatureState(this.state,f)}coalesceChanges(l,f){const _={};for(const b in this.stateChanges){this.state[b]=this.state[b]||{};const k={};for(const E in this.stateChanges[b])this.state[b][E]||(this.state[b][E]={}),a.e(this.state[b][E],this.stateChanges[b][E]),k[E]=this.state[b][E];_[b]=k}for(const b in this.deletedStates){this.state[b]=this.state[b]||{};const k={};if(this.deletedStates[b]===null)for(const E in this.state[b])k[E]={},this.state[b][E]={};else for(const E in this.deletedStates[b]){if(this.deletedStates[b][E]===null)this.state[b][E]={};else for(const A of Object.keys(this.deletedStates[b][E]))delete this.state[b][E][A];k[E]=this.state[b][E]}_[b]=_[b]||{},a.e(_[b],k)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const b in l)l[b].setFeatureState(_,f)}}class Yn extends a.E{constructor(l,f,_){super(),this.id=l,this.dispatcher=_,this.on("data",b=>this._dataHandler(b)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((b,k,E,A)=>{const B=new(Ar(k.type))(b,k,E,A);if(B.id!==b)throw new Error(`Expected Source id to be ${b} instead of ${B.id}`);return B})(l,f,_,this),this._tiles={},this._cache=new or(0,b=>this._unloadTile(b)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Kn,this._didEmitContent=!1,this._updated=!1}onAdd(l){this.map=l,this._maxTileCacheSize=l?l._maxTileCacheSize:null,this._maxTileCacheZoomLevels=l?l._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(l)}onRemove(l){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(l)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const l in this._tiles){const f=this._tiles[l];if(f.state!=="loaded"&&f.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(l,f,_){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(l),this._tileLoaded(l,f,_)}catch(b){l.state="errored",b.status!==404?this._source.fire(new a.j(b,{tile:l})):this.update(this.transform,this.terrain)}})}_unloadTile(l){this._source.unloadTile&&this._source.unloadTile(l)}_abortTile(l){this._source.abortTile&&this._source.abortTile(l),this._source.fire(new a.k("dataabort",{tile:l,coord:l.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const f in this._tiles){const _=this._tiles[f];_.upload(l),_.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(l=>l.tileID).sort(Pt).map(l=>l.key)}getRenderableIds(l){const f=[];for(const _ in this._tiles)this._isIdRenderable(_,l)&&f.push(this._tiles[_]);return l?f.sort((_,b)=>{const k=_.tileID,E=b.tileID,A=new a.P(k.canonical.x,k.canonical.y)._rotate(this.transform.angle),B=new a.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return k.overscaledZ-E.overscaledZ||B.y-A.y||B.x-A.x}).map(_=>_.tileID.key):f.map(_=>_.tileID).sort(Pt).map(_=>_.key)}hasRenderableParent(l){const f=this.findLoadedParent(l,0);return!!f&&this._isIdRenderable(f.tileID.key)}_isIdRenderable(l,f){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(f||!this._tiles[l].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)this._tiles[l].state!=="errored"&&this._reloadTile(l,"reloading")}}_reloadTile(l,f){return a._(this,void 0,void 0,function*(){const _=this._tiles[l];_&&(_.state!=="loading"&&(_.state=f),yield this._loadTile(_,l,f))})}_tileLoaded(l,f,_){l.timeAdded=y.now(),_==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(f,l),this.getSource().type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),l.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:l,coord:l.tileID}))}_backfillDEM(l){const f=this.getRenderableIds();for(let b=0;b<f.length;b++){const k=f[b];if(l.neighboringTiles&&l.neighboringTiles[k]){const E=this.getTileByID(k);_(l,E),_(E,l)}}function _(b,k){b.needsHillshadePrepare=!0,b.needsTerrainPrepare=!0;let E=k.tileID.canonical.x-b.tileID.canonical.x;const A=k.tileID.canonical.y-b.tileID.canonical.y,B=Math.pow(2,b.tileID.canonical.z),Z=k.tileID.key;E===0&&A===0||Math.abs(A)>1||(Math.abs(E)>1&&(Math.abs(E+B)===1?E+=B:Math.abs(E-B)===1&&(E-=B)),k.dem&&b.dem&&(b.dem.backfillBorder(k.dem,E,A),b.neighboringTiles&&b.neighboringTiles[Z]&&(b.neighboringTiles[Z].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,f,_,b){for(const k in this._tiles){let E=this._tiles[k];if(b[k]||!E.hasData()||E.tileID.overscaledZ<=f||E.tileID.overscaledZ>_)continue;let A=E.tileID;for(;E&&E.tileID.overscaledZ>f+1;){const Z=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[Z.key],E&&E.hasData()&&(A=Z)}let B=A;for(;B.overscaledZ>f;)if(B=B.scaledTo(B.overscaledZ-1),l[B.key]){b[A.key]=A;break}}}findLoadedParent(l,f){if(l.key in this._loadedParentTiles){const _=this._loadedParentTiles[l.key];return _&&_.tileID.overscaledZ>=f?_:null}for(let _=l.overscaledZ-1;_>=f;_--){const b=l.scaledTo(_),k=this._getLoadedTile(b);if(k)return k}}_getLoadedTile(l){const f=this._tiles[l.key];return f&&f.hasData()?f:this._cache.getByKey(l.wrapped().key)}updateCacheSize(l){const f=Math.ceil(l.width/this._source.tileSize)+1,_=Math.ceil(l.height/this._source.tileSize)+1,b=Math.floor(f*_*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),k=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(k)}handleWrapJump(l){const f=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,f){const _={};for(const b in this._tiles){const k=this._tiles[b];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+f),_[k.tileID.key]=k}this._tiles=_;for(const b in this._timers)clearTimeout(this._timers[b]),delete this._timers[b];for(const b in this._tiles)this._setTileReloadTimer(b,this._tiles[b])}}update(l,f){if(!this._sourceLoaded||this._paused)return;let _;this.transform=l,this.terrain=f,this.updateCacheSize(l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?_=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(X=>new a.Q(X.canonical.z,X.wrap,X.canonical.z,X.canonical.x,X.canonical.y)):(_=l.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:f}),this._source.hasTile&&(_=_.filter(X=>this._source.hasTile(X)))):_=[];const b=l.coveringZoomLevel(this._source),k=Math.max(b-Yn.maxOverzooming,this._source.minzoom),E=Math.max(b+Yn.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const X={};for(const Q of _)if(Q.canonical.z>this._source.minzoom){const pe=Q.scaledTo(Q.canonical.z-1);X[pe.key]=pe;const Se=Q.scaledTo(Math.max(this._source.minzoom,Math.min(Q.canonical.z,5)));X[Se.key]=Se}_=_.concat(Object.values(X))}const A=_.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,A&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const B=this._updateRetainedTiles(_,b);if(sn(this._source.type)){const X={},Q={},pe=Object.keys(B),Se=y.now();for(const ke of pe){const Me=B[ke],be=this._tiles[ke];if(!be||be.fadeEndTime!==0&&be.fadeEndTime<=Se)continue;const Fe=this.findLoadedParent(Me,k);Fe&&(this._addTile(Fe.tileID),X[Fe.tileID.key]=Fe.tileID),Q[ke]=Me}this._retainLoadedChildren(Q,b,E,B);for(const ke in X)B[ke]||(this._coveredTiles[ke]=!0,B[ke]=X[ke]);if(f){const ke={},Me={};for(const be of _)this._tiles[be.key].hasData()?ke[be.key]=be:Me[be.key]=be;for(const be in Me){const Fe=Me[be].children(this._source.maxzoom);this._tiles[Fe[0].key]&&this._tiles[Fe[1].key]&&this._tiles[Fe[2].key]&&this._tiles[Fe[3].key]&&(ke[Fe[0].key]=B[Fe[0].key]=Fe[0],ke[Fe[1].key]=B[Fe[1].key]=Fe[1],ke[Fe[2].key]=B[Fe[2].key]=Fe[2],ke[Fe[3].key]=B[Fe[3].key]=Fe[3],delete Me[be])}for(const be in Me){const Fe=this.findLoadedParent(Me[be],this._source.minzoom);if(Fe){ke[Fe.tileID.key]=B[Fe.tileID.key]=Fe.tileID;for(const Je in ke)ke[Je].isChildOf(Fe.tileID)&&delete ke[Je]}}for(const be in this._tiles)ke[be]||(this._coveredTiles[be]=!0)}}for(const X in B)this._tiles[X].clearFadeHold();const Z=a.ab(this._tiles,B);for(const X of Z){const Q=this._tiles[X];Q.hasSymbolBuckets&&!Q.holdingForFade()?Q.setHoldDuration(this.map._fadeDuration):Q.hasSymbolBuckets&&!Q.symbolFadeFinished()||this._removeTile(X)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(l)}_updateRetainedTiles(l,f){const _={},b={},k=Math.max(f-Yn.maxOverzooming,this._source.minzoom),E=Math.max(f+Yn.maxUnderzooming,this._source.minzoom),A={};for(const B of l){const Z=this._addTile(B);_[B.key]=B,Z.hasData()||f<this._source.maxzoom&&(A[B.key]=B)}this._retainLoadedChildren(A,f,E,_);for(const B of l){let Z=this._tiles[B.key];if(Z.hasData())continue;if(f+1>this._source.maxzoom){const Q=B.children(this._source.maxzoom)[0],pe=this.getTile(Q);if(pe&&pe.hasData()){_[Q.key]=Q;continue}}else{const Q=B.children(this._source.maxzoom);if(_[Q[0].key]&&_[Q[1].key]&&_[Q[2].key]&&_[Q[3].key])continue}let X=Z.wasRequested();for(let Q=B.overscaledZ-1;Q>=k;--Q){const pe=B.scaledTo(Q);if(b[pe.key])break;if(b[pe.key]=!0,Z=this.getTile(pe),!Z&&X&&(Z=this._addTile(pe)),Z){const Se=Z.hasData();if((X||Se)&&(_[pe.key]=pe),X=Z.wasRequested(),Se)break}}}return _}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const f=[];let _,b=this._tiles[l].tileID;for(;b.overscaledZ>0;){if(b.key in this._loadedParentTiles){_=this._loadedParentTiles[b.key];break}f.push(b.key);const k=b.scaledTo(b.overscaledZ-1);if(_=this._getLoadedTile(k),_)break;b=k}for(const k of f)this._loadedParentTiles[k]=_}}_addTile(l){let f=this._tiles[l.key];if(f)return f;f=this._cache.getAndRemove(l),f&&(this._setTileReloadTimer(l.key,f),f.tileID=l,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,f)));const _=f;return f||(f=new Vr(l,this._source.tileSize*l.overscaleFactor()),this._loadTile(f,l.key,f.state)),f.uses++,this._tiles[l.key]=f,_||this._source.fire(new a.k("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f}_setTileReloadTimer(l,f){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const _=f.getExpiryTimeout();_&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},_))}_removeTile(l){const f=this._tiles[l];f&&(f.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),f.uses>0||(f.hasData()&&f.state!=="reloading"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))}_dataHandler(l){const f=l.sourceDataType;l.dataType==="source"&&f==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&f==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(l);this._cache.reset()}tilesIn(l,f,_){const b=[],k=this.transform;if(!k)return b;const E=_?k.getCameraQueryGeometry(l):l,A=l.map(ke=>k.pointCoordinate(ke,this.terrain)),B=E.map(ke=>k.pointCoordinate(ke,this.terrain)),Z=this.getIds();let X=1/0,Q=1/0,pe=-1/0,Se=-1/0;for(const ke of B)X=Math.min(X,ke.x),Q=Math.min(Q,ke.y),pe=Math.max(pe,ke.x),Se=Math.max(Se,ke.y);for(let ke=0;ke<Z.length;ke++){const Me=this._tiles[Z[ke]];if(Me.holdingForFade())continue;const be=Me.tileID,Fe=Math.pow(2,k.zoom-Me.tileID.overscaledZ),Je=f*Me.queryPadding*a.W/Me.tileSize/Fe,Le=[be.getTilePoint(new a.Y(X,Q)),be.getTilePoint(new a.Y(pe,Se))];if(Le[0].x-Je<a.W&&Le[0].y-Je<a.W&&Le[1].x+Je>=0&&Le[1].y+Je>=0){const Ue=A.map(et=>be.getTilePoint(et)),Qe=B.map(et=>be.getTilePoint(et));b.push({tile:Me,tileID:be,queryGeometry:Ue,cameraQueryGeometry:Qe,scale:Fe})}}return b}getVisibleCoordinates(l){const f=this.getRenderableIds(l).map(_=>this._tiles[_].tileID);for(const _ of f)_.posMatrix=this.transform.calculatePosMatrix(_.toUnwrapped());return f}hasTransition(){if(this._source.hasTransition())return!0;if(sn(this._source.type)){const l=y.now();for(const f in this._tiles)if(this._tiles[f].fadeEndTime>=l)return!0}return!1}setFeatureState(l,f,_){this._state.updateState(l=l||"_geojsonTileLayer",f,_)}removeFeatureState(l,f,_){this._state.removeFeatureState(l=l||"_geojsonTileLayer",f,_)}getFeatureState(l,f){return this._state.getState(l=l||"_geojsonTileLayer",f)}setDependencies(l,f,_){const b=this._tiles[l];b&&b.setDependencies(f,_)}reloadTilesForDependencies(l,f){for(const _ in this._tiles)this._tiles[_].hasDependency(l,f)&&this._reloadTile(_,"reloading");this._cache.filter(_=>!_.hasDependency(l,f))}}function Pt(x,l){const f=Math.abs(2*x.wrap)-+(x.wrap<0),_=Math.abs(2*l.wrap)-+(l.wrap<0);return x.overscaledZ-l.overscaledZ||_-f||l.canonical.y-x.canonical.y||l.canonical.x-x.canonical.x}function sn(x){return x==="raster"||x==="image"||x==="video"}Yn.maxOverzooming=10,Yn.maxUnderzooming=3;class mn{constructor(l,f){this.reset(l,f)}reset(l,f){this.points=l||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=a.ac(l,0,1);let f=1,_=this._distances[f];const b=l*this.paddedLength+this.padding;for(;_<b&&f<this._distances.length;)_=this._distances[++f];const k=f-1,E=this._distances[k],A=_-E,B=A>0?(b-E)/A:0;return this.points[k].mult(1-B).add(this.points[f].mult(B))}}function Qn(x,l){let f=!0;return x==="always"||x!=="never"&&l!=="never"||(f=!1),f}class _i{constructor(l,f,_){const b=this.boxCells=[],k=this.circleCells=[];this.xCellCount=Math.ceil(l/_),this.yCellCount=Math.ceil(f/_);for(let E=0;E<this.xCellCount*this.yCellCount;E++)b.push([]),k.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,f,_,b,k){this._forEachCell(f,_,b,k,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(b),this.bboxes.push(k)}insertCircle(l,f,_,b){this._forEachCell(f-b,_-b,f+b,_+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(_),this.circles.push(b)}_insertBoxCell(l,f,_,b,k,E){this.boxCells[k].push(E)}_insertCircleCell(l,f,_,b,k,E){this.circleCells[k].push(E)}_query(l,f,_,b,k,E,A){if(_<0||l>this.width||b<0||f>this.height)return[];const B=[];if(l<=0&&f<=0&&this.width<=_&&this.height<=b){if(k)return[{key:null,x1:l,y1:f,x2:_,y2:b}];for(let Z=0;Z<this.boxKeys.length;Z++)B.push({key:this.boxKeys[Z],x1:this.bboxes[4*Z],y1:this.bboxes[4*Z+1],x2:this.bboxes[4*Z+2],y2:this.bboxes[4*Z+3]});for(let Z=0;Z<this.circleKeys.length;Z++){const X=this.circles[3*Z],Q=this.circles[3*Z+1],pe=this.circles[3*Z+2];B.push({key:this.circleKeys[Z],x1:X-pe,y1:Q-pe,x2:X+pe,y2:Q+pe})}}else this._forEachCell(l,f,_,b,this._queryCell,B,{hitTest:k,overlapMode:E,seenUids:{box:{},circle:{}}},A);return B}query(l,f,_,b){return this._query(l,f,_,b,!1,null)}hitTest(l,f,_,b,k,E){return this._query(l,f,_,b,!0,k,E).length>0}hitTestCircle(l,f,_,b,k){const E=l-_,A=l+_,B=f-_,Z=f+_;if(A<0||E>this.width||Z<0||B>this.height)return!1;const X=[];return this._forEachCell(E,B,A,Z,this._queryCellCircle,X,{hitTest:!0,overlapMode:b,circle:{x:l,y:f,radius:_},seenUids:{box:{},circle:{}}},k),X.length>0}_queryCell(l,f,_,b,k,E,A,B){const{seenUids:Z,hitTest:X,overlapMode:Q}=A,pe=this.boxCells[k];if(pe!==null){const ke=this.bboxes;for(const Me of pe)if(!Z.box[Me]){Z.box[Me]=!0;const be=4*Me,Fe=this.boxKeys[Me];if(l<=ke[be+2]&&f<=ke[be+3]&&_>=ke[be+0]&&b>=ke[be+1]&&(!B||B(Fe))&&(!X||!Qn(Q,Fe.overlapMode))&&(E.push({key:Fe,x1:ke[be],y1:ke[be+1],x2:ke[be+2],y2:ke[be+3]}),X))return!0}}const Se=this.circleCells[k];if(Se!==null){const ke=this.circles;for(const Me of Se)if(!Z.circle[Me]){Z.circle[Me]=!0;const be=3*Me,Fe=this.circleKeys[Me];if(this._circleAndRectCollide(ke[be],ke[be+1],ke[be+2],l,f,_,b)&&(!B||B(Fe))&&(!X||!Qn(Q,Fe.overlapMode))){const Je=ke[be],Le=ke[be+1],Ue=ke[be+2];if(E.push({key:Fe,x1:Je-Ue,y1:Le-Ue,x2:Je+Ue,y2:Le+Ue}),X)return!0}}}return!1}_queryCellCircle(l,f,_,b,k,E,A,B){const{circle:Z,seenUids:X,overlapMode:Q}=A,pe=this.boxCells[k];if(pe!==null){const ke=this.bboxes;for(const Me of pe)if(!X.box[Me]){X.box[Me]=!0;const be=4*Me,Fe=this.boxKeys[Me];if(this._circleAndRectCollide(Z.x,Z.y,Z.radius,ke[be+0],ke[be+1],ke[be+2],ke[be+3])&&(!B||B(Fe))&&!Qn(Q,Fe.overlapMode))return E.push(!0),!0}}const Se=this.circleCells[k];if(Se!==null){const ke=this.circles;for(const Me of Se)if(!X.circle[Me]){X.circle[Me]=!0;const be=3*Me,Fe=this.circleKeys[Me];if(this._circlesCollide(ke[be],ke[be+1],ke[be+2],Z.x,Z.y,Z.radius)&&(!B||B(Fe))&&!Qn(Q,Fe.overlapMode))return E.push(!0),!0}}}_forEachCell(l,f,_,b,k,E,A,B){const Z=this._convertToXCellCoord(l),X=this._convertToYCellCoord(f),Q=this._convertToXCellCoord(_),pe=this._convertToYCellCoord(b);for(let Se=Z;Se<=Q;Se++)for(let ke=X;ke<=pe;ke++)if(k.call(this,l,f,_,b,this.xCellCount*ke+Se,E,A,B))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,f,_,b,k,E){const A=b-l,B=k-f,Z=_+E;return Z*Z>A*A+B*B}_circleAndRectCollide(l,f,_,b,k,E,A){const B=(E-b)/2,Z=Math.abs(l-(b+B));if(Z>B+_)return!1;const X=(A-k)/2,Q=Math.abs(f-(k+X));if(Q>X+_)return!1;if(Z<=B||Q<=X)return!0;const pe=Z-B,Se=Q-X;return pe*pe+Se*Se<=_*_}}function _n(x,l,f,_,b){const k=a.F();return l?(a.J(k,k,[1/b,1/b,1]),f||a.ad(k,k,_.angle)):a.K(k,_.labelPlaneMatrix,x),k}function Nr(x,l,f,_,b){if(l){const k=a.ae(x);return a.J(k,k,[b,b,1]),f||a.ad(k,k,-_.angle),k}return _.glCoordMatrix}function _r(x,l,f){let _;f?(_=[x.x,x.y,f(x.x,x.y),1],a.af(_,_,l)):(_=[x.x,x.y,0,1],at(_,_,l));const b=_[3];return{point:new a.P(_[0]/b,_[1]/b),signedDistanceFromCamera:b}}function Ce(x,l){return .5+x/l*.5}function te(x,l){const f=x[0]/x[3],_=x[1]/x[3];return f>=-l[0]&&f<=l[0]&&_>=-l[1]&&_<=l[1]}function ie(x,l,f,_,b,k,E,A,B,Z){const X=_?x.textSizeData:x.iconSizeData,Q=a.ag(X,f.transform.zoom),pe=[256/f.width*2+1,256/f.height*2+1],Se=_?x.text.dynamicLayoutVertexArray:x.icon.dynamicLayoutVertexArray;Se.clear();const ke=x.lineVertexArray,Me=_?x.text.placedSymbolArray:x.icon.placedSymbolArray,be=f.transform.width/f.transform.height;let Fe=!1;for(let Je=0;Je<Me.length;Je++){const Le=Me.get(Je);if(Le.hidden||Le.writingMode===a.ah.vertical&&!Fe){Ye(Le.numGlyphs,Se);continue}let Ue;if(Fe=!1,Z?(Ue=[Le.anchorX,Le.anchorY,Z(Le.anchorX,Le.anchorY),1],a.af(Ue,Ue,l)):(Ue=[Le.anchorX,Le.anchorY,0,1],at(Ue,Ue,l)),!te(Ue,pe)){Ye(Le.numGlyphs,Se);continue}const Qe=Ce(f.transform.cameraToCenterDistance,Ue[3]),et=a.ai(X,Q,Le),ot=E?et/Qe:et*Qe,_t=new a.P(Le.anchorX,Le.anchorY),dt=_r(_t,b,Z).point,At={projections:{},offsets:{}},Rt=Ae(Le,ot,!1,A,l,b,k,x.glyphOffsetArray,ke,Se,dt,_t,At,be,B,Z);Fe=Rt.useVertical,(Rt.notEnoughRoom||Fe||Rt.needsFlipping&&Ae(Le,ot,!0,A,l,b,k,x.glyphOffsetArray,ke,Se,dt,_t,At,be,B,Z).notEnoughRoom)&&Ye(Le.numGlyphs,Se)}_?x.text.dynamicLayoutVertexBuffer.updateData(Se):x.icon.dynamicLayoutVertexBuffer.updateData(Se)}function le(x,l,f,_,b,k,E,A,B,Z,X,Q,pe){const Se=A.glyphStartIndex+A.numGlyphs,ke=A.lineStartIndex,Me=A.lineStartIndex+A.lineLength,be=l.getoffsetX(A.glyphStartIndex),Fe=l.getoffsetX(Se-1),Je=He(x*be,f,_,b,k,E,A.segment,ke,Me,B,Z,X,Q,pe);if(!Je)return null;const Le=He(x*Fe,f,_,b,k,E,A.segment,ke,Me,B,Z,X,Q,pe);return Le?{first:Je,last:Le}:null}function ge(x,l,f,_){return x===a.ah.horizontal&&Math.abs(f.y-l.y)>Math.abs(f.x-l.x)*_?{useVertical:!0}:(x===a.ah.vertical?l.y<f.y:l.x>f.x)?{needsFlipping:!0}:null}function Ae(x,l,f,_,b,k,E,A,B,Z,X,Q,pe,Se,ke,Me){const be=l/24,Fe=x.lineOffsetX*be,Je=x.lineOffsetY*be;let Le;if(x.numGlyphs>1){const Ue=x.glyphStartIndex+x.numGlyphs,Qe=x.lineStartIndex,et=x.lineStartIndex+x.lineLength,ot=le(be,A,Fe,Je,f,X,Q,x,B,k,pe,ke,Me);if(!ot)return{notEnoughRoom:!0};const _t=_r(ot.first.point,E,Me).point,dt=_r(ot.last.point,E,Me).point;if(_&&!f){const At=ge(x.writingMode,_t,dt,Se);if(At)return At}Le=[ot.first];for(let At=x.glyphStartIndex+1;At<Ue-1;At++)Le.push(He(be*A.getoffsetX(At),Fe,Je,f,X,Q,x.segment,Qe,et,B,k,pe,ke,Me));Le.push(ot.last)}else{if(_&&!f){const Qe=_r(Q,b,Me).point,et=x.lineStartIndex+x.segment+1,ot=new a.P(B.getx(et),B.gety(et)),_t=_r(ot,b,Me),dt=_t.signedDistanceFromCamera>0?_t.point:Be(Q,ot,Qe,1,b,Me),At=ge(x.writingMode,Qe,dt,Se);if(At)return At}const Ue=He(be*A.getoffsetX(x.glyphStartIndex),Fe,Je,f,X,Q,x.segment,x.lineStartIndex,x.lineStartIndex+x.lineLength,B,k,pe,ke,Me);if(!Ue)return{notEnoughRoom:!0};Le=[Ue]}for(const Ue of Le)a.aj(Z,Ue.point,Ue.angle);return{}}function Be(x,l,f,_,b,k){const E=_r(x.add(x.sub(l)._unit()),b,k).point,A=f.sub(E);return f.add(A._mult(_/A.mag()))}function je(x,l){const{projectionCache:f,lineVertexArray:_,labelPlaneMatrix:b,tileAnchorPoint:k,distanceFromAnchor:E,getElevation:A,previousVertex:B,direction:Z,absOffsetX:X}=l;if(f.projections[x])return f.projections[x];const Q=new a.P(_.getx(x),_.gety(x)),pe=_r(Q,b,A);if(pe.signedDistanceFromCamera>0)return f.projections[x]=pe.point,pe.point;const Se=x-Z;return Be(E===0?k:new a.P(_.getx(Se),_.gety(Se)),Q,B,X-E+1,b,A)}function Re(x,l,f){return x._unit()._perp()._mult(l*f)}function ne(x,l,f,_,b,k,E,A){const{projectionCache:B,direction:Z}=A;if(B.offsets[x])return B.offsets[x];const X=f.add(l);if(x+Z<_||x+Z>=b)return B.offsets[x]=X,X;const Q=je(x+Z,A),pe=Re(Q.sub(f),E,Z),Se=f.add(pe),ke=Q.add(pe);return B.offsets[x]=a.ak(k,X,Se,ke)||X,B.offsets[x]}function He(x,l,f,_,b,k,E,A,B,Z,X,Q,pe,Se){const ke=_?x-l:x+l;let Me=ke>0?1:-1,be=0;_&&(Me*=-1,be=Math.PI),Me<0&&(be+=Math.PI);let Fe,Je,Le=Me>0?A+E:A+E+1,Ue=b,Qe=b,et=0,ot=0;const _t=Math.abs(ke),dt=[];let At;for(;et+ot<=_t;){if(Le+=Me,Le<A||Le>=B)return null;et+=ot,Qe=Ue,Je=Fe;const $t={projectionCache:Q,lineVertexArray:Z,labelPlaneMatrix:X,tileAnchorPoint:k,distanceFromAnchor:et,getElevation:Se,previousVertex:Qe,direction:Me,absOffsetX:_t};if(Ue=je(Le,$t),f===0)dt.push(Qe),At=Ue.sub(Qe);else{let fn;const bn=Ue.sub(Qe);fn=bn.mag()===0?Re(je(Le+Me,$t).sub(Ue),f,Me):Re(bn,f,Me),Je||(Je=Qe.add(fn)),Fe=ne(Le,fn,Ue,A,B,Je,f,$t),dt.push(Je),At=Fe.sub(Je)}ot=At.mag()}const Rt=At._mult((_t-et)/ot)._add(Je||Qe),yn=be+Math.atan2(Ue.y-Qe.y,Ue.x-Qe.x);return dt.push(Rt),{point:Rt,angle:pe?yn:0,path:dt}}const Xe=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ye(x,l){for(let f=0;f<x;f++){const _=l.length;l.resize(_+4),l.float32.set(Xe,3*_)}}function at(x,l,f){const _=l[0],b=l[1];return x[0]=f[0]*_+f[4]*b+f[12],x[1]=f[1]*_+f[5]*b+f[13],x[3]=f[3]*_+f[7]*b+f[15],x}const Tt=100;class Xt{constructor(l,f=new _i(l.width+200,l.height+200,25),_=new _i(l.width+200,l.height+200,25)){this.transform=l,this.grid=f,this.ignoredGrid=_,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Tt,this.screenBottomBoundary=l.height+Tt,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(l,f,_,b,k,E){const A=this.projectAndGetPerspectiveRatio(b,l.anchorPointX,l.anchorPointY,E),B=_*A.perspectiveRatio,Z=l.x1*B+A.point.x,X=l.y1*B+A.point.y,Q=l.x2*B+A.point.x,pe=l.y2*B+A.point.y;return!this.isInsideGrid(Z,X,Q,pe)||f!=="always"&&this.grid.hitTest(Z,X,Q,pe,f,k)||A.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[Z,X,Q,pe],offscreen:this.isOffscreen(Z,X,Q,pe)}}placeCollisionCircles(l,f,_,b,k,E,A,B,Z,X,Q,pe,Se,ke){const Me=[],be=new a.P(f.anchorX,f.anchorY),Fe=_r(be,E,ke),Je=Ce(this.transform.cameraToCenterDistance,Fe.signedDistanceFromCamera),Le=(X?k/Je:k*Je)/a.ao,Ue=_r(be,A,ke).point,Qe=le(Le,b,f.lineOffsetX*Le,f.lineOffsetY*Le,!1,Ue,be,f,_,A,{projections:{},offsets:{}},!1,ke);let et=!1,ot=!1,_t=!0;if(Qe){const dt=.5*pe*Je+Se,At=new a.P(-100,-100),Rt=new a.P(this.screenRightBoundary,this.screenBottomBoundary),yn=new mn,$t=Qe.first,fn=Qe.last;let bn=[];for(let xn=$t.path.length-1;xn>=1;xn--)bn.push($t.path[xn]);for(let xn=1;xn<fn.path.length;xn++)bn.push(fn.path[xn]);const Nn=2.5*dt;if(B){const xn=bn.map(Tn=>_r(Tn,B,ke));bn=xn.some(Tn=>Tn.signedDistanceFromCamera<=0)?[]:xn.map(Tn=>Tn.point)}let gn=[];if(bn.length>0){const xn=bn[0].clone(),Tn=bn[0].clone();for(let $r=1;$r<bn.length;$r++)xn.x=Math.min(xn.x,bn[$r].x),xn.y=Math.min(xn.y,bn[$r].y),Tn.x=Math.max(Tn.x,bn[$r].x),Tn.y=Math.max(Tn.y,bn[$r].y);gn=xn.x>=At.x&&Tn.x<=Rt.x&&xn.y>=At.y&&Tn.y<=Rt.y?[bn]:Tn.x<At.x||xn.x>Rt.x||Tn.y<At.y||xn.y>Rt.y?[]:a.al([bn],At.x,At.y,Rt.x,Rt.y)}for(const xn of gn){yn.reset(xn,.25*dt);let Tn=0;Tn=yn.length<=.5*dt?1:Math.ceil(yn.paddedLength/Nn)+1;for(let $r=0;$r<Tn;$r++){const ir=$r/Math.max(Tn-1,1),Ji=yn.lerp(ir),ri=Ji.x+Tt,Cr=Ji.y+Tt;Me.push(ri,Cr,dt,0);const ii=ri-dt,Yi=Cr-dt,Vo=ri+dt,vs=Cr+dt;if(_t=_t&&this.isOffscreen(ii,Yi,Vo,vs),ot=ot||this.isInsideGrid(ii,Yi,Vo,vs),l!=="always"&&this.grid.hitTestCircle(ri,Cr,dt,l,Q)&&(et=!0,!Z))return{circles:[],offscreen:!1,collisionDetected:et}}}}return{circles:!Z&&et||!ot||Je<this.perspectiveRatioCutoff?[]:Me,offscreen:_t,collisionDetected:et}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let _=1/0,b=1/0,k=-1/0,E=-1/0;for(const X of l){const Q=new a.P(X.x+Tt,X.y+Tt);_=Math.min(_,Q.x),b=Math.min(b,Q.y),k=Math.max(k,Q.x),E=Math.max(E,Q.y),f.push(Q)}const A=this.grid.query(_,b,k,E).concat(this.ignoredGrid.query(_,b,k,E)),B={},Z={};for(const X of A){const Q=X.key;if(B[Q.bucketInstanceId]===void 0&&(B[Q.bucketInstanceId]={}),B[Q.bucketInstanceId][Q.featureIndex])continue;const pe=[new a.P(X.x1,X.y1),new a.P(X.x2,X.y1),new a.P(X.x2,X.y2),new a.P(X.x1,X.y2)];a.am(f,pe)&&(B[Q.bucketInstanceId][Q.featureIndex]=!0,Z[Q.bucketInstanceId]===void 0&&(Z[Q.bucketInstanceId]=[]),Z[Q.bucketInstanceId].push(Q.featureIndex))}return Z}insertCollisionBox(l,f,_,b,k,E){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:b,featureIndex:k,collisionGroupID:E,overlapMode:f},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,f,_,b,k,E){const A=_?this.ignoredGrid:this.grid,B={bucketInstanceId:b,featureIndex:k,collisionGroupID:E,overlapMode:f};for(let Z=0;Z<l.length;Z+=4)A.insertCircle(B,l[Z],l[Z+1],l[Z+2])}projectAndGetPerspectiveRatio(l,f,_,b){let k;return b?(k=[f,_,b(f,_),1],a.af(k,k,l)):(k=[f,_,0,1],at(k,k,l)),{point:new a.P((k[0]/k[3]+1)/2*this.transform.width+Tt,(-k[1]/k[3]+1)/2*this.transform.height+Tt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/k[3]*.5}}isOffscreen(l,f,_,b){return _<Tt||l>=this.screenRightBoundary||b<Tt||f>this.screenBottomBoundary}isInsideGrid(l,f,_,b){return _>=0&&l<this.gridRightBoundary&&b>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const l=a.an([]);return a.H(l,l,[-100,-100,0]),l}}function hn(x,l,f){return l*(a.W/(x.tileSize*Math.pow(2,f-x.tileID.overscaledZ)))}class vn{constructor(l,f,_,b){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):b&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class Fn{constructor(l,f,_,b,k){this.text=new vn(l?l.text:null,f,_,k),this.icon=new vn(l?l.icon:null,f,b,k)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class vr{constructor(l,f,_){this.text=l,this.icon=f,this.skipFade=_}}class Hr{constructor(){this.invProjMatrix=a.F(),this.viewportMatrix=a.F(),this.circles=[]}}class wn{constructor(l,f,_,b,k){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=_,this.bucketIndex=b,this.tileID=k}}class zr{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:_=>_.collisionGroupID===f}}return this.collisionGroups[l]}}function ni(x,l,f,_,b){const{horizontalAlign:k,verticalAlign:E}=a.at(x);return new a.P(-(k-.5)*l+_[0]*b,-(E-.5)*f+_[1]*b)}function Ci(x,l,f,_,b,k){const{x1:E,x2:A,y1:B,y2:Z,anchorPointX:X,anchorPointY:Q}=x,pe=new a.P(l,f);return _&&pe._rotate(b?k:-k),{x1:E+pe.x,y1:B+pe.y,x2:A+pe.x,y2:Z+pe.y,anchorPointX:X,anchorPointY:Q}}class zi{constructor(l,f,_,b,k){this.transform=l.clone(),this.terrain=f,this.collisionIndex=new Xt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=_,this.retainedQueryData={},this.collisionGroups=new zr(b),this.collisionCircleArrays={},this.prevPlacement=k,k&&(k.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,f,_,b){const k=_.getBucket(f),E=_.latestFeatureIndex;if(!k||!E||f.id!==k.layerIds[0])return;const A=_.collisionBoxArray,B=k.layers[0].layout,Z=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),X=_.tileSize/a.W,Q=this.transform.calculatePosMatrix(_.tileID.toUnwrapped()),pe=B.get("text-pitch-alignment")==="map",Se=B.get("text-rotation-alignment")==="map",ke=hn(_,1,this.transform.zoom),Me=_n(Q,pe,Se,this.transform,ke);let be=null;if(pe){const Je=Nr(Q,pe,Se,this.transform,ke);be=a.K([],this.transform.labelPlaneMatrix,Je)}this.retainedQueryData[k.bucketInstanceId]=new wn(k.bucketInstanceId,E,k.sourceLayerIndex,k.index,_.tileID);const Fe={bucket:k,layout:B,posMatrix:Q,textLabelPlaneMatrix:Me,labelToScreenMatrix:be,scale:Z,textPixelRatio:X,holdingForFade:_.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:a.ag(k.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(k.sourceID)};if(b)for(const Je of k.sortKeyRanges){const{sortKey:Le,symbolInstanceStart:Ue,symbolInstanceEnd:Qe}=Je;l.push({sortKey:Le,symbolInstanceStart:Ue,symbolInstanceEnd:Qe,parameters:Fe})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:k.symbolInstances.length,parameters:Fe})}attemptAnchorPlacement(l,f,_,b,k,E,A,B,Z,X,Q,pe,Se,ke,Me,be){const Fe=a.ap[l.textAnchor],Je=[l.textOffset0,l.textOffset1],Le=ni(Fe,_,b,Je,k),Ue=this.collisionIndex.placeCollisionBox(Ci(f,Le.x,Le.y,E,A,this.transform.angle),Q,B,Z,X.predicate,be);if((!Me||this.collisionIndex.placeCollisionBox(Ci(Me,Le.x,Le.y,E,A,this.transform.angle),Q,B,Z,X.predicate,be).box.length!==0)&&Ue.box.length>0){let Qe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[pe.crossTileID]&&this.prevPlacement.placements[pe.crossTileID]&&this.prevPlacement.placements[pe.crossTileID].text&&(Qe=this.prevPlacement.variableOffsets[pe.crossTileID].anchor),pe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[pe.crossTileID]={textOffset:Je,width:_,height:b,anchor:Fe,textBoxScale:k,prevAnchor:Qe},this.markUsedJustification(Se,Fe,pe,ke),Se.allowVerticalPlacement&&(this.markUsedOrientation(Se,ke,pe),this.placedOrientations[pe.crossTileID]=ke),{shift:Le,placedGlyphBoxes:Ue}}}placeLayerBucketPart(l,f,_){const{bucket:b,layout:k,posMatrix:E,textLabelPlaneMatrix:A,labelToScreenMatrix:B,textPixelRatio:Z,holdingForFade:X,collisionBoxArray:Q,partiallyEvaluatedTextSize:pe,collisionGroup:Se}=l.parameters,ke=k.get("text-optional"),Me=k.get("icon-optional"),be=a.aq(k,"text-overlap","text-allow-overlap"),Fe=be==="always",Je=a.aq(k,"icon-overlap","icon-allow-overlap"),Le=Je==="always",Ue=k.get("text-rotation-alignment")==="map",Qe=k.get("text-pitch-alignment")==="map",et=k.get("icon-text-fit")!=="none",ot=k.get("symbol-z-order")==="viewport-y",_t=Fe&&(Le||!b.hasIconData()||Me),dt=Le&&(Fe||!b.hasTextData()||ke);!b.collisionArrays&&Q&&b.deserializeCollisionBoxes(Q);const At=this.retainedQueryData[b.bucketInstanceId].tileID,Rt=this.terrain?($t,fn)=>this.terrain.getElevation(At,$t,fn):null,yn=($t,fn)=>{var bn,Nn;if(f[$t.crossTileID])return;if(X)return void(this.placements[$t.crossTileID]=new vr(!1,!1,!1));let gn=!1,xn=!1,Tn=!0,$r=null,ir={box:null,offscreen:null},Ji={box:null,offscreen:null},ri=null,Cr=null,ii=null,Yi=0,Vo=0,vs=0;fn.textFeatureIndex?Yi=fn.textFeatureIndex:$t.useRuntimeCollisionCircles&&(Yi=$t.featureIndex),fn.verticalTextFeatureIndex&&(Vo=fn.verticalTextFeatureIndex);const il=fn.textBox;if(il){const Kr=Xr=>{let Mr=a.ah.horizontal;if(b.allowVerticalPlacement&&!Xr&&this.prevPlacement){const uo=this.prevPlacement.placedOrientations[$t.crossTileID];uo&&(this.placedOrientations[$t.crossTileID]=uo,Mr=uo,this.markUsedOrientation(b,Mr,$t))}return Mr},Tr=(Xr,Mr)=>{if(b.allowVerticalPlacement&&$t.numVerticalGlyphVertices>0&&fn.verticalTextBox){for(const uo of b.writingModes)if(uo===a.ah.vertical?(ir=Mr(),Ji=ir):ir=Xr(),ir&&ir.box&&ir.box.length)break}else ir=Xr()},xr=$t.textAnchorOffsetStartIndex,co=$t.textAnchorOffsetEndIndex;if(co===xr){const Xr=(Mr,uo)=>{const Jr=this.collisionIndex.placeCollisionBox(Mr,be,Z,E,Se.predicate,Rt);return Jr&&Jr.box&&Jr.box.length&&(this.markUsedOrientation(b,uo,$t),this.placedOrientations[$t.crossTileID]=uo),Jr};Tr(()=>Xr(il,a.ah.horizontal),()=>{const Mr=fn.verticalTextBox;return b.allowVerticalPlacement&&$t.numVerticalGlyphVertices>0&&Mr?Xr(Mr,a.ah.vertical):{box:null,offscreen:null}}),Kr(ir&&ir.box&&ir.box.length)}else{let Xr=a.ap[(Nn=(bn=this.prevPlacement)===null||bn===void 0?void 0:bn.variableOffsets[$t.crossTileID])===null||Nn===void 0?void 0:Nn.anchor];const Mr=(Jr,jr,_u)=>{const _f=Jr.x2-Jr.x1,Rs=Jr.y2-Jr.y1,$s=$t.textBoxScale,rc=et&&Je==="never"?jr:null;let xs={box:[],offscreen:!1},gu=be==="never"?1:2,gf="never";Xr&&gu++;for(let yu=0;yu<gu;yu++){for(let bu=xr;bu<co;bu++){const ic=b.textAnchorOffsets.get(bu);if(Xr&&ic.textAnchor!==Xr)continue;const vu=this.attemptAnchorPlacement(ic,Jr,_f,Rs,$s,Ue,Qe,Z,E,Se,gf,$t,b,_u,rc,Rt);if(vu&&(xs=vu.placedGlyphBoxes,xs&&xs.box&&xs.box.length))return gn=!0,$r=vu.shift,xs}Xr?Xr=null:gf=be}return xs};Tr(()=>Mr(il,fn.iconBox,a.ah.horizontal),()=>{const Jr=fn.verticalTextBox;return b.allowVerticalPlacement&&!(ir&&ir.box&&ir.box.length)&&$t.numVerticalGlyphVertices>0&&Jr?Mr(Jr,fn.verticalIconBox,a.ah.vertical):{box:null,offscreen:null}}),ir&&(gn=ir.box,Tn=ir.offscreen);const uo=Kr(ir&&ir.box);if(!gn&&this.prevPlacement){const Jr=this.prevPlacement.variableOffsets[$t.crossTileID];Jr&&(this.variableOffsets[$t.crossTileID]=Jr,this.markUsedJustification(b,Jr.anchor,$t,uo))}}}if(ri=ir,gn=ri&&ri.box&&ri.box.length>0,Tn=ri&&ri.offscreen,$t.useRuntimeCollisionCircles){const Kr=b.text.placedSymbolArray.get($t.centerJustifiedTextSymbolIndex),Tr=a.ai(b.textSizeData,pe,Kr),xr=k.get("text-padding");Cr=this.collisionIndex.placeCollisionCircles(be,Kr,b.lineVertexArray,b.glyphOffsetArray,Tr,E,A,B,_,Qe,Se.predicate,$t.collisionCircleDiameter,xr,Rt),Cr.circles.length&&Cr.collisionDetected&&!_&&a.w("Collisions detected, but collision boxes are not shown"),gn=Fe||Cr.circles.length>0&&!Cr.collisionDetected,Tn=Tn&&Cr.offscreen}if(fn.iconFeatureIndex&&(vs=fn.iconFeatureIndex),fn.iconBox){const Kr=Tr=>{const xr=et&&$r?Ci(Tr,$r.x,$r.y,Ue,Qe,this.transform.angle):Tr;return this.collisionIndex.placeCollisionBox(xr,Je,Z,E,Se.predicate,Rt)};Ji&&Ji.box&&Ji.box.length&&fn.verticalIconBox?(ii=Kr(fn.verticalIconBox),xn=ii.box.length>0):(ii=Kr(fn.iconBox),xn=ii.box.length>0),Tn=Tn&&ii.offscreen}const ws=ke||$t.numHorizontalGlyphVertices===0&&$t.numVerticalGlyphVertices===0,qo=Me||$t.numIconVertices===0;if(ws||qo?qo?ws||(xn=xn&&gn):gn=xn&&gn:xn=gn=xn&&gn,gn&&ri&&ri.box&&this.collisionIndex.insertCollisionBox(ri.box,be,k.get("text-ignore-placement"),b.bucketInstanceId,Ji&&Ji.box&&Vo?Vo:Yi,Se.ID),xn&&ii&&this.collisionIndex.insertCollisionBox(ii.box,Je,k.get("icon-ignore-placement"),b.bucketInstanceId,vs,Se.ID),Cr&&(gn&&this.collisionIndex.insertCollisionCircles(Cr.circles,be,k.get("text-ignore-placement"),b.bucketInstanceId,Yi,Se.ID),_)){const Kr=b.bucketInstanceId;let Tr=this.collisionCircleArrays[Kr];Tr===void 0&&(Tr=this.collisionCircleArrays[Kr]=new Hr);for(let xr=0;xr<Cr.circles.length;xr+=4)Tr.circles.push(Cr.circles[xr+0]),Tr.circles.push(Cr.circles[xr+1]),Tr.circles.push(Cr.circles[xr+2]),Tr.circles.push(Cr.collisionDetected?1:0)}if($t.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(b.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[$t.crossTileID]=new vr(gn||_t,xn||dt,Tn||b.justReloaded),f[$t.crossTileID]=!0};if(ot){if(l.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const $t=b.getSortedSymbolIndexes(this.transform.angle);for(let fn=$t.length-1;fn>=0;--fn){const bn=$t[fn];yn(b.symbolInstances.get(bn),b.collisionArrays[bn])}}else for(let $t=l.symbolInstanceStart;$t<l.symbolInstanceEnd;$t++)yn(b.symbolInstances.get($t),b.collisionArrays[$t]);if(_&&b.bucketInstanceId in this.collisionCircleArrays){const $t=this.collisionCircleArrays[b.bucketInstanceId];a.ar($t.invProjMatrix,E),$t.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(l,f,_,b){let k;k=b===a.ah.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[a.as(f)];const E=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const A of E)A>=0&&(l.text.placedSymbolArray.get(A).crossTileID=k>=0&&A!==k?0:_.crossTileID)}markUsedOrientation(l,f,_){const b=f===a.ah.horizontal||f===a.ah.horizontalOnly?f:0,k=f===a.ah.vertical?f:0,E=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const A of E)l.text.placedSymbolArray.get(A).placedOrientation=b;_.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=k)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let _=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const b=f?f.symbolFadeChange(l):1,k=f?f.opacities:{},E=f?f.variableOffsets:{},A=f?f.placedOrientations:{};for(const B in this.placements){const Z=this.placements[B],X=k[B];X?(this.opacities[B]=new Fn(X,b,Z.text,Z.icon),_=_||Z.text!==X.text.placed||Z.icon!==X.icon.placed):(this.opacities[B]=new Fn(null,b,Z.text,Z.icon,Z.skipFade),_=_||Z.text||Z.icon)}for(const B in k){const Z=k[B];if(!this.opacities[B]){const X=new Fn(Z,b,!1,!1);X.isHidden()||(this.opacities[B]=X,_=_||Z.text.placed||Z.icon.placed)}}for(const B in E)this.variableOffsets[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.variableOffsets[B]=E[B]);for(const B in A)this.placedOrientations[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.placedOrientations[B]=A[B]);if(f&&f.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");_?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)}updateLayerOpacities(l,f){const _={};for(const b of f){const k=b.getBucket(l);k&&b.latestFeatureIndex&&l.id===k.layerIds[0]&&this.updateBucketOpacities(k,_,b.collisionBoxArray)}}updateBucketOpacities(l,f,_){l.hasTextData()&&(l.text.opacityVertexArray.clear(),l.text.hasVisibleVertices=!1),l.hasIconData()&&(l.icon.opacityVertexArray.clear(),l.icon.hasVisibleVertices=!1),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const b=l.layers[0],k=b.layout,E=new Fn(null,0,!1,!1,!0),A=k.get("text-allow-overlap"),B=k.get("icon-allow-overlap"),Z=b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"),X=k.get("text-rotation-alignment")==="map",Q=k.get("text-pitch-alignment")==="map",pe=k.get("icon-text-fit")!=="none",Se=new Fn(null,0,A&&(B||!l.hasIconData()||k.get("icon-optional")),B&&(A||!l.hasTextData()||k.get("text-optional")),!0);!l.collisionArrays&&_&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(_);const ke=(Me,be,Fe)=>{for(let Je=0;Je<be/4;Je++)Me.opacityVertexArray.emplaceBack(Fe);Me.hasVisibleVertices=Me.hasVisibleVertices||Fe!==$a};for(let Me=0;Me<l.symbolInstances.length;Me++){const be=l.symbolInstances.get(Me),{numHorizontalGlyphVertices:Fe,numVerticalGlyphVertices:Je,crossTileID:Le}=be;let Ue=this.opacities[Le];f[Le]?Ue=E:Ue||(Ue=Se,this.opacities[Le]=Ue),f[Le]=!0;const Qe=be.numIconVertices>0,et=this.placedOrientations[be.crossTileID],ot=et===a.ah.vertical,_t=et===a.ah.horizontal||et===a.ah.horizontalOnly;if(Fe>0||Je>0){const dt=Di(Ue.text);ke(l.text,Fe,ot?$a:dt),ke(l.text,Je,_t?$a:dt);const At=Ue.text.isHidden();[be.rightJustifiedTextSymbolIndex,be.centerJustifiedTextSymbolIndex,be.leftJustifiedTextSymbolIndex].forEach($t=>{$t>=0&&(l.text.placedSymbolArray.get($t).hidden=At||ot?1:0)}),be.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(be.verticalPlacedTextSymbolIndex).hidden=At||_t?1:0);const Rt=this.variableOffsets[be.crossTileID];Rt&&this.markUsedJustification(l,Rt.anchor,be,et);const yn=this.placedOrientations[be.crossTileID];yn&&(this.markUsedJustification(l,"left",be,yn),this.markUsedOrientation(l,yn,be))}if(Qe){const dt=Di(Ue.icon),At=!(pe&&be.verticalPlacedIconSymbolIndex&&ot);be.placedIconSymbolIndex>=0&&(ke(l.icon,be.numIconVertices,At?dt:$a),l.icon.placedSymbolArray.get(be.placedIconSymbolIndex).hidden=Ue.icon.isHidden()),be.verticalPlacedIconSymbolIndex>=0&&(ke(l.icon,be.numVerticalIconVertices,At?$a:dt),l.icon.placedSymbolArray.get(be.verticalPlacedIconSymbolIndex).hidden=Ue.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const dt=l.collisionArrays[Me];if(dt){let At=new a.P(0,0);if(dt.textBox||dt.verticalTextBox){let yn=!0;if(Z){const $t=this.variableOffsets[Le];$t?(At=ni($t.anchor,$t.width,$t.height,$t.textOffset,$t.textBoxScale),X&&At._rotate(Q?this.transform.angle:-this.transform.angle)):yn=!1}dt.textBox&&di(l.textCollisionBox.collisionVertexArray,Ue.text.placed,!yn||ot,At.x,At.y),dt.verticalTextBox&&di(l.textCollisionBox.collisionVertexArray,Ue.text.placed,!yn||_t,At.x,At.y)}const Rt=!!(!_t&&dt.verticalIconBox);dt.iconBox&&di(l.iconCollisionBox.collisionVertexArray,Ue.icon.placed,Rt,pe?At.x:0,pe?At.y:0),dt.verticalIconBox&&di(l.iconCollisionBox.collisionVertexArray,Ue.icon.placed,!Rt,pe?At.x:0,pe?At.y:0)}}}if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.text.opacityVertexArray.length!==l.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${l.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${l.text.layoutVertexArray.length}) / 4`);if(l.icon.opacityVertexArray.length!==l.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${l.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${l.icon.layoutVertexArray.length}) / 4`);if(l.bucketInstanceId in this.collisionCircleArrays){const Me=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Me.invProjMatrix,l.placementViewportMatrix=Me.viewportMatrix,l.collisionCircleArray=Me.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,f){const _=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*_>l}setStale(){this.stale=!0}}function di(x,l,f,_,b){x.emplaceBack(l?1:0,f?1:0,_||0,b||0),x.emplaceBack(l?1:0,f?1:0,_||0,b||0),x.emplaceBack(l?1:0,f?1:0,_||0,b||0),x.emplaceBack(l?1:0,f?1:0,_||0,b||0)}const Bo=Math.pow(2,25),Ph=Math.pow(2,24),Ad=Math.pow(2,17),nr=Math.pow(2,16),Bc=Math.pow(2,9),Oc=Math.pow(2,8),Wi=Math.pow(2,1);function Di(x){if(x.opacity===0&&!x.placed)return 0;if(x.opacity===1&&x.placed)return 4294967295;const l=x.placed?1:0,f=Math.floor(127*x.opacity);return f*Bo+l*Ph+f*Ad+l*nr+f*Bc+l*Oc+f*Wi+l}const $a=0;class ao{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&!l.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,f,_,b,k){const E=this._bucketParts;for(;this._currentTileIndex<l.length;)if(f.getBucketParts(E,b,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,k())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((A,B)=>A.sortKey-B.sortKey));this._currentPartIndex<E.length;)if(f.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,k())return!0;return!1}}class lo{constructor(l,f,_,b,k,E,A,B){this.placement=new zi(l,f,E,A,B),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=b,this._showCollisionBoxes=k,this._done=!1}isDone(){return this._done}continuePlacement(l,f,_){const b=y.now(),k=()=>!this._forceFullPlacement&&y.now()-b>2;for(;this._currentPlacementIndex>=0;){const E=f[l[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=A)&&(!E.maxzoom||E.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new ao(E)),this._inProgressLayer.continuePlacement(_[E.source],this.placement,this._showCollisionBoxes,E,k))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const Qs=512/a.W/2;class yl{constructor(l,f,_){this.tileID=l,this.bucketInstanceId=_,this._symbolsByKey={};const b=new Map;for(let k=0;k<f.length;k++){const E=f.get(k),A=E.key,B=b.get(A);B?B.push(E):b.set(A,[E])}for(const[k,E]of b){const A={positions:E.map(B=>({x:Math.floor(B.anchorX*Qs),y:Math.floor(B.anchorY*Qs)})),crossTileIDs:E.map(B=>B.crossTileID)};if(A.positions.length>128){const B=new a.au(A.positions.length,16,Uint16Array);for(const{x:Z,y:X}of A.positions)B.add(Z,X);B.finish(),delete A.positions,A.index=B}this._symbolsByKey[k]=A}}getScaledCoordinates(l,f){const{x:_,y:b,z:k}=this.tileID.canonical,{x:E,y:A,z:B}=f.canonical,Z=Qs/Math.pow(2,B-k),X=(A*a.W+l.anchorY)*Z,Q=b*a.W*Qs;return{x:Math.floor((E*a.W+l.anchorX)*Z-_*a.W*Qs),y:Math.floor(X-Q)}}findMatches(l,f,_){const b=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z);for(let k=0;k<l.length;k++){const E=l.get(k);if(E.crossTileID)continue;const A=this._symbolsByKey[E.key];if(!A)continue;const B=this.getScaledCoordinates(E,f);if(A.index){const Z=A.index.range(B.x-b,B.y-b,B.x+b,B.y+b).sort();for(const X of Z){const Q=A.crossTileIDs[X];if(!_[Q]){_[Q]=!0,E.crossTileID=Q;break}}}else if(A.positions)for(let Z=0;Z<A.positions.length;Z++){const X=A.positions[Z],Q=A.crossTileIDs[Z];if(Math.abs(X.x-B.x)<=b&&Math.abs(X.y-B.y)<=b&&!_[Q]){_[Q]=!0,E.crossTileID=Q;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:l})=>l)}}class Wr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Fa{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const f=Math.round((l-this.lng)/360);if(f!==0)for(const _ in this.indexes){const b=this.indexes[_],k={};for(const E in b){const A=b[E];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+f),k[A.tileID.key]=A}this.indexes[_]=k}this.lng=l}addBucket(l,f,_){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let k=0;k<f.symbolInstances.length;k++)f.symbolInstances.get(k).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const b=this.usedCrossTileIDs[l.overscaledZ];for(const k in this.indexes){const E=this.indexes[k];if(Number(k)>l.overscaledZ)for(const A in E){const B=E[A];B.tileID.isChildOf(l)&&B.findMatches(f.symbolInstances,l,b)}else{const A=E[l.scaledTo(Number(k)).key];A&&A.findMatches(f.symbolInstances,l,b)}}for(let k=0;k<f.symbolInstances.length;k++){const E=f.symbolInstances.get(k);E.crossTileID||(E.crossTileID=_.generate(),b[E.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new yl(l,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(l,f){for(const _ of f.getCrossTileIDsLists())for(const b of _)delete this.usedCrossTileIDs[l][b]}removeStaleBuckets(l){let f=!1;for(const _ in this.indexes){const b=this.indexes[_];for(const k in b)l[b[k].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,b[k]),delete b[k],f=!0)}return f}}class ps{constructor(){this.layerIndexes={},this.crossTileIDs=new Wr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,f,_){let b=this.layerIndexes[l.id];b===void 0&&(b=this.layerIndexes[l.id]=new Fa);let k=!1;const E={};b.handleWrapJump(_);for(const A of f){const B=A.getBucket(l);B&&l.id===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(A.tileID,B,this.crossTileIDs)&&(k=!0),E[B.bucketInstanceId]=!0)}return b.removeStaleBuckets(E)&&(k=!0),k}pruneUnusedLayers(l){const f={};l.forEach(_=>{f[_]=!0});for(const _ in this.layerIndexes)f[_]||delete this.layerIndexes[_]}}const Sr=(x,l)=>a.t(x,l&&l.filter(f=>f.identifier!=="source.canvas")),bl=a.av();class Ki extends a.E{constructor(l,f={}){super(),this._rtlPluginLoaded=()=>{for(const _ in this.sourceCaches){const b=this.sourceCaches[_].getSource().type;b!=="vector"&&b!=="geojson"||this.sourceCaches[_].reload()}},this.map=l,this.dispatcher=new Mt(Nt(),l._getMapId()),this.dispatcher.registerMessageHandler("GG",(_,b)=>this.getGlyphs(_,b)),this.dispatcher.registerMessageHandler("GI",(_,b)=>this.getImages(_,b)),this.imageManager=new Ee,this.imageManager.setEventedParent(this),this.glyphManager=new Ie(l._requestManager,f.localIdeographFontFamily),this.lineAtlas=new lt(256,512),this.crossTileSymbolIndex=new ps,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.ax()),vt().on(Pr,this._rtlPluginLoaded),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const b=this.sourceCaches[_.sourceId];if(!b)return;const k=b.getSource();if(k&&k.vectorLayerIds)for(const E in this._layers){const A=this._layers[E];A.source===k.id&&this._validateLayer(A)}})}loadURL(l,f={},_){this.fire(new a.k("dataloading",{dataType:"style"})),f.validate=typeof f.validate!="boolean"||f.validate;const b=this.map._requestManager.transformRequest(l,"Style");this._loadStyleRequest=new AbortController,a.h(b,this._loadStyleRequest).then(k=>{this._loadStyleRequest=null,this._load(k.data,f,_)}).catch(k=>{this._loadStyleRequest=null,k&&this.fire(new a.j(k))})}loadJSON(l,f={},_){this.fire(new a.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,y.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,f.validate=f.validate!==!1,this._load(l,f,_)}).catch(()=>{})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(bl,{validate:!1})}_load(l,f,_){var b;const k=f.transformStyle?f.transformStyle(_,l):l;if(!f.validate||!Sr(this,a.x(k))){this._loaded=!0,this.stylesheet=k;for(const E in k.sources)this.addSource(E,k.sources[E],{validate:!1});k.sprite?this._loadSprite(k.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(k.glyphs),this._createLayers(),this.light=new nt(this.stylesheet.light),this.map.setTerrain((b=this.stylesheet.terrain)!==null&&b!==void 0?b:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const l=a.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",l),this._order=l.map(f=>f.id),this._layers={},this._serializedLayers=null;for(const f of l){const _=a.az(f);_.setEventedParent(this,{layer:{id:f.id}}),this._layers[f.id]=_}}_loadSprite(l,f=!1,_=void 0){let b;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(k,E,A,B){return a._(this,void 0,void 0,function*(){const Z=ze(k),X=A>1?"@2x":"",Q={},pe={};for(const{id:Se,url:ke}of Z){const Me=E.transformRequest(E.normalizeSpriteURL(ke,X,".json"),"SpriteJSON");Q[Se]=a.h(Me,B);const be=E.transformRequest(E.normalizeSpriteURL(ke,X,".png"),"SpriteImage");pe[Se]=F.getImage(be,B)}return yield Promise.all([...Object.values(Q),...Object.values(pe)]),function(Se,ke){return a._(this,void 0,void 0,function*(){const Me={};for(const be in Se){Me[be]={};const Fe=y.getImageCanvasContext((yield ke[be]).data),Je=(yield Se[be]).data;for(const Le in Je){const{width:Ue,height:Qe,x:et,y:ot,sdf:_t,pixelRatio:dt,stretchX:At,stretchY:Rt,content:yn}=Je[Le];Me[be][Le]={data:null,pixelRatio:dt,sdf:_t,stretchX:At,stretchY:Rt,content:yn,spriteData:{width:Ue,height:Qe,x:et,y:ot,context:Fe}}}}return Me})}(Q,pe)})}(l,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(k=>{if(this._spriteRequest=null,k)for(const E in k){this._spritesImagesIds[E]=[];const A=this._spritesImagesIds[E]?this._spritesImagesIds[E].filter(B=>!(B in k)):[];for(const B of A)this.imageManager.removeImage(B),this._changedImages[B]=!0;for(const B in k[E]){const Z=E==="default"?B:`${E}:${B}`;this._spritesImagesIds[E].push(Z),Z in this.imageManager.images?this.imageManager.updateImage(Z,k[E][B],!1):this.imageManager.addImage(Z,k[E][B]),f&&(this._changedImages[Z]=!0)}}}).catch(k=>{this._spriteRequest=null,b=k,this.fire(new a.j(b))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),f&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),_&&_(b)})}_unloadSprite(){for(const l of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(l),this._changedImages[l]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(l){const f=this.sourceCaches[l.source];if(!f)return;const _=l.sourceLayer;if(!_)return;const b=f.getSource();(b.type==="geojson"||b.vectorLayerIds&&b.vectorLayerIds.indexOf(_)===-1)&&this.fire(new a.j(new Error(`Source layer "${_}" does not exist on source "${b.id}" as specified by style layer "${l.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this.sourceCaches)if(!this.sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(l){const f=this._serializedAllLayers();if(!l||l.length===0)return Object.values(f);const _=[];for(const b of l)f[b]&&_.push(f[b]);return _}_serializedAllLayers(){let l=this._serializedLayers;if(l)return l;l=this._serializedLayers={};const f=Object.keys(this._layers);for(const _ of f){const b=this._layers[_];b.type!=="custom"&&(l[_]=b.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const l in this.sourceCaches)if(this.sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(l){if(!this._loaded)return;const f=this._changed;if(f){const b=Object.keys(this._updatedLayers),k=Object.keys(this._removedLayers);(b.length||k.length)&&this._updateWorkerLayers(b,k);for(const E in this._updatedSources){const A=this._updatedSources[E];if(A==="reload")this._reloadSource(E);else{if(A!=="clear")throw new Error(`Invalid action ${A}`);this._clearSource(E)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(l);this.light.updateTransitions(l),this._resetUpdates()}const _={};for(const b in this.sourceCaches){const k=this.sourceCaches[b];_[b]=k.used,k.used=!1}for(const b of this._order){const k=this._layers[b];k.recalculate(l,this._availableImages),!k.isHidden(l.zoom)&&k.source&&(this.sourceCaches[k.source].used=!0)}for(const b in _){const k=this.sourceCaches[b];!!_[b]!=!!k.used&&k.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:b}))}this.light.recalculate(l),this.z=l.zoom,f&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const f in this.sourceCaches)this.sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(l,f){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(l),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(l,f={}){var _;this._checkLoaded();const b=this.serialize();if(l=f.transformStyle?f.transformStyle(b,l):l,((_=f.validate)===null||_===void 0||_)&&Sr(this,a.x(l)))return!1;(l=a.aA(l)).layers=a.ay(l.layers);const k=a.aB(b,l),E=this._getOperationsToPerform(k);if(E.unimplemented.length>0)throw new Error(`Unimplemented: ${E.unimplemented.join(", ")}.`);if(E.operations.length===0)return!1;for(const A of E.operations)A();return this.stylesheet=l,this._serializedLayers=null,!0}_getOperationsToPerform(l){const f=[],_=[];for(const b of l)switch(b.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":f.push(()=>this.addLayer.apply(this,b.args));break;case"removeLayer":f.push(()=>this.removeLayer.apply(this,b.args));break;case"setPaintProperty":f.push(()=>this.setPaintProperty.apply(this,b.args));break;case"setLayoutProperty":f.push(()=>this.setLayoutProperty.apply(this,b.args));break;case"setFilter":f.push(()=>this.setFilter.apply(this,b.args));break;case"addSource":f.push(()=>this.addSource.apply(this,b.args));break;case"removeSource":f.push(()=>this.removeSource.apply(this,b.args));break;case"setLayerZoomRange":f.push(()=>this.setLayerZoomRange.apply(this,b.args));break;case"setLight":f.push(()=>this.setLight.apply(this,b.args));break;case"setGeoJSONSourceData":f.push(()=>this.setGeoJSONSourceData.apply(this,b.args));break;case"setGlyphs":f.push(()=>this.setGlyphs.apply(this,b.args));break;case"setSprite":f.push(()=>this.setSprite.apply(this,b.args));break;case"setTerrain":f.push(()=>this.map.setTerrain.apply(this,b.args));break;case"setTransition":f.push(()=>{});break;default:_.push(b.command)}return{operations:f,unimplemented:_}}addImage(l,f){if(this.getImage(l))return this.fire(new a.j(new Error(`An image named "${l}" already exists.`)));this.imageManager.addImage(l,f),this._afterImageUpdated(l)}updateImage(l,f){this.imageManager.updateImage(l,f)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){if(!this.getImage(l))return this.fire(new a.j(new Error(`An image named "${l}" does not exist.`)));this.imageManager.removeImage(l),this._afterImageUpdated(l)}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(l,f,_={}){if(this._checkLoaded(),this.sourceCaches[l]!==void 0)throw new Error(`Source "${l}" already exists.`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(a.x.source,`sources.${l}`,f,null,_))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const b=this.sourceCaches[l]=new Yn(l,f,this.dispatcher);b.style=this,b.setEventedParent(this,()=>({isSourceLoaded:b.loaded(),source:b.serialize(),sourceId:l})),b.onAdd(this.map),this._changed=!0}removeSource(l){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===l)return this.fire(new a.j(new Error(`Source "${l}" cannot be removed while layer "${_}" is using it.`)));const f=this.sourceCaches[l];delete this.sourceCaches[l],delete this._updatedSources[l],f.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:l})),f.setEventedParent(null),f.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(l,f){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error(`There is no source with this ID=${l}`);const _=this.sourceCaches[l].getSource();if(_.type!=="geojson")throw new Error(`geojsonSource.type is ${_.type}, which is !== 'geojson`);_.setData(f),this._changed=!0}getSource(l){return this.sourceCaches[l]&&this.sourceCaches[l].getSource()}addLayer(l,f,_={}){this._checkLoaded();const b=l.id;if(this.getLayer(b))return void this.fire(new a.j(new Error(`Layer "${b}" already exists on this map.`)));let k;if(l.type==="custom"){if(Sr(this,a.aC(l)))return;k=a.az(l)}else{if("source"in l&&typeof l.source=="object"&&(this.addSource(b,l.source),l=a.aA(l),l=a.e(l,{source:b})),this._validate(a.x.layer,`layers.${b}`,l,{arrayIndex:-1},_))return;k=a.az(l),this._validateLayer(k),k.setEventedParent(this,{layer:{id:b}})}const E=f?this._order.indexOf(f):this._order.length;if(f&&E===-1)this.fire(new a.j(new Error(`Cannot add layer "${b}" before non-existing layer "${f}".`)));else{if(this._order.splice(E,0,b),this._layerOrderChanged=!0,this._layers[b]=k,this._removedLayers[b]&&k.source&&k.type!=="custom"){const A=this._removedLayers[b];delete this._removedLayers[b],A.type!==k.type?this._updatedSources[k.source]="clear":(this._updatedSources[k.source]="reload",this.sourceCaches[k.source].pause())}this._updateLayer(k),k.onAdd&&k.onAdd(this.map)}}moveLayer(l,f){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new a.j(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===f)return;const _=this._order.indexOf(l);this._order.splice(_,1);const b=f?this._order.indexOf(f):this._order.length;f&&b===-1?this.fire(new a.j(new Error(`Cannot move layer "${l}" before non-existing layer "${f}".`))):(this._order.splice(b,0,l),this._layerOrderChanged=!0)}removeLayer(l){this._checkLoaded();const f=this._layers[l];if(!f)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${l}".`)));f.setEventedParent(null);const _=this._order.indexOf(l);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=f,delete this._layers[l],this._serializedLayers&&delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],f.onRemove&&f.onRemove(this.map)}getLayer(l){return this._layers[l]}getLayersOrder(){return[...this._order]}hasLayer(l){return l in this._layers}setLayerZoomRange(l,f,_){this._checkLoaded();const b=this.getLayer(l);b?b.minzoom===f&&b.maxzoom===_||(f!=null&&(b.minzoom=f),_!=null&&(b.maxzoom=_),this._updateLayer(b)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${l}".`)))}setFilter(l,f,_={}){this._checkLoaded();const b=this.getLayer(l);if(b){if(!a.aD(b.filter,f))return f==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(a.x.filter,`layers.${b.id}.filter`,f,null,_)||(b.filter=a.aA(f),this._updateLayer(b)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${l}".`)))}getFilter(l){return a.aA(this.getLayer(l).filter)}setLayoutProperty(l,f,_,b={}){this._checkLoaded();const k=this.getLayer(l);k?a.aD(k.getLayoutProperty(f),_)||(k.setLayoutProperty(f,_,b),this._updateLayer(k)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${l}".`)))}getLayoutProperty(l,f){const _=this.getLayer(l);if(_)return _.getLayoutProperty(f);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${l}".`)))}setPaintProperty(l,f,_,b={}){this._checkLoaded();const k=this.getLayer(l);k?a.aD(k.getPaintProperty(f),_)||(k.setPaintProperty(f,_,b)&&this._updateLayer(k),this._changed=!0,this._updatedPaintProps[l]=!0,this._serializedLayers=null):this.fire(new a.j(new Error(`Cannot style non-existing layer "${l}".`)))}getPaintProperty(l,f){return this.getLayer(l).getPaintProperty(f)}setFeatureState(l,f){this._checkLoaded();const _=l.source,b=l.sourceLayer,k=this.sourceCaches[_];if(k===void 0)return void this.fire(new a.j(new Error(`The source '${_}' does not exist in the map's style.`)));const E=k.getSource().type;E==="geojson"&&b?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||b?(l.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),k.setFeatureState(b,l.id,f)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(l,f){this._checkLoaded();const _=l.source,b=this.sourceCaches[_];if(b===void 0)return void this.fire(new a.j(new Error(`The source '${_}' does not exist in the map's style.`)));const k=b.getSource().type,E=k==="vector"?l.sourceLayer:void 0;k!=="vector"||E?f&&typeof l.id!="string"&&typeof l.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):b.removeFeatureState(E,l.id,f):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(l){this._checkLoaded();const f=l.source,_=l.sourceLayer,b=this.sourceCaches[f];if(b!==void 0)return b.getSource().type!=="vector"||_?(l.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),b.getFeatureState(_,l.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const l=a.aE(this.sourceCaches,k=>k.serialize()),f=this._serializeByIds(this._order),_=this.map.getTerrain()||void 0,b=this.stylesheet;return a.aF({version:b.version,name:b.name,metadata:b.metadata,light:b.light,center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch,sprite:b.sprite,glyphs:b.glyphs,transition:b.transition,sources:l,layers:f,terrain:_},k=>k!==void 0)}_updateLayer(l){this._updatedLayers[l.id]=!0,l.source&&!this._updatedSources[l.source]&&this.sourceCaches[l.source].getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",this.sourceCaches[l.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(l){const f=E=>this._layers[E].type==="fill-extrusion",_={},b=[];for(let E=this._order.length-1;E>=0;E--){const A=this._order[E];if(f(A)){_[A]=E;for(const B of l){const Z=B[A];if(Z)for(const X of Z)b.push(X)}}}b.sort((E,A)=>A.intersectionZ-E.intersectionZ);const k=[];for(let E=this._order.length-1;E>=0;E--){const A=this._order[E];if(f(A))for(let B=b.length-1;B>=0;B--){const Z=b[B].feature;if(_[Z.layer.id]<E)break;k.push(Z),b.pop()}else for(const B of l){const Z=B[A];if(Z)for(const X of Z)k.push(X.feature)}}return k}queryRenderedFeatures(l,f,_){f&&f.filter&&this._validate(a.x.filter,"queryRenderedFeatures.filter",f.filter,null,f);const b={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const A of f.layers){const B=this._layers[A];if(!B)return this.fire(new a.j(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];b[B.source]=!0}}const k=[];f.availableImages=this._availableImages;const E=this._serializedAllLayers();for(const A in this.sourceCaches)f.layers&&!b[A]||k.push(Dt(this.sourceCaches[A],this._layers,E,l,f,_));return this.placement&&k.push(function(A,B,Z,X,Q,pe,Se){const ke={},Me=pe.queryRenderedSymbols(X),be=[];for(const Fe of Object.keys(Me).map(Number))be.push(Se[Fe]);be.sort(pn);for(const Fe of be){const Je=Fe.featureIndex.lookupSymbolFeatures(Me[Fe.bucketInstanceId],B,Fe.bucketIndex,Fe.sourceLayerIndex,Q.filter,Q.layers,Q.availableImages,A);for(const Le in Je){const Ue=ke[Le]=ke[Le]||[],Qe=Je[Le];Qe.sort((et,ot)=>{const _t=Fe.featureSortOrder;if(_t){const dt=_t.indexOf(et.featureIndex);return _t.indexOf(ot.featureIndex)-dt}return ot.featureIndex-et.featureIndex});for(const et of Qe)Ue.push(et)}}for(const Fe in ke)ke[Fe].forEach(Je=>{const Le=Je.feature,Ue=Z[A[Fe].source].getFeatureState(Le.layer["source-layer"],Le.id);Le.source=Le.layer.source,Le.layer["source-layer"]&&(Le.sourceLayer=Le.layer["source-layer"]),Le.state=Ue});return ke}(this._layers,E,this.sourceCaches,l,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(k)}querySourceFeatures(l,f){f&&f.filter&&this._validate(a.x.filter,"querySourceFeatures.filter",f.filter,null,f);const _=this.sourceCaches[l];return _?function(b,k){const E=b.getRenderableIds().map(Z=>b.getTileByID(Z)),A=[],B={};for(let Z=0;Z<E.length;Z++){const X=E[Z],Q=X.tileID.canonical.key;B[Q]||(B[Q]=!0,X.querySourceFeatures(A,k))}return A}(_,f):[]}getLight(){return this.light.getLight()}setLight(l,f={}){this._checkLoaded();const _=this.light.getLight();let b=!1;for(const E in l)if(!a.aD(l[E],_[E])){b=!0;break}if(!b)return;const k={now:y.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,f),this.light.updateTransitions(k)}_validate(l,f,_,b,k={}){return(!k||k.validate!==!1)&&Sr(this,l.call(a.x,a.e({key:f,style:this.serialize(),value:_,styleSpec:a.v},b)))}_remove(l=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),vt().off(Pr,this._rtlPluginLoaded);for(const f in this._layers)this._layers[f].setEventedParent(null);for(const f in this.sourceCaches){const _=this.sourceCaches[f];_.setEventedParent(null),_.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),l&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(l)}_clearSource(l){this.sourceCaches[l].clearTiles()}_reloadSource(l){this.sourceCaches[l].resume(),this.sourceCaches[l].reload()}_updateSources(l){for(const f in this.sourceCaches)this.sourceCaches[f].update(l,this.map.terrain)}_generateCollisionBoxes(){for(const l in this.sourceCaches)this._reloadSource(l)}_updatePlacement(l,f,_,b,k=!1){let E=!1,A=!1;const B={};for(const Z of this._order){const X=this._layers[Z];if(X.type!=="symbol")continue;if(!B[X.source]){const pe=this.sourceCaches[X.source];B[X.source]=pe.getRenderableIds(!0).map(Se=>pe.getTileByID(Se)).sort((Se,ke)=>ke.tileID.overscaledZ-Se.tileID.overscaledZ||(Se.tileID.isLessThan(ke.tileID)?-1:1))}const Q=this.crossTileSymbolIndex.addLayer(X,B[X.source],l.center.lng);E=E||Q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((k=k||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.now(),l.zoom))&&(this.pauseablePlacement=new lo(l,this.map.terrain,this._order,k,f,_,b,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,B),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.now()),A=!0),E&&this.pauseablePlacement.placement.setStale()),A||E)for(const Z of this._order){const X=this._layers[Z];X.type==="symbol"&&this.placement.updateLayerOpacities(X,B[X.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.now())}_releaseSymbolFadeTiles(){for(const l in this.sourceCaches)this.sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,f){return a._(this,void 0,void 0,function*(){const _=yield this.imageManager.getImages(f.icons);this._updateTilesForChangedImages();const b=this.sourceCaches[f.source];return b&&b.setDependencies(f.tileID.key,f.type,f.icons),_})}getGlyphs(l,f){return a._(this,void 0,void 0,function*(){const _=yield this.glyphManager.getGlyphs(f.stacks),b=this.sourceCaches[f.source];return b&&b.setDependencies(f.tileID.key,f.type,[""]),_})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(l,f={}){this._checkLoaded(),l&&this._validate(a.x.glyphs,"glyphs",l,null,f)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=l,this.glyphManager.entries={},this.glyphManager.setURL(l))}addSprite(l,f,_={},b){this._checkLoaded();const k=[{id:l,url:f}],E=[...ze(this.stylesheet.sprite),...k];this._validate(a.x.sprite,"sprite",E,null,_)||(this.stylesheet.sprite=E,this._loadSprite(k,!0,b))}removeSprite(l){this._checkLoaded();const f=ze(this.stylesheet.sprite);if(f.find(_=>_.id===l)){if(this._spritesImagesIds[l])for(const _ of this._spritesImagesIds[l])this.imageManager.removeImage(_),this._changedImages[_]=!0;f.splice(f.findIndex(_=>_.id===l),1),this.stylesheet.sprite=f.length>0?f:void 0,delete this._spritesImagesIds[l],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${l}" doesn't exists on this map.`)))}getSprite(){return ze(this.stylesheet.sprite)}setSprite(l,f={},_){this._checkLoaded(),l&&this._validate(a.x.sprite,"sprite",l,null,f)||(this.stylesheet.sprite=l,l?this._loadSprite(l,!0,_):(this._unloadSprite(),_&&_(null)))}}var vl=a.X([{name:"a_pos",type:"Int16",components:2}]),Oo="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Ba={prelude:rr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:rr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:rr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:rr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:rr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:rr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:rr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:rr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:rr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:rr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:rr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:rr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:rr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:rr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:rr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:rr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:rr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:rr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:rr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:rr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:rr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:rr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:rr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:rr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:rr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:rr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:rr("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Oo),terrainDepth:rr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Oo),terrainCoords:rr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Oo)};function rr(x,l){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=l.match(/attribute ([\w]+) ([\w]+)/g),b=x.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),k=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=k?k.concat(b):b,A={};return{fragmentSource:x=x.replace(f,(B,Z,X,Q,pe)=>(A[pe]=!0,Z==="define"?`
#ifndef HAS_UNIFORM_u_${pe}
varying ${X} ${Q} ${pe};
#else
uniform ${X} ${Q} u_${pe};
#endif
`:`
#ifdef HAS_UNIFORM_u_${pe}
    ${X} ${Q} ${pe} = u_${pe};
#endif
`)),vertexSource:l=l.replace(f,(B,Z,X,Q,pe)=>{const Se=Q==="float"?"vec2":"vec4",ke=pe.match(/color/)?"color":Se;return A[pe]?Z==="define"?`
#ifndef HAS_UNIFORM_u_${pe}
uniform lowp float u_${pe}_t;
attribute ${X} ${Se} a_${pe};
varying ${X} ${Q} ${pe};
#else
uniform ${X} ${Q} u_${pe};
#endif
`:ke==="vec4"?`
#ifndef HAS_UNIFORM_u_${pe}
    ${pe} = a_${pe};
#else
    ${X} ${Q} ${pe} = u_${pe};
#endif
`:`
#ifndef HAS_UNIFORM_u_${pe}
    ${pe} = unpack_mix_${ke}(a_${pe}, u_${pe}_t);
#else
    ${X} ${Q} ${pe} = u_${pe};
#endif
`:Z==="define"?`
#ifndef HAS_UNIFORM_u_${pe}
uniform lowp float u_${pe}_t;
attribute ${X} ${Se} a_${pe};
#else
uniform ${X} ${Q} u_${pe};
#endif
`:ke==="vec4"?`
#ifndef HAS_UNIFORM_u_${pe}
    ${X} ${Q} ${pe} = a_${pe};
#else
    ${X} ${Q} ${pe} = u_${pe};
#endif
`:`
#ifndef HAS_UNIFORM_u_${pe}
    ${X} ${Q} ${pe} = unpack_mix_${ke}(a_${pe}, u_${pe}_t);
#else
    ${X} ${Q} ${pe} = u_${pe};
#endif
`}),staticAttributes:_,staticUniforms:E}}class wl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(l,f,_,b,k,E,A,B,Z){this.context=l;let X=this.boundPaintVertexBuffers.length!==b.length;for(let Q=0;!X&&Q<b.length;Q++)this.boundPaintVertexBuffers[Q]!==b[Q]&&(X=!0);!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==_||X||this.boundIndexBuffer!==k||this.boundVertexOffset!==E||this.boundDynamicVertexBuffer!==A||this.boundDynamicVertexBuffer2!==B||this.boundDynamicVertexBuffer3!==Z?this.freshBind(f,_,b,k,E,A,B,Z):(l.bindVertexArray.set(this.vao),A&&A.bind(),k&&k.dynamicDraw&&k.bind(),B&&B.bind(),Z&&Z.bind())}freshBind(l,f,_,b,k,E,A,B){const Z=l.numAttributes,X=this.context,Q=X.gl;this.vao&&this.destroy(),this.vao=X.createVertexArray(),X.bindVertexArray.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=b,this.boundVertexOffset=k,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=A,this.boundDynamicVertexBuffer3=B,f.enableAttributes(Q,l);for(const pe of _)pe.enableAttributes(Q,l);E&&E.enableAttributes(Q,l),A&&A.enableAttributes(Q,l),B&&B.enableAttributes(Q,l),f.bind(),f.setVertexAttribPointers(Q,l,k);for(const pe of _)pe.bind(),pe.setVertexAttribPointers(Q,l,k);E&&(E.bind(),E.setVertexAttribPointers(Q,l,k)),b&&b.bind(),A&&(A.bind(),A.setVertexAttribPointers(Q,l,k)),B&&(B.bind(),B.setVertexAttribPointers(Q,l,k)),X.currentNumAttributes=Z}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ea(x){const l=[];for(let f=0;f<x.length;f++){if(x[f]===null)continue;const _=x[f].split(" ");l.push(_.pop())}return l}class ms{constructor(l,f,_,b,k,E){const A=l.gl;this.program=A.createProgram();const B=ea(f.staticAttributes),Z=_?_.getBinderAttributes():[],X=B.concat(Z),Q=Ba.prelude.staticUniforms?ea(Ba.prelude.staticUniforms):[],pe=f.staticUniforms?ea(f.staticUniforms):[],Se=_?_.getBinderUniforms():[],ke=Q.concat(pe).concat(Se),Me=[];for(const et of ke)Me.indexOf(et)<0&&Me.push(et);const be=_?_.defines():[];k&&be.push("#define OVERDRAW_INSPECTOR;"),E&&be.push("#define TERRAIN3D;");const Fe=be.concat(Ba.prelude.fragmentSource,f.fragmentSource).join(`
`),Je=be.concat(Ba.prelude.vertexSource,f.vertexSource).join(`
`),Le=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);if(A.shaderSource(Le,Fe),A.compileShader(Le),!A.getShaderParameter(Le,A.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${A.getShaderInfoLog(Le)}`);A.attachShader(this.program,Le);const Ue=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);if(A.shaderSource(Ue,Je),A.compileShader(Ue),!A.getShaderParameter(Ue,A.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${A.getShaderInfoLog(Ue)}`);A.attachShader(this.program,Ue),this.attributes={};const Qe={};this.numAttributes=X.length;for(let et=0;et<this.numAttributes;et++)X[et]&&(A.bindAttribLocation(this.program,et,X[et]),this.attributes[X[et]]=et);if(A.linkProgram(this.program),!A.getProgramParameter(this.program,A.LINK_STATUS))throw new Error(`Program failed to link: ${A.getProgramInfoLog(this.program)}`);A.deleteShader(Ue),A.deleteShader(Le);for(let et=0;et<Me.length;et++){const ot=Me[et];if(ot&&!Qe[ot]){const _t=A.getUniformLocation(this.program,ot);_t&&(Qe[ot]=_t)}}this.fixedUniforms=b(l,Qe),this.terrainUniforms=((et,ot)=>({u_depth:new a.aG(et,ot.u_depth),u_terrain:new a.aG(et,ot.u_terrain),u_terrain_dim:new a.aH(et,ot.u_terrain_dim),u_terrain_matrix:new a.aI(et,ot.u_terrain_matrix),u_terrain_unpack:new a.aJ(et,ot.u_terrain_unpack),u_terrain_exaggeration:new a.aH(et,ot.u_terrain_exaggeration)}))(l,Qe),this.binderUniforms=_?_.getUniforms(l,Qe):[]}draw(l,f,_,b,k,E,A,B,Z,X,Q,pe,Se,ke,Me,be,Fe,Je){const Le=l.gl;if(this.failedToCreate)return;if(l.program.set(this.program),l.setDepthMode(_),l.setStencilMode(b),l.setColorMode(k),l.setCullFace(E),B){l.activeTexture.set(Le.TEXTURE2),Le.bindTexture(Le.TEXTURE_2D,B.depthTexture),l.activeTexture.set(Le.TEXTURE3),Le.bindTexture(Le.TEXTURE_2D,B.texture);for(const Qe in this.terrainUniforms)this.terrainUniforms[Qe].set(B[Qe])}for(const Qe in this.fixedUniforms)this.fixedUniforms[Qe].set(A[Qe]);Me&&Me.setUniforms(l,this.binderUniforms,Se,{zoom:ke});let Ue=0;switch(f){case Le.LINES:Ue=2;break;case Le.TRIANGLES:Ue=3;break;case Le.LINE_STRIP:Ue=1}for(const Qe of pe.get()){const et=Qe.vaos||(Qe.vaos={});(et[Z]||(et[Z]=new wl)).bind(l,this,X,Me?Me.getPaintVertexBuffers():[],Q,Qe.vertexOffset,be,Fe,Je),Le.drawElements(f,Qe.primitiveLength*Ue,Le.UNSIGNED_SHORT,Qe.primitiveOffset*Ue*2)}}}function xl(x,l,f){const _=1/hn(f,1,l.transform.tileZoom),b=Math.pow(2,f.tileID.overscaledZ),k=f.tileSize*Math.pow(2,l.transform.tileZoom)/b,E=k*(f.tileID.canonical.x+f.tileID.wrap*b),A=k*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[_,x.fromScale,x.toScale],u_fade:x.t,u_pixel_coord_upper:[E>>16,A>>16],u_pixel_coord_lower:[65535&E,65535&A]}}const Oa=(x,l,f,_)=>{const b=l.style.light,k=b.properties.get("position"),E=[k.x,k.y,k.z],A=function(){var Z=new a.A(9);return a.A!=Float32Array&&(Z[1]=0,Z[2]=0,Z[3]=0,Z[5]=0,Z[6]=0,Z[7]=0),Z[0]=1,Z[4]=1,Z[8]=1,Z}();b.properties.get("anchor")==="viewport"&&function(Z,X){var Q=Math.sin(X),pe=Math.cos(X);Z[0]=pe,Z[1]=Q,Z[2]=0,Z[3]=-Q,Z[4]=pe,Z[5]=0,Z[6]=0,Z[7]=0,Z[8]=1}(A,-l.transform.angle),function(Z,X,Q){var pe=X[0],Se=X[1],ke=X[2];Z[0]=pe*Q[0]+Se*Q[3]+ke*Q[6],Z[1]=pe*Q[1]+Se*Q[4]+ke*Q[7],Z[2]=pe*Q[2]+Se*Q[5]+ke*Q[8]}(E,E,A);const B=b.properties.get("color");return{u_matrix:x,u_lightpos:E,u_lightintensity:b.properties.get("intensity"),u_lightcolor:[B.r,B.g,B.b],u_vertical_gradient:+f,u_opacity:_}},Pd=(x,l,f,_,b,k,E)=>a.e(Oa(x,l,f,_),xl(k,l,E),{u_height_factor:-Math.pow(2,b.overscaledZ)/E.tileSize/8}),zh=x=>({u_matrix:x}),kl=(x,l,f,_)=>a.e(zh(x),xl(f,l,_)),zd=(x,l)=>({u_matrix:x,u_world:l}),Dh=(x,l,f,_,b)=>a.e(kl(x,l,f,_),{u_world:b}),Dd=(x,l,f,_)=>{const b=x.transform;let k,E;if(_.paint.get("circle-pitch-alignment")==="map"){const A=hn(f,1,b.zoom);k=!0,E=[A,A]}else k=!1,E=b.pixelsToGLUnits;return{u_camera_to_center_distance:b.cameraToCenterDistance,u_scale_with_map:+(_.paint.get("circle-pitch-scale")==="map"),u_matrix:x.translatePosMatrix(l.posMatrix,f,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_pitch_with_map:+k,u_device_pixel_ratio:x.pixelRatio,u_extrude_scale:E}},Rh=(x,l,f)=>{const _=hn(f,1,l.zoom),b=Math.pow(2,l.zoom-f.tileID.overscaledZ),k=f.tileID.overscaleFactor();return{u_matrix:x,u_camera_to_center_distance:l.cameraToCenterDistance,u_pixels_to_tile_units:_,u_extrude_scale:[l.pixelsToGLUnits[0]/(_*b),l.pixelsToGLUnits[1]/(_*b)],u_overscale_factor:k}},$h=(x,l,f=1)=>({u_matrix:x,u_color:l,u_overlay:0,u_overlay_scale:f}),Sl=x=>({u_matrix:x}),Fh=(x,l,f,_)=>({u_matrix:x,u_extrude_scale:hn(l,1,f),u_intensity:_});function Bh(x,l){const f=Math.pow(2,l.canonical.z),_=l.canonical.y;return[new a.Y(0,_/f).toLngLat().lat,new a.Y(0,(_+1)/f).toLngLat().lat]}const Cl=(x,l,f,_)=>{const b=x.transform;return{u_matrix:Na(x,l,f,_),u_ratio:1/hn(l,1,b.zoom),u_device_pixel_ratio:x.pixelRatio,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Oh=(x,l,f,_,b)=>a.e(Cl(x,l,f,b),{u_image:0,u_image_height:_}),Ms=(x,l,f,_,b)=>{const k=x.transform,E=Xi(l,k);return{u_matrix:Na(x,l,f,b),u_texsize:l.imageAtlasTexture.size,u_ratio:1/hn(l,1,k.zoom),u_device_pixel_ratio:x.pixelRatio,u_image:0,u_scale:[E,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]]}},Tl=(x,l,f,_,b,k)=>{const E=x.lineAtlas,A=Xi(l,x.transform),B=f.layout.get("line-cap")==="round",Z=E.getDash(_.from,B),X=E.getDash(_.to,B),Q=Z.width*b.fromScale,pe=X.width*b.toScale;return a.e(Cl(x,l,f,k),{u_patternscale_a:[A/Q,-Z.height/2],u_patternscale_b:[A/pe,-X.height/2],u_sdfgamma:E.width/(256*Math.min(Q,pe)*x.pixelRatio)/2,u_image:0,u_tex_y_a:Z.y,u_tex_y_b:X.y,u_mix:b.t})};function Xi(x,l){return 1/hn(x,1,l.tileZoom)}function Na(x,l,f,_){return x.translatePosMatrix(_?_.posMatrix:l.tileID.posMatrix,l,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}const Ml=(x,l,f,_,b)=>{return{u_matrix:x,u_tl_parent:l,u_scale_parent:f,u_buffer_scale:1,u_fade_t:_.mix,u_opacity:_.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(E=b.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(k=b.paint.get("raster-contrast"),k>0?1/(1-k):1+k),u_spin_weights:ja(b.paint.get("raster-hue-rotate"))};var k,E};function ja(x){x*=Math.PI/180;const l=Math.sin(x),f=Math.cos(x);return[(2*f+1)/3,(-Math.sqrt(3)*l-f+1)/3,(Math.sqrt(3)*l-f+1)/3]}const Ua=(x,l,f,_,b,k,E,A,B,Z)=>{const X=b.transform;return{u_is_size_zoom_constant:+(x==="constant"||x==="source"),u_is_size_feature_constant:+(x==="constant"||x==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:X.cameraToCenterDistance,u_pitch:X.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:X.width/X.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:k,u_label_plane_matrix:E,u_coord_matrix:A,u_is_text:+B,u_pitch_with_map:+_,u_texsize:Z,u_texture:0}},Va=(x,l,f,_,b,k,E,A,B,Z,X)=>{const Q=b.transform;return a.e(Ua(x,l,f,_,b,k,E,A,B,Z),{u_gamma_scale:_?Math.cos(Q._pitch)*Q.cameraToCenterDistance:1,u_device_pixel_ratio:b.pixelRatio,u_is_halo:+X})},qa=(x,l,f,_,b,k,E,A,B,Z)=>a.e(Va(x,l,f,_,b,k,E,A,!0,B,!0),{u_texsize_icon:Z,u_texture_icon:1}),Rd=(x,l,f)=>({u_matrix:x,u_opacity:l,u_color:f}),$d=(x,l,f,_,b,k)=>a.e(function(E,A,B,Z){const X=B.imageManager.getPattern(E.from.toString()),Q=B.imageManager.getPattern(E.to.toString()),{width:pe,height:Se}=B.imageManager.getPixelSize(),ke=Math.pow(2,Z.tileID.overscaledZ),Me=Z.tileSize*Math.pow(2,B.transform.tileZoom)/ke,be=Me*(Z.tileID.canonical.x+Z.tileID.wrap*ke),Fe=Me*Z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:X.tl,u_pattern_br_a:X.br,u_pattern_tl_b:Q.tl,u_pattern_br_b:Q.br,u_texsize:[pe,Se],u_mix:A.t,u_pattern_size_a:X.displaySize,u_pattern_size_b:Q.displaySize,u_scale_a:A.fromScale,u_scale_b:A.toScale,u_tile_units_to_pixels:1/hn(Z,1,B.transform.tileZoom),u_pixel_coord_upper:[be>>16,Fe>>16],u_pixel_coord_lower:[65535&be,65535&Fe]}}(_,k,f,b),{u_matrix:x,u_opacity:l}),Nh={fillExtrusion:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_lightpos:new a.aK(x,l.u_lightpos),u_lightintensity:new a.aH(x,l.u_lightintensity),u_lightcolor:new a.aK(x,l.u_lightcolor),u_vertical_gradient:new a.aH(x,l.u_vertical_gradient),u_opacity:new a.aH(x,l.u_opacity)}),fillExtrusionPattern:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_lightpos:new a.aK(x,l.u_lightpos),u_lightintensity:new a.aH(x,l.u_lightintensity),u_lightcolor:new a.aK(x,l.u_lightcolor),u_vertical_gradient:new a.aH(x,l.u_vertical_gradient),u_height_factor:new a.aH(x,l.u_height_factor),u_image:new a.aG(x,l.u_image),u_texsize:new a.aL(x,l.u_texsize),u_pixel_coord_upper:new a.aL(x,l.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(x,l.u_pixel_coord_lower),u_scale:new a.aK(x,l.u_scale),u_fade:new a.aH(x,l.u_fade),u_opacity:new a.aH(x,l.u_opacity)}),fill:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix)}),fillPattern:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_image:new a.aG(x,l.u_image),u_texsize:new a.aL(x,l.u_texsize),u_pixel_coord_upper:new a.aL(x,l.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(x,l.u_pixel_coord_lower),u_scale:new a.aK(x,l.u_scale),u_fade:new a.aH(x,l.u_fade)}),fillOutline:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_world:new a.aL(x,l.u_world)}),fillOutlinePattern:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_world:new a.aL(x,l.u_world),u_image:new a.aG(x,l.u_image),u_texsize:new a.aL(x,l.u_texsize),u_pixel_coord_upper:new a.aL(x,l.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(x,l.u_pixel_coord_lower),u_scale:new a.aK(x,l.u_scale),u_fade:new a.aH(x,l.u_fade)}),circle:(x,l)=>({u_camera_to_center_distance:new a.aH(x,l.u_camera_to_center_distance),u_scale_with_map:new a.aG(x,l.u_scale_with_map),u_pitch_with_map:new a.aG(x,l.u_pitch_with_map),u_extrude_scale:new a.aL(x,l.u_extrude_scale),u_device_pixel_ratio:new a.aH(x,l.u_device_pixel_ratio),u_matrix:new a.aI(x,l.u_matrix)}),collisionBox:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_camera_to_center_distance:new a.aH(x,l.u_camera_to_center_distance),u_pixels_to_tile_units:new a.aH(x,l.u_pixels_to_tile_units),u_extrude_scale:new a.aL(x,l.u_extrude_scale),u_overscale_factor:new a.aH(x,l.u_overscale_factor)}),collisionCircle:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_inv_matrix:new a.aI(x,l.u_inv_matrix),u_camera_to_center_distance:new a.aH(x,l.u_camera_to_center_distance),u_viewport_size:new a.aL(x,l.u_viewport_size)}),debug:(x,l)=>({u_color:new a.aM(x,l.u_color),u_matrix:new a.aI(x,l.u_matrix),u_overlay:new a.aG(x,l.u_overlay),u_overlay_scale:new a.aH(x,l.u_overlay_scale)}),clippingMask:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix)}),heatmap:(x,l)=>({u_extrude_scale:new a.aH(x,l.u_extrude_scale),u_intensity:new a.aH(x,l.u_intensity),u_matrix:new a.aI(x,l.u_matrix)}),heatmapTexture:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_world:new a.aL(x,l.u_world),u_image:new a.aG(x,l.u_image),u_color_ramp:new a.aG(x,l.u_color_ramp),u_opacity:new a.aH(x,l.u_opacity)}),hillshade:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_image:new a.aG(x,l.u_image),u_latrange:new a.aL(x,l.u_latrange),u_light:new a.aL(x,l.u_light),u_shadow:new a.aM(x,l.u_shadow),u_highlight:new a.aM(x,l.u_highlight),u_accent:new a.aM(x,l.u_accent)}),hillshadePrepare:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_image:new a.aG(x,l.u_image),u_dimension:new a.aL(x,l.u_dimension),u_zoom:new a.aH(x,l.u_zoom),u_unpack:new a.aJ(x,l.u_unpack)}),line:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_ratio:new a.aH(x,l.u_ratio),u_device_pixel_ratio:new a.aH(x,l.u_device_pixel_ratio),u_units_to_pixels:new a.aL(x,l.u_units_to_pixels)}),lineGradient:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_ratio:new a.aH(x,l.u_ratio),u_device_pixel_ratio:new a.aH(x,l.u_device_pixel_ratio),u_units_to_pixels:new a.aL(x,l.u_units_to_pixels),u_image:new a.aG(x,l.u_image),u_image_height:new a.aH(x,l.u_image_height)}),linePattern:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_texsize:new a.aL(x,l.u_texsize),u_ratio:new a.aH(x,l.u_ratio),u_device_pixel_ratio:new a.aH(x,l.u_device_pixel_ratio),u_image:new a.aG(x,l.u_image),u_units_to_pixels:new a.aL(x,l.u_units_to_pixels),u_scale:new a.aK(x,l.u_scale),u_fade:new a.aH(x,l.u_fade)}),lineSDF:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_ratio:new a.aH(x,l.u_ratio),u_device_pixel_ratio:new a.aH(x,l.u_device_pixel_ratio),u_units_to_pixels:new a.aL(x,l.u_units_to_pixels),u_patternscale_a:new a.aL(x,l.u_patternscale_a),u_patternscale_b:new a.aL(x,l.u_patternscale_b),u_sdfgamma:new a.aH(x,l.u_sdfgamma),u_image:new a.aG(x,l.u_image),u_tex_y_a:new a.aH(x,l.u_tex_y_a),u_tex_y_b:new a.aH(x,l.u_tex_y_b),u_mix:new a.aH(x,l.u_mix)}),raster:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_tl_parent:new a.aL(x,l.u_tl_parent),u_scale_parent:new a.aH(x,l.u_scale_parent),u_buffer_scale:new a.aH(x,l.u_buffer_scale),u_fade_t:new a.aH(x,l.u_fade_t),u_opacity:new a.aH(x,l.u_opacity),u_image0:new a.aG(x,l.u_image0),u_image1:new a.aG(x,l.u_image1),u_brightness_low:new a.aH(x,l.u_brightness_low),u_brightness_high:new a.aH(x,l.u_brightness_high),u_saturation_factor:new a.aH(x,l.u_saturation_factor),u_contrast_factor:new a.aH(x,l.u_contrast_factor),u_spin_weights:new a.aK(x,l.u_spin_weights)}),symbolIcon:(x,l)=>({u_is_size_zoom_constant:new a.aG(x,l.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(x,l.u_is_size_feature_constant),u_size_t:new a.aH(x,l.u_size_t),u_size:new a.aH(x,l.u_size),u_camera_to_center_distance:new a.aH(x,l.u_camera_to_center_distance),u_pitch:new a.aH(x,l.u_pitch),u_rotate_symbol:new a.aG(x,l.u_rotate_symbol),u_aspect_ratio:new a.aH(x,l.u_aspect_ratio),u_fade_change:new a.aH(x,l.u_fade_change),u_matrix:new a.aI(x,l.u_matrix),u_label_plane_matrix:new a.aI(x,l.u_label_plane_matrix),u_coord_matrix:new a.aI(x,l.u_coord_matrix),u_is_text:new a.aG(x,l.u_is_text),u_pitch_with_map:new a.aG(x,l.u_pitch_with_map),u_texsize:new a.aL(x,l.u_texsize),u_texture:new a.aG(x,l.u_texture)}),symbolSDF:(x,l)=>({u_is_size_zoom_constant:new a.aG(x,l.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(x,l.u_is_size_feature_constant),u_size_t:new a.aH(x,l.u_size_t),u_size:new a.aH(x,l.u_size),u_camera_to_center_distance:new a.aH(x,l.u_camera_to_center_distance),u_pitch:new a.aH(x,l.u_pitch),u_rotate_symbol:new a.aG(x,l.u_rotate_symbol),u_aspect_ratio:new a.aH(x,l.u_aspect_ratio),u_fade_change:new a.aH(x,l.u_fade_change),u_matrix:new a.aI(x,l.u_matrix),u_label_plane_matrix:new a.aI(x,l.u_label_plane_matrix),u_coord_matrix:new a.aI(x,l.u_coord_matrix),u_is_text:new a.aG(x,l.u_is_text),u_pitch_with_map:new a.aG(x,l.u_pitch_with_map),u_texsize:new a.aL(x,l.u_texsize),u_texture:new a.aG(x,l.u_texture),u_gamma_scale:new a.aH(x,l.u_gamma_scale),u_device_pixel_ratio:new a.aH(x,l.u_device_pixel_ratio),u_is_halo:new a.aG(x,l.u_is_halo)}),symbolTextAndIcon:(x,l)=>({u_is_size_zoom_constant:new a.aG(x,l.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(x,l.u_is_size_feature_constant),u_size_t:new a.aH(x,l.u_size_t),u_size:new a.aH(x,l.u_size),u_camera_to_center_distance:new a.aH(x,l.u_camera_to_center_distance),u_pitch:new a.aH(x,l.u_pitch),u_rotate_symbol:new a.aG(x,l.u_rotate_symbol),u_aspect_ratio:new a.aH(x,l.u_aspect_ratio),u_fade_change:new a.aH(x,l.u_fade_change),u_matrix:new a.aI(x,l.u_matrix),u_label_plane_matrix:new a.aI(x,l.u_label_plane_matrix),u_coord_matrix:new a.aI(x,l.u_coord_matrix),u_is_text:new a.aG(x,l.u_is_text),u_pitch_with_map:new a.aG(x,l.u_pitch_with_map),u_texsize:new a.aL(x,l.u_texsize),u_texsize_icon:new a.aL(x,l.u_texsize_icon),u_texture:new a.aG(x,l.u_texture),u_texture_icon:new a.aG(x,l.u_texture_icon),u_gamma_scale:new a.aH(x,l.u_gamma_scale),u_device_pixel_ratio:new a.aH(x,l.u_device_pixel_ratio),u_is_halo:new a.aG(x,l.u_is_halo)}),background:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_opacity:new a.aH(x,l.u_opacity),u_color:new a.aM(x,l.u_color)}),backgroundPattern:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_opacity:new a.aH(x,l.u_opacity),u_image:new a.aG(x,l.u_image),u_pattern_tl_a:new a.aL(x,l.u_pattern_tl_a),u_pattern_br_a:new a.aL(x,l.u_pattern_br_a),u_pattern_tl_b:new a.aL(x,l.u_pattern_tl_b),u_pattern_br_b:new a.aL(x,l.u_pattern_br_b),u_texsize:new a.aL(x,l.u_texsize),u_mix:new a.aH(x,l.u_mix),u_pattern_size_a:new a.aL(x,l.u_pattern_size_a),u_pattern_size_b:new a.aL(x,l.u_pattern_size_b),u_scale_a:new a.aH(x,l.u_scale_a),u_scale_b:new a.aH(x,l.u_scale_b),u_pixel_coord_upper:new a.aL(x,l.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(x,l.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aH(x,l.u_tile_units_to_pixels)}),terrain:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_texture:new a.aG(x,l.u_texture),u_ele_delta:new a.aH(x,l.u_ele_delta)}),terrainDepth:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_ele_delta:new a.aH(x,l.u_ele_delta)}),terrainCoords:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_texture:new a.aG(x,l.u_texture),u_terrain_coords_id:new a.aH(x,l.u_terrain_coords_id),u_ele_delta:new a.aH(x,l.u_ele_delta)})};class Fd{constructor(l,f,_){this.context=l;const b=l.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const f=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ls={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ll{constructor(l,f,_,b){this.length=f.length,this.attributes=_,this.itemSize=f.bytesPerElement,this.dynamicDraw=b,this.context=l;const k=l.gl;this.buffer=k.createBuffer(),l.bindVertexBuffer.set(this.buffer),k.bufferData(k.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){if(l.length!==this.length)throw new Error(`Length of new data is ${l.length}, which doesn't match current length of ${this.length}`);const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,f){for(let _=0;_<this.attributes.length;_++){const b=f.attributes[this.attributes[_].name];b!==void 0&&l.enableVertexAttribArray(b)}}setVertexAttribPointers(l,f,_){for(let b=0;b<this.attributes.length;b++){const k=this.attributes[b],E=f.attributes[k.name];E!==void 0&&l.vertexAttribPointer(E,k.components,l[Ls[k.type]],!1,this.itemSize,k.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ti=new WeakMap;function vi(x){var l;if(Ti.has(x))return Ti.get(x);{const f=(l=x.getParameter(x.VERSION))===null||l===void 0?void 0:l.startsWith("WebGL 2.0");return Ti.set(x,f),f}}class Gn{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class El extends Gn{getDefault(){return a.aO.transparent}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Il extends Gn{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class Nc extends Gn{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class jc extends Gn{getDefault(){return[!0,!0,!0,!0]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Al extends Gn{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class Uc extends Gn{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class Vc extends Gn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const f=this.current;(l.func!==f.func||l.ref!==f.ref||l.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class Pl extends Gn{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class jh extends Gn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=l,this.dirty=!1}}class Uh extends Gn{getDefault(){return[0,1]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class ta extends Gn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=l,this.dirty=!1}}class Bd extends Gn{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class Od extends Gn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.BLEND):f.disable(f.BLEND),this.current=l,this.dirty=!1}}class Nd extends Gn{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class jd extends Gn{getDefault(){return a.aO.transparent}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Ud extends Gn{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class Vd extends Gn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=l,this.dirty=!1}}class qc extends Gn{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class zl extends Gn{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class Zc extends Gn{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class Gc extends Gn{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class na extends Gn{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Vh extends Gn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class qh extends Gn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Hc extends Gn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class Es extends Gn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Zh extends Gn{getDefault(){return null}set(l){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class ra extends Gn{getDefault(){return null}set(l){var f;if(l===this.current&&!this.dirty)return;const _=this.gl;vi(_)?_.bindVertexArray(l):(f=_.getExtension("OES_vertex_array_object"))===null||f===void 0||f.bindVertexArrayOES(l),this.current=l,this.dirty=!1}}class ia extends Gn{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class Gh extends Gn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class Wc extends Gn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Vn extends Gn{constructor(l,f){super(l),this.context=l,this.parent=f}getDefault(){return null}}class Dl extends Vn{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class qd extends Vn{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Hh extends Vn{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Za{constructor(l,f,_,b,k){this.context=l,this.width=f,this.height=_;const E=l.gl,A=this.framebuffer=E.createFramebuffer();if(this.colorAttachment=new Dl(l,A),b)this.depthAttachment=k?new Hh(l,A):new qd(l,A);else if(k)throw new Error("Stencil cannot be set without depth");if(E.checkFramebufferStatus(E.FRAMEBUFFER)!==E.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){const _=this.depthAttachment.get();_&&l.deleteRenderbuffer(_)}l.deleteFramebuffer(this.framebuffer)}}class qr{constructor(l,f,_){this.blendFunction=l,this.blendColor=f,this.mask=_}}qr.Replace=[1,0],qr.disabled=new qr(qr.Replace,a.aO.transparent,[!1,!1,!1,!1]),qr.unblended=new qr(qr.Replace,a.aO.transparent,[!0,!0,!0,!0]),qr.alphaBlended=new qr([1,771],a.aO.transparent,[!0,!0,!0,!0]);class Zd{constructor(l){var f,_;if(this.gl=l,this.clearColor=new El(this),this.clearDepth=new Il(this),this.clearStencil=new Nc(this),this.colorMask=new jc(this),this.depthMask=new Al(this),this.stencilMask=new Uc(this),this.stencilFunc=new Vc(this),this.stencilOp=new Pl(this),this.stencilTest=new jh(this),this.depthRange=new Uh(this),this.depthTest=new ta(this),this.depthFunc=new Bd(this),this.blend=new Od(this),this.blendFunc=new Nd(this),this.blendColor=new jd(this),this.blendEquation=new Ud(this),this.cullFace=new Vd(this),this.cullFaceSide=new qc(this),this.frontFace=new zl(this),this.program=new Zc(this),this.activeTexture=new Gc(this),this.viewport=new na(this),this.bindFramebuffer=new Vh(this),this.bindRenderbuffer=new qh(this),this.bindTexture=new Hc(this),this.bindVertexBuffer=new Es(this),this.bindElementBuffer=new Zh(this),this.bindVertexArray=new ra(this),this.pixelStoreUnpack=new ia(this),this.pixelStoreUnpackPremultiplyAlpha=new Gh(this),this.pixelStoreUnpackFlipY=new Wc(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),vi(l)){this.HALF_FLOAT=l.HALF_FLOAT;const b=l.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(f=l.RGBA16F)!==null&&f!==void 0?f:b==null?void 0:b.RGBA16F_EXT,this.RGB16F=(_=l.RGB16F)!==null&&_!==void 0?_:b==null?void 0:b.RGB16F_EXT,l.getExtension("EXT_color_buffer_float")}else{l.getExtension("EXT_color_buffer_half_float"),l.getExtension("OES_texture_half_float_linear");const b=l.getExtension("OES_texture_half_float");this.HALF_FLOAT=b==null?void 0:b.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,f){return new Fd(this,l,f)}createVertexBuffer(l,f,_){return new Ll(this,l,f,_)}createRenderbuffer(l,f,_){const b=this.gl,k=b.createRenderbuffer();return this.bindRenderbuffer.set(k),b.renderbufferStorage(b.RENDERBUFFER,l,f,_),this.bindRenderbuffer.set(null),k}createFramebuffer(l,f,_,b){return new Za(this,l,f,_,b)}clear({color:l,depth:f,stencil:_}){const b=this.gl;let k=0;l&&(k|=b.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(k|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),_!==void 0&&(k|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),b.clear(k)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){a.aD(l.blendFunction,qr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}createVertexArray(){var l;return vi(this.gl)?this.gl.createVertexArray():(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.createVertexArrayOES()}deleteVertexArray(l){var f;return vi(this.gl)?this.gl.deleteVertexArray(l):(f=this.gl.getExtension("OES_vertex_array_object"))===null||f===void 0?void 0:f.deleteVertexArrayOES(l)}unbindVAO(){this.bindVertexArray.set(null)}}class On{constructor(l,f,_){this.func=l,this.mask=f,this.range=_}}On.ReadOnly=!1,On.ReadWrite=!0,On.disabled=new On(519,On.ReadOnly,[0,1]);const Kc=7680;class gr{constructor(l,f,_,b,k,E){this.test=l,this.ref=f,this.mask=_,this.fail=b,this.depthFail=k,this.pass=E}}gr.disabled=new gr({func:519,mask:0},0,0,Kc,Kc,Kc);class fr{constructor(l,f,_){this.enable=l,this.mode=f,this.frontFace=_}}let Is;function Rl(x,l,f,_,b,k,E){const A=x.context,B=A.gl,Z=x.useProgram("collisionBox"),X=[];let Q=0,pe=0;for(let Le=0;Le<_.length;Le++){const Ue=_[Le],Qe=l.getTile(Ue),et=Qe.getBucket(f);if(!et)continue;let ot=Ue.posMatrix;b[0]===0&&b[1]===0||(ot=x.translatePosMatrix(Ue.posMatrix,Qe,b,k));const _t=E?et.textCollisionBox:et.iconCollisionBox,dt=et.collisionCircleArray;if(dt.length>0){const At=a.F(),Rt=ot;a.aP(At,et.placementInvProjMatrix,x.transform.glCoordMatrix),a.aP(At,At,et.placementViewportMatrix),X.push({circleArray:dt,circleOffset:pe,transform:Rt,invTransform:At,coord:Ue}),Q+=dt.length/4,pe=Q}_t&&Z.draw(A,B.LINES,On.disabled,gr.disabled,x.colorModeForRenderPass(),fr.disabled,Rh(ot,x.transform,Qe),x.style.map.terrain&&x.style.map.terrain.getTerrainData(Ue),f.id,_t.layoutVertexBuffer,_t.indexBuffer,_t.segments,null,x.transform.zoom,null,null,_t.collisionVertexBuffer)}if(!E||!X.length)return;const Se=x.useProgram("collisionCircle"),ke=new a.aQ;ke.resize(4*Q),ke._trim();let Me=0;for(const Le of X)for(let Ue=0;Ue<Le.circleArray.length/4;Ue++){const Qe=4*Ue,et=Le.circleArray[Qe+0],ot=Le.circleArray[Qe+1],_t=Le.circleArray[Qe+2],dt=Le.circleArray[Qe+3];ke.emplace(Me++,et,ot,_t,dt,0),ke.emplace(Me++,et,ot,_t,dt,1),ke.emplace(Me++,et,ot,_t,dt,2),ke.emplace(Me++,et,ot,_t,dt,3)}(!Is||Is.length<2*Q)&&(Is=function(Le){const Ue=2*Le,Qe=new a.aS;Qe.resize(Ue),Qe._trim();for(let et=0;et<Ue;et++){const ot=6*et;Qe.uint16[ot+0]=4*et+0,Qe.uint16[ot+1]=4*et+1,Qe.uint16[ot+2]=4*et+2,Qe.uint16[ot+3]=4*et+2,Qe.uint16[ot+4]=4*et+3,Qe.uint16[ot+5]=4*et+0}return Qe}(Q));const be=A.createIndexBuffer(Is,!0),Fe=A.createVertexBuffer(ke,a.aR.members,!0);for(const Le of X){const Ue={u_matrix:Le.transform,u_inv_matrix:Le.invTransform,u_camera_to_center_distance:(Je=x.transform).cameraToCenterDistance,u_viewport_size:[Je.width,Je.height]};Se.draw(A,B.TRIANGLES,On.disabled,gr.disabled,x.colorModeForRenderPass(),fr.disabled,Ue,x.style.map.terrain&&x.style.map.terrain.getTerrainData(Le.coord),f.id,Fe,be,a.$.simpleSegment(0,2*Le.circleOffset,Le.circleArray.length,Le.circleArray.length/2),null,x.transform.zoom,null,null,null)}var Je;Fe.destroy(),be.destroy()}fr.disabled=new fr(!1,1029,2305),fr.backCCW=new fr(!0,1029,2305);const Xc=a.an(new Float32Array(16));function Wh(x,l,f,_,b,k){const{horizontalAlign:E,verticalAlign:A}=a.at(x);return new a.P((-(E-.5)*l/b+_[0])*k,(-(A-.5)*f/b+_[1])*k)}function $l(x,l,f,_,b,k,E,A,B,Z,X){const Q=x.text.placedSymbolArray,pe=x.text.dynamicLayoutVertexArray,Se=x.icon.dynamicLayoutVertexArray,ke={};pe.clear();for(let Me=0;Me<Q.length;Me++){const be=Q.get(Me),Fe=be.hidden||!be.crossTileID||x.allowVerticalPlacement&&!be.placedOrientation?null:_[be.crossTileID];if(Fe){const Je=new a.P(be.anchorX,be.anchorY),Le=_r(Je,f?E:k,X),Ue=Ce(b.cameraToCenterDistance,Le.signedDistanceFromCamera);let Qe=a.ai(x.textSizeData,B,be)*Ue/a.ao;f&&(Qe*=x.tilePixelRatio/A);const{width:et,height:ot,anchor:_t,textOffset:dt,textBoxScale:At}=Fe,Rt=Wh(_t,et,ot,dt,At,Qe),yn=f?_r(Je.add(Rt),k,X).point:Le.point.add(l?Rt.rotate(-b.angle):Rt),$t=x.allowVerticalPlacement&&be.placedOrientation===a.ah.vertical?Math.PI/2:0;for(let fn=0;fn<be.numGlyphs;fn++)a.aj(pe,yn,$t);Z&&be.associatedIconIndex>=0&&(ke[be.associatedIconIndex]={shiftedAnchor:yn,angle:$t})}else Ye(be.numGlyphs,pe)}if(Z){Se.clear();const Me=x.icon.placedSymbolArray;for(let be=0;be<Me.length;be++){const Fe=Me.get(be);if(Fe.hidden)Ye(Fe.numGlyphs,Se);else{const Je=ke[be];if(Je)for(let Le=0;Le<Fe.numGlyphs;Le++)a.aj(Se,Je.shiftedAnchor,Je.angle);else Ye(Fe.numGlyphs,Se)}}x.icon.dynamicLayoutVertexBuffer.updateData(Se)}x.text.dynamicLayoutVertexBuffer.updateData(pe)}function Fl(x,l,f){return f.iconsInText&&l?"symbolTextAndIcon":x?"symbolSDF":"symbolIcon"}function Bl(x,l,f,_,b,k,E,A,B,Z,X,Q){const pe=x.context,Se=pe.gl,ke=x.transform,Me=A==="map",be=B==="map",Fe=A!=="viewport"&&f.layout.get("symbol-placement")!=="point",Je=Me&&!be&&!Fe,Le=!f.layout.get("symbol-sort-key").isConstant();let Ue=!1;const Qe=x.depthModeForSublayer(0,On.ReadOnly),et=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ot=[];for(const _t of _){const dt=l.getTile(_t),At=dt.getBucket(f);if(!At)continue;const Rt=b?At.text:At.icon;if(!Rt||!Rt.segments.get().length||!Rt.hasVisibleVertices)continue;const yn=Rt.programConfigurations.get(f.id),$t=b||At.sdfIcons,fn=b?At.textSizeData:At.iconSizeData,bn=be||ke.pitch!==0,Nn=x.useProgram(Fl($t,b,At),yn),gn=a.ag(fn,ke.zoom),xn=x.style.map.terrain&&x.style.map.terrain.getTerrainData(_t);let Tn,$r,ir,Ji,ri=[0,0],Cr=null;if(b)$r=dt.glyphAtlasTexture,ir=Se.LINEAR,Tn=dt.glyphAtlasTexture.size,At.iconsInText&&(ri=dt.imageAtlasTexture.size,Cr=dt.imageAtlasTexture,Ji=bn||x.options.rotating||x.options.zooming||fn.kind==="composite"||fn.kind==="camera"?Se.LINEAR:Se.NEAREST);else{const Xr=f.layout.get("icon-size").constantOr(0)!==1||At.iconsNeedLinear;$r=dt.imageAtlasTexture,ir=$t||x.options.rotating||x.options.zooming||Xr||bn?Se.LINEAR:Se.NEAREST,Tn=dt.imageAtlasTexture.size}const ii=hn(dt,1,x.transform.zoom),Yi=_n(_t.posMatrix,be,Me,x.transform,ii),Vo=Nr(_t.posMatrix,be,Me,x.transform,ii),vs=et&&At.hasTextData(),il=f.layout.get("icon-text-fit")!=="none"&&vs&&At.hasIconData();if(Fe){const Xr=x.style.map.terrain?(uo,Jr)=>x.style.map.terrain.getElevation(_t,uo,Jr):null,Mr=f.layout.get("text-rotation-alignment")==="map";ie(At,_t.posMatrix,x,b,Yi,Vo,be,Z,Mr,Xr)}const ws=x.translatePosMatrix(_t.posMatrix,dt,k,E),qo=Fe||b&&et||il?Xc:Yi,Kr=x.translatePosMatrix(Vo,dt,k,E,!0),Tr=$t&&f.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let xr;xr=$t?At.iconsInText?qa(fn.kind,gn,Je,be,x,ws,qo,Kr,Tn,ri):Va(fn.kind,gn,Je,be,x,ws,qo,Kr,b,Tn,!0):Ua(fn.kind,gn,Je,be,x,ws,qo,Kr,b,Tn);const co={program:Nn,buffers:Rt,uniformValues:xr,atlasTexture:$r,atlasTextureIcon:Cr,atlasInterpolation:ir,atlasInterpolationIcon:Ji,isSDF:$t,hasHalo:Tr};if(Le&&At.canOverlap){Ue=!0;const Xr=Rt.segments.get();for(const Mr of Xr)ot.push({segments:new a.$([Mr]),sortKey:Mr.sortKey,state:co,terrainData:xn})}else ot.push({segments:Rt.segments,sortKey:0,state:co,terrainData:xn})}Ue&&ot.sort((_t,dt)=>_t.sortKey-dt.sortKey);for(const _t of ot){const dt=_t.state;if(pe.activeTexture.set(Se.TEXTURE0),dt.atlasTexture.bind(dt.atlasInterpolation,Se.CLAMP_TO_EDGE),dt.atlasTextureIcon&&(pe.activeTexture.set(Se.TEXTURE1),dt.atlasTextureIcon&&dt.atlasTextureIcon.bind(dt.atlasInterpolationIcon,Se.CLAMP_TO_EDGE)),dt.isSDF){const At=dt.uniformValues;dt.hasHalo&&(At.u_is_halo=1,Kh(dt.buffers,_t.segments,f,x,dt.program,Qe,X,Q,At,_t.terrainData)),At.u_is_halo=0}Kh(dt.buffers,_t.segments,f,x,dt.program,Qe,X,Q,dt.uniformValues,_t.terrainData)}}function Kh(x,l,f,_,b,k,E,A,B,Z){const X=_.context;b.draw(X,X.gl.TRIANGLES,k,E,A,fr.disabled,B,Z,f.id,x.layoutVertexBuffer,x.indexBuffer,l,f.paint,_.transform.zoom,x.programConfigurations.get(f.id),x.dynamicLayoutVertexBuffer,x.opacityVertexBuffer)}function Ol(x,l,f,_,b){if(!f||!_||!_.imageAtlas)return;const k=_.imageAtlas.patternPositions;let E=k[f.to.toString()],A=k[f.from.toString()];if(!E&&A&&(E=A),!A&&E&&(A=E),!E||!A){const B=b.getPaintProperty(l);E=k[B],A=k[B]}E&&A&&x.setConstantPatternPositions(E,A)}function Xh(x,l,f,_,b,k,E){const A=x.context.gl,B="fill-pattern",Z=f.paint.get(B),X=Z&&Z.constantOr(1),Q=f.getCrossfadeParameters();let pe,Se,ke,Me,be;E?(Se=X&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",pe=A.LINES):(Se=X?"fillPattern":"fill",pe=A.TRIANGLES);const Fe=Z.constantOr(null);for(const Je of _){const Le=l.getTile(Je);if(X&&!Le.patternsLoaded())continue;const Ue=Le.getBucket(f);if(!Ue)continue;const Qe=Ue.programConfigurations.get(f.id),et=x.useProgram(Se,Qe),ot=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Je);X&&(x.context.activeTexture.set(A.TEXTURE0),Le.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),Qe.updatePaintBuffers(Q)),Ol(Qe,B,Fe,Le,f);const _t=ot?Je:null,dt=x.translatePosMatrix(_t?_t.posMatrix:Je.posMatrix,Le,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(E){Me=Ue.indexBuffer2,be=Ue.segments2;const At=[A.drawingBufferWidth,A.drawingBufferHeight];ke=Se==="fillOutlinePattern"&&X?Dh(dt,x,Q,Le,At):zd(dt,At)}else Me=Ue.indexBuffer,be=Ue.segments,ke=X?kl(dt,x,Q,Le):zh(dt);et.draw(x.context,pe,b,x.stencilModeForClipping(Je),k,fr.disabled,ke,ot,f.id,Ue.layoutVertexBuffer,Me,be,f.paint,x.transform.zoom,Qe)}}function Nl(x,l,f,_,b,k,E){const A=x.context,B=A.gl,Z="fill-extrusion-pattern",X=f.paint.get(Z),Q=X.constantOr(1),pe=f.getCrossfadeParameters(),Se=f.paint.get("fill-extrusion-opacity"),ke=X.constantOr(null);for(const Me of _){const be=l.getTile(Me),Fe=be.getBucket(f);if(!Fe)continue;const Je=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Me),Le=Fe.programConfigurations.get(f.id),Ue=x.useProgram(Q?"fillExtrusionPattern":"fillExtrusion",Le);Q&&(x.context.activeTexture.set(B.TEXTURE0),be.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Le.updatePaintBuffers(pe)),Ol(Le,Z,ke,be,f);const Qe=x.translatePosMatrix(Me.posMatrix,be,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),et=f.paint.get("fill-extrusion-vertical-gradient"),ot=Q?Pd(Qe,x,et,Se,Me,pe,be):Oa(Qe,x,et,Se);Ue.draw(A,A.gl.TRIANGLES,b,k,E,fr.backCCW,ot,Je,f.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,f.paint,x.transform.zoom,Le,x.style.map.terrain&&Fe.centroidVertexBuffer)}}function jl(x,l,f,_,b,k,E){const A=x.context,B=A.gl,Z=f.fbo;if(!Z)return;const X=x.useProgram("hillshade"),Q=x.style.map.terrain&&x.style.map.terrain.getTerrainData(l);A.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,Z.colorAttachment.get()),X.draw(A,B.TRIANGLES,b,k,E,fr.disabled,((pe,Se,ke,Me)=>{const be=ke.paint.get("hillshade-shadow-color"),Fe=ke.paint.get("hillshade-highlight-color"),Je=ke.paint.get("hillshade-accent-color");let Le=ke.paint.get("hillshade-illumination-direction")*(Math.PI/180);ke.paint.get("hillshade-illumination-anchor")==="viewport"&&(Le-=pe.transform.angle);const Ue=!pe.options.moving;return{u_matrix:Me?Me.posMatrix:pe.transform.calculatePosMatrix(Se.tileID.toUnwrapped(),Ue),u_image:0,u_latrange:Bh(0,Se.tileID),u_light:[ke.paint.get("hillshade-exaggeration"),Le],u_shadow:be,u_highlight:Fe,u_accent:Je}})(x,f,_,Q?l:null),Q,_.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments)}function Jc(x,l,f,_,b,k){const E=x.context,A=E.gl,B=l.dem;if(B&&B.data){const Z=B.dim,X=B.stride,Q=B.getPixels();if(E.activeTexture.set(A.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||x.getTileTexture(X),l.demTexture){const Se=l.demTexture;Se.update(Q,{premultiply:!1}),Se.bind(A.NEAREST,A.CLAMP_TO_EDGE)}else l.demTexture=new ee(E,Q,A.RGBA,{premultiply:!1}),l.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);E.activeTexture.set(A.TEXTURE0);let pe=l.fbo;if(!pe){const Se=new ee(E,{width:Z,height:Z,data:null},A.RGBA);Se.bind(A.LINEAR,A.CLAMP_TO_EDGE),pe=l.fbo=E.createFramebuffer(Z,Z,!0,!1),pe.colorAttachment.set(Se.texture)}E.bindFramebuffer.set(pe.framebuffer),E.viewport.set([0,0,Z,Z]),x.useProgram("hillshadePrepare").draw(E,A.TRIANGLES,_,b,k,fr.disabled,((Se,ke)=>{const Me=ke.stride,be=a.F();return a.aN(be,0,a.W,-a.W,0,0,1),a.H(be,be,[0,-a.W,0]),{u_matrix:be,u_image:1,u_dimension:[Me,Me],u_zoom:Se.overscaledZ,u_unpack:ke.getUnpackVector()}})(l.tileID,B),null,f.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments),l.needsHillshadePrepare=!1}}function Jh(x,l,f,_,b,k){const E=_.paint.get("raster-fade-duration");if(!k&&E>0){const A=y.now(),B=(A-x.timeAdded)/E,Z=l?(A-l.timeAdded)/E:-1,X=f.getSource(),Q=b.coveringZoomLevel({tileSize:X.tileSize,roundZoom:X.roundZoom}),pe=!l||Math.abs(l.tileID.overscaledZ-Q)>Math.abs(x.tileID.overscaledZ-Q),Se=pe&&x.refreshedUponExpiration?1:a.ac(pe?B:1-Z,0,1);return x.refreshedUponExpiration&&B>=1&&(x.refreshedUponExpiration=!1),l?{opacity:1,mix:1-Se}:{opacity:Se,mix:0}}return{opacity:1,mix:0}}const Yh=new a.aO(1,0,0,1),Ul=new a.aO(0,1,0,1),Yc=new a.aO(0,0,1,1),Gd=new a.aO(1,0,1,1),Qh=new a.aO(0,1,1,1);function Dr(x,l,f,_){Mi(x,0,l+f/2,x.transform.width,f,_)}function _s(x,l,f,_){Mi(x,l-f/2,0,f,x.transform.height,_)}function Mi(x,l,f,_,b,k){const E=x.context,A=E.gl;A.enable(A.SCISSOR_TEST),A.scissor(l*x.pixelRatio,f*x.pixelRatio,_*x.pixelRatio,b*x.pixelRatio),E.clear({color:k}),A.disable(A.SCISSOR_TEST)}function Qc(x,l,f){const _=x.context,b=_.gl,k=f.posMatrix,E=x.useProgram("debug"),A=On.disabled,B=gr.disabled,Z=x.colorModeForRenderPass(),X="$debug",Q=x.style.map.terrain&&x.style.map.terrain.getTerrainData(f);_.activeTexture.set(b.TEXTURE0);const pe=l.getTileByID(f.key).latestRawTileData,Se=Math.floor((pe&&pe.byteLength||0)/1024),ke=l.getTile(f).tileSize,Me=512/Math.min(ke,512)*(f.overscaledZ/x.transform.zoom)*.5;let be=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(be+=` => ${f.overscaledZ}`),function(Fe,Je){Fe.initDebugOverlayCanvas();const Le=Fe.debugOverlayCanvas,Ue=Fe.context.gl,Qe=Fe.debugOverlayCanvas.getContext("2d");Qe.clearRect(0,0,Le.width,Le.height),Qe.shadowColor="white",Qe.shadowBlur=2,Qe.lineWidth=1.5,Qe.strokeStyle="white",Qe.textBaseline="top",Qe.font="bold 36px Open Sans, sans-serif",Qe.fillText(Je,5,5),Qe.strokeText(Je,5,5),Fe.debugOverlayTexture.update(Le),Fe.debugOverlayTexture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE)}(x,`${be} ${Se}kB`),E.draw(_,b.TRIANGLES,A,B,qr.alphaBlended,fr.disabled,$h(k,a.aO.transparent,Me),null,X,x.debugBuffer,x.quadTriangleIndexBuffer,x.debugSegments),E.draw(_,b.LINE_STRIP,A,B,Z,fr.disabled,$h(k,a.aO.red),Q,X,x.debugBuffer,x.tileBorderIndexBuffer,x.debugSegments)}function Vl(x,l,f){const _=x.context,b=_.gl,k=x.colorModeForRenderPass(),E=new On(b.LEQUAL,On.ReadWrite,x.depthRangeFor3D),A=x.useProgram("terrain"),B=l.getTerrainMesh();_.bindFramebuffer.set(null),_.viewport.set([0,0,x.width,x.height]);for(const Z of f){const X=x.renderToTexture.getTexture(Z),Q=l.getTerrainData(Z.tileID);_.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,X.texture);const pe={u_matrix:x.transform.calculatePosMatrix(Z.tileID.toUnwrapped()),u_texture:0,u_ele_delta:l.getMeshFrameDelta(x.transform.zoom)};A.draw(_,b.TRIANGLES,E,gr.disabled,k,fr.backCCW,pe,Q,"terrain",B.vertexBuffer,B.indexBuffer,B.segments)}}class ef{constructor(l,f){this.context=new Zd(l),this.transform=f,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Yn.maxUnderzooming+Yn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ps}resize(l,f,_){if(this.width=Math.floor(l*_),this.height=Math.floor(f*_),this.pixelRatio=_,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const b of this.style._order)this.style._layers[b].resize()}setup(){const l=this.context,f=new a.aV;f.emplaceBack(0,0),f.emplaceBack(a.W,0),f.emplaceBack(0,a.W),f.emplaceBack(a.W,a.W),this.tileExtentBuffer=l.createVertexBuffer(f,vl.members),this.tileExtentSegments=a.$.simpleSegment(0,0,4,2);const _=new a.aV;_.emplaceBack(0,0),_.emplaceBack(a.W,0),_.emplaceBack(0,a.W),_.emplaceBack(a.W,a.W),this.debugBuffer=l.createVertexBuffer(_,vl.members),this.debugSegments=a.$.simpleSegment(0,0,4,5);const b=new a.Z;b.emplaceBack(0,0,0,0),b.emplaceBack(a.W,0,a.W,0),b.emplaceBack(0,a.W,0,a.W),b.emplaceBack(a.W,a.W,a.W,a.W),this.rasterBoundsBuffer=l.createVertexBuffer(b,tt.members),this.rasterBoundsSegments=a.$.simpleSegment(0,0,4,2);const k=new a.aV;k.emplaceBack(0,0),k.emplaceBack(1,0),k.emplaceBack(0,1),k.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(k,vl.members),this.viewportSegments=a.$.simpleSegment(0,0,4,2);const E=new a.aW;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(E);const A=new a.aX;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(A);const B=this.context.gl;this.stencilClearMode=new gr({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO)}clearStencil(){const l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const _=a.F();a.aN(_,0,this.width,this.height,0,0,1),a.J(_,_,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,f.TRIANGLES,On.disabled,this.stencilClearMode,qr.disabled,fr.disabled,Sl(_),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(l,f){if(this.currentStencilSource===l.source||!l.isTileClipped()||!f||!f.length)return;this.currentStencilSource=l.source;const _=this.context,b=_.gl;this.nextStencilID+f.length>256&&this.clearStencil(),_.setColorMode(qr.disabled),_.setDepthMode(On.disabled);const k=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of f){const A=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,B=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E);k.draw(_,b.TRIANGLES,On.disabled,new gr({func:b.ALWAYS,mask:0},A,255,b.KEEP,b.KEEP,b.REPLACE),qr.disabled,fr.disabled,Sl(E.posMatrix),B,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,f=this.context.gl;return new gr({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(l){const f=this.context.gl;return new gr({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(l){const f=this.context.gl,_=l.sort((E,A)=>A.overscaledZ-E.overscaledZ),b=_[_.length-1].overscaledZ,k=_[0].overscaledZ-b+1;if(k>1){this.currentStencilSource=void 0,this.nextStencilID+k>256&&this.clearStencil();const E={};for(let A=0;A<k;A++)E[A+b]=new gr({func:f.GEQUAL,mask:255},A+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=k,[E,_]}return[{[b]:gr.disabled},_]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new qr([l.CONSTANT_COLOR,l.ONE],new a.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?qr.unblended:qr.alphaBlended}depthModeForSublayer(l,f,_){if(!this.opaquePassEnabledForLayer())return On.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new On(_||this.context.gl.LEQUAL,f,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,f){this.style=l,this.options=f,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(y.now()),this.imageManager.beginFrame();const _=this.style._order,b=this.style.sourceCaches,k={},E={},A={};for(const B in b){const Z=b[B];Z.used&&Z.prepare(this.context),k[B]=Z.getVisibleCoordinates(),E[B]=k[B].slice().reverse(),A[B]=Z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let B=0;B<_.length;B++)if(this.style._layers[_[B]].is3D()){this.opaquePassCutoff=B;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const B of _){const Z=this.style._layers[B];if(!Z.hasOffscreenPass()||Z.isHidden(this.transform.zoom))continue;const X=E[Z.source];(Z.type==="custom"||X.length)&&this.renderLayer(this,b[Z.source],Z,X)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?a.aO.black:a.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const B=this.style._layers[_[this.currentLayer]],Z=b[B.source],X=k[B.source];this._renderTileClippingMasks(B,X),this.renderLayer(this,Z,B,X)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const B=this.style._layers[_[this.currentLayer]],Z=b[B.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(B))continue;const X=(B.type==="symbol"?A:E)[B.source];this._renderTileClippingMasks(B,k[B.source]),this.renderLayer(this,Z,B,X)}if(this.options.showTileBoundaries){const B=function(Z,X){let Q=null;const pe=Object.values(Z._layers).flatMap(be=>be.source&&!be.isHidden(X)?[Z.sourceCaches[be.source]]:[]),Se=pe.filter(be=>be.getSource().type==="vector"),ke=pe.filter(be=>be.getSource().type!=="vector"),Me=be=>{(!Q||Q.getSource().maxzoom<be.getSource().maxzoom)&&(Q=be)};return Se.forEach(be=>Me(be)),Q||ke.forEach(be=>Me(be)),Q}(this.style,this.transform.zoom);B&&function(Z,X,Q){for(let pe=0;pe<Q.length;pe++)Qc(Z,X,Q[pe])}(this,B,B.getVisibleCoordinates())}this.options.showPadding&&function(B){const Z=B.transform.padding;Dr(B,B.transform.height-(Z.top||0),3,Yh),Dr(B,Z.bottom||0,3,Ul),_s(B,Z.left||0,3,Yc),_s(B,B.transform.width-(Z.right||0),3,Gd);const X=B.transform.centerPoint;(function(Q,pe,Se,ke){Mi(Q,pe-1,Se-10,2,20,ke),Mi(Q,pe-10,Se-1,20,2,ke)})(B,X.x,B.transform.height-X.y,Qh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(l){if(!this.style||!this.style.map||!this.style.map.terrain)return;const f=this.terrainFacilitator.matrix,_=this.transform.projMatrix;let b=this.terrainFacilitator.dirty;b||(b=l?!a.aY(f,_):!a.aZ(f,_)),b||(b=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),b&&(a.a_(f,_),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(k,E){const A=k.context,B=A.gl,Z=qr.unblended,X=new On(B.LEQUAL,On.ReadWrite,[0,1]),Q=E.getTerrainMesh(),pe=E.sourceCache.getRenderableTiles(),Se=k.useProgram("terrainDepth");A.bindFramebuffer.set(E.getFramebuffer("depth").framebuffer),A.viewport.set([0,0,k.width/devicePixelRatio,k.height/devicePixelRatio]),A.clear({color:a.aO.transparent,depth:1});for(const ke of pe){const Me=E.getTerrainData(ke.tileID),be={u_matrix:k.transform.calculatePosMatrix(ke.tileID.toUnwrapped()),u_ele_delta:E.getMeshFrameDelta(k.transform.zoom)};Se.draw(A,B.TRIANGLES,X,gr.disabled,Z,fr.backCCW,be,Me,"terrain",Q.vertexBuffer,Q.indexBuffer,Q.segments)}A.bindFramebuffer.set(null),A.viewport.set([0,0,k.width,k.height])}(this,this.style.map.terrain),function(k,E){const A=k.context,B=A.gl,Z=qr.unblended,X=new On(B.LEQUAL,On.ReadWrite,[0,1]),Q=E.getTerrainMesh(),pe=E.getCoordsTexture(),Se=E.sourceCache.getRenderableTiles(),ke=k.useProgram("terrainCoords");A.bindFramebuffer.set(E.getFramebuffer("coords").framebuffer),A.viewport.set([0,0,k.width/devicePixelRatio,k.height/devicePixelRatio]),A.clear({color:a.aO.transparent,depth:1}),E.coordsIndex=[];for(const Me of Se){const be=E.getTerrainData(Me.tileID);A.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,pe.texture);const Fe={u_matrix:k.transform.calculatePosMatrix(Me.tileID.toUnwrapped()),u_terrain_coords_id:(255-E.coordsIndex.length)/255,u_texture:0,u_ele_delta:E.getMeshFrameDelta(k.transform.zoom)};ke.draw(A,B.TRIANGLES,X,gr.disabled,Z,fr.backCCW,Fe,be,"terrain",Q.vertexBuffer,Q.indexBuffer,Q.segments),E.coordsIndex.push(Me.tileID.key)}A.bindFramebuffer.set(null),A.viewport.set([0,0,k.width,k.height])}(this,this.style.map.terrain))}renderLayer(l,f,_,b){if(!_.isHidden(this.transform.zoom)&&(_.type==="background"||_.type==="custom"||(b||[]).length))switch(this.id=_.id,_.type){case"symbol":(function(k,E,A,B,Z){if(k.renderPass!=="translucent")return;const X=gr.disabled,Q=k.colorModeForRenderPass();(A._unevaluatedLayout.hasValue("text-variable-anchor")||A._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(pe,Se,ke,Me,be,Fe,Je){const Le=Se.transform,Ue=be==="map",Qe=Fe==="map";for(const et of pe){const ot=Me.getTile(et),_t=ot.getBucket(ke);if(!_t||!_t.text||!_t.text.segments.get().length)continue;const dt=a.ag(_t.textSizeData,Le.zoom),At=hn(ot,1,Se.transform.zoom),Rt=_n(et.posMatrix,Qe,Ue,Se.transform,At),yn=ke.layout.get("icon-text-fit")!=="none"&&_t.hasIconData();if(dt){const $t=Math.pow(2,Le.zoom-ot.tileID.overscaledZ);$l(_t,Ue,Qe,Je,Le,Rt,et.posMatrix,$t,dt,yn,Se.style.map.terrain?(fn,bn)=>Se.style.map.terrain.getElevation(et,fn,bn):null)}}}(B,k,A,E,A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),Z),A.paint.get("icon-opacity").constantOr(1)!==0&&Bl(k,E,A,B,!1,A.paint.get("icon-translate"),A.paint.get("icon-translate-anchor"),A.layout.get("icon-rotation-alignment"),A.layout.get("icon-pitch-alignment"),A.layout.get("icon-keep-upright"),X,Q),A.paint.get("text-opacity").constantOr(1)!==0&&Bl(k,E,A,B,!0,A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),A.layout.get("text-keep-upright"),X,Q),E.map.showCollisionBoxes&&(Rl(k,E,A,B,A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),!0),Rl(k,E,A,B,A.paint.get("icon-translate"),A.paint.get("icon-translate-anchor"),!1))})(l,f,_,b,this.style.placement.variableOffsets);break;case"circle":(function(k,E,A,B){if(k.renderPass!=="translucent")return;const Z=A.paint.get("circle-opacity"),X=A.paint.get("circle-stroke-width"),Q=A.paint.get("circle-stroke-opacity"),pe=!A.layout.get("circle-sort-key").isConstant();if(Z.constantOr(1)===0&&(X.constantOr(1)===0||Q.constantOr(1)===0))return;const Se=k.context,ke=Se.gl,Me=k.depthModeForSublayer(0,On.ReadOnly),be=gr.disabled,Fe=k.colorModeForRenderPass(),Je=[];for(let Le=0;Le<B.length;Le++){const Ue=B[Le],Qe=E.getTile(Ue),et=Qe.getBucket(A);if(!et)continue;const ot=et.programConfigurations.get(A.id),_t=k.useProgram("circle",ot),dt=et.layoutVertexBuffer,At=et.indexBuffer,Rt=k.style.map.terrain&&k.style.map.terrain.getTerrainData(Ue),yn={programConfiguration:ot,program:_t,layoutVertexBuffer:dt,indexBuffer:At,uniformValues:Dd(k,Ue,Qe,A),terrainData:Rt};if(pe){const $t=et.segments.get();for(const fn of $t)Je.push({segments:new a.$([fn]),sortKey:fn.sortKey,state:yn})}else Je.push({segments:et.segments,sortKey:0,state:yn})}pe&&Je.sort((Le,Ue)=>Le.sortKey-Ue.sortKey);for(const Le of Je){const{programConfiguration:Ue,program:Qe,layoutVertexBuffer:et,indexBuffer:ot,uniformValues:_t,terrainData:dt}=Le.state;Qe.draw(Se,ke.TRIANGLES,Me,be,Fe,fr.disabled,_t,dt,A.id,et,ot,Le.segments,A.paint,k.transform.zoom,Ue)}})(l,f,_,b);break;case"heatmap":(function(k,E,A,B){if(A.paint.get("heatmap-opacity")!==0)if(k.renderPass==="offscreen"){const Z=k.context,X=Z.gl,Q=gr.disabled,pe=new qr([X.ONE,X.ONE],a.aO.transparent,[!0,!0,!0,!0]);(function(Se,ke,Me){const be=Se.gl;Se.activeTexture.set(be.TEXTURE1),Se.viewport.set([0,0,ke.width/4,ke.height/4]);let Fe=Me.heatmapFbo;if(Fe)be.bindTexture(be.TEXTURE_2D,Fe.colorAttachment.get()),Se.bindFramebuffer.set(Fe.framebuffer);else{const Je=be.createTexture();be.bindTexture(be.TEXTURE_2D,Je),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_WRAP_S,be.CLAMP_TO_EDGE),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_WRAP_T,be.CLAMP_TO_EDGE),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_MIN_FILTER,be.LINEAR),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_MAG_FILTER,be.LINEAR),Fe=Me.heatmapFbo=Se.createFramebuffer(ke.width/4,ke.height/4,!1,!1),function(Le,Ue,Qe,et){var ot,_t;const dt=Le.gl,At=(ot=Le.HALF_FLOAT)!==null&&ot!==void 0?ot:dt.UNSIGNED_BYTE,Rt=(_t=Le.RGBA16F)!==null&&_t!==void 0?_t:dt.RGBA;dt.texImage2D(dt.TEXTURE_2D,0,Rt,Ue.width/4,Ue.height/4,0,dt.RGBA,At,null),et.colorAttachment.set(Qe)}(Se,ke,Je,Fe)}})(Z,k,A),Z.clear({color:a.aO.transparent});for(let Se=0;Se<B.length;Se++){const ke=B[Se];if(E.hasRenderableParent(ke))continue;const Me=E.getTile(ke),be=Me.getBucket(A);if(!be)continue;const Fe=be.programConfigurations.get(A.id),Je=k.useProgram("heatmap",Fe),{zoom:Le}=k.transform;Je.draw(Z,X.TRIANGLES,On.disabled,Q,pe,fr.disabled,Fh(ke.posMatrix,Me,Le,A.paint.get("heatmap-intensity")),null,A.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,A.paint,k.transform.zoom,Fe)}Z.viewport.set([0,0,k.width,k.height])}else k.renderPass==="translucent"&&(k.context.setColorMode(k.colorModeForRenderPass()),function(Z,X){const Q=Z.context,pe=Q.gl,Se=X.heatmapFbo;if(!Se)return;Q.activeTexture.set(pe.TEXTURE0),pe.bindTexture(pe.TEXTURE_2D,Se.colorAttachment.get()),Q.activeTexture.set(pe.TEXTURE1);let ke=X.colorRampTexture;ke||(ke=X.colorRampTexture=new ee(Q,X.colorRamp,pe.RGBA)),ke.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),Z.useProgram("heatmapTexture").draw(Q,pe.TRIANGLES,On.disabled,gr.disabled,Z.colorModeForRenderPass(),fr.disabled,((Me,be,Fe,Je)=>{const Le=a.F();a.aN(Le,0,Me.width,Me.height,0,0,1);const Ue=Me.context.gl;return{u_matrix:Le,u_world:[Ue.drawingBufferWidth,Ue.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:be.paint.get("heatmap-opacity")}})(Z,X),null,X.id,Z.viewportBuffer,Z.quadTriangleIndexBuffer,Z.viewportSegments,X.paint,Z.transform.zoom)}(k,A))})(l,f,_,b);break;case"line":(function(k,E,A,B){if(k.renderPass!=="translucent")return;const Z=A.paint.get("line-opacity"),X=A.paint.get("line-width");if(Z.constantOr(1)===0||X.constantOr(1)===0)return;const Q=k.depthModeForSublayer(0,On.ReadOnly),pe=k.colorModeForRenderPass(),Se=A.paint.get("line-dasharray"),ke=A.paint.get("line-pattern"),Me=ke.constantOr(1),be=A.paint.get("line-gradient"),Fe=A.getCrossfadeParameters(),Je=Me?"linePattern":Se?"lineSDF":be?"lineGradient":"line",Le=k.context,Ue=Le.gl;let Qe=!0;for(const et of B){const ot=E.getTile(et);if(Me&&!ot.patternsLoaded())continue;const _t=ot.getBucket(A);if(!_t)continue;const dt=_t.programConfigurations.get(A.id),At=k.context.program.get(),Rt=k.useProgram(Je,dt),yn=Qe||Rt.program!==At,$t=k.style.map.terrain&&k.style.map.terrain.getTerrainData(et),fn=ke.constantOr(null);if(fn&&ot.imageAtlas){const gn=ot.imageAtlas,xn=gn.patternPositions[fn.to.toString()],Tn=gn.patternPositions[fn.from.toString()];xn&&Tn&&dt.setConstantPatternPositions(xn,Tn)}const bn=$t?et:null,Nn=Me?Ms(k,ot,A,Fe,bn):Se?Tl(k,ot,A,Se,Fe,bn):be?Oh(k,ot,A,_t.lineClipsArray.length,bn):Cl(k,ot,A,bn);if(Me)Le.activeTexture.set(Ue.TEXTURE0),ot.imageAtlasTexture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE),dt.updatePaintBuffers(Fe);else if(Se&&(yn||k.lineAtlas.dirty))Le.activeTexture.set(Ue.TEXTURE0),k.lineAtlas.bind(Le);else if(be){const gn=_t.gradients[A.id];let xn=gn.texture;if(A.gradientVersion!==gn.version){let Tn=256;if(A.stepInterpolant){const $r=E.getSource().maxzoom,ir=et.canonical.z===$r?Math.ceil(1<<k.transform.maxZoom-et.canonical.z):1;Tn=a.ac(a.aT(_t.maxLineLength/a.W*1024*ir),256,Le.maxTextureSize)}gn.gradient=a.aU({expression:A.gradientExpression(),evaluationKey:"lineProgress",resolution:Tn,image:gn.gradient||void 0,clips:_t.lineClipsArray}),gn.texture?gn.texture.update(gn.gradient):gn.texture=new ee(Le,gn.gradient,Ue.RGBA),gn.version=A.gradientVersion,xn=gn.texture}Le.activeTexture.set(Ue.TEXTURE0),xn.bind(A.stepInterpolant?Ue.NEAREST:Ue.LINEAR,Ue.CLAMP_TO_EDGE)}Rt.draw(Le,Ue.TRIANGLES,Q,k.stencilModeForClipping(et),pe,fr.disabled,Nn,$t,A.id,_t.layoutVertexBuffer,_t.indexBuffer,_t.segments,A.paint,k.transform.zoom,dt,_t.layoutVertexBuffer2),Qe=!1}})(l,f,_,b);break;case"fill":(function(k,E,A,B){const Z=A.paint.get("fill-color"),X=A.paint.get("fill-opacity");if(X.constantOr(1)===0)return;const Q=k.colorModeForRenderPass(),pe=A.paint.get("fill-pattern"),Se=k.opaquePassEnabledForLayer()&&!pe.constantOr(1)&&Z.constantOr(a.aO.transparent).a===1&&X.constantOr(0)===1?"opaque":"translucent";if(k.renderPass===Se){const ke=k.depthModeForSublayer(1,k.renderPass==="opaque"?On.ReadWrite:On.ReadOnly);Xh(k,E,A,B,ke,Q,!1)}if(k.renderPass==="translucent"&&A.paint.get("fill-antialias")){const ke=k.depthModeForSublayer(A.getPaintProperty("fill-outline-color")?2:0,On.ReadOnly);Xh(k,E,A,B,ke,Q,!0)}})(l,f,_,b);break;case"fill-extrusion":(function(k,E,A,B){const Z=A.paint.get("fill-extrusion-opacity");if(Z!==0&&k.renderPass==="translucent"){const X=new On(k.context.gl.LEQUAL,On.ReadWrite,k.depthRangeFor3D);if(Z!==1||A.paint.get("fill-extrusion-pattern").constantOr(1))Nl(k,E,A,B,X,gr.disabled,qr.disabled),Nl(k,E,A,B,X,k.stencilModeFor3D(),k.colorModeForRenderPass());else{const Q=k.colorModeForRenderPass();Nl(k,E,A,B,X,gr.disabled,Q)}}})(l,f,_,b);break;case"hillshade":(function(k,E,A,B){if(k.renderPass!=="offscreen"&&k.renderPass!=="translucent")return;const Z=k.context,X=k.depthModeForSublayer(0,On.ReadOnly),Q=k.colorModeForRenderPass(),[pe,Se]=k.renderPass==="translucent"?k.stencilConfigForOverlap(B):[{},B];for(const ke of Se){const Me=E.getTile(ke);Me.needsHillshadePrepare!==void 0&&Me.needsHillshadePrepare&&k.renderPass==="offscreen"?Jc(k,Me,A,X,gr.disabled,Q):k.renderPass==="translucent"&&jl(k,ke,Me,A,X,pe[ke.overscaledZ],Q)}Z.viewport.set([0,0,k.width,k.height])})(l,f,_,b);break;case"raster":(function(k,E,A,B){if(k.renderPass!=="translucent"||A.paint.get("raster-opacity")===0||!B.length)return;const Z=k.context,X=Z.gl,Q=E.getSource(),pe=k.useProgram("raster"),Se=k.colorModeForRenderPass(),[ke,Me]=Q instanceof Kt?[{},B]:k.stencilConfigForOverlap(B),be=Me[Me.length-1].overscaledZ,Fe=!k.options.moving;for(const Je of Me){const Le=k.depthModeForSublayer(Je.overscaledZ-be,A.paint.get("raster-opacity")===1?On.ReadWrite:On.ReadOnly,X.LESS),Ue=E.getTile(Je);Ue.registerFadeDuration(A.paint.get("raster-fade-duration"));const Qe=E.findLoadedParent(Je,0),et=Jh(Ue,Qe,E,A,k.transform,k.style.map.terrain);let ot,_t;const dt=A.paint.get("raster-resampling")==="nearest"?X.NEAREST:X.LINEAR;Z.activeTexture.set(X.TEXTURE0),Ue.texture.bind(dt,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST),Z.activeTexture.set(X.TEXTURE1),Qe?(Qe.texture.bind(dt,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST),ot=Math.pow(2,Qe.tileID.overscaledZ-Ue.tileID.overscaledZ),_t=[Ue.tileID.canonical.x*ot%1,Ue.tileID.canonical.y*ot%1]):Ue.texture.bind(dt,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST);const At=k.style.map.terrain&&k.style.map.terrain.getTerrainData(Je),Rt=At?Je:null,yn=Rt?Rt.posMatrix:k.transform.calculatePosMatrix(Je.toUnwrapped(),Fe),$t=Ml(yn,_t||[0,0],ot||1,et,A);Q instanceof Kt?pe.draw(Z,X.TRIANGLES,Le,gr.disabled,Se,fr.disabled,$t,At,A.id,Q.boundsBuffer,k.quadTriangleIndexBuffer,Q.boundsSegments):pe.draw(Z,X.TRIANGLES,Le,ke[Je.overscaledZ],Se,fr.disabled,$t,At,A.id,k.rasterBoundsBuffer,k.quadTriangleIndexBuffer,k.rasterBoundsSegments)}})(l,f,_,b);break;case"background":(function(k,E,A,B){const Z=A.paint.get("background-color"),X=A.paint.get("background-opacity");if(X===0)return;const Q=k.context,pe=Q.gl,Se=k.transform,ke=Se.tileSize,Me=A.paint.get("background-pattern");if(k.isPatternMissing(Me))return;const be=!Me&&Z.a===1&&X===1&&k.opaquePassEnabledForLayer()?"opaque":"translucent";if(k.renderPass!==be)return;const Fe=gr.disabled,Je=k.depthModeForSublayer(0,be==="opaque"?On.ReadWrite:On.ReadOnly),Le=k.colorModeForRenderPass(),Ue=k.useProgram(Me?"backgroundPattern":"background"),Qe=B||Se.coveringTiles({tileSize:ke,terrain:k.style.map.terrain});Me&&(Q.activeTexture.set(pe.TEXTURE0),k.imageManager.bind(k.context));const et=A.getCrossfadeParameters();for(const ot of Qe){const _t=B?ot.posMatrix:k.transform.calculatePosMatrix(ot.toUnwrapped()),dt=Me?$d(_t,X,k,Me,{tileID:ot,tileSize:ke},et):Rd(_t,X,Z),At=k.style.map.terrain&&k.style.map.terrain.getTerrainData(ot);Ue.draw(Q,pe.TRIANGLES,Je,Fe,Le,fr.disabled,dt,At,A.id,k.tileExtentBuffer,k.quadTriangleIndexBuffer,k.tileExtentSegments)}})(l,0,_,b);break;case"custom":(function(k,E,A){const B=k.context,Z=A.implementation;if(k.renderPass==="offscreen"){const X=Z.prerender;X&&(k.setCustomLayerDefaults(),B.setColorMode(k.colorModeForRenderPass()),X.call(Z,B.gl,k.transform.customLayerMatrix()),B.setDirty(),k.setBaseState())}else if(k.renderPass==="translucent"){k.setCustomLayerDefaults(),B.setColorMode(k.colorModeForRenderPass()),B.setStencilMode(gr.disabled);const X=Z.renderingMode==="3d"?new On(k.context.gl.LEQUAL,On.ReadWrite,k.depthRangeFor3D):k.depthModeForSublayer(0,On.ReadOnly);B.setDepthMode(X),Z.render(B.gl,k.transform.customLayerMatrix()),B.setDirty(),k.setBaseState(),B.bindFramebuffer.set(null)}})(l,0,_)}}translatePosMatrix(l,f,_,b,k){if(!_[0]&&!_[1])return l;const E=k?b==="map"?this.transform.angle:0:b==="viewport"?-this.transform.angle:0;if(E){const Z=Math.sin(E),X=Math.cos(E);_=[_[0]*X-_[1]*Z,_[0]*Z+_[1]*X]}const A=[k?_[0]:hn(f,_[0],this.transform.zoom),k?_[1]:hn(f,_[1],this.transform.zoom),0],B=new Float32Array(16);return a.H(B,l,A),B}saveTileTexture(l){const f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const f=this._tileTextures[l];return f&&f.length>0?f.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const f=this.imageManager.getPattern(l.from.toString()),_=this.imageManager.getPattern(l.to.toString());return!f||!_}useProgram(l,f){this.cache=this.cache||{};const _=l+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[_]||(this.cache[_]=new ms(this.context,Ba[l],f,Nh[l],this._showOverdrawInspector,this.style.map.terrain)),this.cache[_]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ee(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:l,drawingBufferHeight:f}=this.context.gl;return this.width!==l||this.height!==f}}class gs{constructor(l,f){this.points=l,this.planes=f}static fromInvProjectionMatrix(l,f,_){const b=Math.pow(2,_),k=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const B=1/(A=a.af([],A,l))[3]/f*b;return a.a$(A,A,[B,B,1/A[3],B])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const B=function(pe,Se){var ke=Se[0],Me=Se[1],be=Se[2],Fe=ke*ke+Me*Me+be*be;return Fe>0&&(Fe=1/Math.sqrt(Fe)),pe[0]=Se[0]*Fe,pe[1]=Se[1]*Fe,pe[2]=Se[2]*Fe,pe}([],function(pe,Se,ke){var Me=Se[0],be=Se[1],Fe=Se[2],Je=ke[0],Le=ke[1],Ue=ke[2];return pe[0]=be*Ue-Fe*Le,pe[1]=Fe*Je-Me*Ue,pe[2]=Me*Le-be*Je,pe}([],Y([],k[A[0]],k[A[1]]),Y([],k[A[2]],k[A[1]]))),Z=-((X=B)[0]*(Q=k[A[1]])[0]+X[1]*Q[1]+X[2]*Q[2]);var X,Q;return B.concat(Z)});return new gs(k,E)}}class ys{constructor(l,f){this.min=l,this.max=f,this.center=function(_,b,k){return _[0]=.5*b[0],_[1]=.5*b[1],_[2]=.5*b[2],_}([],function(_,b,k){return _[0]=b[0]+k[0],_[1]=b[1]+k[1],_[2]=b[2]+k[2],_}([],this.min,this.max))}quadrant(l){const f=[l%2==0,l<2],_=se(this.min),b=se(this.max);for(let k=0;k<f.length;k++)_[k]=f[k]?this.min[k]:this.center[k],b[k]=f[k]?this.center[k]:this.max[k];return b[2]=this.max[2],new ys(_,b)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}intersects(l){const f=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let _=!0;for(let b=0;b<l.planes.length;b++){const k=l.planes[b];let E=0;for(let A=0;A<f.length;A++)a.b0(k,f[A])>=0&&E++;if(E===0)return 0;E!==f.length&&(_=!1)}if(_)return 2;for(let b=0;b<3;b++){let k=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let A=0;A<l.points.length;A++){const B=l.points[A][b]-this.min[b];k=Math.min(k,B),E=Math.max(E,B)}if(E<0||k>this.max[b]-this.min[b])return 0}return 1}}class oa{constructor(l=0,f=0,_=0,b=0){if(isNaN(l)||l<0||isNaN(f)||f<0||isNaN(_)||_<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=_,this.right=b}interpolate(l,f,_){return f.top!=null&&l.top!=null&&(this.top=a.z.number(l.top,f.top,_)),f.bottom!=null&&l.bottom!=null&&(this.bottom=a.z.number(l.bottom,f.bottom,_)),f.left!=null&&l.left!=null&&(this.left=a.z.number(l.left,f.left,_)),f.right!=null&&l.right!=null&&(this.right=a.z.number(l.right,f.right,_)),this}getCenter(l,f){const _=a.ac((this.left+l-this.right)/2,0,l),b=a.ac((this.top+f-this.bottom)/2,0,f);return new a.P(_,b)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new oa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const eu=85.051129;class ql{constructor(l,f,_,b,k){this.tileSize=512,this._renderWorldCopies=k===void 0||!!k,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=_??0,this._maxPitch=b??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new oa,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const l=new ql(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.apply(this),l}apply(l){this.tileSize=l.tileSize,this.latRange=l.latRange,this.width=l.width,this.height=l.height,this._center=l._center,this._elevation=l._elevation,this.minElevationForCurrentTile=l.minElevationForCurrentTile,this.zoom=l.zoom,this.angle=l.angle,this._fov=l._fov,this._pitch=l._pitch,this._unmodified=l._unmodified,this._edgeInsets=l._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(l){const f=-a.b1(l,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=function(){var _=new a.A(4);return a.A!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_}(),function(_,b,k){var E=b[0],A=b[1],B=b[2],Z=b[3],X=Math.sin(k),Q=Math.cos(k);_[0]=E*Q+B*X,_[1]=A*Q+Z*X,_[2]=E*-X+B*Q,_[3]=A*-X+Z*Q}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const f=a.ac(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(l){const f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.tileZoom=Math.max(0,Math.floor(f)),this.scale=this.zoomScale(f),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(l){l!==this._elevation&&(this._elevation=l,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,f,_){this._unmodified=!1,this._edgeInsets.interpolate(l,f,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(l){const f=[new a.b2(0,l)];if(this._renderWorldCopies){const _=this.pointCoordinate(new a.P(0,0)),b=this.pointCoordinate(new a.P(this.width,0)),k=this.pointCoordinate(new a.P(this.width,this.height)),E=this.pointCoordinate(new a.P(0,this.height)),A=Math.floor(Math.min(_.x,b.x,k.x,E.x)),B=Math.floor(Math.max(_.x,b.x,k.x,E.x)),Z=1;for(let X=A-Z;X<=B+Z;X++)X!==0&&f.push(new a.b2(X,l))}return f}coveringTiles(l){var f,_;let b=this.coveringZoomLevel(l);const k=b;if(l.minzoom!==void 0&&b<l.minzoom)return[];l.maxzoom!==void 0&&b>l.maxzoom&&(b=l.maxzoom);const E=this.pointCoordinate(this.getCameraPoint()),A=a.Y.fromLngLat(this.center),B=Math.pow(2,b),Z=[B*E.x,B*E.y,0],X=[B*A.x,B*A.y,0],Q=gs.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,b);let pe=l.minzoom||0;!l.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(pe=b);const Se=l.terrain?2/Math.min(this.tileSize,l.tileSize)*this.tileSize:3,ke=Le=>({aabb:new ys([Le*B,0,0],[(Le+1)*B,B,0]),zoom:0,x:0,y:0,wrap:Le,fullyVisible:!1}),Me=[],be=[],Fe=b,Je=l.reparseOverscaled?k:b;if(this._renderWorldCopies)for(let Le=1;Le<=3;Le++)Me.push(ke(-Le)),Me.push(ke(Le));for(Me.push(ke(0));Me.length>0;){const Le=Me.pop(),Ue=Le.x,Qe=Le.y;let et=Le.fullyVisible;if(!et){const Rt=Le.aabb.intersects(Q);if(Rt===0)continue;et=Rt===2}const ot=l.terrain?Z:X,_t=Le.aabb.distanceX(ot),dt=Le.aabb.distanceY(ot),At=Math.max(Math.abs(_t),Math.abs(dt));if(Le.zoom===Fe||At>Se+(1<<Fe-Le.zoom)-2&&Le.zoom>=pe){const Rt=Fe-Le.zoom,yn=Z[0]-.5-(Ue<<Rt),$t=Z[1]-.5-(Qe<<Rt);be.push({tileID:new a.Q(Le.zoom===Fe?Je:Le.zoom,Le.wrap,Le.zoom,Ue,Qe),distanceSq:_e([X[0]-.5-Ue,X[1]-.5-Qe]),tileDistanceToCamera:Math.sqrt(yn*yn+$t*$t)})}else for(let Rt=0;Rt<4;Rt++){const yn=(Ue<<1)+Rt%2,$t=(Qe<<1)+(Rt>>1),fn=Le.zoom+1;let bn=Le.aabb.quadrant(Rt);if(l.terrain){const Nn=new a.Q(fn,Le.wrap,fn,yn,$t),gn=l.terrain.getMinMaxElevation(Nn),xn=(f=gn.minElevation)!==null&&f!==void 0?f:this.elevation,Tn=(_=gn.maxElevation)!==null&&_!==void 0?_:this.elevation;bn=new ys([bn.min[0],bn.min[1],xn],[bn.max[0],bn.max[1],Tn])}Me.push({aabb:bn,zoom:fn,x:yn,y:$t,wrap:Le.wrap,fullyVisible:et})}}return be.sort((Le,Ue)=>Le.distanceSq-Ue.distanceSq).map(Le=>Le.tileID)}resize(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const f=a.ac(l.lat,-85.051129,eu);return new a.P(a.N(l.lng)*this.worldSize,a.O(f)*this.worldSize)}unproject(l){return new a.Y(l.x/this.worldSize,l.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(l){const f=this.elevation,_=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,b=this.pointLocation(this.centerPoint,l),k=l.getElevationForLngLatZoom(b,this.tileZoom);if(!(this.elevation-k))return;const E=_+f-k,A=Math.cos(this._pitch)*this.cameraToCenterDistance/E/a.b3(1,b.lat),B=this.scaleZoom(A/this.tileSize);this._elevation=k,this._center=b,this.zoom=B}setLocationAtPoint(l,f){const _=this.pointCoordinate(f),b=this.pointCoordinate(this.centerPoint),k=this.locationCoordinate(l),E=new a.Y(k.x-(_.x-b.x),k.y-(_.y-b.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(l,f){return f?this.coordinatePoint(this.locationCoordinate(l),f.getElevationForLngLatZoom(l,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(l))}pointLocation(l,f){return this.coordinateLocation(this.pointCoordinate(l,f))}locationCoordinate(l){return a.Y.fromLngLat(l)}coordinateLocation(l){return l&&l.toLngLat()}pointCoordinate(l,f){if(f){const pe=f.pointCoordinate(l);if(pe!=null)return pe}const _=[l.x,l.y,0,1],b=[l.x,l.y,1,1];a.af(_,_,this.pixelMatrixInverse),a.af(b,b,this.pixelMatrixInverse);const k=_[3],E=b[3],A=_[1]/k,B=b[1]/E,Z=_[2]/k,X=b[2]/E,Q=Z===X?0:(0-Z)/(X-Z);return new a.Y(a.z.number(_[0]/k,b[0]/E,Q)/this.worldSize,a.z.number(A,B,Q)/this.worldSize)}coordinatePoint(l,f=0,_=this.pixelMatrix){const b=[l.x*this.worldSize,l.y*this.worldSize,f,1];return a.af(b,b,_),new a.P(b[0]/b[3],b[1]/b[3])}getBounds(){const l=Math.max(0,this.height/2-this.getHorizon());return new Ve().extend(this.pointLocation(new a.P(0,l))).extend(this.pointLocation(new a.P(this.width,l))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ve([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,eu])}calculatePosMatrix(l,f=!1){const _=l.key,b=f?this._alignedPosMatrixCache:this._posMatrixCache;if(b[_])return b[_];const k=l.canonical,E=this.worldSize/this.zoomScale(k.z),A=k.x+Math.pow(2,k.z)*l.wrap,B=a.an(new Float64Array(16));return a.H(B,B,[A*E,k.y*E,0]),a.J(B,B,[E/a.W,E/a.W,1]),a.K(B,f?this.alignedProjMatrix:this.projMatrix,B),b[_]=new Float32Array(B),b[_]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(l,f){f=a.ac(+f,this.minZoom,this.maxZoom);const _={center:new a.M(l.lng,l.lat),zoom:f};let b=this.lngRange;if(!this._renderWorldCopies&&b===null){const Le=179.9999999999;b=[-Le,Le]}const k=this.tileSize*this.zoomScale(_.zoom);let E=0,A=k,B=0,Z=k,X=0,Q=0;const{x:pe,y:Se}=this.size;if(this.latRange){const Le=this.latRange;E=a.O(Le[1])*k,A=a.O(Le[0])*k,A-E<Se&&(X=Se/(A-E))}b&&(B=a.b1(a.N(b[0])*k,0,k),Z=a.b1(a.N(b[1])*k,0,k),Z<B&&(Z+=k),Z-B<pe&&(Q=pe/(Z-B)));const{x:ke,y:Me}=this.project.call({worldSize:k},l);let be,Fe;const Je=Math.max(Q||0,X||0);if(Je){const Le=new a.P(Q?(Z+B)/2:ke,X?(A+E)/2:Me);return _.center=this.unproject.call({worldSize:k},Le).wrap(),_.zoom+=this.scaleZoom(Je),_}if(this.latRange){const Le=Se/2;Me-Le<E&&(Fe=E+Le),Me+Le>A&&(Fe=A-Le)}if(b){const Le=(B+Z)/2;let Ue=ke;this._renderWorldCopies&&(Ue=a.b1(ke,Le-k/2,Le+k/2));const Qe=pe/2;Ue-Qe<B&&(be=B+Qe),Ue+Qe>Z&&(be=Z-Qe)}if(be!==void 0||Fe!==void 0){const Le=new a.P(be??ke,Fe??Me);_.center=this.unproject.call({worldSize:k},Le).wrap()}return _}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this._unmodified,{center:f,zoom:_}=this.getConstrained(this.center,this.zoom);this.center=f,this.zoom=_,this._unmodified=l,this._constraining=!1}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,f=this.point.x,_=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b3(1,this.center.lat)*this.worldSize;let b=a.an(new Float64Array(16));a.J(b,b,[this.width/2,-this.height/2,1]),a.H(b,b,[1,-1,0]),this.labelPlaneMatrix=b,b=a.an(new Float64Array(16)),a.J(b,b,[1,-1,1]),a.H(b,b,[-1,-1,0]),a.J(b,b,[2/this.width,2/this.height,1]),this.glCoordMatrix=b;const k=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),E=Math.min(this.elevation,this.minElevationForCurrentTile),A=k-E*this._pixelPerMeter/Math.cos(this._pitch),B=E<0?A:k,Z=Math.PI/2+this._pitch,X=this._fov*(.5+l.y/this.height),Q=Math.sin(X)*B/Math.sin(a.ac(Math.PI-Z-X,.01,Math.PI-.01)),pe=this.getHorizon(),Se=2*Math.atan(pe/this.cameraToCenterDistance)*(.5+l.y/(2*pe)),ke=Math.sin(Se)*B/Math.sin(a.ac(Math.PI-Z-Se,.01,Math.PI-.01)),Me=Math.min(Q,ke),be=1.01*(Math.cos(Math.PI/2-this._pitch)*Me+B),Fe=this.height/50;b=new Float64Array(16),a.b4(b,this._fov,this.width/this.height,Fe,be),b[8]=2*-l.x/this.width,b[9]=2*l.y/this.height,a.J(b,b,[1,-1,1]),a.H(b,b,[0,0,-this.cameraToCenterDistance]),a.b5(b,b,this._pitch),a.ad(b,b,this.angle),a.H(b,b,[-f,-_,0]),this.mercatorMatrix=a.J([],b,[this.worldSize,this.worldSize,this.worldSize]),a.J(b,b,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.K(new Float64Array(16),this.labelPlaneMatrix,b),a.H(b,b,[0,0,-this.elevation]),this.projMatrix=b,this.invProjMatrix=a.ar([],b),this.pixelMatrix3D=a.K(new Float64Array(16),this.labelPlaneMatrix,b);const Je=this.width%2/2,Le=this.height%2/2,Ue=Math.cos(this.angle),Qe=Math.sin(this.angle),et=f-Math.round(f)+Ue*Je+Qe*Le,ot=_-Math.round(_)+Ue*Le+Qe*Je,_t=new Float64Array(b);if(a.H(_t,_t,[et>.5?et-1:et,ot>.5?ot-1:ot,0]),this.alignedProjMatrix=_t,b=a.ar(new Float64Array(16),this.pixelMatrix),!b)throw new Error("failed to invert matrix");this.pixelMatrixInverse=b,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const l=this.pointCoordinate(new a.P(0,0)),f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return a.af(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,l))}getCameraQueryGeometry(l){const f=this.getCameraPoint();if(l.length===1)return[l[0],f];{let _=f.x,b=f.y,k=f.x,E=f.y;for(const A of l)_=Math.min(_,A.x),b=Math.min(b,A.y),k=Math.max(k,A.x),E=Math.max(E,A.y);return[new a.P(_,b),new a.P(k,b),new a.P(k,E),new a.P(_,E),new a.P(_,b)]}}lngLatToCameraDepth(l,f){const _=this.locationCoordinate(l),b=[_.x*this.worldSize,_.y*this.worldSize,f,1];return a.af(b,b,this.projMatrix),b[2]/b[3]}}function tu(x,l){let f,_=!1,b=null,k=null;const E=()=>{b=null,_&&(x.apply(k,f),b=setTimeout(E,l),_=!1)};return(...A)=>(_=!0,k=this,f=A,b||E(),b)}class nu{constructor(l){this._getCurrentHash=()=>{const f=window.location.hash.replace("#","");if(this._hashName){let _;return f.split("&").map(b=>b.split("=")).forEach(b=>{b[0]===this._hashName&&(_=b)}),(_&&_[1]||"").split("/")}return f.split("/")},this._onHashChange=()=>{const f=this._getCurrentHash();if(f.length>=3&&!f.some(_=>isNaN(_))){const _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:_,pitch:+(f[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const f=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,f)}catch{}},this._updateHash=tu(this._updateHashUnthrottled,300),this._hashName=l&&encodeURIComponent(l)}addTo(l){return this._map=l,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(l){const f=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,b=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),k=Math.pow(10,b),E=Math.round(f.lng*k)/k,A=Math.round(f.lat*k)/k,B=this._map.getBearing(),Z=this._map.getPitch();let X="";if(X+=l?`/${E}/${A}/${_}`:`${_}/${A}/${E}`,(B||Z)&&(X+="/"+Math.round(10*B)/10),Z&&(X+=`/${Math.round(Z)}`),this._hashName){const Q=this._hashName;let pe=!1;const Se=window.location.hash.slice(1).split("&").map(ke=>{const Me=ke.split("=")[0];return Me===Q?(pe=!0,`${Me}=${X}`):ke}).filter(ke=>ke);return pe||Se.push(`${Q}=${X}`),`#${Se.join("&")}`}return`#${X}`}}const Ga={linearity:.3,easing:a.b6(0,0,.3,1)},As=a.e({deceleration:2500,maxSpeed:1400},Ga),tf=a.e({deceleration:20,maxSpeed:1400},Ga),nf=a.e({deceleration:1e3,maxSpeed:360},Ga),rf=a.e({deceleration:1e3,maxSpeed:90},Ga);class of{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,f=y.now();for(;l.length>0&&f-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const f={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:k}of this._inertiaBuffer)f.zoom+=k.zoomDelta||0,f.bearing+=k.bearingDelta||0,f.pitch+=k.pitchDelta||0,k.panDelta&&f.pan._add(k.panDelta),k.around&&(f.around=k.around),k.pinchAround&&(f.pinchAround=k.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(f.pan.mag()){const k=Wa(f.pan.mag(),_,a.e({},As,l||{}));b.offset=f.pan.mult(k.amount/f.pan.mag()),b.center=this._map.transform.center,Ha(b,k)}if(f.zoom){const k=Wa(f.zoom,_,tf);b.zoom=this._map.transform.zoom+k.amount,Ha(b,k)}if(f.bearing){const k=Wa(f.bearing,_,nf);b.bearing=this._map.transform.bearing+a.ac(k.amount,-179,179),Ha(b,k)}if(f.pitch){const k=Wa(f.pitch,_,rf);b.pitch=this._map.transform.pitch+k.amount,Ha(b,k)}if(b.zoom||b.bearing){const k=f.pinchAround===void 0?f.around:f.pinchAround;b.around=k?this._map.unproject(k):this._map.getCenter()}return this.clear(),a.e(b,{noMoveStart:!0})}}function Ha(x,l){(!x.duration||x.duration<l.duration)&&(x.duration=l.duration,x.easing=l.easing)}function Wa(x,l,f){const{maxSpeed:_,linearity:b,deceleration:k}=f,E=a.ac(x*b/(l/1e3),-_,_),A=Math.abs(E)/(k*b);return{easing:f.easing,duration:1e3*A,amount:E*(A/2)}}class Ri extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,_,b={}){const k=w.mousePos(f.getCanvas(),_),E=f.unproject(k);super(l,a.e({point:k,lngLat:E,originalEvent:_},b)),this._defaultPrevented=!1,this.target=f}}class No extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,_){const b=l==="touchend"?_.changedTouches:_.touches,k=w.touchPos(f.getCanvasContainer(),b),E=k.map(B=>f.unproject(B)),A=k.reduce((B,Z,X,Q)=>B.add(Z.div(Q.length)),new a.P(0,0));super(l,{points:k,point:A,lngLats:E,lngLat:f.unproject(A),originalEvent:_}),this._defaultPrevented=!1}}class ru extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,_){super(l,{originalEvent:_}),this._defaultPrevented=!1}}class yo{constructor(l,f){this._map=l,this._clickTolerance=f.clickTolerance}reset(){delete this._mousedownPos}wheel(l){return this._firePreventable(new ru(l.type,this._map,l))}mousedown(l,f){return this._mousedownPos=f,this._firePreventable(new Ri(l.type,this._map,l))}mouseup(l){this._map.fire(new Ri(l.type,this._map,l))}click(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new Ri(l.type,this._map,l))}dblclick(l){return this._firePreventable(new Ri(l.type,this._map,l))}mouseover(l){this._map.fire(new Ri(l.type,this._map,l))}mouseout(l){this._map.fire(new Ri(l.type,this._map,l))}touchstart(l){return this._firePreventable(new No(l.type,this._map,l))}touchmove(l){this._map.fire(new No(l.type,this._map,l))}touchend(l){this._map.fire(new No(l.type,this._map,l))}touchcancel(l){this._map.fire(new No(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class jo{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(l){this._map.fire(new Ri(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ri("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._ignoreContextMenu||this._map.fire(new Ri(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class sa{constructor(l){this._map=l}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(l){return this.transform.pointLocation(a.P.convert(l),this._map.terrain)}}class bo{constructor(l,f){this._map=l,this._tr=new sa(l),this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(w.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(l,f){if(!this._active)return;const _=f;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const b=this._startPos;this._lastPos=_,this._box||(this._box=w.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",l));const k=Math.min(b.x,_.x),E=Math.max(b.x,_.x),A=Math.min(b.y,_.y),B=Math.max(b.y,_.y);w.setTransform(this._box,`translate(${k}px,${A}px)`),this._box.style.width=E-k+"px",this._box.style.height=B-A+"px"}mouseupWindow(l,f){if(!this._active||l.button!==0)return;const _=this._startPos,b=f;if(this.reset(),w.suppressClick(),_.x!==b.x||_.y!==b.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:l})),{cameraAnimation:k=>k.fitScreenCoordinates(_,b,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",l)}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(w.remove(this._box),this._box=null),w.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(l,f){return this._map.fire(new a.k(l,{originalEvent:f}))}}function Ps(x,l){if(x.length!==l.length)throw new Error(`The number of touches and points are not equal - touches ${x.length}, points ${l.length}`);const f={};for(let _=0;_<x.length;_++)f[x[_].identifier]=l[_];return f}class Hd{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(l,f,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),_.length===this.numTouches&&(this.centroid=function(b){const k=new a.P(0,0);for(const E of b)k._add(E);return k.div(b.length)}(f),this.touches=Ps(_,f)))}touchmove(l,f,_){if(this.aborted||!this.centroid)return;const b=Ps(_,f);for(const k in this.touches){const E=b[k];(!E||E.dist(this.touches[k])>30)&&(this.aborted=!0)}}touchend(l,f,_){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class iu{constructor(l){this.singleTap=new Hd(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(l,f,_){this.singleTap.touchstart(l,f,_)}touchmove(l,f,_){this.singleTap.touchmove(l,f,_)}touchend(l,f,_){const b=this.singleTap.touchend(l,f,_);if(b){const k=l.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(b)<30;if(k&&E||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Wd{constructor(l){this._tr=new sa(l),this._zoomIn=new iu({numTouches:1,numTaps:2}),this._zoomOut=new iu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,f,_){this._zoomIn.touchstart(l,f,_),this._zoomOut.touchstart(l,f,_)}touchmove(l,f,_){this._zoomIn.touchmove(l,f,_),this._zoomOut.touchmove(l,f,_)}touchend(l,f,_){const b=this._zoomIn.touchend(l,f,_),k=this._zoomOut.touchend(l,f,_),E=this._tr;return b?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:E.zoom+1,around:E.unproject(b)},{originalEvent:l})}):k?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:E.zoom-1,around:E.unproject(k)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class aa{constructor(l){this._enabled=!!l.enable,this._moveStateManager=l.moveStateManager,this._clickTolerance=l.clickTolerance||1,this._moveFunction=l.move,this._activateOnStart=!!l.activateOnStart,l.assignEvents(this),this.reset()}reset(l){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(l)}_move(...l){const f=this._moveFunction(...l);if(f.bearingDelta||f.pitchDelta||f.around||f.panDelta)return this._active=!0,f}dragStart(l,f){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(l)&&(this._moveStateManager.startMove(l),this._lastPoint=f.length?f[0]:f,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(l,f){if(!this.isEnabled())return;const _=this._lastPoint;if(!_)return;if(l.preventDefault(),!this._moveStateManager.isValidMoveEvent(l))return void this.reset(l);const b=f.length?f[0]:f;return!this._moved&&b.dist(_)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=b,this._move(_,b))}dragEnd(l){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(l)&&(this._moved&&w.suppressClick(),this.reset(l))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ka={0:1,2:2};class Uo{constructor(l){this._correctEvent=l.checkCorrectEvent}startMove(l){const f=w.mouseButton(l);this._eventButton=f}endMove(l){delete this._eventButton}isValidStartEvent(l){return this._correctEvent(l)}isValidMoveEvent(l){return!function(f,_){const b=Ka[_];return f.buttons===void 0||(f.buttons&b)!==b}(l,this._eventButton)}isValidEndEvent(l){return w.mouseButton(l)===this._eventButton}}class Ht{constructor(){this._firstTouch=void 0}_isOneFingerTouch(l){return l.targetTouches.length===1}_isSameTouchEvent(l){return l.targetTouches[0].identifier===this._firstTouch}startMove(l){this._firstTouch=l.targetTouches[0].identifier}endMove(l){delete this._firstTouch}isValidStartEvent(l){return this._isOneFingerTouch(l)}isValidMoveEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}isValidEndEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}}const Zl=x=>{x.mousedown=x.dragStart,x.mousemoveWindow=x.dragMove,x.mouseup=x.dragEnd,x.contextmenu=function(l){l.preventDefault()}},la=({enable:x,clickTolerance:l,bearingDegreesPerPixelMoved:f=.8})=>{const _=new Uo({checkCorrectEvent:b=>w.mouseButton(b)===0&&b.ctrlKey||w.mouseButton(b)===2});return new aa({clickTolerance:l,move:(b,k)=>({bearingDelta:(k.x-b.x)*f}),moveStateManager:_,enable:x,assignEvents:Zl})},ca=({enable:x,clickTolerance:l,pitchDegreesPerPixelMoved:f=-.5})=>{const _=new Uo({checkCorrectEvent:b=>w.mouseButton(b)===0&&b.ctrlKey||w.mouseButton(b)===2});return new aa({clickTolerance:l,move:(b,k)=>({pitchDelta:(k.y-b.y)*f}),moveStateManager:_,enable:x,assignEvents:Zl})};class sf{constructor(l,f){this._clickTolerance=l.clickTolerance||1,this._map=f,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(l,f,_){return this._calculateTransform(l,f,_)}touchmove(l,f,_){if(this._active&&!(_.length<this.minTouchs()))return l.preventDefault(),this._calculateTransform(l,f,_)}touchend(l,f,_){this._calculateTransform(l,f,_),this._active&&_.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,f,_){_.length>0&&(this._active=!0);const b=Ps(_,f),k=new a.P(0,0),E=new a.P(0,0);let A=0;for(const Z in b){const X=b[Z],Q=this._touches[Z];Q&&(k._add(X),E._add(X.sub(Q)),A++,b[Z]=X)}if(this._touches=b,A<this.minTouchs()||!E.mag())return;const B=E.div(A);return this._sum._add(B),this._sum.mag()<this._clickTolerance?void 0:{around:k.div(A),panDelta:B}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vt{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(l,f,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([f[0],f[1]]))}touchmove(l,f,_){if(!this._firstTwoTouches)return;l.preventDefault();const[b,k]=this._firstTwoTouches,E=ua(_,f,b),A=ua(_,f,k);if(!E||!A)return;const B=this._aroundCenter?null:E.add(A).div(2);return this._move([E,A],B,l)}touchend(l,f,_){if(!this._firstTwoTouches)return;const[b,k]=this._firstTwoTouches,E=ua(_,f,b),A=ua(_,f,k);E&&A||(this._active&&w.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ua(x,l,f){for(let _=0;_<x.length;_++)if(x[_].identifier===f)return l[_]}function af(x,l){return Math.log(x/l)/Math.LN2}class lf extends Vt{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,f){const _=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(af(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:af(this._distance,_),pinchAround:f}}}function Gl(x,l){return 180*x.angleWith(l)/Math.PI}class ou extends Vt{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,f,_){const b=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Gl(this._vector,b),pinchAround:f}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const f=25/(Math.PI*this._minDiameter)*360,_=Gl(l,this._startVector);return Math.abs(_)<f}}function Hl(x){return Math.abs(x.y)>Math.abs(x.x)}class cf extends Vt{constructor(l){super(),this._currentTouchCount=0,this._map=l}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(l,f,_){super.touchstart(l,f,_),this._currentTouchCount=_.length}_start(l){this._lastPoints=l,Hl(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,f,_){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const b=l[0].sub(this._lastPoints[0]),k=l[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(b,k,_.timeStamp),this._valid?(this._lastPoints=l,this._active=!0,{pitchDelta:(b.y+k.y)/2*-.5}):void 0}gestureBeginsVertically(l,f,_){if(this._valid!==void 0)return this._valid;const b=l.mag()>=2,k=f.mag()>=2;if(!b&&!k)return;if(!b||!k)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;const E=l.y>0==f.y>0;return Hl(l)&&Hl(f)&&E}}const Kd={panStep:100,bearingStep:15,pitchStep:10};class bs{constructor(l){this._tr=new sa(l);const f=Kd;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let f=0,_=0,b=0,k=0,E=0;switch(l.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:l.shiftKey?_=-1:(l.preventDefault(),k=-1);break;case 39:l.shiftKey?_=1:(l.preventDefault(),k=1);break;case 38:l.shiftKey?b=1:(l.preventDefault(),E=-1);break;case 40:l.shiftKey?b=-1:(l.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(_=0,b=0),{cameraAnimation:A=>{const B=this._tr;A.easeTo({duration:300,easeId:"keyboardHandler",easing:wr,zoom:f?Math.round(B.zoom)+f*(l.shiftKey?2:1):B.zoom,bearing:B.bearing+_*this._bearingStep,pitch:B.pitch+b*this._pitchStep,offset:[-k*this._panStep,-E*this._panStep],center:B.center},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function wr(x){return x*(2-x)}const Xa=4.000244140625;class Wl{constructor(l,f){this._onTimeout=_=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(_)},this._map=l,this._tr=new sa(l),this._triggerRenderFrame=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(l){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!l[this._map.cooperativeGestures._bypassKey])return;let f=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const _=y.now(),b=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,f!==0&&f%Xa==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(b*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=w.mousePos(this._map.getCanvas(),l),_=this._tr;this._around=f.y>_.transform.height/2-_.transform.getHorizon()?a.M.convert(this._aroundCenter?_.center:_.unproject(f)):a.M.convert(_.center),this._aroundPoint=_.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._tr.transform;if(this._delta!==0){const A=this._type==="wheel"&&Math.abs(this._delta)>Xa?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&B!==0&&(B=1/B);const Z=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):l.scale;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(Z*B))),this._type==="wheel"&&(this._startZoom=l.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:l.zoom,_=this._startZoom,b=this._easing;let k,E=!1;if(this._type==="wheel"&&_&&b){const A=Math.min((y.now()-this._lastWheelEventTime)/200,1),B=b(A);k=a.z.number(_,f,B),A<1?this._frameId||(this._frameId=!0):E=!0}else k=f,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:k-l.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let f=a.b7;if(this._prevEase){const _=this._prevEase,b=(y.now()-_.start)/_.duration,k=_.easing(b+.01)-_.easing(b),E=.27/Math.sqrt(k*k+1e-4)*.01,A=Math.sqrt(.0729-E*E);f=a.b6(E,A,.25,1)}return this._prevEase={start:y.now(),duration:l,easing:f},f}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class su{constructor(l,f){this._clickZoom=l,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class uf{constructor(l){this._tr=new sa(l),this.reset()}reset(){this._active=!1}dblclick(l,f){return l.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:this._tr.zoom+(l.shiftKey?-1:1),around:this._tr.unproject(f)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hf{constructor(){this._tap=new iu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(l,f,_){if(!this._swipePoint)if(this._tapTime){const b=f[0],k=l.timeStamp-this._tapTime<500,E=this._tapPoint.dist(b)<30;k&&E?_.length>0&&(this._swipePoint=b,this._swipeTouch=_[0].identifier):this.reset()}else this._tap.touchstart(l,f,_)}touchmove(l,f,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const b=f[0],k=b.y-this._swipePoint.y;return this._swipePoint=b,l.preventDefault(),this._active=!0,{zoomDelta:k/128}}}else this._tap.touchmove(l,f,_)}touchend(l,f,_){if(this._tapTime)this._swipePoint&&_.length===0&&this.reset();else{const b=this._tap.touchend(l,f,_);b&&(this._tapTime=l.timeStamp,this._tapPoint=b)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ff{constructor(l,f,_){this._el=l,this._mousePan=f,this._touchPan=_}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class vo{constructor(l,f,_){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ja{constructor(l,f,_,b){this._el=l,this._touchZoom=f,this._touchRotate=_,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class rn{constructor(l,f){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=l,this._options=f,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const l=this._map.getCanvasContainer();l.classList.add("maplibregl-cooperative-gestures"),this._container=w.create("div","maplibregl-cooperative-gesture-screen",l);let f=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(f=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const _=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),b=document.createElement("div");b.className="maplibregl-desktop-message",b.textContent=f,this._container.appendChild(b);const k=document.createElement("div");k.className="maplibregl-mobile-message",k.textContent=_,this._container.appendChild(k),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(w.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(l){this._onCooperativeGesture(l.touches.length===1)}wheel(l){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!l[this._bypassKey])}_onCooperativeGesture(l){this._enabled&&l&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const cn=x=>x.zoom||x.drag||x.pitch||x.rotate;class Kl extends a.k{}function Ya(x){return x.panDelta&&x.panDelta.mag()||x.zoomDelta||x.bearingDelta||x.pitchDelta}class au{constructor(l,f){this.handleWindowEvent=b=>{this.handleEvent(b,`${b.type}Window`)},this.handleEvent=(b,k)=>{if(b.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const E=b.type==="renderFrame"?void 0:b,A={needsRenderFrame:!1},B={},Z={},X=b.touches,Q=X?this._getMapTouches(X):void 0,pe=Q?w.touchPos(this._map.getCanvas(),Q):w.mousePos(this._map.getCanvas(),b);for(const{handlerName:Me,handler:be,allowed:Fe}of this._handlers){if(!be.isEnabled())continue;let Je;this._blockedByActive(Z,Fe,Me)?be.reset():be[k||b.type]&&(Je=be[k||b.type](b,pe,Q),this.mergeHandlerResult(A,B,Je,Me,E),Je&&Je.needsRenderFrame&&this._triggerRenderFrame()),(Je||be.isActive())&&(Z[Me]=be)}const Se={};for(const Me in this._previousActiveHandlers)Z[Me]||(Se[Me]=E);this._previousActiveHandlers=Z,(Object.keys(Se).length||Ya(A))&&(this._changes.push([A,B,Se]),this._triggerRenderFrame()),(Object.keys(Z).length||Ya(A))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ke}=A;ke&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ke(this._map))},this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new of(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[b,k,E]of this._listeners)w.addEventListener(b,k,b===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[l,f,_]of this._listeners)w.removeEventListener(l,f,l===document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(l){const f=this._map,_=f.getCanvasContainer();this._add("mapEvent",new yo(f,l));const b=f.boxZoom=new bo(f,l);this._add("boxZoom",b),l.interactive&&l.boxZoom&&b.enable();const k=f.cooperativeGestures=new rn(f,l.cooperativeGestures);this._add("cooperativeGestures",k),l.cooperativeGestures&&k.enable();const E=new Wd(f),A=new uf(f);f.doubleClickZoom=new su(A,E),this._add("tapZoom",E),this._add("clickZoom",A),l.interactive&&l.doubleClickZoom&&f.doubleClickZoom.enable();const B=new hf;this._add("tapDragZoom",B);const Z=f.touchPitch=new cf(f);this._add("touchPitch",Z),l.interactive&&l.touchPitch&&f.touchPitch.enable(l.touchPitch);const X=la(l),Q=ca(l);f.dragRotate=new vo(l,X,Q),this._add("mouseRotate",X,["mousePitch"]),this._add("mousePitch",Q,["mouseRotate"]),l.interactive&&l.dragRotate&&f.dragRotate.enable();const pe=(({enable:Je,clickTolerance:Le})=>{const Ue=new Uo({checkCorrectEvent:Qe=>w.mouseButton(Qe)===0&&!Qe.ctrlKey});return new aa({clickTolerance:Le,move:(Qe,et)=>({around:et,panDelta:et.sub(Qe)}),activateOnStart:!0,moveStateManager:Ue,enable:Je,assignEvents:Zl})})(l),Se=new sf(l,f);f.dragPan=new ff(_,pe,Se),this._add("mousePan",pe),this._add("touchPan",Se,["touchZoom","touchRotate"]),l.interactive&&l.dragPan&&f.dragPan.enable(l.dragPan);const ke=new ou,Me=new lf;f.touchZoomRotate=new Ja(_,Me,ke,B),this._add("touchRotate",ke,["touchPan","touchZoom"]),this._add("touchZoom",Me,["touchPan","touchRotate"]),l.interactive&&l.touchZoomRotate&&f.touchZoomRotate.enable(l.touchZoomRotate);const be=f.scrollZoom=new Wl(f,()=>this._triggerRenderFrame());this._add("scrollZoom",be,["mousePan"]),l.interactive&&l.scrollZoom&&f.scrollZoom.enable(l.scrollZoom);const Fe=f.keyboard=new bs(f);this._add("keyboard",Fe),l.interactive&&l.keyboard&&f.keyboard.enable(),this._add("blockableMapEvent",new jo(f))}_add(l,f,_){this._handlers.push({handlerName:l,handler:f,allowed:_}),this._handlersById[l]=f}stop(l){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!cn(this._eventsInProgress)||this.isZooming()}_blockedByActive(l,f,_){for(const b in l)if(b!==_&&(!f||f.indexOf(b)<0))return!0;return!1}_getMapTouches(l){const f=[];for(const _ of l)this._el.contains(_.target)&&f.push(_);return f}mergeHandlerResult(l,f,_,b,k){if(!_)return;a.e(l,_);const E={handlerName:b,originalEvent:_.originalEvent||k};_.zoomDelta!==void 0&&(f.zoom=E),_.panDelta!==void 0&&(f.drag=E),_.pitchDelta!==void 0&&(f.pitch=E),_.bearingDelta!==void 0&&(f.rotate=E)}_applyChanges(){const l={},f={},_={};for(const[b,k,E]of this._changes)b.panDelta&&(l.panDelta=(l.panDelta||new a.P(0,0))._add(b.panDelta)),b.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+b.pitchDelta),b.around!==void 0&&(l.around=b.around),b.pinchAround!==void 0&&(l.pinchAround=b.pinchAround),b.noInertia&&(l.noInertia=b.noInertia),a.e(f,k),a.e(_,E);this._updateMapTransform(l,f,_),this._changes=[]}_updateMapTransform(l,f,_){const b=this._map,k=b._getTransformForUpdate(),E=b.terrain;if(!(Ya(l)||E&&this._terrainMovement))return this._fireEvents(f,_,!0);let{panDelta:A,zoomDelta:B,bearingDelta:Z,pitchDelta:X,around:Q,pinchAround:pe}=l;pe!==void 0&&(Q=pe),b._stop(!0),Q=Q||b.transform.centerPoint;const Se=k.pointLocation(A?Q.sub(A):Q);Z&&(k.bearing+=Z),X&&(k.pitch+=X),B&&(k.zoom+=B),E?this._terrainMovement||!f.drag&&!f.zoom?f.drag&&this._terrainMovement?k.center=k.pointLocation(k.centerPoint.sub(A)):k.setLocationAtPoint(Se,Q):(this._terrainMovement=!0,this._map._elevationFreeze=!0,k.setLocationAtPoint(Se,Q),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,k.recalculateZoom(b.terrain)})):k.setLocationAtPoint(Se,Q),b._applyUpdatedTransform(k),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,_,!0)}_fireEvents(l,f,_){const b=cn(this._eventsInProgress),k=cn(l),E={};for(const X in l){const{originalEvent:Q}=l[X];this._eventsInProgress[X]||(E[`${X}start`]=Q),this._eventsInProgress[X]=l[X]}!b&&k&&this._fireEvent("movestart",k.originalEvent);for(const X in E)this._fireEvent(X,E[X]);k&&this._fireEvent("move",k.originalEvent);for(const X in l){const{originalEvent:Q}=l[X];this._fireEvent(X,Q)}const A={};let B;for(const X in this._eventsInProgress){const{handlerName:Q,originalEvent:pe}=this._eventsInProgress[X];this._handlersById[Q].isActive()||(delete this._eventsInProgress[X],B=f[Q]||pe,A[`${X}end`]=B)}for(const X in A)this._fireEvent(X,A[X]);const Z=cn(this._eventsInProgress);if(_&&(b||k)&&!Z){this._updatingCamera=!0;const X=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Q=pe=>pe!==0&&-this._bearingSnap<pe&&pe<this._bearingSnap;!X||!X.essential&&y.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:B})),Q(this._map.getBearing())&&this._map.resetNorth()):(Q(X.bearing||this._map.getBearing())&&(X.bearing=0),X.freezeElevation=!0,this._map.easeTo(X,{originalEvent:B})),this._updatingCamera=!1}}_fireEvent(l,f){this._map.fire(new a.k(l,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{delete this._frameId,this.handleEvent(new Kl("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class $i extends a.E{constructor(l,f){super(),this._renderFrameCallback=()=>{const _=Math.min((y.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(_)),_<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=f.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.M(this.transform.center.lng,this.transform.center.lat)}setCenter(l,f){return this.jumpTo({center:l},f)}panBy(l,f,_){return l=a.P.convert(l).mult(-1),this.panTo(this.transform.center,a.e({offset:l},f),_)}panTo(l,f,_){return this.easeTo(a.e({center:l},f),_)}getZoom(){return this.transform.zoom}setZoom(l,f){return this.jumpTo({zoom:l},f),this}zoomTo(l,f,_){return this.easeTo(a.e({zoom:l},f),_)}zoomIn(l,f){return this.zoomTo(this.getZoom()+1,l,f),this}zoomOut(l,f){return this.zoomTo(this.getZoom()-1,l,f),this}getBearing(){return this.transform.bearing}setBearing(l,f){return this.jumpTo({bearing:l},f),this}getPadding(){return this.transform.padding}setPadding(l,f){return this.jumpTo({padding:l},f),this}rotateTo(l,f,_){return this.easeTo(a.e({bearing:l},f),_)}resetNorth(l,f){return this.rotateTo(0,a.e({duration:1e3},l),f),this}resetNorthPitch(l,f){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},l),f),this}snapToNorth(l,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,f):this}getPitch(){return this.transform.pitch}setPitch(l,f){return this.jumpTo({pitch:l},f),this}cameraForBounds(l,f){l=Ve.convert(l);const _=f&&f.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),_,f)}_cameraForBoxAndBearing(l,f,_,b){const k={top:0,bottom:0,right:0,left:0};if(typeof(b=a.e({padding:k,offset:[0,0],maxZoom:this.transform.maxZoom},b)).padding=="number"){const Rt=b.padding;b.padding={top:Rt,bottom:Rt,right:Rt,left:Rt}}b.padding=a.e(k,b.padding);const E=this.transform,A=E.padding,B=new Ve(l,f),Z=E.project(B.getNorthWest()),X=E.project(B.getNorthEast()),Q=E.project(B.getSouthEast()),pe=E.project(B.getSouthWest()),Se=a.b8(-_),ke=Z.rotate(Se),Me=X.rotate(Se),be=Q.rotate(Se),Fe=pe.rotate(Se),Je=new a.P(Math.max(ke.x,Me.x,Fe.x,be.x),Math.max(ke.y,Me.y,Fe.y,be.y)),Le=new a.P(Math.min(ke.x,Me.x,Fe.x,be.x),Math.min(ke.y,Me.y,Fe.y,be.y)),Ue=Je.sub(Le),Qe=(E.width-(A.left+A.right+b.padding.left+b.padding.right))/Ue.x,et=(E.height-(A.top+A.bottom+b.padding.top+b.padding.bottom))/Ue.y;if(et<0||Qe<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ot=Math.min(E.scaleZoom(E.scale*Math.min(Qe,et)),b.maxZoom),_t=a.P.convert(b.offset),dt=new a.P((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(a.b8(_)),At=_t.add(dt).mult(E.scale/E.zoomScale(ot));return{center:E.unproject(Z.add(Q).div(2).sub(At)),zoom:ot,bearing:_}}fitBounds(l,f,_){return this._fitInternal(this.cameraForBounds(l,f),f,_)}fitScreenCoordinates(l,f,_,b,k){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(l)),this.transform.pointLocation(a.P.convert(f)),_,b),b,k)}_fitInternal(l,f,_){return l?(delete(f=a.e(l,f)).padding,f.linear?this.easeTo(f,_):this.flyTo(f,_)):this}jumpTo(l,f){this.stop();const _=this._getTransformForUpdate();let b=!1,k=!1,E=!1;return"zoom"in l&&_.zoom!==+l.zoom&&(b=!0,_.zoom=+l.zoom),l.center!==void 0&&(_.center=a.M.convert(l.center)),"bearing"in l&&_.bearing!==+l.bearing&&(k=!0,_.bearing=+l.bearing),"pitch"in l&&_.pitch!==+l.pitch&&(E=!0,_.pitch=+l.pitch),l.padding==null||_.isPaddingEqual(l.padding)||(_.padding=l.padding),this._applyUpdatedTransform(_),this.fire(new a.k("movestart",f)).fire(new a.k("move",f)),b&&this.fire(new a.k("zoomstart",f)).fire(new a.k("zoom",f)).fire(new a.k("zoomend",f)),k&&this.fire(new a.k("rotatestart",f)).fire(new a.k("rotate",f)).fire(new a.k("rotateend",f)),E&&this.fire(new a.k("pitchstart",f)).fire(new a.k("pitch",f)).fire(new a.k("pitchend",f)),this.fire(new a.k("moveend",f))}calculateCameraOptionsFromTo(l,f,_,b=0){const k=a.Y.fromLngLat(l,f),E=a.Y.fromLngLat(_,b),A=E.x-k.x,B=E.y-k.y,Z=E.z-k.z,X=Math.hypot(A,B,Z);if(X===0)throw new Error("Can't calculate camera options with same From and To");const Q=Math.hypot(A,B),pe=this.transform.scaleZoom(this.transform.cameraToCenterDistance/X/this.transform.tileSize),Se=180*Math.atan2(A,-B)/Math.PI;let ke=180*Math.acos(Q/X)/Math.PI;return ke=Z<0?90-ke:90+ke,{center:E.toLngLat(),zoom:pe,pitch:ke,bearing:Se}}easeTo(l,f){var _;this._stop(!1,l.easeId),((l=a.e({offset:[0,0],duration:500,easing:a.b7},l)).animate===!1||!l.essential&&y.prefersReducedMotion)&&(l.duration=0);const b=this._getTransformForUpdate(),k=this.getZoom(),E=this.getBearing(),A=this.getPitch(),B=this.getPadding(),Z="bearing"in l?this._normalizeBearing(l.bearing,E):E,X="pitch"in l?+l.pitch:A,Q="padding"in l?l.padding:b.padding,pe=a.P.convert(l.offset);let Se=b.centerPoint.add(pe);const ke=b.pointLocation(Se),{center:Me,zoom:be}=b.getConstrained(a.M.convert(l.center||ke),(_=l.zoom)!==null&&_!==void 0?_:k);this._normalizeCenter(Me);const Fe=b.project(ke),Je=b.project(Me).sub(Fe),Le=b.zoomScale(be-k);let Ue,Qe;l.around&&(Ue=a.M.convert(l.around),Qe=b.locationPoint(Ue));const et={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||be!==k,this._rotating=this._rotating||E!==Z,this._pitching=this._pitching||X!==A,this._padding=!b.isPaddingEqual(Q),this._easeId=l.easeId,this._prepareEase(f,l.noMoveStart,et),this.terrain&&this._prepareElevation(Me),this._ease(ot=>{if(this._zooming&&(b.zoom=a.z.number(k,be,ot)),this._rotating&&(b.bearing=a.z.number(E,Z,ot)),this._pitching&&(b.pitch=a.z.number(A,X,ot)),this._padding&&(b.interpolatePadding(B,Q,ot),Se=b.centerPoint.add(pe)),this.terrain&&!l.freezeElevation&&this._updateElevation(ot),Ue)b.setLocationAtPoint(Ue,Qe);else{const _t=b.zoomScale(b.zoom-k),dt=be>k?Math.min(2,Le):Math.max(.5,Le),At=Math.pow(dt,1-ot),Rt=b.unproject(Fe.add(Je.mult(ot*At)).mult(_t));b.setLocationAtPoint(b.renderWorldCopies?Rt.wrap():Rt,Se)}this._applyUpdatedTransform(b),this._fireMoveEvents(f)},ot=>{this.terrain&&this._finalizeElevation(),this._afterEase(f,ot)},l),this}_prepareEase(l,f,_={}){this._moving=!0,f||_.moving||this.fire(new a.k("movestart",l)),this._zooming&&!_.zooming&&this.fire(new a.k("zoomstart",l)),this._rotating&&!_.rotating&&this.fire(new a.k("rotatestart",l)),this._pitching&&!_.pitching&&this.fire(new a.k("pitchstart",l))}_prepareElevation(l){this._elevationCenter=l,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(l){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const f=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(l<1&&f!==this._elevationTarget){const _=this._elevationTarget-this._elevationStart;this._elevationStart+=l*(_-(f-(_*l+this._elevationStart))/(1-l)),this._elevationTarget=f}this.transform.elevation=a.z.number(this._elevationStart,this._elevationTarget,l)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(l){if(!this.transformCameraUpdate)return;const f=l.clone(),{center:_,zoom:b,pitch:k,bearing:E,elevation:A}=this.transformCameraUpdate(f);_&&(f.center=_),b!==void 0&&(f.zoom=b),k!==void 0&&(f.pitch=k),E!==void 0&&(f.bearing=E),A!==void 0&&(f.elevation=A),this.transform.apply(f)}_fireMoveEvents(l){this.fire(new a.k("move",l)),this._zooming&&this.fire(new a.k("zoom",l)),this._rotating&&this.fire(new a.k("rotate",l)),this._pitching&&this.fire(new a.k("pitch",l))}_afterEase(l,f){if(this._easeId&&f&&this._easeId===f)return;delete this._easeId;const _=this._zooming,b=this._rotating,k=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new a.k("zoomend",l)),b&&this.fire(new a.k("rotateend",l)),k&&this.fire(new a.k("pitchend",l)),this.fire(new a.k("moveend",l))}flyTo(l,f){var _;if(!l.essential&&y.prefersReducedMotion){const Nn=a.L(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Nn,f)}this.stop(),l=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.b7},l);const b=this._getTransformForUpdate(),k=this.getZoom(),E=this.getBearing(),A=this.getPitch(),B=this.getPadding(),Z="bearing"in l?this._normalizeBearing(l.bearing,E):E,X="pitch"in l?+l.pitch:A,Q="padding"in l?l.padding:b.padding,pe=a.P.convert(l.offset);let Se=b.centerPoint.add(pe);const ke=b.pointLocation(Se),{center:Me,zoom:be}=b.getConstrained(a.M.convert(l.center||ke),(_=l.zoom)!==null&&_!==void 0?_:k);this._normalizeCenter(Me);const Fe=b.zoomScale(be-k),Je=b.project(ke),Le=b.project(Me).sub(Je);let Ue=l.curve;const Qe=Math.max(b.width,b.height),et=Qe/Fe,ot=Le.mag();if("minZoom"in l){const Nn=a.ac(Math.min(l.minZoom,k,be),b.minZoom,b.maxZoom),gn=Qe/b.zoomScale(Nn-k);Ue=Math.sqrt(gn/ot*2)}const _t=Ue*Ue;function dt(Nn){const gn=(et*et-Qe*Qe+(Nn?-1:1)*_t*_t*ot*ot)/(2*(Nn?et:Qe)*_t*ot);return Math.log(Math.sqrt(gn*gn+1)-gn)}function At(Nn){return(Math.exp(Nn)-Math.exp(-Nn))/2}function Rt(Nn){return(Math.exp(Nn)+Math.exp(-Nn))/2}const yn=dt(!1);let $t=function(Nn){return Rt(yn)/Rt(yn+Ue*Nn)},fn=function(Nn){return Qe*((Rt(yn)*(At(gn=yn+Ue*Nn)/Rt(gn))-At(yn))/_t)/ot;var gn},bn=(dt(!0)-yn)/Ue;if(Math.abs(ot)<1e-6||!isFinite(bn)){if(Math.abs(Qe-et)<1e-6)return this.easeTo(l,f);const Nn=et<Qe?-1:1;bn=Math.abs(Math.log(et/Qe))/Ue,fn=function(){return 0},$t=function(gn){return Math.exp(Nn*Ue*gn)}}return l.duration="duration"in l?+l.duration:1e3*bn/("screenSpeed"in l?+l.screenSpeed/Ue:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=E!==Z,this._pitching=X!==A,this._padding=!b.isPaddingEqual(Q),this._prepareEase(f,!1),this.terrain&&this._prepareElevation(Me),this._ease(Nn=>{const gn=Nn*bn,xn=1/$t(gn);b.zoom=Nn===1?be:k+b.scaleZoom(xn),this._rotating&&(b.bearing=a.z.number(E,Z,Nn)),this._pitching&&(b.pitch=a.z.number(A,X,Nn)),this._padding&&(b.interpolatePadding(B,Q,Nn),Se=b.centerPoint.add(pe)),this.terrain&&!l.freezeElevation&&this._updateElevation(Nn);const Tn=Nn===1?Me:b.unproject(Je.add(Le.mult(fn(gn))).mult(xn));b.setLocationAtPoint(b.renderWorldCopies?Tn.wrap():Tn,Se),this._applyUpdatedTransform(b),this._fireMoveEvents(f)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(f)},l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const _=this._onEaseEnd;delete this._onEaseEnd,_.call(this,f)}if(!l){const _=this.handlers;_&&_.stop(!1)}return this}_ease(l,f,_){_.animate===!1||_.duration===0?(l(1),f()):(this._easeStart=y.now(),this._easeOptions=_,this._onEaseFrame=l,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(l,f){l=a.b1(l,-180,180);const _=Math.abs(l-f);return Math.abs(l-360-f)<_&&(l-=360),Math.abs(l+360-f)<_&&(l+=360),l}_normalizeCenter(l){const f=this.transform;if(!f.renderWorldCopies||f.lngRange)return;const _=l.lng-f.center.lng;l.lng+=_>180?-360:_<-180?360:0}queryTerrainElevation(l){return this.terrain?this.terrain.getElevationForLngLatZoom(a.M.convert(l),this.transform.tileZoom)-this.transform.elevation:null}}const lu={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class wo{constructor(l=lu){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=f=>{!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"&&f.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=l}getDefaultPosition(){return"bottom-right"}onAdd(l){return this._map=l,this._compact=this.options.compact,this._container=w.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=w.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=w.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){w.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(l,f){const _=this._map._getUIString(`AttributionControl.${f}`);l.title=_,l.setAttribute("aria-label",_)}_updateAttributions(){if(!this._map.style)return;let l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(b=>typeof b!="string"?"":b)):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const f=this._map.style.sourceCaches;for(const b in f){const k=f[b];if(k.used||k.usedForTerrain){const E=k.getSource();E.attribution&&l.indexOf(E.attribution)<0&&l.push(E.attribution)}}l=l.filter(b=>String(b).trim()),l.sort((b,k)=>b.length-k.length),l=l.filter((b,k)=>{for(let E=k+1;E<l.length;E++)if(l[E].indexOf(b)>=0)return!1;return!0});const _=l.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,l.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class df{constructor(l={}){this._updateCompact=()=>{const f=this._container.children;if(f.length){const _=f[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&_.classList.add("maplibregl-compact"):_.classList.remove("maplibregl-compact")}},this.options=l}getDefaultPosition(){return"bottom-left"}onAdd(l){this._map=l,this._compact=this.options&&this.options.compact,this._container=w.create("div","maplibregl-ctrl");const f=w.create("a","maplibregl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://maplibre.org/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){w.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Qa{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f}remove(l){const f=this._currentlyRunning,_=f?this._queue.concat(f):this._queue;for(const b of _)if(b.id===l)return void(b.cancelled=!0)}run(l=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const f=this._currentlyRunning=this._queue;this._queue=[];for(const _ of f)if(!_.cancelled&&(_.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Rr=a.X([{name:"a_pos3d",type:"Int16",components:3}]);class Zr extends a.E{constructor(l){super(),this.sourceCache=l,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,l.usedForTerrain=!0,l.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(l,f){this.sourceCache.update(l,f),this._renderableTilesKeys=[];const _={};for(const b of l.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:f}))_[b.key]=!0,this._renderableTilesKeys.push(b.key),this._tiles[b.key]||(b.posMatrix=new Float64Array(16),a.aN(b.posMatrix,0,a.W,0,a.W,0,1),this._tiles[b.key]=new Vr(b,this.tileSize));for(const b in this._tiles)_[b]||delete this._tiles[b]}freeRtt(l){for(const f in this._tiles){const _=this._tiles[f];(!l||_.tileID.equals(l)||_.tileID.isChildOf(l)||l.isChildOf(_.tileID))&&(_.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(l=>this.getTileByID(l))}getTileByID(l){return this._tiles[l]}getTerrainCoords(l){const f={};for(const _ of this._renderableTilesKeys){const b=this._tiles[_].tileID;if(b.canonical.equals(l.canonical)){const k=l.clone();k.posMatrix=new Float64Array(16),a.aN(k.posMatrix,0,a.W,0,a.W,0,1),f[_]=k}else if(b.canonical.isChildOf(l.canonical)){const k=l.clone();k.posMatrix=new Float64Array(16);const E=b.canonical.z-l.canonical.z,A=b.canonical.x-(b.canonical.x>>E<<E),B=b.canonical.y-(b.canonical.y>>E<<E),Z=a.W>>E;a.aN(k.posMatrix,0,Z,0,Z,0,1),a.H(k.posMatrix,k.posMatrix,[-A*Z,-B*Z,0]),f[_]=k}else if(l.canonical.isChildOf(b.canonical)){const k=l.clone();k.posMatrix=new Float64Array(16);const E=l.canonical.z-b.canonical.z,A=l.canonical.x-(l.canonical.x>>E<<E),B=l.canonical.y-(l.canonical.y>>E<<E),Z=a.W>>E;a.aN(k.posMatrix,0,a.W,0,a.W,0,1),a.H(k.posMatrix,k.posMatrix,[A*Z,B*Z,0]),a.J(k.posMatrix,k.posMatrix,[1/2**E,1/2**E,0]),f[_]=k}}return f}getSourceTile(l,f){const _=this.sourceCache._source;let b=l.overscaledZ-this.deltaZoom;if(b>_.maxzoom&&(b=_.maxzoom),b<_.minzoom)return null;this._sourceTileCache[l.key]||(this._sourceTileCache[l.key]=l.scaledTo(b).key);let k=this.sourceCache.getTileByID(this._sourceTileCache[l.key]);if((!k||!k.dem)&&f)for(;b>=_.minzoom&&(!k||!k.dem);)k=this.sourceCache.getTileByID(l.scaledTo(b--).key);return k}tilesAfterTime(l=Date.now()){return Object.values(this._tiles).filter(f=>f.timeAdded>=l)}}class pf{constructor(l,f,_){this.painter=l,this.sourceCache=new Zr(f),this.options=_,this.exaggeration=typeof _.exaggeration=="number"?_.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(l,f,_,b=a.W){var k;if(!(f>=0&&f<b&&_>=0&&_<b))return 0;const E=this.getTerrainData(l),A=(k=E.tile)===null||k===void 0?void 0:k.dem;if(!A)return 0;const B=function(ke,Me,be){var Fe=Me[0],Je=Me[1];return ke[0]=be[0]*Fe+be[4]*Je+be[12],ke[1]=be[1]*Fe+be[5]*Je+be[13],ke}([],[f/b*a.W,_/b*a.W],E.u_terrain_matrix),Z=[B[0]*A.dim,B[1]*A.dim],X=Math.floor(Z[0]),Q=Math.floor(Z[1]),pe=Z[0]-X,Se=Z[1]-Q;return A.get(X,Q)*(1-pe)*(1-Se)+A.get(X+1,Q)*pe*(1-Se)+A.get(X,Q+1)*(1-pe)*Se+A.get(X+1,Q+1)*pe*Se}getElevationForLngLatZoom(l,f){const{tileID:_,mercatorX:b,mercatorY:k}=this._getOverscaledTileIDFromLngLatZoom(l,f);return this.getElevation(_,b%a.W,k%a.W,a.W)}getElevation(l,f,_,b=a.W){return this.getDEMElevation(l,f,_,b)*this.exaggeration}getTerrainData(l){if(!this._emptyDemTexture){const b=this.painter.context,k=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ee(b,k,b.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ee(b,new a.R({width:1,height:1}),b.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(b.gl.NEAREST,b.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.an([])}const f=this.sourceCache.getSourceTile(l,!0);if(f&&f.dem&&(!f.demTexture||f.needsTerrainPrepare)){const b=this.painter.context;f.demTexture=this.painter.getTileTexture(f.dem.stride),f.demTexture?f.demTexture.update(f.dem.getPixels(),{premultiply:!1}):f.demTexture=new ee(b,f.dem.getPixels(),b.gl.RGBA,{premultiply:!1}),f.demTexture.bind(b.gl.NEAREST,b.gl.CLAMP_TO_EDGE),f.needsTerrainPrepare=!1}const _=f&&f+f.tileID.key+l.key;if(_&&!this._demMatrixCache[_]){const b=this.sourceCache.sourceCache._source.maxzoom;let k=l.canonical.z-f.tileID.canonical.z;l.overscaledZ>l.canonical.z&&(l.canonical.z>=b?k=l.canonical.z-b:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const E=l.canonical.x-(l.canonical.x>>k<<k),A=l.canonical.y-(l.canonical.y>>k<<k),B=a.b9(new Float64Array(16),[1/(a.W<<k),1/(a.W<<k),0]);a.H(B,B,[E*a.W,A*a.W,0]),this._demMatrixCache[l.key]={matrix:B,coord:l}}return{u_depth:2,u_terrain:3,u_terrain_dim:f&&f.dem&&f.dem.dim||1,u_terrain_matrix:_?this._demMatrixCache[l.key].matrix:this._emptyDemMatrix,u_terrain_unpack:f&&f.dem&&f.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(f&&f.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:f}}getFramebuffer(l){const f=this.painter,_=f.width/devicePixelRatio,b=f.height/devicePixelRatio;return!this._fbo||this._fbo.width===_&&this._fbo.height===b||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ee(f.context,{width:_,height:b,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ee(f.context,{width:_,height:b,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=f.context.createFramebuffer(_,b,!0,!1),this._fbo.depthAttachment.set(f.context.createRenderbuffer(f.context.gl.DEPTH_COMPONENT16,_,b))),this._fbo.colorAttachment.set(l==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const l=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const f=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let k=0,E=0;k<this._coordsTextureSize;k++)for(let A=0;A<this._coordsTextureSize;A++,E+=4)f[E+0]=255&A,f[E+1]=255&k,f[E+2]=A>>8<<4|k>>8,f[E+3]=0;const _=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(f.buffer)),b=new ee(l,_,l.gl.RGBA,{premultiply:!1});return b.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._coordsTexture=b,b}pointCoordinate(l){this.painter.maybeDrawDepthAndCoords(!0);const f=new Uint8Array(4),_=this.painter.context,b=_.gl,k=Math.round(l.x*this.painter.pixelRatio/devicePixelRatio),E=Math.round(l.y*this.painter.pixelRatio/devicePixelRatio),A=Math.round(this.painter.height/devicePixelRatio);_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),b.readPixels(k,A-E-1,1,1,b.RGBA,b.UNSIGNED_BYTE,f),_.bindFramebuffer.set(null);const B=f[0]+(f[2]>>4<<8),Z=f[1]+((15&f[2])<<8),X=this.coordsIndex[255-f[3]],Q=X&&this.sourceCache.getTileByID(X);if(!Q)return null;const pe=this._coordsTextureSize,Se=(1<<Q.tileID.canonical.z)*pe;return new a.Y((Q.tileID.canonical.x*pe+B)/Se+Q.tileID.wrap,(Q.tileID.canonical.y*pe+Z)/Se,this.getElevation(Q.tileID,B,Z,pe))}depthAtPoint(l){const f=new Uint8Array(4),_=this.painter.context,b=_.gl;return _.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),b.readPixels(l.x,this.painter.height/devicePixelRatio-l.y-1,1,1,b.RGBA,b.UNSIGNED_BYTE,f),_.bindFramebuffer.set(null),(f[0]/16777216+f[1]/65536+f[2]/256+f[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const l=this.painter.context,f=new a.ba,_=new a.aX,b=this.meshSize,k=a.W/b,E=b*b;for(let Q=0;Q<=b;Q++)for(let pe=0;pe<=b;pe++)f.emplaceBack(pe*k,Q*k,0);for(let Q=0;Q<E;Q+=b+1)for(let pe=0;pe<b;pe++)_.emplaceBack(pe+Q,b+pe+Q+1,b+pe+Q+2),_.emplaceBack(pe+Q,b+pe+Q+2,pe+Q+1);const A=f.length,B=A+2*(b+1);for(const Q of[0,1])for(let pe=0;pe<=b;pe++)for(const Se of[0,1])f.emplaceBack(pe*k,Q*a.W,Se);for(let Q=0;Q<2*b;Q+=2)_.emplaceBack(B+Q,B+Q+1,B+Q+3),_.emplaceBack(B+Q,B+Q+3,B+Q+2),_.emplaceBack(A+Q,A+Q+3,A+Q+1),_.emplaceBack(A+Q,A+Q+2,A+Q+3);const Z=f.length,X=Z+2*(b+1);for(const Q of[0,1])for(let pe=0;pe<=b;pe++)for(const Se of[0,1])f.emplaceBack(Q*a.W,pe*k,Se);for(let Q=0;Q<2*b;Q+=2)_.emplaceBack(Z+Q,Z+Q+1,Z+Q+3),_.emplaceBack(Z+Q,Z+Q+3,Z+Q+2),_.emplaceBack(X+Q,X+Q+3,X+Q+1),_.emplaceBack(X+Q,X+Q+2,X+Q+3);return this._mesh={indexBuffer:l.createIndexBuffer(_),vertexBuffer:l.createVertexBuffer(f,Rr.members),segments:a.$.simpleSegment(0,0,f.length,_.length)},this._mesh}getMeshFrameDelta(l){return 2*Math.PI*a.bb/Math.pow(2,l)/5}getMinTileElevationForLngLatZoom(l,f){var _;const{tileID:b}=this._getOverscaledTileIDFromLngLatZoom(l,f);return(_=this.getMinMaxElevation(b).minElevation)!==null&&_!==void 0?_:0}getMinMaxElevation(l){const f=this.getTerrainData(l).tile,_={minElevation:null,maxElevation:null};return f&&f.dem&&(_.minElevation=f.dem.min*this.exaggeration,_.maxElevation=f.dem.max*this.exaggeration),_}_getOverscaledTileIDFromLngLatZoom(l,f){const _=a.Y.fromLngLat(l.wrap()),b=(1<<f)*a.W,k=_.x*b,E=_.y*b,A=Math.floor(k/a.W),B=Math.floor(E/a.W);return{tileID:new a.Q(f,0,f,A,B),mercatorX:k,mercatorY:E}}}class el{constructor(l,f,_){this._context=l,this._size=f,this._tileSize=_,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const l of this._objects)l.texture.destroy(),l.fbo.destroy()}_createObject(l){const f=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),_=new ee(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return _.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),f.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),f.colorAttachment.set(_.texture),{id:l,fbo:f,texture:_,stamp:-1,inUse:!1}}getObjectForId(l){return this._objects[l]}useObject(l){l.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(f=>l.id!==f),this._recentlyUsed.push(l.id)}stampObject(l){l.stamp=++this._stamp}getOrCreateFreeObject(){for(const f of this._recentlyUsed)if(!this._objects[f].inUse)return this._objects[f];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const l=this._createObject(this._objects.length);return this._objects.push(l),l}freeObject(l){l.inUse=!1}freeAllObjects(){for(const l of this._objects)this.freeObject(l)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(l=>!l.inUse)===!1}}const es={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class cu{constructor(l,f){this.painter=l,this.terrain=f,this.pool=new el(l.context,30,f.sourceCache.tileSize*f.qualityFactor)}destruct(){this.pool.destruct()}getTexture(l){return this.pool.getObjectForId(l.rtt[this._stacks.length-1].id).texture}prepareForRender(l,f){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=l._order.filter(_=>!l._layers[_].isHidden(f)),this._coordsDescendingInv={};for(const _ in l.sourceCaches){this._coordsDescendingInv[_]={};const b=l.sourceCaches[_].getVisibleCoordinates();for(const k of b){const E=this.terrain.sourceCache.getTerrainCoords(k);for(const A in E)this._coordsDescendingInv[_][A]||(this._coordsDescendingInv[_][A]=[]),this._coordsDescendingInv[_][A].push(E[A])}}this._coordsDescendingInvStr={};for(const _ of l._order){const b=l._layers[_],k=b.source;if(es[b.type]&&!this._coordsDescendingInvStr[k]){this._coordsDescendingInvStr[k]={};for(const E in this._coordsDescendingInv[k])this._coordsDescendingInvStr[k][E]=this._coordsDescendingInv[k][E].map(A=>A.key).sort().join()}}for(const _ of this._renderableTiles)for(const b in this._coordsDescendingInvStr){const k=this._coordsDescendingInvStr[b][_.tileID.key];k&&k!==_.rttCoords[b]&&(_.rtt=[])}}renderLayer(l){if(l.isHidden(this.painter.transform.zoom))return!1;const f=l.type,_=this.painter,b=this._renderableLayerIds[this._renderableLayerIds.length-1]===l.id;if(es[f]&&(this._prevType&&es[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(l.id),!b))return!0;if(es[this._prevType]||es[f]&&b){this._prevType=f;const k=this._stacks.length-1,E=this._stacks[k]||[];for(const A of this._renderableTiles){if(this.pool.isFull()&&(Vl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(A),A.rtt[k]){const Z=this.pool.getObjectForId(A.rtt[k].id);if(Z.stamp===A.rtt[k].stamp){this.pool.useObject(Z);continue}}const B=this.pool.getOrCreateFreeObject();this.pool.useObject(B),this.pool.stampObject(B),A.rtt[k]={id:B.id,stamp:B.stamp},_.context.bindFramebuffer.set(B.fbo.framebuffer),_.context.clear({color:a.aO.transparent,stencil:0}),_.currentStencilSource=void 0;for(let Z=0;Z<E.length;Z++){const X=_.style._layers[E[Z]],Q=X.source?this._coordsDescendingInv[X.source][A.tileID.key]:[A.tileID];_.context.viewport.set([0,0,B.fbo.width,B.fbo.height]),_._renderTileClippingMasks(X,Q),_.renderLayer(_,_.style.sourceCaches[X.source],X,Q),X.source&&(A.rttCoords[X.source]=this._coordsDescendingInvStr[X.source][A.tileID.key])}}return Vl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),es[f]}return!1}}const uu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},hu=d,tl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:lu,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Xl=x=>{x.touchstart=x.dragStart,x.touchmoveWindow=x.dragMove,x.touchend=x.dragEnd},fu={showCompass:!0,showZoom:!0,visualizePitch:!1};class du{constructor(l,f,_=!1){this.mousedown=E=>{this.startMouse(a.e({},E,{ctrlKey:!0,preventDefault:()=>E.preventDefault()}),w.mousePos(this.element,E)),w.addEventListener(window,"mousemove",this.mousemove),w.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=E=>{this.moveMouse(E,w.mousePos(this.element,E))},this.mouseup=E=>{this.mouseRotate.dragEnd(E),this.mousePitch&&this.mousePitch.dragEnd(E),this.offTemp()},this.touchstart=E=>{E.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=w.touchPos(this.element,E.targetTouches)[0],this.startTouch(E,this._startPos),w.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.addEventListener(window,"touchend",this.touchend))},this.touchmove=E=>{E.targetTouches.length!==1?this.reset():(this._lastPos=w.touchPos(this.element,E.targetTouches)[0],this.moveTouch(E,this._lastPos))},this.touchend=E=>{E.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const b=l.dragRotate._mouseRotate.getClickTolerance(),k=l.dragRotate._mousePitch.getClickTolerance();this.element=f,this.mouseRotate=la({clickTolerance:b,enable:!0}),this.touchRotate=(({enable:E,clickTolerance:A,bearingDegreesPerPixelMoved:B=.8})=>{const Z=new Ht;return new aa({clickTolerance:A,move:(X,Q)=>({bearingDelta:(Q.x-X.x)*B}),moveStateManager:Z,enable:E,assignEvents:Xl})})({clickTolerance:b,enable:!0}),this.map=l,_&&(this.mousePitch=ca({clickTolerance:k,enable:!0}),this.touchPitch=(({enable:E,clickTolerance:A,pitchDegreesPerPixelMoved:B=-.5})=>{const Z=new Ht;return new aa({clickTolerance:A,move:(X,Q)=>({pitchDelta:(Q.y-X.y)*B}),moveStateManager:Z,enable:E,assignEvents:Xl})})({clickTolerance:k,enable:!0})),w.addEventListener(f,"mousedown",this.mousedown),w.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),w.addEventListener(f,"touchcancel",this.reset)}startMouse(l,f){this.mouseRotate.dragStart(l,f),this.mousePitch&&this.mousePitch.dragStart(l,f),w.disableDrag()}startTouch(l,f){this.touchRotate.dragStart(l,f),this.touchPitch&&this.touchPitch.dragStart(l,f),w.disableDrag()}moveMouse(l,f){const _=this.map,{bearingDelta:b}=this.mouseRotate.dragMove(l,f)||{};if(b&&_.setBearing(_.getBearing()+b),this.mousePitch){const{pitchDelta:k}=this.mousePitch.dragMove(l,f)||{};k&&_.setPitch(_.getPitch()+k)}}moveTouch(l,f){const _=this.map,{bearingDelta:b}=this.touchRotate.dragMove(l,f)||{};if(b&&_.setBearing(_.getBearing()+b),this.touchPitch){const{pitchDelta:k}=this.touchPitch.dragMove(l,f)||{};k&&_.setPitch(_.getPitch()+k)}}off(){const l=this.element;w.removeEventListener(l,"mousedown",this.mousedown),w.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),w.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.removeEventListener(window,"touchend",this.touchend),w.removeEventListener(l,"touchcancel",this.reset),this.offTemp()}offTemp(){w.enableDrag(),w.removeEventListener(window,"mousemove",this.mousemove),w.removeEventListener(window,"mouseup",this.mouseup),w.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.removeEventListener(window,"touchend",this.touchend)}}let ts;function Jl(x,l,f){const _=new a.M(x.lng,x.lat);if(x=new a.M(x.lng,x.lat),l){const b=new a.M(x.lng-360,x.lat),k=new a.M(x.lng+360,x.lat),E=f.locationPoint(x).distSqr(l);f.locationPoint(b).distSqr(l)<E?x=b:f.locationPoint(k).distSqr(l)<E&&(x=k)}for(;Math.abs(x.lng-f.center.lng)>180;){const b=f.locationPoint(x);if(b.x>=0&&b.y>=0&&b.x<=f.width&&b.y<=f.height)break;x.lng>f.center.lng?x.lng-=360:x.lng+=360}return x.lng!==_.lng&&f.locationPoint(x).y>f.height/2-f.getHorizon()?x:_}const nl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Yl(x,l,f){const _=x.classList;for(const b in nl)_.remove(`maplibregl-${f}-anchor-${b}`);_.add(`maplibregl-${f}-anchor-${l}`)}class rl extends a.E{constructor(l){if(super(),this._onKeyPress=f=>{const _=f.code,b=f.charCode||f.keyCode;_!=="Space"&&_!=="Enter"&&b!==32&&b!==13||this.togglePopup()},this._onMapClick=f=>{const _=f.originalEvent.target,b=this._element;this._popup&&(_===b||b.contains(_))&&this.togglePopup()},this._update=f=>{var _;if(!this._map)return;const b=this._map.loaded()&&!this._map.isMoving();((f==null?void 0:f.type)==="terrain"||(f==null?void 0:f.type)==="render"&&!b)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Jl(this._lngLat,this._flatPos,this._map.transform):(_=this._lngLat)===null||_===void 0?void 0:_.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let k="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?k=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(k=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E=`rotateX(${this._map.getPitch()}deg)`),f&&f.type!=="moveend"||(this._pos=this._pos.round()),w.setTransform(this._element,`${nl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${E} ${k}`),y.frameAsync(new AbortController).then(()=>{this._updateOpacity(f&&f.type==="moveend")}).catch(()=>{})},this._onMove=f=>{if(!this._isDragging){const _=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=f=>{this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment!=="auto"?l.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(l==null?void 0:l.opacity,l==null?void 0:l.opacityWhenCovered),l&&l.element)this._element=l.element,this._offset=a.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=w.create("div"),this._element.setAttribute("aria-label","Map marker");const f=w.createNS("http://www.w3.org/2000/svg","svg"),_=41,b=27;f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height",`${_}px`),f.setAttributeNS(null,"width",`${b}px`),f.setAttributeNS(null,"viewBox",`0 0 ${b} ${_}`);const k=w.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"stroke","none"),k.setAttributeNS(null,"stroke-width","1"),k.setAttributeNS(null,"fill","none"),k.setAttributeNS(null,"fill-rule","evenodd");const E=w.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");const A=w.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"transform","translate(3.0, 29.0)"),A.setAttributeNS(null,"fill","#000000");const B=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Fe of B){const Je=w.createNS("http://www.w3.org/2000/svg","ellipse");Je.setAttributeNS(null,"opacity","0.04"),Je.setAttributeNS(null,"cx","10.5"),Je.setAttributeNS(null,"cy","5.80029008"),Je.setAttributeNS(null,"rx",Fe.rx),Je.setAttributeNS(null,"ry",Fe.ry),A.appendChild(Je)}const Z=w.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"fill",this._color);const X=w.createNS("http://www.w3.org/2000/svg","path");X.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Z.appendChild(X);const Q=w.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"opacity","0.25"),Q.setAttributeNS(null,"fill","#000000");const pe=w.createNS("http://www.w3.org/2000/svg","path");pe.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Q.appendChild(pe);const Se=w.createNS("http://www.w3.org/2000/svg","g");Se.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Se.setAttributeNS(null,"fill","#FFFFFF");const ke=w.createNS("http://www.w3.org/2000/svg","g");ke.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Me=w.createNS("http://www.w3.org/2000/svg","circle");Me.setAttributeNS(null,"fill","#000000"),Me.setAttributeNS(null,"opacity","0.25"),Me.setAttributeNS(null,"cx","5.5"),Me.setAttributeNS(null,"cy","5.5"),Me.setAttributeNS(null,"r","5.4999962");const be=w.createNS("http://www.w3.org/2000/svg","circle");be.setAttributeNS(null,"fill","#FFFFFF"),be.setAttributeNS(null,"cx","5.5"),be.setAttributeNS(null,"cy","5.5"),be.setAttributeNS(null,"r","5.4999962"),ke.appendChild(Me),ke.appendChild(be),E.appendChild(A),E.appendChild(Z),E.appendChild(Q),E.appendChild(Se),E.appendChild(ke),f.appendChild(E),f.setAttributeNS(null,"height",_*this._scale+"px"),f.setAttributeNS(null,"width",b*this._scale+"px"),this._element.appendChild(f),this._offset=a.P.convert(l&&l.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()}),Yl(this._element,this._anchor,"marker"),l&&l.className)for(const f of l.className.split(" "))this._element.classList.add(f);this._popup=null}addTo(l){return this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),l.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),w.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=a.M.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const b=Math.abs(13.5)/Math.SQRT2;l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const l=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:l?(l.isOpen()?l.remove():(l.setLngLat(this._lngLat),l.addTo(this._map)),this):this}_updateOpacity(l=!1){var f,_;if(!(!((f=this._map)===null||f===void 0)&&f.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(l)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const b=this._map,k=b.terrain.depthAtPoint(this._pos),E=b.terrain.getElevationForLngLatZoom(this._lngLat,b.transform.tileZoom);if(b.transform.lngLatToCameraDepth(this._lngLat,E)-k<.006)return void(this._element.style.opacity=this._opacity);const A=-this._offset.y/b.transform._pixelPerMeter,B=Math.sin(b.getPitch()*Math.PI/180)*A,Z=b.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),X=b.transform.lngLatToCameraDepth(this._lngLat,E+B)-Z>.006;!((_=this._popup)===null||_===void 0)&&_.isOpen()&&X&&this._popup.remove(),this._element.style.opacity=X?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(l){return this._offset=a.P.convert(l),this._update(),this}addClassName(l){this._element.classList.add(l)}removeClassName(l){this._element.classList.remove(l)}toggleClassName(l){return this._element.classList.toggle(l)}setDraggable(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l&&l!=="auto"?l:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(l,f){return l===void 0&&f===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),l!==void 0&&(this._opacity=l),f!==void 0&&(this._opacityWhenCovered=f),this._map&&this._updateOpacity(!0),this}}const Ql={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ha=0,zs=!1;const ec={maxWidth:100,unit:"metric"};function tc(x,l,f){const _=f&&f.maxWidth||100,b=x._container.clientHeight/2,k=x.unproject([0,b]),E=x.unproject([_,b]),A=k.distanceTo(E);if(f&&f.unit==="imperial"){const B=3.2808*A;B>5280?Ds(l,_,B/5280,x._getUIString("ScaleControl.Miles")):Ds(l,_,B,x._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?Ds(l,_,A/1852,x._getUIString("ScaleControl.NauticalMiles")):A>=1e3?Ds(l,_,A/1e3,x._getUIString("ScaleControl.Kilometers")):Ds(l,_,A,x._getUIString("ScaleControl.Meters"))}function Ds(x,l,f,_){const b=function(k){const E=Math.pow(10,`${Math.floor(k)}`.length-1);let A=k/E;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(B){const Z=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*Z)/Z}(A),E*A}(f);x.style.width=l*(b/f)+"px",x.innerHTML=`${b}&nbsp;${_}`}const pu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},mu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function nc(x){if(x){if(typeof x=="number"){const l=Math.round(Math.abs(x)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,x),"top-left":new a.P(l,l),"top-right":new a.P(-l,l),bottom:new a.P(0,-x),"bottom-left":new a.P(l,-l),"bottom-right":new a.P(-l,-l),left:new a.P(x,0),right:new a.P(-x,0)}}if(x instanceof a.P||Array.isArray(x)){const l=a.P.convert(x);return{center:l,top:l,"top-left":l,"top-right":l,bottom:l,"bottom-left":l,"bottom-right":l,left:l,right:l}}return{center:a.P.convert(x.center||[0,0]),top:a.P.convert(x.top||[0,0]),"top-left":a.P.convert(x["top-left"]||[0,0]),"top-right":a.P.convert(x["top-right"]||[0,0]),bottom:a.P.convert(x.bottom||[0,0]),"bottom-left":a.P.convert(x["bottom-left"]||[0,0]),"bottom-right":a.P.convert(x["bottom-right"]||[0,0]),left:a.P.convert(x.left||[0,0]),right:a.P.convert(x.right||[0,0])}}return nc(new a.P(0,0))}const mf=d;u.AJAXError=a.be,u.Evented=a.E,u.LngLat=a.M,u.MercatorCoordinate=a.Y,u.Point=a.P,u.addProtocol=a.bf,u.config=a.a,u.removeProtocol=a.bg,u.AttributionControl=wo,u.BoxZoomHandler=bo,u.CanvasSource=ur,u.CooperativeGesturesHandler=rn,u.DoubleClickZoomHandler=su,u.DragPanHandler=ff,u.DragRotateHandler=vo,u.EdgeInsets=oa,u.FullscreenControl=class extends a.E{constructor(x={}){super(),this._onFullscreenChange=()=>{var l;let f=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((l=f==null?void 0:f.shadowRoot)===null||l===void 0)&&l.fullscreenElement;)f=f.shadowRoot.fullscreenElement;f===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,x&&x.container&&(x.container instanceof HTMLElement?this._container=x.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(x){return this._map=x,this._container||(this._container=this._map.getContainer()),this._controlContainer=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){w.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const x=this._fullscreenButton=w.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);w.create("span","maplibregl-ctrl-icon",x).setAttribute("aria-hidden","true"),x.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const x=this._getTitle();this._fullscreenButton.setAttribute("aria-label",x),this._fullscreenButton.title=x}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},u.GeoJSONSource=Oe,u.GeolocateControl=class extends a.E{constructor(x){super(),this._onSuccess=l=>{if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",l)),this._finish()}},this._updateCamera=l=>{const f=new a.M(l.coords.longitude,l.coords.latitude),_=l.coords.accuracy,b=this._map.getBearing(),k=a.e({bearing:b},this.options.fitBoundsOptions),E=Ve.fromLngLat(f,_);this._map.fitBounds(E,k,{geolocateSource:!0})},this._updateMarker=l=>{if(l){const f=new a.M(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(f).addTo(this._map),this._userLocationDotMarker.setLngLat(f).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=l=>{if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&zs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",l)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=l=>{if(this._map){if(this._container.addEventListener("contextmenu",f=>f.preventDefault()),this._geolocateButton=w.create("button","maplibregl-ctrl-geolocate",this._container),w.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}else{const f=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=w.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new rl({element:this._dotElement}),this._circleElement=w.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new rl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",f=>{f.geolocateSource||this._watchState!=="ACTIVE_LOCK"||f.originalEvent&&f.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")))})}},this.options=a.e({},Ql,x)}onAdd(x){return this._map=x,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return a._(this,arguments,void 0,function*(l=!1){if(ts!==void 0&&!l)return ts;if(window.navigator.permissions===void 0)return ts=!!window.navigator.geolocation,ts;try{ts=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ts=!!window.navigator.geolocation}return ts})}().then(l=>this._setupUI(l)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),w.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ha=0,zs=!1}_isOutOfMapMaxBounds(x){const l=this._map.getMaxBounds(),f=x.coords;return l&&(f.longitude<l.getWest()||f.longitude>l.getEast()||f.latitude<l.getSouth()||f.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const x=this._map.getBounds(),l=x.getSouthEast(),f=x.getNorthEast(),_=l.distanceTo(f),b=Math.ceil(this._accuracy/(_/this._map._container.clientHeight)*2);this._circleElement.style.width=`${b}px`,this._circleElement.style.height=`${b}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ha--,zs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let x;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ha++,ha>1?(x={maximumAge:6e5,timeout:0},zs=!0):(x=this.options.positionOptions,zs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,x)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},u.Hash=nu,u.ImageSource=Kt,u.KeyboardHandler=bs,u.LngLatBounds=Ve,u.LogoControl=df,u.Map=class extends $i{constructor(x){if(a.bc.mark(a.bd.create),(x=a.e({},tl,x)).minZoom!=null&&x.maxZoom!=null&&x.minZoom>x.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(x.minPitch!=null&&x.maxPitch!=null&&x.minPitch>x.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(x.minPitch!=null&&x.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(x.maxPitch!=null&&x.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ql(x.minZoom,x.maxZoom,x.minPitch,x.maxPitch,x.renderWorldCopies),{bearingSnap:x.bearingSnap}),this._contextLost=l=>{l.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.k("webglcontextlost",{originalEvent:l}))},this._contextRestored=l=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:l}))},this._onMapScroll=l=>{if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=x.interactive,this._maxTileCacheSize=x.maxTileCacheSize,this._maxTileCacheZoomLevels=x.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=x.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=x.preserveDrawingBuffer,this._antialias=x.antialias,this._trackResize=x.trackResize,this._bearingSnap=x.bearingSnap,this._refreshExpiredTiles=x.refreshExpiredTiles,this._fadeDuration=x.fadeDuration,this._crossSourceCollisions=x.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=x.collectResourceTiming,this._renderTaskQueue=new Qa,this._controls=[],this._mapId=a.a3(),this._locale=a.e({},uu,x.locale),this._clickTolerance=x.clickTolerance,this._overridePixelRatio=x.pixelRatio,this._maxCanvasSize=x.maxCanvasSize,this.transformCameraUpdate=x.transformCameraUpdate,this._imageQueueHandle=F.addThrottleControl(()=>this.isMoving()),this._requestManager=new N(x.transformRequest),typeof x.container=="string"){if(this._container=document.getElementById(x.container),!this._container)throw new Error(`Container '${x.container}' not found.`)}else{if(!(x.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=x.container}if(x.maxBounds&&this.setMaxBounds(x.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let l=!1;const f=tu(_=>{this._trackResize&&!this._removed&&this.resize(_)._update()},50);this._resizeObserver=new ResizeObserver(_=>{l?f(_):l=!0}),this._resizeObserver.observe(this._container)}this.handlers=new au(this,x),this._hash=x.hash&&new nu(typeof x.hash=="string"&&x.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:x.center,zoom:x.zoom,bearing:x.bearing,pitch:x.pitch}),x.bounds&&(this.resize(),this.fitBounds(x.bounds,a.e({},x.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=x.localIdeographFontFamily,this._validateStyle=x.validateStyle,x.style&&this.setStyle(x.style,{localIdeographFontFamily:x.localIdeographFontFamily}),x.attributionControl&&this.addControl(new wo(typeof x.attributionControl=="boolean"?void 0:x.attributionControl)),x.maplibreLogo&&this.addControl(new df,x.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new a.k(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new a.k(`${l.dataType}dataloading`,l))}),this.on("dataabort",l=>{this.fire(new a.k("sourcedataabort",l))})}_getMapId(){return this._mapId}addControl(x,l){if(l===void 0&&(l=x.getDefaultPosition?x.getDefaultPosition():"top-right"),!x||!x.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=x.onAdd(this);this._controls.push(x);const _=this._controlPositions[l];return l.indexOf("bottom")!==-1?_.insertBefore(f,_.firstChild):_.appendChild(f),this}removeControl(x){if(!x||!x.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(x);return l>-1&&this._controls.splice(l,1),x.onRemove(this),this}hasControl(x){return this._controls.indexOf(x)>-1}calculateCameraOptionsFromTo(x,l,f,_){return _==null&&this.terrain&&(_=this.terrain.getElevationForLngLatZoom(f,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(x,l,f,_)}resize(x){var l;const f=this._containerDimensions(),_=f[0],b=f[1],k=this._getClampedPixelRatio(_,b);if(this._resizeCanvas(_,b,k),this.painter.resize(_,b,k),this.painter.overLimit()){const A=this.painter.context.gl;this._maxCanvasSize=[A.drawingBufferWidth,A.drawingBufferHeight];const B=this._getClampedPixelRatio(_,b);this._resizeCanvas(_,b,B),this.painter.resize(_,b,B)}this.transform.resize(_,b),(l=this._requestedCameraState)===null||l===void 0||l.resize(_,b);const E=!this._moving;return E&&(this.stop(),this.fire(new a.k("movestart",x)).fire(new a.k("move",x))),this.fire(new a.k("resize",x)),E&&this.fire(new a.k("moveend",x)),this}_getClampedPixelRatio(x,l){const{0:f,1:_}=this._maxCanvasSize,b=this.getPixelRatio(),k=x*b,E=l*b;return Math.min(k>f?f/k:1,E>_?_/E:1)*b}getPixelRatio(){var x;return(x=this._overridePixelRatio)!==null&&x!==void 0?x:devicePixelRatio}setPixelRatio(x){this._overridePixelRatio=x,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(x){return this.transform.setMaxBounds(Ve.convert(x)),this._update()}setMinZoom(x){if((x=x??-2)>=-2&&x<=this.transform.maxZoom)return this.transform.minZoom=x,this._update(),this.getZoom()<x&&this.setZoom(x),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(x){if((x=x??22)>=this.transform.minZoom)return this.transform.maxZoom=x,this._update(),this.getZoom()>x&&this.setZoom(x),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(x){if((x=x??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(x>=0&&x<=this.transform.maxPitch)return this.transform.minPitch=x,this._update(),this.getPitch()<x&&this.setPitch(x),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(x){if((x=x??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(x>=this.transform.minPitch)return this.transform.maxPitch=x,this._update(),this.getPitch()>x&&this.setPitch(x),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(x){return this.transform.renderWorldCopies=x,this._update()}project(x){return this.transform.locationPoint(a.M.convert(x),this.style&&this.terrain)}unproject(x){return this.transform.pointLocation(a.P.convert(x),this.terrain)}isMoving(){var x;return this._moving||((x=this.handlers)===null||x===void 0?void 0:x.isMoving())}isZooming(){var x;return this._zooming||((x=this.handlers)===null||x===void 0?void 0:x.isZooming())}isRotating(){var x;return this._rotating||((x=this.handlers)===null||x===void 0?void 0:x.isRotating())}_createDelegatedListener(x,l,f){if(x==="mouseenter"||x==="mouseover"){let _=!1;return{layer:l,listener:f,delegates:{mousemove:k=>{const E=this.getLayer(l)?this.queryRenderedFeatures(k.point,{layers:[l]}):[];E.length?_||(_=!0,f.call(this,new Ri(x,this,k.originalEvent,{features:E}))):_=!1},mouseout:()=>{_=!1}}}}if(x==="mouseleave"||x==="mouseout"){let _=!1;return{layer:l,listener:f,delegates:{mousemove:E=>{(this.getLayer(l)?this.queryRenderedFeatures(E.point,{layers:[l]}):[]).length?_=!0:_&&(_=!1,f.call(this,new Ri(x,this,E.originalEvent)))},mouseout:E=>{_&&(_=!1,f.call(this,new Ri(x,this,E.originalEvent)))}}}}{const _=b=>{const k=this.getLayer(l)?this.queryRenderedFeatures(b.point,{layers:[l]}):[];k.length&&(b.features=k,f.call(this,b),delete b.features)};return{layer:l,listener:f,delegates:{[x]:_}}}}on(x,l,f){if(f===void 0)return super.on(x,l);const _=this._createDelegatedListener(x,l,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[x]=this._delegatedListeners[x]||[],this._delegatedListeners[x].push(_);for(const b in _.delegates)this.on(b,_.delegates[b]);return this}once(x,l,f){if(f===void 0)return super.once(x,l);const _=this._createDelegatedListener(x,l,f);for(const b in _.delegates)this.once(b,_.delegates[b]);return this}off(x,l,f){return f===void 0?super.off(x,l):(this._delegatedListeners&&this._delegatedListeners[x]&&(_=>{const b=this._delegatedListeners[x];for(let k=0;k<b.length;k++){const E=b[k];if(E.layer===l&&E.listener===f){for(const A in E.delegates)this.off(A,E.delegates[A]);return b.splice(k,1),this}}})(),this)}queryRenderedFeatures(x,l){if(!this.style)return[];let f;const _=x instanceof a.P||Array.isArray(x),b=_?x:[[0,0],[this.transform.width,this.transform.height]];if(l=l||(_?{}:x)||{},b instanceof a.P||typeof b[0]=="number")f=[a.P.convert(b)];else{const k=a.P.convert(b[0]),E=a.P.convert(b[1]);f=[k,new a.P(E.x,k.y),E,new a.P(k.x,E.y),k]}return this.style.queryRenderedFeatures(f,l,this.transform)}querySourceFeatures(x,l){return this.style.querySourceFeatures(x,l)}setStyle(x,l){return(l=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&x?(this._diffStyle(x,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._updateStyle(x,l))}setTransformRequest(x){return this._requestManager.setTransformRequest(x),this}_getUIString(x){const l=this._locale[x];if(l==null)throw new Error(`Missing UI string '${x}'`);return l}_updateStyle(x,l){if(l.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(x,l));const f=this.style&&l.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!x)),x?(this.style=new Ki(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof x=="string"?this.style.loadURL(x,l,f):this.style.loadJSON(x,l,f),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ki(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(x,l){if(typeof x=="string"){const f=this._requestManager.transformRequest(x,"Style");a.h(f,new AbortController).then(_=>{this._updateDiff(_.data,l)}).catch(_=>{_&&this.fire(new a.j(_))})}else typeof x=="object"&&this._updateDiff(x,l)}_updateDiff(x,l){try{this.style.setState(x,l)&&this._update(!0)}catch(f){a.w(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(x,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(x,l){return this._lazyInitEmptyStyle(),this.style.addSource(x,l),this._update(!0)}isSourceLoaded(x){const l=this.style&&this.style.sourceCaches[x];if(l!==void 0)return l.loaded();this.fire(new a.j(new Error(`There is no source with ID '${x}'`)))}setTerrain(x){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),x){const l=this.style.sourceCaches[x.source];if(!l)throw new Error(`cannot load terrain, because there exists no source with ID: ${x.source}`);this.terrain===null&&l.reload();for(const f in this.style._layers){const _=this.style._layers[f];_.type==="hillshade"&&_.source===x.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new pf(this.painter,l,x),this.painter.renderToTexture=new cu(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=f=>{f.dataType==="style"?this.terrain.sourceCache.freeRtt():f.dataType==="source"&&f.tile&&(f.sourceId!==x.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(f.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:x})),this}getTerrain(){var x,l;return(l=(x=this.terrain)===null||x===void 0?void 0:x.options)!==null&&l!==void 0?l:null}areTilesLoaded(){const x=this.style&&this.style.sourceCaches;for(const l in x){const f=x[l]._tiles;for(const _ in f){const b=f[_];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}removeSource(x){return this.style.removeSource(x),this._update(!0)}getSource(x){return this.style.getSource(x)}addImage(x,l,f={}){const{pixelRatio:_=1,sdf:b=!1,stretchX:k,stretchY:E,content:A}=f;if(this._lazyInitEmptyStyle(),!(l instanceof HTMLImageElement||a.b(l))){if(l.width===void 0||l.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:B,height:Z,data:X}=l,Q=l;return this.style.addImage(x,{data:new a.R({width:B,height:Z},new Uint8Array(X)),pixelRatio:_,stretchX:k,stretchY:E,content:A,sdf:b,version:0,userImage:Q}),Q.onAdd&&Q.onAdd(this,x),this}}{const{width:B,height:Z,data:X}=y.getImageData(l);this.style.addImage(x,{data:new a.R({width:B,height:Z},X),pixelRatio:_,stretchX:k,stretchY:E,content:A,sdf:b,version:0})}}updateImage(x,l){const f=this.style.getImage(x);if(!f)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=l instanceof HTMLImageElement||a.b(l)?y.getImageData(l):l,{width:b,height:k,data:E}=_;if(b===void 0||k===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==f.data.width||k!==f.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const A=!(l instanceof HTMLImageElement||a.b(l));return f.data.replace(E,A),this.style.updateImage(x,f),this}getImage(x){return this.style.getImage(x)}hasImage(x){return x?!!this.style.getImage(x):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(x){this.style.removeImage(x)}loadImage(x){return F.getImage(this._requestManager.transformRequest(x,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(x,l){return this._lazyInitEmptyStyle(),this.style.addLayer(x,l),this._update(!0)}moveLayer(x,l){return this.style.moveLayer(x,l),this._update(!0)}removeLayer(x){return this.style.removeLayer(x),this._update(!0)}getLayer(x){return this.style.getLayer(x)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(x,l,f){return this.style.setLayerZoomRange(x,l,f),this._update(!0)}setFilter(x,l,f={}){return this.style.setFilter(x,l,f),this._update(!0)}getFilter(x){return this.style.getFilter(x)}setPaintProperty(x,l,f,_={}){return this.style.setPaintProperty(x,l,f,_),this._update(!0)}getPaintProperty(x,l){return this.style.getPaintProperty(x,l)}setLayoutProperty(x,l,f,_={}){return this.style.setLayoutProperty(x,l,f,_),this._update(!0)}getLayoutProperty(x,l){return this.style.getLayoutProperty(x,l)}setGlyphs(x,l={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(x,l),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(x,l,f={}){return this._lazyInitEmptyStyle(),this.style.addSprite(x,l,f,_=>{_||this._update(!0)}),this}removeSprite(x){return this._lazyInitEmptyStyle(),this.style.removeSprite(x),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(x,l={}){return this._lazyInitEmptyStyle(),this.style.setSprite(x,l,f=>{f||this._update(!0)}),this}setLight(x,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(x,l),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(x,l){return this.style.setFeatureState(x,l),this._update()}removeFeatureState(x,l){return this.style.removeFeatureState(x,l),this._update()}getFeatureState(x){return this.style.getFeatureState(x)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let x=0,l=0;return this._container&&(x=this._container.clientWidth||400,l=this._container.clientHeight||300),[x,l]}_setupContainer(){const x=this._container;x.classList.add("maplibregl-map");const l=this._canvasContainer=w.create("div","maplibregl-canvas-container",x);this._interactive&&l.classList.add("maplibregl-interactive"),this._canvas=w.create("canvas","maplibregl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const f=this._containerDimensions(),_=this._getClampedPixelRatio(f[0],f[1]);this._resizeCanvas(f[0],f[1],_);const b=this._controlContainer=w.create("div","maplibregl-control-container",x),k=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(E=>{k[E]=w.create("div",`maplibregl-ctrl-${E} `,b)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(x,l,f){this._canvas.width=Math.floor(f*x),this._canvas.height=Math.floor(f*l),this._canvas.style.width=`${x}px`,this._canvas.style.height=`${l}px`}_setupPainter(){const x={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let l=null;this._canvas.addEventListener("webglcontextcreationerror",_=>{l={requestedAttributes:x},_&&(l.statusMessage=_.statusMessage,l.type=_.type)},{once:!0});const f=this._canvas.getContext("webgl2",x)||this._canvas.getContext("webgl",x);if(!f){const _="Failed to initialize WebGL";throw l?(l.message=_,new Error(JSON.stringify(l))):new Error(_)}this.painter=new ef(f,this.transform),T.testSupport(f)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(x){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||x,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(x){return this._update(),this._renderTaskQueue.add(x)}_cancelRenderFrame(x){this._renderTaskQueue.remove(x)}_render(x){const l=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(x),this._removed)return;let f=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const b=this.transform.zoom,k=y.now();this.style.zoomHistory.update(b,k);const E=new a.a8(b,{now:k,fadeDuration:l,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),A=E.crossFadingFactor();A===1&&A===this._crossFadingFactor||(f=!0,this._crossFadingFactor=A),this.style.update(E)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bc.mark(a.bd.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||f)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const _=this._sourcesDirty||this._styleDirty||this._placementDirty;return _||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||_||(this._fullyLoaded=!0,a.bc.mark(a.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var x;this._hash&&this._hash.remove();for(const f of this._controls)f.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),F.removeThrottleControl(this._imageQueueHandle),(x=this._resizeObserver)===null||x===void 0||x.disconnect();const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),w.remove(this._canvasContainer),w.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),a.bc.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,y.frameAsync(this._frameRequest).then(x=>{a.bc.frame(x),this._frameRequest=null,this._render(x)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(x){this._showTileBoundaries!==x&&(this._showTileBoundaries=x,this._update())}get showPadding(){return!!this._showPadding}set showPadding(x){this._showPadding!==x&&(this._showPadding=x,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(x){this._showCollisionBoxes!==x&&(this._showCollisionBoxes=x,x?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(x){this._showOverdrawInspector!==x&&(this._showOverdrawInspector=x,this._update())}get repaint(){return!!this._repaint}set repaint(x){this._repaint!==x&&(this._repaint=x,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(x){this._vertices=x,this._update()}get version(){return hu}getCameraTargetElevation(){return this.transform.elevation}},u.MapMouseEvent=Ri,u.MapTouchEvent=No,u.MapWheelEvent=ru,u.Marker=rl,u.NavigationControl=class{constructor(x){this._updateZoomButtons=()=>{const l=this._map.getZoom(),f=l===this._map.getMaxZoom(),_=l===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},this._rotateCompassArrow=()=>{const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=l},this._setButtonTitle=(l,f)=>{const _=this._map._getUIString(`NavigationControl.${f}`);l.title=_,l.setAttribute("aria-label",_)},this.options=a.e({},fu,x),this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",l=>this._map.zoomIn({},{originalEvent:l})),w.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",l=>this._map.zoomOut({},{originalEvent:l})),w.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",l=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})}),this._compassIcon=w.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(x){return this._map=x,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new du(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){w.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(x,l){const f=w.create("button",x,this._container);return f.type="button",f.addEventListener("click",l),f}},u.Popup=class extends a.E{constructor(x){super(),this.remove=()=>(this._content&&w.remove(this._content),this._container&&(w.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.k("close"))),this),this._onMouseUp=l=>{this._update(l.point)},this._onMouseMove=l=>{this._update(l.point)},this._onDrag=l=>{this._update(l.point)},this._update=l=>{var f;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=w.create("div","maplibregl-popup",this._map.getContainer()),this._tip=w.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const A of this.options.className.split(" "))this._container.classList.add(A);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Jl(this._lngLat,this._flatPos,this._map.transform):(f=this._lngLat)===null||f===void 0?void 0:f.wrap(),this._trackPointer&&!l)return;const _=this._flatPos=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&l?l:this._map.transform.locationPoint(this._lngLat));let b=this.options.anchor;const k=nc(this.options.offset);if(!b){const A=this._container.offsetWidth,B=this._container.offsetHeight;let Z;Z=_.y+k.bottom.y<B?["top"]:_.y>this._map.transform.height-B?["bottom"]:[],_.x<A/2?Z.push("left"):_.x>this._map.transform.width-A/2&&Z.push("right"),b=Z.length===0?"bottom":Z.join("-")}let E=_.add(k[b]);this.options.subpixelPositioning||(E=E.round()),w.setTransform(this._container,`${nl[b]} translate(${E.x}px,${E.y}px)`),Yl(this._container,b,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(pu),x)}addTo(x){return this._map&&this.remove(),this._map=x,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(x){return this._lngLat=a.M.convert(x),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(x){return this.setDOMContent(document.createTextNode(x))}setHTML(x){const l=document.createDocumentFragment(),f=document.createElement("body");let _;for(f.innerHTML=x;_=f.firstChild,_;)l.appendChild(_);return this.setDOMContent(l)}getMaxWidth(){var x;return(x=this._container)===null||x===void 0?void 0:x.style.maxWidth}setMaxWidth(x){return this.options.maxWidth=x,this._update(),this}setDOMContent(x){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=w.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(x),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(x){this._container&&this._container.classList.add(x)}removeClassName(x){this._container&&this._container.classList.remove(x)}setOffset(x){return this.options.offset=x,this._update(),this}toggleClassName(x){if(this._container)return this._container.classList.toggle(x)}setSubpixelPositioning(x){this.options.subpixelPositioning=x}_createCloseButton(){this.options.closeButton&&(this._closeButton=w.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const x=this._container.querySelector(mu);x&&x.focus()}},u.RasterDEMTileSource=zn,u.RasterTileSource=ye,u.ScaleControl=class{constructor(x){this._onMove=()=>{tc(this._map,this._container,this.options)},this.setUnit=l=>{this.options.unit=l,tc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},ec),x)}getDefaultPosition(){return"bottom-left"}onAdd(x){return this._map=x,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-scale",x.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){w.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},u.ScrollZoomHandler=Wl,u.Style=Ki,u.TerrainControl=class{constructor(x){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=x}onAdd(x){return this._map=x,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=w.create("button","maplibregl-ctrl-terrain",this._container),w.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){w.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},u.TwoFingersTouchPitchHandler=cf,u.TwoFingersTouchRotateHandler=ou,u.TwoFingersTouchZoomHandler=lf,u.TwoFingersTouchZoomRotateHandler=Ja,u.VectorTileSource=Ut,u.VideoSource=Un,u.addSourceType=(x,l)=>a._(void 0,void 0,void 0,function*(){if(Ar(x))throw new Error(`A source type called "${x}" already exists.`);((f,_)=>{pr[f]=_})(x,l)}),u.clearPrewarmedResources=function(){const x=Bt;x&&(x.isPreloaded()&&x.numActive()===1?(x.release(mt),Bt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},u.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},u.getRTLTextPluginStatus=function(){return vt().getRTLTextPluginStatus()},u.getVersion=function(){return mf},u.getWorkerCount=function(){return ht.workerCount},u.getWorkerUrl=function(){return a.a.WORKER_URL},u.importScriptInWorkers=function(x){return Qt().broadcast("IS",x)},u.prewarm=function(){Nt().acquire(mt)},u.setMaxParallelImageRequests=function(x){a.a.MAX_PARALLEL_IMAGE_REQUESTS=x},u.setRTLTextPlugin=function(x,l){return vt().setRTLTextPlugin(x,l)},u.setWorkerCount=function(x){ht.workerCount=x},u.setWorkerUrl=function(x){a.a.WORKER_URL=x}});var o=t;return o})})(wb);var Hs=wb.exports;const ei=vb(Hs),cx=U2({__proto__:null,default:ei},[Hs]);let on;const kb=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&kb.decode();let Hu=null;function th(){return(Hu===null||Hu.byteLength===0)&&(Hu=new Uint8Array(on.memory.buffer)),Hu}function Ho(r,e){return r=r>>>0,kb.decode(th().subarray(r,r+e))}const Vs=new Array(128).fill(void 0);Vs.push(void 0,null,!0,!1);let nh=Vs.length;function Qr(r){nh===Vs.length&&Vs.push(Vs.length+1);const e=nh;return nh=Vs[e],Vs[e]=r,e}function jn(r){return Vs[r]}function ux(r){r<132||(Vs[r]=nh,nh=r)}function kc(r){const e=jn(r);return ux(r),e}function Fp(r){return r==null}let Wu=null;function hx(){return(Wu===null||Wu.byteLength===0)&&(Wu=new Float64Array(on.memory.buffer)),Wu}let Ku=null;function Hn(){return(Ku===null||Ku.byteLength===0)&&(Ku=new Int32Array(on.memory.buffer)),Ku}let wa=0;const Hf=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},fx=typeof Hf.encodeInto=="function"?function(r,e){return Hf.encodeInto(r,e)}:function(r,e){const t=Hf.encode(r);return e.set(t),{read:r.length,written:t.length}};function Of(r,e,t){if(t===void 0){const a=Hf.encode(r),d=e(a.length,1)>>>0;return th().subarray(d,d+a.length).set(a),wa=a.length,d}let n=r.length,i=e(n,1)>>>0;const o=th();let u=0;for(;u<n;u++){const a=r.charCodeAt(u);if(a>127)break;o[i+u]=a}if(u!==n){u!==0&&(r=r.slice(u)),i=t(i,n,n=u+r.length*3,1)>>>0;const a=th().subarray(i+u,i+n),d=fx(r,a);u+=d.written}return wa=u,i}function em(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=em(r[0]));for(let u=1;u<i;u++)o+=", "+em(r[u]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function dx(r,e){const t=e(r.length*1,1)>>>0;return th().set(r,t/1),wa=r.length,t}function Bp(r,e){try{return r.apply(this,e)}catch(t){on.__wbindgen_exn_store(Qr(t))}}class id{static __wrap(e){e=e>>>0;const t=Object.create(id.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();on.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=on.__wbindgen_add_to_stack_pointer(-16),u=dx(e,on.__wbindgen_malloc),a=wa;on.jsroutesnapper_new(o,u,a);var t=Hn()[o/4+0],n=Hn()[o/4+1],i=Hn()[o/4+2];if(i)throw kc(n);return id.__wrap(t)}finally{on.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){on.jsroutesnapper_setRouteConfig(this.__wbg_ptr,Qr(e))}setAreaMode(){on.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const o=on.__wbindgen_add_to_stack_pointer(-16);on.jsroutesnapper_getConfig(o,this.__wbg_ptr);var n=Hn()[o/4+0],i=Hn()[o/4+1];return e=n,t=i,Ho(n,i)}finally{on.__wbindgen_add_to_stack_pointer(16),on.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const n=on.__wbindgen_add_to_stack_pointer(-16);on.jsroutesnapper_toFinalFeature(n,this.__wbg_ptr);var e=Hn()[n/4+0],t=Hn()[n/4+1];let i;return e!==0&&(i=Ho(e,t).slice(),on.__wbindgen_free(e,t*1)),i}finally{on.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const o=on.__wbindgen_add_to_stack_pointer(-16);on.jsroutesnapper_renderGeojson(o,this.__wbg_ptr);var n=Hn()[o/4+0],i=Hn()[o/4+1];return e=n,t=i,Ho(n,i)}finally{on.__wbindgen_add_to_stack_pointer(16),on.__wbindgen_free(e,t,1)}}toggleSnapMode(){on.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,n){return on.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,n)!==0}onClick(){on.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return on.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return on.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){on.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const i=on.__wbindgen_add_to_stack_pointer(-16);on.jsroutesnapper_editExisting(i,this.__wbg_ptr,Qr(e));var t=Hn()[i/4+0],n=Hn()[i/4+1];if(n)throw kc(t)}finally{on.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const o=on.__wbindgen_add_to_stack_pointer(-16);on.jsroutesnapper_debugRenderGraph(o,this.__wbg_ptr);var n=Hn()[o/4+0],i=Hn()[o/4+1];return e=n,t=i,Ho(n,i)}finally{on.__wbindgen_add_to_stack_pointer(16),on.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const o=on.__wbindgen_add_to_stack_pointer(-16);on.jsroutesnapper_debugSnappableNodes(o,this.__wbg_ptr);var n=Hn()[o/4+0],i=Hn()[o/4+1];return e=n,t=i,Ho(n,i)}finally{on.__wbindgen_add_to_stack_pointer(16),on.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,n;try{const g=on.__wbindgen_add_to_stack_pointer(-16);on.jsroutesnapper_routeNameForWaypoints(g,this.__wbg_ptr,Qr(e));var i=Hn()[g/4+0],o=Hn()[g/4+1],u=Hn()[g/4+2],a=Hn()[g/4+3],d=i,p=o;if(a)throw d=0,p=0,kc(u);return t=d,n=p,Ho(d,p)}finally{on.__wbindgen_add_to_stack_pointer(16),on.__wbindgen_free(t,n,1)}}addSnappedWaypoint(e,t){on.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){on.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,n;try{const g=on.__wbindgen_add_to_stack_pointer(-16);on.jsroutesnapper_calculateRoute(g,this.__wbg_ptr,Qr(e));var i=Hn()[g/4+0],o=Hn()[g/4+1],u=Hn()[g/4+2],a=Hn()[g/4+3],d=i,p=o;if(a)throw d=0,p=0,kc(u);return t=d,n=p,Ho(d,p)}finally{on.__wbindgen_add_to_stack_pointer(16),on.__wbindgen_free(t,n,1)}}getExtraNodes(e,t){let n,i;try{const y=on.__wbindgen_add_to_stack_pointer(-16);on.jsroutesnapper_getExtraNodes(y,this.__wbg_ptr,Qr(e),Qr(t));var o=Hn()[y/4+0],u=Hn()[y/4+1],a=Hn()[y/4+2],d=Hn()[y/4+3],p=o,g=u;if(d)throw p=0,g=0,kc(a);return n=p,i=g,Ho(p,g)}finally{on.__wbindgen_add_to_stack_pointer(16),on.__wbindgen_free(n,i,1)}}}async function px(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function mx(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=Ho(e,t);return Qr(n)},r.wbg.__wbindgen_object_drop_ref=function(e){kc(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Ho(e,t));return Qr(n)},r.wbg.__wbindgen_number_get=function(e,t){const n=jn(t),i=typeof n=="number"?n:void 0;hx()[e/8+1]=Fp(i)?0:i,Hn()[e/4+0]=!Fp(i)},r.wbg.__wbindgen_is_object=function(e){const t=jn(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return jn(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return jn(e)in jn(t)},r.wbg.__wbindgen_boolean_get=function(e){const t=jn(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return jn(e)==jn(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=jn(t),i=typeof n=="string"?n:void 0;var o=Fp(i)?0:Of(i,on.__wbindgen_malloc,on.__wbindgen_realloc),u=wa;Hn()[e/4+1]=u,Hn()[e/4+0]=o},r.wbg.__wbg_String_4370c5505c674d30=function(e,t){const n=String(jn(t)),i=Of(n,on.__wbindgen_malloc,on.__wbindgen_realloc),o=wa;Hn()[e/4+1]=o,Hn()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=jn(e);return Qr(t)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const n=jn(e)[jn(t)];return Qr(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Qr(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=jn(t).stack,i=Of(n,on.__wbindgen_malloc,on.__wbindgen_realloc),o=wa;Hn()[e/4+1]=o,Hn()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(Ho(e,t))}finally{on.__wbindgen_free(n,i,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(jn(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(jn(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(jn(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(jn(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(jn(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,t){const n=jn(e)[t>>>0];return Qr(n)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return jn(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof jn(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const t=jn(e).next;return Qr(t)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Bp(function(e){const t=jn(e).next();return Qr(t)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return jn(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const t=jn(e).value;return Qr(t)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return Qr(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return Bp(function(e,t){const n=Reflect.get(jn(e),jn(t));return Qr(n)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return Bp(function(e,t){const n=jn(e).call(jn(t));return Qr(n)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(jn(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=jn(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=jn(e).buffer;return Qr(t)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(jn(e));return Qr(t)},r.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){jn(e).set(jn(t),n>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return jn(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=jn(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_debug_string=function(e,t){const n=em(jn(t)),i=Of(n,on.__wbindgen_malloc,on.__wbindgen_realloc),o=wa;Hn()[e/4+1]=o,Hn()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Ho(e,t))},r.wbg.__wbindgen_memory=function(){const e=on.memory;return Qr(e)},r}function _x(r,e){return on=r.exports,Sb.__wbindgen_wasm_module=e,Wu=null,Ku=null,Hu=null,on}async function Sb(r){if(on!==void 0)return on;typeof r>"u"&&(r="/ltn/assets/route_snapper_bg.wasm");const e=mx();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await px(await r,e);return _x(t,n)}var Vi=63710088e-1,Rm={centimeters:Vi*100,centimetres:Vi*100,degrees:Vi/111325,feet:Vi*3.28084,inches:Vi*39.37,kilometers:Vi/1e3,kilometres:Vi/1e3,meters:Vi,metres:Vi,miles:Vi/1609.344,millimeters:Vi*1e3,millimetres:Vi*1e3,nauticalmiles:Vi/1852,radians:1,yards:Vi*1.0936},gx={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Vi,yards:1.0936133},tm={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Qo(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function yx(r,e,t){switch(r){case"Point":return fo(e).geometry;case"LineString":return Ko(e).geometry;case"Polygon":return $m(e).geometry;case"MultiPoint":return Tb(e).geometry;case"MultiLineString":return Cb(e).geometry;case"MultiPolygon":return Mb(e).geometry;default:throw new Error(r+" is invalid")}}function fo(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!od(r[0])||!od(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return Qo(n,e,t)}function bx(r,e,t){return t===void 0&&(t={}),fl(r.map(function(n){return fo(n,e)}),t)}function $m(r,e,t){t===void 0&&(t={});for(var n=0,i=r;n<i.length;n++){var o=i[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<o[o.length-1].length;u++)if(o[o.length-1][u]!==o[0][u])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:r};return Qo(a,e,t)}function vx(r,e,t){return t===void 0&&(t={}),fl(r.map(function(n){return $m(n,e)}),t)}function Ko(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return Qo(n,e,t)}function wx(r,e,t){return t===void 0&&(t={}),fl(r.map(function(n){return Ko(n,e)}),t)}function fl(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function Cb(r,e,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:r};return Qo(n,e,t)}function Tb(r,e,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:r};return Qo(n,e,t)}function Mb(r,e,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:r};return Qo(n,e,t)}function xx(r,e,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:r};return Qo(n,e,t)}function kx(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(r*t)/t}function Fm(r,e){e===void 0&&(e="kilometers");var t=Rm[e];if(!t)throw new Error(e+" units is invalid");return r*t}function yd(r,e){e===void 0&&(e="kilometers");var t=Rm[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Sx(r,e){return hh(yd(r,e))}function Cx(r){var e=r%360;return e<0&&(e+=360),e}function hh(r){var e=r%(2*Math.PI);return e*180/Math.PI}function Xo(r){var e=r%360;return e*Math.PI/180}function Tx(r,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("length must be a positive number");return Fm(yd(r,e),t)}function Mx(r,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("area must be a positive number");var n=tm[e];if(!n)throw new Error("invalid original units");var i=tm[t];if(!i)throw new Error("invalid final units");return r/n*i}function od(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Bm(r){return!!r&&r.constructor===Object}function Lx(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!od(e))throw new Error("bbox must only contain numbers")})}function Ex(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const Ix=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:tm,bearingToAzimuth:Cx,convertArea:Mx,convertLength:Tx,degreesToRadians:Xo,earthRadius:Vi,factors:Rm,feature:Qo,featureCollection:fl,geometry:yx,geometryCollection:xx,isNumber:od,isObject:Bm,lengthToDegrees:Sx,lengthToRadians:yd,lineString:Ko,lineStrings:wx,multiLineString:Cb,multiPoint:Tb,multiPolygon:Mb,point:fo,points:bx,polygon:$m,polygons:vx,radiansToDegrees:hh,radiansToLength:Fm,round:kx,unitsFactors:gx,validateBBox:Lx,validateId:Ex},Symbol.toStringTag,{value:"Module"}));function fh(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ac(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Bu(r,e,t){t===void 0&&(t={});var n=fh(r),i=fh(e),o=Xo(i[1]-n[1]),u=Xo(i[0]-n[0]),a=Xo(n[1]),d=Xo(i[1]),p=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(u/2),2)*Math.cos(a)*Math.cos(d);return Fm(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),t.units)}function Ch(r,e,t){if(r!==null)for(var n,i,o,u,a,d,p,g=0,y=0,w,T=r.type,L=T==="FeatureCollection",D=T==="Feature",R=L?r.features.length:1,z=0;z<R;z++){p=L?r.features[z].geometry:D?r.geometry:r,w=p?p.type==="GeometryCollection":!1,a=w?p.geometries.length:1;for(var I=0;I<a;I++){var F=0,N=0;if(u=w?p.geometries[I]:p,u!==null){d=u.coordinates;var W=u.type;switch(g=t&&(W==="Polygon"||W==="MultiPolygon")?1:0,W){case null:break;case"Point":if(e(d,y,z,F,N)===!1)return!1;y++,F++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],y,z,F,N)===!1)return!1;y++,W==="MultiPoint"&&F++}W==="LineString"&&F++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-g;i++){if(e(d[n][i],y,z,F,N)===!1)return!1;y++}W==="MultiLineString"&&F++,W==="Polygon"&&N++}W==="Polygon"&&F++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(N=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-g;o++){if(e(d[n][i][o],y,z,F,N)===!1)return!1;y++}N++}F++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(Ch(u.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Ax(r,e,t,n){var i=t;return Ch(r,function(o,u,a,d,p){u===0&&t===void 0?i=o:i=e(i,o,u,a,d,p)},n),i}function Lb(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}function Px(r,e,t){var n=t;return Lb(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function sd(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function zx(r,e,t){var n=t;return sd(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function Dx(r){var e=[];return Ch(r,function(t){e.push(t)}),e}function Om(r,e){var t,n,i,o,u,a,d,p,g,y,w=0,T=r.type==="FeatureCollection",L=r.type==="Feature",D=T?r.features.length:1;for(t=0;t<D;t++){for(a=T?r.features[t].geometry:L?r.geometry:r,p=T?r.features[t].properties:L?r.properties:{},g=T?r.features[t].bbox:L?r.bbox:void 0,y=T?r.features[t].id:L?r.id:void 0,d=a?a.type==="GeometryCollection":!1,u=d?a.geometries.length:1,i=0;i<u;i++){if(o=d?a.geometries[i]:a,o===null){if(e(null,w,p,g,y)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,w,p,g,y)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],w,p,g,y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}w++}}function Rx(r,e,t){var n=t;return Om(r,function(i,o,u,a,d){o===0&&t===void 0?n=i:n=e(n,i,o,u,a,d)}),n}function $c(r,e){Om(r,function(t,n,i,o,u){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(Qo(t,i,{bbox:o,id:u}),n,0)===!1?!1:void 0}var d;switch(a){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var g=t.coordinates[p],y={type:d,coordinates:g};if(e(Qo(y,i),n,p)===!1)return!1}})}function $x(r,e,t){var n=t;return $c(r,function(i,o,u){o===0&&u===0&&t===void 0?n=i:n=e(n,i,o,u)}),n}function Eb(r,e){$c(r,function(t,n,i){var o=0;if(t.geometry){var u=t.geometry.type;if(!(u==="Point"||u==="MultiPoint")){var a,d=0,p=0,g=0;if(Ch(t,function(y,w,T,L,D){if(a===void 0||n>d||L>p||D>g){a=y,d=n,p=L,g=D,o=0;return}var R=Ko([a,y],t.properties);if(e(R,n,i,D,o)===!1)return!1;o++,a=y})===!1)return!1}}})}function Fx(r,e,t){var n=t,i=!1;return Eb(r,function(o,u,a,d,p){i===!1&&t===void 0?n=o:n=e(n,o,u,a,d,p),i=!0}),n}function Ib(r,e){if(!r)throw new Error("geojson is required");$c(r,function(t,n,i){if(t.geometry!==null){var o=t.geometry.type,u=t.geometry.coordinates;switch(o){case"LineString":if(e(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var a=0;a<u.length;a++)if(e(Ko(u[a],t.properties),n,i,a)===!1)return!1;break}}})}function Bx(r,e,t){var n=t;return Ib(r,function(i,o,u,a){o===0&&t===void 0?n=i:n=e(n,i,o,u,a)}),n}function Ox(r,e){if(e=e||{},!Bm(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,u=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),u=u||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":u=u||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var d=a.coordinates;switch(a.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=d.length+o-1),Ko([d[o],d[o+1]],u,e);case"Polygon":return i<0&&(i=d.length+i),o<0&&(o=d[i].length+o-1),Ko([d[i][o],d[i][o+1]],u,e);case"MultiLineString":return n<0&&(n=d.length+n),o<0&&(o=d[n].length+o-1),Ko([d[n][o],d[n][o+1]],u,e);case"MultiPolygon":return n<0&&(n=d.length+n),i<0&&(i=d[n].length+i),o<0&&(o=d[n][i].length-o-1),Ko([d[n][i][o],d[n][i][o+1]],u,e)}throw new Error("geojson is invalid")}function Nx(r,e){if(e=e||{},!Bm(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,u=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),u=u||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":u=u||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var d=a.coordinates;switch(a.type){case"Point":return fo(d,u,e);case"MultiPoint":return n<0&&(n=d.length+n),fo(d[n],u,e);case"LineString":return o<0&&(o=d.length+o),fo(d[o],u,e);case"Polygon":return i<0&&(i=d.length+i),o<0&&(o=d[i].length+o),fo(d[i][o],u,e);case"MultiLineString":return n<0&&(n=d.length+n),o<0&&(o=d[n].length+o),fo(d[n][o],u,e);case"MultiPolygon":return n<0&&(n=d.length+n),i<0&&(i=d[n].length+i),o<0&&(o=d[n][i].length-o),fo(d[n][i][o],u,e)}throw new Error("geojson is invalid")}const jx=Object.freeze(Object.defineProperty({__proto__:null,coordAll:Dx,coordEach:Ch,coordReduce:Ax,featureEach:sd,featureReduce:zx,findPoint:Nx,findSegment:Ox,flattenEach:$c,flattenReduce:$x,geomEach:Om,geomReduce:Rx,lineEach:Ib,lineReduce:Bx,propEach:Lb,propReduce:Px,segmentEach:Eb,segmentReduce:Fx},Symbol.toStringTag,{value:"Module"}));function Ab(r,e,t){if(t===void 0&&(t={}),t.final===!0)return Ux(r,e);var n=fh(r),i=fh(e),o=Xo(n[0]),u=Xo(i[0]),a=Xo(n[1]),d=Xo(i[1]),p=Math.sin(u-o)*Math.cos(d),g=Math.cos(a)*Math.sin(d)-Math.sin(a)*Math.cos(d)*Math.cos(u-o);return hh(Math.atan2(p,g))}function Ux(r,e){var t=Ab(e,r);return t=(t+180)%360,t}function Bg(r,e,t,n){n===void 0&&(n={});var i=fh(r),o=Xo(i[0]),u=Xo(i[1]),a=Xo(t),d=yd(e,n.units),p=Math.asin(Math.sin(u)*Math.cos(d)+Math.cos(u)*Math.sin(d)*Math.cos(a)),g=o+Math.atan2(Math.sin(a)*Math.sin(d)*Math.cos(u),Math.cos(d)-Math.sin(u)*Math.sin(p)),y=hh(g),w=hh(p);return fo([y,w],n.properties)}function Og(r){if(!r)throw new Error("geojson is required");var e=[];return $c(r,function(t){Vx(t,e)}),fl(e)}function Vx(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Ac(n);break;case"LineString":t=[Ac(n)]}t.forEach(function(i){var o=qx(i,r.properties);o.forEach(function(u){u.id=e.length,e.push(u)})})}}function qx(r,e){var t=[];return r.reduce(function(n,i){var o=Ko([n,i],e);return o.bbox=Zx(n,i),t.push(o),i}),t}function Zx(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],u=t<i?t:i,a=n<o?n:o,d=t>i?t:i,p=n>o?n:o;return[u,a,d,p]}var Nm={exports:{}},Pb={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(bb,function(){function t(I,F,N,W,se){(function J(Y,_e,ze,ee,ae){for(;ee>ze;){if(ee-ze>600){var Ee=ee-ze+1,we=_e-ze+1,it=Math.log(Ee),Ge=.5*Math.exp(2*it/3),Ie=.5*Math.sqrt(it*Ge*(Ee-Ge)/Ee)*(we-Ee/2<0?-1:1),De=Math.max(ze,Math.floor(_e-we*Ge/Ee+Ie)),Ct=Math.min(ee,Math.floor(_e+(Ee-we)*Ge/Ee+Ie));J(Y,_e,De,Ct,ae)}var nt=Y[_e],lt=ze,mt=ee;for(n(Y,ze,_e),ae(Y[ee],nt)>0&&n(Y,ze,ee);lt<mt;){for(n(Y,lt,mt),lt++,mt--;ae(Y[lt],nt)<0;)lt++;for(;ae(Y[mt],nt)>0;)mt--}ae(Y[ze],nt)===0?n(Y,ze,mt):n(Y,++mt,ee),mt<=_e&&(ze=mt+1),_e<=mt&&(ee=mt-1)}})(I,F,N||0,W||I.length-1,se||i)}function n(I,F,N){var W=I[F];I[F]=I[N],I[N]=W}function i(I,F){return I<F?-1:I>F?1:0}var o=function(I){I===void 0&&(I=9),this._maxEntries=Math.max(4,I),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function u(I,F,N){if(!N)return F.indexOf(I);for(var W=0;W<F.length;W++)if(N(I,F[W]))return W;return-1}function a(I,F){d(I,0,I.children.length,F,I)}function d(I,F,N,W,se){se||(se=R(null)),se.minX=1/0,se.minY=1/0,se.maxX=-1/0,se.maxY=-1/0;for(var J=F;J<N;J++){var Y=I.children[J];p(se,I.leaf?W(Y):Y)}return se}function p(I,F){return I.minX=Math.min(I.minX,F.minX),I.minY=Math.min(I.minY,F.minY),I.maxX=Math.max(I.maxX,F.maxX),I.maxY=Math.max(I.maxY,F.maxY),I}function g(I,F){return I.minX-F.minX}function y(I,F){return I.minY-F.minY}function w(I){return(I.maxX-I.minX)*(I.maxY-I.minY)}function T(I){return I.maxX-I.minX+(I.maxY-I.minY)}function L(I,F){return I.minX<=F.minX&&I.minY<=F.minY&&F.maxX<=I.maxX&&F.maxY<=I.maxY}function D(I,F){return F.minX<=I.maxX&&F.minY<=I.maxY&&F.maxX>=I.minX&&F.maxY>=I.minY}function R(I){return{children:I,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function z(I,F,N,W,se){for(var J=[F,N];J.length;)if(!((N=J.pop())-(F=J.pop())<=W)){var Y=F+Math.ceil((N-F)/W/2)*W;t(I,Y,F,N,se),J.push(F,Y,Y,N)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(I){var F=this.data,N=[];if(!D(I,F))return N;for(var W=this.toBBox,se=[];F;){for(var J=0;J<F.children.length;J++){var Y=F.children[J],_e=F.leaf?W(Y):Y;D(I,_e)&&(F.leaf?N.push(Y):L(I,_e)?this._all(Y,N):se.push(Y))}F=se.pop()}return N},o.prototype.collides=function(I){var F=this.data;if(!D(I,F))return!1;for(var N=[];F;){for(var W=0;W<F.children.length;W++){var se=F.children[W],J=F.leaf?this.toBBox(se):se;if(D(I,J)){if(F.leaf||L(I,J))return!0;N.push(se)}}F=N.pop()}return!1},o.prototype.load=function(I){if(!I||!I.length)return this;if(I.length<this._minEntries){for(var F=0;F<I.length;F++)this.insert(I[F]);return this}var N=this._build(I.slice(),0,I.length-1,0);if(this.data.children.length)if(this.data.height===N.height)this._splitRoot(this.data,N);else{if(this.data.height<N.height){var W=this.data;this.data=N,N=W}this._insert(N,this.data.height-N.height-1,!0)}else this.data=N;return this},o.prototype.insert=function(I){return I&&this._insert(I,this.data.height-1),this},o.prototype.clear=function(){return this.data=R([]),this},o.prototype.remove=function(I,F){if(!I)return this;for(var N,W,se,J=this.data,Y=this.toBBox(I),_e=[],ze=[];J||_e.length;){if(J||(J=_e.pop(),W=_e[_e.length-1],N=ze.pop(),se=!0),J.leaf){var ee=u(I,J.children,F);if(ee!==-1)return J.children.splice(ee,1),_e.push(J),this._condense(_e),this}se||J.leaf||!L(J,Y)?W?(N++,J=W.children[N],se=!1):J=null:(_e.push(J),ze.push(N),N=0,W=J,J=J.children[0])}return this},o.prototype.toBBox=function(I){return I},o.prototype.compareMinX=function(I,F){return I.minX-F.minX},o.prototype.compareMinY=function(I,F){return I.minY-F.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(I){return this.data=I,this},o.prototype._all=function(I,F){for(var N=[];I;)I.leaf?F.push.apply(F,I.children):N.push.apply(N,I.children),I=N.pop();return F},o.prototype._build=function(I,F,N,W){var se,J=N-F+1,Y=this._maxEntries;if(J<=Y)return a(se=R(I.slice(F,N+1)),this.toBBox),se;W||(W=Math.ceil(Math.log(J)/Math.log(Y)),Y=Math.ceil(J/Math.pow(Y,W-1))),(se=R([])).leaf=!1,se.height=W;var _e=Math.ceil(J/Y),ze=_e*Math.ceil(Math.sqrt(Y));z(I,F,N,ze,this.compareMinX);for(var ee=F;ee<=N;ee+=ze){var ae=Math.min(ee+ze-1,N);z(I,ee,ae,_e,this.compareMinY);for(var Ee=ee;Ee<=ae;Ee+=_e){var we=Math.min(Ee+_e-1,ae);se.children.push(this._build(I,Ee,we,W-1))}}return a(se,this.toBBox),se},o.prototype._chooseSubtree=function(I,F,N,W){for(;W.push(F),!F.leaf&&W.length-1!==N;){for(var se=1/0,J=1/0,Y=void 0,_e=0;_e<F.children.length;_e++){var ze=F.children[_e],ee=w(ze),ae=(Ee=I,we=ze,(Math.max(we.maxX,Ee.maxX)-Math.min(we.minX,Ee.minX))*(Math.max(we.maxY,Ee.maxY)-Math.min(we.minY,Ee.minY))-ee);ae<J?(J=ae,se=ee<se?ee:se,Y=ze):ae===J&&ee<se&&(se=ee,Y=ze)}F=Y||F.children[0]}var Ee,we;return F},o.prototype._insert=function(I,F,N){var W=N?I:this.toBBox(I),se=[],J=this._chooseSubtree(W,this.data,F,se);for(J.children.push(I),p(J,W);F>=0&&se[F].children.length>this._maxEntries;)this._split(se,F),F--;this._adjustParentBBoxes(W,se,F)},o.prototype._split=function(I,F){var N=I[F],W=N.children.length,se=this._minEntries;this._chooseSplitAxis(N,se,W);var J=this._chooseSplitIndex(N,se,W),Y=R(N.children.splice(J,N.children.length-J));Y.height=N.height,Y.leaf=N.leaf,a(N,this.toBBox),a(Y,this.toBBox),F?I[F-1].children.push(Y):this._splitRoot(N,Y)},o.prototype._splitRoot=function(I,F){this.data=R([I,F]),this.data.height=I.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(I,F,N){for(var W,se,J,Y,_e,ze,ee,ae=1/0,Ee=1/0,we=F;we<=N-F;we++){var it=d(I,0,we,this.toBBox),Ge=d(I,we,N,this.toBBox),Ie=(se=it,J=Ge,Y=void 0,_e=void 0,ze=void 0,ee=void 0,Y=Math.max(se.minX,J.minX),_e=Math.max(se.minY,J.minY),ze=Math.min(se.maxX,J.maxX),ee=Math.min(se.maxY,J.maxY),Math.max(0,ze-Y)*Math.max(0,ee-_e)),De=w(it)+w(Ge);Ie<ae?(ae=Ie,W=we,Ee=De<Ee?De:Ee):Ie===ae&&De<Ee&&(Ee=De,W=we)}return W||N-F},o.prototype._chooseSplitAxis=function(I,F,N){var W=I.leaf?this.compareMinX:g,se=I.leaf?this.compareMinY:y;this._allDistMargin(I,F,N,W)<this._allDistMargin(I,F,N,se)&&I.children.sort(W)},o.prototype._allDistMargin=function(I,F,N,W){I.children.sort(W);for(var se=this.toBBox,J=d(I,0,F,se),Y=d(I,N-F,N,se),_e=T(J)+T(Y),ze=F;ze<N-F;ze++){var ee=I.children[ze];p(J,I.leaf?se(ee):ee),_e+=T(J)}for(var ae=N-F-1;ae>=F;ae--){var Ee=I.children[ae];p(Y,I.leaf?se(Ee):Ee),_e+=T(Y)}return _e},o.prototype._adjustParentBBoxes=function(I,F,N){for(var W=N;W>=0;W--)p(F[W],I)},o.prototype._condense=function(I){for(var F=I.length-1,N=void 0;F>=0;F--)I[F].children.length===0?F>0?(N=I[F-1].children).splice(N.indexOf(I[F]),1):this.clear():a(I[F],this.toBBox)},o})})(Pb);var Gx=Pb.exports;const Hx=Dm(Ix),Wx=Dm(jx);function zb(r,e,t){if(r!==null)for(var n,i,o,u,a,d,p,g=0,y=0,w,T=r.type,L=T==="FeatureCollection",D=T==="Feature",R=L?r.features.length:1,z=0;z<R;z++){p=L?r.features[z].geometry:D?r.geometry:r,w=p?p.type==="GeometryCollection":!1,a=w?p.geometries.length:1;for(var I=0;I<a;I++){var F=0,N=0;if(u=w?p.geometries[I]:p,u!==null){d=u.coordinates;var W=u.type;switch(g=t&&(W==="Polygon"||W==="MultiPolygon")?1:0,W){case null:break;case"Point":if(e(d,y,z,F,N)===!1)return!1;y++,F++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],y,z,F,N)===!1)return!1;y++,W==="MultiPoint"&&F++}W==="LineString"&&F++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-g;i++){if(e(d[n][i],y,z,F,N)===!1)return!1;y++}W==="MultiLineString"&&F++,W==="Polygon"&&N++}W==="Polygon"&&F++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(N=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-g;o++){if(e(d[n][i][o],y,z,F,N)===!1)return!1;y++}N++}F++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(zb(u.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Db(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return zb(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var Kx=Db;const Xx=Object.freeze(Object.defineProperty({__proto__:null,bbox:Db,default:Kx},Symbol.toStringTag,{value:"Module"})),Jx=Dm(Xx);var Cs=Gx,Rb=Hx,$b=Wx,_c=Jx.default,Yx=$b.featureEach;$b.coordEach;Rb.polygon;var Ng=Rb.featureCollection;function Fb(r){var e=new Cs(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:_c(t),Cs.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:_c(i),n.push(i)}):Yx(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:_c(i),n.push(i)}),Cs.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:_c(t),Cs.prototype.remove.call(this,t,n)},e.clear=function(){return Cs.prototype.clear.call(this)},e.search=function(t){var n=Cs.prototype.search.call(this,this.toBBox(t));return Ng(n)},e.collides=function(t){return Cs.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Cs.prototype.all.call(this);return Ng(t)},e.toJSON=function(){return Cs.prototype.toJSON.call(this)},e.fromJSON=function(t){return Cs.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=_c(t);else if(t.type==="FeatureCollection")n=_c(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Nm.exports=Fb;Nm.exports.default=Fb;var Qx=Nm.exports;const ek=vb(Qx);function tk(r,e){var t={},n=[];if(r.type==="LineString"&&(r=Qo(r)),e.type==="LineString"&&(e=Qo(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=jg(r,e);return i&&n.push(i),fl(n)}var o=ek();return o.load(Og(e)),sd(Og(r),function(u){sd(o.search(u),function(a){var d=jg(u,a);if(d){var p=Ac(d).join(",");t[p]||(t[p]=!0,n.push(d))}})}),fl(n)}function jg(r,e){var t=Ac(r),n=Ac(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],u=t[1][0],a=t[1][1],d=n[0][0],p=n[0][1],g=n[1][0],y=n[1][1],w=(y-p)*(u-i)-(g-d)*(a-o),T=(g-d)*(o-p)-(y-p)*(i-d),L=(u-i)*(o-p)-(a-o)*(i-d);if(w===0)return null;var D=T/w,R=L/w;if(D>=0&&D<=1&&R>=0&&R<=1){var z=i+D*(u-i),I=o+D*(a-o);return fo([z,I])}return null}function nk(r,e,t){t===void 0&&(t={});var n=fo([1/0,1/0],{dist:1/0}),i=0;return $c(r,function(o){for(var u=Ac(o),a=0;a<u.length-1;a++){var d=fo(u[a]);d.properties.dist=Bu(e,d,t);var p=fo(u[a+1]);p.properties.dist=Bu(e,p,t);var g=Bu(d,p,t),y=Math.max(d.properties.dist,p.properties.dist),w=Ab(d,p),T=Bg(e,y,w+90,t),L=Bg(e,y,w-90,t),D=tk(Ko([T.geometry.coordinates,L.geometry.coordinates]),Ko([d.geometry.coordinates,p.geometry.coordinates])),R=null;D.features.length>0&&(R=D.features[0],R.properties.dist=Bu(e,R,t),R.properties.location=i+Bu(d,R,t)),d.properties.dist<n.properties.dist&&(n=d,n.properties.index=a,n.properties.location=i),p.properties.dist<n.properties.dist&&(n=p,n.properties.index=a+1,n.properties.location=i+g),R&&R.properties.dist<n.properties.dist&&(n=R,n.properties.index=a),i+=g}}),n}const rk=30;class ik{constructor(e,t,n,i,o){this.onMouseMove=u=>{if(!this.active)return;const a=[u.point.x-rk,u.point.y],d=this.map.unproject(u.point).distanceTo(this.map.unproject(a));this.inner.onMouseMove(u.lngLat.lng,u.lngLat.lat,d)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=u=>{this.active&&(u.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=u=>{if(!this.active)return;let a=u.target.tagName;a=="INPUT"||a=="TEXTAREA"||u.key=="Escape"&&(u.stopPropagation(),this.cancel())},this.onKeyPress=u=>{if(!this.active)return;let a=u.target.tagName;a=="INPUT"||a=="TEXTAREA"||(u.key=="Enter"?(u.stopPropagation(),this.finish()):u.key=="s"||u.key=="S"?(u.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):u.key=="z"&&u.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new id(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=n,this.snapMode=i,this.undoLength=o,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}const gc=[];function Op(r,e){return{subscribe:Ln(r,e).subscribe}}function Ln(r,e=rt){let t;const n=new Set;function i(a){if(xt(r,a)&&(r=a,t)){const d=!gc.length;for(const p of n)p[1](),gc.push(p,r);if(d){for(let p=0;p<gc.length;p+=2)gc[p][0](gc[p+1]);gc.length=0}}}function o(a){i(a(r))}function u(a,d=rt){const p=[a,d];return n.add(p),n.size===1&&(t=e(i,o)||rt),a(r),()=>{n.delete(p),n.size===0&&t&&(t(),t=null)}}return{set:i,update:o,subscribe:u}}class ok{constructor(){Lr(this,"rootKey","ltn")}get schemaVersionKey(){return`${this.rootKey}/_meta/schema-version`}get storedSchemaVersion(){let e,t=window.localStorage.getItem(this.schemaVersionKey);return t?(e=parseInt(t),Number.isNaN(e)&&(e=0)):e=0,e}ensureMigrated(){if(localStorage.length==0){console.log("localStorage is empty  nothing to migrate."),window.localStorage.setItem(this.schemaVersionKey,2 .toString());return}if(this.storedSchemaVersion==2){console.debug("Schema is already up to date.");return}if(this.storedSchemaVersion<1){console.log(`Migrating storage from version ${this.storedSchemaVersion} to 2`);for(const t of["cnt","global"]){const n=t,i=new Np(n,1,Wf);for(const[o,u]of sk(n))for(const{projectKey:a,projectName:d}of u){let p=window.localStorage.getItem(a);if(!p){console.warn(`Project features not found for ${a}, skipping migration`);continue}let g=JSON.parse(p);g.app_focus=n,g.study_area_name=o,g.project_name=d,console.log(`migrating project ${a}`);let y=i.createProject(g);console.log(`Successfully migrated v0->v1 project ${a} -> ${i.projectKey(y)}`),window.localStorage.removeItem(a)}}}if(this.storedSchemaVersion<2)for(const t of["cnt","global"]){const n=t,i=new Np(n,2,Wf);for(const[o,u]of i.projects()){if(u.db_schema_version>=2){console.log(`skipping previously migrated project: ${o}`);continue}u.db_schema_version=2,i.saveProject(o,u),console.log(`Successfully migrated v1->v2 project: ${i.projectKey(o)}`)}}window.localStorage.setItem(this.schemaVersionKey,2 .toString()),console.debug("Completed migrating database to v2")}projectStorage(e){return this.ensureMigrated(),new Np(e,this.storedSchemaVersion,Wf)}}const Wf=Symbol("internal_method_token");class Np{constructor(e,t,n){Lr(this,"appFocus");Lr(this,"dbSchemaVersion");if(n!==Wf)throw new Error("ProjectStorage must be created via Database.projectStorage()");this.appFocus=e,this.dbSchemaVersion=t}get collectionKey(){return"ltn/projects"}projectKey(e){if(!e)throw new Error("Cannot get project. ProjectID was blank/missing.");return`${this.collectionKey}/${e}`}projectName(e){return this.project(e).project_name}projectNameAlreadyExists(e){for(const[t,n]of this.projects())if(n.project_name==e)return!0;return!1}nextAvailableProjectName(e){if(this.projectNameAlreadyExists(e)){let t=e,n=2;do e=`${t} (${n})`,n++;while(this.projectNameAlreadyExists(e))}return e}nextAvailableNeighbourhoodName(e){let t=this.project(e),n=`${t.project_name} LTN`,i=t.features.filter(a=>{var d;return((d=a.properties)==null?void 0:d.kind)=="boundary"}),o=n,u=1;for(;i.some(a=>{var d;return((d=a.properties)==null?void 0:d.name)==o});)u++,o=`${n} #${u}`;return o}createEmptyProject(e,t){const n={type:"FeatureCollection",features:[],study_area_name:t,project_name:e,app_focus:this.appFocus};return this.createProject(n)}createProject(e){if(this.projectNameAlreadyExists(e.project_name))throw new Error(`Project name already taken: ${e.project_name}`);e.db_schema_version||(e.db_schema_version=this.dbSchemaVersion);let t=crypto.randomUUID();return this.saveProject(t,e),t}studyAreaProjects(){let e=new Map;for(const[t,n]of this.projects()){const i=n.study_area_name;e.has(i)||e.set(i,[]),e.get(i).push({projectID:t,projectName:n.project_name})}for(const[t,n]of e.entries())n.sort((i,o)=>i.projectName.localeCompare(o.projectName));return Array.from(e.entries()).sort((t,n)=>t[0]==null?1:n[0]==null?-1:t[0].localeCompare(n[0]))}projectIDFromKey(e){let t=e.match(/ltn\/projects\/([a-z0-9-]+)/);if(!t)return;let n=t[1];if(n)return n}projects(){return this.globalAndCntProjectKeys().map(e=>{let t=this.projectIDFromKey(e);if(!t)throw new Error(`Cannot get project: no projectID parsed from ${e}`);let n=window.localStorage.getItem(e);if(!n)throw new Error(`Cannot get project: no project found for ${e}`);let i=JSON.parse(n);return i.app_focus!=this.appFocus?null:[t,i]}).filter(e=>e!==null)}globalAndCntProjectKeys(){const e=this.collectionKey;let t=[];for(let n=0;n<localStorage.length;n++){const i=localStorage.key(n);i&&i.startsWith(e)&&t.push(i)}return t}saveProject(e,t){let n=this.projectKey(e);t.study_area_name||delete t.study_area_name,window.localStorage.setItem(n,JSON.stringify(t))}removeProject(e){let t=this.projectKey(e);window.localStorage.removeItem(t)}renameProject(e,t){let n=this.project(e);if(!n)throw new Error(`Cannot rename project: no existing project found for ${e}`);if(n.project_name==t){console.debug("Ignoring rename, since it's the same name.");return}if(this.projectNameAlreadyExists(t))throw new Error(`Project name ${t} already taken. Choose a different name.`);n.project_name=t,this.saveProject(e,n)}project(e){let t=this.projectKey(e),n=window.localStorage.getItem(t);if(!n)throw new Error(`Cannot get project: no project found for ${e}`);let i=JSON.parse(n);return console.assert(i.study_area_name||i.app_focus!="cnt","missing study area name for cnt project"),console.assert(i.project_name,"missing project name"),i}}function sk(r){let e=new Map,t=[];for(let i=0;i<window.localStorage.length;i++){let o=window.localStorage.key(i);if(o.startsWith("ltn_cnt/")){if(r!="cnt")continue;try{let[u,a,d]=o.split("/");e.has(a)||e.set(a,[]),e.get(a).push({projectKey:o,projectName:d})}catch(u){console.log(`error loading cnt project: ${o}`,u)}}else if(o.startsWith("ltn_")){if(r!="global")continue;let u=o.split("ltn_"),a=u[u.length-1],d="";try{d=JSON.parse(window.localStorage.getItem(o)).study_area_name}catch(p){console.log(`error loading global project: ${o}`,p)}d&&d.length>0?(e.has(d)||e.set(d,[]),e.get(d).push({projectKey:o,projectName:a})):t.push({projectKey:o,projectName:a})}}let n=[...e.entries()];return n.sort((i,o)=>i[0].localeCompare(o[0])),t.length>0&&n.push([void 0,t]),n}const Bb="MZEJTanw3WpxRvt7qDfo";let Do=Ln(null),Ro=Ln("global"),dl=Ln(void 0),jm=new ok,Xs=Ln(jm.projectStorage(pi(Ro)));Ro.subscribe(r=>{Xs.set(jm.projectStorage(r))});let rh=Ln(!1),Ir=Ln(null),ih=Ln(new Hs.LngLat(0,0)),oh=Ln(new Hs.LngLat(0,0)),Nf=Ln(new Hs.LngLat(0,0)),Ug=Ln(1),io=Ln(1),an=Ln({mode:"title",firstLoad:!0}),ad=Ln(!1),nm=Ln("streets-v2"),rm=Ln("walk_cycle_only"),Vg=Ln(!1),ld=Ln(!0),cd=Ln("shortcuts"),im=Ln(!1),om=Ln(!0),qg=Ln(500);function dh(){const r=pi(dl);try{pi(Xs).saveProject(r,pi(Ir).toSavefile())}catch(e){window.alert(`Autosave failed: ${e}`)}}let sm=Ln(!1);function Ao(r){return pi(sm)?`/${r}`:`https://assets.od2net.org/${r}`}function $o(){var e;an.set({mode:"title",firstLoad:!1});let r=[-180,-90,180,90];pi(Ro)=="cnt"&&(r=[-8.943,54.631,-.901,59.489]),(e=pi(Do))==null||e.fitBounds(r,{duration:500})}function am(r){var n;function e(i){const o=i.getEast()-i.getWest();let u=i.getWest()+Math.random()*o;const a=i.getNorth()-i.getSouth();let d=i.getSouth()+Math.random()*a;return new Hs.LngLat(u,d)}const t=(n=pi(Do))==null?void 0:n.getBounds();if(!t){console.assert(!1,"missing map bounds");return}t.contains(pi(r))||r.set(e(t))}function ak(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L,D,R;return{c(){e=U("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",t=oe(),n=U("p"),n.innerHTML=`This is an <b>experimental</b>
    version of the
    <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>
    . Most parts of it do not work yet, and you should probably use the other version
    of the tool instead.`,i=oe(),o=U("p"),o.textContent="To use this tool, you need to:",u=oe(),a=U("ol"),a.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, fix the basemap data on existing modal filters, turn
      restrictions, one-ways, etc</li> <li>Create one or more proposals with new modal filters, and explore their
      effects</li>`,d=oe(),p=U("p"),p.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
    and relies heavily on
    <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
    data.`,g=oe(),y=U("p"),y.textContent="Some road signs images  Crown copyright.",w=oe(),T=U("center"),L=U("button"),L.textContent="Start!"},m(z,I){q(z,e,I),q(z,t,I),q(z,n,I),q(z,i,I),q(z,o,I),q(z,u,I),q(z,a,I),q(z,d,I),q(z,p,I),q(z,g,I),q(z,y,I),q(z,w,I),q(z,T,I),$(T,L),D||(R=yt(L,"click",r[1]),D=!0)},p:rt,d(z){z&&(V(e),V(t),V(n),V(i),V(o),V(u),V(a),V(d),V(p),V(g),V(y),V(w),V(T)),D=!1,R()}}}function lk(r){let e,t,n;function i(u){r[2](u)}let o={$$slots:{default:[ak]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.show=r[0]),e=new _d({props:o}),un.push(()=>Cn(e,"show",i)),{c(){de(e.$$.fragment)},m(u,a){he(e,u,a),n=!0},p(u,[a]){const d={};a&9&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.show=u[0],Sn(()=>t=!1)),e.$set(d)},i(u){n||(j(e.$$.fragment,u),n=!0)},o(u){G(e.$$.fragment,u),n=!1},d(u){fe(e,u)}}}function ck(r,e,t){let n;st(r,rh,u=>t(0,n=u));const i=()=>Ot(rh,n=!1,n);function o(u){n=u,rh.set(n)}return[n,i,o]}class uk extends It{constructor(e){super(),Et(this,e,ck,lk,xt,{})}}/**
 * @license lucide-svelte v0.475.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const hk={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},Zg=hk;function Gg(r,e,t){const n=r.slice();return n[11]=e[t][0],n[12]=e[t][1],n}function jp(r){let e,t=[r[12]],n={};for(let i=0;i<t.length;i+=1)n=Gt(n,t[i]);return{c(){e=hs(r[11]),rd(e,n)},m(i,o){q(i,e,o)},p(i,o){rd(e,n=Zn(t,[o&32&&i[12]]))},d(i){i&&V(e)}}}function Hg(r){let e=r[11],t,n=r[11]&&jp(r);return{c(){n&&n.c(),t=Jn()},m(i,o){n&&n.m(i,o),q(i,t,o)},p(i,o){i[11]?e?xt(e,i[11])?(n.d(1),n=jp(i),e=i[11],n.c(),n.m(t.parentNode,t)):n.p(i,o):(n=jp(i),e=i[11],n.c(),n.m(t.parentNode,t)):e&&(n.d(1),n=null,e=i[11])},d(i){i&&V(t),n&&n.d(i)}}}function fk(r){let e,t,n,i,o,u=$n(r[5]),a=[];for(let w=0;w<u.length;w+=1)a[w]=Hg(Gg(r,u,w));const d=r[10].default,p=En(d,r,r[9],null);let g=[Zg,r[7],{width:r[2]},{height:r[2]},{stroke:r[1]},{"stroke-width":n=r[4]?Number(r[3])*24/Number(r[2]):r[3]},{class:i=r[6]("lucide-icon","lucide",r[0]?`lucide-${r[0]}`:"",r[8].class)}],y={};for(let w=0;w<g.length;w+=1)y=Gt(y,g[w]);return{c(){e=hs("svg");for(let w=0;w<a.length;w+=1)a[w].c();t=Jn(),p&&p.c(),rd(e,y)},m(w,T){q(w,e,T);for(let L=0;L<a.length;L+=1)a[L]&&a[L].m(e,null);$(e,t),p&&p.m(e,null),o=!0},p(w,[T]){if(T&32){u=$n(w[5]);let L;for(L=0;L<u.length;L+=1){const D=Gg(w,u,L);a[L]?a[L].p(D,T):(a[L]=Hg(D),a[L].c(),a[L].m(e,t))}for(;L<a.length;L+=1)a[L].d(1);a.length=u.length}p&&p.p&&(!o||T&512)&&An(p,d,w,w[9],o?In(d,w[9],T,null):Pn(w[9]),null),rd(e,y=Zn(g,[Zg,T&128&&w[7],(!o||T&4)&&{width:w[2]},(!o||T&4)&&{height:w[2]},(!o||T&2)&&{stroke:w[1]},(!o||T&28&&n!==(n=w[4]?Number(w[3])*24/Number(w[2]):w[3]))&&{"stroke-width":n},(!o||T&257&&i!==(i=w[6]("lucide-icon","lucide",w[0]?`lucide-${w[0]}`:"",w[8].class)))&&{class:i}]))},i(w){o||(j(p,w),o=!0)},o(w){G(p,w),o=!1},d(w){w&&V(e),mi(a,w),p&&p.d(w)}}}function dk(r,e,t){const n=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"];let i=Pg(e,n),{$$slots:o={},$$scope:u}=e,{name:a=void 0}=e,{color:d="currentColor"}=e,{size:p=24}=e,{strokeWidth:g=2}=e,{absoluteStrokeWidth:y=!1}=e,{iconNode:w=[]}=e;const T=(...L)=>L.filter((D,R,z)=>!!D&&z.indexOf(D)===R).join(" ");return r.$$set=L=>{t(8,e=Gt(Gt({},e),mo(L))),t(7,i=Pg(e,n)),"name"in L&&t(0,a=L.name),"color"in L&&t(1,d=L.color),"size"in L&&t(2,p=L.size),"strokeWidth"in L&&t(3,g=L.strokeWidth),"absoluteStrokeWidth"in L&&t(4,y=L.absoluteStrokeWidth),"iconNode"in L&&t(5,w=L.iconNode),"$$scope"in L&&t(9,u=L.$$scope)},e=mo(e),[a,d,p,g,y,w,T,i,e,u,o]}class pk extends It{constructor(e){super(),Et(this,e,dk,fk,xt,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5})}}const Fc=pk;function mk(r){let e;const t=r[2].default,n=En(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&An(n,t,i,i[3],e?In(t,i[3],o,null):Pn(i[3]),null)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function _k(r){let e,t;const n=[{name:"circle-help"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[mk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new Fc({props:i}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,[u]){const a=u&3?Zn(n,[n[0],u&2&&Rc(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function gk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return r.$$set=u=>{t(1,e=Gt(Gt({},e),mo(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=mo(e),[o,e,n,i]}class yk extends It{constructor(e){super(),Et(this,e,gk,_k,xt,{})}}const bk=yk;function vk(r){let e;const t=r[2].default,n=En(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&An(n,t,i,i[3],e?In(t,i[3],o,null):Pn(i[3]),null)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function wk(r){let e,t;const n=[{name:"circle-plus"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[vk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new Fc({props:i}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,[u]){const a=u&3?Zn(n,[n[0],u&2&&Rc(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function xk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M8 12h8"}],["path",{d:"M12 8v8"}]];return r.$$set=u=>{t(1,e=Gt(Gt({},e),mo(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=mo(e),[o,e,n,i]}class kk extends It{constructor(e){super(),Et(this,e,xk,wk,xt,{})}}const Sk=kk;function Ck(r){let e;const t=r[2].default,n=En(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&An(n,t,i,i[3],e?In(t,i[3],o,null):Pn(i[3]),null)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function Tk(r){let e,t;const n=[{name:"file-down"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Ck]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new Fc({props:i}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,[u]){const a=u&3?Zn(n,[n[0],u&2&&Rc(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function Mk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}],["path",{d:"M12 18v-6"}],["path",{d:"m9 15 3 3 3-3"}]];return r.$$set=u=>{t(1,e=Gt(Gt({},e),mo(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=mo(e),[o,e,n,i]}class Lk extends It{constructor(e){super(),Et(this,e,Mk,Tk,xt,{})}}const Ob=Lk;function Ek(r){let e;const t=r[2].default,n=En(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&An(n,t,i,i[3],e?In(t,i[3],o,null):Pn(i[3]),null)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function Ik(r){let e,t;const n=[{name:"layers"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Ek]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new Fc({props:i}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,[u]){const a=u&3?Zn(n,[n[0],u&2&&Rc(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function Ak(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17"}]];return r.$$set=u=>{t(1,e=Gt(Gt({},e),mo(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=mo(e),[o,e,n,i]}class Pk extends It{constructor(e){super(),Et(this,e,Ak,Ik,xt,{})}}const zk=Pk;function Dk(r){let e;const t=r[2].default,n=En(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&An(n,t,i,i[3],e?In(t,i[3],o,null):Pn(i[3]),null)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function Rk(r){let e,t;const n=[{name:"pencil"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Dk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new Fc({props:i}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,[u]){const a=u&3?Zn(n,[n[0],u&2&&Rc(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function $k(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return r.$$set=u=>{t(1,e=Gt(Gt({},e),mo(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=mo(e),[o,e,n,i]}class Fk extends It{constructor(e){super(),Et(this,e,$k,Rk,xt,{})}}const Nb=Fk;function Bk(r){let e;const t=r[2].default,n=En(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&An(n,t,i,i[3],e?In(t,i[3],o,null):Pn(i[3]),null)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function Ok(r){let e,t;const n=[{name:"trash-2"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Bk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new Fc({props:i}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,[u]){const a=u&3?Zn(n,[n[0],u&2&&Rc(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function Nk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]];return r.$$set=u=>{t(1,e=Gt(Gt({},e),mo(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=mo(e),[o,e,n,i]}class jk extends It{constructor(e){super(),Et(this,e,Nk,Ok,xt,{})}}const Um=jk;let Uk=Date.now();function ml(r){return`${r}-${Uk++}`}const Vm=Symbol.for("svelte-maplibre");function Ia(){return xh(Vm)}function Vk(r){let e=new WeakMap;return t=>{var u;let n=e.get(t.originalEvent);if(n!==void 0)return n;let o=(u=t.target.queryRenderedFeatures(t.point).find(a=>{var d;return(d=r.get(a.layer.id))==null?void 0:d.interactive}))==null?void 0:u.layer.id;return e.set(t.originalEvent,o),o}}function qk(){let r=new Map;return md(Vm,{map:Ln(null),source:Op(null),layer:Op(null),popupTarget:Op(null),cluster:Ln(),loadedImages:Ln(new Set),minzoom:Ln(0),maxzoom:Ln(24),layerEvent:Ln(null),layerInfo:r,eventTopMost:Vk(r),markerClickManager:new Hk})}function Wg(r){return{subscribe:r.subscribe}}function qm({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let i=Ia(),o=Ln(null),u=Wg(o),a={...i,[r]:Wg(o)};if(e&&(a.popupTarget=u),n){let d=Ln(null);a.layerEvent=d,i.layerEvent=d}return t&&(a.cluster=Ln()),md(Vm,a),{...i,self:o}}function jb(){return qm({key:"source",setCluster:!0})}function Ub(r=!0){return qm({key:"layer",setPopupTarget:r,setMouseEvent:r})}function Zk(){return qm({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}function Gk(r){return"layerType"in r&&r.layerType==="deckgl"}class Hk{constructor(){Lr(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}function Kg(r){let e;return t=>{if(t)for(let n in t){let i=e==null?void 0:e[n],o=t[n];i!==o&&r(n,o,i)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function Wk(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function Kk(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Wn(r,e){return["case",["boolean",["feature-state","hover"],!1],e,r]}var Sa=Xk;function Xk(r){var e,t,n;if(r){if(Array.isArray(r)){for(e=[],t=r.length,n=0;n<t;n++){var i=r[n];i!=null&&e.push(i)}return e}if(typeof r=="object"){e={};var o=Object.keys(r);for(t=o.length,n=0;n<t;n++){var u=o[n],a=r[u];a!=null&&(e[u]=a)}return e}}}function Xg(r){let e=r[0],t,n,i=Jg(r);return{c(){i.c(),t=Jn()},m(o,u){i.m(o,u),q(o,t,u),n=!0},p(o,u){u[0]&1&&xt(e,e=o[0])?(tn(),G(i,1,1,rt),nn(),i=Jg(o),i.c(),j(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(j(i),n=!0)},o(o){G(i),n=!1},d(o){o&&V(t),i.d(o)}}}function Jg(r){let e;const t=r[36].default,n=En(t,r,r[35],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[1]&16)&&An(n,t,i,i[35],e?In(t,i[35],o,null):Pn(i[35]),null)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function Jk(r){let e,t,n=r[0]&&Xg(r);return{c(){n&&n.c(),e=Jn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o[0]&1&&j(n,1)):(n=Xg(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),G(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){G(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function Yk(r,e,t){let n,i,o,u,a,d,p,g,y,w,T,L,{$$slots:D={},$$scope:R}=e,{id:z=ml("layer")}=e,{source:I=void 0}=e,{sourceLayer:F=void 0}=e,{beforeId:N=void 0}=e,{beforeLayerType:W=void 0}=e,{type:se}=e,{paint:J=void 0}=e,{layout:Y=void 0}=e,{filter:_e=void 0}=e,{applyToClusters:ze=void 0}=e,{minzoom:ee=void 0}=e,{maxzoom:ae=void 0}=e,{manageHoverState:Ee=!1}=e,{hovered:we=null}=e,{interactive:it=!0}=e,{hoverCursor:Ge=void 0}=e,{eventsIfTopMost:Ie=!1}=e;const De=ds(),{map:Ct,source:nt,self:lt,minzoom:mt,maxzoom:ht,eventTopMost:We,layerInfo:Bt}=Ub();st(r,Ct,qe=>t(31,y=qe)),st(r,nt,qe=>t(32,w=qe)),st(r,lt,qe=>t(0,g=qe)),st(r,mt,qe=>t(34,L=qe)),st(r,ht,qe=>t(33,T=qe)),ti(()=>{g&&y&&(Bt.delete(g),y==null||y.removeLayer(g))});let Lt;function Nt(qe){var ye,zn;if(!it||!g||!y||Ie&&We(qe)!==g)return;let Ve=qe.features??[],kt=(zn=(ye=Ve[0])==null?void 0:ye.properties)==null?void 0:zn.cluster_id,Ut={event:qe,map:y,clusterId:kt,layer:g,source:a,features:Ve};De(qe.type,Ut)}function Mt(qe){var ye,zn;if(!it||!g||!y||Ie&&We(qe)!==g)return;Ge&&(y.getCanvas().style.cursor=Ge);let Ve=qe.features??[];t(6,we=Ve[0]??null);let kt=(zn=(ye=Ve[0])==null?void 0:ye.properties)==null?void 0:zn.cluster_id;De("mouseenter",{event:qe,map:y,clusterId:kt,layer:g,source:a,features:Ve})}function Qt(qe){var ye,zn,Oe;if(!it||!y)return;if(Ie&&We(qe)!==g){t(6,we=null),Ee&&Lt!==void 0&&(y==null||y.setFeatureState({source:a,sourceLayer:F,id:Lt},{hover:!1}),Lt=void 0);return}y.getCanvas().style.cursor=Ge;let Ve=qe.features??[],kt=(zn=(ye=Ve[0])==null?void 0:ye.properties)==null?void 0:zn.cluster_id,Ut=(Oe=Ve[0])==null?void 0:Oe.id;Ut!==Lt&&(Ee&&(Lt!==void 0&&(y==null||y.setFeatureState({source:a,id:Lt,sourceLayer:F},{hover:!1})),y==null||y.setFeatureState({source:a,id:Ut,sourceLayer:F},{hover:!0})),Lt=Ut,t(6,we=Ve[0]??null)),De("mousemove",{event:qe,map:y,clusterId:kt,layer:g,source:a,features:Ve})}function bt(qe){if(!(!it||!g||!y)){if(Ge&&(y.getCanvas().style.cursor=""),t(6,we=null),Ee&&Lt!==void 0){const Ve={source:a,id:Lt,sourceLayer:F};y==null||y.setFeatureState(Ve,{hover:!1}),Lt=void 0}De("mouseleave",{map:y,layer:g,source:a})}}let Dt=!0;function pn(qe){y&&(y.off("click",qe,Nt),y.off("dblclick",qe,Nt),y.off("contextmenu",qe,Nt),y.off("mouseenter",qe,Mt),y.off("mousemove",qe,Qt),y.off("mouseleave",qe,bt))}return ti(()=>{y&&g&&pn(g)}),r.$$set=qe=>{"id"in qe&&t(7,z=qe.id),"source"in qe&&t(8,I=qe.source),"sourceLayer"in qe&&t(9,F=qe.sourceLayer),"beforeId"in qe&&t(10,N=qe.beforeId),"beforeLayerType"in qe&&t(11,W=qe.beforeLayerType),"type"in qe&&t(12,se=qe.type),"paint"in qe&&t(13,J=qe.paint),"layout"in qe&&t(14,Y=qe.layout),"filter"in qe&&t(15,_e=qe.filter),"applyToClusters"in qe&&t(16,ze=qe.applyToClusters),"minzoom"in qe&&t(17,ee=qe.minzoom),"maxzoom"in qe&&t(18,ae=qe.maxzoom),"manageHoverState"in qe&&t(19,Ee=qe.manageHoverState),"hovered"in qe&&t(6,we=qe.hovered),"interactive"in qe&&t(20,it=qe.interactive),"hoverCursor"in qe&&t(21,Ge=qe.hoverCursor),"eventsIfTopMost"in qe&&t(22,Ie=qe.eventsIfTopMost),"$$scope"in qe&&t(35,R=qe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=Kk(ze)),r.$$.dirty[0]&1073774592&&t(24,i=Wk("all",n,_e)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,o=ee??L),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,u=ae??T),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,a=I||w),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&y&&g!==z&&a){g&&(pn(g),Bt.delete(g));let qe=N;if(!N&&W){let Ve=y.getStyle().layers,kt=typeof W=="function"?W:ye=>ye.type===W,Ut=Ve==null?void 0:Ve.find(kt);Ut&&(qe=Ut.id)}Ot(lt,g=z,g),y.addLayer(Sa({id:g,type:se,source:a,"source-layer":F,filter:i,paint:J,layout:Y,minzoom:o,maxzoom:u}),qe),t(23,Dt=!0),y.on("click",g,Nt),y.on("dblclick",g,Nt),y.on("contextmenu",g,Nt),y.on("mouseenter",g,Mt),y.on("mousemove",g,Qt),y.on("mouseleave",g,bt)}r.$$.dirty[0]&1048577&&g&&Bt.set(g,{interactive:it}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,d=g?Kg((qe,Ve)=>{y!=null&&y.style._loaded?y.setPaintProperty(g,qe,Ve):y==null||y.once("styledata",()=>y==null?void 0:y.setPaintProperty(g,qe,Ve))}):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,p=g?Kg((qe,Ve)=>{y!=null&&y.style._loaded?y.setLayoutProperty(g,qe,Ve):y==null||y.once("styledata",()=>y==null?void 0:y.setLayoutProperty(g,qe,Ve))}):void 0),r.$$.dirty[0]&268443648&&(d==null||d(J)),r.$$.dirty[0]&134234112&&(p==null||p(Y)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&g&&(y==null||y.setLayerZoomRange(g,o,u)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&g&&(Dt?t(23,Dt=!1):y==null||y.setFilter(g,i))},[g,Ct,nt,lt,mt,ht,we,z,I,F,N,W,se,J,Y,_e,ze,ee,ae,Ee,it,Ge,Ie,Dt,i,u,o,p,d,a,n,y,w,T,L,R,D]}let bd=class extends It{constructor(e){super(),Et(this,e,Yk,Jk,xt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function Qk(r){let e;const t=r[16].default,n=En(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&An(n,t,i,i[24],e?In(t,i[24],o,null):Pn(i[24]),null)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function e3(r){let e,t,n;function i(u){r[17](u)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[Qk]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new bd({props:o}),un.push(()=>Cn(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){de(e.$$.fragment)},m(u,a){he(e,u,a),n=!0},p(u,[a]){const d={};a&2&&(d.id=u[1]),a&4&&(d.source=u[2]),a&8&&(d.sourceLayer=u[3]),a&16&&(d.beforeId=u[4]),a&32&&(d.beforeLayerType=u[5]),a&64&&(d.paint=u[6]),a&128&&(d.layout=u[7]),a&256&&(d.filter=u[8]),a&512&&(d.applyToClusters=u[9]),a&1024&&(d.minzoom=u[10]),a&2048&&(d.maxzoom=u[11]),a&4096&&(d.hoverCursor=u[12]),a&8192&&(d.manageHoverState=u[13]),a&16384&&(d.eventsIfTopMost=u[14]),a&32768&&(d.interactive=u[15]),a&16777216&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.hovered=u[0],Sn(()=>t=!1)),e.$set(d)},i(u){n||(j(e.$$.fragment,u),n=!0)},o(u){G(e.$$.fragment,u),n=!1},d(u){fe(e,u)}}}function t3(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=ml("circle")}=e,{source:u=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:y=void 0}=e,{filter:w=void 0}=e,{applyToClusters:T=void 0}=e,{minzoom:L=void 0}=e,{maxzoom:D=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:z=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:F=!1}=e,{interactive:N=!0}=e;function W(ae){I=ae,t(0,I)}function se(ae){Mn.call(this,r,ae)}function J(ae){Mn.call(this,r,ae)}function Y(ae){Mn.call(this,r,ae)}function _e(ae){Mn.call(this,r,ae)}function ze(ae){Mn.call(this,r,ae)}function ee(ae){Mn.call(this,r,ae)}return r.$$set=ae=>{"id"in ae&&t(1,o=ae.id),"source"in ae&&t(2,u=ae.source),"sourceLayer"in ae&&t(3,a=ae.sourceLayer),"beforeId"in ae&&t(4,d=ae.beforeId),"beforeLayerType"in ae&&t(5,p=ae.beforeLayerType),"paint"in ae&&t(6,g=ae.paint),"layout"in ae&&t(7,y=ae.layout),"filter"in ae&&t(8,w=ae.filter),"applyToClusters"in ae&&t(9,T=ae.applyToClusters),"minzoom"in ae&&t(10,L=ae.minzoom),"maxzoom"in ae&&t(11,D=ae.maxzoom),"hoverCursor"in ae&&t(12,R=ae.hoverCursor),"manageHoverState"in ae&&t(13,z=ae.manageHoverState),"hovered"in ae&&t(0,I=ae.hovered),"eventsIfTopMost"in ae&&t(14,F=ae.eventsIfTopMost),"interactive"in ae&&t(15,N=ae.interactive),"$$scope"in ae&&t(24,i=ae.$$scope)},[I,o,u,a,d,p,g,y,w,T,L,D,R,z,F,N,n,W,se,J,Y,_e,ze,ee,i]}let _l=class extends It{constructor(e){super(),Et(this,e,t3,e3,xt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function n3(r){let e,t;const n=r[7].default,i=En(n,r,r[6],null);return{c(){e=U("div"),i&&i.c(),ue(e,"class",r[1]),Yt(e,"maplibregl-ctrl",r[0])},m(o,u){q(o,e,u),i&&i.m(e,null),r[8](e),t=!0},p(o,[u]){i&&i.p&&(!t||u&64)&&An(i,n,o,o[6],t?In(n,o[6],u,null):Pn(o[6]),null),(!t||u&2)&&ue(e,"class",o[1]),(!t||u&3)&&Yt(e,"maplibregl-ctrl",o[0])},i(o){t||(j(i,o),t=!0)},o(o){G(i,o),t=!1},d(o){o&&V(e),i&&i.d(o),r[8](null)}}}function r3(r,e,t){let n,{$$slots:i={},$$scope:o}=e,{defaultStyling:u=!0}=e,{position:a="top-right"}=e,{class:d=void 0}=e;const{map:p}=Ia();st(r,p,T=>t(5,n=T));let g,y={onAdd(){return g},onRemove(){var T;(T=g==null?void 0:g.parentNode)==null||T.removeChild(g)}};ti(()=>{n==null||n.removeControl(y)});function w(T){un[T?"unshift":"push"](()=>{g=T,t(2,g)})}return r.$$set=T=>{"defaultStyling"in T&&t(0,u=T.defaultStyling),"position"in T&&t(4,a=T.position),"class"in T&&t(1,d=T.class),"$$scope"in T&&t(6,o=T.$$scope)},r.$$.update=()=>{r.$$.dirty&52&&n&&g&&n.addControl(y,a)},[u,d,g,p,a,n,o,i,w]}class i3 extends It{constructor(e){super(),Et(this,e,r3,n3,xt,{defaultStyling:0,position:4,class:1})}}function o3(r){let e;const t=r[15].default,n=En(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&An(n,t,i,i[23],e?In(t,i[23],o,null):Pn(i[23]),null)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function s3(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[o3]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new bd({props:o}),un.push(()=>Cn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){de(e.$$.fragment)},m(u,a){he(e,u,a),n=!0},p(u,[a]){const d={};a&2&&(d.id=u[1]),a&4&&(d.source=u[2]),a&8&&(d.sourceLayer=u[3]),a&16&&(d.beforeId=u[4]),a&32&&(d.beforeLayerType=u[5]),a&64&&(d.paint=u[6]),a&128&&(d.layout=u[7]),a&256&&(d.filter=u[8]),a&512&&(d.minzoom=u[9]),a&1024&&(d.maxzoom=u[10]),a&2048&&(d.hoverCursor=u[11]),a&4096&&(d.manageHoverState=u[12]),a&8192&&(d.eventsIfTopMost=u[13]),a&16384&&(d.interactive=u[14]),a&8388608&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.hovered=u[0],Sn(()=>t=!1)),e.$set(d)},i(u){n||(j(e.$$.fragment,u),n=!0)},o(u){G(e.$$.fragment,u),n=!1},d(u){fe(e,u)}}}function a3(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=ml("fill")}=e,{source:u=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:y=void 0}=e,{filter:w=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:L=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:R=!1}=e,{hovered:z=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:F=!0}=e;function N(ee){z=ee,t(0,z)}function W(ee){Mn.call(this,r,ee)}function se(ee){Mn.call(this,r,ee)}function J(ee){Mn.call(this,r,ee)}function Y(ee){Mn.call(this,r,ee)}function _e(ee){Mn.call(this,r,ee)}function ze(ee){Mn.call(this,r,ee)}return r.$$set=ee=>{"id"in ee&&t(1,o=ee.id),"source"in ee&&t(2,u=ee.source),"sourceLayer"in ee&&t(3,a=ee.sourceLayer),"beforeId"in ee&&t(4,d=ee.beforeId),"beforeLayerType"in ee&&t(5,p=ee.beforeLayerType),"paint"in ee&&t(6,g=ee.paint),"layout"in ee&&t(7,y=ee.layout),"filter"in ee&&t(8,w=ee.filter),"minzoom"in ee&&t(9,T=ee.minzoom),"maxzoom"in ee&&t(10,L=ee.maxzoom),"hoverCursor"in ee&&t(11,D=ee.hoverCursor),"manageHoverState"in ee&&t(12,R=ee.manageHoverState),"hovered"in ee&&t(0,z=ee.hovered),"eventsIfTopMost"in ee&&t(13,I=ee.eventsIfTopMost),"interactive"in ee&&t(14,F=ee.interactive),"$$scope"in ee&&t(23,i=ee.$$scope)},[z,o,u,a,d,p,g,y,w,T,L,D,R,I,F,n,N,W,se,J,Y,_e,ze,i]}let Pi=class extends It{constructor(e){super(),Et(this,e,a3,s3,xt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function l3(r,e,t){let n;const{map:i}=Ia();st(r,i,d=>t(4,n=d));let{position:o="top-left"}=e,{container:u=void 0}=e,a=null;return ti(()=>{n!=null&&n.loaded()&&a&&n.removeControl(a)}),r.$$set=d=>{"position"in d&&t(1,o=d.position),"container"in d&&t(2,u=d.container)},r.$$.update=()=>{if(r.$$.dirty&30&&n&&!a){let d;typeof u=="string"?d=document.querySelector(u)??void 0:d=u,t(3,a=new ei.FullscreenControl({container:d})),n.addControl(a,o)}},[i,o,u,a,n]}class c3 extends It{constructor(e){super(),Et(this,e,l3,null,xt,{position:1,container:2})}}function Vb(r,e,t,n,i){let o=!1;r.getSource(e)&&(o=!0,r.removeSource(e));const u=()=>{n(e)&&(r.addSource(e,t),i())};if(o){const a=()=>{e&&(r.getSource(e)?setTimeout(a,1):u())};a()}else u()}function qb(r,e,t){gb().then(()=>{let n=pi(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function Yg(r){let e=r[0],t,n,i=Qg(r);return{c(){i.c(),t=Jn()},m(o,u){i.m(o,u),q(o,t,u),n=!0},p(o,u){u&1&&xt(e,e=o[0])?(tn(),G(i,1,1,rt),nn(),i=Qg(o),i.c(),j(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(j(i),n=!0)},o(o){G(i),n=!1},d(o){o&&V(t),i.d(o)}}}function Qg(r){let e;const t=r[19].default,n=En(t,r,r[18],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&262144)&&An(n,t,i,i[18],e?In(t,i[18],o,null):Pn(i[18]),null)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function u3(r){let e,t,n=r[0]&&Yg(r);return{c(){n&&n.c(),e=Jn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&j(n,1)):(n=Yg(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),G(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){G(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function h3(r,e,t){let n,i,o,{$$slots:u={},$$scope:a}=e,{id:d=ml("geojson")}=e,{data:p}=e,{generateId:g=!1}=e,{promoteId:y=void 0}=e,{filter:w=void 0}=e,{lineMetrics:T=void 0}=e,{cluster:L=void 0}=e,{maxzoom:D=void 0}=e,{attribution:R=void 0}=e,{buffer:z=void 0}=e,{tolerance:I=void 0}=e;const{map:F,cluster:N,self:W}=jb();st(r,F,Y=>t(17,i=Y)),st(r,N,Y=>t(20,o=Y)),st(r,W,Y=>t(0,n=Y));let se,J=!0;return ti(()=>{n&&se&&i&&(qb(F,n,se),Ot(W,n=null,n),t(15,se=void 0))}),r.$$set=Y=>{"id"in Y&&t(4,d=Y.id),"data"in Y&&t(5,p=Y.data),"generateId"in Y&&t(6,g=Y.generateId),"promoteId"in Y&&t(7,y=Y.promoteId),"filter"in Y&&t(8,w=Y.filter),"lineMetrics"in Y&&t(9,T=Y.lineMetrics),"cluster"in Y&&t(10,L=Y.cluster),"maxzoom"in Y&&t(11,D=Y.maxzoom),"attribution"in Y&&t(12,R=Y.attribution),"buffer"in Y&&t(13,z=Y.buffer),"tolerance"in Y&&t(14,I=Y.tolerance),"$$scope"in Y&&t(18,a=Y.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&Ot(N,o=L,o),r.$$.dirty&196593&&i&&n!==d&&(Ot(W,n=d,n),Vb(i,n,Sa({type:"geojson",data:p,filter:w,lineMetrics:T,generateId:g,promoteId:y,cluster:!!L,clusterMinPoints:L==null?void 0:L.minPoints,clusterMaxZoom:L==null?void 0:L.maxZoom,clusterRadius:L==null?void 0:L.radius,clusterProperties:L==null?void 0:L.properties,maxzoom:D,attribution:R,buffer:z,tolerance:I}),Y=>i&&Y===n,()=>{n&&(t(15,se=i==null?void 0:i.getSource(n)),t(16,J=!0))})),r.$$.dirty&131088&&(i==null||i.on("style.load",()=>{t(15,se=i==null?void 0:i.getSource(d))})),r.$$.dirty&98336&&se&&(J?t(16,J=!1):se.setData(p)),r.$$.dirty&33792&&(se==null||se.setClusterOptions(Sa({cluster:!!L,clusterMaxZoom:L==null?void 0:L.maxZoom,clusterRadius:L==null?void 0:L.radius})))},[n,F,N,W,d,p,g,y,w,T,L,D,R,z,I,se,J,i,a,u]}let dr=class extends It{constructor(e){super(),Et(this,e,h3,u3,xt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}};function f3(r,e,t){let n;const{map:i}=Ia();st(r,i,w=>t(8,n=w));let{position:o="top-left"}=e,{positionOptions:u=void 0}=e,{fitBoundsOptions:a=void 0}=e,{trackUserLocation:d=!1}=e,{showAccuracyCircle:p=!0}=e,{showUserLocation:g=!0}=e,{control:y=null}=e;return ti(()=>{n!=null&&n.loaded()&&y&&n.removeControl(y)}),r.$$set=w=>{"position"in w&&t(2,o=w.position),"positionOptions"in w&&t(3,u=w.positionOptions),"fitBoundsOptions"in w&&t(4,a=w.fitBoundsOptions),"trackUserLocation"in w&&t(5,d=w.trackUserLocation),"showAccuracyCircle"in w&&t(6,p=w.showAccuracyCircle),"showUserLocation"in w&&t(7,g=w.showUserLocation),"control"in w&&t(1,y=w.control)},r.$$.update=()=>{r.$$.dirty&510&&n&&!y&&(t(1,y=new ei.GeolocateControl({positionOptions:u,fitBoundsOptions:a,trackUserLocation:d,showAccuracyCircle:p,showUserLocation:g})),n.addControl(y,o))},[i,y,o,u,a,d,p,g,n]}class d3 extends It{constructor(e){super(),Et(this,e,f3,null,xt,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function p3(r,e,t){let n,i,{data:o}=e,{idCol:u}=e,{sourceLayer:a=void 0}=e,d=new Set;const{map:p,source:g}=Ub();return st(r,p,y=>t(6,n=y)),st(r,g,y=>t(7,i=y)),r.$$set=y=>{"data"in y&&t(2,o=y.data),"idCol"in y&&t(3,u=y.idCol),"sourceLayer"in y&&t(4,a=y.sourceLayer)},r.$$.update=()=>{if(r.$$.dirty&252&&o&&n&&i){let y=new Set;for(const w of o){const T=w[u];if(!T)continue;d.delete(T),y.add(T);const L={id:T,source:i,sourceLayer:a},D=n.getFeatureState(L);let R=!1;for(const z of Object.keys(w))if(D[z]!==w[z]){R=!0;break}R&&n.setFeatureState(L,w)}for(const w of d){const T={id:w,source:i,sourceLayer:a},L=n.getFeatureState(T);for(const D of Object.keys(L))n.removeFeatureState(T,D)}t(5,d=y)}},[p,g,o,u,a,d,n,i]}class m3 extends It{constructor(e){super(),Et(this,e,p3,null,xt,{data:2,idCol:3,sourceLayer:4})}}function _3(r){let e;const t=r[15].default,n=En(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&An(n,t,i,i[23],e?In(t,i[23],o,null):Pn(i[23]),null)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function g3(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[_3]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new bd({props:o}),un.push(()=>Cn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){de(e.$$.fragment)},m(u,a){he(e,u,a),n=!0},p(u,[a]){const d={};a&2&&(d.id=u[1]),a&4&&(d.source=u[2]),a&8&&(d.sourceLayer=u[3]),a&16&&(d.beforeId=u[4]),a&32&&(d.beforeLayerType=u[5]),a&64&&(d.paint=u[6]),a&128&&(d.layout=u[7]),a&256&&(d.filter=u[8]),a&512&&(d.minzoom=u[9]),a&1024&&(d.maxzoom=u[10]),a&2048&&(d.hoverCursor=u[11]),a&4096&&(d.manageHoverState=u[12]),a&8192&&(d.eventsIfTopMost=u[13]),a&16384&&(d.interactive=u[14]),a&8388608&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.hovered=u[0],Sn(()=>t=!1)),e.$set(d)},i(u){n||(j(e.$$.fragment,u),n=!0)},o(u){G(e.$$.fragment,u),n=!1},d(u){fe(e,u)}}}function y3(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=ml("line")}=e,{source:u=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:y=void 0}=e,{filter:w=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:L=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:R=!1}=e,{hovered:z=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:F=!0}=e;function N(ee){z=ee,t(0,z)}function W(ee){Mn.call(this,r,ee)}function se(ee){Mn.call(this,r,ee)}function J(ee){Mn.call(this,r,ee)}function Y(ee){Mn.call(this,r,ee)}function _e(ee){Mn.call(this,r,ee)}function ze(ee){Mn.call(this,r,ee)}return r.$$set=ee=>{"id"in ee&&t(1,o=ee.id),"source"in ee&&t(2,u=ee.source),"sourceLayer"in ee&&t(3,a=ee.sourceLayer),"beforeId"in ee&&t(4,d=ee.beforeId),"beforeLayerType"in ee&&t(5,p=ee.beforeLayerType),"paint"in ee&&t(6,g=ee.paint),"layout"in ee&&t(7,y=ee.layout),"filter"in ee&&t(8,w=ee.filter),"minzoom"in ee&&t(9,T=ee.minzoom),"maxzoom"in ee&&t(10,L=ee.maxzoom),"hoverCursor"in ee&&t(11,D=ee.hoverCursor),"manageHoverState"in ee&&t(12,R=ee.manageHoverState),"hovered"in ee&&t(0,z=ee.hovered),"eventsIfTopMost"in ee&&t(13,I=ee.eventsIfTopMost),"interactive"in ee&&t(14,F=ee.interactive),"$$scope"in ee&&t(23,i=ee.$$scope)},[z,o,u,a,d,p,g,y,w,T,L,D,R,I,F,n,N,W,se,J,Y,_e,ze,i]}let tr=class extends It{constructor(e){super(),Et(this,e,y3,g3,xt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function b3(r,e,t){let n;const i=ds();let{layer:o=void 0}=e;const{map:u}=Ia();st(r,u,g=>t(2,n=g));function a(g){i(g.type,{...g,map:u})}const d=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],p=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return ti(()=>{if(n)if(o)for(const g of d)n.off(g,o,a);else for(const g of p)n.off(g,a)}),r.$$set=g=>{"layer"in g&&t(1,o=g.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&n)if(o)for(const g of d)n.on(g,o,a);else for(const g of p)n.on(g,a)},[u,o,n]}class Zm extends It{constructor(e){super(),Et(this,e,b3,null,xt,{layer:1})}}function v3(r){let e=r.getCenter(),t=Math.round(r.getZoom()*100)/100,n=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,n),o=Math.round(e.lat*i)/i,u=Math.round(e.lng*i)/i,a=`${t}/${o}/${u}`,d=r.getBearing(),p=r.getPitch();return(d||p)&&(a+=`/${Math.round(d*10)/10}`),p&&(a+=`/${Math.round(p)}`),`#${a}`}function w3(r){return r.replace("#","").split("/").map(parseFloat)}var yc=Gm;function Gm(r,e){return r===e||r!==r&&e!==e?!0:typeof r!=typeof e||{}.toString.call(r)!={}.toString.call(e)||r!==Object(r)||!r?!1:Array.isArray(r)?e0(r,e):{}.toString.call(r)=="[object Set]"?e0(Array.from(r),Array.from(e)):{}.toString.call(r)=="[object Object]"?k3(r,e):x3(r,e)}function x3(r,e){return r.toString()===e.toString()}function e0(r,e){var t=r.length;if(t!=e.length)return!1;for(var n=0;n<t;n++)if(!Gm(r[n],e[n]))return!1;return!0}function k3(r,e){var t=Object.keys(r),n=t.length;if(n!=Object.keys(e).length)return!1;for(var i=0;i<n;i++){var o=t[i];if(!(e.hasOwnProperty(o)&&Gm(r[o],e[o])))return!1}return!0}function S3(r,e,t){let n;const{map:i}=Ia();st(r,i,g=>t(6,n=g));let{position:o="top-left"}=e,{showCompass:u=!0}=e,{showZoom:a=!0}=e,{visualizePitch:d=!1}=e,p=null;return ti(()=>{n!=null&&n.loaded()&&p&&n.removeControl(p)}),r.$$set=g=>{"position"in g&&t(1,o=g.position),"showCompass"in g&&t(2,u=g.showCompass),"showZoom"in g&&t(3,a=g.showZoom),"visualizePitch"in g&&t(4,d=g.visualizePitch)},r.$$.update=()=>{r.$$.dirty&126&&n&&!p&&(t(5,p=new ei.NavigationControl({showCompass:u,showZoom:a,visualizePitch:d})),n.addControl(p,o))},[i,o,u,a,d,p,n]}class Zb extends It{constructor(e){super(),Et(this,e,S3,null,xt,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function C3(r,e,t){let n;const{map:i}=Ia();st(r,i,p=>t(5,n=p));let{position:o="bottom-left"}=e,{maxWidth:u=void 0}=e,{unit:a="metric"}=e,d=null;return ti(()=>{n!=null&&n.loaded()&&d&&n.removeControl(d)}),r.$$set=p=>{"position"in p&&t(1,o=p.position),"maxWidth"in p&&t(2,u=p.maxWidth),"unit"in p&&t(3,a=p.unit)},r.$$.update=()=>{r.$$.dirty&62&&n&&!d&&(t(4,d=new ei.ScaleControl({maxWidth:u,unit:a})),n.addControl(d,o))},[i,o,u,a,d,n]}class Gb extends It{constructor(e){super(),Et(this,e,C3,null,xt,{position:1,maxWidth:2,unit:3})}}const{window:T3}=pb,M3=r=>({map:r[0]&16,loadedImages:r[0]&32,allImagesLoaded:r[0]&64}),t0=r=>({map:r[4],loadedImages:r[5],allImagesLoaded:r[6]});function n0(r){let e,t,n=r[3]&&r0(r);const i=r[46].default,o=En(i,r,r[45],t0);return{c(){n&&n.c(),e=oe(),o&&o.c()},m(u,a){n&&n.m(u,a),q(u,e,a),o&&o.m(u,a),t=!0},p(u,a){u[3]?n?(n.p(u,a),a[0]&8&&j(n,1)):(n=r0(u),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),G(n,1,1,()=>{n=null}),nn()),o&&o.p&&(!t||a[0]&112|a[1]&16384)&&An(o,i,u,u[45],t?In(i,u[45],a,M3):Pn(u[45]),t0)},i(u){t||(j(n),j(o,u),t=!0)},o(u){G(n),G(o,u),t=!1},d(u){u&&V(e),n&&n.d(u),o&&o.d(u)}}}function r0(r){let e,t,n,i,o,u,a,d;return e=new Zb({props:{position:r[7]}}),n=new d3({props:{position:r[7],fitBoundsOptions:{maxZoom:12}}}),o=new c3({props:{position:r[7]}}),a=new Gb({props:{position:r[7]}}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment),i=oe(),de(o.$$.fragment),u=oe(),de(a.$$.fragment)},m(p,g){he(e,p,g),q(p,t,g),he(n,p,g),q(p,i,g),he(o,p,g),q(p,u,g),he(a,p,g),d=!0},p(p,g){const y={};g[0]&128&&(y.position=p[7]),e.$set(y);const w={};g[0]&128&&(w.position=p[7]),n.$set(w);const T={};g[0]&128&&(T.position=p[7]),o.$set(T);const L={};g[0]&128&&(L.position=p[7]),a.$set(L)},i(p){d||(j(e.$$.fragment,p),j(n.$$.fragment,p),j(o.$$.fragment,p),j(a.$$.fragment,p),d=!0)},o(p){G(e.$$.fragment,p),G(n.$$.fragment,p),G(o.$$.fragment,p),G(a.$$.fragment,p),d=!1},d(p){p&&(V(t),V(i),V(u)),fe(e,p),fe(n,p),fe(o,p),fe(a,p)}}}function L3(r){let e,t,n,i,o,u=r[4]&&r[0]&&n0(r);return{c(){e=U("div"),u&&u.c(),ue(e,"class",t=nd(r[2])+" svelte-p00lfq"),ue(e,"data-testid","map-container"),Yt(e,"expand-map",!r[2])},m(a,d){q(a,e,d),u&&u.m(e,null),r[47](e),n=!0,i||(o=[yt(T3,"hashchange",r[11]),Jp(r[10].call(null,e))],i=!0)},p(a,d){a[4]&&a[0]?u?(u.p(a,d),d[0]&17&&j(u,1)):(u=n0(a),u.c(),j(u,1),u.m(e,null)):u&&(tn(),G(u,1,1,()=>{u=null}),nn()),(!n||d[0]&4&&t!==(t=nd(a[2])+" svelte-p00lfq"))&&ue(e,"class",t),(!n||d[0]&4)&&Yt(e,"expand-map",!a[2])},i(a){n||(j(u),n=!0)},o(a){G(u),n=!1},d(a){a&&V(e),u&&u.d(),r[47](null),i=!1,mr(o)}}}function E3(r,e,t){let n,i,o,u,{$$slots:a={},$$scope:d}=e,{map:p=null}=e,{mapContainer:g=void 0}=e,{class:y=void 0}=e,{style:w}=e,{diffStyleUpdates:T=!1}=e,{center:L=void 0}=e,{zoom:D=void 0}=e,{pitch:R=0}=e,{bearing:z=0}=e,{bounds:I=void 0}=e,{hash:F=!1}=e,{updateHash:N=Oe=>{window.history.replaceState(window.history.state,"",Oe)}}=e,{loaded:W=!1}=e,{minZoom:se=0}=e,{maxZoom:J=22}=e,{minPitch:Y=0}=e,{maxPitch:_e=60}=e,{renderWorldCopies:ze=void 0}=e,{dragPan:ee=void 0}=e,{dragRotate:ae=void 0}=e,{pitchWithRotate:Ee=void 0}=e,{antialias:we=void 0}=e,{zoomOnDoubleClick:it=!0}=e,{locale:Ge=void 0}=e,{interactive:Ie=!0}=e,{attributionControl:De=!0}=e,{cooperativeGestures:Ct=!1}=e,{preserveDrawingBuffer:nt=!1}=e,{maxBounds:lt=void 0}=e,{images:mt=[]}=e,{standardControls:ht=!1}=e,{filterLayers:We=void 0}=e,{transformRequest:Bt=void 0}=e;const Lt=ds(),{map:Nt,loadedImages:Mt}=qk();st(r,Nt,Oe=>t(4,o=Oe)),st(r,Mt,Oe=>t(5,u=Oe));let Qt=new Set;async function bt(Oe,tt=!1){if(o&&!(!o.loaded()&&!tt))if("url"in Oe){Qt.add(Oe.id);try{let Kt=await o.loadImage(Oe.url);o==null||o.addImage(Oe.id,Kt.data,Oe.options),u.add(Oe.id),Mt.set(u)}catch(Kt){Lt("error",Kt)}finally{Qt.delete(Oe.id)}}else o.addImage(Oe.id,Oe.data,Oe.options),u.add(Oe.id),Mt.set(u)}let Dt,pn,qe,Ve;function kt(Oe){return ye(),Ot(Nt,o=new ei.Map(Sa({container:Oe,style:w,locale:Ge,center:L,zoom:D,pitch:R,bearing:z,minZoom:se,maxZoom:J,minPitch:Y,maxPitch:_e,renderWorldCopies:ze,dragPan:ee,dragRotate:ae,pitchWithRotate:Ee,antialias:we,interactive:Ie,preserveDrawingBuffer:nt,maxBounds:lt,bounds:I,attributionControl:De,transformRequest:Bt,cooperativeGestures:Ct})),o),o.on("load",tt=>{tt.target.getContainer().setAttribute("data-testid","map"),tt.target.getCanvas().setAttribute("data-testid","map-canvas"),t(0,W=!0),Lt("load",o)}),o.on("error",tt=>Lt("error",{...tt,map:o})),o.on("movestart",tt=>Lt("movestart",{...tt,map:o})),o.on("moveend",tt=>{if(t(12,L=tt.target.getCenter()),t(13,D=tt.target.getZoom()),t(14,R=tt.target.getPitch()),t(15,z=tt.target.getBearing()),t(16,I=tt.target.getBounds()),Lt("moveend",{...tt,map:o}),F){let Kt=new URL(window.location.href.replace(/(#.+)?$/,v3(o)));N(Kt)}}),o.on("click",tt=>Lt("click",{...tt,map:o})),o.on("dblclick",tt=>Lt("dblclick",{...tt,map:o})),o.on("contextmenu",tt=>Lt("contextmenu",{...tt,map:o})),o.on("zoomstart",tt=>Lt("zoomstart",{...tt,map:o})),o.on("zoom",tt=>{Lt("zoom",{...tt,map:o})}),o.on("zoomend",tt=>{Lt("zoomend",{...tt,map:o})}),o.on("style.load",()=>{if(o){const tt=o.getStyle();if(t(42,Dt=tt.layers.map(Kt=>Kt.id)),t(43,pn=Object.keys(tt.sources)),Ve)for(const[Kt,Un]of Object.entries(Ve))o.addSource(Kt,Un);if(qe)for(const Kt of qe)o.addLayer(Kt);for(const Kt of mt)bt(Kt,!0)}}),o.on("styledata",tt=>{if(o&&We){const Kt=o.getStyle().layers;if(Kt)for(let Un of Kt)We(Un)||o.setLayoutProperty(Un.id,"visibility","none")}Lt("styledata",{...tt,map:o})}),{destroy(){t(0,W=!1),o==null||o.remove(),Ot(Nt,o=null,o)}}}let Ut=w;function ye(){if(F){let Oe=w3(window.location.hash);Oe.length>=3&&(t(13,D=Oe[0]),t(12,L=[Oe[2],Oe[1]])),Oe.length==5&&(t(15,z=Oe[3]),t(14,R=Oe[4]))}}function zn(Oe){un[Oe?"unshift":"push"](()=>{g=Oe,t(1,g)})}return r.$$set=Oe=>{"map"in Oe&&t(17,p=Oe.map),"mapContainer"in Oe&&t(1,g=Oe.mapContainer),"class"in Oe&&t(2,y=Oe.class),"style"in Oe&&t(18,w=Oe.style),"diffStyleUpdates"in Oe&&t(19,T=Oe.diffStyleUpdates),"center"in Oe&&t(12,L=Oe.center),"zoom"in Oe&&t(13,D=Oe.zoom),"pitch"in Oe&&t(14,R=Oe.pitch),"bearing"in Oe&&t(15,z=Oe.bearing),"bounds"in Oe&&t(16,I=Oe.bounds),"hash"in Oe&&t(20,F=Oe.hash),"updateHash"in Oe&&t(21,N=Oe.updateHash),"loaded"in Oe&&t(0,W=Oe.loaded),"minZoom"in Oe&&t(22,se=Oe.minZoom),"maxZoom"in Oe&&t(23,J=Oe.maxZoom),"minPitch"in Oe&&t(24,Y=Oe.minPitch),"maxPitch"in Oe&&t(25,_e=Oe.maxPitch),"renderWorldCopies"in Oe&&t(26,ze=Oe.renderWorldCopies),"dragPan"in Oe&&t(27,ee=Oe.dragPan),"dragRotate"in Oe&&t(28,ae=Oe.dragRotate),"pitchWithRotate"in Oe&&t(29,Ee=Oe.pitchWithRotate),"antialias"in Oe&&t(30,we=Oe.antialias),"zoomOnDoubleClick"in Oe&&t(31,it=Oe.zoomOnDoubleClick),"locale"in Oe&&t(32,Ge=Oe.locale),"interactive"in Oe&&t(33,Ie=Oe.interactive),"attributionControl"in Oe&&t(34,De=Oe.attributionControl),"cooperativeGestures"in Oe&&t(35,Ct=Oe.cooperativeGestures),"preserveDrawingBuffer"in Oe&&t(36,nt=Oe.preserveDrawingBuffer),"maxBounds"in Oe&&t(37,lt=Oe.maxBounds),"images"in Oe&&t(38,mt=Oe.images),"standardControls"in Oe&&t(3,ht=Oe.standardControls),"filterLayers"in Oe&&t(39,We=Oe.filterLayers),"transformRequest"in Oe&&t(40,Bt=Oe.transformRequest),"$$scope"in Oe&&t(45,d=Oe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&8&&t(7,n=typeof ht=="boolean"?void 0:ht),r.$$.dirty[0]&16&&t(17,p=o),r.$$.dirty[0]&786448|r.$$.dirty[1]&14336&&o&&!yc(w,Ut)){const Oe=o.getStyle();if(Dt&&(qe=Oe.layers.filter(tt=>!Dt.includes(tt.id))),pn){const tt=Object.keys(Oe.sources).filter(Kt=>!pn.includes(Kt));Ve={};for(const Kt of tt)Ve[Kt]=Oe.sources[Kt]}t(44,Ut=w),o.setStyle(w,{diff:T}),Ot(Mt,u=new Set,u),t(41,Qt=new Set)}if(r.$$.dirty[0]&49|r.$$.dirty[1]&1152&&W&&o!=null&&o.loaded())for(let Oe of mt)!u.has(Oe.id)&&!Qt.has(Oe.id)&&!o.hasImage(Oe.id)&&bt(Oe);if(r.$$.dirty[0]&32|r.$$.dirty[1]&128&&t(6,i=mt.every(Oe=>u.has(Oe.id))),r.$$.dirty[0]&61456&&o){let Oe={};L!=null&&!yc(L,o==null?void 0:o.getCenter())&&(Oe.center=L),D!=null&&!yc(D,o==null?void 0:o.getZoom())&&(Oe.zoom=D),z!=null&&!yc(z,o==null?void 0:o.getBearing())&&(Oe.bearing=z),R!=null&&!yc(R,o==null?void 0:o.getPitch())&&(Oe.pitch=R),Object.keys(Oe).length&&o.easeTo(Oe)}r.$$.dirty[0]&65552&&I&&!yc(I,o==null?void 0:o.getBounds())&&(o==null||o.fitBounds(I)),r.$$.dirty[0]&16|r.$$.dirty[1]&1&&(it?o==null||o.doubleClickZoom.enable():o==null||o.doubleClickZoom.disable())},[W,g,y,ht,o,u,i,n,Nt,Mt,kt,ye,L,D,R,z,I,p,w,T,F,N,se,J,Y,_e,ze,ee,ae,Ee,we,it,Ge,Ie,De,Ct,nt,lt,mt,We,Bt,Qt,Dt,pn,Ut,d,a,zn]}class I3 extends It{constructor(e){super(),Et(this,e,E3,L3,xt,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const A3=r=>({marker:r&8}),i0=r=>({marker:r[3]});function P3(r){let e,t,n,i,o,u,a;const d=r[19].default,p=En(d,r,r[18],i0);return{c(){e=U("div"),p&&p.c(),ue(e,"tabindex",t=r[1]?0:void 0),ue(e,"role",n=r[1]?"button":void 0),ut(e,"z-index",r[2])},m(g,y){q(g,e,y),p&&p.m(e,null),o=!0,u||(a=[Jp(r[7].call(null,e)),Jp(i=z3.call(null,e,r[0])),yt(e,"click",eh(r[20])),yt(e,"dblclick",eh(r[21])),yt(e,"contextmenu",eh(Am(r[22]))),yt(e,"mouseenter",r[23]),yt(e,"mouseleave",r[24]),yt(e,"mousemove",r[25]),yt(e,"keydown",r[8])],u=!0)},p(g,[y]){p&&p.p&&(!o||y&262152)&&An(p,d,g,g[18],o?In(d,g[18],y,A3):Pn(g[18]),i0),(!o||y&2&&t!==(t=g[1]?0:void 0))&&ue(e,"tabindex",t),(!o||y&2&&n!==(n=g[1]?"button":void 0))&&ue(e,"role",n),i&&zc(i.update)&&y&1&&i.update.call(null,g[0]),y&4&&ut(e,"z-index",g[2])},i(g){o||(j(p,g),o=!0)},o(g){G(p,g),o=!1},d(g){g&&V(e),p&&p.d(g),u=!1,mr(a)}}}function z3(r,e){const t=r.className;function n(i){i?r.className=`${t} ${i}`:r.className=t}return n(e),{update:n}}function D3(r,e,t){let n,i,o,{$$slots:u={},$$scope:a}=e,{marker:d=void 0}=e,{lngLat:p}=e,{class:g=void 0}=e,{interactive:y=!0}=e,{asButton:w=!1}=e,{draggable:T=!1}=e,{feature:L=null}=e,{offset:D=void 0}=e,{zIndex:R=void 0}=e,{rotation:z=0}=e,{opacity:I=1}=e;const F=ds(),{map:N,layerEvent:W,self:se,markerClickManager:J}=Zk();st(r,N,De=>t(27,o=De)),st(r,W,De=>t(26,n=De)),st(r,se,De=>t(3,i=De));function Y(De){Ot(se,i=new ei.Marker({element:De,rotation:z,draggable:T,offset:D,opacity:I.toString()}).setLngLat(p).addTo(o),i),t(11,d=i);const Ct=()=>ee("dragstart"),nt=()=>{_e(),ee("drag")},lt=()=>{_e(),ee("dragend")};return T&&(i.on("dragstart",Ct),i.on("drag",nt),i.on("dragend",lt)),{destroy(){T&&(i==null||i.off("dragstart",Ct),i==null||i.off("drag",nt),i==null||i.off("dragend",lt)),t(11,d=void 0),i==null||i.remove()}}}function _e(){let De=i==null?void 0:i.getLngLat();De&&(Array.isArray(p)?t(10,p=[De.lng,De.lat]):p&&"lon"in p?t(10,p={lon:De.lng,lat:De.lat}):t(10,p=De))}function ze(De){De.key===" "&&(De.preventDefault(),De.stopPropagation(),ee("click"))}function ee(De){if(!y)return;let Ct=i==null?void 0:i.getLngLat();if(!Ct)return;const nt=[Ct.lng,Ct.lat];let lt={map:o,marker:i,lngLat:nt,features:[{type:"Feature",properties:(L==null?void 0:L.properties)??{},geometry:{type:"Point",coordinates:nt}}]};(De==="click"||De==="contextmenu")&&J.handleClick(lt),Ot(W,n={...lt,layerType:"marker",type:De},n),F(De,lt)}const ae=()=>ee("click"),Ee=()=>ee("dblclick"),we=()=>{ee("contextmenu")},it=()=>{ee("mouseenter")},Ge=()=>{ee("mouseleave")},Ie=()=>ee("mousemove");return r.$$set=De=>{"marker"in De&&t(11,d=De.marker),"lngLat"in De&&t(10,p=De.lngLat),"class"in De&&t(0,g=De.class),"interactive"in De&&t(12,y=De.interactive),"asButton"in De&&t(1,w=De.asButton),"draggable"in De&&t(13,T=De.draggable),"feature"in De&&t(14,L=De.feature),"offset"in De&&t(15,D=De.offset),"zIndex"in De&&t(2,R=De.zIndex),"rotation"in De&&t(16,z=De.rotation),"opacity"in De&&t(17,I=De.opacity),"$$scope"in De&&t(18,a=De.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(i==null||i.setLngLat(p)),r.$$.dirty&32776&&(i==null||i.setOffset(D??[0,0])),r.$$.dirty&65544&&(i==null||i.setRotation(z)),r.$$.dirty&131080&&(i==null||i.setOpacity(I.toString()))},[g,w,R,i,N,W,se,Y,ze,ee,p,d,y,T,L,D,z,I,a,u,ae,Ee,we,it,Ge,Ie]}class vd extends It{constructor(e){super(),Et(this,e,D3,P3,xt,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}const R3=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),o0=r=>{var e;return{features:r[4],data:((e=r[4])==null?void 0:e[0])??null,map:r[2],close:r[31]}};function s0(r){var i;let e,t,n=(((i=r[4])==null?void 0:i.length)||r[3]instanceof ei.Marker)&&a0(r);return{c(){e=U("div"),n&&n.c()},m(o,u){q(o,e,u),n&&n.m(e,null),r[32](e),t=!0},p(o,u){var a;(a=o[4])!=null&&a.length||o[3]instanceof ei.Marker?n?(n.p(o,u),u[0]&24&&j(n,1)):(n=a0(o),n.c(),j(n,1),n.m(e,null)):n&&(tn(),G(n,1,1,()=>{n=null}),nn())},i(o){t||(j(n),t=!0)},o(o){G(n),t=!1},d(o){o&&V(e),n&&n.d(),r[32](null)}}}function a0(r){let e;const t=r[30].default,n=En(t,r,r[29],o0);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[0]&536870933)&&An(n,t,i,i[29],e?In(t,i[29],o,R3):Pn(i[29]),o0)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function $3(r){let e,t,n=r[9].default&&s0(r);return{c(){n&&n.c(),e=Jn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,o){i[9].default?n?(n.p(i,o),o[0]&512&&j(n,1)):(n=s0(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),G(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){G(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function F3(r,e,t){let n,i,o,u,a,d,{$$slots:p={},$$scope:g}=e;const y=Im(p);let{closeButton:w=void 0}=e,{closeOnClickOutside:T=!0}=e,{closeOnClickInside:L=!1}=e,{closeOnMove:D=!1}=e,{openOn:R="click"}=e,{openIfTopMost:z=!0}=e,{focusAfterOpen:I=!0}=e,{anchor:F=void 0}=e,{offset:N=void 0}=e,{popupClass:W=void 0}=e,{maxWidth:se=void 0}=e,{lngLat:J=void 0}=e,{html:Y=void 0}=e,{open:_e=!1}=e;const ze=ds(),{map:ee,popupTarget:ae,layerEvent:Ee,layer:we,eventTopMost:it,markerClickManager:Ge}=Ia();st(r,ee,ye=>t(2,o=ye)),st(r,ae,ye=>t(3,a=ye)),st(r,Ee,ye=>t(28,u=ye)),st(r,we,ye=>t(35,d=ye));const Ie=["click","dblclick","contextmenu"];let De,Ct=!1,nt;function lt(){if(!De)return;let ye=De.getElement();!ye||ye===nt||(nt=ye,R==="hover"&&(nt.style.pointerEvents="none"),nt.addEventListener("mouseenter",()=>{t(24,Ct=!0)},{passive:!0}),nt.addEventListener("mouseleave",()=>{t(24,Ct=!1)},{passive:!0}),nt.addEventListener("click",()=>{L&&t(0,_e=!1)},{passive:!0}))}Ts(()=>{if(o)return o.on("click",pn),o.on("contextmenu",pn),Ge.add(qe),typeof a=="string"&&(o.on("click",a,Lt),o.on("dblclick",a,Lt),o.on("contextmenu",a,Lt),o.on("mousemove",a,Dt),o.on("mouseleave",a,bt),o.on("touchstart",a,Mt),o.on("touchend",a,Qt)),()=>{o!=null&&o.loaded()&&(De==null||De.remove(),o.off("click",pn),o.off("contextmenu",pn),Ge.remove(qe),a instanceof ei.Marker?a.getPopup()===De&&a.setPopup(void 0):typeof a=="string"&&(o.off("click",a,Lt),o.off("dblclick",a,Lt),o.off("contextmenu",a,Lt),o.off("mousemove",a,Dt),o.off("mouseleave",a,bt),o.off("touchstart",a,Mt),o.off("touchend",a,Qt)))}});function mt(ye){return z?!("marker"in ye)&&!Gk(ye)&&it(ye)!==d:!1}let ht=null,We="normal";function Bt(ye){"layerType"in ye&&ye.layerType==="deckgl"?(t(10,J=ye.coordinate),t(4,ht=ye.object?[ye.object]:null)):(t(10,J=ye.lngLat),t(4,ht=ye.features??[]))}function Lt(ye){ye.type!==R||mt(ye)||(Bt(ye),setTimeout(()=>t(0,_e=!0)))}let Nt=null;function Mt(ye){Nt=ye.point}function Qt(ye){if(!Nt||R!=="hover")return;let zn=Nt.dist(ye.point);Nt=null,zn<3&&(t(10,J=ye.lngLat),t(4,ht=ye.features??[]),De.isOpen()?t(25,We="justOpened"):(t(25,We="opening"),t(0,_e=!0)))}function bt(ye){R!=="hover"||Nt||We!=="normal"||(t(0,_e=!1),t(4,ht=null))}function Dt(ye){if(!(R!=="hover"||Nt||We!=="normal")){if(mt(ye)){t(0,_e=!1),t(4,ht=null);return}t(0,_e=!0),t(4,ht=ye.features??[]),t(10,J=ye.lngLat)}}function pn(ye){if(We==="justOpened"){t(25,We="normal");return}if(!T)return;let zn=[nt,a instanceof ei.Marker?a==null?void 0:a.getElement():null];_e&&De.isOpen()&&!zn.some(Oe=>Oe==null?void 0:Oe.contains(ye.originalEvent.target))&&(ye.type==="contextmenu"&&R==="contextmenu"||ye.type!=="contextmenu")&&t(0,_e=!1)}function qe(ye){T&&_e&&De.isOpen()&&ye.marker!==a&&t(0,_e=!1)}ti(()=>{o&&(De!=null&&De.isOpen())&&De.remove()});let Ve;const kt=()=>t(0,_e=!1);function Ut(ye){un[ye?"unshift":"push"](()=>{Ve=ye,t(1,Ve)})}return r.$$set=ye=>{"closeButton"in ye&&t(11,w=ye.closeButton),"closeOnClickOutside"in ye&&t(12,T=ye.closeOnClickOutside),"closeOnClickInside"in ye&&t(13,L=ye.closeOnClickInside),"closeOnMove"in ye&&t(14,D=ye.closeOnMove),"openOn"in ye&&t(15,R=ye.openOn),"openIfTopMost"in ye&&t(16,z=ye.openIfTopMost),"focusAfterOpen"in ye&&t(17,I=ye.focusAfterOpen),"anchor"in ye&&t(18,F=ye.anchor),"offset"in ye&&t(19,N=ye.offset),"popupClass"in ye&&t(20,W=ye.popupClass),"maxWidth"in ye&&t(21,se=ye.maxWidth),"lngLat"in ye&&t(10,J=ye.lngLat),"html"in ye&&t(22,Y=ye.html),"open"in ye&&t(0,_e=ye.open),"$$scope"in ye&&t(29,g=ye.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=w??(!T&&!L)),r.$$.dirty[0]&146685952&&(De||(t(23,De=new ei.Popup({closeButton:n,closeOnClick:!1,closeOnMove:D,focusAfterOpen:I,maxWidth:se,className:W,anchor:F,offset:N})),nt=De.getElement(),De.on("open",()=>{t(0,_e=!0),lt(),ze("open",De)}),De.on("close",()=>{t(0,_e=!1),ze("close",De)}),De.on("hover",()=>{ze("hover",De)}))),r.$$.dirty[0]&8421384&&De&&a instanceof ei.Marker&&(R==="click"?a.setPopup(De):a.getPopup()===De&&a.setPopup(void 0)),r.$$.dirty[0]&268468224&&Ie.includes(R)&&(u==null?void 0:u.type)===R&&(Lt(u),Ot(Ee,u=null,u)),r.$$.dirty[0]&268468224&&t(26,i=R==="hover"&&((u==null?void 0:u.type)==="mousemove"||(u==null?void 0:u.type)==="mouseenter")),r.$$.dirty[0]&352354304&&R==="hover"&&Ee&&(i&&u&&Bt(u),t(0,_e=(i||Ct)??!1)),r.$$.dirty[0]&12582914&&(Ve?De.setDOMContent(Ve):Y&&De.setHTML(Y)),r.$$.dirty[0]&8389632&&J&&De.setLngLat(J),r.$$.dirty[0]&41943045&&o){let ye=De.isOpen();_e&&!ye?(De.addTo(o),We==="opening"&&t(25,We="justOpened")):!_e&&ye&&De.remove()}},[_e,Ve,o,a,ht,ee,ae,Ee,we,y,J,w,T,L,D,R,z,I,F,N,W,se,Y,De,Ct,We,i,n,u,g,p,kt,Ut]}let Hb=class extends It{constructor(e){super(),Et(this,e,F3,$3,xt,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}};var Lc=Math.pow,Zi=(r,e,t)=>new Promise((n,i)=>{var o=d=>{try{a(t.next(d))}catch(p){i(p)}},u=d=>{try{a(t.throw(d))}catch(p){i(p)}},a=d=>d.done?n(d.value):Promise.resolve(d.value).then(o,u);a((t=t.apply(r,e)).next())}),zo=Uint8Array,Tc=Uint16Array,B3=Int32Array,Wb=new zo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Kb=new zo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),O3=new zo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Xb=function(r,e){for(var t=new Tc(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new B3(t[30]),n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)i[o]=o-t[n]<<5|n;return{b:t,r:i}},Jb=Xb(Wb,2),Yb=Jb.b,N3=Jb.r;Yb[28]=258,N3[258]=28;var j3=Xb(Kb,0),U3=j3.b,lm=new Tc(32768);for(lr=0;lr<32768;++lr)js=(lr&43690)>>1|(lr&21845)<<1,js=(js&52428)>>2|(js&13107)<<2,js=(js&61680)>>4|(js&3855)<<4,lm[lr]=((js&65280)>>8|(js&255)<<8)>>1;var js,lr,sh=function(r,e,t){for(var n=r.length,i=0,o=new Tc(e);i<n;++i)r[i]&&++o[r[i]-1];var u=new Tc(e);for(i=1;i<e;++i)u[i]=u[i-1]+o[i-1]<<1;var a;if(t){a=new Tc(1<<e);var d=15-e;for(i=0;i<n;++i)if(r[i])for(var p=i<<4|r[i],g=e-r[i],y=u[r[i]-1]++<<g,w=y|(1<<g)-1;y<=w;++y)a[lm[y]>>d]=p}else for(a=new Tc(n),i=0;i<n;++i)r[i]&&(a[i]=lm[u[r[i]-1]++]>>15-r[i]);return a},Th=new zo(288);for(lr=0;lr<144;++lr)Th[lr]=8;var lr;for(lr=144;lr<256;++lr)Th[lr]=9;var lr;for(lr=256;lr<280;++lr)Th[lr]=7;var lr;for(lr=280;lr<288;++lr)Th[lr]=8;var lr,Qb=new zo(32);for(lr=0;lr<32;++lr)Qb[lr]=5;var lr,V3=sh(Th,9,1),q3=sh(Qb,5,1),Up=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},ss=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},Vp=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},Z3=function(r){return(r+7)/8|0},G3=function(r,e,t){(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length);var n=new zo(t-e);return n.set(r.subarray(e,t)),n},H3=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Eo=function(r,e,t){var n=new Error(e||H3[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,Eo),!t)throw n;return n},Hm=function(r,e,t,n){var i=r.length,o=n?n.length:0;if(!i||e.f&&!e.l)return t||new zo(0);var u=!t||e.i!=2,a=e.i;t||(t=new zo(i*3));var d=function(bt){var Dt=t.length;if(bt>Dt){var pn=new zo(Math.max(Dt*2,bt));pn.set(t),t=pn}},p=e.f||0,g=e.p||0,y=e.b||0,w=e.l,T=e.d,L=e.m,D=e.n,R=i*8;do{if(!w){p=ss(r,g,1);var z=ss(r,g+1,3);if(g+=3,z)if(z==1)w=V3,T=q3,L=9,D=5;else if(z==2){var W=ss(r,g,31)+257,se=ss(r,g+10,15)+4,J=W+ss(r,g+5,31)+1;g+=14;for(var Y=new zo(J),_e=new zo(19),ze=0;ze<se;++ze)_e[O3[ze]]=ss(r,g+ze*3,7);g+=se*3;for(var ee=Up(_e),ae=(1<<ee)-1,Ee=sh(_e,ee,1),ze=0;ze<J;){var we=Ee[ss(r,g,ae)];g+=we&15;var I=we>>4;if(I<16)Y[ze++]=I;else{var it=0,Ge=0;for(I==16?(Ge=3+ss(r,g,3),g+=2,it=Y[ze-1]):I==17?(Ge=3+ss(r,g,7),g+=3):I==18&&(Ge=11+ss(r,g,127),g+=7);Ge--;)Y[ze++]=it}}var Ie=Y.subarray(0,W),De=Y.subarray(W);L=Up(Ie),D=Up(De),w=sh(Ie,L,1),T=sh(De,D,1)}else Eo(1);else{var I=Z3(g)+4,F=r[I-4]|r[I-3]<<8,N=I+F;if(N>i){a&&Eo(0);break}u&&d(y+F),t.set(r.subarray(I,N),y),e.b=y+=F,e.p=g=N*8,e.f=p;continue}if(g>R){a&&Eo(0);break}}u&&d(y+131072);for(var Ct=(1<<L)-1,nt=(1<<D)-1,lt=g;;lt=g){var it=w[Vp(r,g)&Ct],mt=it>>4;if(g+=it&15,g>R){a&&Eo(0);break}if(it||Eo(2),mt<256)t[y++]=mt;else if(mt==256){lt=g,w=null;break}else{var ht=mt-254;if(mt>264){var ze=mt-257,We=Wb[ze];ht=ss(r,g,(1<<We)-1)+Yb[ze],g+=We}var Bt=T[Vp(r,g)&nt],Lt=Bt>>4;Bt||Eo(3),g+=Bt&15;var De=U3[Lt];if(Lt>3){var We=Kb[Lt];De+=Vp(r,g)&(1<<We)-1,g+=We}if(g>R){a&&Eo(0);break}u&&d(y+131072);var Nt=y+ht;if(y<De){var Mt=o-De,Qt=Math.min(De,Nt);for(Mt+y<0&&Eo(3);y<Qt;++y)t[y]=n[Mt+y]}for(;y<Nt;y+=4)t[y]=t[y-De],t[y+1]=t[y+1-De],t[y+2]=t[y+2-De],t[y+3]=t[y+3-De];y=Nt}}e.l=w,e.p=lt,e.b=y,e.f=p,w&&(p=1,e.m=L,e.d=T,e.n=D)}while(!p);return y==t.length?t:G3(t,0,y)},W3=new zo(0),K3=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&Eo(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)},X3=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},J3=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&Eo(6,"invalid zlib data"),(r[1]>>5&1)==+!e&&Eo(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function Y3(r,e){return Hm(r,{i:2},e&&e.out,e&&e.dictionary)}function Q3(r,e){var t=K3(r);return t+8>r.length&&Eo(6,"invalid gzip data"),Hm(r.subarray(t,-8),{i:2},e&&e.out||new zo(X3(r)),e&&e.dictionary)}function e4(r,e){return Hm(r.subarray(J3(r,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function cm(r,e){return r[0]==31&&r[1]==139&&r[2]==8?Q3(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?Y3(r,e):e4(r,e)}var t4=typeof TextDecoder<"u"&&new TextDecoder,n4=0;try{t4.decode(W3,{stream:!0}),n4=1}catch{}var ev=(r,e)=>r*Lc(2,e),Ou=(r,e)=>Math.floor(r/Lc(2,e)),ud=(r,e)=>ev(r.getUint16(e+1,!0),8)+r.getUint8(e),tv=(r,e)=>ev(r.getUint32(e+2,!0),16)+r.getUint16(e,!0),r4=(r,e,t,n,i)=>{if(r!==n.getUint8(i))return r-n.getUint8(i);const o=ud(n,i+1);if(e!==o)return e-o;const u=ud(n,i+4);return t!==u?t-u:0},i4=(r,e,t,n)=>{const i=nv(r,e|128,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],isDir:!0}:null},l0=(r,e,t,n)=>{const i=nv(r,e,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],isDir:!1}:null},nv=(r,e,t,n)=>{let i=0,o=r.byteLength/17-1;for(;i<=o;){const u=o+i>>1,a=r4(e,t,n,r,u*17);if(a>0)i=u+1;else if(a<0)o=u-1;else return[tv(r,u*17+7),r.getUint32(u*17+13,!0)]}return null},o4=(r,e)=>r.isDir&&!e.isDir?1:!r.isDir&&e.isDir?-1:r.z!==e.z?r.z-e.z:r.x!==e.x?r.x-e.x:r.y-e.y,rv=(r,e)=>{const t=r.getUint8(e*17);return{z:t&127,x:ud(r,e*17+1),y:ud(r,e*17+4),offset:tv(r,e*17+7),length:r.getUint32(e*17+13,!0),isDir:t>>7===1}},c0=r=>{const e=[],t=new DataView(r);for(let n=0;n<t.byteLength/17;n++)e.push(rv(t,n));return s4(e)},s4=r=>{r.sort(o4);const e=new ArrayBuffer(17*r.length),t=new Uint8Array(e);for(let n=0;n<r.length;n++){const i=r[n];let o=i.z;i.isDir&&(o=o|128),t[n*17]=o,t[n*17+1]=i.x&255,t[n*17+2]=i.x>>8&255,t[n*17+3]=i.x>>16&255,t[n*17+4]=i.y&255,t[n*17+5]=i.y>>8&255,t[n*17+6]=i.y>>16&255,t[n*17+7]=i.offset&255,t[n*17+8]=Ou(i.offset,8)&255,t[n*17+9]=Ou(i.offset,16)&255,t[n*17+10]=Ou(i.offset,24)&255,t[n*17+11]=Ou(i.offset,32)&255,t[n*17+12]=Ou(i.offset,48)&255,t[n*17+13]=i.length&255,t[n*17+14]=i.length>>8&255,t[n*17+15]=i.length>>16&255,t[n*17+16]=i.length>>24&255}return e},a4=(r,e)=>{if(r.byteLength<17)return null;const t=r.byteLength/17,n=rv(r,t-1);if(n.isDir){const i=n.z,o=e.z-i,u=Math.trunc(e.x/(1<<o)),a=Math.trunc(e.y/(1<<o));return{z:i,x:u,y:a}}return null};function l4(r){return Zi(this,null,function*(){const e=yield r.getBytes(0,512e3),t=new DataView(e.data),n=t.getUint32(4,!0),i=t.getUint16(8,!0),o=new TextDecoder("utf-8"),u=JSON.parse(o.decode(new DataView(e.data,10,n)));let a=0;u.compression==="gzip"&&(a=2);let d=0;"minzoom"in u&&(d=+u.minzoom);let p=0;"maxzoom"in u&&(p=+u.maxzoom);let g=0,y=0,w=0,T=-180,L=-85,D=180,R=85;if(u.bounds){const I=u.bounds.split(",");T=+I[0],L=+I[1],D=+I[2],R=+I[3]}if(u.center){const I=u.center.split(",");g=+I[0],y=+I[1],w=+I[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+n,rootDirectoryLength:i*17,jsonMetadataOffset:10,jsonMetadataLength:n,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:d,maxZoom:p,minLon:T,minLat:L,maxLon:D,maxLat:R,centerZoom:w,centerLon:g,centerLat:y,etag:e.etag}})}function c4(r,e,t,n,i,o,u){return Zi(this,null,function*(){let a=yield t.getArrayBuffer(e,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(a=c0(a));const d=l0(new DataView(a),n,i,o);if(d){let y=(yield e.getBytes(d.offset,d.length,u)).data;const w=new DataView(y);return w.getUint8(0)===31&&w.getUint8(1)===139&&(y=cm(new Uint8Array(y))),{data:y}}const p=a4(new DataView(a),{z:n,x:i,y:o});if(p){const g=i4(new DataView(a),p.z,p.x,p.y);if(g){let y=yield t.getArrayBuffer(e,g.offset,g.length,r);r.specVersion===1&&(y=c0(y));const w=l0(new DataView(y),n,i,o);if(w){let L=(yield e.getBytes(w.offset,w.length,u)).data;const D=new DataView(L);return D.getUint8(0)===31&&D.getUint8(1)===139&&(L=cm(new Uint8Array(L))),{data:L}}}}})}var iv={getHeader:l4,getZxy:c4},u4=r=>(e,t)=>{if(t instanceof AbortController)return r(e,t);const n=new AbortController;return r(e,n).then(i=>t(void 0,i.data,i.cacheControl||"",i.expires||""),i=>t(i)).catch(i=>t(i)),{cancel:()=>n.abort()}},h4=class{constructor(){this.tilev4=(r,e)=>Zi(this,null,function*(){if(r.type==="json"){const y=r.url.substr(10);let w=this.tiles.get(y);w||(w=new u0(y),this.tiles.set(y,w));const T=yield w.getHeader();return{data:{tiles:[`${r.url}/{z}/{x}/{y}`],minzoom:T.minZoom,maxzoom:T.maxZoom,bounds:[T.minLon,T.minLat,T.maxLon,T.maxLat]}}}const t=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),n=r.url.match(t);if(!n)throw new Error("Invalid PMTiles protocol URL");const i=n[1];let o=this.tiles.get(i);o||(o=new u0(i),this.tiles.set(i,o));const u=n[2],a=n[3],d=n[4],p=yield o.getHeader(),g=yield o==null?void 0:o.getZxy(+u,+a,+d,e.signal);return g?{data:new Uint8Array(g.data),cacheControl:g.cacheControl,expires:g.expires}:p.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=u4(this.tilev4),this.tiles=new Map}add(r){this.tiles.set(r.source.getKey(),r)}get(r){return this.tiles.get(r)}};function bc(r,e){return(e>>>0)*4294967296+(r>>>0)}function f4(r,e){const t=e.buf;let n=t[e.pos++],i=(n&112)>>4;if(n<128||(n=t[e.pos++],i|=(n&127)<<3,n<128)||(n=t[e.pos++],i|=(n&127)<<10,n<128)||(n=t[e.pos++],i|=(n&127)<<17,n<128)||(n=t[e.pos++],i|=(n&127)<<24,n<128)||(n=t[e.pos++],i|=(n&1)<<31,n<128))return bc(r,i);throw new Error("Expected varint not more than 10 bytes")}function Nu(r){const e=r.buf;let t=e[r.pos++],n=t&127;return t<128||(t=e[r.pos++],n|=(t&127)<<7,t<128)||(t=e[r.pos++],n|=(t&127)<<14,t<128)||(t=e[r.pos++],n|=(t&127)<<21,t<128)?n:(t=e[r.pos],n|=(t&15)<<28,f4(n,r))}function d4(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}var p4=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function m4(r,e,t){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Lc(2,r)-1||t>Lc(2,r)-1)throw Error("tile x/y outside zoom level bounds");const n=p4[r],i=Lc(2,r);let o=0,u=0,a=0;const d=[e,t];let p=i/2;for(;p>0;)o=(d[0]&p)>0?1:0,u=(d[1]&p)>0?1:0,a+=p*p*(3*o^u),d4(p,d,o,u),p=p/2;return n+a}function ov(r,e){return Zi(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return cm(new Uint8Array(r));const t=new Response(r).body;if(!t)throw Error("Failed to read response stream");const n=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw Error("Compression method not supported")})}var _4=127;function g4(r,e){let t=0,n=r.length-1;for(;t<=n;){const i=n+t>>1,o=e-r[i].tileId;if(o>0)t=i+1;else if(o<0)n=i-1;else return r[i]}return n>=0&&(r[n].runLength===0||e-r[n].tileId<r[n].runLength)?r[n]:null}var y4=class{constructor(r,e=new Headers){this.url=r,this.customHeaders=e,this.mustReload=!1}getKey(){return this.url}setHeaders(r){this.customHeaders=r}getBytes(r,e,t,n){return Zi(this,null,function*(){let i,o;t?o=t:(i=new AbortController,o=i.signal);const u=new Headers(this.customHeaders);u.set("range",`bytes=${r}-${r+e-1}`);let a;this.mustReload&&(a="reload");let d=yield fetch(this.url,{signal:o,cache:a,headers:u});if(r===0&&d.status===416){const w=d.headers.get("Content-Range");if(!w||!w.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const T=+w.substr(8);d=yield fetch(this.url,{signal:o,cache:"reload",headers:{range:`bytes=0-${T-1}`}})}let p=d.headers.get("Etag");if(p!=null&&p.startsWith("W/")&&(p=null),d.status===416||n&&p&&p!==n)throw this.mustReload=!0,new um(n);if(d.status>=300)throw Error(`Bad response code: ${d.status}`);const g=d.headers.get("Content-Length");if(d.status===200&&(!g||+g>e))throw i&&i.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield d.arrayBuffer(),etag:p||void 0,cacheControl:d.headers.get("Cache-Control")||void 0,expires:d.headers.get("Expires")||void 0}})}};function as(r,e){const t=r.getUint32(e+4,!0),n=r.getUint32(e+0,!0);return t*Lc(2,32)+n}function b4(r,e){const t=new DataView(r),n=t.getUint8(7);if(n>3)throw Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:as(t,8),rootDirectoryLength:as(t,16),jsonMetadataOffset:as(t,24),jsonMetadataLength:as(t,32),leafDirectoryOffset:as(t,40),leafDirectoryLength:as(t,48),tileDataOffset:as(t,56),tileDataLength:as(t,64),numAddressedTiles:as(t,72),numTileEntries:as(t,80),numTileContents:as(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function sv(r){const e={buf:new Uint8Array(r),pos:0},t=Nu(e),n=[];let i=0;for(let o=0;o<t;o++){const u=Nu(e);n.push({tileId:i+u,offset:0,length:0,runLength:1}),i+=u}for(let o=0;o<t;o++)n[o].runLength=Nu(e);for(let o=0;o<t;o++)n[o].length=Nu(e);for(let o=0;o<t;o++){const u=Nu(e);u===0&&o>0?n[o].offset=n[o-1].offset+n[o-1].length:n[o].offset=u-1}return n}function v4(r){const e=new DataView(r);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var um=class extends Error{};function w4(r,e){return Zi(this,null,function*(){const t=yield r.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(v4(t.data)<3)return[yield iv.getHeader(r)];const i=t.data.slice(0,_4),o=b4(i,t.etag),u=t.data.slice(o.rootDirectoryOffset,o.rootDirectoryOffset+o.rootDirectoryLength),a=`${r.getKey()}|${o.etag||""}|${o.rootDirectoryOffset}|${o.rootDirectoryLength}`,d=sv(yield e(u,o.internalCompression));return[o,[a,d.length,d]]})}function x4(r,e,t,n,i){return Zi(this,null,function*(){const o=yield r.getBytes(t,n,void 0,i.etag),u=yield e(o.data,i.internalCompression),a=sv(u);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var k4=class{constructor(r=100,e=!0,t=ov){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=r,this.counter=1,this.decompress=t}getHeader(r){return Zi(this,null,function*(){const e=r.getKey(),t=this.cache.get(e);if(t)return t.lastUsed=this.counter++,yield t.data;const n=new Promise((i,o)=>{w4(r,this.decompress).then(u=>{u[1]&&this.cache.set(u[1][0],{lastUsed:this.counter++,data:Promise.resolve(u[1][2])}),i(u[0]),this.prune()}).catch(u=>{o(u)})});return this.cache.set(e,{lastUsed:this.counter++,data:n}),n})}getDirectory(r,e,t,n){return Zi(this,null,function*(){const i=`${r.getKey()}|${n.etag||""}|${e}|${t}`,o=this.cache.get(i);if(o)return o.lastUsed=this.counter++,yield o.data;const u=new Promise((a,d)=>{x4(r,this.decompress,e,t,n).then(p=>{a(p),this.prune()}).catch(p=>{d(p)})});return this.cache.set(i,{lastUsed:this.counter++,data:u}),u})}getArrayBuffer(r,e,t,n){return Zi(this,null,function*(){const i=`${r.getKey()}|${n.etag||""}|${e}|${t}`,o=this.cache.get(i);if(o)return o.lastUsed=this.counter++,yield o.data;const u=new Promise((a,d)=>{r.getBytes(e,t,void 0,n.etag).then(p=>{a(p.data),this.cache.has(i),this.prune()}).catch(p=>{d(p)})});return this.cache.set(i,{lastUsed:this.counter++,data:u}),u})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,e;this.cache.forEach((t,n)=>{t.lastUsed<r&&(r=t.lastUsed,e=n)}),e&&this.cache.delete(e)}}invalidate(r){return Zi(this,null,function*(){const e=r.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(r.getKey());const t=new Promise((n,i)=>{this.getHeader(r).then(o=>{n(),this.invalidations.delete(e)}).catch(o=>{i(o)})});this.invalidations.set(e,t)})}},u0=class{constructor(r,e,t){typeof r=="string"?this.source=new y4(r):this.source=r,t?this.decompress=t:this.decompress=ov,e?this.cache=e:this.cache=new k4}getHeader(){return Zi(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,e,t,n){return Zi(this,null,function*(){const i=m4(r,e,t),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return iv.getZxy(o,this.source,this.cache,r,e,t,n);if(r<o.minZoom||r>o.maxZoom)return;let u=o.rootDirectoryOffset,a=o.rootDirectoryLength;for(let d=0;d<=3;d++){const p=yield this.cache.getDirectory(this.source,u,a,o),g=g4(p,i);if(g){if(g.runLength>0){const y=yield this.source.getBytes(o.tileDataOffset+g.offset,g.length,n,o.etag);return{data:yield this.decompress(y.data,o.tileCompression),cacheControl:y.cacheControl,expires:y.expires}}u=o.leafDirectoryOffset+g.offset,a=g.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,e,t,n){return Zi(this,null,function*(){try{return yield this.getZxyAttempt(r,e,t,n)}catch(i){if(i instanceof um)return this.cache.invalidate(this.source),yield this.getZxyAttempt(r,e,t,n);throw i}})}getMetadataAttempt(){return Zi(this,null,function*(){const r=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength,void 0,r.etag),t=yield this.decompress(e.data,r.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(t))})}getMetadata(){return Zi(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof um)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw r}})}};function S4(r){let e;const t=r[16].default,n=En(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&An(n,t,i,i[24],e?In(t,i[24],o,null):Pn(i[24]),null)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function C4(r){let e,t,n;function i(u){r[17](u)}let o={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[S4]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new bd({props:o}),un.push(()=>Cn(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){de(e.$$.fragment)},m(u,a){he(e,u,a),n=!0},p(u,[a]){const d={};a&2&&(d.id=u[1]),a&4&&(d.source=u[2]),a&8&&(d.sourceLayer=u[3]),a&16&&(d.beforeId=u[4]),a&32&&(d.beforeLayerType=u[5]),a&64&&(d.paint=u[6]),a&128&&(d.layout=u[7]),a&256&&(d.filter=u[8]),a&512&&(d.applyToClusters=u[9]),a&1024&&(d.minzoom=u[10]),a&2048&&(d.maxzoom=u[11]),a&4096&&(d.hoverCursor=u[12]),a&8192&&(d.manageHoverState=u[13]),a&16384&&(d.eventsIfTopMost=u[14]),a&32768&&(d.interactive=u[15]),a&16777216&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.hovered=u[0],Sn(()=>t=!1)),e.$set(d)},i(u){n||(j(e.$$.fragment,u),n=!0)},o(u){G(e.$$.fragment,u),n=!1},d(u){fe(e,u)}}}function T4(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=ml("symbol")}=e,{source:u=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g=void 0}=e,{layout:y=void 0}=e,{filter:w=void 0}=e,{applyToClusters:T=void 0}=e,{minzoom:L=void 0}=e,{maxzoom:D=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:z=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:F=!1}=e,{interactive:N=!0}=e;function W(ae){I=ae,t(0,I)}function se(ae){Mn.call(this,r,ae)}function J(ae){Mn.call(this,r,ae)}function Y(ae){Mn.call(this,r,ae)}function _e(ae){Mn.call(this,r,ae)}function ze(ae){Mn.call(this,r,ae)}function ee(ae){Mn.call(this,r,ae)}return r.$$set=ae=>{"id"in ae&&t(1,o=ae.id),"source"in ae&&t(2,u=ae.source),"sourceLayer"in ae&&t(3,a=ae.sourceLayer),"beforeId"in ae&&t(4,d=ae.beforeId),"beforeLayerType"in ae&&t(5,p=ae.beforeLayerType),"paint"in ae&&t(6,g=ae.paint),"layout"in ae&&t(7,y=ae.layout),"filter"in ae&&t(8,w=ae.filter),"applyToClusters"in ae&&t(9,T=ae.applyToClusters),"minzoom"in ae&&t(10,L=ae.minzoom),"maxzoom"in ae&&t(11,D=ae.maxzoom),"hoverCursor"in ae&&t(12,R=ae.hoverCursor),"manageHoverState"in ae&&t(13,z=ae.manageHoverState),"hovered"in ae&&t(0,I=ae.hovered),"eventsIfTopMost"in ae&&t(14,F=ae.eventsIfTopMost),"interactive"in ae&&t(15,N=ae.interactive),"$$scope"in ae&&t(24,i=ae.$$scope)},[I,o,u,a,d,p,g,y,w,T,L,D,R,z,F,N,n,W,se,J,Y,_e,ze,ee,i]}class ph extends It{constructor(e){super(),Et(this,e,T4,C4,xt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function h0(r){let e=r[0],t,n,i=f0(r);return{c(){i.c(),t=Jn()},m(o,u){i.m(o,u),q(o,t,u),n=!0},p(o,u){u&1&&xt(e,e=o[0])?(tn(),G(i,1,1,rt),nn(),i=f0(o),i.c(),j(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(j(i),n=!0)},o(o){G(i),n=!1},d(o){o&&V(t),i.d(o)}}}function f0(r){let e;const t=r[15].default,n=En(t,r,r[14],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16384)&&An(n,t,i,i[14],e?In(t,i[14],o,null):Pn(i[14]),null)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function M4(r){let e,t,n=r[0]&&h0(r);return{c(){n&&n.c(),e=Jn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&j(n,1)):(n=h0(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),G(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){G(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function L4(r,e,t){let n,i,{$$slots:o={},$$scope:u}=e,{id:a=ml("vector")}=e,{url:d=null}=e,{tiles:p=null}=e,{promoteId:g=null}=e,{bounds:y=null}=e,{scheme:w=null}=e,{attribution:T=null}=e,{minzoom:L=null}=e,{maxzoom:D=null}=e,{volatile:R=null}=e;if(d&&d.includes("pmtiles://")&&!ei.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let N=new h4;ei.addProtocol("pmtiles",N.tile)}const{map:z,self:I}=jb();st(r,z,N=>t(13,i=N)),st(r,I,N=>t(0,n=N));let F;return ti(()=>{n&&i&&(qb(z,n,F),Ot(I,n=null,n),F=void 0)}),r.$$set=N=>{"id"in N&&t(3,a=N.id),"url"in N&&t(4,d=N.url),"tiles"in N&&t(5,p=N.tiles),"promoteId"in N&&t(6,g=N.promoteId),"bounds"in N&&t(7,y=N.bounds),"scheme"in N&&t(8,w=N.scheme),"attribution"in N&&t(9,T=N.attribution),"minzoom"in N&&t(10,L=N.minzoom),"maxzoom"in N&&t(11,D=N.maxzoom),"volatile"in N&&t(12,R=N.volatile),"$$scope"in N&&t(14,u=N.$$scope)},r.$$.update=()=>{r.$$.dirty&16377&&i&&n!==a&&(Ot(I,n=a,n),Vb(i,n,Sa({type:"vector",url:d,tiles:p,promoteId:g,bounds:y,scheme:w,attribution:T,minzoom:L,maxzoom:D,volatile:R}),N=>i&&N===n,()=>{n&&(F=i==null?void 0:i.getSource(n))})),r.$$.dirty&8200&&(i==null||i.on("style.load",()=>{F=i==null?void 0:i.getSource(a)}))},[n,z,I,a,d,p,g,y,w,T,L,D,R,i,u,o]}class Mh extends It{constructor(e){super(),Et(this,e,L4,M4,xt,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}function E4(r){let e,t,n,i,o,u,a,d,p;return{c(){e=U("label"),t=xe(`Basemap:
  `),n=U("select"),i=U("option"),i.textContent="MapTiler Dataviz",o=U("option"),o.textContent="MapTiler Streets",u=U("option"),u.textContent="MapTiler Satellite",a=U("option"),a.textContent="OS Open Zoomstack",i.__value="dataviz",qn(i,i.__value),o.__value="streets-v2",qn(o,o.__value),u.__value="hybrid",qn(u,u.__value),a.__value="uk-openzoomstack-light",qn(a,a.__value),r[0]===void 0&&ls(()=>r[1].call(n))},m(g,y){q(g,e,y),$(e,t),$(e,n),$(n,i),$(n,o),$(n,u),$(n,a),qi(n,r[0],!0),d||(p=yt(n,"change",r[1]),d=!0)},p(g,[y]){y&1&&qi(n,g[0])},i:rt,o:rt,d(g){g&&V(e),d=!1,p()}}}function I4(r,e,t){let n;st(r,nm,o=>t(0,n=o));function i(){n=va(this),nm.set(n)}return[n,i]}class A4 extends It{constructor(e){super(),Et(this,e,I4,E4,xt,{})}}const P4=r=>({}),d0=r=>({}),z4=r=>({}),p0=r=>({});function m0(r){let e,t;return e=new Wm({props:{color:"var(--pico-secondary-inverse)",$$slots:{default:[D4]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&64&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function D4(r){let e,t;const n=r[3].help,i=En(n,r,r[6],p0);return{c(){e=U("div"),i&&i.c(),ue(e,"class","context-layer-help-content")},m(o,u){q(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&64)&&An(i,n,o,o[6],t?In(n,o[6],u,z4):Pn(o[6]),p0)},i(o){t||(j(i,o),t=!0)},o(o){G(i,o),t=!1},d(o){o&&V(e),i&&i.d(o)}}}function _0(r){let e,t;const n=r[3].legend,i=En(n,r,r[6],d0);return{c(){e=U("div"),i&&i.c(),ue(e,"class","legend svelte-wh5rsr")},m(o,u){q(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&64)&&An(i,n,o,o[6],t?In(n,o[6],u,P4):Pn(o[6]),d0)},i(o){t||(j(i,o),t=!0)},o(o){G(i,o),t=!1},d(o){o&&V(e),i&&i.d(o)}}}function R4(r){let e,t,n,i,o,u,a,d,p,g,y=r[2].help&&m0(r),w=r[0]&&r[2].legend&&_0(r);return{c(){e=U("button"),t=U("input"),n=oe(),i=xe(r[1]),o=oe(),y&&y.c(),u=oe(),w&&w.c(),a=Jn(),ut(t,"aspect-ratio","1.0"),ue(t,"type","checkbox"),ut(e,"display","flex"),ut(e,"align-items","center"),ut(e,"justify-content","leading"),ut(e,"gap","8px"),ut(e,"text-align","left"),ue(e,"class","secondary")},m(T,L){q(T,e,L),$(e,t),t.checked=r[0],$(e,n),$(e,i),$(e,o),y&&y.m(e,null),q(T,u,L),w&&w.m(T,L),q(T,a,L),d=!0,p||(g=[yt(t,"change",r[4]),yt(e,"click",r[5])],p=!0)},p(T,[L]){L&1&&(t.checked=T[0]),(!d||L&2)&&St(i,T[1]),T[2].help?y?(y.p(T,L),L&4&&j(y,1)):(y=m0(T),y.c(),j(y,1),y.m(e,null)):y&&(tn(),G(y,1,1,()=>{y=null}),nn()),T[0]&&T[2].legend?w?(w.p(T,L),L&5&&j(w,1)):(w=_0(T),w.c(),j(w,1),w.m(a.parentNode,a)):w&&(tn(),G(w,1,1,()=>{w=null}),nn())},i(T){d||(j(y),j(w),d=!0)},o(T){G(y),G(w),d=!1},d(T){T&&(V(e),V(u),V(a)),y&&y.d(),w&&w.d(T),p=!1,mr(g)}}}function $4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=Im(n);let{label:u}=e,{show:a=!1}=e;function d(){a=this.checked,t(0,a)}const p=()=>t(0,a=!a);return r.$$set=g=>{"label"in g&&t(1,u=g.label),"show"in g&&t(0,a=g.show),"$$scope"in g&&t(6,i=g.$$scope)},[a,u,o,n,d,p,i]}class Yo extends It{constructor(e){super(),Et(this,e,$4,R4,xt,{label:1,show:0})}}let Kf=Ln(!0);function F4(r){let e,t;return e=new Pi({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:r[0]?"none":"visible"}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.layout={visibility:n[0]?"none":"visible"}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function B4(r){let e,t;return e=new dr({props:{data:r[1],$$slots:{default:[F4]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,[i]){const o={};i&5&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function O4(r,e,t){let n;return st(r,Kf,o=>t(0,n=o)),[n,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class N4 extends It{constructor(e){super(),Et(this,e,O4,B4,xt,{})}}function j4(r){let e,t;return e=new vd({props:{lngLat:r[0],$$slots:{default:[V4]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.lngLat=n[0]),i&16&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function U4(r){let e,t,n;function i(u){r[3](u)}let o={draggable:!0,$$slots:{default:[q4]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.lngLat=r[0]),e=new vd({props:o}),un.push(()=>Cn(e,"lngLat",i)),{c(){de(e.$$.fragment)},m(u,a){he(e,u,a),n=!0},p(u,a){const d={};a&16&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.lngLat=u[0],Sn(()=>t=!1)),e.$set(d)},i(u){n||(j(e.$$.fragment,u),n=!0)},o(u){G(e.$$.fragment,u),n=!1},d(u){fe(e,u)}}}function V4(r){let e,t;const n=r[2].default,i=En(n,r,r[4],null);return{c(){e=U("span"),i&&i.c(),ue(e,"class","dot svelte-nb4dgc")},m(o,u){q(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&16)&&An(i,n,o,o[4],t?In(n,o[4],u,null):Pn(o[4]),null)},i(o){t||(j(i,o),t=!0)},o(o){G(i,o),t=!1},d(o){o&&V(e),i&&i.d(o)}}}function q4(r){let e,t;const n=r[2].default,i=En(n,r,r[4],null);return{c(){e=U("span"),i&&i.c(),ue(e,"class","dot svelte-nb4dgc")},m(o,u){q(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&16)&&An(i,n,o,o[4],t?In(n,o[4],u,null):Pn(o[4]),null)},i(o){t||(j(i,o),t=!0)},o(o){G(i,o),t=!1},d(o){o&&V(e),i&&i.d(o)}}}function Z4(r){let e,t,n,i;const o=[U4,j4],u=[];function a(d,p){return d[1]?0:1}return e=a(r),t=u[e]=o[e](r),{c(){t.c(),n=Jn()},m(d,p){u[e].m(d,p),q(d,n,p),i=!0},p(d,[p]){let g=e;e=a(d),e===g?u[e].p(d,p):(tn(),G(u[g],1,1,()=>{u[g]=null}),nn(),t=u[e],t?t.p(d,p):(t=u[e]=o[e](d),t.c()),j(t,1),t.m(n.parentNode,n))},i(d){i||(j(t),i=!0)},o(d){G(t),i=!1},d(d){d&&V(n),u[e].d(d)}}}function G4(r,e,t){let{$$slots:n={},$$scope:i}=e,{lngLat:o}=e,{draggable:u=!1}=e;function a(d){o=d,t(0,o)}return r.$$set=d=>{"lngLat"in d&&t(0,o=d.lngLat),"draggable"in d&&t(1,u=d.draggable),"$$scope"in d&&t(4,i=d.$$scope)},[o,u,n,a,i]}class pl extends It{constructor(e){super(),Et(this,e,G4,Z4,xt,{lngLat:0,draggable:1})}}function H4(r){let e,t,n;const i=r[2].default,o=En(i,r,r[5],null);return{c(){e=U("h2"),e.textContent="Help",t=oe(),o&&o.c()},m(u,a){q(u,e,a),q(u,t,a),o&&o.m(u,a),n=!0},p(u,a){o&&o.p&&(!n||a&32)&&An(o,i,u,u[5],n?In(i,u[5],a,null):Pn(u[5]),null)},i(u){n||(j(o,u),n=!0)},o(u){G(o,u),n=!1},d(u){u&&(V(e),V(t)),o&&o.d(u)}}}function W4(r){let e,t,n,i,o,u,a,d;t=new bk({props:{color:r[0]}});function p(y){r[4](y)}let g={$$slots:{default:[H4]},$$scope:{ctx:r}};return r[1]!==void 0&&(g.show=r[1]),i=new _d({props:g}),un.push(()=>Cn(i,"show",p)),{c(){e=U("button"),de(t.$$.fragment),n=oe(),de(i.$$.fragment),ue(e,"class","icon-btn help svelte-my65h"),ue(e,"title","Help")},m(y,w){q(y,e,w),he(t,e,null),q(y,n,w),he(i,y,w),u=!0,a||(d=yt(e,"click",eh(r[3])),a=!0)},p(y,[w]){const T={};w&1&&(T.color=y[0]),t.$set(T);const L={};w&32&&(L.$$scope={dirty:w,ctx:y}),!o&&w&2&&(o=!0,L.show=y[1],Sn(()=>o=!1)),i.$set(L)},i(y){u||(j(t.$$.fragment,y),j(i.$$.fragment,y),u=!0)},o(y){G(t.$$.fragment,y),G(i.$$.fragment,y),u=!1},d(y){y&&(V(e),V(n)),fe(t),fe(i,y),a=!1,d()}}}function K4(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!1,{color:u="black"}=e;const a=()=>t(1,o=!0);function d(p){o=p,t(1,o)}return r.$$set=p=>{"color"in p&&t(0,u=p.color),"$$scope"in p&&t(5,i=p.$$scope)},[u,o,n,a,d,i]}class Wm extends It{constructor(e){super(),Et(this,e,K4,W4,xt,{color:0})}}function X4(r){let e,t,n,i;const o=r[1].default,u=En(o,r,r[0],null);return{c(){e=U("a"),u&&u.c(),ue(e,"href","#")},m(a,d){q(a,e,d),u&&u.m(e,null),t=!0,n||(i=yt(e,"click",Am(r[2])),n=!0)},p(a,[d]){u&&u.p&&(!t||d&1)&&An(u,o,a,a[0],t?In(o,a[0],d,null):Pn(a[0]),null)},i(a){t||(j(u,a),t=!0)},o(a){G(u,a),t=!1},d(a){a&&V(e),u&&u.d(a),n=!1,i()}}}function J4(r,e,t){let{$$slots:n={},$$scope:i}=e;function o(u){Mn.call(this,r,u)}return r.$$set=u=>{"$$scope"in u&&t(0,i=u.$$scope)},[i,n,o]}class Rn extends It{constructor(e){super(),Et(this,e,J4,X4,xt,{})}}function Y4(r){let e,t,n,i,o,u=r[0]+1+"",a,d,p=r[1].length+"",g,y,w,T,L,D,R;return{c(){e=U("div"),t=U("button"),n=xe("Previous"),o=oe(),a=xe(u),d=xe(" / "),g=xe(p),y=oe(),w=U("button"),T=xe("Next"),t.disabled=i=r[0]==0,ue(t,"data-tooltip","Left"),w.disabled=L=r[0]==r[1].length-1,ue(w,"data-tooltip","Right"),ut(e,"display","flex"),ut(e,"justify-content","space-between"),ut(e,"align-items","center")},m(z,I){q(z,e,I),$(e,t),$(t,n),$(e,o),$(e,a),$(e,d),$(e,g),$(e,y),$(e,w),$(w,T),D||(R=[yt(window,"keydown",r[2]),yt(t,"click",r[3]),yt(w,"click",r[4])],D=!0)},p(z,[I]){I&1&&i!==(i=z[0]==0)&&(t.disabled=i),I&1&&u!==(u=z[0]+1+"")&&St(a,u),I&2&&p!==(p=z[1].length+"")&&St(g,p),I&3&&L!==(L=z[0]==z[1].length-1)&&(w.disabled=L)},i:rt,o:rt,d(z){z&&V(e),D=!1,mr(R)}}}function Q4(r,e,t){let n;st(r,Do,p=>t(5,n=p));let{list:i}=e,{idx:o=0}=e;Ts(()=>{n==null||n.keyboard.disable()}),ti(()=>{n==null||n.keyboard.enable()});function u(p){p.key=="ArrowLeft"&&(p.stopPropagation(),a()),p.key=="ArrowRight"&&(p.stopPropagation(),d())}function a(){o!=0&&t(0,o--,o)}function d(){o!=i.length-1&&t(0,o++,o)}return r.$$set=p=>{"list"in p&&t(1,i=p.list),"idx"in p&&t(0,o=p.idx)},[o,i,u,a,d]}class wd extends It{constructor(e){super(),Et(this,e,Q4,Y4,xt,{list:1,idx:0})}}function g0(r,e,t){const n=r.slice();return n[4]=e[t][0],n[5]=e[t][1],n}function y0(r){let e,t,n,i,o=r[4]+"",u,a;return{c(){e=U("div"),t=U("span"),i=oe(),u=xe(o),a=oe(),ue(t,"class",n="color-swatch "+r[1]+" svelte-1enycr6"),ut(t,"background",r[5]),ut(e,"display","flex"),ut(e,"align-items","center"),ut(e,"gap","6px")},m(d,p){q(d,e,p),$(e,t),$(e,i),$(e,u),$(e,a)},p(d,p){p&2&&n!==(n="color-swatch "+d[1]+" svelte-1enycr6")&&ue(t,"class",n),p&1&&ut(t,"background",d[5]),p&1&&o!==(o=d[4]+"")&&St(u,o)},d(d){d&&V(e)}}}function eS(r){let e,t=$n(Object.entries(r[0])),n=[];for(let i=0;i<t.length;i+=1)n[i]=y0(g0(r,t,i));return{c(){e=U("div");for(let i=0;i<n.length;i+=1)n[i].c();ut(e,"display","grid"),ut(e,"grid-template-columns","repeat(auto-fill, calc("+r[2]+" - 10px))"),ut(e,"gap","10px")},m(i,o){q(i,e,o);for(let u=0;u<n.length;u+=1)n[u]&&n[u].m(e,null)},p(i,[o]){if(o&3){t=$n(Object.entries(i[0]));let u;for(u=0;u<t.length;u+=1){const a=g0(i,t,u);n[u]?n[u].p(a,o):(n[u]=y0(a),n[u].c(),n[u].m(e,null))}for(;u<n.length;u+=1)n[u].d(1);n.length=t.length}},i:rt,o:rt,d(i){i&&V(e),mi(n,i)}}}function tS(r,e,t){let{labelColors:n}=e,{swatchClass:i="rectangle"}=e,{itemsPerRow:o=2}=e,u=`${100/o}%`;return r.$$set=a=>{"labelColors"in a&&t(0,n=a.labelColors),"swatchClass"in a&&t(1,i=a.swatchClass),"itemsPerRow"in a&&t(3,o=a.itemsPerRow)},[n,i,u,o]}class Km extends It{constructor(e){super(),Et(this,e,tS,eS,xt,{labelColors:0,swatchClass:1,itemsPerRow:3})}}function b0(r,e,t){const n=r.slice();return n[6]=e[t],n}function v0(r,e,t){const n=r.slice();return n[9]=e[t],n}function w0(r){let e,t;return{c(){e=U("span"),t=xe(""),ue(e,"class","bucket svelte-3plrz9"),ut(e,"background",r[9])},m(n,i){q(n,e,i),$(e,t)},p(n,i){i&1&&ut(e,"background",n[9])},d(n){n&&V(e)}}}function x0(r){let e;return{c(){e=U("span"),e.textContent=`${r[6]}`,ue(e,"class","svelte-3plrz9")},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function nS(r){let e,t,n,i,o=$n(r[0]),u=[];for(let p=0;p<o.length;p+=1)u[p]=w0(v0(r,o,p));let a=$n(r[3]),d=[];for(let p=0;p<a.length;p+=1)d[p]=x0(b0(r,a,p));return{c(){e=U("div"),t=U("div");for(let p=0;p<u.length;p+=1)u[p].c();n=oe(),i=U("div");for(let p=0;p<d.length;p+=1)d[p].c();ue(t,"class","colors svelte-3plrz9"),ue(i,"class","labels svelte-3plrz9"),ue(e,"class","svelte-3plrz9"),Yt(e,"full-width-bucket-legend",r[2]),Yt(e,"bucketed",r[1].hasOwnProperty("buckets")),Yt(e,"limits",r[1].hasOwnProperty("limits"))},m(p,g){q(p,e,g),$(e,t);for(let y=0;y<u.length;y+=1)u[y]&&u[y].m(t,null);$(e,n),$(e,i);for(let y=0;y<d.length;y+=1)d[y]&&d[y].m(i,null)},p(p,[g]){if(g&1){o=$n(p[0]);let y;for(y=0;y<o.length;y+=1){const w=v0(p,o,y);u[y]?u[y].p(w,g):(u[y]=w0(w),u[y].c(),u[y].m(t,null))}for(;y<u.length;y+=1)u[y].d(1);u.length=o.length}if(g&8){a=$n(p[3]);let y;for(y=0;y<a.length;y+=1){const w=b0(p,a,y);d[y]?d[y].p(w,g):(d[y]=x0(w),d[y].c(),d[y].m(i,null))}for(;y<d.length;y+=1)d[y].d(1);d.length=a.length}g&4&&Yt(e,"full-width-bucket-legend",p[2]),g&2&&Yt(e,"bucketed",p[1].hasOwnProperty("buckets")),g&2&&Yt(e,"limits",p[1].hasOwnProperty("limits"))},i:rt,o:rt,d(p){p&&V(e),mi(u,p),mi(d,p)}}}function rS(r,e,t){let{colorScale:n}=e,{labels:i}=e,{decimalPlaces:o=0}=e,{fullWidthBucketLegend:u=!1}=e,a=[];"limits"in i?a=i.limits:a=i.buckets;let d=a.map(p=>typeof p=="number"?o>0?p.toFixed(o):p.toLocaleString():p);return r.$$set=p=>{"colorScale"in p&&t(0,n=p.colorScale),"labels"in p&&t(1,i=p.labels),"decimalPlaces"in p&&t(4,o=p.decimalPlaces),"fullWidthBucketLegend"in p&&t(2,u=p.fullWidthBucketLegend)},[n,i,u,d,o]}class Fo extends It{constructor(e){super(),Et(this,e,rS,nS,xt,{colorScale:0,labels:1,decimalPlaces:4,fullWidthBucketLegend:2})}}function iS(r,e){let t=new Set(r.getStyle().layers.filter(n=>n.type=="line").map(n=>n.id));return e=="dataviz"?["Road network","Path"].filter(n=>t.has(n)):e=="hybrid"?["Path","Road","Tunnel"].filter(n=>t.has(n)):e=="streets-v2"?r.getStyle().layers.filter(n=>n["source-layer"]=="transportation"&&n.type=="line").map(n=>n.id):e=="uk-openzoomstack-light"?r.getStyle().layers.filter(n=>n["source-layer"]=="roads"&&n.type=="line").map(n=>n.id):[]}const{window:oS}=pb;function sS(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L,D;return T=Pm(r[8][0]),{c(){e=U("button"),e.textContent="Stop StreetView",t=oe(),n=U("fieldset"),i=U("legend"),i.textContent="Source:",o=oe(),u=U("label"),a=U("input"),d=xe(`
      Google Street View`),p=oe(),g=U("label"),y=U("input"),w=xe(`
      Bing Streetside`),ue(e,"class","secondary"),ue(a,"type","radio"),a.__value="google",qn(a,a.__value),ue(y,"type","radio"),y.__value="bing",qn(y,y.__value),T.p(a,y)},m(R,z){q(R,e,z),q(R,t,z),q(R,n,z),$(n,i),$(n,o),$(n,u),$(u,a),a.checked=a.__value===r[0],$(u,d),$(n,p),$(n,g),$(g,y),y.checked=y.__value===r[0],$(g,w),L||(D=[yt(e,"click",r[3]),yt(a,"change",r[7]),yt(y,"change",r[9])],L=!0)},p(R,z){z&1&&(a.checked=a.__value===R[0]),z&1&&(y.checked=y.__value===R[0])},d(R){R&&(V(e),V(t),V(n)),T.r(),L=!1,mr(D)}}}function aS(r){let e,t,n;return{c(){e=U("button"),e.textContent="StreetView",ue(e,"class","secondary")},m(i,o){q(i,e,o),t||(n=yt(e,"click",r[2]),t=!0)},p:rt,d(i){i&&V(e),t=!1,n()}}}function lS(r){let e,t,n;function i(a,d){return a[1]?aS:sS}let o=i(r),u=o(r);return{c(){u.c(),e=Jn()},m(a,d){u.m(a,d),q(a,e,d),t||(n=yt(oS,"keydown",r[4]),t=!0)},p(a,[d]){o===(o=i(a))&&u?u.p(a,d):(u.d(1),u=o(a),u&&(u.c(),u.m(e.parentNode,e)))},i:rt,o:rt,d(a){a&&V(e),u.d(a),t=!1,n()}}}function cS(r,e,t){let n;st(r,Kf,D=>t(1,n=D));let{map:i}=e,{maptilerBasemap:o}=e,u="google",a=[];function d(){Ot(Kf,n=!1,n),i.on("click",g),i.getCanvas().style.cursor="crosshair";for(let D of iS(i,o))a.push([D,i.getPaintProperty(D,"line-color")]),i.setPaintProperty(D,"line-color","cyan")}function p(){Ot(Kf,n=!0,n),i.off("click",g),i.getCanvas().style.cursor="inherit";for(let[D,R]of a)i.setPaintProperty(D,"line-color",R);a=[]}ti(p);function g(D){let R=D.lngLat.lng,z=D.lngLat.lat;u=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${z},${R}&cbp=11,0,0,0,0`,"_blank"):u=="bing"&&window.open(`https://www.bing.com/maps?cp=${z}~${R}&style=x`,"_blank")}function y(D){!n&&D.key=="Escape"&&(D.stopPropagation(),p())}const w=[[]];function T(){u=this.__value,t(0,u)}function L(){u=this.__value,t(0,u)}return r.$$set=D=>{"map"in D&&t(5,i=D.map),"maptilerBasemap"in D&&t(6,o=D.maptilerBasemap)},[u,n,d,p,y,i,o,T,w,L]}class uS extends It{constructor(e){super(),Et(this,e,cS,lS,xt,{map:5,maptilerBasemap:6})}}function dn(r,e=!0){return{id:r,beforeId:hS(r),eventsIfTopMost:e}}function hS(r){let e=pi(Do);if(!e){console.warn(`getBeforeId(${r}) called before map is ready. Z-ordering may be incorrect.`);return}let t,n=!1;for(let i=k0.length-1;i>=0;i--){let o=k0[i];if(o==r){n=!0;break}e.getLayer(o)&&(t=o)}if(!n)throw new Error(`Layer ID ${r} not defined in layerZorder`);return t}let qp=r=>r,Zp=r=>r;const k0=[qp(Zp("Background")),"neighbourhood-boundaries",qp("Ferry line"),"neighbourhood-boundaries-outline","neighbourhood-boundaries-selected-outline-base","neighbourhood-boundaries-selected-outline","debug-borders","debug-filters","cells","main-roads-outlines","main-roads","interior-roads-outlines","interior-roads","turn-restriction-targets","debug-intersections","debug-movements-outline","debug-movements-fill","debug-editable-intersections","editable-intersections","intersection-filters","compare-route","shortcuts","shortcuts-focus","predict-impact-outline","predict-impact",Zp("Building"),"draw-area-lines","draw-area-area","draw-area-lines-preview","debug-demand-fill","debug-demand-outline","one-ways","context-population-car-ownership","context-simd","context-population-density","context-population-outline","context-traffic","context-los","context-existing-infra","context-route-network","context-bus-routes","context-pois","context-railway-stations","context-stats19",Zp("Road labels"),qp("road_label"),"animate-shortcuts","modal-filters","turn-restrictions","turn-restrictions-debug-arrows","boundary","neighbourhood-boundary","border-arrows","border-arrow-outlines","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];let av=["#8a9a5b","#ffc300","#cc5500","#c70039","#900c3f","#581845"],lv=[20,30,40,50,60,70],gl=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],xd=gl,kd=[0,20,40,60,80,100],Sd=gl.toReversed(),Cd=[0,1300,3e3,4200,5900,52e3],Xf=gl.toReversed(),fS=[0,.3,.6,1,1.5,2],dS=gl.toReversed(),cv=[0,1,10,50,100,1e3],uv=gl.toReversed(),hv=[0,1,10,50,100,1e3],fv=gl.toReversed(),Td=[0,20,40,60,80,100],Md=gl;function dv(r){let e=[];for(let t=1;t<r.length;t++)e.push(t);return e}const pS="#0C793A",po={mapFeature:{hover:{backgroundColor:"rgb(72, 96, 202)"}}};function Us(r){return["interpolate",["linear"],["zoom"],5,.5+r,10,1+r,12,1.5+r,14,4+r,16,7+r,20,24+r]}function Ca(r){return r<1e3?Math.round(r)+"m":(r/1e3).toFixed(1)+"km"}function Ta(r){if(r<60)return Math.round(r)+"s";let e=Math.floor(r/60),t=Math.round(r-e*60);return`${e}m${t}s`}function Pc(r,e){return e===0?"0%":`${Math.round(r/e*100)}%`}function ah(r){return r?pi(Ro)=="cnt"?fm(r,"LAD_"):r:"custom area"}function pv(r){let e=pi(Xs).project(r),t=new Date().toISOString().split("T")[0],n=`${e.project_name}-${t}.geojson`;gd(n,JSON.stringify(e))}function hm(r,e=4){return["interpolate",["exponential",2],["zoom"],0,["max",["/",r,15654.303392],e],22,["max",["/",r,.0597164283],e]]}async function ya(r){let e=await fetch(r);if(!e.ok)throw new Error(`${r} not OK: ${e.status}`);return e}function S0(r){return r.reduce((e,t)=>e+t,0)}function fm(r,e){return r.startsWith(e)?r.slice(e.length):r}function C0(r,e){return r.endsWith(e)?r.slice(0,-e.length):r}function mS(r){let e;return{c(){e=U("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:route%3Dbus" target="_blank">bus routes</a>
    according to OpenStreetMap.`,ue(e,"slot","help")},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function _S(r){let e,t;const n=[dn("context-bus-routes"),{sourceLayer:"bus_routes"},{paint:{"line-color":"blue","line-width":Us(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let i={};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new tr({props:i}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,u){const a=u&1?Zn(n,[n[0],n[1],n[2],{layout:{visibility:o[0]?"visible":"none"}}]):{};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function gS(r){let e,t,n,i,o;function u(d){r[1](d)}let a={label:"Bus routes",$$slots:{help:[mS]},$$scope:{ctx:r}};return r[0]!==void 0&&(a.show=r[0]),e=new Yo({props:a}),un.push(()=>Cn(e,"show",u)),i=new Mh({props:{url:`pmtiles://${Ao("cnt_layers/bus_routes.pmtiles")}`,$$slots:{default:[_S]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment),n=oe(),de(i.$$.fragment)},m(d,p){he(e,d,p),q(d,n,p),he(i,d,p),o=!0},p(d,[p]){const g={};p&4&&(g.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,g.show=d[0],Sn(()=>t=!1)),e.$set(g);const y={};p&5&&(y.$$scope={dirty:p,ctx:d}),i.$set(y)},i(d){o||(j(e.$$.fragment,d),j(i.$$.fragment,d),o=!0)},o(d){G(e.$$.fragment,d),G(i.$$.fragment,d),o=!1},d(d){d&&V(n),fe(e,d),fe(i,d)}}}function yS(r,e,t){let n=!1;function i(o){n=o,t(0,n)}return[n,i]}class bS extends It{constructor(e){super(),Et(this,e,yS,gS,xt,{})}}var vS=Object.defineProperty,mv=r=>{throw TypeError(r)},wS=(r,e,t)=>e in r?vS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Mo=(r,e,t)=>wS(r,typeof e!="symbol"?e+"":e,t),_v=(r,e,t)=>e.has(r)||mv("Cannot "+t),yi=(r,e,t)=>(_v(r,e,"read from private field"),t?t.call(r):e.get(r)),T0=(r,e,t)=>e.has(r)?mv("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),M0=(r,e,t,n)=>(_v(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);function Br(){}function xS(r,e){for(const t in e)r[t]=e[t];return r}function gv(r){return r()}function L0(){return Object.create(null)}function Js(r){r.forEach(gv)}function yv(r){return typeof r=="function"}function Aa(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let jf;function Gi(r,e){return r===e?!0:(jf||(jf=document.createElement("a")),jf.href=e,r===jf.href)}function kS(r){return Object.keys(r).length===0}function SS(r,e,t,n){if(r){const i=bv(r,e,t,n);return r[0](i)}}function bv(r,e,t,n){return r[1]&&n?xS(t.ctx.slice(),r[1](n(e))):t.ctx}function CS(r,e,t,n){if(r[2]&&n){const i=r[2](n(t));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],u=Math.max(e.dirty.length,i.length);for(let a=0;a<u;a+=1)o[a]=e.dirty[a]|i[a];return o}return e.dirty|i}return e.dirty}function TS(r,e,t,n,i,o){if(i){const u=bv(e,t,n,o);r.p(u,i)}}function MS(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function E0(r){return r??""}function Xn(r,e){r.appendChild(e)}function Ur(r,e,t){r.insertBefore(e,t||null)}function Or(r){r.parentNode&&r.parentNode.removeChild(r)}function br(r){return document.createElement(r)}function fs(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Ma(r){return document.createTextNode(r)}function Io(){return Ma(" ")}function LS(){return Ma("")}function oo(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function ES(r){return function(e){return e.preventDefault(),r.call(this,e)}}function gt(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function IS(r){return Array.from(r.childNodes)}function mh(r,e){e=""+e,r.data!==e&&(r.data=e)}function I0(r,e){r.value=e??""}function Jo(r,e,t){r.classList.toggle(e,!!t)}function AS(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}let _h;function lh(r){_h=r}function vv(){if(!_h)throw new Error("Function called outside component initialization");return _h}function PS(r){vv().$$.on_destroy.push(r)}function zS(){const r=vv();return(e,t,{cancelable:n=!1}={})=>{const i=r.$$.callbacks[e];if(i){const o=AS(e,t,{cancelable:n});return i.slice().forEach(u=>{u.call(r,o)}),!o.defaultPrevented}return!0}}function A0(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const Sc=[],dm=[];let Ec=[];const P0=[],DS=Promise.resolve();let pm=!1;function RS(){pm||(pm=!0,DS.then(wv))}function mm(r){Ec.push(r)}const Gp=new Set;let vc=0;function wv(){if(vc!==0)return;const r=_h;do{try{for(;vc<Sc.length;){const e=Sc[vc];vc++,lh(e),$S(e.$$)}}catch(e){throw Sc.length=0,vc=0,e}for(lh(null),Sc.length=0,vc=0;dm.length;)dm.pop()();for(let e=0;e<Ec.length;e+=1){const t=Ec[e];Gp.has(t)||(Gp.add(t),t())}Ec.length=0}while(Sc.length);for(;P0.length;)P0.pop()();pm=!1,Gp.clear(),lh(r)}function $S(r){if(r.fragment!==null){r.update(),Js(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(mm)}}function FS(r){const e=[],t=[];Ec.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Ec=e}const Jf=new Set;let ul;function Yf(){ul={r:0,c:[],p:ul}}function Qf(){ul.r||Js(ul.c),ul=ul.p}function hi(r,e){r&&r.i&&(Jf.delete(r),r.i(e))}function Si(r,e,t,n){if(r&&r.o){if(Jf.has(r))return;Jf.add(r),ul.c.push(()=>{Jf.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function z0(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function BS(r,e){Si(r,1,1,()=>{e.delete(r.key)})}function OS(r,e,t,n,i,o,u,a,d,p,g,y){let w=r.length,T=o.length,L=w;const D={};for(;L--;)D[r[L].key]=L;const R=[],z=new Map,I=new Map,F=[];for(L=T;L--;){const J=y(i,o,L),Y=t(J);let _e=u.get(Y);_e?F.push(()=>_e.p(J,e)):(_e=p(Y,J),_e.c()),z.set(Y,R[L]=_e),Y in D&&I.set(Y,Math.abs(L-D[Y]))}const N=new Set,W=new Set;function se(J){hi(J,1),J.m(a,g),u.set(J.key,J),g=J.first,T--}for(;w&&T;){const J=R[T-1],Y=r[w-1],_e=J.key,ze=Y.key;J===Y?(g=J.first,w--,T--):z.has(ze)?!u.has(_e)||N.has(_e)?se(J):W.has(ze)?w--:I.get(_e)>I.get(ze)?(W.add(_e),se(J)):(N.add(ze),w--):(d(Y,u),w--)}for(;w--;){const J=r[w];z.has(J.key)||d(J,u)}for(;T;)se(R[T-1]);return Js(F),R}function La(r){r&&r.c()}function Ws(r,e,t){const{fragment:n,after_update:i}=r.$$;n&&n.m(e,t),mm(()=>{const o=r.$$.on_mount.map(gv).filter(yv);r.$$.on_destroy?r.$$.on_destroy.push(...o):Js(o),r.$$.on_mount=[]}),i.forEach(mm)}function Ks(r,e){const t=r.$$;t.fragment!==null&&(FS(t.after_update),Js(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function NS(r,e){r.$$.dirty[0]===-1&&(Sc.push(r),RS(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Pa(r,e,t,n,i,o,u=null,a=[-1]){const d=_h;lh(r);const p=r.$$={fragment:null,ctx:[],props:o,update:Br,not_equal:i,bound:L0(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:L0(),dirty:a,skip_bound:!1,root:e.target||d.$$.root};u&&u(p.root);let g=!1;if(p.ctx=t?t(r,e.props||{},(y,w,...T)=>{const L=T.length?T[0]:w;return p.ctx&&i(p.ctx[y],p.ctx[y]=L)&&(!p.skip_bound&&p.bound[y]&&p.bound[y](L),g&&NS(r,y)),w}):[],p.update(),g=!0,Js(p.before_update),p.fragment=n?n(p.ctx):!1,e.target){if(e.hydrate){const y=IS(e.target);p.fragment&&p.fragment.l(y),y.forEach(Or)}else p.fragment&&p.fragment.c();e.intro&&hi(r.$$.fragment),Ws(r,e.target,e.anchor),wv()}lh(d)}class za{constructor(){Mo(this,"$$"),Mo(this,"$$set")}$destroy(){Ks(this,1),this.$destroy=Br}$on(e,t){if(!yv(t))return Br;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!kS(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const jS="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(jS);function US(r){let e,t;return{c(){e=fs("svg"),t=fs("path"),gt(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),gt(e,"viewBox","0 0 14 14"),gt(e,"width","13"),gt(e,"height","13"),gt(e,"class","svelte-en2qvf")},m(n,i){Ur(n,e,i),Xn(e,t)},p:Br,i:Br,o:Br,d(n){n&&Or(e)}}}class xv extends za{constructor(e){super(),Pa(this,e,null,US,Aa,{})}}function VS(r){let e,t;return{c(){e=fs("svg"),t=fs("path"),gt(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),gt(e,"viewBox","0 0 30 30"),gt(e,"fill","none"),gt(e,"xmlns","http://www.w3.org/2000/svg"),gt(e,"class","svelte-d2loi5")},m(n,i){Ur(n,e,i),Xn(e,t)},p:Br,i:Br,o:Br,d(n){n&&Or(e)}}}class kv extends za{constructor(e){super(),Pa(this,e,null,VS,Aa,{})}}function qS(r){let e,t;return{c(){e=br("img"),Gi(e.src,t=r[3]+"area.svg")||gt(e,"src",t),gt(e,"alt",r[6]),gt(e,"class","svelte-ltkwvy")},m(n,i){Ur(n,e,i)},p(n,i){i&8&&!Gi(e.src,t=n[3]+"area.svg")&&gt(e,"src",t),i&64&&gt(e,"alt",n[6])},d(n){n&&Or(e)}}}function ZS(r){let e,t;return{c(){e=br("img"),Gi(e.src,t=r[3]+"reverse.svg")||gt(e,"src",t),gt(e,"alt",r[6]),gt(e,"class","svelte-ltkwvy")},m(n,i){Ur(n,e,i)},p(n,i){i&8&&!Gi(e.src,t=n[3]+"reverse.svg")&&gt(e,"src",t),i&64&&gt(e,"alt",n[6])},d(n){n&&Or(e)}}}function GS(r){let e,t;return{c(){e=br("img"),Gi(e.src,t=r[3]+"poi.svg")||gt(e,"src",t),gt(e,"alt",r[6]),gt(e,"class","svelte-ltkwvy")},m(n,i){Ur(n,e,i)},p(n,i){i&8&&!Gi(e.src,t=n[3]+"poi.svg")&&gt(e,"src",t),i&64&&gt(e,"alt",n[6])},d(n){n&&Or(e)}}}function HS(r){let e,t;return{c(){e=br("img"),Gi(e.src,t=r[3]+"postal_code.svg")||gt(e,"src",t),gt(e,"alt",r[6]),gt(e,"class","svelte-ltkwvy")},m(n,i){Ur(n,e,i)},p(n,i){i&8&&!Gi(e.src,t=n[3]+"postal_code.svg")&&gt(e,"src",t),i&64&&gt(e,"alt",n[6])},d(n){n&&Or(e)}}}function WS(r){let e,t;return{c(){e=br("img"),Gi(e.src,t=r[3]+"street.svg")||gt(e,"src",t),gt(e,"alt",r[6]),gt(e,"class","svelte-ltkwvy")},m(n,i){Ur(n,e,i)},p(n,i){i&8&&!Gi(e.src,t=n[3]+"street.svg")&&gt(e,"src",t),i&64&&gt(e,"alt",n[6])},d(n){n&&Or(e)}}}function KS(r){let e,t;return{c(){e=br("img"),Gi(e.src,t=r[3]+"road.svg")||gt(e,"src",t),gt(e,"alt",r[6]),gt(e,"class","svelte-ltkwvy")},m(n,i){Ur(n,e,i)},p(n,i){i&8&&!Gi(e.src,t=n[3]+"road.svg")&&gt(e,"src",t),i&64&&gt(e,"alt",n[6])},d(n){n&&Or(e)}}}function XS(r){let e,t;return{c(){e=br("img"),Gi(e.src,t=r[3]+"housenumber.svg")||gt(e,"src",t),gt(e,"alt",r[6]),gt(e,"class","svelte-ltkwvy")},m(n,i){Ur(n,e,i)},p(n,i){i&8&&!Gi(e.src,t=n[3]+"housenumber.svg")&&gt(e,"src",t),i&64&&gt(e,"alt",n[6])},d(n){n&&Or(e)}}}function JS(r){let e,t,n,i;return{c(){e=br("img"),Gi(e.src,t=r[5])||gt(e,"src",t),gt(e,"alt",r[4]),gt(e,"class","svelte-ltkwvy")},m(o,u){Ur(o,e,u),n||(i=oo(e,"error",r[14]),n=!0)},p(o,u){u&32&&!Gi(e.src,t=o[5])&&gt(e,"src",t),u&16&&gt(e,"alt",o[4])},d(o){o&&Or(e),n=!1,i()}}}function D0(r){let e,t;return{c(){e=br("span"),t=Ma(r[6]),gt(e,"class","secondary svelte-ltkwvy")},m(n,i){Ur(n,e,i),Xn(e,t)},p(n,i){i&64&&mh(t,n[6])},d(n){n&&Or(e)}}}function YS(r){let e,t,n,i,o,u,a,d,p,g=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",y,w,T=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],L,D,R=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",z,I,F;function N(Y,_e){return _e&1&&(t=null),_e&1&&(n=null),_e&1&&(i=null),_e&1&&(o=null),Y[5]?JS:Y[0].address?XS:(t==null&&(t=!!Y[0].id.startsWith("road.")),t?KS:(n==null&&(n=!!Y[0].id.startsWith("address.")),n?WS:(i==null&&(i=!!Y[0].id.startsWith("postal_code.")),i?HS:(o==null&&(o=!!Y[0].id.startsWith("poi.")),o?GS:Y[7]?ZS:qS))))}let W=N(r,-1),se=W(r),J=T&&D0(r);return{c(){e=br("li"),se.c(),u=Io(),a=br("span"),d=br("span"),p=br("span"),y=Ma(g),w=Io(),J&&J.c(),L=Io(),D=br("span"),z=Ma(R),gt(p,"class","primary svelte-ltkwvy"),gt(d,"class","svelte-ltkwvy"),gt(D,"class","line2 svelte-ltkwvy"),gt(a,"class","texts svelte-ltkwvy"),gt(e,"tabindex","0"),gt(e,"data-selected",r[1]),gt(e,"class","svelte-ltkwvy"),Jo(e,"selected",r[1])},m(Y,_e){Ur(Y,e,_e),se.m(e,null),Xn(e,u),Xn(e,a),Xn(a,d),Xn(d,p),Xn(p,y),Xn(d,w),J&&J.m(d,null),Xn(a,L),Xn(a,D),Xn(D,z),I||(F=[oo(e,"mouseenter",r[12]),oo(e,"focus",r[13])],I=!0)},p(Y,[_e]){W===(W=N(Y,_e))&&se?se.p(Y,_e):(se.d(1),se=W(Y),se&&(se.c(),se.m(e,u))),_e&1&&g!==(g=(Y[7]?Y[0].place_name:Y[0].place_name.replace(/,.*/,""))+"")&&mh(y,g),_e&37&&(T=Y[2]==="always"||Y[2]!=="never"&&!Y[0].address&&!Y[0].id.startsWith("road.")&&!Y[0].id.startsWith("address.")&&!Y[0].id.startsWith("postal_code.")&&(!Y[0].id.startsWith("poi.")||!Y[5])&&!Y[7]),T?J?J.p(Y,_e):(J=D0(Y),J.c(),J.m(d,null)):J&&(J.d(1),J=null),_e&1&&R!==(R=(Y[7]?"":Y[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&mh(z,R),_e&2&&gt(e,"data-selected",Y[1]),_e&2&&Jo(e,"selected",Y[1])},i:Br,o:Br,d(Y){Y&&Or(e),se.d(),J&&J.d(),I=!1,Js(F)}}}function QS(r,e,t){var n;let i,o,{feature:u}=e,{selected:a=!1}=e,{showPlaceType:d}=e,{missingIconsCache:p}=e,{iconsBaseUrl:g}=e;const y=(n=u.properties)==null?void 0:n.categories;let w,T,L=0,D=u.place_type[0]==="reverse";function R(){T&&p.add(T),t(10,L++,L)}function z(N){A0.call(this,r,N)}function I(N){A0.call(this,r,N)}const F=()=>R();return r.$$set=N=>{"feature"in N&&t(0,u=N.feature),"selected"in N&&t(1,a=N.selected),"showPlaceType"in N&&t(2,d=N.showPlaceType),"missingIconsCache"in N&&t(9,p=N.missingIconsCache),"iconsBaseUrl"in N&&t(3,g=N.iconsBaseUrl)},r.$$.update=()=>{var N,W,se,J;if(r.$$.dirty&3640)do t(11,i--,i),t(4,w=y==null?void 0:y[i]),t(5,T=w?g+w.replace(/ /g,"_")+".svg":void 0);while(i>-1&&(!T||p.has(T)));r.$$.dirty&1&&t(6,o=((W=(N=u.properties)==null?void 0:N.categories)==null?void 0:W.join(", "))??((J=(se=u.properties)==null?void 0:se.place_type_name)==null?void 0:J[0])??u.place_type[0])},t(11,i=(y==null?void 0:y.length)??0),[u,a,d,g,w,T,o,D,R,p,L,i,z,I,F]}class e5 extends za{constructor(e){super(),Pa(this,e,QS,YS,Aa,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function t5(r){let e;return{c(){e=br("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',gt(e,"class","svelte-7cmwmc")},m(t,n){Ur(t,e,n)},p:Br,i:Br,o:Br,d(t){t&&Or(e)}}}class n5 extends za{constructor(e){super(),Pa(this,e,null,t5,Aa,{})}}function r5(r){let e,t,n;return{c(){e=fs("svg"),t=fs("path"),gt(t,"stroke-width","4"),gt(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),gt(t,"class","svelte-gzo3ar"),gt(e,"width",n=r[0]==="list"?20:void 0),gt(e,"viewBox","0 0 70 85"),gt(e,"fill","none"),gt(e,"class","svelte-gzo3ar"),Jo(e,"in-map",r[0]!=="list"),Jo(e,"list-icon",r[0]==="list")},m(i,o){Ur(i,e,o),Xn(e,t)},p(i,[o]){o&1&&n!==(n=i[0]==="list"?20:void 0)&&gt(e,"width",n),o&1&&Jo(e,"in-map",i[0]!=="list"),o&1&&Jo(e,"list-icon",i[0]==="list")},i:Br,o:Br,d(i){i&&Or(e)}}}function i5(r,e,t){let{displayIn:n}=e;return r.$$set=i=>{"displayIn"in i&&t(0,n=i.displayIn)},[n]}class o5 extends za{constructor(e){super(),Pa(this,e,i5,r5,Aa,{displayIn:0})}}function s5(r){let e,t;return{c(){e=fs("svg"),t=fs("path"),gt(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),gt(e,"viewBox","0 0 60.006 21.412"),gt(e,"width","14"),gt(e,"height","20"),gt(e,"class","svelte-en2qvf")},m(n,i){Ur(n,e,i),Xn(e,t)},p:Br,i:Br,o:Br,d(n){n&&Or(e)}}}class a5 extends za{constructor(e){super(),Pa(this,e,null,s5,Aa,{})}}function l5(r){let e,t,n;return{c(){e=fs("svg"),t=fs("circle"),n=fs("path"),gt(t,"cx","4.789"),gt(t,"cy","4.787"),gt(t,"r","3.85"),gt(t,"class","svelte-1aq105l"),gt(n,"d","M12.063 12.063 7.635 7.635"),gt(n,"class","svelte-1aq105l"),gt(e,"xmlns","http://www.w3.org/2000/svg"),gt(e,"width","13"),gt(e,"height","13"),gt(e,"viewBox","0 0 13 13"),gt(e,"class","svelte-1aq105l")},m(i,o){Ur(i,e,o),Xn(e,t),Xn(e,n)},p:Br,i:Br,o:Br,d(i){i&&Or(e)}}}class c5 extends za{constructor(e){super(),Pa(this,e,null,l5,Aa,{})}}function u5(r,e,t){const n=e[1],i=e[0],o=n-i;return r===n&&t?r:((r-i)%o+o)%o+i}function hd(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let ju;async function h5(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const i of e??[])if(!(n&&(i.minZoom!=null&&i.minZoom>n[0]||i.maxZoom!=null&&i.maxZoom<n[0]))){if(i.type==="fixed")return i.coordinates.join(",");e:if(i.type==="client-geolocation"){if(ju&&i.cachedLocationExpiry&&ju.time+i.cachedLocationExpiry>Date.now()){if(!ju.coords)break e;return ju.coords}let o;try{return o=await new Promise((u,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(d=>{u([d.coords.longitude,d.coords.latitude].map(p=>p.toFixed(6)).join(","))},d=>{a(d)},i)}),o}catch{}finally{i.cachedLocationExpiry&&(ju={time:Date.now(),coords:o})}if(t.signal.aborted)return}if(i.type==="server-geolocation")return"ip";if(n&&i.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const f5=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,R0=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,$0=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,F0=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,B0=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,O0=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function d5(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(T=>Number(T.trim())),t=Number(e[0]),n=Number(e[1]),i=Math.abs(t),o=Math.abs(n),u=t>0?"N":"S",a=n>0?"E":"W";let d;r=="DD"&&(d=`${i} ${u}, ${o} ${a}`);const p=Math.floor(i),g=Math.floor(o),y=(i-p)*60,w=(o-g)*60;if(r=="DM"){let T=N0(y,3).toFixed(3).padStart(6,"0"),L=N0(w,3).toFixed(3).padStart(6,"0");T.endsWith(".000")&&L.endsWith(".000")&&(T=T.replace(/\.000$/,""),L=L.replace(/\.000$/,"")),d=`${p} ${T}' ${u}, ${g} ${L}' ${a}`}if(r=="DMS"){const T=Math.floor(y),L=Math.floor(w);let D=((y-T)*60).toFixed(1).padStart(4,"0"),R=((w-L)*60).toFixed(1).padStart(4,"0");const z=T.toString().padStart(2,"0"),I=L.toString().padStart(2,"0");D.endsWith(".0")&&R.endsWith(".0")&&(D=D.replace(/\.0$/,""),R=R.replace(/\.0$/,"")),d=`${p} ${z}' ${D}" ${u}, ${g} ${I}' ${R}" ${a}`}return d}else throw new Error("no decimal coordinates to convert")}function N0(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function Xm(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,n=null,i="",o="",u=null,a=[],d=!1;if(f5.test(r))throw new Error("invalid coordinate value");if(R0.test(r))if(a=R0.exec(r),d=Uu(a),d)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),n=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(n*=-1),u="DM";else throw new Error("invalid coordinate format");else if($0.test(r))if(a=$0.exec(r),d=Uu(a),d){if(t=a[2],n=a[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),u="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");a[1]?(i=a[1],o=a[5]):a[4]&&(i=a[4],o=a[8])}else throw new Error("invalid decimal coordinate format");else if(F0.test(r))if(a=F0.exec(r),d=Uu(a),d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,u="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,u="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[9])),a[11]&&(n+=a[11]/60),a[13]&&(n+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(n=-1*n),a[1]?(i=a[1],o=a[8]):a[7]&&(i=a[7],o=a[14]);else throw new Error("invalid DMS coordinates format");else if(B0.test(r))if(a=B0.exec(r),d=Uu(a),d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,u="DM"),a[6]&&(t+=a[6]/3600,u="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12]/60),a[14]&&(n+=a[14]/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(i=a[1],o=a[9]):a[8]&&(i=a[8],o=a[16]);else throw new Error("invalid DMS coordinates format");else if(O0.test(r)){if(a=O0.exec(r),d=Uu(a),a.filter(p=>p).length<=5)throw new Error("invalid coordinates format");if(d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,u="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,u="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12].replace(",",".")/60),a[14]&&(n+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(i=a[1],o=a[9]):a[8]&&(i=a[8],o=a[16]);else throw new Error("invalid coordinates format")}if(d){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(i&&!o||!i&&o)throw new Error("invalid coordinates value");if(i&&i==o)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let p=/S|SOUTH/i;p.test(i)&&t>0&&(t=-1*t),p=/W|WEST/i,p.test(o)&&n>0&&(n=-1*n);const g=a[0].trim();let y,w;const T=/[,/;\u0020]/g,L=g.match(T);if(L==null){const z=Math.floor(r.length/2);y=g.substring(0,z).trim(),w=g.substring(z).trim()}else{let z;L.length%2==1?z=Math.floor(L.length/2):z=L.length/2-1;let I=0;if(z==0)I=g.indexOf(L[0]),y=g.substring(0,I).trim(),w=g.substring(I+1).trim();else{let F=0,N=0;for(;F<=z;)I=g.indexOf(L[F],N),N=I+1,F++;y=g.substring(0,I).trim(),w=g.substring(I+1).trim()}}const D=y.split(".");if(D.length==2&&D[1]==0&&D[1].length!=2)throw new Error("invalid coordinates format");const R=w.split(".");if(R.length==2&&R[1]==0&&R[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(y)||/^\d+$/.test(w))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:g,verbatimLatitude:y,verbatimLongitude:w,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:u,closeEnough:p5,toCoordinateFormat:d5})}else throw new Error("coordinates pattern match failed")}function Uu(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,i=e.length/2;for(let o=0;o<i;o++){const u=e[o],a=e[o+i],d=t.test(u)&&t.test(a),p=n.test(u)&&n.test(a),g=u==a;if(!(u==null&&a==null)){if(u==null||a==null)return!1;if(d||p||g)continue;return!1}}return!0}function j0(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function p5(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return j0(this.decimalLatitude,Number(e[0]))&&j0(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const m5=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Xm.to=m5;const _5=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],g5={decimalLatitude:40.123,decimalLongitude:-74.123},y5=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],b5=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function v5(){const r=[];return _5.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...g5})}),[...r,...y5,...b5]}const w5=v5();Xm.formats=w5.map(r=>r.verbatimCoordinates);const x5=Xm;function U0(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function V0(r){let e,t;return e=new n5({}),{c(){La(e.$$.fragment)},m(n,i){Ws(e,n,i),t=!0},i(n){t||(hi(e.$$.fragment,n),t=!0)},o(n){Si(e.$$.fragment,n),t=!1},d(n){Ks(e,n)}}}function q0(r){let e,t,n,i,o;return t=new a5({}),{c(){e=br("button"),La(t.$$.fragment),gt(e,"type","button"),gt(e,"title",r[9]),gt(e,"class","svelte-bz0zu3"),Jo(e,"active",r[0])},m(u,a){Ur(u,e,a),Ws(t,e,null),n=!0,i||(o=oo(e,"click",r[69]),i=!0)},p(u,a){(!n||a[0]&512)&&gt(e,"title",u[9]),(!n||a[0]&1)&&Jo(e,"active",u[0])},i(u){n||(hi(t.$$.fragment,u),n=!0)},o(u){Si(t.$$.fragment,u),n=!1},d(u){u&&Or(e),Ks(t),i=!1,o()}}}function k5(r){let e,t=[],n=new Map,i,o,u,a=z0(r[14]);const d=p=>p[84].id+(p[84].address?","+p[84].address:"");for(let p=0;p<a.length;p+=1){let g=U0(r,a,p),y=d(g);n.set(y,t[p]=Z0(y,g))}return{c(){e=br("ul");for(let p=0;p<t.length;p+=1)t[p].c();gt(e,"class","options svelte-bz0zu3")},m(p,g){Ur(p,e,g);for(let y=0;y<t.length;y+=1)t[y]&&t[y].m(e,null);i=!0,o||(u=[oo(e,"mouseleave",r[73]),oo(e,"blur",r[74])],o=!0)},p(p,g){g[0]&17880064&&(a=z0(p[14]),Yf(),t=OS(t,g,d,1,p,a,n,e,BS,Z0,null,U0),Qf())},i(p){if(!i){for(let g=0;g<a.length;g+=1)hi(t[g]);i=!0}},o(p){for(let g=0;g<t.length;g+=1)Si(t[g]);i=!1},d(p){p&&Or(e);for(let g=0;g<t.length;g+=1)t[g].d();o=!1,Js(u)}}}function S5(r){let e,t,n,i,o,u;return t=new kv({}),{c(){e=br("div"),La(t.$$.fragment),n=Io(),i=br("div"),o=Ma(r[7]),gt(i,"class","svelte-bz0zu3"),gt(e,"class","no-results svelte-bz0zu3")},m(a,d){Ur(a,e,d),Ws(t,e,null),Xn(e,n),Xn(e,i),Xn(i,o),u=!0},p(a,d){(!u||d[0]&128)&&mh(o,a[7])},i(a){u||(hi(t.$$.fragment,a),u=!0)},o(a){Si(t.$$.fragment,a),u=!1},d(a){a&&Or(e),Ks(t)}}}function C5(r){let e="",t;return{c(){t=Ma(e)},m(n,i){Ur(n,t,i)},p:Br,i:Br,o:Br,d(n){n&&Or(t)}}}function T5(r){let e,t,n,i,o,u,a,d,p,g,y;return t=new kv({}),d=new xv({}),{c(){e=br("div"),La(t.$$.fragment),n=Io(),i=br("div"),o=Ma(r[6]),u=Io(),a=br("button"),La(d.$$.fragment),gt(i,"class","svelte-bz0zu3"),gt(a,"class","svelte-bz0zu3"),gt(e,"class","error svelte-bz0zu3")},m(w,T){Ur(w,e,T),Ws(t,e,null),Xn(e,n),Xn(e,i),Xn(i,o),Xn(e,u),Xn(e,a),Ws(d,a,null),p=!0,g||(y=oo(a,"click",r[70]),g=!0)},p(w,T){(!p||T[0]&64)&&mh(o,w[6])},i(w){p||(hi(t.$$.fragment,w),hi(d.$$.fragment,w),p=!0)},o(w){Si(t.$$.fragment,w),Si(d.$$.fragment,w),p=!1},d(w){w&&Or(e),Ks(t),Ks(d),g=!1,y()}}}function Z0(r,e){let t,n,i;function o(){return e[71](e[86])}function u(){return e[72](e[84])}return n=new e5({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",o),n.$on("focus",u),{key:r,first:null,c(){t=LS(),La(n.$$.fragment),this.first=t},m(a,d){Ur(a,t,d),Ws(n,a,d),i=!0},p(a,d){e=a;const p={};d[0]&16384&&(p.feature=e[84]),d[0]&1024&&(p.showPlaceType=e[10]),d[0]&49152&&(p.selected=e[15]===e[86]),d[0]&4096&&(p.iconsBaseUrl=e[12]),n.$set(p)},i(a){i||(hi(n.$$.fragment,a),i=!0)},o(a){Si(n.$$.fragment,a),i=!1},d(a){a&&Or(t),Ks(n,a)}}}function M5(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L,D,R,z,I,F,N,W,se=!1;o=new c5({}),y=new xv({});let J=r[19]&&V0(),Y=r[5]==="button"&&q0(r);const _e=r[61].default,ze=SS(_e,r,r[60],null),ee=[T5,C5,S5,k5],ae=[];function Ee(we,it){var Ge,Ie;return we[18]?0:we[16]?((Ge=we[14])==null?void 0:Ge.length)===0?2:we[16]&&(Ie=we[14])!=null&&Ie.length?3:-1:1}return~(R=Ee(r))&&(z=ae[R]=ee[R](r)),{c(){e=Io(),t=br("form"),n=br("div"),i=br("button"),La(o.$$.fragment),u=Io(),a=br("input"),d=Io(),p=br("div"),g=br("button"),La(y.$$.fragment),w=Io(),J&&J.c(),T=Io(),Y&&Y.c(),L=Io(),ze&&ze.c(),D=Io(),z&&z.c(),gt(i,"class","search-button svelte-bz0zu3"),gt(i,"type","button"),gt(a,"placeholder",r[8]),gt(a,"aria-label",r[8]),gt(a,"class","svelte-bz0zu3"),gt(g,"type","button"),gt(g,"title",r[3]),gt(g,"class","svelte-bz0zu3"),gt(p,"class","clear-button-container svelte-bz0zu3"),Jo(p,"displayable",r[1]!==""),gt(n,"class","input-group svelte-bz0zu3"),gt(t,"tabindex","0"),gt(t,"class",I=E0(r[2])+" svelte-bz0zu3"),Jo(t,"can-collapse",r[4]&&r[1]==="")},m(we,it){Ur(we,e,it),Ur(we,t,it),Xn(t,n),Xn(n,i),Ws(o,i,null),Xn(n,u),Xn(n,a),r[63](a),I0(a,r[1]),Xn(n,d),Xn(n,p),Xn(p,g),Ws(y,g,null),Xn(p,w),J&&J.m(p,null),Xn(n,T),Y&&Y.m(n,null),Xn(n,L),ze&&ze.m(n,null),Xn(t,D),~R&&ae[R].m(t,null),F=!0,N||(W=[oo(i,"click",r[62]),oo(a,"input",r[64]),oo(a,"focus",r[65]),oo(a,"blur",r[66]),oo(a,"keydown",r[22]),oo(a,"input",r[67]),oo(g,"click",r[68]),oo(t,"submit",ES(r[21]))],N=!0)},p(we,it){(!F||it[0]&256)&&gt(a,"placeholder",we[8]),(!F||it[0]&256)&&gt(a,"aria-label",we[8]),it[0]&2&&a.value!==we[1]&&I0(a,we[1]),(!F||it[0]&8)&&gt(g,"title",we[3]),we[19]?J?it[0]&524288&&hi(J,1):(J=V0(),J.c(),hi(J,1),J.m(p,null)):J&&(Yf(),Si(J,1,1,()=>{J=null}),Qf()),(!F||it[0]&2)&&Jo(p,"displayable",we[1]!==""),we[5]==="button"?Y?(Y.p(we,it),it[0]&32&&hi(Y,1)):(Y=q0(we),Y.c(),hi(Y,1),Y.m(n,L)):Y&&(Yf(),Si(Y,1,1,()=>{Y=null}),Qf()),ze&&ze.p&&(!F||it[1]&536870912)&&TS(ze,_e,we,we[60],F?CS(_e,we[60],it,null):MS(we[60]),null);let Ge=R;R=Ee(we),R===Ge?~R&&ae[R].p(we,it):(z&&(Yf(),Si(ae[Ge],1,1,()=>{ae[Ge]=null}),Qf()),~R?(z=ae[R],z?z.p(we,it):(z=ae[R]=ee[R](we),z.c()),hi(z,1),z.m(t,null)):z=null),(!F||it[0]&4&&I!==(I=E0(we[2])+" svelte-bz0zu3"))&&gt(t,"class",I),(!F||it[0]&22)&&Jo(t,"can-collapse",we[4]&&we[1]==="")},i(we){F||(hi(se),hi(o.$$.fragment,we),hi(y.$$.fragment,we),hi(J),hi(Y),hi(ze,we),hi(z),F=!0)},o(we){Si(se),Si(o.$$.fragment,we),Si(y.$$.fragment,we),Si(J),Si(Y),Si(ze,we),Si(z),F=!1},d(we){we&&(Or(e),Or(t)),Ks(o),r[63](null),Ks(y),J&&J.d(),Y&&Y.d(),ze&&ze.d(we),~R&&ae[R].d(),N=!1,Js(W)}}}function L5(r,e,t){let n,i,{$$slots:o={},$$scope:u}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:d=void 0}=e,{apiKey:p}=e,{bbox:g=void 0}=e,{clearButtonTitle:y="clear"}=e,{clearOnBlur:w=!1}=e,{collapsed:T=!1}=e,{country:L=void 0}=e,{debounceSearch:D=200}=e,{enableReverse:R="never"}=e,{errorMessage:z="Something went wrong"}=e,{filter:I=()=>!0}=e,{flyTo:F=!0}=e,{fuzzyMatch:N=!0}=e,{language:W=void 0}=e,{limit:se=void 0}=e,{mapController:J=void 0}=e,{minLength:Y=2}=e,{noResultsMessage:_e="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:ze="Search"}=e,{proximity:ee=[{type:"server-geolocation"}]}=e,{reverseActive:ae=R==="always"}=e,{reverseButtonTitle:Ee="toggle reverse geocoding"}=e,{searchValue:we=""}=e,{pickedResultStyle:it="full-geometry"}=e,{showPlaceType:Ge="if-needed"}=e,{showResultsWhileTyping:Ie=!0}=e,{selectFirst:De=!0}=e,{flyToSelected:Ct=!1}=e,{markerOnSelected:nt=!0}=e,{types:lt=void 0}=e,{exhaustiveReverseGeocoding:mt=!1}=e,{excludeTypes:ht=!1}=e,{zoom:We=a}=e,{apiUrl:Bt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Lt={}}=e,{iconsBaseUrl:Nt="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:Mt=()=>{}}=e;function Qt(){Oe.focus()}function bt(){Oe.blur()}function Dt(ne,He=!0,Xe=!1){t(1,we=ne),He?(t(15,tt=-1),vt()):(mn(!Xe,Xe),setTimeout(()=>{Oe.focus(),Oe.select()}))}function pn(){t(14,kt=void 0),t(56,ye=void 0),t(15,tt=-1)}function qe(){t(55,Ut=[]),t(56,ye=void 0)}let Ve=!1,kt,Ut,ye,zn="",Oe,tt=-1,Kt,Un=[],ur,pr,Ar,Pr;const go=new Set,hr=zS();PS(()=>{J&&(J.setEventHandler(void 0),J.indicateReverse(!1),J.setSelectedMarker(-1),J.setFeatures(void 0,void 0,!1))});function vt(ne){if(pr&&(clearTimeout(pr),pr=void 0),tt>-1&&kt)t(56,ye=kt[tt]),t(1,we=ye.place_type[0]==="reverse"?ye.place_name:ye.place_name.replace(/,.*/,"")),t(18,Kt=void 0),t(55,Ut=void 0),t(15,tt=-1);else if(we){const He=ne||!Vr(we);or(we,{exact:!0}).then(()=>{t(55,Ut=kt),t(56,ye=void 0),He&&Kn()}).catch(Xe=>t(18,Kt=Xe))}}function Vr(ne){try{return x5(ne,6)}catch{return!1}}async function or(ne,{byId:He=!1,exact:Xe=!1}={}){t(18,Kt=void 0),ur==null||ur.abort();const Ye=new AbortController;t(19,ur=Ye);try{const at=Vr(ne),Tt=new URLSearchParams;if(W!==void 0&&Tt.set("language",Array.isArray(W)?W.join(","):W??""),lt&&Tt.set("types",lt.join(",")),ht&&Tt.set("excludeTypes",String(ht)),g&&Tt.set("bbox",g.map(Fn=>Fn.toFixed(6)).join(",")),L&&Tt.set("country",Array.isArray(L)?L.join(","):L),!He&&!at){const Fn=await h5(J,ee,Ye);Fn&&Tt.set("proximity",Fn),(Xe||!Ie)&&Tt.set("autocomplete","false"),Tt.set("fuzzyMatch",String(N))}se!==void 0&&(mt||!at||(lt==null?void 0:lt.length)===1)&&Tt.set("limit",String(se)),Tt.set("key",p),Mt(Tt);const Xt=Bt+"/"+encodeURIComponent(at?at.decimalLongitude+","+at.decimalLatitude:ne)+".json?"+Tt.toString();if(Xt===zn){He?(t(14,kt=void 0),t(56,ye=Un[0])):t(14,kt=Un);return}zn=Xt;const hn=await fetch(Xt,{signal:Ye.signal,...Lt});if(!hn.ok)throw new Error(await hn.text());const vn=await hn.json();hr("response",{url:Xt,featureCollection:vn}),He?(t(14,kt=void 0),t(56,ye=vn.features[0]),Un=[ye]):(t(14,kt=vn.features.filter(I)),at&&kt.unshift({type:"Feature",properties:{},id:"reverse_"+at.decimalLongitude+"_"+at.decimalLatitude,text:at.decimalLatitude+", "+at.decimalLongitude,place_name:at.decimalLatitude+", "+at.decimalLongitude,place_type:["reverse"],center:[at.decimalLongitude,at.decimalLatitude],bbox:[at.decimalLongitude,at.decimalLatitude,at.decimalLongitude,at.decimalLatitude],geometry:{type:"Point",coordinates:[at.decimalLongitude,at.decimalLatitude]}}),Un=kt,at&&Oe.focus())}catch(at){if(at&&typeof at=="object"&&"name"in at&&at.name==="AbortError")return;throw at}finally{Ye===ur&&t(19,ur=void 0)}}function Kn(){var ne;if(!(Ut!=null&&Ut.length)||!F)return;const He=[180,90,-180,-90],Xe=!Ut.some(at=>!at.matching_text);let Ye;for(const at of Ut){const Tt=Yn(at);if(Ye=Ye===void 0?Tt:Tt===void 0?Ye:Math.max(Ye,Tt),Xe||!at.matching_text)for(const Xt of[0,1,2,3])He[Xt]=Math[Xt<2?"min":"max"](He[Xt],((ne=at.bbox)==null?void 0:ne[Xt])??at.center[Xt%2])}J&&Ut.length>0&&(ye&&He[0]===He[2]&&He[1]===He[3]?J.flyTo(ye.center,Yn(ye)):J.fitBounds(hd(He),50,Ye))}function Yn(ne){var He;if(!ne.bbox||ne.bbox[0]!==ne.bbox[2]&&ne.bbox[1]!==ne.bbox[3])return;const Xe=ne.id.replace(/\..*/,"");return(Array.isArray((He=ne.properties)==null?void 0:He.categories)?ne.properties.categories.reduce((Ye,at)=>{const Tt=We[Xe+"."+at];return Ye===void 0?Tt:Tt===void 0?Ye:Math.max(Ye,Tt)},void 0):void 0)??We[Xe]}function Pt(ne){t(0,ae=R==="always"),t(14,kt=void 0),t(56,ye=void 0),t(15,tt=-1),Dt(ne[1].toFixed(6)+", "+u5(ne[0],[-180,180],!0).toFixed(6),!1,!0)}function sn(ne){if(!kt)return;let He=ne.key==="ArrowDown"?1:ne.key==="ArrowUp"?-1:0;He&&(tt===(De?0:-1)&&He===-1&&t(15,tt=kt.length),t(15,tt+=He),tt>=kt.length&&t(15,tt=-1),tt<0&&De&&t(15,tt=0),ne.preventDefault())}function mn(ne=!0,He=!1){if(t(18,Kt=void 0),Ie||He){if(pr&&clearTimeout(pr),we.length<Y)return;const Xe=we;pr=window.setTimeout(()=>{or(Xe).catch(Ye=>t(18,Kt=Ye))},ne?D:0)}else t(14,kt=void 0),t(18,Kt=void 0)}function Qn(ne){t(56,ye=ne),t(1,we=ne.place_name),t(15,tt=-1)}const _i=()=>Oe.focus();function _n(ne){dm[ne?"unshift":"push"](()=>{Oe=ne,t(17,Oe)})}function Nr(){we=this.value,t(1,we),t(13,Ve),t(28,w)}const _r=()=>t(13,Ve=!0),Ce=()=>t(13,Ve=!1),te=()=>mn(),ie=()=>{t(1,we=""),Oe.focus()},le=()=>t(0,ae=!ae),ge=()=>t(18,Kt=void 0),Ae=ne=>t(15,tt=ne),Be=ne=>Qn(ne),je=()=>{De||t(15,tt=-1)},Re=()=>{};return r.$$set=ne=>{"class"in ne&&t(2,d=ne.class),"apiKey"in ne&&t(26,p=ne.apiKey),"bbox"in ne&&t(27,g=ne.bbox),"clearButtonTitle"in ne&&t(3,y=ne.clearButtonTitle),"clearOnBlur"in ne&&t(28,w=ne.clearOnBlur),"collapsed"in ne&&t(4,T=ne.collapsed),"country"in ne&&t(29,L=ne.country),"debounceSearch"in ne&&t(30,D=ne.debounceSearch),"enableReverse"in ne&&t(5,R=ne.enableReverse),"errorMessage"in ne&&t(6,z=ne.errorMessage),"filter"in ne&&t(31,I=ne.filter),"flyTo"in ne&&t(32,F=ne.flyTo),"fuzzyMatch"in ne&&t(33,N=ne.fuzzyMatch),"language"in ne&&t(34,W=ne.language),"limit"in ne&&t(35,se=ne.limit),"mapController"in ne&&t(36,J=ne.mapController),"minLength"in ne&&t(37,Y=ne.minLength),"noResultsMessage"in ne&&t(7,_e=ne.noResultsMessage),"placeholder"in ne&&t(8,ze=ne.placeholder),"proximity"in ne&&t(38,ee=ne.proximity),"reverseActive"in ne&&t(0,ae=ne.reverseActive),"reverseButtonTitle"in ne&&t(9,Ee=ne.reverseButtonTitle),"searchValue"in ne&&t(1,we=ne.searchValue),"pickedResultStyle"in ne&&t(39,it=ne.pickedResultStyle),"showPlaceType"in ne&&t(10,Ge=ne.showPlaceType),"showResultsWhileTyping"in ne&&t(40,Ie=ne.showResultsWhileTyping),"selectFirst"in ne&&t(11,De=ne.selectFirst),"flyToSelected"in ne&&t(41,Ct=ne.flyToSelected),"markerOnSelected"in ne&&t(42,nt=ne.markerOnSelected),"types"in ne&&t(43,lt=ne.types),"exhaustiveReverseGeocoding"in ne&&t(44,mt=ne.exhaustiveReverseGeocoding),"excludeTypes"in ne&&t(45,ht=ne.excludeTypes),"zoom"in ne&&t(46,We=ne.zoom),"apiUrl"in ne&&t(47,Bt=ne.apiUrl),"fetchParameters"in ne&&t(48,Lt=ne.fetchParameters),"iconsBaseUrl"in ne&&t(12,Nt=ne.iconsBaseUrl),"adjustUrlQuery"in ne&&t(49,Mt=ne.adjustUrlQuery),"$$scope"in ne&&t(60,u=ne.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,ae=R==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,Ar=Ve),w&&!Ve&&t(1,we="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&we.length<Y&&(t(56,ye=void 0),t(14,kt=void 0),t(18,Kt=void 0),t(55,Ut=kt)),r.$$.dirty[1]&33554688&&it!=="marker-only"&&ye&&!ye.address&&ye.geometry.type==="Point"&&ye.place_type[0]!=="reverse"&&or(ye.id,{byId:!0}).catch(ne=>t(18,Kt=ne)),r.$$.dirty[1]&100663330&&(J&&ye&&ye.id!==Pr&&F&&(!ye.bbox||ye.bbox[0]===ye.bbox[2]&&ye.bbox[1]===ye.bbox[3]?J.flyTo(ye.center,Yn(ye)):J.fitBounds(hd(ye.bbox),50,Yn(ye)),t(14,kt=void 0),t(55,Ut=void 0),t(15,tt=-1)),t(57,Pr=ye==null?void 0:ye.id)),r.$$.dirty[0]&18432&&De&&kt!=null&&kt.length&&t(15,tt=0),r.$$.dirty[0]&2&&t(15,tt=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&Ut!==kt&&t(55,Ut=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&J&&J.setEventHandler(ne=>{switch(ne.type){case"mapClick":ae&&Pt(ne.coordinates);break;case"markerClick":{const He=kt==null?void 0:kt.find(Xe=>Xe.id===ne.id);He&&Qn(He)}break;case"markerMouseEnter":Ut&&t(15,tt=Ar?(kt==null?void 0:kt.findIndex(He=>He.id===ne.id))??-1:-1);break;case"markerMouseLeave":Ut&&t(15,tt=-1);break}}),r.$$.dirty[0]&49152&&t(58,i=kt==null?void 0:kt[tt]),r.$$.dirty[1]&134218786&&J&&i&&F&&Ct&&J.flyTo(i.center,Yn(i)),r.$$.dirty[1]&256&&t(59,n=it==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(nt||J==null||J.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&J&&nt&&!Ut&&(J.setFeatures(i?[i]:void 0,void 0,n),J.setSelectedMarker(i?0:-1)),r.$$.dirty[1]&318767136&&J&&J.setFeatures(Ut,ye,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&Ut&&J&&J.setSelectedMarker(tt),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&J){const ne=Vr(we);J.setReverseMarker(ne?[ne.decimalLongitude,ne.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&hr("select",{feature:i}),r.$$.dirty[1]&33554432&&hr("pick",{feature:ye}),r.$$.dirty[0]&81920&&hr("optionsvisibilitychange",{optionsVisible:Ar&&!!kt}),r.$$.dirty[0]&16384&&hr("featureslisted",{features:kt}),r.$$.dirty[1]&16777216&&hr("featuresmarked",{features:Ut}),r.$$.dirty[0]&1&&hr("reversetoggle",{reverse:ae}),r.$$.dirty[0]&2&&hr("querychange",{query:we}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&J&&J.indicateReverse(ae)},[ae,we,d,y,T,R,z,_e,ze,Ee,Ge,De,Nt,Ve,kt,tt,Ar,Oe,Kt,ur,go,vt,sn,mn,Qn,a,p,g,w,L,D,I,F,N,W,se,J,Y,ee,it,Ie,Ct,nt,lt,mt,ht,We,Bt,Lt,Mt,Qt,bt,Dt,pn,qe,Ut,ye,Pr,i,n,u,o,_i,_n,Nr,_r,Ce,te,ie,le,ge,Ae,Be,je,Re]}let E5=class extends za{constructor(r){super(),Pa(this,r,L5,M5,Aa,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}};function gh(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Jm(r,e,t={}){for(const n of r){if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(n[n.length-1].length!==n[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<n[n.length-1].length;i++)if(n[n.length-1][i]!==n[0][i])throw new Error("First and last Position are not equivalent.")}return gh({type:"Polygon",coordinates:r},e,t)}function yh(r,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function Sv(r,e,t={}){return gh({type:"MultiPolygon",coordinates:r},e,t)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function I5(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,u;return u={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function a(p){return function(g){return d([p,g])}}function d(p){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=p[0]&2?i.return:p[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,p[1])).done)return o;switch(i=0,o&&(p=[p[0]&2,o.value]),p[0]){case 0:case 1:o=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!o||p[1]>o[0]&&p[1]<o[3])){t.label=p[1];break}if(p[0]===6&&t.label<o[1]){t.label=o[1],o=p;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(p);break}o[2]&&t.ops.pop(),t.trys.pop();continue}p=e.call(r,t)}catch(g){p=[6,g],i=0}finally{n=o=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}var Ea=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function A5(r,e){return r>e?1:r<e?-1:0}function ba(r,e,t){for(var n=new Ea(null,null),i=n,o=n;;){var u=t(r,e.key);if(u<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(u>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function Hp(r,e,t,n){var i=new Ea(r,e);if(t===null)return i.left=i.right=null,i;t=ba(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function G0(r,e,t){var n=null,i=null;if(e){e=ba(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function P5(r,e,t){return e===null?r:(r===null||(e=ba(r.key,e,t),e.left=r),e)}function _m(r,e,t,n,i){if(r){n(""+e+(t?" ":" ")+i(r)+`
`);var o=e+(t?"    ":"   ");r.left&&_m(r.left,o,!1,n,i),r.right&&_m(r.right,o,!0,n,i)}}var Ym=function(){function r(e){e===void 0&&(e=A5),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=Hp(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ea(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=ba(e,this._root,i),u=i(e,o.key);return u===0?this._root=o:(u<0?(n.left=o.left,n.right=o,o.left=null):u>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=ba(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=ba(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=ba(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=ba(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],u=this._comparator,a=this._root,d;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),d=u(a.key,t),d>0)break;if(u(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return D5(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&bm(e,t,0,i-1,o),this._root===null)this._root=gm(e,t,0,i),this._size=i;else{var u=R5(this.toList(),z5(e,t),o);i=this._size+i,this._root=ym({head:u},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return _m(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=G0(e,this._root,i),u=o.left,a=o.right;i(e,t)<0?a=Hp(t,n,a,i):u=Hp(t,n,u,i),this._root=P5(u,a,i)},r.prototype.split=function(e){return G0(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e,t,n;return I5(this,function(i){switch(i.label){case 0:e=this._root,t=[],n=!1,i.label=1;case 1:return n?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return i.sent(),e=e.right,[3,5];case 4:n=!0,i.label=5;case 5:return[3,1];case 6:return[2]}})},r}();function gm(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),u=r[o],a=e[o],d=new Ea(u,a);return d.left=gm(r,e,t,o),d.right=gm(r,e,o+1,n),d}return null}function z5(r,e){for(var t=new Ea(null,null),n=t,i=0;i<r.length;i++)n=n.next=new Ea(r[i],e[i]);return n.next=null,t.next}function D5(r){for(var e=r,t=[],n=!1,i=new Ea(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function ym(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=ym(r,e,i),u=r.head;return u.left=o,r.head=r.head.next,u.right=ym(r,i+1,t),u}return null}function R5(r,e,t){for(var n=new Ea(null,null),i=n,o=r,u=e;o!==null&&u!==null;)t(o.key,u.key)<0?(i.next=o,o=o.next):(i.next=u,u=u.next),i=i.next;return o!==null?i.next=o:u!==null&&(i.next=u),n.next}function bm(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],u=t-1,a=n+1;;){do u++;while(i(r[u],o)<0);do a--;while(i(r[a],o)>0);if(u>=a)break;var d=r[u];r[u]=r[a],r[a]=d,d=e[u],e[u]=e[a],e[a]=d}bm(r,e,t,a,i),bm(r,e,a+1,n,i)}}const Gs=11102230246251565e-32,Ui=134217729,$5=(3+8*Gs)*Gs;function Wp(r,e,t,n,i){let o,u,a,d,p=e[0],g=n[0],y=0,w=0;g>p==g>-p?(o=p,p=e[++y]):(o=g,g=n[++w]);let T=0;if(y<r&&w<t)for(g>p==g>-p?(u=p+o,a=o-(u-p),p=e[++y]):(u=g+o,a=o-(u-g),g=n[++w]),o=u,a!==0&&(i[T++]=a);y<r&&w<t;)g>p==g>-p?(u=o+p,d=u-o,a=o-(u-d)+(p-d),p=e[++y]):(u=o+g,d=u-o,a=o-(u-d)+(g-d),g=n[++w]),o=u,a!==0&&(i[T++]=a);for(;y<r;)u=o+p,d=u-o,a=o-(u-d)+(p-d),p=e[++y],o=u,a!==0&&(i[T++]=a);for(;w<t;)u=o+g,d=u-o,a=o-(u-d)+(g-d),g=n[++w],o=u,a!==0&&(i[T++]=a);return(o!==0||T===0)&&(i[T++]=o),T}function F5(r,e){let t=e[0];for(let n=1;n<r;n++)t+=e[n];return t}function Lh(r){return new Float64Array(r)}const B5=(3+16*Gs)*Gs,O5=(2+12*Gs)*Gs,N5=(9+64*Gs)*Gs*Gs,wc=Lh(4),H0=Lh(8),W0=Lh(12),K0=Lh(16),ro=Lh(4);function j5(r,e,t,n,i,o,u){let a,d,p,g,y,w,T,L,D,R,z,I,F,N,W,se,J,Y;const _e=r-i,ze=t-i,ee=e-o,ae=n-o;N=_e*ae,w=Ui*_e,T=w-(w-_e),L=_e-T,w=Ui*ae,D=w-(w-ae),R=ae-D,W=L*R-(N-T*D-L*D-T*R),se=ee*ze,w=Ui*ee,T=w-(w-ee),L=ee-T,w=Ui*ze,D=w-(w-ze),R=ze-D,J=L*R-(se-T*D-L*D-T*R),z=W-J,y=W-z,wc[0]=W-(z+y)+(y-J),I=N+z,y=I-N,F=N-(I-y)+(z-y),z=F-se,y=F-z,wc[1]=F-(z+y)+(y-se),Y=I+z,y=Y-I,wc[2]=I-(Y-y)+(z-y),wc[3]=Y;let Ee=F5(4,wc),we=O5*u;if(Ee>=we||-Ee>=we||(y=r-_e,a=r-(_e+y)+(y-i),y=t-ze,p=t-(ze+y)+(y-i),y=e-ee,d=e-(ee+y)+(y-o),y=n-ae,g=n-(ae+y)+(y-o),a===0&&d===0&&p===0&&g===0)||(we=N5*u+$5*Math.abs(Ee),Ee+=_e*g+ae*a-(ee*p+ze*d),Ee>=we||-Ee>=we))return Ee;N=a*ae,w=Ui*a,T=w-(w-a),L=a-T,w=Ui*ae,D=w-(w-ae),R=ae-D,W=L*R-(N-T*D-L*D-T*R),se=d*ze,w=Ui*d,T=w-(w-d),L=d-T,w=Ui*ze,D=w-(w-ze),R=ze-D,J=L*R-(se-T*D-L*D-T*R),z=W-J,y=W-z,ro[0]=W-(z+y)+(y-J),I=N+z,y=I-N,F=N-(I-y)+(z-y),z=F-se,y=F-z,ro[1]=F-(z+y)+(y-se),Y=I+z,y=Y-I,ro[2]=I-(Y-y)+(z-y),ro[3]=Y;const it=Wp(4,wc,4,ro,H0);N=_e*g,w=Ui*_e,T=w-(w-_e),L=_e-T,w=Ui*g,D=w-(w-g),R=g-D,W=L*R-(N-T*D-L*D-T*R),se=ee*p,w=Ui*ee,T=w-(w-ee),L=ee-T,w=Ui*p,D=w-(w-p),R=p-D,J=L*R-(se-T*D-L*D-T*R),z=W-J,y=W-z,ro[0]=W-(z+y)+(y-J),I=N+z,y=I-N,F=N-(I-y)+(z-y),z=F-se,y=F-z,ro[1]=F-(z+y)+(y-se),Y=I+z,y=Y-I,ro[2]=I-(Y-y)+(z-y),ro[3]=Y;const Ge=Wp(it,H0,4,ro,W0);N=a*g,w=Ui*a,T=w-(w-a),L=a-T,w=Ui*g,D=w-(w-g),R=g-D,W=L*R-(N-T*D-L*D-T*R),se=d*p,w=Ui*d,T=w-(w-d),L=d-T,w=Ui*p,D=w-(w-p),R=p-D,J=L*R-(se-T*D-L*D-T*R),z=W-J,y=W-z,ro[0]=W-(z+y)+(y-J),I=N+z,y=I-N,F=N-(I-y)+(z-y),z=F-se,y=F-z,ro[1]=F-(z+y)+(y-se),Y=I+z,y=Y-I,ro[2]=I-(Y-y)+(z-y),ro[3]=Y;const Ie=Wp(Ge,W0,4,ro,K0);return K0[Ie-1]}function U5(r,e,t,n,i,o){const u=(e-o)*(t-i),a=(r-i)*(n-o),d=u-a,p=Math.abs(u+a);return Math.abs(d)>=B5*p?d:-j5(r,e,t,n,i,o,p)}const Vu=(r,e)=>r.ll.x<=e.x&&e.x<=r.ur.x&&r.ll.y<=e.y&&e.y<=r.ur.y,vm=(r,e)=>{if(e.ur.x<r.ll.x||r.ur.x<e.ll.x||e.ur.y<r.ll.y||r.ur.y<e.ll.y)return null;const t=r.ll.x<e.ll.x?e.ll.x:r.ll.x,n=r.ur.x<e.ur.x?r.ur.x:e.ur.x,i=r.ll.y<e.ll.y?e.ll.y:r.ll.y,o=r.ur.y<e.ur.y?r.ur.y:e.ur.y;return{ll:{x:t,y:i},ur:{x:n,y:o}}};let xa=Number.EPSILON;xa===void 0&&(xa=Math.pow(2,-52));const V5=xa*xa,X0=(r,e)=>{if(-xa<r&&r<xa&&-xa<e&&e<xa)return 0;const t=r-e;return t*t<V5*r*e?0:r<e?-1:1};class q5{constructor(){this.reset()}reset(){this.xRounder=new J0,this.yRounder=new J0}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class J0{constructor(){this.tree=new Ym,this.round(0)}round(e){const t=this.tree.add(e),n=this.tree.prev(t);if(n!==null&&X0(t.key,n.key)===0)return this.tree.remove(e),n.key;const i=this.tree.next(t);return i!==null&&X0(t.key,i.key)===0?(this.tree.remove(e),i.key):e}}const bh=new q5,ed=(r,e)=>r.x*e.y-r.y*e.x,Cv=(r,e)=>r.x*e.x+r.y*e.y,Y0=(r,e,t)=>{const n=U5(r.x,r.y,e.x,e.y,t.x,t.y);return n>0?-1:n<0?1:0},fd=r=>Math.sqrt(Cv(r,r)),Z5=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},i={x:t.x-r.x,y:t.y-r.y};return ed(i,n)/fd(i)/fd(n)},G5=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},i={x:t.x-r.x,y:t.y-r.y};return Cv(i,n)/fd(i)/fd(n)},Q0=(r,e,t)=>e.y===0?null:{x:r.x+e.x/e.y*(t-r.y),y:t},ey=(r,e,t)=>e.x===0?null:{x:t,y:r.y+e.y/e.x*(t-r.x)},H5=(r,e,t,n)=>{if(e.x===0)return ey(t,n,r.x);if(n.x===0)return ey(r,e,t.x);if(e.y===0)return Q0(t,n,r.y);if(n.y===0)return Q0(r,e,t.y);const i=ed(e,n);if(i==0)return null;const o={x:t.x-r.x,y:t.y-r.y},u=ed(o,e)/i,a=ed(o,n)/i,d=r.x+a*e.x,p=t.x+u*n.x,g=r.y+a*e.y,y=t.y+u*n.y,w=(d+p)/2,T=(g+y)/2;return{x:w,y:T}};class Wo{static compare(e,t){const n=Wo.comparePoints(e.point,t.point);return n!==0?n:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:ka.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let n=0,i=t.length;n<i;n++){const o=t[n];this.point.events.push(o),o.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const n=this.point.events[t];if(n.segment.consumedBy===void 0)for(let i=t+1;i<e;i++){const o=this.point.events[i];o.consumedBy===void 0&&n.otherSE.point.events===o.otherSE.point.events&&n.segment.consume(o.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,n=this.point.events.length;t<n;t++){const i=this.point.events[t];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&e.push(i)}return e}getLeftmostComparator(e){const t=new Map,n=i=>{const o=i.otherSE;t.set(i,{sine:Z5(this.point,e.point,o.point),cosine:G5(this.point,e.point,o.point)})};return(i,o)=>{t.has(i)||n(i),t.has(o)||n(o);const{sine:u,cosine:a}=t.get(i),{sine:d,cosine:p}=t.get(o);return u>=0&&d>=0?a<p?1:a>p?-1:0:u<0&&d<0?a<p?-1:a>p?1:0:d<u?-1:d>u?1:0}}}let W5=0;class ka{static compare(e,t){const n=e.leftSE.point.x,i=t.leftSE.point.x,o=e.rightSE.point.x,u=t.rightSE.point.x;if(u<n)return 1;if(o<i)return-1;const a=e.leftSE.point.y,d=t.leftSE.point.y,p=e.rightSE.point.y,g=t.rightSE.point.y;if(n<i){if(d<a&&d<p)return 1;if(d>a&&d>p)return-1;const y=e.comparePoint(t.leftSE.point);if(y<0)return 1;if(y>0)return-1;const w=t.comparePoint(e.rightSE.point);return w!==0?w:-1}if(n>i){if(a<d&&a<g)return-1;if(a>d&&a>g)return 1;const y=t.comparePoint(e.leftSE.point);if(y!==0)return y;const w=e.comparePoint(t.rightSE.point);return w<0?1:w>0?-1:1}if(a<d)return-1;if(a>d)return 1;if(o<u){const y=t.comparePoint(e.rightSE.point);if(y!==0)return y}if(o>u){const y=e.comparePoint(t.rightSE.point);if(y<0)return 1;if(y>0)return-1}if(o!==u){const y=p-a,w=o-n,T=g-d,L=u-i;if(y>w&&T<L)return 1;if(y<w&&T>L)return-1}return o>u?1:o<u||p<g?-1:p>g?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,n,i){this.id=++W5,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}static fromRing(e,t,n){let i,o,u;const a=Wo.comparePoints(e,t);if(a<0)i=e,o=t,u=1;else if(a>0)i=t,o=e,u=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const d=new Wo(i,!0),p=new Wo(o,!1);return new ka(d,p,[n],[u])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,n=this.rightSE.point,i=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;const o=(e.y-t.y)/i.y,u=t.x+o*i.x;if(e.x===u)return 0;const a=(e.x-t.x)/i.x,d=t.y+a*i.y;return e.y===d?0:e.y<d?-1:1}getIntersection(e){const t=this.bbox(),n=e.bbox(),i=vm(t,n);if(i===null)return null;const o=this.leftSE.point,u=this.rightSE.point,a=e.leftSE.point,d=e.rightSE.point,p=Vu(t,a)&&this.comparePoint(a)===0,g=Vu(n,o)&&e.comparePoint(o)===0,y=Vu(t,d)&&this.comparePoint(d)===0,w=Vu(n,u)&&e.comparePoint(u)===0;if(g&&p)return w&&!y?u:!w&&y?d:null;if(g)return y&&o.x===d.x&&o.y===d.y?null:o;if(p)return w&&u.x===a.x&&u.y===a.y?null:a;if(w&&y)return null;if(w)return u;if(y)return d;const T=H5(o,this.vector(),a,e.vector());return T===null||!Vu(i,T)?null:bh.round(T.x,T.y)}split(e){const t=[],n=e.events!==void 0,i=new Wo(e,!0),o=new Wo(e,!1),u=this.rightSE;this.replaceRightSE(o),t.push(o),t.push(i);const a=new ka(i,u,this.rings.slice(),this.windings.slice());return Wo.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),Wo.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(i.checkForConsuming(),o.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}consume(e){let t=this,n=e;for(;t.consumedBy;)t=t.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const i=ka.compare(t,n);if(i!==0){if(i>0){const o=t;t=n,n=o}if(t.prev===n){const o=t;t=n,n=o}for(let o=0,u=n.rings.length;o<u;o++){const a=n.rings[o],d=n.windings[o],p=t.rings.indexOf(a);p===-1?(t.rings.push(a),t.windings.push(d)):t.windings[p]+=d}n.rings=null,n.windings=null,n.consumedBy=t,n.leftSE.consumedBy=t.leftSE,n.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,n=this._afterState.windings,i=this._afterState.multiPolys;for(let a=0,d=this.rings.length;a<d;a++){const p=this.rings[a],g=this.windings[a],y=t.indexOf(p);y===-1?(t.push(p),n.push(g)):n[y]+=g}const o=[],u=[];for(let a=0,d=t.length;a<d;a++){if(n[a]===0)continue;const p=t[a],g=p.poly;if(u.indexOf(g)===-1)if(p.isExterior)o.push(g);else{u.indexOf(g)===-1&&u.push(g);const y=o.indexOf(p.poly);y!==-1&&o.splice(y,1)}}for(let a=0,d=o.length;a<d;a++){const p=o[a].multiPoly;i.indexOf(p)===-1&&i.push(p)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(cs.type){case"union":{const n=e.length===0,i=t.length===0;this._isInResult=n!==i;break}case"intersection":{let n,i;e.length<t.length?(n=e.length,i=t.length):(n=t.length,i=e.length),this._isInResult=i===cs.numMultiPolys&&n<i;break}case"xor":{const n=Math.abs(e.length-t.length);this._isInResult=n%2===1;break}case"difference":{const n=i=>i.length===1&&i[0].isSubject;this._isInResult=n(e)!==n(t);break}default:throw new Error(`Unrecognized operation type found ${cs.type}`)}return this._isInResult}}class ty{constructor(e,t,n){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=bh.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let o=i;for(let u=1,a=e.length;u<a;u++){if(typeof e[u][0]!="number"||typeof e[u][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let d=bh.round(e[u][0],e[u][1]);d.x===o.x&&d.y===o.y||(this.segments.push(ka.fromRing(o,d,this)),d.x<this.bbox.ll.x&&(this.bbox.ll.x=d.x),d.y<this.bbox.ll.y&&(this.bbox.ll.y=d.y),d.x>this.bbox.ur.x&&(this.bbox.ur.x=d.x),d.y>this.bbox.ur.y&&(this.bbox.ur.y=d.y),o=d)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(ka.fromRing(o,i,this))}getSweepEvents(){const e=[];for(let t=0,n=this.segments.length;t<n;t++){const i=this.segments[t];e.push(i.leftSE),e.push(i.rightSE)}return e}}class K5{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new ty(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,i=e.length;n<i;n++){const o=new ty(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,n=this.interiorRings.length;t<n;t++){const i=this.interiorRings[t].getSweepEvents();for(let o=0,u=i.length;o<u;o++)e.push(i[o])}return e}}class ny{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let n=0,i=e.length;n<i;n++){const o=new K5(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const i=this.polys[t].getSweepEvents();for(let o=0,u=i.length;o<u;o++)e.push(i[o])}return e}}class dd{static factory(e){const t=[];for(let n=0,i=e.length;n<i;n++){const o=e[n];if(!o.isInResult()||o.ringOut)continue;let u=null,a=o.leftSE,d=o.rightSE;const p=[a],g=a.point,y=[];for(;u=a,a=d,p.push(a),a.point!==g;)for(;;){const w=a.getAvailableLinkedEvents();if(w.length===0){const D=p[0].point,R=p[p.length-1].point;throw new Error(`Unable to complete output ring starting at [${D.x}, ${D.y}]. Last matching segment found ends at [${R.x}, ${R.y}].`)}if(w.length===1){d=w[0].otherSE;break}let T=null;for(let D=0,R=y.length;D<R;D++)if(y[D].point===a.point){T=D;break}if(T!==null){const D=y.splice(T)[0],R=p.splice(D.index);R.unshift(R[0].otherSE),t.push(new dd(R.reverse()));continue}y.push({index:p.length,point:a.point});const L=a.getLeftmostComparator(u);d=w.sort(L)[0].otherSE;break}t.push(new dd(p))}return t}constructor(e){this.events=e;for(let t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let p=1,g=this.events.length-1;p<g;p++){const y=this.events[p].point,w=this.events[p+1].point;Y0(y,e,w)!==0&&(t.push(y),e=y)}if(t.length===1)return null;const n=t[0],i=t[1];Y0(n,e,i)===0&&t.shift(),t.push(t[0]);const o=this.isExteriorRing()?1:-1,u=this.isExteriorRing()?0:t.length-1,a=this.isExteriorRing()?t.length:-1,d=[];for(let p=u;p!=a;p+=o)d.push([t[p].x,t[p].y]);return d}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let i=1,o=this.events.length;i<o;i++){const u=this.events[i];Wo.compare(e,u)>0&&(e=u)}let t=e.segment.prevInResult(),n=t?t.prevInResult():null;for(;;){if(!t)return null;if(!n)return t.ringOut;if(n.ringOut!==t.ringOut)return n.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=n.prevInResult(),n=t?t.prevInResult():null}}}class ry{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,n=this.interiorRings.length;t<n;t++){const i=this.interiorRings[t].getGeom();i!==null&&e.push(i)}return e}}class X5{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const i=this.polys[t].getGeom();i!==null&&e.push(i)}return e}_composePolys(e){const t=[];for(let n=0,i=e.length;n<i;n++){const o=e[n];if(!o.poly)if(o.isExteriorRing())t.push(new ry(o));else{const u=o.enclosingRing();u.poly||t.push(new ry(u)),u.poly.addInterior(o)}}return t}}class J5{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ka.compare;this.queue=e,this.tree=new Ym(t),this.segments=[]}process(e){const t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;const i=e.isLeft?this.tree.add(t):this.tree.find(t);if(!i)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let o=i,u=i,a,d;for(;a===void 0;)o=this.tree.prev(o),o===null?a=null:o.key.consumedBy===void 0&&(a=o.key);for(;d===void 0;)u=this.tree.next(u),u===null?d=null:u.key.consumedBy===void 0&&(d=u.key);if(e.isLeft){let p=null;if(a){const y=a.getIntersection(t);if(y!==null&&(t.isAnEndpoint(y)||(p=y),!a.isAnEndpoint(y))){const w=this._splitSafely(a,y);for(let T=0,L=w.length;T<L;T++)n.push(w[T])}}let g=null;if(d){const y=d.getIntersection(t);if(y!==null&&(t.isAnEndpoint(y)||(g=y),!d.isAnEndpoint(y))){const w=this._splitSafely(d,y);for(let T=0,L=w.length;T<L;T++)n.push(w[T])}}if(p!==null||g!==null){let y=null;p===null?y=g:g===null?y=p:y=Wo.comparePoints(p,g)<=0?p:g,this.queue.remove(t.rightSE),n.push(t.rightSE);const w=t.split(y);for(let T=0,L=w.length;T<L;T++)n.push(w[T])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&d){const p=a.getIntersection(d);if(p!==null){if(!a.isAnEndpoint(p)){const g=this._splitSafely(a,p);for(let y=0,w=g.length;y<w;y++)n.push(g[y])}if(!d.isAnEndpoint(p)){const g=this._splitSafely(d,p);for(let y=0,w=g.length;y<w;y++)n.push(g[y])}}}this.tree.remove(t)}return n}_splitSafely(e,t){this.tree.remove(e);const n=e.rightSE;this.queue.remove(n);const i=e.split(t);return i.push(n),e.consumedBy===void 0&&this.tree.add(e),i}}const iy=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Y5=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class Q5{run(e,t,n){cs.type=e,bh.reset();const i=[new ny(t,!0)];for(let g=0,y=n.length;g<y;g++)i.push(new ny(n[g],!1));if(cs.numMultiPolys=i.length,cs.type==="difference"){const g=i[0];let y=1;for(;y<i.length;)vm(i[y].bbox,g.bbox)!==null?y++:i.splice(y,1)}if(cs.type==="intersection")for(let g=0,y=i.length;g<y;g++){const w=i[g];for(let T=g+1,L=i.length;T<L;T++)if(vm(w.bbox,i[T].bbox)===null)return[]}const o=new Ym(Wo.compare);for(let g=0,y=i.length;g<y;g++){const w=i[g].getSweepEvents();for(let T=0,L=w.length;T<L;T++)if(o.insert(w[T]),o.size>iy)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const u=new J5(o);let a=o.size,d=o.pop();for(;d;){const g=d.key;if(o.size===a){const w=g.segment;throw new Error(`Unable to pop() ${g.isLeft?"left":"right"} SweepEvent [${g.point.x}, ${g.point.y}] from segment #${w.id} [${w.leftSE.point.x}, ${w.leftSE.point.y}] -> [${w.rightSE.point.x}, ${w.rightSE.point.y}] from queue.`)}if(o.size>iy)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(u.segments.length>Y5)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const y=u.process(g);for(let w=0,T=y.length;w<T;w++){const L=y[w];L.consumedBy===void 0&&o.insert(L)}a=o.size,d=o.pop()}bh.reset();const p=dd.factory(u.segments);return new X5(p).getGeom()}}const cs=new Q5,eC=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return cs.run("union",r,t)},tC=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return cs.run("intersection",r,t)},nC=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return cs.run("xor",r,t)},rC=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return cs.run("difference",r,t)};var Tv={union:eC,intersection:tC,xor:nC,difference:rC};function Mv(r,e,t){if(r!==null)for(var n,i,o,u,a,d,p,g=0,y=0,w,T=r.type,L=T==="FeatureCollection",D=T==="Feature",R=L?r.features.length:1,z=0;z<R;z++){p=L?r.features[z].geometry:D?r.geometry:r,w=p?p.type==="GeometryCollection":!1,a=w?p.geometries.length:1;for(var I=0;I<a;I++){var F=0,N=0;if(u=w?p.geometries[I]:p,u!==null){d=u.coordinates;var W=u.type;switch(g=0,W){case null:break;case"Point":if(e(d,y,z,F,N)===!1)return!1;y++,F++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],y,z,F,N)===!1)return!1;y++,W==="MultiPoint"&&F++}W==="LineString"&&F++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-g;i++){if(e(d[n][i],y,z,F,N)===!1)return!1;y++}W==="MultiLineString"&&F++,W==="Polygon"&&N++}W==="Polygon"&&F++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(N=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-g;o++){if(e(d[n][i][o],y,z,F,N)===!1)return!1;y++}N++}F++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(Mv(u.geometries[n],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Qm(r,e){var t,n,i,o,u,a,d,p,g,y,w=0,T=r.type==="FeatureCollection",L=r.type==="Feature",D=T?r.features.length:1;for(t=0;t<D;t++){for(a=T?r.features[t].geometry:L?r.geometry:r,p=T?r.features[t].properties:L?r.properties:{},g=T?r.features[t].bbox:L?r.bbox:void 0,y=T?r.features[t].id:L?r.id:void 0,d=a?a.type==="GeometryCollection":!1,u=d?a.geometries.length:1,i=0;i<u;i++){if(o=d?a.geometries[i]:a,o===null){if(e(null,w,p,g,y)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,w,p,g,y)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],w,p,g,y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}w++}}function iC(r,e){Qm(r,function(t,n,i,o,u){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(gh(t,i,{bbox:o,id:u}),n,0)===!1?!1:void 0}var d;switch(a){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var g=t.coordinates[p],y={type:d,coordinates:g};if(e(gh(y,i),n,p)===!1)return!1}})}function oC(r,e={}){const t=[];if(Qm(r,i=>{t.push(i.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const n=Tv.union(t[0],...t.slice(1));return n.length===0?null:n.length===1?Jm(n[0],e.properties):Sv(n,e.properties)}var Lv=oC;function sC(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return Mv(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var oy=sC;function aC(r){const e=[];if(Qm(r,i=>{e.push(i.coordinates)}),e.length<2)throw new Error("Must have at least two features");const t=r.features[0].properties||{},n=Tv.difference(e[0],...e.slice(1));return n.length===0?null:n.length===1?Jm(n[0],t):Sv(n,t)}var lC=aC;function cC(r){if(!r)throw new Error("geojson is required");var e=[];return iC(r,function(t){e.push(t)}),yh(e)}var uC=cC;function sy(r,e){const t=lC(yh([Jm([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),r]));if(!t)return;t.properties={isMask:!0};const n=hd(oy(r)),i=(n[2]-n[0])/360/1e3,o=n[0]<-180,u=n[2]>180,a=uC(r);if(a.features.length>1&&(o||u))for(const d of a.features){const p=hd(oy(d));if(u&&p[0]<-180+i)for(const g of d.geometry.coordinates)for(const y of g)y[0]+=360-i;if(o&&p[2]>180-i)for(const g of d.geometry.coordinates)for(const y of g)y[0]-=360-i}e(yh([a.features.length<2?r:Lv(a)??r,t]))}const ay={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},Uf="mtlr-gc-full-geom",ly="mtlr-gc-full-geom-fill",cy="mtlr-gc-full-geom-line";function Ev(r,e,t=!0,n=!0,i={},o={},u=ay){let a;const d=[];let p,g,y;function w(){if(!r.loaded){r.once("load",w);return}const R=u?u===!0?ay:u:void 0;if(!(R!=null&&R.fill)&&!(R!=null&&R.line))return;const z=r.getSource(Uf);if(z)z.setData(y??yh([]));else if(y)r.addSource(Uf,{type:"geojson",data:y});else return;!r.getLayer(ly)&&R!=null&&R.fill&&r.addLayer({...R==null?void 0:R.fill,id:ly,type:"fill",source:Uf}),!r.getLayer(cy)&&R!=null&&R.line&&r.addLayer({...R==null?void 0:R.line,id:cy,type:"line",source:Uf})}function T(R){y=R,w()}r.on("styledata",()=>{setTimeout(()=>{y&&w()})});const L=R=>{a==null||a({type:"mapClick",coordinates:[R.lngLat.lng,R.lngLat.lat]})};function D(R=!1){if(!e)throw new Error;const z=document.createElement("div");return R&&z.classList.add("marker-interactive"),new o5({props:{displayIn:"maplibre"},target:z}),new e.Marker({element:z,offset:[1,-13]})}return{setEventHandler(R){R?(a=R,r.on("click",L)):(a=void 0,r.off("click",L))},flyTo(R,z){r.flyTo({center:R,...z?{zoom:z}:{},...i})},fitBounds(R,z,I){r.fitBounds([[R[0],R[1]],[R[2],R[3]]],{padding:z,...I?{maxZoom:I}:{},...o})},indicateReverse(R){r.getCanvasContainer().style.cursor=R?"crosshair":""},setReverseMarker(R){!e||!t||(g?R?g.setLngLat(R):(g.remove(),g=void 0):R&&(t instanceof Function?g=t(r)??void 0:(g=(typeof t=="object"?new e.Marker(t):D()).setLngLat(R).addTo(r),g.getElement().classList.add("marker-reverse"))))},setFeatures(R,z,I){for(const F of d)F.remove();if(d.length=0,T(void 0),!!e){if(z){let F=!1;if(z.geometry.type==="GeometryCollection"){const N=z.geometry.geometries.filter(W=>W.type==="Polygon"||W.type==="MultiPolygon");e:if(N.length>0){const W=Lv(yh(N.map(se=>gh(se))));if(!W)break e;sy({...z,geometry:W.geometry},T),F=!0}else{const W=z.geometry.geometries.filter(se=>se.type==="LineString"||se.type==="MultiLineString");W.length>0&&(T({...z,geometry:{type:"GeometryCollection",geometries:W}}),F=!0)}}if(!F){if(z.geometry.type==="Polygon"||z.geometry.type==="MultiPolygon")sy(z,T);else if(z.geometry.type==="LineString"||z.geometry.type==="MultiLineString"){T(z);return}}if(!I&&z.geometry.type!=="Point")return;if(t instanceof Function){const N=t(r,z);N&&d.push(N)}else t&&d.push(typeof t=="object"?new e.Marker(t):D().setLngLat(z.center).addTo(r))}if(n)for(const F of R??[]){if(F===z)continue;let N;if(n instanceof Function){if(N=n(r,F),!N)continue}else N=(typeof n=="object"?new e.Marker(n):D(!0)).setLngLat(F.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(F.place_type[0]==="reverse"?F.place_name:F.place_name.replace(/,.*/,""))).addTo(r);const W=N.getElement();W.addEventListener("click",se=>{se.stopPropagation(),a==null||a({type:"markerClick",id:F.id})}),W.addEventListener("mouseenter",()=>{a==null||a({type:"markerMouseEnter",id:F.id}),N.togglePopup()}),W.addEventListener("mouseleave",()=>{a==null||a({type:"markerMouseLeave",id:F.id}),N.togglePopup()}),d.push(N)}}},setSelectedMarker(R){p&&p.getElement().classList.toggle("marker-selected",!1),p=R>-1?d[R]:void 0,p==null||p.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const R=r.getCenter();return[r.getZoom(),R.lng,R.lat]}}}function hC(r,e,t){var n,i;class o{constructor(R,z){Mo(this,"type"),Mo(this,"target"),this.type=z,this.target=R}}class u extends o{constructor(R,z){super(R,"select"),Mo(this,"feature"),Object.assign(this,z)}}class a extends o{constructor(R,z){super(R,"featureslisted"),Mo(this,"features"),this.features=z}}class d extends o{constructor(R,z){super(R,"featuresmarked"),Mo(this,"features"),this.features=z}}class p extends o{constructor(R,z){super(R,"optionsvisibilitychange"),Mo(this,"optionsVisible"),this.optionsVisible=z}}class g extends o{constructor(R,z){super(R,"pick"),Mo(this,"feature"),this.feature=z}}class y extends o{constructor(R,z){super(R,"querychange"),Mo(this,"query"),this.query=z}}class w extends o{constructor(R,z,I){super(R,"response"),Mo(this,"url"),Mo(this,"featureCollection"),this.url=z,this.featureCollection=I}}class T extends o{constructor(R,z){super(R,"reversetoggle"),Mo(this,"reverse"),this.reverse=z}}class L extends r{constructor(R={}){super(),T0(this,n),T0(this,i),M0(this,i,R)}onAddInt(R){const z=document.createElement("div");z.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:I,showResultMarkers:F,flyTo:N,fullGeometryStyle:W,...se}=yi(this,i),J=typeof N=="boolean"?{}:N,Y={mapController:Ev(R,e,I,F,J,J,W),flyTo:N===void 0?!0:!!N,apiKey:"",...t==null?void 0:t(R,z),...se};if(!Y.apiKey)throw new Error("no apiKey provided");return M0(this,n,new E5({target:z,props:Y})),yi(this,n).$on("select",_e=>{this.fire(new u(this,_e.detail))}),yi(this,n).$on("pick",_e=>{this.fire(new g(this,_e.detail.feature))}),yi(this,n).$on("featureslisted",_e=>{this.fire(new a(this,_e.detail.features))}),yi(this,n).$on("featuresmarked",_e=>{this.fire(new d(this,_e.detail.features))}),yi(this,n).$on("response",_e=>{this.fire(new w(this,_e.detail.url,_e.detail.featureCollection))}),yi(this,n).$on("optionsvisibilitychange",_e=>{this.fire(new p(this,_e.detail.optionsVisible))}),yi(this,n).$on("reversetoggle",_e=>{this.fire(new T(this,_e.detail.reverse))}),yi(this,n).$on("querychange",_e=>{this.fire(new y(this,_e.detail.query))}),z}on(R,z){return super.on(R,z)}once(R,z){return super.once(R,z)}off(R,z){return super.off(R,z)}listens(R){return super.listens(R)}setOptions(R){var z;Object.assign(yi(this,i),R);const{marker:I,showResultMarkers:F,flyTo:N,fullGeometryStyle:W,...se}=yi(this,i);(z=yi(this,n))==null||z.$set(se)}setQuery(R,z=!0){var I;(I=yi(this,n))==null||I.setQuery(R,z)}clearMap(){var R;(R=yi(this,n))==null||R.clearMap()}clearList(){var R;(R=yi(this,n))==null||R.clearList()}setReverseMode(R){var z;(z=yi(this,n))==null||z.$set({reverseActive:R})}focus(){var R;(R=yi(this,n))==null||R.focus()}blur(){var R;(R=yi(this,n))==null||R.blur()}onRemove(){var R;(R=yi(this,n))==null||R.$destroy()}}return n=new WeakMap,i=new WeakMap,{MapLibreBasedGeocodingControl:L,events:{SelectEvent:u,FeaturesListedEvent:a,FeaturesMarkedEvent:d,OptionsVisibilityChangeEvent:p,PickEvent:g,QueryChangeEvent:y,ResponseEvent:w,ReverseToggleEvent:T}}}const{MapLibreBasedGeocodingControl:Sz,events:Da}=hC(Hs.Evented,cx);Da.SelectEvent;Da.FeaturesListedEvent;Da.FeaturesMarkedEvent;Da.OptionsVisibilityChangeEvent;Da.PickEvent;Da.QueryChangeEvent;Da.ResponseEvent;Da.ReverseToggleEvent;function fC(r){let e,t;return{c(){e=hs("svg"),t=hs("path"),ue(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),ue(e,"viewBox","0 0 14 14"),ue(e,"width","13"),ue(e,"height","13"),ue(e,"class","svelte-en2qvf")},m(n,i){q(n,e,i),$(e,t)},p:rt,i:rt,o:rt,d(n){n&&V(e)}}}class Iv extends It{constructor(e){super(),Et(this,e,null,fC,xt,{})}}function dC(r){let e,t;return{c(){e=hs("svg"),t=hs("path"),ue(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),ue(e,"viewBox","0 0 30 30"),ue(e,"fill","none"),ue(e,"xmlns","http://www.w3.org/2000/svg"),ue(e,"class","svelte-d2loi5")},m(n,i){q(n,e,i),$(e,t)},p:rt,i:rt,o:rt,d(n){n&&V(e)}}}class Av extends It{constructor(e){super(),Et(this,e,null,dC,xt,{})}}function pC(r){let e,t;return{c(){e=U("img"),cr(e.src,t=r[3]+"area.svg")||ue(e,"src",t),ue(e,"alt",r[6]),ue(e,"class","svelte-ltkwvy")},m(n,i){q(n,e,i)},p(n,i){i&8&&!cr(e.src,t=n[3]+"area.svg")&&ue(e,"src",t),i&64&&ue(e,"alt",n[6])},d(n){n&&V(e)}}}function mC(r){let e,t;return{c(){e=U("img"),cr(e.src,t=r[3]+"reverse.svg")||ue(e,"src",t),ue(e,"alt",r[6]),ue(e,"class","svelte-ltkwvy")},m(n,i){q(n,e,i)},p(n,i){i&8&&!cr(e.src,t=n[3]+"reverse.svg")&&ue(e,"src",t),i&64&&ue(e,"alt",n[6])},d(n){n&&V(e)}}}function _C(r){let e,t;return{c(){e=U("img"),cr(e.src,t=r[3]+"poi.svg")||ue(e,"src",t),ue(e,"alt",r[6]),ue(e,"class","svelte-ltkwvy")},m(n,i){q(n,e,i)},p(n,i){i&8&&!cr(e.src,t=n[3]+"poi.svg")&&ue(e,"src",t),i&64&&ue(e,"alt",n[6])},d(n){n&&V(e)}}}function gC(r){let e,t;return{c(){e=U("img"),cr(e.src,t=r[3]+"postal_code.svg")||ue(e,"src",t),ue(e,"alt",r[6]),ue(e,"class","svelte-ltkwvy")},m(n,i){q(n,e,i)},p(n,i){i&8&&!cr(e.src,t=n[3]+"postal_code.svg")&&ue(e,"src",t),i&64&&ue(e,"alt",n[6])},d(n){n&&V(e)}}}function yC(r){let e,t;return{c(){e=U("img"),cr(e.src,t=r[3]+"street.svg")||ue(e,"src",t),ue(e,"alt",r[6]),ue(e,"class","svelte-ltkwvy")},m(n,i){q(n,e,i)},p(n,i){i&8&&!cr(e.src,t=n[3]+"street.svg")&&ue(e,"src",t),i&64&&ue(e,"alt",n[6])},d(n){n&&V(e)}}}function bC(r){let e,t;return{c(){e=U("img"),cr(e.src,t=r[3]+"road.svg")||ue(e,"src",t),ue(e,"alt",r[6]),ue(e,"class","svelte-ltkwvy")},m(n,i){q(n,e,i)},p(n,i){i&8&&!cr(e.src,t=n[3]+"road.svg")&&ue(e,"src",t),i&64&&ue(e,"alt",n[6])},d(n){n&&V(e)}}}function vC(r){let e,t;return{c(){e=U("img"),cr(e.src,t=r[3]+"housenumber.svg")||ue(e,"src",t),ue(e,"alt",r[6]),ue(e,"class","svelte-ltkwvy")},m(n,i){q(n,e,i)},p(n,i){i&8&&!cr(e.src,t=n[3]+"housenumber.svg")&&ue(e,"src",t),i&64&&ue(e,"alt",n[6])},d(n){n&&V(e)}}}function wC(r){let e,t,n,i;return{c(){e=U("img"),cr(e.src,t=r[5])||ue(e,"src",t),ue(e,"alt",r[4]),ue(e,"class","svelte-ltkwvy")},m(o,u){q(o,e,u),n||(i=yt(e,"error",r[14]),n=!0)},p(o,u){u&32&&!cr(e.src,t=o[5])&&ue(e,"src",t),u&16&&ue(e,"alt",o[4])},d(o){o&&V(e),n=!1,i()}}}function uy(r){let e,t;return{c(){e=U("span"),t=xe(r[6]),ue(e,"class","secondary svelte-ltkwvy")},m(n,i){q(n,e,i),$(e,t)},p(n,i){i&64&&St(t,n[6])},d(n){n&&V(e)}}}function xC(r){let e,t,n,i,o,u,a,d,p,g=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",y,w,T=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],L,D,R=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",z,I,F;function N(Y,_e){return _e&1&&(t=null),_e&1&&(n=null),_e&1&&(i=null),_e&1&&(o=null),Y[5]?wC:Y[0].address?vC:(t==null&&(t=!!Y[0].id.startsWith("road.")),t?bC:(n==null&&(n=!!Y[0].id.startsWith("address.")),n?yC:(i==null&&(i=!!Y[0].id.startsWith("postal_code.")),i?gC:(o==null&&(o=!!Y[0].id.startsWith("poi.")),o?_C:Y[7]?mC:pC))))}let W=N(r,-1),se=W(r),J=T&&uy(r);return{c(){e=U("li"),se.c(),u=oe(),a=U("span"),d=U("span"),p=U("span"),y=xe(g),w=oe(),J&&J.c(),L=oe(),D=U("span"),z=xe(R),ue(p,"class","primary svelte-ltkwvy"),ue(d,"class","svelte-ltkwvy"),ue(D,"class","line2 svelte-ltkwvy"),ue(a,"class","texts svelte-ltkwvy"),ue(e,"tabindex","0"),ue(e,"data-selected",r[1]),ue(e,"class","svelte-ltkwvy"),Yt(e,"selected",r[1])},m(Y,_e){q(Y,e,_e),se.m(e,null),$(e,u),$(e,a),$(a,d),$(d,p),$(p,y),$(d,w),J&&J.m(d,null),$(a,L),$(a,D),$(D,z),I||(F=[yt(e,"mouseenter",r[12]),yt(e,"focus",r[13])],I=!0)},p(Y,[_e]){W===(W=N(Y,_e))&&se?se.p(Y,_e):(se.d(1),se=W(Y),se&&(se.c(),se.m(e,u))),_e&1&&g!==(g=(Y[7]?Y[0].place_name:Y[0].place_name.replace(/,.*/,""))+"")&&St(y,g),_e&37&&(T=Y[2]==="always"||Y[2]!=="never"&&!Y[0].address&&!Y[0].id.startsWith("road.")&&!Y[0].id.startsWith("address.")&&!Y[0].id.startsWith("postal_code.")&&(!Y[0].id.startsWith("poi.")||!Y[5])&&!Y[7]),T?J?J.p(Y,_e):(J=uy(Y),J.c(),J.m(d,null)):J&&(J.d(1),J=null),_e&1&&R!==(R=(Y[7]?"":Y[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&St(z,R),_e&2&&ue(e,"data-selected",Y[1]),_e&2&&Yt(e,"selected",Y[1])},i:rt,o:rt,d(Y){Y&&V(e),se.d(),J&&J.d(),I=!1,mr(F)}}}function kC(r,e,t){var F;let n,i,{feature:o}=e,{selected:u=!1}=e,{showPlaceType:a}=e,{missingIconsCache:d}=e,{iconsBaseUrl:p}=e;const g=(F=o.properties)==null?void 0:F.categories;let y,w,T=0,L=o.place_type[0]==="reverse";function D(){w&&d.add(w),t(10,T++,T)}function R(N){Mn.call(this,r,N)}function z(N){Mn.call(this,r,N)}const I=()=>D();return r.$$set=N=>{"feature"in N&&t(0,o=N.feature),"selected"in N&&t(1,u=N.selected),"showPlaceType"in N&&t(2,a=N.showPlaceType),"missingIconsCache"in N&&t(9,d=N.missingIconsCache),"iconsBaseUrl"in N&&t(3,p=N.iconsBaseUrl)},r.$$.update=()=>{var N,W,se,J;if(r.$$.dirty&3640)do t(11,n--,n),t(4,y=g==null?void 0:g[n]),t(5,w=y?p+y.replace(/ /g,"_")+".svg":void 0);while(n>-1&&(!w||d.has(w)));r.$$.dirty&1&&t(6,i=((W=(N=o.properties)==null?void 0:N.categories)==null?void 0:W.join(", "))??((J=(se=o.properties)==null?void 0:se.place_type_name)==null?void 0:J[0])??o.place_type[0])},t(11,n=(g==null?void 0:g.length)??0),[o,u,a,p,y,w,i,L,D,d,T,n,R,z,I]}class SC extends It{constructor(e){super(),Et(this,e,kC,xC,xt,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function CC(r){let e;return{c(){e=U("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',ue(e,"class","svelte-7cmwmc")},m(t,n){q(t,e,n)},p:rt,i:rt,o:rt,d(t){t&&V(e)}}}class TC extends It{constructor(e){super(),Et(this,e,null,CC,xt,{})}}function MC(r){let e,t;return{c(){e=hs("svg"),t=hs("path"),ue(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),ue(e,"viewBox","0 0 60.006 21.412"),ue(e,"width","14"),ue(e,"height","20"),ue(e,"class","svelte-en2qvf")},m(n,i){q(n,e,i),$(e,t)},p:rt,i:rt,o:rt,d(n){n&&V(e)}}}class LC extends It{constructor(e){super(),Et(this,e,null,MC,xt,{})}}function EC(r){let e,t,n;return{c(){e=hs("svg"),t=hs("circle"),n=hs("path"),ue(t,"cx","4.789"),ue(t,"cy","4.787"),ue(t,"r","3.85"),ue(t,"class","svelte-1aq105l"),ue(n,"d","M12.063 12.063 7.635 7.635"),ue(n,"class","svelte-1aq105l"),ue(e,"xmlns","http://www.w3.org/2000/svg"),ue(e,"width","13"),ue(e,"height","13"),ue(e,"viewBox","0 0 13 13"),ue(e,"class","svelte-1aq105l")},m(i,o){q(i,e,o),$(e,t),$(e,n)},p:rt,i:rt,o:rt,d(i){i&&V(e)}}}class IC extends It{constructor(e){super(),Et(this,e,null,EC,xt,{})}}function AC(r,e,t){const n=e[1],i=e[0],o=n-i;return r===n&&t?r:((r-i)%o+o)%o+i}function hy(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let qu;async function PC(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const i of e??[])if(!(n&&(i.minZoom!=null&&i.minZoom>n[0]||i.maxZoom!=null&&i.maxZoom<n[0]))){if(i.type==="fixed")return i.coordinates.join(",");e:if(i.type==="client-geolocation"){if(qu&&i.cachedLocationExpiry&&qu.time+i.cachedLocationExpiry>Date.now()){if(!qu.coords)break e;return qu.coords}let o;try{return o=await new Promise((u,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(d=>{u([d.coords.longitude,d.coords.latitude].map(p=>p.toFixed(6)).join(","))},d=>{a(d)},i)}),o}catch{}finally{i.cachedLocationExpiry&&(qu={time:Date.now(),coords:o})}if(t.signal.aborted)return}if(i.type==="server-geolocation")return"ip";if(n&&i.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const zC=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,fy=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,dy=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,py=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,my=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,_y=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function DC(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(T=>Number(T.trim())),t=Number(e[0]),n=Number(e[1]),i=Math.abs(t),o=Math.abs(n),u=t>0?"N":"S",a=n>0?"E":"W";let d;r=="DD"&&(d=`${i} ${u}, ${o} ${a}`);const p=Math.floor(i),g=Math.floor(o),y=(i-p)*60,w=(o-g)*60;if(r=="DM"){let T=gy(y,3).toFixed(3).padStart(6,"0"),L=gy(w,3).toFixed(3).padStart(6,"0");T.endsWith(".000")&&L.endsWith(".000")&&(T=T.replace(/\.000$/,""),L=L.replace(/\.000$/,"")),d=`${p} ${T}' ${u}, ${g} ${L}' ${a}`}if(r=="DMS"){const T=Math.floor(y),L=Math.floor(w);let D=((y-T)*60).toFixed(1).padStart(4,"0"),R=((w-L)*60).toFixed(1).padStart(4,"0");const z=T.toString().padStart(2,"0"),I=L.toString().padStart(2,"0");D.endsWith(".0")&&R.endsWith(".0")&&(D=D.replace(/\.0$/,""),R=R.replace(/\.0$/,"")),d=`${p} ${z}' ${D}" ${u}, ${g} ${I}' ${R}" ${a}`}return d}else throw new Error("no decimal coordinates to convert")}function gy(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function e_(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,n=null,i="",o="",u=null,a=[],d=!1;if(zC.test(r))throw new Error("invalid coordinate value");if(fy.test(r))if(a=fy.exec(r),d=Zu(a),d)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),n=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(n*=-1),u="DM";else throw new Error("invalid coordinate format");else if(dy.test(r))if(a=dy.exec(r),d=Zu(a),d){if(t=a[2],n=a[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),u="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");a[1]?(i=a[1],o=a[5]):a[4]&&(i=a[4],o=a[8])}else throw new Error("invalid decimal coordinate format");else if(py.test(r))if(a=py.exec(r),d=Zu(a),d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,u="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,u="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[9])),a[11]&&(n+=a[11]/60),a[13]&&(n+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(n=-1*n),a[1]?(i=a[1],o=a[8]):a[7]&&(i=a[7],o=a[14]);else throw new Error("invalid DMS coordinates format");else if(my.test(r))if(a=my.exec(r),d=Zu(a),d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,u="DM"),a[6]&&(t+=a[6]/3600,u="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12]/60),a[14]&&(n+=a[14]/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(i=a[1],o=a[9]):a[8]&&(i=a[8],o=a[16]);else throw new Error("invalid DMS coordinates format");else if(_y.test(r)){if(a=_y.exec(r),d=Zu(a),a.filter(p=>p).length<=5)throw new Error("invalid coordinates format");if(d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,u="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,u="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12].replace(",",".")/60),a[14]&&(n+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(i=a[1],o=a[9]):a[8]&&(i=a[8],o=a[16]);else throw new Error("invalid coordinates format")}if(d){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(i&&!o||!i&&o)throw new Error("invalid coordinates value");if(i&&i==o)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let p=/S|SOUTH/i;p.test(i)&&t>0&&(t=-1*t),p=/W|WEST/i,p.test(o)&&n>0&&(n=-1*n);const g=a[0].trim();let y,w;const T=/[,/;\u0020]/g,L=g.match(T);if(L==null){const z=Math.floor(r.length/2);y=g.substring(0,z).trim(),w=g.substring(z).trim()}else{let z;L.length%2==1?z=Math.floor(L.length/2):z=L.length/2-1;let I=0;if(z==0)I=g.indexOf(L[0]),y=g.substring(0,I).trim(),w=g.substring(I+1).trim();else{let F=0,N=0;for(;F<=z;)I=g.indexOf(L[F],N),N=I+1,F++;y=g.substring(0,I).trim(),w=g.substring(I+1).trim()}}const D=y.split(".");if(D.length==2&&D[1]==0&&D[1].length!=2)throw new Error("invalid coordinates format");const R=w.split(".");if(R.length==2&&R[1]==0&&R[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(y)||/^\d+$/.test(w))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:g,verbatimLatitude:y,verbatimLongitude:w,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:u,closeEnough:RC,toCoordinateFormat:DC})}else throw new Error("coordinates pattern match failed")}function Zu(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,i=e.length/2;for(let o=0;o<i;o++){const u=e[o],a=e[o+i],d=t.test(u)&&t.test(a),p=n.test(u)&&n.test(a),g=u==a;if(!(u==null&&a==null)){if(u==null||a==null)return!1;if(d||p||g)continue;return!1}}return!0}function yy(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function RC(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return yy(this.decimalLatitude,Number(e[0]))&&yy(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const $C=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});e_.to=$C;const FC=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],BC={decimalLatitude:40.123,decimalLongitude:-74.123},OC=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],NC=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function jC(){const r=[];return FC.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...BC})}),[...r,...OC,...NC]}const UC=jC();e_.formats=UC.map(r=>r.verbatimCoordinates);const VC=e_;function by(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function vy(r){let e,t;return e=new TC({}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function wy(r){let e,t,n,i,o;return t=new LC({}),{c(){e=U("button"),de(t.$$.fragment),ue(e,"type","button"),ue(e,"title",r[9]),ue(e,"class","svelte-bz0zu3"),Yt(e,"active",r[0])},m(u,a){q(u,e,a),he(t,e,null),n=!0,i||(o=yt(e,"click",r[69]),i=!0)},p(u,a){(!n||a[0]&512)&&ue(e,"title",u[9]),(!n||a[0]&1)&&Yt(e,"active",u[0])},i(u){n||(j(t.$$.fragment,u),n=!0)},o(u){G(t.$$.fragment,u),n=!1},d(u){u&&V(e),fe(t),i=!1,o()}}}function qC(r){let e,t=[],n=new Map,i,o,u,a=$n(r[14]);const d=p=>p[84].id+(p[84].address?","+p[84].address:"");for(let p=0;p<a.length;p+=1){let g=by(r,a,p),y=d(g);n.set(y,t[p]=xy(y,g))}return{c(){e=U("ul");for(let p=0;p<t.length;p+=1)t[p].c();ue(e,"class","options svelte-bz0zu3")},m(p,g){q(p,e,g);for(let y=0;y<t.length;y+=1)t[y]&&t[y].m(e,null);i=!0,o||(u=[yt(e,"mouseleave",r[73]),yt(e,"blur",r[74])],o=!0)},p(p,g){g[0]&17880064&&(a=$n(p[14]),tn(),t=Y2(t,g,d,1,p,a,n,e,J2,xy,null,by),nn())},i(p){if(!i){for(let g=0;g<a.length;g+=1)j(t[g]);i=!0}},o(p){for(let g=0;g<t.length;g+=1)G(t[g]);i=!1},d(p){p&&V(e);for(let g=0;g<t.length;g+=1)t[g].d();o=!1,mr(u)}}}function ZC(r){let e,t,n,i,o,u;return t=new Av({}),{c(){e=U("div"),de(t.$$.fragment),n=oe(),i=U("div"),o=xe(r[7]),ue(i,"class","svelte-bz0zu3"),ue(e,"class","no-results svelte-bz0zu3")},m(a,d){q(a,e,d),he(t,e,null),$(e,n),$(e,i),$(i,o),u=!0},p(a,d){(!u||d[0]&128)&&St(o,a[7])},i(a){u||(j(t.$$.fragment,a),u=!0)},o(a){G(t.$$.fragment,a),u=!1},d(a){a&&V(e),fe(t)}}}function GC(r){let e="",t;return{c(){t=xe(e)},m(n,i){q(n,t,i)},p:rt,i:rt,o:rt,d(n){n&&V(t)}}}function HC(r){let e,t,n,i,o,u,a,d,p,g,y;return t=new Av({}),d=new Iv({}),{c(){e=U("div"),de(t.$$.fragment),n=oe(),i=U("div"),o=xe(r[6]),u=oe(),a=U("button"),de(d.$$.fragment),ue(i,"class","svelte-bz0zu3"),ue(a,"class","svelte-bz0zu3"),ue(e,"class","error svelte-bz0zu3")},m(w,T){q(w,e,T),he(t,e,null),$(e,n),$(e,i),$(i,o),$(e,u),$(e,a),he(d,a,null),p=!0,g||(y=yt(a,"click",r[70]),g=!0)},p(w,T){(!p||T[0]&64)&&St(o,w[6])},i(w){p||(j(t.$$.fragment,w),j(d.$$.fragment,w),p=!0)},o(w){G(t.$$.fragment,w),G(d.$$.fragment,w),p=!1},d(w){w&&V(e),fe(t),fe(d),g=!1,y()}}}function xy(r,e){let t,n,i;function o(){return e[71](e[86])}function u(){return e[72](e[84])}return n=new SC({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",o),n.$on("focus",u),{key:r,first:null,c(){t=Jn(),de(n.$$.fragment),this.first=t},m(a,d){q(a,t,d),he(n,a,d),i=!0},p(a,d){e=a;const p={};d[0]&16384&&(p.feature=e[84]),d[0]&1024&&(p.showPlaceType=e[10]),d[0]&49152&&(p.selected=e[15]===e[86]),d[0]&4096&&(p.iconsBaseUrl=e[12]),n.$set(p)},i(a){i||(j(n.$$.fragment,a),i=!0)},o(a){G(n.$$.fragment,a),i=!1},d(a){a&&V(t),fe(n,a)}}}function WC(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L,D,R,z,I,F,N,W,se=!1;o=new IC({}),y=new Iv({});let J=r[19]&&vy(),Y=r[5]==="button"&&wy(r);const _e=r[61].default,ze=En(_e,r,r[60],null),ee=[HC,GC,ZC,qC],ae=[];function Ee(we,it){var Ge,Ie;return we[18]?0:we[16]?((Ge=we[14])==null?void 0:Ge.length)===0?2:we[16]&&((Ie=we[14])!=null&&Ie.length)?3:-1:1}return~(R=Ee(r))&&(z=ae[R]=ee[R](r)),{c(){e=oe(),t=U("form"),n=U("div"),i=U("button"),de(o.$$.fragment),u=oe(),a=U("input"),d=oe(),p=U("div"),g=U("button"),de(y.$$.fragment),w=oe(),J&&J.c(),T=oe(),Y&&Y.c(),L=oe(),ze&&ze.c(),D=oe(),z&&z.c(),ue(i,"class","search-button svelte-bz0zu3"),ue(i,"type","button"),ue(a,"placeholder",r[8]),ue(a,"aria-label",r[8]),ue(a,"class","svelte-bz0zu3"),ue(g,"type","button"),ue(g,"title",r[3]),ue(g,"class","svelte-bz0zu3"),ue(p,"class","clear-button-container svelte-bz0zu3"),Yt(p,"displayable",r[1]!==""),ue(n,"class","input-group svelte-bz0zu3"),ue(t,"tabindex","0"),ue(t,"class",I=nd(r[2])+" svelte-bz0zu3"),Yt(t,"can-collapse",r[4]&&r[1]==="")},m(we,it){q(we,e,it),q(we,t,it),$(t,n),$(n,i),he(o,i,null),$(n,u),$(n,a),r[63](a),qn(a,r[1]),$(n,d),$(n,p),$(p,g),he(y,g,null),$(p,w),J&&J.m(p,null),$(n,T),Y&&Y.m(n,null),$(n,L),ze&&ze.m(n,null),$(t,D),~R&&ae[R].m(t,null),F=!0,N||(W=[yt(i,"click",r[62]),yt(a,"input",r[64]),yt(a,"focus",r[65]),yt(a,"blur",r[66]),yt(a,"keydown",r[22]),yt(a,"input",r[67]),yt(g,"click",r[68]),yt(t,"submit",Am(r[21]))],N=!0)},p(we,it){(!F||it[0]&256)&&ue(a,"placeholder",we[8]),(!F||it[0]&256)&&ue(a,"aria-label",we[8]),it[0]&2&&a.value!==we[1]&&qn(a,we[1]),(!F||it[0]&8)&&ue(g,"title",we[3]),we[19]?J?it[0]&524288&&j(J,1):(J=vy(),J.c(),j(J,1),J.m(p,null)):J&&(tn(),G(J,1,1,()=>{J=null}),nn()),(!F||it[0]&2)&&Yt(p,"displayable",we[1]!==""),we[5]==="button"?Y?(Y.p(we,it),it[0]&32&&j(Y,1)):(Y=wy(we),Y.c(),j(Y,1),Y.m(n,L)):Y&&(tn(),G(Y,1,1,()=>{Y=null}),nn()),ze&&ze.p&&(!F||it[1]&536870912)&&An(ze,_e,we,we[60],F?In(_e,we[60],it,null):Pn(we[60]),null);let Ge=R;R=Ee(we),R===Ge?~R&&ae[R].p(we,it):(z&&(tn(),G(ae[Ge],1,1,()=>{ae[Ge]=null}),nn()),~R?(z=ae[R],z?z.p(we,it):(z=ae[R]=ee[R](we),z.c()),j(z,1),z.m(t,null)):z=null),(!F||it[0]&4&&I!==(I=nd(we[2])+" svelte-bz0zu3"))&&ue(t,"class",I),(!F||it[0]&22)&&Yt(t,"can-collapse",we[4]&&we[1]==="")},i(we){F||(j(se),j(o.$$.fragment,we),j(y.$$.fragment,we),j(J),j(Y),j(ze,we),j(z),F=!0)},o(we){G(se),G(o.$$.fragment,we),G(y.$$.fragment,we),G(J),G(Y),G(ze,we),G(z),F=!1},d(we){we&&(V(e),V(t)),fe(o),r[63](null),fe(y),J&&J.d(),Y&&Y.d(),ze&&ze.d(we),~R&&ae[R].d(),N=!1,mr(W)}}}function KC(r,e,t){let n,i,{$$slots:o={},$$scope:u}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:d=void 0}=e,{apiKey:p}=e,{bbox:g=void 0}=e,{clearButtonTitle:y="clear"}=e,{clearOnBlur:w=!1}=e,{collapsed:T=!1}=e,{country:L=void 0}=e,{debounceSearch:D=200}=e,{enableReverse:R="never"}=e,{errorMessage:z="Something went wrong"}=e,{filter:I=()=>!0}=e,{flyTo:F=!0}=e,{fuzzyMatch:N=!0}=e,{language:W=void 0}=e,{limit:se=void 0}=e,{mapController:J=void 0}=e,{minLength:Y=2}=e,{noResultsMessage:_e="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:ze="Search"}=e,{proximity:ee=[{type:"server-geolocation"}]}=e,{reverseActive:ae=R==="always"}=e,{reverseButtonTitle:Ee="toggle reverse geocoding"}=e,{searchValue:we=""}=e,{pickedResultStyle:it="full-geometry"}=e,{showPlaceType:Ge="if-needed"}=e,{showResultsWhileTyping:Ie=!0}=e,{selectFirst:De=!0}=e,{flyToSelected:Ct=!1}=e,{markerOnSelected:nt=!0}=e,{types:lt=void 0}=e,{exhaustiveReverseGeocoding:mt=!1}=e,{excludeTypes:ht=!1}=e,{zoom:We=a}=e,{apiUrl:Bt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Lt={}}=e,{iconsBaseUrl:Nt="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:Mt=()=>{}}=e;function Qt(){Oe.focus()}function bt(){Oe.blur()}function Dt(ne,He=!0,Xe=!1){t(1,we=ne),He?(t(15,tt=-1),vt()):(mn(!Xe,Xe),setTimeout(()=>{Oe.focus(),Oe.select()}))}function pn(){t(14,kt=void 0),t(56,ye=void 0),t(15,tt=-1)}function qe(){t(55,Ut=[]),t(56,ye=void 0)}let Ve=!1,kt,Ut,ye,zn="",Oe,tt=-1,Kt,Un=[],ur,pr,Ar,Pr;const go=new Set,hr=ds();ti(()=>{J&&(J.setEventHandler(void 0),J.indicateReverse(!1),J.setSelectedMarker(-1),J.setFeatures(void 0,void 0,!1))});function vt(ne){if(pr&&(clearTimeout(pr),pr=void 0),tt>-1&&kt)t(56,ye=kt[tt]),t(1,we=ye.place_type[0]==="reverse"?ye.place_name:ye.place_name.replace(/,.*/,"")),t(18,Kt=void 0),t(55,Ut=void 0),t(15,tt=-1);else if(we){const He=ne||!Vr(we);or(we,{exact:!0}).then(()=>{t(55,Ut=kt),t(56,ye=void 0),He&&Kn()}).catch(Xe=>t(18,Kt=Xe))}}function Vr(ne){try{return VC(ne,6)}catch{return!1}}async function or(ne,{byId:He=!1,exact:Xe=!1}={}){t(18,Kt=void 0),ur==null||ur.abort();const Ye=new AbortController;t(19,ur=Ye);try{const at=Vr(ne),Tt=new URLSearchParams;if(W!==void 0&&Tt.set("language",Array.isArray(W)?W.join(","):W??""),lt&&Tt.set("types",lt.join(",")),ht&&Tt.set("excludeTypes",String(ht)),g&&Tt.set("bbox",g.map(Fn=>Fn.toFixed(6)).join(",")),L&&Tt.set("country",Array.isArray(L)?L.join(","):L),!He&&!at){const Fn=await PC(J,ee,Ye);Fn&&Tt.set("proximity",Fn),(Xe||!Ie)&&Tt.set("autocomplete","false"),Tt.set("fuzzyMatch",String(N))}se!==void 0&&(mt||!at||(lt==null?void 0:lt.length)===1)&&Tt.set("limit",String(se)),Tt.set("key",p),Mt(Tt);const Xt=Bt+"/"+encodeURIComponent(at?at.decimalLongitude+","+at.decimalLatitude:ne)+".json?"+Tt.toString();if(Xt===zn){He?(t(14,kt=void 0),t(56,ye=Un[0])):t(14,kt=Un);return}zn=Xt;const hn=await fetch(Xt,{signal:Ye.signal,...Lt});if(!hn.ok)throw new Error(await hn.text());const vn=await hn.json();hr("response",{url:Xt,featureCollection:vn}),He?(t(14,kt=void 0),t(56,ye=vn.features[0]),Un=[ye]):(t(14,kt=vn.features.filter(I)),at&&kt.unshift({type:"Feature",properties:{},id:"reverse_"+at.decimalLongitude+"_"+at.decimalLatitude,text:at.decimalLatitude+", "+at.decimalLongitude,place_name:at.decimalLatitude+", "+at.decimalLongitude,place_type:["reverse"],center:[at.decimalLongitude,at.decimalLatitude],bbox:[at.decimalLongitude,at.decimalLatitude,at.decimalLongitude,at.decimalLatitude],geometry:{type:"Point",coordinates:[at.decimalLongitude,at.decimalLatitude]}}),Un=kt,at&&Oe.focus())}catch(at){if(at&&typeof at=="object"&&"name"in at&&at.name==="AbortError")return;throw at}finally{Ye===ur&&t(19,ur=void 0)}}function Kn(){var Ye;if(!(Ut!=null&&Ut.length)||!F)return;const ne=[180,90,-180,-90],He=!Ut.some(at=>!at.matching_text);let Xe;for(const at of Ut){const Tt=Yn(at);if(Xe=Xe===void 0?Tt:Tt===void 0?Xe:Math.max(Xe,Tt),He||!at.matching_text)for(const Xt of[0,1,2,3])ne[Xt]=Math[Xt<2?"min":"max"](ne[Xt],((Ye=at.bbox)==null?void 0:Ye[Xt])??at.center[Xt%2])}J&&Ut.length>0&&(ye&&ne[0]===ne[2]&&ne[1]===ne[3]?J.flyTo(ye.center,Yn(ye)):J.fitBounds(hy(ne),50,Xe))}function Yn(ne){var Xe;if(!ne.bbox||ne.bbox[0]!==ne.bbox[2]&&ne.bbox[1]!==ne.bbox[3])return;const He=ne.id.replace(/\..*/,"");return(Array.isArray((Xe=ne.properties)==null?void 0:Xe.categories)?ne.properties.categories.reduce((Ye,at)=>{const Tt=We[He+"."+at];return Ye===void 0?Tt:Tt===void 0?Ye:Math.max(Ye,Tt)},void 0):void 0)??We[He]}function Pt(ne){t(0,ae=R==="always"),t(14,kt=void 0),t(56,ye=void 0),t(15,tt=-1),Dt(ne[1].toFixed(6)+", "+AC(ne[0],[-180,180],!0).toFixed(6),!1,!0)}function sn(ne){if(!kt)return;let He=ne.key==="ArrowDown"?1:ne.key==="ArrowUp"?-1:0;He&&(tt===(De?0:-1)&&He===-1&&t(15,tt=kt.length),t(15,tt+=He),tt>=kt.length&&t(15,tt=-1),tt<0&&De&&t(15,tt=0),ne.preventDefault())}function mn(ne=!0,He=!1){if(t(18,Kt=void 0),Ie||He){if(pr&&clearTimeout(pr),we.length<Y)return;const Xe=we;pr=window.setTimeout(()=>{or(Xe).catch(Ye=>t(18,Kt=Ye))},ne?D:0)}else t(14,kt=void 0),t(18,Kt=void 0)}function Qn(ne){t(56,ye=ne),t(1,we=ne.place_name),t(15,tt=-1)}const _i=()=>Oe.focus();function _n(ne){un[ne?"unshift":"push"](()=>{Oe=ne,t(17,Oe)})}function Nr(){we=this.value,t(1,we),t(13,Ve),t(28,w)}const _r=()=>t(13,Ve=!0),Ce=()=>t(13,Ve=!1),te=()=>mn(),ie=()=>{t(1,we=""),Oe.focus()},le=()=>t(0,ae=!ae),ge=()=>t(18,Kt=void 0),Ae=ne=>t(15,tt=ne),Be=ne=>Qn(ne),je=()=>{De||t(15,tt=-1)},Re=()=>{};return r.$$set=ne=>{"class"in ne&&t(2,d=ne.class),"apiKey"in ne&&t(26,p=ne.apiKey),"bbox"in ne&&t(27,g=ne.bbox),"clearButtonTitle"in ne&&t(3,y=ne.clearButtonTitle),"clearOnBlur"in ne&&t(28,w=ne.clearOnBlur),"collapsed"in ne&&t(4,T=ne.collapsed),"country"in ne&&t(29,L=ne.country),"debounceSearch"in ne&&t(30,D=ne.debounceSearch),"enableReverse"in ne&&t(5,R=ne.enableReverse),"errorMessage"in ne&&t(6,z=ne.errorMessage),"filter"in ne&&t(31,I=ne.filter),"flyTo"in ne&&t(32,F=ne.flyTo),"fuzzyMatch"in ne&&t(33,N=ne.fuzzyMatch),"language"in ne&&t(34,W=ne.language),"limit"in ne&&t(35,se=ne.limit),"mapController"in ne&&t(36,J=ne.mapController),"minLength"in ne&&t(37,Y=ne.minLength),"noResultsMessage"in ne&&t(7,_e=ne.noResultsMessage),"placeholder"in ne&&t(8,ze=ne.placeholder),"proximity"in ne&&t(38,ee=ne.proximity),"reverseActive"in ne&&t(0,ae=ne.reverseActive),"reverseButtonTitle"in ne&&t(9,Ee=ne.reverseButtonTitle),"searchValue"in ne&&t(1,we=ne.searchValue),"pickedResultStyle"in ne&&t(39,it=ne.pickedResultStyle),"showPlaceType"in ne&&t(10,Ge=ne.showPlaceType),"showResultsWhileTyping"in ne&&t(40,Ie=ne.showResultsWhileTyping),"selectFirst"in ne&&t(11,De=ne.selectFirst),"flyToSelected"in ne&&t(41,Ct=ne.flyToSelected),"markerOnSelected"in ne&&t(42,nt=ne.markerOnSelected),"types"in ne&&t(43,lt=ne.types),"exhaustiveReverseGeocoding"in ne&&t(44,mt=ne.exhaustiveReverseGeocoding),"excludeTypes"in ne&&t(45,ht=ne.excludeTypes),"zoom"in ne&&t(46,We=ne.zoom),"apiUrl"in ne&&t(47,Bt=ne.apiUrl),"fetchParameters"in ne&&t(48,Lt=ne.fetchParameters),"iconsBaseUrl"in ne&&t(12,Nt=ne.iconsBaseUrl),"adjustUrlQuery"in ne&&t(49,Mt=ne.adjustUrlQuery),"$$scope"in ne&&t(60,u=ne.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,ae=R==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,Ar=Ve),w&&!Ve&&t(1,we="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&we.length<Y&&(t(56,ye=void 0),t(14,kt=void 0),t(18,Kt=void 0),t(55,Ut=kt)),r.$$.dirty[1]&33554688&&it!=="marker-only"&&ye&&!ye.address&&ye.geometry.type==="Point"&&ye.place_type[0]!=="reverse"&&or(ye.id,{byId:!0}).catch(ne=>t(18,Kt=ne)),r.$$.dirty[1]&100663330&&(J&&ye&&ye.id!==Pr&&F&&(!ye.bbox||ye.bbox[0]===ye.bbox[2]&&ye.bbox[1]===ye.bbox[3]?J.flyTo(ye.center,Yn(ye)):J.fitBounds(hy(ye.bbox),50,Yn(ye)),t(14,kt=void 0),t(55,Ut=void 0),t(15,tt=-1)),t(57,Pr=ye==null?void 0:ye.id)),r.$$.dirty[0]&18432&&De&&kt!=null&&kt.length&&t(15,tt=0),r.$$.dirty[0]&2&&t(15,tt=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&Ut!==kt&&t(55,Ut=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&J&&J.setEventHandler(ne=>{switch(ne.type){case"mapClick":ae&&Pt(ne.coordinates);break;case"markerClick":{const He=kt==null?void 0:kt.find(Xe=>Xe.id===ne.id);He&&Qn(He)}break;case"markerMouseEnter":Ut&&t(15,tt=Ar?(kt==null?void 0:kt.findIndex(He=>He.id===ne.id))??-1:-1);break;case"markerMouseLeave":Ut&&t(15,tt=-1);break}}),r.$$.dirty[0]&49152&&t(58,i=kt==null?void 0:kt[tt]),r.$$.dirty[1]&134218786&&J&&i&&F&&Ct&&J.flyTo(i.center,Yn(i)),r.$$.dirty[1]&256&&t(59,n=it==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(nt||J==null||J.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&J&&nt&&!Ut&&(J.setFeatures(i?[i]:void 0,void 0,n),J.setSelectedMarker(i?0:-1)),r.$$.dirty[1]&318767136&&J&&J.setFeatures(Ut,ye,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&Ut&&J&&J.setSelectedMarker(tt),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&J){const ne=Vr(we);J.setReverseMarker(ne?[ne.decimalLongitude,ne.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&hr("select",{feature:i}),r.$$.dirty[1]&33554432&&hr("pick",{feature:ye}),r.$$.dirty[0]&81920&&hr("optionsvisibilitychange",{optionsVisible:Ar&&!!kt}),r.$$.dirty[0]&16384&&hr("featureslisted",{features:kt}),r.$$.dirty[1]&16777216&&hr("featuresmarked",{features:Ut}),r.$$.dirty[0]&1&&hr("reversetoggle",{reverse:ae}),r.$$.dirty[0]&2&&hr("querychange",{query:we}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&J&&J.indicateReverse(ae)},[ae,we,d,y,T,R,z,_e,ze,Ee,Ge,De,Nt,Ve,kt,tt,Ar,Oe,Kt,ur,go,vt,sn,mn,Qn,a,p,g,w,L,D,I,F,N,W,se,J,Y,ee,it,Ie,Ct,nt,lt,mt,ht,We,Bt,Lt,Mt,Qt,bt,Dt,pn,qe,Ut,ye,Pr,i,n,u,o,_i,_n,Nr,_r,Ce,te,ie,le,ge,Ae,Be,je,Re]}class XC extends It{constructor(e){super(),Et(this,e,KC,WC,xt,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function ky(r){let e,t,n;return t=new XC({props:{mapController:r[2],apiKey:r[0],country:r[1],types:r[3],proximity:[{type:"map-center"}]}}),{c(){e=U("div"),de(t.$$.fragment),ue(e,"class","svelte-ixhnie")},m(i,o){q(i,e,o),he(t,e,null),n=!0},p(i,o){const u={};o&4&&(u.mapController=i[2]),o&1&&(u.apiKey=i[0]),o&2&&(u.country=i[1]),t.$set(u)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&V(e),fe(t)}}}function JC(r){let e,t,n=r[2]&&ky(r);return{c(){n&&n.c(),e=Jn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,[o]){i[2]?n?(n.p(i,o),o&4&&j(n,1)):(n=ky(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),G(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){G(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function YC(r,e,t){let n,{apiKey:i}=e,{map:o}=e,{country:u}=e,a=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function d(p){return p?Ev(p,ei,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=p=>{"apiKey"in p&&t(0,i=p.apiKey),"map"in p&&t(4,o=p.map),"country"in p&&t(1,u=p.country)},r.$$.update=()=>{r.$$.dirty&16&&t(2,n=d(o))},[i,u,n,a,o]}class QC extends It{constructor(e){super(),Et(this,e,YC,JC,xt,{apiKey:0,map:4,country:1})}}const eT=Symbol.for("svelte-maplibre");function tT(){return xh(eT)}function nT(r){return"layerType"in r&&r.layerType==="deckgl"}const rT=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),Sy=r=>{var e;return{features:r[4],data:(e=r[4])==null?void 0:e[0],map:r[2],close:r[31]}};function Cy(r){let e,t,n=(r[4]||r[3]instanceof ei.Marker)&&Ty(r);return{c(){e=U("div"),n&&n.c()},m(i,o){q(i,e,o),n&&n.m(e,null),r[32](e),t=!0},p(i,o){i[4]||i[3]instanceof ei.Marker?n?(n.p(i,o),o[0]&24&&j(n,1)):(n=Ty(i),n.c(),j(n,1),n.m(e,null)):n&&(tn(),G(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){G(n),t=!1},d(i){i&&V(e),n&&n.d(),r[32](null)}}}function Ty(r){let e;const t=r[30].default,n=En(t,r,r[29],Sy);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[0]&536870933)&&An(n,t,i,i[29],e?In(t,i[29],o,rT):Pn(i[29]),Sy)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function iT(r){let e,t,n=r[9].default&&Cy(r);return{c(){n&&n.c(),e=Jn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,o){i[9].default?n?(n.p(i,o),o[0]&512&&j(n,1)):(n=Cy(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),G(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){G(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function oT(r,e,t){let n,i,o,u,a,d,{$$slots:p={},$$scope:g}=e;const y=Im(p);let{closeButton:w=void 0}=e,{closeOnClickOutside:T=!0}=e,{closeOnClickInside:L=!1}=e,{closeOnMove:D=!1}=e,{openOn:R="click"}=e,{openIfTopMost:z=!0}=e,{focusAfterOpen:I=!0}=e,{anchor:F=void 0}=e,{offset:N=void 0}=e,{popupClass:W=void 0}=e,{maxWidth:se=void 0}=e,{lngLat:J=void 0}=e,{html:Y=void 0}=e,{open:_e=!1}=e;const ze=ds(),{map:ee,popupTarget:ae,layerEvent:Ee,layer:we,eventTopMost:it}=tT();st(r,ee,Ve=>t(2,o=Ve)),st(r,ae,Ve=>t(3,a=Ve)),st(r,Ee,Ve=>t(28,u=Ve)),st(r,we,Ve=>t(35,d=Ve));const Ge=["click","dblclick","contextmenu"];let Ie,De=!1,Ct;function nt(){if(!Ie)return;let Ve=Ie.getElement();!Ve||Ve===Ct||(Ct=Ve,R==="hover"&&(Ct.style.pointerEvents="none"),Ct.addEventListener("mouseenter",()=>{t(24,De=!0)},{passive:!0}),Ct.addEventListener("mouseleave",()=>{t(24,De=!1)},{passive:!0}),Ct.addEventListener("click",()=>{L&&t(0,_e=!1)},{passive:!0}))}Ts(()=>{if(o)return o.on("click",bt),o.on("contextmenu",bt),typeof a=="string"&&(o.on("click",a,We),o.on("dblclick",a,We),o.on("contextmenu",a,We),o.on("mousemove",a,Qt),o.on("mouseleave",a,Mt),o.on("touchstart",a,Lt),o.on("touchend",a,Nt)),()=>{o!=null&&o.loaded()&&(Ie==null||Ie.remove(),o.off("click",bt),o.off("contextmenu",bt),a instanceof ei.Marker?a.getPopup()===Ie&&a.setPopup(void 0):typeof a=="string"&&(o.off("click",a,We),o.off("dblclick",a,We),o.off("contextmenu",a,We),o.off("mousemove",a,Qt),o.off("mouseleave",a,Mt),o.off("touchstart",a,Lt),o.off("touchend",a,Nt)))}});function lt(Ve){return z?!("marker"in Ve)&&!nT(Ve)&&it(Ve)!==d:!1}let mt=null,ht="normal";function We(Ve){Ve.type===R&&(lt(Ve)||("layerType"in Ve?Ve.layerType==="deckgl"?(t(10,J=Ve.coordinate),t(4,mt=Ve.object?[Ve.object]:null)):(t(10,J=Ve.lngLat),t(4,mt=Ve.features??[])):(t(10,J=Ve.lngLat),t(4,mt=Ve.features??[])),setTimeout(()=>t(0,_e=!0))))}let Bt=null;function Lt(Ve){Bt=Ve.point}function Nt(Ve){if(!Bt||R!=="hover")return;let kt=Bt.dist(Ve.point);Bt=null,kt<3&&(t(10,J=Ve.lngLat),t(4,mt=Ve.features??[]),Ie.isOpen()?t(25,ht="justOpened"):(t(25,ht="opening"),t(0,_e=!0)))}function Mt(Ve){R!=="hover"||Bt||ht!=="normal"||(t(0,_e=!1),t(4,mt=null))}function Qt(Ve){if(!(R!=="hover"||Bt||ht!=="normal")){if(lt(Ve)){t(0,_e=!1),t(4,mt=null);return}t(0,_e=!0),t(4,mt=Ve.features??[]),t(10,J=Ve.lngLat)}}function bt(Ve){if(ht==="justOpened"){t(25,ht="normal");return}if(!T)return;let kt=[Ct,a instanceof ei.Marker?a==null?void 0:a.getElement():null];_e&&Ie.isOpen()&&!kt.some(Ut=>Ut==null?void 0:Ut.contains(Ve.originalEvent.target))&&(Ve.type==="contextmenu"&&R==="contextmenu"||Ve.type!=="contextmenu")&&t(0,_e=!1)}ti(()=>{o&&(Ie!=null&&Ie.isOpen())&&Ie.remove()});let Dt;const pn=()=>t(0,_e=!1);function qe(Ve){un[Ve?"unshift":"push"](()=>{Dt=Ve,t(1,Dt)})}return r.$$set=Ve=>{"closeButton"in Ve&&t(11,w=Ve.closeButton),"closeOnClickOutside"in Ve&&t(12,T=Ve.closeOnClickOutside),"closeOnClickInside"in Ve&&t(13,L=Ve.closeOnClickInside),"closeOnMove"in Ve&&t(14,D=Ve.closeOnMove),"openOn"in Ve&&t(15,R=Ve.openOn),"openIfTopMost"in Ve&&t(16,z=Ve.openIfTopMost),"focusAfterOpen"in Ve&&t(17,I=Ve.focusAfterOpen),"anchor"in Ve&&t(18,F=Ve.anchor),"offset"in Ve&&t(19,N=Ve.offset),"popupClass"in Ve&&t(20,W=Ve.popupClass),"maxWidth"in Ve&&t(21,se=Ve.maxWidth),"lngLat"in Ve&&t(10,J=Ve.lngLat),"html"in Ve&&t(22,Y=Ve.html),"open"in Ve&&t(0,_e=Ve.open),"$$scope"in Ve&&t(29,g=Ve.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=w??(!T&&!L)),r.$$.dirty[0]&146685952&&(Ie||(t(23,Ie=new ei.Popup({closeButton:n,closeOnClick:!1,closeOnMove:D,focusAfterOpen:I,maxWidth:se,className:W,anchor:F,offset:N})),Ct=Ie.getElement(),Ie.on("open",()=>{t(0,_e=!0),nt(),ze("open",Ie)}),Ie.on("close",()=>{t(0,_e=!1),ze("close",Ie)}),Ie.on("hover",()=>{ze("hover",Ie)}))),r.$$.dirty[0]&8421384&&Ie&&a instanceof ei.Marker&&(R==="click"?a.setPopup(Ie):a.getPopup()===Ie&&a.setPopup(void 0)),r.$$.dirty[0]&268468224&&Ge.includes(R)&&(u==null?void 0:u.type)===R&&(We(u),Ot(Ee,u=null,u)),r.$$.dirty[0]&268468224&&t(26,i=R==="hover"&&((u==null?void 0:u.type)==="mousemove"||(u==null?void 0:u.type)==="mouseenter")),r.$$.dirty[0]&352354304&&R==="hover"&&Ee&&(i&&u&&(u.layerType==="deckgl"?(t(10,J=u.coordinate),t(4,mt=u.object?[u.object]:null)):(t(10,J=u.lngLat),t(4,mt=u.features??[]))),t(0,_e=(i||De)??!1)),r.$$.dirty[0]&12582914&&(Dt?Ie.setDOMContent(Dt):Y&&Ie.setHTML(Y)),r.$$.dirty[0]&8389632&&J&&Ie.setLngLat(J),r.$$.dirty[0]&41943045&&o){let Ve=Ie.isOpen();_e&&!Ve?(Ie.addTo(o),ht==="opening"&&t(25,ht="justOpened")):!_e&&Ve&&Ie.remove()}},[_e,Dt,o,a,mt,ee,ae,Ee,we,y,J,w,T,L,D,R,z,I,F,N,W,se,Y,Ie,De,ht,i,n,u,g,p,pn,qe]}class sT extends It{constructor(e){super(),Et(this,e,oT,iT,xt,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}const aT=r=>({props:r&8}),My=r=>({props:uT(r[3])});function lT(r){let e;const t=r[1].default,n=En(t,r,r[2],My);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&12)&&An(n,t,i,i[2],e?In(t,i[2],o,aT):Pn(i[2]),My)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function cT(r){let e,t;return e=new sT({props:{openOn:r[0],$$slots:{default:[lT,({features:n})=>({3:n}),({features:n})=>n?8:0]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.openOn=n[0]),i&12&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function uT(r){return r?r[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function hT(r,e,t){let{$$slots:n={},$$scope:i}=e,{openOn:o="hover"}=e;return r.$$set=u=>{"openOn"in u&&t(0,o=u.openOn),"$$scope"in u&&t(2,i=u.$$scope)},[o,n,i]}class fi extends It{constructor(e){super(),Et(this,e,hT,cT,xt,{openOn:0})}}function Po(r,e,t){let n=["match",r];for(let[i,o]of Object.entries(e))n.push(i),n.push(o);return n.push(t),n}function so(r,e,t){let n=["step",r];for(let i=1;i<e.length;i++)n.push(t[i-1]),n.push(e[i]);return n.push(t[t.length-1]),n}function Hi(){return{type:"FeatureCollection",features:[]}}function fT(r){let e,t,n;return t=new Fo({props:{colorScale:r[3].colorScale,labels:{limits:r[3].limits}}}),{c(){e=U("div"),de(t.$$.fragment),ue(e,"slot","legend")},m(i,o){q(i,e,o),he(t,e,null),n=!0},p:rt,i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&V(e),fe(t)}}}function dT(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',ue(e,"slot","help")},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function pT(r){let e,t,n;return t=new Fo({props:{colorScale:Object.values(r[4]),labels:{buckets:Object.keys(r[4])},fullWidthBucketLegend:!0}}),{c(){e=U("div"),de(t.$$.fragment),ue(e,"slot","legend")},m(i,o){q(i,e,o),he(t,e,null),n=!0},p:rt,i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&V(e),fe(t)}}}function mT(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',ue(e,"slot","help")},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function _T(r){let e,t,n;return t=new Km({props:{labelColors:r[5]}}),{c(){e=U("div"),de(t.$$.fragment),ue(e,"slot","legend")},m(i,o){q(i,e,o),he(t,e,null),n=!0},p:rt,i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&V(e),fe(t)}}}function gT(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',ue(e,"slot","help")},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function yT(r){let e,t,n,i,o,u;const a=[dn("context-traffic"),{sourceLayer:"cbd_layer"},{filter:["has","Traffic volume category"]},{paint:{"line-color":Po(["get","Traffic volume category"],{"0 to 1999":r[3].colorScale[0],"2000 to 3999":r[3].colorScale[1],"4000+":r[3].colorScale[2]},"cyan"),"line-width":Us(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let d={};for(let T=0;T<a.length;T+=1)d=Gt(d,a[T]);e=new tr({props:d});const p=[dn("context-los"),{sourceLayer:"cbd_layer"},{paint:{"line-color":Po(["get","Level of Service"],r[4],"cyan"),"line-width":Us(1)}},{layout:{visibility:r[1]?"visible":"none"}}];let g={};for(let T=0;T<p.length;T+=1)g=Gt(g,p[T]);n=new tr({props:g});const y=[dn("context-existing-infra"),{sourceLayer:"cbd_layer"},{filter:["!=",["get","Infrastructure type"],"Mixed Traffic Street"]},{paint:{"line-color":Po(["get","Infrastructure type"],r[5],"cyan"),"line-width":Us(1)}},{layout:{visibility:r[2]?"visible":"none"}}];let w={};for(let T=0;T<y.length;T+=1)w=Gt(w,y[T]);return o=new tr({props:w}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment),i=oe(),de(o.$$.fragment)},m(T,L){he(e,T,L),q(T,t,L),he(n,T,L),q(T,i,L),he(o,T,L),u=!0},p(T,L){const D=L&9?Zn(a,[a[0],a[1],a[2],L&8&&{paint:{"line-color":Po(["get","Traffic volume category"],{"0 to 1999":T[3].colorScale[0],"2000 to 3999":T[3].colorScale[1],"4000+":T[3].colorScale[2]},"cyan"),"line-width":Us(0)}},L&1&&{layout:{visibility:T[0]?"visible":"none"}}]):{};e.$set(D);const R=L&18?Zn(p,[p[0],p[1],L&16&&{paint:{"line-color":Po(["get","Level of Service"],T[4],"cyan"),"line-width":Us(1)}},L&2&&{layout:{visibility:T[1]?"visible":"none"}}]):{};n.$set(R);const z=L&36?Zn(y,[y[0],y[1],y[2],L&32&&{paint:{"line-color":Po(["get","Infrastructure type"],T[5],"cyan"),"line-width":Us(1)}},L&4&&{layout:{visibility:T[2]?"visible":"none"}}]):{};o.$set(z)},i(T){u||(j(e.$$.fragment,T),j(n.$$.fragment,T),j(o.$$.fragment,T),u=!0)},o(T){G(e.$$.fragment,T),G(n.$$.fragment,T),G(o.$$.fragment,T),u=!1},d(T){T&&(V(t),V(i)),fe(e,T),fe(n,T),fe(o,T)}}}function bT(r){let e,t,n,i,o,u,a,d,p,g,y;function w(I){r[6](I)}let T={label:"Traffic",$$slots:{help:[dT],legend:[fT]},$$scope:{ctx:r}};r[0]!==void 0&&(T.show=r[0]),e=new Yo({props:T}),un.push(()=>Cn(e,"show",w));function L(I){r[7](I)}let D={label:"Level of Service",$$slots:{help:[mT],legend:[pT]},$$scope:{ctx:r}};r[1]!==void 0&&(D.show=r[1]),i=new Yo({props:D}),un.push(()=>Cn(i,"show",L));function R(I){r[8](I)}let z={label:"Cycle infrastructure",$$slots:{help:[gT],legend:[_T]},$$scope:{ctx:r}};return r[2]!==void 0&&(z.show=r[2]),a=new Yo({props:z}),un.push(()=>Cn(a,"show",R)),g=new Mh({props:{url:`pmtiles://${Ao("cnt_layers/cbd.pmtiles")}`,$$slots:{default:[yT]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment),n=oe(),de(i.$$.fragment),u=oe(),de(a.$$.fragment),p=oe(),de(g.$$.fragment)},m(I,F){he(e,I,F),q(I,n,F),he(i,I,F),q(I,u,F),he(a,I,F),q(I,p,F),he(g,I,F),y=!0},p(I,[F]){const N={};F&512&&(N.$$scope={dirty:F,ctx:I}),!t&&F&1&&(t=!0,N.show=I[0],Sn(()=>t=!1)),e.$set(N);const W={};F&512&&(W.$$scope={dirty:F,ctx:I}),!o&&F&2&&(o=!0,W.show=I[1],Sn(()=>o=!1)),i.$set(W);const se={};F&512&&(se.$$scope={dirty:F,ctx:I}),!d&&F&4&&(d=!0,se.show=I[2],Sn(()=>d=!1)),a.$set(se);const J={};F&519&&(J.$$scope={dirty:F,ctx:I}),g.$set(J)},i(I){y||(j(e.$$.fragment,I),j(i.$$.fragment,I),j(a.$$.fragment,I),j(g.$$.fragment,I),y=!0)},o(I){G(e.$$.fragment,I),G(i.$$.fragment,I),G(a.$$.fragment,I),G(g.$$.fragment,I),y=!1},d(I){I&&(V(n),V(u),V(p)),fe(e,I),fe(i,I),fe(a,I),fe(g,I)}}}function vT(r,e,t){let n=!1,i=!1,o=!1,u={colorScale:["#27918d","#ffaa33","#440154"],limits:[0,2e3,4e3,1e4]},a={High:"mediumseagreen",Medium:"orange",Low:"red","Should not be used":"brown"},d={"Segregated Track (wide)":"#054d05","Off Road Cycleway":"#3a9120","Segregated Track (narrow)":"#87d668","Shared Footway":"#ffbf00","Painted Cycle Lane":"#7faedd"};function p(w){n=w,t(0,n)}function g(w){i=w,t(1,i)}function y(w){o=w,t(2,o)}return[n,i,o,u,a,d,p,g,y]}class wT extends It{constructor(e){super(),Et(this,e,vT,bT,xt,{})}}function xT(r){let e,t,n;return t=new Km({props:{labelColors:r[2],swatchClass:"circle"}}),{c(){e=U("div"),de(t.$$.fragment),ue(e,"slot","legend")},m(i,o){q(i,e,o),he(t,e,null),n=!0},p:rt,i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&V(e),fe(t)}}}function kT(r){let e;return{c(){e=U("p"),e.innerHTML=`See Scottish data sources for
    <a href="https://www.data.gov.uk/dataset/9a6f9d86-9698-4a5d-a2c8-89f3b212c52c/scottish-school-roll-and-locations" target="_blank">schools</a>
    ,
    <a href="https://data.spatialhub.scot/dataset/gp_practices-is" target="_blank">GP practices</a>
    , and
    <a href="https://data.spatialhub.scot/dataset/nhs_hospitals-is" target="_blank">hospitals</a>
    . Other data is from
    <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
    .`,ue(e,"slot","help")},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function Ly(r){let e,t;return e=new dr({props:{data:r[1].getPOIs(),generateId:!0,$$slots:{default:[TT]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.data=n[1].getPOIs()),i&33&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function ST(r){let e=(r[4].name||`unnamed ${r[4].kind}`)+"",t;return{c(){t=xe(e)},m(n,i){q(n,t,i)},p(n,i){i&16&&e!==(e=(n[4].name||`unnamed ${n[4].kind}`)+"")&&St(t,e)},d(n){n&&V(t)}}}function CT(r){let e,t;return e=new fi({props:{openOn:"hover",$$slots:{default:[ST,({props:n})=>({4:n}),({props:n})=>n?16:0]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&48&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function TT(r){let e,t;const n=[dn("context-pois"),{paint:{"circle-color":Po(["get","kind"],r[2],"black"),"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let i={$$slots:{default:[CT]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new _l({props:i}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,u){const a=u&5?Zn(n,[n[0],u&4&&{paint:{"circle-color":Po(["get","kind"],o[2],"black"),"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},u&1&&{layout:{visibility:o[0]?"visible":"none"}}]):{};u&32&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function MT(r){let e,t,n,i,o;function u(p){r[3](p)}let a={label:"POIs",$$slots:{help:[kT],legend:[xT]},$$scope:{ctx:r}};r[0]!==void 0&&(a.show=r[0]),e=new Yo({props:a}),un.push(()=>Cn(e,"show",u));let d=r[1]&&Ly(r);return{c(){de(e.$$.fragment),n=oe(),d&&d.c(),i=Jn()},m(p,g){he(e,p,g),q(p,n,g),d&&d.m(p,g),q(p,i,g),o=!0},p(p,[g]){const y={};g&32&&(y.$$scope={dirty:g,ctx:p}),!t&&g&1&&(t=!0,y.show=p[0],Sn(()=>t=!1)),e.$set(y),p[1]?d?(d.p(p,g),g&2&&j(d,1)):(d=Ly(p),d.c(),j(d,1),d.m(i.parentNode,i)):d&&(tn(),G(d,1,1,()=>{d=null}),nn())},i(p){o||(j(e.$$.fragment,p),j(d),o=!0)},o(p){G(e.$$.fragment,p),G(d),o=!1},d(p){p&&(V(n),V(i)),fe(e,p),d&&d.d(p)}}}function LT(r,e,t){let n;st(r,Ir,a=>t(1,n=a));let i=!1,o={School:"#7fc97f",GP:"#beaed4",Hospital:"#fdc086",Grocery:"#386cb0",CommunityCenter:"#ffff99"};function u(a){i=a,t(0,i)}return[i,n,o,u]}class ET extends It{constructor(e){super(),Et(this,e,LT,MT,xt,{})}}function IT(r){let e,t,n,i,o;return t=new Fo({props:{colorScale:xd,labels:{buckets:dv(kd)}}}),{c(){e=U("div"),de(t.$$.fragment),n=oe(),i=U("div"),i.innerHTML="<span>More deprived</span> <span>Less deprived</span>",ut(i,"display","flex"),ut(i,"justify-content","space-between"),ue(e,"slot","legend")},m(u,a){q(u,e,a),he(t,e,null),$(e,n),$(e,i),o=!0},p:rt,i(u){o||(j(t.$$.fragment,u),o=!0)},o(u){G(t.$$.fragment,u),o=!1},d(u){u&&V(e),fe(t)}}}function AT(r){let e;return{c(){e=U("p"),e.innerHTML=`This shows the Scottish Index of Multiple Deprivation (SIMD) from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
    . SIMD combines different domains: income; employment; health; education, skills
    and training; geographic access to services; crime; and housing.`,ue(e,"slot","help")},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function PT(r){let e,t,n,i,o;return t=new Fo({props:{colorScale:Sd,labels:{limits:Cd}}}),{c(){e=U("div"),de(t.$$.fragment),n=oe(),i=U("div"),i.innerHTML="<span>Less dense</span> <span>people / km</span> <span>More dense</span>",ut(i,"display","flex"),ut(i,"justify-content","space-between"),ue(e,"slot","legend")},m(u,a){q(u,e,a),he(t,e,null),$(e,n),$(e,i),o=!0},p:rt,i(u){o||(j(t.$$.fragment,u),o=!0)},o(u){G(t.$$.fragment,u),o=!1},d(u){u&&V(e),fe(t)}}}function zT(r){let e;return{c(){e=U("p"),e.innerHTML=`This shows population data from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
    .`,ue(e,"slot","help")},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function DT(r){let e,t,n,i,o;return t=new Fo({props:{colorScale:Md,labels:{limits:Td.map(qT)}}}),{c(){e=U("div"),de(t.$$.fragment),n=oe(),i=U("div"),i.innerHTML='<span style="text-align: center; width: 100%">Households with at least one car or van</span>',ut(i,"display","flex"),ut(i,"justify-content","space-between"),ue(e,"slot","legend")},m(u,a){q(u,e,a),he(t,e,null),$(e,n),$(e,i),o=!0},p:rt,i(u){o||(j(t.$$.fragment,u),o=!0)},o(u){G(t.$$.fragment,u),o=!1},d(u){u&&V(e),fe(t)}}}function RT(r){let e;return{c(){e=U("p"),e.textContent="Show households from the Scottish census with at least one car.",ue(e,"slot","help")},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function $T(r){let e,t,n=r[6].id+"",i,o,u=r[6].population.toLocaleString()+"",a,d,p=r[6].imd_rank+"",g,y,w=r[6].imd_percentile+"",T,L;return{c(){e=U("p"),t=xe("Data zone "),i=xe(n),o=xe(`
        has `),a=xe(u),d=xe(`
        people, and a SIMD rank of `),g=xe(p),y=xe(`, making it less deprived
        than `),T=xe(w),L=xe("% of data zones.")},m(D,R){q(D,e,R),$(e,t),$(e,i),$(e,o),$(e,a),$(e,d),$(e,g),$(e,y),$(e,T),$(e,L)},p(D,R){R&64&&n!==(n=D[6].id+"")&&St(i,n),R&64&&u!==(u=D[6].population.toLocaleString()+"")&&St(a,u),R&64&&p!==(p=D[6].imd_rank+"")&&St(g,p),R&64&&w!==(w=D[6].imd_percentile+"")&&St(T,w)},d(D){D&&V(e)}}}function FT(r){let e,t;return e=new fi({props:{openOn:"hover",$$slots:{default:[$T,({props:n})=>({6:n}),({props:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function BT(r){let e,t,n=r[6].id+"",i,o,u=Pc(r[6].households_with_cars_or_vans,r[6].total_households)+"",a,d,p=r[6].total_households.toLocaleString()+"",g,y;return{c(){e=U("p"),t=xe("In data zone "),i=xe(n),o=oe(),a=xe(u),d=xe(" of approximately "),g=xe(p),y=xe(`
        households have at least one car or van.`)},m(w,T){q(w,e,T),$(e,t),$(e,i),$(e,o),$(e,a),$(e,d),$(e,g),$(e,y)},p(w,T){T&64&&n!==(n=w[6].id+"")&&St(i,n),T&64&&u!==(u=Pc(w[6].households_with_cars_or_vans,w[6].total_households)+"")&&St(a,u),T&64&&p!==(p=w[6].total_households.toLocaleString()+"")&&St(g,p)},d(w){w&&V(e)}}}function OT(r){let e,t;return e=new fi({props:{openOn:"hover",$$slots:{default:[BT,({props:n})=>({6:n}),({props:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function NT(r){let e,t,n=r[6].id+"",i,o,u=r[6].population.toLocaleString()+"",a,d,p=Math.round(r[6].population/(r[6].area/1e6)).toLocaleString()+"",g,y;return{c(){e=U("p"),t=xe("Data zone "),i=xe(n),o=xe(`
        has `),a=xe(u),d=xe(`
        people, with a density of `),g=xe(p),y=xe(" people per square kilometer")},m(w,T){q(w,e,T),$(e,t),$(e,i),$(e,o),$(e,a),$(e,d),$(e,g),$(e,y)},p(w,T){T&64&&n!==(n=w[6].id+"")&&St(i,n),T&64&&u!==(u=w[6].population.toLocaleString()+"")&&St(a,u),T&64&&p!==(p=Math.round(w[6].population/(w[6].area/1e6)).toLocaleString()+"")&&St(g,p)},d(w){w&&V(e)}}}function jT(r){let e,t;return e=new fi({props:{openOn:"hover",$$slots:{default:[NT,({props:n})=>({6:n}),({props:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function UT(r){let e,t,n,i,o,u,a,d;const p=[dn("context-simd"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":so(["get","imd_percentile"],kd,xd),"fill-opacity":Wn(.7,.9)}},{layout:{visibility:r[0]?"visible":"none"}}];let g={$$slots:{default:[FT]},$$scope:{ctx:r}};for(let z=0;z<p.length;z+=1)g=Gt(g,p[z]);e=new Pi({props:g});const y=[dn("context-population-car-ownership"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":so(["*",100,["/",["get","households_with_cars_or_vans"],["get","total_households"]]],Td,Md),"fill-opacity":Wn(.7,.9)}},{layout:{visibility:r[2]?"visible":"none"}}];let w={$$slots:{default:[OT]},$$scope:{ctx:r}};for(let z=0;z<y.length;z+=1)w=Gt(w,y[z]);n=new Pi({props:w});const T=[dn("context-population-density"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":so(["/",["get","population"],["/",["get","area"],1e6]],Cd,Sd),"fill-opacity":Wn(.7,.9)}},{layout:{visibility:r[1]?"visible":"none"}}];let L={$$slots:{default:[jT]},$$scope:{ctx:r}};for(let z=0;z<T.length;z+=1)L=Gt(L,T[z]);o=new Pi({props:L});const D=[dn("context-population-outline"),{sourceLayer:"population"},{paint:{"line-color":"black","line-width":1}},{layout:{visibility:r[0]||r[1]||r[2]?"visible":"none"}}];let R={};for(let z=0;z<D.length;z+=1)R=Gt(R,D[z]);return a=new tr({props:R}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment),i=oe(),de(o.$$.fragment),u=oe(),de(a.$$.fragment)},m(z,I){he(e,z,I),q(z,t,I),he(n,z,I),q(z,i,I),he(o,z,I),q(z,u,I),he(a,z,I),d=!0},p(z,I){const F=I&1?Zn(p,[p[0],p[1],p[2],p[3],{layout:{visibility:z[0]?"visible":"none"}}]):{};I&128&&(F.$$scope={dirty:I,ctx:z}),e.$set(F);const N=I&4?Zn(y,[y[0],y[1],y[2],y[3],{layout:{visibility:z[2]?"visible":"none"}}]):{};I&128&&(N.$$scope={dirty:I,ctx:z}),n.$set(N);const W=I&2?Zn(T,[T[0],T[1],T[2],T[3],{layout:{visibility:z[1]?"visible":"none"}}]):{};I&128&&(W.$$scope={dirty:I,ctx:z}),o.$set(W);const se=I&7?Zn(D,[D[0],D[1],D[2],{layout:{visibility:z[0]||z[1]||z[2]?"visible":"none"}}]):{};a.$set(se)},i(z){d||(j(e.$$.fragment,z),j(n.$$.fragment,z),j(o.$$.fragment,z),j(a.$$.fragment,z),d=!0)},o(z){G(e.$$.fragment,z),G(n.$$.fragment,z),G(o.$$.fragment,z),G(a.$$.fragment,z),d=!1},d(z){z&&(V(t),V(i),V(u)),fe(e,z),fe(n,z),fe(o,z),fe(a,z)}}}function VT(r){let e,t,n,i,o,u,a,d,p,g,y;function w(I){r[3](I)}let T={label:"SIMD",$$slots:{help:[AT],legend:[IT]},$$scope:{ctx:r}};r[0]!==void 0&&(T.show=r[0]),e=new Yo({props:T}),un.push(()=>Cn(e,"show",w));function L(I){r[4](I)}let D={label:"Population density",$$slots:{help:[zT],legend:[PT]},$$scope:{ctx:r}};r[1]!==void 0&&(D.show=r[1]),i=new Yo({props:D}),un.push(()=>Cn(i,"show",L));function R(I){r[5](I)}let z={label:"Car ownership",$$slots:{help:[RT],legend:[DT]},$$scope:{ctx:r}};return r[2]!==void 0&&(z.show=r[2]),a=new Yo({props:z}),un.push(()=>Cn(a,"show",R)),g=new Mh({props:{url:`pmtiles://${Ao("cnt_layers/population.pmtiles")}`,$$slots:{default:[UT]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment),n=oe(),de(i.$$.fragment),u=oe(),de(a.$$.fragment),p=oe(),de(g.$$.fragment)},m(I,F){he(e,I,F),q(I,n,F),he(i,I,F),q(I,u,F),he(a,I,F),q(I,p,F),he(g,I,F),y=!0},p(I,[F]){const N={};F&128&&(N.$$scope={dirty:F,ctx:I}),!t&&F&1&&(t=!0,N.show=I[0],Sn(()=>t=!1)),e.$set(N);const W={};F&128&&(W.$$scope={dirty:F,ctx:I}),!o&&F&2&&(o=!0,W.show=I[1],Sn(()=>o=!1)),i.$set(W);const se={};F&128&&(se.$$scope={dirty:F,ctx:I}),!d&&F&4&&(d=!0,se.show=I[2],Sn(()=>d=!1)),a.$set(se);const J={};F&135&&(J.$$scope={dirty:F,ctx:I}),g.$set(J)},i(I){y||(j(e.$$.fragment,I),j(i.$$.fragment,I),j(a.$$.fragment,I),j(g.$$.fragment,I),y=!0)},o(I){G(e.$$.fragment,I),G(i.$$.fragment,I),G(a.$$.fragment,I),G(g.$$.fragment,I),y=!1},d(I){I&&(V(n),V(u),V(p)),fe(e,I),fe(i,I),fe(a,I),fe(g,I)}}}const qT=r=>`${r}%`;function ZT(r,e,t){let n=!1,i=!1,o=!1;function u(p){n=p,t(0,n)}function a(p){i=p,t(1,i)}function d(p){o=p,t(2,o)}return[n,i,o,u,a,d]}class GT extends It{constructor(e){super(),Et(this,e,ZT,VT,xt,{})}}function HT(r){let e;return{c(){e=U("div"),e.innerHTML=`<img src="${yb}" alt="National Rail logo"/>
    Station`,ue(e,"slot","legend"),ut(e,"display","flex"),ut(e,"gap","8px"),ut(e,"align-items","center")},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function WT(r){let e;return{c(){e=U("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:railway%3Dstation" target="_blank">railway stations</a>
    according to OpenStreetMap.`,ue(e,"slot","help")},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function KT(r){let e,t=(r[2].name??"Unnamed railway station")+"",n;return{c(){e=U("p"),n=xe(t)},m(i,o){q(i,e,o),$(e,n)},p(i,o){o&4&&t!==(t=(i[2].name??"Unnamed railway station")+"")&&St(n,t)},d(i){i&&V(e)}}}function XT(r){let e,t;return e=new fi({props:{$$slots:{default:[KT,({props:n})=>({2:n}),({props:n})=>n?4:0]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&12&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function JT(r){let e,t;const n=[dn("context-railway-stations"),{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:r[0]?"visible":"none"}}];let i={$$slots:{default:[XT]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new ph({props:i}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,u){const a=u&1?Zn(n,[n[0],{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:o[0]?"visible":"none"}}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function YT(r){let e,t,n,i,o;function u(d){r[1](d)}let a={label:"Railway stations",$$slots:{help:[WT],legend:[HT]},$$scope:{ctx:r}};return r[0]!==void 0&&(a.show=r[0]),e=new Yo({props:a}),un.push(()=>Cn(e,"show",u)),i=new dr({props:{data:Ao("cnt_layers/railways.geojson"),generateId:!0,$$slots:{default:[JT]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment),n=oe(),de(i.$$.fragment)},m(d,p){he(e,d,p),q(d,n,p),he(i,d,p),o=!0},p(d,[p]){const g={};p&8&&(g.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,g.show=d[0],Sn(()=>t=!1)),e.$set(g);const y={};p&9&&(y.$$scope={dirty:p,ctx:d}),i.$set(y)},i(d){o||(j(e.$$.fragment,d),j(i.$$.fragment,d),o=!0)},o(d){G(e.$$.fragment,d),G(i.$$.fragment,d),o=!1},d(d){d&&V(n),fe(e,d),fe(i,d)}}}function QT(r,e,t){let n=!1;function i(o){n=o,t(0,n)}return[n,i]}class eM extends It{constructor(e){super(),Et(this,e,QT,YT,xt,{})}}function Ey(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Iy(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Ay(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Py(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function zy(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Dy(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function tM(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#routenetwork" target="_blank">Data from NPT</a>',ue(e,"slot","help")},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function Ry(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=xe(t),e.__value=r[18],qn(e,e.__value)},m(i,o){q(i,e,o),$(e,n)},p:rt,d(i){i&&V(e)}}}function $y(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=xe(t),e.__value=r[18],qn(e,e.__value)},m(i,o){q(i,e,o),$(e,n)},p:rt,d(i){i&&V(e)}}}function Fy(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=xe(t),e.__value=r[18],qn(e,e.__value)},m(i,o){q(i,e,o),$(e,n)},p:rt,d(i){i&&V(e)}}}function By(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=xe(t),e.__value=r[18],qn(e,e.__value)},m(i,o){q(i,e,o),$(e,n)},p:rt,d(i){i&&V(e)}}}function nM(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L,D,R,z,I,F=$n(r[7]),N=[];for(let ee=0;ee<F.length;ee+=1)N[ee]=Ry(Dy(r,F,ee));let W=$n(r[8]),se=[];for(let ee=0;ee<W.length;ee+=1)se[ee]=$y(zy(r,W,ee));let J=$n(r[9]),Y=[];for(let ee=0;ee<J.length;ee+=1)Y[ee]=Fy(Py(r,J,ee));let _e=$n(r[10]),ze=[];for(let ee=0;ee<_e.length;ee+=1)ze[ee]=By(Ay(r,_e,ee));return{c(){e=U("div"),t=U("label"),n=xe(`Trip purpose:
      `),i=U("select");for(let ee=0;ee<N.length;ee+=1)N[ee].c();o=oe(),u=U("label"),a=xe(`Scenario:
      `),d=U("select");for(let ee=0;ee<se.length;ee+=1)se[ee].c();p=oe(),g=U("label"),y=xe(`Network type:
      `),w=U("select");for(let ee=0;ee<Y.length;ee+=1)Y[ee].c();T=oe(),L=U("label"),D=xe(`Color by:
      `),R=U("select");for(let ee=0;ee<ze.length;ee+=1)ze[ee].c();r[0]===void 0&&ls(()=>r[11].call(i)),r[1]===void 0&&ls(()=>r[12].call(d)),r[2]===void 0&&ls(()=>r[13].call(w)),r[3]===void 0&&ls(()=>r[14].call(R)),ue(e,"slot","legend")},m(ee,ae){q(ee,e,ae),$(e,t),$(t,n),$(t,i);for(let Ee=0;Ee<N.length;Ee+=1)N[Ee]&&N[Ee].m(i,null);qi(i,r[0],!0),$(e,o),$(e,u),$(u,a),$(u,d);for(let Ee=0;Ee<se.length;Ee+=1)se[Ee]&&se[Ee].m(d,null);qi(d,r[1],!0),$(e,p),$(e,g),$(g,y),$(g,w);for(let Ee=0;Ee<Y.length;Ee+=1)Y[Ee]&&Y[Ee].m(w,null);qi(w,r[2],!0),$(e,T),$(e,L),$(L,D),$(L,R);for(let Ee=0;Ee<ze.length;Ee+=1)ze[Ee]&&ze[Ee].m(R,null);qi(R,r[3],!0),z||(I=[yt(i,"change",r[11]),yt(d,"change",r[12]),yt(w,"change",r[13]),yt(R,"change",r[14])],z=!0)},p(ee,ae){if(ae[0]&128){F=$n(ee[7]);let Ee;for(Ee=0;Ee<F.length;Ee+=1){const we=Dy(ee,F,Ee);N[Ee]?N[Ee].p(we,ae):(N[Ee]=Ry(we),N[Ee].c(),N[Ee].m(i,null))}for(;Ee<N.length;Ee+=1)N[Ee].d(1);N.length=F.length}if(ae[0]&129&&qi(i,ee[0]),ae[0]&256){W=$n(ee[8]);let Ee;for(Ee=0;Ee<W.length;Ee+=1){const we=zy(ee,W,Ee);se[Ee]?se[Ee].p(we,ae):(se[Ee]=$y(we),se[Ee].c(),se[Ee].m(d,null))}for(;Ee<se.length;Ee+=1)se[Ee].d(1);se.length=W.length}if(ae[0]&258&&qi(d,ee[1]),ae[0]&512){J=$n(ee[9]);let Ee;for(Ee=0;Ee<J.length;Ee+=1){const we=Py(ee,J,Ee);Y[Ee]?Y[Ee].p(we,ae):(Y[Ee]=Fy(we),Y[Ee].c(),Y[Ee].m(w,null))}for(;Ee<Y.length;Ee+=1)Y[Ee].d(1);Y.length=J.length}if(ae[0]&516&&qi(w,ee[2]),ae[0]&1024){_e=$n(ee[10]);let Ee;for(Ee=0;Ee<_e.length;Ee+=1){const we=Ay(ee,_e,Ee);ze[Ee]?ze[Ee].p(we,ae):(ze[Ee]=By(we),ze[Ee].c(),ze[Ee].m(R,null))}for(;Ee<ze.length;Ee+=1)ze[Ee].d(1);ze.length=_e.length}ae[0]&1032&&qi(R,ee[3])},d(ee){ee&&V(e),mi(N,ee),mi(se,ee),mi(Y,ee),mi(ze,ee),z=!1,mr(I)}}}function Oy(r){let e,t,n,i,o=r[17][`${r[18]}_fastest_bicycle`].toLocaleString()+"",u,a,d,p=r[17][`${r[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"",g,y,w,T=r[17][`${r[18]}_fastest_bicycle_ebike`].toLocaleString()+"",L,D;return{c(){e=U("tr"),t=U("th"),t.textContent=`${r[19]}`,n=oe(),i=U("td"),u=xe(o),a=oe(),d=U("td"),g=xe(p),y=oe(),w=U("td"),L=xe(T),D=oe()},m(R,z){q(R,e,z),$(e,t),$(e,n),$(e,i),$(i,u),$(e,a),$(e,d),$(d,g),$(e,y),$(e,w),$(w,L),$(e,D)},p(R,z){z[0]&131072&&o!==(o=R[17][`${R[18]}_fastest_bicycle`].toLocaleString()+"")&&St(u,o),z[0]&131072&&p!==(p=R[17][`${R[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&St(g,p),z[0]&131072&&T!==(T=R[17][`${R[18]}_fastest_bicycle_ebike`].toLocaleString()+"")&&St(L,T)},d(R){R&&V(e)}}}function Ny(r){let e,t,n,i,o=r[17][`${r[18]}_quietest_bicycle`].toLocaleString()+"",u,a,d,p=r[17][`${r[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"",g,y,w,T=r[17][`${r[18]}_quietest_bicycle_ebike`].toLocaleString()+"",L,D;return{c(){e=U("tr"),t=U("th"),t.textContent=`${r[19]}`,n=oe(),i=U("td"),u=xe(o),a=oe(),d=U("td"),g=xe(p),y=oe(),w=U("td"),L=xe(T),D=oe()},m(R,z){q(R,e,z),$(e,t),$(e,n),$(e,i),$(i,u),$(e,a),$(e,d),$(d,g),$(e,y),$(e,w),$(w,L),$(e,D)},p(R,z){z[0]&131072&&o!==(o=R[17][`${R[18]}_quietest_bicycle`].toLocaleString()+"")&&St(u,o),z[0]&131072&&p!==(p=R[17][`${R[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&St(g,p),z[0]&131072&&T!==(T=R[17][`${R[18]}_quietest_bicycle_ebike`].toLocaleString()+"")&&St(L,T)},d(R){R&&V(e)}}}function rM(r){let e,t,n,i=r[17][r[4]].toLocaleString()+"",o,u,a,d,p=r[17].gradient+"",g,y,w,T,L,D=r[17].quietness+"",R,z,I,F,N,W,se,J,Y,_e,ze,ee,ae,Ee,we,it,Ge,Ie=$n(r[7]),De=[];for(let lt=0;lt<Ie.length;lt+=1)De[lt]=Oy(Iy(r,Ie,lt));let Ct=$n(r[7]),nt=[];for(let lt=0;lt<Ct.length;lt+=1)nt[lt]=Ny(Ey(r,Ct,lt));return{c(){e=U("div"),t=U("p"),n=xe("Cyclists: "),o=xe(i),u=oe(),a=U("p"),d=xe("Gradient: "),g=xe(p),y=xe("%"),w=oe(),T=U("p"),L=xe("Cycle-friendliness: "),R=xe(D),z=xe("%"),I=oe(),F=U("details"),N=U("summary"),N.textContent="All network details",W=oe(),se=U("p"),se.textContent="Fast/Direct network",J=oe(),Y=U("table"),_e=U("tr"),_e.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",ze=oe();for(let lt=0;lt<De.length;lt+=1)De[lt].c();ee=oe(),ae=U("p"),ae.textContent="Quiet/Indirect network",Ee=oe(),we=U("table"),it=U("tr"),it.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Ge=oe();for(let lt=0;lt<nt.length;lt+=1)nt[lt].c();ut(e,"max-width","30vw"),ut(e,"max-height","60vh"),ut(e,"overflow","auto")},m(lt,mt){q(lt,e,mt),$(e,t),$(t,n),$(t,o),$(e,u),$(e,a),$(a,d),$(a,g),$(a,y),$(e,w),$(e,T),$(T,L),$(T,R),$(T,z),$(e,I),$(e,F),$(F,N),$(F,W),$(F,se),$(F,J),$(F,Y),$(Y,_e),$(Y,ze);for(let ht=0;ht<De.length;ht+=1)De[ht]&&De[ht].m(Y,null);$(F,ee),$(F,ae),$(F,Ee),$(F,we),$(we,it),$(we,Ge);for(let ht=0;ht<nt.length;ht+=1)nt[ht]&&nt[ht].m(we,null)},p(lt,mt){if(mt[0]&131088&&i!==(i=lt[17][lt[4]].toLocaleString()+"")&&St(o,i),mt[0]&131072&&p!==(p=lt[17].gradient+"")&&St(g,p),mt[0]&131072&&D!==(D=lt[17].quietness+"")&&St(R,D),mt[0]&131200){Ie=$n(lt[7]);let ht;for(ht=0;ht<Ie.length;ht+=1){const We=Iy(lt,Ie,ht);De[ht]?De[ht].p(We,mt):(De[ht]=Oy(We),De[ht].c(),De[ht].m(Y,null))}for(;ht<De.length;ht+=1)De[ht].d(1);De.length=Ie.length}if(mt[0]&131200){Ct=$n(lt[7]);let ht;for(ht=0;ht<Ct.length;ht+=1){const We=Ey(lt,Ct,ht);nt[ht]?nt[ht].p(We,mt):(nt[ht]=Ny(We),nt[ht].c(),nt[ht].m(we,null))}for(;ht<nt.length;ht+=1)nt[ht].d(1);nt.length=Ct.length}},d(lt){lt&&V(e),mi(De,lt),mi(nt,lt)}}}function iM(r){let e,t;return e=new fi({props:{openOn:"click",$$slots:{default:[rM,({props:n})=>({17:n}),({props:n})=>[n?131072:0]]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i[0]&131088|i[1]&2&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function oM(r){let e,t;const n=[dn("context-route-network"),{sourceLayer:"rnet"},{paint:{"line-color":r[6],"line-width":jy(["get",r[4]])}},{layout:{visibility:r[5]?"visible":"none"}},{hoverCursor:"pointer"}];let i={$$slots:{default:[iM]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new tr({props:i}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,u){const a=u[0]&112?Zn(n,[n[0],n[1],u[0]&80&&{paint:{"line-color":o[6],"line-width":jy(["get",o[4]])}},u[0]&32&&{layout:{visibility:o[5]?"visible":"none"}},n[4]]):{};u[0]&16|u[1]&2&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function sM(r){let e,t,n,i,o;function u(d){r[15](d)}let a={label:"Route network",$$slots:{legend:[nM],help:[tM]},$$scope:{ctx:r}};return r[5]!==void 0&&(a.show=r[5]),e=new Yo({props:a}),un.push(()=>Cn(e,"show",u)),i=new Mh({props:{url:`pmtiles://${Ao("cnt_layers/route_network.pmtiles")}`,$$slots:{default:[oM]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment),n=oe(),de(i.$$.fragment)},m(d,p){he(e,d,p),q(d,n,p),he(i,d,p),o=!0},p(d,p){const g={};p[0]&15|p[1]&2&&(g.$$scope={dirty:p,ctx:d}),!t&&p[0]&32&&(t=!0,g.show=d[5],Sn(()=>t=!1)),e.$set(g);const y={};p[0]&112|p[1]&2&&(y.$$scope={dirty:p,ctx:d}),i.$set(y)},i(d){o||(j(e.$$.fragment,d),j(i.$$.fragment,d),o=!0)},o(d){G(e.$$.fragment,d),G(i.$$.fragment,d),o=!1},d(d){d&&V(n),fe(e,d),fe(i,d)}}}function jy(r){return["let","base",["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",r,.0021]]]]]],["interpolate",["linear"],["zoom"],12,["*",2.1,["var","base"]],14,["*",5.25,["var","base"]],15,["*",7.5,["var","base"]],16,["*",18,["var","base"]],18,["*",52.5,["var","base"]]]]}function aM(r){return["step",r,"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function lM(r,e,t){let n,i,o=!1,u="all",a="bicycle_go_dutch",d="fastest",p="flow",g=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],y=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],w=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],T=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]],L={colorScale:["#59ee19","#37a009","#FFC300","#C70039","#581845","#000000"],limits:[3,5,7,10,100]};function D(){u=va(this),t(0,u),t(7,g)}function R(){a=va(this),t(1,a),t(8,y)}function z(){d=va(this),t(2,d),t(9,w)}function I(){p=va(this),t(3,p),t(10,T)}function F(N){o=N,t(5,o)}return r.$$.update=()=>{r.$$.dirty[0]&7&&t(4,n=`${u}_${d}_${a}`),r.$$.dirty[0]&24&&t(6,i={none:"#304ce7",flow:aM(["get",n]),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:so(["abs",["get","gradient"]],L.limits,L.colorScale)}[p])},[u,a,d,p,n,o,i,g,y,w,T,D,R,z,I,F]}class cM extends It{constructor(e){super(),Et(this,e,lM,sM,xt,{},null,[-1,-1])}}function uM(r){let e;return{c(){e=U("div"),e.innerHTML=`<p>This layer shows collisions recorded in the <a href="https://www.data.gov.uk/dataset/cb7ae6f0-4be6-4935-9277-47e5ce24a11f/road-safety-data" target="_blank">DfT stats19</a>
      dataset, as of 30 September 2024. Please note these limitations:</p> <ul><li>Only collisions between 2017 and 2023 are included</li> <li>This tool is intended to be used when zoomed into the map, while
        inspecting a scheme or development area. Not all points are shown when
        zoomed out and showing large areas. Do not use this to look for trends
        across a city or region scale.</li> <li>Approximately 150 collisions from the source data aren&#39;t included, due
        to problems with the recorded location</li> <li>The &quot;pedestrians&quot; category also include mobility scooters</li> <li>All limitations <a href="https://www.gov.uk/guidance/road-accident-and-safety-statistics-guidance" target="_blank">documented by DfT</a>
        also apply. Not all collisions or near misses are reported. There&#39;s nuance
        with the severity categories.</li></ul> <p>You can click a point to open the full report, thanks to CycleStreets.</p> <p>License: <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">Open Government License</a>
      . Contains OS data  Crown copyright and database right 2025.</p>`,ue(e,"slot","help")},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function hM(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L,D,R,z,I,F,N,W,se,J;return N=new Km({props:{labelColors:r[6],swatchClass:"circle",itemsPerRow:3}}),{c(){e=U("div"),t=U("fieldset"),n=U("label"),i=U("input"),o=xe(`
        Pedestrians`),u=oe(),a=U("label"),d=U("input"),p=xe(`
        Cyclists`),g=oe(),y=U("fieldset"),w=U("label"),T=xe(`From
        `),L=U("input"),D=oe(),R=U("label"),z=xe(`To
        `),I=U("input"),F=oe(),de(N.$$.fragment),ue(i,"type","checkbox"),ue(i,"class","svelte-rvrx5w"),ue(d,"type","checkbox"),ue(d,"class","svelte-rvrx5w"),ut(t,"display","flex"),ut(t,"gap","3em"),ue(t,"class","svelte-rvrx5w"),ue(L,"type","number"),ue(L,"min",2017),ue(L,"max",2023),ue(L,"class","svelte-rvrx5w"),ue(I,"type","number"),ue(I,"min",2017),ue(I,"max",2023),ue(I,"class","svelte-rvrx5w"),ue(y,"class","year-filter svelte-rvrx5w"),ue(e,"slot","legend")},m(Y,_e){q(Y,e,_e),$(e,t),$(t,n),$(n,i),i.checked=r[1].pedestrians,$(n,o),$(t,u),$(t,a),$(a,d),d.checked=r[1].cyclists,$(a,p),$(e,g),$(e,y),$(y,w),$(w,T),$(w,L),qn(L,r[1].minYear),$(y,D),$(y,R),$(R,z),$(R,I),qn(I,r[1].maxYear),$(e,F),he(N,e,null),W=!0,se||(J=[yt(i,"change",r[7]),yt(d,"change",r[8]),yt(L,"input",r[9]),yt(I,"input",r[10])],se=!0)},p(Y,_e){_e&2&&(i.checked=Y[1].pedestrians),_e&2&&(d.checked=Y[1].cyclists),_e&2&&hl(L.value)!==Y[1].minYear&&qn(L,Y[1].minYear),_e&2&&hl(I.value)!==Y[1].maxYear&&qn(I,Y[1].maxYear)},i(Y){W||(j(N.$$.fragment,Y),W=!0)},o(Y){G(N.$$.fragment,Y),W=!1},d(Y){Y&&V(e),fe(N),se=!1,mr(J)}}}function Uy(r){let e,t,n,i=r[3][r[12].pedestrian_location]+"",o;return{c(){e=U("p"),t=xe("Pedestrian location: "),n=U("b"),o=xe(i)},m(u,a){q(u,e,a),$(e,t),$(e,n),$(n,o)},p(u,a){a&4096&&i!==(i=u[3][u[12].pedestrian_location]+"")&&St(o,i)},d(u){u&&V(e)}}}function Vy(r){let e,t,n,i=r[4][r[12].pedestrian_movement]+"",o;return{c(){e=U("p"),t=xe("Pedestrian movement: "),n=U("b"),o=xe(i)},m(u,a){q(u,e,a),$(e,t),$(e,n),$(n,o)},p(u,a){a&4096&&i!==(i=u[4][u[12].pedestrian_movement]+"")&&St(o,i)},d(u){u&&V(e)}}}function fM(r){let e,t,n,i=r[12].year+"",o,u,a,d,p,g=r[5][r[12].severity]+"",y,w,T,L,D,R=qy(r[12])+"",z,I,F,N,W,se=r[12].pedestrian_location&&Uy(r),J=r[12].pedestrian_movement&&Vy(r);return{c(){e=U("p"),t=xe("Year: "),n=U("b"),o=xe(i),u=oe(),a=U("p"),d=xe("Severity: "),p=U("b"),y=xe(g),w=oe(),T=U("p"),L=xe("Casualties: "),D=U("b"),z=xe(R),I=oe(),se&&se.c(),F=oe(),J&&J.c(),N=oe(),W=U("p"),W.textContent="Click to open full report in CycleStreets"},m(Y,_e){q(Y,e,_e),$(e,t),$(e,n),$(n,o),q(Y,u,_e),q(Y,a,_e),$(a,d),$(a,p),$(p,y),q(Y,w,_e),q(Y,T,_e),$(T,L),$(T,D),$(D,z),q(Y,I,_e),se&&se.m(Y,_e),q(Y,F,_e),J&&J.m(Y,_e),q(Y,N,_e),q(Y,W,_e)},p(Y,_e){_e&4096&&i!==(i=Y[12].year+"")&&St(o,i),_e&4096&&g!==(g=Y[5][Y[12].severity]+"")&&St(y,g),_e&4096&&R!==(R=qy(Y[12])+"")&&St(z,R),Y[12].pedestrian_location?se?se.p(Y,_e):(se=Uy(Y),se.c(),se.m(F.parentNode,F)):se&&(se.d(1),se=null),Y[12].pedestrian_movement?J?J.p(Y,_e):(J=Vy(Y),J.c(),J.m(N.parentNode,N)):J&&(J.d(1),J=null)},d(Y){Y&&(V(e),V(u),V(a),V(w),V(T),V(I),V(F),V(N),V(W)),se&&se.d(Y),J&&J.d(Y)}}}function dM(r){let e,t;return e=new fi({props:{$$slots:{default:[fM,({props:n})=>({12:n}),({props:n})=>n?4096:0]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&12288&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function pM(r){let e,t;const n=[dn("context-stats19"),{sourceLayer:"stats19"},{paint:{"circle-color":so(["get","severity"],[1,2,3],[wm,xm,km]),"circle-opacity":.9,"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,15],"circle-stroke-color":"black","circle-stroke-width":.1}},{filter:r[2](r[1])},{layout:{visibility:r[0]?"visible":"none"}},{hoverCursor:"pointer"}];let i={$$slots:{default:[dM]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new _l({props:i}),e.$on("click",_M),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,u){const a=u&7?Zn(n,[n[0],n[1],u&0&&{paint:{"circle-color":so(["get","severity"],[1,2,3],[wm,xm,km]),"circle-opacity":.9,"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,15],"circle-stroke-color":"black","circle-stroke-width":.1}},u&6&&{filter:o[2](o[1])},u&1&&{layout:{visibility:o[0]?"visible":"none"}},n[5]]):{};u&8192&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function mM(r){let e,t,n,i,o;function u(d){r[11](d)}let a={label:"Collisions",$$slots:{legend:[hM],help:[uM]},$$scope:{ctx:r}};return r[0]!==void 0&&(a.show=r[0]),e=new Yo({props:a}),un.push(()=>Cn(e,"show",u)),i=new Mh({props:{url:`pmtiles://${Ao("cnt_layers/stats19.pmtiles")}`,$$slots:{default:[pM]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment),n=oe(),de(i.$$.fragment)},m(d,p){he(e,d,p),q(d,n,p),he(i,d,p),o=!0},p(d,[p]){const g={};p&8194&&(g.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,g.show=d[0],Sn(()=>t=!1)),e.$set(g);const y={};p&8195&&(y.$$scope={dirty:p,ctx:d}),i.$set(y)},i(d){o||(j(e.$$.fragment,d),j(i.$$.fragment,d),o=!0)},o(d){G(e.$$.fragment,d),G(i.$$.fragment,d),o=!1},d(d){d&&V(n),fe(e,d),fe(i,d)}}}let wm="#080C54",xm="#1F9EB7",km="#CDE594";function qy(r){let e=[];return r.pedestrian&&e.push("pedestrian"),r.cyclist&&e.push("cyclist"),e.join(", ")}function _M(r){window.open(`https://www.cyclestreets.net/collisions/reports/${r.detail.features[0].properties.accident_index}`,"_blank")}function gM(r,e,t){let n=!1,i={pedestrians:!0,cyclists:!0,minYear:2017,maxYear:2023};function o(D){let R=["any"];return i.pedestrians&&R.push(["get","pedestrian"]),i.cyclists&&R.push(["get","cyclist"]),["all",[">=",["get","year"],i.minYear],["<=",["get","year"],i.maxYear],R]}let u={1:"Crossing on pedestrian crossing facility",2:"Crossing in zig-zag approach lines",3:"Crossing in zig-zag exit lines",4:"Crossing elsewhere within 50m. of pedestrian crossing",5:"In carriageway, crossing elsewhere",6:"On footway or verge",7:"On refuge, central island or central reservation",8:"In centre of carriageway - not on refuge, island or central reservation",9:"In carriageway, not crossing"},a={1:"Crossing from driver's nearside",2:"Crossing from nearside - masked by parked or stationary vehicle",3:"Crossing from driver's offside",4:"Crossing from offside - masked by parked or stationary vehicle",5:"In carriageway, stationary - not crossing (standing or playing)",6:"In carriageway, stationary - not crossing (standing or playing - masked by parked or stationary vehicle)",7:"Walking along in carriageway, facing traffic",8:"Walking along in carriageway, back to traffic"},d={1:"Fatal",2:"Serious",3:"Slight"},p={Slight:km,Serious:xm,Fatal:wm};function g(){i.pedestrians=this.checked,t(1,i)}function y(){i.cyclists=this.checked,t(1,i)}function w(){i.minYear=hl(this.value),t(1,i)}function T(){i.maxYear=hl(this.value),t(1,i)}function L(D){n=D,t(0,n)}return[n,i,o,u,a,d,p,g,y,w,T,L]}class yM extends It{constructor(e){super(),Et(this,e,gM,mM,xt,{})}}function Zy(r){let e;return{c(){e=xe("Layers")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function Gy(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L;return e=new ET({}),n=new GT({}),o=new eM({}),a=new bS({}),p=new wT({}),y=new cM({}),T=new yM({}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment),i=oe(),de(o.$$.fragment),u=oe(),de(a.$$.fragment),d=oe(),de(p.$$.fragment),g=oe(),de(y.$$.fragment),w=oe(),de(T.$$.fragment)},m(D,R){he(e,D,R),q(D,t,R),he(n,D,R),q(D,i,R),he(o,D,R),q(D,u,R),he(a,D,R),q(D,d,R),he(p,D,R),q(D,g,R),he(y,D,R),q(D,w,R),he(T,D,R),L=!0},i(D){L||(j(e.$$.fragment,D),j(n.$$.fragment,D),j(o.$$.fragment,D),j(a.$$.fragment,D),j(p.$$.fragment,D),j(y.$$.fragment,D),j(T.$$.fragment,D),L=!0)},o(D){G(e.$$.fragment,D),G(n.$$.fragment,D),G(o.$$.fragment,D),G(a.$$.fragment,D),G(p.$$.fragment,D),G(y.$$.fragment,D),G(T.$$.fragment,D),L=!1},d(D){D&&(V(t),V(i),V(u),V(d),V(g),V(w)),fe(e,D),fe(n,D),fe(o,D),fe(a,D),fe(p,D),fe(y,D),fe(T,D)}}}function bM(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L;i=new zk({props:{color:"#333"}});let D=r[0]&&Zy();function R(F){r[4](F)}let z={label:"Existing modal filters and turn restrictions"};r[1]!==void 0&&(z.show=r[1]),p=new Yo({props:z}),un.push(()=>Cn(p,"show",R));let I=r[2]=="cnt"&&Gy();return{c(){e=U("div"),t=U("button"),n=U("div"),de(i.$$.fragment),o=oe(),D&&D.c(),a=oe(),d=U("div"),de(p.$$.fragment),y=oe(),I&&I.c(),ut(n,"display","flex"),ut(n,"gap","12px"),ut(n,"color","#333"),ut(n,"align-items","center"),ut(n,"justify-content","center"),ue(t,"class",u="show-layers-button icon-btn "+(r[0]?"expanded":"")+" svelte-8cnrrn"),ue(t,"aria-label","Layers"),ut(d,"flex-direction","column"),ut(d,"display",r[0]?"flex":"none"),ut(d,"background-color","#515f7A"),ue(e,"class","pico contextual-layers svelte-8cnrrn"),ut(e,"display","flex"),ut(e,"flex-direction","column"),ut(e,"max-height","80vh"),ut(e,"overflow","auto"),ut(e,"border-radius","5px"),ut(e,"width",r[0]?"300px":"auto")},m(F,N){q(F,e,N),$(e,t),$(t,n),he(i,n,null),$(n,o),D&&D.m(n,null),$(e,a),$(e,d),he(p,d,null),$(d,y),I&&I.m(d,null),w=!0,T||(L=yt(t,"click",r[3]),T=!0)},p(F,N){F[0]?D||(D=Zy(),D.c(),D.m(n,null)):D&&(D.d(1),D=null),(!w||N&1&&u!==(u="show-layers-button icon-btn "+(F[0]?"expanded":"")+" svelte-8cnrrn"))&&ue(t,"class",u);const W={};!g&&N&2&&(g=!0,W.show=F[1],Sn(()=>g=!1)),p.$set(W),F[2]=="cnt"?I?N&4&&j(I,1):(I=Gy(),I.c(),j(I,1),I.m(d,null)):I&&(tn(),G(I,1,1,()=>{I=null}),nn()),N&1&&ut(d,"display",F[0]?"flex":"none"),N&1&&ut(e,"width",F[0]?"300px":"auto")},i(F){w||(j(i.$$.fragment,F),j(p.$$.fragment,F),j(I),w=!0)},o(F){G(i.$$.fragment,F),G(p.$$.fragment,F),G(I),w=!1},d(F){F&&V(e),fe(i),D&&D.d(),fe(p),I&&I.d(),T=!1,L()}}}function vM(r){let e,t;return e=new i3({props:{defaultStyling:!0,$$slots:{default:[bM]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,[i]){const o={};i&39&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function wM(r,e,t){let n,i;st(r,ld,d=>t(1,n=d)),st(r,Ro,d=>t(2,i=d));let o=!1;const u=()=>t(0,o=!o);function a(d){n=d,ld.set(n)}return[o,n,i,u,a]}class xM extends It{constructor(e){super(),Et(this,e,wM,vM,xt,{})}}let Ke;const Pv=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Pv.decode();let Xu=null;function Ic(){return(Xu===null||Xu.byteLength===0)&&(Xu=new Uint8Array(Ke.memory.buffer)),Xu}function Fr(r,e){return r=r>>>0,Pv.decode(Ic().subarray(r,r+e))}const qs=new Array(128).fill(void 0);qs.push(void 0,null,!0,!1);let ch=qs.length;function ar(r){ch===qs.length&&qs.push(qs.length+1);const e=ch;return ch=qs[e],qs[e]=r,e}function kn(r){return qs[r]}function kM(r){r<132||(qs[r]=ch,ch=r)}function er(r){const e=kn(r);return kM(r),e}let bi=0;const td=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},SM=typeof td.encodeInto=="function"?function(r,e){return td.encodeInto(r,e)}:function(r,e){const t=td.encode(r);return e.set(t),{read:r.length,written:t.length}};function Lo(r,e,t){if(t===void 0){const a=td.encode(r),d=e(a.length,1)>>>0;return Ic().subarray(d,d+a.length).set(a),bi=a.length,d}let n=r.length,i=e(n,1)>>>0;const o=Ic();let u=0;for(;u<n;u++){const a=r.charCodeAt(u);if(a>127)break;o[i+u]=a}if(u!==n){u!==0&&(r=r.slice(u)),i=t(i,n,n=u+r.length*3,1)>>>0;const a=Ic().subarray(i+u,i+n),d=SM(r,a);u+=d.written}return bi=u,i}function Cc(r){return r==null}let Ju=null;function pt(){return(Ju===null||Ju.byteLength===0)&&(Ju=new Int32Array(Ke.memory.buffer)),Ju}let Yu=null;function zv(){return(Yu===null||Yu.byteLength===0)&&(Yu=new Float64Array(Ke.memory.buffer)),Yu}let Qu=null;function CM(){return(Qu===null||Qu.byteLength===0)&&(Qu=new BigInt64Array(Ke.memory.buffer)),Qu}function Sm(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Sm(r[0]));for(let u=1;u<i;u++)o+=", "+Sm(r[u]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Kp(r,e){const t=e(r.length*1,1)>>>0;return Ic().set(r,t/1),bi=r.length,t}function TM(r,e){return r=r>>>0,zv().subarray(r/8,r/8+e)}function MM(r,e){return r=r>>>0,Ic().subarray(r/1,r/1+e)}function ll(r,e){try{return r.apply(this,e)}catch(t){Ke.__wbindgen_exn_store(ar(t))}}class LM{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ke.__wbg_ltn_free(e)}constructor(e,t,n,i,o,u,a,d){try{const L=Ke.__wbindgen_add_to_stack_pointer(-16),D=Kp(e,Ke.__wbindgen_malloc),R=bi,z=Kp(t,Ke.__wbindgen_malloc),I=bi,F=Kp(n,Ke.__wbindgen_malloc),N=bi,W=Lo(o,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),se=bi;var p=Cc(u)?0:Lo(u,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),g=bi;const J=Lo(a,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),Y=bi;Ke.ltn_new(L,D,R,z,I,F,N,ar(i),W,se,p,g,J,Y,d);var y=pt()[L/4+0],w=pt()[L/4+1],T=pt()[L/4+2];if(T)throw er(w);return this.__wbg_ptr=y>>>0,this}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let e,t;try{const p=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_getInvertedBoundary(p,this.__wbg_ptr);var n=pt()[p/4+0],i=pt()[p/4+1],o=pt()[p/4+2],u=pt()[p/4+3],a=n,d=i;if(u)throw a=0,d=0,er(o);return e=a,t=d,Fr(a,d)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(e,t,1)}}getBounds(){try{const i=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_getBounds(i,this.__wbg_ptr);var e=pt()[i/4+0],t=pt()[i/4+1],n=TM(e,t).slice();return Ke.__wbindgen_free(e,t*8,8),n}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const i=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_toRouteSnapper(i,this.__wbg_ptr);var e=pt()[i/4+0],t=pt()[i/4+1],n=MM(e,t).slice();return Ke.__wbindgen_free(e,t*1,1),n}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let e,t;try{const p=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_toRouteSnapperGj(p,this.__wbg_ptr);var n=pt()[p/4+0],i=pt()[p/4+1],o=pt()[p/4+2],u=pt()[p/4+3],a=n,d=i;if(u)throw a=0,d=0,er(o);return e=a,t=d,Fr(a,d)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(e,t,1)}}renderModalFilters(){let e,t;try{const p=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_renderModalFilters(p,this.__wbg_ptr);var n=pt()[p/4+0],i=pt()[p/4+1],o=pt()[p/4+2],u=pt()[p/4+3],a=n,d=i;if(u)throw a=0,d=0,er(o);return e=a,t=d,Fr(a,d)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(e,t,1)}}renderTurnRestrictions(){let e,t;try{const p=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_renderTurnRestrictions(p,this.__wbg_ptr);var n=pt()[p/4+0],i=pt()[p/4+1],o=pt()[p/4+2],u=pt()[p/4+3],a=n,d=i;if(u)throw a=0,d=0,er(o);return e=a,t=d,Fr(a,d)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(e,t,1)}}renderNeighbourhood(){let e,t;try{const p=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_renderNeighbourhood(p,this.__wbg_ptr);var n=pt()[p/4+0],i=pt()[p/4+1],o=pt()[p/4+2],u=pt()[p/4+3],a=n,d=i;if(u)throw a=0,d=0,er(o);return e=a,t=d,Fr(a,d)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(e,t,1)}}generatedBoundaries(){let e,t;try{const p=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_generatedBoundaries(p,this.__wbg_ptr);var n=pt()[p/4+0],i=pt()[p/4+1],o=pt()[p/4+2],u=pt()[p/4+3],a=n,d=i;if(u)throw a=0,d=0,er(o);return e=a,t=d,Fr(a,d)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(e,t,1)}}generateMergedBoundary(e){let t,n;try{const g=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_generateMergedBoundary(g,this.__wbg_ptr,ar(e));var i=pt()[g/4+0],o=pt()[g/4+1],u=pt()[g/4+2],a=pt()[g/4+3],d=i,p=o;if(a)throw d=0,p=0,er(u);return t=d,n=p,Fr(d,p)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(t,n,1)}}setNeighbourhoodBoundary(e,t){try{const o=Ke.__wbindgen_add_to_stack_pointer(-16),u=Lo(e,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),a=bi;Ke.ltn_setNeighbourhoodBoundary(o,this.__wbg_ptr,u,a,ar(t));var n=pt()[o/4+0],i=pt()[o/4+1];if(i)throw er(n)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(e){const t=Lo(e,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),n=bi;Ke.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,t,n)}renameNeighbourhoodBoundary(e,t){const n=Lo(e,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),i=bi,o=Lo(t,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),u=bi;Ke.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,n,i,o,u)}setCurrentNeighbourhood(e){try{const i=Ke.__wbindgen_add_to_stack_pointer(-16),o=Lo(e,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),u=bi;Ke.ltn_setCurrentNeighbourhood(i,this.__wbg_ptr,o,u);var t=pt()[i/4+0],n=pt()[i/4+1];if(n)throw er(t)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(e,t){try{const o=Ke.__wbindgen_add_to_stack_pointer(-16),u=Lo(t,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),a=bi;Ke.ltn_addModalFilter(o,this.__wbg_ptr,ar(e),u,a);var n=pt()[o/4+0],i=pt()[o/4+1];if(i)throw er(n)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(e,t){try{const o=Ke.__wbindgen_add_to_stack_pointer(-16),u=Lo(t,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),a=bi;Ke.ltn_addManyModalFilters(o,this.__wbg_ptr,ar(e),u,a);var n=pt()[o/4+0],i=pt()[o/4+1];if(i)throw er(n)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(e){Ke.ltn_deleteModalFilter(this.__wbg_ptr,e)}addDiagonalFilter(e){try{const i=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_addDiagonalFilter(i,this.__wbg_ptr,e);var t=pt()[i/4+0],n=pt()[i/4+1];if(n)throw er(t)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}rotateDiagonalFilter(e){try{const i=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_rotateDiagonalFilter(i,this.__wbg_ptr,e);var t=pt()[i/4+0],n=pt()[i/4+1];if(n)throw er(t)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}deleteDiagonalFilter(e){try{const i=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_deleteDiagonalFilter(i,this.__wbg_ptr,e);var t=pt()[i/4+0],n=pt()[i/4+1];if(n)throw er(t)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}addTurnRestriction(e,t){try{const o=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_addTurnRestriction(o,this.__wbg_ptr,e,t);var n=pt()[o/4+0],i=pt()[o/4+1];if(i)throw er(n)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}deleteTurnRestriction(e,t,n){try{const u=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_deleteTurnRestriction(u,this.__wbg_ptr,e,t,n);var i=pt()[u/4+0],o=pt()[u/4+1];if(o)throw er(i)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}getTurnRestrictionTargets(e){let t,n;try{const g=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_getTurnRestrictionTargets(g,this.__wbg_ptr,e);var i=pt()[g/4+0],o=pt()[g/4+1],u=pt()[g/4+2],a=pt()[g/4+3],d=i,p=o;if(a)throw d=0,p=0,er(u);return t=d,n=p,Fr(d,p)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(t,n,1)}}toggleTravelFlow(e){Ke.ltn_toggleTravelFlow(this.__wbg_ptr,e)}toggleMainRoad(e){try{const i=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_toggleMainRoad(i,this.__wbg_ptr,e);var t=pt()[i/4+0],n=pt()[i/4+1];if(n)throw er(t)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}undo(){Ke.ltn_undo(this.__wbg_ptr)}redo(){Ke.ltn_redo(this.__wbg_ptr)}getShortcutsCrossingRoad(e){let t,n;try{const g=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_getShortcutsCrossingRoad(g,this.__wbg_ptr,e);var i=pt()[g/4+0],o=pt()[g/4+1],u=pt()[g/4+2],a=pt()[g/4+3],d=i,p=o;if(a)throw d=0,p=0,er(u);return t=d,n=p,Fr(d,p)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(t,n,1)}}getAllShortcuts(){let e,t;try{const p=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_getAllShortcuts(p,this.__wbg_ptr);var n=pt()[p/4+0],i=pt()[p/4+1],o=pt()[p/4+2],u=pt()[p/4+3],a=n,d=i;if(u)throw a=0,d=0,er(o);return e=a,t=d,Fr(a,d)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const p=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_toSavefile(p,this.__wbg_ptr);var n=pt()[p/4+0],i=pt()[p/4+1],o=pt()[p/4+2],u=pt()[p/4+3],a=n,d=i;if(u)throw a=0,d=0,er(o);return e=a,t=d,Fr(a,d)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(e,t,1)}}loadSavefile(e){try{const i=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_loadSavefile(i,this.__wbg_ptr,ar(e));var t=pt()[i/4+0],n=pt()[i/4+1];if(n)throw er(t)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}compareRoute(e,t,n,i,o){let u,a;try{const L=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_compareRoute(L,this.__wbg_ptr,e,t,n,i,o);var d=pt()[L/4+0],p=pt()[L/4+1],g=pt()[L/4+2],y=pt()[L/4+3],w=d,T=p;if(y)throw w=0,T=0,er(g);return u=w,a=T,Fr(w,T)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(u,a,1)}}impactToOneDestination(e,t){let n,i;try{const y=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_impactToOneDestination(y,this.__wbg_ptr,e,t);var o=pt()[y/4+0],u=pt()[y/4+1],a=pt()[y/4+2],d=pt()[y/4+3],p=o,g=u;if(d)throw p=0,g=0,er(a);return n=p,i=g,Fr(p,g)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(n,i,1)}}predictImpact(e){let t,n;try{const g=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_predictImpact(g,this.__wbg_ptr,e);var i=pt()[g/4+0],o=pt()[g/4+1],u=pt()[g/4+2],a=pt()[g/4+3],d=i,p=o;if(a)throw d=0,p=0,er(u);return t=d,n=p,Fr(d,p)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(t,n,1)}}getImpactsOnRoad(e,t){let n,i;try{const y=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_getImpactsOnRoad(y,this.__wbg_ptr,e,t);var o=pt()[y/4+0],u=pt()[y/4+1],a=pt()[y/4+2],d=pt()[y/4+3],p=o,g=u;if(d)throw p=0,g=0,er(a);return n=p,i=g,Fr(p,g)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(n,i,1)}}getAllNeighbourhoods(){let e,t;try{const p=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_getAllNeighbourhoods(p,this.__wbg_ptr);var n=pt()[p/4+0],i=pt()[p/4+1],o=pt()[p/4+2],u=pt()[p/4+3],a=n,d=i;if(u)throw a=0,d=0,er(o);return e=a,t=d,Fr(a,d)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(e,t,1)}}getAllIntersections(){let e,t;try{const p=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_getAllIntersections(p,this.__wbg_ptr);var n=pt()[p/4+0],i=pt()[p/4+1],o=pt()[p/4+2],u=pt()[p/4+3],a=n,d=i;if(u)throw a=0,d=0,er(o);return e=a,t=d,Fr(a,d)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(e,t,1)}}getMovements(e){let t,n;try{const g=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_getMovements(g,this.__wbg_ptr,e);var i=pt()[g/4+0],o=pt()[g/4+1],u=pt()[g/4+2],a=pt()[g/4+3],d=i,p=o;if(a)throw d=0,p=0,er(u);return t=d,n=p,Fr(d,p)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(t,n,1)}}getDemandModel(){let e,t;try{const p=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_getDemandModel(p,this.__wbg_ptr);var n=pt()[p/4+0],i=pt()[p/4+1],o=pt()[p/4+2],u=pt()[p/4+3],a=n,d=i;if(u)throw a=0,d=0,er(o);return e=a,t=d,Fr(a,d)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(e,t,1)}}getPOIs(){let e,t;try{const p=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_getPOIs(p,this.__wbg_ptr);var n=pt()[p/4+0],i=pt()[p/4+1],o=pt()[p/4+2],u=pt()[p/4+3],a=n,d=i;if(u)throw a=0,d=0,er(o);return e=a,t=d,Fr(a,d)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(e,t,1)}}}async function EM(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function IM(){const r={};return r.wbg={},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Fr(e,t));return ar(n)},r.wbg.__wbindgen_object_drop_ref=function(e){er(e)},r.wbg.__wbindgen_string_get=function(e,t){const n=kn(t),i=typeof n=="string"?n:void 0;var o=Cc(i)?0:Lo(i,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),u=bi;pt()[e/4+1]=u,pt()[e/4+0]=o},r.wbg.__wbindgen_boolean_get=function(e){const t=kn(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof kn(e)=="bigint"},r.wbg.__wbindgen_number_get=function(e,t){const n=kn(t),i=typeof n=="number"?n:void 0;zv()[e/8+1]=Cc(i)?0:i,pt()[e/4+0]=!Cc(i)},r.wbg.__wbindgen_is_object=function(e){const t=kn(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return kn(e)in kn(t)},r.wbg.__wbindgen_bigint_from_i64=function(e){return ar(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return kn(e)===kn(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return ar(t)},r.wbg.__wbindgen_is_undefined=function(e){return kn(e)===void 0},r.wbg.__wbindgen_string_new=function(e,t){const n=Fr(e,t);return ar(n)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return kn(e)==kn(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=kn(e);return ar(t)},r.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,t){const n=kn(e)[kn(t)];return ar(n)},r.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(kn(e))},r.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(kn(e))},r.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(kn(e))},r.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(kn(e))},r.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(kn(e))},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ar(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=kn(t).stack,i=Lo(n,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),o=bi;pt()[e/4+1]=o,pt()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(Fr(e,t))}finally{Ke.__wbindgen_free(n,i,1)}},r.wbg.__wbg_performance_3f3012faa4463882=function(e){const t=kn(e).performance;return ar(t)},r.wbg.__wbg_now_2fd65358804c9485=function(e){return kn(e).now()},r.wbg.__wbg_get_f01601b5a68d10e3=function(e,t){const n=kn(e)[t>>>0];return ar(n)},r.wbg.__wbg_length_1009b1af0c481d7b=function(e){return kn(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof kn(e)=="function"},r.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,t){const n=new Function(Fr(e,t));return ar(n)},r.wbg.__wbg_next_9b877f231f476d01=function(e){const t=kn(e).next;return ar(t)},r.wbg.__wbg_next_6529ee0cca8d57ed=function(){return ll(function(e){const t=kn(e).next();return ar(t)},arguments)},r.wbg.__wbg_done_5fe336b092d60cf2=function(e){return kn(e).done},r.wbg.__wbg_value_0c248a78fdc8e19f=function(e){const t=kn(e).value;return ar(t)},r.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return ar(Symbol.iterator)},r.wbg.__wbg_get_7b48513de5dc5ea4=function(){return ll(function(e,t){const n=Reflect.get(kn(e),kn(t));return ar(n)},arguments)},r.wbg.__wbg_call_90c26b09837aba1c=function(){return ll(function(e,t){const n=kn(e).call(kn(t));return ar(n)},arguments)},r.wbg.__wbg_self_f0e34d89f33b99fd=function(){return ll(function(){const e=self.self;return ar(e)},arguments)},r.wbg.__wbg_window_d3b084224f4774d7=function(){return ll(function(){const e=window.window;return ar(e)},arguments)},r.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return ll(function(){const e=globalThis.globalThis;return ar(e)},arguments)},r.wbg.__wbg_global_35dfdd59a4da3e74=function(){return ll(function(){const e=global.global;return ar(e)},arguments)},r.wbg.__wbg_isArray_74fb723e24f76012=function(e){return Array.isArray(kn(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let t;try{t=kn(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(e){return Number.isSafeInteger(kn(e))},r.wbg.__wbg_entries_9e2e2aa45aa5094a=function(e){const t=Object.entries(kn(e));return ar(t)},r.wbg.__wbg_buffer_a448f833075b71ba=function(e){const t=kn(e).buffer;return ar(t)},r.wbg.__wbg_new_8f67e318f15d7254=function(e){const t=new Uint8Array(kn(e));return ar(t)},r.wbg.__wbg_set_2357bf09366ee480=function(e,t,n){kn(e).set(kn(t),n>>>0)},r.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return kn(e).length},r.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let t;try{t=kn(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=kn(t),i=typeof n=="bigint"?n:void 0;CM()[e/8+1]=Cc(i)?BigInt(0):i,pt()[e/4+0]=!Cc(i)},r.wbg.__wbindgen_debug_string=function(e,t){const n=Sm(kn(t)),i=Lo(n,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),o=bi;pt()[e/4+1]=o,pt()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Fr(e,t))},r.wbg.__wbindgen_memory=function(){const e=Ke.memory;return ar(e)},r}function AM(r,e){return Ke=r.exports,Dv.__wbindgen_wasm_module=e,Qu=null,Yu=null,Ju=null,Xu=null,Ke}async function Dv(r){if(Ke!==void 0)return Ke;typeof r>"u"&&(r="/ltn/assets/backend_bg.wasm");const e=IM();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await EM(await r,e);return AM(t,n)}const PM=r=>({}),Hy=r=>({}),zM=r=>({}),Wy=r=>({}),DM=r=>({}),Ky=r=>({});function RM(r){let e,t,n,i,o,u,a,d;const p=r[1].top,g=En(p,r,r[0],Ky),y=r[1].left,w=En(y,r,r[0],Wy),T=r[1].main,L=En(T,r,r[0],Hy);return{c(){e=U("div"),t=U("div"),g&&g.c(),n=oe(),i=U("div"),o=U("div"),w&&w.c(),u=oe(),a=U("div"),L&&L.c(),ue(t,"class","top svelte-29q570"),ue(o,"class","left svelte-29q570"),ue(a,"class","main svelte-29q570"),ue(i,"class","content svelte-29q570"),ue(e,"class","flex-container svelte-29q570")},m(D,R){q(D,e,R),$(e,t),g&&g.m(t,null),$(e,n),$(e,i),$(i,o),w&&w.m(o,null),$(i,u),$(i,a),L&&L.m(a,null),d=!0},p(D,[R]){g&&g.p&&(!d||R&1)&&An(g,p,D,D[0],d?In(p,D[0],R,DM):Pn(D[0]),Ky),w&&w.p&&(!d||R&1)&&An(w,y,D,D[0],d?In(y,D[0],R,zM):Pn(D[0]),Wy),L&&L.p&&(!d||R&1)&&An(L,T,D,D[0],d?In(T,D[0],R,PM):Pn(D[0]),Hy)},i(D){d||(j(g,D),j(w,D),j(L,D),d=!0)},o(D){G(g,D),G(w,D),G(L,D),d=!1},d(D){D&&V(e),g&&g.d(D),w&&w.d(D),L&&L.d(D)}}}function $M(r,e,t){let{$$slots:n={},$$scope:i}=e;return r.$$set=o=>{"$$scope"in o&&t(0,i=o.$$scope)},[i,n]}class FM extends It{constructor(e){super(),Et(this,e,$M,RM,xt,{})}}const BM=r=>({}),Xy=r=>({}),OM=r=>({}),Jy=r=>({}),NM=r=>({}),Yy=r=>({});function jM(r){let e,t,n,i,o,u;const a=r[4].top,d=En(a,r,r[3],Yy),p=r[4].sidebar,g=En(p,r,r[3],Jy),y=r[4].map,w=En(y,r,r[3],Xy);return{c(){e=U("div"),d&&d.c(),t=oe(),n=U("div"),g&&g.c(),i=oe(),o=U("div"),w&&w.c()},m(T,L){q(T,e,L),d&&d.m(e,null),r[5](e),q(T,t,L),q(T,n,L),g&&g.m(n,null),r[6](n),q(T,i,L),q(T,o,L),w&&w.m(o,null),r[7](o),u=!0},p(T,[L]){d&&d.p&&(!u||L&8)&&An(d,a,T,T[3],u?In(a,T[3],L,NM):Pn(T[3]),Yy),g&&g.p&&(!u||L&8)&&An(g,p,T,T[3],u?In(p,T[3],L,OM):Pn(T[3]),Jy),w&&w.p&&(!u||L&8)&&An(w,y,T,T[3],u?In(y,T[3],L,BM):Pn(T[3]),Xy)},i(T){u||(j(d,T),j(g,T),j(w,T),u=!0)},o(T){G(d,T),G(g,T),G(w,T),u=!1},d(T){T&&(V(e),V(t),V(n),V(i),V(o)),d&&d.d(T),r[5](null),g&&g.d(T),r[6](null),w&&w.d(T),r[7](null)}}}function UM(r,e,t){let n,i,o;st(r,Cm,y=>t(0,n=y)),st(r,Tm,y=>t(1,i=y)),st(r,Mm,y=>t(2,o=y));let{$$slots:u={},$$scope:a}=e;function d(y){un[y?"unshift":"push"](()=>{n=y,Cm.set(n)})}function p(y){un[y?"unshift":"push"](()=>{i=y,Tm.set(i)})}function g(y){un[y?"unshift":"push"](()=>{o=y,Mm.set(o)})}return r.$$set=y=>{"$$scope"in y&&t(3,a=y.$$scope)},[n,i,o,a,u,d,p,g]}class _o extends It{constructor(e){super(),Et(this,e,UM,jM,xt,{})}}let Cm=Ln(null),Tm=Ln(null),Mm=Ln(null);const VM="/ltn/assets/streets-v2-style-b76f3b8b.json";function qM(r){let e;return{c(){e=xe("Back")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function ZM(r){let e,t,n,i;return e=new Rn({props:{$$slots:{default:[qM]},$$scope:{ctx:r}}}),e.$on("click",r[2]),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0,n||(i=yt(window,"keydown",r[1]),n=!0)},p(o,[u]){const a={};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o),n=!1,i()}}}function GM(r){let e=ds();function t(i){i.key=="Escape"&&(i.stopPropagation(),e("click"))}return[e,t,()=>e("click")]}class Ys extends It{constructor(e){super(),Et(this,e,GM,ZM,xt,{})}}let pd=Ln(null);function Qy(r,e,t){const n=r.slice();return n[37]=e[t],n[38]=e,n[39]=t,n}function e1(r,e,t){const n=r.slice();return n[40]=e[t],n[41]=e,n[42]=t,n}function HM(r){let e,t=r[6].length+"",n,i;return{c(){e=xe("Undo ("),n=xe(t),i=xe(")")},m(o,u){q(o,e,u),q(o,n,u),q(o,i,u)},p(o,u){u[0]&64&&t!==(t=o[6].length+"")&&St(n,t)},d(o){o&&(V(e),V(n),V(i))}}}function WM(r){let e;return{c(){e=xe("Undo")},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function KM(r){let e;return{c(){e=U("span"),ue(e,"class","dot svelte-11yzwwb"),Yt(e,"snapped-node",r[40].snapped),Yt(e,"free-node",!r[40].snapped),Yt(e,"hide",r[4])},m(t,n){q(t,e,n)},p(t,n){n[0]&128&&Yt(e,"snapped-node",t[40].snapped),n[0]&128&&Yt(e,"free-node",!t[40].snapped),n[0]&16&&Yt(e,"hide",t[4])},d(t){t&&V(e)}}}function t1(r){let e,t,n;function i(p){r[23](p,r[40])}function o(){return r[24](r[40])}function u(){return r[25](r[40])}function a(){return r[26](r[40])}let d={draggable:!0,zIndex:0,$$slots:{default:[KM]},$$scope:{ctx:r}};return r[40].point!==void 0&&(d.lngLat=r[40].point),e=new vd({props:d}),un.push(()=>Cn(e,"lngLat",i)),e.$on("dragstart",o),e.$on("drag",u),e.$on("dragend",r[16]),e.$on("click",a),{c(){de(e.$$.fragment)},m(p,g){he(e,p,g),n=!0},p(p,g){r=p;const y={};g[0]&144|g[1]&4096&&(y.$$scope={dirty:g,ctx:r}),!t&&g[0]&128&&(t=!0,y.lngLat=r[40].point,Sn(()=>t=!1)),e.$set(y)},i(p){n||(j(e.$$.fragment,p),n=!0)},o(p){G(e.$$.fragment,p),n=!1},d(p){fe(e,p)}}}function XM(r){let e;return{c(){e=U("ul"),e.innerHTML=`<li><b>Click and drag</b>
          to move</li> <li><b>Click</b>
          to toggle snapping</li> <li><b>Right click</b>
          to delete</li>`,ut(e,"padding-right","0"),ut(e,"padding-left","20px"),ut(e,"margin","0")},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function JM(r){let e,t,n,i;return n=new Hb({props:{openOn:"hover",popupClass:"edit-waypoint-popup",$$slots:{default:[XM]},$$scope:{ctx:r}}}),{c(){e=U("span"),e.textContent=`${r[39]+1}`,t=oe(),de(n.$$.fragment),ue(e,"class","dot svelte-11yzwwb"),Yt(e,"snapped",r[37].snapped)},m(o,u){q(o,e,u),q(o,t,u),he(n,o,u),i=!0},p(o,u){(!i||u[0]&1)&&Yt(e,"snapped",o[37].snapped);const a={};u[1]&4096&&(a.$$scope={dirty:u,ctx:o}),n.$set(a)},i(o){i||(j(n.$$.fragment,o),i=!0)},o(o){G(n.$$.fragment,o),i=!1},d(o){o&&(V(e),V(t)),fe(n,o)}}}function n1(r){let e,t,n;function i(d){r[27](d,r[37])}function o(){return r[28](r[39])}function u(){return r[29](r[39])}let a={draggable:!0,zIndex:1,$$slots:{default:[JM]},$$scope:{ctx:r}};return r[37].point!==void 0&&(a.lngLat=r[37].point),e=new vd({props:a}),un.push(()=>Cn(e,"lngLat",i)),e.$on("click",o),e.$on("contextmenu",u),e.$on("mouseenter",r[30]),e.$on("mouseleave",r[31]),e.$on("dragstart",r[17]),e.$on("dragend",r[32]),{c(){de(e.$$.fragment)},m(d,p){he(e,d,p),n=!0},p(d,p){r=d;const g={};p[0]&1|p[1]&4096&&(g.$$scope={dirty:p,ctx:r}),!t&&p[0]&1&&(t=!0,g.lngLat=r[37].point,Sn(()=>t=!1)),e.$set(g)},i(d){n||(j(e.$$.fragment,d),n=!0)},o(d){G(e.$$.fragment,d),n=!1},d(d){fe(e,d)}}}function YM(r){let e,t,n,i;const o=[dn("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let u={};for(let p=0;p<o.length;p+=1)u=Gt(u,o[p]);e=new tr({props:u});const a=[dn("draw-area-area"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let d={};for(let p=0;p<a.length;p+=1)d=Gt(d,a[p]);return n=new Pi({props:d}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment)},m(p,g){he(e,p,g),q(p,t,g),he(n,p,g),i=!0},p(p,g){const y={};e.$set(y);const w={};n.$set(w)},i(p){i||(j(e.$$.fragment,p),j(n.$$.fragment,p),i=!0)},o(p){G(e.$$.fragment,p),G(n.$$.fragment,p),i=!1},d(p){p&&V(t),fe(e,p),fe(n,p)}}}function QM(r){let e,t;const n=[dn("draw-area-lines-preview"),{paint:{"line-color":"black","line-width":3}}];let i={};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new tr({props:i}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function e6(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L,D,R,z,I,F,N,W,se;function J(Ge,Ie){return Ge[6].length==0?WM:HM}let Y=J(r),_e=Y(r);w=new Zm({}),w.$on("click",r[10]),w.$on("mousemove",r[11]);let ze=$n(r[7]),ee=[];for(let Ge=0;Ge<ze.length;Ge+=1)ee[Ge]=t1(e1(r,ze,Ge));const ae=Ge=>G(ee[Ge],1,1,()=>{ee[Ge]=null});let Ee=$n(r[0]),we=[];for(let Ge=0;Ge<Ee.length;Ge+=1)we[Ge]=n1(Qy(r,Ee,Ge));const it=Ge=>G(we[Ge],1,1,()=>{we[Ge]=null});return R=new dr({props:{data:r[1]||Hi(),generateId:!0,$$slots:{default:[YM]},$$scope:{ctx:r}}}),I=new dr({props:{data:r[8],$$slots:{default:[QM]},$$scope:{ctx:r}}}),N=Pm(r[22][0]),{c(){e=U("p"),e.textContent="Click the map to add three points. Then adjust the points or add more.",t=oe(),n=U("div"),i=U("label"),o=U("input"),a=xe(`
    Snap boundary to roads`),d=oe(),p=U("button"),_e.c(),y=oe(),de(w.$$.fragment),T=oe();for(let Ge=0;Ge<ee.length;Ge+=1)ee[Ge].c();L=oe();for(let Ge=0;Ge<we.length;Ge+=1)we[Ge].c();D=oe(),de(R.$$.fragment),z=oe(),de(I.$$.fragment),o.disabled=u=r[0].length>=3,ue(o,"type","checkbox"),o.__value="snap",qn(o,o.__value),ue(p,"class","secondary"),p.disabled=g=r[6].length==0,ut(n,"display","flex"),ut(n,"gap","16px"),N.p(o)},m(Ge,Ie){q(Ge,e,Ie),q(Ge,t,Ie),q(Ge,n,Ie),$(n,i),$(i,o),o.checked=~(r[5]||[]).indexOf(o.__value),$(i,a),$(n,d),$(n,p),_e.m(p,null),q(Ge,y,Ie),he(w,Ge,Ie),q(Ge,T,Ie);for(let De=0;De<ee.length;De+=1)ee[De]&&ee[De].m(Ge,Ie);q(Ge,L,Ie);for(let De=0;De<we.length;De+=1)we[De]&&we[De].m(Ge,Ie);q(Ge,D,Ie),he(R,Ge,Ie),q(Ge,z,Ie),he(I,Ge,Ie),F=!0,W||(se=[yt(o,"change",r[21]),yt(p,"click",r[9])],W=!0)},p(Ge,Ie){if((!F||Ie[0]&1&&u!==(u=Ge[0].length>=3))&&(o.disabled=u),Ie[0]&32&&(o.checked=~(Ge[5]||[]).indexOf(o.__value)),Y===(Y=J(Ge))&&_e?_e.p(Ge,Ie):(_e.d(1),_e=Y(Ge),_e&&(_e.c(),_e.m(p,null))),(!F||Ie[0]&64&&g!==(g=Ge[6].length==0))&&(p.disabled=g),Ie[0]&114832){ze=$n(Ge[7]);let nt;for(nt=0;nt<ze.length;nt+=1){const lt=e1(Ge,ze,nt);ee[nt]?(ee[nt].p(lt,Ie),j(ee[nt],1)):(ee[nt]=t1(lt),ee[nt].c(),j(ee[nt],1),ee[nt].m(L.parentNode,L))}for(tn(),nt=ze.length;nt<ee.length;nt+=1)ae(nt);nn()}if(Ie[0]&143373){Ee=$n(Ge[0]);let nt;for(nt=0;nt<Ee.length;nt+=1){const lt=Qy(Ge,Ee,nt);we[nt]?(we[nt].p(lt,Ie),j(we[nt],1)):(we[nt]=n1(lt),we[nt].c(),j(we[nt],1),we[nt].m(D.parentNode,D))}for(tn(),nt=Ee.length;nt<we.length;nt+=1)it(nt);nn()}const De={};Ie[0]&2&&(De.data=Ge[1]||Hi()),Ie[1]&4096&&(De.$$scope={dirty:Ie,ctx:Ge}),R.$set(De);const Ct={};Ie[0]&256&&(Ct.data=Ge[8]),Ie[1]&4096&&(Ct.$$scope={dirty:Ie,ctx:Ge}),I.$set(Ct)},i(Ge){if(!F){j(w.$$.fragment,Ge);for(let Ie=0;Ie<ze.length;Ie+=1)j(ee[Ie]);for(let Ie=0;Ie<Ee.length;Ie+=1)j(we[Ie]);j(R.$$.fragment,Ge),j(I.$$.fragment,Ge),F=!0}},o(Ge){G(w.$$.fragment,Ge),ee=ee.filter(Boolean);for(let Ie=0;Ie<ee.length;Ie+=1)G(ee[Ie]);we=we.filter(Boolean);for(let Ie=0;Ie<we.length;Ie+=1)G(we[Ie]);G(R.$$.fragment,Ge),G(I.$$.fragment,Ge),F=!1},d(Ge){Ge&&(V(e),V(t),V(n),V(y),V(T),V(L),V(D),V(z)),_e.d(),fe(w,Ge),mi(ee,Ge),mi(we,Ge),fe(R,Ge),fe(I,Ge),N.r(),W=!1,mr(se)}}}function t6(r,e){if(e.length<3)return JSON.parse(r.inner.calculateRoute(e));let t=JSON.parse(JSON.stringify(e));t.push(t[0]);let n=JSON.parse(r.inner.calculateRoute(t));return n.properties.waypoints.pop(),n.geometry.type="Polygon",n.geometry.coordinates=[n.geometry.coordinates],n}function n6(r,e,t){let n,i;st(r,pd,We=>t(20,i=We));let{map:o}=e,{waypoints:u}=e,{drawnShapeOut:a=void 0}=e;ti(()=>{i==null||i.stop(),o.getCanvas().style.cursor="inherit"});let d="snap",p=[],g=[],y=null,w=!1,T=!1,L=!1;function D(We){let Bt=We.length==0?"crosshair":"inherit";o.getCanvas().style.cursor=Bt}function R(){let We=p.pop();t(6,p),We&&t(0,u=We)}function z(){p.length==100&&p.shift(),t(6,p=[...p,JSON.parse(JSON.stringify(u))])}function I(We){u.length>=3||(z(),u.push({point:We.detail.lngLat.toArray(),snapped:d=="snap"}),t(0,u))}function F(We){t(19,y={point:We.detail.lngLat.toArray(),snapped:d=="snap"})}function N(We){z(),t(0,u[We].snapped=!u[We].snapped,u),t(0,u)}function W(We){z(),u.splice(We,1),t(0,u),t(2,w=!1)}function se(We,Bt,Lt,Nt){if(Nt||Bt.length>=3)return Hi();try{if(We&&Bt.length>0&&Lt)return JSON.parse(We.inner.calculateRoute([Bt[Bt.length-1],Lt]))}catch{}return Hi()}function J(We,Bt,Lt){if(Lt)return;if(!We||Bt.length<3){t(7,g=[]);return}let Nt=[],Mt=1,Qt=JSON.parse(JSON.stringify(Bt));Qt.push(Qt[0]);for(let bt=0;bt<Qt.length-1;bt++){let Dt=JSON.parse(We.inner.getExtraNodes(Qt[bt],Qt[bt+1]));for(let[pn,qe,Ve]of Dt)Nt.push({point:[pn,qe],snapped:Ve,insertIdx:Mt});Mt++}t(7,g=Nt)}function Y(We){z(),u.splice(We.insertIdx,0,{point:We.point,snapped:We.snapped}),t(0,u),t(4,L=!0)}function _e(We){t(0,u[We.insertIdx].point=We.point,u),t(0,u)}function ze(){t(4,L=!1)}function ee(){z(),t(3,T=!0)}const ae=[[]];function Ee(){d=Z2(ae[0],this.__value,this.checked),t(5,d)}function we(We,Bt){r.$$.not_equal(Bt.point,We)&&(Bt.point=We,t(7,g))}const it=We=>Y(We),Ge=We=>_e(We),Ie=We=>{Y(We),t(4,L=!1)};function De(We,Bt){r.$$.not_equal(Bt.point,We)&&(Bt.point=We,t(0,u))}const Ct=We=>N(We),nt=We=>W(We),lt=()=>t(2,w=!0),mt=()=>t(2,w=!1),ht=()=>t(3,T=!1);return r.$$set=We=>{"map"in We&&t(18,o=We.map),"waypoints"in We&&t(0,u=We.waypoints),"drawnShapeOut"in We&&t(1,a=We.drawnShapeOut)},r.$$.update=()=>{if(r.$$.dirty[0]&1048577)try{i&&t(1,a=t6(i,u))}catch(We){console.log("error drawing shape",We),t(1,a=void 0)}r.$$.dirty[0]&1048593&&J(i,u,L),r.$$.dirty[0]&1572877&&t(8,n=se(i,u,y,w||T)),r.$$.dirty[0]&1&&D(u)},[u,a,w,T,L,d,p,g,n,R,I,F,N,W,Y,_e,ze,ee,o,y,i,Ee,ae,we,it,Ge,Ie,De,Ct,nt,lt,mt,ht]}class Rv extends It{constructor(e){super(),Et(this,e,n6,e6,xt,{map:18,waypoints:0,drawnShapeOut:1},null,[-1,-1])}}function r1(r){let e,t,n,i,o=Math.round(r[0].properties.population/r[0].properties.area_km2).toLocaleString()+"",u,a,d,p,g,y,w,T=r[0].properties.simd.toFixed(1)+"",L,D,R,z,I,F,N,W=(r[0].properties.number_stats19_collisions/r[0].properties.area_km2).toFixed(1)+"",se,J,Y,_e,ze,ee,ae,Ee=Pc(r[0].properties.households_with_cars_or_vans,r[0].properties.total_households)+"",we,it,Ge,Ie,De,Ct,nt,lt=(r[0].properties.number_pois/r[0].properties.area_km2).toFixed(1)+"",mt,ht;return{c(){e=U("tr"),t=U("th"),t.textContent="Population density",n=oe(),i=U("td"),u=xe(o),a=xe(" people / km"),d=oe(),p=U("tr"),g=U("th"),g.textContent="SIMD",y=oe(),w=U("td"),L=xe(T),D=xe("%"),R=oe(),z=U("tr"),I=U("th"),I.textContent="Collision density",F=oe(),N=U("td"),se=xe(W),J=xe(" / km"),Y=oe(),_e=U("tr"),ze=U("th"),ze.textContent="Car ownership",ee=oe(),ae=U("td"),we=xe(Ee),it=xe(" of households"),Ge=oe(),Ie=U("tr"),De=U("th"),De.textContent="POI density",Ct=oe(),nt=U("td"),mt=xe(lt),ht=xe(" / km")},m(We,Bt){q(We,e,Bt),$(e,t),$(e,n),$(e,i),$(i,u),$(i,a),q(We,d,Bt),q(We,p,Bt),$(p,g),$(p,y),$(p,w),$(w,L),$(w,D),q(We,R,Bt),q(We,z,Bt),$(z,I),$(z,F),$(z,N),$(N,se),$(N,J),q(We,Y,Bt),q(We,_e,Bt),$(_e,ze),$(_e,ee),$(_e,ae),$(ae,we),$(ae,it),q(We,Ge,Bt),q(We,Ie,Bt),$(Ie,De),$(Ie,Ct),$(Ie,nt),$(nt,mt),$(nt,ht)},p(We,Bt){Bt&1&&o!==(o=Math.round(We[0].properties.population/We[0].properties.area_km2).toLocaleString()+"")&&St(u,o),Bt&1&&T!==(T=We[0].properties.simd.toFixed(1)+"")&&St(L,T),Bt&1&&W!==(W=(We[0].properties.number_stats19_collisions/We[0].properties.area_km2).toFixed(1)+"")&&St(se,W),Bt&1&&Ee!==(Ee=Pc(We[0].properties.households_with_cars_or_vans,We[0].properties.total_households)+"")&&St(we,Ee),Bt&1&&lt!==(lt=(We[0].properties.number_pois/We[0].properties.area_km2).toFixed(1)+"")&&St(mt,lt)},d(We){We&&(V(e),V(d),V(p),V(R),V(z),V(Y),V(_e),V(Ge),V(Ie))}}}function r6(r){let e,t,n,i,o,u=r[0].properties.area_km2.toFixed(1)+"",a,d,p,g=r[1]=="cnt"&&r1(r);return{c(){e=U("table"),t=U("tr"),n=U("th"),n.textContent="Area",i=oe(),o=U("td"),a=xe(u),d=xe(" km"),p=oe(),g&&g.c(),ue(e,"class","svelte-1kpsyee")},m(y,w){q(y,e,w),$(e,t),$(t,n),$(t,i),$(t,o),$(o,a),$(o,d),$(e,p),g&&g.m(e,null)},p(y,[w]){w&1&&u!==(u=y[0].properties.area_km2.toFixed(1)+"")&&St(a,u),y[1]=="cnt"?g?g.p(y,w):(g=r1(y),g.c(),g.m(e,null)):g&&(g.d(1),g=null)},i:rt,o:rt,d(y){y&&V(e),g&&g.d()}}}function i6(r,e,t){let n;st(r,Ro,o=>t(1,n=o));let{neighbourhoodBoundary:i}=e;return r.$$set=o=>{"neighbourhoodBoundary"in o&&t(0,i=o.neighbourhoodBoundary)},[i,n]}class $v extends It{constructor(e){super(),Et(this,e,i6,r6,xt,{neighbourhoodBoundary:0})}}function Fv(r,e,t){let n=new Set(r.toSavefile().features.filter(i=>i.properties.kind=="boundary").map(i=>i.properties.name));for(;;){let i=window.prompt(e,t);if(i===null)return null;if(i=i.trim(),i==="")window.alert("Neighbourhood cannot be blank; please pick a name or cancel");else if(n.has(i))window.alert(`There is already a neighbourhood called ${i}; please pick another name`);else return i}}function o6(r){let e,t,n,i;return e=new Fo({props:{colorScale:fv,labels:{limits:hv}}}),{c(){de(e.$$.fragment),t=oe(),n=U("div"),n.textContent="POIs / km",ut(n,"text-align","center")},m(o,u){he(e,o,u),q(o,t,u),q(o,n,u),i=!0},i(o){i||(j(e.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),i=!1},d(o){o&&(V(t),V(n)),fe(e,o)}}}function s6(r){let e,t,n,i;return e=new Fo({props:{colorScale:uv,labels:{limits:cv}}}),{c(){de(e.$$.fragment),t=oe(),n=U("div"),n.textContent="collisions / km",ut(n,"text-align","center")},m(o,u){he(e,o,u),q(o,t,u),q(o,n,u),i=!0},i(o){i||(j(e.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),i=!1},d(o){o&&(V(t),V(n)),fe(e,o)}}}function a6(r){let e,t,n,i;return e=new Fo({props:{colorScale:xd,labels:{buckets:dv(kd)}}}),{c(){de(e.$$.fragment),t=oe(),n=U("div"),n.innerHTML="<span>More deprived</span> <span>Less deprived</span>",ue(n,"class","sub-labels svelte-3xhwrh")},m(o,u){he(e,o,u),q(o,t,u),q(o,n,u),i=!0},i(o){i||(j(e.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),i=!1},d(o){o&&(V(t),V(n)),fe(e,o)}}}function l6(r){let e,t,n,i;return e=new Fo({props:{colorScale:Md,labels:{limits:Td.map(h6)}}}),{c(){de(e.$$.fragment),t=oe(),n=U("div"),n.innerHTML='<span style="text-align: center; width: 100%">Households with at least one car or van</span>',ut(n,"display","flex"),ut(n,"justify-content","space-between")},m(o,u){he(e,o,u),q(o,t,u),q(o,n,u),i=!0},i(o){i||(j(e.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),i=!1},d(o){o&&(V(t),V(n)),fe(e,o)}}}function c6(r){let e,t,n,i;return e=new Fo({props:{colorScale:Sd,labels:{limits:Cd}}}),{c(){de(e.$$.fragment),t=oe(),n=U("div"),n.innerHTML="<span>Less dense</span> <span>people / km</span> <span>More dense</span>",ue(n,"class","sub-labels svelte-3xhwrh")},m(o,u){he(e,o,u),q(o,t,u),q(o,n,u),i=!0},i(o){i||(j(e.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),i=!1},d(o){o&&(V(t),V(n)),fe(e,o)}}}function u6(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L,D,R,z;const I=[c6,l6,a6,s6,o6],F=[];function N(W,se){return W[0]=="density"?0:W[0]=="car_ownership"?1:W[0]=="simd"?2:W[0]=="stats19"?3:W[0]=="pois"?4:-1}return~(w=N(r))&&(T=F[w]=I[w](r)),{c(){e=U("div"),t=U("label"),t.textContent="Metric",n=oe(),i=U("select"),o=U("option"),o.textContent="None",u=U("option"),u.textContent="Density",a=U("option"),a.textContent="Collisions",d=U("option"),d.textContent="SIMD",p=U("option"),p.textContent="Points of interest",g=U("option"),g.textContent="Car ownership",y=oe(),T&&T.c(),L=Jn(),ue(t,"for","prioritization-selection"),o.__value="none",qn(o,o.__value),u.__value="density",qn(u,u.__value),a.__value="stats19",qn(a,a.__value),d.__value="simd",qn(d,d.__value),p.__value="pois",qn(p,p.__value),g.__value="car_ownership",qn(g,g.__value),ue(i,"id","prioritization-selection"),r[0]===void 0&&ls(()=>r[1].call(i)),ut(e,"display","flex"),ut(e,"gap","16px"),ut(e,"align-items","center")},m(W,se){q(W,e,se),$(e,t),$(e,n),$(e,i),$(i,o),$(i,u),$(i,a),$(i,d),$(i,p),$(i,g),qi(i,r[0],!0),q(W,y,se),~w&&F[w].m(W,se),q(W,L,se),D=!0,R||(z=yt(i,"change",r[1]),R=!0)},p(W,[se]){se&1&&qi(i,W[0]);let J=w;w=N(W),w!==J&&(T&&(tn(),G(F[J],1,1,()=>{F[J]=null}),nn()),~w?(T=F[w],T||(T=F[w]=I[w](W),T.c()),j(T,1),T.m(L.parentNode,L)):T=null)},i(W){D||(j(T),D=!0)},o(W){G(T),D=!1},d(W){W&&(V(e),V(y),V(L)),~w&&F[w].d(W),R=!1,z()}}}const h6=r=>`${r}%`;function f6(r,e,t){let n;st(r,Ro,a=>t(2,n=a));let{selectedPrioritization:i}=e;function o(){let a=new URL(window.location.href).searchParams.get("prioritizationMetric");a=="density"?t(0,i="density"):a=="simd"?t(0,i="simd"):a=="stats19"?t(0,i="stats19"):a=="pois"?t(0,i="pois"):a=="car_ownership"&&t(0,i="car_ownership")}n=="cnt"?o():i="none";function u(){i=va(this),t(0,i)}return r.$$set=a=>{"selectedPrioritization"in a&&t(0,i=a.selectedPrioritization)},r.$$.update=()=>{if(r.$$.dirty&1){const a=new URL(window.location.href);i=="none"?a.searchParams.delete("prioritizationMetric"):a.searchParams.set("prioritizationMetric",i),history.replaceState({},"",a)}},[i,u]}class Bv extends It{constructor(e){super(),Et(this,e,f6,u6,xt,{selectedPrioritization:0})}}function Ov(r,e){return{none:r.none,area:so(["get","area_km2"],fS,dS),car_ownership:so(["*",100,["/",["get","households_with_cars_or_vans"],["get","total_households"]]],Td,Md),density:so(["/",["get","population"],["get","area_km2"]],Cd,Sd),pois:so(["/",["get","number_pois"],["get","area_km2"]],hv,fv),simd:so(["get","simd"],kd,xd),stats19:so(["/",["get","number_stats19_collisions"],["get","area_km2"]],cv,uv)}[e]}function d6(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function p6(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function m6(r){let e,t,n,i,o,u,a,d,p,g,y;return o=new Rn({props:{$$slots:{default:[d6]},$$scope:{ctx:r}}}),o.$on("click",$o),d=new Rn({props:{$$slots:{default:[p6]},$$scope:{ctx:r}}}),d.$on("click",r[27]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),de(o.$$.fragment),u=oe(),a=U("li"),de(d.$$.fragment),p=oe(),g=U("li"),g.textContent="Add a neighbourhood",ue(t,"aria-label","breadcrumb"),ue(e,"slot","top")},m(w,T){q(w,e,T),$(e,t),$(t,n),$(n,i),he(o,i,null),$(n,u),$(n,a),he(d,a,null),$(n,p),$(n,g),y=!0},p(w,T){const L={};T[1]&1&&(L.$$scope={dirty:T,ctx:w}),o.$set(L);const D={};T[1]&1&&(D.$$scope={dirty:T,ctx:w}),d.$set(D)},i(w){y||(j(o.$$.fragment,w),j(d.$$.fragment,w),y=!0)},o(w){G(o.$$.fragment,w),G(d.$$.fragment,w),y=!1},d(w){w&&V(e),fe(o),fe(d)}}}function i1(r){let e,t,n,i,o,u,a;function d(g){r[21](g)}let p={};return r[4]!==void 0&&(p.selectedPrioritization=r[4]),o=new Bv({props:p}),un.push(()=>Cn(o,"selectedPrioritization",d)),{c(){e=U("h3"),e.textContent="Prioritization",t=oe(),n=U("p"),n.textContent="Compare metrics across candidate neighbourhoods.",i=oe(),de(o.$$.fragment)},m(g,y){q(g,e,y),q(g,t,y),q(g,n,y),q(g,i,y),he(o,g,y),a=!0},p(g,y){const w={};!u&&y[0]&16&&(u=!0,w.selectedPrioritization=g[4],Sn(()=>u=!1)),o.$set(w)},i(g){a||(j(o.$$.fragment,g),a=!0)},o(g){G(o.$$.fragment,g),a=!1},d(g){g&&(V(e),V(t),V(n),V(i)),fe(o,g)}}}function o1(r){let e;return{c(){e=U("p"),e.textContent="The colors are arbitrary, just to distinguish better."},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function _6(r){let e,t,n,i,o,u,a,d;function p(w){r[24](w)}function g(w){r[25](w)}let y={map:Er(r[10])};return r[6]!==void 0&&(y.waypoints=r[6]),r[1]!==void 0&&(y.drawnShapeOut=r[1]),n=new Rv({props:y}),un.push(()=>Cn(n,"waypoints",p)),un.push(()=>Cn(n,"drawnShapeOut",g)),{c(){e=U("div"),e.innerHTML='<h3 class="svelte-qlwqvq">1. Draw your neighbourhood</h3>',t=oe(),de(n.$$.fragment),u=oe(),a=U("div"),a.innerHTML=`<h3 class="svelte-qlwqvq">2. Refine your boundary</h3> <p>Continue to add, delete, and move points until you&#39;re happy with
            your neighbourhood boundary. Don&#39;t worry, you can always adjust the
            boundary more later.</p>`,ue(e,"class","step svelte-qlwqvq"),Yt(e,"active",!r[7]),Yt(e,"complete",r[7]),ue(a,"class","step svelte-qlwqvq"),ut(a,"margin-top","16px"),Yt(a,"active",r[7]),Yt(a,"complete",r[5].size>1)},m(w,T){q(w,e,T),q(w,t,T),he(n,w,T),q(w,u,T),q(w,a,T),d=!0},p(w,T){(!d||T[0]&128)&&Yt(e,"active",!w[7]),(!d||T[0]&128)&&Yt(e,"complete",w[7]);const L={};T[0]&1024&&(L.map=Er(w[10])),!i&&T[0]&64&&(i=!0,L.waypoints=w[6],Sn(()=>i=!1)),!o&&T[0]&2&&(o=!0,L.drawnShapeOut=w[1],Sn(()=>o=!1)),n.$set(L),(!d||T[0]&128)&&Yt(a,"active",w[7]),(!d||T[0]&32)&&Yt(a,"complete",w[5].size>1)},i(w){d||(j(n.$$.fragment,w),d=!0)},o(w){G(n.$$.fragment,w),d=!1},d(w){w&&(V(e),V(t),V(u),V(a)),fe(n,w)}}}function g6(r){let e,t,n;return{c(){e=U("div"),e.innerHTML=`<h3 class="svelte-qlwqvq">1. Click an area to start your neighbourhood</h3> <p>These particular boundaries are suggested by finding roads,
            railways, and water that form severances.</p>`,t=oe(),n=U("div"),n.innerHTML='<h3 class="svelte-qlwqvq">2. Include additional areas</h3> <p>Click any adjacent areas you&#39;d like to add to your boundary.</p>',ue(e,"class","step svelte-qlwqvq"),Yt(e,"active",!r[7]),Yt(e,"complete",r[7]),ue(n,"class","step svelte-qlwqvq"),Yt(n,"active",r[7]),Yt(n,"complete",r[5].size>1)},m(i,o){q(i,e,o),q(i,t,o),q(i,n,o)},p(i,o){o[0]&128&&Yt(e,"active",!i[7]),o[0]&128&&Yt(e,"complete",i[7]),o[0]&128&&Yt(n,"active",i[7]),o[0]&32&&Yt(n,"complete",i[5].size>1)},i:rt,o:rt,d(i){i&&(V(e),V(t),V(n))}}}function y6(r){let e;function t(o,u){if(o[0]=="choose-area")return w6;if(o[0]=="draw-area")return v6}let n=t(r),i=n&&n(r);return{c(){e=U("span"),i&&i.c(),ut(e,"text-align","center")},m(o,u){q(o,e,u),i&&i.m(e,null)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e,null)))},i:rt,o:rt,d(o){o&&V(e),i&&i.d()}}}function b6(r){let e,t;return e=new $v({props:{neighbourhoodBoundary:r[7]}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i[0]&128&&(o.neighbourhoodBoundary=n[7]),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function v6(r){let e;function t(o,u){return o[6].length<3?k6:x6}let n=t(r),i=n(r);return{c(){i.c(),e=Jn()},m(o,u){i.m(o,u),q(o,e,u)},p(o,u){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&V(e),i.d(o)}}}function w6(r){let e;return{c(){e=xe("Empty so far. Click an area to get started.")},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function x6(r){let e;return{c(){e=xe(`Not a valid shape yet  try dragging the points into a box
                around your neighbourhood. Note the ordering of the points.`)},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function k6(r){let e;return{c(){e=xe(`Empty so far. Click the map to add points around your
                neighborhood to get started.`)},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function S6(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L,D,R,z,I,F,N,W,se,J,Y,_e,ze,ee,ae,Ee,we,it,Ge,Ie,De,Ct,nt,lt,mt,ht,We,Bt,Lt,Nt,Mt,Qt,bt;t=new Ys({}),t.$on("click",r[20]);let Dt=r[9]=="cnt"&&i1(r),pn=r[4]=="none"&&o1();const qe=[g6,_6],Ve=[];function kt(Oe,tt){return Oe[0]=="choose-area"?0:Oe[0]=="draw-area"?1:-1}~(N=kt(r))&&(W=Ve[N]=qe[N](r)),it=new Um({});const Ut=[b6,y6],ye=[];function zn(Oe,tt){return Oe[7]?0:1}return mt=zn(r),ht=ye[mt]=Ut[mt](r),{c(){e=U("div"),de(t.$$.fragment),n=oe(),Dt&&Dt.c(),i=oe(),pn&&pn.c(),o=oe(),u=U("hr"),a=oe(),d=U("div"),p=U("div"),g=U("button"),y=xe("Choose area"),T=oe(),L=U("span"),L.textContent="or",D=oe(),R=U("button"),z=xe("Draw area"),F=oe(),W&&W.c(),se=oe(),J=U("div"),J.innerHTML='<h3 class="svelte-qlwqvq">3. Finished?</h3> <p>When you&#39;re done, click &quot;Create&quot;.</p>',Y=oe(),_e=U("div"),ze=U("button"),ee=xe("Create neighborhood"),Ee=oe(),we=U("button"),de(it.$$.fragment),Ge=xe(" Start over"),De=oe(),Ct=U("h3"),Ct.textContent="Your neighbourhood overall",nt=oe(),lt=U("div"),ht.c(),We=oe(),Bt=U("hr"),Lt=oe(),Nt=U("button"),Nt.textContent="Export to GeoJSON",g.disabled=w=r[0]=="choose-area",ue(g,"class","svelte-qlwqvq"),Yt(g,"active",r[0]=="choose-area"),ut(L,"margin","0 16px"),R.disabled=I=r[0]=="draw-area",ue(R,"class","svelte-qlwqvq"),Yt(R,"active",r[0]=="draw-area"),ue(p,"class","modes svelte-qlwqvq"),ue(J,"class","step svelte-qlwqvq"),Yt(J,"active",r[7]),ze.disabled=ae=!r[7],ue(we,"class","destructive"),ut(we,"display","flex"),ut(we,"gap","8px"),ut(we,"align-items","center"),we.disabled=Ie=!(r[7]||r[0]=="draw-area"&&r[6].length>0),ut(_e,"display","flex"),ut(_e,"gap","16px"),ut(_e,"justify-content","space-between"),ut(_e,"margin-bottom","16px"),ue(lt,"class","neighbourhood-boundary-summary svelte-qlwqvq"),ue(Nt,"class","secondary"),ue(e,"slot","sidebar")},m(Oe,tt){q(Oe,e,tt),he(t,e,null),$(e,n),Dt&&Dt.m(e,null),$(e,i),pn&&pn.m(e,null),$(e,o),$(e,u),$(e,a),$(e,d),$(d,p),$(p,g),$(g,y),$(p,T),$(p,L),$(p,D),$(p,R),$(R,z),$(d,F),~N&&Ve[N].m(d,null),$(d,se),$(d,J),$(d,Y),$(d,_e),$(_e,ze),$(ze,ee),$(_e,Ee),$(_e,we),he(it,we,null),$(we,Ge),$(d,De),$(d,Ct),$(d,nt),$(d,lt),ye[mt].m(lt,null),$(e,We),$(e,Bt),$(e,Lt),$(e,Nt),Mt=!0,Qt||(bt=[yt(g,"click",r[22]),yt(R,"click",r[23]),yt(ze,"click",r[26]),yt(we,"click",r[16]),yt(Nt,"click",r[13])],Qt=!0)},p(Oe,tt){Oe[9]=="cnt"?Dt?(Dt.p(Oe,tt),tt[0]&512&&j(Dt,1)):(Dt=i1(Oe),Dt.c(),j(Dt,1),Dt.m(e,i)):Dt&&(tn(),G(Dt,1,1,()=>{Dt=null}),nn()),Oe[4]=="none"?pn||(pn=o1(),pn.c(),pn.m(e,o)):pn&&(pn.d(1),pn=null),(!Mt||tt[0]&1&&w!==(w=Oe[0]=="choose-area"))&&(g.disabled=w),(!Mt||tt[0]&1)&&Yt(g,"active",Oe[0]=="choose-area"),(!Mt||tt[0]&1&&I!==(I=Oe[0]=="draw-area"))&&(R.disabled=I),(!Mt||tt[0]&1)&&Yt(R,"active",Oe[0]=="draw-area");let Kt=N;N=kt(Oe),N===Kt?~N&&Ve[N].p(Oe,tt):(W&&(tn(),G(Ve[Kt],1,1,()=>{Ve[Kt]=null}),nn()),~N?(W=Ve[N],W?W.p(Oe,tt):(W=Ve[N]=qe[N](Oe),W.c()),j(W,1),W.m(d,se)):W=null),(!Mt||tt[0]&128)&&Yt(J,"active",Oe[7]),(!Mt||tt[0]&128&&ae!==(ae=!Oe[7]))&&(ze.disabled=ae),(!Mt||tt[0]&193&&Ie!==(Ie=!(Oe[7]||Oe[0]=="draw-area"&&Oe[6].length>0)))&&(we.disabled=Ie);let Un=mt;mt=zn(Oe),mt===Un?ye[mt].p(Oe,tt):(tn(),G(ye[Un],1,1,()=>{ye[Un]=null}),nn(),ht=ye[mt],ht?ht.p(Oe,tt):(ht=ye[mt]=Ut[mt](Oe),ht.c()),j(ht,1),ht.m(lt,null))},i(Oe){Mt||(j(t.$$.fragment,Oe),j(Dt),j(W),j(it.$$.fragment,Oe),j(ht),Mt=!0)},o(Oe){G(t.$$.fragment,Oe),G(Dt),G(W),G(it.$$.fragment,Oe),G(ht),Mt=!1},d(Oe){Oe&&V(e),fe(t),Dt&&Dt.d(),pn&&pn.d(),~N&&Ve[N].d(),fe(it),ye[mt].d(),Qt=!1,mr(bt)}}}function s1(r){let e,t;return e=new dr({props:{data:{type:"FeatureCollection",features:[r[7]]},$$slots:{default:[C6]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i[0]&128&&(o.data={type:"FeatureCollection",features:[n[7]]}),i[1]&1&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function C6(r){let e,t,n,i;const o=[dn("neighbourhood-boundaries-selected-outline",!1),{paint:{"line-color":"black","line-width":4,"line-dasharray":[2,2]}}];let u={};for(let p=0;p<o.length;p+=1)u=Gt(u,o[p]);e=new tr({props:u});const a=[dn("neighbourhood-boundaries-selected-outline-base",!1),{paint:{"line-color":"white","line-width":8,"line-opacity":.7}}];let d={};for(let p=0;p<a.length;p+=1)d=Gt(d,a[p]);return n=new tr({props:d}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment)},m(p,g){he(e,p,g),q(p,t,g),he(n,p,g),i=!0},p(p,g){const y={};e.$set(y);const w={};n.$set(w)},i(p){i||(j(e.$$.fragment,p),j(n.$$.fragment,p),i=!0)},o(p){G(e.$$.fragment,p),G(n.$$.fragment,p),i=!1},d(p){p&&V(t),fe(e,p),fe(n,p)}}}function a1(r){let e,t;return e=new dr({props:{data:r[3],generateId:!0,$$slots:{default:[z6]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i[0]&8&&(o.data=n[3]),i[0]&16|i[1]&1&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function l1(r){let e,t;return e=new fi({props:{openOn:"hover",$$slots:{default:[A6,({props:n})=>({30:n}),({props:n})=>[n?1073741824:0]]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i[0]&1073741840|i[1]&1&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function T6(r){let e,t,n,i,o=(r[30].number_pois/r[30].area_km2).toFixed(1)+"",u,a;return{c(){e=U("b"),e.textContent="Points of interest",t=oe(),n=U("br"),i=oe(),u=xe(o),a=xe(" / km")},m(d,p){q(d,e,p),q(d,t,p),q(d,n,p),q(d,i,p),q(d,u,p),q(d,a,p)},p(d,p){p[0]&1073741824&&o!==(o=(d[30].number_pois/d[30].area_km2).toFixed(1)+"")&&St(u,o)},d(d){d&&(V(e),V(t),V(n),V(i),V(u),V(a))}}}function M6(r){let e,t,n,i,o=(r[30].number_stats19_collisions/r[30].area_km2).toFixed(1)+"",u,a;return{c(){e=U("b"),e.textContent="Pedestrian and cyclist collisions",t=oe(),n=U("br"),i=oe(),u=xe(o),a=xe(` /
                km`)},m(d,p){q(d,e,p),q(d,t,p),q(d,n,p),q(d,i,p),q(d,u,p),q(d,a,p)},p(d,p){p[0]&1073741824&&o!==(o=(d[30].number_stats19_collisions/d[30].area_km2).toFixed(1)+"")&&St(u,o)},d(d){d&&(V(e),V(t),V(n),V(i),V(u),V(a))}}}function L6(r){let e,t,n,i,o=Math.round(r[30].population/r[30].area_km2).toLocaleString()+"",u,a;return{c(){e=U("b"),e.textContent="Population density",t=oe(),n=U("br"),i=oe(),u=xe(o),a=xe(`
                people / km`)},m(d,p){q(d,e,p),q(d,t,p),q(d,n,p),q(d,i,p),q(d,u,p),q(d,a,p)},p(d,p){p[0]&1073741824&&o!==(o=Math.round(d[30].population/d[30].area_km2).toLocaleString()+"")&&St(u,o)},d(d){d&&(V(e),V(t),V(n),V(i),V(u),V(a))}}}function E6(r){let e,t,n,i,o=Pc(r[30].households_with_cars_or_vans,r[30].total_households)+"",u,a,d=r[30].total_households.toLocaleString()+"",p,g;return{c(){e=U("b"),e.textContent="Car or van ownership",t=oe(),n=U("br"),i=oe(),u=xe(o),a=xe(" of approximately "),p=xe(d),g=xe(`
                households have at least one car or van.`)},m(y,w){q(y,e,w),q(y,t,w),q(y,n,w),q(y,i,w),q(y,u,w),q(y,a,w),q(y,p,w),q(y,g,w)},p(y,w){w[0]&1073741824&&o!==(o=Pc(y[30].households_with_cars_or_vans,y[30].total_households)+"")&&St(u,o),w[0]&1073741824&&d!==(d=y[30].total_households.toLocaleString()+"")&&St(p,d)},d(y){y&&(V(e),V(t),V(n),V(i),V(u),V(a),V(p),V(g))}}}function I6(r){let e,t,n=r[30].area_km2.toFixed(1)+"",i,o;return{c(){e=U("b"),e.textContent="Area:",t=oe(),i=xe(n),o=xe(" km")},m(u,a){q(u,e,a),q(u,t,a),q(u,i,a),q(u,o,a)},p(u,a){a[0]&1073741824&&n!==(n=u[30].area_km2.toFixed(1)+"")&&St(i,n)},d(u){u&&(V(e),V(t),V(i),V(o))}}}function A6(r){let e;function t(o,u){if(o[4]=="none")return I6;if(o[4]=="car_ownership")return E6;if(o[4]=="density")return L6;if(o[4]=="stats19")return M6;if(o[4]=="pois")return T6}let n=t(r),i=n&&n(r);return{c(){i&&i.c(),e=Jn()},m(o,u){i&&i.m(o,u),q(o,e,u)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&V(e),i&&i.d(o)}}}function P6(r){let e,t,n=r[4]!="simd"&&l1(r);return{c(){n&&n.c(),e=Jn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,o){i[4]!="simd"?n?(n.p(i,o),o[0]&16&&j(n,1)):(n=l1(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),G(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){G(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function z6(r){let e,t,n,i;const o=[dn("neighbourhood-boundaries",!1),{paint:{"fill-color":r[14](r[4]),"fill-opacity":r[15](r[4])}},{manageHoverState:!0},{hoverCursor:"pointer"}];let u={$$slots:{default:[P6]},$$scope:{ctx:r}};for(let p=0;p<o.length;p+=1)u=Gt(u,o[p]);e=new Pi({props:u}),e.$on("click",r[11]);const a=[dn("neighbourhood-boundaries-outline",!1),{paint:{"line-color":"black","line-width":1}}];let d={};for(let p=0;p<a.length;p+=1)d=Gt(d,a[p]);return n=new tr({props:d}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment)},m(p,g){he(e,p,g),q(p,t,g),he(n,p,g),i=!0},p(p,g){const y=g[0]&49168?Zn(o,[o[0],{paint:{"fill-color":p[14](p[4]),"fill-opacity":p[15](p[4])}},o[2],o[3]]):{};g[0]&16|g[1]&1&&(y.$$scope={dirty:g,ctx:p}),e.$set(y);const w={};n.$set(w)},i(p){i||(j(e.$$.fragment,p),j(n.$$.fragment,p),i=!0)},o(p){G(e.$$.fragment,p),G(n.$$.fragment,p),i=!1},d(p){p&&V(t),fe(e,p),fe(n,p)}}}function D6(r){let e,t,n,i=r[7]&&s1(r),o=r[0]=="choose-area"&&a1(r);return{c(){e=U("div"),i&&i.c(),t=oe(),o&&o.c(),ue(e,"slot","map")},m(u,a){q(u,e,a),i&&i.m(e,null),$(e,t),o&&o.m(e,null),n=!0},p(u,a){u[7]?i?(i.p(u,a),a[0]&128&&j(i,1)):(i=s1(u),i.c(),j(i,1),i.m(e,t)):i&&(tn(),G(i,1,1,()=>{i=null}),nn()),u[0]=="choose-area"?o?(o.p(u,a),a[0]&1&&j(o,1)):(o=a1(u),o.c(),j(o,1),o.m(e,null)):o&&(tn(),G(o,1,1,()=>{o=null}),nn())},i(u){n||(j(i),j(o),n=!0)},o(u){G(i),G(o),n=!1},d(u){u&&V(e),i&&i.d(),o&&o.d()}}}function R6(r){let e,t,n,i;return e=new kh({props:{loading:r[2]}}),n=new _o({props:{$$slots:{map:[D6],sidebar:[S6],top:[m6]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment)},m(o,u){he(e,o,u),q(o,t,u),he(n,o,u),i=!0},p(o,u){const a={};u[0]&4&&(a.loading=o[2]),e.$set(a);const d={};u[0]&2043|u[1]&1&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(j(e.$$.fragment,o),j(n.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),G(n.$$.fragment,o),i=!1},d(o){o&&V(t),fe(e,o),fe(n,o)}}}function $6(r,e,t){let n,i,o,u,a,d;st(r,an,Ie=>t(8,n=Ie)),st(r,Ir,Ie=>t(19,i=Ie)),st(r,dl,Ie=>t(28,o=Ie)),st(r,Xs,Ie=>t(29,u=Ie)),st(r,Ro,Ie=>t(9,a=Ie)),st(r,Do,Ie=>t(10,d=Ie));let p="Generating severance boundaries...",g=Hi(),y="choose-area",w="none",T=null,L=new Map,D=[],R,z=null,I=null;Ts(async()=>{await new Promise(Ie=>{requestAnimationFrame(()=>{requestAnimationFrame(Ie)})}),t(3,g=i.generatedBoundaries()),t(2,p="")});function F(Ie){let De=Ie.detail.features[0].id,Ct=g.features[De],nt=new Map(L);if(nt.has(De)?nt.delete(De):nt.set(De,Ct),nt.size===0)t(17,T=null),t(5,L=nt);else if(nt.size===1)t(17,T=nt.values().next().value),t(5,L=nt);else{let lt={type:"FeatureCollection",features:Array.from(nt.values())};try{t(17,T=i.generateMergedBoundary(lt)),t(5,L=nt)}catch(mt){console.log(`error merging boundaries: ${mt}`),window.alert(`Sorry, the boundaries you selected cannot be merged.
Error: ${mt}`)}}}function N(Ie){var nt;let De=u.nextAvailableNeighbourhoodName(o),Ct=Fv(i,"What do you want to name the neighbourhood?",De);if(Ct)try{const lt={};y=="draw-area"&&((nt=R==null?void 0:R.properties)!=null&&nt.waypoints)&&(lt.waypoints=R.properties.waypoints);let mt={type:"Feature",properties:lt,geometry:Ie.geometry};i.setNeighbourhoodBoundary(Ct,mt),dh(),i.setCurrentNeighbourhood(Ct),Ot(an,n={mode:"neighbourhood"},n)}catch(lt){window.alert(`Sorry, this boundary is invalid: ${lt}`)}}function W(){gd("auto_boundaries.geojson",JSON.stringify(g,null,"  "))}function se(Ie){return Ov({none:["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"]},Ie)}function J(Ie){return{none:Wn(.3,.5),area:Wn(.7,.9),car_ownership:Wn(.7,.9),density:Wn(.7,.9),pois:Wn(.7,.9),simd:Wn(.7,.9),stats19:Wn(.7,.9)}[Ie]}function Y(){t(17,T=null),L.clear(),t(5,L),t(6,D=[]),t(18,z=null),t(7,I=null)}const _e=()=>Ot(an,n={mode:"pick-neighbourhood"},n);function ze(Ie){w=Ie,t(4,w)}const ee=()=>t(0,y="choose-area"),ae=()=>t(0,y="draw-area");function Ee(Ie){D=Ie,t(6,D)}function we(Ie){R=Ie,t(1,R)}const it=()=>N(Er(I)),Ge=()=>Ot(an,n={mode:"pick-neighbourhood"},n);return r.$$.update=()=>{if(r.$$.dirty[0]&524290){let Ie=null;if(R&&R.geometry.coordinates[0].length>3){let De={type:"FeatureCollection",features:[R]};try{Ie=i.generateMergedBoundary(De)}catch(Ct){console.log(`error merging boundaries: ${Ct}`)}}t(18,z=Ie)}r.$$.dirty[0]&393217&&(y=="draw-area"?t(7,I=z):t(7,I=T))},[y,R,p,g,w,L,D,I,n,a,d,F,N,W,se,J,Y,T,z,i,_e,ze,ee,ae,Ee,we,it,Ge]}class F6 extends It{constructor(e){super(),Et(this,e,$6,R6,xt,{},null,[-1,-1])}}function B6(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function O6(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function N6(r){let e,t,n,i,o,u,a,d,p,g,y;return o=new Rn({props:{$$slots:{default:[B6]},$$scope:{ctx:r}}}),o.$on("click",$o),d=new Rn({props:{$$slots:{default:[O6]},$$scope:{ctx:r}}}),d.$on("click",r[11]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),de(o.$$.fragment),u=oe(),a=U("li"),de(d.$$.fragment),p=oe(),g=U("li"),g.textContent="Explore origin/destination demand data",ue(t,"aria-label","breadcrumb"),ue(e,"slot","top")},m(w,T){q(w,e,T),$(e,t),$(t,n),$(n,i),he(o,i,null),$(n,u),$(n,a),he(d,a,null),$(n,p),$(n,g),y=!0},p(w,T){const L={};T&32768&&(L.$$scope={dirty:T,ctx:w}),o.$set(L);const D={};T&32768&&(D.$$scope={dirty:T,ctx:w}),d.$set(D)},i(w){y||(j(o.$$.fragment,w),j(d.$$.fragment,w),y=!0)},o(w){G(o.$$.fragment,w),G(d.$$.fragment,w),y=!1},d(w){w&&V(e),fe(o),fe(d)}}}function j6(r){let e;return{c(){e=U("p"),e.textContent="Hover on a zone"},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function U6(r){let e,t=r[6].properties.name+"",n,i,o,u,a=r[6].properties.sum_from.toLocaleString()+"",d,p,g,y,w=r[6].properties.sum_to.toLocaleString()+"",T,L,D,R,z=r[6].properties.counts_from[r[3]]+"",I;return{c(){e=U("u"),n=xe(t),i=oe(),o=U("p"),u=xe("Total trips from here: "),d=xe(a),p=oe(),g=U("p"),y=xe("Total trips to here: "),T=xe(w),L=oe(),D=U("p"),R=xe("Total intra-zonal trips starting and ending here: "),I=xe(z)},m(F,N){q(F,e,N),$(e,n),q(F,i,N),q(F,o,N),$(o,u),$(o,d),q(F,p,N),q(F,g,N),$(g,y),$(g,T),q(F,L,N),q(F,D,N),$(D,R),$(D,I)},p(F,N){N&64&&t!==(t=F[6].properties.name+"")&&St(n,t),N&64&&a!==(a=F[6].properties.sum_from.toLocaleString()+"")&&St(d,a),N&64&&w!==(w=F[6].properties.sum_to.toLocaleString()+"")&&St(T,w),N&72&&z!==(z=F[6].properties.counts_from[F[3]]+"")&&St(I,z)},d(F){F&&(V(e),V(i),V(o),V(p),V(g),V(L),V(D))}}}function V6(r){let e,t,n,i,o,u=r[0].features.length.toLocaleString()+"",a,d,p,g,y,w,T,L,D,R,z=r[1]?"from":"to",I,F,N=r[3]==null?"each zone":"this zone",W,se,J,Y,_e,ze,ee,ae,Ee,we;t=new Ys({}),t.$on("click",r[9]),Y=new Fo({props:{colorScale:Xf,labels:{limits:r[5]}}});function it(De,Ct){return De[6]&&De[3]!=null?U6:j6}let Ge=it(r),Ie=Ge(r);return{c(){e=U("div"),de(t.$$.fragment),n=oe(),i=U("p"),o=xe("Trips begin and end in "),a=xe(u),d=xe(" zones"),p=oe(),g=U("label"),y=xe(`Trips from
      `),w=U("input"),T=xe(`
      Trips to`),L=oe(),D=U("p"),R=xe("Trips "),I=xe(z),F=oe(),W=xe(N),se=xe(":"),J=oe(),de(Y.$$.fragment),_e=oe(),ze=U("hr"),ee=oe(),Ie.c(),ue(w,"type","checkbox"),ue(w,"role","switch"),ue(e,"slot","sidebar")},m(De,Ct){q(De,e,Ct),he(t,e,null),$(e,n),$(e,i),$(i,o),$(i,a),$(i,d),$(e,p),$(e,g),$(g,y),$(g,w),w.checked=r[1],$(g,T),$(e,L),$(e,D),$(D,R),$(D,I),$(D,F),$(D,W),$(D,se),$(e,J),he(Y,e,null),$(e,_e),$(e,ze),$(e,ee),Ie.m(e,null),ae=!0,Ee||(we=yt(w,"change",r[10]),Ee=!0)},p(De,Ct){(!ae||Ct&1)&&u!==(u=De[0].features.length.toLocaleString()+"")&&St(a,u),Ct&2&&(w.checked=De[1]),(!ae||Ct&2)&&z!==(z=De[1]?"from":"to")&&St(I,z),(!ae||Ct&8)&&N!==(N=De[3]==null?"each zone":"this zone")&&St(W,N);const nt={};Ct&32&&(nt.labels={limits:De[5]}),Y.$set(nt),Ge===(Ge=it(De))&&Ie?Ie.p(De,Ct):(Ie.d(1),Ie=Ge(De),Ie&&(Ie.c(),Ie.m(e,null)))},i(De){ae||(j(t.$$.fragment,De),j(Y.$$.fragment,De),ae=!0)},o(De){G(t.$$.fragment,De),G(Y.$$.fragment,De),ae=!1},d(De){De&&V(e),fe(t),fe(Y),Ie.d(),Ee=!1,we()}}}function q6(r){let e,t,n,i,o;const u=[dn("debug-demand-fill"),{paint:{"fill-color":r[4],"fill-opacity":Wn(.5,.1)}},{manageHoverState:!0}];function a(y){r[8](y)}let d={};for(let y=0;y<u.length;y+=1)d=Gt(d,u[y]);r[2]!==void 0&&(d.hovered=r[2]),e=new Pi({props:d}),un.push(()=>Cn(e,"hovered",a));const p=[dn("debug-demand-outline"),{paint:{"line-width":2,"line-color":"black"}}];let g={};for(let y=0;y<p.length;y+=1)g=Gt(g,p[y]);return i=new tr({props:g}),{c(){de(e.$$.fragment),n=oe(),de(i.$$.fragment)},m(y,w){he(e,y,w),q(y,n,w),he(i,y,w),o=!0},p(y,w){const T=w&16?Zn(u,[u[0],{paint:{"fill-color":y[4],"fill-opacity":Wn(.5,.1)}},u[2]]):{};!t&&w&4&&(t=!0,T.hovered=y[2],Sn(()=>t=!1)),e.$set(T);const L={};i.$set(L)},i(y){o||(j(e.$$.fragment,y),j(i.$$.fragment,y),o=!0)},o(y){G(e.$$.fragment,y),G(i.$$.fragment,y),o=!1},d(y){y&&V(n),fe(e,y),fe(i,y)}}}function Z6(r){let e,t,n;return t=new dr({props:{data:r[0],generateId:!0,$$slots:{default:[q6]},$$scope:{ctx:r}}}),{c(){e=U("div"),de(t.$$.fragment),ue(e,"slot","map")},m(i,o){q(i,e,o),he(t,e,null),n=!0},p(i,o){const u={};o&1&&(u.data=i[0]),o&32788&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&V(e),fe(t)}}}function G6(r){let e,t;return e=new _o({props:{$$slots:{map:[Z6],sidebar:[V6],top:[N6]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,[i]){const o={};i&33023&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function H6(r,e,t){let n,i,o,u,a,d;st(r,an,I=>t(7,a=I)),st(r,Ir,I=>t(12,d=I));let p=Hi();try{p=d.getDemandModel()}catch{window.alert("No demand model for this area"),Ot(an,a={mode:"pick-neighbourhood"},a)}let g=!1,y=null;function w(I,F){if(I==null){let N=F?"sum_to":"sum_from",W=Math.max(...p.features.map(J=>J.properties[N])),se=T(W);return[se,so(["get",N],se,Xf)]}else{let N=F?"counts_to":"counts_from",W=[...p.features.map(Y=>Y.properties[N][I])],se=Math.max(...W),J=T(se);return[J,so(["at",["id"],["literal",W]],J,Xf)]}}function T(I){let F=Xf.length+1;return Array.from(Array(F).keys()).map(N=>Math.round(I/(F-1)*N))}function L(I){y=I,t(2,y)}const D=()=>Ot(an,a={mode:"predict-impact"},a);function R(){g=this.checked,t(1,g)}const z=()=>Ot(an,a={mode:"pick-neighbourhood"},a);return r.$$.update=()=>{r.$$.dirty&4&&t(3,n=y==null?null:y.id),r.$$.dirty&9&&t(6,i=n!=null?p.features[n]:null),r.$$.dirty&10&&t(5,[o,u]=w(n,g),o,(t(4,u),t(3,n),t(1,g),t(2,y)))},[p,g,y,n,u,o,i,a,L,D,R,z]}class W6 extends It{constructor(e){super(),Et(this,e,H6,G6,xt,{})}}function K6(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function X6(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function J6(r){let e,t,n,i,o,u,a,d,p,g,y;return o=new Rn({props:{$$slots:{default:[K6]},$$scope:{ctx:r}}}),o.$on("click",$o),d=new Rn({props:{$$slots:{default:[X6]},$$scope:{ctx:r}}}),d.$on("click",r[9]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),de(o.$$.fragment),u=oe(),a=U("li"),de(d.$$.fragment),p=oe(),g=U("li"),g.textContent="Debug intersections",ue(t,"aria-label","breadcrumb"),ue(e,"slot","top")},m(w,T){q(w,e,T),$(e,t),$(t,n),$(n,i),he(o,i,null),$(n,u),$(n,a),he(d,a,null),$(n,p),$(n,g),y=!0},p(w,T){const L={};T&1024&&(L.$$scope={dirty:T,ctx:w}),o.$set(L);const D={};T&1024&&(D.$$scope={dirty:T,ctx:w}),d.$set(D)},i(w){y||(j(o.$$.fragment,w),j(d.$$.fragment,w),y=!0)},o(w){G(o.$$.fragment,w),G(d.$$.fragment,w),y=!1},d(w){w&&V(e),fe(o),fe(d)}}}function c1(r){let e,t,n,i,o,u,a;function d(g){r[8](g)}let p={list:r[1].features};return r[2]!==void 0&&(p.idx=r[2]),n=new wd({props:p}),un.push(()=>Cn(n,"idx",d)),{c(){e=U("button"),e.textContent="Pick another intersection",t=oe(),de(n.$$.fragment),ue(e,"class","secondary")},m(g,y){q(g,e,y),q(g,t,y),he(n,g,y),o=!0,u||(a=yt(e,"click",r[7]),u=!0)},p(g,y){const w={};y&2&&(w.list=g[1].features),!i&&y&4&&(i=!0,w.idx=g[2],Sn(()=>i=!1)),n.$set(w)},i(g){o||(j(n.$$.fragment,g),o=!0)},o(g){G(n.$$.fragment,g),o=!1},d(g){g&&(V(e),V(t)),fe(n,g),u=!1,a()}}}function u1(r){let e,t;return{c(){e=U("a"),t=xe("Open OSM"),ue(e,"href",r[0]),ue(e,"target","_blank")},m(n,i){q(n,e,i),$(e,t)},p(n,i){i&1&&ue(e,"href",n[0])},d(n){n&&V(e)}}}function Y6(r){let e,t,n,i,o,u,a;t=new Ys({}),t.$on("click",r[6]);let d=r[1].features.length>0&&c1(r),p=r[0]&&u1(r);return{c(){e=U("div"),de(t.$$.fragment),n=oe(),i=U("p"),i.textContent="Purple intersections have some kind of turn restriction.",o=oe(),d&&d.c(),u=oe(),p&&p.c(),ue(e,"slot","sidebar")},m(g,y){q(g,e,y),he(t,e,null),$(e,n),$(e,i),$(e,o),d&&d.m(e,null),$(e,u),p&&p.m(e,null),a=!0},p(g,y){g[1].features.length>0?d?(d.p(g,y),y&2&&j(d,1)):(d=c1(g),d.c(),j(d,1),d.m(e,u)):d&&(tn(),G(d,1,1,()=>{d=null}),nn()),g[0]?p?p.p(g,y):(p=u1(g),p.c(),p.m(e,null)):p&&(p.d(1),p=null)},i(g){a||(j(t.$$.fragment,g),j(d),a=!0)},o(g){G(t.$$.fragment,g),G(d),a=!1},d(g){g&&V(e),fe(t),d&&d.d(),p&&p.d()}}}function Q6(r){let e,t;const n=[dn("debug-intersections"),{paint:{"circle-radius":15,"circle-color":["case",["get","has_turn_restrictions"],"purple","black"]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new _l({props:i}),e.$on("click",r[5]),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function eL(r){let e,t,n,i;const o=[dn("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let u={};for(let p=0;p<o.length;p+=1)u=Gt(u,o[p]);e=new tr({props:u});const a=[dn("debug-movements-fill"),{filter:["==",["id"],r[2]]},{paint:{"fill-color":"cyan"}}];let d={};for(let p=0;p<a.length;p+=1)d=Gt(d,a[p]);return n=new Pi({props:d}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment)},m(p,g){he(e,p,g),q(p,t,g),he(n,p,g),i=!0},p(p,g){const y={};e.$set(y);const w=g&4?Zn(a,[a[0],{filter:["==",["id"],p[2]]},a[2]]):{};n.$set(w)},i(p){i||(j(e.$$.fragment,p),j(n.$$.fragment,p),i=!0)},o(p){G(e.$$.fragment,p),G(n.$$.fragment,p),i=!1},d(p){p&&V(t),fe(e,p),fe(n,p)}}}function tL(r){let e,t,n,i,o;return t=new dr({props:{data:Er(r[3]).getAllIntersections(),generateId:!0,$$slots:{default:[Q6]},$$scope:{ctx:r}}}),i=new dr({props:{data:r[1],generateId:!0,$$slots:{default:[eL]},$$scope:{ctx:r}}}),{c(){e=U("div"),de(t.$$.fragment),n=oe(),de(i.$$.fragment),ue(e,"slot","map")},m(u,a){q(u,e,a),he(t,e,null),$(e,n),he(i,e,null),o=!0},p(u,a){const d={};a&8&&(d.data=Er(u[3]).getAllIntersections()),a&1024&&(d.$$scope={dirty:a,ctx:u}),t.$set(d);const p={};a&2&&(p.data=u[1]),a&1028&&(p.$$scope={dirty:a,ctx:u}),i.$set(p)},i(u){o||(j(t.$$.fragment,u),j(i.$$.fragment,u),o=!0)},o(u){G(t.$$.fragment,u),G(i.$$.fragment,u),o=!1},d(u){u&&V(e),fe(t),fe(i)}}}function nL(r){let e,t;return e=new _o({props:{$$slots:{map:[tL],sidebar:[Y6],top:[J6]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,[i]){const o={};i&1055&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function rL(r,e,t){let n,i;st(r,Ir,T=>t(3,n=T)),st(r,an,T=>t(4,i=T));let o=null,u=Hi(),a=0;function d(T){t(0,o=T.detail.features[0].properties.osm),t(1,u=n.getMovements(T.detail.features[0].id)),t(2,a=0)}const p=()=>Ot(an,i={mode:"pick-neighbourhood"},i),g=()=>t(1,u=Hi());function y(T){a=T,t(2,a)}return[o,u,a,n,i,d,p,g,y,()=>Ot(an,i={mode:"pick-neighbourhood"},i)]}class iL extends It{constructor(e){super(),Et(this,e,rL,nL,xt,{})}}function oL(r){let e,t,n,i,o,u;const a=[dn("cells"),{filter:["==",["get","kind"],"cell"]},{layout:{visibility:r[0]=="cells"?"none":"visible"}},{paint:{"fill-color":["get","color"],"fill-opacity":.5,"fill-outline-color":"hsla(0, 0%, 0%, 0.3)"}}];let d={};for(let T=0;T<a.length;T+=1)d=Gt(d,a[T]);e=new Pi({props:d});const p=[dn("border-arrows"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"fill-color":["get","color"]}},{minzoom:14}];let g={};for(let T=0;T<p.length;T+=1)g=Gt(g,p[T]);n=new Pi({props:g});const y=[dn("border-arrow-outlines"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"line-color":"black","line-width":2}},{minzoom:14}];let w={};for(let T=0;T<y.length;T+=1)w=Gt(w,y[T]);return o=new tr({props:w}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment),i=oe(),de(o.$$.fragment)},m(T,L){he(e,T,L),q(T,t,L),he(n,T,L),q(T,i,L),he(o,T,L),u=!0},p(T,[L]){const D=L&1?Zn(a,[a[0],a[1],{layout:{visibility:T[0]=="cells"?"none":"visible"}},a[3]]):{};e.$set(D);const R={};n.$set(R);const z={};o.$set(z)},i(T){u||(j(e.$$.fragment,T),j(n.$$.fragment,T),j(o.$$.fragment,T),u=!0)},o(T){G(e.$$.fragment,T),G(n.$$.fragment,T),G(o.$$.fragment,T),u=!1},d(T){T&&(V(t),V(i)),fe(e,T),fe(n,T),fe(o,T)}}}function sL(r,e,t){let n;return st(r,cd,i=>t(0,n=i)),[n]}class Ld extends It{constructor(e){super(),Et(this,e,sL,oL,xt,{})}}function aL(r){let e,t;const n=[dn("neighbourhood-boundary"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":.3}}];let i={};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new Pi({props:i}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,[u]){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}class Ed extends It{constructor(e){super(),Et(this,e,null,aL,xt,{})}}const lL=r=>({}),h1=r=>({}),cL=r=>({}),f1=r=>({});function d1(r){let e;const t=r[7]["line-popup"],n=En(t,r,r[10],f1);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&1024)&&An(n,t,i,i[10],e?In(t,i[10],o,cL):Pn(i[10]),f1)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function uL(r){let e,t,n=r[0]&&d1(r);return{c(){n&&n.c(),e=Jn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o&1&&j(n,1)):(n=d1(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),G(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){G(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function p1(r){let e;const t=r[7]["line-popup"],n=En(t,r,r[10],h1);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&1024)&&An(n,t,i,i[10],e?In(t,i[10],o,lL):Pn(i[10]),h1)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function hL(r){let e,t,n=r[0]&&p1(r);return{c(){n&&n.c(),e=Jn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o&1&&j(n,1)):(n=p1(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),G(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){G(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function fL(r){let e,t,n,i,o,u,a,d;const p=[dn("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,1),"line-color":"black"}},{minzoom:13}];let g={};for(let z=0;z<p.length;z+=1)g=Gt(g,p[z]);e=new tr({props:g});const y=[dn("interior-roads",!1),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":r[5](r[3],r[4].maxShortcuts),"line-opacity":Wn(1,.5)}},{layout:{"line-sort-key":["get","shortcuts"]}},{minzoom:13},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let w={$$slots:{default:[uL]},$$scope:{ctx:r}};for(let z=0;z<y.length;z+=1)w=Gt(w,y[z]);n=new tr({props:w}),n.$on("click",r[8]);const T=[dn("main-roads-outlines"),{filter:["==",["get","kind"],"main_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,6),"line-color":"black"}},{minzoom:13}];let L={};for(let z=0;z<T.length;z+=1)L=Gt(L,T[z]);o=new tr({props:L});const D=[dn("main-roads",!1),{filter:["==",["get","kind"],"main_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,4),"line-color":Wn("gray",po.mapFeature.hover.backgroundColor),"line-opacity":Wn(1,.5)}},{layout:{"line-sort-key":["get","shortcuts"]}},{minzoom:13},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let R={$$slots:{default:[hL]},$$scope:{ctx:r}};for(let z=0;z<D.length;z+=1)R=Gt(R,D[z]);return a=new tr({props:R}),a.$on("click",r[9]),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment),i=oe(),de(o.$$.fragment),u=oe(),de(a.$$.fragment)},m(z,I){he(e,z,I),q(z,t,I),he(n,z,I),q(z,i,I),he(o,z,I),q(z,u,I),he(a,z,I),d=!0},p(z,[I]){const F=I&84?Zn(p,[p[0],p[1],{paint:{"line-width":z[6](z[2],z[4].maxShortcuts,1),"line-color":"black"}},p[3]]):{};e.$set(F);const N=I&125?Zn(y,[y[0],y[1],I&124&&{paint:{"line-width":z[6](z[2],z[4].maxShortcuts,0),"line-color":z[5](z[3],z[4].maxShortcuts),"line-opacity":Wn(1,.5)}},y[3],y[4],I&1&&{manageHoverState:z[0]},I&1&&{hoverCursor:z[0]?"pointer":void 0}]):{};I&1025&&(N.$$scope={dirty:I,ctx:z}),n.$set(N);const W=I&84?Zn(T,[T[0],T[1],{paint:{"line-width":z[6](z[2],z[4].maxShortcuts,6),"line-color":"black"}},T[3]]):{};o.$set(W);const se=I&85?Zn(D,[D[0],D[1],I&84&&{paint:{"line-width":z[6](z[2],z[4].maxShortcuts,4),"line-color":Wn("gray",po.mapFeature.hover.backgroundColor),"line-opacity":Wn(1,.5)}},D[3],D[4],I&1&&{manageHoverState:z[0]},I&1&&{hoverCursor:z[0]?"pointer":void 0}]):{};I&1025&&(se.$$scope={dirty:I,ctx:z}),a.$set(se)},i(z){d||(j(e.$$.fragment,z),j(n.$$.fragment,z),j(o.$$.fragment,z),j(a.$$.fragment,z),d=!0)},o(z){G(e.$$.fragment,z),G(n.$$.fragment,z),G(o.$$.fragment,z),G(a.$$.fragment,z),d=!1},d(z){z&&(V(t),V(i),V(u)),fe(e,z),fe(n,z),fe(o,z),fe(a,z)}}}function dL(r,e,t){let n,i;st(r,im,L=>t(2,n=L)),st(r,cd,L=>t(3,i=L));let{$$slots:o={},$$scope:u}=e,a=xh("neighbourhoodGj"),{interactive:d=!0}=e,{onClickLine:p=(L,D)=>{}}=e;function g(L,D){return L=="cells"?["get","color"]:L=="edits"?Wn(["case",["get","edited"],pS,"white"],po.mapFeature.hover.backgroundColor):L=="speeds"?so(["get","speed_mph"],lv,av):D<=2?Wn("white","blue"):(console.assert(L=="shortcuts"),Wn(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",D,"#A32015"],po.mapFeature.hover.backgroundColor))}function y(L,D,R){return!L||D<=2?Us(R):["interpolate",["linear"],["get","shortcuts"],0,5+R,D,25+R]}const w=L=>d&&p(L.detail.features[0],L.detail.event.lngLat),T=L=>d&&p(L.detail.features[0],L.detail.event.lngLat);return r.$$set=L=>{"interactive"in L&&t(0,d=L.interactive),"onClickLine"in L&&t(1,p=L.onClickLine),"$$scope"in L&&t(10,u=L.$$scope)},[d,p,n,i,a,g,y,o,w,T,u]}class Eh extends It{constructor(e){super(),Et(this,e,dL,fL,xt,{interactive:0,onClickLine:1})}}function pL(r){let e;const t=r[7].default,n=En(t,r,r[9],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&512)&&An(n,t,i,i[9],e?In(t,i[9],o,null):Pn(i[9]),null)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function mL(r){let e,t,n;const i=[dn("turn-restrictions"),{minzoom:13},{filter:r[4]?void 0:["get","edited"]},{layout:{"icon-image":["concat","no_",["get","kind"],"_turn"],"icon-rotate":["get","icon_angle"],"icon-allow-overlap":!0,"icon-size":.05}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];function o(a){r[8](a)}let u={$$slots:{default:[pL]},$$scope:{ctx:r}};for(let a=0;a<i.length;a+=1)u=Gt(u,i[a]);return r[1]!==void 0&&(u.hovered=r[1]),e=new ph({props:u}),un.push(()=>Cn(e,"hovered",o)),e.$on("click",function(){zc(r[0])&&r[0].apply(this,arguments)}),{c(){de(e.$$.fragment)},m(a,d){he(e,a,d),n=!0},p(a,d){r=a;const p=d&16?Zn(i,[i[0],i[1],{filter:r[4]?void 0:["get","edited"]},i[3],i[4]]):{};d&512&&(p.$$scope={dirty:d,ctx:r}),!t&&d&2&&(t=!0,p.hovered=r[1],Sn(()=>t=!1)),e.$set(p)},i(a){n||(j(e.$$.fragment,a),n=!0)},o(a){G(e.$$.fragment,a),n=!1},d(a){fe(e,a)}}}function _L(r){let e,t;const n=[dn("turn-restrictions-debug-arrows"),{interactive:!1},{paint:{"line-width":4,"line-color":"red"}}];let i={};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new tr({props:i}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function gL(r){let e,t,n,i;return e=new dr({props:{data:r[2],generateId:!0,$$slots:{default:[mL]},$$scope:{ctx:r}}}),n=new dr({props:{data:r[3],$$slots:{default:[_L]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment)},m(o,u){he(e,o,u),q(o,t,u),he(n,o,u),i=!0},p(o,[u]){const a={};u&4&&(a.data=o[2]),u&531&&(a.$$scope={dirty:u,ctx:o}),e.$set(a);const d={};u&8&&(d.data=o[3]),u&512&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(j(e.$$.fragment,o),j(n.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),G(n.$$.fragment,o),i=!1},d(o){o&&V(t),fe(e,o),fe(n,o)}}}function yL(r,e,t){let n,i,o,u,a;st(r,Ir,T=>t(5,o=T)),st(r,io,T=>t(6,u=T)),st(r,ld,T=>t(4,a=T));let{$$slots:d={},$$scope:p}=e,{onClickTurnRestriction:g=()=>{}}=e,y=null;function w(T){y=T,t(1,y)}return r.$$set=T=>{"onClickTurnRestriction"in T&&t(0,g=T.onClickTurnRestriction),"$$scope"in T&&t(9,p=T.$$scope)},r.$$.update=()=>{r.$$.dirty&2&&t(3,n=y==null?Hi():{type:"FeatureCollection",features:[{type:"Feature",geometry:JSON.parse(y.properties.from_geometry),properties:{}},{type:"Feature",geometry:JSON.parse(y.properties.to_geometry),properties:{}}]}),r.$$.dirty&96&&t(2,i=u>0?o.renderTurnRestrictions():Hi())},[g,y,i,n,a,o,u,d,w,p]}class bL extends It{constructor(e){super(),Et(this,e,yL,gL,xt,{onClickTurnRestriction:0})}}const vL=r=>({}),m1=r=>({}),wL=r=>({}),_1=r=>({});function xL(r){let e;const t=r[6]["modal-filter"],n=En(t,r,r[7],_1);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&128)&&An(n,t,i,i[7],e?In(t,i[7],o,wL):Pn(i[7]),_1)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function kL(r){let e,t,n,i;const o=[dn("modal-filters"),{filter:["all",["!=",["get","filter_kind"],"diagonal_filter"],r[3]?["literal",!0]:["get","edited"]]},{minzoom:Vf},{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let u={$$slots:{default:[xL]},$$scope:{ctx:r}};for(let p=0;p<o.length;p+=1)u=Gt(u,o[p]);e=new ph({props:u}),e.$on("click",function(){zc(r[0])&&r[0].apply(this,arguments)});const a=[dn("intersection-filters"),{filter:["==",["get","filter_kind"],"diagonal_filter"]},{minzoom:Vf},{layout:{"icon-image":"diagonal_filter","icon-rotate":["get","angle",["get","filter"]],"icon-allow-overlap":!0,"icon-size":.07}},{interactive:!1}];let d={};for(let p=0;p<a.length;p+=1)d=Gt(d,a[p]);return n=new ph({props:d}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment)},m(p,g){he(e,p,g),q(p,t,g),he(n,p,g),i=!0},p(p,g){r=p;const y=g&8?Zn(o,[o[0],g&8&&{filter:["all",["!=",["get","filter_kind"],"diagonal_filter"],r[3]?["literal",!0]:["get","edited"]]},g&0&&{minzoom:Vf},o[3],o[4]]):{};g&128&&(y.$$scope={dirty:g,ctx:r}),e.$set(y);const w=g&0?Zn(a,[a[0],a[1],{minzoom:Vf},a[3],a[4]]):{};n.$set(w)},i(p){i||(j(e.$$.fragment,p),j(n.$$.fragment,p),i=!0)},o(p){G(e.$$.fragment,p),G(n.$$.fragment,p),i=!1},d(p){p&&V(t),fe(e,p),fe(n,p)}}}function SL(r){let e;const t=r[6]["turn-restriction"],n=En(t,r,r[7],m1);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&128)&&An(n,t,i,i[7],e?In(t,i[7],o,vL):Pn(i[7]),m1)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function CL(r){let e,t,n,i;return e=new dr({props:{data:r[2],generateId:!0,$$slots:{default:[kL]},$$scope:{ctx:r}}}),n=new bL({props:{onClickTurnRestriction:r[1],$$slots:{default:[SL]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment)},m(o,u){he(e,o,u),q(o,t,u),he(n,o,u),i=!0},p(o,[u]){const a={};u&4&&(a.data=o[2]),u&137&&(a.$$scope={dirty:u,ctx:o}),e.$set(a);const d={};u&2&&(d.onClickTurnRestriction=o[1]),u&128&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(j(e.$$.fragment,o),j(n.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),G(n.$$.fragment,o),i=!1},d(o){o&&V(t),fe(e,o),fe(n,o)}}}let Vf=13;function TL(r,e,t){let n,i,o,u;st(r,Ir,y=>t(4,i=y)),st(r,io,y=>t(5,o=y)),st(r,ld,y=>t(3,u=y));let{$$slots:a={},$$scope:d}=e,{onClickModalFilter:p=()=>{}}=e,{onClickTurnRestriction:g=()=>{}}=e;return r.$$set=y=>{"onClickModalFilter"in y&&t(0,p=y.onClickModalFilter),"onClickTurnRestriction"in y&&t(1,g=y.onClickTurnRestriction),"$$scope"in y&&t(7,d=y.$$scope)},r.$$.update=()=>{r.$$.dirty&48&&t(2,n=o>0?i.renderModalFilters():Hi())},[p,g,n,u,i,o,a,d]}class Ra extends It{constructor(e){super(),Et(this,e,TL,CL,xt,{onClickModalFilter:0,onClickTurnRestriction:1})}}function ML(r){let e,t;const n=[dn("one-ways"),{filter:["all",["in",["get","kind"],["literal",["interior_road","main_road"]]],["!=",["get","travel_flow"],"both"]]},{layout:{"icon-image":"oneway_arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","travel_flow"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","travel_flow_edited"],1,.5]}},{minzoom:13},{interactive:!1},{hoverCursor:"pointer"}];let i={};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new ph({props:i}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,[u]){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}class Id extends It{constructor(e){super(),Et(this,e,null,ML,xt,{})}}function LL(r){let e;const t=r[3].default,n=En(t,r,r[4],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16)&&An(n,t,i,i[4],e?In(t,i[4],o,null):Pn(i[4]),null)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function EL(r){let e,t;return e=new dr({props:{data:r[0],generateId:!0,$$slots:{default:[LL]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&16&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function IL(r,e,t){let n,i;st(r,Ir,d=>t(2,i=d));let{$$slots:o={},$$scope:u}=e,{input:a=null}=e;return r.$$set=d=>{"input"in d&&t(1,a=d.input),"$$scope"in d&&t(4,u=d.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&t(0,n=a||i.renderNeighbourhood()),r.$$.dirty&1&&md("neighbourhoodGj",n)},[n,a,i,o,u]}class Ih extends It{constructor(e){super(),Et(this,e,IL,EL,xt,{input:1})}}function AL(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function PL(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function zL(r){let e;return{c(){e=xe("Editing")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function DL(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L;return o=new Rn({props:{$$slots:{default:[AL]},$$scope:{ctx:r}}}),o.$on("click",$o),d=new Rn({props:{$$slots:{default:[PL]},$$scope:{ctx:r}}}),d.$on("click",r[8]),y=new Rn({props:{$$slots:{default:[zL]},$$scope:{ctx:r}}}),y.$on("click",r[9]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),de(o.$$.fragment),u=oe(),a=U("li"),de(d.$$.fragment),p=oe(),g=U("li"),de(y.$$.fragment),w=oe(),T=U("li"),T.textContent="Debug mode",ue(t,"aria-label","breadcrumb"),ue(e,"slot","top")},m(D,R){q(D,e,R),$(e,t),$(t,n),$(n,i),he(o,i,null),$(n,u),$(n,a),he(d,a,null),$(n,p),$(n,g),he(y,g,null),$(n,w),$(n,T),L=!0},p(D,R){const z={};R&2048&&(z.$$scope={dirty:R,ctx:D}),o.$set(z);const I={};R&2048&&(I.$$scope={dirty:R,ctx:D}),d.$set(I);const F={};R&2048&&(F.$$scope={dirty:R,ctx:D}),y.$set(F)},i(D){L||(j(o.$$.fragment,D),j(d.$$.fragment,D),j(y.$$.fragment,D),L=!0)},o(D){G(o.$$.fragment,D),G(d.$$.fragment,D),G(y.$$.fragment,D),L=!1},d(D){D&&V(e),fe(o),fe(d),fe(y)}}}function g1(r){let e,t,n;return{c(){e=U("button"),e.textContent="",ue(e,"class","close-btn svelte-khnvno")},m(i,o){q(i,e,o),t||(n=yt(e,"click",r[6]),t=!0)},p:rt,d(i){i&&V(e),t=!1,n()}}}function RL(r){let e;return{c(){e=U("p"),e.textContent="Click an intersection to inspect its movements."},m(t,n){q(t,e,n)},p:rt,i:rt,o:rt,d(t){t&&V(e)}}}function $L(r){let e,t,n,i,o,u,a;e=new Sh({props:{properties:r[0].feature.properties}});function d(g){r[7](g)}let p={list:r[0].movements.features};return r[0].movementIdx!==void 0&&(p.idx=r[0].movementIdx),o=new wd({props:p}),un.push(()=>Cn(o,"idx",d)),{c(){de(e.$$.fragment),t=oe(),n=U("h5"),n.textContent="Turn restrictions:",i=oe(),de(o.$$.fragment)},m(g,y){he(e,g,y),q(g,t,y),q(g,n,y),q(g,i,y),he(o,g,y),a=!0},p(g,y){const w={};y&1&&(w.properties=g[0].feature.properties),e.$set(w);const T={};y&1&&(T.list=g[0].movements.features),!u&&y&1&&(u=!0,T.idx=g[0].movementIdx,Sn(()=>u=!1)),o.$set(T)},i(g){a||(j(e.$$.fragment,g),j(o.$$.fragment,g),a=!0)},o(g){G(e.$$.fragment,g),G(o.$$.fragment,g),a=!1},d(g){g&&(V(t),V(n),V(i)),fe(e,g),fe(o,g)}}}function FL(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L;t=new Ys({}),t.$on("click",r[5]);let D=r[0]&&g1(r);const R=[$L,RL],z=[];function I(F,N){return F[0]?0:1}return w=I(r),T=z[w]=R[w](r),{c(){e=U("div"),de(t.$$.fragment),n=oe(),i=U("h4"),i.textContent="Roads",o=oe(),u=U("p"),u.textContent="Click a road to visit its OSM object.",a=oe(),d=U("div"),p=U("h4"),p.textContent="Intersections",g=oe(),D&&D.c(),y=oe(),T.c(),ut(d,"display","flex"),ut(d,"align-items","start"),ut(d,"justify-content","space-between"),ue(e,"slot","sidebar")},m(F,N){q(F,e,N),he(t,e,null),$(e,n),$(e,i),$(e,o),$(e,u),$(e,a),$(e,d),$(d,p),$(d,g),D&&D.m(d,null),$(e,y),z[w].m(e,null),L=!0},p(F,N){F[0]?D?D.p(F,N):(D=g1(F),D.c(),D.m(d,null)):D&&(D.d(1),D=null);let W=w;w=I(F),w===W?z[w].p(F,N):(tn(),G(z[W],1,1,()=>{z[W]=null}),nn(),T=z[w],T?T.p(F,N):(T=z[w]=R[w](F),T.c()),j(T,1),T.m(e,null))},i(F){L||(j(t.$$.fragment,F),j(T),L=!0)},o(F){G(t.$$.fragment,F),G(T),L=!1},d(F){F&&V(e),fe(t),D&&D.d(),z[w].d()}}}function BL(r){let e,t;return e=new Sh({props:{properties:r[10]}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.properties=n[10]),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function OL(r){let e,t;return e=new fi({props:{openOn:"hover",$$slots:{default:[BL,({props:n})=>({10:n}),({props:n})=>n?1024:0]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&3072&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function NL(r){let e,t;return e=new Sh({props:{properties:r[10]}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.properties=n[10]),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function jL(r){let e,t,n;return t=new fi({props:{openOn:"hover",$$slots:{default:[NL,({props:i})=>({10:i}),({props:i})=>i?1024:0]},$$scope:{ctx:r}}}),{c(){e=U("div"),de(t.$$.fragment),ue(e,"slot","line-popup")},m(i,o){q(i,e,o),he(t,e,null),n=!0},p(i,o){const u={};o&3072&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&V(e),fe(t)}}}function UL(r){let e,t,n,i,o,u,a,d,p,g;e=new Ed({}),n=new Ld({}),o=new Id({});const y=[dn("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let w={$$slots:{default:[OL]},$$scope:{ctx:r}};for(let T=0;T<y.length;T+=1)w=Gt(w,y[T]);return a=new _l({props:w}),p=new Eh({props:{interactive:!0,onClickLine:r[4],$$slots:{"line-popup":[jL]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment),i=oe(),de(o.$$.fragment),u=oe(),de(a.$$.fragment),d=oe(),de(p.$$.fragment)},m(T,L){he(e,T,L),q(T,t,L),he(n,T,L),q(T,i,L),he(o,T,L),q(T,u,L),he(a,T,L),q(T,d,L),he(p,T,L),g=!0},p(T,L){const D={};L&2048&&(D.$$scope={dirty:L,ctx:T}),a.$set(D);const R={};L&2048&&(R.$$scope={dirty:L,ctx:T}),p.$set(R)},i(T){g||(j(e.$$.fragment,T),j(n.$$.fragment,T),j(o.$$.fragment,T),j(a.$$.fragment,T),j(p.$$.fragment,T),g=!0)},o(T){G(e.$$.fragment,T),G(n.$$.fragment,T),G(o.$$.fragment,T),G(a.$$.fragment,T),G(p.$$.fragment,T),g=!1},d(T){T&&(V(t),V(i),V(u),V(d)),fe(e,T),fe(n,T),fe(o,T),fe(a,T),fe(p,T)}}}function VL(r){let e,t;return e=new Sh({props:{properties:r[10]}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.properties=n[10]),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function qL(r){let e,t;return e=new fi({props:{openOn:"hover",$$slots:{default:[VL,({props:n})=>({10:n}),({props:n})=>n?1024:0]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&3072&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function ZL(r){let e,t;return e=new Sh({props:{properties:r[10]}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.properties=n[10]),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function GL(r){let e,t;return e=new fi({props:{openOn:"hover",$$slots:{default:[ZL,({props:n})=>({10:n}),({props:n})=>n?1024:0]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&3072&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function HL(r){var o,u,a;let e,t;const n=[dn("debug-intersections"),{paint:{"circle-radius":hm(30),"circle-color":po.mapFeature.hover.backgroundColor,"circle-stroke-color":po.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":Wn(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((a=(u=(o=r[0])==null?void 0:o.feature)==null?void 0:u.properties)==null?void 0:a.intersection_id)??-1],.3,Wn(0,.5)]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={$$slots:{default:[GL]},$$scope:{ctx:r}};for(let d=0;d<n.length;d+=1)i=Gt(i,n[d]);return e=new _l({props:i}),e.$on("click",r[3]),{c(){de(e.$$.fragment)},m(d,p){he(e,d,p),t=!0},p(d,p){var y,w,T;const g=p&1?Zn(n,[n[0],{paint:{"circle-radius":hm(30),"circle-color":po.mapFeature.hover.backgroundColor,"circle-stroke-color":po.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":Wn(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((T=(w=(y=d[0])==null?void 0:y.feature)==null?void 0:w.properties)==null?void 0:T.intersection_id)??-1],.3,Wn(0,.5)]}},n[2],n[3]]):{};p&2048&&(g.$$scope={dirty:p,ctx:d}),e.$set(g)},i(d){t||(j(e.$$.fragment,d),t=!0)},o(d){G(e.$$.fragment,d),t=!1},d(d){fe(e,d)}}}function y1(r){let e,t;return e=new dr({props:{data:r[0].movements,generateId:!0,$$slots:{default:[WL]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.data=n[0].movements),i&2049&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function WL(r){let e,t,n,i;const o=[dn("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let u={};for(let p=0;p<o.length;p+=1)u=Gt(u,o[p]);e=new tr({props:u});const a=[dn("debug-movements-fill"),{filter:["==",["id"],r[0].movementIdx]},{paint:{"fill-color":"cyan"}}];let d={};for(let p=0;p<a.length;p+=1)d=Gt(d,a[p]);return n=new Pi({props:d}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment)},m(p,g){he(e,p,g),q(p,t,g),he(n,p,g),i=!0},p(p,g){const y={};e.$set(y);const w=g&1?Zn(a,[a[0],{filter:["==",["id"],p[0].movementIdx]},a[2]]):{};n.$set(w)},i(p){i||(j(e.$$.fragment,p),j(n.$$.fragment,p),i=!0)},o(p){G(e.$$.fragment,p),G(n.$$.fragment,p),i=!1},d(p){p&&V(t),fe(e,p),fe(n,p)}}}function KL(r){let e,t,n,i,o,u,a,d;t=new Ih({props:{$$slots:{default:[UL]},$$scope:{ctx:r}}}),i=new Ra({props:{$$slots:{default:[qL]},$$scope:{ctx:r}}}),u=new dr({props:{data:Er(r[1]).getAllIntersections(),generateId:!0,$$slots:{default:[HL]},$$scope:{ctx:r}}});let p=r[0]&&y1(r);return{c(){e=U("div"),de(t.$$.fragment),n=oe(),de(i.$$.fragment),o=oe(),de(u.$$.fragment),a=oe(),p&&p.c(),ue(e,"slot","map")},m(g,y){q(g,e,y),he(t,e,null),$(e,n),he(i,e,null),$(e,o),he(u,e,null),$(e,a),p&&p.m(e,null),d=!0},p(g,y){const w={};y&2048&&(w.$$scope={dirty:y,ctx:g}),t.$set(w);const T={};y&2048&&(T.$$scope={dirty:y,ctx:g}),i.$set(T);const L={};y&2&&(L.data=Er(g[1]).getAllIntersections()),y&2049&&(L.$$scope={dirty:y,ctx:g}),u.$set(L),g[0]?p?(p.p(g,y),y&1&&j(p,1)):(p=y1(g),p.c(),j(p,1),p.m(e,null)):p&&(tn(),G(p,1,1,()=>{p=null}),nn())},i(g){d||(j(t.$$.fragment,g),j(i.$$.fragment,g),j(u.$$.fragment,g),j(p),d=!0)},o(g){G(t.$$.fragment,g),G(i.$$.fragment,g),G(u.$$.fragment,g),G(p),d=!1},d(g){g&&V(e),fe(t),fe(i),fe(u),p&&p.d()}}}function XL(r){let e,t;return e=new _o({props:{$$slots:{map:[KL],sidebar:[FL],top:[DL]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,[i]){const o={};i&2055&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function JL(r,e,t){let n,i;st(r,Ir,T=>t(1,n=T)),st(r,an,T=>t(2,i=T));let o=null;function u(T){let L=T.detail.features[0],D=n.getMovements(L.properties.intersection_id);t(0,o={feature:L,movements:D,movementIdx:0})}const a=(T,L)=>window.open(Er(T.properties).way,"_blank"),d=()=>Ot(an,i={mode:"neighbourhood"},i),p=()=>t(0,o=null);function g(T){r.$$.not_equal(o.movementIdx,T)&&(o.movementIdx=T,t(0,o))}return[o,n,i,u,a,d,p,g,()=>Ot(an,i={mode:"pick-neighbourhood"},i),()=>Ot(an,i={mode:"neighbourhood"},i)]}class YL extends It{constructor(e){super(),Et(this,e,JL,XL,xt,{})}}const b1="/ltn/assets/one_way_left-9368d5dd.svg",QL="/ltn/assets/traffic_1-a90740ec.svg";var To=63710088e-1,Nv={centimeters:To*100,centimetres:To*100,degrees:360/(2*Math.PI),feet:To*3.28084,inches:To*39.37,kilometers:To/1e3,kilometres:To/1e3,meters:To,metres:To,miles:To/1609.344,millimeters:To*1e3,millimetres:To*1e3,nauticalmiles:To/1852,radians:1,yards:To*1.0936};function eE(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Lm(r,e,t={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!v1(r[0])||!v1(r[1]))throw new Error("coordinates must contain numbers");return eE({type:"Point",coordinates:r},e,t)}function tE(r,e="kilometers"){const t=Nv[e];if(!t)throw new Error(e+" units is invalid");return r*t}function nE(r,e="kilometers"){const t=Nv[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Em(r){return r%(2*Math.PI)*180/Math.PI}function us(r){return r%360*Math.PI/180}function v1(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function vh(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function rE(r){return r.type==="Feature"?r.geometry:r}function jv(r,e,t={}){if(t.final===!0)return iE(r,e);const n=vh(r),i=vh(e),o=us(n[0]),u=us(i[0]),a=us(n[1]),d=us(i[1]),p=Math.sin(u-o)*Math.cos(d),g=Math.cos(a)*Math.sin(d)-Math.sin(a)*Math.cos(d)*Math.cos(u-o);return Em(Math.atan2(p,g))}function iE(r,e){let t=jv(e,r);return t=(t+180)%360,t}function oE(r,e,t,n={}){const i=vh(r),o=us(i[0]),u=us(i[1]),a=us(t),d=nE(e,n.units),p=Math.asin(Math.sin(u)*Math.cos(d)+Math.cos(u)*Math.sin(d)*Math.cos(a)),g=o+Math.atan2(Math.sin(a)*Math.sin(d)*Math.cos(u),Math.cos(d)-Math.sin(u)*Math.sin(p)),y=Em(g),w=Em(p);return Lm([y,w],n.properties)}function sE(r,e,t={}){var n=vh(r),i=vh(e),o=us(i[1]-n[1]),u=us(i[0]-n[0]),a=us(n[1]),d=us(i[1]),p=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(u/2),2)*Math.cos(a)*Math.cos(d);return tE(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),t.units)}function aE(r,e,t={}){const i=rE(r).coordinates;let o=0;for(let u=0;u<i.length&&!(e>=o&&u===i.length-1);u++)if(o>=e){const a=e-o;if(a){const d=jv(i[u],i[u-1])-180;return oE(i[u],a,d,t)}else return Lm(i[u])}else o+=sE(i[u],i[u+1],t);return Lm(i[i.length-1])}var lE=aE;function cE(r){let e,t;const n=[dn("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let i={};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new _l({props:i}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function uE(r){let e,t;return e=new dr({props:{data:r[0],$$slots:{default:[cE]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&1024&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}let hE=50,fE=100,dE=.01;function pE(r,e,t){let{paths:n}=e,i=d(),o=p(),u=y(),a=setInterval(w,fE);ti(()=>clearInterval(a));function d(){return n.features.map(T=>1/T.properties.directness).reduce((T,L)=>T+L,0)}function p(){return n.features.length==0?[]:Array.from({length:hE},g)}function g(){let T=Math.random()*i,L=0;for(let[D,R]of n.features.entries())if(L+=1/R.properties.directness,T<L)return{idx:D,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${i}`)}function y(){return{type:"FeatureCollection",features:o.map(({idx:T,distance:L})=>lE(n.features[T],L,{units:"kilometers"}))}}function w(){for(let[T,L]of o.entries())L.distance+=dE,L.distance>=n.features[L.idx].properties.length_meters/1e3&&(o[T]=g());t(0,u=y())}return r.$$set=T=>{"paths"in T&&t(1,n=T.paths)},r.$$.update=()=>{r.$$.dirty&2&&n&&(i=d(),o=p())},[u,n]}class mE extends It{constructor(e){super(),Et(this,e,pE,uE,xt,{paths:1})}}class _E{constructor(e){Lr(this,"feature");this.feature=e}get intersectionId(){return this.feature.properties.intersection_id}get filter(){return this.feature.properties.filter}get filterAngle(){var e;return(e=this.feature.properties.filter)==null?void 0:e.angle}get hasRotatedFilter(){var e;return((e=this.feature.properties.filter)==null?void 0:e.is_rotated)??!1}}function gE(r){let e,t,n,i,o;return{c(){e=U("div"),e.textContent="+",t=oe(),n=U("img"),o=xe(`
    Add diagonal filter`),ut(e,"font-size","200%"),ut(e,"margin-top","-12px"),ue(e,"class","icon"),cr(n.src,i="/ltn//filters/diagonal_filter_icon.png")||ue(n,"src",i),ue(n,"alt","Add diagonal filter"),ut(n,"transform","rotate(135deg)"),ue(n,"class","svelte-j2s60j")},m(u,a){q(u,e,a),q(u,t,a),q(u,n,a),q(u,o,a)},p:rt,d(u){u&&(V(e),V(t),V(n),V(o))}}}function yE(r){let e;function t(o,u){return o[0].hasRotatedFilter?vE:bE}let n=t(r),i=n(r);return{c(){i.c(),e=Jn()},m(o,u){i.m(o,u),q(o,e,u)},p(o,u){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&V(e),i.d(o)}}}function bE(r){let e,t,n,i,o;return{c(){e=U("div"),e.textContent="",t=oe(),n=U("img"),o=xe(`
      Rotate diagonal filter`),ut(e,"font-size","200%"),ut(e,"padding-bottom","4px"),ue(e,"class","icon"),cr(n.src,i="/ltn//filters/diagonal_filter_icon.png")||ue(n,"src",i),ue(n,"alt","Rotate diagonal filter"),ut(n,"transform","rotate(45deg)"),ue(n,"class","svelte-j2s60j")},m(u,a){q(u,e,a),q(u,t,a),q(u,n,a),q(u,o,a)},d(u){u&&(V(e),V(t),V(n),V(o))}}}function vE(r){let e,t,n,i,o;return{c(){e=U("div"),e.textContent="",t=oe(),n=U("img"),o=xe(`
      Delete diagonal filter`),ue(e,"class","icon"),cr(n.src,i="/ltn//filters/diagonal_filter_icon.png")||ue(n,"src",i),ue(n,"alt","Remove diagonal filter"),ut(n,"transform","rotate(45deg)"),ue(n,"class","svelte-j2s60j")},m(u,a){q(u,e,a),q(u,t,a),q(u,n,a),q(u,o,a)},d(u){u&&(V(e),V(t),V(n),V(o))}}}function wE(r){let e;function t(o,u){return o[0].filter?yE:gE}let n=t(r),i=n(r);return{c(){e=U("div"),i.c(),ut(e,"display","flex"),ut(e,"align-items","center")},m(o,u){q(o,e,u),i.m(e,null)},p(o,[u]){n===(n=t(o))&&i?i.p(o,u):(i.d(1),i=n(o),i&&(i.c(),i.m(e,null)))},i:rt,o:rt,d(o){o&&V(e),i.d()}}}function xE(r,e,t){let{intersection:n}=e;return r.$$set=i=>{"intersection"in i&&t(0,n=i.intersection)},[n]}class kE extends It{constructor(e){super(),Et(this,e,xE,wE,xt,{intersection:0})}}function SE(r){let e,t;return e=new kE({props:{intersection:r[2](r[6])}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&64&&(o.intersection=n[2](n[6])),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function CE(r){let e,t;return e=new Hb({props:{openOn:"hover",$$slots:{default:[SE,({features:n})=>({6:n}),({features:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function TE(r){let e,t;const n=[dn("editable-intersections"),{filter:["==",["get","kind"],"editable_intersection"]},{paint:{"circle-radius":hm(30),"circle-color":po.mapFeature.hover.backgroundColor,"circle-opacity":Wn(0,.5),"circle-stroke-color":po.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":Wn(0,3)}},{minzoom:13},{interactive:r[1]},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={$$slots:{default:[CE]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new _l({props:i}),e.$on("click",r[4]),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,[u]){const a=u&2?Zn(n,[n[0],n[1],n[2],n[3],{interactive:o[1]},n[5],n[6]]):{};u&128&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function ME(r,e,t){let{neighbourhood:n=xh("neighbourhoodGj")}=e,{onClickIntersection:i=p=>{}}=e,{interactive:o=!1}=e;function u(p){let g=n.features[p];return new _E(g)}function a(p){return u(p[0].id)}const d=p=>i(a(p.detail.features));return r.$$set=p=>{"neighbourhood"in p&&t(3,n=p.neighbourhood),"onClickIntersection"in p&&t(0,i=p.onClickIntersection),"interactive"in p&&t(1,o=p.interactive)},[i,o,a,n,d]}class LE extends It{constructor(e){super(),Et(this,e,ME,TE,xt,{neighbourhood:3,onClickIntersection:0,interactive:1})}}function w1(r,e,t){const n=r.slice();return n[7]=e[t][0],n[8]=e[t][1],n[9]=e[t][2],n}function x1(r){let e,t,n,i,o,u,a=r[8]+"",d,p,g,y,w;function T(){return r[4](r[7])}return{c(){e=U("button"),t=U("img"),i=oe(),o=U("br"),u=oe(),d=xe(a),p=oe(),cr(t.src,n=`/ltn//filters/${r[7]}_icon.gif`)||ue(t,"src",n),ue(t,"width","80"),ue(t,"alt",r[8]),ue(e,"class","outline"),ut(e,"width","100%"),e.disabled=g=r[1]==r[7]},m(L,D){q(L,e,D),$(e,t),$(e,i),$(e,o),$(e,u),$(e,d),$(e,p),y||(w=yt(e,"click",T),y=!0)},p(L,D){r=L,D&2&&g!==(g=r[1]==r[7])&&(e.disabled=g)},d(L){L&&V(e),y=!1,w()}}}function EE(r){let e,t,n,i,o,u,a,d,p,g,y,w,T=r[2][2]+"",L,D,R,z,I,F,N=$n(r[3]),W=[];for(let se=0;se<N.length;se+=1)W[se]=x1(w1(r,N,se));return{c(){e=U("h3"),e.textContent="Choose a modal filter to place on streets",t=oe(),n=U("table"),i=U("tr"),o=U("td");for(let se=0;se<W.length;se+=1)W[se].c();u=oe(),a=U("td"),d=U("img"),y=oe(),w=U("p"),L=xe(T),D=oe(),R=U("center"),z=U("button"),z.textContent="Confirm",cr(d.src,p=`/ltn//filters/${r[1]}.gif`)||ue(d,"src",p),ue(d,"height","300"),ue(d,"alt",g=r[2][1])},m(se,J){q(se,e,J),q(se,t,J),q(se,n,J),$(n,i),$(i,o);for(let Y=0;Y<W.length;Y+=1)W[Y]&&W[Y].m(o,null);$(i,u),$(i,a),$(a,d),$(a,y),$(a,w),$(w,L),q(se,D,J),q(se,R,J),$(R,z),I||(F=yt(z,"click",r[5]),I=!0)},p(se,J){if(J&10){N=$n(se[3]);let Y;for(Y=0;Y<N.length;Y+=1){const _e=w1(se,N,Y);W[Y]?W[Y].p(_e,J):(W[Y]=x1(_e),W[Y].c(),W[Y].m(o,null))}for(;Y<W.length;Y+=1)W[Y].d(1);W.length=N.length}J&2&&!cr(d.src,p=`/ltn//filters/${se[1]}.gif`)&&ue(d,"src",p),J&4&&g!==(g=se[2][1])&&ue(d,"alt",g),J&4&&T!==(T=se[2][2]+"")&&St(L,T)},d(se){se&&(V(e),V(t),V(n),V(D),V(R)),mi(W,se),I=!1,F()}}}function IE(r){let e,t,n;function i(u){r[6](u)}let o={$$slots:{default:[EE]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.show=r[0]),e=new _d({props:o}),un.push(()=>Cn(e,"show",i)),{c(){de(e.$$.fragment)},m(u,a){he(e,u,a),n=!0},p(u,[a]){const d={};a&4103&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.show=u[0],Sn(()=>t=!1)),e.$set(d)},i(u){n||(j(e.$$.fragment,u),n=!0)},o(u){G(e.$$.fragment,u),n=!1},d(u){fe(e,u)}}}function AE(r,e,t){let n,i;st(r,rm,g=>t(1,i=g));let o=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]],{show:u}=e;const a=g=>Ot(rm,i=g,i),d=()=>t(0,u=!1);function p(g){u=g,t(0,u)}return r.$$set=g=>{"show"in g&&t(0,u=g.show)},r.$$.update=()=>{r.$$.dirty&2&&t(2,n=o.find(g=>g[0]==i))},[u,i,n,o,a,d,p]}class PE extends It{constructor(e){super(),Et(this,e,AE,IE,xt,{show:0})}}function k1(r){let e,t;return e=new dr({props:{data:r[0],$$slots:{default:[zE]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.data=n[0]),i&64&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function zE(r){let e,t;const n=[dn("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let i={};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new tr({props:i}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function DE(r){let e,t,n=r[0]&&k1(r);return{c(){n&&n.c(),e=Jn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&j(n,1)):(n=k1(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),G(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){G(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function RE(r,e,t){let{map:n}=e,i=null;const o=ds();n.on("dragstart",u),n.on("mousemove",a),n.on("mouseup",d),ti(()=>{n.dragPan.enable(),n.off("dragstart",u),n.off("mousemove",a),n.off("mouseup",d)});function u(){n.dragPan.disable(),t(0,i={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function a(p){i&&(i.geometry.coordinates.push(p.lngLat.toArray()),t(0,i))}function d(){i&&(o("done",i),t(0,i=null))}return r.$$set=p=>{"map"in p&&t(1,n=p.map)},[i,n]}class $E extends It{constructor(e){super(),Et(this,e,RE,DE,xt,{map:1})}}function FE(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function BE(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function OE(r){let e;return{c(){e=U("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function NE(r){let e;return{c(){e=xe("View shortcuts")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function jE(r){let e;return{c(){e=xe("Route")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function UE(r){let e;return{c(){e=xe("Impact routing to one destination")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function VE(r){let e;return{c(){e=xe("Change this boundary")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function S1(r){let e,t,n;return t=new Rn({props:{$$slots:{default:[qE]},$$scope:{ctx:r}}}),t.$on("click",r[40]),{c(){e=U("li"),de(t.$$.fragment)},m(i,o){q(i,e,o),he(t,e,null),n=!0},p(i,o){const u={};o[1]&8192&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&V(e),fe(t)}}}function qE(r){let e;return{c(){e=xe("Debug")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function ZE(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L,D,R,z,I,F,N,W,se,J,Y,_e,ze,ee,ae;o=new Rn({props:{$$slots:{default:[FE]},$$scope:{ctx:r}}}),o.$on("click",$o),d=new Rn({props:{$$slots:{default:[BE]},$$scope:{ctx:r}}}),d.$on("click",r[35]),w=new Wm({props:{$$slots:{default:[OE]},$$scope:{ctx:r}}}),z=new Rn({props:{$$slots:{default:[NE]},$$scope:{ctx:r}}}),z.$on("click",r[36]),N=new Rn({props:{$$slots:{default:[jE]},$$scope:{ctx:r}}}),N.$on("click",r[37]),J=new Rn({props:{$$slots:{default:[UE]},$$scope:{ctx:r}}}),J.$on("click",r[38]),ze=new Rn({props:{$$slots:{default:[VE]},$$scope:{ctx:r}}}),ze.$on("click",r[39]);let Ee=r[13]&&S1(r);return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),de(o.$$.fragment),u=oe(),a=U("li"),de(d.$$.fragment),p=oe(),g=U("li"),y=xe(`Editing
          `),de(w.$$.fragment),T=oe(),L=U("nav"),D=U("ul"),R=U("li"),de(z.$$.fragment),I=oe(),F=U("li"),de(N.$$.fragment),W=oe(),se=U("li"),de(J.$$.fragment),Y=oe(),_e=U("li"),de(ze.$$.fragment),ee=oe(),Ee&&Ee.c(),ue(t,"aria-label","breadcrumb"),ue(e,"slot","top"),ut(e,"display","flex"),ut(e,"justify-content","space-between")},m(we,it){q(we,e,it),$(e,t),$(t,n),$(n,i),he(o,i,null),$(n,u),$(n,a),he(d,a,null),$(n,p),$(n,g),$(g,y),he(w,g,null),$(e,T),$(e,L),$(L,D),$(D,R),he(z,R,null),$(D,I),$(D,F),he(N,F,null),$(D,W),$(D,se),he(J,se,null),$(D,Y),$(D,_e),he(ze,_e,null),$(D,ee),Ee&&Ee.m(D,null),ae=!0},p(we,it){const Ge={};it[1]&8192&&(Ge.$$scope={dirty:it,ctx:we}),o.$set(Ge);const Ie={};it[1]&8192&&(Ie.$$scope={dirty:it,ctx:we}),d.$set(Ie);const De={};it[1]&8192&&(De.$$scope={dirty:it,ctx:we}),w.$set(De);const Ct={};it[1]&8192&&(Ct.$$scope={dirty:it,ctx:we}),z.$set(Ct);const nt={};it[1]&8192&&(nt.$$scope={dirty:it,ctx:we}),N.$set(nt);const lt={};it[1]&8192&&(lt.$$scope={dirty:it,ctx:we}),J.$set(lt);const mt={};it[1]&8192&&(mt.$$scope={dirty:it,ctx:we}),ze.$set(mt),we[13]?Ee?(Ee.p(we,it),it[0]&8192&&j(Ee,1)):(Ee=S1(we),Ee.c(),j(Ee,1),Ee.m(D,null)):Ee&&(tn(),G(Ee,1,1,()=>{Ee=null}),nn())},i(we){ae||(j(o.$$.fragment,we),j(d.$$.fragment,we),j(w.$$.fragment,we),j(z.$$.fragment,we),j(N.$$.fragment,we),j(J.$$.fragment,we),j(ze.$$.fragment,we),j(Ee),ae=!0)},o(we){G(o.$$.fragment,we),G(d.$$.fragment,we),G(w.$$.fragment,we),G(z.$$.fragment,we),G(N.$$.fragment,we),G(J.$$.fragment,we),G(ze.$$.fragment,we),G(Ee),ae=!1},d(we){we&&V(e),fe(o),fe(d),fe(w),fe(z),fe(N),fe(J),fe(ze),Ee&&Ee.d()}}}function C1(r){let e;return{c(){e=U("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function GE(r){let e,t,n;return{c(){e=xe("Undo ("),t=xe(r[4]),n=xe(")")},m(i,o){q(i,e,o),q(i,t,o),q(i,n,o)},p(i,o){o[0]&16&&St(t,i[4])},d(i){i&&(V(e),V(t),V(n))}}}function HE(r){let e;return{c(){e=xe("Undo")},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function WE(r){let e,t,n;return{c(){e=xe("Redo ("),t=xe(r[5]),n=xe(")")},m(i,o){q(i,e,o),q(i,t,o),q(i,n,o)},p(i,o){o[0]&32&&St(t,i[5])},d(i){i&&(V(e),V(t),V(n))}}}function KE(r){let e;return{c(){e=xe("Redo")},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function T1(r){let e,t,n,i,o;return{c(){e=U("h3"),e.textContent="Reclassify main roads",t=oe(),n=U("p"),n.innerHTML=`<i>Main roads</i>, drawn in grey, were classified automatically using
        data from
        <a href="https://openstreetmap.org/about" target="_blank">OpenStreetMap</a>, but you can reclassify a road segment by clicking on it.`,i=oe(),o=U("p"),o.textContent=`Main roads are typically better suited to support higher levels of
        traffic than neighbourhood roads.`},m(u,a){q(u,e,a),q(u,t,a),q(u,n,a),q(u,i,a),q(u,o,a)},d(u){u&&(V(e),V(t),V(n),V(i),V(o))}}}function M1(r){let e,t;return e=new Fo({props:{colorScale:av,labels:{limits:lv}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function XE(r){let e,t,n=Er(r[6]).properties.name+"",i,o,u,a,d,p,g,y,w,T,L,D,R,z,I,F,N,W,se,J,Y,_e,ze,ee,ae,Ee,we,it,Ge,Ie,De,Ct,nt,lt,mt,ht,We,Bt,Lt,Nt,Mt,Qt,bt,Dt,pn,qe,Ve,kt,Ut,ye,zn,Oe,tt,Kt,Un,ur,pr,Ar,Pr,go,hr,vt,Vr,or,Kn,Yn,Pt,sn=r[8]>0&&C1();function mn(ge){r[32](ge)}let Qn={};r[3]!==void 0&&(Qn.show=r[3]),nt=new PE({props:Qn}),un.push(()=>Cn(nt,"show",mn));function _i(ge,Ae){return ge[4]==0?HE:GE}let _n=_i(r),Nr=_n(r);function _r(ge,Ae){return ge[5]==0?KE:WE}let Ce=_r(r),te=Ce(r),ie=r[0].kind=="main-roads"&&T1(),le=r[11]=="speeds"&&M1();return or=new $v({props:{neighbourhoodBoundary:Er(r[6])}}),{c(){e=U("div"),t=U("h1"),i=xe(n),o=oe(),sn&&sn.c(),u=oe(),a=U("h2"),a.textContent="Editing tools",d=oe(),p=U("div"),g=U("button"),y=U("img"),L=oe(),D=U("button"),R=U("img"),F=oe(),N=U("button"),W=U("div"),W.innerHTML=`<img style="position: absolute; width: 60%; height: 60%; top: -1px; left: -1px;" src="${b1}" alt="Reverse directions" class="svelte-1fxkstq"/> <img style="position: absolute; width: 60%; height: 60%; bottom: -1px; right: -1px; transform: rotate(180deg);" src="${b1}" alt="Reverse directions" class="svelte-1fxkstq"/>`,J=oe(),Y=U("button"),_e=U("img"),ae=oe(),Ee=U("button"),we=U("img"),Ie=oe(),De=U("button"),De.textContent="Change modal filter type",Ct=oe(),de(nt.$$.fragment),mt=oe(),ht=U("div"),We=U("button"),Nr.c(),Lt=oe(),Nt=U("button"),te.c(),Qt=oe(),ie&&ie.c(),bt=oe(),Dt=U("h2"),Dt.textContent="Map style",pn=oe(),qe=U("label"),Ve=U("input"),kt=xe(`
      Animate shortcuts`),Ut=oe(),ye=U("p"),ye.innerHTML=`<i>Shortcuts</i>
      are routes from one main road to another, which cut through the neighborhood&#39;s
      interior.`,zn=oe(),Oe=U("div"),tt=U("label"),Kt=xe(`Draw roads:
        `),Un=U("select"),ur=U("option"),ur.textContent="Worst shortcuts",pr=U("option"),pr.textContent="Cell",Ar=U("option"),Ar.textContent="Edits (either filter or direction)",Pr=U("option"),Pr.textContent="Speed limit",go=oe(),le&&le.c(),hr=oe(),vt=U("h2"),vt.textContent="Neighbourhood stats",Vr=oe(),de(or.$$.fragment),cr(y.src,w=`/ltn//filters/${r[9]}_icon.gif`)||ue(y,"src",w),ue(y,"alt","Add a modal filter"),ue(y,"class","svelte-1fxkstq"),g.disabled=T=r[0].kind=="filter",ue(g,"data-tooltip","Add a modal filter (hotkey 1)"),ue(g,"class","svelte-1fxkstq"),Yt(g,"active",r[0].kind=="filter"),Yt(g,"outline",r[0].kind!="filter"),cr(R.src,z="/ltn//filters/select_freehand.png")||ue(R,"src",z),ue(R,"alt","Add many modal filters along a line"),ue(R,"class","svelte-1fxkstq"),D.disabled=I=r[0].kind=="freehand-filters",ue(D,"data-tooltip","Add many modal filters along a line (hotkey 2)"),ue(D,"class","svelte-1fxkstq"),Yt(D,"active",r[0].kind=="freehand-filters"),Yt(D,"outline",r[0].kind!="freehand-filters"),ut(W,"height","100%"),ut(W,"width","100%"),ut(W,"position","relative"),N.disabled=se=r[0].kind=="oneway",ue(N,"data-tooltip","Toggle one-way (hotkey 3)"),ue(N,"class","svelte-1fxkstq"),Yt(N,"active",r[0].kind=="oneway"),Yt(N,"outline",r[0].kind!="oneway"),cr(_e.src,ze="/ltn//filters/no_right_turn.svg")||ue(_e,"src",ze),ue(_e,"alt","Restrict turns"),ue(_e,"class","svelte-1fxkstq"),Y.disabled=ee=r[0].kind=="turn_restriction",ue(Y,"data-tooltip","Restrict turns (hotkey 4)"),ue(Y,"class","svelte-1fxkstq"),Yt(Y,"active",r[0].kind=="turn_restriction"),Yt(Y,"outline",r[0].kind!="turn_restriction"),cr(we.src,it=QL)||ue(we,"src",it),ue(we,"alt","Change main/minor roads"),ue(we,"class","svelte-1fxkstq"),Ee.disabled=Ge=r[0].kind=="main-roads",ue(Ee,"data-tooltip","Reclassify main roads (hotkey 5)"),ue(Ee,"class","svelte-1fxkstq"),Yt(Ee,"active",r[0].kind=="main-roads"),Yt(Ee,"outline",r[0].kind!="main-roads"),ue(p,"class","tool-palette svelte-1fxkstq"),ue(De,"class","outline"),ue(We,"class","outline"),We.disabled=Bt=r[4]==0,ue(We,"data-tooltip","Ctrl+Z"),ue(Nt,"class","outline"),Nt.disabled=Mt=r[5]==0,ue(Nt,"data-tooltip","Ctrl+Y"),ut(ht,"display","flex"),ut(ht,"justify-content","space-between"),ue(Ve,"type","checkbox"),ur.__value="shortcuts",qn(ur,ur.__value),pr.__value="cells",qn(pr,pr.__value),Ar.__value="edits",qn(Ar,Ar.__value),Pr.__value="speeds",qn(Pr,Pr.__value),r[11]===void 0&&ls(()=>r[34].call(Un)),ut(Oe,"border","1px solid black"),ut(Oe,"padding","4px"),ue(e,"slot","sidebar")},m(ge,Ae){q(ge,e,Ae),$(e,t),$(t,i),$(e,o),sn&&sn.m(e,null),$(e,u),$(e,a),$(e,d),$(e,p),$(p,g),$(g,y),$(p,L),$(p,D),$(D,R),$(p,F),$(p,N),$(N,W),$(p,J),$(p,Y),$(Y,_e),$(p,ae),$(p,Ee),$(Ee,we),$(e,Ie),$(e,De),$(e,Ct),he(nt,e,null),$(e,mt),$(e,ht),$(ht,We),Nr.m(We,null),$(ht,Lt),$(ht,Nt),te.m(Nt,null),$(e,Qt),ie&&ie.m(e,null),$(e,bt),$(e,Dt),$(e,pn),$(e,qe),$(qe,Ve),Ve.checked=r[10],$(qe,kt),$(e,Ut),$(e,ye),$(e,zn),$(e,Oe),$(Oe,tt),$(tt,Kt),$(tt,Un),$(Un,ur),$(Un,pr),$(Un,Ar),$(Un,Pr),qi(Un,r[11],!0),$(Oe,go),le&&le.m(Oe,null),$(e,hr),$(e,vt),$(e,Vr),he(or,e,null),Kn=!0,Yn||(Pt=[yt(g,"click",r[26]),yt(D,"click",r[27]),yt(N,"click",r[28]),yt(Y,"click",r[29]),yt(Ee,"click",r[30]),yt(De,"click",r[31]),yt(We,"click",r[22]),yt(Nt,"click",r[23]),yt(Ve,"change",r[33]),yt(Un,"change",r[34])],Yn=!0)},p(ge,Ae){(!Kn||Ae[0]&64)&&n!==(n=Er(ge[6]).properties.name+"")&&St(i,n),ge[8]>0?sn||(sn=C1(),sn.c(),sn.m(e,u)):sn&&(sn.d(1),sn=null),(!Kn||Ae[0]&512&&!cr(y.src,w=`/ltn//filters/${ge[9]}_icon.gif`))&&ue(y,"src",w),(!Kn||Ae[0]&1&&T!==(T=ge[0].kind=="filter"))&&(g.disabled=T),(!Kn||Ae[0]&1)&&Yt(g,"active",ge[0].kind=="filter"),(!Kn||Ae[0]&1)&&Yt(g,"outline",ge[0].kind!="filter"),(!Kn||Ae[0]&1&&I!==(I=ge[0].kind=="freehand-filters"))&&(D.disabled=I),(!Kn||Ae[0]&1)&&Yt(D,"active",ge[0].kind=="freehand-filters"),(!Kn||Ae[0]&1)&&Yt(D,"outline",ge[0].kind!="freehand-filters"),(!Kn||Ae[0]&1&&se!==(se=ge[0].kind=="oneway"))&&(N.disabled=se),(!Kn||Ae[0]&1)&&Yt(N,"active",ge[0].kind=="oneway"),(!Kn||Ae[0]&1)&&Yt(N,"outline",ge[0].kind!="oneway"),(!Kn||Ae[0]&1&&ee!==(ee=ge[0].kind=="turn_restriction"))&&(Y.disabled=ee),(!Kn||Ae[0]&1)&&Yt(Y,"active",ge[0].kind=="turn_restriction"),(!Kn||Ae[0]&1)&&Yt(Y,"outline",ge[0].kind!="turn_restriction"),(!Kn||Ae[0]&1&&Ge!==(Ge=ge[0].kind=="main-roads"))&&(Ee.disabled=Ge),(!Kn||Ae[0]&1)&&Yt(Ee,"active",ge[0].kind=="main-roads"),(!Kn||Ae[0]&1)&&Yt(Ee,"outline",ge[0].kind!="main-roads");const Be={};!lt&&Ae[0]&8&&(lt=!0,Be.show=ge[3],Sn(()=>lt=!1)),nt.$set(Be),_n===(_n=_i(ge))&&Nr?Nr.p(ge,Ae):(Nr.d(1),Nr=_n(ge),Nr&&(Nr.c(),Nr.m(We,null))),(!Kn||Ae[0]&16&&Bt!==(Bt=ge[4]==0))&&(We.disabled=Bt),Ce===(Ce=_r(ge))&&te?te.p(ge,Ae):(te.d(1),te=Ce(ge),te&&(te.c(),te.m(Nt,null))),(!Kn||Ae[0]&32&&Mt!==(Mt=ge[5]==0))&&(Nt.disabled=Mt),ge[0].kind=="main-roads"?ie||(ie=T1(),ie.c(),ie.m(e,bt)):ie&&(ie.d(1),ie=null),Ae[0]&1024&&(Ve.checked=ge[10]),Ae[0]&2048&&qi(Un,ge[11]),ge[11]=="speeds"?le?Ae[0]&2048&&j(le,1):(le=M1(),le.c(),j(le,1),le.m(Oe,null)):le&&(tn(),G(le,1,1,()=>{le=null}),nn());const je={};Ae[0]&64&&(je.neighbourhoodBoundary=Er(ge[6])),or.$set(je)},i(ge){Kn||(j(nt.$$.fragment,ge),j(le),j(or.$$.fragment,ge),Kn=!0)},o(ge){G(nt.$$.fragment,ge),G(le),G(or.$$.fragment,ge),Kn=!1},d(ge){ge&&V(e),sn&&sn.d(),fe(nt),Nr.d(),te.d(),ie&&ie.d(),le&&le.d(),fe(or),Yn=!1,mr(Pt)}}}function JE(r){let e,t,n=(r[43].name??"unnamed road")+"",i,o,u=Math.round(r[43].speed_mph)+"",a,d;return{c(){e=U("p"),t=xe("Main road: "),i=xe(n),o=xe(`
                (`),a=xe(u),d=xe(" mph)")},m(p,g){q(p,e,g),$(e,t),$(e,i),$(e,o),$(e,a),$(e,d)},p(p,g){g[1]&4096&&n!==(n=(p[43].name??"unnamed road")+"")&&St(i,n),g[1]&4096&&u!==(u=Math.round(p[43].speed_mph)+"")&&St(a,u)},d(p){p&&V(e)}}}function YE(r){let e,t=r[43].shortcuts+"",n,i,o=(r[43].name??"unnamed road")+"",u,a,d=Math.round(r[43].speed_mph)+"",p,g;return{c(){e=U("p"),n=xe(t),i=xe(" shortcuts through "),u=xe(o),a=xe(`
                (`),p=xe(d),g=xe(" mph)")},m(y,w){q(y,e,w),$(e,n),$(e,i),$(e,u),$(e,a),$(e,p),$(e,g)},p(y,w){w[1]&4096&&t!==(t=y[43].shortcuts+"")&&St(n,t),w[1]&4096&&o!==(o=(y[43].name??"unnamed road")+"")&&St(u,o),w[1]&4096&&d!==(d=Math.round(y[43].speed_mph)+"")&&St(p,d)},d(y){y&&V(e)}}}function QE(r){let e;return{c(){e=U("p"),e.textContent="Click to create a turn restriction from here"},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function eI(r){let e;return{c(){e=U("p"),e.textContent="Click to designate a main road or not"},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function tI(r){let e;return{c(){e=U("p"),e.textContent="Click to change direction"},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function nI(r){let e,t,n,i;return{c(){e=U("div"),t=U("img"),i=xe(`
                Click to add modal filter`),cr(t.src,n=`/ltn//filters/${r[9]}_icon.gif`)||ue(t,"src",n),ue(t,"width","20"),ue(t,"alt","Add modal filter")},m(o,u){q(o,e,u),$(e,t),$(e,i)},p(o,u){u[0]&512&&!cr(t.src,n=`/ltn//filters/${o[9]}_icon.gif`)&&ue(t,"src",n)},d(o){o&&V(e)}}}function rI(r){let e,t;function n(p,g){if(p[43].kind=="interior_road")return YE;if(p[43].kind=="main_road")return JE}let i=n(r),o=i&&i(r);function u(p,g){if(p[0].kind=="filter")return nI;if(p[0].kind=="oneway")return tI;if(p[0].kind=="main-roads")return eI;if(p[0].kind=="turn_restriction")return QE}let a=u(r),d=a&&a(r);return{c(){o&&o.c(),e=oe(),d&&d.c(),t=Jn()},m(p,g){o&&o.m(p,g),q(p,e,g),d&&d.m(p,g),q(p,t,g)},p(p,g){i===(i=n(p))&&o?o.p(p,g):(o&&o.d(1),o=i&&i(p),o&&(o.c(),o.m(e.parentNode,e))),a===(a=u(p))&&d?d.p(p,g):(d&&d.d(1),d=a&&a(p),d&&(d.c(),d.m(t.parentNode,t)))},d(p){p&&(V(e),V(t)),o&&o.d(p),d&&d.d(p)}}}function iI(r){let e,t,n;return t=new fi({props:{openOn:"hover",$$slots:{default:[rI,({props:i})=>({43:i}),({props:i})=>[0,i?4096:0]]},$$scope:{ctx:r}}}),{c(){e=U("div"),de(t.$$.fragment),ue(e,"slot","line-popup")},m(i,o){q(i,e,o),he(t,e,null),n=!0},p(i,o){const u={};o[0]&513|o[1]&12288&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&V(e),fe(t)}}}function oI(r){let e,t,n,i,o,u,a,d,p,g;return e=new Ed({}),n=new Ld({}),o=new Id({}),a=new Eh({props:{interactive:r[0].kind=="filter"||r[0].kind=="oneway"||r[0].kind=="main-roads"||r[0].kind=="turn_restriction"&&r[0].from_road_id==null,onClickLine:r[15],$$slots:{"line-popup":[iI]},$$scope:{ctx:r}}}),p=new LE({props:{interactive:r[0].kind=="filter",neighbourhood:r[1],onClickIntersection:r[20]}}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment),i=oe(),de(o.$$.fragment),u=oe(),de(a.$$.fragment),d=oe(),de(p.$$.fragment)},m(y,w){he(e,y,w),q(y,t,w),he(n,y,w),q(y,i,w),he(o,y,w),q(y,u,w),he(a,y,w),q(y,d,w),he(p,y,w),g=!0},p(y,w){const T={};w[0]&1&&(T.interactive=y[0].kind=="filter"||y[0].kind=="oneway"||y[0].kind=="main-roads"||y[0].kind=="turn_restriction"&&y[0].from_road_id==null),w[0]&513|w[1]&8192&&(T.$$scope={dirty:w,ctx:y}),a.$set(T);const L={};w[0]&1&&(L.interactive=y[0].kind=="filter"),w[0]&2&&(L.neighbourhood=y[1]),p.$set(L)},i(y){g||(j(e.$$.fragment,y),j(n.$$.fragment,y),j(o.$$.fragment,y),j(a.$$.fragment,y),j(p.$$.fragment,y),g=!0)},o(y){G(e.$$.fragment,y),G(n.$$.fragment,y),G(o.$$.fragment,y),G(a.$$.fragment,y),G(p.$$.fragment,y),g=!1},d(y){y&&(V(t),V(i),V(u),V(d)),fe(e,y),fe(n,y),fe(o,y),fe(a,y),fe(p,y)}}}function L1(r){let e,t;return e=new mE({props:{paths:r[7]}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i[0]&128&&(o.paths=n[7]),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function sI(r){let e;return{c(){e=xe("Click to delete filter")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function aI(r){let e,t,n;return t=new fi({props:{openOn:"hover",$$slots:{default:[sI]},$$scope:{ctx:r}}}),{c(){e=U("div"),de(t.$$.fragment),ue(e,"slot","modal-filter")},m(i,o){q(i,e,o),he(t,e,null),n=!0},p(i,o){const u={};o[1]&8192&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&V(e),fe(t)}}}function lI(r){let e;return{c(){e=xe("Click to delete turn restriction")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function cI(r){let e,t,n;return t=new fi({props:{openOn:"hover",$$slots:{default:[lI]},$$scope:{ctx:r}}}),{c(){e=U("div"),de(t.$$.fragment),ue(e,"slot","turn-restriction")},m(i,o){q(i,e,o),he(t,e,null),n=!0},p(i,o){const u={};o[1]&8192&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&V(e),fe(t)}}}function E1(r){let e,t;return e=new $E({props:{map:Er(r[2])}}),e.$on("done",r[24]),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i[0]&4&&(o.map=Er(n[2])),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function I1(r){let e,t;return e=new dr({props:{data:r[0].possible_targets||Hi(),generateId:!0,$$slots:{default:[fI]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i[0]&1&&(o.data=n[0].possible_targets||Hi()),i[0]&1|i[1]&8192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function uI(r){let e,t,n,i,o=r[0].from_road_name+"",u,a,d=(r[43].name||"unnamed road")+"",p;return{c(){e=U("div"),t=U("img"),i=xe(`

              Create a turn restriction from `),u=xe(o),a=xe(" to "),p=xe(d),cr(t.src,n=`/ltn//filters/no_${r[43].kind}_turn.png`)||ue(t,"src",n),ue(t,"width","20"),ue(t,"alt","Add turn restriction")},m(g,y){q(g,e,y),$(e,t),$(e,i),$(e,u),$(e,a),$(e,p)},p(g,y){y[1]&4096&&!cr(t.src,n=`/ltn//filters/no_${g[43].kind}_turn.png`)&&ue(t,"src",n),y[0]&1&&o!==(o=g[0].from_road_name+"")&&St(u,o),y[1]&4096&&d!==(d=(g[43].name||"unnamed road")+"")&&St(p,d)},d(g){g&&V(e)}}}function hI(r){let e,t;return e=new fi({props:{openOn:"hover",$$slots:{default:[uI,({props:n})=>({43:n}),({props:n})=>[0,n?4096:0]]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i[0]&1|i[1]&12288&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function fI(r){let e,t;const n=[dn("turn-restriction-targets"),{manageHoverState:!0},{paint:{"line-color":"yellow","line-opacity":Wn(.5,1),"line-width":Us(1)}}];let i={$$slots:{default:[hI]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new tr({props:i}),e.$on("click",r[17]),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,u){const a={};u[0]&1|u[1]&8192&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function dI(r){let e,t,n,i,o,u,a,d,p,g;t=new Zm({}),t.$on("click",r[16]),i=new Ih({props:{input:r[1],$$slots:{default:[oI]},$$scope:{ctx:r}}});let y=r[10]&&L1(r);a=new Ra({props:{onClickModalFilter:r[18],onClickTurnRestriction:r[19],$$slots:{"turn-restriction":[cI],"modal-filter":[aI]},$$scope:{ctx:r}}});let w=r[0].kind=="freehand-filters"&&E1(r),T=r[0].kind=="turn_restriction"&&I1(r);return{c(){e=U("div"),de(t.$$.fragment),n=oe(),de(i.$$.fragment),o=oe(),y&&y.c(),u=oe(),de(a.$$.fragment),d=oe(),w&&w.c(),p=oe(),T&&T.c(),ue(e,"slot","map")},m(L,D){q(L,e,D),he(t,e,null),$(e,n),he(i,e,null),$(e,o),y&&y.m(e,null),$(e,u),he(a,e,null),$(e,d),w&&w.m(e,null),$(e,p),T&&T.m(e,null),g=!0},p(L,D){const R={};D[0]&2&&(R.input=L[1]),D[0]&515|D[1]&8192&&(R.$$scope={dirty:D,ctx:L}),i.$set(R),L[10]?y?(y.p(L,D),D[0]&1024&&j(y,1)):(y=L1(L),y.c(),j(y,1),y.m(e,u)):y&&(tn(),G(y,1,1,()=>{y=null}),nn());const z={};D[1]&8192&&(z.$$scope={dirty:D,ctx:L}),a.$set(z),L[0].kind=="freehand-filters"?w?(w.p(L,D),D[0]&1&&j(w,1)):(w=E1(L),w.c(),j(w,1),w.m(e,p)):w&&(tn(),G(w,1,1,()=>{w=null}),nn()),L[0].kind=="turn_restriction"?T?(T.p(L,D),D[0]&1&&j(T,1)):(T=I1(L),T.c(),j(T,1),T.m(e,null)):T&&(tn(),G(T,1,1,()=>{T=null}),nn())},i(L){g||(j(t.$$.fragment,L),j(i.$$.fragment,L),j(y),j(a.$$.fragment,L),j(w),j(T),g=!0)},o(L){G(t.$$.fragment,L),G(i.$$.fragment,L),G(y),G(a.$$.fragment,L),G(w),G(T),g=!1},d(L){L&&V(e),fe(t),fe(i),y&&y.d(),fe(a),w&&w.d(),T&&T.d()}}}function pI(r){let e,t,n,i;return e=new _o({props:{$$slots:{map:[dI],sidebar:[XE],top:[ZE]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0,n||(i=yt(window,"keydown",r[21]),n=!0)},p(o,u){const a={};u[0]&16383|u[1]&8192&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o),n=!1,i()}}}function mI(r,e,t){let n,i,o,u,a,d,p,g,y;st(r,io,bt=>t(25,i=bt)),st(r,rm,bt=>t(9,o=bt)),st(r,Ir,bt=>t(41,u=bt)),st(r,Do,bt=>t(2,a=bt)),st(r,Vg,bt=>t(10,d=bt)),st(r,cd,bt=>t(11,p=bt)),st(r,an,bt=>t(12,g=bt)),st(r,ad,bt=>t(13,y=bt));function w(){return{kind:"turn_restriction",from_road_id:null,from_road_name:"",possible_targets:Hi()}}let T={kind:"filter"},L=!1,D=0,R=0,z,I,F=u.getAllShortcuts();ti(()=>{a.doubleClickZoom.enable()});function N(bt){t(1,I=u.renderNeighbourhood()),t(6,z=I.features.find(Dt=>Dt.properties.kind=="boundary")),t(4,D=I.undo_length),t(5,R=I.redo_length),t(7,F=u.getAllShortcuts()),dh()}function W(bt,Dt){T.kind=="filter"?(u.addModalFilter(Dt,o),Ot(io,i++,i)):T.kind=="oneway"?(u.toggleTravelFlow(bt.properties.road),Ot(io,i++,i)):T.kind=="main-roads"?(u.toggleMainRoad(bt.properties.road),Ot(io,i++,i)):T.kind=="turn_restriction"&&(t(0,T.from_road_id=bt.properties.road,T),t(0,T.from_road_name=bt.properties.name||"unnamed road",T),t(0,T.possible_targets=u.getTurnRestrictionTargets(bt.properties.road),T))}function se(bt){T.kind=="turn_restriction"&&(a.queryRenderedFeatures(bt.detail.point,{layers:["interior-roads","turn-restriction-targets"]}).length>0||t(0,T=w()))}function J(bt){if(T.kind=="turn_restriction"&&T.from_road_id!=null){let Dt=bt.detail.features[0].properties.road;u.addTurnRestriction(T.from_road_id,Dt),Ot(io,i++,i)}t(0,T=w())}function Y(bt){let Dt=bt.detail.features[0];u.deleteModalFilter(Dt.properties.road),Ot(io,i++,i)}function _e(bt){let Dt=bt.detail.features[0];u.deleteTurnRestriction(Dt.properties.intersection,Dt.properties.from_road,Dt.properties.to_road),Ot(io,i++,i)}function ze(bt){if(T.kind!="filter"){console.assert(!1,`this shouldn't happen - intersections should only be clickable when in 'filter' mode, not ${T.kind}`);return}bt.hasRotatedFilter?(u.deleteDiagonalFilter(bt),Ot(io,i++,i)):bt.filter?(u.rotateDiagonalFilter(bt),Ot(io,i++,i)):(u.addDiagonalFilter(bt),Ot(io,i++,i))}function ee(bt){bt.target.tagName!="INPUT"&&(bt.ctrlKey&&bt.key=="z"&&ae(),bt.ctrlKey&&bt.key=="y"&&Ee(),bt.key=="1"&&t(0,T={kind:"filter"}),bt.key=="2"&&t(0,T={kind:"freehand-filters"}),bt.key=="3"&&t(0,T={kind:"oneway"}),bt.key=="4"&&t(0,T=w()),bt.key=="5"&&t(0,T={kind:"main-roads"}))}function ae(){u.undo(),Ot(io,i++,i)}function Ee(){u.redo(),Ot(io,i++,i)}function we(bt){let Dt=bt.detail;Dt&&(u.addManyModalFilters(Dt,o),Ot(io,i++,i)),t(0,T={kind:"filter"})}const it=()=>t(0,T={kind:"filter"}),Ge=()=>t(0,T={kind:"freehand-filters"}),Ie=()=>t(0,T={kind:"oneway"}),De=()=>t(0,T=w()),Ct=()=>t(0,T={kind:"main-roads"}),nt=()=>t(3,L=!0);function lt(bt){L=bt,t(3,L)}function mt(){d=this.checked,Vg.set(d)}function ht(){p=va(this),cd.set(p)}const We=()=>Ot(an,g={mode:"pick-neighbourhood"},g),Bt=()=>Ot(an,g={mode:"view-shortcuts"},g),Lt=()=>Ot(an,g={mode:"route",prevMode:"neighbourhood"},g),Nt=()=>Ot(an,g={mode:"impact-one-destination"},g),Mt=()=>Ot(an,g={mode:"set-boundary",name:Er(z).properties.name,existing:Er(z)},g),Qt=()=>Ot(an,g={mode:"debug-neighbourhood"},g);return r.$$.update=()=>{r.$$.dirty[0]&5&&(T.kind=="oneway"||T.kind=="main-roads"?a.doubleClickZoom.disable():a.doubleClickZoom.enable()),r.$$.dirty[0]&33554432&&N(),r.$$.dirty[0]&2&&t(8,n=I.features.filter(bt=>bt.properties.kind=="cell"&&bt.properties.cell_color=="disconnected").length)},[T,I,a,L,D,R,z,F,n,o,d,p,g,y,w,W,se,J,Y,_e,ze,ee,ae,Ee,we,i,it,Ge,Ie,De,Ct,nt,lt,mt,ht,We,Bt,Lt,Nt,Mt,Qt]}class _I extends It{constructor(e){super(),Et(this,e,mI,pI,xt,{},null,[-1,-1])}}function gI(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function yI(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function bI(r){let e,t,n,i,o,u,a,d,p,g,y;return o=new Rn({props:{$$slots:{default:[gI]},$$scope:{ctx:r}}}),o.$on("click",$o),d=new Rn({props:{$$slots:{default:[yI]},$$scope:{ctx:r}}}),d.$on("click",r[11]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),de(o.$$.fragment),u=oe(),a=U("li"),de(d.$$.fragment),p=oe(),g=U("li"),g.textContent="Predict impact",ue(t,"aria-label","breadcrumb"),ue(e,"slot","top")},m(w,T){q(w,e,T),$(e,t),$(t,n),$(n,i),he(o,i,null),$(n,u),$(n,a),he(d,a,null),$(n,p),$(n,g),y=!0},p(w,T){const L={};T&16384&&(L.$$scope={dirty:T,ctx:w}),o.$set(L);const D={};T&16384&&(D.$$scope={dirty:T,ctx:w}),d.$set(D)},i(w){y||(j(o.$$.fragment,w),j(d.$$.fragment,w),y=!0)},o(w){G(o.$$.fragment,w),G(d.$$.fragment,w),y=!1},d(w){w&&V(e),fe(o),fe(d)}}}function A1(r){let e,t,n,i,o,u,a;function d(T){r[10](T)}let p={list:r[1]};r[2]!==void 0&&(p.idx=r[2]),e=new wd({props:p}),un.push(()=>Cn(e,"idx",d));let g=r[1][r[2]].count>1&&P1(r),y=r[1][r[2]].before==null&&z1(),w=r[1][r[2]].after==null&&D1();return{c(){de(e.$$.fragment),n=oe(),g&&g.c(),i=oe(),y&&y.c(),o=oe(),w&&w.c(),u=Jn()},m(T,L){he(e,T,L),q(T,n,L),g&&g.m(T,L),q(T,i,L),y&&y.m(T,L),q(T,o,L),w&&w.m(T,L),q(T,u,L),a=!0},p(T,L){const D={};L&2&&(D.list=T[1]),!t&&L&4&&(t=!0,D.idx=T[2],Sn(()=>t=!1)),e.$set(D),T[1][T[2]].count>1?g?g.p(T,L):(g=P1(T),g.c(),g.m(i.parentNode,i)):g&&(g.d(1),g=null),T[1][T[2]].before==null?y||(y=z1(),y.c(),y.m(o.parentNode,o)):y&&(y.d(1),y=null),T[1][T[2]].after==null?w||(w=D1(),w.c(),w.m(u.parentNode,u)):w&&(w.d(1),w=null)},i(T){a||(j(e.$$.fragment,T),a=!0)},o(T){G(e.$$.fragment,T),a=!1},d(T){T&&(V(n),V(i),V(o),V(u)),fe(e,T),g&&g.d(T),y&&y.d(T),w&&w.d(T)}}}function P1(r){let e,t,n=r[1][r[2]].count.toLocaleString()+"",i,o,u,a;return{c(){e=U("p"),t=xe(`The routes are currently sampled, to speed things up. This one sample
          route represents `),i=xe(n),o=xe(` trips between the
          same points.`),u=oe(),a=U("i"),a.textContent=`Note: if these don't sum to the total above, that's likely a known
          software bug`},m(d,p){q(d,e,p),$(e,t),$(e,i),$(e,o),q(d,u,p),q(d,a,p)},p(d,p){p&6&&n!==(n=d[1][d[2]].count.toLocaleString()+"")&&St(i,n)},d(d){d&&(V(e),V(u),V(a))}}}function z1(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route before changes (
          <i>This is usually a known software bug</i>`,ut(e,"color","red")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function D1(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route after changes (
          <i>This is usually a known software bug</i>`,ut(e,"color","blue")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function vI(r){let e,t,n,i,o=r[0].before.toLocaleString()+"",u,a,d,p,g=r[0].after.toLocaleString()+"",y,w,T,L,D=Math.round(100*r[0].after/r[0].before)+"",R,z,I,F;t=new Ys({}),t.$on("click",r[9]);let N=r[1].length>0&&A1(r);return{c(){e=U("div"),de(t.$$.fragment),n=oe(),i=U("p"),u=xe(o),a=xe(` routes cross here
      `),d=U("span"),d.textContent="before your changes",p=xe(`
      , and `),y=xe(g),w=oe(),T=U("span"),T.textContent="after your changes",L=xe(`
      . That's
      `),R=xe(D),z=xe("% of the original traffic."),I=oe(),N&&N.c(),ut(d,"color","red"),ut(T,"color","blue"),ue(e,"slot","sidebar")},m(W,se){q(W,e,se),he(t,e,null),$(e,n),$(e,i),$(i,u),$(i,a),$(i,d),$(i,p),$(i,y),$(i,w),$(i,T),$(i,L),$(i,R),$(i,z),$(e,I),N&&N.m(e,null),F=!0},p(W,se){(!F||se&1)&&o!==(o=W[0].before.toLocaleString()+"")&&St(u,o),(!F||se&1)&&g!==(g=W[0].after.toLocaleString()+"")&&St(y,g),(!F||se&1)&&D!==(D=Math.round(100*W[0].after/W[0].before)+"")&&St(R,D),W[1].length>0?N?(N.p(W,se),se&2&&j(N,1)):(N=A1(W),N.c(),j(N,1),N.m(e,null)):N&&(tn(),G(N,1,1,()=>{N=null}),nn())},i(W){F||(j(t.$$.fragment,W),j(N),F=!0)},o(W){G(t.$$.fragment,W),G(N),F=!1},d(W){W&&V(e),fe(t),N&&N.d()}}}function R1(r){let e,t,n,i,o,u;return e=new dr({props:{data:r[5](r[2]),$$slots:{default:[wI]},$$scope:{ctx:r}}}),n=new pl({props:{lngLat:r[6](r[2]),$$slots:{default:[xI]},$$scope:{ctx:r}}}),o=new pl({props:{lngLat:r[7](r[2]),$$slots:{default:[kI]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment),i=oe(),de(o.$$.fragment)},m(a,d){he(e,a,d),q(a,t,d),he(n,a,d),q(a,i,d),he(o,a,d),u=!0},p(a,d){const p={};d&4&&(p.data=a[5](a[2])),d&16384&&(p.$$scope={dirty:d,ctx:a}),e.$set(p);const g={};d&4&&(g.lngLat=a[6](a[2])),d&16384&&(g.$$scope={dirty:d,ctx:a}),n.$set(g);const y={};d&4&&(y.lngLat=a[7](a[2])),d&16384&&(y.$$scope={dirty:d,ctx:a}),o.$set(y)},i(a){u||(j(e.$$.fragment,a),j(n.$$.fragment,a),j(o.$$.fragment,a),u=!0)},o(a){G(e.$$.fragment,a),G(n.$$.fragment,a),G(o.$$.fragment,a),u=!1},d(a){a&&(V(t),V(i)),fe(e,a),fe(n,a),fe(o,a)}}}function wI(r){let e,t;const n=[dn("predict-impact"),{paint:{"line-width":Po(["get","kind"],{focus:8},5),"line-color":Po(["get","kind"],{focus:"black",before:"red",after:"blue"},"cyan"),"line-opacity":Po(["get","kind"],{focus:1},.5)}}];let i={};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new tr({props:i}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function xI(r){let e;return{c(){e=xe("A")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function kI(r){let e;return{c(){e=xe("B")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function SI(r){let e,t,n,i,o=r[1].length>0&&R1(r);return n=new Ra({}),{c(){e=U("div"),o&&o.c(),t=oe(),de(n.$$.fragment),ue(e,"slot","map")},m(u,a){q(u,e,a),o&&o.m(e,null),$(e,t),he(n,e,null),i=!0},p(u,a){u[1].length>0?o?(o.p(u,a),a&2&&j(o,1)):(o=R1(u),o.c(),j(o,1),o.m(e,t)):o&&(tn(),G(o,1,1,()=>{o=null}),nn())},i(u){i||(j(o),j(n.$$.fragment,u),i=!0)},o(u){G(o),G(n.$$.fragment,u),i=!1},d(u){u&&V(e),o&&o.d(),fe(n)}}}function CI(r){let e,t,n,i;return e=new kh({props:{loading:r[3]}}),n=new _o({props:{$$slots:{map:[SI],sidebar:[vI],top:[bI]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment)},m(o,u){he(e,o,u),q(o,t,u),he(n,o,u),i=!0},p(o,[u]){const a={};u&8&&(a.loading=o[3]),e.$set(a);const d={};u&16407&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(j(e.$$.fragment,o),j(n.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),G(n.$$.fragment,o),i=!1},d(o){o&&V(t),fe(e,o),fe(n,o)}}}function TI(r,e,t){let n,i,o;st(r,an,z=>t(4,n=z)),st(r,om,z=>t(12,i=z)),st(r,Ir,z=>t(13,o=z));let{road:u}=e,a=u.properties;a.kind="focus";let d=[],p=0,g="Finding changes to this road";Ts(async()=>{await new Promise(z=>{requestAnimationFrame(()=>{requestAnimationFrame(z)})}),t(1,d=o.getImpactsOnRoad(a.id,i)),t(3,g=""),d.length==0&&(window.alert("No routes over this road change. (This is a bug in progress of being fixed.)"),Ot(an,n={mode:"predict-impact"},n))});function y(z){return{type:"FeatureCollection",features:[d[z].before,d[z].after,u].filter(I=>I!=null)}}function w(z){return d[z].before!=null?d[z].before.geometry.coordinates[0]:d[z].after.geometry.coordinates[0]}function T(z){let I=d[z].before!=null?d[z].before.geometry.coordinates:d[z].after.geometry.coordinates;return I[I.length-1]}const L=()=>Ot(an,n={mode:"predict-impact"},n);function D(z){p=z,t(2,p)}const R=()=>Ot(an,n={mode:"pick-neighbourhood"},n);return r.$$set=z=>{"road"in z&&t(8,u=z.road)},[a,d,p,g,n,y,w,T,u,L,D,R]}class MI extends It{constructor(e){super(),Et(this,e,TI,CI,xt,{road:8})}}function LI(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function EI(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function II(r){let e;return{c(){e=xe("Editing")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function AI(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L;return o=new Rn({props:{$$slots:{default:[LI]},$$scope:{ctx:r}}}),o.$on("click",$o),d=new Rn({props:{$$slots:{default:[EI]},$$scope:{ctx:r}}}),d.$on("click",r[14]),y=new Rn({props:{$$slots:{default:[II]},$$scope:{ctx:r}}}),y.$on("click",r[7]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),de(o.$$.fragment),u=oe(),a=U("li"),de(d.$$.fragment),p=oe(),g=U("li"),de(y.$$.fragment),w=oe(),T=U("li"),T.textContent="Impact routing to one destination",ue(t,"aria-label","breadcrumb"),ue(e,"slot","top")},m(D,R){q(D,e,R),$(e,t),$(t,n),$(n,i),he(o,i,null),$(n,u),$(n,a),he(d,a,null),$(n,p),$(n,g),he(y,g,null),$(n,w),$(n,T),L=!0},p(D,R){const z={};R&524288&&(z.$$scope={dirty:R,ctx:D}),o.$set(z);const I={};R&524288&&(I.$$scope={dirty:R,ctx:D}),d.$set(I);const F={};R&524288&&(F.$$scope={dirty:R,ctx:D}),y.$set(F)},i(D){L||(j(o.$$.fragment,D),j(d.$$.fragment,D),j(y.$$.fragment,D),L=!0)},o(D){G(o.$$.fragment,D),G(d.$$.fragment,D),G(y.$$.fragment,D),L=!1},d(D){D&&V(e),fe(o),fe(d),fe(y)}}}function PI(r){let e;return{c(){e=U("p"),e.textContent="Hover on a road to compare"},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function zI(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function DI(r){let e,t=Ca(r[4].properties.distance)+"",n,i,o=Ta(r[4].properties.time)+"",u;return{c(){e=U("p"),n=xe(t),i=xe(", "),u=xe(o)},m(a,d){q(a,e,d),$(e,n),$(e,i),$(e,u)},p(a,d){d&16&&t!==(t=Ca(a[4].properties.distance)+"")&&St(n,t),d&16&&o!==(o=Ta(a[4].properties.time)+"")&&St(u,o)},d(a){a&&V(e)}}}function RI(r){let e;return{c(){e=U("p"),e.textContent="Hover on a road to compare"},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function $I(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function FI(r){let e,t=Ca(r[3].properties.distance)+"",n,i,o=Ta(r[3].properties.time)+"",u;return{c(){e=U("p"),n=xe(t),i=xe(", "),u=xe(o)},m(a,d){q(a,e,d),$(e,n),$(e,i),$(e,u)},p(a,d){d&8&&t!==(t=Ca(a[3].properties.distance)+"")&&St(n,t),d&8&&o!==(o=Ta(a[3].properties.time)+"")&&St(u,o)},d(a){a&&V(e)}}}function BI(r){let e,t,n,i,o,u,a,d,p,g,y;t=new Ys({}),t.$on("click",r[7]);function w(I,F){return I[4]?DI:I[3]?zI:PI}let T=w(r),L=T(r);function D(I,F){return I[3]?FI:I[4]?$I:RI}let R=D(r),z=R(r);return{c(){e=U("div"),de(t.$$.fragment),n=oe(),i=U("p"),i.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin around to change that destination.`,o=oe(),u=U("u"),u.textContent="Route before changes",a=oe(),L.c(),d=oe(),p=U("u"),p.textContent="Route after changes",g=oe(),z.c(),ut(u,"color","red"),ut(p,"color","blue"),ue(e,"slot","sidebar")},m(I,F){q(I,e,F),he(t,e,null),$(e,n),$(e,i),$(e,o),$(e,u),$(e,a),L.m(e,null),$(e,d),$(e,p),$(e,g),z.m(e,null),y=!0},p(I,F){T===(T=w(I))&&L?L.p(I,F):(L.d(1),L=T(I),L&&(L.c(),L.m(e,d))),R===(R=D(I))&&z?z.p(I,F):(z.d(1),z=R(I),z&&(z.c(),z.m(e,null)))},i(I){y||(j(t.$$.fragment,I),y=!0)},o(I){G(t.$$.fragment,I),y=!1},d(I){I&&V(e),fe(t),L.d(),z.d()}}}function OI(r){let e,t;const n=[dn("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let i={};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new Pi({props:i}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function NI(r){let e,t,n=(r[18].time_after/r[18].time_before).toFixed(1)+"",i;return{c(){e=U("p"),t=xe("Time ratio: "),i=xe(n)},m(o,u){q(o,e,u),$(e,t),$(e,i)},p(o,u){u&262144&&n!==(n=(o[18].time_after/o[18].time_before).toFixed(1)+"")&&St(i,n)},d(o){o&&V(e)}}}function jI(r){let e,t;return e=new fi({props:{openOn:"hover",$$slots:{default:[NI,({props:n})=>({18:n}),({props:n})=>n?262144:0]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&786432&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function UI(r){let e,t,n;const i=[dn("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(r[5].highest_time_ratio,1.1),"red"],"line-width":5}},{manageHoverState:!0}];function o(a){r[11](a)}let u={$$slots:{default:[jI]},$$scope:{ctx:r}};for(let a=0;a<i.length;a+=1)u=Gt(u,i[a]);return r[0]!==void 0&&(u.hovered=r[0]),e=new tr({props:u}),un.push(()=>Cn(e,"hovered",o)),e.$on("click",r[12]),{c(){de(e.$$.fragment)},m(a,d){he(e,a,d),n=!0},p(a,d){const p=d&32?Zn(i,[i[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(a[5].highest_time_ratio,1.1),"red"],"line-width":5}},i[2]]):{};d&524288&&(p.$$scope={dirty:d,ctx:a}),!t&&d&1&&(t=!0,p.hovered=a[0],Sn(()=>t=!1)),e.$set(p)},i(a){n||(j(e.$$.fragment,a),n=!0)},o(a){G(e.$$.fragment,a),n=!1},d(a){fe(e,a)}}}function VI(r){let e,t;const n=[dn("compare-route"),{interactive:!1},{paint:{"line-width":10,"line-color":Po(["get","kind"],{before:"red",after:"blue"},"red")}}];let i={};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new tr({props:i}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function qI(r){let e;return{c(){e=xe("X")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function ZI(r){let e,t,n,i,o,u,a,d,p,g,y,w;t=new Ih({props:{$$slots:{default:[OI]},$$scope:{ctx:r}}}),i=new dr({props:{data:r[5],generateId:!0,$$slots:{default:[UI]},$$scope:{ctx:r}}}),u=new dr({props:{data:r[1],$$slots:{default:[VI]},$$scope:{ctx:r}}}),d=new Ra({});function T(D){r[13](D)}let L={draggable:!0,$$slots:{default:[qI]},$$scope:{ctx:r}};return r[2]!==void 0&&(L.lngLat=r[2]),g=new pl({props:L}),un.push(()=>Cn(g,"lngLat",T)),{c(){e=U("div"),de(t.$$.fragment),n=oe(),de(i.$$.fragment),o=oe(),de(u.$$.fragment),a=oe(),de(d.$$.fragment),p=oe(),de(g.$$.fragment),ue(e,"slot","map")},m(D,R){q(D,e,R),he(t,e,null),$(e,n),he(i,e,null),$(e,o),he(u,e,null),$(e,a),he(d,e,null),$(e,p),he(g,e,null),w=!0},p(D,R){const z={};R&524288&&(z.$$scope={dirty:R,ctx:D}),t.$set(z);const I={};R&32&&(I.data=D[5]),R&524321&&(I.$$scope={dirty:R,ctx:D}),i.$set(I);const F={};R&2&&(F.data=D[1]),R&524288&&(F.$$scope={dirty:R,ctx:D}),u.$set(F);const N={};R&524288&&(N.$$scope={dirty:R,ctx:D}),!y&&R&4&&(y=!0,N.lngLat=D[2],Sn(()=>y=!1)),g.$set(N)},i(D){w||(j(t.$$.fragment,D),j(i.$$.fragment,D),j(u.$$.fragment,D),j(d.$$.fragment,D),j(g.$$.fragment,D),w=!0)},o(D){G(t.$$.fragment,D),G(i.$$.fragment,D),G(u.$$.fragment,D),G(d.$$.fragment,D),G(g.$$.fragment,D),w=!1},d(D){D&&V(e),fe(t),fe(i),fe(u),fe(d),fe(g)}}}function GI(r){let e,t,n,i;return e=new Zm({}),e.$on("contextmenu",r[9]),n=new _o({props:{$$slots:{map:[ZI],sidebar:[BI],top:[AI]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment)},m(o,u){he(e,o,u),q(o,t,u),he(n,o,u),i=!0},p(o,[u]){const a={};u&524415&&(a.$$scope={dirty:u,ctx:o}),n.$set(a)},i(o){i||(j(e.$$.fragment,o),j(n.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),G(n.$$.fragment,o),i=!1},d(o){o&&V(t),fe(e,o),fe(n,o)}}}function HI(r,e,t){let n,i,o,u,a,d,p,g,y;st(r,Nf,W=>t(2,a=W)),st(r,an,W=>t(6,d=W)),st(r,oh,W=>t(15,p=W)),st(r,ih,W=>t(16,g=W)),st(r,Ir,W=>t(10,y=W));function w(){Ot(an,d={mode:"neighbourhood"},d)}let T=null;Ts(()=>{setTimeout(()=>{a&&am(Nf)},10)});function L(W){return W?y.compareRoute(new Hs.LngLat(W.properties.pt1_x,W.properties.pt1_y),a,1):Hi()}function D(W){Ot(ih,g=new Hs.LngLat(W.properties.pt1_x,W.properties.pt1_y),g),Ot(oh,p=a,p),Ot(an,d={mode:"route",prevMode:"impact-one-destination"},d)}function R(W){Ot(Nf,a=W.detail.lngLat,a)}function z(W){T=W,t(0,T)}const I=W=>D(W.detail.features[0]);function F(W){a=W,Nf.set(a)}const N=()=>Ot(an,d={mode:"pick-neighbourhood"},d);return r.$$.update=()=>{r.$$.dirty&1028&&t(5,n=y.impactToOneDestination(a)),r.$$.dirty&1&&t(1,i=L(T)),r.$$.dirty&2&&t(4,o=i.features.find(W=>W.properties.kind=="before")),r.$$.dirty&2&&t(3,u=i.features.find(W=>W.properties.kind=="after"))},[T,i,a,u,o,n,d,w,D,R,y,z,I,F,N]}class WI extends It{constructor(e){super(),Et(this,e,HI,GI,xt,{})}}function $1(r,e,t){const n=r.slice();return n[31]=e[t].properties.name,n}function KI(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function XI(r){let e;return{c(){e=U("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function JI(r){let e;return{c(){e=xe("Route")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function YI(r){let e;return{c(){e=xe("Predict impact")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function F1(r){let e,t,n;return t=new Rn({props:{$$slots:{default:[QI]},$$scope:{ctx:r}}}),t.$on("click",r[29]),{c(){e=U("li"),de(t.$$.fragment)},m(i,o){q(i,e,o),he(t,e,null),n=!0},p(i,o){const u={};o[1]&8&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&V(e),fe(t)}}}function QI(r){let e;return{c(){e=xe("Debug intersections")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function eA(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L,D,R,z,I,F;o=new Rn({props:{$$slots:{default:[KI]},$$scope:{ctx:r}}}),o.$on("click",$o),p=new Wm({props:{$$slots:{default:[XI]},$$scope:{ctx:r}}}),L=new Rn({props:{$$slots:{default:[JI]},$$scope:{ctx:r}}}),L.$on("click",r[27]),z=new Rn({props:{$$slots:{default:[YI]},$$scope:{ctx:r}}}),z.$on("click",r[28]);let N=r[9]&&F1(r);return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),de(o.$$.fragment),u=oe(),a=U("li"),d=xe(`Pick neighbourhood
          `),de(p.$$.fragment),g=oe(),y=U("nav"),w=U("ul"),T=U("li"),de(L.$$.fragment),D=oe(),R=U("li"),de(z.$$.fragment),I=oe(),N&&N.c(),ue(t,"aria-label","breadcrumb"),ue(e,"slot","top"),ut(e,"display","flex"),ut(e,"justify-content","space-between")},m(W,se){q(W,e,se),$(e,t),$(t,n),$(n,i),he(o,i,null),$(n,u),$(n,a),$(a,d),he(p,a,null),$(e,g),$(e,y),$(y,w),$(w,T),he(L,T,null),$(w,D),$(w,R),he(z,R,null),$(w,I),N&&N.m(w,null),F=!0},p(W,se){const J={};se[1]&8&&(J.$$scope={dirty:se,ctx:W}),o.$set(J);const Y={};se[1]&8&&(Y.$$scope={dirty:se,ctx:W}),p.$set(Y);const _e={};se[1]&8&&(_e.$$scope={dirty:se,ctx:W}),L.$set(_e);const ze={};se[1]&8&&(ze.$$scope={dirty:se,ctx:W}),z.$set(ze),W[9]?N?(N.p(W,se),se[0]&512&&j(N,1)):(N=F1(W),N.c(),j(N,1),N.m(w,null)):N&&(tn(),G(N,1,1,()=>{N=null}),nn())},i(W){F||(j(o.$$.fragment,W),j(p.$$.fragment,W),j(L.$$.fragment,W),j(z.$$.fragment,W),j(N),F=!0)},o(W){G(o.$$.fragment,W),G(p.$$.fragment,W),G(L.$$.fragment,W),G(z.$$.fragment,W),G(N),F=!1},d(W){W&&V(e),fe(o),fe(p),fe(L),fe(z),N&&N.d()}}}function tA(r){let e=r[31]+"",t;return{c(){t=xe(e)},m(n,i){q(n,t,i)},p(n,i){i[0]&1&&e!==(e=n[31]+"")&&St(t,e)},d(n){n&&V(t)}}}function B1(r){let e,t,n,i,o,u,a,d,p,g,y,w,T;function L(){return r[20](r[31])}n=new Rn({props:{$$slots:{default:[tA]},$$scope:{ctx:r}}}),n.$on("click",L),a=new Nb({props:{color:"black"}});function D(){return r[21](r[31])}g=new Um({props:{color:"white"}});function R(){return r[22](r[31])}function z(){return r[23](r[31])}return{c(){var I;e=U("li"),t=U("h3"),de(n.$$.fragment),i=oe(),o=U("span"),u=U("button"),de(a.$$.fragment),d=oe(),p=U("button"),de(g.$$.fragment),ue(u,"class","outline icon-btn"),ue(u,"title","Rename neighbourhood"),ue(p,"class","icon-btn destructive"),ue(p,"title","Delete neighbourhood"),ue(o,"class","actions"),ue(e,"class","actionable-cell svelte-qhjp0j"),Yt(e,"highlighted",((I=r[3])==null?void 0:I.properties.name)==r[31]||r[2]==r[31])},m(I,F){q(I,e,F),$(e,t),he(n,t,null),$(e,i),$(e,o),$(o,u),he(a,u,null),$(o,d),$(o,p),he(g,p,null),y=!0,w||(T=[yt(u,"click",D),yt(p,"click",R),yt(e,"mouseenter",z),yt(e,"mouseleave",r[24])],w=!0)},p(I,F){var W;r=I;const N={};F[0]&1|F[1]&8&&(N.$$scope={dirty:F,ctx:r}),n.$set(N),(!y||F[0]&13)&&Yt(e,"highlighted",((W=r[3])==null?void 0:W.properties.name)==r[31]||r[2]==r[31])},i(I){y||(j(n.$$.fragment,I),j(a.$$.fragment,I),j(g.$$.fragment,I),y=!0)},o(I){G(n.$$.fragment,I),G(a.$$.fragment,I),G(g.$$.fragment,I),y=!1},d(I){I&&V(e),fe(n),fe(a),fe(g),w=!1,mr(T)}}}function nA(r){let e,t,n;return e=new Sk({}),{c(){de(e.$$.fragment),t=xe(`
          Add a new neighbourhood`)},m(i,o){he(e,i,o),q(i,t,o),n=!0},i(i){n||(j(e.$$.fragment,i),n=!0)},o(i){G(e.$$.fragment,i),n=!1},d(i){i&&V(t),fe(e,i)}}}function O1(r){let e,t,n,i,o,u,a,d,p;function g(w){r[26](w)}let y={};return r[1]!==void 0&&(y.selectedPrioritization=r[1]),o=new Bv({props:y}),un.push(()=>Cn(o,"selectedPrioritization",g)),{c(){e=U("h3"),e.textContent="Prioritization",t=oe(),n=U("p"),n.textContent="Compare metrics across your neighbourhoods.",i=oe(),de(o.$$.fragment),a=oe(),d=U("hr")},m(w,T){q(w,e,T),q(w,t,T),q(w,n,T),q(w,i,T),he(o,w,T),q(w,a,T),q(w,d,T),p=!0},p(w,T){const L={};!u&&T[0]&2&&(u=!0,L.selectedPrioritization=w[1],Sn(()=>u=!1)),o.$set(L)},i(w){p||(j(o.$$.fragment,w),p=!0)},o(w){G(o.$$.fragment,w),p=!1},d(w){w&&(V(e),V(t),V(n),V(i),V(a),V(d)),fe(o,w)}}}function N1(r){let e,t,n;return{c(){e=U("button"),e.textContent="Debug route-snapper",ue(e,"class","secondary")},m(i,o){q(i,e,o),t||(n=yt(e,"click",r[13]),t=!0)},p:rt,d(i){i&&V(e),t=!1,n()}}}function rA(r){let e,t,n,i=r[6].projectName(Er(r[7]))+"",o,u,a,d,p,g,y,w,T,L,D,R,z,I,F,N,W,se=r[4].modalFilters+"",J,Y,_e,ze,ee=r[4].deletedModalFilters+"",ae,Ee,we,it,Ge=r[4].travelFlows+"",Ie,De,Ct,nt,lt,mt;p=new Ob({props:{color:"black"}});let ht=$n(r[0].features),We=[];for(let Mt=0;Mt<ht.length;Mt+=1)We[Mt]=B1($1(r,ht,Mt));const Bt=Mt=>G(We[Mt],1,1,()=>{We[Mt]=null});I=new Rn({props:{$$slots:{default:[nA]},$$scope:{ctx:r}}}),I.$on("click",r[25]);let Lt=r[8]=="cnt"&&O1(r),Nt=r[9]&&N1(r);return{c(){e=U("div"),t=U("div"),n=U("h1"),o=xe(i),u=oe(),a=U("button"),d=U("div"),de(p.$$.fragment),g=oe(),y=U("span"),y.textContent="Export",w=oe(),T=U("h2"),T.textContent="Neighbourhoods",L=oe(),D=U("ul");for(let Mt=0;Mt<We.length;Mt+=1)We[Mt].c();R=oe(),z=U("li"),de(I.$$.fragment),F=oe(),Lt&&Lt.c(),N=oe(),W=U("p"),J=xe(se),Y=xe(" new modal filter(s) added"),_e=oe(),ze=U("p"),ae=xe(ee),Ee=xe(`
      existing modal filter(s) removed`),we=oe(),it=U("p"),Ie=xe(Ge),De=xe(" road segment direction(s) changed"),Ct=oe(),Nt&&Nt.c(),ut(y,"margin-right","2px"),ut(d,"display","flex"),ut(d,"align-items","center"),ut(d,"gap","8px"),ue(a,"class","outline icon-btn"),ut(a,"margin-right","8px"),ue(a,"title","Download project as GeoJSON"),ut(t,"display","flex"),ut(t,"justify-content","space-between"),ut(t,"align-items","center"),ut(t,"gap","16px"),ue(D,"class","navigable-list"),ue(e,"slot","sidebar")},m(Mt,Qt){q(Mt,e,Qt),$(e,t),$(t,n),$(n,o),$(t,u),$(t,a),$(a,d),he(p,d,null),$(d,g),$(d,y),$(e,w),$(e,T),$(e,L),$(e,D);for(let bt=0;bt<We.length;bt+=1)We[bt]&&We[bt].m(D,null);$(D,R),$(D,z),he(I,z,null),$(e,F),Lt&&Lt.m(e,null),$(e,N),$(e,W),$(W,J),$(W,Y),$(e,_e),$(e,ze),$(ze,ae),$(ze,Ee),$(e,we),$(e,it),$(it,Ie),$(it,De),$(e,Ct),Nt&&Nt.m(e,null),nt=!0,lt||(mt=yt(a,"click",r[19]),lt=!0)},p(Mt,Qt){if((!nt||Qt[0]&192)&&i!==(i=Mt[6].projectName(Er(Mt[7]))+"")&&St(o,i),Qt[0]&7181){ht=$n(Mt[0].features);let Dt;for(Dt=0;Dt<ht.length;Dt+=1){const pn=$1(Mt,ht,Dt);We[Dt]?(We[Dt].p(pn,Qt),j(We[Dt],1)):(We[Dt]=B1(pn),We[Dt].c(),j(We[Dt],1),We[Dt].m(D,R))}for(tn(),Dt=ht.length;Dt<We.length;Dt+=1)Bt(Dt);nn()}const bt={};Qt[1]&8&&(bt.$$scope={dirty:Qt,ctx:Mt}),I.$set(bt),Mt[8]=="cnt"?Lt?(Lt.p(Mt,Qt),Qt[0]&256&&j(Lt,1)):(Lt=O1(Mt),Lt.c(),j(Lt,1),Lt.m(e,N)):Lt&&(tn(),G(Lt,1,1,()=>{Lt=null}),nn()),(!nt||Qt[0]&16)&&se!==(se=Mt[4].modalFilters+"")&&St(J,se),(!nt||Qt[0]&16)&&ee!==(ee=Mt[4].deletedModalFilters+"")&&St(ae,ee),(!nt||Qt[0]&16)&&Ge!==(Ge=Mt[4].travelFlows+"")&&St(Ie,Ge),Mt[9]?Nt?Nt.p(Mt,Qt):(Nt=N1(Mt),Nt.c(),Nt.m(e,null)):Nt&&(Nt.d(1),Nt=null)},i(Mt){if(!nt){j(p.$$.fragment,Mt);for(let Qt=0;Qt<ht.length;Qt+=1)j(We[Qt]);j(I.$$.fragment,Mt),j(Lt),nt=!0}},o(Mt){G(p.$$.fragment,Mt),We=We.filter(Boolean);for(let Qt=0;Qt<We.length;Qt+=1)G(We[Qt]);G(I.$$.fragment,Mt),G(Lt),nt=!1},d(Mt){Mt&&V(e),fe(p),mi(We,Mt),fe(I),Lt&&Lt.d(),Nt&&Nt.d(),lt=!1,mt()}}}function iA(r){let e,t,n=(r[30].number_pois/r[30].area_km2).toFixed(1)+"",i,o;return{c(){e=U("b"),e.textContent="Points of interest:",t=oe(),i=xe(n),o=xe(" / km")},m(u,a){q(u,e,a),q(u,t,a),q(u,i,a),q(u,o,a)},p(u,a){a[0]&1073741824&&n!==(n=(u[30].number_pois/u[30].area_km2).toFixed(1)+"")&&St(i,n)},d(u){u&&(V(e),V(t),V(i),V(o))}}}function oA(r){let e,t,n=(r[30].number_stats19_collisions/r[30].area_km2).toFixed(1)+"",i,o;return{c(){e=U("b"),e.textContent="Pedestrian and cyclist collisions:",t=oe(),i=xe(n),o=xe(" / km")},m(u,a){q(u,e,a),q(u,t,a),q(u,i,a),q(u,o,a)},p(u,a){a[0]&1073741824&&n!==(n=(u[30].number_stats19_collisions/u[30].area_km2).toFixed(1)+"")&&St(i,n)},d(u){u&&(V(e),V(t),V(i),V(o))}}}function sA(r){let e,t,n=Math.round(r[30].population/r[30].area_km2).toLocaleString()+"",i,o;return{c(){e=U("b"),e.textContent="Population density:",t=oe(),i=xe(n),o=xe(` people
            / km`)},m(u,a){q(u,e,a),q(u,t,a),q(u,i,a),q(u,o,a)},p(u,a){a[0]&1073741824&&n!==(n=Math.round(u[30].population/u[30].area_km2).toLocaleString()+"")&&St(i,n)},d(u){u&&(V(e),V(t),V(i),V(o))}}}function aA(r){let e,t=r[30].name+"",n,i,o;function u(p,g){if(p[1]=="density")return sA;if(p[1]=="stats19")return oA;if(p[1]=="pois")return iA}let a=u(r),d=a&&a(r);return{c(){e=U("h2"),n=xe(t),i=oe(),d&&d.c(),o=Jn()},m(p,g){q(p,e,g),$(e,n),q(p,i,g),d&&d.m(p,g),q(p,o,g)},p(p,g){g[0]&1073741824&&t!==(t=p[30].name+"")&&St(n,t),a===(a=u(p))&&d?d.p(p,g):(d&&d.d(1),d=a&&a(p),d&&(d.c(),d.m(o.parentNode,o)))},d(p){p&&(V(e),V(i),V(o)),d&&d.d(p)}}}function lA(r){let e,t;return e=new fi({props:{openOn:"hover",$$slots:{default:[aA,({props:n})=>({30:n}),({props:n})=>[n?1073741824:0]]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i[0]&1073741826|i[1]&8&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function cA(r){let e,t,n,i,o,u,a,d,p;e=new m3({props:{data:r[2]?[{name:r[2],highlight:"yes"}]:[],idCol:"name"}});const g=[{filter:["==",["get","kind"],"boundary"]},dn("neighbourhood-boundaries-selected-outline",!1),{manageHoverState:!1},{paint:{"line-color":"black","line-width":4,"line-dasharray":[2,2]}}];let y={};for(let z=0;z<g.length;z+=1)y=Gt(y,g[z]);n=new tr({props:y});const w=[{filter:["==",["get","kind"],"boundary"]},dn("neighbourhood-boundaries-selected-outline-base",!1),{manageHoverState:!1},{paint:{"line-color":"white","line-width":8,"line-opacity":.7}}];let T={};for(let z=0;z<w.length;z+=1)T=Gt(T,w[z]);o=new tr({props:T});const L=[dn("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":r[14](r[1]),"fill-opacity":r[15](r[1])}},{manageHoverState:!0},{hoverCursor:"pointer"}];function D(z){r[17](z)}let R={$$slots:{default:[lA]},$$scope:{ctx:r}};for(let z=0;z<L.length;z+=1)R=Gt(R,L[z]);return r[3]!==void 0&&(R.hovered=r[3]),a=new Pi({props:R}),un.push(()=>Cn(a,"hovered",D)),a.$on("click",r[18]),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment),i=oe(),de(o.$$.fragment),u=oe(),de(a.$$.fragment)},m(z,I){he(e,z,I),q(z,t,I),he(n,z,I),q(z,i,I),he(o,z,I),q(z,u,I),he(a,z,I),p=!0},p(z,I){const F={};I[0]&4&&(F.data=z[2]?[{name:z[2],highlight:"yes"}]:[]),e.$set(F);const N={};n.$set(N);const W={};o.$set(W);const se=I[0]&49154?Zn(L,[L[0],L[1],{paint:{"fill-color":z[14](z[1]),"fill-opacity":z[15](z[1])}},L[3],L[4]]):{};I[0]&2|I[1]&8&&(se.$$scope={dirty:I,ctx:z}),!d&&I[0]&8&&(d=!0,se.hovered=z[3],Sn(()=>d=!1)),a.$set(se)},i(z){p||(j(e.$$.fragment,z),j(n.$$.fragment,z),j(o.$$.fragment,z),j(a.$$.fragment,z),p=!0)},o(z){G(e.$$.fragment,z),G(n.$$.fragment,z),G(o.$$.fragment,z),G(a.$$.fragment,z),p=!1},d(z){z&&(V(t),V(i),V(u)),fe(e,z),fe(n,z),fe(o,z),fe(a,z)}}}function uA(r){let e,t,n,i,o;return t=new dr({props:{data:r[0],promoteId:"name",$$slots:{default:[cA]},$$scope:{ctx:r}}}),i=new Ra({}),{c(){e=U("div"),de(t.$$.fragment),n=oe(),de(i.$$.fragment),ue(e,"slot","map")},m(u,a){q(u,e,a),he(t,e,null),$(e,n),he(i,e,null),o=!0},p(u,a){const d={};a[0]&1&&(d.data=u[0]),a[0]&14|a[1]&8&&(d.$$scope={dirty:a,ctx:u}),t.$set(d)},i(u){o||(j(t.$$.fragment,u),j(i.$$.fragment,u),o=!0)},o(u){G(t.$$.fragment,u),G(i.$$.fragment,u),o=!1},d(u){u&&V(e),fe(t),fe(i)}}}function hA(r){let e,t;return e=new _o({props:{$$slots:{map:[uA],sidebar:[rA],top:[eA]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i[0]&1023|i[1]&8&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function fA(r){let e=0,t=0,n=0;for(let i of r.features)i.properties.kind=="modal_filter"?e++:i.properties.kind=="deleted_existing_modal_filter"?t++:i.properties.kind=="travel_flow"&&n++;return{modalFilters:e,deletedModalFilters:t,travelFlows:n}}function dA(r,e,t){let n,i,o,u,a,d,p,g;st(r,Ir,Ie=>t(16,o=Ie)),st(r,an,Ie=>t(5,u=Ie)),st(r,Xs,Ie=>t(6,a=Ie)),st(r,dl,Ie=>t(7,d=Ie)),st(r,Ro,Ie=>t(8,p=Ie)),st(r,ad,Ie=>t(9,g=Ie));let y="none",w=null,T=null;function L(Ie){o.setCurrentNeighbourhood(Ie),Ot(an,u={mode:"neighbourhood"},u)}function D(Ie){window.confirm(`Really delete neighbourhood ${Ie}? You can't undo this.`)&&(o.deleteNeighbourhoodBoundary(Ie),dh(),t(0,n=o.getAllNeighbourhoods()))}function R(Ie){let De=Fv(o,`Rename neighbourhood ${Ie} to what?`,Ie);De&&(o.renameNeighbourhoodBoundary(Ie,De),dh(),t(0,n=o.getAllNeighbourhoods()))}function z(){gd("debug_route_snapper.geojson",o.toRouteSnapperGj())}function I(Ie){let De=po.mapFeature.hover.backgroundColor,Ct=Ov({none:De},Ie);return["case",["==",["feature-state","highlight"],"yes"],De,Ct]}function F(Ie){let De=.7;return{none:["case",["==",["feature-state","highlight"],"yes"],De,Wn(.3,De)],area:Wn(.7,.9),density:Wn(.7,.9),simd:Wn(.7,.9),stats19:Wn(.7,.9),pois:Wn(.7,.9),car_ownership:Wn(.7,.9)}[Ie]}function N(Ie){T=Ie,t(3,T)}const W=Ie=>L(Er(Ie.detail.features[0].properties).name),se=()=>pv(Er(d)),J=Ie=>L(Ie),Y=Ie=>R(Ie),_e=Ie=>D(Ie),ze=Ie=>t(2,w=Ie),ee=()=>t(2,w=null),ae=()=>Ot(an,u={mode:"add-neighbourhood"},u);function Ee(Ie){y=Ie,t(1,y)}const we=()=>Ot(an,u={mode:"route",prevMode:"pick-neighbourhood"},u),it=()=>Ot(an,u={mode:"predict-impact"},u),Ge=()=>Ot(an,u={mode:"debug-intersections"},u);return r.$$.update=()=>{r.$$.dirty[0]&65536&&t(0,n=o.getAllNeighbourhoods()),r.$$.dirty[0]&1&&t(4,i=fA(n))},[n,y,w,T,i,u,a,d,p,g,L,D,R,z,I,F,o,N,W,se,J,Y,_e,ze,ee,ae,Ee,we,it,Ge]}class pA extends It{constructor(e){super(),Et(this,e,dA,hA,xt,{},null,[-1,-1])}}function mA(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function _A(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function gA(r){let e,t,n,i,o,u,a,d,p,g,y;return o=new Rn({props:{$$slots:{default:[mA]},$$scope:{ctx:r}}}),o.$on("click",$o),d=new Rn({props:{$$slots:{default:[_A]},$$scope:{ctx:r}}}),d.$on("click",r[17]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),de(o.$$.fragment),u=oe(),a=U("li"),de(d.$$.fragment),p=oe(),g=U("li"),g.textContent="Predict impact",ue(t,"aria-label","breadcrumb"),ue(e,"slot","top")},m(w,T){q(w,e,T),$(e,t),$(t,n),$(n,i),he(o,i,null),$(n,u),$(n,a),he(d,a,null),$(n,p),$(n,g),y=!0},p(w,T){const L={};T&2097152&&(L.$$scope={dirty:T,ctx:w}),o.$set(L);const D={};T&2097152&&(D.$$scope={dirty:T,ctx:w}),d.$set(D)},i(w){y||(j(o.$$.fragment,w),j(d.$$.fragment,w),y=!0)},o(w){G(o.$$.fragment,w),G(d.$$.fragment,w),y=!1},d(w){w&&V(e),fe(o),fe(d)}}}function yA(r){let e;return{c(){e=xe("Explore the origin/destination demand data used")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function bA(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L,D,R,z,I,F,N,W,se,J,Y,_e,ze,ee;return t=new Ys({}),t.$on("click",r[11]),u=new Rn({props:{$$slots:{default:[yA]},$$scope:{ctx:r}}}),u.$on("click",r[12]),J=new Fo({props:{colorScale:r[5],labels:{limits:["0%","50%","same","150%","200%"]}}}),_e=Pm(r[14][0]),{c(){e=U("div"),de(t.$$.fragment),n=oe(),i=U("p"),o=xe(`This mode estimates the impact of all your changes on traffic around the
      entire area. It's based on many assumptions and must be interpreted very
      carefully. `),de(u.$$.fragment),a=oe(),d=U("fieldset"),p=U("label"),g=U("input"),y=xe(`
        Calculate quickly`),w=oe(),T=U("label"),L=U("input"),D=xe(`
        Calculate more accurately`),R=oe(),z=U("p"),z.textContent=`Red roads have increased traffic, and green roads have decreased. Thicker
      roads have more traffic after edits. If hovering on a road doesn't show
      anything, there was no change there. Click a road to see example routes
      through it that've changed.`,I=oe(),F=U("label"),N=xe(`Only show roads with at least this many daily trips before or after
      `),W=U("input"),se=oe(),de(J.$$.fragment),ue(g,"type","radio"),g.__value="fast",qn(g,g.__value),ue(L,"type","radio"),L.__value="accurate",qn(L,L.__value),ue(W,"type","number"),ue(W,"min",0),ue(e,"slot","sidebar"),_e.p(g,L)},m(ae,Ee){q(ae,e,Ee),he(t,e,null),$(e,n),$(e,i),$(i,o),he(u,i,null),$(e,a),$(e,d),$(d,p),$(p,g),g.checked=g.__value===r[2],$(p,y),$(d,w),$(d,T),$(T,L),L.checked=L.__value===r[2],$(T,D),$(e,R),$(e,z),$(e,I),$(e,F),$(F,N),$(F,W),qn(W,r[4]),$(e,se),he(J,e,null),Y=!0,ze||(ee=[yt(g,"change",r[13]),yt(g,"change",r[8]),yt(L,"change",r[15]),yt(L,"change",r[8]),yt(W,"input",r[16])],ze=!0)},p(ae,Ee){const we={};Ee&2097152&&(we.$$scope={dirty:Ee,ctx:ae}),u.$set(we),Ee&4&&(g.checked=g.__value===ae[2]),Ee&4&&(L.checked=L.__value===ae[2]),Ee&16&&hl(W.value)!==ae[4]&&qn(W,ae[4])},i(ae){Y||(j(t.$$.fragment,ae),j(u.$$.fragment,ae),j(J.$$.fragment,ae),Y=!0)},o(ae){G(t.$$.fragment,ae),G(u.$$.fragment,ae),G(J.$$.fragment,ae),Y=!1},d(ae){ae&&V(e),fe(t),fe(u),fe(J),_e.r(),ze=!1,mr(ee)}}}function vA(r){let e,t;const n=[dn("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"grey","fill-opacity":.5}}];let i={};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new Pi({props:i}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function wA(r){let e,t=r[20].before.toLocaleString()+"",n,i,o=r[20].after.toLocaleString()+"",u,a,d,p,g=Math.round(100*r[20].after/r[20].before)+"",y,w;return{c(){e=U("p"),n=xe(t),i=xe(" before, "),u=xe(o),a=xe(`
            after`),d=oe(),p=U("p"),y=xe(g),w=xe("%")},m(T,L){q(T,e,L),$(e,n),$(e,i),$(e,u),$(e,a),q(T,d,L),q(T,p,L),$(p,y),$(p,w)},p(T,L){L&1048576&&t!==(t=T[20].before.toLocaleString()+"")&&St(n,t),L&1048576&&o!==(o=T[20].after.toLocaleString()+"")&&St(u,o),L&1048576&&g!==(g=Math.round(100*T[20].after/T[20].before)+"")&&St(y,g)},d(T){T&&(V(e),V(d),V(p))}}}function xA(r){let e,t;return e=new fi({props:{openOn:"hover",$$slots:{default:[wA,({props:n})=>({20:n}),({props:n})=>n?1048576:0]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&3145728&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function kA(r){let e,t,n,i;const o=[dn("predict-impact-outline"),{filter:[">=",["max",["get","before"],["get","after"]],r[4]]},{paint:{"line-width":["interpolate",["linear"],["get","after"],0,1.5*qf,r[1].max_count,1.5*Zf],"line-color":"black"}}];let u={};for(let p=0;p<o.length;p+=1)u=Gt(u,o[p]);e=new tr({props:u});const a=[dn("predict-impact"),{filter:[">=",["max",["get","before"],["get","after"]],r[4]]},{paint:{"line-width":["interpolate",["linear"],["get","after"],0,qf,r[1].max_count,Zf],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,r[5][0],50,r[5][1],100,r[5][2],150,r[5][3],200,r[5][4]]]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let d={$$slots:{default:[xA]},$$scope:{ctx:r}};for(let p=0;p<a.length;p+=1)d=Gt(d,a[p]);return n=new tr({props:d}),n.$on("click",r[10]),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment)},m(p,g){he(e,p,g),q(p,t,g),he(n,p,g),i=!0},p(p,g){const y=g&18?Zn(o,[o[0],g&16&&{filter:[">=",["max",["get","before"],["get","after"]],p[4]]},g&2&&{paint:{"line-width":["interpolate",["linear"],["get","after"],0,1.5*qf,p[1].max_count,1.5*Zf],"line-color":"black"}}]):{};e.$set(y);const w=g&50?Zn(a,[a[0],g&16&&{filter:[">=",["max",["get","before"],["get","after"]],p[4]]},g&34&&{paint:{"line-width":["interpolate",["linear"],["get","after"],0,qf,p[1].max_count,Zf],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,p[5][0],50,p[5][1],100,p[5][2],150,p[5][3],200,p[5][4]]]}},a[3],a[4]]):{};g&2097152&&(w.$$scope={dirty:g,ctx:p}),n.$set(w)},i(p){i||(j(e.$$.fragment,p),j(n.$$.fragment,p),i=!0)},o(p){G(e.$$.fragment,p),G(n.$$.fragment,p),i=!1},d(p){p&&V(t),fe(e,p),fe(n,p)}}}function SA(r){let e,t,n,i,o,u,a;return t=new dr({props:{data:r[6],$$slots:{default:[vA]},$$scope:{ctx:r}}}),i=new dr({props:{data:r[1],generateId:!0,$$slots:{default:[kA]},$$scope:{ctx:r}}}),u=new Ra({}),{c(){e=U("div"),de(t.$$.fragment),n=oe(),de(i.$$.fragment),o=oe(),de(u.$$.fragment),ue(e,"slot","map")},m(d,p){q(d,e,p),he(t,e,null),$(e,n),he(i,e,null),$(e,o),he(u,e,null),a=!0},p(d,p){const g={};p&2097152&&(g.$$scope={dirty:p,ctx:d}),t.$set(g);const y={};p&2&&(y.data=d[1]),p&2097170&&(y.$$scope={dirty:p,ctx:d}),i.$set(y)},i(d){a||(j(t.$$.fragment,d),j(i.$$.fragment,d),j(u.$$.fragment,d),a=!0)},o(d){G(t.$$.fragment,d),G(i.$$.fragment,d),G(u.$$.fragment,d),a=!1},d(d){d&&V(e),fe(t),fe(i),fe(u)}}}function CA(r){let e,t,n,i;return e=new kh({props:{loading:r[0]}}),n=new _o({props:{$$slots:{map:[SA],sidebar:[bA],top:[gA]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment)},m(o,u){he(e,o,u),q(o,t,u),he(n,o,u),i=!0},p(o,[u]){const a={};u&1&&(a.loading=o[0]),e.$set(a);const d={};u&2097182&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(j(e.$$.fragment,o),j(n.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),G(n.$$.fragment,o),i=!1},d(o){o&&V(t),fe(e,o),fe(n,o)}}}let qf=3,Zf=10;function TA(r,e,t){let n,i,o,u;st(r,om,J=>t(9,n=J)),st(r,Ir,J=>t(18,i=J)),st(r,an,J=>t(3,o=J)),st(r,qg,J=>t(4,u=J));let a=["#1a9641","#a6d96a","white","#fdae61","#d7191c"],d="",p={type:"FeatureCollection",features:[],max_count:1},g=i.getAllNeighbourhoods();function y(J){Ot(an,o={mode:"impact-detail",road:J},o)}async function w(J){t(0,d="Calculating impact"),await new Promise(Y=>{requestAnimationFrame(()=>{requestAnimationFrame(Y)})}),t(1,p=i.predictImpact(J)),t(0,d="")}let T=n?"fast":"accurate";function L(){Ot(om,n=T=="fast",n)}const D=[[]],R=J=>y(J.detail.features[0]),z=()=>Ot(an,o={mode:"pick-neighbourhood"},o),I=()=>Ot(an,o={mode:"debug-demand"},o);function F(){T=this.__value,t(2,T)}function N(){T=this.__value,t(2,T)}function W(){u=hl(this.value),qg.set(u)}const se=()=>Ot(an,o={mode:"pick-neighbourhood"},o);return r.$$.update=()=>{r.$$.dirty&512&&w(n)},[d,p,T,o,u,a,g,y,L,n,R,z,I,F,D,N,W,se]}class MA extends It{constructor(e){super(),Et(this,e,TA,CA,xt,{})}}function LA(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function EA(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function j1(r){let e,t,n;return t=new Rn({props:{$$slots:{default:[IA]},$$scope:{ctx:r}}}),t.$on("click",r[14]),{c(){e=U("li"),de(t.$$.fragment)},m(i,o){q(i,e,o),he(t,e,null),n=!0},p(i,o){const u={};o&32768&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&V(e),fe(t)}}}function IA(r){let e;return{c(){e=xe("Editing")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function AA(r){let e,t,n,i,o,u,a,d,p,g,y,w;o=new Rn({props:{$$slots:{default:[LA]},$$scope:{ctx:r}}}),o.$on("click",$o),d=new Rn({props:{$$slots:{default:[EA]},$$scope:{ctx:r}}}),d.$on("click",r[13]);let T=r[0]=="neighbourhood"&&j1(r);return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),de(o.$$.fragment),u=oe(),a=U("li"),de(d.$$.fragment),p=oe(),T&&T.c(),g=oe(),y=U("li"),y.textContent="Routing",ue(t,"aria-label","breadcrumb"),ue(e,"slot","top")},m(L,D){q(L,e,D),$(e,t),$(t,n),$(n,i),he(o,i,null),$(n,u),$(n,a),he(d,a,null),$(n,p),T&&T.m(n,null),$(n,g),$(n,y),w=!0},p(L,D){const R={};D&32768&&(R.$$scope={dirty:D,ctx:L}),o.$set(R);const z={};D&32768&&(z.$$scope={dirty:D,ctx:L}),d.$set(z),L[0]=="neighbourhood"?T?(T.p(L,D),D&1&&j(T,1)):(T=j1(L),T.c(),j(T,1),T.m(n,g)):T&&(tn(),G(T,1,1,()=>{T=null}),nn())},i(L){w||(j(o.$$.fragment,L),j(d.$$.fragment,L),j(T),w=!0)},o(L){G(o.$$.fragment,L),G(d.$$.fragment,L),G(T),w=!1},d(L){L&&V(e),fe(o),fe(d),T&&T.d()}}}function PA(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function zA(r){let e,t=Ca(r[6].properties.distance)+"",n,i,o=Ta(r[6].properties.time)+"",u;return{c(){e=U("p"),n=xe(t),i=xe(", "),u=xe(o)},m(a,d){q(a,e,d),$(e,n),$(e,i),$(e,u)},p(a,d){d&64&&t!==(t=Ca(a[6].properties.distance)+"")&&St(n,t),d&64&&o!==(o=Ta(a[6].properties.time)+"")&&St(u,o)},d(a){a&&V(e)}}}function DA(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function RA(r){let e,t=Ca(r[5].properties.distance)+"",n,i,o=Ta(r[5].properties.time)+"",u;return{c(){e=U("p"),n=xe(t),i=xe(", "),u=xe(o)},m(a,d){q(a,e,d),$(e,n),$(e,i),$(e,u)},p(a,d){d&32&&t!==(t=Ca(a[5].properties.distance)+"")&&St(n,t),d&32&&o!==(o=Ta(a[5].properties.time)+"")&&St(u,o)},d(a){a&&V(e)}}}function $A(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L,D,R,z,I,F,N,W;t=new Ys({}),t.$on("click",r[8]);function se(ae,Ee){return ae[6]?zA:PA}let J=se(r),Y=J(r);function _e(ae,Ee){return ae[5]?RA:DA}let ze=_e(r),ee=ze(r);return{c(){e=U("div"),de(t.$$.fragment),n=oe(),i=U("p"),i.textContent="Drag markers for a route",o=oe(),u=U("u"),u.textContent="Route before changes",a=oe(),Y.c(),d=oe(),p=U("u"),p.textContent="Route after changes",g=oe(),ee.c(),y=oe(),w=U("label"),T=xe("Slow-down factor for main roads: "),L=xe(r[2]),D=oe(),R=U("input"),z=oe(),I=U("i"),I.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,ut(u,"color","red"),ut(p,"color","blue"),ue(R,"type","range"),ue(R,"min","1.0"),ue(R,"max","5.0"),ue(R,"step","0.1"),ue(e,"slot","sidebar")},m(ae,Ee){q(ae,e,Ee),he(t,e,null),$(e,n),$(e,i),$(e,o),$(e,u),$(e,a),Y.m(e,null),$(e,d),$(e,p),$(e,g),ee.m(e,null),$(e,y),$(e,w),$(w,T),$(w,L),$(w,D),$(w,R),qn(R,r[2]),$(e,z),$(e,I),F=!0,N||(W=[yt(R,"change",r[12]),yt(R,"input",r[12])],N=!0)},p(ae,Ee){J===(J=se(ae))&&Y?Y.p(ae,Ee):(Y.d(1),Y=J(ae),Y&&(Y.c(),Y.m(e,d))),ze===(ze=_e(ae))&&ee?ee.p(ae,Ee):(ee.d(1),ee=ze(ae),ee&&(ee.c(),ee.m(e,y))),(!F||Ee&4)&&St(L,ae[2]),Ee&4&&qn(R,ae[2])},i(ae){F||(j(t.$$.fragment,ae),F=!0)},o(ae){G(t.$$.fragment,ae),F=!1},d(ae){ae&&V(e),fe(t),Y.d(),ee.d(),N=!1,mr(W)}}}function U1(r){let e,t;return e=new Ih({props:{$$slots:{default:[FA]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function FA(r){let e,t,n,i,o,u,a,d;return e=new Ed({}),n=new Ld({}),o=new Id({}),a=new Eh({props:{interactive:!1}}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment),i=oe(),de(o.$$.fragment),u=oe(),de(a.$$.fragment)},m(p,g){he(e,p,g),q(p,t,g),he(n,p,g),q(p,i,g),he(o,p,g),q(p,u,g),he(a,p,g),d=!0},p:rt,i(p){d||(j(e.$$.fragment,p),j(n.$$.fragment,p),j(o.$$.fragment,p),j(a.$$.fragment,p),d=!0)},o(p){G(e.$$.fragment,p),G(n.$$.fragment,p),G(o.$$.fragment,p),G(a.$$.fragment,p),d=!1},d(p){p&&(V(t),V(i),V(u)),fe(e,p),fe(n,p),fe(o,p),fe(a,p)}}}function BA(r){let e,t;const n=[dn("compare-route"),{paint:{"line-width":10,"line-color":Po(["get","kind"],{before:"red",after:"blue"},"red")}}];let i={};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new tr({props:i}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function OA(r){let e;return{c(){e=xe("A")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function NA(r){let e;return{c(){e=xe("B")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function jA(r){let e,t,n,i,o,u,a,d,p,g,y,w,T=r[0]=="neighbourhood"&&U1(r);n=new Ra({}),o=new dr({props:{data:r[1],$$slots:{default:[BA]},$$scope:{ctx:r}}});function L(I){r[10](I)}let D={draggable:!0,$$slots:{default:[OA]},$$scope:{ctx:r}};r[4]!==void 0&&(D.lngLat=r[4]),a=new pl({props:D}),un.push(()=>Cn(a,"lngLat",L));function R(I){r[11](I)}let z={draggable:!0,$$slots:{default:[NA]},$$scope:{ctx:r}};return r[3]!==void 0&&(z.lngLat=r[3]),g=new pl({props:z}),un.push(()=>Cn(g,"lngLat",R)),{c(){e=U("div"),T&&T.c(),t=oe(),de(n.$$.fragment),i=oe(),de(o.$$.fragment),u=oe(),de(a.$$.fragment),p=oe(),de(g.$$.fragment),ue(e,"slot","map")},m(I,F){q(I,e,F),T&&T.m(e,null),$(e,t),he(n,e,null),$(e,i),he(o,e,null),$(e,u),he(a,e,null),$(e,p),he(g,e,null),w=!0},p(I,F){I[0]=="neighbourhood"?T?F&1&&j(T,1):(T=U1(I),T.c(),j(T,1),T.m(e,t)):T&&(tn(),G(T,1,1,()=>{T=null}),nn());const N={};F&2&&(N.data=I[1]),F&32768&&(N.$$scope={dirty:F,ctx:I}),o.$set(N);const W={};F&32768&&(W.$$scope={dirty:F,ctx:I}),!d&&F&16&&(d=!0,W.lngLat=I[4],Sn(()=>d=!1)),a.$set(W);const se={};F&32768&&(se.$$scope={dirty:F,ctx:I}),!y&&F&8&&(y=!0,se.lngLat=I[3],Sn(()=>y=!1)),g.$set(se)},i(I){w||(j(T),j(n.$$.fragment,I),j(o.$$.fragment,I),j(a.$$.fragment,I),j(g.$$.fragment,I),w=!0)},o(I){G(T),G(n.$$.fragment,I),G(o.$$.fragment,I),G(a.$$.fragment,I),G(g.$$.fragment,I),w=!1},d(I){I&&V(e),T&&T.d(),fe(n),fe(o),fe(a),fe(g)}}}function UA(r){let e,t;return e=new _o({props:{$$slots:{map:[jA],sidebar:[$A],top:[AA]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,[i]){const o={};i&33023&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function VA(r,e,t){let n,i,o,u,a,d,p,g;st(r,an,I=>t(7,u=I)),st(r,Ug,I=>t(2,a=I)),st(r,oh,I=>t(3,d=I)),st(r,ih,I=>t(4,p=I)),st(r,Ir,I=>t(9,g=I));let{prevMode:y}=e;Ts(()=>{setTimeout(()=>{am(ih),am(oh)},10)});function w(){Ot(an,u={mode:y},u)}function T(I){p=I,ih.set(p)}function L(I){d=I,oh.set(d)}function D(){a=hl(this.value),Ug.set(a)}const R=()=>Ot(an,u={mode:"pick-neighbourhood"},u),z=()=>Ot(an,u={mode:"neighbourhood"},u);return r.$$set=I=>{"prevMode"in I&&t(0,y=I.prevMode)},r.$$.update=()=>{r.$$.dirty&540&&t(1,n=g.compareRoute(p,d,a)),r.$$.dirty&2&&t(6,i=n.features.find(I=>I.properties.kind=="before")),r.$$.dirty&2&&t(5,o=n.features.find(I=>I.properties.kind=="after"))},[y,n,a,d,p,o,i,u,w,g,T,L,D,R,z]}class qA extends It{constructor(e){super(),Et(this,e,VA,UA,xt,{prevMode:0})}}function ZA(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function GA(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function HA(r){let e;return{c(){e=xe("Editing")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function WA(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L;return o=new Rn({props:{$$slots:{default:[ZA]},$$scope:{ctx:r}}}),o.$on("click",$o),d=new Rn({props:{$$slots:{default:[GA]},$$scope:{ctx:r}}}),d.$on("click",r[10]),y=new Rn({props:{$$slots:{default:[HA]},$$scope:{ctx:r}}}),y.$on("click",r[11]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),de(o.$$.fragment),u=oe(),a=U("li"),de(d.$$.fragment),p=oe(),g=U("li"),de(y.$$.fragment),w=oe(),T=U("li"),T.textContent="Changing neighbourhood boundary",ue(t,"aria-label","breadcrumb"),ue(e,"slot","top")},m(D,R){q(D,e,R),$(e,t),$(t,n),$(n,i),he(o,i,null),$(n,u),$(n,a),he(d,a,null),$(n,p),$(n,g),he(y,g,null),$(n,w),$(n,T),L=!0},p(D,R){const z={};R&8192&&(z.$$scope={dirty:R,ctx:D}),o.$set(z);const I={};R&8192&&(I.$$scope={dirty:R,ctx:D}),d.$set(I);const F={};R&8192&&(F.$$scope={dirty:R,ctx:D}),y.$set(F)},i(D){L||(j(o.$$.fragment,D),j(d.$$.fragment,D),j(y.$$.fragment,D),L=!0)},o(D){G(o.$$.fragment,D),G(d.$$.fragment,D),G(y.$$.fragment,D),L=!1},d(D){D&&V(e),fe(o),fe(d),fe(y)}}}function KA(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L,D,R;function z(N){r[8](N)}function I(N){r[9](N)}let F={map:Er(r[3])};return r[0]!==void 0&&(F.waypoints=r[0]),r[1]!==void 0&&(F.drawnShapeOut=r[1]),i=new Rv({props:F}),un.push(()=>Cn(i,"waypoints",z)),un.push(()=>Cn(i,"drawnShapeOut",I)),{c(){e=U("div"),t=U("h1"),t.textContent="Edit boundary",n=oe(),de(i.$$.fragment),a=oe(),d=U("div"),p=U("button"),g=xe("Finish"),w=oe(),T=U("button"),T.textContent="Cancel",p.disabled=y=r[0].length<3,ue(T,"class","secondary"),ut(d,"display","flex"),ut(d,"gap","16px"),ue(e,"slot","sidebar")},m(N,W){q(N,e,W),$(e,t),$(e,n),he(i,e,null),$(e,a),$(e,d),$(d,p),$(p,g),$(d,w),$(d,T),L=!0,D||(R=[yt(p,"click",r[4]),yt(T,"click",r[5])],D=!0)},p(N,W){const se={};W&8&&(se.map=Er(N[3])),!o&&W&1&&(o=!0,se.waypoints=N[0],Sn(()=>o=!1)),!u&&W&2&&(u=!0,se.drawnShapeOut=N[1],Sn(()=>u=!1)),i.$set(se),(!L||W&1&&y!==(y=N[0].length<3))&&(p.disabled=y)},i(N){L||(j(i.$$.fragment,N),L=!0)},o(N){G(i.$$.fragment,N),L=!1},d(N){N&&V(e),fe(i),D=!1,mr(R)}}}function XA(r){let e,t;return e=new _o({props:{$$slots:{sidebar:[KA],top:[WA]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,[i]){const o={};i&8207&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function JA(r,e,t){let n,i,o;st(r,an,R=>t(2,n=R)),st(r,Ir,R=>t(12,i=R)),st(r,Do,R=>t(3,o=R));let{name:u}=e,{existing:a}=e,d=[],p;a.properties.waypoints?d=a.properties.waypoints.map(R=>({point:[R.lon,R.lat],snapped:R.snapped})):d=a.geometry.coordinates[1].slice(1).map(R=>({point:R,snapped:!1}));function g(){if(p)try{i.setNeighbourhoodBoundary(u,p),dh(),i.setCurrentNeighbourhood(u),Ot(an,n={mode:"neighbourhood"},n)}catch(R){window.alert(`Sorry, this boundary is invalid: ${R}`),y()}}function y(){Ot(an,n={mode:"neighbourhood"},n)}function w(R){d=R,t(0,d)}function T(R){p=R,t(1,p)}const L=()=>Ot(an,n={mode:"pick-neighbourhood"},n),D=()=>Ot(an,n={mode:"neighbourhood"},n);return r.$$set=R=>{"name"in R&&t(6,u=R.name),"existing"in R&&t(7,a=R.existing)},[d,p,n,o,g,y,u,a,w,T,L,D]}class YA extends It{constructor(e){super(),Et(this,e,JA,XA,xt,{name:6,existing:7})}}const QA="/ltn/assets/settings-342fb430.svg";function e8(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L,D,R,z;return n=new A4({}),{c(){e=U("h1"),e.textContent="Settings",t=oe(),de(n.$$.fragment),i=oe(),o=U("label"),u=U("input"),a=xe(`
    Road thickness depends on shortcuts`),d=oe(),p=U("label"),g=U("input"),y=xe(`
    Developer mode`),w=oe(),T=U("center"),L=U("button"),L.textContent="Confirm",ue(u,"type","checkbox"),ue(g,"type","checkbox")},m(I,F){q(I,e,F),q(I,t,F),he(n,I,F),q(I,i,F),q(I,o,F),$(o,u),u.checked=r[1],$(o,a),q(I,d,F),q(I,p,F),$(p,g),g.checked=r[2],$(p,y),q(I,w,F),q(I,T,F),$(T,L),D=!0,R||(z=[yt(u,"change",r[4]),yt(g,"change",r[5]),yt(L,"click",r[6])],R=!0)},p(I,F){F&2&&(u.checked=I[1]),F&4&&(g.checked=I[2])},i(I){D||(j(n.$$.fragment,I),D=!0)},o(I){G(n.$$.fragment,I),D=!1},d(I){I&&(V(e),V(t),V(i),V(o),V(d),V(p),V(w),V(T)),fe(n,I),R=!1,mr(z)}}}function t8(r){let e,t,n,i,o,u,a;function d(g){r[7](g)}let p={$$slots:{default:[e8]},$$scope:{ctx:r}};return r[0]!==void 0&&(p.show=r[0]),n=new _d({props:p}),un.push(()=>Cn(n,"show",d)),{c(){e=U("button"),e.innerHTML=`<img src="${QA}" alt="Settings"/>`,t=oe(),de(n.$$.fragment),ue(e,"class","outline")},m(g,y){q(g,e,y),q(g,t,y),he(n,g,y),o=!0,u||(a=yt(e,"click",r[3]),u=!0)},p(g,[y]){const w={};y&263&&(w.$$scope={dirty:y,ctx:g}),!i&&y&1&&(i=!0,w.show=g[0],Sn(()=>i=!1)),n.$set(w)},i(g){o||(j(n.$$.fragment,g),o=!0)},o(g){G(n.$$.fragment,g),o=!1},d(g){g&&(V(e),V(t)),fe(n,g),u=!1,a()}}}function n8(r,e,t){let n,i;st(r,im,y=>t(1,n=y)),st(r,ad,y=>t(2,i=y));let o=!1;const u=()=>t(0,o=!0);function a(){n=this.checked,im.set(n)}function d(){i=this.checked,ad.set(i)}const p=()=>t(0,o=!1);function g(y){o=y,t(0,o)}return[o,n,i,u,a,d,p,g]}class r8 extends It{constructor(e){super(),Et(this,e,n8,t8,xt,{})}}const i8=["==",["geometry-type"],"Polygon"],o8=["==",["geometry-type"],"LineString"],s8=["==",["geometry-type"],"Point"];function Uv(){return{type:"FeatureCollection",features:[]}}function Xp(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:Vv(r)}}}function Vv(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const qv=Ln(Uv()),Zv=Ln(0),a8=100;class l8{constructor(e){Lr(this,"map");Lr(this,"active");Lr(this,"eventListenersSuccess");Lr(this,"eventListenersUpdated");Lr(this,"eventListenersFailure");Lr(this,"points");Lr(this,"cursor");Lr(this,"hover");Lr(this,"dragFrom");Lr(this,"previousStates");Lr(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});Lr(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(V1(this.points).forEach((n,i)=>{t.push([i+1,nk(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});Lr(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=Xp(e.lngLat.toArray()),this.onClick(e),this.finish())});Lr(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});Lr(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});Lr(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});Lr(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=Uv();this.points.forEach((i,o)=>{let u=Xp(i);u.properties.hover=this.hover==o,u.properties.idx=o,e.features.push(u)}),e.features=e.features.concat(V1(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),qv.set(e);let n="crosshair";this.hover!=null&&(n=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=n,Zv.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Xp(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(Vv),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>a8&&this.previousStates.shift()}}function V1(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}function c8(r){let e,t,n;return{c(){e=xe("Undo ("),t=xe(r[1]),n=xe(")")},m(i,o){q(i,e,o),q(i,t,o),q(i,n,o)},p(i,o){o&2&&St(t,i[1])},d(i){i&&(V(e),V(t),V(n))}}}function u8(r){let e;return{c(){e=xe("Undo")},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function h8(r){let e,t,n,i,o,u,a,d,p,g,y;function w(D,R){return D[1]==0?u8:c8}let T=w(r),L=T(r);return{c(){e=U("div"),t=U("button"),t.textContent="Finish",n=oe(),i=U("button"),i.textContent="Cancel",o=oe(),u=U("button"),L.c(),d=oe(),p=U("ul"),p.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,u.disabled=a=r[1]==0,ut(e,"display","flex"),ut(e,"justify-content","space-between")},m(D,R){q(D,e,R),$(e,t),$(e,n),$(e,i),$(e,o),$(e,u),L.m(u,null),q(D,d,R),q(D,p,R),g||(y=[yt(t,"click",r[2]),yt(i,"click",r[3]),yt(u,"click",r[4])],g=!0)},p(D,[R]){T===(T=w(D))&&L?L.p(D,R):(L.d(1),L=T(D),L&&(L.c(),L.m(u,null))),R&2&&a!==(a=D[1]==0)&&(u.disabled=a)},i:rt,o:rt,d(D){D&&(V(e),V(d),V(p)),L.d(),g=!1,mr(y)}}}function f8(r,e,t){let n;st(r,Zv,d=>t(1,n=d));let{polygonTool:i}=e;const o=()=>i.finish(),u=()=>i.cancel(),a=()=>i.undo();return r.$$set=d=>{"polygonTool"in d&&t(0,i=d.polygonTool)},[i,n,o,u,a]}class d8 extends It{constructor(e){super(),Et(this,e,f8,h8,xt,{polygonTool:0})}}let p8=Date.now();function Ah(r){return`${r}-${p8++}`}const Gv=Symbol.for("svelte-maplibre");function m8(){return xh(Gv)}function q1(r){return{subscribe:r.subscribe}}function Hv({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let i=m8(),o=Ln(null),u=q1(o),a={...i,[r]:q1(o)};if(e&&(a.popupTarget=u),n){let d=Ln(null);a.layerEvent=d,i.layerEvent=d}return t&&(a.cluster=Ln()),md(Gv,a),{...i,self:o}}function _8(){return Hv({key:"source",setCluster:!0})}function g8(r=!0){return Hv({key:"layer",setPopupTarget:r,setMouseEvent:r})}function Z1(r){let e;return t=>{if(t)for(let n in t){let i=e==null?void 0:e[n],o=t[n];i!==o&&r(n,o,i)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function y8(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function b8(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function G1(r){let e=r[0],t,n,i=H1(r);return{c(){i.c(),t=Jn()},m(o,u){i.m(o,u),q(o,t,u),n=!0},p(o,u){u[0]&1&&xt(e,e=o[0])?(tn(),G(i,1,1,rt),nn(),i=H1(o),i.c(),j(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(j(i),n=!0)},o(o){G(i),n=!1},d(o){o&&V(t),i.d(o)}}}function H1(r){let e;const t=r[36].default,n=En(t,r,r[35],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[1]&16)&&An(n,t,i,i[35],e?In(t,i[35],o,null):Pn(i[35]),null)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function v8(r){let e,t,n=r[0]&&G1(r);return{c(){n&&n.c(),e=Jn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o[0]&1&&j(n,1)):(n=G1(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),G(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){G(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function w8(r,e,t){let n,i,o,u,a,d,p,g,y,w,T,L,{$$slots:D={},$$scope:R}=e,{id:z=Ah("layer")}=e,{source:I=void 0}=e,{sourceLayer:F=void 0}=e,{beforeId:N=void 0}=e,{beforeLayerType:W=void 0}=e,{type:se}=e,{paint:J=void 0}=e,{layout:Y=void 0}=e,{filter:_e=void 0}=e,{applyToClusters:ze=void 0}=e,{minzoom:ee=void 0}=e,{maxzoom:ae=void 0}=e,{manageHoverState:Ee=!1}=e,{hovered:we=null}=e,{interactive:it=!0}=e,{hoverCursor:Ge=void 0}=e,{eventsIfTopMost:Ie=!1}=e;const De=ds(),{map:Ct,source:nt,self:lt,minzoom:mt,maxzoom:ht,eventTopMost:We,layerInfo:Bt}=g8();st(r,Ct,qe=>t(31,y=qe)),st(r,nt,qe=>t(32,w=qe)),st(r,lt,qe=>t(0,g=qe)),st(r,mt,qe=>t(34,L=qe)),st(r,ht,qe=>t(33,T=qe)),ti(()=>{g&&y&&(Bt.delete(g),y==null||y.removeLayer(g))});let Lt;function Nt(qe){var ye,zn;if(!it||!g||!y||Ie&&We(qe)!==g)return;let Ve=qe.features??[],kt=(zn=(ye=Ve[0])==null?void 0:ye.properties)==null?void 0:zn.cluster_id,Ut={event:qe,map:y,clusterId:kt,layer:g,source:a,features:Ve};De(qe.type,Ut)}function Mt(qe){var ye,zn;if(!it||!g||!y||Ie&&We(qe)!==g)return;Ge&&(y.getCanvas().style.cursor=Ge);let Ve=qe.features??[];t(6,we=Ve[0]??null);let kt=(zn=(ye=Ve[0])==null?void 0:ye.properties)==null?void 0:zn.cluster_id;De("mouseenter",{event:qe,map:y,clusterId:kt,layer:g,source:a,features:Ve})}function Qt(qe){var ye,zn,Oe;if(!it||!y)return;if(Ie&&We(qe)!==g){t(6,we=null),Ee&&Lt!==void 0&&(y==null||y.setFeatureState({source:a,sourceLayer:F,id:Lt},{hover:!1}),Lt=void 0);return}y.getCanvas().style.cursor=Ge;let Ve=qe.features??[],kt=(zn=(ye=Ve[0])==null?void 0:ye.properties)==null?void 0:zn.cluster_id,Ut=(Oe=Ve[0])==null?void 0:Oe.id;Ut!==Lt&&(Ee&&(Lt!==void 0&&(y==null||y.setFeatureState({source:a,id:Lt,sourceLayer:F},{hover:!1})),y==null||y.setFeatureState({source:a,id:Ut,sourceLayer:F},{hover:!0})),Lt=Ut,t(6,we=Ve[0]??null)),De("mousemove",{event:qe,map:y,clusterId:kt,layer:g,source:a,features:Ve})}function bt(qe){if(!(!it||!g||!y)){if(Ge&&(y.getCanvas().style.cursor=""),t(6,we=null),Ee&&Lt!==void 0){const Ve={source:a,id:Lt,sourceLayer:F};y==null||y.setFeatureState(Ve,{hover:!1}),Lt=void 0}De("mouseleave",{map:y,layer:g,source:a})}}let Dt=!0;function pn(qe){y&&(y.off("click",qe,Nt),y.off("dblclick",qe,Nt),y.off("contextmenu",qe,Nt),y.off("mouseenter",qe,Mt),y.off("mousemove",qe,Qt),y.off("mouseleave",qe,bt))}return ti(()=>{y&&g&&pn(g)}),r.$$set=qe=>{"id"in qe&&t(7,z=qe.id),"source"in qe&&t(8,I=qe.source),"sourceLayer"in qe&&t(9,F=qe.sourceLayer),"beforeId"in qe&&t(10,N=qe.beforeId),"beforeLayerType"in qe&&t(11,W=qe.beforeLayerType),"type"in qe&&t(12,se=qe.type),"paint"in qe&&t(13,J=qe.paint),"layout"in qe&&t(14,Y=qe.layout),"filter"in qe&&t(15,_e=qe.filter),"applyToClusters"in qe&&t(16,ze=qe.applyToClusters),"minzoom"in qe&&t(17,ee=qe.minzoom),"maxzoom"in qe&&t(18,ae=qe.maxzoom),"manageHoverState"in qe&&t(19,Ee=qe.manageHoverState),"hovered"in qe&&t(6,we=qe.hovered),"interactive"in qe&&t(20,it=qe.interactive),"hoverCursor"in qe&&t(21,Ge=qe.hoverCursor),"eventsIfTopMost"in qe&&t(22,Ie=qe.eventsIfTopMost),"$$scope"in qe&&t(35,R=qe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=b8(ze)),r.$$.dirty[0]&1073774592&&t(24,i=y8("all",n,_e)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,o=ee??L),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,u=ae??T),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,a=I||w),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&y&&g!==z&&a){g&&(pn(g),Bt.delete(g));let qe=N;if(!N&&W){let Ve=y.getStyle().layers,kt=typeof W=="function"?W:ye=>ye.type===W,Ut=Ve==null?void 0:Ve.find(kt);Ut&&(qe=Ut.id)}Ot(lt,g=z,g),y.addLayer(Sa({id:g,type:se,source:a,"source-layer":F,filter:i,paint:J,layout:Y,minzoom:o,maxzoom:u}),qe),t(23,Dt=!0),y.on("click",g,Nt),y.on("dblclick",g,Nt),y.on("contextmenu",g,Nt),y.on("mouseenter",g,Mt),y.on("mousemove",g,Qt),y.on("mouseleave",g,bt)}r.$$.dirty[0]&1048577&&g&&Bt.set(g,{interactive:it}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,d=g?Z1((qe,Ve)=>y==null?void 0:y.setPaintProperty(g,qe,Ve)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,p=g?Z1((qe,Ve)=>y==null?void 0:y.setLayoutProperty(g,qe,Ve)):void 0),r.$$.dirty[0]&268443648&&(d==null||d(J)),r.$$.dirty[0]&134234112&&(p==null||p(Y)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&g&&(y==null||y.setLayerZoomRange(g,o,u)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&g&&(Dt?t(23,Dt=!1):y==null||y.setFilter(g,i))},[g,Ct,nt,lt,mt,ht,we,z,I,F,N,W,se,J,Y,_e,ze,ee,ae,Ee,it,Ge,Ie,Dt,i,u,o,p,d,a,n,y,w,T,L,R,D]}class t_ extends It{constructor(e){super(),Et(this,e,w8,v8,xt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function x8(r){let e;const t=r[16].default,n=En(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&An(n,t,i,i[24],e?In(t,i[24],o,null):Pn(i[24]),null)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function k8(r){let e,t,n;function i(u){r[17](u)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[x8]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new t_({props:o}),un.push(()=>Cn(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){de(e.$$.fragment)},m(u,a){he(e,u,a),n=!0},p(u,[a]){const d={};a&2&&(d.id=u[1]),a&4&&(d.source=u[2]),a&8&&(d.sourceLayer=u[3]),a&16&&(d.beforeId=u[4]),a&32&&(d.beforeLayerType=u[5]),a&64&&(d.paint=u[6]),a&128&&(d.layout=u[7]),a&256&&(d.filter=u[8]),a&512&&(d.applyToClusters=u[9]),a&1024&&(d.minzoom=u[10]),a&2048&&(d.maxzoom=u[11]),a&4096&&(d.hoverCursor=u[12]),a&8192&&(d.manageHoverState=u[13]),a&16384&&(d.eventsIfTopMost=u[14]),a&32768&&(d.interactive=u[15]),a&16777216&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.hovered=u[0],Sn(()=>t=!1)),e.$set(d)},i(u){n||(j(e.$$.fragment,u),n=!0)},o(u){G(e.$$.fragment,u),n=!1},d(u){fe(e,u)}}}function S8(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Ah("circle")}=e,{source:u=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:y=void 0}=e,{filter:w=void 0}=e,{applyToClusters:T=void 0}=e,{minzoom:L=void 0}=e,{maxzoom:D=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:z=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:F=!1}=e,{interactive:N=!0}=e;function W(ae){I=ae,t(0,I)}function se(ae){Mn.call(this,r,ae)}function J(ae){Mn.call(this,r,ae)}function Y(ae){Mn.call(this,r,ae)}function _e(ae){Mn.call(this,r,ae)}function ze(ae){Mn.call(this,r,ae)}function ee(ae){Mn.call(this,r,ae)}return r.$$set=ae=>{"id"in ae&&t(1,o=ae.id),"source"in ae&&t(2,u=ae.source),"sourceLayer"in ae&&t(3,a=ae.sourceLayer),"beforeId"in ae&&t(4,d=ae.beforeId),"beforeLayerType"in ae&&t(5,p=ae.beforeLayerType),"paint"in ae&&t(6,g=ae.paint),"layout"in ae&&t(7,y=ae.layout),"filter"in ae&&t(8,w=ae.filter),"applyToClusters"in ae&&t(9,T=ae.applyToClusters),"minzoom"in ae&&t(10,L=ae.minzoom),"maxzoom"in ae&&t(11,D=ae.maxzoom),"hoverCursor"in ae&&t(12,R=ae.hoverCursor),"manageHoverState"in ae&&t(13,z=ae.manageHoverState),"hovered"in ae&&t(0,I=ae.hovered),"eventsIfTopMost"in ae&&t(14,F=ae.eventsIfTopMost),"interactive"in ae&&t(15,N=ae.interactive),"$$scope"in ae&&t(24,i=ae.$$scope)},[I,o,u,a,d,p,g,y,w,T,L,D,R,z,F,N,n,W,se,J,Y,_e,ze,ee,i]}class C8 extends It{constructor(e){super(),Et(this,e,S8,k8,xt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function T8(r){let e;const t=r[15].default,n=En(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&An(n,t,i,i[23],e?In(t,i[23],o,null):Pn(i[23]),null)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function M8(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[T8]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new t_({props:o}),un.push(()=>Cn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){de(e.$$.fragment)},m(u,a){he(e,u,a),n=!0},p(u,[a]){const d={};a&2&&(d.id=u[1]),a&4&&(d.source=u[2]),a&8&&(d.sourceLayer=u[3]),a&16&&(d.beforeId=u[4]),a&32&&(d.beforeLayerType=u[5]),a&64&&(d.paint=u[6]),a&128&&(d.layout=u[7]),a&256&&(d.filter=u[8]),a&512&&(d.minzoom=u[9]),a&1024&&(d.maxzoom=u[10]),a&2048&&(d.hoverCursor=u[11]),a&4096&&(d.manageHoverState=u[12]),a&8192&&(d.eventsIfTopMost=u[13]),a&16384&&(d.interactive=u[14]),a&8388608&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.hovered=u[0],Sn(()=>t=!1)),e.$set(d)},i(u){n||(j(e.$$.fragment,u),n=!0)},o(u){G(e.$$.fragment,u),n=!1},d(u){fe(e,u)}}}function L8(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Ah("fill")}=e,{source:u=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:y=void 0}=e,{filter:w=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:L=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:R=!1}=e,{hovered:z=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:F=!0}=e;function N(ee){z=ee,t(0,z)}function W(ee){Mn.call(this,r,ee)}function se(ee){Mn.call(this,r,ee)}function J(ee){Mn.call(this,r,ee)}function Y(ee){Mn.call(this,r,ee)}function _e(ee){Mn.call(this,r,ee)}function ze(ee){Mn.call(this,r,ee)}return r.$$set=ee=>{"id"in ee&&t(1,o=ee.id),"source"in ee&&t(2,u=ee.source),"sourceLayer"in ee&&t(3,a=ee.sourceLayer),"beforeId"in ee&&t(4,d=ee.beforeId),"beforeLayerType"in ee&&t(5,p=ee.beforeLayerType),"paint"in ee&&t(6,g=ee.paint),"layout"in ee&&t(7,y=ee.layout),"filter"in ee&&t(8,w=ee.filter),"minzoom"in ee&&t(9,T=ee.minzoom),"maxzoom"in ee&&t(10,L=ee.maxzoom),"hoverCursor"in ee&&t(11,D=ee.hoverCursor),"manageHoverState"in ee&&t(12,R=ee.manageHoverState),"hovered"in ee&&t(0,z=ee.hovered),"eventsIfTopMost"in ee&&t(13,I=ee.eventsIfTopMost),"interactive"in ee&&t(14,F=ee.interactive),"$$scope"in ee&&t(23,i=ee.$$scope)},[z,o,u,a,d,p,g,y,w,T,L,D,R,I,F,n,N,W,se,J,Y,_e,ze,i]}class E8 extends It{constructor(e){super(),Et(this,e,L8,M8,xt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function I8(r,e,t,n,i){let o=!1;r.getSource(e)&&(o=!0,r.removeSource(e));const u=()=>{n(e)&&(r.addSource(e,t),i())};if(o){const a=()=>{e&&(r.getSource(e)?setTimeout(a,1):u())};a()}else u()}function A8(r,e,t){gb().then(()=>{let n=pi(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function W1(r){let e=r[0],t,n,i=K1(r);return{c(){i.c(),t=Jn()},m(o,u){i.m(o,u),q(o,t,u),n=!0},p(o,u){u&1&&xt(e,e=o[0])?(tn(),G(i,1,1,rt),nn(),i=K1(o),i.c(),j(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(j(i),n=!0)},o(o){G(i),n=!1},d(o){o&&V(t),i.d(o)}}}function K1(r){let e;const t=r[15].default,n=En(t,r,r[14],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16384)&&An(n,t,i,i[14],e?In(t,i[14],o,null):Pn(i[14]),null)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function P8(r){let e,t,n=r[0]&&W1(r);return{c(){n&&n.c(),e=Jn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&j(n,1)):(n=W1(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),G(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){G(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function z8(r,e,t){let n,i,o,{$$slots:u={},$$scope:a}=e,{id:d=Ah("geojson")}=e,{data:p}=e,{generateId:g=!1}=e,{promoteId:y=void 0}=e,{filter:w=void 0}=e,{lineMetrics:T=void 0}=e,{cluster:L=void 0}=e;const{map:D,cluster:R,self:z}=_8();st(r,D,N=>t(13,i=N)),st(r,R,N=>t(16,o=N)),st(r,z,N=>t(0,n=N));let I,F=!0;return ti(()=>{n&&I&&i&&(A8(D,n,I),Ot(z,n=null,n),t(11,I=void 0))}),r.$$set=N=>{"id"in N&&t(4,d=N.id),"data"in N&&t(5,p=N.data),"generateId"in N&&t(6,g=N.generateId),"promoteId"in N&&t(7,y=N.promoteId),"filter"in N&&t(8,w=N.filter),"lineMetrics"in N&&t(9,T=N.lineMetrics),"cluster"in N&&t(10,L=N.cluster),"$$scope"in N&&t(14,a=N.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&Ot(R,o=L,o),r.$$.dirty&12273&&i&&n!==d&&(Ot(z,n=d,n),I8(i,n,Sa({type:"geojson",data:p,filter:w,lineMetrics:T,generateId:g,promoteId:y,cluster:!!L,clusterMinPoints:L==null?void 0:L.minPoints,clusterMaxZoom:L==null?void 0:L.maxZoom,clusterRadius:L==null?void 0:L.radius,clusterProperties:L==null?void 0:L.properties}),N=>i&&N===n,()=>{n&&(t(11,I=i==null?void 0:i.getSource(n)),t(12,F=!0))})),r.$$.dirty&8208&&(i==null||i.on("style.load",()=>{t(11,I=i==null?void 0:i.getSource(d))})),r.$$.dirty&6176&&I&&(F?t(12,F=!1):I.setData(p)),r.$$.dirty&3072&&(I==null||I.setClusterOptions(Sa({cluster:!!L,clusterMaxZoom:L==null?void 0:L.maxZoom,clusterRadius:L==null?void 0:L.radius})))},[n,D,R,z,d,p,g,y,w,T,L,I,F,i,a,u]}class D8 extends It{constructor(e){super(),Et(this,e,z8,P8,xt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function R8(r){let e;const t=r[15].default,n=En(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&An(n,t,i,i[23],e?In(t,i[23],o,null):Pn(i[23]),null)},i(i){e||(j(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function $8(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[R8]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new t_({props:o}),un.push(()=>Cn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){de(e.$$.fragment)},m(u,a){he(e,u,a),n=!0},p(u,[a]){const d={};a&2&&(d.id=u[1]),a&4&&(d.source=u[2]),a&8&&(d.sourceLayer=u[3]),a&16&&(d.beforeId=u[4]),a&32&&(d.beforeLayerType=u[5]),a&64&&(d.paint=u[6]),a&128&&(d.layout=u[7]),a&256&&(d.filter=u[8]),a&512&&(d.minzoom=u[9]),a&1024&&(d.maxzoom=u[10]),a&2048&&(d.hoverCursor=u[11]),a&4096&&(d.manageHoverState=u[12]),a&8192&&(d.eventsIfTopMost=u[13]),a&16384&&(d.interactive=u[14]),a&8388608&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.hovered=u[0],Sn(()=>t=!1)),e.$set(d)},i(u){n||(j(e.$$.fragment,u),n=!0)},o(u){G(e.$$.fragment,u),n=!1},d(u){fe(e,u)}}}function F8(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Ah("line")}=e,{source:u=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:y=void 0}=e,{filter:w=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:L=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:R=!1}=e,{hovered:z=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:F=!0}=e;function N(ee){z=ee,t(0,z)}function W(ee){Mn.call(this,r,ee)}function se(ee){Mn.call(this,r,ee)}function J(ee){Mn.call(this,r,ee)}function Y(ee){Mn.call(this,r,ee)}function _e(ee){Mn.call(this,r,ee)}function ze(ee){Mn.call(this,r,ee)}return r.$$set=ee=>{"id"in ee&&t(1,o=ee.id),"source"in ee&&t(2,u=ee.source),"sourceLayer"in ee&&t(3,a=ee.sourceLayer),"beforeId"in ee&&t(4,d=ee.beforeId),"beforeLayerType"in ee&&t(5,p=ee.beforeLayerType),"paint"in ee&&t(6,g=ee.paint),"layout"in ee&&t(7,y=ee.layout),"filter"in ee&&t(8,w=ee.filter),"minzoom"in ee&&t(9,T=ee.minzoom),"maxzoom"in ee&&t(10,L=ee.maxzoom),"hoverCursor"in ee&&t(11,D=ee.hoverCursor),"manageHoverState"in ee&&t(12,R=ee.manageHoverState),"hovered"in ee&&t(0,z=ee.hovered),"eventsIfTopMost"in ee&&t(13,I=ee.eventsIfTopMost),"interactive"in ee&&t(14,F=ee.interactive),"$$scope"in ee&&t(23,i=ee.$$scope)},[z,o,u,a,d,p,g,y,w,T,L,D,R,I,F,n,N,W,se,J,Y,_e,ze,i]}class B8 extends It{constructor(e){super(),Et(this,e,F8,$8,xt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function O8(r){let e,t,n,i,o,u;return e=new E8({props:{id:"edit-polygon-fill",filter:i8,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),n=new B8({props:{id:"edit-polygon-lines",filter:o8,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),o=new C8({props:{id:"edit-polygon-vertices",filter:s8,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment),i=oe(),de(o.$$.fragment)},m(a,d){he(e,a,d),q(a,t,d),he(n,a,d),q(a,i,d),he(o,a,d),u=!0},p:rt,i(a){u||(j(e.$$.fragment,a),j(n.$$.fragment,a),j(o.$$.fragment,a),u=!0)},o(a){G(e.$$.fragment,a),G(n.$$.fragment,a),G(o.$$.fragment,a),u=!1},d(a){a&&(V(t),V(i)),fe(e,a),fe(n,a),fe(o,a)}}}function N8(r){let e,t;return e=new D8({props:{data:r[0],$$slots:{default:[O8]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&2&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function j8(r,e,t){let n;return st(r,qv,i=>t(0,n=i)),[n]}class U8 extends It{constructor(e){super(),Et(this,e,j8,N8,xt,{})}}function V8(r){let e,t,n,i,o,u,a;return{c(){e=U("button"),e.textContent="Import current view",t=oe(),n=U("i"),n.textContent="or...",i=oe(),o=U("button"),o.textContent="Draw an area to import on the map",ue(e,"type","button"),ue(o,"type","button")},m(d,p){q(d,e,p),q(d,t,p),q(d,n,p),q(d,i,p),q(d,o,p),u||(a=[yt(e,"click",r[2]),yt(o,"click",r[3])],u=!0)},p:rt,i:rt,o:rt,d(d){d&&(V(e),V(t),V(n),V(i),V(o)),u=!1,mr(a)}}}function q8(r){let e,t;return e=new d8({props:{polygonTool:r[0]}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.polygonTool=n[0]),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function Z8(r){let e,t,n,i,o,u,a,d,p;const g=[q8,V8],y=[];function w(T,L){return T[0]?0:1}return e=w(r),t=y[e]=g[e](r),{c(){t.c(),n=oe(),i=U("label"),o=U("input"),u=xe(`Save a copy of the osm.xml
  after importing`),ue(o,"type","checkbox")},m(T,L){y[e].m(T,L),q(T,n,L),q(T,i,L),$(i,o),o.checked=r[1],$(i,u),a=!0,d||(p=yt(o,"change",r[5]),d=!0)},p(T,[L]){let D=e;e=w(T),e===D?y[e].p(T,L):(tn(),G(y[D],1,1,()=>{y[D]=null}),nn(),t=y[e],t?t.p(T,L):(t=y[e]=g[e](T),t.c()),j(t,1),t.m(n.parentNode,n)),L&2&&(o.checked=T[1])},i(T){a||(j(t),a=!0)},o(T){G(t),a=!1},d(T){T&&(V(n),V(i)),y[e].d(T),d=!1,p()}}}function Gu(r){return[r.lng,r.lat]}function G8(r,e,t){let{map:n}=e;const i=ds();let o=null,u=!1;async function a(w){try{i("loading","Loading from Overpass");let L=await(await fetch(Wv(w))).text();u&&gd("osm.xml",L),i("gotXml",{xml:L,boundary:w})}catch(T){i("error",T.toString())}}function d(){let w=n.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[Gu(w.getSouthWest()),Gu(w.getNorthWest()),Gu(w.getNorthEast()),Gu(w.getSouthEast()),Gu(w.getSouthWest())]],type:"Polygon"}}}async function p(){if(n){if(n.getZoom()<13){i("error","Zoom in more to import");return}await a(d())}}function g(){n&&(t(0,o=new l8(n)),o.startNew(),o.addEventListenerSuccess(async w=>{t(0,o=null),await a(w)}),o.addEventListenerFailure(()=>{t(0,o=null)}))}function y(){u=this.checked,t(1,u)}return r.$$set=w=>{"map"in w&&t(4,n=w.map)},[o,u,p,g,n,y]}class H8 extends It{constructor(e){super(),Et(this,e,G8,Z8,xt,{map:4})}}function Wv(r){let e='poly:"';if(r.geometry.type=="Polygon")for(let[n,i]of r.geometry.coordinates[0])e+=`${i} ${n} `;else if(r.geometry.type=="MultiPolygon")for(let[n,i]of r.geometry.coordinates[0][0])e+=`${i} ${n} `;else throw new Error("overpassQueryForPolygon needs a Polygon or MultiPolygon");return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}class Kv{constructor(e,t,n,i,o,u,a,d){Lr(this,"inner");this.inner=new LM(e,t||new Uint8Array,n||new Uint8Array,i,o,u,a,d)}getInvertedBoundary(){return JSON.parse(this.inner.getInvertedBoundary())}getBounds(){return Array.from(this.inner.getBounds())}toRouteSnapper(){return this.inner.toRouteSnapper()}toRouteSnapperGj(){return this.inner.toRouteSnapperGj()}renderModalFilters(){return JSON.parse(this.inner.renderModalFilters())}renderTurnRestrictions(){return JSON.parse(this.inner.renderTurnRestrictions())}renderNeighbourhood(){let e=W8(JSON.parse(this.inner.renderNeighbourhood()));return e.maxShortcuts=Math.max(...e.features.map(t=>t.properties.kind=="interior_road"?t.properties.shortcuts:0))??0,e}generatedBoundaries(){return JSON.parse(this.inner.generatedBoundaries())}generateMergedBoundary(e){let t=this.inner.generateMergedBoundary(e);return JSON.parse(t)}setNeighbourhoodBoundary(e,t){this.inner.setNeighbourhoodBoundary(e,t)}deleteNeighbourhoodBoundary(e){this.inner.deleteNeighbourhoodBoundary(e)}renameNeighbourhoodBoundary(e,t){this.inner.renameNeighbourhoodBoundary(e,t)}setCurrentNeighbourhood(e){this.inner.setCurrentNeighbourhood(e)}addModalFilter(e,t){this.inner.addModalFilter(e,t)}addManyModalFilters(e,t){this.inner.addManyModalFilters(e,t)}deleteModalFilter(e){this.inner.deleteModalFilter(e)}addDiagonalFilter(e){this.inner.addDiagonalFilter(e.intersectionId)}rotateDiagonalFilter(e){this.inner.rotateDiagonalFilter(e.intersectionId)}deleteDiagonalFilter(e){this.inner.deleteDiagonalFilter(e.intersectionId)}toggleTravelFlow(e){this.inner.toggleTravelFlow(e)}toggleMainRoad(e){this.inner.toggleMainRoad(e)}addTurnRestriction(e,t){this.inner.addTurnRestriction(e,t)}deleteTurnRestriction(e,t,n){this.inner.deleteTurnRestriction(e,t,n)}getTurnRestrictionTargets(e){return JSON.parse(this.inner.getTurnRestrictionTargets(e))}undo(){this.inner.undo()}redo(){this.inner.redo()}getShortcutsCrossingRoad(e){return JSON.parse(this.inner.getShortcutsCrossingRoad(e))}getAllShortcuts(){return JSON.parse(this.inner.getAllShortcuts())}toSavefile(){return JSON.parse(this.inner.toSavefile())}loadSavefile(e){this.inner.loadSavefile(e)}compareRoute(e,t,n){return JSON.parse(this.inner.compareRoute(e.lng,e.lat,t.lng,t.lat,n))}impactToOneDestination(e){return JSON.parse(this.inner.impactToOneDestination(e.lng,e.lat))}predictImpact(e){return JSON.parse(this.inner.predictImpact(e))}getImpactsOnRoad(e,t){return JSON.parse(this.inner.getImpactsOnRoad(e,t)).map(n=>{let[i,o,u]=n;return{count:i,before:o,after:u}})}getAllNeighbourhoods(){return JSON.parse(this.inner.getAllNeighbourhoods())}getAllIntersections(){return JSON.parse(this.inner.getAllIntersections())}getMovements(e){return JSON.parse(this.inner.getMovements(e))}getDemandModel(){let e=JSON.parse(this.inner.getDemandModel());for(let t of e.features)t.properties.sum_from=S0(t.properties.counts_from),t.properties.sum_to=S0(t.properties.counts_to);return e}getPOIs(){return JSON.parse(this.inner.getPOIs())}}function W8(r){let e=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];for(let t of r.features)t.properties.kind!="cell"&&t.properties.kind!="border_arrow"&&t.properties.kind!="interior_road"||(t.properties.cell_color=="disconnected"?t.properties.color="red":t.properties.color=e[t.properties.cell_color%e.length]);return r}async function wh(r){let e=pi(Xs).project(r);try{console.time("get input files");let{osmBuffer:t,demandBuffer:n,contextDataBuffer:i,boundary:o}=await K8(e);console.timeEnd("get input files"),console.time("load"),Ir.set(new Kv(new Uint8Array(t),n?new Uint8Array(n):void 0,i?new Uint8Array(i):void 0,o,e.app_focus,e.study_area_name,e.project_name,e.db_schema_version)),pi(Ir).loadSavefile(e),dl.set(r),console.timeEnd("load"),X8(r)}catch(t){window.alert(`Couldn't open project: ${t}`),dl.set(void 0)}}async function K8(r){if(r.app_focus=="cnt"){console.assert(r.study_area_name,"CNT projects must have a study area name");let e=Ao(`cnt_osm/${r.study_area_name}.osm.pbf`);console.log(`Grabbing ${e}`);let n=await(await ya(e)).arrayBuffer(),i=Ao(`cnt_boundaries/${r.study_area_name}.geojson`),u=await(await ya(i)).json(),a=Ao(`cnt_demand/demand_${r.study_area_name}.bin`);console.log(`Grabbing ${a}`);let d;try{d=await(await ya(a)).arrayBuffer()}catch(y){console.log(`No demand model: ${y}`)}let p=Ao(`cnt_prioritization/context_${r.study_area_name}.bin`);console.log(`Grabbing ${p}`);let g;try{g=await(await ya(p)).arrayBuffer()}catch(y){console.log(`No context data for prioritization: ${y}`)}return{osmBuffer:n,boundary:u,demandBuffer:d,contextDataBuffer:g}}else if(r.study_area_name){let e=Ao(`severance_pbfs/${r.study_area_name}.pbf`);console.log(`Grabbing ${e}`);let n=await(await ya(e)).arrayBuffer(),i=Ao(`boundaries/${r.study_area_name}.geojson`),u=await(await ya(i)).json();return{osmBuffer:n,boundary:u}}else{console.log("Grabbing from Overpass");let e=r.features.find(i=>i.properties.kind=="study_area_boundary");return{osmBuffer:await(await ya(Wv(e))).arrayBuffer(),boundary:e}}}function X8(r){pd.set(new ik(pi(Do),pi(Ir).toRouteSnapper(),Ln(Hi()),Ln(!0),Ln(0))),pi(Do).fitBounds(pi(Ir).getBounds(),{duration:500});let e=new URL(window.location.href);e.searchParams.set("project",r),window.history.replaceState(null,"",e.toString())}function X1(r,e,t){const n=r.slice();return n[16]=e[t][0],n[17]=e[t][1],n}function J1(r,e,t){const n=r.slice();return n[20]=e[t][0],n[21]=e[t][1],n}function J8(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function Y8(r){let e,t,n,i,o,u,a,d;return o=new Rn({props:{$$slots:{default:[J8]},$$scope:{ctx:r}}}),o.$on("click",$o),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),de(o.$$.fragment),u=oe(),a=U("li"),a.textContent="New project",ue(t,"aria-label","breadcrumb"),ue(e,"slot","top")},m(p,g){q(p,e,g),$(e,t),$(t,n),$(n,i),he(o,i,null),$(n,u),$(n,a),d=!0},p(p,g){const y={};g&16777216&&(y.$$scope={dirty:g,ctx:p}),o.$set(y)},i(p){d||(j(o.$$.fragment,p),d=!0)},o(p){G(o.$$.fragment,p),d=!1},d(p){p&&V(e),fe(o)}}}function Y1(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L;e=new kh({props:{loading:r[4]}});let D=$n(r[3]),R=[];for(let z=0;z<D.length;z+=1)R[z]=eb(X1(r,D,z));return y=new H8({props:{map:r[5]}}),y.$on("gotXml",r[6]),y.$on("loading",r[10]),y.$on("error",r[11]),{c(){de(e.$$.fragment),t=oe(),n=U("label"),i=xe(`Load a built-in area:
        `),o=U("select"),u=U("option");for(let z=0;z<R.length;z+=1)R[z].c();a=oe(),d=U("i"),d.textContent="or...",p=oe(),g=U("div"),de(y.$$.fragment),u.__value="",qn(u,u.__value),r[2]===void 0&&ls(()=>r[8].call(o))},m(z,I){he(e,z,I),q(z,t,I),q(z,n,I),$(n,i),$(n,o),$(o,u);for(let F=0;F<R.length;F+=1)R[F]&&R[F].m(o,null);qi(o,r[2],!0),q(z,a,I),q(z,d,I),q(z,p,I),q(z,g,I),he(y,g,null),w=!0,T||(L=[yt(o,"change",r[8]),yt(o,"change",r[9])],T=!0)},p(z,I){const F={};if(I&16&&(F.loading=z[4]),e.$set(F),I&8){D=$n(z[3]);let W;for(W=0;W<D.length;W+=1){const se=X1(z,D,W);R[W]?R[W].p(se,I):(R[W]=eb(se),R[W].c(),R[W].m(o,null))}for(;W<R.length;W+=1)R[W].d(1);R.length=D.length}I&12&&qi(o,z[2]);const N={};I&32&&(N.map=z[5]),y.$set(N)},i(z){w||(j(e.$$.fragment,z),j(y.$$.fragment,z),w=!0)},o(z){G(e.$$.fragment,z),G(y.$$.fragment,z),w=!1},d(z){z&&(V(t),V(n),V(a),V(d),V(p),V(g)),fe(e,z),mi(R,z),fe(y),T=!1,mr(L)}}}function Q1(r){let e,t=r[21]+"",n,i;return{c(){e=U("option"),n=xe(t),e.__value=i=r[20],qn(e,e.__value)},m(o,u){q(o,e,u),$(e,n)},p(o,u){u&8&&t!==(t=o[21]+"")&&St(n,t),u&8&&i!==(i=o[20])&&(e.__value=i,qn(e,e.__value))},d(o){o&&V(e)}}}function eb(r){let e,t,n=$n(r[17]),i=[];for(let o=0;o<n.length;o+=1)i[o]=Q1(J1(r,n,o));return{c(){e=U("optgroup");for(let o=0;o<i.length;o+=1)i[o].c();ue(e,"label",t=r[16])},m(o,u){q(o,e,u);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(e,null)},p(o,u){if(u&8){n=$n(o[17]);let a;for(a=0;a<n.length;a+=1){const d=J1(o,n,a);i[a]?i[a].p(d,u):(i[a]=Q1(d),i[a].c(),i[a].m(e,null))}for(;a<i.length;a+=1)i[a].d(1);i.length=n.length}u&8&&t!==(t=o[16])&&ue(e,"label",t)},d(o){o&&V(e),mi(i,o)}}}function Q8(r){let e,t,n,i,o,u,a,d,p,g=r[1]&&Y1(r);return{c(){e=U("div"),t=U("div"),n=U("label"),i=xe(`Project name:
        `),o=U("input"),u=oe(),g&&g.c(),ue(o,"type","text"),ue(e,"slot","sidebar")},m(y,w){q(y,e,w),$(e,t),$(t,n),$(n,i),$(n,o),qn(o,r[1]),$(e,u),g&&g.m(e,null),a=!0,d||(p=yt(o,"input",r[7]),d=!0)},p(y,w){w&2&&o.value!==y[1]&&qn(o,y[1]),y[1]?g?(g.p(y,w),w&2&&j(g,1)):(g=Y1(y),g.c(),j(g,1),g.m(e,null)):g&&(tn(),G(g,1,1,()=>{g=null}),nn())},i(y){a||(j(g),a=!0)},o(y){G(g),a=!1},d(y){y&&V(e),g&&g.d(),d=!1,p()}}}function eP(r){let e,t,n;return t=new U8({}),{c(){e=U("div"),de(t.$$.fragment),ue(e,"slot","map")},m(i,o){q(i,e,o),he(t,e,null),n=!0},p:rt,i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&V(e),fe(t)}}}function tP(r){let e,t;return e=new _o({props:{$$slots:{map:[eP],sidebar:[Q8],top:[Y8]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,[i]){const o={};i&16777278&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function nP(r,e,t){let n,i,o,u,a;st(r,an,F=>t(12,n=F)),st(r,Xs,F=>t(13,i=F)),st(r,Ir,F=>t(14,o=F)),st(r,Ro,F=>t(15,u=F)),st(r,Do,F=>t(5,a=F));let d="",p=null,g=[],y="";Ts(async()=>{let F=await ya(Ao("severance_pbfs/areas.json"));t(3,g=await F.json())});async function w(F){t(4,y="Loading OSM");try{let N;Ot(Ir,o=new Kv(new TextEncoder().encode(F.detail.xml),void 0,void 0,F.detail.boundary,u,N,d,i.dbSchemaVersion),o);const W=i.createProject(o.toSavefile());await wh(W),Ot(an,n={mode:"add-neighbourhood"},n)}catch(N){window.alert(`Couldn't import from Overpass: ${N}`)}t(4,y="")}async function T(){if(!p)return;let F;try{F=i.createEmptyProject(d,p)}catch(N){t(2,p=null),window.alert(`Couldn't create project: ${N}`);return}t(4,y=`Loading pre-clipped OSM area ${p}`),await wh(F),Ot(an,n={mode:"add-neighbourhood"},n),t(4,y="")}function L(){d=this.value,t(1,d)}function D(){p=va(this),t(2,p),t(3,g)}return[T,d,p,g,y,a,w,L,D,()=>T(),F=>t(4,y=F.detail),F=>window.alert(F.detail)]}class rP extends It{constructor(e){super(),Et(this,e,nP,tP,xt,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}const iP="/ltn/assets/boundaries-2701bb3b.geojson";function tb(r,e,t){const n=r.slice();return n[9]=e[t],n}function oP(r){let e=r[9]+"",t;return{c(){t=xe(e)},m(n,i){q(n,t,i)},p(n,i){i&2&&e!==(e=n[9]+"")&&St(t,e)},d(n){n&&V(t)}}}function nb(r){let e,t,n;function i(){return r[5](r[9])}return t=new Rn({props:{$$slots:{default:[oP]},$$scope:{ctx:r}}}),t.$on("click",i),{c(){e=U("li"),de(t.$$.fragment)},m(o,u){q(o,e,u),he(t,e,null),n=!0},p(o,u){r=o;const a={};u&4098&&(a.$$scope={dirty:u,ctx:r}),t.$set(a)},i(o){n||(j(t.$$.fragment,o),n=!0)},o(o){G(t.$$.fragment,o),n=!1},d(o){o&&V(e),fe(t)}}}function sP(r){let e,t,n=r[8].name+"",i;return{c(){e=U("p"),t=xe("Click to start a new project in "),i=xe(n)},m(o,u){q(o,e,u),$(e,t),$(e,i)},p(o,u){u&256&&n!==(n=o[8].name+"")&&St(i,n)},d(o){o&&V(e)}}}function aP(r){let e,t;return e=new fi({props:{openOn:"hover",$$slots:{default:[sP,({props:n})=>({8:n}),({props:n})=>n?256:0]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&4352&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function lP(r){let e,t,n,i;return e=new Pi({props:{paint:{"fill-color":po.mapFeature.hover.backgroundColor,"fill-outline-color":po.mapFeature.hover.backgroundColor,"fill-opacity":Wn(0,.5)},beforeId:"Road labels",manageHoverState:!0,hoverCursor:"pointer",$$slots:{default:[aP]},$$scope:{ctx:r}}}),e.$on("click",r[2]),n=new tr({props:{paint:{"line-color":po.mapFeature.hover.backgroundColor,"line-width":2.5},beforeId:"Road labels",manageHoverState:!1}}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment)},m(o,u){he(e,o,u),q(o,t,u),he(n,o,u),i=!0},p(o,u){const a={};u&4096&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){i||(j(e.$$.fragment,o),j(n.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),G(n.$$.fragment,o),i=!1},d(o){o&&V(t),fe(e,o),fe(n,o)}}}function cP(r){let e,t,n,i,o,u,a=$n(r[1]),d=[];for(let g=0;g<a.length;g+=1)d[g]=nb(tb(r,a,g));const p=g=>G(d[g],1,1,()=>{d[g]=null});return o=new dr({props:{data:r[0],generateId:!0,$$slots:{default:[lP]},$$scope:{ctx:r}}}),{c(){e=U("p"),e.textContent="Choose a boundary below or on the map to begin sketching:",t=oe(),n=U("ul");for(let g=0;g<d.length;g+=1)d[g].c();i=oe(),de(o.$$.fragment),ut(n,"columns","3")},m(g,y){q(g,e,y),q(g,t,y),q(g,n,y);for(let w=0;w<d.length;w+=1)d[w]&&d[w].m(n,null);q(g,i,y),he(o,g,y),u=!0},p(g,[y]){if(y&10){a=$n(g[1]);let T;for(T=0;T<a.length;T+=1){const L=tb(g,a,T);d[T]?(d[T].p(L,y),j(d[T],1)):(d[T]=nb(L),d[T].c(),j(d[T],1),d[T].m(n,null))}for(tn(),T=a.length;T<d.length;T+=1)p(T);nn()}const w={};y&1&&(w.data=g[0]),y&4096&&(w.$$scope={dirty:y,ctx:g}),o.$set(w)},i(g){if(!u){for(let y=0;y<a.length;y+=1)j(d[y]);j(o.$$.fragment,g),u=!0}},o(g){d=d.filter(Boolean);for(let y=0;y<d.length;y+=1)G(d[y]);G(o.$$.fragment,g),u=!1},d(g){g&&(V(e),V(t),V(n),V(i)),mi(d,g),fe(o,g)}}}function uP(r,e,t){let n,i;st(r,an,y=>t(6,n=y)),st(r,Xs,y=>t(7,i=y));let{activityIndicatorText:o}=e,u={type:"FeatureCollection",features:[]},a=[];Ts(async()=>{let y=await fetch(iP);t(0,u=await y.json());for(let w of u.features)a.push(w.properties.name);a.sort(),t(1,a)});function d(y){let w=y.detail.features[0].properties;p(`${w.kind}_${w.name}`)}async function p(y){let w,T=!1;for(;!T;){let L=w||i.nextAvailableProjectName(ah(y));if(w=window.prompt(`Please pick a project name to create in ${ah(y)}`,L),w===null)return;if(w=w.trim(),w===""){window.alert("Project name cannot be blank; Please pick a name or cancel.");continue}t(4,o=`Loading pre-clipped OSM area ${ah(y)}`);try{let D=i.createEmptyProject(w,y);await wh(D),Ot(an,n={mode:"add-neighbourhood"},n),T=!0}catch(D){window.alert(D)}t(4,o="")}}const g=y=>p(`LAD_${y}`);return r.$$set=y=>{"activityIndicatorText"in y&&t(4,o=y.activityIndicatorText)},[u,a,d,p,o,g]}class hP extends It{constructor(e){super(),Et(this,e,uP,cP,xt,{activityIndicatorText:4})}}function fP(r){let e,t,n,i,o,u;return{c(){e=U("label"),t=U("strong"),t.textContent="Load a project from a file",n=oe(),i=U("input"),ue(i,"type","file"),ut(e,"margin-top","16px")},m(a,d){q(a,e,d),$(e,t),$(e,n),$(e,i),r[3](i),o||(u=yt(i,"change",r[1]),o=!0)},p:rt,i:rt,o:rt,d(a){a&&V(e),r[3](null),o=!1,u()}}}function dP(r,e,t){let n;st(r,an,d=>t(4,n=d));let{loading:i}=e,o;async function u(d){let p=o.files[0].name;t(2,i=`Loading from file ${p}`);let g=await o.files[0].text(),y=JSON.parse(g),w,T,L;y.app_focus&&(console.assert(y.app_focus=="global"||y.app_focus=="cnt"),w=y.app_focus),y.study_area_name&&(T=y.study_area_name),y.project_name&&(L=y.project_name),(!y.app_focus||!y.project_name)&&(y.study_area_name&&y.study_area_name.startsWith("LAD_")?(w="cnt",L=C0(fm(p,`ltn_cnt_${y.study_area_name}_`),".geojson")):(w="global",L=C0(fm(p,"ltn_"),".geojson"))),L=L,w=w;let D=jm.projectStorage(w);L=D.nextAvailableProjectName(L),y.project_name=L,y.app_focus=w,y.study_area_name=T;let R=D.createProject(y);await wh(R),Ot(an,n={mode:"pick-neighbourhood"},n),t(2,i="")}function a(d){un[d?"unshift":"push"](()=>{o=d,t(0,o)})}return r.$$set=d=>{"loading"in d&&t(2,i=d.loading)},[o,u,i,a]}class pP extends It{constructor(e){super(),Et(this,e,dP,fP,xt,{loading:2})}}function rb(r,e,t){const n=r.slice();return n[22]=e[t][0],n[23]=e[t][1],n}function ib(r,e,t){const n=r.slice();return n[26]=e[t].projectID,n[27]=e[t].projectName,n}function mP(r){let e;return{c(){e=U("div"),e.innerHTML='<nav aria-label="breadcrumb"><ul><li>Choose project</li></ul></nav>',ue(e,"slot","top")},m(t,n){q(t,e,n)},p:rt,d(t){t&&V(e)}}}function _P(r){let e;return{c(){e=U("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(t,n){q(t,e,n)},p:rt,i:rt,o:rt,d(t){t&&V(e)}}}function gP(r){let e,t,n,i,o,u,a,d,p,g=r[2].length>0&&ob(r);const y=[vP,bP],w=[];function T(R,z){return R[5]=="global"?0:R[5]=="cnt"?1:-1}~(i=T(r))&&(o=w[i]=y[i](r));function L(R){r[16](R)}let D={};return r[1]!==void 0&&(D.loading=r[1]),a=new pP({props:D}),un.push(()=>Cn(a,"loading",L)),{c(){g&&g.c(),e=oe(),t=U("h1"),t.textContent="Start a new project",n=oe(),o&&o.c(),u=oe(),de(a.$$.fragment)},m(R,z){g&&g.m(R,z),q(R,e,z),q(R,t,z),q(R,n,z),~i&&w[i].m(R,z),q(R,u,z),he(a,R,z),p=!0},p(R,z){R[2].length>0?g?(g.p(R,z),z&4&&j(g,1)):(g=ob(R),g.c(),j(g,1),g.m(e.parentNode,e)):g&&(tn(),G(g,1,1,()=>{g=null}),nn());let I=i;i=T(R),i===I?~i&&w[i].p(R,z):(o&&(tn(),G(w[I],1,1,()=>{w[I]=null}),nn()),~i?(o=w[i],o?o.p(R,z):(o=w[i]=y[i](R),o.c()),j(o,1),o.m(u.parentNode,u)):o=null);const F={};!d&&z&2&&(d=!0,F.loading=R[1],Sn(()=>d=!1)),a.$set(F)},i(R){p||(j(g),j(o),j(a.$$.fragment,R),p=!0)},o(R){G(g),G(o),G(a.$$.fragment,R),p=!1},d(R){R&&(V(e),V(t),V(n),V(u)),g&&g.d(R),~i&&w[i].d(R),fe(a,R)}}}function ob(r){let e,t,n,i,o=$n(r[2]),u=[];for(let d=0;d<o.length;d+=1)u[d]=ab(rb(r,o,d));const a=d=>G(u[d],1,1,()=>{u[d]=null});return{c(){e=U("h1"),e.textContent="Your projects",t=oe(),n=U("div");for(let d=0;d<u.length;d+=1)u[d].c();ue(n,"class","project-list svelte-s5f8l2")},m(d,p){q(d,e,p),q(d,t,p),q(d,n,p);for(let g=0;g<u.length;g+=1)u[g]&&u[g].m(n,null);i=!0},p(d,p){if(p&452){o=$n(d[2]);let g;for(g=0;g<o.length;g+=1){const y=rb(d,o,g);u[g]?(u[g].p(y,p),j(u[g],1)):(u[g]=ab(y),u[g].c(),j(u[g],1),u[g].m(n,null))}for(tn(),g=o.length;g<u.length;g+=1)a(g);nn()}},i(d){if(!i){for(let p=0;p<o.length;p+=1)j(u[p]);i=!0}},o(d){u=u.filter(Boolean);for(let p=0;p<u.length;p+=1)G(u[p]);i=!1},d(d){d&&(V(e),V(t),V(n)),mi(u,d)}}}function yP(r){let e=r[27]+"",t;return{c(){t=xe(e)},m(n,i){q(n,t,i)},p(n,i){i&4&&e!==(e=n[27]+"")&&St(t,e)},d(n){n&&V(t)}}}function sb(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L,D,R;function z(){return r[10](r[26],r[27])}n=new Rn({props:{$$slots:{default:[yP]},$$scope:{ctx:r}}}),n.$on("click",z),a=new Ob({props:{color:"black"}});function I(){return r[11](r[26])}g=new Nb({props:{color:"black"}});function F(){return r[12](r[26],r[27])}T=new Um({props:{color:"white"}});function N(){return r[13](r[26],r[27])}return{c(){e=U("li"),t=U("h3"),de(n.$$.fragment),i=oe(),o=U("span"),u=U("button"),de(a.$$.fragment),d=oe(),p=U("button"),de(g.$$.fragment),y=oe(),w=U("button"),de(T.$$.fragment),ue(u,"class","outline icon-btn"),ue(u,"title","Download project as GeoJSON"),ue(p,"class","outline icon-btn"),ue(p,"title","Rename project"),ue(w,"class","icon-btn destructive"),ue(w,"title","Delete project"),ue(o,"class","actions"),ue(e,"class","actionable-cell svelte-s5f8l2")},m(W,se){q(W,e,se),$(e,t),he(n,t,null),$(e,i),$(e,o),$(o,u),he(a,u,null),$(o,d),$(o,p),he(g,p,null),$(o,y),$(o,w),he(T,w,null),L=!0,D||(R=[yt(u,"click",I),yt(p,"click",F),yt(w,"click",N)],D=!0)},p(W,se){r=W;const J={};se&1073741828&&(J.$$scope={dirty:se,ctx:r}),n.$set(J)},i(W){L||(j(n.$$.fragment,W),j(a.$$.fragment,W),j(g.$$.fragment,W),j(T.$$.fragment,W),L=!0)},o(W){G(n.$$.fragment,W),G(a.$$.fragment,W),G(g.$$.fragment,W),G(T.$$.fragment,W),L=!1},d(W){W&&V(e),fe(n),fe(a),fe(g),fe(T),D=!1,mr(R)}}}function ab(r){let e,t=ah(r[22])+"",n,i,o,u,a,d=$n(r[23]),p=[];for(let y=0;y<d.length;y+=1)p[y]=sb(ib(r,d,y));const g=y=>G(p[y],1,1,()=>{p[y]=null});return{c(){e=U("h2"),n=xe(t),i=oe(),o=U("ul");for(let y=0;y<p.length;y+=1)p[y].c();u=oe(),ue(e,"class","study-area-name svelte-s5f8l2"),ue(o,"class","navigable-list")},m(y,w){q(y,e,w),$(e,n),q(y,i,w),q(y,o,w);for(let T=0;T<p.length;T+=1)p[T]&&p[T].m(o,null);$(o,u),a=!0},p(y,w){if((!a||w&4)&&t!==(t=ah(y[22])+"")&&St(n,t),w&452){d=$n(y[23]);let T;for(T=0;T<d.length;T+=1){const L=ib(y,d,T);p[T]?(p[T].p(L,w),j(p[T],1)):(p[T]=sb(L),p[T].c(),j(p[T],1),p[T].m(o,u))}for(tn(),T=d.length;T<p.length;T+=1)g(T);nn()}},i(y){if(!a){for(let w=0;w<d.length;w+=1)j(p[w]);a=!0}},o(y){p=p.filter(Boolean);for(let w=0;w<p.length;w+=1)G(p[w]);a=!1},d(y){y&&(V(e),V(i),V(o)),mi(p,y)}}}function bP(r){let e,t,n;function i(u){r[15](u)}let o={};return r[1]!==void 0&&(o.activityIndicatorText=r[1]),e=new hP({props:o}),un.push(()=>Cn(e,"activityIndicatorText",i)),{c(){de(e.$$.fragment)},m(u,a){he(e,u,a),n=!0},p(u,a){const d={};!t&&a&2&&(t=!0,d.activityIndicatorText=u[1],Sn(()=>t=!1)),e.$set(d)},i(u){n||(j(e.$$.fragment,u),n=!0)},o(u){G(e.$$.fragment,u),n=!1},d(u){fe(e,u)}}}function vP(r){let e,t,n;return{c(){e=U("button"),e.textContent="New project"},m(i,o){q(i,e,o),t||(n=yt(e,"click",r[14]),t=!0)},p:rt,i:rt,o:rt,d(i){i&&V(e),t=!1,n()}}}function wP(r){let e,t,n,i;const o=[gP,_P],u=[];function a(d,p){return d[4]&&d[0]?0:1}return t=a(r),n=u[t]=o[t](r),{c(){e=U("div"),n.c(),ue(e,"slot","sidebar")},m(d,p){q(d,e,p),u[t].m(e,null),i=!0},p(d,p){let g=t;t=a(d),t===g?u[t].p(d,p):(tn(),G(u[g],1,1,()=>{u[g]=null}),nn(),n=u[t],n?n.p(d,p):(n=u[t]=o[t](d),n.c()),j(n,1),n.m(e,null))},i(d){i||(j(n),i=!0)},o(d){G(n),i=!1},d(d){d&&V(e),u[t].d()}}}function xP(r){let e,t,n,i;return e=new kh({props:{loading:r[1]}}),n=new _o({props:{$$slots:{sidebar:[wP],top:[mP]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment)},m(o,u){he(e,o,u),q(o,t,u),he(n,o,u),i=!0},p(o,[u]){const a={};u&2&&(a.loading=o[1]),e.$set(a);const d={};u&1073741887&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(j(e.$$.fragment,o),j(n.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),G(n.$$.fragment,o),i=!1},d(o){o&&V(t),fe(e,o),fe(n,o)}}}function kP(r,e,t){let n,i,o,u,a,d,p;st(r,an,_e=>t(3,n=_e)),st(r,Xs,_e=>t(17,i=_e)),st(r,dl,_e=>t(18,o=_e)),st(r,pd,_e=>t(19,u=_e)),st(r,Ir,_e=>t(20,a=_e)),st(r,Do,_e=>t(4,d=_e)),st(r,Ro,_e=>t(5,p=_e));let{wasmReady:g}=e,{firstLoad:y}=e,w="";if(Ot(Ir,a=null,a),Ot(pd,u=null,u),Ot(dl,o=void 0,o),y){let ze=new URLSearchParams(window.location.search).get("project");ze&&L(ze)}else{let _e=new URL(window.location.href);_e.searchParams.delete("project"),window.history.replaceState(null,"",_e.toString())}let T=i.studyAreaProjects();function L(_e){let ze=_e;try{let ee=i.projectName(ze);if(!ee){console.error(`Project ${ze} from URL not found`);return}z(ze,ee)}catch{console.error(`Error trying to fetch project from URL: ${ze}`)}}function D(_e,ze){window.confirm(`Really delete project ${ze}? You can't undo this.`)&&(i.removeProject(_e),t(2,T=i.studyAreaProjects()))}function R(_e,ze){let ee=window.prompt(`Rename project ${ze} to what?`,ze);if(ee){try{i.renameProject(_e,ee)}catch(ae){window.alert(`Couldn't rename project: ${ae}`)}t(2,T=i.studyAreaProjects())}}async function z(_e,ze){t(1,w=`Loading project ${ze}`),await wh(_e),Ot(an,n={mode:"pick-neighbourhood"},n),t(1,w="")}const I=(_e,ze)=>z(_e,ze),F=_e=>pv(_e),N=(_e,ze)=>R(_e,ze),W=(_e,ze)=>D(_e,ze),se=()=>Ot(an,n={mode:"new-project"},n);function J(_e){w=_e,t(1,w)}function Y(_e){w=_e,t(1,w)}return r.$$set=_e=>{"wasmReady"in _e&&t(0,g=_e.wasmReady),"firstLoad"in _e&&t(9,y=_e.firstLoad)},[g,w,T,n,d,p,D,R,z,y,I,F,N,W,se,J,Y]}class SP extends It{constructor(e){super(),Et(this,e,kP,xP,xt,{wasmReady:0,firstLoad:9})}}function CP(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function TP(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function MP(r){let e;return{c(){e=xe("Editing")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function LP(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L;return o=new Rn({props:{$$slots:{default:[CP]},$$scope:{ctx:r}}}),o.$on("click",$o),d=new Rn({props:{$$slots:{default:[TP]},$$scope:{ctx:r}}}),d.$on("click",r[6]),y=new Rn({props:{$$slots:{default:[MP]},$$scope:{ctx:r}}}),y.$on("click",r[3]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),de(o.$$.fragment),u=oe(),a=U("li"),de(d.$$.fragment),p=oe(),g=U("li"),de(y.$$.fragment),w=oe(),T=U("li"),T.textContent="Viewing shortcuts",ue(t,"aria-label","breadcrumb"),ue(e,"slot","top")},m(D,R){q(D,e,R),$(e,t),$(t,n),$(n,i),he(o,i,null),$(n,u),$(n,a),he(d,a,null),$(n,p),$(n,g),he(y,g,null),$(n,w),$(n,T),L=!0},p(D,R){const z={};R&512&&(z.$$scope={dirty:R,ctx:D}),o.$set(z);const I={};R&512&&(I.$$scope={dirty:R,ctx:D}),d.$set(I);const F={};R&512&&(F.$$scope={dirty:R,ctx:D}),y.$set(F)},i(D){L||(j(o.$$.fragment,D),j(d.$$.fragment,D),j(y.$$.fragment,D),L=!0)},o(D){G(o.$$.fragment,D),G(d.$$.fragment,D),G(y.$$.fragment,D),L=!1},d(D){D&&V(e),fe(o),fe(d),fe(y)}}}function EP(r){let e,t,n,i,o,u,a,d,p,g,y=Er(r[0].gj.features[r[0].shortcutIndex].properties).directness.toFixed(1)+"",w,T,L,D,R,z;function I(N){r[5](N)}let F={list:r[0].gj.features};return r[0].shortcutIndex!==void 0&&(F.idx=r[0].shortcutIndex),o=new wd({props:F}),un.push(()=>Cn(o,"idx",I)),{c(){e=U("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending on main (busy)
        roads, then cutting through smaller streets. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,t=oe(),n=U("button"),n.textContent="Pick a different road",i=oe(),de(o.$$.fragment),a=oe(),d=U("p"),p=xe("This shortcut is "),g=U("b"),w=xe(y),T=xe("x"),L=xe(`
        the length of the shortest route using all roads, not just this neighbourhood`)},m(N,W){q(N,e,W),q(N,t,W),q(N,n,W),q(N,i,W),he(o,N,W),q(N,a,W),q(N,d,W),$(d,p),$(d,g),$(g,w),$(g,T),$(d,L),D=!0,R||(z=yt(n,"click",r[4]),R=!0)},p(N,W){const se={};W&1&&(se.list=N[0].gj.features),!u&&W&1&&(u=!0,se.idx=N[0].shortcutIndex,Sn(()=>u=!1)),o.$set(se),(!D||W&1)&&y!==(y=Er(N[0].gj.features[N[0].shortcutIndex].properties).directness.toFixed(1)+"")&&St(w,y)},i(N){D||(j(o.$$.fragment,N),D=!0)},o(N){G(o.$$.fragment,N),D=!1},d(N){N&&(V(e),V(t),V(n),V(i),V(a),V(d)),fe(o,N),R=!1,z()}}}function IP(r){let e;return{c(){e=U("p"),e.textContent="Click a road to see shortcuts"},m(t,n){q(t,e,n)},p:rt,i:rt,o:rt,d(t){t&&V(e)}}}function AP(r){let e,t,n,i,o,u;t=new Ys({}),t.$on("click",r[3]);const a=[IP,EP],d=[];function p(g,y){return g[0].state=="neutral"?0:g[0].state=="chose-road"?1:-1}return~(i=p(r))&&(o=d[i]=a[i](r)),{c(){e=U("div"),de(t.$$.fragment),n=oe(),o&&o.c(),ue(e,"slot","sidebar")},m(g,y){q(g,e,y),he(t,e,null),$(e,n),~i&&d[i].m(e,null),u=!0},p(g,y){let w=i;i=p(g),i===w?~i&&d[i].p(g,y):(o&&(tn(),G(d[w],1,1,()=>{d[w]=null}),nn()),~i?(o=d[i],o?o.p(g,y):(o=d[i]=a[i](g),o.c()),j(o,1),o.m(e,null)):o=null)},i(g){u||(j(t.$$.fragment,g),j(o),u=!0)},o(g){G(t.$$.fragment,g),G(o),u=!1},d(g){g&&V(e),fe(t),~i&&d[i].d()}}}function PP(r){let e,t;return e=new Eh({props:{interactive:!1}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p:rt,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function zP(r){let e,t;return e=new Eh({props:{onClickLine:r[2],$$slots:{"line-popup":[FP]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&512&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function DP(r){let e,t,n=(r[8].name??"unnamed road")+"",i;return{c(){e=U("p"),t=xe("Main road: "),i=xe(n)},m(o,u){q(o,e,u),$(e,t),$(e,i)},p(o,u){u&256&&n!==(n=(o[8].name??"unnamed road")+"")&&St(i,n)},d(o){o&&V(e)}}}function RP(r){let e,t=r[8].shortcuts+"",n,i,o=(r[8].name??"unnamed road")+"",u;return{c(){e=U("p"),n=xe(t),i=xe(" shortcuts through "),u=xe(o)},m(a,d){q(a,e,d),$(e,n),$(e,i),$(e,u)},p(a,d){d&256&&t!==(t=a[8].shortcuts+"")&&St(n,t),d&256&&o!==(o=(a[8].name??"unnamed road")+"")&&St(u,o)},d(a){a&&V(e)}}}function $P(r){let e;function t(o,u){if(o[8].kind=="interior_road")return RP;if(o[8].kind=="main_road")return DP}let n=t(r),i=n&&n(r);return{c(){i&&i.c(),e=Jn()},m(o,u){i&&i.m(o,u),q(o,e,u)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&V(e),i&&i.d(o)}}}function FP(r){let e,t,n;return t=new fi({props:{openOn:"hover",$$slots:{default:[$P,({props:i})=>({8:i}),({props:i})=>i?256:0]},$$scope:{ctx:r}}}),{c(){e=U("div"),de(t.$$.fragment),ue(e,"slot","line-popup")},m(i,o){q(i,e,o),he(t,e,null),n=!0},p(i,o){const u={};o&768&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&V(e),fe(t)}}}function BP(r){let e,t,n,i,o,u,a,d,p,g;e=new Ed({}),n=new Ld({}),o=new Id({});const y=[zP,PP],w=[];function T(L,D){return L[0].state=="neutral"?0:L[0].state=="chose-road"?1:-1}return~(a=T(r))&&(d=w[a]=y[a](r)),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment),i=oe(),de(o.$$.fragment),u=oe(),d&&d.c(),p=Jn()},m(L,D){he(e,L,D),q(L,t,D),he(n,L,D),q(L,i,D),he(o,L,D),q(L,u,D),~a&&w[a].m(L,D),q(L,p,D),g=!0},p(L,D){let R=a;a=T(L),a===R?~a&&w[a].p(L,D):(d&&(tn(),G(w[R],1,1,()=>{w[R]=null}),nn()),~a?(d=w[a],d?d.p(L,D):(d=w[a]=y[a](L),d.c()),j(d,1),d.m(p.parentNode,p)):d=null)},i(L){g||(j(e.$$.fragment,L),j(n.$$.fragment,L),j(o.$$.fragment,L),j(d),g=!0)},o(L){G(e.$$.fragment,L),G(n.$$.fragment,L),G(o.$$.fragment,L),G(d),g=!1},d(L){L&&(V(t),V(i),V(u),V(p)),fe(e,L),fe(n,L),fe(o,L),~a&&w[a].d(L)}}}function lb(r){let e,t,n,i,o,u,a,d;return e=new dr({props:{data:r[0].gj.features[r[0].shortcutIndex],$$slots:{default:[OP]},$$scope:{ctx:r}}}),n=new dr({props:{data:r[0].roadGj,$$slots:{default:[NP]},$$scope:{ctx:r}}}),o=new pl({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[0],$$slots:{default:[jP]},$$scope:{ctx:r}}}),a=new pl({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[r[0].gj.features[r[0].shortcutIndex].geometry.coordinates.length-1],$$slots:{default:[UP]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment),i=oe(),de(o.$$.fragment),u=oe(),de(a.$$.fragment)},m(p,g){he(e,p,g),q(p,t,g),he(n,p,g),q(p,i,g),he(o,p,g),q(p,u,g),he(a,p,g),d=!0},p(p,g){const y={};g&1&&(y.data=p[0].gj.features[p[0].shortcutIndex]),g&512&&(y.$$scope={dirty:g,ctx:p}),e.$set(y);const w={};g&1&&(w.data=p[0].roadGj),g&512&&(w.$$scope={dirty:g,ctx:p}),n.$set(w);const T={};g&1&&(T.lngLat=p[0].gj.features[p[0].shortcutIndex].geometry.coordinates[0]),g&512&&(T.$$scope={dirty:g,ctx:p}),o.$set(T);const L={};g&1&&(L.lngLat=p[0].gj.features[p[0].shortcutIndex].geometry.coordinates[p[0].gj.features[p[0].shortcutIndex].geometry.coordinates.length-1]),g&512&&(L.$$scope={dirty:g,ctx:p}),a.$set(L)},i(p){d||(j(e.$$.fragment,p),j(n.$$.fragment,p),j(o.$$.fragment,p),j(a.$$.fragment,p),d=!0)},o(p){G(e.$$.fragment,p),G(n.$$.fragment,p),G(o.$$.fragment,p),G(a.$$.fragment,p),d=!1},d(p){p&&(V(t),V(i),V(u)),fe(e,p),fe(n,p),fe(o,p),fe(a,p)}}}function OP(r){let e,t;const n=[dn("shortcuts"),{paint:{"line-width":10,"line-color":"cyan"}}];let i={};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new tr({props:i}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function NP(r){let e,t;const n=[dn("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let i={};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new tr({props:i}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function jP(r){let e;return{c(){e=xe("A")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function UP(r){let e;return{c(){e=xe("B")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function VP(r){let e,t,n,i,o,u;t=new Ih({props:{$$slots:{default:[BP]},$$scope:{ctx:r}}});let a=r[0].state=="chose-road"&&lb(r);return o=new Ra({}),{c(){e=U("div"),de(t.$$.fragment),n=oe(),a&&a.c(),i=oe(),de(o.$$.fragment),ue(e,"slot","map")},m(d,p){q(d,e,p),he(t,e,null),$(e,n),a&&a.m(e,null),$(e,i),he(o,e,null),u=!0},p(d,p){const g={};p&513&&(g.$$scope={dirty:p,ctx:d}),t.$set(g),d[0].state=="chose-road"?a?(a.p(d,p),p&1&&j(a,1)):(a=lb(d),a.c(),j(a,1),a.m(e,i)):a&&(tn(),G(a,1,1,()=>{a=null}),nn())},i(d){u||(j(t.$$.fragment,d),j(a),j(o.$$.fragment,d),u=!0)},o(d){G(t.$$.fragment,d),G(a),G(o.$$.fragment,d),u=!1},d(d){d&&V(e),fe(t),a&&a.d(),fe(o)}}}function qP(r){let e,t;return e=new _o({props:{$$slots:{map:[VP],sidebar:[AP],top:[LP]},$$scope:{ctx:r}}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,[i]){const o={};i&515&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function ZP(r,e,t){let n,i;st(r,an,y=>t(1,n=y)),st(r,Ir,y=>t(7,i=y));let o={state:"neutral"};function u(y,w){let T=i.getShortcutsCrossingRoad(y.properties.id);if(T.features.length==0){window.alert("No shortcuts here");return}t(0,o={state:"chose-road",roadGj:y,gj:T,shortcutIndex:0})}function a(){Ot(an,n={mode:"neighbourhood"},n)}const d=()=>t(0,o={state:"neutral"});function p(y){r.$$.not_equal(o.shortcutIndex,y)&&(o.shortcutIndex=y,t(0,o))}return[o,n,u,a,d,p,()=>Ot(an,n={mode:"pick-neighbourhood"},n)]}class GP extends It{constructor(e){super(),Et(this,e,ZP,qP,xt,{})}}function HP(r){let e,t,n,i,o,u,a,d,p;return i=new r8({}),{c(){e=U("div"),t=U("button"),t.innerHTML=`<img src="${nx}" alt="A/B Street logo"/>`,n=oe(),de(i.$$.fragment),o=oe(),u=U("span"),ue(t,"class","outline"),ut(u,"width","100%"),ue(e,"slot","top"),ue(e,"class","pico"),ut(e,"display","flex"),ut(e,"align-items","center"),ut(e,"gap","8px")},m(g,y){q(g,e,y),$(e,t),$(e,n),he(i,e,null),$(e,o),$(e,u),r[23](u),a=!0,d||(p=yt(t,"click",r[22]),d=!0)},p:rt,i(g){a||(j(i.$$.fragment,g),a=!0)},o(g){G(i.$$.fragment,g),a=!1},d(g){g&&V(e),fe(i),r[23](null),d=!1,p()}}}function cb(r){let e,t,n,i,o,u;return n=new uS({props:{map:Er(r[7]),maptilerBasemap:r[9]}}),{c(){e=U("button"),e.textContent="Zoom to fit study area",t=oe(),de(n.$$.fragment),ue(e,"class","secondary")},m(a,d){q(a,e,d),q(a,t,d),he(n,a,d),i=!0,o||(u=yt(e,"click",r[12]),o=!0)},p(a,d){const p={};d&128&&(p.map=Er(a[7])),d&512&&(p.maptilerBasemap=a[9]),n.$set(p)},i(a){i||(j(n.$$.fragment,a),i=!0)},o(a){G(n.$$.fragment,a),i=!1},d(a){a&&(V(e),V(t)),fe(n,a),o=!1,u()}}}function WP(r){let e,t,n,i,o,u,a=r[6]&&cb(r);return{c(){e=U("div"),t=U("div"),n=oe(),i=U("hr"),o=oe(),a&&a.c(),ue(e,"class","pico"),ue(e,"slot","left")},m(d,p){q(d,e,p),$(e,t),r[21](t),$(e,n),$(e,i),$(e,o),a&&a.m(e,null),u=!0},p(d,p){d[6]?a?(a.p(d,p),p&64&&j(a,1)):(a=cb(d),a.c(),j(a,1),a.m(e,null)):a&&(tn(),G(a,1,1,()=>{a=null}),nn())},i(d){u||(j(a),u=!0)},o(d){G(a),u=!1},d(d){d&&V(e),r[21](null),a&&a.d()}}}function KP(r){return{c:rt,m:rt,p:rt,i:rt,o:rt,d:rt}}function XP(r){let e,t,n;function i(u){r[19](u)}let o={style:r[25],hash:!0,bounds:r[5],maxZoom:19,images:[{id:"walk_cycle_only",url:"/ltn//filters/walk_cycle_only_icon.gif"},{id:"no_entry",url:"/ltn//filters/no_entry_icon.gif"},{id:"bus_gate",url:"/ltn//filters/bus_gate_icon.gif"},{id:"school_street",url:"/ltn//filters/school_street_icon.gif"},{id:"diagonal_filter",url:"/ltn//filters/diagonal_filter_icon.png"},{id:"no_straight_turn",url:"/ltn//filters/no_straight_turn.png"},{id:"no_left_turn",url:"/ltn//filters/no_left_turn.png"},{id:"no_right_turn",url:"/ltn//filters/no_right_turn.png"},{id:"no_u_left_to_right_turn",url:"/ltn//filters/no_u_left_to_right_turn.png"},{id:"no_u_right_to_left_turn",url:"/ltn//filters/no_u_right_to_left_turn.png"},{id:"oneway_arrow",url:tx},{id:"national_rail",url:yb}],$$slots:{default:[fz]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.map=r[0]),e=new I3({props:o}),un.push(()=>Cn(e,"map",i)),e.$on("error",r[20]),{c(){de(e.$$.fragment)},m(u,a){he(e,u,a),n=!0},p(u,a){const d={};a&512&&(d.style=u[25]),a&32&&(d.bounds=u[5]),a&67109977&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.map=u[0],Sn(()=>t=!1)),e.$set(d)},i(u){n||(j(e.$$.fragment,u),n=!0)},o(u){G(e.$$.fragment,u),n=!1},d(u){fe(e,u)}}}function JP(r){let e,t;return e=new rP({}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p:rt,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function YP(r){let e,t;return e=new SP({props:{wasmReady:r[4],firstLoad:r[10].firstLoad}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&16&&(o.wasmReady=n[4]),i&1024&&(o.firstLoad=n[10].firstLoad),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function ub(r){let e,t,n,i,o,u,a,d;e=new xM({}),n=new dr({props:{data:r[6].getInvertedBoundary(),$$slots:{default:[QP]},$$scope:{ctx:r}}});const p=[hz,uz,cz,lz,az,sz,oz,iz,rz,nz,tz,ez],g=[];function y(w,T){return w[10].mode=="pick-neighbourhood"?0:w[10].mode=="set-boundary"?1:w[10].mode=="add-neighbourhood"?2:w[10].mode=="neighbourhood"?3:w[10].mode=="view-shortcuts"?4:w[10].mode=="impact-one-destination"?5:w[10].mode=="route"?6:w[10].mode=="predict-impact"?7:w[10].mode=="impact-detail"?8:w[10].mode=="debug-neighbourhood"?9:w[10].mode=="debug-intersections"?10:w[10].mode=="debug-demand"?11:-1}return~(o=y(r))&&(u=g[o]=p[o](r)),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment),i=oe(),u&&u.c(),a=Jn()},m(w,T){he(e,w,T),q(w,t,T),he(n,w,T),q(w,i,T),~o&&g[o].m(w,T),q(w,a,T),d=!0},p(w,T){const L={};T&64&&(L.data=w[6].getInvertedBoundary()),T&67108864&&(L.$$scope={dirty:T,ctx:w}),n.$set(L);let D=o;o=y(w),o===D?~o&&g[o].p(w,T):(u&&(tn(),G(g[D],1,1,()=>{g[D]=null}),nn()),~o?(u=g[o],u?u.p(w,T):(u=g[o]=p[o](w),u.c()),j(u,1),u.m(a.parentNode,a)):u=null)},i(w){d||(j(e.$$.fragment,w),j(n.$$.fragment,w),j(u),d=!0)},o(w){G(e.$$.fragment,w),G(n.$$.fragment,w),G(u),d=!1},d(w){w&&(V(t),V(i),V(a)),fe(e,w),fe(n,w),~o&&g[o].d(w)}}}function QP(r){let e,t;const n=[dn("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let i={};for(let o=0;o<n.length;o+=1)i=Gt(i,n[o]);return e=new Pi({props:i}),{c(){de(e.$$.fragment)},m(o,u){he(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){fe(e,o)}}}function ez(r){let e,t;return e=new W6({}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p:rt,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function tz(r){let e,t;return e=new iL({}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p:rt,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function nz(r){let e,t;return e=new YL({}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p:rt,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function rz(r){let e,t;return e=new MI({props:{road:r[10].road}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.road=n[10].road),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function iz(r){let e,t;return e=new MA({}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p:rt,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function oz(r){let e,t;return e=new qA({props:{prevMode:r[10].prevMode}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.prevMode=n[10].prevMode),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function sz(r){let e,t;return e=new WI({}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p:rt,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function az(r){let e,t;return e=new GP({}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p:rt,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function lz(r){let e,t;return e=new _I({}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p:rt,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function cz(r){let e,t;return e=new F6({}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p:rt,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function uz(r){let e,t;return e=new YA({props:{name:r[10].name,existing:r[10].existing}}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.name=n[10].name),i&1024&&(o.existing=n[10].existing),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function hz(r){let e,t;return e=new pA({}),{c(){de(e.$$.fragment)},m(n,i){he(e,n,i),t=!0},p:rt,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function fz(r){let e,t,n,i,o,u,a,d,p,g,y,w,T,L;e=new Zb({}),n=new Gb({}),o=new QC({props:{map:r[0],apiKey:Bb,country:void 0}});const D=[YP,JP],R=[];function z(F,N){return F[10].mode=="title"?0:F[10].mode=="new-project"?1:-1}~(p=z(r))&&(g=R[p]=D[p](r));let I=r[6]&&ub(r);return T=new N4({}),{c(){de(e.$$.fragment),t=oe(),de(n.$$.fragment),i=oe(),de(o.$$.fragment),u=oe(),a=U("div"),d=oe(),g&&g.c(),y=oe(),I&&I.c(),w=oe(),de(T.$$.fragment)},m(F,N){he(e,F,N),q(F,t,N),he(n,F,N),q(F,i,N),he(o,F,N),q(F,u,N),q(F,a,N),r[18](a),q(F,d,N),~p&&R[p].m(F,N),q(F,y,N),I&&I.m(F,N),q(F,w,N),he(T,F,N),L=!0},p(F,N){const W={};N&1&&(W.map=F[0]),o.$set(W);let se=p;p=z(F),p===se?~p&&R[p].p(F,N):(g&&(tn(),G(R[se],1,1,()=>{R[se]=null}),nn()),~p?(g=R[p],g?g.p(F,N):(g=R[p]=D[p](F),g.c()),j(g,1),g.m(y.parentNode,y)):g=null),F[6]?I?(I.p(F,N),N&64&&j(I,1)):(I=ub(F),I.c(),j(I,1),I.m(w.parentNode,w)):I&&(tn(),G(I,1,1,()=>{I=null}),nn())},i(F){L||(j(e.$$.fragment,F),j(n.$$.fragment,F),j(o.$$.fragment,F),j(g),j(I),j(T.$$.fragment,F),L=!0)},o(F){G(e.$$.fragment,F),G(n.$$.fragment,F),G(o.$$.fragment,F),G(g),G(I),G(T.$$.fragment,F),L=!1},d(F){F&&(V(t),V(i),V(u),V(a),V(d),V(y),V(w)),fe(e,F),fe(n,F),fe(o,F),r[18](null),~p&&R[p].d(F),I&&I.d(F),fe(T,F)}}}function dz(r){return{c:rt,m:rt,p:rt,i:rt,o:rt,d:rt}}function pz(r){let e,t,n,i={ctx:r,current:null,token:null,hasCatch:!1,pending:dz,then:XP,catch:KP,value:25,blocks:[,,,]};return zg(t=r[13](r[9]),i),{c(){e=U("div"),i.block.c(),ue(e,"slot","main"),ut(e,"position","relative"),ut(e,"width","100%"),ut(e,"height","100%")},m(o,u){q(o,e,u),i.block.m(e,i.anchor=null),i.mount=()=>e,i.anchor=null,n=!0},p(o,u){r=o,i.ctx=r,u&512&&t!==(t=r[13](r[9]))&&zg(t,i)||X2(i,r,u)},i(o){n||(j(i.block),n=!0)},o(o){for(let u=0;u<3;u+=1){const a=i.blocks[u];G(a)}n=!1},d(o){o&&V(e),i.block.d(),i.token=null,i=null}}}function mz(r){let e,t,n,i,o,u,a;return t=new uk({}),o=new FM({props:{$$slots:{main:[pz],left:[WP],top:[HP]},$$scope:{ctx:r}}}),{c(){e=U("div"),de(t.$$.fragment),n=oe(),i=U("div"),de(o.$$.fragment),ue(e,"class","pico"),ue(i,"class",u="app-focus-"+r[8])},m(d,p){q(d,e,p),he(t,e,null),q(d,n,p),q(d,i,p),he(o,i,null),a=!0},p(d,[p]){const g={};p&67112703&&(g.$$scope={dirty:p,ctx:d}),o.$set(g),(!a||p&256&&u!==(u="app-focus-"+d[8]))&&ue(i,"class",u)},i(d){a||(j(t.$$.fragment,d),j(o.$$.fragment,d),a=!0)},o(d){G(t.$$.fragment,d),G(o.$$.fragment,d),a=!1},d(d){d&&(V(e),V(n),V(i)),fe(t),fe(o)}}}function _z(r,e,t){let n,i,o,u,a,d,p,g,y,w;st(r,Mm,ae=>t(15,n=ae)),st(r,Tm,ae=>t(16,i=ae)),st(r,Cm,ae=>t(17,o=ae)),st(r,Ir,ae=>t(6,u=ae)),st(r,Do,ae=>t(7,a=ae)),st(r,sm,ae=>t(24,d=ae)),st(r,Ro,ae=>t(8,p=ae)),st(r,nm,ae=>t(9,g=ae)),st(r,an,ae=>t(10,y=ae)),st(r,rh,ae=>t(11,w=ae));let{appFocus:T="global"}=e;Ro.set(T);let L=!1;Ts(async()=>{await Dv(),await Sb(),t(4,L=!0);try{(await fetch("/severance_pbfs/areas.json")).ok&&(Ot(sm,d=!0,d),console.log("Using local cache, not od2net.org"))}catch{}});let D=null;function R(){a.fitBounds(u.getBounds(),{animate:!1})}let z,I,F,N;T=="cnt"&&(N=[-8.943,54.631,-.901,59.489]);async function W(ae){return ae=="streets-v2"?VM:`https://api.maptiler.com/maps/${ae}/style.json?key=${Bb}`}function se(ae){un[ae?"unshift":"push"](()=>{F=ae,t(3,F),t(15,n)})}function J(ae){D=ae,t(0,D)}const Y=ae=>{console.log(ae.detail.error)};function _e(ae){un[ae?"unshift":"push"](()=>{I=ae,t(2,I),t(16,i)})}const ze=()=>Ot(rh,w=!0,w);function ee(ae){un[ae?"unshift":"push"](()=>{z=ae,t(1,z),t(17,o)})}return r.$$set=ae=>{"appFocus"in ae&&t(14,T=ae.appFocus)},r.$$.update=()=>{r.$$.dirty&1&&D&&Do.set(D),r.$$.dirty&131074&&z&&o&&(t(1,z.innerHTML="",z),z.appendChild(o)),r.$$.dirty&65540&&I&&i&&(t(2,I.innerHTML="",I),I.appendChild(i)),r.$$.dirty&32776&&F&&n&&(t(3,F.innerHTML="",F),F.appendChild(n))},[D,z,I,F,L,N,u,a,p,g,y,w,R,W,T,n,i,o,se,J,Y,_e,ze,ee]}class Cz extends It{constructor(e){super(),Et(this,e,_z,mz,xt,{appFocus:14})}}export{Cz as A};
