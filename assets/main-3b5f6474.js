var q_=Object.defineProperty;var Z_=(p,a,h)=>a in p?q_(p,a,{enumerable:!0,configurable:!0,writable:!0,value:h}):p[a]=h;var io=(p,a,h)=>(Z_(p,typeof a!="symbol"?a+"":a,h),h);(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))d(y);new MutationObserver(y=>{for(const S of y)if(S.type==="childList")for(const k of S.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&d(k)}).observe(document,{childList:!0,subtree:!0});function h(y){const S={};return y.integrity&&(S.integrity=y.integrity),y.referrerPolicy&&(S.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?S.credentials="include":y.crossOrigin==="anonymous"?S.credentials="omit":S.credentials="same-origin",S}function d(y){if(y.ep)return;y.ep=!0;const S=h(y);fetch(y.href,S)}})();function _i(){}function G_(p,a){for(const h in a)p[h]=a[h];return p}function wf(p){return p()}function zp(){return Object.create(null)}function qo(p){p.forEach(wf)}function Fu(p){return typeof p=="function"}function Di(p,a){return p!=p?a==a:p!==a||p&&typeof p=="object"||typeof p=="function"}let Iu;function Fh(p,a){return p===a?!0:(Iu||(Iu=document.createElement("a")),Iu.href=a,p===Iu.href)}function W_(p){return Object.keys(p).length===0}function Sf(p,...a){if(p==null){for(const d of a)d(void 0);return _i}const h=p.subscribe(...a);return h.unsubscribe?()=>h.unsubscribe():h}function H_(p){let a;return Sf(p,h=>a=h)(),a}function $t(p,a,h){p.$$.on_destroy.push(Sf(a,h))}function go(p,a,h,d){if(p){const y=Tf(p,a,h,d);return p[0](y)}}function Tf(p,a,h,d){return p[1]&&d?G_(h.ctx.slice(),p[1](d(a))):h.ctx}function yo(p,a,h,d){if(p[2]&&d){const y=p[2](d(h));if(a.dirty===void 0)return y;if(typeof y=="object"){const S=[],k=Math.max(a.dirty.length,y.length);for(let s=0;s<k;s+=1)S[s]=a.dirty[s]|y[s];return S}return a.dirty|y}return a.dirty}function vo(p,a,h,d,y,S){if(y){const k=Tf(a,h,d,S);p.p(k,y)}}function bo(p){if(p.ctx.length>32){const a=[],h=p.ctx.length/32;for(let d=0;d<h;d++)a[d]=-1;return a}return-1}function X_(p){const a={};for(const h in p)a[h]=!0;return a}function Dp(p){return p??""}function rn(p,a,h){return p.set(h),a}function Rh(p){return p&&Fu(p.destroy)?p.destroy:_i}const K_=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function we(p,a){p.appendChild(a)}function Ke(p,a,h){p.insertBefore(a,h||null)}function He(p){p.parentNode&&p.parentNode.removeChild(p)}function Gh(p,a){for(let h=0;h<p.length;h+=1)p[h]&&p[h].d(a)}function Ee(p){return document.createElement(p)}function ki(p){return document.createTextNode(p)}function Tt(){return ki(" ")}function us(){return ki("")}function li(p,a,h,d){return p.addEventListener(a,h,d),()=>p.removeEventListener(a,h,d)}function ui(p,a,h){h==null?p.removeAttribute(a):p.getAttribute(a)!==h&&p.setAttribute(a,h)}function J_(p){return Array.from(p.childNodes)}function xo(p,a){a=""+a,p.data!==a&&(p.data=a)}function as(p,a){p.value=a??""}function jl(p,a,h,d){h==null?p.style.removeProperty(a):p.style.setProperty(a,h,d?"important":"")}function Fp(p,a,h){for(let d=0;d<p.options.length;d+=1){const y=p.options[d];if(y.__value===a){y.selected=!0;return}}(!h||a!==void 0)&&(p.selectedIndex=-1)}function Y_(p){const a=p.querySelector(":checked");return a&&a.__value}function Rp(p,a,h){p.classList.toggle(a,!!h)}function Q_(p,a,{bubbles:h=!1,cancelable:d=!1}={}){return new CustomEvent(p,{detail:a,bubbles:h,cancelable:d})}let Zc;function Vc(p){Zc=p}function Gc(){if(!Zc)throw new Error("Function called outside component initialization");return Zc}function Wc(p){Gc().$$.on_mount.push(p)}function Ss(p){Gc().$$.on_destroy.push(p)}function Hc(){const p=Gc();return(a,h,{cancelable:d=!1}={})=>{const y=p.$$.callbacks[a];if(y){const S=Q_(a,h,{cancelable:d});return y.slice().forEach(k=>{k.call(p,S)}),!S.defaultPrevented}return!0}}function If(p,a){return Gc().$$.context.set(p,a),a}function $_(p){return Gc().$$.context.get(p)}function ur(p,a){const h=p.$$.callbacks[a.type];h&&h.slice().forEach(d=>d.call(this,a))}const Vl=[],qr=[];let ql=[];const Oh=[],Cf=Promise.resolve();let Bh=!1;function kf(){Bh||(Bh=!0,Cf.then(Ef))}function eg(){return kf(),Cf}function Lu(p){ql.push(p)}function fl(p){Oh.push(p)}const Ah=new Set;let Bl=0;function Ef(){if(Bl!==0)return;const p=Zc;do{try{for(;Bl<Vl.length;){const a=Vl[Bl];Bl++,Vc(a),tg(a.$$)}}catch(a){throw Vl.length=0,Bl=0,a}for(Vc(null),Vl.length=0,Bl=0;qr.length;)qr.pop()();for(let a=0;a<ql.length;a+=1){const h=ql[a];Ah.has(h)||(Ah.add(h),h())}ql.length=0}while(Vl.length);for(;Oh.length;)Oh.pop()();Bh=!1,Ah.clear(),Vc(p)}function tg(p){if(p.fragment!==null){p.update(),qo(p.before_update);const a=p.dirty;p.dirty=[-1],p.fragment&&p.fragment.p(p.ctx,a),p.after_update.forEach(Lu)}}function ig(p){const a=[],h=[];ql.forEach(d=>p.indexOf(d)===-1?a.push(d):h.push(d)),h.forEach(d=>d()),ql=a}const Eu=new Set;let pl;function dr(){pl={r:0,c:[],p:pl}}function pr(){pl.r||qo(pl.c),pl=pl.p}function Pe(p,a){p&&p.i&&(Eu.delete(p),p.i(a))}function Ve(p,a,h,d){if(p&&p.o){if(Eu.has(p))return;Eu.add(p),pl.c.push(()=>{Eu.delete(p),d&&(h&&p.d(1),d())}),p.o(a)}else d&&d()}function Wl(p){return(p==null?void 0:p.length)!==void 0?p:Array.from(p)}function ml(p,a,h){const d=p.$$.props[a];d!==void 0&&(p.$$.bound[d]=h,h(p.$$.ctx[d]))}function Ft(p){p&&p.c()}function Lt(p,a,h){const{fragment:d,after_update:y}=p.$$;d&&d.m(a,h),Lu(()=>{const S=p.$$.on_mount.map(wf).filter(Fu);p.$$.on_destroy?p.$$.on_destroy.push(...S):qo(S),p.$$.on_mount=[]}),y.forEach(Lu)}function zt(p,a){const h=p.$$;h.fragment!==null&&(ig(h.after_update),qo(h.on_destroy),h.fragment&&h.fragment.d(a),h.on_destroy=h.fragment=null,h.ctx=[])}function ng(p,a){p.$$.dirty[0]===-1&&(Vl.push(p),kf(),p.$$.dirty.fill(0)),p.$$.dirty[a/31|0]|=1<<a%31}function Gi(p,a,h,d,y,S,k=null,s=[-1]){const D=Zc;Vc(p);const M=p.$$={fragment:null,ctx:[],props:S,update:_i,not_equal:y,bound:zp(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(a.context||(D?D.$$.context:[])),callbacks:zp(),dirty:s,skip_bound:!1,root:a.target||D.$$.root};k&&k(M.root);let q=!1;if(M.ctx=h?h(p,a.props||{},(te,ce,...be)=>{const he=be.length?be[0]:ce;return M.ctx&&y(M.ctx[te],M.ctx[te]=he)&&(!M.skip_bound&&M.bound[te]&&M.bound[te](he),q&&ng(p,te)),ce}):[],M.update(),q=!0,qo(M.before_update),M.fragment=d?d(M.ctx):!1,a.target){if(a.hydrate){const te=J_(a.target);M.fragment&&M.fragment.l(te),te.forEach(He)}else M.fragment&&M.fragment.c();a.intro&&Pe(p.$$.fragment),Lt(p,a.target,a.anchor),Ef()}Vc(D)}class Wi{constructor(){io(this,"$$");io(this,"$$set")}$destroy(){zt(this,1),this.$destroy=_i}$on(a,h){if(!Fu(h))return _i;const d=this.$$.callbacks[a]||(this.$$.callbacks[a]=[]);return d.push(h),()=>{const y=d.indexOf(h);y!==-1&&d.splice(y,1)}}$set(a){this.$$set&&!W_(a)&&(this.$$.skip_bound=!0,this.$$set(a),this.$$.skip_bound=!1)}}const rg="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(rg);let ht;const ua=new Array(128).fill(void 0);ua.push(void 0,null,!0,!1);function ci(p){return ua[p]}let Uc=ua.length;function og(p){p<132||(ua[p]=Uc,Uc=p)}function mo(p){const a=ci(p);return og(p),a}const Mf=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Mf.decode();let Lc=null;function Zl(){return(Lc===null||Lc.byteLength===0)&&(Lc=new Uint8Array(ht.memory.buffer)),Lc}function _o(p,a){return p=p>>>0,Mf.decode(Zl().subarray(p,p+a))}function qn(p){Uc===ua.length&&ua.push(ua.length+1);const a=Uc;return Uc=ua[a],ua[a]=p,a}let ls=0;const Mu=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},sg=typeof Mu.encodeInto=="function"?function(p,a){return Mu.encodeInto(p,a)}:function(p,a){const h=Mu.encode(p);return a.set(h),{read:p.length,written:h.length}};function Ha(p,a,h){if(h===void 0){const s=Mu.encode(p),D=a(s.length,1)>>>0;return Zl().subarray(D,D+s.length).set(s),ls=s.length,D}let d=p.length,y=a(d,1)>>>0;const S=Zl();let k=0;for(;k<d;k++){const s=p.charCodeAt(k);if(s>127)break;S[y+k]=s}if(k!==d){k!==0&&(p=p.slice(k)),y=h(y,d,d=k+p.length*3,1)>>>0;const s=Zl().subarray(y+k,y+d),D=sg(p,s);k+=D.written}return ls=k,y}function Ac(p){return p==null}let zc=null;function Ut(){return(zc===null||zc.byteLength===0)&&(zc=new Int32Array(ht.memory.buffer)),zc}let Dc=null;function Af(){return(Dc===null||Dc.byteLength===0)&&(Dc=new Float64Array(ht.memory.buffer)),Dc}let Fc=null;function ag(){return(Fc===null||Fc.byteLength===0)&&(Fc=new BigInt64Array(ht.memory.buffer)),Fc}function Nh(p){const a=typeof p;if(a=="number"||a=="boolean"||p==null)return`${p}`;if(a=="string")return`"${p}"`;if(a=="symbol"){const y=p.description;return y==null?"Symbol":`Symbol(${y})`}if(a=="function"){const y=p.name;return typeof y=="string"&&y.length>0?`Function(${y})`:"Function"}if(Array.isArray(p)){const y=p.length;let S="[";y>0&&(S+=Nh(p[0]));for(let k=1;k<y;k++)S+=", "+Nh(p[k]);return S+="]",S}const h=/\[object ([^\]]+)\]/.exec(toString.call(p));let d;if(h.length>1)d=h[1];else return toString.call(p);if(d=="Object")try{return"Object("+JSON.stringify(p)+")"}catch{return"Object"}return p instanceof Error?`${p.name}: ${p.message}
${p.stack}`:d}function lg(p,a){const h=a(p.length*1,1)>>>0;return Zl().set(p,h/1),ls=p.length,h}function cg(p,a){return p=p>>>0,Af().subarray(p/8,p/8+a)}function ug(p,a){return p=p>>>0,Zl().subarray(p/1,p/1+a)}function Ph(p,a){try{return p.apply(this,a)}catch(h){ht.__wbindgen_exn_store(qn(h))}}class hg{__destroy_into_raw(){const a=this.__wbg_ptr;return this.__wbg_ptr=0,a}free(){const a=this.__destroy_into_raw();ht.__wbg_ltn_free(a)}constructor(a){try{const S=ht.__wbindgen_add_to_stack_pointer(-16),k=lg(a,ht.__wbindgen_malloc),s=ls;ht.ltn_new(S,k,s);var h=Ut()[S/4+0],d=Ut()[S/4+1],y=Ut()[S/4+2];if(y)throw mo(d);return this.__wbg_ptr=h>>>0,this}finally{ht.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let a,h;try{const M=ht.__wbindgen_add_to_stack_pointer(-16);ht.ltn_getInvertedBoundary(M,this.__wbg_ptr);var d=Ut()[M/4+0],y=Ut()[M/4+1],S=Ut()[M/4+2],k=Ut()[M/4+3],s=d,D=y;if(k)throw s=0,D=0,mo(S);return a=s,h=D,_o(s,D)}finally{ht.__wbindgen_add_to_stack_pointer(16),ht.__wbindgen_free(a,h,1)}}getBounds(){try{const y=ht.__wbindgen_add_to_stack_pointer(-16);ht.ltn_getBounds(y,this.__wbg_ptr);var a=Ut()[y/4+0],h=Ut()[y/4+1],d=cg(a,h).slice();return ht.__wbindgen_free(a,h*8,8),d}finally{ht.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const y=ht.__wbindgen_add_to_stack_pointer(-16);ht.ltn_toRouteSnapper(y,this.__wbg_ptr);var a=Ut()[y/4+0],h=Ut()[y/4+1],d=ug(a,h).slice();return ht.__wbindgen_free(a,h*1,1),d}finally{ht.__wbindgen_add_to_stack_pointer(16)}}renderNeighbourhood(){let a,h;try{const M=ht.__wbindgen_add_to_stack_pointer(-16);ht.ltn_renderNeighbourhood(M,this.__wbg_ptr);var d=Ut()[M/4+0],y=Ut()[M/4+1],S=Ut()[M/4+2],k=Ut()[M/4+3],s=d,D=y;if(k)throw s=0,D=0,mo(S);return a=s,h=D,_o(s,D)}finally{ht.__wbindgen_add_to_stack_pointer(16),ht.__wbindgen_free(a,h,1)}}setNeighbourhoodBoundary(a,h){try{const S=ht.__wbindgen_add_to_stack_pointer(-16),k=Ha(a,ht.__wbindgen_malloc,ht.__wbindgen_realloc),s=ls;ht.ltn_setNeighbourhoodBoundary(S,this.__wbg_ptr,k,s,qn(h));var d=Ut()[S/4+0],y=Ut()[S/4+1];if(y)throw mo(d)}finally{ht.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(a){const h=Ha(a,ht.__wbindgen_malloc,ht.__wbindgen_realloc),d=ls;ht.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,h,d)}setCurrentNeighbourhood(a){let h,d;try{const q=ht.__wbindgen_add_to_stack_pointer(-16),te=Ha(a,ht.__wbindgen_malloc,ht.__wbindgen_realloc),ce=ls;ht.ltn_setCurrentNeighbourhood(q,this.__wbg_ptr,te,ce);var y=Ut()[q/4+0],S=Ut()[q/4+1],k=Ut()[q/4+2],s=Ut()[q/4+3],D=y,M=S;if(s)throw D=0,M=0,mo(k);return h=D,d=M,_o(D,M)}finally{ht.__wbindgen_add_to_stack_pointer(16),ht.__wbindgen_free(h,d,1)}}addModalFilter(a,h){let d,y;try{const te=ht.__wbindgen_add_to_stack_pointer(-16),ce=Ha(h,ht.__wbindgen_malloc,ht.__wbindgen_realloc),be=ls;ht.ltn_addModalFilter(te,this.__wbg_ptr,qn(a),ce,be);var S=Ut()[te/4+0],k=Ut()[te/4+1],s=Ut()[te/4+2],D=Ut()[te/4+3],M=S,q=k;if(D)throw M=0,q=0,mo(s);return d=M,y=q,_o(M,q)}finally{ht.__wbindgen_add_to_stack_pointer(16),ht.__wbindgen_free(d,y,1)}}addManyModalFilters(a,h){let d,y;try{const te=ht.__wbindgen_add_to_stack_pointer(-16),ce=Ha(h,ht.__wbindgen_malloc,ht.__wbindgen_realloc),be=ls;ht.ltn_addManyModalFilters(te,this.__wbg_ptr,qn(a),ce,be);var S=Ut()[te/4+0],k=Ut()[te/4+1],s=Ut()[te/4+2],D=Ut()[te/4+3],M=S,q=k;if(D)throw M=0,q=0,mo(s);return d=M,y=q,_o(M,q)}finally{ht.__wbindgen_add_to_stack_pointer(16),ht.__wbindgen_free(d,y,1)}}deleteModalFilter(a){let h,d;try{const q=ht.__wbindgen_add_to_stack_pointer(-16);ht.ltn_deleteModalFilter(q,this.__wbg_ptr,a);var y=Ut()[q/4+0],S=Ut()[q/4+1],k=Ut()[q/4+2],s=Ut()[q/4+3],D=y,M=S;if(s)throw D=0,M=0,mo(k);return h=D,d=M,_o(D,M)}finally{ht.__wbindgen_add_to_stack_pointer(16),ht.__wbindgen_free(h,d,1)}}undo(){let a,h;try{const M=ht.__wbindgen_add_to_stack_pointer(-16);ht.ltn_undo(M,this.__wbg_ptr);var d=Ut()[M/4+0],y=Ut()[M/4+1],S=Ut()[M/4+2],k=Ut()[M/4+3],s=d,D=y;if(k)throw s=0,D=0,mo(S);return a=s,h=D,_o(s,D)}finally{ht.__wbindgen_add_to_stack_pointer(16),ht.__wbindgen_free(a,h,1)}}redo(){let a,h;try{const M=ht.__wbindgen_add_to_stack_pointer(-16);ht.ltn_redo(M,this.__wbg_ptr);var d=Ut()[M/4+0],y=Ut()[M/4+1],S=Ut()[M/4+2],k=Ut()[M/4+3],s=d,D=y;if(k)throw s=0,D=0,mo(S);return a=s,h=D,_o(s,D)}finally{ht.__wbindgen_add_to_stack_pointer(16),ht.__wbindgen_free(a,h,1)}}getShortcutsCrossingRoad(a){let h,d;try{const q=ht.__wbindgen_add_to_stack_pointer(-16);ht.ltn_getShortcutsCrossingRoad(q,this.__wbg_ptr,a);var y=Ut()[q/4+0],S=Ut()[q/4+1],k=Ut()[q/4+2],s=Ut()[q/4+3],D=y,M=S;if(s)throw D=0,M=0,mo(k);return h=D,d=M,_o(D,M)}finally{ht.__wbindgen_add_to_stack_pointer(16),ht.__wbindgen_free(h,d,1)}}toSavefile(){let a,h;try{const M=ht.__wbindgen_add_to_stack_pointer(-16);ht.ltn_toSavefile(M,this.__wbg_ptr);var d=Ut()[M/4+0],y=Ut()[M/4+1],S=Ut()[M/4+2],k=Ut()[M/4+3],s=d,D=y;if(k)throw s=0,D=0,mo(S);return a=s,h=D,_o(s,D)}finally{ht.__wbindgen_add_to_stack_pointer(16),ht.__wbindgen_free(a,h,1)}}loadSavefile(a){try{const y=ht.__wbindgen_add_to_stack_pointer(-16);ht.ltn_loadSavefile(y,this.__wbg_ptr,qn(a));var h=Ut()[y/4+0],d=Ut()[y/4+1];if(d)throw mo(h)}finally{ht.__wbindgen_add_to_stack_pointer(16)}}compareRoute(a,h,d,y){let S,k;try{const be=ht.__wbindgen_add_to_stack_pointer(-16);ht.ltn_compareRoute(be,this.__wbg_ptr,a,h,d,y);var s=Ut()[be/4+0],D=Ut()[be/4+1],M=Ut()[be/4+2],q=Ut()[be/4+3],te=s,ce=D;if(q)throw te=0,ce=0,mo(M);return S=te,k=ce,_o(te,ce)}finally{ht.__wbindgen_add_to_stack_pointer(16),ht.__wbindgen_free(S,k,1)}}}async function dg(p,a){if(typeof Response=="function"&&p instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(p,a)}catch(d){if(p.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",d);else throw d}const h=await p.arrayBuffer();return await WebAssembly.instantiate(h,a)}else{const h=await WebAssembly.instantiate(p,a);return h instanceof WebAssembly.Instance?{instance:h,module:p}:h}}function pg(){const p={};return p.wbg={},p.wbg.__wbindgen_object_drop_ref=function(a){mo(a)},p.wbg.__wbindgen_error_new=function(a,h){const d=new Error(_o(a,h));return qn(d)},p.wbg.__wbindgen_string_get=function(a,h){const d=ci(h),y=typeof d=="string"?d:void 0;var S=Ac(y)?0:Ha(y,ht.__wbindgen_malloc,ht.__wbindgen_realloc),k=ls;Ut()[a/4+1]=k,Ut()[a/4+0]=S},p.wbg.__wbindgen_boolean_get=function(a){const h=ci(a);return typeof h=="boolean"?h?1:0:2},p.wbg.__wbindgen_is_bigint=function(a){return typeof ci(a)=="bigint"},p.wbg.__wbindgen_bigint_from_i64=function(a){return qn(a)},p.wbg.__wbindgen_jsval_eq=function(a,h){return ci(a)===ci(h)},p.wbg.__wbindgen_bigint_from_u64=function(a){const h=BigInt.asUintN(64,a);return qn(h)},p.wbg.__wbindgen_number_get=function(a,h){const d=ci(h),y=typeof d=="number"?d:void 0;Af()[a/8+1]=Ac(y)?0:y,Ut()[a/4+0]=!Ac(y)},p.wbg.__wbindgen_is_object=function(a){const h=ci(a);return typeof h=="object"&&h!==null},p.wbg.__wbindgen_in=function(a,h){return ci(a)in ci(h)},p.wbg.__wbindgen_string_new=function(a,h){const d=_o(a,h);return qn(d)},p.wbg.__wbindgen_is_undefined=function(a){return ci(a)===void 0},p.wbg.__wbindgen_object_clone_ref=function(a){const h=ci(a);return qn(h)},p.wbg.__wbindgen_jsval_loose_eq=function(a,h){return ci(a)==ci(h)},p.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(a,h){const d=ci(a)[ci(h)];return qn(d)},p.wbg.__wbg_debug_34c9290896ec9856=function(a){console.debug(ci(a))},p.wbg.__wbg_error_e60eff06f24ab7a4=function(a){console.error(ci(a))},p.wbg.__wbg_info_d7d58472d0bab115=function(a){console.info(ci(a))},p.wbg.__wbg_log_a4530b4fe289336f=function(a){console.log(ci(a))},p.wbg.__wbg_warn_f260f49434e45e62=function(a){console.warn(ci(a))},p.wbg.__wbg_get_f01601b5a68d10e3=function(a,h){const d=ci(a)[h>>>0];return qn(d)},p.wbg.__wbg_length_1009b1af0c481d7b=function(a){return ci(a).length},p.wbg.__wbindgen_is_function=function(a){return typeof ci(a)=="function"},p.wbg.__wbg_next_9b877f231f476d01=function(a){const h=ci(a).next;return qn(h)},p.wbg.__wbg_next_6529ee0cca8d57ed=function(){return Ph(function(a){const h=ci(a).next();return qn(h)},arguments)},p.wbg.__wbg_done_5fe336b092d60cf2=function(a){return ci(a).done},p.wbg.__wbg_value_0c248a78fdc8e19f=function(a){const h=ci(a).value;return qn(h)},p.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return qn(Symbol.iterator)},p.wbg.__wbg_get_7b48513de5dc5ea4=function(){return Ph(function(a,h){const d=Reflect.get(ci(a),ci(h));return qn(d)},arguments)},p.wbg.__wbg_call_90c26b09837aba1c=function(){return Ph(function(a,h){const d=ci(a).call(ci(h));return qn(d)},arguments)},p.wbg.__wbg_isArray_74fb723e24f76012=function(a){return Array.isArray(ci(a))},p.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(a){let h;try{h=ci(a)instanceof ArrayBuffer}catch{h=!1}return h},p.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(a){return Number.isSafeInteger(ci(a))},p.wbg.__wbg_entries_9e2e2aa45aa5094a=function(a){const h=Object.entries(ci(a));return qn(h)},p.wbg.__wbg_buffer_a448f833075b71ba=function(a){const h=ci(a).buffer;return qn(h)},p.wbg.__wbg_new_8f67e318f15d7254=function(a){const h=new Uint8Array(ci(a));return qn(h)},p.wbg.__wbg_set_2357bf09366ee480=function(a,h,d){ci(a).set(ci(h),d>>>0)},p.wbg.__wbg_length_1d25fa9e4ac21ce7=function(a){return ci(a).length},p.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(a){let h;try{h=ci(a)instanceof Uint8Array}catch{h=!1}return h},p.wbg.__wbg_new_abda76e883ba8a5f=function(){const a=new Error;return qn(a)},p.wbg.__wbg_stack_658279fe44541cf6=function(a,h){const d=ci(h).stack,y=Ha(d,ht.__wbindgen_malloc,ht.__wbindgen_realloc),S=ls;Ut()[a/4+1]=S,Ut()[a/4+0]=y},p.wbg.__wbg_error_f851667af71bcfc6=function(a,h){let d,y;try{d=a,y=h,console.error(_o(a,h))}finally{ht.__wbindgen_free(d,y,1)}},p.wbg.__wbindgen_bigint_get_as_i64=function(a,h){const d=ci(h),y=typeof d=="bigint"?d:void 0;ag()[a/8+1]=Ac(y)?BigInt(0):y,Ut()[a/4+0]=!Ac(y)},p.wbg.__wbindgen_debug_string=function(a,h){const d=Nh(ci(h)),y=Ha(d,ht.__wbindgen_malloc,ht.__wbindgen_realloc),S=ls;Ut()[a/4+1]=S,Ut()[a/4+0]=y},p.wbg.__wbindgen_throw=function(a,h){throw new Error(_o(a,h))},p.wbg.__wbindgen_memory=function(){const a=ht.memory;return qn(a)},p}function fg(p,a){return ht=p.exports,Wh.__wbindgen_wasm_module=a,Fc=null,Dc=null,zc=null,Lc=null,ht}async function Wh(p){if(ht!==void 0)return ht;typeof p>"u"&&(p="/ltn/assets/backend_bg.wasm");const a=pg();(typeof p=="string"||typeof Request=="function"&&p instanceof Request||typeof URL=="function"&&p instanceof URL)&&(p=fetch(p));const{instance:h,module:d}=await dg(await p,a);return fg(h,d)}let Yt;const Pf=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Pf.decode();let Rc=null;function jc(){return(Rc===null||Rc.byteLength===0)&&(Rc=new Uint8Array(Yt.memory.buffer)),Rc}function ha(p,a){return p=p>>>0,Pf.decode(jc().subarray(p,p+a))}const da=new Array(128).fill(void 0);da.push(void 0,null,!0,!1);let qc=da.length;function xr(p){qc===da.length&&da.push(da.length+1);const a=qc;return qc=da[a],da[a]=p,a}function Ci(p){return da[p]}function mg(p){p<132||(da[p]=qc,qc=p)}function Au(p){const a=Ci(p);return mg(p),a}function Lh(p){return p==null}let Oc=null;function _g(){return(Oc===null||Oc.byteLength===0)&&(Oc=new Float64Array(Yt.memory.buffer)),Oc}let Bc=null;function In(){return(Bc===null||Bc.byteLength===0)&&(Bc=new Int32Array(Yt.memory.buffer)),Bc}let Xa=0;const Pu=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},gg=typeof Pu.encodeInto=="function"?function(p,a){return Pu.encodeInto(p,a)}:function(p,a){const h=Pu.encode(p);return a.set(h),{read:p.length,written:h.length}};function Cu(p,a,h){if(h===void 0){const s=Pu.encode(p),D=a(s.length,1)>>>0;return jc().subarray(D,D+s.length).set(s),Xa=s.length,D}let d=p.length,y=a(d,1)>>>0;const S=jc();let k=0;for(;k<d;k++){const s=p.charCodeAt(k);if(s>127)break;S[y+k]=s}if(k!==d){k!==0&&(p=p.slice(k)),y=h(y,d,d=k+p.length*3,1)>>>0;const s=jc().subarray(y+k,y+d),D=gg(p,s);k+=D.written}return Xa=k,y}function Vh(p){const a=typeof p;if(a=="number"||a=="boolean"||p==null)return`${p}`;if(a=="string")return`"${p}"`;if(a=="symbol"){const y=p.description;return y==null?"Symbol":`Symbol(${y})`}if(a=="function"){const y=p.name;return typeof y=="string"&&y.length>0?`Function(${y})`:"Function"}if(Array.isArray(p)){const y=p.length;let S="[";y>0&&(S+=Vh(p[0]));for(let k=1;k<y;k++)S+=", "+Vh(p[k]);return S+="]",S}const h=/\[object ([^\]]+)\]/.exec(toString.call(p));let d;if(h.length>1)d=h[1];else return toString.call(p);if(d=="Object")try{return"Object("+JSON.stringify(p)+")"}catch{return"Object"}return p instanceof Error?`${p.name}: ${p.message}
${p.stack}`:d}function yg(p,a){const h=a(p.length*1,1)>>>0;return jc().set(p,h/1),Xa=p.length,h}function zh(p,a){try{return p.apply(this,a)}catch(h){Yt.__wbindgen_exn_store(xr(h))}}class zu{static __wrap(a){a=a>>>0;const h=Object.create(zu.prototype);return h.__wbg_ptr=a,h}__destroy_into_raw(){const a=this.__wbg_ptr;return this.__wbg_ptr=0,a}free(){const a=this.__destroy_into_raw();Yt.__wbg_jsroutesnapper_free(a)}constructor(a){try{const S=Yt.__wbindgen_add_to_stack_pointer(-16),k=yg(a,Yt.__wbindgen_malloc),s=Xa;Yt.jsroutesnapper_new(S,k,s);var h=In()[S/4+0],d=In()[S/4+1],y=In()[S/4+2];if(y)throw Au(d);return zu.__wrap(h)}finally{Yt.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(a){Yt.jsroutesnapper_setRouteConfig(this.__wbg_ptr,xr(a))}setAreaMode(){Yt.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let a,h;try{const S=Yt.__wbindgen_add_to_stack_pointer(-16);Yt.jsroutesnapper_getConfig(S,this.__wbg_ptr);var d=In()[S/4+0],y=In()[S/4+1];return a=d,h=y,ha(d,y)}finally{Yt.__wbindgen_add_to_stack_pointer(16),Yt.__wbindgen_free(a,h,1)}}toFinalFeature(){try{const d=Yt.__wbindgen_add_to_stack_pointer(-16);Yt.jsroutesnapper_toFinalFeature(d,this.__wbg_ptr);var a=In()[d/4+0],h=In()[d/4+1];let y;return a!==0&&(y=ha(a,h).slice(),Yt.__wbindgen_free(a,h*1)),y}finally{Yt.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let a,h;try{const S=Yt.__wbindgen_add_to_stack_pointer(-16);Yt.jsroutesnapper_renderGeojson(S,this.__wbg_ptr);var d=In()[S/4+0],y=In()[S/4+1];return a=d,h=y,ha(d,y)}finally{Yt.__wbindgen_add_to_stack_pointer(16),Yt.__wbindgen_free(a,h,1)}}toggleSnapMode(){Yt.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(a,h,d){return Yt.jsroutesnapper_onMouseMove(this.__wbg_ptr,a,h,d)!==0}onClick(){Yt.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return Yt.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return Yt.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){Yt.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(a){try{const y=Yt.__wbindgen_add_to_stack_pointer(-16);Yt.jsroutesnapper_editExisting(y,this.__wbg_ptr,xr(a));var h=In()[y/4+0],d=In()[y/4+1];if(d)throw Au(h)}finally{Yt.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let a,h;try{const S=Yt.__wbindgen_add_to_stack_pointer(-16);Yt.jsroutesnapper_debugRenderGraph(S,this.__wbg_ptr);var d=In()[S/4+0],y=In()[S/4+1];return a=d,h=y,ha(d,y)}finally{Yt.__wbindgen_add_to_stack_pointer(16),Yt.__wbindgen_free(a,h,1)}}routeNameForWaypoints(a){let h,d;try{const q=Yt.__wbindgen_add_to_stack_pointer(-16);Yt.jsroutesnapper_routeNameForWaypoints(q,this.__wbg_ptr,xr(a));var y=In()[q/4+0],S=In()[q/4+1],k=In()[q/4+2],s=In()[q/4+3],D=y,M=S;if(s)throw D=0,M=0,Au(k);return h=D,d=M,ha(D,M)}finally{Yt.__wbindgen_add_to_stack_pointer(16),Yt.__wbindgen_free(h,d,1)}}addSnappedWaypoint(a,h){Yt.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,a,h)}undo(){Yt.jsroutesnapper_undo(this.__wbg_ptr)}}async function vg(p,a){if(typeof Response=="function"&&p instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(p,a)}catch(d){if(p.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",d);else throw d}const h=await p.arrayBuffer();return await WebAssembly.instantiate(h,a)}else{const h=await WebAssembly.instantiate(p,a);return h instanceof WebAssembly.Instance?{instance:h,module:p}:h}}function bg(){const p={};return p.wbg={},p.wbg.__wbindgen_string_new=function(a,h){const d=ha(a,h);return xr(d)},p.wbg.__wbindgen_object_drop_ref=function(a){Au(a)},p.wbg.__wbindgen_error_new=function(a,h){const d=new Error(ha(a,h));return xr(d)},p.wbg.__wbindgen_is_object=function(a){const h=Ci(a);return typeof h=="object"&&h!==null},p.wbg.__wbindgen_is_undefined=function(a){return Ci(a)===void 0},p.wbg.__wbindgen_in=function(a,h){return Ci(a)in Ci(h)},p.wbg.__wbindgen_number_get=function(a,h){const d=Ci(h),y=typeof d=="number"?d:void 0;_g()[a/8+1]=Lh(y)?0:y,In()[a/4+0]=!Lh(y)},p.wbg.__wbindgen_boolean_get=function(a){const h=Ci(a);return typeof h=="boolean"?h?1:0:2},p.wbg.__wbindgen_object_clone_ref=function(a){const h=Ci(a);return xr(h)},p.wbg.__wbindgen_jsval_loose_eq=function(a,h){return Ci(a)==Ci(h)},p.wbg.__wbindgen_string_get=function(a,h){const d=Ci(h),y=typeof d=="string"?d:void 0;var S=Lh(y)?0:Cu(y,Yt.__wbindgen_malloc,Yt.__wbindgen_realloc),k=Xa;In()[a/4+1]=k,In()[a/4+0]=S},p.wbg.__wbg_String_4370c5505c674d30=function(a,h){const d=String(Ci(h)),y=Cu(d,Yt.__wbindgen_malloc,Yt.__wbindgen_realloc),S=Xa;In()[a/4+1]=S,In()[a/4+0]=y},p.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(a,h){const d=Ci(a)[Ci(h)];return xr(d)},p.wbg.__wbg_new_abda76e883ba8a5f=function(){const a=new Error;return xr(a)},p.wbg.__wbg_stack_658279fe44541cf6=function(a,h){const d=Ci(h).stack,y=Cu(d,Yt.__wbindgen_malloc,Yt.__wbindgen_realloc),S=Xa;In()[a/4+1]=S,In()[a/4+0]=y},p.wbg.__wbg_error_f851667af71bcfc6=function(a,h){let d,y;try{d=a,y=h,console.error(ha(a,h))}finally{Yt.__wbindgen_free(d,y,1)}},p.wbg.__wbg_debug_9a6b3243fbbebb61=function(a){console.debug(Ci(a))},p.wbg.__wbg_error_788ae33f81d3b84b=function(a){console.error(Ci(a))},p.wbg.__wbg_info_2e30e8204b29d91d=function(a){console.info(Ci(a))},p.wbg.__wbg_log_1d3ae0273d8f4f8a=function(a){console.log(Ci(a))},p.wbg.__wbg_warn_d60e832f9882c1b2=function(a){console.warn(Ci(a))},p.wbg.__wbg_get_44be0491f933a435=function(a,h){const d=Ci(a)[h>>>0];return xr(d)},p.wbg.__wbg_length_fff51ee6522a1a18=function(a){return Ci(a).length},p.wbg.__wbindgen_is_function=function(a){return typeof Ci(a)=="function"},p.wbg.__wbg_next_526fc47e980da008=function(a){const h=Ci(a).next;return xr(h)},p.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return zh(function(a){const h=Ci(a).next();return xr(h)},arguments)},p.wbg.__wbg_done_5c1f01fb660d73b5=function(a){return Ci(a).done},p.wbg.__wbg_value_1695675138684bd5=function(a){const h=Ci(a).value;return xr(h)},p.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return xr(Symbol.iterator)},p.wbg.__wbg_get_97b561fb56f034b5=function(){return zh(function(a,h){const d=Reflect.get(Ci(a),Ci(h));return xr(d)},arguments)},p.wbg.__wbg_call_cb65541d95d71282=function(){return zh(function(a,h){const d=Ci(a).call(Ci(h));return xr(d)},arguments)},p.wbg.__wbg_isArray_4c24b343cb13cfb1=function(a){return Array.isArray(Ci(a))},p.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(a){let h;try{h=Ci(a)instanceof ArrayBuffer}catch{h=!1}return h},p.wbg.__wbg_buffer_085ec1f694018c4f=function(a){const h=Ci(a).buffer;return xr(h)},p.wbg.__wbg_new_8125e318e6245eed=function(a){const h=new Uint8Array(Ci(a));return xr(h)},p.wbg.__wbg_set_5cf90238115182c3=function(a,h,d){Ci(a).set(Ci(h),d>>>0)},p.wbg.__wbg_length_72e2208bbc0efc61=function(a){return Ci(a).length},p.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(a){let h;try{h=Ci(a)instanceof Uint8Array}catch{h=!1}return h},p.wbg.__wbindgen_debug_string=function(a,h){const d=Vh(Ci(h)),y=Cu(d,Yt.__wbindgen_malloc,Yt.__wbindgen_realloc),S=Xa;In()[a/4+1]=S,In()[a/4+0]=y},p.wbg.__wbindgen_throw=function(a,h){throw new Error(ha(a,h))},p.wbg.__wbindgen_memory=function(){const a=Yt.memory;return xr(a)},p}function xg(p,a){return Yt=p.exports,Hh.__wbindgen_wasm_module=a,Oc=null,Bc=null,Rc=null,Yt}async function Hh(p){if(Yt!==void 0)return Yt;typeof p>"u"&&(p="/ltn/assets/route_snapper_bg.wasm");const a=bg();(typeof p=="string"||typeof Request=="function"&&p instanceof Request||typeof URL=="function"&&p instanceof URL)&&(p=fetch(p));const{instance:h,module:d}=await vg(await p,a);return xg(h,d)}const Nl=[];function Dh(p,a){return{subscribe:hr(p,a).subscribe}}function hr(p,a=_i){let h;const d=new Set;function y(s){if(Di(p,s)&&(p=s,h)){const D=!Nl.length;for(const M of d)M[1](),Nl.push(M,p);if(D){for(let M=0;M<Nl.length;M+=2)Nl[M][0](Nl[M+1]);Nl.length=0}}}function S(s){y(s(p))}function k(s,D=_i){const M=[s,D];return d.add(M),d.size===1&&(h=a(y,S)||_i),s(p),()=>{d.delete(M),d.size===0&&h&&(h(),h=null)}}return{set:y,update:S,subscribe:k}}let wg=Date.now();function Xc(p){return`${p}-${wg++}`}const Xh=Symbol.for("svelte-maplibre");function Hl(){return $_(Xh)}function Sg(p){let a=new WeakMap;return h=>{var k;let d=a.get(h.originalEvent);if(d!==void 0)return d;let S=(k=h.target.queryRenderedFeatures(h.point).find(s=>{var D;return(D=p.get(s.layer.id))==null?void 0:D.interactive}))==null?void 0:k.layer.id;return a.set(h.originalEvent,S),S}}function Tg(){let p=new Map;return If(Xh,{map:hr(null),source:Dh(null),layer:Dh(null),popupTarget:Dh(null),cluster:hr(),loadedImages:hr(new Set),minzoom:hr(0),maxzoom:hr(24),layerEvent:hr(null),layerInfo:p,eventTopMost:Sg(p)})}function Op(p){return{subscribe:p.subscribe}}function Kh({key:p,setPopupTarget:a=!1,setCluster:h=!1,setMouseEvent:d=!1}){let y=Hl(),S=hr(null),k=Op(S),s={...y,[p]:Op(S)};if(a&&(s.popupTarget=k),d){let D=hr(null);s.layerEvent=D,y.layerEvent=D}return h&&(s.cluster=hr()),If(Xh,s),{...y,self:S}}function Ig(){return Kh({key:"source",setCluster:!0})}function Cg(p=!0){return Kh({key:"layer",setPopupTarget:p,setMouseEvent:p})}function kg(){return Kh({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}function Eg(p){return"layerType"in p&&p.layerType==="deckgl"}var Ul=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Lf(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var zf={exports:{}};(function(p,a){(function(h,d){p.exports=d()})(Ul,function(){var h,d,y;function S(s,D){if(!h)h=D;else if(!d)d=D;else{var M="var sharedChunk = {}; ("+h+")(sharedChunk); ("+d+")(sharedChunk);",q={};h(q),y=D(q),typeof window<"u"&&(y.workerUrl=window.URL.createObjectURL(new Blob([M],{type:"text/javascript"})))}}S(["exports"],function(s){function D(i,e,n,o){return new(n||(n=Promise))(function(c,m){function g(C){try{T(o.next(C))}catch(P){m(P)}}function b(C){try{T(o.throw(C))}catch(P){m(P)}}function T(C){var P;C.done?c(C.value):(P=C.value,P instanceof n?P:new n(function(F){F(P)})).then(g,b)}T((o=o.apply(i,e||[])).next())})}function M(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var q=te;function te(i,e){this.x=i,this.y=e}te.prototype={clone:function(){return new te(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),n=Math.sin(i),o=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=o,this},_rotateAround:function(i,e){var n=Math.cos(i),o=Math.sin(i),c=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-o*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},te.convert=function(i){return i instanceof te?i:Array.isArray(i)?new te(i[0],i[1]):i};var ce=M(q),be=he;function he(i,e,n,o){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=n,this.p2y=o}he.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var n=i,o=0;o<8;o++){var c=this.sampleCurveX(n)-i;if(Math.abs(c)<e)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=c/m}var g=0,b=1;for(n=i,o=0;o<20&&(c=this.sampleCurveX(n),!(Math.abs(c-i)<e));o++)i>c?g=n:b=n,n=.5*(b-g)+g;return n},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var ye=M(be);let me,Te;function De(){return me==null&&(me=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),me}function Ze(){if(Te==null&&(Te=!1,De())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<5*5;o++){const c=4*o;e.fillStyle=`rgb(${c},${c+1},${c+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}const n=e.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&n[o]!==o){Te=!0;break}}}return Te||!1}function Le(i,e,n,o){const c=new ye(i,e,n,o);return function(m){return c.solve(m)}}const tt=Le(.25,.1,.25,1);function xt(i,e,n){return Math.min(n,Math.max(e,i))}function Qe(i,e,n){const o=n-e,c=((i-e)%o+o)%o+e;return c===e?n:c}function Dt(i,...e){for(const n of e)for(const o in n)i[o]=n[o];return i}let bt=1;function qt(i,e,n){const o={};for(const c in i)o[c]=e.call(n||this,i[c],c,i);return o}function Fe(i,e,n){const o={};for(const c in i)e.call(n||this,i[c],c,i)&&(o[c]=i[c]);return o}function $e(i){return Array.isArray(i)?i.map($e):typeof i=="object"&&i?qt(i,$e):i}const Wt={};function rt(i){Wt[i]||(typeof console<"u"&&console.warn(i),Wt[i]=!0)}function Qt(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function Bt(i){let e=0;for(let n,o,c=0,m=i.length,g=m-1;c<m;g=c++)n=i[c],o=i[g],e+=(o.x-n.x)*(n.y+o.y);return e}function At(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let hi=null;function Rn(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const On="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ei(i,e,n,o,c){return D(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const m=new VideoFrame(i,{timestamp:0});try{const g=m==null?void 0:m.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);const b=g.startsWith("BGR"),T=new Uint8ClampedArray(o*c*4);if(yield m.copyTo(T,function(C,P,F,O,U){const j=4*Math.max(-P,0),W=(Math.max(0,F)-F)*O*4+j,ee=4*O,re=Math.max(0,P),fe=Math.max(0,F);return{rect:{x:re,y:fe,width:Math.min(C.width,P+O)-re,height:Math.min(C.height,F+U)-fe},layout:[{offset:W,stride:ee}]}}(i,e,n,o,c)),b)for(let C=0;C<T.length;C+=4){const P=T[C];T[C]=T[C+2],T[C+2]=P}return T}finally{m.close()}})}let Mi,Nt,bi,ji;const qe={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){return this.getImageCanvasContext(i).getImageData(-e,-e,i.width+2*e,i.height+2*e)},getImageCanvasContext(i){const e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=i.width,e.height=i.height,n.drawImage(i,0,0,i.width,i.height),n},resolveURL:i=>(bi||(bi=document.createElement("a")),bi.href=i,bi.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ji==null&&(ji=matchMedia("(prefers-reduced-motion: reduce)")),ji.matches)}},Zt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class nt extends Error{constructor(e,n,o,c){super(`AJAXError: ${n} (${e}): ${o}`),this.status=e,this.statusText=n,this.url=o,this.body=c}}const oi=At()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,vt=i=>Zt.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))];function qi(i,e){const n=new AbortController,o=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,cache:i.cache,referrer:oi(),signal:n.signal});let c=!1,m=!1;return i.type==="json"&&o.headers.set("Accept","application/json"),m||fetch(o).then(g=>g.ok?(b=>{(i.type==="arrayBuffer"||i.type==="image"?b.arrayBuffer():i.type==="json"?b.json():b.text()).then(T=>{m||(c=!0,e(null,T,b.headers.get("Cache-Control"),b.headers.get("Expires")))}).catch(T=>{m||e(new Error(T.message))})})(g):g.blob().then(b=>e(new nt(g.status,g.statusText,i.url,b)))).catch(g=>{g.code!==20&&e(new Error(g.message))}),{cancel:()=>{m=!0,c||n.abort()}}}const xn=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(At()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!At())return(vt(i.url)||qi)(i,e)}if(!(/^file:/.test(n=i.url)||/^file:/.test(oi())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return qi(i,e);if(At()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var n;return function(o,c){const m=new XMLHttpRequest;m.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(m.responseType="arraybuffer");for(const g in o.headers)m.setRequestHeader(g,o.headers[g]);return o.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=o.credentials==="include",m.onerror=()=>{c(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let g=m.response;if(o.type==="json")try{g=JSON.parse(m.response)}catch(b){return c(b)}c(null,g,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else{const g=new Blob([m.response],{type:m.getResponseHeader("Content-Type")});c(new nt(m.status,m.statusText,o.url,g))}},m.send(o.body),{cancel:()=>m.abort()}}(i,e)},Je=function(i,e){return xn(Dt(i,{type:"arrayBuffer"}),e)};function Fi(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function wn(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function xi(i,e,n){if(n&&n[i]){const o=n[i].indexOf(e);o!==-1&&n[i].splice(o,1)}}class Zr{constructor(e,n={}){Dt(this,n),this.type=e}}class fr extends Zr{constructor(e,n={}){super("error",Dt({error:e},n))}}class Zn{on(e,n){return this._listeners=this._listeners||{},wn(e,n,this._listeners),this}off(e,n){return xi(e,n,this._listeners),xi(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},wn(e,n,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,n){typeof e=="string"&&(e=new Zr(e,n||{}));const o=e.type;if(this.listens(o)){e.target=this;const c=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const b of c)b.call(this,e);const m=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const b of m)xi(o,b,this._oneTimeListeners),b.call(this,e);const g=this._eventedParent;g&&(Dt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof fr&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var Me={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Kn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function mr(i,e){const n={};for(const o in i)o!=="ref"&&(n[o]=i[o]);return Kn.forEach(o=>{o in e&&(n[o]=e[o])}),n}function Ai(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let n=0;n<i.length;n++)if(!Ai(i[n],e[n]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const n in i)if(!Ai(i[n],e[n]))return!1;return!0}return i===e}const ii={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function wr(i,e,n){n.push({command:ii.addSource,args:[i,e[i]]})}function Jn(i,e,n){e.push({command:ii.removeSource,args:[i]}),n[i]=!0}function Sn(i,e,n,o){Jn(i,n,o),wr(i,e,n)}function en(i,e,n){let o;for(o in i[n])if(Object.prototype.hasOwnProperty.call(i[n],o)&&o!=="data"&&!Ai(i[n][o],e[n][o]))return!1;for(o in e[n])if(Object.prototype.hasOwnProperty.call(e[n],o)&&o!=="data"&&!Ai(i[n][o],e[n][o]))return!1;return!0}function pi(i,e,n,o,c,m){let g;for(g in e=e||{},i=i||{})Object.prototype.hasOwnProperty.call(i,g)&&(Ai(i[g],e[g])||n.push({command:m,args:[o,g,e[g],c]}));for(g in e)Object.prototype.hasOwnProperty.call(e,g)&&!Object.prototype.hasOwnProperty.call(i,g)&&(Ai(i[g],e[g])||n.push({command:m,args:[o,g,e[g],c]}))}function Ji(i){return i.id}function wo(i,e){return i[e.id]=e,i}class it{constructor(e,n,o,c){this.message=(e?`${e}: `:"")+o,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function zr(i,...e){for(const n of e)for(const o in n)i[o]=n[o];return i}class _n extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class hs{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[o,c]of n)this.bindings[o]=c}concat(e){return new hs(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Sr={kind:"null"},st={kind:"number"},ri={kind:"string"},Kt={kind:"boolean"},sr={kind:"color"},Dr={kind:"object"},Gt={kind:"value"},Gr={kind:"collator"},K={kind:"formatted"},R={kind:"padding"},B={kind:"resolvedImage"},Z={kind:"variableAnchorOffsetCollection"};function Y(i,e){return{kind:"array",itemType:i,N:e}}function $(i){if(i.kind==="array"){const e=$(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const _e=[Sr,st,ri,Kt,sr,K,Dr,Y(Gt),R,B,Z];function ae(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ae(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const n of _e)if(!ae(n,e))return null}}return`Expected ${$(i)} but found ${$(e)} instead.`}function ne(i,e){return e.some(n=>n.kind===i.kind)}function ue(i,e){return e.some(n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i)}function ze(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const Re=.96422,Oe=.82521,kt=4/29,Jt=6/29,wt=3*Jt*Jt,Rt=Jt*Jt*Jt,ei=Math.PI/180,zi=180/Math.PI;function si(i){return(i%=360)<0&&(i+=360),i}function Ii([i,e,n,o]){let c,m;const g=ar((.2225045*(i=wi(i))+.7168786*(e=wi(e))+.0606169*(n=wi(n)))/1);i===e&&e===n?c=m=g:(c=ar((.4360747*i+.3850649*e+.1430804*n)/Re),m=ar((.0139322*i+.0971045*e+.7141733*n)/Oe));const b=116*g-16;return[b<0?0:b,500*(c-g),200*(g-m),o]}function wi(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function ar(i){return i>Rt?Math.pow(i,1/3):i/wt+kt}function Hi([i,e,n,o]){let c=(i+16)/116,m=isNaN(e)?c:c+e/500,g=isNaN(n)?c:c-n/200;return c=1*Bn(c),m=Re*Bn(m),g=Oe*Bn(g),[Mn(3.1338561*m-1.6168667*c-.4906146*g),Mn(-.9787684*m+1.9161415*c+.033454*g),Mn(.0719453*m-.2289914*c+1.4052427*g),o]}function Mn(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function Bn(i){return i>Jt?i*i*i:wt*(i-kt)}function Wr(i){return parseInt(i.padEnd(2,i),16)/255}function Bs(i,e){return Zo(e?i/100:i,0,1)}function Zo(i,e,n){return Math.min(Math.max(e,i),n)}function Go(i){return!i.some(Number.isNaN)}const Nn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Ri{constructor(e,n,o,c=1,m=!0){this.r=e,this.g=n,this.b=o,this.a=c,m||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[e,n,o,c]))}static parse(e){if(e instanceof Ri)return e;if(typeof e!="string")return;const n=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=Nn[o];if(c){const[g,b,T]=c;return[g/255,b/255,T/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const g=o.length<6?1:2;let b=1;return[Wr(o.slice(b,b+=g)),Wr(o.slice(b,b+=g)),Wr(o.slice(b,b+=g)),Wr(o.slice(b,b+g)||"ff")]}if(o.startsWith("rgb")){const g=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[b,T,C,P,F,O,U,j,W,ee,re,fe]=g,oe=[P||" ",U||" ",ee].join("");if(oe==="  "||oe==="  /"||oe===",,"||oe===",,,"){const ve=[C,O,W].join(""),Ie=ve==="%%%"?100:ve===""?255:0;if(Ie){const Ne=[Zo(+T/Ie,0,1),Zo(+F/Ie,0,1),Zo(+j/Ie,0,1),re?Bs(+re,fe):1];if(Go(Ne))return Ne}}return}}const m=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[g,b,T,C,P,F,O,U,j]=m,W=[T||" ",P||" ",O].join("");if(W==="  "||W==="  /"||W===",,"||W===",,,"){const ee=[+b,Zo(+C,0,100),Zo(+F,0,100),U?Bs(+U,j):1];if(Go(ee))return function([re,fe,oe,ve]){function Ie(Ne){const yt=(Ne+re/30)%12,Ct=fe*Math.min(oe,1-oe);return oe-Ct*Math.max(-1,Math.min(yt-3,9-yt,1))}return re=si(re),fe/=100,oe/=100,[Ie(0),Ie(8),Ie(4),ve]}(ee)}}}(e);return n?new Ri(...n,!1):void 0}get rgb(){const{r:e,g:n,b:o,a:c}=this,m=c||1/0;return this.overwriteGetter("rgb",[e/m,n/m,o/m,c])}get hcl(){return this.overwriteGetter("hcl",function(e){const[n,o,c,m]=Ii(e),g=Math.sqrt(o*o+c*c);return[Math.round(1e4*g)?si(Math.atan2(c,o)*zi):NaN,g,n,m]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ii(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,o,c]=this.rgb;return`rgba(${[e,n,o].map(m=>Math.round(255*m)).join(",")},${c})`}}Ri.black=new Ri(0,0,0,1),Ri.white=new Ri(1,1,1,1),Ri.transparent=new Ri(0,0,0,0),Ri.red=new Ri(1,0,0,1);class pa{constructor(e,n,o){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class no{constructor(e,n,o,c,m){this.text=e,this.image=n,this.scale=o,this.fontStack=c,this.textColor=m}}class on{constructor(e){this.sections=e}static fromString(e){return new on([new no(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof on?e:on.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class lr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof lr)return e;if(typeof e=="number")return new lr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new lr(e)}}toString(){return JSON.stringify(this.values)}}const ds=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Gn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Gn)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let n=0;n<e.length;n+=2){const o=e[n],c=e[n+1];if(typeof o!="string"||!ds.has(o)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new Gn(e)}}toString(){return JSON.stringify(this.values)}}class Wn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Wn({name:e,available:!1}):null}}function fa(i,e,n,o){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,e,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,e,n,o]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ts(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Ri||i instanceof pa||i instanceof on||i instanceof lr||i instanceof Gn||i instanceof Wn)return!0;if(Array.isArray(i)){for(const e of i)if(!Ts(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Ts(i[e]))return!1;return!0}return!1}function an(i){if(i===null)return Sr;if(typeof i=="string")return ri;if(typeof i=="boolean")return Kt;if(typeof i=="number")return st;if(i instanceof Ri)return sr;if(i instanceof pa)return Gr;if(i instanceof on)return K;if(i instanceof lr)return R;if(i instanceof Gn)return Z;if(i instanceof Wn)return B;if(Array.isArray(i)){const e=i.length;let n;for(const o of i){const c=an(o);if(n){if(n===c)continue;n=Gt;break}n=c}return Y(n||Gt,e)}return Dr}function Pi(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Ri||i instanceof on||i instanceof lr||i instanceof Gn||i instanceof Wn?i.toString():JSON.stringify(i)}class Lo{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ts(e[1]))return n.error("invalid value");const o=e[1];let c=an(o);const m=n.expectedType;return c.kind!=="array"||c.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(c=m),new Lo(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ln{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ns={string:ri,number:st,boolean:Kt,object:Dr};class Hr{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o,c=1;const m=e[0];if(m==="array"){let b,T;if(e.length>2){const C=e[1];if(typeof C!="string"||!(C in Ns)||C==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);b=Ns[C],c++}else b=Gt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);T=e[2],c++}o=Y(b,T)}else{if(!Ns[m])throw new Error(`Types doesn't contain name = ${m}`);o=Ns[m]}const g=[];for(;c<e.length;c++){const b=n.parse(e[c],c,Gt);if(!b)return null;g.push(b)}return new Hr(o,g)}evaluate(e){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(e);if(!ae(this.type,an(o)))return o;if(n===this.args.length-1)throw new ln(`Expected value to be of type ${$(this.type)}, but found ${$(an(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ja={"to-boolean":Kt,"to-color":sr,"to-number":st,"to-string":ri};class Wo{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[0];if(!Ja[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return n.error("Expected one argument.");const c=Ja[o],m=[];for(let g=1;g<e.length;g++){const b=n.parse(e[g],g,Gt);if(!b)return null;m.push(b)}return new Wo(c,m)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,o;for(const c of this.args){if(n=c.evaluate(e),o=null,n instanceof Ri)return n;if(typeof n=="string"){const m=e.parseColor(n);if(m)return m}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:fa(n[0],n[1],n[2],n[3]),!o))return new Ri(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new ln(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(e);const c=lr.parse(n);if(c)return c}throw new ln(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(e);const c=Gn.parse(n);if(c)return c}throw new ln(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(e),n===null)return 0;const c=Number(n);if(!isNaN(c))return c}throw new ln(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return on.fromString(Pi(this.args[0].evaluate(e)));case"resolvedImage":return Wn.fromString(Pi(this.args[0].evaluate(e)));default:return Pi(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Vs=["Unknown","Point","LineString","Polygon"];class v{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Vs[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=Ri.parse(e)),n}}class E{constructor(e,n,o=[],c,m=new hs,g=[]){this.registry=e,this.path=o,this.key=o.map(b=>`[${b}]`).join(""),this.scope=m,this.errors=g,this.expectedType=c,this._isConstant=n}parse(e,n,o,c,m={}){return n?this.concat(n,o,c)._parse(e,m):this._parse(e,m)}_parse(e,n){function o(c,m,g){return g==="assert"?new Hr(m,[c]):g==="coerce"?new Wo(m,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[c];if(m){let g=m.parse(e,this);if(!g)return null;if(this.expectedType){const b=this.expectedType,T=g.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||T.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string")if(b.kind!=="padding"||T.kind!=="value"&&T.kind!=="number"&&T.kind!=="array")if(b.kind!=="variableAnchorOffsetCollection"||T.kind!=="value"&&T.kind!=="array"){if(this.checkSubtype(b,T))return null}else g=o(g,b,n.typeAnnotation||"coerce");else g=o(g,b,n.typeAnnotation||"coerce");else g=o(g,b,n.typeAnnotation||"coerce");else g=o(g,b,n.typeAnnotation||"assert")}if(!(g instanceof Lo)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const b=new v;try{g=new Lo(g.type,g.evaluate(b))}catch(T){return this.error(T.message),null}}return g}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,o){const c=typeof e=="number"?this.path.concat(e):this.path,m=o?this.scope.concat(o):this.scope;return new E(this.registry,this._isConstant,c,n||null,m,this.errors)}error(e,...n){const o=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new _n(o,e))}checkSubtype(e,n){const o=ae(e,n);return o&&this.error(o),o}}class V{constructor(e,n,o){this.type=Gr,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const c=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Kt);if(!c)return null;const m=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Kt);if(!m)return null;let g=null;return o.locale&&(g=n.parse(o.locale,1,ri),!g)?null:new V(c,m,g)}evaluate(e){return new pa(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const Q=8192;function se(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function le(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function xe(i,e){const n=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(n*c*Q),Math.round(o*c*Q)]}function Ge(i,e,n){const o=i[0]-e[0],c=i[1]-e[1],m=i[0]-n[0],g=i[1]-n[1];return o*g-m*c==0&&o*m<=0&&c*g<=0}function Ye(i,e){let n=!1;for(let g=0,b=e.length;g<b;g++){const T=e[g];for(let C=0,P=T.length;C<P-1;C++){if(Ge(i,T[C],T[C+1]))return!1;(c=T[C])[1]>(o=i)[1]!=(m=T[C+1])[1]>o[1]&&o[0]<(m[0]-c[0])*(o[1]-c[1])/(m[1]-c[1])+c[0]&&(n=!n)}}var o,c,m;return n}function mt(i,e){for(let n=0;n<e.length;n++)if(Ye(i,e[n]))return!0;return!1}function _t(i,e,n,o){const c=o[0]-n[0],m=o[1]-n[1],g=(i[0]-n[0])*m-c*(i[1]-n[1]),b=(e[0]-n[0])*m-c*(e[1]-n[1]);return g>0&&b<0||g<0&&b>0}function ct(i,e,n){for(const C of n)for(let P=0;P<C.length-1;++P)if((b=[(g=C[P+1])[0]-(m=C[P])[0],g[1]-m[1]])[0]*(T=[(c=e)[0]-(o=i)[0],c[1]-o[1]])[1]-b[1]*T[0]!=0&&_t(o,c,m,g)&&_t(m,g,o,c))return!0;var o,c,m,g,b,T;return!1}function ti(i,e){for(let n=0;n<i.length;++n)if(!Ye(i[n],e))return!1;for(let n=0;n<i.length-1;++n)if(ct(i[n],i[n+1],e))return!1;return!0}function cn(i,e){for(let n=0;n<e.length;n++)if(ti(i,e[n]))return!0;return!1}function ni(i,e,n){const o=[];for(let c=0;c<i.length;c++){const m=[];for(let g=0;g<i[c].length;g++){const b=xe(i[c][g],n);se(e,b),m.push(b)}o.push(m)}return o}function Cn(i,e,n){const o=[];for(let c=0;c<i.length;c++){const m=ni(i[c],e,n);o.push(m)}return o}function Ue(i,e,n,o){if(i[0]<n[0]||i[0]>n[2]){const c=.5*o;let m=i[0]-n[0]>c?-o:n[0]-i[0]>c?o:0;m===0&&(m=i[0]-n[2]>c?-o:n[2]-i[0]>c?o:0),i[0]+=m}se(e,i)}function Et(i,e,n,o){const c=Math.pow(2,o.z)*Q,m=[o.x*Q,o.y*Q],g=[];for(const b of i)for(const T of b){const C=[T.x+m[0],T.y+m[1]];Ue(C,e,n,c),g.push(C)}return g}function Oi(i,e,n,o){const c=Math.pow(2,o.z)*Q,m=[o.x*Q,o.y*Q],g=[];for(const T of i){const C=[];for(const P of T){const F=[P.x+m[0],P.y+m[1]];se(e,F),C.push(F)}g.push(C)}if(e[2]-e[0]<=c/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const T of g)for(const C of T)Ue(C,e,n,c)}var b;return g}class un{constructor(e,n){this.type=Kt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ts(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let c=0;c<o.features.length;++c){const m=o.features[c].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new un(o,o.features[c].geometry)}else if(o.type==="Feature"){const c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new un(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new un(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,o){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const b=ni(o.coordinates,m,g),T=Et(n.geometry(),c,m,g);if(!le(c,m))return!1;for(const C of T)if(!Ye(C,b))return!1}if(o.type==="MultiPolygon"){const b=Cn(o.coordinates,m,g),T=Et(n.geometry(),c,m,g);if(!le(c,m))return!1;for(const C of T)if(!mt(C,b))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,o){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const b=ni(o.coordinates,m,g),T=Oi(n.geometry(),c,m,g);if(!le(c,m))return!1;for(const C of T)if(!ti(C,b))return!1}if(o.type==="MultiPolygon"){const b=Cn(o.coordinates,m,g),T=Oi(n.geometry(),c,m,g);if(!le(c,m))return!1;for(const C of T)if(!cn(C,b))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class gn{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=e[1];return n.scope.has(o)?new gn(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Tr{constructor(e,n,o,c){this.name=e,this.type=n,this._evaluate=o,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const o=e[0],c=Tr.definitions[o];if(!c)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(c)?c[0]:c.type,g=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,b=g.filter(([C])=>!Array.isArray(C)||C.length===e.length-1);let T=null;for(const[C,P]of b){T=new E(n.registry,ma,n.path,null,n.scope);const F=[];let O=!1;for(let U=1;U<e.length;U++){const j=e[U],W=Array.isArray(C)?C[U-1]:C.type,ee=T.parse(j,1+F.length,W);if(!ee){O=!0;break}F.push(ee)}if(!O)if(Array.isArray(C)&&C.length!==F.length)T.error(`Expected ${C.length} arguments, but found ${F.length} instead.`);else{for(let U=0;U<F.length;U++){const j=Array.isArray(C)?C[U]:C.type,W=F[U];T.concat(U+1).checkSubtype(j,W.type)}if(T.errors.length===0)return new Tr(o,m,P,F)}}if(b.length===1)n.errors.push(...T.errors);else{const C=(b.length?b:g).map(([F])=>{return O=F,Array.isArray(O)?`(${O.map($).join(", ")})`:`(${$(O.type)}...)`;var O}).join(" | "),P=[];for(let F=1;F<e.length;F++){const O=n.parse(e[F],1+P.length);if(!O)return null;P.push($(O.type))}n.error(`Expected arguments of type ${C}, but found (${P.join(", ")}) instead.`)}return null}static register(e,n){Tr.definitions=n;for(const o in n)e[o]=Tr}}function ma(i){if(i instanceof gn)return ma(i.boundExpression);if(i instanceof Tr&&i.name==="error"||i instanceof V||i instanceof un)return!1;const e=i instanceof Wo||i instanceof Hr;let n=!0;return i.eachChild(o=>{n=e?n&&ma(o):n&&o instanceof Lo}),!!n&&Xi(i)&&_a(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Xi(i){if(i instanceof Tr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof un)return!1;let e=!0;return i.eachChild(n=>{e&&!Xi(n)&&(e=!1)}),e}function Is(i){if(i instanceof Tr&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(n=>{e&&!Is(n)&&(e=!1)}),e}function _a(i,e){if(i instanceof Tr&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(o=>{n&&!_a(o,e)&&(n=!1)}),n}function Ir(i,e){const n=i.length-1;let o,c,m=0,g=n,b=0;for(;m<=g;)if(b=Math.floor((m+g)/2),o=i[b],c=i[b+1],o<=e){if(b===n||e<c)return b;m=b+1}else{if(!(o>e))throw new ln("Input is not a number.");g=b-1}return 0}class zo{constructor(e,n,o){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[c,m]of o)this.labels.push(c),this.outputs.push(m)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(e[1],1,st);if(!o)return null;const c=[];let m=null;n.expectedType&&n.expectedType.kind!=="value"&&(m=n.expectedType);for(let g=1;g<e.length;g+=2){const b=g===1?-1/0:e[g],T=e[g+1],C=g,P=g+1;if(typeof b!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(c.length&&c[c.length-1][0]>=b)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const F=n.parse(T,P,m);if(!F)return null;m=m||F.type,c.push([b,F])}return new zo(m,o,c)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return o[0].evaluate(e);const m=n.length;return c>=n[m-1]?o[m-1].evaluate(e):o[Ir(n,c)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function fi(i,e,n){return i+n*(e-i)}function Us(i,e,n){return i.map((o,c)=>fi(o,e[c],n))}const _r={number:fi,color:function(i,e,n,o="rgb"){switch(o){case"rgb":{const[c,m,g,b]=Us(i.rgb,e.rgb,n);return new Ri(c,m,g,b,!1)}case"hcl":{const[c,m,g,b]=i.hcl,[T,C,P,F]=e.hcl;let O,U;if(isNaN(c)||isNaN(T))isNaN(c)?isNaN(T)?O=NaN:(O=T,g!==1&&g!==0||(U=C)):(O=c,P!==1&&P!==0||(U=m));else{let fe=T-c;T>c&&fe>180?fe-=360:T<c&&c-T>180&&(fe+=360),O=c+n*fe}const[j,W,ee,re]=function([fe,oe,ve,Ie]){return fe=isNaN(fe)?0:fe*ei,Hi([ve,Math.cos(fe)*oe,Math.sin(fe)*oe,Ie])}([O,U??fi(m,C,n),fi(g,P,n),fi(b,F,n)]);return new Ri(j,W,ee,re,!1)}case"lab":{const[c,m,g,b]=Hi(Us(i.lab,e.lab,n));return new Ri(c,m,g,b,!1)}}},array:Us,padding:function(i,e,n){return new lr(Us(i.values,e.values,n))},variableAnchorOffsetCollection:function(i,e,n){const o=i.values,c=e.values;if(o.length!==c.length)throw new ln(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);const m=[];for(let g=0;g<o.length;g+=2){if(o[g]!==c[g])throw new ln(`Cannot interpolate values containing mismatched anchors. from[${g}]: ${o[g]}, to[${g}]: ${c[g]}`);m.push(o[g]);const[b,T]=o[g+1],[C,P]=c[g+1];m.push([fi(b,C,n),fi(T,P,n)])}return new Gn(m)}};class Cr{constructor(e,n,o,c,m){this.type=e,this.operator=n,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(const[g,b]of m)this.labels.push(g),this.outputs.push(b)}static interpolationFactor(e,n,o,c){let m=0;if(e.name==="exponential")m=ga(n,e.base,o,c);else if(e.name==="linear")m=ga(n,1,o,c);else if(e.name==="cubic-bezier"){const g=e.controlPoints;m=new ye(g[0],g[1],g[2],g[3]).solve(ga(n,1,o,c))}return m}static parse(e,n){let[o,c,m,...g]=e;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const C=c[1];if(typeof C!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:C}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const C=c.slice(1);if(C.length!==4||C.some(P=>typeof P!="number"||P<0||P>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:C}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(m=n.parse(m,2,st),!m)return null;const b=[];let T=null;o==="interpolate-hcl"||o==="interpolate-lab"?T=sr:n.expectedType&&n.expectedType.kind!=="value"&&(T=n.expectedType);for(let C=0;C<g.length;C+=2){const P=g[C],F=g[C+1],O=C+3,U=C+4;if(typeof P!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(b.length&&b[b.length-1][0]>=P)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);const j=n.parse(F,U,T);if(!j)return null;T=T||j.type,b.push([P,j])}return ze(T,st)||ze(T,sr)||ze(T,R)||ze(T,Z)||ze(T,Y(st))?new Cr(T,o,c,m,b):n.error(`Type ${$(T)} is not interpolatable.`)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return o[0].evaluate(e);const m=n.length;if(c>=n[m-1])return o[m-1].evaluate(e);const g=Ir(n,c),b=Cr.interpolationFactor(this.interpolation,c,n[g],n[g+1]),T=o[g].evaluate(e),C=o[g+1].evaluate(e);switch(this.operator){case"interpolate":return _r[this.type.kind](T,C,b);case"interpolate-hcl":return _r.color(T,C,b,"hcl");case"interpolate-lab":return _r.color(T,C,b,"lab")}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function ga(i,e,n,o){const c=o-n,m=i-n;return c===0?0:e===1?m/c:(Math.pow(e,m)-1)/(Math.pow(e,c)-1)}class ya{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let o=null;const c=n.expectedType;c&&c.kind!=="value"&&(o=c);const m=[];for(const b of e.slice(1)){const T=n.parse(b,1+m.length,o,void 0,{typeAnnotation:"omit"});if(!T)return null;o=o||T.type,m.push(T)}if(!o)throw new Error("No output type");const g=c&&m.some(b=>ae(c,b.type));return new ya(g?Gt:o,m)}evaluate(e){let n,o=null,c=0;for(const m of this.args)if(c++,o=m.evaluate(e),o&&o instanceof Wn&&!o.available&&(n||(n=o.name),o=null,c===this.args.length&&(o=n)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class va{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let m=1;m<e.length-1;m+=2){const g=e[m];if(typeof g!="string")return n.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return n.error("Variable names must contain only alphanumeric characters or '_'.",m);const b=n.parse(e[m+1],m+1);if(!b)return null;o.push([g,b])}const c=n.parse(e[e.length-1],e.length-1,n.expectedType,o);return c?new va(o,c):null}outputDefined(){return this.result.outputDefined()}}class Ya{constructor(e,n,o){this.type=e,this.index=n,this.input=o}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,st),c=n.parse(e[2],2,Y(n.expectedType||Gt));return o&&c?new Ya(c.type.itemType,o,c):null}evaluate(e){const n=this.index.evaluate(e),o=this.input.evaluate(e);if(n<0)throw new ln(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new ln(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new ln(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class ba{constructor(e,n){this.type=Kt,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Gt),c=n.parse(e[2],2,Gt);return o&&c?ne(o.type,[Kt,ri,st,Sr,Gt])?new ba(o,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${$(o.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!ue(n,["boolean","string","number","null"]))throw new ln(`Expected first argument to be of type boolean, string, number or null, but found ${$(an(n))} instead.`);if(!ue(o,["string","array"]))throw new ln(`Expected second argument to be of type array or string, but found ${$(an(o))} instead.`);return o.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class js{constructor(e,n,o){this.type=st,this.needle=e,this.haystack=n,this.fromIndex=o}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Gt),c=n.parse(e[2],2,Gt);if(!o||!c)return null;if(!ne(o.type,[Kt,ri,st,Sr,Gt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${$(o.type)} instead`);if(e.length===4){const m=n.parse(e[3],3,st);return m?new js(o,c,m):null}return new js(o,c)}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!ue(n,["boolean","string","number","null"]))throw new ln(`Expected first argument to be of type boolean, string, number or null, but found ${$(an(n))} instead.`);if(!ue(o,["string","array"]))throw new ln(`Expected second argument to be of type array or string, but found ${$(an(o))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return o.indexOf(n,c)}return o.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class xa{constructor(e,n,o,c,m,g){this.inputType=e,this.type=n,this.input=o,this.cases=c,this.outputs=m,this.otherwise=g}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let o,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const m={},g=[];for(let C=2;C<e.length-1;C+=2){let P=e[C];const F=e[C+1];Array.isArray(P)||(P=[P]);const O=n.concat(C);if(P.length===0)return O.error("Expected at least one branch label.");for(const j of P){if(typeof j!="number"&&typeof j!="string")return O.error("Branch labels must be numbers or strings.");if(typeof j=="number"&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return O.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof j=="number"&&Math.floor(j)!==j)return O.error("Numeric branch labels must be integer values.");if(o){if(O.checkSubtype(o,an(j)))return null}else o=an(j);if(m[String(j)]!==void 0)return O.error("Branch labels must be unique.");m[String(j)]=g.length}const U=n.parse(F,C,c);if(!U)return null;c=c||U.type,g.push(U)}const b=n.parse(e[1],1,Gt);if(!b)return null;const T=n.parse(e[e.length-1],e.length-1,c);return T?b.type.kind!=="value"&&n.concat(1).checkSubtype(o,b.type)?null:new xa(o,c,b,m,g,T):null}evaluate(e){const n=this.input.evaluate(e);return(an(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Qa{constructor(e,n,o){this.type=e,this.branches=n,this.otherwise=o}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const c=[];for(let g=1;g<e.length-1;g+=2){const b=n.parse(e[g],g,Kt);if(!b)return null;const T=n.parse(e[g+1],g+1,o);if(!T)return null;c.push([b,T]),o=o||T.type}const m=n.parse(e[e.length-1],e.length-1,o);if(!m)return null;if(!o)throw new Error("Can't infer output type");return new Qa(o,c,m)}evaluate(e){for(const[n,o]of this.branches)if(n.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,o]of this.branches)e(n),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class wa{constructor(e,n,o,c){this.type=e,this.input=n,this.beginIndex=o,this.endIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Gt),c=n.parse(e[2],2,st);if(!o||!c)return null;if(!ne(o.type,[Y(Gt),ri,Gt]))return n.error(`Expected first argument to be of type array or string, but found ${$(o.type)} instead`);if(e.length===4){const m=n.parse(e[3],3,st);return m?new wa(o.type,o,c,m):null}return new wa(o.type,o,c)}evaluate(e){const n=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!ue(n,["string","array"]))throw new ln(`Expected first argument to be of type array or string, but found ${$(an(n))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return n.slice(o,c)}return n.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function qs(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Sa(i,e,n,o){return o.compare(e,n)===0}function ps(i,e,n){const o=i!=="=="&&i!=="!=";return class Df{constructor(m,g,b){this.type=Kt,this.lhs=m,this.rhs=g,this.collator=b,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");const b=m[0];let T=g.parse(m[1],1,Gt);if(!T)return null;if(!qs(b,T.type))return g.concat(1).error(`"${b}" comparisons are not supported for type '${$(T.type)}'.`);let C=g.parse(m[2],2,Gt);if(!C)return null;if(!qs(b,C.type))return g.concat(2).error(`"${b}" comparisons are not supported for type '${$(C.type)}'.`);if(T.type.kind!==C.type.kind&&T.type.kind!=="value"&&C.type.kind!=="value")return g.error(`Cannot compare types '${$(T.type)}' and '${$(C.type)}'.`);o&&(T.type.kind==="value"&&C.type.kind!=="value"?T=new Hr(C.type,[T]):T.type.kind!=="value"&&C.type.kind==="value"&&(C=new Hr(T.type,[C])));let P=null;if(m.length===4){if(T.type.kind!=="string"&&C.type.kind!=="string"&&T.type.kind!=="value"&&C.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(P=g.parse(m[3],3,Gr),!P)return null}return new Df(T,C,P)}evaluate(m){const g=this.lhs.evaluate(m),b=this.rhs.evaluate(m);if(o&&this.hasUntypedArgument){const T=an(g),C=an(b);if(T.kind!==C.kind||T.kind!=="string"&&T.kind!=="number")throw new ln(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${T.kind}, ${C.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const T=an(g),C=an(b);if(T.kind!=="string"||C.kind!=="string")return e(m,g,b)}return this.collator?n(m,g,b,this.collator.evaluate(m)):e(m,g,b)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const So=ps("==",function(i,e,n){return e===n},Sa),yl=ps("!=",function(i,e,n){return e!==n},function(i,e,n,o){return!Sa(0,e,n,o)}),vl=ps("<",function(i,e,n){return e<n},function(i,e,n,o){return o.compare(e,n)<0}),Kl=ps(">",function(i,e,n){return e>n},function(i,e,n,o){return o.compare(e,n)>0}),bl=ps("<=",function(i,e,n){return e<=n},function(i,e,n,o){return o.compare(e,n)<=0}),Ta=ps(">=",function(i,e,n){return e>=n},function(i,e,n,o){return o.compare(e,n)>=0});class Ia{constructor(e,n,o,c,m){this.type=ri,this.number=e,this.locale=n,this.currency=o,this.minFractionDigits=c,this.maxFractionDigits=m}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const o=n.parse(e[1],1,st);if(!o)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let m=null;if(c.locale&&(m=n.parse(c.locale,1,ri),!m))return null;let g=null;if(c.currency&&(g=n.parse(c.currency,1,ri),!g))return null;let b=null;if(c["min-fraction-digits"]&&(b=n.parse(c["min-fraction-digits"],1,st),!b))return null;let T=null;return c["max-fraction-digits"]&&(T=n.parse(c["max-fraction-digits"],1,st),!T)?null:new Ia(o,m,g,b,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Zs{constructor(e){this.type=K,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const c=[];let m=!1;for(let g=1;g<=e.length-1;++g){const b=e[g];if(m&&typeof b=="object"&&!Array.isArray(b)){m=!1;let T=null;if(b["font-scale"]&&(T=n.parse(b["font-scale"],1,st),!T))return null;let C=null;if(b["text-font"]&&(C=n.parse(b["text-font"],1,Y(ri)),!C))return null;let P=null;if(b["text-color"]&&(P=n.parse(b["text-color"],1,sr),!P))return null;const F=c[c.length-1];F.scale=T,F.font=C,F.textColor=P}else{const T=n.parse(e[g],1,Gt);if(!T)return null;const C=T.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,c.push({content:T,scale:null,font:null,textColor:null})}}return new Zs(c)}evaluate(e){return new on(this.sections.map(n=>{const o=n.content.evaluate(e);return an(o)===B?new no("",o,null,null,null):new no(Pi(o),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}}class $a{constructor(e){this.type=B,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const o=n.parse(e[1],1,ri);return o?new $a(o):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),o=Wn.fromString(n);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(n)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class Do{constructor(e){this.type=st,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=n.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${$(o.type)} instead.`):new Do(o):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new ln(`Expected value to be of type string or array, but found ${$(an(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const fs={"==":So,"!=":yl,">":Kl,"<":vl,">=":Ta,"<=":bl,array:Hr,at:Ya,boolean:Hr,case:Qa,coalesce:ya,collator:V,format:Zs,image:$a,in:ba,"index-of":js,interpolate:Cr,"interpolate-hcl":Cr,"interpolate-lab":Cr,length:Do,let:va,literal:Lo,match:xa,number:Hr,"number-format":Ia,object:Hr,slice:wa,step:zo,string:Hr,"to-boolean":Wo,"to-color":Wo,"to-number":Wo,"to-string":Wo,var:gn,within:un};function xl(i,[e,n,o,c]){e=e.evaluate(i),n=n.evaluate(i),o=o.evaluate(i);const m=c?c.evaluate(i):1,g=fa(e,n,o,m);if(g)throw new ln(g);return new Ri(e/255,n/255,o/255,m,!1)}function wl(i,e){return i in e}function Gs(i,e){const n=e[i];return n===void 0?null:n}function ro(i){return{type:i}}function Ca(i){return{result:"success",value:i}}function To(i){return{result:"error",value:i}}function Ho(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Cs(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function el(i){return!!i.expression&&i.expression.interpolated}function Li(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function hn(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Jl(i){return i}function gi(i,e){const n=e.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",c=o||!(o||i.property!==void 0),m=i.type||(el(e)?"exponential":"interval");if(n||e.type==="padding"){const P=n?Ri.parse:lr.parse;(i=zr({},i)).stops&&(i.stops=i.stops.map(F=>[F[0],P(F[1])])),i.default=P(i.default?i.default:e.default)}if(i.colorSpace&&(g=i.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var g;let b,T,C;if(m==="exponential")b=Fr;else if(m==="interval")b=Bi;else if(m==="categorical"){b=tn,T=Object.create(null);for(const P of i.stops)T[P[0]]=P[1];C=typeof i.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);b=Ko}if(o){const P={},F=[];for(let j=0;j<i.stops.length;j++){const W=i.stops[j],ee=W[0].zoom;P[ee]===void 0&&(P[ee]={zoom:ee,type:i.type,property:i.property,default:i.default,stops:[]},F.push(ee)),P[ee].stops.push([W[0].value,W[1]])}const O=[];for(const j of F)O.push([P[j].zoom,gi(P[j],e)]);const U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:Cr.interpolationFactor.bind(void 0,U),zoomStops:O.map(j=>j[0]),evaluate:({zoom:j},W)=>Fr({stops:O,base:i.base},e,j).evaluate(j,W)}}if(c){const P=m==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:Cr.interpolationFactor.bind(void 0,P),zoomStops:i.stops.map(F=>F[0]),evaluate:({zoom:F})=>b(i,e,F,T,C)}}return{kind:"source",evaluate(P,F){const O=F&&F.properties?F.properties[i.property]:void 0;return O===void 0?Xo(i.default,e.default):b(i,e,O,T,C)}}}function Xo(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function tn(i,e,n,o,c){return Xo(typeof n===c?o[n]:void 0,i.default,e.default)}function Bi(i,e,n){if(Li(n)!=="number")return Xo(i.default,e.default);const o=i.stops.length;if(o===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[o-1][0])return i.stops[o-1][1];const c=Ir(i.stops.map(m=>m[0]),n);return i.stops[c][1]}function Fr(i,e,n){const o=i.base!==void 0?i.base:1;if(Li(n)!=="number")return Xo(i.default,e.default);const c=i.stops.length;if(c===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[c-1][0])return i.stops[c-1][1];const m=Ir(i.stops.map(P=>P[0]),n),g=function(P,F,O,U){const j=U-O,W=P-O;return j===0?0:F===1?W/j:(Math.pow(F,W)-1)/(Math.pow(F,j)-1)}(n,o,i.stops[m][0],i.stops[m+1][0]),b=i.stops[m][1],T=i.stops[m+1][1],C=_r[e.type]||Jl;return typeof b.evaluate=="function"?{evaluate(...P){const F=b.evaluate.apply(void 0,P),O=T.evaluate.apply(void 0,P);if(F!==void 0&&O!==void 0)return C(F,O,g,i.colorSpace)}}:C(b,T,g,i.colorSpace)}function Ko(i,e,n){switch(e.type){case"color":n=Ri.parse(n);break;case"formatted":n=on.fromString(n.toString());break;case"resolvedImage":n=Wn.fromString(n.toString());break;case"padding":n=lr.parse(n);break;default:Li(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0)}return Xo(n,i.default,e.default)}Tr.register(fs,{error:[{kind:"error"},[ri],(i,[e])=>{throw new ln(e.evaluate(i))}],typeof:[ri,[Gt],(i,[e])=>$(an(e.evaluate(i)))],"to-rgba":[Y(st,4),[sr],(i,[e])=>{const[n,o,c,m]=e.evaluate(i).rgb;return[255*n,255*o,255*c,m]}],rgb:[sr,[st,st,st],xl],rgba:[sr,[st,st,st,st],xl],has:{type:Kt,overloads:[[[ri],(i,[e])=>wl(e.evaluate(i),i.properties())],[[ri,Dr],(i,[e,n])=>wl(e.evaluate(i),n.evaluate(i))]]},get:{type:Gt,overloads:[[[ri],(i,[e])=>Gs(e.evaluate(i),i.properties())],[[ri,Dr],(i,[e,n])=>Gs(e.evaluate(i),n.evaluate(i))]]},"feature-state":[Gt,[ri],(i,[e])=>Gs(e.evaluate(i),i.featureState||{})],properties:[Dr,[],i=>i.properties()],"geometry-type":[ri,[],i=>i.geometryType()],id:[Gt,[],i=>i.id()],zoom:[st,[],i=>i.globals.zoom],"heatmap-density":[st,[],i=>i.globals.heatmapDensity||0],"line-progress":[st,[],i=>i.globals.lineProgress||0],accumulated:[Gt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[st,ro(st),(i,e)=>{let n=0;for(const o of e)n+=o.evaluate(i);return n}],"*":[st,ro(st),(i,e)=>{let n=1;for(const o of e)n*=o.evaluate(i);return n}],"-":{type:st,overloads:[[[st,st],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[st],(i,[e])=>-e.evaluate(i)]]},"/":[st,[st,st],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[st,[st,st],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[st,[],()=>Math.LN2],pi:[st,[],()=>Math.PI],e:[st,[],()=>Math.E],"^":[st,[st,st],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[st,[st],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[st,[st],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[st,[st],(i,[e])=>Math.log(e.evaluate(i))],log2:[st,[st],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[st,[st],(i,[e])=>Math.sin(e.evaluate(i))],cos:[st,[st],(i,[e])=>Math.cos(e.evaluate(i))],tan:[st,[st],(i,[e])=>Math.tan(e.evaluate(i))],asin:[st,[st],(i,[e])=>Math.asin(e.evaluate(i))],acos:[st,[st],(i,[e])=>Math.acos(e.evaluate(i))],atan:[st,[st],(i,[e])=>Math.atan(e.evaluate(i))],min:[st,ro(st),(i,e)=>Math.min(...e.map(n=>n.evaluate(i)))],max:[st,ro(st),(i,e)=>Math.max(...e.map(n=>n.evaluate(i)))],abs:[st,[st],(i,[e])=>Math.abs(e.evaluate(i))],round:[st,[st],(i,[e])=>{const n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[st,[st],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[st,[st],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[Kt,[ri,Gt],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[Kt,[Gt],(i,[e])=>i.id()===e.value],"filter-type-==":[Kt,[ri],(i,[e])=>i.geometryType()===e.value],"filter-<":[Kt,[ri,Gt],(i,[e,n])=>{const o=i.properties()[e.value],c=n.value;return typeof o==typeof c&&o<c}],"filter-id-<":[Kt,[Gt],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n<o}],"filter->":[Kt,[ri,Gt],(i,[e,n])=>{const o=i.properties()[e.value],c=n.value;return typeof o==typeof c&&o>c}],"filter-id->":[Kt,[Gt],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n>o}],"filter-<=":[Kt,[ri,Gt],(i,[e,n])=>{const o=i.properties()[e.value],c=n.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[Kt,[Gt],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n<=o}],"filter->=":[Kt,[ri,Gt],(i,[e,n])=>{const o=i.properties()[e.value],c=n.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[Kt,[Gt],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n>=o}],"filter-has":[Kt,[Gt],(i,[e])=>e.value in i.properties()],"filter-has-id":[Kt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Kt,[Y(ri)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[Kt,[Y(Gt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[Kt,[ri,Y(Gt)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[Kt,[ri,Y(Gt)],(i,[e,n])=>function(o,c,m,g){for(;m<=g;){const b=m+g>>1;if(c[b]===o)return!0;c[b]>o?g=b-1:m=b+1}return!1}(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Kt,overloads:[[[Kt,Kt],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[ro(Kt),(i,e)=>{for(const n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:Kt,overloads:[[[Kt,Kt],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[ro(Kt),(i,e)=>{for(const n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[Kt,[Kt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[Kt,[ri],(i,[e])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[ri,[ri],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[ri,[ri],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[ri,ro(Gt),(i,e)=>e.map(n=>Pi(n.evaluate(i))).join("")],"resolved-locale":[ri,[Gr],(i,[e])=>e.evaluate(i).resolvedLocale()]});class ks{constructor(e,n){var o;this.expression=e,this._warningHistory={},this._evaluator=new v,this._defaultValue=n?(o=n).type==="color"&&hn(o.default)?new Ri(0,0,0,0):o.type==="color"?Ri.parse(o.default)||null:o.type==="padding"?lr.parse(o.default)||null:o.type==="variableAnchorOffsetCollection"?Gn.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,o,c,m,g){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(e,n,o,c,m,g){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new ln(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function oo(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in fs}function ka(i,e){const n=new E(fs,ma,[],e?function(c){const m={color:sr,string:ri,number:st,enum:ri,boolean:Kt,formatted:K,padding:R,resolvedImage:B,variableAnchorOffsetCollection:Z};return c.type==="array"?Y(m[c.value]||Gt,c.length):m[c.type]}(e):void 0),o=n.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?Ca(new ks(o,e)):To(n.errors)}class Es{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!Is(n.expression)}evaluateWithoutErrorHandling(e,n,o,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,c,m,g)}evaluate(e,n,o,c,m,g){return this._styleExpression.evaluate(e,n,o,c,m,g)}}class Jo{constructor(e,n,o,c){this.kind=e,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Is(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,n,o,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,c,m,g)}evaluate(e,n,o,c,m,g){return this._styleExpression.evaluate(e,n,o,c,m,g)}interpolationFactor(e,n,o){return this.interpolationType?Cr.interpolationFactor(this.interpolationType,e,n,o):0}}function Ea(i,e){const n=ka(i,e);if(n.result==="error")return n;const o=n.value.expression,c=Xi(o);if(!c&&!Ho(e))return To([new _n("","data expressions not supported")]);const m=_a(o,["zoom"]);if(!m&&!Cs(e))return To([new _n("","zoom expressions not supported")]);const g=Ws(o);return g||m?g instanceof _n?To([g]):g instanceof Cr&&!el(e)?To([new _n("",'"interpolate" expressions cannot be used with this property')]):Ca(g?new Jo(c?"camera":"composite",n.value,g.labels,g instanceof Cr?g.interpolation:void 0):new Es(c?"constant":"source",n.value)):To([new _n("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ms{constructor(e,n){this._parameters=e,this._specification=n,zr(this,gi(this._parameters,this._specification))}static deserialize(e){return new Ms(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ws(i){let e=null;if(i instanceof va)e=Ws(i.result);else if(i instanceof ya){for(const n of i.args)if(e=Ws(n),e)break}else(i instanceof zo||i instanceof Cr)&&i.input instanceof Tr&&i.input.name==="zoom"&&(e=i);return e instanceof _n||i.eachChild(n=>{const o=Ws(n);o instanceof _n?e=o:!e&&o?e=new _n("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new _n("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Hs(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Hs(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Sl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ma(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Hs(i)||(i=Pa(i));const e=ka(i,Sl);if(e.result==="error")throw new Error(e.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,o,c)=>e.value.evaluate(n,o,{},c),needGeometry:ms(i)}}function Aa(i,e){return i<e?-1:i>e?1:0}function ms(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(ms(i[e]))return!0;return!1}function Pa(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Io(i[1],i[2],"=="):e==="!="?As(Io(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Io(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(Pa))):e==="all"?["all"].concat(i.slice(1).map(Pa)):e==="none"?["all"].concat(i.slice(1).map(Pa).map(As)):e==="in"?Tl(i[1],i.slice(2)):e==="!in"?As(Tl(i[1],i.slice(2))):e==="has"?Yo(i[1]):e==="!has"?As(Yo(i[1])):e!=="within"||i;var n}function Io(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function Tl(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Aa)]]:["filter-in-small",i,["literal",e]]}}function Yo(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function As(i){return["!",i]}function La(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let c="[";for(const m of i)c+=`${La(m)},`;return`${c}]`}const n=Object.keys(i).sort();let o="{";for(let c=0;c<n.length;c++)o+=`${JSON.stringify(n[c])}:${La(i[n[c]])},`;return`${o}}`}function _s(i){let e="";for(const n of Kn)e+=`/${La(i[n])}`;return e}function za(i){const e=i.value;return e?[new it(i.key,e,"constants have been deprecated as of v8")]:[]}function dn(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Qo(i){if(Array.isArray(i))return i.map(Qo);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const n in i)e[n]=Qo(i[n]);return e}return dn(i)}function gr(i){const e=i.key,n=i.value,o=i.valueSpec||{},c=i.objectElementValidators||{},m=i.style,g=i.styleSpec,b=i.validateSpec;let T=[];const C=Li(n);if(C!=="object")return[new it(e,n,`object expected, ${C} found`)];for(const P in n){const F=P.split(".")[0],O=o[F]||o["*"];let U;if(c[F])U=c[F];else if(o[F])U=b;else if(c["*"])U=c["*"];else{if(!o["*"]){T.push(new it(e,n[P],`unknown property "${P}"`));continue}U=b}T=T.concat(U({key:(e&&`${e}.`)+P,value:n[P],valueSpec:O,style:m,styleSpec:g,object:n,objectKey:P,validateSpec:b},n))}for(const P in o)c[P]||o[P].required&&o[P].default===void 0&&n[P]===void 0&&T.push(new it(e,n,`missing required property "${P}"`));return T}function Co(i){const e=i.value,n=i.valueSpec,o=i.style,c=i.styleSpec,m=i.key,g=i.arrayElementValidator||i.validateSpec;if(Li(e)!=="array")return[new it(m,e,`array expected, ${Li(e)} found`)];if(n.length&&e.length!==n.length)return[new it(m,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new it(m,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let b={type:n.value,values:n.values};c.$version<7&&(b.function=n.function),Li(n.value)==="object"&&(b=n.value);let T=[];for(let C=0;C<e.length;C++)T=T.concat(g({array:e,arrayIndex:C,value:e[C],valueSpec:b,validateSpec:i.validateSpec,style:o,styleSpec:c,key:`${m}[${C}]`}));return T}function Ps(i){const e=i.key,n=i.value,o=i.valueSpec;let c=Li(n);return c==="number"&&n!=n&&(c="NaN"),c!=="number"?[new it(e,n,`number expected, ${c} found`)]:"minimum"in o&&n<o.minimum?[new it(e,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new it(e,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function Da(i){const e=i.valueSpec,n=dn(i.value.type);let o,c,m,g={};const b=n!=="categorical"&&i.value.property===void 0,T=!b,C=Li(i.value.stops)==="array"&&Li(i.value.stops[0])==="array"&&Li(i.value.stops[0][0])==="object",P=gr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(U){if(n==="identity")return[new it(U.key,U.value,'identity function may not have a "stops" property')];let j=[];const W=U.value;return j=j.concat(Co({key:U.key,value:W,valueSpec:U.valueSpec,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:F})),Li(W)==="array"&&W.length===0&&j.push(new it(U.key,W,"array must have at least one stop")),j},default:function(U){return U.validateSpec({key:U.key,value:U.value,valueSpec:e,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec})}}});return n==="identity"&&b&&P.push(new it(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||P.push(new it(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!el(i.valueSpec)&&P.push(new it(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(T&&!Ho(i.valueSpec)?P.push(new it(i.key,i.value,"property functions not supported")):b&&!Cs(i.valueSpec)&&P.push(new it(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!C||i.value.property!==void 0||P.push(new it(i.key,i.value,'"property" property is required')),P;function F(U){let j=[];const W=U.value,ee=U.key;if(Li(W)!=="array")return[new it(ee,W,`array expected, ${Li(W)} found`)];if(W.length!==2)return[new it(ee,W,`array length 2 expected, length ${W.length} found`)];if(C){if(Li(W[0])!=="object")return[new it(ee,W,`object expected, ${Li(W[0])} found`)];if(W[0].zoom===void 0)return[new it(ee,W,"object stop key must have zoom")];if(W[0].value===void 0)return[new it(ee,W,"object stop key must have value")];if(m&&m>dn(W[0].zoom))return[new it(ee,W[0].zoom,"stop zoom values must appear in ascending order")];dn(W[0].zoom)!==m&&(m=dn(W[0].zoom),c=void 0,g={}),j=j.concat(gr({key:`${ee}[0]`,value:W[0],valueSpec:{zoom:{}},validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:Ps,value:O}}))}else j=j.concat(O({key:`${ee}[0]`,value:W[0],valueSpec:{},validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec},W));return oo(Qo(W[1]))?j.concat([new it(`${ee}[1]`,W[1],"expressions are not allowed in function stops.")]):j.concat(U.validateSpec({key:`${ee}[1]`,value:W[1],valueSpec:e,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec}))}function O(U,j){const W=Li(U.value),ee=dn(U.value),re=U.value!==null?U.value:j;if(o){if(W!==o)return[new it(U.key,re,`${W} stop domain type must match previous stop domain type ${o}`)]}else o=W;if(W!=="number"&&W!=="string"&&W!=="boolean")return[new it(U.key,re,"stop domain value must be a number, string, or boolean")];if(W!=="number"&&n!=="categorical"){let fe=`number expected, ${W} found`;return Ho(e)&&n===void 0&&(fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new it(U.key,re,fe)]}return n!=="categorical"||W!=="number"||isFinite(ee)&&Math.floor(ee)===ee?n!=="categorical"&&W==="number"&&c!==void 0&&ee<c?[new it(U.key,re,"stop domain values must appear in ascending order")]:(c=ee,n==="categorical"&&ee in g?[new it(U.key,re,"stop domain values must be unique")]:(g[ee]=!0,[])):[new it(U.key,re,`integer expected, found ${ee}`)]}}function ge(i){const e=(i.expressionContext==="property"?Ea:ka)(Qo(i.value),i.valueSpec);if(e.result==="error")return e.value.map(o=>new it(`${i.key}${o.key}`,i.value,o.message));const n=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new it(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Is(n))return[new it(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Is(n))return[new it(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!_a(n,["zoom","feature-state"]))return[new it(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Xi(n))return[new it(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ae(i){const e=i.key,n=i.value,o=i.valueSpec,c=[];return Array.isArray(o.values)?o.values.indexOf(dn(n))===-1&&c.push(new it(e,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(dn(n))===-1&&c.push(new it(e,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),c}function ut(i){return Hs(Qo(i.value))?ge(zr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):jt(i)}function jt(i){const e=i.value,n=i.key;if(Li(e)!=="array")return[new it(n,e,`array expected, ${Li(e)} found`)];const o=i.styleSpec;let c,m=[];if(e.length<1)return[new it(n,e,"filter array must have at least 1 element")];switch(m=m.concat(Ae({key:`${n}[0]`,value:e[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),dn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&dn(e[1])==="$type"&&m.push(new it(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&m.push(new it(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=Li(e[1]),c!=="string"&&m.push(new it(`${n}[1]`,e[1],`string expected, ${c} found`)));for(let g=2;g<e.length;g++)c=Li(e[g]),dn(e[1])==="$type"?m=m.concat(Ae({key:`${n}[${g}]`,value:e[g],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&m.push(new it(`${n}[${g}]`,e[g],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)m=m.concat(jt({key:`${n}[${g}]`,value:e[g],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":c=Li(e[1]),e.length!==2?m.push(new it(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&m.push(new it(`${n}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=Li(e[1]),e.length!==2?m.push(new it(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&m.push(new it(`${n}[1]`,e[1],`object expected, ${c} found`))}return m}function nn(i,e){const n=i.key,o=i.validateSpec,c=i.style,m=i.styleSpec,g=i.value,b=i.objectKey,T=m[`${e}_${i.layerType}`];if(!T)return[];const C=b.match(/^(.*)-transition$/);if(e==="paint"&&C&&T[C[1]]&&T[C[1]].transition)return o({key:n,value:g,valueSpec:m.transition,style:c,styleSpec:m});const P=i.valueSpec||T[b];if(!P)return[new it(n,g,`unknown property "${b}"`)];let F;if(Li(g)==="string"&&Ho(P)&&!P.tokens&&(F=/^{([^}]+)}$/.exec(g)))return[new it(n,g,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(F[1])} }\`.`)];const O=[];return i.layerType==="symbol"&&(b==="text-field"&&c&&!c.glyphs&&O.push(new it(n,g,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&hn(Qo(g))&&dn(g.type)==="identity"&&O.push(new it(n,g,'"text-font" does not support identity functions'))),O.concat(o({key:i.key,value:g,valueSpec:P,style:c,styleSpec:m,expressionContext:"property",propertyType:e,propertyKey:b}))}function Si(i){return nn(i,"paint")}function yn(i){return nn(i,"layout")}function kn(i){let e=[];const n=i.value,o=i.key,c=i.style,m=i.styleSpec;n.type||n.ref||e.push(new it(o,n,'either "type" or "ref" is required'));let g=dn(n.type);const b=dn(n.ref);if(n.id){const T=dn(n.id);for(let C=0;C<i.arrayIndex;C++){const P=c.layers[C];dn(P.id)===T&&e.push(new it(o,n.id,`duplicate layer id "${n.id}", previously used at line ${P.id.__line__}`))}}if("ref"in n){let T;["type","source","source-layer","filter","layout"].forEach(C=>{C in n&&e.push(new it(o,n[C],`"${C}" is prohibited for ref layers`))}),c.layers.forEach(C=>{dn(C.id)===b&&(T=C)}),T?T.ref?e.push(new it(o,n.ref,"ref cannot reference another ref layer")):g=dn(T.type):e.push(new it(o,n.ref,`ref layer "${b}" not found`))}else if(g!=="background")if(n.source){const T=c.sources&&c.sources[n.source],C=T&&dn(T.type);T?C==="vector"&&g==="raster"?e.push(new it(o,n.source,`layer "${n.id}" requires a raster source`)):C!=="raster-dem"&&g==="hillshade"?e.push(new it(o,n.source,`layer "${n.id}" requires a raster-dem source`)):C==="raster"&&g!=="raster"?e.push(new it(o,n.source,`layer "${n.id}" requires a vector source`)):C!=="vector"||n["source-layer"]?C==="raster-dem"&&g!=="hillshade"?e.push(new it(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!n.paint||!n.paint["line-gradient"]||C==="geojson"&&T.lineMetrics||e.push(new it(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new it(o,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new it(o,n.source,`source "${n.source}" not found`))}else e.push(new it(o,n,'missing required property "source"'));return e=e.concat(gr({key:o,value:n,valueSpec:m.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${o}.type`,value:n.type,valueSpec:m.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:n,objectKey:"type"}),filter:ut,layout:T=>gr({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":C=>yn(zr({layerType:g},C))}}),paint:T=>gr({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":C=>Si(zr({layerType:g},C))}})}})),e}function An(i){const e=i.value,n=i.key,o=Li(e);return o!=="string"?[new it(n,e,`string expected, ${o} found`)]:[]}const vn={promoteId:function({key:i,value:e}){if(Li(e)==="string")return An({key:i,value:e});{const n=[];for(const o in e)n.push(...An({key:`${i}.${o}`,value:e[o]}));return n}}};function Ni(i){const e=i.value,n=i.key,o=i.styleSpec,c=i.style,m=i.validateSpec;if(!e.type)return[new it(n,e,'"type" is required')];const g=dn(e.type);let b;switch(g){case"vector":case"raster":return b=gr({key:n,value:e,valueSpec:o[`source_${g.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:vn,validateSpec:m}),b;case"raster-dem":return b=function(T){var C;const P=(C=T.sourceName)!==null&&C!==void 0?C:"",F=T.value,O=T.styleSpec,U=O.source_raster_dem,j=T.style;let W=[];const ee=Li(F);if(F===void 0)return W;if(ee!=="object")return W.push(new it("source_raster_dem",F,`object expected, ${ee} found`)),W;const re=dn(F.encoding)==="custom",fe=["redFactor","greenFactor","blueFactor","baseShift"],oe=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const ve in F)!re&&fe.includes(ve)?W.push(new it(ve,F[ve],`In "${P}": "${ve}" is only valid when "encoding" is set to "custom". ${oe} encoding found`)):U[ve]?W=W.concat(T.validateSpec({key:ve,value:F[ve],valueSpec:U[ve],validateSpec:T.validateSpec,style:j,styleSpec:O})):W.push(new it(ve,F[ve],`unknown property "${ve}"`));return W}({sourceName:n,value:e,style:i.style,styleSpec:o,validateSpec:m}),b;case"geojson":if(b=gr({key:n,value:e,valueSpec:o.source_geojson,style:c,styleSpec:o,validateSpec:m,objectElementValidators:vn}),e.cluster)for(const T in e.clusterProperties){const[C,P]=e.clusterProperties[T],F=typeof C=="string"?[C,["accumulated"],["get",T]]:C;b.push(...ge({key:`${n}.${T}.map`,value:P,validateSpec:m,expressionContext:"cluster-map"})),b.push(...ge({key:`${n}.${T}.reduce`,value:F,validateSpec:m,expressionContext:"cluster-reduce"}))}return b;case"video":return gr({key:n,value:e,valueSpec:o.source_video,style:c,validateSpec:m,styleSpec:o});case"image":return gr({key:n,value:e,valueSpec:o.source_image,style:c,validateSpec:m,styleSpec:o});case"canvas":return[new it(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ae({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,validateSpec:m,styleSpec:o})}}function kr(i){const e=i.value,n=i.styleSpec,o=n.light,c=i.style;let m=[];const g=Li(e);if(e===void 0)return m;if(g!=="object")return m=m.concat([new it("light",e,`object expected, ${g} found`)]),m;for(const b in e){const T=b.match(/^(.*)-transition$/);m=m.concat(T&&o[T[1]]&&o[T[1]].transition?i.validateSpec({key:b,value:e[b],valueSpec:n.transition,validateSpec:i.validateSpec,style:c,styleSpec:n}):o[b]?i.validateSpec({key:b,value:e[b],valueSpec:o[b],validateSpec:i.validateSpec,style:c,styleSpec:n}):[new it(b,e[b],`unknown property "${b}"`)])}return m}function ko(i){const e=i.value,n=i.styleSpec,o=n.terrain,c=i.style;let m=[];const g=Li(e);if(e===void 0)return m;if(g!=="object")return m=m.concat([new it("terrain",e,`object expected, ${g} found`)]),m;for(const b in e)m=m.concat(o[b]?i.validateSpec({key:b,value:e[b],valueSpec:o[b],validateSpec:i.validateSpec,style:c,styleSpec:n}):[new it(b,e[b],`unknown property "${b}"`)]);return m}function cr(i){let e=[];const n=i.value,o=i.key;if(Array.isArray(n)){const c=[],m=[];for(const g in n)n[g].id&&c.includes(n[g].id)&&e.push(new it(o,n,`all the sprites' ids must be unique, but ${n[g].id} is duplicated`)),c.push(n[g].id),n[g].url&&m.includes(n[g].url)&&e.push(new it(o,n,`all the sprites' URLs must be unique, but ${n[g].url} is duplicated`)),m.push(n[g].url),e=e.concat(gr({key:`${o}[${g}]`,value:n[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return An({key:o,value:n})}const Eo={"*":()=>[],array:Co,boolean:function(i){const e=i.value,n=i.key,o=Li(e);return o!=="boolean"?[new it(n,e,`boolean expected, ${o} found`)]:[]},number:Ps,color:function(i){const e=i.key,n=i.value,o=Li(n);return o!=="string"?[new it(e,n,`color expected, ${o} found`)]:Ri.parse(String(n))?[]:[new it(e,n,`color expected, "${n}" found`)]},constants:za,enum:Ae,filter:ut,function:Da,layer:kn,object:gr,source:Ni,light:kr,terrain:ko,string:An,formatted:function(i){return An(i).length===0?[]:ge(i)},resolvedImage:function(i){return An(i).length===0?[]:ge(i)},padding:function(i){const e=i.key,n=i.value;if(Li(n)==="array"){if(n.length<1||n.length>4)return[new it(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let c=[];for(let m=0;m<n.length;m++)c=c.concat(i.validateSpec({key:`${e}[${m}]`,value:n[m],validateSpec:i.validateSpec,valueSpec:o}));return c}return Ps({key:e,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const e=i.key,n=i.value,o=Li(n),c=i.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new it(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let m=[];for(let g=0;g<n.length;g+=2)m=m.concat(Ae({key:`${e}[${g}]`,value:n[g],valueSpec:c.layout_symbol["text-anchor"]})),m=m.concat(Co({key:`${e}[${g+1}]`,value:n[g+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:c}));return m},sprite:cr};function Er(i){const e=i.value,n=i.valueSpec,o=i.styleSpec;return i.validateSpec=Er,n.expression&&hn(dn(e))?Da(i):n.expression&&oo(Qo(e))?ge(i):n.type&&Eo[n.type]?Eo[n.type](i):gr(zr({},i,{valueSpec:n.type?o[n.type]:n}))}function Xs(i){const e=i.value,n=i.key,o=An(i);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new it(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new it(n,e,'"glyphs" url must include a "{range}" token'))),o}function Yn(i,e=Me){let n=[];return n=n.concat(Er({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:Er,objectElementValidators:{glyphs:Xs,"*":()=>[]}})),i.constants&&(n=n.concat(za({key:"constants",value:i.constants,style:i,styleSpec:e,validateSpec:Er}))),Ks(n)}function Rr(i){return function(e){return i({...e,validateSpec:Er})}}function Ks(i){return[].concat(i).sort((e,n)=>e.line-n.line)}function Fo(i){return function(...e){return Ks(i.apply(this,e))}}Yn.source=Fo(Rr(Ni)),Yn.sprite=Fo(Rr(cr)),Yn.glyphs=Fo(Rr(Xs)),Yn.light=Fo(Rr(kr)),Yn.terrain=Fo(Rr(ko)),Yn.layer=Fo(Rr(kn)),Yn.filter=Fo(Rr(ut)),Yn.paintProperty=Fo(Rr(Si)),Yn.layoutProperty=Fo(Rr(yn));const Ro=Yn,Yi=Ro.light,Vi=Ro.paintProperty,Js=Ro.layoutProperty;function so(i,e){let n=!1;if(e&&e.length)for(const o of e)i.fire(new fr(new Error(o.message))),n=!0;return n}class $o{constructor(e,n,o){const c=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const g=new Int32Array(this.arrayBuffer);e=g[0],this.d=(n=g[1])+2*(o=g[2]);for(let T=0;T<this.d*this.d;T++){const C=g[3+T],P=g[3+T+1];c.push(C===P?null:g.subarray(C,P))}const b=g[3+c.length+1];this.keys=g.subarray(g[3+c.length],b),this.bboxes=g.subarray(b),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let g=0;g<this.d*this.d;g++)c.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=e,this.padding=o,this.scale=n/e,this.uid=0;const m=o/n*e;this.min=-m,this.max=e+m}insert(e,n,o,c,m){this._forEachCell(n,o,c,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,n,o,c,m,g){this.cells[m].push(g)}query(e,n,o,c,m){const g=this.min,b=this.max;if(e<=g&&n<=g&&b<=o&&b<=c&&!m)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(e,n,o,c,this._queryCell,T,{},m),T}}_queryCell(e,n,o,c,m,g,b,T){const C=this.cells[m];if(C!==null){const P=this.keys,F=this.bboxes;for(let O=0;O<C.length;O++){const U=C[O];if(b[U]===void 0){const j=4*U;(T?T(F[j+0],F[j+1],F[j+2],F[j+3]):e<=F[j+2]&&n<=F[j+3]&&o>=F[j+0]&&c>=F[j+1])?(b[U]=!0,g.push(P[U])):b[U]=!1}}}}_forEachCell(e,n,o,c,m,g,b,T){const C=this._convertToCellCoord(e),P=this._convertToCellCoord(n),F=this._convertToCellCoord(o),O=this._convertToCellCoord(c);for(let U=C;U<=F;U++)for(let j=P;j<=O;j++){const W=this.d*j+U;if((!T||T(this._convertFromCellCoord(U),this._convertFromCellCoord(j),this._convertFromCellCoord(U+1),this._convertFromCellCoord(j+1)))&&m.call(this,e,n,o,c,W,g,b,T))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,n=3+this.cells.length+1+1;let o=0;for(let g=0;g<this.cells.length;g++)o+=this.cells[g].length;const c=new Int32Array(n+o+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let m=n;for(let g=0;g<e.length;g++){const b=e[g];c[3+g]=m,c.set(b,m),m+=b.length}return c[3+e.length]=m,c.set(this.keys,m),m+=this.keys.length,c[3+e.length+1]=m,c.set(this.bboxes,m),m+=this.bboxes.length,c.buffer}static serialize(e,n){const o=e.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(e){return new $o(e.buffer)}}const Pn={};function ft(i,e,n={}){if(Pn[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Pn[i]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}ft("Object",Object),ft("TransferableGridIndex",$o),ft("Color",Ri),ft("Error",Error),ft("AJAXError",nt),ft("ResolvedImage",Wn),ft("StylePropertyFunction",Ms),ft("StyleExpression",ks,{omit:["_evaluator"]}),ft("ZoomDependentExpression",Jo),ft("ZoomConstantExpression",Es),ft("CompoundExpression",Tr,{omit:["_evaluate"]});for(const i in fs)fs[i]._classRegistryKey||ft(`Expression_${i}`,fs[i]);function ao(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Xr(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(ao(i)||Rn(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const n=i;return e&&e.push(n.buffer),n}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const n=[];for(const o of i)n.push(Xr(o,e));return n}if(typeof i=="object"){const n=i.constructor,o=n._classRegistryKey;if(!o)throw new Error("can't serialize object of unregistered class");if(!Pn[o])throw new Error(`${o} is not registered.`);const c=n.serialize?n.serialize(i,e):{};if(n.serialize){if(e&&c===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in i){if(!i.hasOwnProperty(m)||Pn[o].omit.indexOf(m)>=0)continue;const g=i[m];c[m]=Pn[o].shallow.indexOf(m)>=0?g:Xr(g,e)}i instanceof Error&&(c.message=i.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(c.$name=o),c}throw new Error("can't serialize object of type "+typeof i)}function Oo(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||ao(i)||Rn(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Oo);if(typeof i=="object"){const e=i.$name||"Object";if(!Pn[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=Pn[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(i);const o=Object.create(n.prototype);for(const c of Object.keys(i)){if(c==="$name")continue;const m=i[c];o[c]=Pn[e].shallow.indexOf(c)>=0?m:Oo(m)}return o}throw new Error("can't deserialize object of type "+typeof i)}class gs{constructor(){this.first=!0}update(e,n){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const at={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Fa(i){for(const e of i)if(zs(e.charCodeAt(0)))return!0;return!1}function Ls(i){for(const e of i)if(!tl(e.charCodeAt(0)))return!1;return!0}function tl(i){return!(at.Arabic(i)||at["Arabic Supplement"](i)||at["Arabic Extended-A"](i)||at["Arabic Presentation Forms-A"](i)||at["Arabic Presentation Forms-B"](i))}function zs(i){return!(i!==746&&i!==747&&(i<4352||!(at["Bopomofo Extended"](i)||at.Bopomofo(i)||at["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||at["CJK Compatibility Ideographs"](i)||at["CJK Compatibility"](i)||at["CJK Radicals Supplement"](i)||at["CJK Strokes"](i)||!(!at["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||at["CJK Unified Ideographs Extension A"](i)||at["CJK Unified Ideographs"](i)||at["Enclosed CJK Letters and Months"](i)||at["Hangul Compatibility Jamo"](i)||at["Hangul Jamo Extended-A"](i)||at["Hangul Jamo Extended-B"](i)||at["Hangul Jamo"](i)||at["Hangul Syllables"](i)||at.Hiragana(i)||at["Ideographic Description Characters"](i)||at.Kanbun(i)||at["Kangxi Radicals"](i)||at["Katakana Phonetic Extensions"](i)||at.Katakana(i)&&i!==12540||!(!at["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!at["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||at["Unified Canadian Aboriginal Syllabics"](i)||at["Unified Canadian Aboriginal Syllabics Extended"](i)||at["Vertical Forms"](i)||at["Yijing Hexagram Symbols"](i)||at["Yi Syllables"](i)||at["Yi Radicals"](i))))}function Ys(i){return!(zs(i)||function(e){return!!(at["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||at["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||at["Letterlike Symbols"](e)||at["Number Forms"](e)||at["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||at["Control Pictures"](e)&&e!==9251||at["Optical Character Recognition"](e)||at["Enclosed Alphanumerics"](e)||at["Geometric Shapes"](e)||at["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||at["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||at["CJK Symbols and Punctuation"](e)||at.Katakana(e)||at["Private Use Area"](e)||at["CJK Compatibility Forms"](e)||at["Small Form Variants"](e)||at["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function il(i){return i>=1424&&i<=2303||at["Arabic Presentation Forms-A"](i)||at["Arabic Presentation Forms-B"](i)}function Qs(i,e){return!(!e&&il(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||at.Khmer(i))}function Ra(i){for(const e of i)if(il(e.charCodeAt(0)))return!0;return!1}const Yl="deferred",Ql="loading",$l="loaded";let ec=null,Kr="unavailable",Ds=null;const nl=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Kr="error"),ec&&ec(i)};function tc(){rl.fire(new Zr("pluginStateChange",{pluginStatus:Kr,pluginURL:Ds}))}const rl=new Zn,ic=function(){return Kr},Yc=function(){if(Kr!==Yl||!Ds)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Kr=Ql,tc(),Ds&&Je({url:Ds},i=>{i?nl(i):(Kr=$l,tc())})},lo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Kr===$l||lo.applyArabicShaping!=null,isLoading:()=>Kr===Ql,setState(i){if(!At())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Kr=i.pluginStatus,Ds=i.pluginURL},isParsed(){if(!At())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return lo.applyArabicShaping!=null&&lo.processBidirectionalText!=null&&lo.processStyledBidirectionalText!=null},getPluginURL(){if(!At())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Ds}};class pn{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new gs,this.transition={})}isSupportedScript(e){return function(n,o){for(const c of n)if(!Qs(c.charCodeAt(0),o))return!1;return!0}(e,lo.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class Il{constructor(e,n){this.property=e,this.value=n,this.expression=function(o,c){if(hn(o))return new Ms(o,c);if(oo(o)){const m=Ea(o,c);if(m.result==="error")throw new Error(m.value.map(g=>`${g.key}: ${g.message}`).join(", "));return m.value}{let m=o;return c.type==="color"&&typeof o=="string"?m=Ri.parse(o):c.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(o)&&(m=Gn.parse(o)):m=lr.parse(o),{kind:"constant",evaluate:()=>m}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,o){return this.property.possiblyEvaluate(this,e,n,o)}}class nc{constructor(e){this.property=e,this.value=new Il(e,void 0)}transitioned(e,n){return new $c(this.property,this.value,n,Dt({},e.transition,this.transition),e.now)}untransitioned(){return new $c(this.property,this.value,null,{},0)}}class Qc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return $e(this._values[e].value.value)}setValue(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new nc(this._values[e].property)),this._values[e].value=new Il(this._values[e].property,n===null?void 0:$e(n))}getTransition(e){return $e(this._values[e].transition)}setTransition(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new nc(this._values[e].property)),this._values[e].transition=$e(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o);const c=this.getTransition(n);c!==void 0&&(e[`${n}-transition`]=c)}return e}transitioned(e,n){const o=new eu(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(e,n._values[c]);return o}untransitioned(){const e=new eu(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class $c{constructor(e,n,o,c,m){this.property=e,this.value=n,this.begin=m+c.delay||0,this.end=this.begin+c.duration||0,e.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(e,n,o){const c=e.now||0,m=this.value.possiblyEvaluate(e,n,o),g=this.prior;if(g){if(c>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(c<this.begin)return g.possiblyEvaluate(e,n,o);{const b=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,n,o),m,function(T){if(T<=0)return 0;if(T>=1)return 1;const C=T*T,P=C*T;return 4*(T<.5?P:3*(T-C)+P-.75)}(b))}}return m}}class eu{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,o){const c=new Cl(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(e,n,o);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Nu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return $e(this._values[e].value)}setValue(e,n){this._values[e]=new Il(this._values[e].property,n===null?void 0:$e(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o)}return e}possiblyEvaluate(e,n,o){const c=new Cl(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(e,n,o);return c}}class Or{constructor(e,n,o){this.property=e,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,o,c){return this.property.evaluate(this.value,this.parameters,e,n,o,c)}}class Cl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ot{constructor(e){this.specification=e}possiblyEvaluate(e,n){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(n)}interpolate(e,n,o){const c=_r[this.specification.type];return c?c(e,n,o):e}}class Ht{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,o,c){return new Or(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},o,c)}:e.expression,n)}interpolate(e,n,o){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Or(this,{kind:"constant",value:void 0},e.parameters);const c=_r[this.specification.type];if(c){const m=c(e.value.value,n.value.value,o);return new Or(this,{kind:"constant",value:m},e.parameters)}return e}evaluate(e,n,o,c,m,g){return e.kind==="constant"?e.value:e.evaluate(n,o,c,m,g)}}class ol extends Ht{possiblyEvaluate(e,n,o,c){if(e.value===void 0)return new Or(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const m=e.expression.evaluate(n,null,{},o,c),g=e.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,b=this._calculate(g,g,g,n);return new Or(this,{kind:"constant",value:b},n)}if(e.expression.kind==="camera"){const m=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new Or(this,{kind:"constant",value:m},n)}return new Or(this,e.expression,n)}evaluate(e,n,o,c,m,g){if(e.kind==="source"){const b=e.evaluate(n,o,c,m,g);return this._calculate(b,b,b,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},o,c),e.evaluate({zoom:Math.floor(n.zoom)},o,c),e.evaluate({zoom:Math.floor(n.zoom)+1},o,c),n):e.value}_calculate(e,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:o,to:n}}interpolate(e){return e}}class rc{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const m=e.expression.evaluate(n,null,{},o,c);return this._calculate(m,m,m,n)}return this._calculate(e.expression.evaluate(new pn(Math.floor(n.zoom-1),n)),e.expression.evaluate(new pn(Math.floor(n.zoom),n)),e.expression.evaluate(new pn(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:o,to:n}}interpolate(e){return e}}class oc{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,c){return!!e.expression.evaluate(n,null,{},o,c)}interpolate(){return!1}}class Vn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const o=e[n];o.specification.overridable&&this.overridableProperties.push(n);const c=this.defaultPropertyValues[n]=new Il(o,void 0),m=this.defaultTransitionablePropertyValues[n]=new nc(o);this.defaultTransitioningPropertyValues[n]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=c.possiblyEvaluate({})}}}ft("DataDrivenProperty",Ht),ft("DataConstantProperty",Ot),ft("CrossFadedDataDrivenProperty",ol),ft("CrossFadedProperty",rc),ft("ColorRampProperty",oc);const sc="-transition";class Mo extends Zn{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new Nu(n.layout)),n.paint)){this._transitionablePaint=new Qc(n.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Cl(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,o={}){n!=null&&this._validate(Js,`layers.${this.id}.layout.${e}`,e,n,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return e.endsWith(sc)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,o={}){if(n!=null&&this._validate(Vi,`layers.${this.id}.paint.${e}`,e,n,o))return!1;if(e.endsWith(sc))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const c=this._transitionablePaint._values[e],m=c.property.specification["property-type"]==="cross-faded-data-driven",g=c.value.isDataDriven(),b=c.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const T=this._transitionablePaint._values[e].value;return T.isDataDriven()||g||m||this._handleOverridablePaintPropertyUpdate(e,b,T)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,n,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Fe(e,(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(e,n,o,c,m={}){return(!m||m.validate!==!1)&&so(this,e.call(Ro,{key:n,layerType:this.type,objectKey:o,value:c,styleSpec:Me,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Or&&Ho(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const tu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class $s{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class En{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Tn(i,e=1){let n=0,o=0;return{members:i.map(c=>{const m=tu[c.type].BYTES_PER_ELEMENT,g=n=Oa(n,Math.max(e,m)),b=c.components||1;return o=Math.max(o,m),n+=m*b,{name:c.name,type:c.type,components:b,offset:g}}),size:Oa(n,Math.max(o,e)),alignment:e}}function Oa(i,e){return Math.ceil(i/e)*e}class sl extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.int16[c+0]=n,this.int16[c+1]=o,e}}sl.prototype.bytesPerElement=4,ft("StructArrayLayout2i4",sl);class al extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const m=3*e;return this.int16[m+0]=n,this.int16[m+1]=o,this.int16[m+2]=c,e}}al.prototype.bytesPerElement=6,ft("StructArrayLayout3i6",al);class ea extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,o,c)}emplace(e,n,o,c,m){const g=4*e;return this.int16[g+0]=n,this.int16[g+1]=o,this.int16[g+2]=c,this.int16[g+3]=m,e}}ea.prototype.bytesPerElement=8,ft("StructArrayLayout4i8",ea);class ac extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,o,c,m,g)}emplace(e,n,o,c,m,g,b){const T=6*e;return this.int16[T+0]=n,this.int16[T+1]=o,this.int16[T+2]=c,this.int16[T+3]=m,this.int16[T+4]=g,this.int16[T+5]=b,e}}ac.prototype.bytesPerElement=12,ft("StructArrayLayout2i4i12",ac);class lc extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,o,c,m,g)}emplace(e,n,o,c,m,g,b){const T=4*e,C=8*e;return this.int16[T+0]=n,this.int16[T+1]=o,this.uint8[C+4]=c,this.uint8[C+5]=m,this.uint8[C+6]=g,this.uint8[C+7]=b,e}}lc.prototype.bytesPerElement=8,ft("StructArrayLayout2i4ub8",lc);class Ba extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.float32[c+0]=n,this.float32[c+1]=o,e}}Ba.prototype.bytesPerElement=8,ft("StructArrayLayout2f8",Ba);class cc extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m,g,b,T,C,P){const F=this.length;return this.resize(F+1),this.emplace(F,e,n,o,c,m,g,b,T,C,P)}emplace(e,n,o,c,m,g,b,T,C,P,F){const O=10*e;return this.uint16[O+0]=n,this.uint16[O+1]=o,this.uint16[O+2]=c,this.uint16[O+3]=m,this.uint16[O+4]=g,this.uint16[O+5]=b,this.uint16[O+6]=T,this.uint16[O+7]=C,this.uint16[O+8]=P,this.uint16[O+9]=F,e}}cc.prototype.bytesPerElement=20,ft("StructArrayLayout10ui20",cc);class uc extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m,g,b,T,C,P,F,O){const U=this.length;return this.resize(U+1),this.emplace(U,e,n,o,c,m,g,b,T,C,P,F,O)}emplace(e,n,o,c,m,g,b,T,C,P,F,O,U){const j=12*e;return this.int16[j+0]=n,this.int16[j+1]=o,this.int16[j+2]=c,this.int16[j+3]=m,this.uint16[j+4]=g,this.uint16[j+5]=b,this.uint16[j+6]=T,this.uint16[j+7]=C,this.int16[j+8]=P,this.int16[j+9]=F,this.int16[j+10]=O,this.int16[j+11]=U,e}}uc.prototype.bytesPerElement=24,ft("StructArrayLayout4i4ui4i24",uc);class Ui extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const m=3*e;return this.float32[m+0]=n,this.float32[m+1]=o,this.float32[m+2]=c,e}}Ui.prototype.bytesPerElement=12,ft("StructArrayLayout3f12",Ui);class f extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}f.prototype.bytesPerElement=4,ft("StructArrayLayout1ul4",f);class t extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m,g,b,T,C){const P=this.length;return this.resize(P+1),this.emplace(P,e,n,o,c,m,g,b,T,C)}emplace(e,n,o,c,m,g,b,T,C,P){const F=10*e,O=5*e;return this.int16[F+0]=n,this.int16[F+1]=o,this.int16[F+2]=c,this.int16[F+3]=m,this.int16[F+4]=g,this.int16[F+5]=b,this.uint32[O+3]=T,this.uint16[F+8]=C,this.uint16[F+9]=P,e}}t.prototype.bytesPerElement=20,ft("StructArrayLayout6i1ul2ui20",t);class r extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,o,c,m,g)}emplace(e,n,o,c,m,g,b){const T=6*e;return this.int16[T+0]=n,this.int16[T+1]=o,this.int16[T+2]=c,this.int16[T+3]=m,this.int16[T+4]=g,this.int16[T+5]=b,e}}r.prototype.bytesPerElement=12,ft("StructArrayLayout2i2i2i12",r);class l extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,o,c,m)}emplace(e,n,o,c,m,g){const b=4*e,T=8*e;return this.float32[b+0]=n,this.float32[b+1]=o,this.float32[b+2]=c,this.int16[T+6]=m,this.int16[T+7]=g,e}}l.prototype.bytesPerElement=16,ft("StructArrayLayout2f1f2i16",l);class u extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,o,c)}emplace(e,n,o,c,m){const g=12*e,b=3*e;return this.uint8[g+0]=n,this.uint8[g+1]=o,this.float32[b+1]=c,this.float32[b+2]=m,e}}u.prototype.bytesPerElement=12,ft("StructArrayLayout2ub2f12",u);class _ extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const m=3*e;return this.uint16[m+0]=n,this.uint16[m+1]=o,this.uint16[m+2]=c,e}}_.prototype.bytesPerElement=6,ft("StructArrayLayout3ui6",_);class x extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m,g,b,T,C,P,F,O,U,j,W,ee,re){const fe=this.length;return this.resize(fe+1),this.emplace(fe,e,n,o,c,m,g,b,T,C,P,F,O,U,j,W,ee,re)}emplace(e,n,o,c,m,g,b,T,C,P,F,O,U,j,W,ee,re,fe){const oe=24*e,ve=12*e,Ie=48*e;return this.int16[oe+0]=n,this.int16[oe+1]=o,this.uint16[oe+2]=c,this.uint16[oe+3]=m,this.uint32[ve+2]=g,this.uint32[ve+3]=b,this.uint32[ve+4]=T,this.uint16[oe+10]=C,this.uint16[oe+11]=P,this.uint16[oe+12]=F,this.float32[ve+7]=O,this.float32[ve+8]=U,this.uint8[Ie+36]=j,this.uint8[Ie+37]=W,this.uint8[Ie+38]=ee,this.uint32[ve+10]=re,this.int16[oe+22]=fe,e}}x.prototype.bytesPerElement=48,ft("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",x);class w extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m,g,b,T,C,P,F,O,U,j,W,ee,re,fe,oe,ve,Ie,Ne,yt,Ct,gt,pt,ot,St){const lt=this.length;return this.resize(lt+1),this.emplace(lt,e,n,o,c,m,g,b,T,C,P,F,O,U,j,W,ee,re,fe,oe,ve,Ie,Ne,yt,Ct,gt,pt,ot,St)}emplace(e,n,o,c,m,g,b,T,C,P,F,O,U,j,W,ee,re,fe,oe,ve,Ie,Ne,yt,Ct,gt,pt,ot,St,lt){const Xe=32*e,Vt=16*e;return this.int16[Xe+0]=n,this.int16[Xe+1]=o,this.int16[Xe+2]=c,this.int16[Xe+3]=m,this.int16[Xe+4]=g,this.int16[Xe+5]=b,this.int16[Xe+6]=T,this.int16[Xe+7]=C,this.uint16[Xe+8]=P,this.uint16[Xe+9]=F,this.uint16[Xe+10]=O,this.uint16[Xe+11]=U,this.uint16[Xe+12]=j,this.uint16[Xe+13]=W,this.uint16[Xe+14]=ee,this.uint16[Xe+15]=re,this.uint16[Xe+16]=fe,this.uint16[Xe+17]=oe,this.uint16[Xe+18]=ve,this.uint16[Xe+19]=Ie,this.uint16[Xe+20]=Ne,this.uint16[Xe+21]=yt,this.uint16[Xe+22]=Ct,this.uint32[Vt+12]=gt,this.float32[Vt+13]=pt,this.float32[Vt+14]=ot,this.uint16[Xe+30]=St,this.uint16[Xe+31]=lt,e}}w.prototype.bytesPerElement=64,ft("StructArrayLayout8i15ui1ul2f2ui64",w);class I extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}I.prototype.bytesPerElement=4,ft("StructArrayLayout1f4",I);class A extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const m=3*e;return this.uint16[6*e+0]=n,this.float32[m+1]=o,this.float32[m+2]=c,e}}A.prototype.bytesPerElement=12,ft("StructArrayLayout1ui2f12",A);class L extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const m=4*e;return this.uint32[2*e+0]=n,this.uint16[m+2]=o,this.uint16[m+3]=c,e}}L.prototype.bytesPerElement=8,ft("StructArrayLayout1ul2ui8",L);class z extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.uint16[c+0]=n,this.uint16[c+1]=o,e}}z.prototype.bytesPerElement=4,ft("StructArrayLayout2ui4",z);class N extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}N.prototype.bytesPerElement=2,ft("StructArrayLayout1ui2",N);class X extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,o,c)}emplace(e,n,o,c,m){const g=4*e;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=c,this.float32[g+3]=m,e}}X.prototype.bytesPerElement=16,ft("StructArrayLayout4f16",X);class H extends $s{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ce(this.anchorPointX,this.anchorPointY)}}H.prototype.size=20;class J extends t{get(e){return new H(this,e)}}ft("CollisionBoxArray",J);class G extends $s{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}G.prototype.size=48;class de extends x{get(e){return new G(this,e)}}ft("PlacedSymbolArray",de);class Se extends $s{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Se.prototype.size=64;class ie extends w{get(e){return new Se(this,e)}}ft("SymbolInstanceArray",ie);class pe extends I{getoffsetX(e){return this.float32[1*e+0]}}ft("GlyphOffsetArray",pe);class Ce extends al{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}ft("SymbolLineVertexArray",Ce);class ke extends $s{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ke.prototype.size=12;class Be extends A{get(e){return new ke(this,e)}}ft("TextAnchorOffsetArray",Be);class We extends $s{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}We.prototype.size=8;class je extends L{get(e){return new We(this,e)}}ft("FeatureIndexArray",je);class et extends sl{}class It extends sl{}class yi extends sl{}class dt extends ac{}class Xt extends lc{}class Mt extends Ba{}class Ki extends cc{}class mi extends uc{}class ai extends Ui{}class vi extends f{}class Ln extends r{}class sn extends u{}class yr extends _{}class Qn extends z{}const Un=Tn([{name:"a_pos",components:2,type:"Int16"}],4),{members:co}=Un;class fn{constructor(e=[]){this.segments=e}prepareSegment(e,n,o,c){let m=this.segments[this.segments.length-1];return e>fn.MAX_VERTEX_ARRAY_LENGTH&&rt(`Max vertices per segment is ${fn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>fn.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==c)&&(m={vertexOffset:n.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},c!==void 0&&(m.sortKey=c),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,o,c){return new fn([{vertexOffset:e,primitiveOffset:n,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}function es(i,e){return 256*(i=xt(Math.floor(i),0,255))+xt(Math.floor(e),0,255)}fn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ft("SegmentVector",fn);const ts=Tn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Fs={exports:{}},ta={exports:{}};ta.exports=function(i,e){var n,o,c,m,g,b,T,C;for(o=i.length-(n=3&i.length),c=e,g=3432918353,b=461845907,C=0;C<o;)T=255&i.charCodeAt(C)|(255&i.charCodeAt(++C))<<8|(255&i.charCodeAt(++C))<<16|(255&i.charCodeAt(++C))<<24,++C,c=27492+(65535&(m=5*(65535&(c=(c^=T=(65535&(T=(T=(65535&T)*g+(((T>>>16)*g&65535)<<16)&4294967295)<<15|T>>>17))*b+(((T>>>16)*b&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(T=0,n){case 3:T^=(255&i.charCodeAt(C+2))<<16;case 2:T^=(255&i.charCodeAt(C+1))<<8;case 1:c^=T=(65535&(T=(T=(65535&(T^=255&i.charCodeAt(C)))*g+(((T>>>16)*g&65535)<<16)&4294967295)<<15|T>>>17))*b+(((T>>>16)*b&65535)<<16)&4294967295}return c^=i.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var Na=ta.exports,Mr={exports:{}};Mr.exports=function(i,e){for(var n,o=i.length,c=e^o,m=0;o>=4;)n=1540483477*(65535&(n=255&i.charCodeAt(m)|(255&i.charCodeAt(++m))<<8|(255&i.charCodeAt(++m))<<16|(255&i.charCodeAt(++m))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),o-=4,++m;switch(o){case 3:c^=(255&i.charCodeAt(m+2))<<16;case 2:c^=(255&i.charCodeAt(m+1))<<8;case 1:c=1540483477*(65535&(c^=255&i.charCodeAt(m)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var vr=Na,Br=Mr.exports;Fs.exports=vr,Fs.exports.murmur3=vr,Fs.exports.murmur2=Br;var ia=M(Fs.exports);class zn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,o,c){this.ids.push($n(e)),this.positions.push(n,o,c)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=$n(e);let o=0,c=this.ids.length-1;for(;o<c;){const g=o+c>>1;this.ids[g]>=n?c=g:o=g+1}const m=[];for(;this.ids[o]===n;)m.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return m}static serialize(e,n){const o=new Float64Array(e.ids),c=new Uint32Array(e.positions);return Jr(o,c,0,o.length-1),n&&n.push(o.buffer,c.buffer),{ids:o,positions:c}}static deserialize(e){const n=new zn;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function $n(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:ia(String(i))}function Jr(i,e,n,o){for(;n<o;){const c=i[n+o>>1];let m=n-1,g=o+1;for(;;){do m++;while(i[m]<c);do g--;while(i[g]>c);if(m>=g)break;Dn(i,m,g),Dn(e,3*m,3*g),Dn(e,3*m+1,3*g+1),Dn(e,3*m+2,3*g+2)}g-n<o-g?(Jr(i,e,n,g),n=g+1):(Jr(i,e,g+1,o),o=g)}}function Dn(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}ft("FeaturePositionMap",zn);class na{constructor(e,n){this.gl=e.gl,this.location=n}}class kl extends na{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class iu extends na{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class nu extends na{constructor(e,n){super(e,n),this.current=Ri.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Vu=new Float32Array(16);function hc(i){return[es(255*i.r,255*i.g),es(255*i.b,255*i.a)]}class is{constructor(e,n,o){this.value=e,this.uniformNames=n.map(c=>`u_${c}`),this.type=o}setUniform(e,n,o){e.set(o.constantOr(this.value))}getBinding(e,n,o){return this.type==="color"?new nu(e,n):new kl(e,n)}}class ra{constructor(e,n){this.uniformNames=n.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=e.tlbr}setUniform(e,n,o,c){const m=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&e.set(m)}getBinding(e,n,o){return o.substr(0,9)==="u_pattern"?new iu(e,n):new kl(e,n)}}class ns{constructor(e,n,o,c){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(m=>({name:`a_${m}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,o,c,m){const g=this.paintVertexArray.length,b=this.expression.evaluate(new pn(0),n,{},c,[],m);this.paintVertexArray.resize(e),this._setPaintValue(g,e,b)}updatePaintArray(e,n,o,c){const m=this.expression.evaluate({zoom:0},o,c);this._setPaintValue(e,n,m)}_setPaintValue(e,n,o){if(this.type==="color"){const c=hc(o);for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,c[0],c[1])}else{for(let c=e;c<n;c++)this.paintVertexArray.emplace(c,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ao{constructor(e,n,o,c,m,g){this.expression=e,this.uniformNames=n.map(b=>`u_${b}_t`),this.type=o,this.useIntegerZoom=c,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=n.map(b=>({name:`a_${b}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,n,o,c,m){const g=this.expression.evaluate(new pn(this.zoom),n,{},c,[],m),b=this.expression.evaluate(new pn(this.zoom+1),n,{},c,[],m),T=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(T,e,g,b)}updatePaintArray(e,n,o,c){const m=this.expression.evaluate({zoom:this.zoom},o,c),g=this.expression.evaluate({zoom:this.zoom+1},o,c);this._setPaintValue(e,n,m,g)}_setPaintValue(e,n,o,c){if(this.type==="color"){const m=hc(o),g=hc(c);for(let b=e;b<n;b++)this.paintVertexArray.emplace(b,m[0],m[1],g[0],g[1])}else{for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,c=xt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,n,o){return new kl(e,n)}}class rs{constructor(e,n,o,c,m,g){this.expression=e,this.type=n,this.useIntegerZoom=o,this.zoom=c,this.layerId=g,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(e,n,o){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(e,n,o,c,m){this._setPaintValues(e,n,o.patterns&&o.patterns[this.layerId],m)}_setPaintValues(e,n,o,c){if(!c||!o)return;const{min:m,mid:g,max:b}=o,T=c[m],C=c[g],P=c[b];if(T&&C&&P)for(let F=e;F<n;F++)this.zoomInPaintVertexArray.emplace(F,C.tl[0],C.tl[1],C.br[0],C.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],C.pixelRatio,T.pixelRatio),this.zoomOutPaintVertexArray.emplace(F,C.tl[0],C.tl[1],C.br[0],C.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],C.pixelRatio,P.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,ts.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,ts.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class dc{constructor(e,n,o){this.binders={},this._buffers=[];const c=[];for(const m in e.paint._values){if(!o(m))continue;const g=e.paint.get(m);if(!(g instanceof Or&&Ho(g.property.specification)))continue;const b=Kf(m,e.type),T=g.value,C=g.property.specification.type,P=g.property.useIntegerZoom,F=g.property.specification["property-type"],O=F==="cross-faded"||F==="cross-faded-data-driven";if(T.kind==="constant")this.binders[m]=O?new ra(T.value,b):new is(T.value,b,C),c.push(`/u_${m}`);else if(T.kind==="source"||O){const U=$h(m,C,"source");this.binders[m]=O?new rs(T,C,P,n,U,e.id):new ns(T,b,C,U),c.push(`/a_${m}`)}else{const U=$h(m,C,"composite");this.binders[m]=new Ao(T,b,C,P,n,U),c.push(`/z_${m}`)}}this.cacheKey=c.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof ns||n instanceof Ao?n.maxValue:0}populatePaintArrays(e,n,o,c,m){for(const g in this.binders){const b=this.binders[g];(b instanceof ns||b instanceof Ao||b instanceof rs)&&b.populatePaintArray(e,n,o,c,m)}}setConstantPatternPositions(e,n){for(const o in this.binders){const c=this.binders[o];c instanceof ra&&c.setConstantPatternPositions(e,n)}}updatePaintArrays(e,n,o,c,m){let g=!1;for(const b in e){const T=n.getPositions(b);for(const C of T){const P=o.feature(C.index);for(const F in this.binders){const O=this.binders[F];if((O instanceof ns||O instanceof Ao||O instanceof rs)&&O.expression.isStateDependent===!0){const U=c.paint.get(F);O.expression=U.value,O.updatePaintArray(C.start,C.end,P,e[b],m),g=!0}}}}return g}defines(){const e=[];for(const n in this.binders){const o=this.binders[n];(o instanceof is||o instanceof ra)&&e.push(...o.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof ns||o instanceof Ao)for(let c=0;c<o.paintVertexAttributes.length;c++)e.push(o.paintVertexAttributes[c].name);else if(o instanceof rs)for(let c=0;c<ts.members.length;c++)e.push(ts.members[c].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof is||o instanceof ra||o instanceof Ao)for(const c of o.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const o=[];for(const c in this.binders){const m=this.binders[c];if(m instanceof is||m instanceof ra||m instanceof Ao){for(const g of m.uniformNames)if(n[g]){const b=m.getBinding(e,n[g],g);o.push({name:g,property:c,binding:b})}}}return o}setUniforms(e,n,o,c){for(const{name:m,property:g,binding:b}of n)this.binders[g].setUniform(b,c,o.get(g),m)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(e&&o instanceof rs){const c=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(o instanceof ns||o instanceof Ao)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const n in this.binders){const o=this.binders[n];(o instanceof ns||o instanceof Ao||o instanceof rs)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof ns||n instanceof Ao||n instanceof rs)&&n.destroy()}}}class ys{constructor(e,n,o=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new dc(c,n,o);this.needsUpload=!1,this._featureMap=new zn,this._bufferOffset=0}populatePaintArrays(e,n,o,c,m,g){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,n,c,m,g);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,o,c){for(const m of o)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,n,m,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Kf(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function $h(i,e,n){const o={color:{source:Ba,composite:X},number:{source:I,composite:Ba}},c=function(m){return{"line-pattern":{source:Ki,composite:Ki},"fill-pattern":{source:Ki,composite:Ki},"fill-extrusion-pattern":{source:Ki,composite:Ki}}[m]}(i);return c&&c[n]||o[e][n]}ft("ConstantBinder",is),ft("CrossFadedConstantBinder",ra),ft("SourceExpressionBinder",ns),ft("CrossFadedCompositeBinder",rs),ft("CompositeExpressionBinder",Ao),ft("ProgramConfiguration",dc,{omit:["_buffers"]}),ft("ProgramConfigurationSet",ys);const Hn=8192,Uu=Math.pow(2,14)-1,ed=-Uu-1;function ll(i){const e=Hn/i.extent,n=i.loadGeometry();for(let o=0;o<n.length;o++){const c=n[o];for(let m=0;m<c.length;m++){const g=c[m],b=Math.round(g.x*e),T=Math.round(g.y*e);g.x=xt(b,ed,Uu),g.y=xt(T,ed,Uu),(b<g.x||b>g.x+1||T<g.y||T>g.y+1)&&rt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function cl(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?ll(i):[]}}function ru(i,e,n,o,c){i.emplaceBack(2*e+(o+1)/2,2*n+(c+1)/2)}class ju{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new It,this.indexArray=new yr,this.segments=new fn,this.programConfigurations=new ys(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){const c=this.layers[0],m=[];let g=null,b=!1;c.type==="circle"&&(g=c.layout.get("circle-sort-key"),b=!g.isConstant());for(const{feature:T,id:C,index:P,sourceLayerIndex:F}of e){const O=this.layers[0]._featureFilter.needGeometry,U=cl(T,O);if(!this.layers[0]._featureFilter.filter(new pn(this.zoom),U,o))continue;const j=b?g.evaluate(U,{},o):void 0,W={id:C,properties:T.properties,type:T.type,sourceLayerIndex:F,index:P,geometry:O?U.geometry:ll(T),patterns:{},sortKey:j};m.push(W)}b&&m.sort((T,C)=>T.sortKey-C.sortKey);for(const T of m){const{geometry:C,index:P,sourceLayerIndex:F}=T,O=e[P].feature;this.addFeature(T,C,P,o),n.featureIndex.insert(O,C,P,F,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,co),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,o,c){for(const m of n)for(const g of m){const b=g.x,T=g.y;if(b<0||b>=Hn||T<0||T>=Hn)continue;const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=C.vertexLength;ru(this.layoutVertexArray,b,T,-1,-1),ru(this.layoutVertexArray,b,T,1,-1),ru(this.layoutVertexArray,b,T,1,1),ru(this.layoutVertexArray,b,T,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+3,P+2),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},c)}}function td(i,e){for(let n=0;n<i.length;n++)if(El(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(El(i,e[n]))return!0;return!!qu(i,e)}function Jf(i,e,n){return!!El(i,e)||!!Zu(e,i,n)}function id(i,e){if(i.length===1)return rd(e,i[0]);for(let n=0;n<e.length;n++){const o=e[n];for(let c=0;c<o.length;c++)if(El(i,o[c]))return!0}for(let n=0;n<i.length;n++)if(rd(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(qu(i,e[n]))return!0;return!1}function Yf(i,e,n){if(i.length>1){if(qu(i,e))return!0;for(let o=0;o<e.length;o++)if(Zu(e[o],i,n))return!0}for(let o=0;o<i.length;o++)if(Zu(i[o],e,n))return!0;return!1}function qu(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){const o=i[n],c=i[n+1];for(let m=0;m<e.length-1;m++)if(Qf(o,c,e[m],e[m+1]))return!0}return!1}function Qf(i,e,n,o){return Qt(i,n,o)!==Qt(e,n,o)&&Qt(i,e,n)!==Qt(i,e,o)}function Zu(i,e,n){const o=n*n;if(e.length===1)return i.distSqr(e[0])<o;for(let c=1;c<e.length;c++)if(nd(i,e[c-1],e[c])<o)return!0;return!1}function nd(i,e,n){const o=e.distSqr(n);if(o===0)return i.distSqr(e);const c=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/o;return i.distSqr(c<0?e:c>1?n:n.sub(e)._mult(c)._add(e))}function rd(i,e){let n,o,c,m=!1;for(let g=0;g<i.length;g++){n=i[g];for(let b=0,T=n.length-1;b<n.length;T=b++)o=n[b],c=n[T],o.y>e.y!=c.y>e.y&&e.x<(c.x-o.x)*(e.y-o.y)/(c.y-o.y)+o.x&&(m=!m)}return m}function El(i,e){let n=!1;for(let o=0,c=i.length-1;o<i.length;c=o++){const m=i[o],g=i[c];m.y>e.y!=g.y>e.y&&e.x<(g.x-m.x)*(e.y-m.y)/(g.y-m.y)+m.x&&(n=!n)}return n}function $f(i,e,n){const o=n[0],c=n[2];if(i.x<o.x&&e.x<o.x||i.x>c.x&&e.x>c.x||i.y<o.y&&e.y<o.y||i.y>c.y&&e.y>c.y)return!1;const m=Qt(i,e,n[0]);return m!==Qt(i,e,n[1])||m!==Qt(i,e,n[2])||m!==Qt(i,e,n[3])}function pc(i,e,n){const o=e.paint.get(i).value;return o.kind==="constant"?o.value:n.programConfigurations.get(e.id).getMaxValue(i)}function ou(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function su(i,e,n,o,c){if(!e[0]&&!e[1])return i;const m=ce.convert(e)._mult(c);n==="viewport"&&m._rotate(-o);const g=[];for(let b=0;b<i.length;b++)g.push(i[b].sub(m));return g}let od,sd;ft("CircleBucket",ju,{omit:["layers"]});var em={get paint(){return sd=sd||new Vn({"circle-radius":new Ht(Me.paint_circle["circle-radius"]),"circle-color":new Ht(Me.paint_circle["circle-color"]),"circle-blur":new Ht(Me.paint_circle["circle-blur"]),"circle-opacity":new Ht(Me.paint_circle["circle-opacity"]),"circle-translate":new Ot(Me.paint_circle["circle-translate"]),"circle-translate-anchor":new Ot(Me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ot(Me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ot(Me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ht(Me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ht(Me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ht(Me.paint_circle["circle-stroke-opacity"])})},get layout(){return od=od||new Vn({"circle-sort-key":new Ht(Me.layout_circle["circle-sort-key"])})}},Yr=1e-6,Ml=typeof Float32Array<"u"?Float32Array:Array;function Gu(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function ad(i,e,n){var o=e[0],c=e[1],m=e[2],g=e[3],b=e[4],T=e[5],C=e[6],P=e[7],F=e[8],O=e[9],U=e[10],j=e[11],W=e[12],ee=e[13],re=e[14],fe=e[15],oe=n[0],ve=n[1],Ie=n[2],Ne=n[3];return i[0]=oe*o+ve*b+Ie*F+Ne*W,i[1]=oe*c+ve*T+Ie*O+Ne*ee,i[2]=oe*m+ve*C+Ie*U+Ne*re,i[3]=oe*g+ve*P+Ie*j+Ne*fe,i[4]=(oe=n[4])*o+(ve=n[5])*b+(Ie=n[6])*F+(Ne=n[7])*W,i[5]=oe*c+ve*T+Ie*O+Ne*ee,i[6]=oe*m+ve*C+Ie*U+Ne*re,i[7]=oe*g+ve*P+Ie*j+Ne*fe,i[8]=(oe=n[8])*o+(ve=n[9])*b+(Ie=n[10])*F+(Ne=n[11])*W,i[9]=oe*c+ve*T+Ie*O+Ne*ee,i[10]=oe*m+ve*C+Ie*U+Ne*re,i[11]=oe*g+ve*P+Ie*j+Ne*fe,i[12]=(oe=n[12])*o+(ve=n[13])*b+(Ie=n[14])*F+(Ne=n[15])*W,i[13]=oe*c+ve*T+Ie*O+Ne*ee,i[14]=oe*m+ve*C+Ie*U+Ne*re,i[15]=oe*g+ve*P+Ie*j+Ne*fe,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var fc,tm=ad;function au(i,e,n){var o=e[0],c=e[1],m=e[2],g=e[3];return i[0]=n[0]*o+n[4]*c+n[8]*m+n[12]*g,i[1]=n[1]*o+n[5]*c+n[9]*m+n[13]*g,i[2]=n[2]*o+n[6]*c+n[10]*m+n[14]*g,i[3]=n[3]*o+n[7]*c+n[11]*m+n[15]*g,i}fc=new Ml(4),Ml!=Float32Array&&(fc[0]=0,fc[1]=0,fc[2]=0,fc[3]=0);class im extends Mo{constructor(e){super(e,em)}createBucket(e){return new ju(e)}queryRadius(e){const n=e;return pc("circle-radius",this,n)+pc("circle-stroke-width",this,n)+ou(this.paint.get("circle-translate"))}queryIntersectsFeature(e,n,o,c,m,g,b,T){const C=su(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,b),P=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),F=this.paint.get("circle-pitch-alignment")==="map",O=F?C:function(j,W){return j.map(ee=>ld(ee,W))}(C,T),U=F?P*b:P;for(const j of c)for(const W of j){const ee=F?W:ld(W,T);let re=U;const fe=au([],[W.x,W.y,0,1],T);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?re*=fe[3]/g.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(re*=g.cameraToCenterDistance/fe[3]),Jf(O,ee,re))return!0}return!1}}function ld(i,e){const n=au([],[i.x,i.y,0,1],e);return new ce(n[0]/n[3],n[1]/n[3])}class cd extends ju{}let ud;ft("HeatmapBucket",cd,{omit:["layers"]});var nm={get paint(){return ud=ud||new Vn({"heatmap-radius":new Ht(Me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ht(Me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ot(Me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new oc(Me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ot(Me.paint_heatmap["heatmap-opacity"])})}};function Wu(i,{width:e,height:n},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*n*o)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${e*n*o}`)}else c=new Uint8Array(e*n*o);return i.width=e,i.height=n,i.data=c,i}function hd(i,{width:e,height:n},o){if(e===i.width&&n===i.height)return;const c=Wu({},{width:e,height:n},o);Hu(i,c,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,n)},o),i.width=e,i.height=n,i.data=c.data}function Hu(i,e,n,o,c,m){if(c.width===0||c.height===0)return e;if(c.width>i.width||c.height>i.height||n.x>i.width-c.width||n.y>i.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||o.x>e.width-c.width||o.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const g=i.data,b=e.data;if(g===b)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<c.height;T++){const C=((n.y+T)*i.width+n.x)*m,P=((o.y+T)*e.width+o.x)*m;for(let F=0;F<c.width*m;F++)b[P+F]=g[C+F]}return e}class mc{constructor(e,n){Wu(this,e,1,n)}resize(e){hd(this,e,1)}clone(){return new mc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,c,m){Hu(e,n,o,c,m,1)}}class Bo{constructor(e,n){Wu(this,e,4,n)}resize(e){hd(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Bo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,c,m){Hu(e,n,o,c,m,4)}}function dd(i){const e={},n=i.resolution||256,o=i.clips?i.clips.length:1,c=i.image||new Bo({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const m=(g,b,T)=>{e[i.evaluationKey]=T;const C=i.expression.evaluate(e);c.data[g+b+0]=Math.floor(255*C.r/C.a),c.data[g+b+1]=Math.floor(255*C.g/C.a),c.data[g+b+2]=Math.floor(255*C.b/C.a),c.data[g+b+3]=Math.floor(255*C.a)};if(i.clips)for(let g=0,b=0;g<o;++g,b+=4*n)for(let T=0,C=0;T<n;T++,C+=4){const P=T/(n-1),{start:F,end:O}=i.clips[g];m(b,C,F*(1-P)+O*P)}else for(let g=0,b=0;g<n;g++,b+=4)m(0,b,g/(n-1));return c}ft("AlphaImage",mc),ft("RGBAImage",Bo);class rm extends Mo{createBucket(e){return new cd(e)}constructor(e){super(e,nm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=dd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let pd;var om={get paint(){return pd=pd||new Vn({"hillshade-illumination-direction":new Ot(Me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ot(Me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ot(Me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ot(Me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ot(Me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ot(Me.paint_hillshade["hillshade-accent-color"])})}};class sm extends Mo{constructor(e){super(e,om)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const am=Tn([{name:"a_pos",components:2,type:"Int16"}],4),{members:lm}=am;var Xu={exports:{}};function lu(i,e,n){n=n||2;var o,c,m,g,b,T,C,P=e&&e.length,F=P?e[0]*n:i.length,O=fd(i,0,F,n,!0),U=[];if(!O||O.next===O.prev)return U;if(P&&(O=function(W,ee,re,fe){var oe,ve,Ie,Ne=[];for(oe=0,ve=ee.length;oe<ve;oe++)(Ie=fd(W,ee[oe]*fe,oe<ve-1?ee[oe+1]*fe:W.length,fe,!1))===Ie.next&&(Ie.steiner=!0),Ne.push(_m(Ie));for(Ne.sort(pm),oe=0;oe<Ne.length;oe++)re=fm(Ne[oe],re);return re}(i,e,O,n)),i.length>80*n){o=m=i[0],c=g=i[1];for(var j=n;j<F;j+=n)(b=i[j])<o&&(o=b),(T=i[j+1])<c&&(c=T),b>m&&(m=b),T>g&&(g=T);C=(C=Math.max(m-o,g-c))!==0?32767/C:0}return _c(O,U,n,o,c,C,0),U}function fd(i,e,n,o,c){var m,g;if(c===Yu(i,e,n,o)>0)for(m=e;m<n;m+=o)g=gd(m,i[m],i[m+1],g);else for(m=n-o;m>=e;m-=o)g=gd(m,i[m],i[m+1],g);return g&&cu(g,g.next)&&(yc(g),g=g.next),g}function ul(i,e){if(!i)return i;e||(e=i);var n,o=i;do if(n=!1,o.steiner||!cu(o,o.next)&&jn(o.prev,o,o.next)!==0)o=o.next;else{if(yc(o),(o=e=o.prev)===o.next)break;n=!0}while(n||o!==e);return e}function _c(i,e,n,o,c,m,g){if(i){!g&&m&&function(P,F,O,U){var j=P;do j.z===0&&(j.z=Ku(j.x,j.y,F,O,U)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next;while(j!==P);j.prevZ.nextZ=null,j.prevZ=null,function(W){var ee,re,fe,oe,ve,Ie,Ne,yt,Ct=1;do{for(re=W,W=null,ve=null,Ie=0;re;){for(Ie++,fe=re,Ne=0,ee=0;ee<Ct&&(Ne++,fe=fe.nextZ);ee++);for(yt=Ct;Ne>0||yt>0&&fe;)Ne!==0&&(yt===0||!fe||re.z<=fe.z)?(oe=re,re=re.nextZ,Ne--):(oe=fe,fe=fe.nextZ,yt--),ve?ve.nextZ=oe:W=oe,oe.prevZ=ve,ve=oe;re=fe}ve.nextZ=null,Ct*=2}while(Ie>1)}(j)}(i,o,c,m);for(var b,T,C=i;i.prev!==i.next;)if(b=i.prev,T=i.next,m?um(i,o,c,m):cm(i))e.push(b.i/n|0),e.push(i.i/n|0),e.push(T.i/n|0),yc(i),i=T.next,C=T.next;else if((i=T)===C){g?g===1?_c(i=hm(ul(i),e,n),e,n,o,c,m,2):g===2&&dm(i,e,n,o,c,m):_c(ul(i),e,n,o,c,m,1);break}}}function cm(i){var e=i.prev,n=i,o=i.next;if(jn(e,n,o)>=0)return!1;for(var c=e.x,m=n.x,g=o.x,b=e.y,T=n.y,C=o.y,P=c<m?c<g?c:g:m<g?m:g,F=b<T?b<C?b:C:T<C?T:C,O=c>m?c>g?c:g:m>g?m:g,U=b>T?b>C?b:C:T>C?T:C,j=o.next;j!==e;){if(j.x>=P&&j.x<=O&&j.y>=F&&j.y<=U&&Al(c,b,m,T,g,C,j.x,j.y)&&jn(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function um(i,e,n,o){var c=i.prev,m=i,g=i.next;if(jn(c,m,g)>=0)return!1;for(var b=c.x,T=m.x,C=g.x,P=c.y,F=m.y,O=g.y,U=b<T?b<C?b:C:T<C?T:C,j=P<F?P<O?P:O:F<O?F:O,W=b>T?b>C?b:C:T>C?T:C,ee=P>F?P>O?P:O:F>O?F:O,re=Ku(U,j,e,n,o),fe=Ku(W,ee,e,n,o),oe=i.prevZ,ve=i.nextZ;oe&&oe.z>=re&&ve&&ve.z<=fe;){if(oe.x>=U&&oe.x<=W&&oe.y>=j&&oe.y<=ee&&oe!==c&&oe!==g&&Al(b,P,T,F,C,O,oe.x,oe.y)&&jn(oe.prev,oe,oe.next)>=0||(oe=oe.prevZ,ve.x>=U&&ve.x<=W&&ve.y>=j&&ve.y<=ee&&ve!==c&&ve!==g&&Al(b,P,T,F,C,O,ve.x,ve.y)&&jn(ve.prev,ve,ve.next)>=0))return!1;ve=ve.nextZ}for(;oe&&oe.z>=re;){if(oe.x>=U&&oe.x<=W&&oe.y>=j&&oe.y<=ee&&oe!==c&&oe!==g&&Al(b,P,T,F,C,O,oe.x,oe.y)&&jn(oe.prev,oe,oe.next)>=0)return!1;oe=oe.prevZ}for(;ve&&ve.z<=fe;){if(ve.x>=U&&ve.x<=W&&ve.y>=j&&ve.y<=ee&&ve!==c&&ve!==g&&Al(b,P,T,F,C,O,ve.x,ve.y)&&jn(ve.prev,ve,ve.next)>=0)return!1;ve=ve.nextZ}return!0}function hm(i,e,n){var o=i;do{var c=o.prev,m=o.next.next;!cu(c,m)&&md(c,o,o.next,m)&&gc(c,m)&&gc(m,c)&&(e.push(c.i/n|0),e.push(o.i/n|0),e.push(m.i/n|0),yc(o),yc(o.next),o=i=m),o=o.next}while(o!==i);return ul(o)}function dm(i,e,n,o,c,m){var g=i;do{for(var b=g.next.next;b!==g.prev;){if(g.i!==b.i&&gm(g,b)){var T=_d(g,b);return g=ul(g,g.next),T=ul(T,T.next),_c(g,e,n,o,c,m,0),void _c(T,e,n,o,c,m,0)}b=b.next}g=g.next}while(g!==i)}function pm(i,e){return i.x-e.x}function fm(i,e){var n=function(c,m){var g,b=m,T=c.x,C=c.y,P=-1/0;do{if(C<=b.y&&C>=b.next.y&&b.next.y!==b.y){var F=b.x+(C-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(F<=T&&F>P&&(P=F,g=b.x<b.next.x?b:b.next,F===T))return g}b=b.next}while(b!==m);if(!g)return null;var O,U=g,j=g.x,W=g.y,ee=1/0;b=g;do T>=b.x&&b.x>=j&&T!==b.x&&Al(C<W?T:P,C,j,W,C<W?P:T,C,b.x,b.y)&&(O=Math.abs(C-b.y)/(T-b.x),gc(b,c)&&(O<ee||O===ee&&(b.x>g.x||b.x===g.x&&mm(g,b)))&&(g=b,ee=O)),b=b.next;while(b!==U);return g}(i,e);if(!n)return e;var o=_d(n,i);return ul(o,o.next),ul(n,n.next)}function mm(i,e){return jn(i.prev,i,e.prev)<0&&jn(e.next,i,i.next)<0}function Ku(i,e,n,o,c){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*c|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function _m(i){var e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function Al(i,e,n,o,c,m,g,b){return(c-g)*(e-b)>=(i-g)*(m-b)&&(i-g)*(o-b)>=(n-g)*(e-b)&&(n-g)*(m-b)>=(c-g)*(o-b)}function gm(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(n,o){var c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==o.i&&c.next.i!==o.i&&md(c,c.next,n,o))return!0;c=c.next}while(c!==n);return!1}(i,e)&&(gc(i,e)&&gc(e,i)&&function(n,o){var c=n,m=!1,g=(n.x+o.x)/2,b=(n.y+o.y)/2;do c.y>b!=c.next.y>b&&c.next.y!==c.y&&g<(c.next.x-c.x)*(b-c.y)/(c.next.y-c.y)+c.x&&(m=!m),c=c.next;while(c!==n);return m}(i,e)&&(jn(i.prev,i,e.prev)||jn(i,e.prev,e))||cu(i,e)&&jn(i.prev,i,i.next)>0&&jn(e.prev,e,e.next)>0)}function jn(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function cu(i,e){return i.x===e.x&&i.y===e.y}function md(i,e,n,o){var c=hu(jn(i,e,n)),m=hu(jn(i,e,o)),g=hu(jn(n,o,i)),b=hu(jn(n,o,e));return c!==m&&g!==b||!(c!==0||!uu(i,n,e))||!(m!==0||!uu(i,o,e))||!(g!==0||!uu(n,i,o))||!(b!==0||!uu(n,e,o))}function uu(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function hu(i){return i>0?1:i<0?-1:0}function gc(i,e){return jn(i.prev,i,i.next)<0?jn(i,e,i.next)>=0&&jn(i,i.prev,e)>=0:jn(i,e,i.prev)<0||jn(i,i.next,e)<0}function _d(i,e){var n=new Ju(i.i,i.x,i.y),o=new Ju(e.i,e.x,e.y),c=i.next,m=e.prev;return i.next=e,e.prev=i,n.next=c,c.prev=n,o.next=n,n.prev=o,m.next=o,o.prev=m,o}function gd(i,e,n,o){var c=new Ju(i,e,n);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function yc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Ju(i,e,n){this.i=i,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Yu(i,e,n,o){for(var c=0,m=e,g=n-o;m<n;m+=o)c+=(i[g]-i[m])*(i[m+1]+i[g+1]),g=m;return c}Xu.exports=lu,Xu.exports.default=lu,lu.deviation=function(i,e,n,o){var c=e&&e.length,m=Math.abs(Yu(i,0,c?e[0]*n:i.length,n));if(c)for(var g=0,b=e.length;g<b;g++)m-=Math.abs(Yu(i,e[g]*n,g<b-1?e[g+1]*n:i.length,n));var T=0;for(g=0;g<o.length;g+=3){var C=o[g]*n,P=o[g+1]*n,F=o[g+2]*n;T+=Math.abs((i[C]-i[F])*(i[P+1]-i[C+1])-(i[C]-i[P])*(i[F+1]-i[C+1]))}return m===0&&T===0?0:Math.abs((T-m)/m)},lu.flatten=function(i){for(var e=i[0][0].length,n={vertices:[],holes:[],dimensions:e},o=0,c=0;c<i.length;c++){for(var m=0;m<i[c].length;m++)for(var g=0;g<e;g++)n.vertices.push(i[c][m][g]);c>0&&n.holes.push(o+=i[c-1].length)}return n};var yd=M(Xu.exports);function ym(i,e,n,o,c){vd(i,e,n||0,o||i.length-1,c||vm)}function vd(i,e,n,o,c){for(;o>n;){if(o-n>600){var m=o-n+1,g=e-n+1,b=Math.log(m),T=.5*Math.exp(2*b/3),C=.5*Math.sqrt(b*T*(m-T)/m)*(g-m/2<0?-1:1);vd(i,e,Math.max(n,Math.floor(e-g*T/m+C)),Math.min(o,Math.floor(e+(m-g)*T/m+C)),c)}var P=i[e],F=n,O=o;for(vc(i,n,e),c(i[o],P)>0&&vc(i,n,o);F<O;){for(vc(i,F,O),F++,O--;c(i[F],P)<0;)F++;for(;c(i[O],P)>0;)O--}c(i[n],P)===0?vc(i,n,O):vc(i,++O,o),O<=e&&(n=O+1),e<=O&&(o=O-1)}}function vc(i,e,n){var o=i[e];i[e]=i[n],i[n]=o}function vm(i,e){return i<e?-1:i>e?1:0}function Qu(i,e){const n=i.length;if(n<=1)return[i];const o=[];let c,m;for(let g=0;g<n;g++){const b=Bt(i[g]);b!==0&&(i[g].area=Math.abs(b),m===void 0&&(m=b<0),m===b<0?(c&&o.push(c),c=[i[g]]):c.push(i[g]))}if(c&&o.push(c),e>1)for(let g=0;g<o.length;g++)o[g].length<=e||(ym(o[g],e,1,o[g].length-1,bm),o[g]=o[g].slice(0,e));return o}function bm(i,e){return e.area-i.area}function $u(i,e,n){const o=n.patternDependencies;let c=!1;for(const m of e){const g=m.paint.get(`${i}-pattern`);g.isConstant()||(c=!0);const b=g.constantOr(null);b&&(c=!0,o[b.to]=!0,o[b.from]=!0)}return c}function eh(i,e,n,o,c){const m=c.patternDependencies;for(const g of e){const b=g.paint.get(`${i}-pattern`).value;if(b.kind!=="constant"){let T=b.evaluate({zoom:o-1},n,{},c.availableImages),C=b.evaluate({zoom:o},n,{},c.availableImages),P=b.evaluate({zoom:o+1},n,{},c.availableImages);T=T&&T.name?T.name:T,C=C&&C.name?C.name:C,P=P&&P.name?P.name:P,m[T]=!0,m[C]=!0,m[P]=!0,n.patterns[g.id]={min:T,mid:C,max:P}}}return n}class th{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new yi,this.indexArray=new yr,this.indexArray2=new Qn,this.programConfigurations=new ys(e.layers,e.zoom),this.segments=new fn,this.segments2=new fn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){this.hasPattern=$u("fill",this.layers,n);const c=this.layers[0].layout.get("fill-sort-key"),m=!c.isConstant(),g=[];for(const{feature:b,id:T,index:C,sourceLayerIndex:P}of e){const F=this.layers[0]._featureFilter.needGeometry,O=cl(b,F);if(!this.layers[0]._featureFilter.filter(new pn(this.zoom),O,o))continue;const U=m?c.evaluate(O,{},o,n.availableImages):void 0,j={id:T,properties:b.properties,type:b.type,sourceLayerIndex:P,index:C,geometry:F?O.geometry:ll(b),patterns:{},sortKey:U};g.push(j)}m&&g.sort((b,T)=>b.sortKey-T.sortKey);for(const b of g){const{geometry:T,index:C,sourceLayerIndex:P}=b;if(this.hasPattern){const F=eh("fill",this.layers,b,this.zoom,n);this.patternFeatures.push(F)}else this.addFeature(b,T,C,o,{});n.featureIndex.insert(e[C].feature,T,C,P,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}addFeatures(e,n,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lm),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,o,c,m){for(const g of Qu(n,500)){let b=0;for(const U of g)b+=U.length;const T=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),C=T.vertexLength,P=[],F=[];for(const U of g){if(U.length===0)continue;U!==g[0]&&F.push(P.length/2);const j=this.segments2.prepareSegment(U.length,this.layoutVertexArray,this.indexArray2),W=j.vertexLength;this.layoutVertexArray.emplaceBack(U[0].x,U[0].y),this.indexArray2.emplaceBack(W+U.length-1,W),P.push(U[0].x),P.push(U[0].y);for(let ee=1;ee<U.length;ee++)this.layoutVertexArray.emplaceBack(U[ee].x,U[ee].y),this.indexArray2.emplaceBack(W+ee-1,W+ee),P.push(U[ee].x),P.push(U[ee].y);j.vertexLength+=U.length,j.primitiveLength+=U.length}const O=yd(P,F);for(let U=0;U<O.length;U+=3)this.indexArray.emplaceBack(C+O[U],C+O[U+1],C+O[U+2]);T.vertexLength+=b,T.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,m,c)}}let bd,xd;ft("FillBucket",th,{omit:["layers","patternFeatures"]});var xm={get paint(){return xd=xd||new Vn({"fill-antialias":new Ot(Me.paint_fill["fill-antialias"]),"fill-opacity":new Ht(Me.paint_fill["fill-opacity"]),"fill-color":new Ht(Me.paint_fill["fill-color"]),"fill-outline-color":new Ht(Me.paint_fill["fill-outline-color"]),"fill-translate":new Ot(Me.paint_fill["fill-translate"]),"fill-translate-anchor":new Ot(Me.paint_fill["fill-translate-anchor"]),"fill-pattern":new ol(Me.paint_fill["fill-pattern"])})},get layout(){return bd=bd||new Vn({"fill-sort-key":new Ht(Me.layout_fill["fill-sort-key"])})}};class wm extends Mo{constructor(e){super(e,xm)}recalculate(e,n){super.recalculate(e,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new th(e)}queryRadius(){return ou(this.paint.get("fill-translate"))}queryIntersectsFeature(e,n,o,c,m,g,b){return id(su(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,b),c)}isTileClipped(){return!0}}const Sm=Tn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Tm=Tn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Im}=Sm;var Va={},Cm=q,wd=Pl;function Pl(i,e,n,o,c){this.properties={},this.extent=n,this.type=0,this._pbf=i,this._geometry=-1,this._keys=o,this._values=c,i.readFields(km,this,e)}function km(i,e,n){i==1?e.id=n.readVarint():i==2?function(o,c){for(var m=o.readVarint()+o.pos;o.pos<m;){var g=c._keys[o.readVarint()],b=c._values[o.readVarint()];c.properties[g]=b}}(n,e):i==3?e.type=n.readVarint():i==4&&(e._geometry=n.pos)}function Em(i){for(var e,n,o=0,c=0,m=i.length,g=m-1;c<m;g=c++)o+=((n=i[g]).x-(e=i[c]).x)*(e.y+n.y);return o}Pl.types=["Unknown","Point","LineString","Polygon"],Pl.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,n=i.readVarint()+i.pos,o=1,c=0,m=0,g=0,b=[];i.pos<n;){if(c<=0){var T=i.readVarint();o=7&T,c=T>>3}if(c--,o===1||o===2)m+=i.readSVarint(),g+=i.readSVarint(),o===1&&(e&&b.push(e),e=[]),e.push(new Cm(m,g));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&b.push(e),b},Pl.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,n=1,o=0,c=0,m=0,g=1/0,b=-1/0,T=1/0,C=-1/0;i.pos<e;){if(o<=0){var P=i.readVarint();n=7&P,o=P>>3}if(o--,n===1||n===2)(c+=i.readSVarint())<g&&(g=c),c>b&&(b=c),(m+=i.readSVarint())<T&&(T=m),m>C&&(C=m);else if(n!==7)throw new Error("unknown command "+n)}return[g,T,b,C]},Pl.prototype.toGeoJSON=function(i,e,n){var o,c,m=this.extent*Math.pow(2,n),g=this.extent*i,b=this.extent*e,T=this.loadGeometry(),C=Pl.types[this.type];function P(U){for(var j=0;j<U.length;j++){var W=U[j];U[j]=[360*(W.x+g)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(W.y+b)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(o=0;o<T.length;o++)F[o]=T[o][0];P(T=F);break;case 2:for(o=0;o<T.length;o++)P(T[o]);break;case 3:for(T=function(U){var j=U.length;if(j<=1)return[U];for(var W,ee,re=[],fe=0;fe<j;fe++){var oe=Em(U[fe]);oe!==0&&(ee===void 0&&(ee=oe<0),ee===oe<0?(W&&re.push(W),W=[U[fe]]):W.push(U[fe]))}return W&&re.push(W),re}(T),o=0;o<T.length;o++)for(c=0;c<T[o].length;c++)P(T[o][c])}T.length===1?T=T[0]:C="Multi"+C;var O={type:"Feature",geometry:{type:C,coordinates:T},properties:this.properties};return"id"in this&&(O.id=this.id),O};var Mm=wd,Sd=Td;function Td(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Am,this,e),this.length=this._features.length}function Am(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push(function(o){for(var c=null,m=o.readVarint()+o.pos;o.pos<m;){var g=o.readVarint()>>3;c=g===1?o.readString():g===2?o.readFloat():g===3?o.readDouble():g===4?o.readVarint64():g===5?o.readVarint():g===6?o.readSVarint():g===7?o.readBoolean():null}return c}(n))}Td.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Mm(this._pbf,e,this.extent,this._keys,this._values)};var Pm=Sd;function Lm(i,e,n){if(i===3){var o=new Pm(n,n.readVarint()+n.pos);o.length&&(e[o.name]=o)}}Va.VectorTile=function(i,e){this.layers=i.readFields(Lm,{},e)},Va.VectorTileFeature=wd,Va.VectorTileLayer=Sd;const zm=Va.VectorTileFeature.types,ih=Math.pow(2,13);function bc(i,e,n,o,c,m,g,b){i.emplaceBack(e,n,2*Math.floor(o*ih)+g,c*ih*2,m*ih*2,Math.round(b))}class nh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new dt,this.centroidVertexArray=new et,this.indexArray=new yr,this.programConfigurations=new ys(e.layers,e.zoom),this.segments=new fn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){this.features=[],this.hasPattern=$u("fill-extrusion",this.layers,n);for(const{feature:c,id:m,index:g,sourceLayerIndex:b}of e){const T=this.layers[0]._featureFilter.needGeometry,C=cl(c,T);if(!this.layers[0]._featureFilter.filter(new pn(this.zoom),C,o))continue;const P={id:m,sourceLayerIndex:b,index:g,geometry:T?C.geometry:ll(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(eh("fill-extrusion",this.layers,P,this.zoom,n)):this.addFeature(P,P.geometry,g,o,{}),n.featureIndex.insert(c,P.geometry,g,b,this.index,!0)}}addFeatures(e,n,o){for(const c of this.features){const{geometry:m}=c;this.addFeature(c,m,c.index,n,o)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Im),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Tm.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,n,o,c,m){const g={x:0,y:0,vertexCount:0};for(const b of Qu(n,500)){let T=0;for(const j of b)T+=j.length;let C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const j of b){if(j.length===0||Fm(j))continue;let W=0;for(let ee=0;ee<j.length;ee++){const re=j[ee];if(ee>=1){const fe=j[ee-1];if(!Dm(re,fe)){C.vertexLength+4>fn.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const oe=re.sub(fe)._perp()._unit(),ve=fe.dist(re);W+ve>32768&&(W=0),bc(this.layoutVertexArray,re.x,re.y,oe.x,oe.y,0,0,W),bc(this.layoutVertexArray,re.x,re.y,oe.x,oe.y,0,1,W),g.x+=2*re.x,g.y+=2*re.y,g.vertexCount+=2,W+=ve,bc(this.layoutVertexArray,fe.x,fe.y,oe.x,oe.y,0,0,W),bc(this.layoutVertexArray,fe.x,fe.y,oe.x,oe.y,0,1,W),g.x+=2*fe.x,g.y+=2*fe.y,g.vertexCount+=2;const Ie=C.vertexLength;this.indexArray.emplaceBack(Ie,Ie+2,Ie+1),this.indexArray.emplaceBack(Ie+1,Ie+2,Ie+3),C.vertexLength+=4,C.primitiveLength+=2}}}}if(C.vertexLength+T>fn.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray)),zm[e.type]!=="Polygon")continue;const P=[],F=[],O=C.vertexLength;for(const j of b)if(j.length!==0){j!==b[0]&&F.push(P.length/2);for(let W=0;W<j.length;W++){const ee=j[W];bc(this.layoutVertexArray,ee.x,ee.y,0,0,1,1,0),g.x+=ee.x,g.y+=ee.y,g.vertexCount+=1,P.push(ee.x),P.push(ee.y)}}const U=yd(P,F);for(let j=0;j<U.length;j+=3)this.indexArray.emplaceBack(O+U[j],O+U[j+2],O+U[j+1]);C.primitiveLength+=U.length/3,C.vertexLength+=T}for(let b=0;b<g.vertexCount;b++)this.centroidVertexArray.emplaceBack(Math.floor(g.x/g.vertexCount),Math.floor(g.y/g.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,m,c)}}function Dm(i,e){return i.x===e.x&&(i.x<0||i.x>Hn)||i.y===e.y&&(i.y<0||i.y>Hn)}function Fm(i){return i.every(e=>e.x<0)||i.every(e=>e.x>Hn)||i.every(e=>e.y<0)||i.every(e=>e.y>Hn)}let Id;ft("FillExtrusionBucket",nh,{omit:["layers","features"]});var Rm={get paint(){return Id=Id||new Vn({"fill-extrusion-opacity":new Ot(Me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ht(Me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ot(Me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ot(Me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ol(Me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ht(Me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ht(Me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ot(Me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Om extends Mo{constructor(e){super(e,Rm)}createBucket(e){return new nh(e)}queryRadius(){return ou(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,n,o,c,m,g,b,T){const C=su(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,b),P=this.paint.get("fill-extrusion-height").evaluate(n,o),F=this.paint.get("fill-extrusion-base").evaluate(n,o),O=function(j,W,ee,re){const fe=[];for(const oe of j){const ve=[oe.x,oe.y,0,1];au(ve,ve,W),fe.push(new ce(ve[0]/ve[3],ve[1]/ve[3]))}return fe}(C,T),U=function(j,W,ee,re){const fe=[],oe=[],ve=re[8]*W,Ie=re[9]*W,Ne=re[10]*W,yt=re[11]*W,Ct=re[8]*ee,gt=re[9]*ee,pt=re[10]*ee,ot=re[11]*ee;for(const St of j){const lt=[],Xe=[];for(const Vt of St){const Pt=Vt.x,di=Vt.y,mn=re[0]*Pt+re[4]*di+re[12],bn=re[1]*Pt+re[5]*di+re[13],tr=re[2]*Pt+re[6]*di+re[14],Po=re[3]*Pt+re[7]*di+re[15],Qr=tr+Ne,Xn=Po+yt,br=mn+Ct,Pr=bn+gt,$r=tr+pt,eo=Po+ot,ir=new ce((mn+ve)/Xn,(bn+Ie)/Xn);ir.z=Qr/Xn,lt.push(ir);const nr=new ce(br/eo,Pr/eo);nr.z=$r/eo,Xe.push(nr)}fe.push(lt),oe.push(Xe)}return[fe,oe]}(c,F,P,T);return function(j,W,ee){let re=1/0;id(ee,W)&&(re=Cd(ee,W[0]));for(let fe=0;fe<W.length;fe++){const oe=W[fe],ve=j[fe];for(let Ie=0;Ie<oe.length-1;Ie++){const Ne=oe[Ie],yt=[Ne,oe[Ie+1],ve[Ie+1],ve[Ie],Ne];td(ee,yt)&&(re=Math.min(re,Cd(ee,yt)))}}return re!==1/0&&re}(U[0],U[1],O)}}function xc(i,e){return i.x*e.x+i.y*e.y}function Cd(i,e){if(i.length===1){let n=0;const o=e[n++];let c;for(;!c||o.equals(c);)if(c=e[n++],!c)return 1/0;for(;n<e.length;n++){const m=e[n],g=i[0],b=c.sub(o),T=m.sub(o),C=g.sub(o),P=xc(b,b),F=xc(b,T),O=xc(T,T),U=xc(C,b),j=xc(C,T),W=P*O-F*F,ee=(O*U-F*j)/W,re=(P*j-F*U)/W,fe=o.z*(1-ee-re)+c.z*ee+m.z*re;if(isFinite(fe))return fe}return 1/0}{let n=1/0;for(const o of e)n=Math.min(n,o.z);return n}}const Bm=Tn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Nm}=Bm,Vm=Tn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Um}=Vm,jm=Va.VectorTileFeature.types,qm=Math.cos(Math.PI/180*37.5),kd=Math.pow(2,14)/.5;class rh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Xt,this.layoutVertexArray2=new Mt,this.indexArray=new yr,this.programConfigurations=new ys(e.layers,e.zoom),this.segments=new fn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){this.hasPattern=$u("line",this.layers,n);const c=this.layers[0].layout.get("line-sort-key"),m=!c.isConstant(),g=[];for(const{feature:b,id:T,index:C,sourceLayerIndex:P}of e){const F=this.layers[0]._featureFilter.needGeometry,O=cl(b,F);if(!this.layers[0]._featureFilter.filter(new pn(this.zoom),O,o))continue;const U=m?c.evaluate(O,{},o):void 0,j={id:T,properties:b.properties,type:b.type,sourceLayerIndex:P,index:C,geometry:F?O.geometry:ll(b),patterns:{},sortKey:U};g.push(j)}m&&g.sort((b,T)=>b.sortKey-T.sortKey);for(const b of g){const{geometry:T,index:C,sourceLayerIndex:P}=b;if(this.hasPattern){const F=eh("line",this.layers,b,this.zoom,n);this.patternFeatures.push(F)}else this.addFeature(b,T,C,o,{});n.featureIndex.insert(e[C].feature,T,C,P,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}addFeatures(e,n,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Um)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Nm),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,o,c,m){const g=this.layers[0].layout,b=g.get("line-join").evaluate(e,{}),T=g.get("line-cap"),C=g.get("line-miter-limit"),P=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const F of n)this.addLine(F,e,b,T,C,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,m,c)}addLine(e,n,o,c,m,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let re=0;re<e.length-1;re++)this.totalDistance+=e[re].dist(e[re+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b=jm[n.type]==="Polygon";let T=e.length;for(;T>=2&&e[T-1].equals(e[T-2]);)T--;let C=0;for(;C<T-1&&e[C].equals(e[C+1]);)C++;if(T<(b?3:2))return;o==="bevel"&&(m=1.05);const P=this.overscaling<=16?15*Hn/(512*this.overscaling):0,F=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let O,U,j,W,ee;this.e1=this.e2=-1,b&&(O=e[T-2],ee=e[C].sub(O)._unit()._perp());for(let re=C;re<T;re++){if(j=re===T-1?b?e[C+1]:void 0:e[re+1],j&&e[re].equals(j))continue;ee&&(W=ee),O&&(U=O),O=e[re],ee=j?j.sub(O)._unit()._perp():W,W=W||ee;let fe=W.add(ee);fe.x===0&&fe.y===0||fe._unit();const oe=W.x*ee.x+W.y*ee.y,ve=fe.x*ee.x+fe.y*ee.y,Ie=ve!==0?1/ve:1/0,Ne=2*Math.sqrt(2-2*ve),yt=ve<qm&&U&&j,Ct=W.x*ee.y-W.y*ee.x>0;if(yt&&re>C){const ot=O.dist(U);if(ot>2*P){const St=O.sub(O.sub(U)._mult(P/ot)._round());this.updateDistance(U,St),this.addCurrentVertex(St,W,0,0,F),U=St}}const gt=U&&j;let pt=gt?o:b?"butt":c;if(gt&&pt==="round"&&(Ie<g?pt="miter":Ie<=2&&(pt="fakeround")),pt==="miter"&&Ie>m&&(pt="bevel"),pt==="bevel"&&(Ie>2&&(pt="flipbevel"),Ie<m&&(pt="miter")),U&&this.updateDistance(U,O),pt==="miter")fe._mult(Ie),this.addCurrentVertex(O,fe,0,0,F);else if(pt==="flipbevel"){if(Ie>100)fe=ee.mult(-1);else{const ot=Ie*W.add(ee).mag()/W.sub(ee).mag();fe._perp()._mult(ot*(Ct?-1:1))}this.addCurrentVertex(O,fe,0,0,F),this.addCurrentVertex(O,fe.mult(-1),0,0,F)}else if(pt==="bevel"||pt==="fakeround"){const ot=-Math.sqrt(Ie*Ie-1),St=Ct?ot:0,lt=Ct?0:ot;if(U&&this.addCurrentVertex(O,W,St,lt,F),pt==="fakeround"){const Xe=Math.round(180*Ne/Math.PI/20);for(let Vt=1;Vt<Xe;Vt++){let Pt=Vt/Xe;if(Pt!==.5){const mn=Pt-.5;Pt+=Pt*mn*(Pt-1)*((1.0904+oe*(oe*(3.55645-1.43519*oe)-3.2452))*mn*mn+(.848013+oe*(.215638*oe-1.06021)))}const di=ee.sub(W)._mult(Pt)._add(W)._unit()._mult(Ct?-1:1);this.addHalfVertex(O,di.x,di.y,!1,Ct,0,F)}}j&&this.addCurrentVertex(O,ee,-St,-lt,F)}else if(pt==="butt")this.addCurrentVertex(O,fe,0,0,F);else if(pt==="square"){const ot=U?1:-1;this.addCurrentVertex(O,fe,ot,ot,F)}else pt==="round"&&(U&&(this.addCurrentVertex(O,W,0,0,F),this.addCurrentVertex(O,W,1,1,F,!0)),j&&(this.addCurrentVertex(O,ee,-1,-1,F,!0),this.addCurrentVertex(O,ee,0,0,F)));if(yt&&re<T-1){const ot=O.dist(j);if(ot>2*P){const St=O.add(j.sub(O)._mult(P/ot)._round());this.updateDistance(O,St),this.addCurrentVertex(St,ee,0,0,F),O=St}}}}addCurrentVertex(e,n,o,c,m,g=!1){const b=n.y*c-n.x,T=-n.y-n.x*c;this.addHalfVertex(e,n.x+n.y*o,n.y-n.x*o,g,!1,o,m),this.addHalfVertex(e,b,T,g,!0,-c,m),this.distance>kd/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,n,o,c,m,g))}addHalfVertex({x:e,y:n},o,c,m,g,b,T){const C=.5*(this.lineClips?this.scaledDistance*(kd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(n<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(b===0?0:b<0?-1:1)|(63&C)<<2,C>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const P=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),T.primitiveLength++),g?this.e2=P:this.e1=P}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}let Ed,Md;ft("LineBucket",rh,{omit:["layers","patternFeatures"]});var Ad={get paint(){return Md=Md||new Vn({"line-opacity":new Ht(Me.paint_line["line-opacity"]),"line-color":new Ht(Me.paint_line["line-color"]),"line-translate":new Ot(Me.paint_line["line-translate"]),"line-translate-anchor":new Ot(Me.paint_line["line-translate-anchor"]),"line-width":new Ht(Me.paint_line["line-width"]),"line-gap-width":new Ht(Me.paint_line["line-gap-width"]),"line-offset":new Ht(Me.paint_line["line-offset"]),"line-blur":new Ht(Me.paint_line["line-blur"]),"line-dasharray":new rc(Me.paint_line["line-dasharray"]),"line-pattern":new ol(Me.paint_line["line-pattern"]),"line-gradient":new oc(Me.paint_line["line-gradient"])})},get layout(){return Ed=Ed||new Vn({"line-cap":new Ot(Me.layout_line["line-cap"]),"line-join":new Ht(Me.layout_line["line-join"]),"line-miter-limit":new Ot(Me.layout_line["line-miter-limit"]),"line-round-limit":new Ot(Me.layout_line["line-round-limit"]),"line-sort-key":new Ht(Me.layout_line["line-sort-key"])})}};class Zm extends Ht{possiblyEvaluate(e,n){return n=new pn(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,o,c){return n=Dt({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,o,c)}}let du;class Gm extends Mo{constructor(e){super(e,Ad),this.gradientVersion=0,du||(du=new Zm(Ad.paint.properties["line-width"].specification),du.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof zo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,n){super.recalculate(e,n),this.paint._values["line-floorwidth"]=du.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new rh(e)}queryRadius(e){const n=e,o=Pd(pc("line-width",this,n),pc("line-gap-width",this,n)),c=pc("line-offset",this,n);return o/2+Math.abs(c)+ou(this.paint.get("line-translate"))}queryIntersectsFeature(e,n,o,c,m,g,b){const T=su(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,b),C=b/2*Pd(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),P=this.paint.get("line-offset").evaluate(n,o);return P&&(c=function(F,O){const U=[];for(let j=0;j<F.length;j++){const W=F[j],ee=[];for(let re=0;re<W.length;re++){const fe=W[re-1],oe=W[re],ve=W[re+1],Ie=re===0?new ce(0,0):oe.sub(fe)._unit()._perp(),Ne=re===W.length-1?new ce(0,0):ve.sub(oe)._unit()._perp(),yt=Ie._add(Ne)._unit(),Ct=yt.x*Ne.x+yt.y*Ne.y;Ct!==0&&yt._mult(1/Ct),ee.push(yt._mult(O)._add(oe))}U.push(ee)}return U}(c,P*b)),function(F,O,U){for(let j=0;j<O.length;j++){const W=O[j];if(F.length>=3){for(let ee=0;ee<W.length;ee++)if(El(F,W[ee]))return!0}if(Yf(F,W,U))return!0}return!1}(T,c,C)}isTileClipped(){return!0}}function Pd(i,e){return e>0?e+2*i:i}const Wm=Tn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Hm=Tn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Tn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Xm=Tn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Tn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ld=Tn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Km=Tn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Jm(i,e,n){return i.sections.forEach(o=>{o.text=function(c,m,g){const b=m.layout.get("text-transform").evaluate(g,{});return b==="uppercase"?c=c.toLocaleUpperCase():b==="lowercase"&&(c=c.toLocaleLowerCase()),lo.applyArabicShaping&&(c=lo.applyArabicShaping(c)),c}(o.text,e,n)}),i}Tn([{name:"triangle",components:3,type:"Uint16"}]),Tn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Tn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Tn([{type:"Float32",name:"offsetX"}]),Tn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Tn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const wc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var er=24,zd=Qi,Dd=function(i,e,n,o,c){var m,g,b=8*c-o-1,T=(1<<b)-1,C=T>>1,P=-7,F=n?c-1:0,O=n?-1:1,U=i[e+F];for(F+=O,m=U&(1<<-P)-1,U>>=-P,P+=b;P>0;m=256*m+i[e+F],F+=O,P-=8);for(g=m&(1<<-P)-1,m>>=-P,P+=o;P>0;g=256*g+i[e+F],F+=O,P-=8);if(m===0)m=1-C;else{if(m===T)return g?NaN:1/0*(U?-1:1);g+=Math.pow(2,o),m-=C}return(U?-1:1)*g*Math.pow(2,m-o)},Fd=function(i,e,n,o,c,m){var g,b,T,C=8*m-c-1,P=(1<<C)-1,F=P>>1,O=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,U=o?0:m-1,j=o?1:-1,W=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(b=isNaN(e)?1:0,g=P):(g=Math.floor(Math.log(e)/Math.LN2),e*(T=Math.pow(2,-g))<1&&(g--,T*=2),(e+=g+F>=1?O/T:O*Math.pow(2,1-F))*T>=2&&(g++,T/=2),g+F>=P?(b=0,g=P):g+F>=1?(b=(e*T-1)*Math.pow(2,c),g+=F):(b=e*Math.pow(2,F-1)*Math.pow(2,c),g=0));c>=8;i[n+U]=255&b,U+=j,b/=256,c-=8);for(g=g<<c|b,C+=c;C>0;i[n+U]=255&g,U+=j,g/=256,C-=8);i[n+U-j]|=128*W};function Qi(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Qi.Varint=0,Qi.Fixed64=1,Qi.Bytes=2,Qi.Fixed32=5;var oh=4294967296,Rd=1/oh,Od=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function oa(i){return i.type===Qi.Bytes?i.readVarint()+i.pos:i.pos+1}function Ll(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Bd(i,e,n){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(o);for(var c=n.pos-1;c>=i;c--)n.buf[c+o]=n.buf[c]}function Ym(i,e){for(var n=0;n<i.length;n++)e.writeVarint(i[n])}function Qm(i,e){for(var n=0;n<i.length;n++)e.writeSVarint(i[n])}function $m(i,e){for(var n=0;n<i.length;n++)e.writeFloat(i[n])}function e_(i,e){for(var n=0;n<i.length;n++)e.writeDouble(i[n])}function t_(i,e){for(var n=0;n<i.length;n++)e.writeBoolean(i[n])}function i_(i,e){for(var n=0;n<i.length;n++)e.writeFixed32(i[n])}function n_(i,e){for(var n=0;n<i.length;n++)e.writeSFixed32(i[n])}function r_(i,e){for(var n=0;n<i.length;n++)e.writeFixed64(i[n])}function o_(i,e){for(var n=0;n<i.length;n++)e.writeSFixed64(i[n])}function pu(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function zl(i,e,n){i[n]=e,i[n+1]=e>>>8,i[n+2]=e>>>16,i[n+3]=e>>>24}function Nd(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}Qi.prototype={destroy:function(){this.buf=null},readFields:function(i,e,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),c=o>>3,m=this.pos;this.type=7&o,i(c,e,this),this.pos===m&&this.skip(o)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=pu(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Nd(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=pu(this.buf,this.pos)+pu(this.buf,this.pos+4)*oh;return this.pos+=8,i},readSFixed64:function(){var i=pu(this.buf,this.pos)+Nd(this.buf,this.pos+4)*oh;return this.pos+=8,i},readFloat:function(){var i=Dd(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Dd(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,n,o=this.buf;return e=127&(n=o[this.pos++]),n<128?e:(e|=(127&(n=o[this.pos++]))<<7,n<128?e:(e|=(127&(n=o[this.pos++]))<<14,n<128?e:(e|=(127&(n=o[this.pos++]))<<21,n<128?e:function(c,m,g){var b,T,C=g.buf;if(b=(112&(T=C[g.pos++]))>>4,T<128||(b|=(127&(T=C[g.pos++]))<<3,T<128)||(b|=(127&(T=C[g.pos++]))<<10,T<128)||(b|=(127&(T=C[g.pos++]))<<17,T<128)||(b|=(127&(T=C[g.pos++]))<<24,T<128)||(b|=(1&(T=C[g.pos++]))<<31,T<128))return Ll(c,b,m);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=o[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Od?function(n,o,c){return Od.decode(n.subarray(o,c))}(this.buf,e,i):function(n,o,c){for(var m="",g=o;g<c;){var b,T,C,P=n[g],F=null,O=P>239?4:P>223?3:P>191?2:1;if(g+O>c)break;O===1?P<128&&(F=P):O===2?(192&(b=n[g+1]))==128&&(F=(31&P)<<6|63&b)<=127&&(F=null):O===3?(T=n[g+2],(192&(b=n[g+1]))==128&&(192&T)==128&&((F=(15&P)<<12|(63&b)<<6|63&T)<=2047||F>=55296&&F<=57343)&&(F=null)):O===4&&(T=n[g+2],C=n[g+3],(192&(b=n[g+1]))==128&&(192&T)==128&&(192&C)==128&&((F=(15&P)<<18|(63&b)<<12|(63&T)<<6|63&C)<=65535||F>=1114112)&&(F=null)),F===null?(F=65533,O=1):F>65535&&(F-=65536,m+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),m+=String.fromCharCode(F),g+=O}return m}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Qi.Bytes)return i.push(this.readVarint(e));var n=oa(this);for(i=i||[];this.pos<n;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Qi.Bytes)return i.push(this.readSVarint());var e=oa(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Qi.Bytes)return i.push(this.readBoolean());var e=oa(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Qi.Bytes)return i.push(this.readFloat());var e=oa(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Qi.Bytes)return i.push(this.readDouble());var e=oa(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Qi.Bytes)return i.push(this.readFixed32());var e=oa(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Qi.Bytes)return i.push(this.readSFixed32());var e=oa(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Qi.Bytes)return i.push(this.readFixed64());var e=oa(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Qi.Bytes)return i.push(this.readSFixed64());var e=oa(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Qi.Varint)for(;this.buf[this.pos++]>127;);else if(e===Qi.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Qi.Fixed32)this.pos+=4;else{if(e!==Qi.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),zl(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),zl(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),zl(this.buf,-1&i,this.pos),zl(this.buf,Math.floor(i*Rd),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),zl(this.buf,-1&i,this.pos),zl(this.buf,Math.floor(i*Rd),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,n){var o,c;if(e>=0?(o=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(m,g,b){b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,b.buf[b.pos]=127&(m>>>=7)}(o,0,n),function(m,g){var b=(7&m)<<4;g.buf[g.pos++]|=b|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))}(c,n)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(o,c,m){for(var g,b,T=0;T<c.length;T++){if((g=c.charCodeAt(T))>55295&&g<57344){if(!b){g>56319||T+1===c.length?(o[m++]=239,o[m++]=191,o[m++]=189):b=g;continue}if(g<56320){o[m++]=239,o[m++]=191,o[m++]=189,b=g;continue}g=b-55296<<10|g-56320|65536,b=null}else b&&(o[m++]=239,o[m++]=191,o[m++]=189,b=null);g<128?o[m++]=g:(g<2048?o[m++]=g>>6|192:(g<65536?o[m++]=g>>12|224:(o[m++]=g>>18|240,o[m++]=g>>12&63|128),o[m++]=g>>6&63|128),o[m++]=63&g|128)}return m}(this.buf,i,this.pos);var n=this.pos-e;n>=128&&Bd(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(i){this.realloc(4),Fd(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Fd(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=i[n]},writeRawMessage:function(i,e){this.pos++;var n=this.pos;i(e,this);var o=this.pos-n;o>=128&&Bd(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(i,e,n){this.writeTag(i,Qi.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Ym,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Qm,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,t_,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,$m,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,e_,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,i_,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,n_,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,r_,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,o_,e)},writeBytesField:function(i,e){this.writeTag(i,Qi.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Qi.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Qi.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Qi.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Qi.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Qi.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Qi.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Qi.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Qi.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Qi.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var sh=M(zd);const ah=3;function s_(i,e,n){i===1&&n.readMessage(a_,e)}function a_(i,e,n){if(i===3){const{id:o,bitmap:c,width:m,height:g,left:b,top:T,advance:C}=n.readMessage(l_,{});e.push({id:o,bitmap:new mc({width:m+2*ah,height:g+2*ah},c),metrics:{width:m,height:g,left:b,top:T,advance:C}})}}function l_(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}const Vd=ah;function Ud(i){let e=0,n=0;for(const g of i)e+=g.w*g.h,n=Math.max(n,g.w);i.sort((g,b)=>b.h-g.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let c=0,m=0;for(const g of i)for(let b=o.length-1;b>=0;b--){const T=o[b];if(!(g.w>T.w||g.h>T.h)){if(g.x=T.x,g.y=T.y,m=Math.max(m,g.y+g.h),c=Math.max(c,g.x+g.w),g.w===T.w&&g.h===T.h){const C=o.pop();b<o.length&&(o[b]=C)}else g.h===T.h?(T.x+=g.w,T.w-=g.w):g.w===T.w?(T.y+=g.h,T.h-=g.h):(o.push({x:T.x+g.w,y:T.y,w:T.w-g.w,h:g.h}),T.y+=g.h,T.h-=g.h);break}}return{w:c,h:m,fill:e/(c*m)||0}}const uo=1;class lh{constructor(e,{pixelRatio:n,version:o,stretchX:c,stretchY:m,content:g}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=c,this.stretchY=m,this.content=g,this.version=o}get tl(){return[this.paddedRect.x+uo,this.paddedRect.y+uo]}get br(){return[this.paddedRect.x+this.paddedRect.w-uo,this.paddedRect.y+this.paddedRect.h-uo]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*uo)/this.pixelRatio,(this.paddedRect.h-2*uo)/this.pixelRatio]}}class jd{constructor(e,n){const o={},c={};this.haveRenderCallbacks=[];const m=[];this.addImages(e,o,m),this.addImages(n,c,m);const{w:g,h:b}=Ud(m),T=new Bo({width:g||1,height:b||1});for(const C in e){const P=e[C],F=o[C].paddedRect;Bo.copy(P.data,T,{x:0,y:0},{x:F.x+uo,y:F.y+uo},P.data)}for(const C in n){const P=n[C],F=c[C].paddedRect,O=F.x+uo,U=F.y+uo,j=P.data.width,W=P.data.height;Bo.copy(P.data,T,{x:0,y:0},{x:O,y:U},P.data),Bo.copy(P.data,T,{x:0,y:W-1},{x:O,y:U-1},{width:j,height:1}),Bo.copy(P.data,T,{x:0,y:0},{x:O,y:U+W},{width:j,height:1}),Bo.copy(P.data,T,{x:j-1,y:0},{x:O-1,y:U},{width:1,height:W}),Bo.copy(P.data,T,{x:0,y:0},{x:O+j,y:U},{width:1,height:W})}this.image=T,this.iconPositions=o,this.patternPositions=c}addImages(e,n,o){for(const c in e){const m=e[c],g={x:0,y:0,w:m.data.width+2*uo,h:m.data.height+2*uo};o.push(g),n[c]=new lh(g,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),n)}patchUpdatedImage(e,n,o){if(!e||!n||e.version===n.version)return;e.version=n.version;const[c,m]=e.tl;o.update(n.data,void 0,{x:c,y:m})}}var Ua;ft("ImagePosition",lh),ft("ImageAtlas",jd),s.ai=void 0,(Ua=s.ai||(s.ai={}))[Ua.none=0]="none",Ua[Ua.horizontal=1]="horizontal",Ua[Ua.vertical=2]="vertical",Ua[Ua.horizontalOnly=3]="horizontalOnly";const Sc=-17;class Tc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const o=new Tc;return o.scale=e||1,o.fontStack=n,o}static forImage(e){const n=new Tc;return n.imageName=e,n}}class Dl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const o=new Dl;for(let c=0;c<e.sections.length;c++){const m=e.sections[c];m.image?o.addImageSection(m):o.addTextSection(m,n)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let n="";for(let o=0;o<e.length;o++){const c=e.charCodeAt(o+1)||null,m=e.charCodeAt(o-1)||null;n+=c&&Ys(c)&&!wc[e[o+1]]||m&&Ys(m)&&!wc[e[o-1]]||!wc[e[o]]?e[o]:wc[e[o]]}return n}(this.text)}trim(){let e=0;for(let o=0;o<this.text.length&&mu[this.text.charCodeAt(o)];o++)e++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&mu[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const o=new Dl;return o.text=this.text.substring(e,n),o.sectionIndex=this.sectionIndex.slice(e,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Tc.forText(e.scale,e.fontStack||n));const o=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(o)}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void rt("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Tc.forImage(n)),this.sectionIndex.push(this.sections.length-1)):rt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function fu(i,e,n,o,c,m,g,b,T,C,P,F,O,U,j,W){const ee=Dl.fromFeature(i,c);let re;F===s.ai.vertical&&ee.verticalizePunctuation();const{processBidirectionalText:fe,processStyledBidirectionalText:oe}=lo;if(fe&&ee.sections.length===1){re=[];const Ne=fe(ee.toString(),ch(ee,C,m,e,o,U,j));for(const yt of Ne){const Ct=new Dl;Ct.text=yt,Ct.sections=ee.sections;for(let gt=0;gt<yt.length;gt++)Ct.sectionIndex.push(0);re.push(Ct)}}else if(oe){re=[];const Ne=oe(ee.text,ee.sectionIndex,ch(ee,C,m,e,o,U,j));for(const yt of Ne){const Ct=new Dl;Ct.text=yt[0],Ct.sectionIndex=yt[1],Ct.sections=ee.sections,re.push(Ct)}}else re=function(Ne,yt){const Ct=[],gt=Ne.text;let pt=0;for(const ot of yt)Ct.push(Ne.substring(pt,ot)),pt=ot;return pt<gt.length&&Ct.push(Ne.substring(pt,gt.length)),Ct}(ee,ch(ee,C,m,e,o,U,j));const ve=[],Ie={positionedLines:ve,text:ee.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:F,iconsInText:!1,verticalizable:!1};return function(Ne,yt,Ct,gt,pt,ot,St,lt,Xe,Vt,Pt,di){let mn=0,bn=Sc,tr=0,Po=0;const Qr=lt==="right"?1:lt==="left"?0:.5;let Xn=0;for(const ir of pt){ir.trim();const nr=ir.getMaxScale(),Nr=(nr-1)*er,to={positionedGlyphs:[],lineOffset:0};Ne.positionedLines[Xn]=to;const Vr=to.positionedGlyphs;let ho=0;if(!ir.length()){bn+=ot,++Xn;continue}for(let rr=0;rr<ir.length();rr++){const Ti=ir.getSection(rr),Ur=ir.getSectionIndex(rr),Lr=ir.getCharCode(rr);let or=0,os=null,vs=null,bs=null,sa=er;const ss=!(Xe===s.ai.horizontal||!Pt&&!zs(Lr)||Pt&&(mu[Lr]||(br=Lr,at.Arabic(br)||at["Arabic Supplement"](br)||at["Arabic Extended-A"](br)||at["Arabic Presentation Forms-A"](br)||at["Arabic Presentation Forms-B"](br))));if(Ti.imageName){const Vo=gt[Ti.imageName];if(!Vo)continue;bs=Ti.imageName,Ne.iconsInText=Ne.iconsInText||!0,vs=Vo.paddedRect;const fo=Vo.displaySize;Ti.scale=Ti.scale*er/di,os={width:fo[0],height:fo[1],left:uo,top:-Vd,advance:ss?fo[1]:fo[0]},or=Nr+(er-fo[1]*Ti.scale),sa=os.advance;const aa=ss?fo[0]*Ti.scale-er*nr:fo[1]*Ti.scale-er*nr;aa>0&&aa>ho&&(ho=aa)}else{const Vo=Ct[Ti.fontStack],fo=Vo&&Vo[Lr];if(fo&&fo.rect)vs=fo.rect,os=fo.metrics;else{const aa=yt[Ti.fontStack],Mc=aa&&aa[Lr];if(!Mc)continue;os=Mc.metrics}or=(nr-Ti.scale)*er}ss?(Ne.verticalizable=!0,Vr.push({glyph:Lr,imageName:bs,x:mn,y:bn+or,vertical:ss,scale:Ti.scale,fontStack:Ti.fontStack,sectionIndex:Ur,metrics:os,rect:vs}),mn+=sa*Ti.scale+Vt):(Vr.push({glyph:Lr,imageName:bs,x:mn,y:bn+or,vertical:ss,scale:Ti.scale,fontStack:Ti.fontStack,sectionIndex:Ur,metrics:os,rect:vs}),mn+=os.advance*Ti.scale+Vt)}Vr.length!==0&&(tr=Math.max(mn-Vt,tr),h_(Vr,0,Vr.length-1,Qr,ho)),mn=0;const po=ot*nr+ho;to.lineOffset=Math.max(ho,Nr),bn+=po,Po=Math.max(po,Po),++Xn}var br;const Pr=bn-Sc,{horizontalAlign:$r,verticalAlign:eo}=uh(St);(function(ir,nr,Nr,to,Vr,ho,po,rr,Ti){const Ur=(nr-Nr)*Vr;let Lr=0;Lr=ho!==po?-rr*to-Sc:(-to*Ti+.5)*po;for(const or of ir)for(const os of or.positionedGlyphs)os.x+=Ur,os.y+=Lr})(Ne.positionedLines,Qr,$r,eo,tr,Po,ot,Pr,pt.length),Ne.top+=-eo*Pr,Ne.bottom=Ne.top+Pr,Ne.left+=-$r*tr,Ne.right=Ne.left+tr}(Ie,e,n,o,re,g,b,T,F,C,O,W),!function(Ne){for(const yt of Ne)if(yt.positionedGlyphs.length!==0)return!1;return!0}(ve)&&Ie}const mu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},c_={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function qd(i,e,n,o,c,m){if(e.imageName){const g=o[e.imageName];return g?g.displaySize[0]*e.scale*er/m+c:0}{const g=n[e.fontStack],b=g&&g[i];return b?b.metrics.advance*e.scale+c:0}}function Zd(i,e,n,o){const c=Math.pow(i-e,2);return o?i<e?c/2:2*c:c+Math.abs(n)*n}function u_(i,e,n){let o=0;return i===10&&(o-=1e4),n&&(o+=150),i!==40&&i!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function Gd(i,e,n,o,c,m){let g=null,b=Zd(e,n,c,m);for(const T of o){const C=Zd(e-T.x,n,c,m)+T.badness;C<=b&&(g=T,b=C)}return{index:i,x:e,priorBreak:g,badness:b}}function Wd(i){return i?Wd(i.priorBreak).concat(i.index):[]}function ch(i,e,n,o,c,m,g){if(m!=="point")return[];if(!i)return[];const b=[],T=function(O,U,j,W,ee,re){let fe=0;for(let oe=0;oe<O.length();oe++){const ve=O.getSection(oe);fe+=qd(O.getCharCode(oe),ve,W,ee,U,re)}return fe/Math.max(1,Math.ceil(fe/j))}(i,e,n,o,c,g),C=i.text.indexOf("")>=0;let P=0;for(let O=0;O<i.length();O++){const U=i.getSection(O),j=i.getCharCode(O);if(mu[j]||(P+=qd(j,U,o,c,e,g)),O<i.length()-1){const W=!((F=j)<11904||!(at["Bopomofo Extended"](F)||at.Bopomofo(F)||at["CJK Compatibility Forms"](F)||at["CJK Compatibility Ideographs"](F)||at["CJK Compatibility"](F)||at["CJK Radicals Supplement"](F)||at["CJK Strokes"](F)||at["CJK Symbols and Punctuation"](F)||at["CJK Unified Ideographs Extension A"](F)||at["CJK Unified Ideographs"](F)||at["Enclosed CJK Letters and Months"](F)||at["Halfwidth and Fullwidth Forms"](F)||at.Hiragana(F)||at["Ideographic Description Characters"](F)||at["Kangxi Radicals"](F)||at["Katakana Phonetic Extensions"](F)||at.Katakana(F)||at["Vertical Forms"](F)||at["Yi Radicals"](F)||at["Yi Syllables"](F)));(c_[j]||W||U.imageName)&&b.push(Gd(O+1,P,T,b,u_(j,i.getCharCode(O+1),W&&C),!1))}}var F;return Wd(Gd(i.length(),P,T,b,0,!0))}function uh(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function h_(i,e,n,o,c){if(!o&&!c)return;const m=i[n],g=(i[n].x+m.metrics.advance*m.scale)*o;for(let b=e;b<=n;b++)i[b].x-=g,i[b].y+=c}function d_(i,e,n){const{horizontalAlign:o,verticalAlign:c}=uh(n),m=e[0]-i.displaySize[0]*o,g=e[1]-i.displaySize[1]*c;return{image:i,top:g,bottom:g+i.displaySize[1],left:m,right:m+i.displaySize[0]}}function Hd(i,e,n,o,c,m){const g=i.image;let b;if(g.content){const ee=g.content,re=g.pixelRatio||1;b=[ee[0]/re,ee[1]/re,g.displaySize[0]-ee[2]/re,g.displaySize[1]-ee[3]/re]}const T=e.left*m,C=e.right*m;let P,F,O,U;n==="width"||n==="both"?(U=c[0]+T-o[3],F=c[0]+C+o[1]):(U=c[0]+(T+C-g.displaySize[0])/2,F=U+g.displaySize[0]);const j=e.top*m,W=e.bottom*m;return n==="height"||n==="both"?(P=c[1]+j-o[0],O=c[1]+W+o[2]):(P=c[1]+(j+W-g.displaySize[1])/2,O=P+g.displaySize[1]),{image:g,top:P,right:F,bottom:O,left:U,collisionPadding:b}}const Ic=255,Rs=128,ja=Ic*Rs;function Xd(i,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new pn(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:c}=n;let m=0;for(;m<o.length&&o[m]<=i;)m++;m=Math.max(0,m-1);let g=m;for(;g<o.length&&o[g]<i+1;)g++;g=Math.min(o.length-1,g);const b=o[m],T=o[g];return n.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:T,interpolationType:c}:{kind:"camera",minZoom:b,maxZoom:T,minSize:n.evaluate(new pn(b)),maxSize:n.evaluate(new pn(T)),interpolationType:c}}}function hh(i,e,n){let o="never";const c=i.get(e);return c?o=c:i.get(n)&&(o="always"),o}const p_=Va.VectorTileFeature.types,f_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function _u(i,e,n,o,c,m,g,b,T,C,P,F,O){const U=b?Math.min(ja,Math.round(b[0])):0,j=b?Math.min(ja,Math.round(b[1])):0;i.emplaceBack(e,n,Math.round(32*o),Math.round(32*c),m,g,(U<<1)+(T?1:0),j,16*C,16*P,256*F,256*O)}function dh(i,e,n){i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n)}function m_(i){for(const e of i.sections)if(Ra(e.text))return!0;return!1}class ph{constructor(e){this.layoutVertexArray=new mi,this.indexArray=new yr,this.programConfigurations=e,this.segments=new fn,this.dynamicLayoutVertexArray=new ai,this.opacityVertexArray=new vi,this.hasVisibleVertices=!1,this.placedSymbolArray=new de}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,o,c){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Wm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Hm.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,f_,!0),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ft("SymbolBuffers",ph);class fh{constructor(e,n,o){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new o,this.segments=new fn,this.collisionVertexArray=new sn}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Xm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ft("CollisionBuffers",fh);class Fl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Gu([]),this.placementViewportMatrix=Gu([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Xd(this.zoom,n["text-size"]),this.iconSizeData=Xd(this.zoom,n["icon-size"]);const o=this.layers[0].layout,c=o.get("symbol-sort-key"),m=o.get("symbol-z-order");this.canOverlap=hh(o,"text-overlap","text-allow-overlap")!=="never"||hh(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(g=>s.ai[g])),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID}createArrays(){this.text=new ph(new ys(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new ph(new ys(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new pe,this.lineVertexArray=new Ce,this.symbolInstances=new ie,this.textAnchorOffsets=new Be}calculateGlyphDependencies(e,n,o,c,m){for(let g=0;g<e.length;g++)if(n[e.charCodeAt(g)]=!0,(o||c)&&m){const b=wc[e.charAt(g)];b&&(n[b.charCodeAt(0)]=!0)}}populate(e,n,o){const c=this.layers[0],m=c.layout,g=m.get("text-font"),b=m.get("text-field"),T=m.get("icon-image"),C=(b.value.kind!=="constant"||b.value.value instanceof on&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),P=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,F=m.get("symbol-sort-key");if(this.features=[],!C&&!P)return;const O=n.iconDependencies,U=n.glyphDependencies,j=n.availableImages,W=new pn(this.zoom);for(const{feature:ee,id:re,index:fe,sourceLayerIndex:oe}of e){const ve=c._featureFilter.needGeometry,Ie=cl(ee,ve);if(!c._featureFilter.filter(W,Ie,o))continue;let Ne,yt;if(ve||(Ie.geometry=ll(ee)),C){const gt=c.getValueAndResolveTokens("text-field",Ie,o,j),pt=on.factory(gt);m_(pt)&&(this.hasRTLText=!0),(!this.hasRTLText||ic()==="unavailable"||this.hasRTLText&&lo.isParsed())&&(Ne=Jm(pt,c,Ie))}if(P){const gt=c.getValueAndResolveTokens("icon-image",Ie,o,j);yt=gt instanceof Wn?gt:Wn.fromString(gt)}if(!Ne&&!yt)continue;const Ct=this.sortFeaturesByKey?F.evaluate(Ie,{},o):void 0;if(this.features.push({id:re,text:Ne,icon:yt,index:fe,sourceLayerIndex:oe,geometry:Ie.geometry,properties:ee.properties,type:p_[ee.type],sortKey:Ct}),yt&&(O[yt.name]=!0),Ne){const gt=g.evaluate(Ie,{},o).join(","),pt=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(s.ai.vertical)>=0;for(const ot of Ne.sections)if(ot.image)O[ot.image.name]=!0;else{const St=Fa(Ne.toString()),lt=ot.fontStack||gt,Xe=U[lt]=U[lt]||{};this.calculateGlyphDependencies(ot.text,Xe,pt,this.allowVerticalPlacement,St)}}}m.get("symbol-placement")==="line"&&(this.features=function(ee){const re={},fe={},oe=[];let ve=0;function Ie(gt){oe.push(ee[gt]),ve++}function Ne(gt,pt,ot){const St=fe[gt];return delete fe[gt],fe[pt]=St,oe[St].geometry[0].pop(),oe[St].geometry[0]=oe[St].geometry[0].concat(ot[0]),St}function yt(gt,pt,ot){const St=re[pt];return delete re[pt],re[gt]=St,oe[St].geometry[0].shift(),oe[St].geometry[0]=ot[0].concat(oe[St].geometry[0]),St}function Ct(gt,pt,ot){const St=ot?pt[0][pt[0].length-1]:pt[0][0];return`${gt}:${St.x}:${St.y}`}for(let gt=0;gt<ee.length;gt++){const pt=ee[gt],ot=pt.geometry,St=pt.text?pt.text.toString():null;if(!St){Ie(gt);continue}const lt=Ct(St,ot),Xe=Ct(St,ot,!0);if(lt in fe&&Xe in re&&fe[lt]!==re[Xe]){const Vt=yt(lt,Xe,ot),Pt=Ne(lt,Xe,oe[Vt].geometry);delete re[lt],delete fe[Xe],fe[Ct(St,oe[Pt].geometry,!0)]=Pt,oe[Vt].geometry=null}else lt in fe?Ne(lt,Xe,ot):Xe in re?yt(lt,Xe,ot):(Ie(gt),re[lt]=ve-1,fe[Xe]=ve-1)}return oe.filter(gt=>gt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ee,re)=>ee.sortKey-re.sortKey)}update(e,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,o),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const o=this.lineVertexArray.length;if(e.segment!==void 0){let c=e.dist(n[e.segment+1]),m=e.dist(n[e.segment]);const g={};for(let b=e.segment+1;b<n.length;b++)g[b]={x:n[b].x,y:n[b].y,tileUnitDistanceFromAnchor:c},b<n.length-1&&(c+=n[b+1].dist(n[b]));for(let b=e.segment||0;b>=0;b--)g[b]={x:n[b].x,y:n[b].y,tileUnitDistanceFromAnchor:m},b>0&&(m+=n[b-1].dist(n[b]));for(let b=0;b<n.length;b++){const T=g[b];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,n,o,c,m,g,b,T,C,P,F,O){const U=e.indexArray,j=e.layoutVertexArray,W=e.segments.prepareSegment(4*n.length,j,U,this.canOverlap?g.sortKey:void 0),ee=this.glyphOffsetArray.length,re=W.vertexLength,fe=this.allowVerticalPlacement&&b===s.ai.vertical?Math.PI/2:0,oe=g.text&&g.text.sections;for(let ve=0;ve<n.length;ve++){const{tl:Ie,tr:Ne,bl:yt,br:Ct,tex:gt,pixelOffsetTL:pt,pixelOffsetBR:ot,minFontScaleX:St,minFontScaleY:lt,glyphOffset:Xe,isSDF:Vt,sectionIndex:Pt}=n[ve],di=W.vertexLength,mn=Xe[1];_u(j,T.x,T.y,Ie.x,mn+Ie.y,gt.x,gt.y,o,Vt,pt.x,pt.y,St,lt),_u(j,T.x,T.y,Ne.x,mn+Ne.y,gt.x+gt.w,gt.y,o,Vt,ot.x,pt.y,St,lt),_u(j,T.x,T.y,yt.x,mn+yt.y,gt.x,gt.y+gt.h,o,Vt,pt.x,ot.y,St,lt),_u(j,T.x,T.y,Ct.x,mn+Ct.y,gt.x+gt.w,gt.y+gt.h,o,Vt,ot.x,ot.y,St,lt),dh(e.dynamicLayoutVertexArray,T,fe),U.emplaceBack(di,di+1,di+2),U.emplaceBack(di+1,di+2,di+3),W.vertexLength+=4,W.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Xe[0]),ve!==n.length-1&&Pt===n[ve+1].sectionIndex||e.programConfigurations.populatePaintArrays(j.length,g,g.index,{},O,oe&&oe[Pt])}e.placedSymbolArray.emplaceBack(T.x,T.y,ee,this.glyphOffsetArray.length-ee,re,C,P,T.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],b,0,!1,0,F)}_addCollisionDebugVertex(e,n,o,c,m,g){return n.emplaceBack(0,0),e.emplaceBack(o.x,o.y,c,m,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(e,n,o,c,m,g,b){const T=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),C=T.vertexLength,P=m.layoutVertexArray,F=m.collisionVertexArray,O=b.anchorX,U=b.anchorY;this._addCollisionDebugVertex(P,F,g,O,U,new ce(e,n)),this._addCollisionDebugVertex(P,F,g,O,U,new ce(o,n)),this._addCollisionDebugVertex(P,F,g,O,U,new ce(o,c)),this._addCollisionDebugVertex(P,F,g,O,U,new ce(e,c)),T.vertexLength+=4;const j=m.indexArray;j.emplaceBack(C,C+1),j.emplaceBack(C+1,C+2),j.emplaceBack(C+2,C+3),j.emplaceBack(C+3,C),T.primitiveLength+=4}addDebugCollisionBoxes(e,n,o,c){for(let m=e;m<n;m++){const g=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,c?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new fh(Ln,Ld.members,Qn),this.iconCollisionBox=new fh(Ln,Ld.members,Qn);for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(e,n,o,c,m,g,b,T,C){const P={};for(let F=n;F<o;F++){const O=e.get(F);P.textBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},P.textFeatureIndex=O.featureIndex;break}for(let F=c;F<m;F++){const O=e.get(F);P.verticalTextBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},P.verticalTextFeatureIndex=O.featureIndex;break}for(let F=g;F<b;F++){const O=e.get(F);P.iconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},P.iconFeatureIndex=O.featureIndex;break}for(let F=T;F<C;F++){const O=e.get(F);P.verticalIconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},P.verticalIconFeatureIndex=O.featureIndex;break}return P}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const o=e.placedSymbolArray.get(n),c=o.vertexStartIndex+4*o.numGlyphs;for(let m=o.vertexStartIndex;m<c;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),o=Math.cos(e),c=[],m=[],g=[];for(let b=0;b<this.symbolInstances.length;++b){g.push(b);const T=this.symbolInstances.get(b);c.push(0|Math.round(n*T.anchorX+o*T.anchorY)),m.push(T.featureIndex)}return g.sort((b,T)=>c[b]-c[T]||m[T]-m[b]),g}addToSortKeyRanges(e,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((c,m,g)=>{c>=0&&g.indexOf(c)===m&&this.addIndicesForPlacedSymbol(this.text,c)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Kd,Jd;ft("SymbolBucket",Fl,{omit:["layers","collisionBoxArray","features","compareText"]}),Fl.MAX_GLYPHS=65535,Fl.addDynamicAttributes=dh;var mh={get paint(){return Jd=Jd||new Vn({"icon-opacity":new Ht(Me.paint_symbol["icon-opacity"]),"icon-color":new Ht(Me.paint_symbol["icon-color"]),"icon-halo-color":new Ht(Me.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ht(Me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ht(Me.paint_symbol["icon-halo-blur"]),"icon-translate":new Ot(Me.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ot(Me.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ht(Me.paint_symbol["text-opacity"]),"text-color":new Ht(Me.paint_symbol["text-color"],{runtimeType:sr,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Ht(Me.paint_symbol["text-halo-color"]),"text-halo-width":new Ht(Me.paint_symbol["text-halo-width"]),"text-halo-blur":new Ht(Me.paint_symbol["text-halo-blur"]),"text-translate":new Ot(Me.paint_symbol["text-translate"]),"text-translate-anchor":new Ot(Me.paint_symbol["text-translate-anchor"])})},get layout(){return Kd=Kd||new Vn({"symbol-placement":new Ot(Me.layout_symbol["symbol-placement"]),"symbol-spacing":new Ot(Me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ot(Me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ht(Me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ot(Me.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ot(Me.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ot(Me.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ot(Me.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ot(Me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ot(Me.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ht(Me.layout_symbol["icon-size"]),"icon-text-fit":new Ot(Me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ot(Me.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ht(Me.layout_symbol["icon-image"]),"icon-rotate":new Ht(Me.layout_symbol["icon-rotate"]),"icon-padding":new Ht(Me.layout_symbol["icon-padding"]),"icon-keep-upright":new Ot(Me.layout_symbol["icon-keep-upright"]),"icon-offset":new Ht(Me.layout_symbol["icon-offset"]),"icon-anchor":new Ht(Me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ot(Me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ot(Me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ot(Me.layout_symbol["text-rotation-alignment"]),"text-field":new Ht(Me.layout_symbol["text-field"]),"text-font":new Ht(Me.layout_symbol["text-font"]),"text-size":new Ht(Me.layout_symbol["text-size"]),"text-max-width":new Ht(Me.layout_symbol["text-max-width"]),"text-line-height":new Ot(Me.layout_symbol["text-line-height"]),"text-letter-spacing":new Ht(Me.layout_symbol["text-letter-spacing"]),"text-justify":new Ht(Me.layout_symbol["text-justify"]),"text-radial-offset":new Ht(Me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ot(Me.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ht(Me.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ht(Me.layout_symbol["text-anchor"]),"text-max-angle":new Ot(Me.layout_symbol["text-max-angle"]),"text-writing-mode":new Ot(Me.layout_symbol["text-writing-mode"]),"text-rotate":new Ht(Me.layout_symbol["text-rotate"]),"text-padding":new Ot(Me.layout_symbol["text-padding"]),"text-keep-upright":new Ot(Me.layout_symbol["text-keep-upright"]),"text-transform":new Ht(Me.layout_symbol["text-transform"]),"text-offset":new Ht(Me.layout_symbol["text-offset"]),"text-allow-overlap":new Ot(Me.layout_symbol["text-allow-overlap"]),"text-overlap":new Ot(Me.layout_symbol["text-overlap"]),"text-ignore-placement":new Ot(Me.layout_symbol["text-ignore-placement"]),"text-optional":new Ot(Me.layout_symbol["text-optional"])})}};class Yd{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Sr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ft("FormatSectionOverride",Yd,{omit:["defaultValue"]});class gu extends Mo{constructor(e){super(e,mh)}recalculate(e,n){if(super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const c=[];for(const m of o)c.indexOf(m)<0&&c.push(m);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,n,o,c){const m=this.layout.get(e).evaluate(n,{},o,c),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||oo(g.value)||!m?m:function(b,T){return T.replace(/{([^{}]+)}/g,(C,P)=>b&&P in b?String(b[P]):"")}(n.properties,m)}createBucket(e){return new Fl(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of mh.paint.overridableProperties){if(!gu.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),o=new Yd(n),c=new ks(o,n.property.specification);let m=null;m=n.value.kind==="constant"||n.value.kind==="source"?new Es("source",c):new Jo("composite",c,n.value.zoomStops),this.paint._values[e]=new Or(n.property,m,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&gu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const o=e.get("text-field"),c=mh.paint.properties[n];let m=!1;const g=b=>{for(const T of b)if(c.overrides&&c.overrides.hasOverride(T))return void(m=!0)};if(o.value.kind==="constant"&&o.value.value instanceof on)g(o.value.value.sections);else if(o.value.kind==="source"){const b=C=>{m||(C instanceof Lo&&an(C.value)===K?g(C.value.sections):C instanceof Zs?g(C.sections):C.eachChild(b))},T=o.value;T._styleExpression&&b(T._styleExpression.expression)}return m}}let Qd;var __={get paint(){return Qd=Qd||new Vn({"background-color":new Ot(Me.paint_background["background-color"]),"background-pattern":new rc(Me.paint_background["background-pattern"]),"background-opacity":new Ot(Me.paint_background["background-opacity"])})}};class g_ extends Mo{constructor(e){super(e,__)}}let $d;var y_={get paint(){return $d=$d||new Vn({"raster-opacity":new Ot(Me.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ot(Me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ot(Me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ot(Me.paint_raster["raster-brightness-max"]),"raster-saturation":new Ot(Me.paint_raster["raster-saturation"]),"raster-contrast":new Ot(Me.paint_raster["raster-contrast"]),"raster-resampling":new Ot(Me.paint_raster["raster-resampling"]),"raster-fade-duration":new Ot(Me.paint_raster["raster-fade-duration"])})}};class v_ extends Mo{constructor(e){super(e,y_)}}class b_ extends Mo{constructor(e){super(e,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class x_{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const _h=63710088e-1;class qa{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new qa(Qe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,o=this.lat*n,c=e.lat*n,m=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((e.lng-this.lng)*n);return _h*Math.acos(Math.min(m,1))}static convert(e){if(e instanceof qa)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new qa(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new qa(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ep=2*Math.PI*_h;function tp(i){return ep*Math.cos(i*Math.PI/180)}function ip(i){return(180+i)/360}function np(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function rp(i,e){return i/tp(e)}function op(i){return 360*i-180}function gh(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class yu{constructor(e,n,o=0){this.x=+e,this.y=+n,this.z=+o}static fromLngLat(e,n=0){const o=qa.convert(e);return new yu(ip(o.lng),np(o.lat),rp(n,o.lat))}toLngLat(){return new qa(op(this.x),gh(this.y))}toAltitude(){return this.z*tp(gh(this.y))}meterInMercatorCoordinateUnits(){return 1/ep*(e=gh(this.y),1/Math.cos(e*Math.PI/180));var e}}function sp(i,e,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[i*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class yh{constructor(e,n,o){if(e<0||e>25||o<0||o>=Math.pow(2,e)||n<0||n>=Math.pow(2,e))throw new Error(`x=${n}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=n,this.y=o,this.key=Cc(0,e,e,n,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n,o){const c=(g=this.y,b=this.z,T=sp(256*(m=this.x),256*(g=Math.pow(2,b)-g-1),b),C=sp(256*(m+1),256*(g+1),b),T[0]+","+T[1]+","+C[0]+","+C[1]);var m,g,b,T,C;const P=function(F,O,U){let j,W="";for(let ee=F;ee>0;ee--)j=1<<ee-1,W+=(O&j?1:0)+(U&j?2:0);return W}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,P).replace(/{bbox-epsg-3857}/g,c)}isChildOf(e){const n=this.z-e.z;return n>0&&e.x===this.x>>n&&e.y===this.y>>n}getTilePoint(e){const n=Math.pow(2,this.z);return new ce((e.x*n-this.x)*Hn,(e.y*n-this.y)*Hn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ap{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Cc(e,n.z,n.z,n.x,n.y)}}class No{constructor(e,n,o,c,m){if(e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=n,this.canonical=new yh(o,+c,+m),this.key=Cc(n,e,o,c,m)}clone(){return new No(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?new No(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new No(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?Cc(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y):Cc(this.wrap*+n,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new No(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new No(n,this.wrap,n,o,c),new No(n,this.wrap,n,o+1,c),new No(n,this.wrap,n,o,c+1),new No(n,this.wrap,n,o+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new No(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new No(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ap(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new yu(e.x-this.wrap,e.y))}}function Cc(i,e,n,o,c){(i*=2)<0&&(i=-1*i-1);const m=1<<n;return(m*m*i+m*c+o).toString(36)+n.toString(36)+e.toString(36)}ft("CanonicalTileID",yh),ft("OverscaledTileID",No,{omit:["posMatrix"]});class lp{constructor(e,n,o,c=1,m=1,g=1,b=0){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void rt(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const T=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=m,this.blueFactor=g,this.baseShift=b;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let C=0;C<T;C++)this.data[this._idx(-1,C)]=this.data[this._idx(0,C)],this.data[this._idx(T,C)]=this.data[this._idx(T-1,C)],this.data[this._idx(C,-1)]=this.data[this._idx(C,0)],this.data[this._idx(C,T)]=this.data[this._idx(C,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let C=0;C<T;C++)for(let P=0;P<T;P++){const F=this.get(C,P);F>this.max&&(this.max=F),F<this.min&&(this.min=F)}}get(e,n){const o=new Uint8Array(this.data.buffer),c=4*this._idx(e,n);return this.unpack(o[c],o[c+1],o[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}unpack(e,n,o){return e*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}getPixels(){return new Bo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,m=n*this.dim+this.dim,g=o*this.dim,b=o*this.dim+this.dim;switch(n){case-1:c=m-1;break;case 1:m=c+1}switch(o){case-1:g=b-1;break;case 1:b=g+1}const T=-n*this.dim,C=-o*this.dim;for(let P=g;P<b;P++)for(let F=c;F<m;F++)this.data[this._idx(F,P)]=e.data[this._idx(F+T,P+C)]}}ft("DEMData",lp);class cp{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const o=e[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class up{constructor(e,n,o,c,m){this.type="Feature",this._vectorTileFeature=e,e._z=n,e._x=o,e._y=c,this.properties=e.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(e[n]=this[n]);return e}}class hp{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new $o(Hn,16,0),this.grid3D=new $o(Hn,16,0),this.featureIndexArray=new je,this.promoteId=n}insert(e,n,o,c,m,g){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,m);const T=g?this.grid3D:this.grid;for(let C=0;C<n.length;C++){const P=n[C],F=[1/0,1/0,-1/0,-1/0];for(let O=0;O<P.length;O++){const U=P[O];F[0]=Math.min(F[0],U.x),F[1]=Math.min(F[1],U.y),F[2]=Math.max(F[2],U.x),F[3]=Math.max(F[3],U.y)}F[0]<Hn&&F[1]<Hn&&F[2]>=0&&F[3]>=0&&T.insert(b,F[0],F[1],F[2],F[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Va.VectorTile(new sh(this.rawTileData)).layers,this.sourceLayerCoder=new cp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,n,o,c){this.loadVTLayers();const m=e.params||{},g=Hn/e.tileSize/e.scale,b=Ma(m.filter),T=e.queryGeometry,C=e.queryPadding*g,P=pp(T),F=this.grid.query(P.minX-C,P.minY-C,P.maxX+C,P.maxY+C),O=pp(e.cameraQueryGeometry),U=this.grid3D.query(O.minX-C,O.minY-C,O.maxX+C,O.maxY+C,(ee,re,fe,oe)=>function(ve,Ie,Ne,yt,Ct){for(const pt of ve)if(Ie<=pt.x&&Ne<=pt.y&&yt>=pt.x&&Ct>=pt.y)return!0;const gt=[new ce(Ie,Ne),new ce(Ie,Ct),new ce(yt,Ct),new ce(yt,Ne)];if(ve.length>2){for(const pt of gt)if(El(ve,pt))return!0}for(let pt=0;pt<ve.length-1;pt++)if($f(ve[pt],ve[pt+1],gt))return!0;return!1}(e.cameraQueryGeometry,ee-C,re-C,fe+C,oe+C));for(const ee of U)F.push(ee);F.sort(w_);const j={};let W;for(let ee=0;ee<F.length;ee++){const re=F[ee];if(re===W)continue;W=re;const fe=this.featureIndexArray.get(re);let oe=null;this.loadMatchingFeature(j,fe.bucketIndex,fe.sourceLayerIndex,fe.featureIndex,b,m.layers,m.availableImages,n,o,c,(ve,Ie,Ne)=>(oe||(oe=ll(ve)),Ie.queryIntersectsFeature(T,ve,Ne,oe,this.z,e.transform,g,e.pixelPosMatrix)))}return j}loadMatchingFeature(e,n,o,c,m,g,b,T,C,P,F){const O=this.bucketLayerIDs[n];if(g&&!function(ee,re){for(let fe=0;fe<ee.length;fe++)if(re.indexOf(ee[fe])>=0)return!0;return!1}(g,O))return;const U=this.sourceLayerCoder.decode(o),j=this.vtLayers[U].feature(c);if(m.needGeometry){const ee=cl(j,!0);if(!m.filter(new pn(this.tileID.overscaledZ),ee,this.tileID.canonical))return}else if(!m.filter(new pn(this.tileID.overscaledZ),j))return;const W=this.getId(j,U);for(let ee=0;ee<O.length;ee++){const re=O[ee];if(g&&g.indexOf(re)<0)continue;const fe=T[re];if(!fe)continue;let oe={};W&&P&&(oe=P.getState(fe.sourceLayer||"_geojsonTileLayer",W));const ve=Dt({},C[re]);ve.paint=dp(ve.paint,fe.paint,j,oe,b),ve.layout=dp(ve.layout,fe.layout,j,oe,b);const Ie=!F||F(j,fe,oe);if(!Ie)continue;const Ne=new up(j,this.z,this.x,this.y,W);Ne.layer=ve;let yt=e[re];yt===void 0&&(yt=e[re]=[]),yt.push({featureIndex:c,feature:Ne,intersectionZ:Ie})}}lookupSymbolFeatures(e,n,o,c,m,g,b,T){const C={};this.loadVTLayers();const P=Ma(m);for(const F of e)this.loadMatchingFeature(C,o,c,F,P,g,b,T,n);return C}hasLayer(e){for(const n of this.bucketLayerIDs)for(const o of n)if(e===o)return!0;return!1}getId(e,n){let o=e.id;return this.promoteId&&(o=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof o=="boolean"&&(o=Number(o))),o}}function dp(i,e,n,o,c){return qt(i,(m,g)=>{const b=e instanceof Cl?e.get(g):null;return b&&b.evaluate?b.evaluate(n,o,c):b})}function pp(i){let e=1/0,n=1/0,o=-1/0,c=-1/0;for(const m of i)e=Math.min(e,m.x),n=Math.min(n,m.y),o=Math.max(o,m.x),c=Math.max(c,m.y);return{minX:e,minY:n,maxX:o,maxY:c}}function w_(i,e){return e-i}function fp(i,e,n,o,c){const m=[];for(let g=0;g<i.length;g++){const b=i[g];let T;for(let C=0;C<b.length-1;C++){let P=b[C],F=b[C+1];P.x<e&&F.x<e||(P.x<e?P=new ce(e,P.y+(e-P.x)/(F.x-P.x)*(F.y-P.y))._round():F.x<e&&(F=new ce(e,P.y+(e-P.x)/(F.x-P.x)*(F.y-P.y))._round()),P.y<n&&F.y<n||(P.y<n?P=new ce(P.x+(n-P.y)/(F.y-P.y)*(F.x-P.x),n)._round():F.y<n&&(F=new ce(P.x+(n-P.y)/(F.y-P.y)*(F.x-P.x),n)._round()),P.x>=o&&F.x>=o||(P.x>=o?P=new ce(o,P.y+(o-P.x)/(F.x-P.x)*(F.y-P.y))._round():F.x>=o&&(F=new ce(o,P.y+(o-P.x)/(F.x-P.x)*(F.y-P.y))._round()),P.y>=c&&F.y>=c||(P.y>=c?P=new ce(P.x+(c-P.y)/(F.y-P.y)*(F.x-P.x),c)._round():F.y>=c&&(F=new ce(P.x+(c-P.y)/(F.y-P.y)*(F.x-P.x),c)._round()),T&&P.equals(T[T.length-1])||(T=[P],m.push(T)),T.push(F)))))}}return m}ft("FeatureIndex",hp,{omit:["rawTileData","sourceLayerCoder"]});class Za extends ce{constructor(e,n,o,c){super(e,n),this.angle=o,c!==void 0&&(this.segment=c)}clone(){return new Za(this.x,this.y,this.angle,this.segment)}}function mp(i,e,n,o,c){if(e.segment===void 0||n===0)return!0;let m=e,g=e.segment+1,b=0;for(;b>-n/2;){if(g--,g<0)return!1;b-=i[g].dist(m),m=i[g]}b+=i[g].dist(i[g+1]),g++;const T=[];let C=0;for(;b<n/2;){const P=i[g],F=i[g+1];if(!F)return!1;let O=i[g-1].angleTo(P)-P.angleTo(F);for(O=Math.abs((O+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:b,angleDelta:O}),C+=O;b-T[0].distance>o;)C-=T.shift().angleDelta;if(C>c)return!1;g++,b+=P.dist(F)}return!0}function _p(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function gp(i,e,n){return i?.6*e*n:0}function yp(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function S_(i,e,n,o,c,m){const g=gp(n,c,m),b=yp(n,o)*m;let T=0;const C=_p(i)/2;for(let P=0;P<i.length-1;P++){const F=i[P],O=i[P+1],U=F.dist(O);if(T+U>C){const j=(C-T)/U,W=_r.number(F.x,O.x,j),ee=_r.number(F.y,O.y,j),re=new Za(W,ee,O.angleTo(F),P);return re._round(),!g||mp(i,re,b,g,e)?re:void 0}T+=U}}function T_(i,e,n,o,c,m,g,b,T){const C=gp(o,m,g),P=yp(o,c),F=P*g,O=i[0].x===0||i[0].x===T||i[0].y===0||i[0].y===T;return e-F<e/4&&(e=F+e/4),vp(i,O?e/2*b%e:(P/2+2*m)*g*b%e,e,C,n,F,O,!1,T)}function vp(i,e,n,o,c,m,g,b,T){const C=m/2,P=_p(i);let F=0,O=e-n,U=[];for(let j=0;j<i.length-1;j++){const W=i[j],ee=i[j+1],re=W.dist(ee),fe=ee.angleTo(W);for(;O+n<F+re;){O+=n;const oe=(O-F)/re,ve=_r.number(W.x,ee.x,oe),Ie=_r.number(W.y,ee.y,oe);if(ve>=0&&ve<T&&Ie>=0&&Ie<T&&O-C>=0&&O+C<=P){const Ne=new Za(ve,Ie,fe,j);Ne._round(),o&&!mp(i,Ne,m,o,c)||U.push(Ne)}}F+=re}return b||U.length||g||(U=vp(i,F/2,n,o,c,m,g,!0,T)),U}ft("Anchor",Za);const Rl=uo;function bp(i,e,n,o){const c=[],m=i.image,g=m.pixelRatio,b=m.paddedRect.w-2*Rl,T=m.paddedRect.h-2*Rl,C=i.right-i.left,P=i.bottom-i.top,F=m.stretchX||[[0,b]],O=m.stretchY||[[0,T]],U=(ot,St)=>ot+St[1]-St[0],j=F.reduce(U,0),W=O.reduce(U,0),ee=b-j,re=T-W;let fe=0,oe=j,ve=0,Ie=W,Ne=0,yt=ee,Ct=0,gt=re;if(m.content&&o){const ot=m.content;fe=vu(F,0,ot[0]),ve=vu(O,0,ot[1]),oe=vu(F,ot[0],ot[2]),Ie=vu(O,ot[1],ot[3]),Ne=ot[0]-fe,Ct=ot[1]-ve,yt=ot[2]-ot[0]-oe,gt=ot[3]-ot[1]-Ie}const pt=(ot,St,lt,Xe)=>{const Vt=bu(ot.stretch-fe,oe,C,i.left),Pt=xu(ot.fixed-Ne,yt,ot.stretch,j),di=bu(St.stretch-ve,Ie,P,i.top),mn=xu(St.fixed-Ct,gt,St.stretch,W),bn=bu(lt.stretch-fe,oe,C,i.left),tr=xu(lt.fixed-Ne,yt,lt.stretch,j),Po=bu(Xe.stretch-ve,Ie,P,i.top),Qr=xu(Xe.fixed-Ct,gt,Xe.stretch,W),Xn=new ce(Vt,di),br=new ce(bn,di),Pr=new ce(bn,Po),$r=new ce(Vt,Po),eo=new ce(Pt/g,mn/g),ir=new ce(tr/g,Qr/g),nr=e*Math.PI/180;if(nr){const Vr=Math.sin(nr),ho=Math.cos(nr),po=[ho,-Vr,Vr,ho];Xn._matMult(po),br._matMult(po),$r._matMult(po),Pr._matMult(po)}const Nr=ot.stretch+ot.fixed,to=St.stretch+St.fixed;return{tl:Xn,tr:br,bl:$r,br:Pr,tex:{x:m.paddedRect.x+Rl+Nr,y:m.paddedRect.y+Rl+to,w:lt.stretch+lt.fixed-Nr,h:Xe.stretch+Xe.fixed-to},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:eo,pixelOffsetBR:ir,minFontScaleX:yt/g/C,minFontScaleY:gt/g/P,isSDF:n}};if(o&&(m.stretchX||m.stretchY)){const ot=xp(F,ee,j),St=xp(O,re,W);for(let lt=0;lt<ot.length-1;lt++){const Xe=ot[lt],Vt=ot[lt+1];for(let Pt=0;Pt<St.length-1;Pt++)c.push(pt(Xe,St[Pt],Vt,St[Pt+1]))}}else c.push(pt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:T+1}));return c}function vu(i,e,n){let o=0;for(const c of i)o+=Math.max(e,Math.min(n,c[1]))-Math.max(e,Math.min(n,c[0]));return o}function xp(i,e,n){const o=[{fixed:-Rl,stretch:0}];for(const[c,m]of i){const g=o[o.length-1];o.push({fixed:c-g.stretch,stretch:g.stretch}),o.push({fixed:c-g.stretch,stretch:g.stretch+(m-c)})}return o.push({fixed:e+Rl,stretch:n}),o}function bu(i,e,n,o){return i/e*n+o}function xu(i,e,n,o){return i-e*n/o}class wu{constructor(e,n,o,c,m,g,b,T,C,P){if(this.boxStartIndex=e.length,C){let F=g.top,O=g.bottom;const U=g.collisionPadding;U&&(F-=U[1],O+=U[3]);let j=O-F;j>0&&(j=Math.max(10,j),this.circleDiameter=j)}else{let F=g.top*b-T[0],O=g.bottom*b+T[2],U=g.left*b-T[3],j=g.right*b+T[1];const W=g.collisionPadding;if(W&&(U-=W[0]*b,F-=W[1]*b,j+=W[2]*b,O+=W[3]*b),P){const ee=new ce(U,F),re=new ce(j,F),fe=new ce(U,O),oe=new ce(j,O),ve=P*Math.PI/180;ee._rotate(ve),re._rotate(ve),fe._rotate(ve),oe._rotate(ve),U=Math.min(ee.x,re.x,fe.x,oe.x),j=Math.max(ee.x,re.x,fe.x,oe.x),F=Math.min(ee.y,re.y,fe.y,oe.y),O=Math.max(ee.y,re.y,fe.y,oe.y)}e.emplaceBack(n.x,n.y,U,F,j,O,o,c,m)}this.boxEndIndex=e.length}}class I_{constructor(e=[],n=C_){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:o}=this,c=n[e];for(;e>0;){const m=e-1>>1,g=n[m];if(o(c,g)>=0)break;n[e]=g,e=m}n[e]=c}_down(e){const{data:n,compare:o}=this,c=this.length>>1,m=n[e];for(;e<c;){let g=1+(e<<1),b=n[g];const T=g+1;if(T<this.length&&o(n[T],b)<0&&(g=T,b=n[T]),o(b,m)>=0)break;n[e]=b,e=g}n[e]=m}}function C_(i,e){return i<e?-1:i>e?1:0}function k_(i,e=1,n=!1){let o=1/0,c=1/0,m=-1/0,g=-1/0;const b=i[0];for(let U=0;U<b.length;U++){const j=b[U];(!U||j.x<o)&&(o=j.x),(!U||j.y<c)&&(c=j.y),(!U||j.x>m)&&(m=j.x),(!U||j.y>g)&&(g=j.y)}const T=Math.min(m-o,g-c);let C=T/2;const P=new I_([],E_);if(T===0)return new ce(o,c);for(let U=o;U<m;U+=T)for(let j=c;j<g;j+=T)P.push(new Ol(U+C,j+C,C,i));let F=function(U){let j=0,W=0,ee=0;const re=U[0];for(let fe=0,oe=re.length,ve=oe-1;fe<oe;ve=fe++){const Ie=re[fe],Ne=re[ve],yt=Ie.x*Ne.y-Ne.x*Ie.y;W+=(Ie.x+Ne.x)*yt,ee+=(Ie.y+Ne.y)*yt,j+=3*yt}return new Ol(W/j,ee/j,0,U)}(i),O=P.length;for(;P.length;){const U=P.pop();(U.d>F.d||!F.d)&&(F=U,n&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,O)),U.max-F.d<=e||(C=U.h/2,P.push(new Ol(U.p.x-C,U.p.y-C,C,i)),P.push(new Ol(U.p.x+C,U.p.y-C,C,i)),P.push(new Ol(U.p.x-C,U.p.y+C,C,i)),P.push(new Ol(U.p.x+C,U.p.y+C,C,i)),O+=4)}return n&&(console.log(`num probes: ${O}`),console.log(`best distance: ${F.d}`)),F.p}function E_(i,e){return e.max-i.max}function Ol(i,e,n,o){this.p=new ce(i,e),this.h=n,this.d=function(c,m){let g=!1,b=1/0;for(let T=0;T<m.length;T++){const C=m[T];for(let P=0,F=C.length,O=F-1;P<F;O=P++){const U=C[P],j=C[O];U.y>c.y!=j.y>c.y&&c.x<(j.x-U.x)*(c.y-U.y)/(j.y-U.y)+U.x&&(g=!g),b=Math.min(b,nd(c,U,j))}}return(g?1:-1)*Math.sqrt(b)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var Ar;s.aq=void 0,(Ar=s.aq||(s.aq={}))[Ar.center=1]="center",Ar[Ar.left=2]="left",Ar[Ar.right=3]="right",Ar[Ar.top=4]="top",Ar[Ar.bottom=5]="bottom",Ar[Ar["top-left"]=6]="top-left",Ar[Ar["top-right"]=7]="top-right",Ar[Ar["bottom-left"]=8]="bottom-left",Ar[Ar["bottom-right"]=9]="bottom-right";const Ga=7,vh=Number.POSITIVE_INFINITY;function wp(i,e){return e[1]!==vh?function(n,o,c){let m=0,g=0;switch(o=Math.abs(o),c=Math.abs(c),n){case"top-right":case"top-left":case"top":g=c-Ga;break;case"bottom-right":case"bottom-left":case"bottom":g=-c+Ga}switch(n){case"top-right":case"bottom-right":case"right":m=-o;break;case"top-left":case"bottom-left":case"left":m=o}return[m,g]}(i,e[0],e[1]):function(n,o){let c=0,m=0;o<0&&(o=0);const g=o/Math.SQRT2;switch(n){case"top-right":case"top-left":m=g-Ga;break;case"bottom-right":case"bottom-left":m=-g+Ga;break;case"bottom":m=-o+Ga;break;case"top":m=o-Ga}switch(n){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=o;break;case"right":c=-o}return[c,m]}(i,e[0])}function Sp(i,e,n){var o;const c=i.layout,m=(o=c.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},n);if(m){const b=m.values,T=[];for(let C=0;C<b.length;C+=2){const P=T[C]=b[C],F=b[C+1].map(O=>O*er);P.startsWith("top")?F[1]-=Ga:P.startsWith("bottom")&&(F[1]+=Ga),T[C+1]=F}return new Gn(T)}const g=c.get("text-variable-anchor");if(g){let b;b=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(e,{},n)*er,vh]:c.get("text-offset").evaluate(e,{},n).map(C=>C*er);const T=[];for(const C of g)T.push(C,wp(C,b));return new Gn(T)}return null}function bh(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function M_(i,e,n,o,c,m,g,b,T,C,P){let F=m.textMaxSize.evaluate(e,{});F===void 0&&(F=g);const O=i.layers[0].layout,U=O.get("icon-offset").evaluate(e,{},P),j=Ip(n.horizontal),W=g/24,ee=i.tilePixelRatio*W,re=i.tilePixelRatio*F/24,fe=i.tilePixelRatio*b,oe=i.tilePixelRatio*O.get("symbol-spacing"),ve=O.get("text-padding")*i.tilePixelRatio,Ie=function(Xe,Vt,Pt,di=1){const mn=Xe.get("icon-padding").evaluate(Vt,{},Pt),bn=mn&&mn.values;return[bn[0]*di,bn[1]*di,bn[2]*di,bn[3]*di]}(O,e,P,i.tilePixelRatio),Ne=O.get("text-max-angle")/180*Math.PI,yt=O.get("text-rotation-alignment")!=="viewport"&&O.get("symbol-placement")!=="point",Ct=O.get("icon-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",gt=O.get("symbol-placement"),pt=oe/2,ot=O.get("icon-text-fit");let St;o&&ot!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(St=Hd(o,n.vertical,ot,O.get("icon-text-fit-padding"),U,W)),j&&(o=Hd(o,j,ot,O.get("icon-text-fit-padding"),U,W)));const lt=(Xe,Vt)=>{Vt.x<0||Vt.x>=Hn||Vt.y<0||Vt.y>=Hn||function(Pt,di,mn,bn,tr,Po,Qr,Xn,br,Pr,$r,eo,ir,nr,Nr,to,Vr,ho,po,rr,Ti,Ur,Lr,or,os){const vs=Pt.addToLineVertexArray(di,mn);let bs,sa,ss,Vo,fo=0,aa=0,Mc=0,Mp=0,Eh=-1,Mh=-1;const la={};let Ap=ia("");if(Pt.allowVerticalPlacement&&bn.vertical){const jr=Xn.layout.get("text-rotate").evaluate(Ti,{},or)+90;ss=new wu(br,di,Pr,$r,eo,bn.vertical,ir,nr,Nr,jr),Qr&&(Vo=new wu(br,di,Pr,$r,eo,Qr,Vr,ho,Nr,jr))}if(tr){const jr=Xn.layout.get("icon-rotate").evaluate(Ti,{}),Uo=Xn.layout.get("icon-text-fit")!=="none",hl=bp(tr,jr,Lr,Uo),ws=Qr?bp(Qr,jr,Lr,Uo):void 0;sa=new wu(br,di,Pr,$r,eo,tr,Vr,ho,!1,jr),fo=4*hl.length;const dl=Pt.iconSizeData;let Os=null;dl.kind==="source"?(Os=[Rs*Xn.layout.get("icon-size").evaluate(Ti,{})],Os[0]>ja&&rt(`${Pt.layerIds[0]}: Value for "icon-size" is >= ${Ic}. Reduce your "icon-size".`)):dl.kind==="composite"&&(Os=[Rs*Ur.compositeIconSizes[0].evaluate(Ti,{},or),Rs*Ur.compositeIconSizes[1].evaluate(Ti,{},or)],(Os[0]>ja||Os[1]>ja)&&rt(`${Pt.layerIds[0]}: Value for "icon-size" is >= ${Ic}. Reduce your "icon-size".`)),Pt.addSymbols(Pt.icon,hl,Os,rr,po,Ti,s.ai.none,di,vs.lineStartIndex,vs.lineLength,-1,or),Eh=Pt.icon.placedSymbolArray.length-1,ws&&(aa=4*ws.length,Pt.addSymbols(Pt.icon,ws,Os,rr,po,Ti,s.ai.vertical,di,vs.lineStartIndex,vs.lineLength,-1,or),Mh=Pt.icon.placedSymbolArray.length-1)}const Pp=Object.keys(bn.horizontal);for(const jr of Pp){const Uo=bn.horizontal[jr];if(!bs){Ap=ia(Uo.text);const ws=Xn.layout.get("text-rotate").evaluate(Ti,{},or);bs=new wu(br,di,Pr,$r,eo,Uo,ir,nr,Nr,ws)}const hl=Uo.positionedLines.length===1;if(Mc+=Tp(Pt,di,Uo,Po,Xn,Nr,Ti,to,vs,bn.vertical?s.ai.horizontal:s.ai.horizontalOnly,hl?Pp:[jr],la,Eh,Ur,or),hl)break}bn.vertical&&(Mp+=Tp(Pt,di,bn.vertical,Po,Xn,Nr,Ti,to,vs,s.ai.vertical,["vertical"],la,Mh,Ur,or));const L_=bs?bs.boxStartIndex:Pt.collisionBoxArray.length,z_=bs?bs.boxEndIndex:Pt.collisionBoxArray.length,D_=ss?ss.boxStartIndex:Pt.collisionBoxArray.length,F_=ss?ss.boxEndIndex:Pt.collisionBoxArray.length,R_=sa?sa.boxStartIndex:Pt.collisionBoxArray.length,O_=sa?sa.boxEndIndex:Pt.collisionBoxArray.length,B_=Vo?Vo.boxStartIndex:Pt.collisionBoxArray.length,N_=Vo?Vo.boxEndIndex:Pt.collisionBoxArray.length;let xs=-1;const Tu=(jr,Uo)=>jr&&jr.circleDiameter?Math.max(jr.circleDiameter,Uo):Uo;xs=Tu(bs,xs),xs=Tu(ss,xs),xs=Tu(sa,xs),xs=Tu(Vo,xs);const Lp=xs>-1?1:0;Lp&&(xs*=os/er),Pt.glyphOffsetArray.length>=Fl.MAX_GLYPHS&&rt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ti.sortKey!==void 0&&Pt.addToSortKeyRanges(Pt.symbolInstances.length,Ti.sortKey);const V_=Sp(Xn,Ti,or),[U_,j_]=function(jr,Uo){const hl=jr.length,ws=Uo==null?void 0:Uo.values;if((ws==null?void 0:ws.length)>0)for(let dl=0;dl<ws.length;dl+=2){const Os=ws[dl+1];jr.emplaceBack(s.aq[ws[dl]],Os[0],Os[1])}return[hl,jr.length]}(Pt.textAnchorOffsets,V_);Pt.symbolInstances.emplaceBack(di.x,di.y,la.right>=0?la.right:-1,la.center>=0?la.center:-1,la.left>=0?la.left:-1,la.vertical||-1,Eh,Mh,Ap,L_,z_,D_,F_,R_,O_,B_,N_,Pr,Mc,Mp,fo,aa,Lp,0,ir,xs,U_,j_)}(i,Vt,Xe,n,o,c,St,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,ee,[ve,ve,ve,ve],yt,T,fe,Ie,Ct,U,e,m,C,P,g)};if(gt==="line")for(const Xe of fp(e.geometry,0,0,Hn,Hn)){const Vt=T_(Xe,oe,Ne,n.vertical||j,o,24,re,i.overscaling,Hn);for(const Pt of Vt)j&&A_(i,j.text,pt,Pt)||lt(Xe,Pt)}else if(gt==="line-center"){for(const Xe of e.geometry)if(Xe.length>1){const Vt=S_(Xe,Ne,n.vertical||j,o,24,re);Vt&&lt(Xe,Vt)}}else if(e.type==="Polygon")for(const Xe of Qu(e.geometry,0)){const Vt=k_(Xe,16);lt(Xe[0],new Za(Vt.x,Vt.y,0))}else if(e.type==="LineString")for(const Xe of e.geometry)lt(Xe,new Za(Xe[0].x,Xe[0].y,0));else if(e.type==="Point")for(const Xe of e.geometry)for(const Vt of Xe)lt([Vt],new Za(Vt.x,Vt.y,0))}function Tp(i,e,n,o,c,m,g,b,T,C,P,F,O,U,j){const W=function(fe,oe,ve,Ie,Ne,yt,Ct,gt){const pt=Ie.layout.get("text-rotate").evaluate(yt,{})*Math.PI/180,ot=[];for(const St of oe.positionedLines)for(const lt of St.positionedGlyphs){if(!lt.rect)continue;const Xe=lt.rect||{};let Vt=Vd+1,Pt=!0,di=1,mn=0;const bn=(Ne||gt)&&lt.vertical,tr=lt.metrics.advance*lt.scale/2;if(gt&&oe.verticalizable&&(mn=St.lineOffset/2-(lt.imageName?-(er-lt.metrics.width*lt.scale)/2:(lt.scale-1)*er)),lt.imageName){const rr=Ct[lt.imageName];Pt=rr.sdf,di=rr.pixelRatio,Vt=uo/di}const Po=Ne?[lt.x+tr,lt.y]:[0,0];let Qr=Ne?[0,0]:[lt.x+tr+ve[0],lt.y+ve[1]-mn],Xn=[0,0];bn&&(Xn=Qr,Qr=[0,0]);const br=lt.metrics.isDoubleResolution?2:1,Pr=(lt.metrics.left-Vt)*lt.scale-tr+Qr[0],$r=(-lt.metrics.top-Vt)*lt.scale+Qr[1],eo=Pr+Xe.w/br*lt.scale/di,ir=$r+Xe.h/br*lt.scale/di,nr=new ce(Pr,$r),Nr=new ce(eo,$r),to=new ce(Pr,ir),Vr=new ce(eo,ir);if(bn){const rr=new ce(-tr,tr-Sc),Ti=-Math.PI/2,Ur=er/2-tr,Lr=new ce(5-Sc-Ur,-(lt.imageName?Ur:0)),or=new ce(...Xn);nr._rotateAround(Ti,rr)._add(Lr)._add(or),Nr._rotateAround(Ti,rr)._add(Lr)._add(or),to._rotateAround(Ti,rr)._add(Lr)._add(or),Vr._rotateAround(Ti,rr)._add(Lr)._add(or)}if(pt){const rr=Math.sin(pt),Ti=Math.cos(pt),Ur=[Ti,-rr,rr,Ti];nr._matMult(Ur),Nr._matMult(Ur),to._matMult(Ur),Vr._matMult(Ur)}const ho=new ce(0,0),po=new ce(0,0);ot.push({tl:nr,tr:Nr,bl:to,br:Vr,tex:Xe,writingMode:oe.writingMode,glyphOffset:Po,sectionIndex:lt.sectionIndex,isSDF:Pt,pixelOffsetTL:ho,pixelOffsetBR:po,minFontScaleX:0,minFontScaleY:0})}return ot}(0,n,b,c,m,g,o,i.allowVerticalPlacement),ee=i.textSizeData;let re=null;ee.kind==="source"?(re=[Rs*c.layout.get("text-size").evaluate(g,{})],re[0]>ja&&rt(`${i.layerIds[0]}: Value for "text-size" is >= ${Ic}. Reduce your "text-size".`)):ee.kind==="composite"&&(re=[Rs*U.compositeTextSizes[0].evaluate(g,{},j),Rs*U.compositeTextSizes[1].evaluate(g,{},j)],(re[0]>ja||re[1]>ja)&&rt(`${i.layerIds[0]}: Value for "text-size" is >= ${Ic}. Reduce your "text-size".`)),i.addSymbols(i.text,W,re,b,m,g,C,e,T.lineStartIndex,T.lineLength,O,j);for(const fe of P)F[fe]=i.text.placedSymbolArray.length-1;return 4*W.length}function Ip(i){for(const e in i)return i[e];return null}function A_(i,e,n,o){const c=i.compareText;if(e in c){const m=c[e];for(let g=m.length-1;g>=0;g--)if(o.dist(m[g])<n)return!0}else c[e]=[];return c[e].push(o),!1}const Cp=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class xh{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=o>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const m=Cp[15&o];if(!m)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[b]=new Uint32Array(e,4,1);return new xh(b,g,m,e)}constructor(e,n=64,o=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const m=Cp.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,b=e*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-b%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${o}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+T,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+b+T),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+T,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=n,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return wh(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:g,nodeSize:b}=this,T=[0,m.length-1,0],C=[];for(;T.length;){const P=T.pop()||0,F=T.pop()||0,O=T.pop()||0;if(F-O<=b){for(let ee=O;ee<=F;ee++){const re=g[2*ee],fe=g[2*ee+1];re>=e&&re<=o&&fe>=n&&fe<=c&&C.push(m[ee])}continue}const U=O+F>>1,j=g[2*U],W=g[2*U+1];j>=e&&j<=o&&W>=n&&W<=c&&C.push(m[U]),(P===0?e<=j:n<=W)&&(T.push(O),T.push(U-1),T.push(1-P)),(P===0?o>=j:c>=W)&&(T.push(U+1),T.push(F),T.push(1-P))}return C}within(e,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:m,nodeSize:g}=this,b=[0,c.length-1,0],T=[],C=o*o;for(;b.length;){const P=b.pop()||0,F=b.pop()||0,O=b.pop()||0;if(F-O<=g){for(let ee=O;ee<=F;ee++)Ep(m[2*ee],m[2*ee+1],e,n)<=C&&T.push(c[ee]);continue}const U=O+F>>1,j=m[2*U],W=m[2*U+1];Ep(j,W,e,n)<=C&&T.push(c[U]),(P===0?e-o<=j:n-o<=W)&&(b.push(O),b.push(U-1),b.push(1-P)),(P===0?e+o>=j:n+o>=W)&&(b.push(U+1),b.push(F),b.push(1-P))}return T}}function wh(i,e,n,o,c,m){if(c-o<=n)return;const g=o+c>>1;kp(i,e,g,o,c,m),wh(i,e,n,o,g-1,1-m),wh(i,e,n,g+1,c,1-m)}function kp(i,e,n,o,c,m){for(;c>o;){if(c-o>600){const C=c-o+1,P=n-o+1,F=Math.log(C),O=.5*Math.exp(2*F/3),U=.5*Math.sqrt(F*O*(C-O)/C)*(P-C/2<0?-1:1);kp(i,e,n,Math.max(o,Math.floor(n-P*O/C+U)),Math.min(c,Math.floor(n+(C-P)*O/C+U)),m)}const g=e[2*n+m];let b=o,T=c;for(kc(i,e,o,n),e[2*c+m]>g&&kc(i,e,o,c);b<T;){for(kc(i,e,b,T),b++,T--;e[2*b+m]<g;)b++;for(;e[2*T+m]>g;)T--}e[2*o+m]===g?kc(i,e,o,T):(T++,kc(i,e,T,c)),T<=n&&(o=T+1),n<=T&&(c=T-1)}}function kc(i,e,n,o){Sh(i,n,o),Sh(e,2*n,2*o),Sh(e,2*n+1,2*o+1)}function Sh(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}function Ep(i,e,n,o){const c=i-n,m=e-o;return c*c+m*m}var Th;s.bh=void 0,(Th=s.bh||(s.bh={})).create="create",Th.load="load",Th.fullLoad="fullLoad";let Su=null,Ec=[];const Ih=1e3/60,Ch="loadTime",kh="fullLoadTime",P_={mark(i){performance.mark(i)},frame(i){const e=i;Su!=null&&Ec.push(e-Su),Su=e},clearMetrics(){Su=null,Ec=[],performance.clearMeasures(Ch),performance.clearMeasures(kh);for(const i in s.bh)performance.clearMarks(s.bh[i])},getPerformanceMetrics(){performance.measure(Ch,s.bh.create,s.bh.load),performance.measure(kh,s.bh.create,s.bh.fullLoad);const i=performance.getEntriesByName(Ch)[0].duration,e=performance.getEntriesByName(kh)[0].duration,n=Ec.length,o=1/(Ec.reduce((m,g)=>m+g,0)/n/1e3),c=Ec.filter(m=>m>Ih).reduce((m,g)=>m+(g-Ih)/Ih,0);return{loadTime:i,fullLoadTime:e,fps:o,percentDroppedFrames:c/(n+c)*100,totalFrames:n}}};s.$=function(i,e,n){var o,c,m,g,b,T,C,P,F,O,U,j,W=n[0],ee=n[1],re=n[2];return e===i?(i[12]=e[0]*W+e[4]*ee+e[8]*re+e[12],i[13]=e[1]*W+e[5]*ee+e[9]*re+e[13],i[14]=e[2]*W+e[6]*ee+e[10]*re+e[14],i[15]=e[3]*W+e[7]*ee+e[11]*re+e[15]):(c=e[1],m=e[2],g=e[3],b=e[4],T=e[5],C=e[6],P=e[7],F=e[8],O=e[9],U=e[10],j=e[11],i[0]=o=e[0],i[1]=c,i[2]=m,i[3]=g,i[4]=b,i[5]=T,i[6]=C,i[7]=P,i[8]=F,i[9]=O,i[10]=U,i[11]=j,i[12]=o*W+b*ee+F*re+e[12],i[13]=c*W+T*ee+O*re+e[13],i[14]=m*W+C*ee+U*re+e[14],i[15]=g*W+P*ee+j*re+e[15]),i},s.A=Ml,s.B=_r,s.C=class{constructor(i,e,n){this.receive=o=>{const c=o.data,m=c.id;if(m&&(!c.targetMapId||this.mapId===c.targetMapId))if(c.type==="<cancel>"){delete this.tasks[m];const g=this.cancelCallbacks[m];delete this.cancelCallbacks[m],g&&g()}else At()||c.mustQueue?(this.tasks[m]=c,this.taskQueue.push(m),this.invoker.trigger()):this.processTask(m,c)},this.process=()=>{if(!this.taskQueue.length)return;const o=this.taskQueue.shift(),c=this.tasks[o];delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),c&&this.processTask(o,c)},this.target=i,this.parent=e,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new x_(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=At()?i:window}send(i,e,n,o,c=!1){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[m]=n);const g=[],b={id:m,type:i,hasCallback:!!n,targetMapId:o,mustQueue:c,sourceMapId:this.mapId,data:Xr(e,g)};return this.target.postMessage(b,{transfer:g}),{cancel:()=>{n&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}processTask(i,e){if(e.type==="<response>"){const n=this.callbacks[i];delete this.callbacks[i],n&&(e.error?n(Oo(e.error)):n(null,Oo(e.data)))}else{let n=!1;const o=[],c=e.hasCallback?(b,T)=>{n=!0,delete this.cancelCallbacks[i];const C={id:i,type:"<response>",sourceMapId:this.mapId,error:b?Xr(b):null,data:Xr(T,o)};this.target.postMessage(C,{transfer:o})}:b=>{n=!0};let m=null;const g=Oo(e.data);if(this.parent[e.type])m=this.parent[e.type](e.sourceMapId,g,c);else if("getWorkerSource"in this.parent){const b=e.type.split(".");m=this.parent.getWorkerSource(e.sourceMapId,b[0],g.source)[b[1]](g,c)}else c(new Error(`Could not find function ${e.type}`));!n&&m&&m.cancel&&(this.cancelCallbacks[i]=m.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.D=Ot,s.E=Zn,s.F=function(i,e){const n={};for(let o=0;o<e.length;o++){const c=e[o];c in i&&(n[c]=i[c])}return n},s.G=ip,s.H=np,s.I=lh,s.J=De,s.K=Ze,s.L=qa,s.M=Ei,s.N=Hn,s.O=No,s.P=ce,s.Q=Tn,s.R=Bo,s.S=fn,s.T=Qc,s.U=yu,s.V=class extends ea{},s.W=yh,s.X=function(i,e){const n=window.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let o=0;o<i.length;o++){const c=window.document.createElement("source");Fi(i[o])||(n.crossOrigin="Anonymous"),c.src=i[o],n.appendChild(c)}return{cancel:()=>{}}},s.Y=it,s.Z=function(){var i=new Ml(16);return Ml!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},s._=D,s.a=Rn,s.a$=class extends N{},s.a0=function(i,e,n){var o=n[0],c=n[1],m=n[2];return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*c,i[5]=e[5]*c,i[6]=e[6]*c,i[7]=e[7]*c,i[8]=e[8]*m,i[9]=e[9]*m,i[10]=e[10]*m,i[11]=e[11]*m,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},s.a1=ad,s.a2=function(){return bt++},s.a3=J,s.a4=Fl,s.a5=function(){lo.isLoading()||lo.isLoaded()||ic()!=="deferred"||Yc()},s.a6=Ma,s.a7=cl,s.a8=pn,s.a9=up,s.aA=nl,s.aB=function(i){i=i.slice();const e=Object.create(null);for(let n=0;n<i.length;n++)e[i[n].id]=i[n];for(let n=0;n<i.length;n++)"ref"in i[n]&&(i[n]=mr(i[n],e[i[n].ref]));return i},s.aC=function(i){if(i.type==="custom")return new b_(i);switch(i.type){case"background":return new g_(i);case"circle":return new im(i);case"fill":return new wm(i);case"fill-extrusion":return new Om(i);case"heatmap":return new rm(i);case"hillshade":return new sm(i);case"line":return new Gm(i);case"raster":return new v_(i);case"symbol":return new gu(i)}},s.aD=$e,s.aE=function(i,e){if(!i)return[{command:ii.setStyle,args:[e]}];let n=[];try{if(!Ai(i.version,e.version))return[{command:ii.setStyle,args:[e]}];Ai(i.center,e.center)||n.push({command:ii.setCenter,args:[e.center]}),Ai(i.zoom,e.zoom)||n.push({command:ii.setZoom,args:[e.zoom]}),Ai(i.bearing,e.bearing)||n.push({command:ii.setBearing,args:[e.bearing]}),Ai(i.pitch,e.pitch)||n.push({command:ii.setPitch,args:[e.pitch]}),Ai(i.sprite,e.sprite)||n.push({command:ii.setSprite,args:[e.sprite]}),Ai(i.glyphs,e.glyphs)||n.push({command:ii.setGlyphs,args:[e.glyphs]}),Ai(i.transition,e.transition)||n.push({command:ii.setTransition,args:[e.transition]}),Ai(i.light,e.light)||n.push({command:ii.setLight,args:[e.light]});const o={},c=[];(function(g,b,T,C){let P;for(P in b=b||{},g=g||{})Object.prototype.hasOwnProperty.call(g,P)&&(Object.prototype.hasOwnProperty.call(b,P)||Jn(P,T,C));for(P in b)Object.prototype.hasOwnProperty.call(b,P)&&(Object.prototype.hasOwnProperty.call(g,P)?Ai(g[P],b[P])||(g[P].type==="geojson"&&b[P].type==="geojson"&&en(g,b,P)?T.push({command:ii.setGeoJSONSourceData,args:[P,b[P].data]}):Sn(P,b,T,C)):wr(P,b,T))})(i.sources,e.sources,c,o);const m=[];i.layers&&i.layers.forEach(g=>{o[g.source]?n.push({command:ii.removeLayer,args:[g.id]}):m.push(g)}),n=n.concat(c),function(g,b,T){b=b||[];const C=(g=g||[]).map(Ji),P=b.map(Ji),F=g.reduce(wo,{}),O=b.reduce(wo,{}),U=C.slice(),j=Object.create(null);let W,ee,re,fe,oe,ve,Ie;for(W=0,ee=0;W<C.length;W++)re=C[W],Object.prototype.hasOwnProperty.call(O,re)?ee++:(T.push({command:ii.removeLayer,args:[re]}),U.splice(U.indexOf(re,ee),1));for(W=0,ee=0;W<P.length;W++)re=P[P.length-1-W],U[U.length-1-W]!==re&&(Object.prototype.hasOwnProperty.call(F,re)?(T.push({command:ii.removeLayer,args:[re]}),U.splice(U.lastIndexOf(re,U.length-ee),1)):ee++,ve=U[U.length-W],T.push({command:ii.addLayer,args:[O[re],ve]}),U.splice(U.length-W,0,re),j[re]=!0);for(W=0;W<P.length;W++)if(re=P[W],fe=F[re],oe=O[re],!j[re]&&!Ai(fe,oe))if(Ai(fe.source,oe.source)&&Ai(fe["source-layer"],oe["source-layer"])&&Ai(fe.type,oe.type)){for(Ie in pi(fe.layout,oe.layout,T,re,null,ii.setLayoutProperty),pi(fe.paint,oe.paint,T,re,null,ii.setPaintProperty),Ai(fe.filter,oe.filter)||T.push({command:ii.setFilter,args:[re,oe.filter]}),Ai(fe.minzoom,oe.minzoom)&&Ai(fe.maxzoom,oe.maxzoom)||T.push({command:ii.setLayerZoomRange,args:[re,oe.minzoom,oe.maxzoom]}),fe)Object.prototype.hasOwnProperty.call(fe,Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&(Ie.indexOf("paint.")===0?pi(fe[Ie],oe[Ie],T,re,Ie.slice(6),ii.setPaintProperty):Ai(fe[Ie],oe[Ie])||T.push({command:ii.setLayerProperty,args:[re,Ie,oe[Ie]]}));for(Ie in oe)Object.prototype.hasOwnProperty.call(oe,Ie)&&!Object.prototype.hasOwnProperty.call(fe,Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&(Ie.indexOf("paint.")===0?pi(fe[Ie],oe[Ie],T,re,Ie.slice(6),ii.setPaintProperty):Ai(fe[Ie],oe[Ie])||T.push({command:ii.setLayerProperty,args:[re,Ie,oe[Ie]]}))}else T.push({command:ii.removeLayer,args:[re]}),ve=U[U.lastIndexOf(re)+1],T.push({command:ii.addLayer,args:[oe,ve]})}(m,e.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:ii.setStyle,args:[e]}]}return n},s.aF=function(i){const e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},s.aG=function i(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let o=0;o<e.length;o++)if(!i(e[o],n[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&n!==null){if(typeof n!="object"||Object.keys(e).length!==Object.keys(n).length)return!1;for(const o in e)if(!i(e[o],n[o]))return!1;return!0}return e===n},s.aH=qt,s.aI=Fe,s.aJ=rl,s.aK=function(i){return i({pluginStatus:Kr,pluginURL:Ds}),rl.on("pluginStateChange",i),i},s.aL=class extends na{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},s.aM=kl,s.aN=class extends na{constructor(i,e){super(i,e),this.current=Vu}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},s.aO=iu,s.aP=class extends na{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},s.aQ=class extends na{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},s.aR=nu,s.aS=function(i,e,n,o,c,m,g){var b=1/(e-n),T=1/(o-c),C=1/(m-g);return i[0]=-2*b,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*T,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*C,i[11]=0,i[12]=(e+n)*b,i[13]=(c+o)*T,i[14]=(g+m)*C,i[15]=1,i},s.aT=Ri,s.aU=tm,s.aV=class extends l{},s.aW=Km,s.aX=class extends _{},s.aY=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},s.aZ=dd,s.a_=et,s.aa=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,c,m)=>{const g=c||m;return e[o]=!g||g.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e},s.ab=function(i,e){const n=[];for(const o in i)o in e||n.push(o);return n},s.ac=function(i){if(hi==null){const e=i.navigator?i.navigator.userAgent:null;hi=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return hi},s.ad=xt,s.ae=function(i,e,n){var o=Math.sin(n),c=Math.cos(n),m=e[0],g=e[1],b=e[2],T=e[3],C=e[4],P=e[5],F=e[6],O=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=m*c+C*o,i[1]=g*c+P*o,i[2]=b*c+F*o,i[3]=T*c+O*o,i[4]=C*c-m*o,i[5]=P*c-g*o,i[6]=F*c-b*o,i[7]=O*c-T*o,i},s.af=function(i){var e=new Ml(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},s.ag=au,s.ah=function(i,e){let n=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:c,minZoom:m,maxZoom:g}=i,b=c?xt(Cr.interpolationFactor(c,e,m,g),0,1):0;i.kind==="camera"?o=_r.number(i.minSize,i.maxSize,b):n=b}return{uSizeT:n,uSize:o}},s.aj=function(i,{uSize:e,uSizeT:n},{lowerSize:o,upperSize:c}){return i.kind==="source"?o/Rs:i.kind==="composite"?_r.number(o/Rs,c/Rs,n):e},s.ak=dh,s.al=function(i,e,n,o){const c=e.y-i.y,m=e.x-i.x,g=o.y-n.y,b=o.x-n.x,T=g*m-b*c;if(T===0)return null;const C=(b*(i.y-n.y)-g*(i.x-n.x))/T;return new ce(i.x+C*m,i.y+C*c)},s.am=fp,s.an=td,s.ao=Gu,s.ap=er,s.ar=hh,s.as=function(i,e){var n=e[0],o=e[1],c=e[2],m=e[3],g=e[4],b=e[5],T=e[6],C=e[7],P=e[8],F=e[9],O=e[10],U=e[11],j=e[12],W=e[13],ee=e[14],re=e[15],fe=n*b-o*g,oe=n*T-c*g,ve=n*C-m*g,Ie=o*T-c*b,Ne=o*C-m*b,yt=c*C-m*T,Ct=P*W-F*j,gt=P*ee-O*j,pt=P*re-U*j,ot=F*ee-O*W,St=F*re-U*W,lt=O*re-U*ee,Xe=fe*lt-oe*St+ve*ot+Ie*pt-Ne*gt+yt*Ct;return Xe?(i[0]=(b*lt-T*St+C*ot)*(Xe=1/Xe),i[1]=(c*St-o*lt-m*ot)*Xe,i[2]=(W*yt-ee*Ne+re*Ie)*Xe,i[3]=(O*Ne-F*yt-U*Ie)*Xe,i[4]=(T*pt-g*lt-C*gt)*Xe,i[5]=(n*lt-c*pt+m*gt)*Xe,i[6]=(ee*ve-j*yt-re*oe)*Xe,i[7]=(P*yt-O*ve+U*oe)*Xe,i[8]=(g*St-b*pt+C*Ct)*Xe,i[9]=(o*pt-n*St-m*Ct)*Xe,i[10]=(j*Ne-W*ve+re*fe)*Xe,i[11]=(F*ve-P*Ne-U*fe)*Xe,i[12]=(b*gt-g*ot-T*Ct)*Xe,i[13]=(n*ot-o*gt+c*Ct)*Xe,i[14]=(W*oe-j*Ie-ee*fe)*Xe,i[15]=(P*Ie-F*oe+O*fe)*Xe,i):null},s.at=bh,s.au=uh,s.av=xh,s.aw=function(){const i={},e=Me.$version;for(const n in Me.$root){const o=Me.$root[n];if(o.required){let c=null;c=n==="version"?e:o.type==="array"?[]:{},c!=null&&(i[n]=c)}}return i},s.ax=ii,s.ay=gs,s.az=oi,s.b=function(i,e){const n=new Blob([new Uint8Array(i)],{type:"image/png"});createImageBitmap(n).then(o=>{e(null,o)}).catch(o=>{e(new Error(`Could not load image because of ${o.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},s.b0=yr,s.b1=function(i,e){var n=i[0],o=i[1],c=i[2],m=i[3],g=i[4],b=i[5],T=i[6],C=i[7],P=i[8],F=i[9],O=i[10],U=i[11],j=i[12],W=i[13],ee=i[14],re=i[15],fe=e[0],oe=e[1],ve=e[2],Ie=e[3],Ne=e[4],yt=e[5],Ct=e[6],gt=e[7],pt=e[8],ot=e[9],St=e[10],lt=e[11],Xe=e[12],Vt=e[13],Pt=e[14],di=e[15];return Math.abs(n-fe)<=Yr*Math.max(1,Math.abs(n),Math.abs(fe))&&Math.abs(o-oe)<=Yr*Math.max(1,Math.abs(o),Math.abs(oe))&&Math.abs(c-ve)<=Yr*Math.max(1,Math.abs(c),Math.abs(ve))&&Math.abs(m-Ie)<=Yr*Math.max(1,Math.abs(m),Math.abs(Ie))&&Math.abs(g-Ne)<=Yr*Math.max(1,Math.abs(g),Math.abs(Ne))&&Math.abs(b-yt)<=Yr*Math.max(1,Math.abs(b),Math.abs(yt))&&Math.abs(T-Ct)<=Yr*Math.max(1,Math.abs(T),Math.abs(Ct))&&Math.abs(C-gt)<=Yr*Math.max(1,Math.abs(C),Math.abs(gt))&&Math.abs(P-pt)<=Yr*Math.max(1,Math.abs(P),Math.abs(pt))&&Math.abs(F-ot)<=Yr*Math.max(1,Math.abs(F),Math.abs(ot))&&Math.abs(O-St)<=Yr*Math.max(1,Math.abs(O),Math.abs(St))&&Math.abs(U-lt)<=Yr*Math.max(1,Math.abs(U),Math.abs(lt))&&Math.abs(j-Xe)<=Yr*Math.max(1,Math.abs(j),Math.abs(Xe))&&Math.abs(W-Vt)<=Yr*Math.max(1,Math.abs(W),Math.abs(Vt))&&Math.abs(ee-Pt)<=Yr*Math.max(1,Math.abs(ee),Math.abs(Pt))&&Math.abs(re-di)<=Yr*Math.max(1,Math.abs(re),Math.abs(di))},s.b2=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},s.b3=function(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i[3]=e[3]*n[3],i},s.b4=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},s.b5=Qe,s.b6=ap,s.b7=rp,s.b8=function(i,e,n,o,c){var m,g=1/Math.tan(e/2);return i[0]=g/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,c!=null&&c!==1/0?(i[10]=(c+o)*(m=1/(o-c)),i[14]=2*c*o*m):(i[10]=-1,i[14]=-2*o),i},s.b9=function(i,e,n){var o=Math.sin(n),c=Math.cos(n),m=e[4],g=e[5],b=e[6],T=e[7],C=e[8],P=e[9],F=e[10],O=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=m*c+C*o,i[5]=g*c+P*o,i[6]=b*c+F*o,i[7]=T*c+O*o,i[8]=C*c-m*o,i[9]=P*c-g*o,i[10]=F*c-b*o,i[11]=O*c-T*o,i},s.bA=q,s.bB=zd,s.bC=ka,s.bD=lo,s.ba=Le,s.bb=tt,s.bc=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},s.bd=class extends al{},s.be=_h,s.bf=op,s.bg=P_,s.bi=nt,s.bj=function(i,e,n=!1){if(Kr===Yl||Kr===Ql||Kr===$l)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ds=qe.resolveURL(i),Kr=Yl,ec=e,tc(),n||Yc()},s.bk=ic,s.bl=function(i,e){const n={};for(let c=0;c<i.length;c++){const m=e&&e[i[c].id]||_s(i[c]);e&&(e[i[c].id]=m);let g=n[m];g||(g=n[m]=[]),g.push(i[c])}const o=[];for(const c in n)o.push(n[c]);return o},s.bm=ft,s.bn=cp,s.bo=hp,s.bp=jd,s.bq=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Hn/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],n=e.layout,o=e._unevaluatedLayout._values,c={layoutIconSize:o["icon-size"].possiblyEvaluate(new pn(i.bucket.zoom+1),i.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new pn(i.bucket.zoom+1),i.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new pn(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:C,maxZoom:P}=i.bucket.textSizeData;c.compositeTextSizes=[o["text-size"].possiblyEvaluate(new pn(C),i.canonical),o["text-size"].possiblyEvaluate(new pn(P),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:C,maxZoom:P}=i.bucket.iconSizeData;c.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new pn(C),i.canonical),o["icon-size"].possiblyEvaluate(new pn(P),i.canonical)]}const m=n.get("text-line-height")*er,g=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",b=n.get("text-keep-upright"),T=n.get("text-size");for(const C of i.bucket.features){const P=n.get("text-font").evaluate(C,{},i.canonical).join(","),F=T.evaluate(C,{},i.canonical),O=c.layoutTextSize.evaluate(C,{},i.canonical),U=c.layoutIconSize.evaluate(C,{},i.canonical),j={horizontal:{},vertical:void 0},W=C.text;let ee,re=[0,0];if(W){const ve=W.toString(),Ie=n.get("text-letter-spacing").evaluate(C,{},i.canonical)*er,Ne=Ls(ve)?Ie:0,yt=n.get("text-anchor").evaluate(C,{},i.canonical),Ct=Sp(e,C,i.canonical);if(!Ct){const lt=n.get("text-radial-offset").evaluate(C,{},i.canonical);re=lt?wp(yt,[lt*er,vh]):n.get("text-offset").evaluate(C,{},i.canonical).map(Xe=>Xe*er)}let gt=g?"center":n.get("text-justify").evaluate(C,{},i.canonical);const pt=n.get("symbol-placement"),ot=pt==="point"?n.get("text-max-width").evaluate(C,{},i.canonical)*er:0,St=()=>{i.bucket.allowVerticalPlacement&&Fa(ve)&&(j.vertical=fu(W,i.glyphMap,i.glyphPositions,i.imagePositions,P,ot,m,yt,"left",Ne,re,s.ai.vertical,!0,pt,O,F))};if(!g&&Ct){const lt=new Set;if(gt==="auto")for(let Vt=0;Vt<Ct.values.length;Vt+=2)lt.add(bh(Ct.values[Vt]));else lt.add(gt);let Xe=!1;for(const Vt of lt)if(!j.horizontal[Vt])if(Xe)j.horizontal[Vt]=j.horizontal[0];else{const Pt=fu(W,i.glyphMap,i.glyphPositions,i.imagePositions,P,ot,m,"center",Vt,Ne,re,s.ai.horizontal,!1,pt,O,F);Pt&&(j.horizontal[Vt]=Pt,Xe=Pt.positionedLines.length===1)}St()}else{gt==="auto"&&(gt=bh(yt));const lt=fu(W,i.glyphMap,i.glyphPositions,i.imagePositions,P,ot,m,yt,gt,Ne,re,s.ai.horizontal,!1,pt,O,F);lt&&(j.horizontal[gt]=lt),St(),Fa(ve)&&g&&b&&(j.vertical=fu(W,i.glyphMap,i.glyphPositions,i.imagePositions,P,ot,m,yt,gt,Ne,re,s.ai.vertical,!1,pt,O,F))}}let fe=!1;if(C.icon&&C.icon.name){const ve=i.imageMap[C.icon.name];ve&&(ee=d_(i.imagePositions[C.icon.name],n.get("icon-offset").evaluate(C,{},i.canonical),n.get("icon-anchor").evaluate(C,{},i.canonical)),fe=!!ve.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=fe:i.bucket.sdfIcons!==fe&&rt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ve.pixelRatio!==i.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const oe=Ip(j.horizontal)||j.vertical;i.bucket.iconsInText=!!oe&&oe.iconsInText,(oe||ee)&&M_(i.bucket,C,j,ee,i.imageMap,c,O,U,re,fe,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},s.br=rh,s.bs=th,s.bt=nh,s.bu=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},s.bv=sh,s.bw=Va,s.bx=function(i,e,n,o,c){return D(this,void 0,void 0,function*(){if(Ze())try{return yield Ei(i,e,n,o,c)}catch{}return function(m,g,b,T,C){const P=m.width,F=m.height;Mi&&Nt||(Mi=new OffscreenCanvas(P,F),Nt=Mi.getContext("2d",{willReadFrequently:!0})),Mi.width=P,Mi.height=F,Nt.drawImage(m,0,0,P,F);const O=Nt.getImageData(g,b,T,C);return Nt.clearRect(0,0,P,F),O.data}(i,e,n,o,c)})},s.by=lp,s.bz=M,s.c=Zt,s.d=function(i,e){const n=new Image;n.onload=()=>{e(null,n),URL.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame(()=>{n.src=On})},n.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const o=new Blob([new Uint8Array(i)],{type:"image/png"});n.src=i.byteLength?URL.createObjectURL(o):On},s.e=Dt,s.f=function(i,e){return xn(Dt(i,{type:"json"}),e)},s.g=vt,s.h=qe,s.i=At,s.j=fr,s.k=Zr,s.l=Je,s.m=xn,s.n=function(i){return new sh(i).readFields(s_,[])},s.o=function(i,e,n){if(!i.length)return n(null,[]);let o=i.length;const c=new Array(i.length);let m=null;i.forEach((g,b)=>{e(g,(T,C)=>{T&&(m=T),c[b]=C,--o==0&&n(m,c)})})},s.p=Ud,s.q=mc,s.r=Vn,s.s=Fi,s.t=Yi,s.u=at,s.v=Me,s.w=rt,s.x=so,s.y=Ro,s.z=function([i,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(n),y:i*Math.sin(e)*Math.sin(n),z:i*Math.cos(n)}}}),S(["./shared"],function(s){class D{constructor(R){this.keyCache={},R&&this.replace(R)}replace(R){this._layerConfigs={},this._layers={},this.update(R,[])}update(R,B){for(const Y of R){this._layerConfigs[Y.id]=Y;const $=this._layers[Y.id]=s.aC(Y);$._featureFilter=s.a6($.filter),this.keyCache[Y.id]&&delete this.keyCache[Y.id]}for(const Y of B)delete this.keyCache[Y],delete this._layerConfigs[Y],delete this._layers[Y];this.familiesBySource={};const Z=s.bl(Object.values(this._layerConfigs),this.keyCache);for(const Y of Z){const $=Y.map(Re=>this._layers[Re.id]),_e=$[0];if(_e.visibility==="none")continue;const ae=_e.source||"";let ne=this.familiesBySource[ae];ne||(ne=this.familiesBySource[ae]={});const ue=_e.sourceLayer||"_geojsonTileLayer";let ze=ne[ue];ze||(ze=ne[ue]=[]),ze.push($)}}}class M{constructor(R){const B={},Z=[];for(const ae in R){const ne=R[ae],ue=B[ae]={};for(const ze in ne){const Re=ne[+ze];if(!Re||Re.bitmap.width===0||Re.bitmap.height===0)continue;const Oe={x:0,y:0,w:Re.bitmap.width+2,h:Re.bitmap.height+2};Z.push(Oe),ue[ze]={rect:Oe,metrics:Re.metrics}}}const{w:Y,h:$}=s.p(Z),_e=new s.q({width:Y||1,height:$||1});for(const ae in R){const ne=R[ae];for(const ue in ne){const ze=ne[+ue];if(!ze||ze.bitmap.width===0||ze.bitmap.height===0)continue;const Re=B[ae][ue].rect;s.q.copy(ze.bitmap,_e,{x:0,y:0},{x:Re.x+1,y:Re.y+1},ze.bitmap)}}this.image=_e,this.positions=B}}s.bm("GlyphAtlas",M);class q{constructor(R){this.tileID=new s.O(R.tileID.overscaledZ,R.tileID.wrap,R.tileID.canonical.z,R.tileID.canonical.x,R.tileID.canonical.y),this.uid=R.uid,this.zoom=R.zoom,this.pixelRatio=R.pixelRatio,this.tileSize=R.tileSize,this.source=R.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=R.showCollisionBoxes,this.collectResourceTiming=!!R.collectResourceTiming,this.returnDependencies=!!R.returnDependencies,this.promoteId=R.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(R,B,Z,Y,$){this.status="parsing",this.data=R,this.collisionBoxArray=new s.a3;const _e=new s.bn(Object.keys(R.layers).sort()),ae=new s.bo(this.tileID,this.promoteId);ae.bucketLayerIDs=[];const ne={},ue={featureIndex:ae,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Z},ze=B.familiesBySource[this.source];for(const Ii in ze){const wi=R.layers[Ii];if(!wi)continue;wi.version===1&&s.w(`Vector tile source "${this.source}" layer "${Ii}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ar=_e.encode(Ii),Hi=[];for(let Mn=0;Mn<wi.length;Mn++){const Bn=wi.feature(Mn),Wr=ae.getId(Bn,Ii);Hi.push({feature:Bn,id:Wr,index:Mn,sourceLayerIndex:ar})}for(const Mn of ze[Ii]){const Bn=Mn[0];Bn.source!==this.source&&s.w(`layer.source = ${Bn.source} does not equal this.source = ${this.source}`),Bn.minzoom&&this.zoom<Math.floor(Bn.minzoom)||Bn.maxzoom&&this.zoom>=Bn.maxzoom||Bn.visibility!=="none"&&(te(Mn,this.zoom,Z),(ne[Bn.id]=Bn.createBucket({index:ae.bucketLayerIDs.length,layers:Mn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ar,sourceID:this.source})).populate(Hi,ue,this.tileID.canonical),ae.bucketLayerIDs.push(Mn.map(Wr=>Wr.id)))}}let Re,Oe,kt,Jt;const wt=s.aH(ue.glyphDependencies,Ii=>Object.keys(Ii).map(Number));this.inFlightDependencies.forEach(Ii=>Ii==null?void 0:Ii.cancel()),this.inFlightDependencies=[];const Rt=++this.dependencySentinel;Object.keys(wt).length?this.inFlightDependencies.push(Y.send("getGlyphs",{uid:this.uid,stacks:wt,source:this.source,tileID:this.tileID,type:"glyphs"},(Ii,wi)=>{Rt===this.dependencySentinel&&(Re||(Re=Ii,Oe=wi,si.call(this)))})):Oe={};const ei=Object.keys(ue.iconDependencies);ei.length?this.inFlightDependencies.push(Y.send("getImages",{icons:ei,source:this.source,tileID:this.tileID,type:"icons"},(Ii,wi)=>{Rt===this.dependencySentinel&&(Re||(Re=Ii,kt=wi,si.call(this)))})):kt={};const zi=Object.keys(ue.patternDependencies);function si(){if(Re)return $(Re);if(Oe&&kt&&Jt){const Ii=new M(Oe),wi=new s.bp(kt,Jt);for(const ar in ne){const Hi=ne[ar];Hi instanceof s.a4?(te(Hi.layers,this.zoom,Z),s.bq({bucket:Hi,glyphMap:Oe,glyphPositions:Ii.positions,imageMap:kt,imagePositions:wi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Hi.hasPattern&&(Hi instanceof s.br||Hi instanceof s.bs||Hi instanceof s.bt)&&(te(Hi.layers,this.zoom,Z),Hi.addFeatures(ue,this.tileID.canonical,wi.patternPositions))}this.status="done",$(null,{buckets:Object.values(ne).filter(ar=>!ar.isEmpty()),featureIndex:ae,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ii.image,imageAtlas:wi,glyphMap:this.returnDependencies?Oe:null,iconMap:this.returnDependencies?kt:null,glyphPositions:this.returnDependencies?Ii.positions:null})}}zi.length?this.inFlightDependencies.push(Y.send("getImages",{icons:zi,source:this.source,tileID:this.tileID,type:"patterns"},(Ii,wi)=>{Rt===this.dependencySentinel&&(Re||(Re=Ii,Jt=wi,si.call(this)))})):Jt={},si.call(this)}}function te(K,R,B){const Z=new s.a8(R);for(const Y of K)Y.recalculate(Z,B)}function ce(K,R){const B=s.l(K.request,(Z,Y,$,_e)=>{if(Z)R(Z);else if(Y)try{const ae=new s.bw.VectorTile(new s.bv(Y));R(null,{vectorTile:ae,rawData:Y,cacheControl:$,expires:_e})}catch(ae){const ne=new Uint8Array(Y);let ue=`Unable to parse the tile at ${K.request.url}, `;ue+=ne[0]===31&&ne[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ae.messge}`,R(new Error(ue))}});return()=>{B.cancel(),R()}}class be{constructor(R,B,Z,Y){this.actor=R,this.layerIndex=B,this.availableImages=Z,this.loadVectorData=Y||ce,this.fetching={},this.loading={},this.loaded={}}loadTile(R,B){const Z=R.uid;this.loading||(this.loading={});const Y=!!(R&&R.request&&R.request.collectResourceTiming)&&new s.bu(R.request),$=this.loading[Z]=new q(R);$.abort=this.loadVectorData(R,(_e,ae)=>{if(delete this.loading[Z],_e||!ae)return $.status="done",this.loaded[Z]=$,B(_e);const ne=ae.rawData,ue={};ae.expires&&(ue.expires=ae.expires),ae.cacheControl&&(ue.cacheControl=ae.cacheControl);const ze={};if(Y){const Re=Y.finish();Re&&(ze.resourceTiming=JSON.parse(JSON.stringify(Re)))}$.vectorTile=ae.vectorTile,$.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor,(Re,Oe)=>{if(delete this.fetching[Z],Re||!Oe)return B(Re);B(null,s.e({rawTileData:ne.slice(0)},Oe,ue,ze))}),this.loaded=this.loaded||{},this.loaded[Z]=$,this.fetching[Z]={rawTileData:ne,cacheControl:ue,resourceTiming:ze}})}reloadTile(R,B){const Z=this.loaded,Y=R.uid;if(Z&&Z[Y]){const $=Z[Y];$.showCollisionBoxes=R.showCollisionBoxes,$.status==="parsing"?$.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor,(_e,ae)=>{if(_e||!ae)return B(_e,ae);let ne;if(this.fetching[Y]){const{rawTileData:ue,cacheControl:ze,resourceTiming:Re}=this.fetching[Y];delete this.fetching[Y],ne=s.e({rawTileData:ue.slice(0)},ae,ze,Re)}else ne=ae;B(null,ne)}):$.status==="done"&&($.vectorTile?$.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor,B):B())}}abortTile(R,B){const Z=this.loading,Y=R.uid;Z&&Z[Y]&&Z[Y].abort&&(Z[Y].abort(),delete Z[Y]),B()}removeTile(R,B){const Z=this.loaded,Y=R.uid;Z&&Z[Y]&&delete Z[Y],B()}}class he{constructor(){this.loaded={}}loadTile(R,B){return s._(this,void 0,void 0,function*(){const{uid:Z,encoding:Y,rawImageData:$,redFactor:_e,greenFactor:ae,blueFactor:ne,baseShift:ue}=R,ze=$.width+2,Re=$.height+2,Oe=s.a($)?new s.R({width:ze,height:Re},yield s.bx($,-1,-1,ze,Re)):$,kt=new s.by(Z,Oe,Y,_e,ae,ne,ue);this.loaded=this.loaded||{},this.loaded[Z]=kt,B(null,kt)})}removeTile(R){const B=this.loaded,Z=R.uid;B&&B[Z]&&delete B[Z]}}function ye(K,R){if(K.length!==0){me(K[0],R);for(var B=1;B<K.length;B++)me(K[B],!R)}}function me(K,R){for(var B=0,Z=0,Y=0,$=K.length,_e=$-1;Y<$;_e=Y++){var ae=(K[Y][0]-K[_e][0])*(K[_e][1]+K[Y][1]),ne=B+ae;Z+=Math.abs(B)>=Math.abs(ae)?B-ne+ae:ae-ne+B,B=ne}B+Z>=0!=!!R&&K.reverse()}var Te=s.bz(function K(R,B){var Z,Y=R&&R.type;if(Y==="FeatureCollection")for(Z=0;Z<R.features.length;Z++)K(R.features[Z],B);else if(Y==="GeometryCollection")for(Z=0;Z<R.geometries.length;Z++)K(R.geometries[Z],B);else if(Y==="Feature")K(R.geometry,B);else if(Y==="Polygon")ye(R.coordinates,B);else if(Y==="MultiPolygon")for(Z=0;Z<R.coordinates.length;Z++)ye(R.coordinates[Z],B);return R});const De=s.bw.VectorTileFeature.prototype.toGeoJSON;var Ze={exports:{}},Le=s.bA,tt=s.bw.VectorTileFeature,xt=Qe;function Qe(K,R){this.options=R||{},this.features=K,this.length=K.length}function Dt(K,R){this.id=typeof K.id=="number"?K.id:void 0,this.type=K.type,this.rawGeometry=K.type===1?[K.geometry]:K.geometry,this.properties=K.tags,this.extent=R||4096}Qe.prototype.feature=function(K){return new Dt(this.features[K],this.options.extent)},Dt.prototype.loadGeometry=function(){var K=this.rawGeometry;this.geometry=[];for(var R=0;R<K.length;R++){for(var B=K[R],Z=[],Y=0;Y<B.length;Y++)Z.push(new Le(B[Y][0],B[Y][1]));this.geometry.push(Z)}return this.geometry},Dt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var K=this.geometry,R=1/0,B=-1/0,Z=1/0,Y=-1/0,$=0;$<K.length;$++)for(var _e=K[$],ae=0;ae<_e.length;ae++){var ne=_e[ae];R=Math.min(R,ne.x),B=Math.max(B,ne.x),Z=Math.min(Z,ne.y),Y=Math.max(Y,ne.y)}return[R,Z,B,Y]},Dt.prototype.toGeoJSON=tt.prototype.toGeoJSON;var bt=s.bB,qt=xt;function Fe(K){var R=new bt;return function(B,Z){for(var Y in B.layers)Z.writeMessage(3,$e,B.layers[Y])}(K,R),R.finish()}function $e(K,R){var B;R.writeVarintField(15,K.version||1),R.writeStringField(1,K.name||""),R.writeVarintField(5,K.extent||4096);var Z={keys:[],values:[],keycache:{},valuecache:{}};for(B=0;B<K.length;B++)Z.feature=K.feature(B),R.writeMessage(2,Wt,Z);var Y=Z.keys;for(B=0;B<Y.length;B++)R.writeStringField(3,Y[B]);var $=Z.values;for(B=0;B<$.length;B++)R.writeMessage(4,hi,$[B])}function Wt(K,R){var B=K.feature;B.id!==void 0&&R.writeVarintField(1,B.id),R.writeMessage(2,rt,K),R.writeVarintField(3,B.type),R.writeMessage(4,At,B)}function rt(K,R){var B=K.feature,Z=K.keys,Y=K.values,$=K.keycache,_e=K.valuecache;for(var ae in B.properties){var ne=B.properties[ae],ue=$[ae];if(ne!==null){ue===void 0&&(Z.push(ae),$[ae]=ue=Z.length-1),R.writeVarint(ue);var ze=typeof ne;ze!=="string"&&ze!=="boolean"&&ze!=="number"&&(ne=JSON.stringify(ne));var Re=ze+":"+ne,Oe=_e[Re];Oe===void 0&&(Y.push(ne),_e[Re]=Oe=Y.length-1),R.writeVarint(Oe)}}}function Qt(K,R){return(R<<3)+(7&K)}function Bt(K){return K<<1^K>>31}function At(K,R){for(var B=K.loadGeometry(),Z=K.type,Y=0,$=0,_e=B.length,ae=0;ae<_e;ae++){var ne=B[ae],ue=1;Z===1&&(ue=ne.length),R.writeVarint(Qt(1,ue));for(var ze=Z===3?ne.length-1:ne.length,Re=0;Re<ze;Re++){Re===1&&Z!==1&&R.writeVarint(Qt(2,ze-1));var Oe=ne[Re].x-Y,kt=ne[Re].y-$;R.writeVarint(Bt(Oe)),R.writeVarint(Bt(kt)),Y+=Oe,$+=kt}Z===3&&R.writeVarint(Qt(7,1))}}function hi(K,R){var B=typeof K;B==="string"?R.writeStringField(1,K):B==="boolean"?R.writeBooleanField(7,K):B==="number"&&(K%1!=0?R.writeDoubleField(3,K):K<0?R.writeSVarintField(6,K):R.writeVarintField(5,K))}Ze.exports=Fe,Ze.exports.fromVectorTileJs=Fe,Ze.exports.fromGeojsonVt=function(K,R){R=R||{};var B={};for(var Z in K)B[Z]=new qt(K[Z].features,R),B[Z].name=Z,B[Z].version=R.version,B[Z].extent=R.extent;return Fe({layers:B})},Ze.exports.GeoJSONWrapper=qt;var Rn=s.bz(Ze.exports);const On={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:K=>K},Ei=Math.fround||(Mi=new Float32Array(1),K=>(Mi[0]=+K,Mi[0]));var Mi;const Nt=3,bi=5,ji=6;class qe{constructor(R){this.options=Object.assign(Object.create(On),R),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(R){const{log:B,minZoom:Z,maxZoom:Y}=this.options;B&&console.time("total time");const $=`prepare ${R.length} points`;B&&console.time($),this.points=R;const _e=[];for(let ne=0;ne<R.length;ne++){const ue=R[ne];if(!ue.geometry)continue;const[ze,Re]=ue.geometry.coordinates,Oe=Ei(oi(ze)),kt=Ei(vt(Re));_e.push(Oe,kt,1/0,ne,-1,1),this.options.reduce&&_e.push(0)}let ae=this.trees[Y+1]=this._createTree(_e);B&&console.timeEnd($);for(let ne=Y;ne>=Z;ne--){const ue=+Date.now();ae=this.trees[ne]=this._createTree(this._cluster(ae,ne)),B&&console.log("z%d: %d clusters in %dms",ne,ae.numItems,+Date.now()-ue)}return B&&console.timeEnd("total time"),this}getClusters(R,B){let Z=((R[0]+180)%360+360)%360-180;const Y=Math.max(-90,Math.min(90,R[1]));let $=R[2]===180?180:((R[2]+180)%360+360)%360-180;const _e=Math.max(-90,Math.min(90,R[3]));if(R[2]-R[0]>=360)Z=-180,$=180;else if(Z>$){const Re=this.getClusters([Z,Y,180,_e],B),Oe=this.getClusters([-180,Y,$,_e],B);return Re.concat(Oe)}const ae=this.trees[this._limitZoom(B)],ne=ae.range(oi(Z),vt(_e),oi($),vt(Y)),ue=ae.data,ze=[];for(const Re of ne){const Oe=this.stride*Re;ze.push(ue[Oe+bi]>1?Zt(ue,Oe,this.clusterProps):this.points[ue[Oe+Nt]])}return ze}getChildren(R){const B=this._getOriginId(R),Z=this._getOriginZoom(R),Y="No cluster with the specified id.",$=this.trees[Z];if(!$)throw new Error(Y);const _e=$.data;if(B*this.stride>=_e.length)throw new Error(Y);const ae=this.options.radius/(this.options.extent*Math.pow(2,Z-1)),ne=$.within(_e[B*this.stride],_e[B*this.stride+1],ae),ue=[];for(const ze of ne){const Re=ze*this.stride;_e[Re+4]===R&&ue.push(_e[Re+bi]>1?Zt(_e,Re,this.clusterProps):this.points[_e[Re+Nt]])}if(ue.length===0)throw new Error(Y);return ue}getLeaves(R,B,Z){const Y=[];return this._appendLeaves(Y,R,B=B||10,Z=Z||0,0),Y}getTile(R,B,Z){const Y=this.trees[this._limitZoom(R)],$=Math.pow(2,R),{extent:_e,radius:ae}=this.options,ne=ae/_e,ue=(Z-ne)/$,ze=(Z+1+ne)/$,Re={features:[]};return this._addTileFeatures(Y.range((B-ne)/$,ue,(B+1+ne)/$,ze),Y.data,B,Z,$,Re),B===0&&this._addTileFeatures(Y.range(1-ne/$,ue,1,ze),Y.data,$,Z,$,Re),B===$-1&&this._addTileFeatures(Y.range(0,ue,ne/$,ze),Y.data,-1,Z,$,Re),Re.features.length?Re:null}getClusterExpansionZoom(R){let B=this._getOriginZoom(R)-1;for(;B<=this.options.maxZoom;){const Z=this.getChildren(R);if(B++,Z.length!==1)break;R=Z[0].properties.cluster_id}return B}_appendLeaves(R,B,Z,Y,$){const _e=this.getChildren(B);for(const ae of _e){const ne=ae.properties;if(ne&&ne.cluster?$+ne.point_count<=Y?$+=ne.point_count:$=this._appendLeaves(R,ne.cluster_id,Z,Y,$):$<Y?$++:R.push(ae),R.length===Z)break}return $}_createTree(R){const B=new s.av(R.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Z=0;Z<R.length;Z+=this.stride)B.add(R[Z],R[Z+1]);return B.finish(),B.data=R,B}_addTileFeatures(R,B,Z,Y,$,_e){for(const ae of R){const ne=ae*this.stride,ue=B[ne+bi]>1;let ze,Re,Oe;if(ue)ze=nt(B,ne,this.clusterProps),Re=B[ne],Oe=B[ne+1];else{const wt=this.points[B[ne+Nt]];ze=wt.properties;const[Rt,ei]=wt.geometry.coordinates;Re=oi(Rt),Oe=vt(ei)}const kt={type:1,geometry:[[Math.round(this.options.extent*(Re*$-Z)),Math.round(this.options.extent*(Oe*$-Y))]],tags:ze};let Jt;Jt=ue||this.options.generateId?B[ne+Nt]:this.points[B[ne+Nt]].id,Jt!==void 0&&(kt.id=Jt),_e.features.push(kt)}}_limitZoom(R){return Math.max(this.options.minZoom,Math.min(Math.floor(+R),this.options.maxZoom+1))}_cluster(R,B){const{radius:Z,extent:Y,reduce:$,minPoints:_e}=this.options,ae=Z/(Y*Math.pow(2,B)),ne=R.data,ue=[],ze=this.stride;for(let Re=0;Re<ne.length;Re+=ze){if(ne[Re+2]<=B)continue;ne[Re+2]=B;const Oe=ne[Re],kt=ne[Re+1],Jt=R.within(ne[Re],ne[Re+1],ae),wt=ne[Re+bi];let Rt=wt;for(const ei of Jt){const zi=ei*ze;ne[zi+2]>B&&(Rt+=ne[zi+bi])}if(Rt>wt&&Rt>=_e){let ei,zi=Oe*wt,si=kt*wt,Ii=-1;const wi=((Re/ze|0)<<5)+(B+1)+this.points.length;for(const ar of Jt){const Hi=ar*ze;if(ne[Hi+2]<=B)continue;ne[Hi+2]=B;const Mn=ne[Hi+bi];zi+=ne[Hi]*Mn,si+=ne[Hi+1]*Mn,ne[Hi+4]=wi,$&&(ei||(ei=this._map(ne,Re,!0),Ii=this.clusterProps.length,this.clusterProps.push(ei)),$(ei,this._map(ne,Hi)))}ne[Re+4]=wi,ue.push(zi/Rt,si/Rt,1/0,wi,-1,Rt),$&&ue.push(Ii)}else{for(let ei=0;ei<ze;ei++)ue.push(ne[Re+ei]);if(Rt>1)for(const ei of Jt){const zi=ei*ze;if(!(ne[zi+2]<=B)){ne[zi+2]=B;for(let si=0;si<ze;si++)ue.push(ne[zi+si])}}}}return ue}_getOriginId(R){return R-this.points.length>>5}_getOriginZoom(R){return(R-this.points.length)%32}_map(R,B,Z){if(R[B+bi]>1){const _e=this.clusterProps[R[B+ji]];return Z?Object.assign({},_e):_e}const Y=this.points[R[B+Nt]].properties,$=this.options.map(Y);return Z&&$===Y?Object.assign({},$):$}}function Zt(K,R,B){return{type:"Feature",id:K[R+Nt],properties:nt(K,R,B),geometry:{type:"Point",coordinates:[(Z=K[R],360*(Z-.5)),qi(K[R+1])]}};var Z}function nt(K,R,B){const Z=K[R+bi],Y=Z>=1e4?`${Math.round(Z/1e3)}k`:Z>=1e3?Math.round(Z/100)/10+"k":Z,$=K[R+ji],_e=$===-1?{}:Object.assign({},B[$]);return Object.assign(_e,{cluster:!0,cluster_id:K[R+Nt],point_count:Z,point_count_abbreviated:Y})}function oi(K){return K/360+.5}function vt(K){const R=Math.sin(K*Math.PI/180),B=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return B<0?0:B>1?1:B}function qi(K){const R=(180-360*K)*Math.PI/180;return 360*Math.atan(Math.exp(R))/Math.PI-90}function xn(K,R,B,Z){for(var Y,$=Z,_e=B-R>>1,ae=B-R,ne=K[R],ue=K[R+1],ze=K[B],Re=K[B+1],Oe=R+3;Oe<B;Oe+=3){var kt=Je(K[Oe],K[Oe+1],ne,ue,ze,Re);if(kt>$)Y=Oe,$=kt;else if(kt===$){var Jt=Math.abs(Oe-_e);Jt<ae&&(Y=Oe,ae=Jt)}}$>Z&&(Y-R>3&&xn(K,R,Y,Z),K[Y+2]=$,B-Y>3&&xn(K,Y,B,Z))}function Je(K,R,B,Z,Y,$){var _e=Y-B,ae=$-Z;if(_e!==0||ae!==0){var ne=((K-B)*_e+(R-Z)*ae)/(_e*_e+ae*ae);ne>1?(B=Y,Z=$):ne>0&&(B+=_e*ne,Z+=ae*ne)}return(_e=K-B)*_e+(ae=R-Z)*ae}function Fi(K,R,B,Z){var Y={id:K===void 0?null:K,type:R,geometry:B,tags:Z,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function($){var _e=$.geometry,ae=$.type;if(ae==="Point"||ae==="MultiPoint"||ae==="LineString")wn($,_e);else if(ae==="Polygon"||ae==="MultiLineString")for(var ne=0;ne<_e.length;ne++)wn($,_e[ne]);else if(ae==="MultiPolygon")for(ne=0;ne<_e.length;ne++)for(var ue=0;ue<_e[ne].length;ue++)wn($,_e[ne][ue])}(Y),Y}function wn(K,R){for(var B=0;B<R.length;B+=3)K.minX=Math.min(K.minX,R[B]),K.minY=Math.min(K.minY,R[B+1]),K.maxX=Math.max(K.maxX,R[B]),K.maxY=Math.max(K.maxY,R[B+1])}function xi(K,R,B,Z){if(R.geometry){var Y=R.geometry.coordinates,$=R.geometry.type,_e=Math.pow(B.tolerance/((1<<B.maxZoom)*B.extent),2),ae=[],ne=R.id;if(B.promoteId?ne=R.properties[B.promoteId]:B.generateId&&(ne=Z||0),$==="Point")Zr(Y,ae);else if($==="MultiPoint")for(var ue=0;ue<Y.length;ue++)Zr(Y[ue],ae);else if($==="LineString")fr(Y,ae,_e,!1);else if($==="MultiLineString"){if(B.lineMetrics){for(ue=0;ue<Y.length;ue++)fr(Y[ue],ae=[],_e,!1),K.push(Fi(ne,"LineString",ae,R.properties));return}Zn(Y,ae,_e,!1)}else if($==="Polygon")Zn(Y,ae,_e,!0);else{if($!=="MultiPolygon"){if($==="GeometryCollection"){for(ue=0;ue<R.geometry.geometries.length;ue++)xi(K,{id:ne,geometry:R.geometry.geometries[ue],properties:R.properties},B,Z);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ue=0;ue<Y.length;ue++){var ze=[];Zn(Y[ue],ze,_e,!0),ae.push(ze)}}K.push(Fi(ne,$,ae,R.properties))}}function Zr(K,R){R.push(Me(K[0])),R.push(Kn(K[1])),R.push(0)}function fr(K,R,B,Z){for(var Y,$,_e=0,ae=0;ae<K.length;ae++){var ne=Me(K[ae][0]),ue=Kn(K[ae][1]);R.push(ne),R.push(ue),R.push(0),ae>0&&(_e+=Z?(Y*ue-ne*$)/2:Math.sqrt(Math.pow(ne-Y,2)+Math.pow(ue-$,2))),Y=ne,$=ue}var ze=R.length-3;R[2]=1,xn(R,0,ze,B),R[ze+2]=1,R.size=Math.abs(_e),R.start=0,R.end=R.size}function Zn(K,R,B,Z){for(var Y=0;Y<K.length;Y++){var $=[];fr(K[Y],$,B,Z),R.push($)}}function Me(K){return K/360+.5}function Kn(K){var R=Math.sin(K*Math.PI/180),B=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return B<0?0:B>1?1:B}function mr(K,R,B,Z,Y,$,_e,ae){if(Z/=R,$>=(B/=R)&&_e<Z)return K;if(_e<B||$>=Z)return null;for(var ne=[],ue=0;ue<K.length;ue++){var ze=K[ue],Re=ze.geometry,Oe=ze.type,kt=Y===0?ze.minX:ze.minY,Jt=Y===0?ze.maxX:ze.maxY;if(kt>=B&&Jt<Z)ne.push(ze);else if(!(Jt<B||kt>=Z)){var wt=[];if(Oe==="Point"||Oe==="MultiPoint")Ai(Re,wt,B,Z,Y);else if(Oe==="LineString")ii(Re,wt,B,Z,Y,!1,ae.lineMetrics);else if(Oe==="MultiLineString")Jn(Re,wt,B,Z,Y,!1);else if(Oe==="Polygon")Jn(Re,wt,B,Z,Y,!0);else if(Oe==="MultiPolygon")for(var Rt=0;Rt<Re.length;Rt++){var ei=[];Jn(Re[Rt],ei,B,Z,Y,!0),ei.length&&wt.push(ei)}if(wt.length){if(ae.lineMetrics&&Oe==="LineString"){for(Rt=0;Rt<wt.length;Rt++)ne.push(Fi(ze.id,Oe,wt[Rt],ze.tags));continue}Oe!=="LineString"&&Oe!=="MultiLineString"||(wt.length===1?(Oe="LineString",wt=wt[0]):Oe="MultiLineString"),Oe!=="Point"&&Oe!=="MultiPoint"||(Oe=wt.length===3?"Point":"MultiPoint"),ne.push(Fi(ze.id,Oe,wt,ze.tags))}}}return ne.length?ne:null}function Ai(K,R,B,Z,Y){for(var $=0;$<K.length;$+=3){var _e=K[$+Y];_e>=B&&_e<=Z&&(R.push(K[$]),R.push(K[$+1]),R.push(K[$+2]))}}function ii(K,R,B,Z,Y,$,_e){for(var ae,ne,ue=wr(K),ze=Y===0?en:pi,Re=K.start,Oe=0;Oe<K.length-3;Oe+=3){var kt=K[Oe],Jt=K[Oe+1],wt=K[Oe+2],Rt=K[Oe+3],ei=K[Oe+4],zi=Y===0?kt:Jt,si=Y===0?Rt:ei,Ii=!1;_e&&(ae=Math.sqrt(Math.pow(kt-Rt,2)+Math.pow(Jt-ei,2))),zi<B?si>B&&(ne=ze(ue,kt,Jt,Rt,ei,B),_e&&(ue.start=Re+ae*ne)):zi>Z?si<Z&&(ne=ze(ue,kt,Jt,Rt,ei,Z),_e&&(ue.start=Re+ae*ne)):Sn(ue,kt,Jt,wt),si<B&&zi>=B&&(ne=ze(ue,kt,Jt,Rt,ei,B),Ii=!0),si>Z&&zi<=Z&&(ne=ze(ue,kt,Jt,Rt,ei,Z),Ii=!0),!$&&Ii&&(_e&&(ue.end=Re+ae*ne),R.push(ue),ue=wr(K)),_e&&(Re+=ae)}var wi=K.length-3;kt=K[wi],Jt=K[wi+1],wt=K[wi+2],(zi=Y===0?kt:Jt)>=B&&zi<=Z&&Sn(ue,kt,Jt,wt),wi=ue.length-3,$&&wi>=3&&(ue[wi]!==ue[0]||ue[wi+1]!==ue[1])&&Sn(ue,ue[0],ue[1],ue[2]),ue.length&&R.push(ue)}function wr(K){var R=[];return R.size=K.size,R.start=K.start,R.end=K.end,R}function Jn(K,R,B,Z,Y,$){for(var _e=0;_e<K.length;_e++)ii(K[_e],R,B,Z,Y,$,!1)}function Sn(K,R,B,Z){K.push(R),K.push(B),K.push(Z)}function en(K,R,B,Z,Y,$){var _e=($-R)/(Z-R);return K.push($),K.push(B+(Y-B)*_e),K.push(1),_e}function pi(K,R,B,Z,Y,$){var _e=($-B)/(Y-B);return K.push(R+(Z-R)*_e),K.push($),K.push(1),_e}function Ji(K,R){for(var B=[],Z=0;Z<K.length;Z++){var Y,$=K[Z],_e=$.type;if(_e==="Point"||_e==="MultiPoint"||_e==="LineString")Y=wo($.geometry,R);else if(_e==="MultiLineString"||_e==="Polygon"){Y=[];for(var ae=0;ae<$.geometry.length;ae++)Y.push(wo($.geometry[ae],R))}else if(_e==="MultiPolygon")for(Y=[],ae=0;ae<$.geometry.length;ae++){for(var ne=[],ue=0;ue<$.geometry[ae].length;ue++)ne.push(wo($.geometry[ae][ue],R));Y.push(ne)}B.push(Fi($.id,_e,Y,$.tags))}return B}function wo(K,R){var B=[];B.size=K.size,K.start!==void 0&&(B.start=K.start,B.end=K.end);for(var Z=0;Z<K.length;Z+=3)B.push(K[Z]+R,K[Z+1],K[Z+2]);return B}function it(K,R){if(K.transformed)return K;var B,Z,Y,$=1<<K.z,_e=K.x,ae=K.y;for(B=0;B<K.features.length;B++){var ne=K.features[B],ue=ne.geometry,ze=ne.type;if(ne.geometry=[],ze===1)for(Z=0;Z<ue.length;Z+=2)ne.geometry.push(zr(ue[Z],ue[Z+1],R,$,_e,ae));else for(Z=0;Z<ue.length;Z++){var Re=[];for(Y=0;Y<ue[Z].length;Y+=2)Re.push(zr(ue[Z][Y],ue[Z][Y+1],R,$,_e,ae));ne.geometry.push(Re)}}return K.transformed=!0,K}function zr(K,R,B,Z,Y,$){return[Math.round(B*(K*Z-Y)),Math.round(B*(R*Z-$))]}function _n(K,R,B,Z,Y){for(var $=R===Y.maxZoom?0:Y.tolerance/((1<<R)*Y.extent),_e={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:B,y:Z,z:R,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ae=0;ae<K.length;ae++){_e.numFeatures++,hs(_e,K[ae],$,Y);var ne=K[ae].minX,ue=K[ae].minY,ze=K[ae].maxX,Re=K[ae].maxY;ne<_e.minX&&(_e.minX=ne),ue<_e.minY&&(_e.minY=ue),ze>_e.maxX&&(_e.maxX=ze),Re>_e.maxY&&(_e.maxY=Re)}return _e}function hs(K,R,B,Z){var Y=R.geometry,$=R.type,_e=[];if($==="Point"||$==="MultiPoint")for(var ae=0;ae<Y.length;ae+=3)_e.push(Y[ae]),_e.push(Y[ae+1]),K.numPoints++,K.numSimplified++;else if($==="LineString")Sr(_e,Y,K,B,!1,!1);else if($==="MultiLineString"||$==="Polygon")for(ae=0;ae<Y.length;ae++)Sr(_e,Y[ae],K,B,$==="Polygon",ae===0);else if($==="MultiPolygon")for(var ne=0;ne<Y.length;ne++){var ue=Y[ne];for(ae=0;ae<ue.length;ae++)Sr(_e,ue[ae],K,B,!0,ae===0)}if(_e.length){var ze=R.tags||null;if($==="LineString"&&Z.lineMetrics){for(var Re in ze={},R.tags)ze[Re]=R.tags[Re];ze.mapbox_clip_start=Y.start/Y.size,ze.mapbox_clip_end=Y.end/Y.size}var Oe={geometry:_e,type:$==="Polygon"||$==="MultiPolygon"?3:$==="LineString"||$==="MultiLineString"?2:1,tags:ze};R.id!==null&&(Oe.id=R.id),K.features.push(Oe)}}function Sr(K,R,B,Z,Y,$){var _e=Z*Z;if(Z>0&&R.size<(Y?_e:Z))B.numPoints+=R.length/3;else{for(var ae=[],ne=0;ne<R.length;ne+=3)(Z===0||R[ne+2]>_e)&&(B.numSimplified++,ae.push(R[ne]),ae.push(R[ne+1])),B.numPoints++;Y&&function(ue,ze){for(var Re=0,Oe=0,kt=ue.length,Jt=kt-2;Oe<kt;Jt=Oe,Oe+=2)Re+=(ue[Oe]-ue[Jt])*(ue[Oe+1]+ue[Jt+1]);if(Re>0===ze)for(Oe=0,kt=ue.length;Oe<kt/2;Oe+=2){var wt=ue[Oe],Rt=ue[Oe+1];ue[Oe]=ue[kt-2-Oe],ue[Oe+1]=ue[kt-1-Oe],ue[kt-2-Oe]=wt,ue[kt-1-Oe]=Rt}}(ae,$),K.push(ae)}}function st(K,R){var B=(R=this.options=function(Y,$){for(var _e in $)Y[_e]=$[_e];return Y}(Object.create(this.options),R)).debug;if(B&&console.time("preprocess data"),R.maxZoom<0||R.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(R.promoteId&&R.generateId)throw new Error("promoteId and generateId cannot be used together.");var Z=function(Y,$){var _e=[];if(Y.type==="FeatureCollection")for(var ae=0;ae<Y.features.length;ae++)xi(_e,Y.features[ae],$,ae);else xi(_e,Y.type==="Feature"?Y:{geometry:Y},$);return _e}(K,R);this.tiles={},this.tileCoords=[],B&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",R.indexMaxZoom,R.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Z=function(Y,$){var _e=$.buffer/$.extent,ae=Y,ne=mr(Y,1,-1-_e,_e,0,-1,2,$),ue=mr(Y,1,1-_e,2+_e,0,-1,2,$);return(ne||ue)&&(ae=mr(Y,1,-_e,1+_e,0,-1,2,$)||[],ne&&(ae=Ji(ne,1).concat(ae)),ue&&(ae=ae.concat(Ji(ue,-1)))),ae}(Z,R),Z.length&&this.splitTile(Z,0,0,0),B&&(Z.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ri(K,R,B){return 32*((1<<K)*B+R)+K}function Kt(K,R){return R?K.properties[R]:K.id}function sr(K,R){if(K==null)return!0;if(K.type==="Feature")return Kt(K,R)!=null;if(K.type==="FeatureCollection"){const B=new Set;for(const Z of K.features){const Y=Kt(Z,R);if(Y==null||B.has(Y))return!1;B.add(Y)}return!0}return!1}function Dr(K,R){const B=new Map;if(K!=null)if(K.type==="Feature")B.set(Kt(K,R),K);else for(const Z of K.features)B.set(Kt(Z,R),Z);return B}st.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},st.prototype.splitTile=function(K,R,B,Z,Y,$,_e){for(var ae=[K,R,B,Z],ne=this.options,ue=ne.debug;ae.length;){Z=ae.pop(),B=ae.pop(),R=ae.pop(),K=ae.pop();var ze=1<<R,Re=ri(R,B,Z),Oe=this.tiles[Re];if(!Oe&&(ue>1&&console.time("creation"),Oe=this.tiles[Re]=_n(K,R,B,Z,ne),this.tileCoords.push({z:R,x:B,y:Z}),ue)){ue>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",R,B,Z,Oe.numFeatures,Oe.numPoints,Oe.numSimplified),console.timeEnd("creation"));var kt="z"+R;this.stats[kt]=(this.stats[kt]||0)+1,this.total++}if(Oe.source=K,Y){if(R===ne.maxZoom||R===Y)continue;var Jt=1<<Y-R;if(B!==Math.floor($/Jt)||Z!==Math.floor(_e/Jt))continue}else if(R===ne.indexMaxZoom||Oe.numPoints<=ne.indexMaxPoints)continue;if(Oe.source=null,K.length!==0){ue>1&&console.time("clipping");var wt,Rt,ei,zi,si,Ii,wi=.5*ne.buffer/ne.extent,ar=.5-wi,Hi=.5+wi,Mn=1+wi;wt=Rt=ei=zi=null,si=mr(K,ze,B-wi,B+Hi,0,Oe.minX,Oe.maxX,ne),Ii=mr(K,ze,B+ar,B+Mn,0,Oe.minX,Oe.maxX,ne),K=null,si&&(wt=mr(si,ze,Z-wi,Z+Hi,1,Oe.minY,Oe.maxY,ne),Rt=mr(si,ze,Z+ar,Z+Mn,1,Oe.minY,Oe.maxY,ne),si=null),Ii&&(ei=mr(Ii,ze,Z-wi,Z+Hi,1,Oe.minY,Oe.maxY,ne),zi=mr(Ii,ze,Z+ar,Z+Mn,1,Oe.minY,Oe.maxY,ne),Ii=null),ue>1&&console.timeEnd("clipping"),ae.push(wt||[],R+1,2*B,2*Z),ae.push(Rt||[],R+1,2*B,2*Z+1),ae.push(ei||[],R+1,2*B+1,2*Z),ae.push(zi||[],R+1,2*B+1,2*Z+1)}}},st.prototype.getTile=function(K,R,B){var Z=this.options,Y=Z.extent,$=Z.debug;if(K<0||K>24)return null;var _e=1<<K,ae=ri(K,R=(R%_e+_e)%_e,B);if(this.tiles[ae])return it(this.tiles[ae],Y);$>1&&console.log("drilling down to z%d-%d-%d",K,R,B);for(var ne,ue=K,ze=R,Re=B;!ne&&ue>0;)ue--,ze=Math.floor(ze/2),Re=Math.floor(Re/2),ne=this.tiles[ri(ue,ze,Re)];return ne&&ne.source?($>1&&console.log("found parent tile z%d-%d-%d",ue,ze,Re),$>1&&console.time("drilling down"),this.splitTile(ne.source,ue,ze,Re,K,R,B),$>1&&console.timeEnd("drilling down"),this.tiles[ae]?it(this.tiles[ae],Y):null):null};class Gt extends be{constructor(R,B,Z,Y){super(R,B,Z),this._dataUpdateable=new Map,this.loadGeoJSON=($,_e)=>{const{promoteId:ae}=$;if($.request)return s.f($.request,(ne,ue,ze,Re)=>{this._dataUpdateable=sr(ue,ae)?Dr(ue,ae):void 0,_e(ne,ue,ze,Re)});if(typeof $.data=="string")try{const ne=JSON.parse($.data);this._dataUpdateable=sr(ne,ae)?Dr(ne,ae):void 0,_e(null,ne)}catch{_e(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`))}else $.dataDiff?this._dataUpdateable?(function(ne,ue,ze){var Re,Oe,kt,Jt;if(ue.removeAll&&ne.clear(),ue.remove)for(const wt of ue.remove)ne.delete(wt);if(ue.add)for(const wt of ue.add){const Rt=Kt(wt,ze);Rt!=null&&ne.set(Rt,wt)}if(ue.update)for(const wt of ue.update){let Rt=ne.get(wt.id);if(Rt==null)continue;const ei=!wt.removeAllProperties&&(((Re=wt.removeProperties)===null||Re===void 0?void 0:Re.length)>0||((Oe=wt.addOrUpdateProperties)===null||Oe===void 0?void 0:Oe.length)>0);if((wt.newGeometry||wt.removeAllProperties||ei)&&(Rt=Object.assign({},Rt),ne.set(wt.id,Rt),ei&&(Rt.properties=Object.assign({},Rt.properties))),wt.newGeometry&&(Rt.geometry=wt.newGeometry),wt.removeAllProperties)Rt.properties={};else if(((kt=wt.removeProperties)===null||kt===void 0?void 0:kt.length)>0)for(const zi of wt.removeProperties)Object.prototype.hasOwnProperty.call(Rt.properties,zi)&&delete Rt.properties[zi];if(((Jt=wt.addOrUpdateProperties)===null||Jt===void 0?void 0:Jt.length)>0)for(const{key:zi,value:si}of wt.addOrUpdateProperties)Rt.properties[zi]=si}}(this._dataUpdateable,$.dataDiff,ae),_e(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):_e(new Error(`Cannot update existing geojson data in ${$.source}`)):_e(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,Y&&(this.loadGeoJSON=Y)}loadGeoJSONTile(R,B){const Z=R.tileID.canonical;if(!this._geoJSONIndex)return B(null,null);const Y=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!Y)return B(null,null);const $=new class{constructor(ae){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.N,this.length=ae.length,this._features=ae}feature(ae){return new class{constructor(ne){this._feature=ne,this.extent=s.N,this.type=ne.type,this.properties=ne.tags,"id"in ne&&!isNaN(ne.id)&&(this.id=parseInt(ne.id,10))}loadGeometry(){if(this._feature.type===1){const ne=[];for(const ue of this._feature.geometry)ne.push([new s.P(ue[0],ue[1])]);return ne}{const ne=[];for(const ue of this._feature.geometry){const ze=[];for(const Re of ue)ze.push(new s.P(Re[0],Re[1]));ne.push(ze)}return ne}}toGeoJSON(ne,ue,ze){return De.call(this,ne,ue,ze)}}(this._features[ae])}}(Y.features);let _e=Rn($);_e.byteOffset===0&&_e.byteLength===_e.buffer.byteLength||(_e=new Uint8Array(_e)),B(null,{vectorTile:$,rawData:_e.buffer})}loadData(R,B){var Z;(Z=this._pendingRequest)===null||Z===void 0||Z.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const Y=!!(R&&R.request&&R.request.collectResourceTiming)&&new s.bu(R.request);this._pendingCallback=B,this._pendingRequest=this.loadGeoJSON(R,($,_e)=>{if(delete this._pendingCallback,delete this._pendingRequest,$||!_e)return B($);if(typeof _e!="object")return B(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));{Te(_e,!0);try{if(R.filter){const ne=s.bC(R.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ne.result==="error")throw new Error(ne.value.map(ze=>`${ze.key}: ${ze.message}`).join(", "));_e={type:"FeatureCollection",features:_e.features.filter(ze=>ne.value.evaluate({zoom:0},ze))}}this._geoJSONIndex=R.cluster?new qe(function({superclusterOptions:ne,clusterProperties:ue}){if(!ue||!ne)return ne;const ze={},Re={},Oe={accumulated:null,zoom:0},kt={properties:null},Jt=Object.keys(ue);for(const wt of Jt){const[Rt,ei]=ue[wt],zi=s.bC(ei),si=s.bC(typeof Rt=="string"?[Rt,["accumulated"],["get",wt]]:Rt);ze[wt]=zi.value,Re[wt]=si.value}return ne.map=wt=>{kt.properties=wt;const Rt={};for(const ei of Jt)Rt[ei]=ze[ei].evaluate(Oe,kt);return Rt},ne.reduce=(wt,Rt)=>{kt.properties=Rt;for(const ei of Jt)Oe.accumulated=wt[ei],wt[ei]=Re[ei].evaluate(Oe,kt)},ne}(R)).load(_e.features):function(ne,ue){return new st(ne,ue)}(_e,R.geojsonVtOptions)}catch(ne){return B(ne)}this.loaded={};const ae={};if(Y){const ne=Y.finish();ne&&(ae.resourceTiming={},ae.resourceTiming[R.source]=JSON.parse(JSON.stringify(ne)))}B(null,ae)}})}reloadTile(R,B){const Z=this.loaded;return Z&&Z[R.uid]?super.reloadTile(R,B):this.loadTile(R,B)}removeSource(R,B){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),B()}getClusterExpansionZoom(R,B){try{B(null,this._geoJSONIndex.getClusterExpansionZoom(R.clusterId))}catch(Z){B(Z)}}getClusterChildren(R,B){try{B(null,this._geoJSONIndex.getChildren(R.clusterId))}catch(Z){B(Z)}}getClusterLeaves(R,B){try{B(null,this._geoJSONIndex.getLeaves(R.clusterId,R.limit,R.offset))}catch(Z){B(Z)}}}class Gr{constructor(R){this.self=R,this.actor=new s.C(R,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:be,geojson:Gt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(B,Z)=>{if(this.workerSourceTypes[B])throw new Error(`Worker source with name "${B}" already registered.`);this.workerSourceTypes[B]=Z},this.self.registerRTLTextPlugin=B=>{if(s.bD.isParsed())throw new Error("RTL text plugin already registered.");s.bD.applyArabicShaping=B.applyArabicShaping,s.bD.processBidirectionalText=B.processBidirectionalText,s.bD.processStyledBidirectionalText=B.processStyledBidirectionalText}}setReferrer(R,B){this.referrer=B}setImages(R,B,Z){this.availableImages[R]=B;for(const Y in this.workerSources[R]){const $=this.workerSources[R][Y];for(const _e in $)$[_e].availableImages=B}Z()}setLayers(R,B,Z){this.getLayerIndex(R).replace(B),Z()}updateLayers(R,B,Z){this.getLayerIndex(R).update(B.layers,B.removedIds),Z()}loadTile(R,B,Z){this.getWorkerSource(R,B.type,B.source).loadTile(B,Z)}loadDEMTile(R,B,Z){this.getDEMWorkerSource(R,B.source).loadTile(B,Z)}reloadTile(R,B,Z){this.getWorkerSource(R,B.type,B.source).reloadTile(B,Z)}abortTile(R,B,Z){this.getWorkerSource(R,B.type,B.source).abortTile(B,Z)}removeTile(R,B,Z){this.getWorkerSource(R,B.type,B.source).removeTile(B,Z)}removeDEMTile(R,B){this.getDEMWorkerSource(R,B.source).removeTile(B)}removeSource(R,B,Z){if(!this.workerSources[R]||!this.workerSources[R][B.type]||!this.workerSources[R][B.type][B.source])return;const Y=this.workerSources[R][B.type][B.source];delete this.workerSources[R][B.type][B.source],Y.removeSource!==void 0?Y.removeSource(B,Z):Z()}loadWorkerSource(R,B,Z){try{this.self.importScripts(B.url),Z()}catch(Y){Z(Y.toString())}}syncRTLPluginState(R,B,Z){try{s.bD.setState(B);const Y=s.bD.getPluginURL();if(s.bD.isLoaded()&&!s.bD.isParsed()&&Y!=null){this.self.importScripts(Y);const $=s.bD.isParsed();Z($?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Y}`),$)}}catch(Y){Z(Y.toString())}}getAvailableImages(R){let B=this.availableImages[R];return B||(B=[]),B}getLayerIndex(R){let B=this.layerIndexes[R];return B||(B=this.layerIndexes[R]=new D),B}getWorkerSource(R,B,Z){return this.workerSources[R]||(this.workerSources[R]={}),this.workerSources[R][B]||(this.workerSources[R][B]={}),this.workerSources[R][B][Z]||(this.workerSources[R][B][Z]=new this.workerSourceTypes[B]({send:(Y,$,_e)=>{this.actor.send(Y,$,_e,R)}},this.getLayerIndex(R),this.getAvailableImages(R))),this.workerSources[R][B][Z]}getDEMWorkerSource(R,B){return this.demWorkerSources[R]||(this.demWorkerSources[R]={}),this.demWorkerSources[R][B]||(this.demWorkerSources[R][B]=new he),this.demWorkerSources[R][B]}}return s.i()&&(self.worker=new Gr(self)),Gr}),S(["./shared"],function(s){var D="3.6.2";class M{static testProp(t){if(!M.docStyle)return t[0];for(let r=0;r<t.length;r++)if(t[r]in M.docStyle)return t[r];return t[0]}static create(t,r,l){const u=window.document.createElement(t);return r!==void 0&&(u.className=r),l&&l.appendChild(u),u}static createNS(t,r){return window.document.createElementNS(t,r)}static disableDrag(){M.docStyle&&M.selectProp&&(M.userSelect=M.docStyle[M.selectProp],M.docStyle[M.selectProp]="none")}static enableDrag(){M.docStyle&&M.selectProp&&(M.docStyle[M.selectProp]=M.userSelect)}static setTransform(t,r){t.style[M.transformProp]=r}static addEventListener(t,r,l,u={}){t.addEventListener(r,l,"passive"in u?u:u.capture)}static removeEventListener(t,r,l,u={}){t.removeEventListener(r,l,"passive"in u?u:u.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",M.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",M.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",M.suppressClickInternal,!0)},0)}static mousePos(t,r){const l=t.getBoundingClientRect();return new s.P(r.clientX-l.left-t.clientLeft,r.clientY-l.top-t.clientTop)}static touchPos(t,r){const l=t.getBoundingClientRect(),u=[];for(let _=0;_<r.length;_++)u.push(new s.P(r[_].clientX-l.left-t.clientLeft,r[_].clientY-l.top-t.clientTop));return u}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}M.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,M.selectProp=M.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),M.transformProp=M.testProp(["transform","WebkitTransform"]);const q={supported:!1,testSupport:function(f){!be&&ce&&(he?ye(f):te=f)}};let te,ce,be=!1,he=!1;function ye(f){const t=f.createTexture();f.bindTexture(f.TEXTURE_2D,t);try{if(f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,ce),f.isContextLost())return;q.supported=!0}catch{}f.deleteTexture(t),be=!0}var me,Te;typeof document<"u"&&(ce=document.createElement("img"),ce.onload=function(){te&&ye(te),te=null,he=!0},ce.onerror=function(){be=!0,te=null},ce.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(f){let t,r,l,u;f.resetRequestQueue=()=>{t=[],r=0,l=0,u={}},f.addThrottleControl=A=>{const L=l++;return u[L]=A,L},f.removeThrottleControl=A=>{delete u[A],w()},f.getImage=(A,L,z=!0)=>{q.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*");const N={requestParameters:A,supportImageRefresh:z,callback:L,cancelled:!1,completed:!1,cancel:()=>{N.completed||N.cancelled||(N.cancelled=!0,N.innerRequest&&(N.innerRequest.cancel(),r--),w())}};return t.push(N),w(),N};const _=A=>{const{requestParameters:L,supportImageRefresh:z,callback:N}=A;return s.e(L,{type:"image"}),(z!==!1||s.i()||s.g(L.url)||L.headers&&!Object.keys(L.headers).reduce((X,H)=>X&&H==="accept",!0)?s.m:I)(L,(X,H,J,G)=>{x(A,N,X,H,J,G)})},x=(A,L,z,N,X,H)=>{z?L(z):N instanceof HTMLImageElement||s.a(N)?L(null,N):N&&((J,G)=>{typeof createImageBitmap=="function"?s.b(J,G):s.d(J,G)})(N,(J,G)=>{J!=null?L(J):G!=null&&L(null,G,{cacheControl:X,expires:H})}),A.cancelled||(A.completed=!0,r--,w())},w=()=>{const A=(()=>{const L=Object.keys(u);let z=!1;if(L.length>0){for(const N of L)if(z=u[N](),z)break}return z})()?s.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let L=r;L<A&&t.length>0;L++){const z=t.shift();if(z.cancelled){L--;continue}const N=_(z);r++,z.innerRequest=N}},I=(A,L)=>{const z=new Image,N=A.url;let X=!1;const H=A.credentials;return H&&H==="include"?z.crossOrigin="use-credentials":(H&&H==="same-origin"||!s.s(N))&&(z.crossOrigin="anonymous"),z.fetchPriority="high",z.onload=()=>{L(null,z),z.onerror=z.onload=null},z.onerror=()=>{X||L(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),z.onerror=z.onload=null},z.src=N,{cancel:()=>{X=!0,z.src=""}}}}(me||(me={})),me.resetRequestQueue(),function(f){f.Glyphs="Glyphs",f.Image="Image",f.Source="Source",f.SpriteImage="SpriteImage",f.SpriteJSON="SpriteJSON",f.Style="Style",f.Tile="Tile",f.Unknown="Unknown"}(Te||(Te={}));class De{constructor(t){this._transformRequestFn=t}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}normalizeSpriteURL(t,r,l){const u=function(_){const x=_.match(Ze);if(!x)throw new Error(`Unable to parse URL "${_}"`);return{protocol:x[1],authority:x[2],path:x[3]||"/",params:x[4]?x[4].split("&"):[]}}(t);return u.path+=`${r}${l}`,function(_){const x=_.params.length?`?${_.params.join("&")}`:"";return`${_.protocol}://${_.authority}${_.path}${x}`}(u)}setTransformRequest(t){this._transformRequestFn=t}}const Ze=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Le(f){var t=new s.A(3);return t[0]=f[0],t[1]=f[1],t[2]=f[2],t}var tt,xt=function(f,t,r){return f[0]=t[0]-r[0],f[1]=t[1]-r[1],f[2]=t[2]-r[2],f};tt=new s.A(3),s.A!=Float32Array&&(tt[0]=0,tt[1]=0,tt[2]=0);var Qe=function(f){var t=f[0],r=f[1];return t*t+r*r};function Dt(f){const t=[];if(typeof f=="string")t.push({id:"default",url:f});else if(f&&f.length>0){const r=[];for(const{id:l,url:u}of f){const _=`${l}${u}`;r.indexOf(_)===-1&&(r.push(_),t.push({id:l,url:u}))}}return t}function bt(f,t,r,l,u){if(l)return void f(l);if(u!==Object.values(t).length||u!==Object.values(r).length)return;const _={};for(const x in t){_[x]={};const w=s.h.getImageCanvasContext(r[x]),I=t[x];for(const A in I){const{width:L,height:z,x:N,y:X,sdf:H,pixelRatio:J,stretchX:G,stretchY:de,content:Se}=I[A];_[x][A]={data:null,pixelRatio:J,sdf:H,stretchX:G,stretchY:de,content:Se,spriteData:{width:L,height:z,x:N,y:X,context:w}}}}f(null,_)}(function(){var f=new s.A(2);s.A!=Float32Array&&(f[0]=0,f[1]=0)})();class qt{constructor(t,r,l,u){this.context=t,this.format=l,this.texture=t.gl.createTexture(),this.update(r,u)}update(t,r,l){const{width:u,height:_}=t,x=!(this.size&&this.size[0]===u&&this.size[1]===_||l),{context:w}=this,{gl:I}=w;if(this.useMipmap=!!(r&&r.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!r||r.premultiply!==!1)),x)this.size=[u,_],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||s.a(t)?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,t):I.texImage2D(I.TEXTURE_2D,0,this.format,u,_,0,this.format,I.UNSIGNED_BYTE,t.data);else{const{x:A,y:L}=l||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||s.a(t)?I.texSubImage2D(I.TEXTURE_2D,0,A,L,I.RGBA,I.UNSIGNED_BYTE,t):I.texSubImage2D(I.TEXTURE_2D,0,A,L,u,_,I.RGBA,I.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)}bind(t,r,l){const{context:u}=this,{gl:_}=u;_.bindTexture(_.TEXTURE_2D,this.texture),l!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=_.LINEAR),t!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,t),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,l||t),this.filter=t),r!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,r),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function Fe(f){const{userImage:t}=f;return!!(t&&t.render&&t.render())&&(f.data.replace(new Uint8Array(t.data.buffer)),!0)}class $e extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:r,callback:l}of this.requestors)this._notify(r,l);this.requestors=[]}}getImage(t){const r=this.images[t];if(r&&!r.data&&r.spriteData){const l=r.spriteData;r.data=new s.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),r.spriteData=null}return r}addImage(t,r){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,r)&&(this.images[t]=r)}_validate(t,r){let l=!0;const u=r.data||r.spriteData;return this._validateStretch(r.stretchX,u&&u.width)||(this.fire(new s.j(new Error(`Image "${t}" has invalid "stretchX" value`))),l=!1),this._validateStretch(r.stretchY,u&&u.height)||(this.fire(new s.j(new Error(`Image "${t}" has invalid "stretchY" value`))),l=!1),this._validateContent(r.content,r)||(this.fire(new s.j(new Error(`Image "${t}" has invalid "content" value`))),l=!1),l}_validateStretch(t,r){if(!t)return!0;let l=0;for(const u of t){if(u[0]<l||u[1]<u[0]||r<u[1])return!1;l=u[1]}return!0}_validateContent(t,r){if(!t)return!0;if(t.length!==4)return!1;const l=r.spriteData,u=l&&l.width||r.data.width,_=l&&l.height||r.data.height;return!(t[0]<0||u<t[0]||t[1]<0||_<t[1]||t[2]<0||u<t[2]||t[3]<0||_<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,r,l=!0){const u=this.getImage(t);if(l&&(u.data.width!==r.data.width||u.data.height!==r.data.height))throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=u.version+1,this.images[t]=r,this.updatedImages[t]=!0}removeImage(t){const r=this.images[t];delete this.images[t],delete this.patterns[t],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,r){let l=!0;if(!this.isLoaded())for(const u of t)this.images[u]||(l=!1);this.isLoaded()||l?this._notify(t,r):this.requestors.push({ids:t,callback:r})}_notify(t,r){const l={};for(const u of t){let _=this.getImage(u);_||(this.fire(new s.k("styleimagemissing",{id:u})),_=this.getImage(u)),_?l[u]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,hasRenderCallback:!!(_.userImage&&_.userImage.render)}:s.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}r(null,l)}getPixelSize(){const{width:t,height:r}=this.atlasImage;return{width:t,height:r}}getPattern(t){const r=this.patterns[t],l=this.getImage(t);if(!l)return null;if(r&&r.position.version===l.version)return r.position;if(r)r.position.version=l.version;else{const u={w:l.data.width+2,h:l.data.height+2,x:0,y:0},_=new s.I(u,l);this.patterns[t]={bin:u,position:_}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const r=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new qt(t,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const _ in this.patterns)t.push(this.patterns[_].bin);const{w:r,h:l}=s.p(t),u=this.atlasImage;u.resize({width:r||1,height:l||1});for(const _ in this.patterns){const{bin:x}=this.patterns[_],w=x.x+1,I=x.y+1,A=this.getImage(_).data,L=A.width,z=A.height;s.R.copy(A,u,{x:0,y:0},{x:w,y:I},{width:L,height:z}),s.R.copy(A,u,{x:0,y:z-1},{x:w,y:I-1},{width:L,height:1}),s.R.copy(A,u,{x:0,y:0},{x:w,y:I+z},{width:L,height:1}),s.R.copy(A,u,{x:L-1,y:0},{x:w-1,y:I},{width:1,height:z}),s.R.copy(A,u,{x:0,y:0},{x:w+L,y:I},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const r of t){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const l=this.getImage(r);l||s.w(`Image with ID: "${r}" was not found`),Fe(l)&&this.updateImage(r,l)}}}const Wt=1e20;function rt(f,t,r,l,u,_,x,w,I){for(let A=t;A<t+l;A++)Qt(f,r*_+A,_,u,x,w,I);for(let A=r;A<r+u;A++)Qt(f,A*_+t,1,l,x,w,I)}function Qt(f,t,r,l,u,_,x){_[0]=0,x[0]=-Wt,x[1]=Wt,u[0]=f[t];for(let w=1,I=0,A=0;w<l;w++){u[w]=f[t+w*r];const L=w*w;do{const z=_[I];A=(u[w]-u[z]+L-z*z)/(w-z)/2}while(A<=x[I]&&--I>-1);I++,_[I]=w,x[I]=A,x[I+1]=Wt}for(let w=0,I=0;w<l;w++){for(;x[I+1]<w;)I++;const A=_[I],L=w-A;f[t+w*r]=u[A]+L*L}}class Bt{constructor(t,r){this.requestManager=t,this.localIdeographFontFamily=r,this.entries={}}setURL(t){this.url=t}getGlyphs(t,r){const l=[];for(const u in t)for(const _ of t[u])l.push({stack:u,id:_});s.o(l,({stack:u,id:_},x)=>{let w=this.entries[u];w||(w=this.entries[u]={glyphs:{},requests:{},ranges:{}});let I=w.glyphs[_];if(I!==void 0)return void x(null,{stack:u,id:_,glyph:I});if(I=this._tinySDF(w,u,_),I)return w.glyphs[_]=I,void x(null,{stack:u,id:_,glyph:I});const A=Math.floor(_/256);if(256*A>65535)return void x(new Error("glyphs > 65535 not supported"));if(w.ranges[A])return void x(null,{stack:u,id:_,glyph:I});if(!this.url)return void x(new Error("glyphsUrl is not set"));let L=w.requests[A];L||(L=w.requests[A]=[],Bt.loadGlyphRange(u,A,this.url,this.requestManager,(z,N)=>{if(N){for(const X in N)this._doesCharSupportLocalGlyph(+X)||(w.glyphs[+X]=N[+X]);w.ranges[A]=!0}for(const X of L)X(z,N);delete w.requests[A]})),L.push((z,N)=>{z?x(z):N&&x(null,{stack:u,id:_,glyph:N[_]||null})})},(u,_)=>{if(u)r(u);else if(_){const x={};for(const{stack:w,id:I,glyph:A}of _)(x[w]||(x[w]={}))[I]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics};r(null,x)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(s.u["CJK Unified Ideographs"](t)||s.u["Hangul Syllables"](t)||s.u.Hiragana(t)||s.u.Katakana(t))}_tinySDF(t,r,l){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let _=t.tinySDF;if(!_){let w="400";/bold/i.test(r)?w="900":/medium/i.test(r)?w="500":/light/i.test(r)&&(w="200"),_=t.tinySDF=new Bt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:w})}const x=_.draw(String.fromCharCode(l));return{id:l,bitmap:new s.q({width:x.width||60,height:x.height||60},x.data),metrics:{width:x.glyphWidth/2||24,height:x.glyphHeight/2||24,left:x.glyphLeft/2+.5||0,top:x.glyphTop/2-27.5||-8,advance:x.glyphAdvance/2||24,isDoubleResolution:!0}}}}Bt.loadGlyphRange=function(f,t,r,l,u){const _=256*t,x=_+255,w=l.transformRequest(r.replace("{fontstack}",f).replace("{range}",`${_}-${x}`),Te.Glyphs);s.l(w,(I,A)=>{if(I)u(I);else if(A){const L={};for(const z of s.n(A))L[z.id]=z;u(null,L)}})},Bt.TinySDF=class{constructor({fontSize:f=24,buffer:t=3,radius:r=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:_="normal",fontStyle:x="normal"}={}){this.buffer=t,this.cutoff=l,this.radius=r;const w=this.size=f+4*t,I=this._createCanvas(w),A=this.ctx=I.getContext("2d",{willReadFrequently:!0});A.font=`${x} ${_} ${f}px ${u}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(f){const t=document.createElement("canvas");return t.width=t.height=f,t}draw(f){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:_}=this.ctx.measureText(f),x=Math.ceil(r),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-u))),I=Math.min(this.size-this.buffer,x+Math.ceil(l)),A=w+2*this.buffer,L=I+2*this.buffer,z=Math.max(A*L,0),N=new Uint8ClampedArray(z),X={data:N,width:A,height:L,glyphWidth:w,glyphHeight:I,glyphTop:x,glyphLeft:0,glyphAdvance:t};if(w===0||I===0)return X;const{ctx:H,buffer:J,gridInner:G,gridOuter:de}=this;H.clearRect(J,J,w,I),H.fillText(f,J,J+x);const Se=H.getImageData(J,J,w,I);de.fill(Wt,0,z),G.fill(0,0,z);for(let ie=0;ie<I;ie++)for(let pe=0;pe<w;pe++){const Ce=Se.data[4*(ie*w+pe)+3]/255;if(Ce===0)continue;const ke=(ie+J)*A+pe+J;if(Ce===1)de[ke]=0,G[ke]=Wt;else{const Be=.5-Ce;de[ke]=Be>0?Be*Be:0,G[ke]=Be<0?Be*Be:0}}rt(de,0,0,A,L,A,this.f,this.v,this.z),rt(G,J,J,w,I,A,this.f,this.v,this.z);for(let ie=0;ie<z;ie++){const pe=Math.sqrt(de[ie])-Math.sqrt(G[ie]);N[ie]=Math.round(255-255*(pe/this.radius+this.cutoff))}return X}};class At{constructor(){this.specification=s.v.light.position}possiblyEvaluate(t,r){return s.z(t.expression.evaluate(r))}interpolate(t,r,l){return{x:s.B.number(t.x,r.x,l),y:s.B.number(t.y,r.y,l),z:s.B.number(t.z,r.z,l)}}}let hi;class Rn extends s.E{constructor(t){super(),hi=hi||new s.r({anchor:new s.D(s.v.light.anchor),position:new At,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(hi),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r={}){if(!this._validate(s.t,t,r))for(const l in t){const u=t[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,l){return(!l||l.validate!==!1)&&s.x(this,t.call(s.y,s.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:s.v})))}}class On{constructor(t,r){this.width=t,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,r){const l=t.join(",")+String(r);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(t,r)),this.dashEntry[l]}getDashRanges(t,r,l){const u=[];let _=t.length%2==1?-t[t.length-1]*l:0,x=t[0]*l,w=!0;u.push({left:_,right:x,isDash:w,zeroLength:t[0]===0});let I=t[0];for(let A=1;A<t.length;A++){w=!w;const L=t[A];_=I*l,I+=L,x=I*l,u.push({left:_,right:x,isDash:w,zeroLength:L===0})}return u}addRoundDash(t,r,l){const u=r/2;for(let _=-l;_<=l;_++){const x=this.width*(this.nextRow+l+_);let w=0,I=t[w];for(let A=0;A<this.width;A++){A/I.right>1&&(I=t[++w]);const L=Math.abs(A-I.left),z=Math.abs(A-I.right),N=Math.min(L,z);let X;const H=_/l*(u+1);if(I.isDash){const J=u-Math.abs(H);X=Math.sqrt(N*N+J*J)}else X=u-Math.sqrt(N*N+H*H);this.data[x+A]=Math.max(0,Math.min(255,X+128))}}}addRegularDash(t){for(let w=t.length-1;w>=0;--w){const I=t[w],A=t[w+1];I.zeroLength?t.splice(w,1):A&&A.isDash===I.isDash&&(A.left=I.left,t.splice(w,1))}const r=t[0],l=t[t.length-1];r.isDash===l.isDash&&(r.left=l.left-this.width,l.right=r.right+this.width);const u=this.width*this.nextRow;let _=0,x=t[_];for(let w=0;w<this.width;w++){w/x.right>1&&(x=t[++_]);const I=Math.abs(w-x.left),A=Math.abs(w-x.right),L=Math.min(I,A);this.data[u+w]=Math.max(0,Math.min(255,(x.isDash?L:-L)+128))}}addDash(t,r){const l=r?7:0,u=2*l+1;if(this.nextRow+u>this.height)return s.w("LineAtlas out of space"),null;let _=0;for(let w=0;w<t.length;w++)_+=t[w];if(_!==0){const w=this.width/_,I=this.getDashRanges(t,this.width,w);r?this.addRoundDash(I,w,l):this.addRegularDash(I)}const x={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:_};return this.nextRow+=u,this.dirty=!0,x}bind(t){const r=t.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}class Ei{constructor(t,r,l){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=l;const u=this.workerPool.acquire(l);for(let _=0;_<u.length;_++){const x=new s.C(u[_],r,l);x.name=`Worker ${_}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,r,l){s.o(this.actors,(u,_)=>{u.send(t,r,_)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(r=>{r.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}}function Mi(f,t,r){const l=function(u,_){if(u)return r(u);if(_){const x=s.F(s.e(_,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);_.vector_layers&&(x.vectorLayers=_.vector_layers,x.vectorLayerIds=x.vectorLayers.map(w=>w.id)),r(null,x)}};return f.url?s.f(t.transformRequest(f.url,Te.Source),l):s.h.frame(()=>l(null,f))}class Nt{constructor(t,r){t&&(r?this.setSouthWest(t).setNorthEast(r):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof s.L?new s.L(t.lng,t.lat):s.L.convert(t),this}setSouthWest(t){return this._sw=t instanceof s.L?new s.L(t.lng,t.lat):s.L.convert(t),this}extend(t){const r=this._sw,l=this._ne;let u,_;if(t instanceof s.L)u=t,_=t;else{if(!(t instanceof Nt))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Nt.convert(t)):this.extend(s.L.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(s.L.convert(t)):this;if(u=t._sw,_=t._ne,!u||!_)return this}return r||l?(r.lng=Math.min(u.lng,r.lng),r.lat=Math.min(u.lat,r.lat),l.lng=Math.max(_.lng,l.lng),l.lat=Math.max(_.lat,l.lat)):(this._sw=new s.L(u.lng,u.lat),this._ne=new s.L(_.lng,_.lat)),this}getCenter(){return new s.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.L(this.getWest(),this.getNorth())}getSouthEast(){return new s.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:r,lat:l}=s.L.convert(t);let u=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(t){return t instanceof Nt?t:t&&new Nt(t)}static fromLngLat(t,r=0){const l=360*r/40075017,u=l/Math.cos(Math.PI/180*t.lat);return new Nt(new s.L(t.lng-u,t.lat-l),new s.L(t.lng+u,t.lat+l))}}class bi{constructor(t,r,l){this.bounds=Nt.convert(this.validateBounds(t)),this.minzoom=r||0,this.maxzoom=l||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const r=Math.pow(2,t.z),l=Math.floor(s.G(this.bounds.getWest())*r),u=Math.floor(s.H(this.bounds.getNorth())*r),_=Math.ceil(s.G(this.bounds.getEast())*r),x=Math.ceil(s.H(this.bounds.getSouth())*r);return t.x>=l&&t.x<_&&t.y>=u&&t.y<x}}class ji extends s.E{constructor(t,r,l,u){if(super(),this.load=()=>{this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Mi(this._options,this.map._requestManager,(_,x)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),_?this.fire(new s.j(_)):x&&(s.e(this,x),x.bounds&&(this.tileBounds=new bi(x.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>s.e({},this._options),this.id=t,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.F(r,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(t,r){const l=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(l,Te.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function _(x,w){return delete t.request,t.aborted?r(null):x&&x.status!==404?r(x):(w&&w.resourceTiming&&(t.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&w&&t.setExpiryData(w),t.loadVectorData(w,this.map.painter),r(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}u.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=r:t.request=t.actor.send("reloadTile",u,_.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",u,_.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class qe extends s.E{constructor(t,r,l,u){super(),this.id=t,this.dispatcher=l,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},r),s.e(this,s.F(r,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Mi(this._options,this.map._requestManager,(t,r)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new s.j(t)):r&&(s.e(this,r),r.bounds&&(this.tileBounds=new bi(r.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}serialize(){return s.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,r){const l=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=me.getImage(this.map._requestManager.transformRequest(l,Te.Tile),(u,_,x)=>{if(delete t.request,t.aborted)t.state="unloaded",r(null);else if(u)t.state="errored",r(u);else if(_){this.map._refreshExpiredTiles&&x&&t.setExpiryData(x);const w=this.map.painter.context,I=w.gl;t.texture=this.map.painter.getTileTexture(_.width),t.texture?t.texture.update(_,{useMipmap:!0}):(t.texture=new qt(w,_,I.RGBA,{useMipmap:!0}),t.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),w.extTextureFilterAnisotropic&&I.texParameterf(I.TEXTURE_2D,w.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,w.extTextureFilterAnisotropicMax)),t.state="loaded",r(null)}},this.map._refreshExpiredTiles)}abortTile(t,r){t.request&&(t.request.cancel(),delete t.request),r()}unloadTile(t,r){t.texture&&this.map.painter.saveTileTexture(t.texture),r()}hasTransition(){return!1}}class Zt extends qe{constructor(t,r,l,u){super(t,r,l,u),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(t,r){const l=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(l,Te.Tile);function _(x,w){x&&(t.state="errored",r(x)),w&&(t.dem=w,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",r(null))}t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.request=me.getImage(u,(x,w,I)=>s._(this,void 0,void 0,function*(){if(delete t.request,t.aborted)t.state="unloaded",r(null);else if(x)t.state="errored",r(x);else if(w){this.map._refreshExpiredTiles&&t.setExpiryData(I);const A=s.a(w)&&s.J()?w:yield function(z){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.K()){const N=z.width+2,X=z.height+2;try{return new s.R({width:N,height:X},yield s.M(z,-1,-1,N,X))}catch{}}return s.h.getImageData(z,1)})}(w),L={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:A,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",L,_))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(t){const r=t.canonical,l=Math.pow(2,r.z),u=(r.x-1+l)%l,_=r.x===0?t.wrap-1:t.wrap,x=(r.x+1+l)%l,w=r.x+1===l?t.wrap+1:t.wrap,I={};return I[new s.O(t.overscaledZ,_,r.z,u,r.y).key]={backfilled:!1},I[new s.O(t.overscaledZ,w,r.z,x,r.y).key]={backfilled:!1},r.y>0&&(I[new s.O(t.overscaledZ,_,r.z,u,r.y-1).key]={backfilled:!1},I[new s.O(t.overscaledZ,t.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},I[new s.O(t.overscaledZ,w,r.z,x,r.y-1).key]={backfilled:!1}),r.y+1<l&&(I[new s.O(t.overscaledZ,_,r.z,u,r.y+1).key]={backfilled:!1},I[new s.O(t.overscaledZ,t.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},I[new s.O(t.overscaledZ,w,r.z,x,r.y+1).key]={backfilled:!1}),I}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class nt extends s.E{constructor(t,r,l,u){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>s.e({},this._options,{type:this.type,data:this._data}),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(u),this._data=r.data,this._options=s.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const _=s.N/this.tileSize;this.workerOptions=s.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*_,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*_,extent:s.N,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:s.N,radius:(r.clusterRadius||50)*_,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},r),this}getClusterChildren(t,r){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},r),this}getClusterLeaves(t,r,l,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:r,offset:l},u),this}_updateWorkerData(t){const r=s.e({},this.workerOptions);t?r.dataDiff=t:typeof this._data=="string"?(r.request=this.map._requestManager.transformRequest(s.h.resolveURL(this._data),Te.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,r,(l,u)=>{if(this._pendingLoads--,this._removed||u&&u.abandoned)return void this.fire(new s.k("dataabort",{dataType:"source"}));let _=null;if(u&&u.resourceTiming&&u.resourceTiming[this.id]&&(_=u.resourceTiming[this.id].slice(0)),l)return void this.fire(new s.j(l));const x={dataType:"source"};this._collectResourceTiming&&_&&_.length>0&&s.e(x,{resourceTiming:_}),this.fire(new s.k("data",Object.assign(Object.assign({},x),{sourceDataType:"metadata"}))),this.fire(new s.k("data",Object.assign(Object.assign({},x),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(t,r){const l=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const u={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(l,u,(_,x)=>(delete t.request,t.unloadVectorData(),t.aborted?r(null):_?r(_):(t.loadVectorData(x,this.map.painter,l==="reloadTile"),r(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var oi=s.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class vt extends s.E{constructor(t,r,l,u){super(),this.load=(_,x)=>{this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=me.getImage(this.map._requestManager.transformRequest(this.url,Te.Image),(w,I)=>{this._request=null,this._loaded=!0,w?this.fire(new s.j(w)):I&&(this.image=I,_&&(this.coordinates=_),x&&x(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const _=this.map.painter.context,x=_.gl;this.boundsBuffer||(this.boundsBuffer=_.createVertexBuffer(this._boundsArray,oi.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new qt(_,this.image,x.RGBA),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE));let w=!1;for(const I in this.tiles){const A=this.tiles[I];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,w=!0)}w&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=t,this.dispatcher=l,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=r}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(t){this.coordinates=t;const r=t.map(s.U.fromLngLat);this.tileID=function(u){let _=1/0,x=1/0,w=-1/0,I=-1/0;for(const N of u)_=Math.min(_,N.x),x=Math.min(x,N.y),w=Math.max(w,N.x),I=Math.max(I,N.y);const A=Math.max(w-_,I-x),L=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),z=Math.pow(2,L);return new s.W(L,Math.floor((_+w)/2*z),Math.floor((x+I)/2*z))}(r),this.minzoom=this.maxzoom=this.tileID.z;const l=r.map(u=>this.tileID.getTilePoint(u)._round());return this._boundsArray=new s.V,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,s.N,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,s.N),this._boundsArray.emplaceBack(l[2].x,l[2].y,s.N,s.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(t,r){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},r(null)):(t.state="errored",r(null))}hasTransition(){return!1}}class qi extends vt{constructor(t,r,l,u){super(t,r,l,u),this.load=()=>{this._loaded=!1;const _=this.options;this.urls=[];for(const x of _.urls)this.urls.push(this.map._requestManager.transformRequest(x,Te.Source).url);s.X(this.urls,(x,w)=>{this._loaded=!0,x?this.fire(new s.j(x)):w&&(this.video=w,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const _=this.map.painter.context,x=_.gl;this.boundsBuffer||(this.boundsBuffer=_.createVertexBuffer(this._boundsArray,oi.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.texSubImage2D(x.TEXTURE_2D,0,0,0,x.RGBA,x.UNSIGNED_BYTE,this.video)):(this.texture=new qt(_,this.video,x.RGBA),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE));let w=!1;for(const I in this.tiles){const A=this.tiles[I];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,w=!0)}w&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=r}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const r=this.video.seekable;t<r.start(0)||t>r.end(0)?this.fire(new s.j(new s.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class xn extends vt{constructor(t,r,l,u){super(t,r,l,u),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let _=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,_=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,_=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const x=this.map.painter.context,w=x.gl;this.boundsBuffer||(this.boundsBuffer=x.createVertexBuffer(this._boundsArray,oi.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture?(_||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new qt(x,this.canvas,w.RGBA,{premultiply:!0});let I=!1;for(const A in this.tiles){const L=this.tiles[A];L.state!=="loaded"&&(L.state="loaded",L.texture=this.texture,I=!0)}I&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(x=>typeof x!="number"))||this.fire(new s.j(new s.Y(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.j(new s.Y(`sources.${t}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new s.j(new s.Y(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new s.j(new s.Y(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.j(new s.Y(`sources.${t}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Je={},Fi=f=>{switch(f){case"geojson":return nt;case"image":return vt;case"raster":return qe;case"raster-dem":return Zt;case"vector":return ji;case"video":return qi;case"canvas":return xn}return Je[f]};function wn(f,t){const r=s.Z();return s.$(r,r,[1,1,0]),s.a0(r,r,[.5*f.width,.5*f.height,1]),s.a1(r,r,f.calculatePosMatrix(t.toUnwrapped()))}function xi(f,t,r,l,u,_){const x=function(z,N,X){if(z)for(const H of z){const J=N[H];if(J&&J.source===X&&J.type==="fill-extrusion")return!0}else for(const H in N){const J=N[H];if(J.source===X&&J.type==="fill-extrusion")return!0}return!1}(u&&u.layers,t,f.id),w=_.maxPitchScaleFactor(),I=f.tilesIn(l,w,x);I.sort(Zr);const A=[];for(const z of I)A.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(t,r,f._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,u,_,w,wn(f.transform,z.tileID))});const L=function(z){const N={},X={};for(const H of z){const J=H.queryResults,G=H.wrappedTileID,de=X[G]=X[G]||{};for(const Se in J){const ie=J[Se],pe=de[Se]=de[Se]||{},Ce=N[Se]=N[Se]||[];for(const ke of ie)pe[ke.featureIndex]||(pe[ke.featureIndex]=!0,Ce.push(ke))}}return N}(A);for(const z in L)L[z].forEach(N=>{const X=N.feature,H=f.getFeatureState(X.layer["source-layer"],X.id);X.source=X.layer.source,X.layer["source-layer"]&&(X.sourceLayer=X.layer["source-layer"]),X.state=H});return L}function Zr(f,t){const r=f.tileID,l=t.tileID;return r.overscaledZ-l.overscaledZ||r.canonical.y-l.canonical.y||r.wrap-l.wrap||r.canonical.x-l.canonical.x}class fr{constructor(t,r){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=s.a2(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const r=t+this.timeAdded;r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,r,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(u,_){const x={};if(!_)return x;for(const w of u){const I=w.layerIds.map(A=>_.getLayer(A)).filter(Boolean);if(I.length!==0){w.layers=I,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(A=>I.filter(L=>L.id===A)[0]));for(const A of I)x[A.id]=w}}return x}(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const _=this.buckets[u];if(_ instanceof s.a4){if(this.hasSymbolBuckets=!0,!l)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const _=this.buckets[u];if(_ instanceof s.a4&&_.hasRTLText){this.hasRTLText=!0,s.a5();break}}this.queryPadding=0;for(const u in this.buckets){const _=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(u).queryRadius(_))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new s.a3}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const u=this.buckets[l];u.uploadPending()&&u.upload(t)}const r=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new qt(t,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new qt(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,r,l,u,_,x,w,I,A,L){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:_,scale:x,tileSize:this.tileSize,pixelPosMatrix:L,transform:I,params:w,queryPadding:this.queryPadding*A},t,r,l):{}}querySourceFeatures(t,r){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const u=l.loadVTLayers(),_=r&&r.sourceLayer?r.sourceLayer:"",x=u._geojsonTileLayer||u[_];if(!x)return;const w=s.a6(r&&r.filter),{z:I,x:A,y:L}=this.tileID.canonical,z={z:I,x:A,y:L};for(let N=0;N<x.length;N++){const X=x.feature(N);if(w.needGeometry){const G=s.a7(X,!0);if(!w.filter(new s.a8(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!w.filter(new s.a8(this.tileID.overscaledZ),X))continue;const H=l.getId(X,_),J=new s.a9(X,I,A,L,H);J.tile=z,t.push(J)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const l=s.aa(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let u=!1;if(this.expirationTime>l)u=!1;else if(r)if(this.expirationTime<r)u=!0;else{const _=this.expirationTime-r;_?this.expirationTime=l+Math.max(_,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!r.style.hasLayer(u))continue;const _=this.buckets[u],x=_.layers[0].sourceLayer||"_geojsonTileLayer",w=l[x],I=t[x];if(!w||!I||Object.keys(I).length===0)continue;_.update(I,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const A=r&&r.style&&r.style.getLayer(u);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=s.h.now()+t}setDependencies(t,r){const l={};for(const u of r)l[u]=!0;this.dependencies[t]=l}hasDependency(t,r){for(const l of t){const u=this.dependencies[l];if(u){for(const _ of r)if(u[_])return!0}}return!1}}class Zn{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(const t in this.data)for(const r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,l){const u=t.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const _={value:r,timeout:void 0};if(l!==void 0&&(_.timeout=setTimeout(()=>{this.remove(t,_)},l)),this.data[u].push(_),this.order.push(u),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){const r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;const l=t.wrapped().key,u=r===void 0?0:this.data[l].indexOf(r),_=this.data[l][u];return this.data[l].splice(u,1),_.timeout&&clearTimeout(_.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(_.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){const r=[];for(const l in this.data)for(const u of this.data[l])t(u.value)||r.push(u);for(const l of r)this.remove(l.value.tileID,l)}}class Me{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,l){const u=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][u]=this.stateChanges[t][u]||{},s.e(this.stateChanges[t][u],l),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==u&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][u]===null){this.deletedStates[t][u]={};for(const _ in this.state[t][u])l[_]||(this.deletedStates[t][u][_]=null)}else for(const _ in l)this.deletedStates[t]&&this.deletedStates[t][u]&&this.deletedStates[t][u][_]===null&&delete this.deletedStates[t][u][_]}removeFeatureState(t,r,l){if(this.deletedStates[t]===null)return;const u=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&r!==void 0)this.deletedStates[t][u]!==null&&(this.deletedStates[t][u]=this.deletedStates[t][u]||{},this.deletedStates[t][u][l]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][u])for(l in this.deletedStates[t][u]={},this.stateChanges[t][u])this.deletedStates[t][u][l]=null;else this.deletedStates[t][u]=null;else this.deletedStates[t]=null}getState(t,r){const l=String(r),u=s.e({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const _=this.deletedStates[t][r];if(_===null)return{};for(const x in _)delete u[x]}return u}initializeTileState(t,r){t.setFeatureState(this.state,r)}coalesceChanges(t,r){const l={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const _={};for(const x in this.stateChanges[u])this.state[u][x]||(this.state[u][x]={}),s.e(this.state[u][x],this.stateChanges[u][x]),_[x]=this.state[u][x];l[u]=_}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const _={};if(this.deletedStates[u]===null)for(const x in this.state[u])_[x]={},this.state[u][x]={};else for(const x in this.deletedStates[u]){if(this.deletedStates[u][x]===null)this.state[u][x]={};else for(const w of Object.keys(this.deletedStates[u][x]))delete this.state[u][x][w];_[x]=this.state[u][x]}l[u]=l[u]||{},s.e(l[u],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const u in t)t[u].setFeatureState(l,r)}}class Kn extends s.E{constructor(t,r,l){super(),this.id=t,this.dispatcher=l,this.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((u,_,x,w)=>{const I=new(Fi(_.type))(u,_,x,w);if(I.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${I.id}`);return I})(t,r,l,this),this._tiles={},this._cache=new Zn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Me,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const r=this._tiles[t];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,r){return this._source.loadTile(t,r)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new s.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const l=this._tiles[r];l.upload(t),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(mr).map(t=>t.key)}getRenderableIds(t){const r=[];for(const l in this._tiles)this._isIdRenderable(l,t)&&r.push(this._tiles[l]);return t?r.sort((l,u)=>{const _=l.tileID,x=u.tileID,w=new s.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),I=new s.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-x.overscaledZ||I.y-w.y||I.x-w.x}).map(l=>l.tileID.key):r.map(l=>l.tileID).sort(mr).map(l=>l.key)}hasRenderableParent(t){const r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,r){const l=this._tiles[t];l&&(l.state!=="loading"&&(l.state=r),this._loadTile(l,this._tileLoaded.bind(this,l,t,r)))}_tileLoaded(t,r,l,u){if(u)return t.state="errored",void(u.status!==404?this._source.fire(new s.j(u,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=s.h.now(),l==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new s.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const r=this.getRenderableIds();for(let u=0;u<r.length;u++){const _=r[u];if(t.neighboringTiles&&t.neighboringTiles[_]){const x=this.getTileByID(_);l(t,x),l(x,t)}}function l(u,_){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let x=_.tileID.canonical.x-u.tileID.canonical.x;const w=_.tileID.canonical.y-u.tileID.canonical.y,I=Math.pow(2,u.tileID.canonical.z),A=_.tileID.key;x===0&&w===0||Math.abs(w)>1||(Math.abs(x)>1&&(Math.abs(x+I)===1?x+=I:Math.abs(x-I)===1&&(x-=I)),_.dem&&u.dem&&(u.dem.backfillBorder(_.dem,x,w),u.neighboringTiles&&u.neighboringTiles[A]&&(u.neighboringTiles[A].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,l,u){for(const _ in this._tiles){let x=this._tiles[_];if(u[_]||!x.hasData()||x.tileID.overscaledZ<=r||x.tileID.overscaledZ>l)continue;let w=x.tileID;for(;x&&x.tileID.overscaledZ>r+1;){const A=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[A.key],x&&x.hasData()&&(w=A)}let I=w;for(;I.overscaledZ>r;)if(I=I.scaledTo(I.overscaledZ-1),t[I.key]){u[w.key]=w;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){const l=this._loadedParentTiles[t.key];return l&&l.tileID.overscaledZ>=r?l:null}for(let l=t.overscaledZ-1;l>=r;l--){const u=t.scaledTo(l),_=this._getLoadedTile(u);if(_)return _}}_getLoadedTile(t){const r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const r=Math.ceil(t.width/this._source.tileSize)+1,l=Math.ceil(t.height/this._source.tileSize)+1,u=Math.floor(r*l*(this._maxTileCacheZoomLevels===null?s.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(_)}handleWrapJump(t){const r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,r){const l={};for(const u in this._tiles){const _=this._tiles[u];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+r),l[_.tileID.key]=_}this._tiles=l;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}update(t,r){if(this.transform=t,this.terrain=r,!this._sourceLoaded||this._paused)return;let l;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(L=>new s.O(L.canonical.z,L.wrap,L.canonical.z,L.canonical.x,L.canonical.y)):(l=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r}),this._source.hasTile&&(l=l.filter(L=>this._source.hasTile(L)))):l=[];const u=t.coveringZoomLevel(this._source),_=Math.max(u-Kn.maxOverzooming,this._source.minzoom),x=Math.max(u+Kn.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const L={};for(const z of l)if(z.canonical.z>this._source.minzoom){const N=z.scaledTo(z.canonical.z-1);L[N.key]=N;const X=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));L[X.key]=X}l=l.concat(Object.values(L))}const w=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new s.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const I=this._updateRetainedTiles(l,u);if(Ai(this._source.type)){const L={},z={},N=Object.keys(I),X=s.h.now();for(const H of N){const J=I[H],G=this._tiles[H];if(!G||G.fadeEndTime!==0&&G.fadeEndTime<=X)continue;const de=this.findLoadedParent(J,_);de&&(this._addTile(de.tileID),L[de.tileID.key]=de.tileID),z[H]=J}this._retainLoadedChildren(z,u,x,I);for(const H in L)I[H]||(this._coveredTiles[H]=!0,I[H]=L[H]);if(r){const H={},J={};for(const G of l)this._tiles[G.key].hasData()?H[G.key]=G:J[G.key]=G;for(const G in J){const de=J[G].children(this._source.maxzoom);this._tiles[de[0].key]&&this._tiles[de[1].key]&&this._tiles[de[2].key]&&this._tiles[de[3].key]&&(H[de[0].key]=I[de[0].key]=de[0],H[de[1].key]=I[de[1].key]=de[1],H[de[2].key]=I[de[2].key]=de[2],H[de[3].key]=I[de[3].key]=de[3],delete J[G])}for(const G in J){const de=this.findLoadedParent(J[G],this._source.minzoom);if(de){H[de.tileID.key]=I[de.tileID.key]=de.tileID;for(const Se in H)H[Se].isChildOf(de.tileID)&&delete H[Se]}}for(const G in this._tiles)H[G]||(this._coveredTiles[G]=!0)}}for(const L in I)this._tiles[L].clearFadeHold();const A=s.ab(this._tiles,I);for(const L of A){const z=this._tiles[L];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(L)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,r){const l={},u={},_=Math.max(r-Kn.maxOverzooming,this._source.minzoom),x=Math.max(r+Kn.maxUnderzooming,this._source.minzoom),w={};for(const I of t){const A=this._addTile(I);l[I.key]=I,A.hasData()||r<this._source.maxzoom&&(w[I.key]=I)}this._retainLoadedChildren(w,r,x,l);for(const I of t){let A=this._tiles[I.key];if(A.hasData())continue;if(r+1>this._source.maxzoom){const z=I.children(this._source.maxzoom)[0],N=this.getTile(z);if(N&&N.hasData()){l[z.key]=z;continue}}else{const z=I.children(this._source.maxzoom);if(l[z[0].key]&&l[z[1].key]&&l[z[2].key]&&l[z[3].key])continue}let L=A.wasRequested();for(let z=I.overscaledZ-1;z>=_;--z){const N=I.scaledTo(z);if(u[N.key])break;if(u[N.key]=!0,A=this.getTile(N),!A&&L&&(A=this._addTile(N)),A){const X=A.hasData();if((L||X)&&(l[N.key]=N),L=A.wasRequested(),X)break}}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const r=[];let l,u=this._tiles[t].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}r.push(u.key);const _=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(_),l)break;u=_}for(const _ of r)this._loadedParentTiles[_]=l}}_addTile(t){let r=this._tiles[t.key];if(r)return r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const l=r;return r||(r=new fr(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))),r.uses++,this._tiles[t.key]=r,l||this._source.fire(new s.k("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const l=r.getExpiryTimeout();l&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},l))}_removeTile(t){const r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,r,l){const u=[],_=this.transform;if(!_)return u;const x=l?_.getCameraQueryGeometry(t):t,w=t.map(H=>_.pointCoordinate(H,this.terrain)),I=x.map(H=>_.pointCoordinate(H,this.terrain)),A=this.getIds();let L=1/0,z=1/0,N=-1/0,X=-1/0;for(const H of I)L=Math.min(L,H.x),z=Math.min(z,H.y),N=Math.max(N,H.x),X=Math.max(X,H.y);for(let H=0;H<A.length;H++){const J=this._tiles[A[H]];if(J.holdingForFade())continue;const G=J.tileID,de=Math.pow(2,_.zoom-J.tileID.overscaledZ),Se=r*J.queryPadding*s.N/J.tileSize/de,ie=[G.getTilePoint(new s.U(L,z)),G.getTilePoint(new s.U(N,X))];if(ie[0].x-Se<s.N&&ie[0].y-Se<s.N&&ie[1].x+Se>=0&&ie[1].y+Se>=0){const pe=w.map(ke=>G.getTilePoint(ke)),Ce=I.map(ke=>G.getTilePoint(ke));u.push({tile:J,tileID:G,queryGeometry:pe,cameraQueryGeometry:Ce,scale:de})}}return u}getVisibleCoordinates(t){const r=this.getRenderableIds(t).map(l=>this._tiles[l].tileID);for(const l of r)l.posMatrix=this.transform.calculatePosMatrix(l.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(Ai(this._source.type)){const t=s.h.now();for(const r in this._tiles)if(this._tiles[r].fadeEndTime>=t)return!0}return!1}setFeatureState(t,r,l){this._state.updateState(t=t||"_geojsonTileLayer",r,l)}removeFeatureState(t,r,l){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,l)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,l){const u=this._tiles[t];u&&u.setDependencies(r,l)}reloadTilesForDependencies(t,r){for(const l in this._tiles)this._tiles[l].hasDependency(t,r)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(t,r))}}function mr(f,t){const r=Math.abs(2*f.wrap)-+(f.wrap<0),l=Math.abs(2*t.wrap)-+(t.wrap<0);return f.overscaledZ-t.overscaledZ||l-r||t.canonical.y-f.canonical.y||t.canonical.x-f.canonical.x}function Ai(f){return f==="raster"||f==="image"||f==="video"}Kn.maxOverzooming=10,Kn.maxUnderzooming=3;const ii="mapboxgl_preloaded_worker_pool";class wr{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<wr.workerCount;)this.workers.push(new Worker(s.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ii]}numActive(){return Object.keys(this.active).length}}const Jn=Math.floor(s.h.hardwareConcurrency/2);let Sn;function en(){return Sn||(Sn=new wr),Sn}wr.workerCount=s.ac(globalThis)?Math.max(Math.min(Jn,3),1):1;class pi{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.ad(t,0,1);let r=1,l=this._distances[r];const u=t*this.paddedLength+this.padding;for(;l<u&&r<this._distances.length;)l=this._distances[++r];const _=r-1,x=this._distances[_],w=l-x,I=w>0?(u-x)/w:0;return this.points[_].mult(1-I).add(this.points[r].mult(I))}}function Ji(f,t){let r=!0;return f==="always"||f!=="never"&&t!=="never"||(r=!1),r}class wo{constructor(t,r,l){const u=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/l),this.yCellCount=Math.ceil(r/l);for(let x=0;x<this.xCellCount*this.yCellCount;x++)u.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,l,u,_){this._forEachCell(r,l,u,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(_)}insertCircle(t,r,l,u){this._forEachCell(r-u,l-u,r+u,l+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(l),this.circles.push(u)}_insertBoxCell(t,r,l,u,_,x){this.boxCells[_].push(x)}_insertCircleCell(t,r,l,u,_,x){this.circleCells[_].push(x)}_query(t,r,l,u,_,x,w){if(l<0||t>this.width||u<0||r>this.height)return[];const I=[];if(t<=0&&r<=0&&this.width<=l&&this.height<=u){if(_)return[{key:null,x1:t,y1:r,x2:l,y2:u}];for(let A=0;A<this.boxKeys.length;A++)I.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const L=this.circles[3*A],z=this.circles[3*A+1],N=this.circles[3*A+2];I.push({key:this.circleKeys[A],x1:L-N,y1:z-N,x2:L+N,y2:z+N})}}else this._forEachCell(t,r,l,u,this._queryCell,I,{hitTest:_,overlapMode:x,seenUids:{box:{},circle:{}}},w);return I}query(t,r,l,u){return this._query(t,r,l,u,!1,null)}hitTest(t,r,l,u,_,x){return this._query(t,r,l,u,!0,_,x).length>0}hitTestCircle(t,r,l,u,_){const x=t-l,w=t+l,I=r-l,A=r+l;if(w<0||x>this.width||A<0||I>this.height)return!1;const L=[];return this._forEachCell(x,I,w,A,this._queryCellCircle,L,{hitTest:!0,overlapMode:u,circle:{x:t,y:r,radius:l},seenUids:{box:{},circle:{}}},_),L.length>0}_queryCell(t,r,l,u,_,x,w,I){const{seenUids:A,hitTest:L,overlapMode:z}=w,N=this.boxCells[_];if(N!==null){const H=this.bboxes;for(const J of N)if(!A.box[J]){A.box[J]=!0;const G=4*J,de=this.boxKeys[J];if(t<=H[G+2]&&r<=H[G+3]&&l>=H[G+0]&&u>=H[G+1]&&(!I||I(de))&&(!L||!Ji(z,de.overlapMode))&&(x.push({key:de,x1:H[G],y1:H[G+1],x2:H[G+2],y2:H[G+3]}),L))return!0}}const X=this.circleCells[_];if(X!==null){const H=this.circles;for(const J of X)if(!A.circle[J]){A.circle[J]=!0;const G=3*J,de=this.circleKeys[J];if(this._circleAndRectCollide(H[G],H[G+1],H[G+2],t,r,l,u)&&(!I||I(de))&&(!L||!Ji(z,de.overlapMode))){const Se=H[G],ie=H[G+1],pe=H[G+2];if(x.push({key:de,x1:Se-pe,y1:ie-pe,x2:Se+pe,y2:ie+pe}),L)return!0}}}return!1}_queryCellCircle(t,r,l,u,_,x,w,I){const{circle:A,seenUids:L,overlapMode:z}=w,N=this.boxCells[_];if(N!==null){const H=this.bboxes;for(const J of N)if(!L.box[J]){L.box[J]=!0;const G=4*J,de=this.boxKeys[J];if(this._circleAndRectCollide(A.x,A.y,A.radius,H[G+0],H[G+1],H[G+2],H[G+3])&&(!I||I(de))&&!Ji(z,de.overlapMode))return x.push(!0),!0}}const X=this.circleCells[_];if(X!==null){const H=this.circles;for(const J of X)if(!L.circle[J]){L.circle[J]=!0;const G=3*J,de=this.circleKeys[J];if(this._circlesCollide(H[G],H[G+1],H[G+2],A.x,A.y,A.radius)&&(!I||I(de))&&!Ji(z,de.overlapMode))return x.push(!0),!0}}}_forEachCell(t,r,l,u,_,x,w,I){const A=this._convertToXCellCoord(t),L=this._convertToYCellCoord(r),z=this._convertToXCellCoord(l),N=this._convertToYCellCoord(u);for(let X=A;X<=z;X++)for(let H=L;H<=N;H++)if(_.call(this,t,r,l,u,this.xCellCount*H+X,x,w,I))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,l,u,_,x){const w=u-t,I=_-r,A=l+x;return A*A>w*w+I*I}_circleAndRectCollide(t,r,l,u,_,x,w){const I=(x-u)/2,A=Math.abs(t-(u+I));if(A>I+l)return!1;const L=(w-_)/2,z=Math.abs(r-(_+L));if(z>L+l)return!1;if(A<=I||z<=L)return!0;const N=A-I,X=z-L;return N*N+X*X<=l*l}}function it(f,t,r,l,u){const _=s.Z();return t?(s.a0(_,_,[1/u,1/u,1]),r||s.ae(_,_,l.angle)):s.a1(_,l.labelPlaneMatrix,f),_}function zr(f,t,r,l,u){if(t){const _=s.af(f);return s.a0(_,_,[u,u,1]),r||s.ae(_,_,-l.angle),_}return l.glCoordMatrix}function _n(f,t,r){let l;r?(l=[f.x,f.y,r(f.x,f.y),1],s.ag(l,l,t)):(l=[f.x,f.y,0,1],Y(l,l,t));const u=l[3];return{point:new s.P(l[0]/u,l[1]/u),signedDistanceFromCamera:u}}function hs(f,t){return .5+f/t*.5}function Sr(f,t){const r=f[0]/f[3],l=f[1]/f[3];return r>=-t[0]&&r<=t[0]&&l>=-t[1]&&l<=t[1]}function st(f,t,r,l,u,_,x,w,I,A){const L=l?f.textSizeData:f.iconSizeData,z=s.ah(L,r.transform.zoom),N=[256/r.width*2+1,256/r.height*2+1],X=l?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;X.clear();const H=f.lineVertexArray,J=l?f.text.placedSymbolArray:f.icon.placedSymbolArray,G=r.transform.width/r.transform.height;let de=!1;for(let Se=0;Se<J.length;Se++){const ie=J.get(Se);if(ie.hidden||ie.writingMode===s.ai.vertical&&!de){Z(ie.numGlyphs,X);continue}let pe;if(de=!1,A?(pe=[ie.anchorX,ie.anchorY,A(ie.anchorX,ie.anchorY),1],s.ag(pe,pe,t)):(pe=[ie.anchorX,ie.anchorY,0,1],Y(pe,pe,t)),!Sr(pe,N)){Z(ie.numGlyphs,X);continue}const Ce=hs(r.transform.cameraToCenterDistance,pe[3]),ke=s.aj(L,z,ie),Be=x?ke/Ce:ke*Ce,We=new s.P(ie.anchorX,ie.anchorY),je=_n(We,u,A).point,et={projections:{},offsets:{}},It=sr(ie,Be,!1,w,t,u,_,f.glyphOffsetArray,H,X,je,We,et,G,I,A);de=It.useVertical,(It.notEnoughRoom||de||It.needsFlipping&&sr(ie,Be,!0,w,t,u,_,f.glyphOffsetArray,H,X,je,We,et,G,I,A).notEnoughRoom)&&Z(ie.numGlyphs,X)}l?f.text.dynamicLayoutVertexBuffer.updateData(X):f.icon.dynamicLayoutVertexBuffer.updateData(X)}function ri(f,t,r,l,u,_,x,w,I,A,L,z,N){const X=w.glyphStartIndex+w.numGlyphs,H=w.lineStartIndex,J=w.lineStartIndex+w.lineLength,G=t.getoffsetX(w.glyphStartIndex),de=t.getoffsetX(X-1),Se=R(f*G,r,l,u,_,x,w.segment,H,J,I,A,L,z,N);if(!Se)return null;const ie=R(f*de,r,l,u,_,x,w.segment,H,J,I,A,L,z,N);return ie?{first:Se,last:ie}:null}function Kt(f,t,r,l){return f===s.ai.horizontal&&Math.abs(r.y-t.y)>Math.abs(r.x-t.x)*l?{useVertical:!0}:(f===s.ai.vertical?t.y<r.y:t.x>r.x)?{needsFlipping:!0}:null}function sr(f,t,r,l,u,_,x,w,I,A,L,z,N,X,H,J){const G=t/24,de=f.lineOffsetX*G,Se=f.lineOffsetY*G;let ie;if(f.numGlyphs>1){const pe=f.glyphStartIndex+f.numGlyphs,Ce=f.lineStartIndex,ke=f.lineStartIndex+f.lineLength,Be=ri(G,w,de,Se,r,L,z,f,I,_,N,H,J);if(!Be)return{notEnoughRoom:!0};const We=_n(Be.first.point,x,J).point,je=_n(Be.last.point,x,J).point;if(l&&!r){const et=Kt(f.writingMode,We,je,X);if(et)return et}ie=[Be.first];for(let et=f.glyphStartIndex+1;et<pe-1;et++)ie.push(R(G*w.getoffsetX(et),de,Se,r,L,z,f.segment,Ce,ke,I,_,N,H,J));ie.push(Be.last)}else{if(l&&!r){const Ce=_n(z,u,J).point,ke=f.lineStartIndex+f.segment+1,Be=new s.P(I.getx(ke),I.gety(ke)),We=_n(Be,u,J),je=We.signedDistanceFromCamera>0?We.point:Dr(z,Be,Ce,1,u,J),et=Kt(f.writingMode,Ce,je,X);if(et)return et}const pe=R(G*w.getoffsetX(f.glyphStartIndex),de,Se,r,L,z,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,I,_,N,H,J);if(!pe)return{notEnoughRoom:!0};ie=[pe]}for(const pe of ie)s.ak(A,pe.point,pe.angle);return{}}function Dr(f,t,r,l,u,_){const x=_n(f.add(f.sub(t)._unit()),u,_).point,w=r.sub(x);return r.add(w._mult(l/w.mag()))}function Gt(f,t){const{projectionCache:r,lineVertexArray:l,labelPlaneMatrix:u,tileAnchorPoint:_,distanceFromAnchor:x,getElevation:w,previousVertex:I,direction:A,absOffsetX:L}=t;if(r.projections[f])return r.projections[f];const z=new s.P(l.getx(f),l.gety(f)),N=_n(z,u,w);if(N.signedDistanceFromCamera>0)return r.projections[f]=N.point,N.point;const X=f-A;return Dr(x===0?_:new s.P(l.getx(X),l.gety(X)),z,I,L-x+1,u,w)}function Gr(f,t,r){return f._unit()._perp()._mult(t*r)}function K(f,t,r,l,u,_,x,w){const{projectionCache:I,direction:A}=w;if(I.offsets[f])return I.offsets[f];const L=r.add(t);if(f+A<l||f+A>=u)return I.offsets[f]=L,L;const z=Gt(f+A,w),N=Gr(z.sub(r),x,A),X=r.add(N),H=z.add(N);return I.offsets[f]=s.al(_,L,X,H)||L,I.offsets[f]}function R(f,t,r,l,u,_,x,w,I,A,L,z,N,X){const H=l?f-t:f+t;let J=H>0?1:-1,G=0;l&&(J*=-1,G=Math.PI),J<0&&(G+=Math.PI);let de,Se,ie=J>0?w+x:w+x+1,pe=u,Ce=u,ke=0,Be=0;const We=Math.abs(H),je=[];let et;for(;ke+Be<=We;){if(ie+=J,ie<w||ie>=I)return null;ke+=Be,Ce=pe,Se=de;const dt={projectionCache:z,lineVertexArray:A,labelPlaneMatrix:L,tileAnchorPoint:_,distanceFromAnchor:ke,getElevation:X,previousVertex:Ce,direction:J,absOffsetX:We};if(pe=Gt(ie,dt),r===0)je.push(Ce),et=pe.sub(Ce);else{let Xt;const Mt=pe.sub(Ce);Xt=Mt.mag()===0?Gr(Gt(ie+J,dt).sub(pe),r,J):Gr(Mt,r,J),Se||(Se=Ce.add(Xt)),de=K(ie,Xt,pe,w,I,Se,r,dt),je.push(Se),et=de.sub(Se)}Be=et.mag()}const It=et._mult((We-ke)/Be)._add(Se||Ce),yi=G+Math.atan2(pe.y-Ce.y,pe.x-Ce.x);return je.push(It),{point:It,angle:N?yi:0,path:je}}const B=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Z(f,t){for(let r=0;r<f;r++){const l=t.length;t.resize(l+4),t.float32.set(B,3*l)}}function Y(f,t,r){const l=t[0],u=t[1];return f[0]=r[0]*l+r[4]*u+r[12],f[1]=r[1]*l+r[5]*u+r[13],f[3]=r[3]*l+r[7]*u+r[15],f}const $=100;class _e{constructor(t,r=new wo(t.width+200,t.height+200,25),l=new wo(t.width+200,t.height+200,25)){this.transform=t,this.grid=r,this.ignoredGrid=l,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+$,this.screenBottomBoundary=t.height+$,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,r,l,u,_,x){const w=this.projectAndGetPerspectiveRatio(u,t.anchorPointX,t.anchorPointY,x),I=l*w.perspectiveRatio,A=t.x1*I+w.point.x,L=t.y1*I+w.point.y,z=t.x2*I+w.point.x,N=t.y2*I+w.point.y;return!this.isInsideGrid(A,L,z,N)||r!=="always"&&this.grid.hitTest(A,L,z,N,r,_)||w.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[A,L,z,N],offscreen:this.isOffscreen(A,L,z,N)}}placeCollisionCircles(t,r,l,u,_,x,w,I,A,L,z,N,X,H){const J=[],G=new s.P(r.anchorX,r.anchorY),de=_n(G,x,H),Se=hs(this.transform.cameraToCenterDistance,de.signedDistanceFromCamera),ie=(L?_/Se:_*Se)/s.ap,pe=_n(G,w,H).point,Ce=ri(ie,u,r.lineOffsetX*ie,r.lineOffsetY*ie,!1,pe,G,r,l,w,{projections:{},offsets:{}},!1,H);let ke=!1,Be=!1,We=!0;if(Ce){const je=.5*N*Se+X,et=new s.P(-100,-100),It=new s.P(this.screenRightBoundary,this.screenBottomBoundary),yi=new pi,dt=Ce.first,Xt=Ce.last;let Mt=[];for(let ai=dt.path.length-1;ai>=1;ai--)Mt.push(dt.path[ai]);for(let ai=1;ai<Xt.path.length;ai++)Mt.push(Xt.path[ai]);const Ki=2.5*je;if(I){const ai=Mt.map(vi=>_n(vi,I,H));Mt=ai.some(vi=>vi.signedDistanceFromCamera<=0)?[]:ai.map(vi=>vi.point)}let mi=[];if(Mt.length>0){const ai=Mt[0].clone(),vi=Mt[0].clone();for(let Ln=1;Ln<Mt.length;Ln++)ai.x=Math.min(ai.x,Mt[Ln].x),ai.y=Math.min(ai.y,Mt[Ln].y),vi.x=Math.max(vi.x,Mt[Ln].x),vi.y=Math.max(vi.y,Mt[Ln].y);mi=ai.x>=et.x&&vi.x<=It.x&&ai.y>=et.y&&vi.y<=It.y?[Mt]:vi.x<et.x||ai.x>It.x||vi.y<et.y||ai.y>It.y?[]:s.am([Mt],et.x,et.y,It.x,It.y)}for(const ai of mi){yi.reset(ai,.25*je);let vi=0;vi=yi.length<=.5*je?1:Math.ceil(yi.paddedLength/Ki)+1;for(let Ln=0;Ln<vi;Ln++){const sn=Ln/Math.max(vi-1,1),yr=yi.lerp(sn),Qn=yr.x+$,Un=yr.y+$;J.push(Qn,Un,je,0);const co=Qn-je,fn=Un-je,es=Qn+je,ts=Un+je;if(We=We&&this.isOffscreen(co,fn,es,ts),Be=Be||this.isInsideGrid(co,fn,es,ts),t!=="always"&&this.grid.hitTestCircle(Qn,Un,je,t,z)&&(ke=!0,!A))return{circles:[],offscreen:!1,collisionDetected:ke}}}}return{circles:!A&&ke||!Be||Se<this.perspectiveRatioCutoff?[]:J,offscreen:We,collisionDetected:ke}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[];let l=1/0,u=1/0,_=-1/0,x=-1/0;for(const L of t){const z=new s.P(L.x+$,L.y+$);l=Math.min(l,z.x),u=Math.min(u,z.y),_=Math.max(_,z.x),x=Math.max(x,z.y),r.push(z)}const w=this.grid.query(l,u,_,x).concat(this.ignoredGrid.query(l,u,_,x)),I={},A={};for(const L of w){const z=L.key;if(I[z.bucketInstanceId]===void 0&&(I[z.bucketInstanceId]={}),I[z.bucketInstanceId][z.featureIndex])continue;const N=[new s.P(L.x1,L.y1),new s.P(L.x2,L.y1),new s.P(L.x2,L.y2),new s.P(L.x1,L.y2)];s.an(r,N)&&(I[z.bucketInstanceId][z.featureIndex]=!0,A[z.bucketInstanceId]===void 0&&(A[z.bucketInstanceId]=[]),A[z.bucketInstanceId].push(z.featureIndex))}return A}insertCollisionBox(t,r,l,u,_,x){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:_,collisionGroupID:x,overlapMode:r},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,l,u,_,x){const w=l?this.ignoredGrid:this.grid,I={bucketInstanceId:u,featureIndex:_,collisionGroupID:x,overlapMode:r};for(let A=0;A<t.length;A+=4)w.insertCircle(I,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,r,l,u){let _;return u?(_=[r,l,u(r,l),1],s.ag(_,_,t)):(_=[r,l,0,1],Y(_,_,t)),{point:new s.P((_[0]/_[3]+1)/2*this.transform.width+$,(-_[1]/_[3]+1)/2*this.transform.height+$),perspectiveRatio:.5+this.transform.cameraToCenterDistance/_[3]*.5}}isOffscreen(t,r,l,u){return l<$||t>=this.screenRightBoundary||u<$||r>this.screenBottomBoundary}isInsideGrid(t,r,l,u){return l>=0&&t<this.gridRightBoundary&&u>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=s.ao([]);return s.$(t,t,[-100,-100,0]),t}}function ae(f,t,r){return t*(s.N/(f.tileSize*Math.pow(2,r-f.tileID.overscaledZ)))}class ne{constructor(t,r,l,u){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):u&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class ue{constructor(t,r,l,u,_){this.text=new ne(t?t.text:null,r,l,_),this.icon=new ne(t?t.icon:null,r,u,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ze{constructor(t,r,l){this.text=t,this.icon=r,this.skipFade=l}}class Re{constructor(){this.invProjMatrix=s.Z(),this.viewportMatrix=s.Z(),this.circles=[]}}class Oe{constructor(t,r,l,u,_){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=l,this.bucketIndex=u,this.tileID=_}}class kt{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:l=>l.collisionGroupID===r}}return this.collisionGroups[t]}}function Jt(f,t,r,l,u){const{horizontalAlign:_,verticalAlign:x}=s.au(f);return new s.P(-(_-.5)*t+l[0]*u,-(x-.5)*r+l[1]*u)}function wt(f,t,r,l,u,_){const{x1:x,x2:w,y1:I,y2:A,anchorPointX:L,anchorPointY:z}=f,N=new s.P(t,r);return l&&N._rotate(u?_:-_),{x1:x+N.x,y1:I+N.y,x2:w+N.x,y2:A+N.y,anchorPointX:L,anchorPointY:z}}class Rt{constructor(t,r,l,u,_){this.transform=t.clone(),this.terrain=r,this.collisionIndex=new _e(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new kt(u),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,r,l,u){const _=l.getBucket(r),x=l.latestFeatureIndex;if(!_||!x||r.id!==_.layerIds[0])return;const w=l.collisionBoxArray,I=_.layers[0].layout,A=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),L=l.tileSize/s.N,z=this.transform.calculatePosMatrix(l.tileID.toUnwrapped()),N=I.get("text-pitch-alignment")==="map",X=I.get("text-rotation-alignment")==="map",H=ae(l,1,this.transform.zoom),J=it(z,N,X,this.transform,H);let G=null;if(N){const Se=zr(z,N,X,this.transform,H);G=s.a1([],this.transform.labelPlaneMatrix,Se)}this.retainedQueryData[_.bucketInstanceId]=new Oe(_.bucketInstanceId,x,_.sourceLayerIndex,_.index,l.tileID);const de={bucket:_,layout:I,posMatrix:z,textLabelPlaneMatrix:J,labelToScreenMatrix:G,scale:A,textPixelRatio:L,holdingForFade:l.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:s.ah(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(u)for(const Se of _.sortKeyRanges){const{sortKey:ie,symbolInstanceStart:pe,symbolInstanceEnd:Ce}=Se;t.push({sortKey:ie,symbolInstanceStart:pe,symbolInstanceEnd:Ce,parameters:de})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:de})}attemptAnchorPlacement(t,r,l,u,_,x,w,I,A,L,z,N,X,H,J,G){const de=s.aq[t.textAnchor],Se=[t.textOffset0,t.textOffset1],ie=Jt(de,l,u,Se,_),pe=this.collisionIndex.placeCollisionBox(wt(r,ie.x,ie.y,x,w,this.transform.angle),z,I,A,L.predicate,G);if((!J||this.collisionIndex.placeCollisionBox(wt(J,ie.x,ie.y,x,w,this.transform.angle),z,I,A,L.predicate,G).box.length!==0)&&pe.box.length>0){let Ce;if(this.prevPlacement&&this.prevPlacement.variableOffsets[N.crossTileID]&&this.prevPlacement.placements[N.crossTileID]&&this.prevPlacement.placements[N.crossTileID].text&&(Ce=this.prevPlacement.variableOffsets[N.crossTileID].anchor),N.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[N.crossTileID]={textOffset:Se,width:l,height:u,anchor:de,textBoxScale:_,prevAnchor:Ce},this.markUsedJustification(X,de,N,H),X.allowVerticalPlacement&&(this.markUsedOrientation(X,H,N),this.placedOrientations[N.crossTileID]=H),{shift:ie,placedGlyphBoxes:pe}}}placeLayerBucketPart(t,r,l){const{bucket:u,layout:_,posMatrix:x,textLabelPlaneMatrix:w,labelToScreenMatrix:I,textPixelRatio:A,holdingForFade:L,collisionBoxArray:z,partiallyEvaluatedTextSize:N,collisionGroup:X}=t.parameters,H=_.get("text-optional"),J=_.get("icon-optional"),G=s.ar(_,"text-overlap","text-allow-overlap"),de=G==="always",Se=s.ar(_,"icon-overlap","icon-allow-overlap"),ie=Se==="always",pe=_.get("text-rotation-alignment")==="map",Ce=_.get("text-pitch-alignment")==="map",ke=_.get("icon-text-fit")!=="none",Be=_.get("symbol-z-order")==="viewport-y",We=de&&(ie||!u.hasIconData()||J),je=ie&&(de||!u.hasTextData()||H);!u.collisionArrays&&z&&u.deserializeCollisionBoxes(z);const et=this.retainedQueryData[u.bucketInstanceId].tileID,It=this.terrain?(dt,Xt)=>this.terrain.getElevation(et,dt,Xt):null,yi=(dt,Xt)=>{var Mt,Ki;if(r[dt.crossTileID])return;if(L)return void(this.placements[dt.crossTileID]=new ze(!1,!1,!1));let mi=!1,ai=!1,vi=!0,Ln=null,sn={box:null,offscreen:null},yr={box:null,offscreen:null},Qn=null,Un=null,co=null,fn=0,es=0,ts=0;Xt.textFeatureIndex?fn=Xt.textFeatureIndex:dt.useRuntimeCollisionCircles&&(fn=dt.featureIndex),Xt.verticalTextFeatureIndex&&(es=Xt.verticalTextFeatureIndex);const Fs=Xt.textBox;if(Fs){const Mr=zn=>{let $n=s.ai.horizontal;if(u.allowVerticalPlacement&&!zn&&this.prevPlacement){const Jr=this.prevPlacement.placedOrientations[dt.crossTileID];Jr&&(this.placedOrientations[dt.crossTileID]=Jr,$n=Jr,this.markUsedOrientation(u,$n,dt))}return $n},vr=(zn,$n)=>{if(u.allowVerticalPlacement&&dt.numVerticalGlyphVertices>0&&Xt.verticalTextBox){for(const Jr of u.writingModes)if(Jr===s.ai.vertical?(sn=$n(),yr=sn):sn=zn(),sn&&sn.box&&sn.box.length)break}else sn=zn()},Br=dt.textAnchorOffsetStartIndex,ia=dt.textAnchorOffsetEndIndex;if(ia===Br){const zn=($n,Jr)=>{const Dn=this.collisionIndex.placeCollisionBox($n,G,A,x,X.predicate,It);return Dn&&Dn.box&&Dn.box.length&&(this.markUsedOrientation(u,Jr,dt),this.placedOrientations[dt.crossTileID]=Jr),Dn};vr(()=>zn(Fs,s.ai.horizontal),()=>{const $n=Xt.verticalTextBox;return u.allowVerticalPlacement&&dt.numVerticalGlyphVertices>0&&$n?zn($n,s.ai.vertical):{box:null,offscreen:null}}),Mr(sn&&sn.box&&sn.box.length)}else{let zn=s.aq[(Ki=(Mt=this.prevPlacement)===null||Mt===void 0?void 0:Mt.variableOffsets[dt.crossTileID])===null||Ki===void 0?void 0:Ki.anchor];const $n=(Dn,na,kl)=>{const iu=Dn.x2-Dn.x1,nu=Dn.y2-Dn.y1,Vu=dt.textBoxScale,hc=ke&&Se==="never"?na:null;let is={box:[],offscreen:!1},ra=G==="never"?1:2,ns="never";zn&&ra++;for(let Ao=0;Ao<ra;Ao++){for(let rs=Br;rs<ia;rs++){const dc=u.textAnchorOffsets.get(rs);if(zn&&dc.textAnchor!==zn)continue;const ys=this.attemptAnchorPlacement(dc,Dn,iu,nu,Vu,pe,Ce,A,x,X,ns,dt,u,kl,hc,It);if(ys&&(is=ys.placedGlyphBoxes,is&&is.box&&is.box.length))return mi=!0,Ln=ys.shift,is}zn?zn=null:ns=G}return is};vr(()=>$n(Fs,Xt.iconBox,s.ai.horizontal),()=>{const Dn=Xt.verticalTextBox;return u.allowVerticalPlacement&&!(sn&&sn.box&&sn.box.length)&&dt.numVerticalGlyphVertices>0&&Dn?$n(Dn,Xt.verticalIconBox,s.ai.vertical):{box:null,offscreen:null}}),sn&&(mi=sn.box,vi=sn.offscreen);const Jr=Mr(sn&&sn.box);if(!mi&&this.prevPlacement){const Dn=this.prevPlacement.variableOffsets[dt.crossTileID];Dn&&(this.variableOffsets[dt.crossTileID]=Dn,this.markUsedJustification(u,Dn.anchor,dt,Jr))}}}if(Qn=sn,mi=Qn&&Qn.box&&Qn.box.length>0,vi=Qn&&Qn.offscreen,dt.useRuntimeCollisionCircles){const Mr=u.text.placedSymbolArray.get(dt.centerJustifiedTextSymbolIndex),vr=s.aj(u.textSizeData,N,Mr),Br=_.get("text-padding");Un=this.collisionIndex.placeCollisionCircles(G,Mr,u.lineVertexArray,u.glyphOffsetArray,vr,x,w,I,l,Ce,X.predicate,dt.collisionCircleDiameter,Br,It),Un.circles.length&&Un.collisionDetected&&!l&&s.w("Collisions detected, but collision boxes are not shown"),mi=de||Un.circles.length>0&&!Un.collisionDetected,vi=vi&&Un.offscreen}if(Xt.iconFeatureIndex&&(ts=Xt.iconFeatureIndex),Xt.iconBox){const Mr=vr=>{const Br=ke&&Ln?wt(vr,Ln.x,Ln.y,pe,Ce,this.transform.angle):vr;return this.collisionIndex.placeCollisionBox(Br,Se,A,x,X.predicate,It)};yr&&yr.box&&yr.box.length&&Xt.verticalIconBox?(co=Mr(Xt.verticalIconBox),ai=co.box.length>0):(co=Mr(Xt.iconBox),ai=co.box.length>0),vi=vi&&co.offscreen}const ta=H||dt.numHorizontalGlyphVertices===0&&dt.numVerticalGlyphVertices===0,Na=J||dt.numIconVertices===0;if(ta||Na?Na?ta||(ai=ai&&mi):mi=ai&&mi:ai=mi=ai&&mi,mi&&Qn&&Qn.box&&this.collisionIndex.insertCollisionBox(Qn.box,G,_.get("text-ignore-placement"),u.bucketInstanceId,yr&&yr.box&&es?es:fn,X.ID),ai&&co&&this.collisionIndex.insertCollisionBox(co.box,Se,_.get("icon-ignore-placement"),u.bucketInstanceId,ts,X.ID),Un&&(mi&&this.collisionIndex.insertCollisionCircles(Un.circles,G,_.get("text-ignore-placement"),u.bucketInstanceId,fn,X.ID),l)){const Mr=u.bucketInstanceId;let vr=this.collisionCircleArrays[Mr];vr===void 0&&(vr=this.collisionCircleArrays[Mr]=new Re);for(let Br=0;Br<Un.circles.length;Br+=4)vr.circles.push(Un.circles[Br+0]),vr.circles.push(Un.circles[Br+1]),vr.circles.push(Un.circles[Br+2]),vr.circles.push(Un.collisionDetected?1:0)}if(dt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[dt.crossTileID]=new ze(mi||We,ai||je,vi||u.justReloaded),r[dt.crossTileID]=!0};if(Be){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const dt=u.getSortedSymbolIndexes(this.transform.angle);for(let Xt=dt.length-1;Xt>=0;--Xt){const Mt=dt[Xt];yi(u.symbolInstances.get(Mt),u.collisionArrays[Mt])}}else for(let dt=t.symbolInstanceStart;dt<t.symbolInstanceEnd;dt++)yi(u.symbolInstances.get(dt),u.collisionArrays[dt]);if(l&&u.bucketInstanceId in this.collisionCircleArrays){const dt=this.collisionCircleArrays[u.bucketInstanceId];s.as(dt.invProjMatrix,x),dt.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}markUsedJustification(t,r,l,u){let _;_=u===s.ai.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[s.at(r)];const x=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const w of x)w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=_>=0&&w!==_?0:l.crossTileID)}markUsedOrientation(t,r,l){const u=r===s.ai.horizontal||r===s.ai.horizontalOnly?r:0,_=r===s.ai.vertical?r:0,x=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const w of x)t.text.placedSymbolArray.get(w).placedOrientation=u;l.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let l=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const u=r?r.symbolFadeChange(t):1,_=r?r.opacities:{},x=r?r.variableOffsets:{},w=r?r.placedOrientations:{};for(const I in this.placements){const A=this.placements[I],L=_[I];L?(this.opacities[I]=new ue(L,u,A.text,A.icon),l=l||A.text!==L.text.placed||A.icon!==L.icon.placed):(this.opacities[I]=new ue(null,u,A.text,A.icon,A.skipFade),l=l||A.text||A.icon)}for(const I in _){const A=_[I];if(!this.opacities[I]){const L=new ue(A,u,!1,!1);L.isHidden()||(this.opacities[I]=L,l=l||A.text.placed||A.icon.placed)}}for(const I in x)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=x[I]);for(const I in w)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=w[I]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r){const l={};for(const u of r){const _=u.getBucket(t);_&&u.latestFeatureIndex&&t.id===_.layerIds[0]&&this.updateBucketOpacities(_,l,u.collisionBoxArray)}}updateBucketOpacities(t,r,l){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const u=t.layers[0],_=u.layout,x=new ue(null,0,!1,!1,!0),w=_.get("text-allow-overlap"),I=_.get("icon-allow-overlap"),A=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),L=_.get("text-rotation-alignment")==="map",z=_.get("text-pitch-alignment")==="map",N=_.get("icon-text-fit")!=="none",X=new ue(null,0,w&&(I||!t.hasIconData()||_.get("icon-optional")),I&&(w||!t.hasTextData()||_.get("text-optional")),!0);!t.collisionArrays&&l&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(l);const H=(J,G,de)=>{for(let Se=0;Se<G/4;Se++)J.opacityVertexArray.emplaceBack(de);J.hasVisibleVertices=J.hasVisibleVertices||de!==Wr};for(let J=0;J<t.symbolInstances.length;J++){const G=t.symbolInstances.get(J),{numHorizontalGlyphVertices:de,numVerticalGlyphVertices:Se,crossTileID:ie}=G;let pe=this.opacities[ie];r[ie]?pe=x:pe||(pe=X,this.opacities[ie]=pe),r[ie]=!0;const Ce=G.numIconVertices>0,ke=this.placedOrientations[G.crossTileID],Be=ke===s.ai.vertical,We=ke===s.ai.horizontal||ke===s.ai.horizontalOnly;if(de>0||Se>0){const je=Bn(pe.text);H(t.text,de,Be?Wr:je),H(t.text,Se,We?Wr:je);const et=pe.text.isHidden();[G.rightJustifiedTextSymbolIndex,G.centerJustifiedTextSymbolIndex,G.leftJustifiedTextSymbolIndex].forEach(dt=>{dt>=0&&(t.text.placedSymbolArray.get(dt).hidden=et||Be?1:0)}),G.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(G.verticalPlacedTextSymbolIndex).hidden=et||We?1:0);const It=this.variableOffsets[G.crossTileID];It&&this.markUsedJustification(t,It.anchor,G,ke);const yi=this.placedOrientations[G.crossTileID];yi&&(this.markUsedJustification(t,"left",G,yi),this.markUsedOrientation(t,yi,G))}if(Ce){const je=Bn(pe.icon),et=!(N&&G.verticalPlacedIconSymbolIndex&&Be);G.placedIconSymbolIndex>=0&&(H(t.icon,G.numIconVertices,et?je:Wr),t.icon.placedSymbolArray.get(G.placedIconSymbolIndex).hidden=pe.icon.isHidden()),G.verticalPlacedIconSymbolIndex>=0&&(H(t.icon,G.numVerticalIconVertices,et?Wr:je),t.icon.placedSymbolArray.get(G.verticalPlacedIconSymbolIndex).hidden=pe.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const je=t.collisionArrays[J];if(je){let et=new s.P(0,0);if(je.textBox||je.verticalTextBox){let yi=!0;if(A){const dt=this.variableOffsets[ie];dt?(et=Jt(dt.anchor,dt.width,dt.height,dt.textOffset,dt.textBoxScale),L&&et._rotate(z?this.transform.angle:-this.transform.angle)):yi=!1}je.textBox&&ei(t.textCollisionBox.collisionVertexArray,pe.text.placed,!yi||Be,et.x,et.y),je.verticalTextBox&&ei(t.textCollisionBox.collisionVertexArray,pe.text.placed,!yi||We,et.x,et.y)}const It=!!(!We&&je.verticalIconBox);je.iconBox&&ei(t.iconCollisionBox.collisionVertexArray,pe.icon.placed,It,N?et.x:0,N?et.y:0),je.verticalIconBox&&ei(t.iconCollisionBox.collisionVertexArray,pe.icon.placed,!It,N?et.x:0,N?et.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const J=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=J.invProjMatrix,t.placementViewportMatrix=J.viewportMatrix,t.collisionCircleArray=J.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const l=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*l>t}setStale(){this.stale=!0}}function ei(f,t,r,l,u){f.emplaceBack(t?1:0,r?1:0,l||0,u||0),f.emplaceBack(t?1:0,r?1:0,l||0,u||0),f.emplaceBack(t?1:0,r?1:0,l||0,u||0),f.emplaceBack(t?1:0,r?1:0,l||0,u||0)}const zi=Math.pow(2,25),si=Math.pow(2,24),Ii=Math.pow(2,17),wi=Math.pow(2,16),ar=Math.pow(2,9),Hi=Math.pow(2,8),Mn=Math.pow(2,1);function Bn(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const t=f.placed?1:0,r=Math.floor(127*f.opacity);return r*zi+t*si+r*Ii+t*wi+r*ar+t*Hi+r*Mn+t}const Wr=0;class Bs{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,r,l,u,_){const x=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(x,u,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((w,I)=>w.sortKey-I.sortKey));this._currentPartIndex<x.length;)if(r.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,_())return!0;return!1}}class Zo{constructor(t,r,l,u,_,x,w,I){this.placement=new Rt(t,r,x,w,I),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(t,r,l){const u=s.h.now(),_=()=>!this._forceFullPlacement&&s.h.now()-u>2;for(;this._currentPlacementIndex>=0;){const x=r[t[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=w)&&(!x.maxzoom||x.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new Bs(x)),this._inProgressLayer.continuePlacement(l[x.source],this.placement,this._showCollisionBoxes,x,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Go=512/s.N/2;class Nn{constructor(t,r,l){this.tileID=t,this.bucketInstanceId=l,this._symbolsByKey={};const u=new Map;for(let _=0;_<r.length;_++){const x=r.get(_),w=x.key,I=u.get(w);I?I.push(x):u.set(w,[x])}for(const[_,x]of u){const w={positions:x.map(I=>({x:Math.floor(I.anchorX*Go),y:Math.floor(I.anchorY*Go)})),crossTileIDs:x.map(I=>I.crossTileID)};if(w.positions.length>128){const I=new s.av(w.positions.length,16,Uint16Array);for(const{x:A,y:L}of w.positions)I.add(A,L);I.finish(),delete w.positions,w.index=I}this._symbolsByKey[_]=w}}getScaledCoordinates(t,r){const{x:l,y:u,z:_}=this.tileID.canonical,{x,y:w,z:I}=r.canonical,A=Go/Math.pow(2,I-_),L=(w*s.N+t.anchorY)*A,z=u*s.N*Go;return{x:Math.floor((x*s.N+t.anchorX)*A-l*s.N*Go),y:Math.floor(L-z)}}findMatches(t,r,l){const u=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let _=0;_<t.length;_++){const x=t.get(_);if(x.crossTileID)continue;const w=this._symbolsByKey[x.key];if(!w)continue;const I=this.getScaledCoordinates(x,r);if(w.index){const A=w.index.range(I.x-u,I.y-u,I.x+u,I.y+u).sort();for(const L of A){const z=w.crossTileIDs[L];if(!l[z]){l[z]=!0,x.crossTileID=z;break}}}else if(w.positions)for(let A=0;A<w.positions.length;A++){const L=w.positions[A],z=w.crossTileIDs[A];if(Math.abs(L.x-I.x)<=u&&Math.abs(L.y-I.y)<=u&&!l[z]){l[z]=!0,x.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class Ri{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class pa{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(r!==0)for(const l in this.indexes){const u=this.indexes[l],_={};for(const x in u){const w=u[x];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+r),_[w.tileID.key]=w}this.indexes[l]=_}this.lng=t}addBucket(t,r,l){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<r.symbolInstances.length;_++)r.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const u=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const x=this.indexes[_];if(Number(_)>t.overscaledZ)for(const w in x){const I=x[w];I.tileID.isChildOf(t)&&I.findMatches(r.symbolInstances,t,u)}else{const w=x[t.scaledTo(Number(_)).key];w&&w.findMatches(r.symbolInstances,t,u)}}for(let _=0;_<r.symbolInstances.length;_++){const x=r.symbolInstances.get(_);x.crossTileID||(x.crossTileID=l.generate(),u[x.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Nn(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const l of r.getCrossTileIDsLists())for(const u of l)delete this.usedCrossTileIDs[t][u]}removeStaleBuckets(t){let r=!1;for(const l in this.indexes){const u=this.indexes[l];for(const _ in u)t[u[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,u[_]),delete u[_],r=!0)}return r}}class no{constructor(){this.layerIndexes={},this.crossTileIDs=new Ri,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,l){let u=this.layerIndexes[t.id];u===void 0&&(u=this.layerIndexes[t.id]=new pa);let _=!1;const x={};u.handleWrapJump(l);for(const w of r){const I=w.getBucket(t);I&&t.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(w.tileID,I,this.crossTileIDs)&&(_=!0),x[I.bucketInstanceId]=!0)}return u.removeStaleBuckets(x)&&(_=!0),_}pruneUnusedLayers(t){const r={};t.forEach(l=>{r[l]=!0});for(const l in this.layerIndexes)r[l]||delete this.layerIndexes[l]}}const on=(f,t)=>s.x(f,t&&t.filter(r=>r.identifier!=="source.canvas")),lr=s.F(s.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),ds=s.F(s.ax,["setCenter","setZoom","setBearing","setPitch"]),Gn=s.aw();class Wn extends s.E{constructor(t,r={}){super(),this.map=t,this.dispatcher=new Ei(en(),this,t._getMapId()),this.imageManager=new $e,this.imageManager.setEventedParent(this),this.glyphManager=new Bt(t._requestManager,r.localIdeographFontFamily),this.lineAtlas=new On(256,512),this.crossTileSymbolIndex=new no,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.az());const l=this;this._rtlTextPluginCallback=Wn.registerForPluginStateChange(u=>{l.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:u.pluginStatus,pluginURL:u.pluginURL},(_,x)=>{if(s.aA(_),x&&x.every(w=>w))for(const w in l.sourceCaches){const I=l.sourceCaches[w].getSource().type;I!=="vector"&&I!=="geojson"||l.sourceCaches[w].reload()}})}),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const _=this.sourceCaches[u.sourceId];if(!_)return;const x=_.getSource();if(x&&x.vectorLayerIds)for(const w in this._layers){const I=this._layers[w];I.source===x.id&&this._validateLayer(I)}})}loadURL(t,r={},l){this.fire(new s.k("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const u=this.map._requestManager.transformRequest(t,Te.Style);this._request=s.f(u,(_,x)=>{this._request=null,_?this.fire(new s.j(_)):x&&this._load(x,r,l)})}loadJSON(t,r={},l){this.fire(new s.k("dataloading",{dataType:"style"})),this._request=s.h.frame(()=>{this._request=null,r.validate=r.validate!==!1,this._load(t,r,l)})}loadEmpty(){this.fire(new s.k("dataloading",{dataType:"style"})),this._load(Gn,{validate:!1})}_load(t,r,l){var u;const _=r.transformStyle?r.transformStyle(l,t):t;if(!r.validate||!on(this,s.y(_))){this._loaded=!0,this.stylesheet=_;for(const x in _.sources)this.addSource(x,_.sources[x],{validate:!1});_.sprite?this._loadSprite(_.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(_.glyphs),this._createLayers(),this.light=new Rn(this.stylesheet.light),this.map.setTerrain((u=this.stylesheet.terrain)!==null&&u!==void 0?u:null),this.fire(new s.k("data",{dataType:"style"})),this.fire(new s.k("style.load"))}}_createLayers(){const t=s.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(r=>r.id),this._layers={},this._serializedLayers=null;for(const r of t){const l=s.aC(r);l.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=l}}_loadSprite(t,r=!1,l=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(u,_,x,w){const I=Dt(u),A=I.length,L=x>1?"@2x":"",z={},N={},X={};for(const{id:H,url:J}of I){const G=_.transformRequest(_.normalizeSpriteURL(J,L,".json"),Te.SpriteJSON),de=`${H}_${G.url}`;z[de]=s.f(G,(pe,Ce)=>{delete z[de],N[H]=Ce,bt(w,N,X,pe,A)});const Se=_.transformRequest(_.normalizeSpriteURL(J,L,".png"),Te.SpriteImage),ie=`${H}_${Se.url}`;z[ie]=me.getImage(Se,(pe,Ce)=>{delete z[ie],X[H]=Ce,bt(w,N,X,pe,A)})}return{cancel(){for(const H of Object.values(z))H.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),(u,_)=>{if(this._spriteRequest=null,u)this.fire(new s.j(u));else if(_)for(const x in _){this._spritesImagesIds[x]=[];const w=this._spritesImagesIds[x]?this._spritesImagesIds[x].filter(I=>!(I in _)):[];for(const I of w)this.imageManager.removeImage(I),this._changedImages[I]=!0;for(const I in _[x]){const A=x==="default"?I:`${x}:${I}`;this._spritesImagesIds[x].push(A),A in this.imageManager.images?this.imageManager.updateImage(A,_[x][I],!1):this.imageManager.addImage(A,_[x][I]),r&&(this._changedImages[A]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"})),l&&l(u)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}_validateLayer(t){const r=this.sourceCaches[t.source];if(!r)return;const l=t.sourceLayer;if(!l)return;const u=r.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(l)===-1)&&this.fire(new s.j(new Error(`Source layer "${l}" does not exist on source "${u.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const r=this._serializedAllLayers();if(!t||t.length===0)return Object.values(r);const l=[];for(const u of t)r[u]&&l.push(r[u]);return l}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const r=Object.keys(this._layers);for(const l of r){const u=this._layers[l];u.type!=="custom"&&(t[l]=u.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const r=this._changed;if(this._changed){const u=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(u.length||_.length)&&this._updateWorkerLayers(u,_);for(const x in this._updatedSources){const w=this._updatedSources[x];if(w==="reload")this._reloadSource(x);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(x)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const l={};for(const u in this.sourceCaches){const _=this.sourceCaches[u];l[u]=_.used,_.used=!1}for(const u of this._order){const _=this._layers[u];_.recalculate(t,this._availableImages),!_.isHidden(t.zoom)&&_.source&&(this.sourceCaches[_.source].used=!0)}for(const u in l){const _=this.sourceCaches[u];l[u]!==_.used&&_.fire(new s.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(t),this.z=t.zoom,r&&this.fire(new s.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,r){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,r={}){this._checkLoaded();const l=this.serialize();if(t=r.transformStyle?r.transformStyle(l,t):t,on(this,s.y(t)))return!1;(t=s.aD(t)).layers=s.aB(t.layers);const u=s.aE(l,t).filter(x=>!(x.command in ds));if(u.length===0)return!1;const _=u.filter(x=>!(x.command in lr));if(_.length>0)throw new Error(`Unimplemented: ${_.map(x=>x.command).join(", ")}.`);for(const x of u)x.command!=="setTransition"&&this[x.command].apply(this,x.args);return this.stylesheet=t,this._serializedLayers=null,!0}addImage(t,r){if(this.getImage(t))return this.fire(new s.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,r),this._afterImageUpdated(t)}updateImage(t,r){this.imageManager.updateImage(t,r)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new s.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,r,l={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(s.y.source,`sources.${t}`,r,null,l))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const u=this.sourceCaches[t]=new Kn(t,r,this.dispatcher);u.style=this,u.setEventedParent(this,()=>({isSourceLoaded:u.loaded(),source:u.serialize(),sourceId:t})),u.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===t)return this.fire(new s.j(new Error(`Source "${t}" cannot be removed while layer "${l}" is using it.`)));const r=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],r.fire(new s.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,r){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const l=this.sourceCaches[t].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(r),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,r,l={}){this._checkLoaded();const u=t.id;if(this.getLayer(u))return void this.fire(new s.j(new Error(`Layer "${u}" already exists on this map.`)));let _;if(t.type==="custom"){if(on(this,s.aF(t)))return;_=s.aC(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(u,t.source),t=s.aD(t),t=s.e(t,{source:u})),this._validate(s.y.layer,`layers.${u}`,t,{arrayIndex:-1},l))return;_=s.aC(t),this._validateLayer(_),_.setEventedParent(this,{layer:{id:u}})}const x=r?this._order.indexOf(r):this._order.length;if(r&&x===-1)this.fire(new s.j(new Error(`Cannot add layer "${u}" before non-existing layer "${r}".`)));else{if(this._order.splice(x,0,u),this._layerOrderChanged=!0,this._layers[u]=_,this._removedLayers[u]&&_.source&&_.type!=="custom"){const w=this._removedLayers[u];delete this._removedLayers[u],w.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.sourceCaches[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(t,r){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new s.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===r)return;const l=this._order.indexOf(t);this._order.splice(l,1);const u=r?this._order.indexOf(r):this._order.length;r&&u===-1?this.fire(new s.j(new Error(`Cannot move layer "${t}" before non-existing layer "${r}".`))):(this._order.splice(u,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const r=this._layers[t];if(!r)return void this.fire(new s.j(new Error(`Cannot remove non-existing layer "${t}".`)));r.setEventedParent(null);const l=this._order.indexOf(t);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=r,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],r.onRemove&&r.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,r,l){this._checkLoaded();const u=this.getLayer(t);u?u.minzoom===r&&u.maxzoom===l||(r!=null&&(u.minzoom=r),l!=null&&(u.maxzoom=l),this._updateLayer(u)):this.fire(new s.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,r,l={}){this._checkLoaded();const u=this.getLayer(t);if(u){if(!s.aG(u.filter,r))return r==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(s.y.filter,`layers.${u.id}.filter`,r,null,l)||(u.filter=s.aD(r),this._updateLayer(u)))}else this.fire(new s.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return s.aD(this.getLayer(t).filter)}setLayoutProperty(t,r,l,u={}){this._checkLoaded();const _=this.getLayer(t);_?s.aG(_.getLayoutProperty(r),l)||(_.setLayoutProperty(r,l,u),this._updateLayer(_)):this.fire(new s.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,r){const l=this.getLayer(t);if(l)return l.getLayoutProperty(r);this.fire(new s.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,r,l,u={}){this._checkLoaded();const _=this.getLayer(t);_?s.aG(_.getPaintProperty(r),l)||(_.setPaintProperty(r,l,u)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new s.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,r){return this.getLayer(t).getPaintProperty(r)}setFeatureState(t,r){this._checkLoaded();const l=t.source,u=t.sourceLayer,_=this.sourceCaches[l];if(_===void 0)return void this.fire(new s.j(new Error(`The source '${l}' does not exist in the map's style.`)));const x=_.getSource().type;x==="geojson"&&u?this.fire(new s.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||u?(t.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),_.setFeatureState(u,t.id,r)):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,r){this._checkLoaded();const l=t.source,u=this.sourceCaches[l];if(u===void 0)return void this.fire(new s.j(new Error(`The source '${l}' does not exist in the map's style.`)));const _=u.getSource().type,x=_==="vector"?t.sourceLayer:void 0;_!=="vector"||x?r&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new s.j(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(x,t.id,r):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const r=t.source,l=t.sourceLayer,u=this.sourceCaches[r];if(u!==void 0)return u.getSource().type!=="vector"||l?(t.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),u.getFeatureState(l,t.id)):void this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.j(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=s.aH(this.sourceCaches,_=>_.serialize()),r=this._serializeByIds(this._order),l=this.map.getTerrain()||void 0,u=this.stylesheet;return s.aI({version:u.version,name:u.name,metadata:u.metadata,light:u.light,center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,sprite:u.sprite,glyphs:u.glyphs,transition:u.transition,sources:t,layers:r,terrain:l},_=>_!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const r=x=>this._layers[x].type==="fill-extrusion",l={},u=[];for(let x=this._order.length-1;x>=0;x--){const w=this._order[x];if(r(w)){l[w]=x;for(const I of t){const A=I[w];if(A)for(const L of A)u.push(L)}}}u.sort((x,w)=>w.intersectionZ-x.intersectionZ);const _=[];for(let x=this._order.length-1;x>=0;x--){const w=this._order[x];if(r(w))for(let I=u.length-1;I>=0;I--){const A=u[I].feature;if(l[A.layer.id]<x)break;_.push(A),u.pop()}else for(const I of t){const A=I[w];if(A)for(const L of A)_.push(L.feature)}}return _}queryRenderedFeatures(t,r,l){r&&r.filter&&this._validate(s.y.filter,"queryRenderedFeatures.filter",r.filter,null,r);const u={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new s.j(new Error("parameters.layers must be an Array."))),[];for(const w of r.layers){const I=this._layers[w];if(!I)return this.fire(new s.j(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];u[I.source]=!0}}const _=[];r.availableImages=this._availableImages;const x=this._serializedAllLayers();for(const w in this.sourceCaches)r.layers&&!u[w]||_.push(xi(this.sourceCaches[w],this._layers,x,t,r,l));return this.placement&&_.push(function(w,I,A,L,z,N,X){const H={},J=N.queryRenderedSymbols(L),G=[];for(const de of Object.keys(J).map(Number))G.push(X[de]);G.sort(Zr);for(const de of G){const Se=de.featureIndex.lookupSymbolFeatures(J[de.bucketInstanceId],I,de.bucketIndex,de.sourceLayerIndex,z.filter,z.layers,z.availableImages,w);for(const ie in Se){const pe=H[ie]=H[ie]||[],Ce=Se[ie];Ce.sort((ke,Be)=>{const We=de.featureSortOrder;if(We){const je=We.indexOf(ke.featureIndex);return We.indexOf(Be.featureIndex)-je}return Be.featureIndex-ke.featureIndex});for(const ke of Ce)pe.push(ke)}}for(const de in H)H[de].forEach(Se=>{const ie=Se.feature,pe=A[w[de].source].getFeatureState(ie.layer["source-layer"],ie.id);ie.source=ie.layer.source,ie.layer["source-layer"]&&(ie.sourceLayer=ie.layer["source-layer"]),ie.state=pe});return H}(this._layers,x,this.sourceCaches,t,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(t,r){r&&r.filter&&this._validate(s.y.filter,"querySourceFeatures.filter",r.filter,null,r);const l=this.sourceCaches[t];return l?function(u,_){const x=u.getRenderableIds().map(A=>u.getTileByID(A)),w=[],I={};for(let A=0;A<x.length;A++){const L=x[A],z=L.tileID.canonical.key;I[z]||(I[z]=!0,L.querySourceFeatures(w,_))}return w}(l,r):[]}addSourceType(t,r,l){return Fi(t)?l(new Error(`A source type called "${t}" already exists.`)):(((u,_)=>{Je[u]=_})(t,r),r.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:r.workerSourceURL},l):l(null,null))}getLight(){return this.light.getLight()}setLight(t,r={}){this._checkLoaded();const l=this.light.getLight();let u=!1;for(const x in t)if(!s.aG(t[x],l[x])){u=!0;break}if(!u)return;const _={now:s.h.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,r),this.light.updateTransitions(_)}_validate(t,r,l,u,_={}){return(!_||_.validate!==!1)&&on(this,t.call(s.y,s.e({key:r,style:this.serialize(),value:l,styleSpec:s.v},u)))}_remove(t=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.sourceCaches){const l=this.sourceCaches[r];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const r in this.sourceCaches)this.sourceCaches[r].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,r,l,u,_=!1){let x=!1,w=!1;const I={};for(const A of this._order){const L=this._layers[A];if(L.type!=="symbol")continue;if(!I[L.source]){const N=this.sourceCaches[L.source];I[L.source]=N.getRenderableIds(!0).map(X=>N.getTileByID(X)).sort((X,H)=>H.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan(H.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(L,I[L.source],t.center.lng);x=x||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.h.now(),t.zoom))&&(this.pauseablePlacement=new Zo(t,this.map.terrain,this._order,_,r,l,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.h.now()),w=!0),x&&this.pauseablePlacement.placement.setStale()),w||x)for(const A of this._order){const L=this._layers[A];L.type==="symbol"&&this.placement.updateLayerOpacities(L,I[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.h.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,r,l){this.imageManager.getImages(r.icons,l),this._updateTilesForChangedImages();const u=this.sourceCaches[r.source];u&&u.setDependencies(r.tileID.key,r.type,r.icons)}getGlyphs(t,r,l){this.glyphManager.getGlyphs(r.stacks,l);const u=this.sourceCaches[r.source];u&&u.setDependencies(r.tileID.key,r.type,[""])}getResource(t,r,l){return s.m(r,l)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,r={}){this._checkLoaded(),t&&this._validate(s.y.glyphs,"glyphs",t,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,r,l={},u){this._checkLoaded();const _=[{id:t,url:r}],x=[...Dt(this.stylesheet.sprite),..._];this._validate(s.y.sprite,"sprite",x,null,l)||(this.stylesheet.sprite=x,this._loadSprite(_,!0,u))}removeSprite(t){this._checkLoaded();const r=Dt(this.stylesheet.sprite);if(r.find(l=>l.id===t)){if(this._spritesImagesIds[t])for(const l of this._spritesImagesIds[t])this.imageManager.removeImage(l),this._changedImages[l]=!0;r.splice(r.findIndex(l=>l.id===t),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}else this.fire(new s.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Dt(this.stylesheet.sprite)}setSprite(t,r={},l){this._checkLoaded(),t&&this._validate(s.y.sprite,"sprite",t,null,r)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,l):(this._unloadSprite(),l&&l(null)))}}Wn.registerForPluginStateChange=s.aK;var fa=s.Q([{name:"a_pos",type:"Int16",components:2}]),Ts="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const an={prelude:Pi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Pi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Pi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Pi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Pi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Pi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Pi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Pi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Pi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Pi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Pi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Pi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Pi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Pi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Pi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Pi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Pi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Pi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Pi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Pi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Pi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Pi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Pi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Pi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Pi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Pi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Pi("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Ts),terrainDepth:Pi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Ts),terrainCoords:Pi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Ts)};function Pi(f,t){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=t.match(/attribute ([\w]+) ([\w]+)/g),u=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=_?_.concat(u):u,w={};return{fragmentSource:f=f.replace(r,(I,A,L,z,N)=>(w[N]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${N}
varying ${L} ${z} ${N};
#else
uniform ${L} ${z} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${L} ${z} ${N} = u_${N};
#endif
`)),vertexSource:t=t.replace(r,(I,A,L,z,N)=>{const X=z==="float"?"vec2":"vec4",H=N.match(/color/)?"color":X;return w[N]?A==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${L} ${X} a_${N};
varying ${L} ${z} ${N};
#else
uniform ${L} ${z} u_${N};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${L} ${z} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${H}(a_${N}, u_${N}_t);
#else
    ${L} ${z} ${N} = u_${N};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${L} ${X} a_${N};
#else
uniform ${L} ${z} u_${N};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${L} ${z} ${N} = a_${N};
#else
    ${L} ${z} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${L} ${z} ${N} = unpack_mix_${H}(a_${N}, u_${N}_t);
#else
    ${L} ${z} ${N} = u_${N};
#endif
`}),staticAttributes:l,staticUniforms:x}}class Lo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,r,l,u,_,x,w,I,A){this.context=t;let L=this.boundPaintVertexBuffers.length!==u.length;for(let z=0;!L&&z<u.length;z++)this.boundPaintVertexBuffers[z]!==u[z]&&(L=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==l||L||this.boundIndexBuffer!==_||this.boundVertexOffset!==x||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==I||this.boundDynamicVertexBuffer3!==A?this.freshBind(r,l,u,_,x,w,I,A):(t.bindVertexArray.set(this.vao),w&&w.bind(),_&&_.dynamicDraw&&_.bind(),I&&I.bind(),A&&A.bind())}freshBind(t,r,l,u,_,x,w,I){const A=t.numAttributes,L=this.context,z=L.gl;this.vao&&this.destroy(),this.vao=L.createVertexArray(),L.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=u,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=I,r.enableAttributes(z,t);for(const N of l)N.enableAttributes(z,t);x&&x.enableAttributes(z,t),w&&w.enableAttributes(z,t),I&&I.enableAttributes(z,t),r.bind(),r.setVertexAttribPointers(z,t,_);for(const N of l)N.bind(),N.setVertexAttribPointers(z,t,_);x&&(x.bind(),x.setVertexAttribPointers(z,t,_)),u&&u.bind(),w&&(w.bind(),w.setVertexAttribPointers(z,t,_)),I&&(I.bind(),I.setVertexAttribPointers(z,t,_)),L.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ln(f){const t=[];for(let r=0;r<f.length;r++){if(f[r]===null)continue;const l=f[r].split(" ");t.push(l.pop())}return t}class Ns{constructor(t,r,l,u,_,x){const w=t.gl;this.program=w.createProgram();const I=ln(r.staticAttributes),A=l?l.getBinderAttributes():[],L=I.concat(A),z=an.prelude.staticUniforms?ln(an.prelude.staticUniforms):[],N=r.staticUniforms?ln(r.staticUniforms):[],X=l?l.getBinderUniforms():[],H=z.concat(N).concat(X),J=[];for(const ke of H)J.indexOf(ke)<0&&J.push(ke);const G=l?l.defines():[];_&&G.push("#define OVERDRAW_INSPECTOR;"),x&&G.push("#define TERRAIN3D;");const de=G.concat(an.prelude.fragmentSource,r.fragmentSource).join(`
`),Se=G.concat(an.prelude.vertexSource,r.vertexSource).join(`
`),ie=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(ie,de),w.compileShader(ie),!w.getShaderParameter(ie,w.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${w.getShaderInfoLog(ie)}`);w.attachShader(this.program,ie);const pe=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(pe,Se),w.compileShader(pe),!w.getShaderParameter(pe,w.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${w.getShaderInfoLog(pe)}`);w.attachShader(this.program,pe),this.attributes={};const Ce={};this.numAttributes=L.length;for(let ke=0;ke<this.numAttributes;ke++)L[ke]&&(w.bindAttribLocation(this.program,ke,L[ke]),this.attributes[L[ke]]=ke);if(w.linkProgram(this.program),!w.getProgramParameter(this.program,w.LINK_STATUS))throw new Error(`Program failed to link: ${w.getProgramInfoLog(this.program)}`);w.deleteShader(pe),w.deleteShader(ie);for(let ke=0;ke<J.length;ke++){const Be=J[ke];if(Be&&!Ce[Be]){const We=w.getUniformLocation(this.program,Be);We&&(Ce[Be]=We)}}this.fixedUniforms=u(t,Ce),this.terrainUniforms=((ke,Be)=>({u_depth:new s.aL(ke,Be.u_depth),u_terrain:new s.aL(ke,Be.u_terrain),u_terrain_dim:new s.aM(ke,Be.u_terrain_dim),u_terrain_matrix:new s.aN(ke,Be.u_terrain_matrix),u_terrain_unpack:new s.aO(ke,Be.u_terrain_unpack),u_terrain_exaggeration:new s.aM(ke,Be.u_terrain_exaggeration)}))(t,Ce),this.binderUniforms=l?l.getUniforms(t,Ce):[]}draw(t,r,l,u,_,x,w,I,A,L,z,N,X,H,J,G,de,Se){const ie=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(l),t.setStencilMode(u),t.setColorMode(_),t.setCullFace(x),I){t.activeTexture.set(ie.TEXTURE2),ie.bindTexture(ie.TEXTURE_2D,I.depthTexture),t.activeTexture.set(ie.TEXTURE3),ie.bindTexture(ie.TEXTURE_2D,I.texture);for(const Ce in this.terrainUniforms)this.terrainUniforms[Ce].set(I[Ce])}for(const Ce in this.fixedUniforms)this.fixedUniforms[Ce].set(w[Ce]);J&&J.setUniforms(t,this.binderUniforms,X,{zoom:H});let pe=0;switch(r){case ie.LINES:pe=2;break;case ie.TRIANGLES:pe=3;break;case ie.LINE_STRIP:pe=1}for(const Ce of N.get()){const ke=Ce.vaos||(Ce.vaos={});(ke[A]||(ke[A]=new Lo)).bind(t,this,L,J?J.getPaintVertexBuffers():[],z,Ce.vertexOffset,G,de,Se),ie.drawElements(r,Ce.primitiveLength*pe,ie.UNSIGNED_SHORT,Ce.primitiveOffset*pe*2)}}}function Hr(f,t,r){const l=1/ae(r,1,t.transform.tileZoom),u=Math.pow(2,r.tileID.overscaledZ),_=r.tileSize*Math.pow(2,t.transform.tileZoom)/u,x=_*(r.tileID.canonical.x+r.tileID.wrap*u),w=_*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[l,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w]}}const Ja=(f,t,r,l)=>{const u=t.style.light,_=u.properties.get("position"),x=[_.x,_.y,_.z],w=function(){var A=new s.A(9);return s.A!=Float32Array&&(A[1]=0,A[2]=0,A[3]=0,A[5]=0,A[6]=0,A[7]=0),A[0]=1,A[4]=1,A[8]=1,A}();u.properties.get("anchor")==="viewport"&&function(A,L){var z=Math.sin(L),N=Math.cos(L);A[0]=N,A[1]=z,A[2]=0,A[3]=-z,A[4]=N,A[5]=0,A[6]=0,A[7]=0,A[8]=1}(w,-t.transform.angle),function(A,L,z){var N=L[0],X=L[1],H=L[2];A[0]=N*z[0]+X*z[3]+H*z[6],A[1]=N*z[1]+X*z[4]+H*z[7],A[2]=N*z[2]+X*z[5]+H*z[8]}(x,x,w);const I=u.properties.get("color");return{u_matrix:f,u_lightpos:x,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[I.r,I.g,I.b],u_vertical_gradient:+r,u_opacity:l}},Wo=(f,t,r,l,u,_,x)=>s.e(Ja(f,t,r,l),Hr(_,t,x),{u_height_factor:-Math.pow(2,u.overscaledZ)/x.tileSize/8}),Vs=f=>({u_matrix:f}),v=(f,t,r,l)=>s.e(Vs(f),Hr(r,t,l)),E=(f,t)=>({u_matrix:f,u_world:t}),V=(f,t,r,l,u)=>s.e(v(f,t,r,l),{u_world:u}),Q=(f,t,r,l)=>{const u=f.transform;let _,x;if(l.paint.get("circle-pitch-alignment")==="map"){const w=ae(r,1,u.zoom);_=!0,x=[w,w]}else _=!1,x=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(t.posMatrix,r,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_pitch_with_map:+_,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:x}},se=(f,t,r)=>{const l=ae(r,1,t.zoom),u=Math.pow(2,t.zoom-r.tileID.overscaledZ),_=r.tileID.overscaleFactor();return{u_matrix:f,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:l,u_extrude_scale:[t.pixelsToGLUnits[0]/(l*u),t.pixelsToGLUnits[1]/(l*u)],u_overscale_factor:_}},le=(f,t,r=1)=>({u_matrix:f,u_color:t,u_overlay:0,u_overlay_scale:r}),xe=f=>({u_matrix:f}),Ge=(f,t,r,l)=>({u_matrix:f,u_extrude_scale:ae(t,1,r),u_intensity:l});function Ye(f,t){const r=Math.pow(2,t.canonical.z),l=t.canonical.y;return[new s.U(0,l/r).toLngLat().lat,new s.U(0,(l+1)/r).toLngLat().lat]}const mt=(f,t,r,l)=>{const u=f.transform;return{u_matrix:ni(f,t,r,l),u_ratio:1/ae(t,1,u.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},_t=(f,t,r,l,u)=>s.e(mt(f,t,r,u),{u_image:0,u_image_height:l}),ct=(f,t,r,l,u)=>{const _=f.transform,x=cn(t,_);return{u_matrix:ni(f,t,r,u),u_texsize:t.imageAtlasTexture.size,u_ratio:1/ae(t,1,_.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[x,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},ti=(f,t,r,l,u,_)=>{const x=f.lineAtlas,w=cn(t,f.transform),I=r.layout.get("line-cap")==="round",A=x.getDash(l.from,I),L=x.getDash(l.to,I),z=A.width*u.fromScale,N=L.width*u.toScale;return s.e(mt(f,t,r,_),{u_patternscale_a:[w/z,-A.height/2],u_patternscale_b:[w/N,-L.height/2],u_sdfgamma:x.width/(256*Math.min(z,N)*f.pixelRatio)/2,u_image:0,u_tex_y_a:A.y,u_tex_y_b:L.y,u_mix:u.t})};function cn(f,t){return 1/ae(f,1,t.tileZoom)}function ni(f,t,r,l){return f.translatePosMatrix(l?l.posMatrix:t.tileID.posMatrix,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const Cn=(f,t,r,l,u)=>{return{u_matrix:f,u_tl_parent:t,u_scale_parent:r,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(x=u.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(_=u.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:Ue(u.paint.get("raster-hue-rotate"))};var _,x};function Ue(f){f*=Math.PI/180;const t=Math.sin(f),r=Math.cos(f);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const Et=(f,t,r,l,u,_,x,w,I,A)=>{const L=u.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:L.cameraToCenterDistance,u_pitch:L.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:L.width/L.height,u_fade_change:u.options.fadeDuration?u.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:x,u_coord_matrix:w,u_is_text:+I,u_pitch_with_map:+l,u_texsize:A,u_texture:0}},Oi=(f,t,r,l,u,_,x,w,I,A,L)=>{const z=u.transform;return s.e(Et(f,t,r,l,u,_,x,w,I,A),{u_gamma_scale:l?Math.cos(z._pitch)*z.cameraToCenterDistance:1,u_device_pixel_ratio:u.pixelRatio,u_is_halo:+L})},un=(f,t,r,l,u,_,x,w,I,A)=>s.e(Oi(f,t,r,l,u,_,x,w,!0,I,!0),{u_texsize_icon:A,u_texture_icon:1}),gn=(f,t,r)=>({u_matrix:f,u_opacity:t,u_color:r}),Tr=(f,t,r,l,u,_)=>s.e(function(x,w,I,A){const L=I.imageManager.getPattern(x.from.toString()),z=I.imageManager.getPattern(x.to.toString()),{width:N,height:X}=I.imageManager.getPixelSize(),H=Math.pow(2,A.tileID.overscaledZ),J=A.tileSize*Math.pow(2,I.transform.tileZoom)/H,G=J*(A.tileID.canonical.x+A.tileID.wrap*H),de=J*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:L.tl,u_pattern_br_a:L.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[N,X],u_mix:w.t,u_pattern_size_a:L.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/ae(A,1,I.transform.tileZoom),u_pixel_coord_upper:[G>>16,de>>16],u_pixel_coord_lower:[65535&G,65535&de]}}(l,_,r,u),{u_matrix:f,u_opacity:t}),ma={fillExtrusion:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_lightpos:new s.aP(f,t.u_lightpos),u_lightintensity:new s.aM(f,t.u_lightintensity),u_lightcolor:new s.aP(f,t.u_lightcolor),u_vertical_gradient:new s.aM(f,t.u_vertical_gradient),u_opacity:new s.aM(f,t.u_opacity)}),fillExtrusionPattern:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_lightpos:new s.aP(f,t.u_lightpos),u_lightintensity:new s.aM(f,t.u_lightintensity),u_lightcolor:new s.aP(f,t.u_lightcolor),u_vertical_gradient:new s.aM(f,t.u_vertical_gradient),u_height_factor:new s.aM(f,t.u_height_factor),u_image:new s.aL(f,t.u_image),u_texsize:new s.aQ(f,t.u_texsize),u_pixel_coord_upper:new s.aQ(f,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(f,t.u_pixel_coord_lower),u_scale:new s.aP(f,t.u_scale),u_fade:new s.aM(f,t.u_fade),u_opacity:new s.aM(f,t.u_opacity)}),fill:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix)}),fillPattern:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_image:new s.aL(f,t.u_image),u_texsize:new s.aQ(f,t.u_texsize),u_pixel_coord_upper:new s.aQ(f,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(f,t.u_pixel_coord_lower),u_scale:new s.aP(f,t.u_scale),u_fade:new s.aM(f,t.u_fade)}),fillOutline:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_world:new s.aQ(f,t.u_world)}),fillOutlinePattern:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_world:new s.aQ(f,t.u_world),u_image:new s.aL(f,t.u_image),u_texsize:new s.aQ(f,t.u_texsize),u_pixel_coord_upper:new s.aQ(f,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(f,t.u_pixel_coord_lower),u_scale:new s.aP(f,t.u_scale),u_fade:new s.aM(f,t.u_fade)}),circle:(f,t)=>({u_camera_to_center_distance:new s.aM(f,t.u_camera_to_center_distance),u_scale_with_map:new s.aL(f,t.u_scale_with_map),u_pitch_with_map:new s.aL(f,t.u_pitch_with_map),u_extrude_scale:new s.aQ(f,t.u_extrude_scale),u_device_pixel_ratio:new s.aM(f,t.u_device_pixel_ratio),u_matrix:new s.aN(f,t.u_matrix)}),collisionBox:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_camera_to_center_distance:new s.aM(f,t.u_camera_to_center_distance),u_pixels_to_tile_units:new s.aM(f,t.u_pixels_to_tile_units),u_extrude_scale:new s.aQ(f,t.u_extrude_scale),u_overscale_factor:new s.aM(f,t.u_overscale_factor)}),collisionCircle:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_inv_matrix:new s.aN(f,t.u_inv_matrix),u_camera_to_center_distance:new s.aM(f,t.u_camera_to_center_distance),u_viewport_size:new s.aQ(f,t.u_viewport_size)}),debug:(f,t)=>({u_color:new s.aR(f,t.u_color),u_matrix:new s.aN(f,t.u_matrix),u_overlay:new s.aL(f,t.u_overlay),u_overlay_scale:new s.aM(f,t.u_overlay_scale)}),clippingMask:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix)}),heatmap:(f,t)=>({u_extrude_scale:new s.aM(f,t.u_extrude_scale),u_intensity:new s.aM(f,t.u_intensity),u_matrix:new s.aN(f,t.u_matrix)}),heatmapTexture:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_world:new s.aQ(f,t.u_world),u_image:new s.aL(f,t.u_image),u_color_ramp:new s.aL(f,t.u_color_ramp),u_opacity:new s.aM(f,t.u_opacity)}),hillshade:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_image:new s.aL(f,t.u_image),u_latrange:new s.aQ(f,t.u_latrange),u_light:new s.aQ(f,t.u_light),u_shadow:new s.aR(f,t.u_shadow),u_highlight:new s.aR(f,t.u_highlight),u_accent:new s.aR(f,t.u_accent)}),hillshadePrepare:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_image:new s.aL(f,t.u_image),u_dimension:new s.aQ(f,t.u_dimension),u_zoom:new s.aM(f,t.u_zoom),u_unpack:new s.aO(f,t.u_unpack)}),line:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_ratio:new s.aM(f,t.u_ratio),u_device_pixel_ratio:new s.aM(f,t.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(f,t.u_units_to_pixels)}),lineGradient:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_ratio:new s.aM(f,t.u_ratio),u_device_pixel_ratio:new s.aM(f,t.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(f,t.u_units_to_pixels),u_image:new s.aL(f,t.u_image),u_image_height:new s.aM(f,t.u_image_height)}),linePattern:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_texsize:new s.aQ(f,t.u_texsize),u_ratio:new s.aM(f,t.u_ratio),u_device_pixel_ratio:new s.aM(f,t.u_device_pixel_ratio),u_image:new s.aL(f,t.u_image),u_units_to_pixels:new s.aQ(f,t.u_units_to_pixels),u_scale:new s.aP(f,t.u_scale),u_fade:new s.aM(f,t.u_fade)}),lineSDF:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_ratio:new s.aM(f,t.u_ratio),u_device_pixel_ratio:new s.aM(f,t.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(f,t.u_units_to_pixels),u_patternscale_a:new s.aQ(f,t.u_patternscale_a),u_patternscale_b:new s.aQ(f,t.u_patternscale_b),u_sdfgamma:new s.aM(f,t.u_sdfgamma),u_image:new s.aL(f,t.u_image),u_tex_y_a:new s.aM(f,t.u_tex_y_a),u_tex_y_b:new s.aM(f,t.u_tex_y_b),u_mix:new s.aM(f,t.u_mix)}),raster:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_tl_parent:new s.aQ(f,t.u_tl_parent),u_scale_parent:new s.aM(f,t.u_scale_parent),u_buffer_scale:new s.aM(f,t.u_buffer_scale),u_fade_t:new s.aM(f,t.u_fade_t),u_opacity:new s.aM(f,t.u_opacity),u_image0:new s.aL(f,t.u_image0),u_image1:new s.aL(f,t.u_image1),u_brightness_low:new s.aM(f,t.u_brightness_low),u_brightness_high:new s.aM(f,t.u_brightness_high),u_saturation_factor:new s.aM(f,t.u_saturation_factor),u_contrast_factor:new s.aM(f,t.u_contrast_factor),u_spin_weights:new s.aP(f,t.u_spin_weights)}),symbolIcon:(f,t)=>({u_is_size_zoom_constant:new s.aL(f,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(f,t.u_is_size_feature_constant),u_size_t:new s.aM(f,t.u_size_t),u_size:new s.aM(f,t.u_size),u_camera_to_center_distance:new s.aM(f,t.u_camera_to_center_distance),u_pitch:new s.aM(f,t.u_pitch),u_rotate_symbol:new s.aL(f,t.u_rotate_symbol),u_aspect_ratio:new s.aM(f,t.u_aspect_ratio),u_fade_change:new s.aM(f,t.u_fade_change),u_matrix:new s.aN(f,t.u_matrix),u_label_plane_matrix:new s.aN(f,t.u_label_plane_matrix),u_coord_matrix:new s.aN(f,t.u_coord_matrix),u_is_text:new s.aL(f,t.u_is_text),u_pitch_with_map:new s.aL(f,t.u_pitch_with_map),u_texsize:new s.aQ(f,t.u_texsize),u_texture:new s.aL(f,t.u_texture)}),symbolSDF:(f,t)=>({u_is_size_zoom_constant:new s.aL(f,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(f,t.u_is_size_feature_constant),u_size_t:new s.aM(f,t.u_size_t),u_size:new s.aM(f,t.u_size),u_camera_to_center_distance:new s.aM(f,t.u_camera_to_center_distance),u_pitch:new s.aM(f,t.u_pitch),u_rotate_symbol:new s.aL(f,t.u_rotate_symbol),u_aspect_ratio:new s.aM(f,t.u_aspect_ratio),u_fade_change:new s.aM(f,t.u_fade_change),u_matrix:new s.aN(f,t.u_matrix),u_label_plane_matrix:new s.aN(f,t.u_label_plane_matrix),u_coord_matrix:new s.aN(f,t.u_coord_matrix),u_is_text:new s.aL(f,t.u_is_text),u_pitch_with_map:new s.aL(f,t.u_pitch_with_map),u_texsize:new s.aQ(f,t.u_texsize),u_texture:new s.aL(f,t.u_texture),u_gamma_scale:new s.aM(f,t.u_gamma_scale),u_device_pixel_ratio:new s.aM(f,t.u_device_pixel_ratio),u_is_halo:new s.aL(f,t.u_is_halo)}),symbolTextAndIcon:(f,t)=>({u_is_size_zoom_constant:new s.aL(f,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(f,t.u_is_size_feature_constant),u_size_t:new s.aM(f,t.u_size_t),u_size:new s.aM(f,t.u_size),u_camera_to_center_distance:new s.aM(f,t.u_camera_to_center_distance),u_pitch:new s.aM(f,t.u_pitch),u_rotate_symbol:new s.aL(f,t.u_rotate_symbol),u_aspect_ratio:new s.aM(f,t.u_aspect_ratio),u_fade_change:new s.aM(f,t.u_fade_change),u_matrix:new s.aN(f,t.u_matrix),u_label_plane_matrix:new s.aN(f,t.u_label_plane_matrix),u_coord_matrix:new s.aN(f,t.u_coord_matrix),u_is_text:new s.aL(f,t.u_is_text),u_pitch_with_map:new s.aL(f,t.u_pitch_with_map),u_texsize:new s.aQ(f,t.u_texsize),u_texsize_icon:new s.aQ(f,t.u_texsize_icon),u_texture:new s.aL(f,t.u_texture),u_texture_icon:new s.aL(f,t.u_texture_icon),u_gamma_scale:new s.aM(f,t.u_gamma_scale),u_device_pixel_ratio:new s.aM(f,t.u_device_pixel_ratio),u_is_halo:new s.aL(f,t.u_is_halo)}),background:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_opacity:new s.aM(f,t.u_opacity),u_color:new s.aR(f,t.u_color)}),backgroundPattern:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_opacity:new s.aM(f,t.u_opacity),u_image:new s.aL(f,t.u_image),u_pattern_tl_a:new s.aQ(f,t.u_pattern_tl_a),u_pattern_br_a:new s.aQ(f,t.u_pattern_br_a),u_pattern_tl_b:new s.aQ(f,t.u_pattern_tl_b),u_pattern_br_b:new s.aQ(f,t.u_pattern_br_b),u_texsize:new s.aQ(f,t.u_texsize),u_mix:new s.aM(f,t.u_mix),u_pattern_size_a:new s.aQ(f,t.u_pattern_size_a),u_pattern_size_b:new s.aQ(f,t.u_pattern_size_b),u_scale_a:new s.aM(f,t.u_scale_a),u_scale_b:new s.aM(f,t.u_scale_b),u_pixel_coord_upper:new s.aQ(f,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(f,t.u_pixel_coord_lower),u_tile_units_to_pixels:new s.aM(f,t.u_tile_units_to_pixels)}),terrain:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_texture:new s.aL(f,t.u_texture),u_ele_delta:new s.aM(f,t.u_ele_delta)}),terrainDepth:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_ele_delta:new s.aM(f,t.u_ele_delta)}),terrainCoords:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_texture:new s.aL(f,t.u_texture),u_terrain_coords_id:new s.aM(f,t.u_terrain_coords_id),u_ele_delta:new s.aM(f,t.u_ele_delta)})};class Xi{constructor(t,r,l){this.context=t;const u=t.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Is={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class _a{constructor(t,r,l,u){this.length=r.length,this.attributes=l,this.itemSize=r.bytesPerElement,this.dynamicDraw=u,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),t.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let l=0;l<this.attributes.length;l++){const u=r.attributes[this.attributes[l].name];u!==void 0&&t.enableVertexAttribArray(u)}}setVertexAttribPointers(t,r,l){for(let u=0;u<this.attributes.length;u++){const _=this.attributes[u],x=r.attributes[_.name];x!==void 0&&t.vertexAttribPointer(x,_.components,t[Is[_.type]],!1,this.itemSize,_.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ir=new WeakMap;function zo(f){var t;if(Ir.has(f))return Ir.get(f);{const r=(t=f.getParameter(f.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Ir.set(f,r),r}}class fi{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Us extends fi{getDefault(){return s.aT.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class _r extends fi{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Cr extends fi{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class ga extends fi{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ya extends fi{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class va extends fi{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ya extends fi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ba extends fi{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class js extends fi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class xa extends fi{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Qa extends fi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class wa extends fi{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class qs extends fi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class Sa extends fi{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class ps extends fi{getDefault(){return s.aT.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class So extends fi{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class yl extends fi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class vl extends fi{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Kl extends fi{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class bl extends fi{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Ta extends fi{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Ia extends fi{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Zs extends fi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class $a extends fi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Do extends fi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class fs extends fi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class xl extends fi{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class wl extends fi{getDefault(){return null}set(t){var r;if(t===this.current&&!this.dirty)return;const l=this.gl;zo(l)?l.bindVertexArray(t):(r=l.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Gs extends fi{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class ro extends fi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ca extends fi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class To extends fi{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class Ho extends To{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Cs extends To{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class el extends To{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Li{constructor(t,r,l,u,_){this.context=t,this.width=r,this.height=l;const x=t.gl,w=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new Ho(t,w),u)this.depthAttachment=_?new el(t,w):new Cs(t,w);else if(_)throw new Error("Stencil cannot be setted without depth");if(x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,r=this.colorAttachment.get();if(r&&t.deleteTexture(r),this.depthAttachment){const l=this.depthAttachment.get();l&&t.deleteRenderbuffer(l)}t.deleteFramebuffer(this.framebuffer)}}class hn{constructor(t,r,l){this.blendFunction=t,this.blendColor=r,this.mask=l}}hn.Replace=[1,0],hn.disabled=new hn(hn.Replace,s.aT.transparent,[!1,!1,!1,!1]),hn.unblended=new hn(hn.Replace,s.aT.transparent,[!0,!0,!0,!0]),hn.alphaBlended=new hn([1,771],s.aT.transparent,[!0,!0,!0,!0]);class Jl{constructor(t){var r,l;if(this.gl=t,this.clearColor=new Us(this),this.clearDepth=new _r(this),this.clearStencil=new Cr(this),this.colorMask=new ga(this),this.depthMask=new ya(this),this.stencilMask=new va(this),this.stencilFunc=new Ya(this),this.stencilOp=new ba(this),this.stencilTest=new js(this),this.depthRange=new xa(this),this.depthTest=new Qa(this),this.depthFunc=new wa(this),this.blend=new qs(this),this.blendFunc=new Sa(this),this.blendColor=new ps(this),this.blendEquation=new So(this),this.cullFace=new yl(this),this.cullFaceSide=new vl(this),this.frontFace=new Kl(this),this.program=new bl(this),this.activeTexture=new Ta(this),this.viewport=new Ia(this),this.bindFramebuffer=new Zs(this),this.bindRenderbuffer=new $a(this),this.bindTexture=new Do(this),this.bindVertexBuffer=new fs(this),this.bindElementBuffer=new xl(this),this.bindVertexArray=new wl(this),this.pixelStoreUnpack=new Gs(this),this.pixelStoreUnpackPremultiplyAlpha=new ro(this),this.pixelStoreUnpackFlipY=new Ca(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),zo(t)){this.HALF_FLOAT=t.HALF_FLOAT;const u=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=t.RGBA16F)!==null&&r!==void 0?r:u==null?void 0:u.RGBA16F_EXT,this.RGB16F=(l=t.RGB16F)!==null&&l!==void 0?l:u==null?void 0:u.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const u=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=u==null?void 0:u.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r){return new Xi(this,t,r)}createVertexBuffer(t,r,l){return new _a(this,t,r,l)}createRenderbuffer(t,r,l){const u=this.gl,_=u.createRenderbuffer();return this.bindRenderbuffer.set(_),u.renderbufferStorage(u.RENDERBUFFER,t,r,l),this.bindRenderbuffer.set(null),_}createFramebuffer(t,r,l,u){return new Li(this,t,r,l,u)}clear({color:t,depth:r,stencil:l}){const u=this.gl;let _=0;t&&(_|=u.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(_|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),l!==void 0&&(_|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),u.clear(_)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){s.aG(t.blendFunction,hn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return zo(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var r;return zo(this.gl)?this.gl.deleteVertexArray(t):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class gi{constructor(t,r,l){this.func=t,this.mask=r,this.range=l}}gi.ReadOnly=!1,gi.ReadWrite=!0,gi.disabled=new gi(519,gi.ReadOnly,[0,1]);const Xo=7680;class tn{constructor(t,r,l,u,_,x){this.test=t,this.ref=r,this.mask=l,this.fail=u,this.depthFail=_,this.pass=x}}tn.disabled=new tn({func:519,mask:0},0,0,Xo,Xo,Xo);class Bi{constructor(t,r,l){this.enable=t,this.mode=r,this.frontFace=l}}let Fr;function Ko(f,t,r,l,u,_,x){const w=f.context,I=w.gl,A=f.useProgram("collisionBox"),L=[];let z=0,N=0;for(let ie=0;ie<l.length;ie++){const pe=l[ie],Ce=t.getTile(pe),ke=Ce.getBucket(r);if(!ke)continue;let Be=pe.posMatrix;u[0]===0&&u[1]===0||(Be=f.translatePosMatrix(pe.posMatrix,Ce,u,_));const We=x?ke.textCollisionBox:ke.iconCollisionBox,je=ke.collisionCircleArray;if(je.length>0){const et=s.Z(),It=Be;s.aU(et,ke.placementInvProjMatrix,f.transform.glCoordMatrix),s.aU(et,et,ke.placementViewportMatrix),L.push({circleArray:je,circleOffset:N,transform:It,invTransform:et,coord:pe}),z+=je.length/4,N=z}We&&A.draw(w,I.LINES,gi.disabled,tn.disabled,f.colorModeForRenderPass(),Bi.disabled,se(Be,f.transform,Ce),f.style.map.terrain&&f.style.map.terrain.getTerrainData(pe),r.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,null,f.transform.zoom,null,null,We.collisionVertexBuffer)}if(!x||!L.length)return;const X=f.useProgram("collisionCircle"),H=new s.aV;H.resize(4*z),H._trim();let J=0;for(const ie of L)for(let pe=0;pe<ie.circleArray.length/4;pe++){const Ce=4*pe,ke=ie.circleArray[Ce+0],Be=ie.circleArray[Ce+1],We=ie.circleArray[Ce+2],je=ie.circleArray[Ce+3];H.emplace(J++,ke,Be,We,je,0),H.emplace(J++,ke,Be,We,je,1),H.emplace(J++,ke,Be,We,je,2),H.emplace(J++,ke,Be,We,je,3)}(!Fr||Fr.length<2*z)&&(Fr=function(ie){const pe=2*ie,Ce=new s.aX;Ce.resize(pe),Ce._trim();for(let ke=0;ke<pe;ke++){const Be=6*ke;Ce.uint16[Be+0]=4*ke+0,Ce.uint16[Be+1]=4*ke+1,Ce.uint16[Be+2]=4*ke+2,Ce.uint16[Be+3]=4*ke+2,Ce.uint16[Be+4]=4*ke+3,Ce.uint16[Be+5]=4*ke+0}return Ce}(z));const G=w.createIndexBuffer(Fr,!0),de=w.createVertexBuffer(H,s.aW.members,!0);for(const ie of L){const pe={u_matrix:ie.transform,u_inv_matrix:ie.invTransform,u_camera_to_center_distance:(Se=f.transform).cameraToCenterDistance,u_viewport_size:[Se.width,Se.height]};X.draw(w,I.TRIANGLES,gi.disabled,tn.disabled,f.colorModeForRenderPass(),Bi.disabled,pe,f.style.map.terrain&&f.style.map.terrain.getTerrainData(ie.coord),r.id,de,G,s.S.simpleSegment(0,2*ie.circleOffset,ie.circleArray.length,ie.circleArray.length/2),null,f.transform.zoom,null,null,null)}var Se;de.destroy(),G.destroy()}Bi.disabled=new Bi(!1,1029,2305),Bi.backCCW=new Bi(!0,1029,2305);const ks=s.ao(new Float32Array(16));function oo(f,t,r,l,u,_){const{horizontalAlign:x,verticalAlign:w}=s.au(f);return new s.P((-(x-.5)*t/u+l[0])*_,(-(w-.5)*r/u+l[1])*_)}function ka(f,t,r,l,u,_,x,w,I,A,L){const z=f.text.placedSymbolArray,N=f.text.dynamicLayoutVertexArray,X=f.icon.dynamicLayoutVertexArray,H={};N.clear();for(let J=0;J<z.length;J++){const G=z.get(J),de=G.hidden||!G.crossTileID||f.allowVerticalPlacement&&!G.placedOrientation?null:l[G.crossTileID];if(de){const Se=new s.P(G.anchorX,G.anchorY),ie=_n(Se,r?x:_,L),pe=hs(u.cameraToCenterDistance,ie.signedDistanceFromCamera);let Ce=s.aj(f.textSizeData,I,G)*pe/s.ap;r&&(Ce*=f.tilePixelRatio/w);const{width:ke,height:Be,anchor:We,textOffset:je,textBoxScale:et}=de,It=oo(We,ke,Be,je,et,Ce),yi=r?_n(Se.add(It),_,L).point:ie.point.add(t?It.rotate(-u.angle):It),dt=f.allowVerticalPlacement&&G.placedOrientation===s.ai.vertical?Math.PI/2:0;for(let Xt=0;Xt<G.numGlyphs;Xt++)s.ak(N,yi,dt);A&&G.associatedIconIndex>=0&&(H[G.associatedIconIndex]={shiftedAnchor:yi,angle:dt})}else Z(G.numGlyphs,N)}if(A){X.clear();const J=f.icon.placedSymbolArray;for(let G=0;G<J.length;G++){const de=J.get(G);if(de.hidden)Z(de.numGlyphs,X);else{const Se=H[G];if(Se)for(let ie=0;ie<de.numGlyphs;ie++)s.ak(X,Se.shiftedAnchor,Se.angle);else Z(de.numGlyphs,X)}}f.icon.dynamicLayoutVertexBuffer.updateData(X)}f.text.dynamicLayoutVertexBuffer.updateData(N)}function Es(f,t,r){return r.iconsInText&&t?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function Jo(f,t,r,l,u,_,x,w,I,A,L,z){const N=f.context,X=N.gl,H=f.transform,J=w==="map",G=I==="map",de=w!=="viewport"&&r.layout.get("symbol-placement")!=="point",Se=J&&!G&&!de,ie=!r.layout.get("symbol-sort-key").isConstant();let pe=!1;const Ce=f.depthModeForSublayer(0,gi.ReadOnly),ke=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Be=[];for(const We of l){const je=t.getTile(We),et=je.getBucket(r);if(!et)continue;const It=u?et.text:et.icon;if(!It||!It.segments.get().length||!It.hasVisibleVertices)continue;const yi=It.programConfigurations.get(r.id),dt=u||et.sdfIcons,Xt=u?et.textSizeData:et.iconSizeData,Mt=G||H.pitch!==0,Ki=f.useProgram(Es(dt,u,et),yi),mi=s.ah(Xt,H.zoom),ai=f.style.map.terrain&&f.style.map.terrain.getTerrainData(We);let vi,Ln,sn,yr,Qn=[0,0],Un=null;if(u)Ln=je.glyphAtlasTexture,sn=X.LINEAR,vi=je.glyphAtlasTexture.size,et.iconsInText&&(Qn=je.imageAtlasTexture.size,Un=je.imageAtlasTexture,yr=Mt||f.options.rotating||f.options.zooming||Xt.kind==="composite"||Xt.kind==="camera"?X.LINEAR:X.NEAREST);else{const zn=r.layout.get("icon-size").constantOr(0)!==1||et.iconsNeedLinear;Ln=je.imageAtlasTexture,sn=dt||f.options.rotating||f.options.zooming||zn||Mt?X.LINEAR:X.NEAREST,vi=je.imageAtlasTexture.size}const co=ae(je,1,f.transform.zoom),fn=it(We.posMatrix,G,J,f.transform,co),es=zr(We.posMatrix,G,J,f.transform,co),ts=ke&&et.hasTextData(),Fs=r.layout.get("icon-text-fit")!=="none"&&ts&&et.hasIconData();if(de){const zn=f.style.map.terrain?(Jr,Dn)=>f.style.map.terrain.getElevation(We,Jr,Dn):null,$n=r.layout.get("text-rotation-alignment")==="map";st(et,We.posMatrix,f,u,fn,es,G,A,$n,zn)}const ta=f.translatePosMatrix(We.posMatrix,je,_,x),Na=de||u&&ke||Fs?ks:fn,Mr=f.translatePosMatrix(es,je,_,x,!0),vr=dt&&r.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Br;Br=dt?et.iconsInText?un(Xt.kind,mi,Se,G,f,ta,Na,Mr,vi,Qn):Oi(Xt.kind,mi,Se,G,f,ta,Na,Mr,u,vi,!0):Et(Xt.kind,mi,Se,G,f,ta,Na,Mr,u,vi);const ia={program:Ki,buffers:It,uniformValues:Br,atlasTexture:Ln,atlasTextureIcon:Un,atlasInterpolation:sn,atlasInterpolationIcon:yr,isSDF:dt,hasHalo:vr};if(ie&&et.canOverlap){pe=!0;const zn=It.segments.get();for(const $n of zn)Be.push({segments:new s.S([$n]),sortKey:$n.sortKey,state:ia,terrainData:ai})}else Be.push({segments:It.segments,sortKey:0,state:ia,terrainData:ai})}pe&&Be.sort((We,je)=>We.sortKey-je.sortKey);for(const We of Be){const je=We.state;if(N.activeTexture.set(X.TEXTURE0),je.atlasTexture.bind(je.atlasInterpolation,X.CLAMP_TO_EDGE),je.atlasTextureIcon&&(N.activeTexture.set(X.TEXTURE1),je.atlasTextureIcon&&je.atlasTextureIcon.bind(je.atlasInterpolationIcon,X.CLAMP_TO_EDGE)),je.isSDF){const et=je.uniformValues;je.hasHalo&&(et.u_is_halo=1,Ea(je.buffers,We.segments,r,f,je.program,Ce,L,z,et,We.terrainData)),et.u_is_halo=0}Ea(je.buffers,We.segments,r,f,je.program,Ce,L,z,je.uniformValues,We.terrainData)}}function Ea(f,t,r,l,u,_,x,w,I,A){const L=l.context;u.draw(L,L.gl.TRIANGLES,_,x,w,Bi.disabled,I,A,r.id,f.layoutVertexBuffer,f.indexBuffer,t,r.paint,l.transform.zoom,f.programConfigurations.get(r.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Ms(f,t,r,l,u){if(!r||!l||!l.imageAtlas)return;const _=l.imageAtlas.patternPositions;let x=_[r.to.toString()],w=_[r.from.toString()];if(!x&&w&&(x=w),!w&&x&&(w=x),!x||!w){const I=u.getPaintProperty(t);x=_[I],w=_[I]}x&&w&&f.setConstantPatternPositions(x,w)}function Ws(f,t,r,l,u,_,x){const w=f.context.gl,I="fill-pattern",A=r.paint.get(I),L=A&&A.constantOr(1),z=r.getCrossfadeParameters();let N,X,H,J,G;x?(X=L&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=w.LINES):(X=L?"fillPattern":"fill",N=w.TRIANGLES);const de=A.constantOr(null);for(const Se of l){const ie=t.getTile(Se);if(L&&!ie.patternsLoaded())continue;const pe=ie.getBucket(r);if(!pe)continue;const Ce=pe.programConfigurations.get(r.id),ke=f.useProgram(X,Ce),Be=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Se);L&&(f.context.activeTexture.set(w.TEXTURE0),ie.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),Ce.updatePaintBuffers(z)),Ms(Ce,I,de,ie,r);const We=Be?Se:null,je=f.translatePosMatrix(We?We.posMatrix:Se.posMatrix,ie,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(x){J=pe.indexBuffer2,G=pe.segments2;const et=[w.drawingBufferWidth,w.drawingBufferHeight];H=X==="fillOutlinePattern"&&L?V(je,f,z,ie,et):E(je,et)}else J=pe.indexBuffer,G=pe.segments,H=L?v(je,f,z,ie):Vs(je);ke.draw(f.context,N,u,f.stencilModeForClipping(Se),_,Bi.disabled,H,Be,r.id,pe.layoutVertexBuffer,J,G,r.paint,f.transform.zoom,Ce)}}function Hs(f,t,r,l,u,_,x){const w=f.context,I=w.gl,A="fill-extrusion-pattern",L=r.paint.get(A),z=L.constantOr(1),N=r.getCrossfadeParameters(),X=r.paint.get("fill-extrusion-opacity"),H=L.constantOr(null);for(const J of l){const G=t.getTile(J),de=G.getBucket(r);if(!de)continue;const Se=f.style.map.terrain&&f.style.map.terrain.getTerrainData(J),ie=de.programConfigurations.get(r.id),pe=f.useProgram(z?"fillExtrusionPattern":"fillExtrusion",ie);z&&(f.context.activeTexture.set(I.TEXTURE0),G.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),ie.updatePaintBuffers(N)),Ms(ie,A,H,G,r);const Ce=f.translatePosMatrix(J.posMatrix,G,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),ke=r.paint.get("fill-extrusion-vertical-gradient"),Be=z?Wo(Ce,f,ke,X,J,N,G):Ja(Ce,f,ke,X);pe.draw(w,w.gl.TRIANGLES,u,_,x,Bi.backCCW,Be,Se,r.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,r.paint,f.transform.zoom,ie,f.style.map.terrain&&de.centroidVertexBuffer)}}function Sl(f,t,r,l,u,_,x){const w=f.context,I=w.gl,A=r.fbo;if(!A)return;const L=f.useProgram("hillshade"),z=f.style.map.terrain&&f.style.map.terrain.getTerrainData(t);w.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,A.colorAttachment.get()),L.draw(w,I.TRIANGLES,u,_,x,Bi.disabled,((N,X,H,J)=>{const G=H.paint.get("hillshade-shadow-color"),de=H.paint.get("hillshade-highlight-color"),Se=H.paint.get("hillshade-accent-color");let ie=H.paint.get("hillshade-illumination-direction")*(Math.PI/180);H.paint.get("hillshade-illumination-anchor")==="viewport"&&(ie-=N.transform.angle);const pe=!N.options.moving;return{u_matrix:J?J.posMatrix:N.transform.calculatePosMatrix(X.tileID.toUnwrapped(),pe),u_image:0,u_latrange:Ye(0,X.tileID),u_light:[H.paint.get("hillshade-exaggeration"),ie],u_shadow:G,u_highlight:de,u_accent:Se}})(f,r,l,z?t:null),z,l.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}function Ma(f,t,r,l,u,_){const x=f.context,w=x.gl,I=t.dem;if(I&&I.data){const A=I.dim,L=I.stride,z=I.getPixels();if(x.activeTexture.set(w.TEXTURE1),x.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||f.getTileTexture(L),t.demTexture){const X=t.demTexture;X.update(z,{premultiply:!1}),X.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else t.demTexture=new qt(x,z,w.RGBA,{premultiply:!1}),t.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);x.activeTexture.set(w.TEXTURE0);let N=t.fbo;if(!N){const X=new qt(x,{width:A,height:A,data:null},w.RGBA);X.bind(w.LINEAR,w.CLAMP_TO_EDGE),N=t.fbo=x.createFramebuffer(A,A,!0,!1),N.colorAttachment.set(X.texture)}x.bindFramebuffer.set(N.framebuffer),x.viewport.set([0,0,A,A]),f.useProgram("hillshadePrepare").draw(x,w.TRIANGLES,l,u,_,Bi.disabled,((X,H)=>{const J=H.stride,G=s.Z();return s.aS(G,0,s.N,-s.N,0,0,1),s.$(G,G,[0,-s.N,0]),{u_matrix:G,u_image:1,u_dimension:[J,J],u_zoom:X.overscaledZ,u_unpack:H.getUnpackVector()}})(t.tileID,I),null,r.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function Aa(f,t,r,l,u,_){const x=l.paint.get("raster-fade-duration");if(!_&&x>0){const w=s.h.now(),I=(w-f.timeAdded)/x,A=t?(w-t.timeAdded)/x:-1,L=r.getSource(),z=u.coveringZoomLevel({tileSize:L.tileSize,roundZoom:L.roundZoom}),N=!t||Math.abs(t.tileID.overscaledZ-z)>Math.abs(f.tileID.overscaledZ-z),X=N&&f.refreshedUponExpiration?1:s.ad(N?I:1-A,0,1);return f.refreshedUponExpiration&&I>=1&&(f.refreshedUponExpiration=!1),t?{opacity:1,mix:1-X}:{opacity:X,mix:0}}return{opacity:1,mix:0}}const ms=new s.aT(1,0,0,1),Pa=new s.aT(0,1,0,1),Io=new s.aT(0,0,1,1),Tl=new s.aT(1,0,1,1),Yo=new s.aT(0,1,1,1);function As(f,t,r,l){_s(f,0,t+r/2,f.transform.width,r,l)}function La(f,t,r,l){_s(f,t-r/2,0,r,f.transform.height,l)}function _s(f,t,r,l,u,_){const x=f.context,w=x.gl;w.enable(w.SCISSOR_TEST),w.scissor(t*f.pixelRatio,r*f.pixelRatio,l*f.pixelRatio,u*f.pixelRatio),x.clear({color:_}),w.disable(w.SCISSOR_TEST)}function za(f,t,r){const l=f.context,u=l.gl,_=r.posMatrix,x=f.useProgram("debug"),w=gi.disabled,I=tn.disabled,A=f.colorModeForRenderPass(),L="$debug",z=f.style.map.terrain&&f.style.map.terrain.getTerrainData(r);l.activeTexture.set(u.TEXTURE0);const N=t.getTileByID(r.key).latestRawTileData,X=Math.floor((N&&N.byteLength||0)/1024),H=t.getTile(r).tileSize,J=512/Math.min(H,512)*(r.overscaledZ/f.transform.zoom)*.5;let G=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(G+=` => ${r.overscaledZ}`),function(de,Se){de.initDebugOverlayCanvas();const ie=de.debugOverlayCanvas,pe=de.context.gl,Ce=de.debugOverlayCanvas.getContext("2d");Ce.clearRect(0,0,ie.width,ie.height),Ce.shadowColor="white",Ce.shadowBlur=2,Ce.lineWidth=1.5,Ce.strokeStyle="white",Ce.textBaseline="top",Ce.font="bold 36px Open Sans, sans-serif",Ce.fillText(Se,5,5),Ce.strokeText(Se,5,5),de.debugOverlayTexture.update(ie),de.debugOverlayTexture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE)}(f,`${G} ${X}kB`),x.draw(l,u.TRIANGLES,w,I,hn.alphaBlended,Bi.disabled,le(_,s.aT.transparent,J),null,L,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),x.draw(l,u.LINE_STRIP,w,I,A,Bi.disabled,le(_,s.aT.red),z,L,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function dn(f,t,r){const l=f.context,u=l.gl,_=f.colorModeForRenderPass(),x=new gi(u.LEQUAL,gi.ReadWrite,f.depthRangeFor3D),w=f.useProgram("terrain"),I=t.getTerrainMesh();l.bindFramebuffer.set(null),l.viewport.set([0,0,f.width,f.height]);for(const A of r){const L=f.renderToTexture.getTexture(A),z=t.getTerrainData(A.tileID);l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,L.texture);const N={u_matrix:f.transform.calculatePosMatrix(A.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(f.transform.zoom)};w.draw(l,u.TRIANGLES,x,tn.disabled,_,Bi.backCCW,N,z,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}}class Qo{constructor(t,r){this.context=new Jl(t),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.Z(),renderTime:0},this.setup(),this.numSublayers=Kn.maxUnderzooming+Kn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new no}resize(t,r,l){if(this.width=Math.floor(t*l),this.height=Math.floor(r*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const t=this.context,r=new s.a_;r.emplaceBack(0,0),r.emplaceBack(s.N,0),r.emplaceBack(0,s.N),r.emplaceBack(s.N,s.N),this.tileExtentBuffer=t.createVertexBuffer(r,fa.members),this.tileExtentSegments=s.S.simpleSegment(0,0,4,2);const l=new s.a_;l.emplaceBack(0,0),l.emplaceBack(s.N,0),l.emplaceBack(0,s.N),l.emplaceBack(s.N,s.N),this.debugBuffer=t.createVertexBuffer(l,fa.members),this.debugSegments=s.S.simpleSegment(0,0,4,5);const u=new s.V;u.emplaceBack(0,0,0,0),u.emplaceBack(s.N,0,s.N,0),u.emplaceBack(0,s.N,0,s.N),u.emplaceBack(s.N,s.N,s.N,s.N),this.rasterBoundsBuffer=t.createVertexBuffer(u,oi.members),this.rasterBoundsSegments=s.S.simpleSegment(0,0,4,2);const _=new s.a_;_.emplaceBack(0,0),_.emplaceBack(1,0),_.emplaceBack(0,1),_.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(_,fa.members),this.viewportSegments=s.S.simpleSegment(0,0,4,2);const x=new s.a$;x.emplaceBack(0),x.emplaceBack(1),x.emplaceBack(3),x.emplaceBack(2),x.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(x);const w=new s.b0;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(w);const I=this.context.gl;this.stencilClearMode=new tn({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO)}clearStencil(){const t=this.context,r=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=s.Z();s.aS(l,0,this.width,this.height,0,0,1),s.a0(l,l,[r.drawingBufferWidth,r.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,r.TRIANGLES,gi.disabled,this.stencilClearMode,hn.disabled,Bi.disabled,xe(l),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,r){if(this.currentStencilSource===t.source||!t.isTileClipped()||!r||!r.length)return;this.currentStencilSource=t.source;const l=this.context,u=l.gl;this.nextStencilID+r.length>256&&this.clearStencil(),l.setColorMode(hn.disabled),l.setDepthMode(gi.disabled);const _=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const x of r){const w=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,I=this.style.map.terrain&&this.style.map.terrain.getTerrainData(x);_.draw(l,u.TRIANGLES,gi.disabled,new tn({func:u.ALWAYS,mask:0},w,255,u.KEEP,u.KEEP,u.REPLACE),hn.disabled,Bi.disabled,xe(x.posMatrix),I,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new tn({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){const r=this.context.gl;return new tn({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(t){const r=this.context.gl,l=t.sort((x,w)=>w.overscaledZ-x.overscaledZ),u=l[l.length-1].overscaledZ,_=l[0].overscaledZ-u+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const x={};for(let w=0;w<_;w++)x[w+u]=new tn({func:r.GEQUAL,mask:255},w+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=_,[x,l]}return[{[u]:tn.disabled},l]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new hn([t.CONSTANT_COLOR,t.ONE],new s.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?hn.unblended:hn.alphaBlended}depthModeForSublayer(t,r,l){if(!this.opaquePassEnabledForLayer())return gi.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new gi(l||this.context.gl.LEQUAL,r,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,r){this.style=t,this.options=r,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(s.h.now()),this.imageManager.beginFrame();const l=this.style._order,u=this.style.sourceCaches,_={},x={},w={};for(const I in u){const A=u[I];A.used&&A.prepare(this.context),_[I]=A.getVisibleCoordinates(),x[I]=_[I].slice().reverse(),w[I]=A.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<l.length;I++)if(this.style._layers[l[I]].is3D()){this.opaquePassCutoff=I;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const I=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!s.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||I.length)&&(s.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(A,L){const z=A.context,N=z.gl,X=hn.unblended,H=new gi(N.LEQUAL,gi.ReadWrite,[0,1]),J=L.getTerrainMesh(),G=L.sourceCache.getRenderableTiles(),de=A.useProgram("terrainDepth");z.bindFramebuffer.set(L.getFramebuffer("depth").framebuffer),z.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),z.clear({color:s.aT.transparent,depth:1});for(const Se of G){const ie=L.getTerrainData(Se.tileID),pe={u_matrix:A.transform.calculatePosMatrix(Se.tileID.toUnwrapped()),u_ele_delta:L.getMeshFrameDelta(A.transform.zoom)};de.draw(z,N.TRIANGLES,H,tn.disabled,X,Bi.backCCW,pe,ie,"terrain",J.vertexBuffer,J.indexBuffer,J.segments)}z.bindFramebuffer.set(null),z.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain),function(A,L){const z=A.context,N=z.gl,X=hn.unblended,H=new gi(N.LEQUAL,gi.ReadWrite,[0,1]),J=L.getTerrainMesh(),G=L.getCoordsTexture(),de=L.sourceCache.getRenderableTiles(),Se=A.useProgram("terrainCoords");z.bindFramebuffer.set(L.getFramebuffer("coords").framebuffer),z.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),z.clear({color:s.aT.transparent,depth:1}),L.coordsIndex=[];for(const ie of de){const pe=L.getTerrainData(ie.tileID);z.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,G.texture);const Ce={u_matrix:A.transform.calculatePosMatrix(ie.tileID.toUnwrapped()),u_terrain_coords_id:(255-L.coordsIndex.length)/255,u_texture:0,u_ele_delta:L.getMeshFrameDelta(A.transform.zoom)};Se.draw(z,N.TRIANGLES,H,tn.disabled,X,Bi.backCCW,Ce,pe,"terrain",J.vertexBuffer,J.indexBuffer,J.segments),L.coordsIndex.push(ie.tileID.key)}z.bindFramebuffer.set(null),z.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const I of l){const A=this.style._layers[I];if(!A.hasOffscreenPass()||A.isHidden(this.transform.zoom))continue;const L=x[A.source];(A.type==="custom"||L.length)&&this.renderLayer(this,u[A.source],A,L)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?s.aT.black:s.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[l[this.currentLayer]],A=u[I.source],L=_[I.source];this._renderTileClippingMasks(I,L),this.renderLayer(this,A,I,L)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const I=this.style._layers[l[this.currentLayer]],A=u[I.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(I))continue;const L=(I.type==="symbol"?w:x)[I.source];this._renderTileClippingMasks(I,_[I.source]),this.renderLayer(this,A,I,L)}if(this.options.showTileBoundaries){const I=function(A,L){let z=null;const N=Object.values(A._layers).flatMap(G=>G.source&&!G.isHidden(L)?[A.sourceCaches[G.source]]:[]),X=N.filter(G=>G.getSource().type==="vector"),H=N.filter(G=>G.getSource().type!=="vector"),J=G=>{(!z||z.getSource().maxzoom<G.getSource().maxzoom)&&(z=G)};return X.forEach(G=>J(G)),z||H.forEach(G=>J(G)),z}(this.style,this.transform.zoom);I&&function(A,L,z){for(let N=0;N<z.length;N++)za(A,L,z[N])}(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const A=I.transform.padding;As(I,I.transform.height-(A.top||0),3,ms),As(I,A.bottom||0,3,Pa),La(I,A.left||0,3,Io),La(I,I.transform.width-(A.right||0),3,Tl);const L=I.transform.centerPoint;(function(z,N,X,H){_s(z,N-1,X-10,2,20,H),_s(z,N-10,X-1,20,2,H)})(I,L.x,I.transform.height-L.y,Yo)}(this),this.context.setDefault()}renderLayer(t,r,l,u){if(!l.isHidden(this.transform.zoom)&&(l.type==="background"||l.type==="custom"||(u||[]).length))switch(this.id=l.id,l.type){case"symbol":(function(_,x,w,I,A){if(_.renderPass!=="translucent")return;const L=tn.disabled,z=_.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(N,X,H,J,G,de,Se){const ie=X.transform,pe=G==="map",Ce=de==="map";for(const ke of N){const Be=J.getTile(ke),We=Be.getBucket(H);if(!We||!We.text||!We.text.segments.get().length)continue;const je=s.ah(We.textSizeData,ie.zoom),et=ae(Be,1,X.transform.zoom),It=it(ke.posMatrix,Ce,pe,X.transform,et),yi=H.layout.get("icon-text-fit")!=="none"&&We.hasIconData();if(je){const dt=Math.pow(2,ie.zoom-Be.tileID.overscaledZ);ka(We,pe,Ce,Se,ie,It,ke.posMatrix,dt,je,yi,X.style.map.terrain?(Xt,Mt)=>X.style.map.terrain.getElevation(ke,Xt,Mt):null)}}}(I,_,w,x,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),A),w.paint.get("icon-opacity").constantOr(1)!==0&&Jo(_,x,w,I,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),L,z),w.paint.get("text-opacity").constantOr(1)!==0&&Jo(_,x,w,I,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),L,z),x.map.showCollisionBoxes&&(Ko(_,x,w,I,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),!0),Ko(_,x,w,I,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),!1))})(t,r,l,u,this.style.placement.variableOffsets);break;case"circle":(function(_,x,w,I){if(_.renderPass!=="translucent")return;const A=w.paint.get("circle-opacity"),L=w.paint.get("circle-stroke-width"),z=w.paint.get("circle-stroke-opacity"),N=!w.layout.get("circle-sort-key").isConstant();if(A.constantOr(1)===0&&(L.constantOr(1)===0||z.constantOr(1)===0))return;const X=_.context,H=X.gl,J=_.depthModeForSublayer(0,gi.ReadOnly),G=tn.disabled,de=_.colorModeForRenderPass(),Se=[];for(let ie=0;ie<I.length;ie++){const pe=I[ie],Ce=x.getTile(pe),ke=Ce.getBucket(w);if(!ke)continue;const Be=ke.programConfigurations.get(w.id),We=_.useProgram("circle",Be),je=ke.layoutVertexBuffer,et=ke.indexBuffer,It=_.style.map.terrain&&_.style.map.terrain.getTerrainData(pe),yi={programConfiguration:Be,program:We,layoutVertexBuffer:je,indexBuffer:et,uniformValues:Q(_,pe,Ce,w),terrainData:It};if(N){const dt=ke.segments.get();for(const Xt of dt)Se.push({segments:new s.S([Xt]),sortKey:Xt.sortKey,state:yi})}else Se.push({segments:ke.segments,sortKey:0,state:yi})}N&&Se.sort((ie,pe)=>ie.sortKey-pe.sortKey);for(const ie of Se){const{programConfiguration:pe,program:Ce,layoutVertexBuffer:ke,indexBuffer:Be,uniformValues:We,terrainData:je}=ie.state;Ce.draw(X,H.TRIANGLES,J,G,de,Bi.disabled,We,je,w.id,ke,Be,ie.segments,w.paint,_.transform.zoom,pe)}})(t,r,l,u);break;case"heatmap":(function(_,x,w,I){if(w.paint.get("heatmap-opacity")!==0)if(_.renderPass==="offscreen"){const A=_.context,L=A.gl,z=tn.disabled,N=new hn([L.ONE,L.ONE],s.aT.transparent,[!0,!0,!0,!0]);(function(X,H,J){const G=X.gl;X.activeTexture.set(G.TEXTURE1),X.viewport.set([0,0,H.width/4,H.height/4]);let de=J.heatmapFbo;if(de)G.bindTexture(G.TEXTURE_2D,de.colorAttachment.get()),X.bindFramebuffer.set(de.framebuffer);else{const Se=G.createTexture();G.bindTexture(G.TEXTURE_2D,Se),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),de=J.heatmapFbo=X.createFramebuffer(H.width/4,H.height/4,!1,!1),function(ie,pe,Ce,ke){var Be,We;const je=ie.gl,et=(Be=ie.HALF_FLOAT)!==null&&Be!==void 0?Be:je.UNSIGNED_BYTE,It=(We=ie.RGBA16F)!==null&&We!==void 0?We:je.RGBA;je.texImage2D(je.TEXTURE_2D,0,It,pe.width/4,pe.height/4,0,je.RGBA,et,null),ke.colorAttachment.set(Ce)}(X,H,Se,de)}})(A,_,w),A.clear({color:s.aT.transparent});for(let X=0;X<I.length;X++){const H=I[X];if(x.hasRenderableParent(H))continue;const J=x.getTile(H),G=J.getBucket(w);if(!G)continue;const de=G.programConfigurations.get(w.id),Se=_.useProgram("heatmap",de),{zoom:ie}=_.transform;Se.draw(A,L.TRIANGLES,gi.disabled,z,N,Bi.disabled,Ge(H.posMatrix,J,ie,w.paint.get("heatmap-intensity")),null,w.id,G.layoutVertexBuffer,G.indexBuffer,G.segments,w.paint,_.transform.zoom,de)}A.viewport.set([0,0,_.width,_.height])}else _.renderPass==="translucent"&&(_.context.setColorMode(_.colorModeForRenderPass()),function(A,L){const z=A.context,N=z.gl,X=L.heatmapFbo;if(!X)return;z.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,X.colorAttachment.get()),z.activeTexture.set(N.TEXTURE1);let H=L.colorRampTexture;H||(H=L.colorRampTexture=new qt(z,L.colorRamp,N.RGBA)),H.bind(N.LINEAR,N.CLAMP_TO_EDGE),A.useProgram("heatmapTexture").draw(z,N.TRIANGLES,gi.disabled,tn.disabled,A.colorModeForRenderPass(),Bi.disabled,((J,G,de,Se)=>{const ie=s.Z();s.aS(ie,0,J.width,J.height,0,0,1);const pe=J.context.gl;return{u_matrix:ie,u_world:[pe.drawingBufferWidth,pe.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:G.paint.get("heatmap-opacity")}})(A,L),null,L.id,A.viewportBuffer,A.quadTriangleIndexBuffer,A.viewportSegments,L.paint,A.transform.zoom)}(_,w))})(t,r,l,u);break;case"line":(function(_,x,w,I){if(_.renderPass!=="translucent")return;const A=w.paint.get("line-opacity"),L=w.paint.get("line-width");if(A.constantOr(1)===0||L.constantOr(1)===0)return;const z=_.depthModeForSublayer(0,gi.ReadOnly),N=_.colorModeForRenderPass(),X=w.paint.get("line-dasharray"),H=w.paint.get("line-pattern"),J=H.constantOr(1),G=w.paint.get("line-gradient"),de=w.getCrossfadeParameters(),Se=J?"linePattern":X?"lineSDF":G?"lineGradient":"line",ie=_.context,pe=ie.gl;let Ce=!0;for(const ke of I){const Be=x.getTile(ke);if(J&&!Be.patternsLoaded())continue;const We=Be.getBucket(w);if(!We)continue;const je=We.programConfigurations.get(w.id),et=_.context.program.get(),It=_.useProgram(Se,je),yi=Ce||It.program!==et,dt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(ke),Xt=H.constantOr(null);if(Xt&&Be.imageAtlas){const mi=Be.imageAtlas,ai=mi.patternPositions[Xt.to.toString()],vi=mi.patternPositions[Xt.from.toString()];ai&&vi&&je.setConstantPatternPositions(ai,vi)}const Mt=dt?ke:null,Ki=J?ct(_,Be,w,de,Mt):X?ti(_,Be,w,X,de,Mt):G?_t(_,Be,w,We.lineClipsArray.length,Mt):mt(_,Be,w,Mt);if(J)ie.activeTexture.set(pe.TEXTURE0),Be.imageAtlasTexture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),je.updatePaintBuffers(de);else if(X&&(yi||_.lineAtlas.dirty))ie.activeTexture.set(pe.TEXTURE0),_.lineAtlas.bind(ie);else if(G){const mi=We.gradients[w.id];let ai=mi.texture;if(w.gradientVersion!==mi.version){let vi=256;if(w.stepInterpolant){const Ln=x.getSource().maxzoom,sn=ke.canonical.z===Ln?Math.ceil(1<<_.transform.maxZoom-ke.canonical.z):1;vi=s.ad(s.aY(We.maxLineLength/s.N*1024*sn),256,ie.maxTextureSize)}mi.gradient=s.aZ({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:vi,image:mi.gradient||void 0,clips:We.lineClipsArray}),mi.texture?mi.texture.update(mi.gradient):mi.texture=new qt(ie,mi.gradient,pe.RGBA),mi.version=w.gradientVersion,ai=mi.texture}ie.activeTexture.set(pe.TEXTURE0),ai.bind(w.stepInterpolant?pe.NEAREST:pe.LINEAR,pe.CLAMP_TO_EDGE)}It.draw(ie,pe.TRIANGLES,z,_.stencilModeForClipping(ke),N,Bi.disabled,Ki,dt,w.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,w.paint,_.transform.zoom,je,We.layoutVertexBuffer2),Ce=!1}})(t,r,l,u);break;case"fill":(function(_,x,w,I){const A=w.paint.get("fill-color"),L=w.paint.get("fill-opacity");if(L.constantOr(1)===0)return;const z=_.colorModeForRenderPass(),N=w.paint.get("fill-pattern"),X=_.opaquePassEnabledForLayer()&&!N.constantOr(1)&&A.constantOr(s.aT.transparent).a===1&&L.constantOr(0)===1?"opaque":"translucent";if(_.renderPass===X){const H=_.depthModeForSublayer(1,_.renderPass==="opaque"?gi.ReadWrite:gi.ReadOnly);Ws(_,x,w,I,H,z,!1)}if(_.renderPass==="translucent"&&w.paint.get("fill-antialias")){const H=_.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,gi.ReadOnly);Ws(_,x,w,I,H,z,!0)}})(t,r,l,u);break;case"fill-extrusion":(function(_,x,w,I){const A=w.paint.get("fill-extrusion-opacity");if(A!==0&&_.renderPass==="translucent"){const L=new gi(_.context.gl.LEQUAL,gi.ReadWrite,_.depthRangeFor3D);if(A!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))Hs(_,x,w,I,L,tn.disabled,hn.disabled),Hs(_,x,w,I,L,_.stencilModeFor3D(),_.colorModeForRenderPass());else{const z=_.colorModeForRenderPass();Hs(_,x,w,I,L,tn.disabled,z)}}})(t,r,l,u);break;case"hillshade":(function(_,x,w,I){if(_.renderPass!=="offscreen"&&_.renderPass!=="translucent")return;const A=_.context,L=_.depthModeForSublayer(0,gi.ReadOnly),z=_.colorModeForRenderPass(),[N,X]=_.renderPass==="translucent"?_.stencilConfigForOverlap(I):[{},I];for(const H of X){const J=x.getTile(H);J.needsHillshadePrepare!==void 0&&J.needsHillshadePrepare&&_.renderPass==="offscreen"?Ma(_,J,w,L,tn.disabled,z):_.renderPass==="translucent"&&Sl(_,H,J,w,L,N[H.overscaledZ],z)}A.viewport.set([0,0,_.width,_.height])})(t,r,l,u);break;case"raster":(function(_,x,w,I){if(_.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!I.length)return;const A=_.context,L=A.gl,z=x.getSource(),N=_.useProgram("raster"),X=_.colorModeForRenderPass(),[H,J]=z instanceof vt?[{},I]:_.stencilConfigForOverlap(I),G=J[J.length-1].overscaledZ,de=!_.options.moving;for(const Se of J){const ie=_.depthModeForSublayer(Se.overscaledZ-G,w.paint.get("raster-opacity")===1?gi.ReadWrite:gi.ReadOnly,L.LESS),pe=x.getTile(Se);pe.registerFadeDuration(w.paint.get("raster-fade-duration"));const Ce=x.findLoadedParent(Se,0),ke=Aa(pe,Ce,x,w,_.transform,_.style.map.terrain);let Be,We;const je=w.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;A.activeTexture.set(L.TEXTURE0),pe.texture.bind(je,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),A.activeTexture.set(L.TEXTURE1),Ce?(Ce.texture.bind(je,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),Be=Math.pow(2,Ce.tileID.overscaledZ-pe.tileID.overscaledZ),We=[pe.tileID.canonical.x*Be%1,pe.tileID.canonical.y*Be%1]):pe.texture.bind(je,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);const et=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Se),It=et?Se:null,yi=It?It.posMatrix:_.transform.calculatePosMatrix(Se.toUnwrapped(),de),dt=Cn(yi,We||[0,0],Be||1,ke,w);z instanceof vt?N.draw(A,L.TRIANGLES,ie,tn.disabled,X,Bi.disabled,dt,et,w.id,z.boundsBuffer,_.quadTriangleIndexBuffer,z.boundsSegments):N.draw(A,L.TRIANGLES,ie,H[Se.overscaledZ],X,Bi.disabled,dt,et,w.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}})(t,r,l,u);break;case"background":(function(_,x,w,I){const A=w.paint.get("background-color"),L=w.paint.get("background-opacity");if(L===0)return;const z=_.context,N=z.gl,X=_.transform,H=X.tileSize,J=w.paint.get("background-pattern");if(_.isPatternMissing(J))return;const G=!J&&A.a===1&&L===1&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==G)return;const de=tn.disabled,Se=_.depthModeForSublayer(0,G==="opaque"?gi.ReadWrite:gi.ReadOnly),ie=_.colorModeForRenderPass(),pe=_.useProgram(J?"backgroundPattern":"background"),Ce=I||X.coveringTiles({tileSize:H,terrain:_.style.map.terrain});J&&(z.activeTexture.set(N.TEXTURE0),_.imageManager.bind(_.context));const ke=w.getCrossfadeParameters();for(const Be of Ce){const We=I?Be.posMatrix:_.transform.calculatePosMatrix(Be.toUnwrapped()),je=J?Tr(We,L,_,J,{tileID:Be,tileSize:H},ke):gn(We,L,A),et=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Be);pe.draw(z,N.TRIANGLES,Se,de,ie,Bi.disabled,je,et,w.id,_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}})(t,0,l,u);break;case"custom":(function(_,x,w){const I=_.context,A=w.implementation;if(_.renderPass==="offscreen"){const L=A.prerender;L&&(_.setCustomLayerDefaults(),I.setColorMode(_.colorModeForRenderPass()),L.call(A,I.gl,_.transform.customLayerMatrix()),I.setDirty(),_.setBaseState())}else if(_.renderPass==="translucent"){_.setCustomLayerDefaults(),I.setColorMode(_.colorModeForRenderPass()),I.setStencilMode(tn.disabled);const L=A.renderingMode==="3d"?new gi(_.context.gl.LEQUAL,gi.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,gi.ReadOnly);I.setDepthMode(L),A.render(I.gl,_.transform.customLayerMatrix()),I.setDirty(),_.setBaseState(),I.bindFramebuffer.set(null)}})(t,0,l)}}translatePosMatrix(t,r,l,u,_){if(!l[0]&&!l[1])return t;const x=_?u==="map"?this.transform.angle:0:u==="viewport"?-this.transform.angle:0;if(x){const A=Math.sin(x),L=Math.cos(x);l=[l[0]*L-l[1]*A,l[0]*A+l[1]*L]}const w=[_?l[0]:ae(r,l[0],this.transform.zoom),_?l[1]:ae(r,l[1],this.transform.zoom),0],I=new Float32Array(16);return s.$(I,t,w),I}saveTileTexture(t){const r=this._tileTextures[t.size[0]];r?r.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const r=this.imageManager.getPattern(t.from.toString()),l=this.imageManager.getPattern(t.to.toString());return!r||!l}useProgram(t,r){this.cache=this.cache||{};const l=t+(r?r.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[l]||(this.cache[l]=new Ns(this.context,an[t],r,ma[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new qt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:r}=this.context.gl;return this.width!==t||this.height!==r}}class gr{constructor(t,r){this.points=t,this.planes=r}static fromInvProjectionMatrix(t,r,l){const u=Math.pow(2,l),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const I=1/(w=s.ag([],w,t))[3]/r*u;return s.b3(w,w,[I,I,1/w[3],I])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const I=function(N,X){var H=X[0],J=X[1],G=X[2],de=H*H+J*J+G*G;return de>0&&(de=1/Math.sqrt(de)),N[0]=X[0]*de,N[1]=X[1]*de,N[2]=X[2]*de,N}([],function(N,X,H){var J=X[0],G=X[1],de=X[2],Se=H[0],ie=H[1],pe=H[2];return N[0]=G*pe-de*ie,N[1]=de*Se-J*pe,N[2]=J*ie-G*Se,N}([],xt([],_[w[0]],_[w[1]]),xt([],_[w[2]],_[w[1]]))),A=-((L=I)[0]*(z=_[w[1]])[0]+L[1]*z[1]+L[2]*z[2]);var L,z;return I.concat(A)});return new gr(_,x)}}class Co{constructor(t,r){this.min=t,this.max=r,this.center=function(l,u,_){return l[0]=.5*u[0],l[1]=.5*u[1],l[2]=.5*u[2],l}([],function(l,u,_){return l[0]=u[0]+_[0],l[1]=u[1]+_[1],l[2]=u[2]+_[2],l}([],this.min,this.max))}quadrant(t){const r=[t%2==0,t<2],l=Le(this.min),u=Le(this.max);for(let _=0;_<r.length;_++)l[_]=r[_]?this.min[_]:this.center[_],u[_]=r[_]?this.center[_]:this.max[_];return u[2]=this.max[2],new Co(l,u)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const r=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let l=!0;for(let u=0;u<t.planes.length;u++){const _=t.planes[u];let x=0;for(let w=0;w<r.length;w++)s.b4(_,r[w])>=0&&x++;if(x===0)return 0;x!==r.length&&(l=!1)}if(l)return 2;for(let u=0;u<3;u++){let _=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let w=0;w<t.points.length;w++){const I=t.points[w][u]-this.min[u];_=Math.min(_,I),x=Math.max(x,I)}if(x<0||_>this.max[u]-this.min[u])return 0}return 1}}class Ps{constructor(t=0,r=0,l=0,u=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(l)||l<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=l,this.right=u}interpolate(t,r,l){return r.top!=null&&t.top!=null&&(this.top=s.B.number(t.top,r.top,l)),r.bottom!=null&&t.bottom!=null&&(this.bottom=s.B.number(t.bottom,r.bottom,l)),r.left!=null&&t.left!=null&&(this.left=s.B.number(t.left,r.left,l)),r.right!=null&&t.right!=null&&(this.right=s.B.number(t.right,r.right,l)),this}getCenter(t,r){const l=s.ad((this.left+t-this.right)/2,0,t),u=s.ad((this.top+r-this.bottom)/2,0,r);return new s.P(l,u)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Ps(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Da{constructor(t,r,l,u,_){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=_===void 0||!!_,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=l??0,this._maxPitch=u??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ps,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const t=new Da(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this._minEleveationForCurrentTile=t._minEleveationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const r=-s.b5(t,-180,180)*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=function(){var l=new s.A(4);return s.A!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l}(),function(l,u,_){var x=u[0],w=u[1],I=u[2],A=u[3],L=Math.sin(_),z=Math.cos(_);l[0]=x*z+I*L,l[1]=w*z+A*L,l[2]=x*-L+I*z,l[3]=w*-L+A*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const r=s.ad(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const r=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this.tileZoom=Math.max(0,Math.floor(r)),this.scale=this.zoomScale(r),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,l){this._unmodified=!1,this._edgeInsets.interpolate(t,r,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const r=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,r)}getVisibleUnwrappedCoordinates(t){const r=[new s.b6(0,t)];if(this._renderWorldCopies){const l=this.pointCoordinate(new s.P(0,0)),u=this.pointCoordinate(new s.P(this.width,0)),_=this.pointCoordinate(new s.P(this.width,this.height)),x=this.pointCoordinate(new s.P(0,this.height)),w=Math.floor(Math.min(l.x,u.x,_.x,x.x)),I=Math.floor(Math.max(l.x,u.x,_.x,x.x)),A=1;for(let L=w-A;L<=I+A;L++)L!==0&&r.push(new s.b6(L,t))}return r}coveringTiles(t){var r,l;let u=this.coveringZoomLevel(t);const _=u;if(t.minzoom!==void 0&&u<t.minzoom)return[];t.maxzoom!==void 0&&u>t.maxzoom&&(u=t.maxzoom);const x=this.pointCoordinate(this.getCameraPoint()),w=s.U.fromLngLat(this.center),I=Math.pow(2,u),A=[I*x.x,I*x.y,0],L=[I*w.x,I*w.y,0],z=gr.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u);let N=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(N=u);const X=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,H=ie=>({aabb:new Co([ie*I,0,0],[(ie+1)*I,I,0]),zoom:0,x:0,y:0,wrap:ie,fullyVisible:!1}),J=[],G=[],de=u,Se=t.reparseOverscaled?_:u;if(this._renderWorldCopies)for(let ie=1;ie<=3;ie++)J.push(H(-ie)),J.push(H(ie));for(J.push(H(0));J.length>0;){const ie=J.pop(),pe=ie.x,Ce=ie.y;let ke=ie.fullyVisible;if(!ke){const It=ie.aabb.intersects(z);if(It===0)continue;ke=It===2}const Be=t.terrain?A:L,We=ie.aabb.distanceX(Be),je=ie.aabb.distanceY(Be),et=Math.max(Math.abs(We),Math.abs(je));if(ie.zoom===de||et>X+(1<<de-ie.zoom)-2&&ie.zoom>=N){const It=de-ie.zoom,yi=A[0]-.5-(pe<<It),dt=A[1]-.5-(Ce<<It);G.push({tileID:new s.O(ie.zoom===de?Se:ie.zoom,ie.wrap,ie.zoom,pe,Ce),distanceSq:Qe([L[0]-.5-pe,L[1]-.5-Ce]),tileDistanceToCamera:Math.sqrt(yi*yi+dt*dt)})}else for(let It=0;It<4;It++){const yi=(pe<<1)+It%2,dt=(Ce<<1)+(It>>1),Xt=ie.zoom+1;let Mt=ie.aabb.quadrant(It);if(t.terrain){const Ki=new s.O(Xt,ie.wrap,Xt,yi,dt),mi=t.terrain.getMinMaxElevation(Ki),ai=(r=mi.minElevation)!==null&&r!==void 0?r:this.elevation,vi=(l=mi.maxElevation)!==null&&l!==void 0?l:this.elevation;Mt=new Co([Mt.min[0],Mt.min[1],ai],[Mt.max[0],Mt.max[1],vi])}J.push({aabb:Mt,zoom:Xt,x:yi,y:dt,wrap:ie.wrap,fullyVisible:ke})}}return G.sort((ie,pe)=>ie.distanceSq-pe.distanceSq).map(ie=>ie.tileID)}resize(t,r){this.width=t,this.height=r,this.pixelsToGLUnits=[2/t,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const r=s.ad(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.P(s.G(t.lng)*this.worldSize,s.H(r)*this.worldSize)}unproject(t){return new s.U(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const r=this.pointLocation(this.centerPoint,t),l=t.getElevationForLngLatZoom(r,this.tileZoom);if(!(this.elevation-l))return;const u=this.getCameraPosition(),_=s.U.fromLngLat(u.lngLat,u.altitude),x=s.U.fromLngLat(r,l),w=_.x-x.x,I=_.y-x.y,A=_.z-x.z,L=Math.sqrt(w*w+I*I+A*A),z=this.scaleZoom(this.cameraToCenterDistance/L/this.tileSize);this._elevation=l,this._center=r,this.zoom=z}setLocationAtPoint(t,r){const l=this.pointCoordinate(r),u=this.pointCoordinate(this.centerPoint),_=this.locationCoordinate(t),x=new s.U(_.x-(l.x-u.x),_.y-(l.y-u.y));this.center=this.coordinateLocation(x),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,r){return r?this.coordinatePoint(this.locationCoordinate(t),r.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,r){return this.coordinateLocation(this.pointCoordinate(t,r))}locationCoordinate(t){return s.U.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,r){if(r){const N=r.pointCoordinate(t);if(N!=null)return N}const l=[t.x,t.y,0,1],u=[t.x,t.y,1,1];s.ag(l,l,this.pixelMatrixInverse),s.ag(u,u,this.pixelMatrixInverse);const _=l[3],x=u[3],w=l[1]/_,I=u[1]/x,A=l[2]/_,L=u[2]/x,z=A===L?0:(0-A)/(L-A);return new s.U(s.B.number(l[0]/_,u[0]/x,z)/this.worldSize,s.B.number(w,I,z)/this.worldSize)}coordinatePoint(t,r=0,l=this.pixelMatrix){const u=[t.x*this.worldSize,t.y*this.worldSize,r,1];return s.ag(u,u,l),new s.P(u[0]/u[3],u[1]/u[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Nt().extend(this.pointLocation(new s.P(0,t))).extend(this.pointLocation(new s.P(this.width,t))).extend(this.pointLocation(new s.P(this.width,this.height))).extend(this.pointLocation(new s.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Nt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,r=!1){const l=t.key,u=r?this._alignedPosMatrixCache:this._posMatrixCache;if(u[l])return u[l];const _=t.canonical,x=this.worldSize/this.zoomScale(_.z),w=_.x+Math.pow(2,_.z)*t.wrap,I=s.ao(new Float64Array(16));return s.$(I,I,[w*x,_.y*x,0]),s.a0(I,I,[x/s.N,x/s.N,1]),s.a1(I,r?this.alignedProjMatrix:this.projMatrix,I),u[l]=new Float32Array(I),u[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,r,l,u,_=-90,x=90,w=-180,I=180;const A=this.size,L=this._unmodified;if(this.latRange){const X=this.latRange;_=s.H(X[1])*this.worldSize,x=s.H(X[0])*this.worldSize,t=x-_<A.y?A.y/(x-_):0}if(this.lngRange){const X=this.lngRange;w=s.b5(s.G(X[0])*this.worldSize,0,this.worldSize),I=s.b5(s.G(X[1])*this.worldSize,0,this.worldSize),I<w&&(I+=this.worldSize),r=I-w<A.x?A.x/(I-w):0}const z=this.point,N=Math.max(r||0,t||0);if(N)return this.center=this.unproject(new s.P(r?(I+w)/2:z.x,t?(x+_)/2:z.y)),this.zoom+=this.scaleZoom(N),this._unmodified=L,void(this._constraining=!1);if(this.latRange){const X=z.y,H=A.y/2;X-H<_&&(u=_+H),X+H>x&&(u=x-H)}if(this.lngRange){const X=(w+I)/2,H=s.b5(z.x,X-this.worldSize/2,X+this.worldSize/2),J=A.x/2;H-J<w&&(l=w+J),H+J>I&&(l=I-J)}l===void 0&&u===void 0||(this.center=this.unproject(new s.P(l!==void 0?l:z.x,u!==void 0?u:z.y)).wrap()),this._unmodified=L,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,r=this.point.x,l=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.b7(1,this.center.lat)*this.worldSize;let u=s.ao(new Float64Array(16));s.a0(u,u,[this.width/2,-this.height/2,1]),s.$(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=s.ao(new Float64Array(16)),s.a0(u,u,[1,-1,1]),s.$(u,u,[-1,-1,0]),s.a0(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u;const _=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),x=Math.min(this.elevation,this._minEleveationForCurrentTile),w=_-x*this._pixelPerMeter/Math.cos(this._pitch),I=x<0?w:_,A=Math.PI/2+this._pitch,L=this._fov*(.5+t.y/this.height),z=Math.sin(L)*I/Math.sin(s.ad(Math.PI-A-L,.01,Math.PI-.01)),N=this.getHorizon(),X=2*Math.atan(N/this.cameraToCenterDistance)*(.5+t.y/(2*N)),H=Math.sin(X)*I/Math.sin(s.ad(Math.PI-A-X,.01,Math.PI-.01)),J=Math.min(z,H),G=1.01*(Math.cos(Math.PI/2-this._pitch)*J+I),de=this.height/50;u=new Float64Array(16),s.b8(u,this._fov,this.width/this.height,de,G),u[8]=2*-t.x/this.width,u[9]=2*t.y/this.height,s.a0(u,u,[1,-1,1]),s.$(u,u,[0,0,-this.cameraToCenterDistance]),s.b9(u,u,this._pitch),s.ae(u,u,this.angle),s.$(u,u,[-r,-l,0]),this.mercatorMatrix=s.a0([],u,[this.worldSize,this.worldSize,this.worldSize]),s.a0(u,u,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.a1(new Float64Array(16),this.labelPlaneMatrix,u),s.$(u,u,[0,0,-this.elevation]),this.projMatrix=u,this.invProjMatrix=s.as([],u),this.pixelMatrix3D=s.a1(new Float64Array(16),this.labelPlaneMatrix,u);const Se=this.width%2/2,ie=this.height%2/2,pe=Math.cos(this.angle),Ce=Math.sin(this.angle),ke=r-Math.round(r)+pe*Se+Ce*ie,Be=l-Math.round(l)+pe*ie+Ce*Se,We=new Float64Array(u);if(s.$(We,We,[ke>.5?ke-1:ke,Be>.5?Be-1:Be,0]),this.alignedProjMatrix=We,u=s.as(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new s.P(0,0)),r=[t.x*this.worldSize,t.y*this.worldSize,0,1];return s.ag(r,r,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,t))}getCameraQueryGeometry(t){const r=this.getCameraPoint();if(t.length===1)return[t[0],r];{let l=r.x,u=r.y,_=r.x,x=r.y;for(const w of t)l=Math.min(l,w.x),u=Math.min(u,w.y),_=Math.max(_,w.x),x=Math.max(x,w.y);return[new s.P(l,u),new s.P(_,u),new s.P(_,x),new s.P(l,x),new s.P(l,u)]}}}function ge(f,t){let r,l=!1,u=null,_=null;const x=()=>{u=null,l&&(f.apply(_,r),u=setTimeout(x,t),l=!1)};return(...w)=>(l=!0,_=this,r=w,u||x(),u)}class Ae{constructor(t){this._getCurrentHash=()=>{const r=window.location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(l=u)}),(l&&l[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{const r=this._getCurrentHash();if(r.length>=3&&!r.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:l,pitch:+(r[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const r=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,r)}catch{}},this._updateHash=ge(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const r=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,u=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,u),x=Math.round(r.lng*_)/_,w=Math.round(r.lat*_)/_,I=this._map.getBearing(),A=this._map.getPitch();let L="";if(L+=t?`/${x}/${w}/${l}`:`${l}/${w}/${x}`,(I||A)&&(L+="/"+Math.round(10*I)/10),A&&(L+=`/${Math.round(A)}`),this._hashName){const z=this._hashName;let N=!1;const X=window.location.hash.slice(1).split("&").map(H=>{const J=H.split("=")[0];return J===z?(N=!0,`${J}=${L}`):H}).filter(H=>H);return N||X.push(`${z}=${L}`),`#${X.join("&")}`}return`#${L}`}}const ut={linearity:.3,easing:s.ba(0,0,.3,1)},jt=s.e({deceleration:2500,maxSpeed:1400},ut),nn=s.e({deceleration:20,maxSpeed:1400},ut),Si=s.e({deceleration:1e3,maxSpeed:360},ut),yn=s.e({deceleration:1e3,maxSpeed:90},ut);class kn{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.h.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=s.h.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)r.zoom+=_.zoomDelta||0,r.bearing+=_.bearingDelta||0,r.pitch+=_.pitchDelta||0,_.panDelta&&r.pan._add(_.panDelta),_.around&&(r.around=_.around),_.pinchAround&&(r.pinchAround=_.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(r.pan.mag()){const _=vn(r.pan.mag(),l,s.e({},jt,t||{}));u.offset=r.pan.mult(_.amount/r.pan.mag()),u.center=this._map.transform.center,An(u,_)}if(r.zoom){const _=vn(r.zoom,l,nn);u.zoom=this._map.transform.zoom+_.amount,An(u,_)}if(r.bearing){const _=vn(r.bearing,l,Si);u.bearing=this._map.transform.bearing+s.ad(_.amount,-179,179),An(u,_)}if(r.pitch){const _=vn(r.pitch,l,yn);u.pitch=this._map.transform.pitch+_.amount,An(u,_)}if(u.zoom||u.bearing){const _=r.pinchAround===void 0?r.around:r.pinchAround;u.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),s.e(u,{noMoveStart:!0})}}function An(f,t){(!f.duration||f.duration<t.duration)&&(f.duration=t.duration,f.easing=t.easing)}function vn(f,t,r){const{maxSpeed:l,linearity:u,deceleration:_}=r,x=s.ad(f*u/(t/1e3),-l,l),w=Math.abs(x)/(_*u);return{easing:r.easing,duration:1e3*w,amount:x*(w/2)}}class Ni extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,l,u={}){const _=M.mousePos(r.getCanvasContainer(),l),x=r.unproject(_);super(t,s.e({point:_,lngLat:x,originalEvent:l},u)),this._defaultPrevented=!1,this.target=r}}class kr extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,l){const u=t==="touchend"?l.changedTouches:l.touches,_=M.touchPos(r.getCanvasContainer(),u),x=_.map(I=>r.unproject(I)),w=_.reduce((I,A,L,z)=>I.add(A.div(z.length)),new s.P(0,0));super(t,{points:_,point:w,lngLats:x,lngLat:r.unproject(w),originalEvent:l}),this._defaultPrevented=!1}}class ko extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,l){super(t,{originalEvent:l}),this._defaultPrevented=!1}}class cr{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new ko(t.type,this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new Ni(t.type,this._map,t))}mouseup(t){this._map.fire(new Ni(t.type,this._map,t))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new Ni(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Ni(t.type,this._map,t))}mouseover(t){this._map.fire(new Ni(t.type,this._map,t))}mouseout(t){this._map.fire(new Ni(t.type,this._map,t))}touchstart(t){return this._firePreventable(new kr(t.type,this._map,t))}touchmove(t){this._map.fire(new kr(t.type,this._map,t))}touchend(t){this._map.fire(new kr(t.type,this._map,t))}touchcancel(t){this._map.fire(new kr(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Eo{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Ni(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ni("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Ni(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Er{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(s.P.convert(t),this._map.terrain)}}class Xs{constructor(t,r){this._map=t,this._tr=new Er(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&t.button===0&&(M.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const l=r;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=l,this._box||(this._box=M.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const _=Math.min(u.x,l.x),x=Math.max(u.x,l.x),w=Math.min(u.y,l.y),I=Math.max(u.y,l.y);M.setTransform(this._box,`translate(${_}px,${w}px)`),this._box.style.width=x-_+"px",this._box.style.height=I-w+"px"}mouseupWindow(t,r){if(!this._active||t.button!==0)return;const l=this._startPos,u=r;if(this.reset(),M.suppressClick(),l.x!==u.x||l.y!==u.y)return this._map.fire(new s.k("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(l,u,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(M.remove(this._box),this._box=null),M.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new s.k(t,{originalEvent:r}))}}function Yn(f,t){if(f.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${t.length}`);const r={};for(let l=0;l<f.length;l++)r[f[l].identifier]=t[l];return r}class Rr{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,r,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),l.length===this.numTouches&&(this.centroid=function(u){const _=new s.P(0,0);for(const x of u)_._add(x);return _.div(u.length)}(r),this.touches=Yn(l,r)))}touchmove(t,r,l){if(this.aborted||!this.centroid)return;const u=Yn(l,r);for(const _ in this.touches){const x=u[_];(!x||x.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(t,r,l){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class Ks{constructor(t){this.singleTap=new Rr(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,r,l){this.singleTap.touchstart(t,r,l)}touchmove(t,r,l){this.singleTap.touchmove(t,r,l)}touchend(t,r,l){const u=this.singleTap.touchend(t,r,l);if(u){const _=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(u)<30;if(_&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class Fo{constructor(t){this._tr=new Er(t),this._zoomIn=new Ks({numTouches:1,numTaps:2}),this._zoomOut=new Ks({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,l){this._zoomIn.touchstart(t,r,l),this._zoomOut.touchstart(t,r,l)}touchmove(t,r,l){this._zoomIn.touchmove(t,r,l),this._zoomOut.touchmove(t,r,l)}touchend(t,r,l){const u=this._zoomIn.touchend(t,r,l),_=this._zoomOut.touchend(t,r,l),x=this._tr;return u?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:x.zoom+1,around:x.unproject(u)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:x.zoom-1,around:x.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ro{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const r=this._moveFunction(...t);if(r.bearingDelta||r.pitchDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(t,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=r.length?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,r){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const u=r.length?r[0]:r;return!this._moved&&u.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=u,this._move(l,u))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&M.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Yi={0:1,2:2};class Vi{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const r=M.mouseButton(t);this._eventButton=r}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(r,l){const u=Yi[l];return r.buttons===void 0||(r.buttons&u)!==u}(t,this._eventButton)}isValidEndEvent(t){return M.mouseButton(t)===this._eventButton}}class Js{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const so=f=>{f.mousedown=f.dragStart,f.mousemoveWindow=f.dragMove,f.mouseup=f.dragEnd,f.contextmenu=function(t){t.preventDefault()}},$o=({enable:f,clickTolerance:t,bearingDegreesPerPixelMoved:r=.8})=>{const l=new Vi({checkCorrectEvent:u=>M.mouseButton(u)===0&&u.ctrlKey||M.mouseButton(u)===2});return new Ro({clickTolerance:t,move:(u,_)=>({bearingDelta:(_.x-u.x)*r}),moveStateManager:l,enable:f,assignEvents:so})},Pn=({enable:f,clickTolerance:t,pitchDegreesPerPixelMoved:r=-.5})=>{const l=new Vi({checkCorrectEvent:u=>M.mouseButton(u)===0&&u.ctrlKey||M.mouseButton(u)===2});return new Ro({clickTolerance:t,move:(u,_)=>({pitchDelta:(_.y-u.y)*r}),moveStateManager:l,enable:f,assignEvents:so})};class ft{constructor(t,r){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,r,l){return this._calculateTransform(t,r,l)}touchmove(t,r,l){if(this._map._cooperativeGestures&&(this._minTouches===2&&l.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,l.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(l.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,r,l)}touchend(t,r,l){this._calculateTransform(t,r,l),this._active&&l.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,l){l.length>0&&(this._active=!0);const u=Yn(l,r),_=new s.P(0,0),x=new s.P(0,0);let w=0;for(const A in u){const L=u[A],z=this._touches[A];z&&(_._add(L),x._add(L.sub(z)),w++,u[A]=L)}if(this._touches=u,w<this._minTouches||!x.mag())return;const I=x.div(w);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(w),panDelta:I}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ao{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,r,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,l){if(!this._firstTwoTouches)return;t.preventDefault();const[u,_]=this._firstTwoTouches,x=Xr(l,r,u),w=Xr(l,r,_);if(!x||!w)return;const I=this._aroundCenter?null:x.add(w).div(2);return this._move([x,w],I,t)}touchend(t,r,l){if(!this._firstTwoTouches)return;const[u,_]=this._firstTwoTouches,x=Xr(l,r,u),w=Xr(l,r,_);x&&w||(this._active&&M.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Xr(f,t,r){for(let l=0;l<f.length;l++)if(f[l].identifier===r)return t[l]}function Oo(f,t){return Math.log(f/t)/Math.LN2}class gs extends ao{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const l=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Oo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Oo(this._distance,l),pinchAround:r}}}function at(f,t){return 180*f.angleWith(t)/Math.PI}class Fa extends ao{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r){const l=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:at(this._vector,l),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,l=at(t,this._startVector);return Math.abs(l)<r}}function Ls(f){return Math.abs(f.y)>Math.abs(f.x)}class tl extends ao{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,r,l){super.touchstart(t,r,l),this._currentTouchCount=l.length}_start(t){this._lastPoints=t,Ls(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,l){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const u=t[0].sub(this._lastPoints[0]),_=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,_,l.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(u.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(t,r,l){if(this._valid!==void 0)return this._valid;const u=t.mag()>=2,_=r.mag()>=2;if(!u&&!_)return;if(!u||!_)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const x=t.y>0==r.y>0;return Ls(t)&&Ls(r)&&x}}const zs={panStep:100,bearingStep:15,pitchStep:10};class Ys{constructor(t){this._tr=new Er(t);const r=zs;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,l=0,u=0,_=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?l=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?l=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?u=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?u=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(l=0,u=0),{cameraAnimation:w=>{const I=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:il,zoom:r?Math.round(I.zoom)+r*(t.shiftKey?2:1):I.zoom,bearing:I.bearing+l*this._bearingStep,pitch:I.pitch+u*this._pitchStep,offset:[-_*this._panStep,-x*this._panStep],center:I.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function il(f){return f*(2-f)}const Qs=4.000244140625;class Ra{constructor(t,r){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=t,this._tr=new Er(t),this._el=t.getCanvasContainer(),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const l=s.h.now(),u=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,r!==0&&r%Qs==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(u*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=M.mousePos(this._el,t),l=this._tr;this._around=s.L.convert(this._aroundCenter?l.center:l.unproject(r)),this._aroundPoint=l.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const w=this._type==="wheel"&&Math.abs(this._delta)>Qs?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&I!==0&&(I=1/I);const A=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(A*I))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,l=this._startZoom,u=this._easing;let _,x=!1;if(this._type==="wheel"&&l&&u){const w=Math.min((s.h.now()-this._lastWheelEventTime)/200,1),I=u(w);_=s.B.number(l,r,I),w<1?this._frameId||(this._frameId=!0):x=!0}else _=r,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:_-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=s.bb;if(this._prevEase){const l=this._prevEase,u=(s.h.now()-l.start)/l.duration,_=l.easing(u+.01)-l.easing(u),x=.27/Math.sqrt(_*_+1e-4)*.01,w=Math.sqrt(.0729-x*x);r=s.ba(x,w,.25,1)}return this._prevEase={start:s.h.now(),duration:t,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Yl{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ql{constructor(t){this._tr=new Er(t),this.reset()}reset(){this._active=!1}dblclick(t,r){return t.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $l{constructor(){this._tap=new Ks({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,r,l){if(!this._swipePoint)if(this._tapTime){const u=r[0],_=t.timeStamp-this._tapTime<500,x=this._tapPoint.dist(u)<30;_&&x?l.length>0&&(this._swipePoint=u,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(t,r,l)}touchmove(t,r,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const u=r[0],_=u.y-this._swipePoint.y;return this._swipePoint=u,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,r,l)}touchend(t,r,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const u=this._tap.touchend(t,r,l);u&&(this._tapTime=t.timeStamp,this._tapPoint=u)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ec{constructor(t,r,l){this._el=t,this._mousePan=r,this._touchPan=l}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Kr{constructor(t,r,l){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=r,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ds{constructor(t,r,l,u){this._el=t,this._touchZoom=r,this._touchRotate=l,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const nl=f=>f.zoom||f.drag||f.pitch||f.rotate;class tc extends s.k{}function rl(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class ic{constructor(t,r){this.handleWindowEvent=u=>{this.handleEvent(u,`${u.type}Window`)},this.handleEvent=(u,_)=>{if(u.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const x=u.type==="renderFrame"?void 0:u,w={needsRenderFrame:!1},I={},A={},L=u.touches,z=L?this._getMapTouches(L):void 0,N=z?M.touchPos(this._el,z):M.mousePos(this._el,u);for(const{handlerName:J,handler:G,allowed:de}of this._handlers){if(!G.isEnabled())continue;let Se;this._blockedByActive(A,de,J)?G.reset():G[_||u.type]&&(Se=G[_||u.type](u,N,z),this.mergeHandlerResult(w,I,Se,J,x),Se&&Se.needsRenderFrame&&this._triggerRenderFrame()),(Se||G.isActive())&&(A[J]=G)}const X={};for(const J in this._previousActiveHandlers)A[J]||(X[J]=x);this._previousActiveHandlers=A,(Object.keys(X).length||rl(w))&&(this._changes.push([w,I,X]),this._triggerRenderFrame()),(Object.keys(A).length||rl(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=w;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new kn(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,_,x]of this._listeners)M.addEventListener(u,_,u===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[t,r,l]of this._listeners)M.removeEventListener(t,r,t===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(t){const r=this._map,l=r.getCanvasContainer();this._add("mapEvent",new cr(r,t));const u=r.boxZoom=new Xs(r,t);this._add("boxZoom",u),t.interactive&&t.boxZoom&&u.enable();const _=new Fo(r),x=new Ql(r);r.doubleClickZoom=new Yl(x,_),this._add("tapZoom",_),this._add("clickZoom",x),t.interactive&&t.doubleClickZoom&&r.doubleClickZoom.enable();const w=new $l;this._add("tapDragZoom",w);const I=r.touchPitch=new tl(r);this._add("touchPitch",I),t.interactive&&t.touchPitch&&r.touchPitch.enable(t.touchPitch);const A=$o(t),L=Pn(t);r.dragRotate=new Kr(t,A,L),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]),t.interactive&&t.dragRotate&&r.dragRotate.enable();const z=(({enable:de,clickTolerance:Se})=>{const ie=new Vi({checkCorrectEvent:pe=>M.mouseButton(pe)===0&&!pe.ctrlKey});return new Ro({clickTolerance:Se,move:(pe,Ce)=>({around:Ce,panDelta:Ce.sub(pe)}),activateOnStart:!0,moveStateManager:ie,enable:de,assignEvents:so})})(t),N=new ft(t,r);r.dragPan=new ec(l,z,N),this._add("mousePan",z),this._add("touchPan",N,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&r.dragPan.enable(t.dragPan);const X=new Fa,H=new gs;r.touchZoomRotate=new Ds(l,H,X,w),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&r.touchZoomRotate.enable(t.touchZoomRotate);const J=r.scrollZoom=new Ra(r,()=>this._triggerRenderFrame());this._add("scrollZoom",J,["mousePan"]),t.interactive&&t.scrollZoom&&r.scrollZoom.enable(t.scrollZoom);const G=r.keyboard=new Ys(r);this._add("keyboard",G),t.interactive&&t.keyboard&&r.keyboard.enable(),this._add("blockableMapEvent",new Eo(r))}_add(t,r,l){this._handlers.push({handlerName:t,handler:r,allowed:l}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!nl(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,r,l){for(const u in t)if(u!==l&&(!r||r.indexOf(u)<0))return!0;return!1}_getMapTouches(t){const r=[];for(const l of t)this._el.contains(l.target)&&r.push(l);return r}mergeHandlerResult(t,r,l,u,_){if(!l)return;s.e(t,l);const x={handlerName:u,originalEvent:l.originalEvent||_};l.zoomDelta!==void 0&&(r.zoom=x),l.panDelta!==void 0&&(r.drag=x),l.pitchDelta!==void 0&&(r.pitch=x),l.bearingDelta!==void 0&&(r.rotate=x)}_applyChanges(){const t={},r={},l={};for(const[u,_,x]of this._changes)u.panDelta&&(t.panDelta=(t.panDelta||new s.P(0,0))._add(u.panDelta)),u.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+u.pitchDelta),u.around!==void 0&&(t.around=u.around),u.pinchAround!==void 0&&(t.pinchAround=u.pinchAround),u.noInertia&&(t.noInertia=u.noInertia),s.e(r,_),s.e(l,x);this._updateMapTransform(t,r,l),this._changes=[]}_updateMapTransform(t,r,l){const u=this._map,_=u._getTransformForUpdate(),x=u.terrain;if(!(rl(t)||x&&this._terrainMovement))return this._fireEvents(r,l,!0);let{panDelta:w,zoomDelta:I,bearingDelta:A,pitchDelta:L,around:z,pinchAround:N}=t;N!==void 0&&(z=N),u._stop(!0),z=z||u.transform.centerPoint;const X=_.pointLocation(w?z.sub(w):z);A&&(_.bearing+=A),L&&(_.pitch+=L),I&&(_.zoom+=I),x?this._terrainMovement||!r.drag&&!r.zoom?r.drag&&this._terrainMovement?_.center=_.pointLocation(_.centerPoint.sub(w)):_.setLocationAtPoint(X,z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,_.setLocationAtPoint(X,z),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,_.recalculateZoom(u.terrain)})):_.setLocationAtPoint(X,z),u._applyUpdatedTransform(_),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,l,!0)}_fireEvents(t,r,l){const u=nl(this._eventsInProgress),_=nl(t),x={};for(const L in t){const{originalEvent:z}=t[L];this._eventsInProgress[L]||(x[`${L}start`]=z),this._eventsInProgress[L]=t[L]}!u&&_&&this._fireEvent("movestart",_.originalEvent);for(const L in x)this._fireEvent(L,x[L]);_&&this._fireEvent("move",_.originalEvent);for(const L in t){const{originalEvent:z}=t[L];this._fireEvent(L,z)}const w={};let I;for(const L in this._eventsInProgress){const{handlerName:z,originalEvent:N}=this._eventsInProgress[L];this._handlersById[z].isActive()||(delete this._eventsInProgress[L],I=r[z]||N,w[`${L}end`]=I)}for(const L in w)this._fireEvent(L,w[L]);const A=nl(this._eventsInProgress);if(l&&(u||_)&&!A){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=N=>N!==0&&-this._bearingSnap<N&&N<this._bearingSnap;!L||!L.essential&&s.h.prefersReducedMotion?(this._map.fire(new s.k("moveend",{originalEvent:I})),z(this._map.getBearing())&&this._map.resetNorth()):(z(L.bearing||this._map.getBearing())&&(L.bearing=0),L.freezeElevation=!0,this._map.easeTo(L,{originalEvent:I})),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new s.k(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new tc("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Yc extends s.E{constructor(t,r){super(),this._renderFrameCallback=()=>{const l=Math.min((s.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new s.L(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}panBy(t,r,l){return t=s.P.convert(t).mult(-1),this.panTo(this.transform.center,s.e({offset:t},r),l)}panTo(t,r,l){return this.easeTo(s.e({center:t},r),l)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,l){return this.easeTo(s.e({zoom:t},r),l)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,l){return this.easeTo(s.e({bearing:t},r),l)}resetNorth(t,r){return this.rotateTo(0,s.e({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}cameraForBounds(t,r){t=Nt.convert(t);const l=r&&r.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),l,r)}_cameraForBoxAndBearing(t,r,l,u){const _={top:0,bottom:0,right:0,left:0};if(typeof(u=s.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const Ce=u.padding;u.padding={top:Ce,bottom:Ce,right:Ce,left:Ce}}u.padding=s.e(_,u.padding);const x=this.transform,w=x.padding,I=x.project(s.L.convert(t)),A=x.project(s.L.convert(r)),L=I.rotate(-l*Math.PI/180),z=A.rotate(-l*Math.PI/180),N=new s.P(Math.max(L.x,z.x),Math.max(L.y,z.y)),X=new s.P(Math.min(L.x,z.x),Math.min(L.y,z.y)),H=N.sub(X),J=(x.width-(w.left+w.right+u.padding.left+u.padding.right))/H.x,G=(x.height-(w.top+w.bottom+u.padding.top+u.padding.bottom))/H.y;if(G<0||J<0)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const de=Math.min(x.scaleZoom(x.scale*Math.min(J,G)),u.maxZoom),Se=s.P.convert(u.offset),ie=new s.P((u.padding.left-u.padding.right)/2,(u.padding.top-u.padding.bottom)/2).rotate(l*Math.PI/180),pe=Se.add(ie).mult(x.scale/x.zoomScale(de));return{center:x.unproject(I.add(A).div(2).sub(pe)),zoom:de,bearing:l}}fitBounds(t,r,l){return this._fitInternal(this.cameraForBounds(t,r),r,l)}fitScreenCoordinates(t,r,l,u,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.P.convert(t)),this.transform.pointLocation(s.P.convert(r)),l,u),u,_)}_fitInternal(t,r,l){return t?(delete(r=s.e(t,r)).padding,r.linear?this.easeTo(r,l):this.flyTo(r,l)):this}jumpTo(t,r){this.stop();const l=this._getTransformForUpdate();let u=!1,_=!1,x=!1;return"zoom"in t&&l.zoom!==+t.zoom&&(u=!0,l.zoom=+t.zoom),t.center!==void 0&&(l.center=s.L.convert(t.center)),"bearing"in t&&l.bearing!==+t.bearing&&(_=!0,l.bearing=+t.bearing),"pitch"in t&&l.pitch!==+t.pitch&&(x=!0,l.pitch=+t.pitch),t.padding==null||l.isPaddingEqual(t.padding)||(l.padding=t.padding),this._applyUpdatedTransform(l),this.fire(new s.k("movestart",r)).fire(new s.k("move",r)),u&&this.fire(new s.k("zoomstart",r)).fire(new s.k("zoom",r)).fire(new s.k("zoomend",r)),_&&this.fire(new s.k("rotatestart",r)).fire(new s.k("rotate",r)).fire(new s.k("rotateend",r)),x&&this.fire(new s.k("pitchstart",r)).fire(new s.k("pitch",r)).fire(new s.k("pitchend",r)),this.fire(new s.k("moveend",r))}calculateCameraOptionsFromTo(t,r,l,u=0){const _=s.U.fromLngLat(t,r),x=s.U.fromLngLat(l,u),w=x.x-_.x,I=x.y-_.y,A=x.z-_.z,L=Math.hypot(w,I,A);if(L===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(w,I),N=this.transform.scaleZoom(this.transform.cameraToCenterDistance/L/this.transform.tileSize),X=180*Math.atan2(w,-I)/Math.PI;let H=180*Math.acos(z/L)/Math.PI;return H=A<0?90-H:90+H,{center:x.toLngLat(),zoom:N,pitch:H,bearing:X}}easeTo(t,r){this._stop(!1,t.easeId),((t=s.e({offset:[0,0],duration:500,easing:s.bb},t)).animate===!1||!t.essential&&s.h.prefersReducedMotion)&&(t.duration=0);const l=this._getTransformForUpdate(),u=this.getZoom(),_=this.getBearing(),x=this.getPitch(),w=this.getPadding(),I="zoom"in t?+t.zoom:u,A="bearing"in t?this._normalizeBearing(t.bearing,_):_,L="pitch"in t?+t.pitch:x,z="padding"in t?t.padding:l.padding,N=s.P.convert(t.offset);let X=l.centerPoint.add(N);const H=l.pointLocation(X),J=s.L.convert(t.center||H);this._normalizeCenter(J);const G=l.project(H),de=l.project(J).sub(G),Se=l.zoomScale(I-u);let ie,pe;t.around&&(ie=s.L.convert(t.around),pe=l.locationPoint(ie));const Ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||I!==u,this._rotating=this._rotating||_!==A,this._pitching=this._pitching||L!==x,this._padding=!l.isPaddingEqual(z),this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,Ce),this.terrain&&this._prepareElevation(J),this._ease(ke=>{if(this._zooming&&(l.zoom=s.B.number(u,I,ke)),this._rotating&&(l.bearing=s.B.number(_,A,ke)),this._pitching&&(l.pitch=s.B.number(x,L,ke)),this._padding&&(l.interpolatePadding(w,z,ke),X=l.centerPoint.add(N)),this.terrain&&!t.freezeElevation&&this._updateElevation(ke),ie)l.setLocationAtPoint(ie,pe);else{const Be=l.zoomScale(l.zoom-u),We=I>u?Math.min(2,Se):Math.max(.5,Se),je=Math.pow(We,1-ke),et=l.unproject(G.add(de.mult(ke*je)).mult(Be));l.setLocationAtPoint(l.renderWorldCopies?et.wrap():et,X)}this._applyUpdatedTransform(l),this._fireMoveEvents(r)},ke=>{this.terrain&&this._finalizeElevation(),this._afterEase(r,ke)},t),this}_prepareEase(t,r,l={}){this._moving=!0,r||l.moving||this.fire(new s.k("movestart",t)),this._zooming&&!l.zooming&&this.fire(new s.k("zoomstart",t)),this._rotating&&!l.rotating&&this.fire(new s.k("rotatestart",t)),this._pitching&&!l.pitching&&this.fire(new s.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&r!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(l-(r-(l*t+this._elevationStart))/(1-t)),this._elevationTarget=r}this.transform.elevation=s.B.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const r=t.clone(),{center:l,zoom:u,pitch:_,bearing:x,elevation:w}=this.transformCameraUpdate(r);l&&(r.center=l),u!==void 0&&(r.zoom=u),_!==void 0&&(r.pitch=_),x!==void 0&&(r.bearing=x),w!==void 0&&(r.elevation=w),this.transform.apply(r)}_fireMoveEvents(t){this.fire(new s.k("move",t)),this._zooming&&this.fire(new s.k("zoom",t)),this._rotating&&this.fire(new s.k("rotate",t)),this._pitching&&this.fire(new s.k("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const l=this._zooming,u=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new s.k("zoomend",t)),u&&this.fire(new s.k("rotateend",t)),_&&this.fire(new s.k("pitchend",t)),this.fire(new s.k("moveend",t))}flyTo(t,r){if(!t.essential&&s.h.prefersReducedMotion){const Mt=s.F(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Mt,r)}this.stop(),t=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.bb},t);const l=this._getTransformForUpdate(),u=this.getZoom(),_=this.getBearing(),x=this.getPitch(),w=this.getPadding(),I="zoom"in t?s.ad(+t.zoom,l.minZoom,l.maxZoom):u,A="bearing"in t?this._normalizeBearing(t.bearing,_):_,L="pitch"in t?+t.pitch:x,z="padding"in t?t.padding:l.padding,N=l.zoomScale(I-u),X=s.P.convert(t.offset);let H=l.centerPoint.add(X);const J=l.pointLocation(H),G=s.L.convert(t.center||J);this._normalizeCenter(G);const de=l.project(J),Se=l.project(G).sub(de);let ie=t.curve;const pe=Math.max(l.width,l.height),Ce=pe/N,ke=Se.mag();if("minZoom"in t){const Mt=s.ad(Math.min(t.minZoom,u,I),l.minZoom,l.maxZoom),Ki=pe/l.zoomScale(Mt-u);ie=Math.sqrt(Ki/ke*2)}const Be=ie*ie;function We(Mt){const Ki=(Ce*Ce-pe*pe+(Mt?-1:1)*Be*Be*ke*ke)/(2*(Mt?Ce:pe)*Be*ke);return Math.log(Math.sqrt(Ki*Ki+1)-Ki)}function je(Mt){return(Math.exp(Mt)-Math.exp(-Mt))/2}function et(Mt){return(Math.exp(Mt)+Math.exp(-Mt))/2}const It=We(!1);let yi=function(Mt){return et(It)/et(It+ie*Mt)},dt=function(Mt){return pe*((et(It)*(je(Ki=It+ie*Mt)/et(Ki))-je(It))/Be)/ke;var Ki},Xt=(We(!0)-It)/ie;if(Math.abs(ke)<1e-6||!isFinite(Xt)){if(Math.abs(pe-Ce)<1e-6)return this.easeTo(t,r);const Mt=Ce<pe?-1:1;Xt=Math.abs(Math.log(Ce/pe))/ie,dt=function(){return 0},yi=function(Ki){return Math.exp(Mt*ie*Ki)}}return t.duration="duration"in t?+t.duration:1e3*Xt/("screenSpeed"in t?+t.screenSpeed/ie:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=_!==A,this._pitching=L!==x,this._padding=!l.isPaddingEqual(z),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(G),this._ease(Mt=>{const Ki=Mt*Xt,mi=1/yi(Ki);l.zoom=Mt===1?I:u+l.scaleZoom(mi),this._rotating&&(l.bearing=s.B.number(_,A,Mt)),this._pitching&&(l.pitch=s.B.number(x,L,Mt)),this._padding&&(l.interpolatePadding(w,z,Mt),H=l.centerPoint.add(X)),this.terrain&&!t.freezeElevation&&this._updateElevation(Mt);const ai=Mt===1?G:l.unproject(de.add(Se.mult(dt(Ki))).mult(mi));l.setLocationAtPoint(l.renderWorldCopies?ai.wrap():ai,H),this._applyUpdatedTransform(l),this._fireMoveEvents(r)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(r)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,r){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const l=this._onEaseEnd;delete this._onEaseEnd,l.call(this,r)}if(!t){const l=this.handlers;l&&l.stop(!1)}return this}_ease(t,r,l){l.animate===!1||l.duration===0?(t(1),r()):(this._easeStart=s.h.now(),this._easeOptions=l,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,r){t=s.b5(t,-180,180);const l=Math.abs(t-r);return Math.abs(t-360-r)<l&&(t-=360),Math.abs(t+360-r)<l&&(t+=360),t}_normalizeCenter(t){const r=this.transform;if(!r.renderWorldCopies||r.lngRange)return;const l=t.lng-r.center.lng;t.lng+=l>180?-360:l<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(s.L.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}class lo{constructor(t={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=M.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=M.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=M.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){M.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,r){const l=this._map._getUIString(`AttributionControl.${r}`);t.title=l,t.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(u=>typeof u!="string"?"":u)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const r=this._map.style.sourceCaches;for(const u in r){const _=r[u];if(_.used||_.usedForTerrain){const x=_.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t=t.filter(u=>String(u).trim()),t.sort((u,_)=>u.length-_.length),t=t.filter((u,_)=>{for(let x=_+1;x<t.length;x++)if(t[x].indexOf(u)>=0)return!1;return!0});const l=t.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,t.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class pn{constructor(t={}){this._updateCompact=()=>{const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=M.create("div","maplibregl-ctrl");const r=M.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){M.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Il{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,l=r?this._queue.concat(r):this._queue;for(const u of l)if(u.id===t)return void(u.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const l of r)if(!l.cancelled&&(l.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const nc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Qc=s.Q([{name:"a_pos3d",type:"Int16",components:3}]);class $c extends s.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,r){this.sourceCache.update(t,r),this._renderableTilesKeys=[];const l={};for(const u of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r}))l[u.key]=!0,this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.posMatrix=new Float64Array(16),s.aS(u.posMatrix,0,s.N,0,s.N,0,1),this._tiles[u.key]=new fr(u,this.tileSize));for(const u in this._tiles)l[u]||delete this._tiles[u]}freeRtt(t){for(const r in this._tiles){const l=this._tiles[r];(!t||l.tileID.equals(t)||l.tileID.isChildOf(t)||t.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const r={};for(const l of this._renderableTilesKeys){const u=this._tiles[l].tileID;if(u.canonical.equals(t.canonical)){const _=t.clone();_.posMatrix=new Float64Array(16),s.aS(_.posMatrix,0,s.N,0,s.N,0,1),r[l]=_}else if(u.canonical.isChildOf(t.canonical)){const _=t.clone();_.posMatrix=new Float64Array(16);const x=u.canonical.z-t.canonical.z,w=u.canonical.x-(u.canonical.x>>x<<x),I=u.canonical.y-(u.canonical.y>>x<<x),A=s.N>>x;s.aS(_.posMatrix,0,A,0,A,0,1),s.$(_.posMatrix,_.posMatrix,[-w*A,-I*A,0]),r[l]=_}else if(t.canonical.isChildOf(u.canonical)){const _=t.clone();_.posMatrix=new Float64Array(16);const x=t.canonical.z-u.canonical.z,w=t.canonical.x-(t.canonical.x>>x<<x),I=t.canonical.y-(t.canonical.y>>x<<x),A=s.N>>x;s.aS(_.posMatrix,0,s.N,0,s.N,0,1),s.$(_.posMatrix,_.posMatrix,[w*A,I*A,0]),s.a0(_.posMatrix,_.posMatrix,[1/2**x,1/2**x,0]),r[l]=_}}return r}getSourceTile(t,r){const l=this.sourceCache._source;let u=t.overscaledZ-this.deltaZoom;if(u>l.maxzoom&&(u=l.maxzoom),u<l.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(u).key);let _=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!_||!_.dem)&&r)for(;u>=l.minzoom&&(!_||!_.dem);)_=this.sourceCache.getTileByID(t.scaledTo(u--).key);return _}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(r=>r.timeAdded>=t)}}class eu{constructor(t,r,l){this.painter=t,this.sourceCache=new $c(r),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,r,l,u=s.N){var _;if(!(r>=0&&r<u&&l>=0&&l<u))return 0;const x=this.getTerrainData(t),w=(_=x.tile)===null||_===void 0?void 0:_.dem;if(!w)return 0;const I=function(H,J,G){var de=J[0],Se=J[1];return H[0]=G[0]*de+G[4]*Se+G[12],H[1]=G[1]*de+G[5]*Se+G[13],H}([],[r/u*s.N,l/u*s.N],x.u_terrain_matrix),A=[I[0]*w.dim,I[1]*w.dim],L=Math.floor(A[0]),z=Math.floor(A[1]),N=A[0]-L,X=A[1]-z;return w.get(L,z)*(1-N)*(1-X)+w.get(L+1,z)*N*(1-X)+w.get(L,z+1)*(1-N)*X+w.get(L+1,z+1)*N*X}getElevationForLngLatZoom(t,r){const{tileID:l,mercatorX:u,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(t,r);return this.getElevation(l,u%s.N,_%s.N,s.N)}getElevation(t,r,l,u=s.N){return this.getDEMElevation(t,r,l,u)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const u=this.painter.context,_=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new qt(u,_,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new qt(u,new s.R({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.ao([])}const r=this.sourceCache.getSourceTile(t,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const u=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new qt(u,r.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),r.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const l=r&&r+r.tileID.key+t.key;if(l&&!this._demMatrixCache[l]){const u=this.sourceCache.sourceCache._source.maxzoom;let _=t.canonical.z-r.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=u?_=t.canonical.z-u:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=t.canonical.x-(t.canonical.x>>_<<_),w=t.canonical.y-(t.canonical.y>>_<<_),I=s.bc(new Float64Array(16),[1/(s.N<<_),1/(s.N<<_),0]);s.$(I,I,[x*s.N,w*s.N,0]),this._demMatrixCache[t.key]={matrix:I,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(t){const r=this.painter,l=r.width/devicePixelRatio,u=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new qt(r.context,{width:l,height:u,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new qt(r.context,{width:l,height:u,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(l,u,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,l,u))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,x=0;_<this._coordsTextureSize;_++)for(let w=0;w<this._coordsTextureSize;w++,x+=4)r[x+0]=255&w,r[x+1]=255&_,r[x+2]=w>>8<<4|_>>8,r[x+3]=0;const l=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),u=new qt(t,l,t.gl.RGBA,{premultiply:!1});return u.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(t){const r=new Uint8Array(4),l=this.painter.context,u=l.gl;l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),u.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,r),l.bindFramebuffer.set(null);const _=r[0]+(r[2]>>4<<8),x=r[1]+((15&r[2])<<8),w=this.coordsIndex[255-r[3]],I=w&&this.sourceCache.getTileByID(w);if(!I)return null;const A=this._coordsTextureSize,L=(1<<I.tileID.canonical.z)*A;return new s.U(this._allowMercatorOverflow(t,(I.tileID.canonical.x*A+_)/L),(I.tileID.canonical.y*A+x)/L,this.getElevation(I.tileID,_,x,A))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,r=new s.bd,l=new s.b0,u=this.meshSize,_=s.N/u,x=u*u;for(let z=0;z<=u;z++)for(let N=0;N<=u;N++)r.emplaceBack(N*_,z*_,0);for(let z=0;z<x;z+=u+1)for(let N=0;N<u;N++)l.emplaceBack(N+z,u+N+z+1,u+N+z+2),l.emplaceBack(N+z,u+N+z+2,N+z+1);const w=r.length,I=w+2*(u+1);for(const z of[0,1])for(let N=0;N<=u;N++)for(const X of[0,1])r.emplaceBack(N*_,z*s.N,X);for(let z=0;z<2*u;z+=2)l.emplaceBack(I+z,I+z+1,I+z+3),l.emplaceBack(I+z,I+z+3,I+z+2),l.emplaceBack(w+z,w+z+3,w+z+1),l.emplaceBack(w+z,w+z+2,w+z+3);const A=r.length,L=A+2*(u+1);for(const z of[0,1])for(let N=0;N<=u;N++)for(const X of[0,1])r.emplaceBack(z*s.N,N*_,X);for(let z=0;z<2*u;z+=2)l.emplaceBack(A+z,A+z+1,A+z+3),l.emplaceBack(A+z,A+z+3,A+z+2),l.emplaceBack(L+z,L+z+3,L+z+1),l.emplaceBack(L+z,L+z+2,L+z+3);return this._mesh={indexBuffer:t.createIndexBuffer(l),vertexBuffer:t.createVertexBuffer(r,Qc.members),segments:s.S.simpleSegment(0,0,r.length,l.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*s.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,r){var l;const{tileID:u}=this._getOverscaledTileIDFromLngLatZoom(t,r);return(l=this.getMinMaxElevation(u).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(t){const r=this.getTerrainData(t).tile,l={minElevation:null,maxElevation:null};return r&&r.dem&&(l.minElevation=r.dem.min*this.exaggeration,l.maxElevation=r.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(t,r){const l=s.U.fromLngLat(t.wrap()),u=(1<<r)*s.N,_=l.x*u,x=l.y*u,w=Math.floor(_/s.N),I=Math.floor(x/s.N);return{tileID:new s.O(r,0,r,w,I),mercatorX:_,mercatorY:x}}_allowMercatorOverflow(t,r){const l=t.x<this.painter.width/2;let u=s.bf(r);const _=this.painter.transform.center.lng;return l&&Math.sign(u)>0&&Math.sign(_)<0||!l&&Math.sign(u)<0&&Math.sign(_)>0?(u=360*Math.sign(_)+u,s.G(u)):r}}class Nu{constructor(t,r,l){this._context=t,this._size=r,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new qt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(l.texture),{id:t,fbo:r,texture:l,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(r=>t.id!==r),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Or={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Cl{constructor(t,r){this.painter=t,this.terrain=r,this.pool=new Nu(t.context,30,r.sourceCache.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(l=>!t._layers[l].isHidden(r)),this._coordsDescendingInv={};for(const l in t.sourceCaches){this._coordsDescendingInv[l]={};const u=t.sourceCaches[l].getVisibleCoordinates();for(const _ of u){const x=this.terrain.sourceCache.getTerrainCoords(_);for(const w in x)this._coordsDescendingInv[l][w]||(this._coordsDescendingInv[l][w]=[]),this._coordsDescendingInv[l][w].push(x[w])}}this._coordsDescendingInvStr={};for(const l of t._order){const u=t._layers[l],_=u.source;if(Or[u.type]&&!this._coordsDescendingInvStr[_]){this._coordsDescendingInvStr[_]={};for(const x in this._coordsDescendingInv[_])this._coordsDescendingInvStr[_][x]=this._coordsDescendingInv[_][x].map(w=>w.key).sort().join()}}for(const l of this._renderableTiles)for(const u in this._coordsDescendingInvStr){const _=this._coordsDescendingInvStr[u][l.tileID.key];_&&_!==l.rttCoords[u]&&(l.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const r=t.type,l=this.painter,u=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Or[r]&&(this._prevType&&Or[this._prevType]||this._stacks.push([]),this._prevType=r,this._stacks[this._stacks.length-1].push(t.id),!u))return!0;if(Or[this._prevType]||Or[r]&&u){this._prevType=r;const _=this._stacks.length-1,x=this._stacks[_]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(dn(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[_]){const A=this.pool.getObjectForId(w.rtt[_].id);if(A.stamp===w.rtt[_].stamp){this.pool.useObject(A);continue}}const I=this.pool.getOrCreateFreeObject();this.pool.useObject(I),this.pool.stampObject(I),w.rtt[_]={id:I.id,stamp:I.stamp},l.context.bindFramebuffer.set(I.fbo.framebuffer),l.context.clear({color:s.aT.transparent,stencil:0}),l.currentStencilSource=void 0;for(let A=0;A<x.length;A++){const L=l.style._layers[x[A]],z=L.source?this._coordsDescendingInv[L.source][w.tileID.key]:[w.tileID];l.context.viewport.set([0,0,I.fbo.width,I.fbo.height]),l._renderTileClippingMasks(L,z),l.renderLayer(l,l.style.sourceCaches[L.source],L,z),L.source&&(w.rttCoords[L.source]=this._coordsDescendingInvStr[L.source][w.tileID.key])}}return dn(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Or[r]}return!1}}const Ot=D,Ht={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},ol=f=>{f.touchstart=f.dragStart,f.touchmoveWindow=f.dragMove,f.touchend=f.dragEnd},rc={showCompass:!0,showZoom:!0,visualizePitch:!1};class oc{constructor(t,r,l=!1){this.mousedown=x=>{this.startMouse(s.e({},x,{ctrlKey:!0,preventDefault:()=>x.preventDefault()}),M.mousePos(this.element,x)),M.addEventListener(window,"mousemove",this.mousemove),M.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=x=>{this.moveMouse(x,M.mousePos(this.element,x))},this.mouseup=x=>{this.mouseRotate.dragEnd(x),this.mousePitch&&this.mousePitch.dragEnd(x),this.offTemp()},this.touchstart=x=>{x.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=M.touchPos(this.element,x.targetTouches)[0],this.startTouch(x,this._startPos),M.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),M.addEventListener(window,"touchend",this.touchend))},this.touchmove=x=>{x.targetTouches.length!==1?this.reset():(this._lastPos=M.touchPos(this.element,x.targetTouches)[0],this.moveTouch(x,this._lastPos))},this.touchend=x=>{x.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const u=t.dragRotate._mouseRotate.getClickTolerance(),_=t.dragRotate._mousePitch.getClickTolerance();this.element=r,this.mouseRotate=$o({clickTolerance:u,enable:!0}),this.touchRotate=(({enable:x,clickTolerance:w,bearingDegreesPerPixelMoved:I=.8})=>{const A=new Js;return new Ro({clickTolerance:w,move:(L,z)=>({bearingDelta:(z.x-L.x)*I}),moveStateManager:A,enable:x,assignEvents:ol})})({clickTolerance:u,enable:!0}),this.map=t,l&&(this.mousePitch=Pn({clickTolerance:_,enable:!0}),this.touchPitch=(({enable:x,clickTolerance:w,pitchDegreesPerPixelMoved:I=-.5})=>{const A=new Js;return new Ro({clickTolerance:w,move:(L,z)=>({pitchDelta:(z.y-L.y)*I}),moveStateManager:A,enable:x,assignEvents:ol})})({clickTolerance:_,enable:!0})),M.addEventListener(r,"mousedown",this.mousedown),M.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),M.addEventListener(r,"touchcancel",this.reset)}startMouse(t,r){this.mouseRotate.dragStart(t,r),this.mousePitch&&this.mousePitch.dragStart(t,r),M.disableDrag()}startTouch(t,r){this.touchRotate.dragStart(t,r),this.touchPitch&&this.touchPitch.dragStart(t,r),M.disableDrag()}moveMouse(t,r){const l=this.map,{bearingDelta:u}=this.mouseRotate.dragMove(t,r)||{};if(u&&l.setBearing(l.getBearing()+u),this.mousePitch){const{pitchDelta:_}=this.mousePitch.dragMove(t,r)||{};_&&l.setPitch(l.getPitch()+_)}}moveTouch(t,r){const l=this.map,{bearingDelta:u}=this.touchRotate.dragMove(t,r)||{};if(u&&l.setBearing(l.getBearing()+u),this.touchPitch){const{pitchDelta:_}=this.touchPitch.dragMove(t,r)||{};_&&l.setPitch(l.getPitch()+_)}}off(){const t=this.element;M.removeEventListener(t,"mousedown",this.mousedown),M.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),M.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),M.removeEventListener(window,"touchend",this.touchend),M.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){M.enableDrag(),M.removeEventListener(window,"mousemove",this.mousemove),M.removeEventListener(window,"mouseup",this.mouseup),M.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),M.removeEventListener(window,"touchend",this.touchend)}}let Vn;function sc(f,t,r){if(f=new s.L(f.lng,f.lat),t){const l=new s.L(f.lng-360,f.lat),u=new s.L(f.lng+360,f.lat),_=r.locationPoint(f).distSqr(t);r.locationPoint(l).distSqr(t)<_?f=l:r.locationPoint(u).distSqr(t)<_&&(f=u)}for(;Math.abs(f.lng-r.center.lng)>180;){const l=r.locationPoint(f);if(l.x>=0&&l.y>=0&&l.x<=r.width&&l.y<=r.height)break;f.lng>r.center.lng?f.lng-=360:f.lng+=360}return f}const Mo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function tu(f,t,r){const l=f.classList;for(const u in Mo)l.remove(`maplibregl-${r}-anchor-${u}`);l.add(`maplibregl-${r}-anchor-${t}`)}class $s extends s.E{constructor(t){if(super(),this._onKeyPress=r=>{const l=r.code,u=r.charCode||r.keyCode;l!=="Space"&&l!=="Enter"&&u!==32&&u!==13||this.togglePopup()},this._onMapClick=r=>{const l=r.originalEvent.target,u=this._element;this._popup&&(l===u||u.contains(l))&&this.togglePopup()},this._update=r=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();((r==null?void 0:r.type)==="terrain"||(r==null?void 0:r.type)==="render"&&!l)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=sc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let u="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?u=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(u=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_=`rotateX(${this._map.getPitch()}deg)`),r&&r.type!=="moveend"||(this._pos=this._pos.round()),M.setTransform(this._element,`${Mo[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${_} ${u}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const x=this._map.unproject(this._pos),w=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=x.distanceTo(this._lngLat)>20*w?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=r=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.k("dragstart"))),this.fire(new s.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.k("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=s.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=M.create("div"),this._element.setAttribute("aria-label","Map marker");const r=M.createNS("http://www.w3.org/2000/svg","svg"),l=41,u=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${l}px`),r.setAttributeNS(null,"width",`${u}px`),r.setAttributeNS(null,"viewBox",`0 0 ${u} ${l}`);const _=M.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const x=M.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");const w=M.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const I=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const de of I){const Se=M.createNS("http://www.w3.org/2000/svg","ellipse");Se.setAttributeNS(null,"opacity","0.04"),Se.setAttributeNS(null,"cx","10.5"),Se.setAttributeNS(null,"cy","5.80029008"),Se.setAttributeNS(null,"rx",de.rx),Se.setAttributeNS(null,"ry",de.ry),w.appendChild(Se)}const A=M.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const L=M.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(L);const z=M.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const N=M.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(N);const X=M.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(6.0, 7.0)"),X.setAttributeNS(null,"fill","#FFFFFF");const H=M.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(8.0, 8.0)");const J=M.createNS("http://www.w3.org/2000/svg","circle");J.setAttributeNS(null,"fill","#000000"),J.setAttributeNS(null,"opacity","0.25"),J.setAttributeNS(null,"cx","5.5"),J.setAttributeNS(null,"cy","5.5"),J.setAttributeNS(null,"r","5.4999962");const G=M.createNS("http://www.w3.org/2000/svg","circle");G.setAttributeNS(null,"fill","#FFFFFF"),G.setAttributeNS(null,"cx","5.5"),G.setAttributeNS(null,"cy","5.5"),G.setAttributeNS(null,"r","5.4999962"),H.appendChild(J),H.appendChild(G),x.appendChild(w),x.appendChild(A),x.appendChild(z),x.appendChild(X),x.appendChild(H),r.appendChild(x),r.setAttributeNS(null,"height",l*this._scale+"px"),r.setAttributeNS(null,"width",u*this._scale+"px"),this._element.appendChild(r),this._offset=s.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",r=>{r.preventDefault()}),this._element.addEventListener("mousedown",r=>{r.preventDefault()}),tu(this._element,this._anchor,"marker"),t&&t.className)for(const r of t.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),M.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.L.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const u=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(t){return this._offset=s.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const En={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Tn=0,Oa=!1;const sl={maxWidth:100,unit:"metric"};function al(f,t,r){const l=r&&r.maxWidth||100,u=f._container.clientHeight/2,_=f.unproject([0,u]),x=f.unproject([l,u]),w=_.distanceTo(x);if(r&&r.unit==="imperial"){const I=3.2808*w;I>5280?ea(t,l,I/5280,f._getUIString("ScaleControl.Miles")):ea(t,l,I,f._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?ea(t,l,w/1852,f._getUIString("ScaleControl.NauticalMiles")):w>=1e3?ea(t,l,w/1e3,f._getUIString("ScaleControl.Kilometers")):ea(t,l,w,f._getUIString("ScaleControl.Meters"))}function ea(f,t,r,l){const u=function(_){const x=Math.pow(10,`${Math.floor(_)}`.length-1);let w=_/x;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(I){const A=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*A)/A}(w),x*w}(r);f.style.width=t*(u/r)+"px",f.innerHTML=`${u}&nbsp;${l}`}const ac={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},lc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ba(f){if(f){if(typeof f=="number"){const t=Math.round(Math.abs(f)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,f),"top-left":new s.P(t,t),"top-right":new s.P(-t,t),bottom:new s.P(0,-f),"bottom-left":new s.P(t,-t),"bottom-right":new s.P(-t,-t),left:new s.P(f,0),right:new s.P(-f,0)}}if(f instanceof s.P||Array.isArray(f)){const t=s.P.convert(f);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:s.P.convert(f.center||[0,0]),top:s.P.convert(f.top||[0,0]),"top-left":s.P.convert(f["top-left"]||[0,0]),"top-right":s.P.convert(f["top-right"]||[0,0]),bottom:s.P.convert(f.bottom||[0,0]),"bottom-left":s.P.convert(f["bottom-left"]||[0,0]),"bottom-right":s.P.convert(f["bottom-right"]||[0,0]),left:s.P.convert(f.left||[0,0]),right:s.P.convert(f.right||[0,0])}}return Ba(new s.P(0,0))}const cc={extend:(f,...t)=>s.e(f,...t),run(f){f()},logToElement(f,t=!1,r="log"){const l=window.document.getElementById(r);l&&(t&&(l.innerHTML=""),l.innerHTML+=`<br>${f}`)}},uc=D;class Ui{static get version(){return uc}static get workerCount(){return wr.workerCount}static set workerCount(t){wr.workerCount=t}static get maxParallelImageRequests(){return s.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(t){s.c.MAX_PARALLEL_IMAGE_REQUESTS=t}static get workerUrl(){return s.c.WORKER_URL}static set workerUrl(t){s.c.WORKER_URL=t}static addProtocol(t,r){s.c.REGISTERED_PROTOCOLS[t]=r}static removeProtocol(t){delete s.c.REGISTERED_PROTOCOLS[t]}}return Ui.Map=class extends Yc{constructor(f){if(s.bg.mark(s.bh.create),(f=s.e({},Ht,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Da(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),{bearingSnap:f.bearingSnap}),this._cooperativeGesturesOnWheel=t=>{this._onCooperativeGesture(t,t[this._metaKey],1)},this._contextLost=t=>{t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=f.interactive,this._cooperativeGestures=f.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=f.maxTileCacheSize,this._maxTileCacheZoomLevels=f.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._renderTaskQueue=new Il,this._controls=[],this._mapId=s.a2(),this._locale=s.e({},nc,f.locale),this._clickTolerance=f.clickTolerance,this._overridePixelRatio=f.pixelRatio,this._maxCanvasSize=f.maxCanvasSize,this.transformCameraUpdate=f.transformCameraUpdate,this._imageQueueHandle=me.addThrottleControl(()=>this.isMoving()),this._requestManager=new De(f.transformRequest),typeof f.container=="string"){if(this._container=document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(f.maxBounds&&this.setMaxBounds(f.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const r=ge(l=>{this._trackResize&&!this._removed&&this.resize(l)._update()},50);this._resizeObserver=new ResizeObserver(l=>{t?r(l):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new ic(this,f),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=f.hash&&new Ae(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,s.e({},f.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=f.localIdeographFontFamily,this._validateStyle=f.validateStyle,f.style&&this.setStyle(f.style,{localIdeographFontFamily:f.localIdeographFontFamily}),f.attributionControl&&this.addControl(new lo({customAttribution:f.customAttribution})),f.maplibreLogo&&this.addControl(new pn,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new s.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new s.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new s.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(f,t){if(t===void 0&&(t=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new s.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=f.onAdd(this);this._controls.push(f);const l=this._controlPositions[t];return t.indexOf("bottom")!==-1?l.insertBefore(r,l.firstChild):l.appendChild(r),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new s.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(f);return t>-1&&this._controls.splice(t,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}calculateCameraOptionsFromTo(f,t,r,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(f,t,r,l)}resize(f){var t;const r=this._containerDimensions(),l=r[0],u=r[1],_=this._getClampedPixelRatio(l,u);if(this._resizeCanvas(l,u,_),this.painter.resize(l,u,_),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const I=this._getClampedPixelRatio(l,u);this._resizeCanvas(l,u,I),this.painter.resize(l,u,I)}this.transform.resize(l,u),(t=this._requestedCameraState)===null||t===void 0||t.resize(l,u);const x=!this._moving;return x&&(this.stop(),this.fire(new s.k("movestart",f)).fire(new s.k("move",f))),this.fire(new s.k("resize",f)),x&&this.fire(new s.k("moveend",f)),this}_getClampedPixelRatio(f,t){const{0:r,1:l}=this._maxCanvasSize,u=this.getPixelRatio(),_=f*u,x=t*u;return Math.min(_>r?r/_:1,x>l?l/x:1)*u}getPixelRatio(){var f;return(f=this._overridePixelRatio)!==null&&f!==void 0?f:devicePixelRatio}setPixelRatio(f){this._overridePixelRatio=f,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(Nt.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(f){return this._cooperativeGestures=f,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(f){return this.transform.locationPoint(s.L.convert(f),this.style&&this.terrain)}unproject(f){return this.transform.pointLocation(s.P.convert(f),this.terrain)}isMoving(){var f;return this._moving||((f=this.handlers)===null||f===void 0?void 0:f.isMoving())}isZooming(){var f;return this._zooming||((f=this.handlers)===null||f===void 0?void 0:f.isZooming())}isRotating(){var f;return this._rotating||((f=this.handlers)===null||f===void 0?void 0:f.isRotating())}_createDelegatedListener(f,t,r){if(f==="mouseenter"||f==="mouseover"){let l=!1;return{layer:t,listener:r,delegates:{mousemove:_=>{const x=this.getLayer(t)?this.queryRenderedFeatures(_.point,{layers:[t]}):[];x.length?l||(l=!0,r.call(this,new Ni(f,this,_.originalEvent,{features:x}))):l=!1},mouseout:()=>{l=!1}}}}if(f==="mouseleave"||f==="mouseout"){let l=!1;return{layer:t,listener:r,delegates:{mousemove:x=>{(this.getLayer(t)?this.queryRenderedFeatures(x.point,{layers:[t]}):[]).length?l=!0:l&&(l=!1,r.call(this,new Ni(f,this,x.originalEvent)))},mouseout:x=>{l&&(l=!1,r.call(this,new Ni(f,this,x.originalEvent)))}}}}{const l=u=>{const _=this.getLayer(t)?this.queryRenderedFeatures(u.point,{layers:[t]}):[];_.length&&(u.features=_,r.call(this,u),delete u.features)};return{layer:t,listener:r,delegates:{[f]:l}}}}on(f,t,r){if(r===void 0)return super.on(f,t);const l=this._createDelegatedListener(f,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(l);for(const u in l.delegates)this.on(u,l.delegates[u]);return this}once(f,t,r){if(r===void 0)return super.once(f,t);const l=this._createDelegatedListener(f,t,r);for(const u in l.delegates)this.once(u,l.delegates[u]);return this}off(f,t,r){return r===void 0?super.off(f,t):(this._delegatedListeners&&this._delegatedListeners[f]&&(l=>{const u=this._delegatedListeners[f];for(let _=0;_<u.length;_++){const x=u[_];if(x.layer===t&&x.listener===r){for(const w in x.delegates)this.off(w,x.delegates[w]);return u.splice(_,1),this}}})(),this)}queryRenderedFeatures(f,t){if(!this.style)return[];let r;const l=f instanceof s.P||Array.isArray(f),u=l?f:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(l?{}:f)||{},u instanceof s.P||typeof u[0]=="number")r=[s.P.convert(u)];else{const _=s.P.convert(u[0]),x=s.P.convert(u[1]);r=[_,new s.P(x.x,_.y),x,new s.P(_.x,x.y),_]}return this.style.queryRenderedFeatures(r,t,this.transform)}querySourceFeatures(f,t){return this.style.querySourceFeatures(f,t)}setStyle(f,t){return(t=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(f,t))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){const t=this._locale[f];if(t==null)throw new Error(`Missing UI string '${f}'`);return t}_updateStyle(f,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(f,t));const r=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!f)),f?(this.style=new Wn(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f,t,r):this.style.loadJSON(f,t,r),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Wn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,t){if(typeof f=="string"){const r=this._requestManager.transformRequest(f,Te.Style);s.f(r,(l,u)=>{l?this.fire(new s.j(l)):u&&this._updateDiff(u,t)})}else typeof f=="object"&&this._updateDiff(f,t)}_updateDiff(f,t){try{this.style.setState(f,t)&&this._update(!0)}catch(r){s.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(f,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(f,t){return this._lazyInitEmptyStyle(),this.style.addSource(f,t),this._update(!0)}isSourceLoaded(f){const t=this.style&&this.style.sourceCaches[f];if(t!==void 0)return t.loaded();this.fire(new s.j(new Error(`There is no source with ID '${f}'`)))}setTerrain(f){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),f){const t=this.style.sourceCaches[f.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${f.source}`);for(const r in this.style._layers){const l=this.style._layers[r];l.type==="hillshade"&&l.source===f.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new eu(this.painter,t,f),this.painter.renderToTexture=new Cl(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=r=>{r.dataType==="style"?this.terrain.sourceCache.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==f.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new s.k("terrain",{terrain:f})),this}getTerrain(){var f,t;return(t=(f=this.terrain)===null||f===void 0?void 0:f.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const f=this.style&&this.style.sourceCaches;for(const t in f){const r=f[t]._tiles;for(const l in r){const u=r[l];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}addSourceType(f,t,r){return this._lazyInitEmptyStyle(),this.style.addSourceType(f,t,r)}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,t,r={}){const{pixelRatio:l=1,sdf:u=!1,stretchX:_,stretchY:x,content:w}=r;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||s.a(t))){if(t.width===void 0||t.height===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:I,height:A,data:L}=t,z=t;return this.style.addImage(f,{data:new s.R({width:I,height:A},new Uint8Array(L)),pixelRatio:l,stretchX:_,stretchY:x,content:w,sdf:u,version:0,userImage:z}),z.onAdd&&z.onAdd(this,f),this}}{const{width:I,height:A,data:L}=s.h.getImageData(t);this.style.addImage(f,{data:new s.R({width:I,height:A},L),pixelRatio:l,stretchX:_,stretchY:x,content:w,sdf:u,version:0})}}updateImage(f,t){const r=this.style.getImage(f);if(!r)return this.fire(new s.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=t instanceof HTMLImageElement||s.a(t)?s.h.getImageData(t):t,{width:u,height:_,data:x}=l;if(u===void 0||_===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==r.data.width||_!==r.data.height)return this.fire(new s.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(t instanceof HTMLImageElement||s.a(t));return r.data.replace(x,w),this.style.updateImage(f,r),this}getImage(f){return this.style.getImage(f)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new s.j(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,t){me.getImage(this._requestManager.transformRequest(f,Te.Image),t)}listImages(){return this.style.listImages()}addLayer(f,t){return this._lazyInitEmptyStyle(),this.style.addLayer(f,t),this._update(!0)}moveLayer(f,t){return this.style.moveLayer(f,t),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(f,t,r){return this.style.setLayerZoomRange(f,t,r),this._update(!0)}setFilter(f,t,r={}){return this.style.setFilter(f,t,r),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,t,r,l={}){return this.style.setPaintProperty(f,t,r,l),this._update(!0)}getPaintProperty(f,t){return this.style.getPaintProperty(f,t)}setLayoutProperty(f,t,r,l={}){return this.style.setLayoutProperty(f,t,r,l),this._update(!0)}getLayoutProperty(f,t){return this.style.getLayoutProperty(f,t)}setGlyphs(f,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(f,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(f,t,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(f,t,r,l=>{l||this._update(!0)}),this}removeSprite(f){return this._lazyInitEmptyStyle(),this.style.removeSprite(f),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(f,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(f,t,r=>{r||this._update(!0)}),this}setLight(f,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(f,t){return this.style.setFeatureState(f,t),this._update()}removeFeatureState(f,t){return this.style.removeFeatureState(f,t),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,t=0;return this._container&&(f=this._container.clientWidth||400,t=this._container.clientHeight||300),[f,t]}_setupContainer(){const f=this._container;f.classList.add("maplibregl-map");const t=this._canvasContainer=M.create("div","maplibregl-canvas-container",f);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=M.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),l=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],l);const u=this._controlContainer=M.create("div","maplibregl-control-container",f),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{_[x]=M.create("div",`maplibregl-ctrl-${x} `,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=M.create("div","maplibregl-cooperative-gesture-screen",this._container);let f=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(f=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${f}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){M.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(f,t,r){this._canvas.width=Math.floor(r*f),this._canvas.height=Math.floor(r*t),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const f={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{t={requestedAttributes:f},l&&(t.statusMessage=l.statusMessage,t.type=l.type)},{once:!0});const r=this._canvas.getContext("webgl2",f)||this._canvas.getContext("webgl",f);if(!r){const l="Failed to initialize WebGL";throw t?(t.message=l,new Error(JSON.stringify(t))):new Error(l)}this.painter=new Qo(r,this.transform),q.testSupport(r)}_onCooperativeGesture(f,t,r){return!t&&r<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let r=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const u=this.transform.zoom,_=s.h.now();this.style.zoomHistory.update(u,_);const x=new s.a8(u,{now:_,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=x.crossFadingFactor();w===1&&w===this._crossFadingFactor||(r=!0,this._crossFadingFactor=w),this.style.update(x)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new s.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.bg.mark(s.bh.load),this.fire(new s.k("load"))),this.style&&(this.style.hasTransitions()||r)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const l=this._sourcesDirty||this._styleDirty||this._placementDirty;return l||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.k("idle")),!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,s.bg.mark(s.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var f;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),me.removeThrottleControl(this._imageQueueHandle),(f=this._resizeObserver)===null||f===void 0||f.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),M.remove(this._canvasContainer),M.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),s.bg.clearMetrics(),this._removed=!0,this.fire(new s.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=s.h.frame(f=>{s.bg.frame(f),this._frame=null,this._render(f)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get version(){return Ot}getCameraTargetElevation(){return this.transform.elevation}},Ui.NavigationControl=class{constructor(f){this._updateZoomButtons=()=>{const t=this._map.getZoom(),r=t===this._map.getMaxZoom(),l=t===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,r)=>{const l=this._map._getUIString(`NavigationControl.${r}`);t.title=l,t.setAttribute("aria-label",l)},this.options=s.e({},rc,f),this._container=M.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),M.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),M.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=M.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new oc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){M.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,t){const r=M.create("button",f,this._container);return r.type="button",r.addEventListener("click",t),r}},Ui.GeolocateControl=class extends s.E{constructor(f){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new s.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const r=new s.L(t.coords.longitude,t.coords.latitude),l=t.coords.accuracy,u=this._map.getBearing(),_=s.e({bearing:u},this.options.fitBoundsOptions),x=Nt.fromLngLat(r,l);this._map.fitBounds(x,_,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const r=new s.L(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Oa)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=M.create("button","maplibregl-ctrl-geolocate",this._container),M.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=M.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new $s({element:this._dotElement}),this._circleElement=M.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new $s({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.k("trackuserlocationend")))})}},this.options=s.e({},En,f)}onAdd(f){return this._map=f,this._container=M.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,r=!1){Vn===void 0||r?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(l=>{Vn=l.state!=="denied",t(Vn)}).catch(()=>{Vn=!!window.navigator.geolocation,t(Vn)}):(Vn=!!window.navigator.geolocation,t(Vn)):t(Vn)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),M.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Tn=0,Oa=!1}_isOutOfMapMaxBounds(f){const t=this._map.getMaxBounds(),r=f.coords;return t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const f=this._map.getBounds(),t=f.getSouthEast(),r=f.getNorthEast(),l=t.distanceTo(r),u=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Tn--,Oa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Tn++,Tn>1?(f={maximumAge:6e5,timeout:0},Oa=!0):(f=this.options.positionOptions,Oa=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Ui.AttributionControl=lo,Ui.LogoControl=pn,Ui.ScaleControl=class{constructor(f){this._onMove=()=>{al(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,al(this._map,this._container,this.options)},this.options=s.e({},sl,f)}getDefaultPosition(){return"bottom-left"}onAdd(f){return this._map=f,this._container=M.create("div","maplibregl-ctrl maplibregl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){M.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Ui.FullscreenControl=class extends s.E{constructor(f={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=M.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){M.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const f=this._fullscreenButton=M.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);M.create("span","maplibregl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new s.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Ui.TerrainControl=class{constructor(f){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=f}onAdd(f){return this._map=f,this._container=M.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=M.create("button","maplibregl-ctrl-terrain",this._container),M.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){M.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Ui.Popup=class extends s.E{constructor(f){super(),this.remove=()=>(this._content&&M.remove(this._content),this._container&&(M.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new s.k("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=M.create("div","maplibregl-popup",this._map.getContainer()),this._tip=M.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const x of this.options.className.split(" "))this._container.classList.add(x);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=sc(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const r=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let l=this.options.anchor;const u=Ba(this.options.offset);if(!l){const x=this._container.offsetWidth,w=this._container.offsetHeight;let I;I=r.y+u.bottom.y<w?["top"]:r.y>this._map.transform.height-w?["bottom"]:[],r.x<x/2?I.push("left"):r.x>this._map.transform.width-x/2&&I.push("right"),l=I.length===0?"bottom":I.join("-")}const _=r.add(u[l]).round();M.setTransform(this._container,`${Mo[l]} translate(${_.x}px,${_.y}px)`),tu(this._container,l,"popup")},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(ac),f)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=s.L.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const t=document.createDocumentFragment(),r=document.createElement("body");let l;for(r.innerHTML=f;l=r.firstChild,l;)t.appendChild(l);return this.setDOMContent(t)}getMaxWidth(){var f;return(f=this._container)===null||f===void 0?void 0:f.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=M.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){this._container&&this._container.classList.add(f)}removeClassName(f){this._container&&this._container.classList.remove(f)}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}_createCloseButton(){this.options.closeButton&&(this._closeButton=M.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(lc);f&&f.focus()}},Ui.Marker=$s,Ui.Style=Wn,Ui.LngLat=s.L,Ui.LngLatBounds=Nt,Ui.Point=s.P,Ui.MercatorCoordinate=s.U,Ui.Evented=s.E,Ui.AJAXError=s.bi,Ui.config=s.c,Ui.CanvasSource=xn,Ui.GeoJSONSource=nt,Ui.ImageSource=vt,Ui.RasterDEMTileSource=Zt,Ui.RasterTileSource=qe,Ui.VectorTileSource=ji,Ui.VideoSource=qi,Ui.setRTLTextPlugin=s.bj,Ui.getRTLTextPluginStatus=s.bk,Ui.prewarm=function(){en().acquire(ii)},Ui.clearPrewarmedResources=function(){const f=Sn;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(ii),Sn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},cc.extend(Ui,{isSafari:s.ac,getPerformanceMetrics:s.bg.getPerformanceMetrics}),Ui});var k=y;return k})})(zf);var Ff=zf.exports;const cs=Lf(Ff);function Bp(p){let a;return h=>{if(h)for(let d in h){let y=a==null?void 0:a[d],S=h[d];y!==S&&p(d,S,y)}else if(a)for(let d in a)p(d,void 0,a[d]);a=h}}function Mg(p,...a){let h=[p];for(let d of a)if(d)Array.isArray(d)&&d[0]===p?h.push(...d.slice(1)):h.push(d);else continue;if(h.length!==1)return h.length===2?h[1]:h}function Ag(p){return p===!0?["has","point_count"]:p===!1?["!",["has","point_count"]]:void 0}function Uh(p,a){return["case",["boolean",["feature-state","hover"],!1],a,p]}var Du=Pg;function Pg(p){var a,h,d;if(p){if(Array.isArray(p)){for(a=[],h=p.length,d=0;d<h;d++){var y=p[d];y!=null&&a.push(y)}return a}if(typeof p=="object"){a={};var S=Object.keys(p);for(h=S.length,d=0;d<h;d++){var k=S[d],s=p[k];s!=null&&(a[k]=s)}return a}}}function Np(p){let a=p[0],h,d,y=Vp(p);return{c(){y.c(),h=us()},m(S,k){y.m(S,k),Ke(S,h,k),d=!0},p(S,k){k[0]&1&&Di(a,a=S[0])?(dr(),Ve(y,1,1,_i),pr(),y=Vp(S),y.c(),Pe(y,1),y.m(h.parentNode,h)):y.p(S,k)},i(S){d||(Pe(y),d=!0)},o(S){Ve(y),d=!1},d(S){S&&He(h),y.d(S)}}}function Vp(p){let a;const h=p[37].default,d=go(h,p,p[36],null);return{c(){d&&d.c()},m(y,S){d&&d.m(y,S),a=!0},p(y,S){d&&d.p&&(!a||S[1]&32)&&vo(d,h,y,y[36],a?yo(h,y[36],S,null):bo(y[36]),null)},i(y){a||(Pe(d,y),a=!0)},o(y){Ve(d,y),a=!1},d(y){d&&d.d(y)}}}function Lg(p){let a,h,d=p[0]&&Np(p);return{c(){d&&d.c(),a=us()},m(y,S){d&&d.m(y,S),Ke(y,a,S),h=!0},p(y,S){y[0]?d?(d.p(y,S),S[0]&1&&Pe(d,1)):(d=Np(y),d.c(),Pe(d,1),d.m(a.parentNode,a)):d&&(dr(),Ve(d,1,1,()=>{d=null}),pr())},i(y){h||(Pe(d),h=!0)},o(y){Ve(d),h=!1},d(y){y&&He(a),d&&d.d(y)}}}function zg(p,a,h){let d,y,S,k,s,D,M,q,te,ce,be,he,{$$slots:ye={},$$scope:me}=a,{id:Te=Xc("layer")}=a,{source:De=void 0}=a,{sourceLayer:Ze=void 0}=a,{beforeId:Le=void 0}=a,{beforeLayerType:tt=void 0}=a,{type:xt}=a,{paint:Qe=void 0}=a,{layout:Dt=void 0}=a,{filter:bt=void 0}=a,{applyToClusters:qt=void 0}=a,{minzoom:Fe=void 0}=a,{maxzoom:$e=void 0}=a,{manageHoverState:Wt=!1}=a,{hovered:rt=null}=a,{interactive:Qt=!0}=a,{hoverCursor:Bt=void 0}=a,{eventsIfTopMost:At=!1}=a;const hi=Hc(),{map:Rn,source:On,self:Ei,minzoom:Mi,maxzoom:Nt,eventTopMost:bi,layerInfo:ji}=Cg();$t(p,Rn,nt=>h(32,te=nt)),$t(p,On,nt=>h(33,ce=nt)),$t(p,Ei,nt=>h(0,q=nt)),$t(p,Mi,nt=>h(35,he=nt)),$t(p,Nt,nt=>h(34,be=nt)),Ss(()=>{q&&te&&(ji.delete(q),te==null||te.removeLayer(q))});let qe,Zt=!0;return p.$$set=nt=>{"id"in nt&&h(7,Te=nt.id),"source"in nt&&h(8,De=nt.source),"sourceLayer"in nt&&h(9,Ze=nt.sourceLayer),"beforeId"in nt&&h(10,Le=nt.beforeId),"beforeLayerType"in nt&&h(11,tt=nt.beforeLayerType),"type"in nt&&h(12,xt=nt.type),"paint"in nt&&h(13,Qe=nt.paint),"layout"in nt&&h(14,Dt=nt.layout),"filter"in nt&&h(15,bt=nt.filter),"applyToClusters"in nt&&h(16,qt=nt.applyToClusters),"minzoom"in nt&&h(17,Fe=nt.minzoom),"maxzoom"in nt&&h(18,$e=nt.maxzoom),"manageHoverState"in nt&&h(19,Wt=nt.manageHoverState),"hovered"in nt&&h(6,rt=nt.hovered),"interactive"in nt&&h(20,Qt=nt.interactive),"hoverCursor"in nt&&h(21,Bt=nt.hoverCursor),"eventsIfTopMost"in nt&&h(22,At=nt.eventsIfTopMost),"$$scope"in nt&&h(36,me=nt.$$scope)},p.$$.update=()=>{if(p.$$.dirty[0]&65536&&h(31,d=Ag(qt)),p.$$.dirty[0]&32768|p.$$.dirty[1]&1&&h(25,y=Mg("all",d,bt)),p.$$.dirty[0]&131072|p.$$.dirty[1]&16&&h(27,S=Fe??he),p.$$.dirty[0]&262144|p.$$.dirty[1]&8&&h(26,k=$e??be),p.$$.dirty[0]&256|p.$$.dirty[1]&4&&h(30,s=De||ce),p.$$.dirty[0]&1324908161|p.$$.dirty[1]&2&&te&&q!==Te&&s){let nt=function(vt){var Fi,wn;if(!Qt||!q||!te||At&&bi(vt)!==q)return;let qi=vt.features??[],xn=(wn=(Fi=qi[0])==null?void 0:Fi.properties)==null?void 0:wn.cluster_id,Je={event:vt,map:te,clusterId:xn,layer:q,source:s,features:qi};hi(vt.type,Je)};q&&ji.delete(q);let oi=Le;if(!Le&&tt){let vt=te.getStyle().layers,qi=typeof tt=="function"?tt:Je=>Je.type===tt,xn=vt==null?void 0:vt.find(qi);xn&&(oi=xn.id)}rn(Ei,q=Te,q),te.addLayer(Du({id:q,type:xt,source:s,"source-layer":Ze,filter:y,paint:Qe,layout:Dt,minzoom:S,maxzoom:k}),oi),h(24,Zt=!0),te.on("click",q,nt),te.on("dblclick",q,nt),te.on("contextmenu",q,nt),te.on("mouseenter",q,vt=>{var Fi,wn;if(!Qt||!q||!te||At&&bi(vt)!==q)return;Bt&&(te.getCanvas().style.cursor=Bt);let qi=vt.features??[];h(6,rt=qi[0]??null);let xn=(wn=(Fi=qi[0])==null?void 0:Fi.properties)==null?void 0:wn.cluster_id;hi("mouseenter",{event:vt,map:te,clusterId:xn,layer:q,source:s,features:qi})}),te.on("mousemove",q,vt=>{var Fi,wn,xi;if(!Qt)return;if(At&&bi(vt)!==q){h(6,rt=null),Wt&&qe!==void 0&&(te==null||te.setFeatureState({source:s,sourceLayer:Ze,id:qe},{hover:!1}),h(23,qe=void 0));return}te.getCanvas().style.cursor=Bt;let qi=vt.features??[],xn=(wn=(Fi=qi[0])==null?void 0:Fi.properties)==null?void 0:wn.cluster_id,Je=(xi=qi[0])==null?void 0:xi.id;Je!==qe&&(Wt&&(qe!==void 0&&(te==null||te.setFeatureState({source:s,id:qe,sourceLayer:Ze},{hover:!1})),te==null||te.setFeatureState({source:s,id:Je,sourceLayer:Ze},{hover:!0})),h(23,qe=Je),h(6,rt=qi[0]??null)),hi("mousemove",{event:vt,map:te,clusterId:xn,layer:q,source:s,features:qi})}),te.on("mouseleave",q,vt=>{if(!(!Qt||!q||!te)){if(Bt&&(te.getCanvas().style.cursor=""),h(6,rt=null),Wt&&qe!==void 0){const qi={source:s,id:qe,sourceLayer:Ze};te==null||te.setFeatureState(qi,{hover:!1}),h(23,qe=void 0)}hi("mouseleave",{map:te,layer:q,source:s})}})}p.$$.dirty[0]&1048577&&q&&ji.set(q,{interactive:Qt}),p.$$.dirty[0]&1|p.$$.dirty[1]&2&&h(29,D=q?Bp((nt,oi)=>te==null?void 0:te.setPaintProperty(q,nt,oi)):void 0),p.$$.dirty[0]&1|p.$$.dirty[1]&2&&h(28,M=q?Bp((nt,oi)=>te==null?void 0:te.setLayoutProperty(q,nt,oi)):void 0),p.$$.dirty[0]&536879104&&(D==null||D(Qe)),p.$$.dirty[0]&268451840&&(M==null||M(Dt)),p.$$.dirty[0]&201326593|p.$$.dirty[1]&2&&q&&(te==null||te.setLayerZoomRange(q,S,k)),p.$$.dirty[0]&50331649|p.$$.dirty[1]&2&&q&&(Zt?h(24,Zt=!1):te==null||te.setFilter(q,y))},[q,Rn,On,Ei,Mi,Nt,rt,Te,De,Ze,Le,tt,xt,Qe,Dt,bt,qt,Fe,$e,Wt,Qt,Bt,At,qe,Zt,y,k,S,M,D,s,d,te,ce,be,he,me,ye]}class Jh extends Wi{constructor(a){super(),Gi(this,a,zg,Lg,Di,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function Dg(p){let a;const h=p[16].default,d=go(h,p,p[24],null);return{c(){d&&d.c()},m(y,S){d&&d.m(y,S),a=!0},p(y,S){d&&d.p&&(!a||S&16777216)&&vo(d,h,y,y[24],a?yo(h,y[24],S,null):bo(y[24]),null)},i(y){a||(Pe(d,y),a=!0)},o(y){Ve(d,y),a=!1},d(y){d&&d.d(y)}}}function Fg(p){let a,h,d;function y(k){p[17](k)}let S={id:p[1],type:"circle",source:p[2],sourceLayer:p[3],beforeId:p[4],beforeLayerType:p[5],paint:p[6],layout:p[7],filter:p[8],applyToClusters:p[9],minzoom:p[10],maxzoom:p[11],hoverCursor:p[12],manageHoverState:p[13],eventsIfTopMost:p[14],interactive:p[15],$$slots:{default:[Dg]},$$scope:{ctx:p}};return p[0]!==void 0&&(S.hovered=p[0]),a=new Jh({props:S}),qr.push(()=>ml(a,"hovered",y)),a.$on("click",p[18]),a.$on("dblclick",p[19]),a.$on("contextmenu",p[20]),a.$on("mouseenter",p[21]),a.$on("mousemove",p[22]),a.$on("mouseleave",p[23]),{c(){Ft(a.$$.fragment)},m(k,s){Lt(a,k,s),d=!0},p(k,[s]){const D={};s&2&&(D.id=k[1]),s&4&&(D.source=k[2]),s&8&&(D.sourceLayer=k[3]),s&16&&(D.beforeId=k[4]),s&32&&(D.beforeLayerType=k[5]),s&64&&(D.paint=k[6]),s&128&&(D.layout=k[7]),s&256&&(D.filter=k[8]),s&512&&(D.applyToClusters=k[9]),s&1024&&(D.minzoom=k[10]),s&2048&&(D.maxzoom=k[11]),s&4096&&(D.hoverCursor=k[12]),s&8192&&(D.manageHoverState=k[13]),s&16384&&(D.eventsIfTopMost=k[14]),s&32768&&(D.interactive=k[15]),s&16777216&&(D.$$scope={dirty:s,ctx:k}),!h&&s&1&&(h=!0,D.hovered=k[0],fl(()=>h=!1)),a.$set(D)},i(k){d||(Pe(a.$$.fragment,k),d=!0)},o(k){Ve(a.$$.fragment,k),d=!1},d(k){zt(a,k)}}}function Rg(p,a,h){let{$$slots:d={},$$scope:y}=a,{id:S=Xc("circle")}=a,{source:k=void 0}=a,{sourceLayer:s=void 0}=a,{beforeId:D=void 0}=a,{beforeLayerType:M=void 0}=a,{paint:q}=a,{layout:te=void 0}=a,{filter:ce=void 0}=a,{applyToClusters:be=void 0}=a,{minzoom:he=void 0}=a,{maxzoom:ye=void 0}=a,{hoverCursor:me=void 0}=a,{manageHoverState:Te=!1}=a,{hovered:De=null}=a,{eventsIfTopMost:Ze=!1}=a,{interactive:Le=!0}=a;function tt($e){De=$e,h(0,De)}function xt($e){ur.call(this,p,$e)}function Qe($e){ur.call(this,p,$e)}function Dt($e){ur.call(this,p,$e)}function bt($e){ur.call(this,p,$e)}function qt($e){ur.call(this,p,$e)}function Fe($e){ur.call(this,p,$e)}return p.$$set=$e=>{"id"in $e&&h(1,S=$e.id),"source"in $e&&h(2,k=$e.source),"sourceLayer"in $e&&h(3,s=$e.sourceLayer),"beforeId"in $e&&h(4,D=$e.beforeId),"beforeLayerType"in $e&&h(5,M=$e.beforeLayerType),"paint"in $e&&h(6,q=$e.paint),"layout"in $e&&h(7,te=$e.layout),"filter"in $e&&h(8,ce=$e.filter),"applyToClusters"in $e&&h(9,be=$e.applyToClusters),"minzoom"in $e&&h(10,he=$e.minzoom),"maxzoom"in $e&&h(11,ye=$e.maxzoom),"hoverCursor"in $e&&h(12,me=$e.hoverCursor),"manageHoverState"in $e&&h(13,Te=$e.manageHoverState),"hovered"in $e&&h(0,De=$e.hovered),"eventsIfTopMost"in $e&&h(14,Ze=$e.eventsIfTopMost),"interactive"in $e&&h(15,Le=$e.interactive),"$$scope"in $e&&h(24,y=$e.$$scope)},[De,S,k,s,D,M,q,te,ce,be,he,ye,me,Te,Ze,Le,d,tt,xt,Qe,Dt,bt,qt,Fe,y]}class Rf extends Wi{constructor(a){super(),Gi(this,a,Rg,Fg,Di,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function Og(p){let a;const h=p[15].default,d=go(h,p,p[23],null);return{c(){d&&d.c()},m(y,S){d&&d.m(y,S),a=!0},p(y,S){d&&d.p&&(!a||S&8388608)&&vo(d,h,y,y[23],a?yo(h,y[23],S,null):bo(y[23]),null)},i(y){a||(Pe(d,y),a=!0)},o(y){Ve(d,y),a=!1},d(y){d&&d.d(y)}}}function Bg(p){let a,h,d;function y(k){p[16](k)}let S={id:p[1],type:"fill",source:p[2],sourceLayer:p[3],beforeId:p[4],beforeLayerType:p[5],paint:p[6],layout:p[7],filter:p[8],minzoom:p[9],maxzoom:p[10],hoverCursor:p[11],manageHoverState:p[12],eventsIfTopMost:p[13],interactive:p[14],$$slots:{default:[Og]},$$scope:{ctx:p}};return p[0]!==void 0&&(S.hovered=p[0]),a=new Jh({props:S}),qr.push(()=>ml(a,"hovered",y)),a.$on("click",p[17]),a.$on("dblclick",p[18]),a.$on("contextmenu",p[19]),a.$on("mouseenter",p[20]),a.$on("mousemove",p[21]),a.$on("mouseleave",p[22]),{c(){Ft(a.$$.fragment)},m(k,s){Lt(a,k,s),d=!0},p(k,[s]){const D={};s&2&&(D.id=k[1]),s&4&&(D.source=k[2]),s&8&&(D.sourceLayer=k[3]),s&16&&(D.beforeId=k[4]),s&32&&(D.beforeLayerType=k[5]),s&64&&(D.paint=k[6]),s&128&&(D.layout=k[7]),s&256&&(D.filter=k[8]),s&512&&(D.minzoom=k[9]),s&1024&&(D.maxzoom=k[10]),s&2048&&(D.hoverCursor=k[11]),s&4096&&(D.manageHoverState=k[12]),s&8192&&(D.eventsIfTopMost=k[13]),s&16384&&(D.interactive=k[14]),s&8388608&&(D.$$scope={dirty:s,ctx:k}),!h&&s&1&&(h=!0,D.hovered=k[0],fl(()=>h=!1)),a.$set(D)},i(k){d||(Pe(a.$$.fragment,k),d=!0)},o(k){Ve(a.$$.fragment,k),d=!1},d(k){zt(a,k)}}}function Ng(p,a,h){let{$$slots:d={},$$scope:y}=a,{id:S=Xc("fill")}=a,{source:k=void 0}=a,{sourceLayer:s=void 0}=a,{beforeId:D=void 0}=a,{beforeLayerType:M=void 0}=a,{paint:q}=a,{layout:te=void 0}=a,{filter:ce=void 0}=a,{minzoom:be=void 0}=a,{maxzoom:he=void 0}=a,{hoverCursor:ye=void 0}=a,{manageHoverState:me=!1}=a,{hovered:Te=null}=a,{eventsIfTopMost:De=!1}=a,{interactive:Ze=!0}=a;function Le(Fe){Te=Fe,h(0,Te)}function tt(Fe){ur.call(this,p,Fe)}function xt(Fe){ur.call(this,p,Fe)}function Qe(Fe){ur.call(this,p,Fe)}function Dt(Fe){ur.call(this,p,Fe)}function bt(Fe){ur.call(this,p,Fe)}function qt(Fe){ur.call(this,p,Fe)}return p.$$set=Fe=>{"id"in Fe&&h(1,S=Fe.id),"source"in Fe&&h(2,k=Fe.source),"sourceLayer"in Fe&&h(3,s=Fe.sourceLayer),"beforeId"in Fe&&h(4,D=Fe.beforeId),"beforeLayerType"in Fe&&h(5,M=Fe.beforeLayerType),"paint"in Fe&&h(6,q=Fe.paint),"layout"in Fe&&h(7,te=Fe.layout),"filter"in Fe&&h(8,ce=Fe.filter),"minzoom"in Fe&&h(9,be=Fe.minzoom),"maxzoom"in Fe&&h(10,he=Fe.maxzoom),"hoverCursor"in Fe&&h(11,ye=Fe.hoverCursor),"manageHoverState"in Fe&&h(12,me=Fe.manageHoverState),"hovered"in Fe&&h(0,Te=Fe.hovered),"eventsIfTopMost"in Fe&&h(13,De=Fe.eventsIfTopMost),"interactive"in Fe&&h(14,Ze=Fe.interactive),"$$scope"in Fe&&h(23,y=Fe.$$scope)},[Te,S,k,s,D,M,q,te,ce,be,he,ye,me,De,Ze,d,Le,tt,xt,Qe,Dt,bt,qt,y]}class Ru extends Wi{constructor(a){super(),Gi(this,a,Ng,Bg,Di,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function Vg(p,a,h){let d;const{map:y}=Hl();$t(p,y,D=>h(4,d=D));let{position:S="top-left"}=a,{container:k=void 0}=a,s=null;return Ss(()=>{d!=null&&d.loaded()&&s&&d.removeControl(s)}),p.$$set=D=>{"position"in D&&h(1,S=D.position),"container"in D&&h(2,k=D.container)},p.$$.update=()=>{if(p.$$.dirty&30&&d&&!s){let D;typeof k=="string"?D=document.querySelector(k)??void 0:D=k,h(3,s=new cs.FullscreenControl({container:D})),d.addControl(s,S)}},[y,S,k,s,d]}class Ug extends Wi{constructor(a){super(),Gi(this,a,Vg,null,Di,{position:1,container:2})}}function jg(p,a,h,d,y){let S=!1;p.getSource(a)&&(S=!0,p.removeSource(a));const k=()=>{d(a)&&(p.addSource(a,h),y())};if(S){const s=()=>{a&&(p.getSource(a)?setTimeout(s,1):k())};s()}else k()}function qg(p,a,h){eg().then(()=>{let d=H_(p);if(!d)return;d.getSource(a)===h&&d.removeSource(a)})}function Up(p){let a=p[0],h,d,y=jp(p);return{c(){y.c(),h=us()},m(S,k){y.m(S,k),Ke(S,h,k),d=!0},p(S,k){k&1&&Di(a,a=S[0])?(dr(),Ve(y,1,1,_i),pr(),y=jp(S),y.c(),Pe(y,1),y.m(h.parentNode,h)):y.p(S,k)},i(S){d||(Pe(y),d=!0)},o(S){Ve(y),d=!1},d(S){S&&He(h),y.d(S)}}}function jp(p){let a;const h=p[15].default,d=go(h,p,p[14],null);return{c(){d&&d.c()},m(y,S){d&&d.m(y,S),a=!0},p(y,S){d&&d.p&&(!a||S&16384)&&vo(d,h,y,y[14],a?yo(h,y[14],S,null):bo(y[14]),null)},i(y){a||(Pe(d,y),a=!0)},o(y){Ve(d,y),a=!1},d(y){d&&d.d(y)}}}function Zg(p){let a,h,d=p[0]&&Up(p);return{c(){d&&d.c(),a=us()},m(y,S){d&&d.m(y,S),Ke(y,a,S),h=!0},p(y,[S]){y[0]?d?(d.p(y,S),S&1&&Pe(d,1)):(d=Up(y),d.c(),Pe(d,1),d.m(a.parentNode,a)):d&&(dr(),Ve(d,1,1,()=>{d=null}),pr())},i(y){h||(Pe(d),h=!0)},o(y){Ve(d),h=!1},d(y){y&&He(a),d&&d.d(y)}}}function Gg(p,a,h){let d,y,S,{$$slots:k={},$$scope:s}=a,{id:D=Xc("geojson")}=a,{data:M}=a,{generateId:q=!1}=a,{promoteId:te=void 0}=a,{filter:ce=void 0}=a,{lineMetrics:be=void 0}=a,{cluster:he=void 0}=a;const{map:ye,cluster:me,self:Te}=Ig();$t(p,ye,Le=>h(13,y=Le)),$t(p,me,Le=>h(16,S=Le)),$t(p,Te,Le=>h(0,d=Le));let De,Ze=!0;return Ss(()=>{d&&De&&y&&(qg(ye,d,De),rn(Te,d=null,d),h(11,De=void 0))}),p.$$set=Le=>{"id"in Le&&h(4,D=Le.id),"data"in Le&&h(5,M=Le.data),"generateId"in Le&&h(6,q=Le.generateId),"promoteId"in Le&&h(7,te=Le.promoteId),"filter"in Le&&h(8,ce=Le.filter),"lineMetrics"in Le&&h(9,be=Le.lineMetrics),"cluster"in Le&&h(10,he=Le.cluster),"$$scope"in Le&&h(14,s=Le.$$scope)},p.$$.update=()=>{p.$$.dirty&1024&&rn(me,S=he,S),p.$$.dirty&12273&&y&&d!==D&&(rn(Te,d=D,d),jg(y,d,Du({type:"geojson",data:M,filter:ce,lineMetrics:be,generateId:q,promoteId:te,cluster:!!he,clusterMinPoints:he==null?void 0:he.minPoints,clusterMaxZoom:he==null?void 0:he.maxZoom,clusterRadius:he==null?void 0:he.radius,clusterProperties:he==null?void 0:he.properties}),Le=>y&&Le===d,()=>{d&&(h(11,De=y==null?void 0:y.getSource(d)),h(12,Ze=!0))})),p.$$.dirty&8208&&(y==null||y.on("style.load",()=>{h(11,De=y==null?void 0:y.getSource(D))})),p.$$.dirty&6176&&De&&(Ze?h(12,Ze=!1):De.setData(M)),p.$$.dirty&3072&&(De==null||De.setClusterOptions(Du({cluster:!!he,clusterMaxZoom:he==null?void 0:he.maxZoom,clusterRadius:he==null?void 0:he.radius})))},[d,ye,me,Te,D,M,q,te,ce,be,he,De,Ze,y,s,k]}class Ka extends Wi{constructor(a){super(),Gi(this,a,Gg,Zg,Di,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function Wg(p,a,h){let d;const{map:y}=Hl();$t(p,y,ce=>h(8,d=ce));let{position:S="top-left"}=a,{positionOptions:k=void 0}=a,{fitBoundsOptions:s=void 0}=a,{trackUserLocation:D=!1}=a,{showAccuracyCircle:M=!0}=a,{showUserLocation:q=!0}=a,te=null;return Ss(()=>{d!=null&&d.loaded()&&te&&d.removeControl(te)}),p.$$set=ce=>{"position"in ce&&h(1,S=ce.position),"positionOptions"in ce&&h(2,k=ce.positionOptions),"fitBoundsOptions"in ce&&h(3,s=ce.fitBoundsOptions),"trackUserLocation"in ce&&h(4,D=ce.trackUserLocation),"showAccuracyCircle"in ce&&h(5,M=ce.showAccuracyCircle),"showUserLocation"in ce&&h(6,q=ce.showUserLocation)},p.$$.update=()=>{p.$$.dirty&510&&d&&!te&&(h(7,te=new cs.GeolocateControl({positionOptions:k,fitBoundsOptions:s,trackUserLocation:D,showAccuracyCircle:M,showUserLocation:q})),d.addControl(te,S))},[y,S,k,s,D,M,q,te,d]}class Hg extends Wi{constructor(a){super(),Gi(this,a,Wg,null,Di,{position:1,positionOptions:2,fitBoundsOptions:3,trackUserLocation:4,showAccuracyCircle:5,showUserLocation:6})}}function Xg(p){let a;const h=p[15].default,d=go(h,p,p[23],null);return{c(){d&&d.c()},m(y,S){d&&d.m(y,S),a=!0},p(y,S){d&&d.p&&(!a||S&8388608)&&vo(d,h,y,y[23],a?yo(h,y[23],S,null):bo(y[23]),null)},i(y){a||(Pe(d,y),a=!0)},o(y){Ve(d,y),a=!1},d(y){d&&d.d(y)}}}function Kg(p){let a,h,d;function y(k){p[16](k)}let S={id:p[1],type:"line",source:p[2],sourceLayer:p[3],beforeId:p[4],beforeLayerType:p[5],paint:p[6],layout:p[7],filter:p[8],minzoom:p[9],maxzoom:p[10],hoverCursor:p[11],manageHoverState:p[12],eventsIfTopMost:p[13],interactive:p[14],$$slots:{default:[Xg]},$$scope:{ctx:p}};return p[0]!==void 0&&(S.hovered=p[0]),a=new Jh({props:S}),qr.push(()=>ml(a,"hovered",y)),a.$on("click",p[17]),a.$on("dblclick",p[18]),a.$on("contextmenu",p[19]),a.$on("mouseenter",p[20]),a.$on("mousemove",p[21]),a.$on("mouseleave",p[22]),{c(){Ft(a.$$.fragment)},m(k,s){Lt(a,k,s),d=!0},p(k,[s]){const D={};s&2&&(D.id=k[1]),s&4&&(D.source=k[2]),s&8&&(D.sourceLayer=k[3]),s&16&&(D.beforeId=k[4]),s&32&&(D.beforeLayerType=k[5]),s&64&&(D.paint=k[6]),s&128&&(D.layout=k[7]),s&256&&(D.filter=k[8]),s&512&&(D.minzoom=k[9]),s&1024&&(D.maxzoom=k[10]),s&2048&&(D.hoverCursor=k[11]),s&4096&&(D.manageHoverState=k[12]),s&8192&&(D.eventsIfTopMost=k[13]),s&16384&&(D.interactive=k[14]),s&8388608&&(D.$$scope={dirty:s,ctx:k}),!h&&s&1&&(h=!0,D.hovered=k[0],fl(()=>h=!1)),a.$set(D)},i(k){d||(Pe(a.$$.fragment,k),d=!0)},o(k){Ve(a.$$.fragment,k),d=!1},d(k){zt(a,k)}}}function Jg(p,a,h){let{$$slots:d={},$$scope:y}=a,{id:S=Xc("line")}=a,{source:k=void 0}=a,{sourceLayer:s=void 0}=a,{beforeId:D=void 0}=a,{beforeLayerType:M=void 0}=a,{paint:q}=a,{layout:te=void 0}=a,{filter:ce=void 0}=a,{minzoom:be=void 0}=a,{maxzoom:he=void 0}=a,{hoverCursor:ye=void 0}=a,{manageHoverState:me=!1}=a,{hovered:Te=null}=a,{eventsIfTopMost:De=!1}=a,{interactive:Ze=!0}=a;function Le(Fe){Te=Fe,h(0,Te)}function tt(Fe){ur.call(this,p,Fe)}function xt(Fe){ur.call(this,p,Fe)}function Qe(Fe){ur.call(this,p,Fe)}function Dt(Fe){ur.call(this,p,Fe)}function bt(Fe){ur.call(this,p,Fe)}function qt(Fe){ur.call(this,p,Fe)}return p.$$set=Fe=>{"id"in Fe&&h(1,S=Fe.id),"source"in Fe&&h(2,k=Fe.source),"sourceLayer"in Fe&&h(3,s=Fe.sourceLayer),"beforeId"in Fe&&h(4,D=Fe.beforeId),"beforeLayerType"in Fe&&h(5,M=Fe.beforeLayerType),"paint"in Fe&&h(6,q=Fe.paint),"layout"in Fe&&h(7,te=Fe.layout),"filter"in Fe&&h(8,ce=Fe.filter),"minzoom"in Fe&&h(9,be=Fe.minzoom),"maxzoom"in Fe&&h(10,he=Fe.maxzoom),"hoverCursor"in Fe&&h(11,ye=Fe.hoverCursor),"manageHoverState"in Fe&&h(12,me=Fe.manageHoverState),"hovered"in Fe&&h(0,Te=Fe.hovered),"eventsIfTopMost"in Fe&&h(13,De=Fe.eventsIfTopMost),"interactive"in Fe&&h(14,Ze=Fe.interactive),"$$scope"in Fe&&h(23,y=Fe.$$scope)},[Te,S,k,s,D,M,q,te,ce,be,he,ye,me,De,Ze,d,Le,tt,xt,Qe,Dt,bt,qt,y]}class Xl extends Wi{constructor(a){super(),Gi(this,a,Jg,Kg,Di,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function Yg(p){let a=p.getCenter(),h=Math.round(p.getZoom()*100)/100,d=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,d),S=Math.round(a.lat*y)/y,k=Math.round(a.lng*y)/y,s=`${h}/${S}/${k}`,D=p.getBearing(),M=p.getPitch();return(D||M)&&(s+=`/${Math.round(D*10)/10}`),M&&(s+=`/${Math.round(M)}`),`#${s}`}function Qg(p){return p.replace("#","").split("/").map(parseFloat)}var ku=Yh;function Yh(p,a){return p===a||p!==p&&a!==a?!0:typeof p!=typeof a||{}.toString.call(p)!={}.toString.call(a)||p!==Object(p)||!p?!1:Array.isArray(p)?qp(p,a):{}.toString.call(p)=="[object Set]"?qp(Array.from(p),Array.from(a)):{}.toString.call(p)=="[object Object]"?ey(p,a):$g(p,a)}function $g(p,a){return p.toString()===a.toString()}function qp(p,a){var h=p.length;if(h!=a.length)return!1;for(var d=0;d<h;d++)if(!Yh(p[d],a[d]))return!1;return!0}function ey(p,a){var h=Object.keys(p),d=h.length;if(d!=Object.keys(a).length)return!1;for(var y=0;y<d;y++){var S=h[y];if(!(a.hasOwnProperty(S)&&Yh(p[S],a[S])))return!1}return!0}function ty(p,a,h){let d;const{map:y}=Hl();$t(p,y,q=>h(6,d=q));let{position:S="top-left"}=a,{showCompass:k=!0}=a,{showZoom:s=!0}=a,{visualizePitch:D=!1}=a,M=null;return Ss(()=>{d!=null&&d.loaded()&&M&&d.removeControl(M)}),p.$$set=q=>{"position"in q&&h(1,S=q.position),"showCompass"in q&&h(2,k=q.showCompass),"showZoom"in q&&h(3,s=q.showZoom),"visualizePitch"in q&&h(4,D=q.visualizePitch)},p.$$.update=()=>{p.$$.dirty&126&&d&&!M&&(h(5,M=new cs.NavigationControl({showCompass:k,showZoom:s,visualizePitch:D})),d.addControl(M,S))},[y,S,k,s,D,M,d]}class iy extends Wi{constructor(a){super(),Gi(this,a,ty,null,Di,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function ny(p,a,h){let d;const{map:y}=Hl();$t(p,y,M=>h(5,d=M));let{position:S="bottom-left"}=a,{maxWidth:k=void 0}=a,{unit:s="metric"}=a,D=null;return Ss(()=>{d!=null&&d.loaded()&&D&&d.removeControl(D)}),p.$$set=M=>{"position"in M&&h(1,S=M.position),"maxWidth"in M&&h(2,k=M.maxWidth),"unit"in M&&h(3,s=M.unit)},p.$$.update=()=>{p.$$.dirty&62&&d&&!D&&(h(4,D=new cs.ScaleControl({maxWidth:k,unit:s})),d.addControl(D,S))},[y,S,k,s,D,d]}class ry extends Wi{constructor(a){super(),Gi(this,a,ny,null,Di,{position:1,maxWidth:2,unit:3})}}const oy=p=>({map:p[0]&8,loadedImages:p[0]&16,allImagesLoaded:p[0]&32}),Zp=p=>({map:p[3],loadedImages:p[4],allImagesLoaded:p[5]});function Gp(p){let a,h,d=p[2]&&Wp(p);const y=p[33].default,S=go(y,p,p[32],Zp);return{c(){d&&d.c(),a=Tt(),S&&S.c()},m(k,s){d&&d.m(k,s),Ke(k,a,s),S&&S.m(k,s),h=!0},p(k,s){k[2]?d?(d.p(k,s),s[0]&4&&Pe(d,1)):(d=Wp(k),d.c(),Pe(d,1),d.m(a.parentNode,a)):d&&(dr(),Ve(d,1,1,()=>{d=null}),pr()),S&&S.p&&(!h||s[0]&56|s[1]&2)&&vo(S,y,k,k[32],h?yo(y,k[32],s,oy):bo(k[32]),Zp)},i(k){h||(Pe(d),Pe(S,k),h=!0)},o(k){Ve(d),Ve(S,k),h=!1},d(k){k&&He(a),d&&d.d(k),S&&S.d(k)}}}function Wp(p){let a,h,d,y,S,k,s,D;return a=new iy({props:{position:p[6]}}),d=new Hg({props:{position:p[6],fitBoundsOptions:{maxZoom:12}}}),S=new Ug({props:{position:p[6]}}),s=new ry({props:{position:p[6]}}),{c(){Ft(a.$$.fragment),h=Tt(),Ft(d.$$.fragment),y=Tt(),Ft(S.$$.fragment),k=Tt(),Ft(s.$$.fragment)},m(M,q){Lt(a,M,q),Ke(M,h,q),Lt(d,M,q),Ke(M,y,q),Lt(S,M,q),Ke(M,k,q),Lt(s,M,q),D=!0},p(M,q){const te={};q[0]&64&&(te.position=M[6]),a.$set(te);const ce={};q[0]&64&&(ce.position=M[6]),d.$set(ce);const be={};q[0]&64&&(be.position=M[6]),S.$set(be);const he={};q[0]&64&&(he.position=M[6]),s.$set(he)},i(M){D||(Pe(a.$$.fragment,M),Pe(d.$$.fragment,M),Pe(S.$$.fragment,M),Pe(s.$$.fragment,M),D=!0)},o(M){Ve(a.$$.fragment,M),Ve(d.$$.fragment,M),Ve(S.$$.fragment,M),Ve(s.$$.fragment,M),D=!1},d(M){M&&(He(h),He(y),He(k)),zt(a,M),zt(d,M),zt(S,M),zt(s,M)}}}function sy(p){let a,h,d,y,S,k=p[3]&&p[0]&&Gp(p);return{c(){a=Ee("div"),k&&k.c(),ui(a,"class",h=Dp(p[1])+" svelte-p00lfq"),Rp(a,"expand-map",!p[1])},m(s,D){Ke(s,a,D),k&&k.m(a,null),d=!0,y||(S=Rh(p[9].call(null,a)),y=!0)},p(s,D){s[3]&&s[0]?k?(k.p(s,D),D[0]&9&&Pe(k,1)):(k=Gp(s),k.c(),Pe(k,1),k.m(a,null)):k&&(dr(),Ve(k,1,1,()=>{k=null}),pr()),(!d||D[0]&2&&h!==(h=Dp(s[1])+" svelte-p00lfq"))&&ui(a,"class",h),(!d||D[0]&2)&&Rp(a,"expand-map",!s[1])},i(s){d||(Pe(k),d=!0)},o(s){Ve(k),d=!1},d(s){s&&He(a),k&&k.d(),y=!1,S()}}}function ay(p,a,h){let d,y,S,k,{$$slots:s={},$$scope:D}=a,{map:M=null}=a,{class:q=void 0}=a,{style:te}=a,{diffStyleUpdates:ce=!1}=a,{center:be=void 0}=a,{zoom:he=void 0}=a,{pitch:ye=0}=a,{bearing:me=0}=a,{bounds:Te=void 0}=a,{hash:De=!1}=a,{loaded:Ze=!1}=a,{minZoom:Le=0}=a,{maxZoom:tt=22}=a,{zoomOnDoubleClick:xt=!0}=a,{interactive:Qe=!0}=a,{attributionControl:Dt=!0}=a,{preserveDrawingBuffer:bt=!1}=a,{maxBounds:qt=void 0}=a,{images:Fe=[]}=a,{standardControls:$e=!1}=a,{filterLayers:Wt=void 0}=a,{transformRequest:rt=void 0}=a;const Qt=Hc(),{map:Bt,loadedImages:At}=Tg();$t(p,Bt,qe=>h(3,S=qe)),$t(p,At,qe=>h(4,k=qe));let hi=new Set;function Rn(qe){S!=null&&S.loaded()&&("url"in qe?(hi.add(qe.id),S.loadImage(qe.url,(Zt,nt)=>{hi.delete(qe.id),Zt?Qt("error",Zt):nt&&(S==null||S.addImage(qe.id,nt,qe.options),k.add(qe.id),At.set(k))})):(S.addImage(qe.id,qe.data,qe.options),k.add(qe.id),At.set(k)))}let On,Ei,Mi,Nt;function bi(qe){if(De){let Zt=Qg(window.location.hash);Zt.length>=3&&(h(11,he=Zt[0]),h(10,be=[Zt[2],Zt[1]])),Zt.length==5&&(h(15,me=Zt[3]),h(14,ye=Zt[4]))}return rn(Bt,S=new cs.Map(Du({container:qe,style:te,center:be,zoom:he,pitch:ye,bearing:me,minZoom:Le,maxZoom:tt,interactive:Qe,preserveDrawingBuffer:bt,maxBounds:qt,bounds:Te,attributionControl:Dt,transformRequest:rt})),S),S.on("load",Zt=>{h(0,Ze=!0),Qt("load",S)}),S.on("error",Zt=>Qt("error",{...Zt,map:S})),S.on("movestart",Zt=>Qt("movestart",{...Zt,map:S})),S.on("moveend",Zt=>{if(h(10,be=Zt.target.getCenter()),h(11,he=Zt.target.getZoom()),h(12,Te=Zt.target.getBounds()),Qt("moveend",{...Zt,map:S}),De){let nt=window.location.href.replace(/(#.+)?$/,Yg(S));window.history.replaceState(window.history.state,"",nt)}}),S.on("zoomstart",Zt=>Qt("zoomstart",{...Zt,map:S})),S.on("zoom",Zt=>{h(11,he=Zt.target.getZoom()),Qt("zoom",{...Zt,map:S})}),S.on("zoomend",Zt=>{h(11,he=Zt.target.getZoom()),Qt("zoomend",{...Zt,map:S})}),S.on("style.load",()=>{if(S){const Zt=S.getStyle();if(h(29,On=Zt.layers.map(nt=>nt.id)),h(30,Ei=Object.keys(Zt.sources)),Nt)for(const[nt,oi]of Object.entries(Nt))S.addSource(nt,oi);if(Mi)for(const nt of Mi)S.addLayer(nt)}}),S.on("styledata",Zt=>{if(S&&Wt){const nt=S.getStyle().layers;if(nt)for(let oi of nt)Wt(oi)||S.setLayoutProperty(oi.id,"visibility","none")}Qt("styledata",{...Zt,map:S})}),{destroy(){h(0,Ze=!1),S==null||S.remove(),rn(Bt,S=null,S)}}}let ji=te;return p.$$set=qe=>{"map"in qe&&h(13,M=qe.map),"class"in qe&&h(1,q=qe.class),"style"in qe&&h(16,te=qe.style),"diffStyleUpdates"in qe&&h(17,ce=qe.diffStyleUpdates),"center"in qe&&h(10,be=qe.center),"zoom"in qe&&h(11,he=qe.zoom),"pitch"in qe&&h(14,ye=qe.pitch),"bearing"in qe&&h(15,me=qe.bearing),"bounds"in qe&&h(12,Te=qe.bounds),"hash"in qe&&h(18,De=qe.hash),"loaded"in qe&&h(0,Ze=qe.loaded),"minZoom"in qe&&h(19,Le=qe.minZoom),"maxZoom"in qe&&h(20,tt=qe.maxZoom),"zoomOnDoubleClick"in qe&&h(21,xt=qe.zoomOnDoubleClick),"interactive"in qe&&h(22,Qe=qe.interactive),"attributionControl"in qe&&h(23,Dt=qe.attributionControl),"preserveDrawingBuffer"in qe&&h(24,bt=qe.preserveDrawingBuffer),"maxBounds"in qe&&h(25,qt=qe.maxBounds),"images"in qe&&h(26,Fe=qe.images),"standardControls"in qe&&h(2,$e=qe.standardControls),"filterLayers"in qe&&h(27,Wt=qe.filterLayers),"transformRequest"in qe&&h(28,rt=qe.transformRequest),"$$scope"in qe&&h(32,D=qe.$$scope)},p.$$.update=()=>{if(p.$$.dirty[0]&4&&h(6,d=typeof $e=="boolean"?void 0:$e),p.$$.dirty[0]&8&&h(13,M=S),p.$$.dirty[0]&67108873&&Ze&&S!=null&&S.loaded())for(let qe of Fe)!hi.has(qe.id)&&!S.hasImage(qe.id)&&Rn(qe);if(p.$$.dirty[0]&67108880&&h(5,y=Fe.every(qe=>k.has(qe.id))),p.$$.dirty[0]&1610809352|p.$$.dirty[1]&1&&S&&!ku(te,ji)){const qe=S.getStyle();if(On&&(Mi=qe.layers.filter(Zt=>!On.includes(Zt.id))),Ei){const Zt=Object.keys(qe.sources).filter(nt=>!Ei.includes(nt));Nt={};for(const nt of Zt)Nt[nt]=qe.sources[nt]}h(31,ji=te),S.setStyle(te,{diff:ce})}p.$$.dirty[0]&1032&&be&&!ku(be,S==null?void 0:S.getCenter())&&(S==null||S.panTo(be)),p.$$.dirty[0]&2056&&he&&!ku(he,S==null?void 0:S.getZoom())&&(S==null||S.zoomTo(he)),p.$$.dirty[0]&4104&&Te&&!ku(Te,S==null?void 0:S.getBounds())&&(S==null||S.fitBounds(Te)),p.$$.dirty[0]&2097160&&(xt?S==null||S.doubleClickZoom.enable():S==null||S.doubleClickZoom.disable())},[Ze,q,$e,S,k,y,d,Bt,At,bi,be,he,Te,M,ye,me,te,ce,De,Le,tt,xt,Qe,Dt,bt,qt,Fe,Wt,rt,On,Ei,ji,D,s]}class ly extends Wi{constructor(a){super(),Gi(this,a,ay,sy,Di,{map:13,class:1,style:16,diffStyleUpdates:17,center:10,zoom:11,pitch:14,bearing:15,bounds:12,hash:18,loaded:0,minZoom:19,maxZoom:20,zoomOnDoubleClick:21,interactive:22,attributionControl:23,preserveDrawingBuffer:24,maxBounds:25,images:26,standardControls:2,filterLayers:27,transformRequest:28},null,[-1,-1])}}function cy(p){let a,h,d,y,S,k,s;const D=p[16].default,M=go(D,p,p[15],null);return{c(){a=Ee("div"),M&&M.c(),ui(a,"tabindex",h=p[1]?0:void 0),ui(a,"role",d=p[1]?"button":void 0),jl(a,"z-index",p[2])},m(q,te){Ke(q,a,te),M&&M.m(a,null),S=!0,k||(s=[Rh(p[6].call(null,a)),Rh(y=uy.call(null,a,p[0])),li(a,"click",p[17]),li(a,"dblclick",p[18]),li(a,"contextmenu",p[19]),li(a,"mouseenter",p[20]),li(a,"mouseleave",p[21]),li(a,"mousemove",p[22]),li(a,"keydown",p[7])],k=!0)},p(q,[te]){M&&M.p&&(!S||te&32768)&&vo(M,D,q,q[15],S?yo(D,q[15],te,null):bo(q[15]),null),(!S||te&2&&h!==(h=q[1]?0:void 0))&&ui(a,"tabindex",h),(!S||te&2&&d!==(d=q[1]?"button":void 0))&&ui(a,"role",d),y&&Fu(y.update)&&te&1&&y.update.call(null,q[0]),te&4&&jl(a,"z-index",q[2])},i(q){S||(Pe(M,q),S=!0)},o(q){Ve(M,q),S=!1},d(q){q&&He(a),M&&M.d(q),k=!1,qo(s)}}}function uy(p,a){const h=p.className;function d(y){y?p.className=`${h} ${y}`:p.className=h}return d(a),{update:d}}function hy(p,a,h){let d,y,S,{$$slots:k={},$$scope:s}=a,{lngLat:D}=a,{class:M=void 0}=a,{interactive:q=!0}=a,{asButton:te=!1}=a,{draggable:ce=!1}=a,{feature:be=null}=a,{offset:he=void 0}=a,{zIndex:ye=void 0}=a;const me=Hc(),{map:Te,layerEvent:De,self:Ze}=kg();$t(p,Te,rt=>h(24,S=rt)),$t(p,De,rt=>h(23,d=rt)),$t(p,Ze,rt=>h(14,y=rt));function Le(rt){rn(Ze,y=new cs.Marker({element:rt,draggable:ce,offset:he}).setLngLat(D).addTo(S),y);const Qt=()=>Qe("dragstart"),Bt=()=>{tt(),Qe("drag")},At=()=>{tt(),Qe("dragend")};return ce&&(y.on("dragstart",Qt),y.on("drag",Bt),y.on("dragend",At)),{destroy(){ce&&(y==null||y.off("dragstart",Qt),y==null||y.off("drag",Bt),y==null||y.off("dragend",At)),y==null||y.remove()}}}function tt(){let rt=y==null?void 0:y.getLngLat();rt&&(Array.isArray(D)?h(9,D=[rt.lng,rt.lat]):D&&"lon"in D?h(9,D={lon:rt.lng,lat:rt.lat}):h(9,D=rt))}function xt(rt){rt.key===" "&&(rt.preventDefault(),rt.stopPropagation(),Qe("click"))}function Qe(rt){if(!q)return;let Qt=y==null?void 0:y.getLngLat();if(!Qt)return;const Bt=[Qt.lng,Qt.lat];let At={map:S,marker:y,lngLat:Bt,features:[{type:"Feature",properties:(be==null?void 0:be.properties)??{},geometry:{type:"Point",coordinates:Bt}}]};rn(De,d={...At,layerType:"marker",type:rt},d),me(rt,At)}const Dt=()=>Qe("click"),bt=()=>Qe("dblclick"),qt=()=>Qe("contextmenu"),Fe=rt=>{Qe("mouseenter")},$e=()=>{Qe("mouseleave")},Wt=()=>Qe("mousemove");return p.$$set=rt=>{"lngLat"in rt&&h(9,D=rt.lngLat),"class"in rt&&h(0,M=rt.class),"interactive"in rt&&h(10,q=rt.interactive),"asButton"in rt&&h(1,te=rt.asButton),"draggable"in rt&&h(11,ce=rt.draggable),"feature"in rt&&h(12,be=rt.feature),"offset"in rt&&h(13,he=rt.offset),"zIndex"in rt&&h(2,ye=rt.zIndex),"$$scope"in rt&&h(15,s=rt.$$scope)},p.$$.update=()=>{p.$$.dirty&16896&&(y==null||y.setLngLat(D)),p.$$.dirty&24576&&(y==null||y.setOffset(he??[0,0]))},[M,te,ye,Te,De,Ze,Le,xt,Qe,D,q,ce,be,he,y,s,k,Dt,bt,qt,Fe,$e,Wt]}class Hp extends Wi{constructor(a){super(),Gi(this,a,hy,cy,Di,{lngLat:9,class:0,interactive:10,asButton:1,draggable:11,feature:12,offset:13,zIndex:2})}}const dy=p=>({features:p[0]&16,data:p[0]&16,map:p[0]&4,close:p[0]&1}),Xp=p=>{var a;return{features:p[4],data:(a=p[4])==null?void 0:a[0],map:p[2],close:p[31]}};function Kp(p){let a,h,d=(p[4]||p[3]instanceof cs.Marker)&&Jp(p);return{c(){a=Ee("div"),d&&d.c()},m(y,S){Ke(y,a,S),d&&d.m(a,null),p[32](a),h=!0},p(y,S){y[4]||y[3]instanceof cs.Marker?d?(d.p(y,S),S[0]&24&&Pe(d,1)):(d=Jp(y),d.c(),Pe(d,1),d.m(a,null)):d&&(dr(),Ve(d,1,1,()=>{d=null}),pr())},i(y){h||(Pe(d),h=!0)},o(y){Ve(d),h=!1},d(y){y&&He(a),d&&d.d(),p[32](null)}}}function Jp(p){let a;const h=p[30].default,d=go(h,p,p[29],Xp);return{c(){d&&d.c()},m(y,S){d&&d.m(y,S),a=!0},p(y,S){d&&d.p&&(!a||S[0]&536870933)&&vo(d,h,y,y[29],a?yo(h,y[29],S,dy):bo(y[29]),Xp)},i(y){a||(Pe(d,y),a=!0)},o(y){Ve(d,y),a=!1},d(y){d&&d.d(y)}}}function py(p){let a,h,d=p[9].default&&Kp(p);return{c(){d&&d.c(),a=us()},m(y,S){d&&d.m(y,S),Ke(y,a,S),h=!0},p(y,S){y[9].default?d?(d.p(y,S),S[0]&512&&Pe(d,1)):(d=Kp(y),d.c(),Pe(d,1),d.m(a.parentNode,a)):d&&(dr(),Ve(d,1,1,()=>{d=null}),pr())},i(y){h||(Pe(d),h=!0)},o(y){Ve(d),h=!1},d(y){y&&He(a),d&&d.d(y)}}}function fy(p,a,h){let d,y,S,k,s,D,{$$slots:M={},$$scope:q}=a;const te=X_(M);let{closeButton:ce=void 0}=a,{closeOnClickOutside:be=!0}=a,{closeOnClickInside:he=!1}=a,{closeOnMove:ye=!1}=a,{openOn:me="click"}=a,{openIfTopMost:Te=!0}=a,{focusAfterOpen:De=!0}=a,{anchor:Ze=void 0}=a,{offset:Le=void 0}=a,{popupClass:tt=void 0}=a,{maxWidth:xt=void 0}=a,{lngLat:Qe=void 0}=a,{html:Dt=void 0}=a,{open:bt=!1}=a;const{map:qt,popupTarget:Fe,layerEvent:$e,layer:Wt,eventTopMost:rt}=Hl();$t(p,qt,Je=>h(2,S=Je)),$t(p,Fe,Je=>h(3,s=Je)),$t(p,$e,Je=>h(28,k=Je)),$t(p,Wt,Je=>h(35,D=Je));const Qt=["click","dblclick","contextmenu"];let Bt,At=!1,hi;function Rn(){if(!Bt)return;let Je=Bt.getElement();!Je||Je===hi||(hi=Je,me==="hover"&&(hi.style.pointerEvents="none"),hi.addEventListener("mouseenter",()=>{h(24,At=!0)},{passive:!0}),hi.addEventListener("mouseleave",()=>{h(24,At=!1)},{passive:!0}),hi.addEventListener("click",()=>{he&&h(0,bt=!1)},{passive:!0}))}Wc(()=>{if(S)return S.on("click",oi),S.on("contextmenu",oi),typeof s=="string"&&(S.on("click",s,Nt),S.on("dblclick",s,Nt),S.on("contextmenu",s,Nt),S.on("mousemove",s,nt),S.on("mouseleave",s,Zt),S.on("touchstart",s,ji),S.on("touchend",s,qe)),()=>{S!=null&&S.loaded()&&(Bt==null||Bt.remove(),S.off("click",oi),S.off("contextmenu",oi),s instanceof cs.Marker?s.getPopup()===Bt&&s.setPopup(void 0):typeof s=="string"&&(S.off("click",s,Nt),S.off("dblclick",s,Nt),S.off("contextmenu",s,Nt),S.off("mousemove",s,nt),S.off("mouseleave",s,Zt),S.off("touchstart",s,ji),S.off("touchend",s,qe)))}});function On(Je){return Te?!("marker"in Je)&&!Eg(Je)&&rt(Je)!==D:!1}let Ei=null,Mi="normal";function Nt(Je){Je.type===me&&(On(Je)||("layerType"in Je?Je.layerType==="deckgl"?(h(10,Qe=Je.coordinate),h(4,Ei=Je.object?[Je.object]:null)):(h(10,Qe=Je.lngLat),h(4,Ei=Je.features??[])):(h(10,Qe=Je.lngLat),h(4,Ei=Je.features??[])),setTimeout(()=>h(0,bt=!0))))}let bi=null;function ji(Je){bi=Je.point}function qe(Je){if(!bi||me!=="hover")return;let Fi=bi.dist(Je.point);bi=null,Fi<3&&(h(10,Qe=Je.lngLat),h(4,Ei=Je.features??[]),Bt.isOpen()?h(25,Mi="justOpened"):(h(25,Mi="opening"),h(0,bt=!0)))}function Zt(Je){me!=="hover"||bi||Mi!=="normal"||(h(0,bt=!1),h(4,Ei=null))}function nt(Je){if(!(me!=="hover"||bi||Mi!=="normal")){if(On(Je)){h(0,bt=!1),h(4,Ei=null);return}h(0,bt=!0),h(4,Ei=Je.features??[]),h(10,Qe=Je.lngLat)}}function oi(Je){if(Mi==="justOpened"){h(25,Mi="normal");return}if(!be)return;let Fi=[hi,s instanceof cs.Marker?s==null?void 0:s.getElement():null];bt&&Bt.isOpen()&&!Fi.some(wn=>wn==null?void 0:wn.contains(Je.originalEvent.target))&&(Je.type==="contextmenu"&&me==="contextmenu"||Je.type!=="contextmenu")&&h(0,bt=!1)}let vt;const qi=()=>h(0,bt=!1);function xn(Je){qr[Je?"unshift":"push"](()=>{vt=Je,h(1,vt)})}return p.$$set=Je=>{"closeButton"in Je&&h(11,ce=Je.closeButton),"closeOnClickOutside"in Je&&h(12,be=Je.closeOnClickOutside),"closeOnClickInside"in Je&&h(13,he=Je.closeOnClickInside),"closeOnMove"in Je&&h(14,ye=Je.closeOnMove),"openOn"in Je&&h(15,me=Je.openOn),"openIfTopMost"in Je&&h(16,Te=Je.openIfTopMost),"focusAfterOpen"in Je&&h(17,De=Je.focusAfterOpen),"anchor"in Je&&h(18,Ze=Je.anchor),"offset"in Je&&h(19,Le=Je.offset),"popupClass"in Je&&h(20,tt=Je.popupClass),"maxWidth"in Je&&h(21,xt=Je.maxWidth),"lngLat"in Je&&h(10,Qe=Je.lngLat),"html"in Je&&h(22,Dt=Je.html),"open"in Je&&h(0,bt=Je.open),"$$scope"in Je&&h(29,q=Je.$$scope)},p.$$.update=()=>{if(p.$$.dirty[0]&14336&&h(27,d=ce??(!be&&!he)),p.$$.dirty[0]&146685952&&(Bt||(h(23,Bt=new cs.Popup({closeButton:d,closeOnClick:!1,closeOnMove:ye,focusAfterOpen:De,maxWidth:xt,className:tt,anchor:Ze,offset:Le})),hi=Bt.getElement(),Bt.on("open",()=>{h(0,bt=!0),Rn()}),Bt.on("close",Je=>{h(0,bt=!1)}))),p.$$.dirty[0]&8421384&&Bt&&s instanceof cs.Marker&&(me==="click"?s.setPopup(Bt):s.getPopup()===Bt&&s.setPopup(void 0)),p.$$.dirty[0]&268468224&&Qt.includes(me)&&(k==null?void 0:k.type)===me&&(Nt(k),rn($e,k=null,k)),p.$$.dirty[0]&268468224&&h(26,y=me==="hover"&&((k==null?void 0:k.type)==="mousemove"||(k==null?void 0:k.type)==="mouseenter")),p.$$.dirty[0]&352354304&&me==="hover"&&$e&&(y&&k&&(k.layerType==="deckgl"?(h(10,Qe=k.coordinate),h(4,Ei=k.object?[k.object]:null)):(h(10,Qe=k.lngLat),h(4,Ei=k.features??[]))),h(0,bt=(y||At)??!1)),p.$$.dirty[0]&12582914&&(vt?Bt.setDOMContent(vt):Dt&&Bt.setHTML(Dt)),p.$$.dirty[0]&8389632&&Qe&&Bt.setLngLat(Qe),p.$$.dirty[0]&41943045&&S){let Je=Bt.isOpen();bt&&!Je?(Bt.addTo(S),Mi==="opening"&&h(25,Mi="justOpened")):!bt&&Je&&Bt.remove()}},[bt,vt,S,s,Ei,qt,Fe,$e,Wt,te,Qe,ce,be,he,ye,me,Te,De,Ze,Le,tt,xt,Dt,Bt,At,Mi,y,d,k,q,M,qi,xn]}class Kc extends Wi{constructor(a){super(),Gi(this,a,fy,py,Di,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}var Jc=Uint8Array,Of=Uint16Array,my=Int32Array,_y=new Jc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),gy=new Jc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Bf=function(p,a){for(var h=new Of(31),d=0;d<31;++d)h[d]=a+=1<<p[d-1];for(var y=new my(h[30]),d=1;d<30;++d)for(var S=h[d];S<h[d+1];++S)y[S]=S-h[d]<<5|d;return{b:h,r:y}},Nf=Bf(_y,2),yy=Nf.b,vy=Nf.r;yy[28]=258,vy[258]=28;Bf(gy,0);var by=new Of(32768);for($i=0;$i<32768;++$i)ca=($i&43690)>>1|($i&21845)<<1,ca=(ca&52428)>>2|(ca&13107)<<2,ca=(ca&61680)>>4|(ca&3855)<<4,by[$i]=((ca&65280)>>8|(ca&255)<<8)>>1;var ca,$i,Ou=new Jc(288);for($i=0;$i<144;++$i)Ou[$i]=8;var $i;for($i=144;$i<256;++$i)Ou[$i]=9;var $i;for($i=256;$i<280;++$i)Ou[$i]=7;var $i;for($i=280;$i<288;++$i)Ou[$i]=8;var $i,xy=new Jc(32);for($i=0;$i<32;++$i)xy[$i]=5;var $i,wy=new Jc(0),Sy=typeof TextDecoder<"u"&&new TextDecoder,Ty=0;try{Sy.decode(wy,{stream:!0}),Ty=1}catch{}const Iy=p=>({}),Yp=p=>({}),Cy=p=>({}),Qp=p=>({});function ky(p){let a,h,d,y;const S=p[1].left,k=go(S,p,p[0],Qp),s=p[1].main,D=go(s,p,p[0],Yp);return{c(){a=Ee("div"),k&&k.c(),h=Tt(),d=Ee("div"),D&&D.c(),ui(a,"class","left svelte-6kzmjs"),ui(d,"class","main svelte-6kzmjs")},m(M,q){Ke(M,a,q),k&&k.m(a,null),Ke(M,h,q),Ke(M,d,q),D&&D.m(d,null),y=!0},p(M,[q]){k&&k.p&&(!y||q&1)&&vo(k,S,M,M[0],y?yo(S,M[0],q,Cy):bo(M[0]),Qp),D&&D.p&&(!y||q&1)&&vo(D,s,M,M[0],y?yo(s,M[0],q,Iy):bo(M[0]),Yp)},i(M){y||(Pe(k,M),Pe(D,M),y=!0)},o(M){Ve(k,M),Ve(D,M),y=!1},d(M){M&&(He(a),He(h),He(d)),k&&k.d(M),D&&D.d(M)}}}function Ey(p,a,h){let{$$slots:d={},$$scope:y}=a;return p.$$set=S=>{"$$scope"in S&&h(0,y=S.$$scope)},[y,d]}class My extends Wi{constructor(a){super(),Gi(this,a,Ey,ky,Di,{})}}function $p(p){let a,h;return{c(){a=Ee("div"),h=ki(p[0]),ui(a,"class","svelte-1uuov7f")},m(d,y){Ke(d,a,y),we(a,h)},p(d,y){y&1&&xo(h,d[0])},d(d){d&&He(a)}}}function Ay(p){let a,h=p[0]&&$p(p);return{c(){h&&h.c(),a=us()},m(d,y){h&&h.m(d,y),Ke(d,a,y)},p(d,[y]){d[0]?h?h.p(d,y):(h=$p(d),h.c(),h.m(a.parentNode,a)):h&&(h.d(1),h=null)},i:_i,o:_i,d(d){d&&He(a),h&&h.d(d)}}}function Py(p,a,h){let{msg:d=null}=a;return p.$$set=y=>{"msg"in y&&h(0,d=y.msg)},[d]}class Vf extends Wi{constructor(a){super(),Gi(this,a,Py,Ay,Di,{msg:0})}}const Ly=p=>({dialog:p&1}),ef=p=>({dialog:p[0]});function zy(p){let a,h,d,y,S;const k=p[2].default,s=go(k,p,p[1],ef);return{c(){a=Ee("dialog"),h=Ee("div"),s&&s.c(),ui(h,"class","svelte-1u3y8t2"),a.open=!0,ui(a,"class","svelte-1u3y8t2")},m(D,M){Ke(D,a,M),we(a,h),s&&s.m(h,null),p[4](a),d=!0,y||(S=li(a,"close",p[3]),y=!0)},p(D,[M]){s&&s.p&&(!d||M&3)&&vo(s,k,D,D[1],d?yo(k,D[1],M,Ly):bo(D[1]),ef)},i(D){d||(Pe(s,D),d=!0)},o(D){Ve(s,D),d=!1},d(D){D&&He(a),s&&s.d(D),p[4](null),y=!1,S()}}}function Dy(p,a,h){let{$$slots:d={},$$scope:y}=a,S;function k(D){ur.call(this,p,D)}function s(D){qr[D?"unshift":"push"](()=>{S=D,h(0,S)})}return p.$$set=D=>{"$$scope"in D&&h(1,y=D.$$scope)},[S,y,d,k,s]}class Uf extends Wi{constructor(a){super(),Gi(this,a,Dy,zy,Di,{})}}var jf={exports:{}};(function(p,a){(function(h,d){p.exports=d()})(Ul,function(){var h=function(v,E){var V={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},Q={on:function(le,xe,Ge){if(V[le]===void 0)throw new Error("Invalid event type: "+le);V[le].push({selector:xe,fn:Ge})},render:function(le){E.store.featureChanged(le)}},se=function(le,xe){for(var Ge=V[le],Ye=Ge.length;Ye--;){var mt=Ge[Ye];if(mt.selector(xe)){mt.fn.call(Q,xe)||E.store.render(),E.ui.updateMapClasses();break}}};return v.start.call(Q),{render:v.render,stop:function(){v.stop&&v.stop()},trash:function(){v.trash&&(v.trash(),E.store.render())},combineFeatures:function(){v.combineFeatures&&v.combineFeatures()},uncombineFeatures:function(){v.uncombineFeatures&&v.uncombineFeatures()},drag:function(le){se("drag",le)},click:function(le){se("click",le)},mousemove:function(le){se("mousemove",le)},mousedown:function(le){se("mousedown",le)},mouseup:function(le){se("mouseup",le)},mouseout:function(le){se("mouseout",le)},keydown:function(le){se("keydown",le)},keyup:function(le){se("keyup",le)},touchstart:function(le){se("touchstart",le)},touchmove:function(le){se("touchmove",le)},touchend:function(le){se("touchend",le)},tap:function(le){se("tap",le)}}};function d(v){return v&&v.__esModule&&Object.prototype.hasOwnProperty.call(v,"default")?v.default:v}function y(v){if(v.__esModule)return v;var E=v.default;if(typeof E=="function"){var V=function Q(){if(this instanceof Q){var se=[null];se.push.apply(se,arguments);var le=Function.bind.apply(E,se);return new le}return E.apply(this,arguments)};V.prototype=E.prototype}else V={};return Object.defineProperty(V,"__esModule",{value:!0}),Object.keys(v).forEach(function(Q){var se=Object.getOwnPropertyDescriptor(v,Q);Object.defineProperty(V,Q,se.get?se:{enumerable:!0,get:function(){return v[Q]}})}),V}var S={},k={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},s=k;function D(v){var E=0;if(v&&v.length>0){E+=Math.abs(M(v[0]));for(var V=1;V<v.length;V++)E-=Math.abs(M(v[V]))}return E}function M(v){var E,V,Q,se,le,xe,Ge=0,Ye=v.length;if(Ye>2){for(xe=0;xe<Ye;xe++)xe===Ye-2?(Q=Ye-2,se=Ye-1,le=0):xe===Ye-1?(Q=Ye-1,se=0,le=1):(Q=xe,se=xe+1,le=xe+2),E=v[Q],V=v[se],Ge+=(q(v[le][0])-q(E[0]))*Math.sin(q(V[1]));Ge=Ge*s.RADIUS*s.RADIUS/2}return Ge}function q(v){return v*Math.PI/180}S.geometry=function v(E){var V,Q=0;switch(E.type){case"Polygon":return D(E.coordinates);case"MultiPolygon":for(V=0;V<E.coordinates.length;V++)Q+=D(E.coordinates[V]);return Q;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(V=0;V<E.geometries.length;V++)Q+=v(E.geometries[V]);return Q}},S.ring=M;var te={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},ce={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},be={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},he={POLYGON:"polygon",LINE:"line_string",POINT:"point"},ye={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},me={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},Te={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},De={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},Ze={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Le={ACTIVE:"true",INACTIVE:"false"},tt=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],xt=-85,Qe=Object.freeze({__proto__:null,classes:te,sources:ce,cursors:be,types:he,geojsonTypes:ye,modes:me,events:Te,updateActions:De,meta:Ze,activeStates:Le,interactions:tt,LAT_MIN:-90,LAT_RENDERED_MIN:xt,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),Dt={Point:0,LineString:1,MultiLineString:1,Polygon:2};function bt(v,E){var V=Dt[v.geometry.type]-Dt[E.geometry.type];return V===0&&v.geometry.type===ye.POLYGON?v.area-E.area:V}function qt(v){return v.map(function(E){return E.geometry.type===ye.POLYGON&&(E.area=S.geometry({type:ye.FEATURE,property:{},geometry:E.geometry})),E}).sort(bt).map(function(E){return delete E.area,E})}function Fe(v,E){return E===void 0&&(E=0),[[v.point.x-E,v.point.y-E],[v.point.x+E,v.point.y+E]]}function $e(v){if(this._items={},this._nums={},this._length=v?v.length:0,v)for(var E=0,V=v.length;E<V;E++)this.add(v[E]),v[E]!==void 0&&(typeof v[E]=="string"?this._items[v[E]]=E:this._nums[v[E]]=E)}$e.prototype.add=function(v){return this.has(v)||(this._length++,typeof v=="string"?this._items[v]=this._length:this._nums[v]=this._length),this},$e.prototype.delete=function(v){return this.has(v)===!1||(this._length--,delete this._items[v],delete this._nums[v]),this},$e.prototype.has=function(v){return(typeof v=="string"||typeof v=="number")&&(this._items[v]!==void 0||this._nums[v]!==void 0)},$e.prototype.values=function(){var v=this,E=[];return Object.keys(this._items).forEach(function(V){E.push({k:V,v:v._items[V]})}),Object.keys(this._nums).forEach(function(V){E.push({k:JSON.parse(V),v:v._nums[V]})}),E.sort(function(V,Q){return V.v-Q.v}).map(function(V){return V.k})},$e.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var Wt=[Ze.FEATURE,Ze.MIDPOINT,Ze.VERTEX],rt={click:function(v,E,V){return Qt(v,E,V,V.options.clickBuffer)},touch:function(v,E,V){return Qt(v,E,V,V.options.touchBuffer)}};function Qt(v,E,V,Q){if(V.map===null)return[];var se=v?Fe(v,Q):E,le={};V.options.styles&&(le.layers=V.options.styles.map(function(mt){return mt.id}).filter(function(mt){return V.map.getLayer(mt)!=null}));var xe=V.map.queryRenderedFeatures(se,le).filter(function(mt){return Wt.indexOf(mt.properties.meta)!==-1}),Ge=new $e,Ye=[];return xe.forEach(function(mt){var _t=mt.properties.id;Ge.has(_t)||(Ge.add(_t),Ye.push(mt))}),qt(Ye)}function Bt(v,E){var V=rt.click(v,null,E),Q={mouse:be.NONE};return V[0]&&(Q.mouse=V[0].properties.active===Le.ACTIVE?be.MOVE:be.POINTER,Q.feature=V[0].properties.meta),E.events.currentModeName().indexOf("draw")!==-1&&(Q.mouse=be.ADD),E.ui.queueMapClasses(Q),E.ui.updateMapClasses(),V[0]}function At(v,E){var V=v.x-E.x,Q=v.y-E.y;return Math.sqrt(V*V+Q*Q)}function hi(v,E,V){V===void 0&&(V={});var Q=V.fineTolerance!=null?V.fineTolerance:4,se=V.grossTolerance!=null?V.grossTolerance:12,le=V.interval!=null?V.interval:500;v.point=v.point||E.point,v.time=v.time||E.time;var xe=At(v.point,E.point);return xe<Q||xe<se&&E.time-v.time<le}function Rn(v,E,V){V===void 0&&(V={});var Q=V.tolerance!=null?V.tolerance:25,se=V.interval!=null?V.interval:250;return v.point=v.point||E.point,v.time=v.time||E.time,At(v.point,E.point)<Q&&E.time-v.time<se}var On={exports:{}},Ei=On.exports=function(v,E){if(E||(E=16),v===void 0&&(v=128),v<=0)return"0";for(var V=Math.log(Math.pow(2,v))/Math.log(E),Q=2;V===1/0;Q*=2)V=Math.log(Math.pow(2,v/Q))/Math.log(E)*Q;var se=V-Math.floor(V),le="";for(Q=0;Q<Math.floor(V);Q++)le=Math.floor(Math.random()*E).toString(E)+le;if(se){var xe=Math.pow(E,se);le=Math.floor(Math.random()*xe).toString(E)+le}var Ge=parseInt(le,E);return Ge!==1/0&&Ge>=Math.pow(2,v)?Ei(v,E):le};Ei.rack=function(v,E,V){var Q=function(le){var xe=0;do{if(xe++>10){if(!V)throw new Error("too many ID collisions, use more bits");v+=V}var Ge=Ei(v,E)}while(Object.hasOwnProperty.call(se,Ge));return se[Ge]=le,Ge},se=Q.hats={};return Q.get=function(le){return Q.hats[le]},Q.set=function(le,xe){return Q.hats[le]=xe,Q},Q.bits=v||128,Q.base=E||16,Q};var Mi=d(On.exports),Nt=function(v,E){this.ctx=v,this.properties=E.properties||{},this.coordinates=E.geometry.coordinates,this.id=E.id||Mi(),this.type=E.geometry.type};Nt.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},Nt.prototype.incomingCoords=function(v){this.setCoordinates(v)},Nt.prototype.setCoordinates=function(v){this.coordinates=v,this.changed()},Nt.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},Nt.prototype.setProperty=function(v,E){this.properties[v]=E},Nt.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:ye.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},Nt.prototype.internal=function(v){var E={id:this.id,meta:Ze.FEATURE,"meta:type":this.type,active:Le.INACTIVE,mode:v};if(this.ctx.options.userProperties)for(var V in this.properties)E["user_"+V]=this.properties[V];return{type:ye.FEATURE,properties:E,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var bi=function(v,E){Nt.call(this,v,E)};(bi.prototype=Object.create(Nt.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},bi.prototype.updateCoordinate=function(v,E,V){this.coordinates=arguments.length===3?[E,V]:[v,E],this.changed()},bi.prototype.getCoordinate=function(){return this.getCoordinates()};var ji=function(v,E){Nt.call(this,v,E)};(ji.prototype=Object.create(Nt.prototype)).isValid=function(){return this.coordinates.length>1},ji.prototype.addCoordinate=function(v,E,V){this.changed();var Q=parseInt(v,10);this.coordinates.splice(Q,0,[E,V])},ji.prototype.getCoordinate=function(v){var E=parseInt(v,10);return JSON.parse(JSON.stringify(this.coordinates[E]))},ji.prototype.removeCoordinate=function(v){this.changed(),this.coordinates.splice(parseInt(v,10),1)},ji.prototype.updateCoordinate=function(v,E,V){var Q=parseInt(v,10);this.coordinates[Q]=[E,V],this.changed()};var qe=function(v,E){Nt.call(this,v,E),this.coordinates=this.coordinates.map(function(V){return V.slice(0,-1)})};(qe.prototype=Object.create(Nt.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(v){return v.length>2})},qe.prototype.incomingCoords=function(v){this.coordinates=v.map(function(E){return E.slice(0,-1)}),this.changed()},qe.prototype.setCoordinates=function(v){this.coordinates=v,this.changed()},qe.prototype.addCoordinate=function(v,E,V){this.changed();var Q=v.split(".").map(function(se){return parseInt(se,10)});this.coordinates[Q[0]].splice(Q[1],0,[E,V])},qe.prototype.removeCoordinate=function(v){this.changed();var E=v.split(".").map(function(Q){return parseInt(Q,10)}),V=this.coordinates[E[0]];V&&(V.splice(E[1],1),V.length<3&&this.coordinates.splice(E[0],1))},qe.prototype.getCoordinate=function(v){var E=v.split(".").map(function(Q){return parseInt(Q,10)}),V=this.coordinates[E[0]];return JSON.parse(JSON.stringify(V[E[1]]))},qe.prototype.getCoordinates=function(){return this.coordinates.map(function(v){return v.concat([v[0]])})},qe.prototype.updateCoordinate=function(v,E,V){this.changed();var Q=v.split("."),se=parseInt(Q[0],10),le=parseInt(Q[1],10);this.coordinates[se]===void 0&&(this.coordinates[se]=[]),this.coordinates[se][le]=[E,V]};var Zt={MultiPoint:bi,MultiLineString:ji,MultiPolygon:qe},nt=function(v,E,V,Q,se){var le=V.split("."),xe=parseInt(le[0],10),Ge=le[1]?le.slice(1).join("."):null;return v[xe][E](Ge,Q,se)},oi=function(v,E){if(Nt.call(this,v,E),delete this.coordinates,this.model=Zt[E.geometry.type],this.model===void 0)throw new TypeError(E.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(E.geometry.coordinates)};function vt(v){this.map=v.map,this.drawConfig=JSON.parse(JSON.stringify(v.options||{})),this._ctx=v}(oi.prototype=Object.create(Nt.prototype))._coordinatesToFeatures=function(v){var E=this,V=this.model.bind(this);return v.map(function(Q){return new V(E.ctx,{id:Mi(),type:ye.FEATURE,properties:{},geometry:{coordinates:Q,type:E.type.replace("Multi","")}})})},oi.prototype.isValid=function(){return this.features.every(function(v){return v.isValid()})},oi.prototype.setCoordinates=function(v){this.features=this._coordinatesToFeatures(v),this.changed()},oi.prototype.getCoordinate=function(v){return nt(this.features,"getCoordinate",v)},oi.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(v){return v.type===ye.POLYGON?v.getCoordinates():v.coordinates})))},oi.prototype.updateCoordinate=function(v,E,V){nt(this.features,"updateCoordinate",v,E,V),this.changed()},oi.prototype.addCoordinate=function(v,E,V){nt(this.features,"addCoordinate",v,E,V),this.changed()},oi.prototype.removeCoordinate=function(v){nt(this.features,"removeCoordinate",v),this.changed()},oi.prototype.getFeatures=function(){return this.features},vt.prototype.setSelected=function(v){return this._ctx.store.setSelected(v)},vt.prototype.setSelectedCoordinates=function(v){var E=this;this._ctx.store.setSelectedCoordinates(v),v.reduce(function(V,Q){return V[Q.feature_id]===void 0&&(V[Q.feature_id]=!0,E._ctx.store.get(Q.feature_id).changed()),V},{})},vt.prototype.getSelected=function(){return this._ctx.store.getSelected()},vt.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},vt.prototype.isSelected=function(v){return this._ctx.store.isSelected(v)},vt.prototype.getFeature=function(v){return this._ctx.store.get(v)},vt.prototype.select=function(v){return this._ctx.store.select(v)},vt.prototype.deselect=function(v){return this._ctx.store.deselect(v)},vt.prototype.deleteFeature=function(v,E){return E===void 0&&(E={}),this._ctx.store.delete(v,E)},vt.prototype.addFeature=function(v){return this._ctx.store.add(v)},vt.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},vt.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},vt.prototype.setActionableState=function(v){v===void 0&&(v={});var E={trash:v.trash||!1,combineFeatures:v.combineFeatures||!1,uncombineFeatures:v.uncombineFeatures||!1};return this._ctx.events.actionable(E)},vt.prototype.changeMode=function(v,E,V){return E===void 0&&(E={}),V===void 0&&(V={}),this._ctx.events.changeMode(v,E,V)},vt.prototype.updateUIClasses=function(v){return this._ctx.ui.queueMapClasses(v)},vt.prototype.activateUIButton=function(v){return this._ctx.ui.setActiveButton(v)},vt.prototype.featuresAt=function(v,E,V){if(V===void 0&&(V="click"),V!=="click"&&V!=="touch")throw new Error("invalid buffer type");return rt[V](v,E,this._ctx)},vt.prototype.newFeature=function(v){var E=v.geometry.type;return E===ye.POINT?new bi(this._ctx,v):E===ye.LINE_STRING?new ji(this._ctx,v):E===ye.POLYGON?new qe(this._ctx,v):new oi(this._ctx,v)},vt.prototype.isInstanceOf=function(v,E){if(v===ye.POINT)return E instanceof bi;if(v===ye.LINE_STRING)return E instanceof ji;if(v===ye.POLYGON)return E instanceof qe;if(v==="MultiFeature")return E instanceof oi;throw new Error("Unknown feature class: "+v)},vt.prototype.doRender=function(v){return this._ctx.store.featureChanged(v)},vt.prototype.onSetup=function(){},vt.prototype.onDrag=function(){},vt.prototype.onClick=function(){},vt.prototype.onMouseMove=function(){},vt.prototype.onMouseDown=function(){},vt.prototype.onMouseUp=function(){},vt.prototype.onMouseOut=function(){},vt.prototype.onKeyUp=function(){},vt.prototype.onKeyDown=function(){},vt.prototype.onTouchStart=function(){},vt.prototype.onTouchMove=function(){},vt.prototype.onTouchEnd=function(){},vt.prototype.onTap=function(){},vt.prototype.onStop=function(){},vt.prototype.onTrash=function(){},vt.prototype.onCombineFeature=function(){},vt.prototype.onUncombineFeature=function(){},vt.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var qi={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},xn=Object.keys(qi);function Je(v){var E=Object.keys(v);return function(V,Q){Q===void 0&&(Q={});var se={},le=E.reduce(function(xe,Ge){return xe[Ge]=v[Ge],xe},new vt(V));return{start:function(){var xe=this;se=le.onSetup(Q),xn.forEach(function(Ge){var Ye,mt=qi[Ge],_t=function(){return!1};v[mt]&&(_t=function(){return!0}),xe.on(Ge,_t,(Ye=mt,function(ct){return le[Ye](se,ct)}))})},stop:function(){le.onStop(se)},trash:function(){le.onTrash(se)},combineFeatures:function(){le.onCombineFeatures(se)},uncombineFeatures:function(){le.onUncombineFeatures(se)},render:function(xe,Ge){le.toDisplayFeatures(se,xe,Ge)}}}}function Fi(v){return[].concat(v).filter(function(E){return E!==void 0})}function wn(){var v=this;if(!(v.ctx.map&&v.ctx.map.getSource(ce.HOT)!==void 0))return Ye();var E=v.ctx.events.currentModeName();v.ctx.ui.queueMapClasses({mode:E});var V=[],Q=[];v.isDirty?Q=v.getAllIds():(V=v.getChangedIds().filter(function(mt){return v.get(mt)!==void 0}),Q=v.sources.hot.filter(function(mt){return mt.properties.id&&V.indexOf(mt.properties.id)===-1&&v.get(mt.properties.id)!==void 0}).map(function(mt){return mt.properties.id})),v.sources.hot=[];var se=v.sources.cold.length;v.sources.cold=v.isDirty?[]:v.sources.cold.filter(function(mt){var _t=mt.properties.id||mt.properties.parent;return V.indexOf(_t)===-1});var le=se!==v.sources.cold.length||Q.length>0;function xe(mt,_t){var ct=v.get(mt).internal(E);v.ctx.events.currentModeRender(ct,function(ti){v.sources[_t].push(ti)})}if(V.forEach(function(mt){return xe(mt,"hot")}),Q.forEach(function(mt){return xe(mt,"cold")}),le&&v.ctx.map.getSource(ce.COLD).setData({type:ye.FEATURE_COLLECTION,features:v.sources.cold}),v.ctx.map.getSource(ce.HOT).setData({type:ye.FEATURE_COLLECTION,features:v.sources.hot}),v._emitSelectionChange&&(v.ctx.map.fire(Te.SELECTION_CHANGE,{features:v.getSelected().map(function(mt){return mt.toGeoJSON()}),points:v.getSelectedCoordinates().map(function(mt){return{type:ye.FEATURE,properties:{},geometry:{type:ye.POINT,coordinates:mt.coordinates}}})}),v._emitSelectionChange=!1),v._deletedFeaturesToEmit.length){var Ge=v._deletedFeaturesToEmit.map(function(mt){return mt.toGeoJSON()});v._deletedFeaturesToEmit=[],v.ctx.map.fire(Te.DELETE,{features:Ge})}function Ye(){v.isDirty=!1,v.clearChangedIds()}Ye(),v.ctx.map.fire(Te.RENDER,{})}function xi(v){var E,V=this;this._features={},this._featureIds=new $e,this._selectedFeatureIds=new $e,this._selectedCoordinates=[],this._changedFeatureIds=new $e,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=v,this.sources={hot:[],cold:[]},this.render=function(){E||(E=requestAnimationFrame(function(){E=null,wn.call(V)}))},this.isDirty=!1}function Zr(v,E){var V=v._selectedCoordinates.filter(function(Q){return v._selectedFeatureIds.has(Q.feature_id)});v._selectedCoordinates.length===V.length||E.silent||(v._emitSelectionChange=!0),v._selectedCoordinates=V}xi.prototype.createRenderBatch=function(){var v=this,E=this.render,V=0;return this.render=function(){V++},function(){v.render=E,V>0&&v.render()}},xi.prototype.setDirty=function(){return this.isDirty=!0,this},xi.prototype.featureChanged=function(v){return this._changedFeatureIds.add(v),this},xi.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},xi.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},xi.prototype.getAllIds=function(){return this._featureIds.values()},xi.prototype.add=function(v){return this.featureChanged(v.id),this._features[v.id]=v,this._featureIds.add(v.id),this},xi.prototype.delete=function(v,E){var V=this;return E===void 0&&(E={}),Fi(v).forEach(function(Q){V._featureIds.has(Q)&&(V._featureIds.delete(Q),V._selectedFeatureIds.delete(Q),E.silent||V._deletedFeaturesToEmit.indexOf(V._features[Q])===-1&&V._deletedFeaturesToEmit.push(V._features[Q]),delete V._features[Q],V.isDirty=!0)}),Zr(this,E),this},xi.prototype.get=function(v){return this._features[v]},xi.prototype.getAll=function(){var v=this;return Object.keys(this._features).map(function(E){return v._features[E]})},xi.prototype.select=function(v,E){var V=this;return E===void 0&&(E={}),Fi(v).forEach(function(Q){V._selectedFeatureIds.has(Q)||(V._selectedFeatureIds.add(Q),V._changedFeatureIds.add(Q),E.silent||(V._emitSelectionChange=!0))}),this},xi.prototype.deselect=function(v,E){var V=this;return E===void 0&&(E={}),Fi(v).forEach(function(Q){V._selectedFeatureIds.has(Q)&&(V._selectedFeatureIds.delete(Q),V._changedFeatureIds.add(Q),E.silent||(V._emitSelectionChange=!0))}),Zr(this,E),this},xi.prototype.clearSelected=function(v){return v===void 0&&(v={}),this.deselect(this._selectedFeatureIds.values(),{silent:v.silent}),this},xi.prototype.setSelected=function(v,E){var V=this;return E===void 0&&(E={}),v=Fi(v),this.deselect(this._selectedFeatureIds.values().filter(function(Q){return v.indexOf(Q)===-1}),{silent:E.silent}),this.select(v.filter(function(Q){return!V._selectedFeatureIds.has(Q)}),{silent:E.silent}),this},xi.prototype.setSelectedCoordinates=function(v){return this._selectedCoordinates=v,this._emitSelectionChange=!0,this},xi.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},xi.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},xi.prototype.getSelected=function(){var v=this;return this._selectedFeatureIds.values().map(function(E){return v.get(E)})},xi.prototype.getSelectedCoordinates=function(){var v=this;return this._selectedCoordinates.map(function(E){return{coordinates:v.get(E.feature_id).getCoordinate(E.coord_path)}})},xi.prototype.isSelected=function(v){return this._selectedFeatureIds.has(v)},xi.prototype.setFeatureProperty=function(v,E,V){this.get(v).setProperty(E,V),this.featureChanged(v)},xi.prototype.storeMapConfig=function(){var v=this;tt.forEach(function(E){v.ctx.map[E]&&(v._mapInitialConfig[E]=v.ctx.map[E].isEnabled())})},xi.prototype.restoreMapConfig=function(){var v=this;Object.keys(this._mapInitialConfig).forEach(function(E){v._mapInitialConfig[E]?v.ctx.map[E].enable():v.ctx.map[E].disable()})},xi.prototype.getInitialConfigValue=function(v){return this._mapInitialConfig[v]===void 0||this._mapInitialConfig[v]};var fr=function(){for(var v=arguments,E={},V=0;V<arguments.length;V++){var Q=v[V];for(var se in Q)Zn.call(Q,se)&&(E[se]=Q[se])}return E},Zn=Object.prototype.hasOwnProperty,Me=d(fr),Kn=["mode","feature","mouse"];function mr(v){var E=null,V=null,Q={onRemove:function(){return v.map.off("load",Q.connect),clearInterval(V),Q.removeLayers(),v.store.restoreMapConfig(),v.ui.removeButtons(),v.events.removeEventListeners(),v.ui.clearMapClasses(),v.boxZoomInitial&&v.map.boxZoom.enable(),v.map=null,v.container=null,v.store=null,E&&E.parentNode&&E.parentNode.removeChild(E),E=null,this},connect:function(){v.map.off("load",Q.connect),clearInterval(V),Q.addLayers(),v.store.storeMapConfig(),v.events.addEventListeners()},onAdd:function(se){var le=se.fire;return se.fire=function(xe,Ge){var Ye=arguments;return le.length===1&&arguments.length!==1&&(Ye=[Me({},{type:xe},Ge)]),le.apply(se,Ye)},v.map=se,v.events=function(xe){var Ge=Object.keys(xe.options.modes).reduce(function(Ue,Et){return Ue[Et]=Je(xe.options.modes[Et]),Ue},{}),Ye={},mt={},_t={},ct=null,ti=null;_t.drag=function(Ue,Et){Et({point:Ue.point,time:new Date().getTime()})?(xe.ui.queueMapClasses({mouse:be.DRAG}),ti.drag(Ue)):Ue.originalEvent.stopPropagation()},_t.mousedrag=function(Ue){_t.drag(Ue,function(Et){return!hi(Ye,Et)})},_t.touchdrag=function(Ue){_t.drag(Ue,function(Et){return!Rn(mt,Et)})},_t.mousemove=function(Ue){if((Ue.originalEvent.buttons!==void 0?Ue.originalEvent.buttons:Ue.originalEvent.which)===1)return _t.mousedrag(Ue);var Et=Bt(Ue,xe);Ue.featureTarget=Et,ti.mousemove(Ue)},_t.mousedown=function(Ue){Ye={time:new Date().getTime(),point:Ue.point};var Et=Bt(Ue,xe);Ue.featureTarget=Et,ti.mousedown(Ue)},_t.mouseup=function(Ue){var Et=Bt(Ue,xe);Ue.featureTarget=Et,hi(Ye,{point:Ue.point,time:new Date().getTime()})?ti.click(Ue):ti.mouseup(Ue)},_t.mouseout=function(Ue){ti.mouseout(Ue)},_t.touchstart=function(Ue){if(xe.options.touchEnabled){mt={time:new Date().getTime(),point:Ue.point};var Et=rt.touch(Ue,null,xe)[0];Ue.featureTarget=Et,ti.touchstart(Ue)}},_t.touchmove=function(Ue){if(xe.options.touchEnabled)return ti.touchmove(Ue),_t.touchdrag(Ue)},_t.touchend=function(Ue){if(Ue.originalEvent.preventDefault(),xe.options.touchEnabled){var Et=rt.touch(Ue,null,xe)[0];Ue.featureTarget=Et,Rn(mt,{time:new Date().getTime(),point:Ue.point})?ti.tap(Ue):ti.touchend(Ue)}};var cn=function(Ue){return!(Ue===8||Ue===46||Ue>=48&&Ue<=57)};function ni(Ue,Et,Oi){Oi===void 0&&(Oi={}),ti.stop();var un=Ge[Ue];if(un===void 0)throw new Error(Ue+" is not valid");ct=Ue;var gn=un(xe,Et);ti=h(gn,xe),Oi.silent||xe.map.fire(Te.MODE_CHANGE,{mode:Ue}),xe.store.setDirty(),xe.store.render()}_t.keydown=function(Ue){(Ue.srcElement||Ue.target).classList.contains("mapboxgl-canvas")&&(Ue.keyCode!==8&&Ue.keyCode!==46||!xe.options.controls.trash?cn(Ue.keyCode)?ti.keydown(Ue):Ue.keyCode===49&&xe.options.controls.point?ni(me.DRAW_POINT):Ue.keyCode===50&&xe.options.controls.line_string?ni(me.DRAW_LINE_STRING):Ue.keyCode===51&&xe.options.controls.polygon&&ni(me.DRAW_POLYGON):(Ue.preventDefault(),ti.trash()))},_t.keyup=function(Ue){cn(Ue.keyCode)&&ti.keyup(Ue)},_t.zoomend=function(){xe.store.changeZoom()},_t.data=function(Ue){if(Ue.dataType==="style"){var Et=xe.setup,Oi=xe.map,un=xe.options,gn=xe.store;un.styles.some(function(Tr){return Oi.getLayer(Tr.id)})||(Et.addLayers(),gn.setDirty(),gn.render())}};var Cn={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){ct=xe.options.defaultMode,ti=h(Ge[ct](xe),xe)},changeMode:ni,actionable:function(Ue){var Et=!1;Object.keys(Ue).forEach(function(Oi){if(Cn[Oi]===void 0)throw new Error("Invalid action type");Cn[Oi]!==Ue[Oi]&&(Et=!0),Cn[Oi]=Ue[Oi]}),Et&&xe.map.fire(Te.ACTIONABLE,{actions:Cn})},currentModeName:function(){return ct},currentModeRender:function(Ue,Et){return ti.render(Ue,Et)},fire:function(Ue,Et){_t[Ue]&&_t[Ue](Et)},addEventListeners:function(){xe.map.on("mousemove",_t.mousemove),xe.map.on("mousedown",_t.mousedown),xe.map.on("mouseup",_t.mouseup),xe.map.on("data",_t.data),xe.map.on("touchmove",_t.touchmove),xe.map.on("touchstart",_t.touchstart),xe.map.on("touchend",_t.touchend),xe.container.addEventListener("mouseout",_t.mouseout),xe.options.keybindings&&(xe.container.addEventListener("keydown",_t.keydown),xe.container.addEventListener("keyup",_t.keyup))},removeEventListeners:function(){xe.map.off("mousemove",_t.mousemove),xe.map.off("mousedown",_t.mousedown),xe.map.off("mouseup",_t.mouseup),xe.map.off("data",_t.data),xe.map.off("touchmove",_t.touchmove),xe.map.off("touchstart",_t.touchstart),xe.map.off("touchend",_t.touchend),xe.container.removeEventListener("mouseout",_t.mouseout),xe.options.keybindings&&(xe.container.removeEventListener("keydown",_t.keydown),xe.container.removeEventListener("keyup",_t.keyup))},trash:function(Ue){ti.trash(Ue)},combineFeatures:function(){ti.combineFeatures()},uncombineFeatures:function(){ti.uncombineFeatures()},getMode:function(){return ct}}}(v),v.ui=function(xe){var Ge={},Ye=null,mt={mode:null,feature:null,mouse:null},_t={mode:null,feature:null,mouse:null};function ct(Ue){_t=Me(_t,Ue)}function ti(){var Ue,Et;if(xe.container){var Oi=[],un=[];Kn.forEach(function(gn){_t[gn]!==mt[gn]&&(Oi.push(gn+"-"+mt[gn]),_t[gn]!==null&&un.push(gn+"-"+_t[gn]))}),Oi.length>0&&(Ue=xe.container.classList).remove.apply(Ue,Oi),un.length>0&&(Et=xe.container.classList).add.apply(Et,un),mt=Me(mt,_t)}}function cn(Ue,Et){Et===void 0&&(Et={});var Oi=document.createElement("button");return Oi.className=te.CONTROL_BUTTON+" "+Et.className,Oi.setAttribute("title",Et.title),Et.container.appendChild(Oi),Oi.addEventListener("click",function(un){if(un.preventDefault(),un.stopPropagation(),un.target===Ye)return ni(),void Et.onDeactivate();Cn(Ue),Et.onActivate()},!0),Oi}function ni(){Ye&&(Ye.classList.remove(te.ACTIVE_BUTTON),Ye=null)}function Cn(Ue){ni();var Et=Ge[Ue];Et&&Et&&Ue!=="trash"&&(Et.classList.add(te.ACTIVE_BUTTON),Ye=Et)}return{setActiveButton:Cn,queueMapClasses:ct,updateMapClasses:ti,clearMapClasses:function(){ct({mode:null,feature:null,mouse:null}),ti()},addButtons:function(){var Ue=xe.options.controls,Et=document.createElement("div");return Et.className=te.CONTROL_GROUP+" "+te.CONTROL_BASE,Ue&&(Ue[he.LINE]&&(Ge[he.LINE]=cn(he.LINE,{container:Et,className:te.CONTROL_BUTTON_LINE,title:"LineString tool "+(xe.options.keybindings?"(l)":""),onActivate:function(){return xe.events.changeMode(me.DRAW_LINE_STRING)},onDeactivate:function(){return xe.events.trash()}})),Ue[he.POLYGON]&&(Ge[he.POLYGON]=cn(he.POLYGON,{container:Et,className:te.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(xe.options.keybindings?"(p)":""),onActivate:function(){return xe.events.changeMode(me.DRAW_POLYGON)},onDeactivate:function(){return xe.events.trash()}})),Ue[he.POINT]&&(Ge[he.POINT]=cn(he.POINT,{container:Et,className:te.CONTROL_BUTTON_POINT,title:"Marker tool "+(xe.options.keybindings?"(m)":""),onActivate:function(){return xe.events.changeMode(me.DRAW_POINT)},onDeactivate:function(){return xe.events.trash()}})),Ue.trash&&(Ge.trash=cn("trash",{container:Et,className:te.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){xe.events.trash()}})),Ue.combine_features&&(Ge.combine_features=cn("combineFeatures",{container:Et,className:te.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){xe.events.combineFeatures()}})),Ue.uncombine_features&&(Ge.uncombine_features=cn("uncombineFeatures",{container:Et,className:te.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){xe.events.uncombineFeatures()}}))),Et},removeButtons:function(){Object.keys(Ge).forEach(function(Ue){var Et=Ge[Ue];Et.parentNode&&Et.parentNode.removeChild(Et),delete Ge[Ue]})}}}(v),v.container=se.getContainer(),v.store=new xi(v),E=v.ui.addButtons(),v.options.boxSelect&&(v.boxZoomInitial=se.boxZoom.isEnabled(),se.boxZoom.disable(),se.dragPan.disable(),se.dragPan.enable()),se.loaded()?Q.connect():(se.on("load",Q.connect),V=setInterval(function(){se.loaded()&&Q.connect()},16)),v.events.start(),E},addLayers:function(){v.map.addSource(ce.COLD,{data:{type:ye.FEATURE_COLLECTION,features:[]},type:"geojson"}),v.map.addSource(ce.HOT,{data:{type:ye.FEATURE_COLLECTION,features:[]},type:"geojson"}),v.options.styles.forEach(function(se){v.map.addLayer(se)}),v.store.setDirty(!0),v.store.render()},removeLayers:function(){v.options.styles.forEach(function(se){v.map.getLayer(se.id)&&v.map.removeLayer(se.id)}),v.map.getSource(ce.COLD)&&v.map.removeSource(ce.COLD),v.map.getSource(ce.HOT)&&v.map.removeSource(ce.HOT)}};return v.setup=Q,Q}var Ai=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function ii(v){return function(E){var V=E.featureTarget;return!!V&&!!V.properties&&V.properties.meta===v}}function wr(v){return!!v.originalEvent&&!!v.originalEvent.shiftKey&&v.originalEvent.button===0}function Jn(v){return!!v.featureTarget&&!!v.featureTarget.properties&&v.featureTarget.properties.active===Le.ACTIVE&&v.featureTarget.properties.meta===Ze.FEATURE}function Sn(v){return!!v.featureTarget&&!!v.featureTarget.properties&&v.featureTarget.properties.active===Le.INACTIVE&&v.featureTarget.properties.meta===Ze.FEATURE}function en(v){return v.featureTarget===void 0}function pi(v){return!!v.featureTarget&&!!v.featureTarget.properties&&v.featureTarget.properties.meta===Ze.FEATURE}function Ji(v){var E=v.featureTarget;return!!E&&!!E.properties&&E.properties.meta===Ze.VERTEX}function wo(v){return!!v.originalEvent&&v.originalEvent.shiftKey===!0}function it(v){return v.keyCode===27}function zr(v){return v.keyCode===13}var _n=Object.freeze({__proto__:null,isOfMetaType:ii,isShiftMousedown:wr,isActiveFeature:Jn,isInactiveFeature:Sn,noTarget:en,isFeature:pi,isVertex:Ji,isShiftDown:wo,isEscapeKey:it,isEnterKey:zr,isTrue:function(){return!0}}),hs=Sr;function Sr(v,E){this.x=v,this.y=E}Sr.prototype={clone:function(){return new Sr(this.x,this.y)},add:function(v){return this.clone()._add(v)},sub:function(v){return this.clone()._sub(v)},multByPoint:function(v){return this.clone()._multByPoint(v)},divByPoint:function(v){return this.clone()._divByPoint(v)},mult:function(v){return this.clone()._mult(v)},div:function(v){return this.clone()._div(v)},rotate:function(v){return this.clone()._rotate(v)},rotateAround:function(v,E){return this.clone()._rotateAround(v,E)},matMult:function(v){return this.clone()._matMult(v)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(v){return this.x===v.x&&this.y===v.y},dist:function(v){return Math.sqrt(this.distSqr(v))},distSqr:function(v){var E=v.x-this.x,V=v.y-this.y;return E*E+V*V},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(v){return Math.atan2(this.y-v.y,this.x-v.x)},angleWith:function(v){return this.angleWithSep(v.x,v.y)},angleWithSep:function(v,E){return Math.atan2(this.x*E-this.y*v,this.x*v+this.y*E)},_matMult:function(v){var E=v[0]*this.x+v[1]*this.y,V=v[2]*this.x+v[3]*this.y;return this.x=E,this.y=V,this},_add:function(v){return this.x+=v.x,this.y+=v.y,this},_sub:function(v){return this.x-=v.x,this.y-=v.y,this},_mult:function(v){return this.x*=v,this.y*=v,this},_div:function(v){return this.x/=v,this.y/=v,this},_multByPoint:function(v){return this.x*=v.x,this.y*=v.y,this},_divByPoint:function(v){return this.x/=v.x,this.y/=v.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var v=this.y;return this.y=this.x,this.x=-v,this},_rotate:function(v){var E=Math.cos(v),V=Math.sin(v),Q=E*this.x-V*this.y,se=V*this.x+E*this.y;return this.x=Q,this.y=se,this},_rotateAround:function(v,E){var V=Math.cos(v),Q=Math.sin(v),se=E.x+V*(this.x-E.x)-Q*(this.y-E.y),le=E.y+Q*(this.x-E.x)+V*(this.y-E.y);return this.x=se,this.y=le,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Sr.convert=function(v){return v instanceof Sr?v:Array.isArray(v)?new Sr(v[0],v[1]):v};var st=d(hs);function ri(v,E){var V=E.getBoundingClientRect();return new st(v.clientX-V.left-(E.clientLeft||0),v.clientY-V.top-(E.clientTop||0))}function Kt(v,E,V,Q){return{type:ye.FEATURE,properties:{meta:Ze.VERTEX,parent:v,coord_path:V,active:Q?Le.ACTIVE:Le.INACTIVE},geometry:{type:ye.POINT,coordinates:E}}}function sr(v,E,V){var Q=E.geometry.coordinates,se=V.geometry.coordinates;if(Q[1]>85||Q[1]<xt||se[1]>85||se[1]<xt)return null;var le={lng:(Q[0]+se[0])/2,lat:(Q[1]+se[1])/2};return{type:ye.FEATURE,properties:{meta:Ze.MIDPOINT,parent:v,lng:le.lng,lat:le.lat,coord_path:V.properties.coord_path},geometry:{type:ye.POINT,coordinates:[le.lng,le.lat]}}}function Dr(v,E,V){E===void 0&&(E={}),V===void 0&&(V=null);var Q,se=v.geometry,le=se.type,xe=se.coordinates,Ge=v.properties&&v.properties.id,Ye=[];function mt(ct,ti){var cn="",ni=null;ct.forEach(function(Cn,Ue){var Et=ti!=null?ti+"."+Ue:String(Ue),Oi=Kt(Ge,Cn,Et,_t(Et));if(E.midpoints&&ni){var un=sr(Ge,ni,Oi);un&&Ye.push(un)}ni=Oi;var gn=JSON.stringify(Cn);cn!==gn&&Ye.push(Oi),Ue===0&&(cn=gn)})}function _t(ct){return!!E.selectedPaths&&E.selectedPaths.indexOf(ct)!==-1}return le===ye.POINT?Ye.push(Kt(Ge,xe,V,_t(V))):le===ye.POLYGON?xe.forEach(function(ct,ti){mt(ct,V!==null?V+"."+ti:String(ti))}):le===ye.LINE_STRING?mt(xe,V):le.indexOf(ye.MULTI_PREFIX)===0&&(Q=le.replace(ye.MULTI_PREFIX,""),xe.forEach(function(ct,ti){var cn={type:ye.FEATURE,properties:v.properties,geometry:{type:Q,coordinates:ct}};Ye=Ye.concat(Dr(cn,E,ti))})),Ye}var Gt={enable:function(v){setTimeout(function(){v.map&&v.map.doubleClickZoom&&v._ctx&&v._ctx.store&&v._ctx.store.getInitialConfigValue&&v._ctx.store.getInitialConfigValue("doubleClickZoom")&&v.map.doubleClickZoom.enable()},0)},disable:function(v){setTimeout(function(){v.map&&v.map.doubleClickZoom&&v.map.doubleClickZoom.disable()},0)}},Gr={exports:{}},K=function(v){if(!v||!v.type)return null;var E=R[v.type];if(!E)return null;if(E==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:v}]};if(E==="feature")return{type:"FeatureCollection",features:[v]};if(E==="featurecollection")return v},R={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},B=d(K),Z=Object.freeze({__proto__:null,default:function v(E){switch(E&&E.type||null){case"FeatureCollection":return E.features=E.features.reduce(function(V,Q){return V.concat(v(Q))},[]),E;case"Feature":return E.geometry?v(E.geometry).map(function(V){var Q={type:"Feature",properties:JSON.parse(JSON.stringify(E.properties)),geometry:V};return E.id!==void 0&&(Q.id=E.id),Q}):[E];case"MultiPoint":return E.coordinates.map(function(V){return{type:"Point",coordinates:V}});case"MultiPolygon":return E.coordinates.map(function(V){return{type:"Polygon",coordinates:V}});case"MultiLineString":return E.coordinates.map(function(V){return{type:"LineString",coordinates:V}});case"GeometryCollection":return E.geometries.map(v).reduce(function(V,Q){return V.concat(Q)},[]);case"Point":case"Polygon":case"LineString":return[E]}}}),Y=K,$=y(Z),_e=function(v){return function E(V){return Array.isArray(V)&&V.length&&typeof V[0]=="number"?[V]:V.reduce(function(Q,se){return Array.isArray(se)&&Array.isArray(se[0])?Q.concat(E(se)):(Q.push(se),Q)},[])}(v)};$ instanceof Function||($=$.default);var ae={exports:{}},ne=ae.exports=function(v){return new ue(v)};function ue(v){this.value=v}function ze(v,E,V){var Q=[],se=[],le=!0;return function xe(Ge){var Ye=V?Re(Ge):Ge,mt={},_t=!0,ct={node:Ye,node_:Ge,path:[].concat(Q),parent:se[se.length-1],parents:se,key:Q.slice(-1)[0],isRoot:Q.length===0,level:Q.length,circular:null,update:function(ni,Cn){ct.isRoot||(ct.parent.node[ct.key]=ni),ct.node=ni,Cn&&(_t=!1)},delete:function(ni){delete ct.parent.node[ct.key],ni&&(_t=!1)},remove:function(ni){Jt(ct.parent.node)?ct.parent.node.splice(ct.key,1):delete ct.parent.node[ct.key],ni&&(_t=!1)},keys:null,before:function(ni){mt.before=ni},after:function(ni){mt.after=ni},pre:function(ni){mt.pre=ni},post:function(ni){mt.post=ni},stop:function(){le=!1},block:function(){_t=!1}};if(!le)return ct;function ti(){if(typeof ct.node=="object"&&ct.node!==null){ct.keys&&ct.node_===ct.node||(ct.keys=Oe(ct.node)),ct.isLeaf=ct.keys.length==0;for(var ni=0;ni<se.length;ni++)if(se[ni].node_===Ge){ct.circular=se[ni];break}}else ct.isLeaf=!0,ct.keys=null;ct.notLeaf=!ct.isLeaf,ct.notRoot=!ct.isRoot}ti();var cn=E.call(ct,ct.node);return cn!==void 0&&ct.update&&ct.update(cn),mt.before&&mt.before.call(ct,ct.node),_t&&(typeof ct.node!="object"||ct.node===null||ct.circular||(se.push(ct),ti(),wt(ct.keys,function(ni,Cn){Q.push(ni),mt.pre&&mt.pre.call(ct,ct.node[ni],ni);var Ue=xe(ct.node[ni]);V&&Rt.call(ct.node,ni)&&(ct.node[ni]=Ue.node),Ue.isLast=Cn==ct.keys.length-1,Ue.isFirst=Cn==0,mt.post&&mt.post.call(ct,Ue),Q.pop()}),se.pop()),mt.after&&mt.after.call(ct,ct.node)),ct}(v).node}function Re(v){if(typeof v=="object"&&v!==null){var E;if(Jt(v))E=[];else if(kt(v)==="[object Date]")E=new Date(v.getTime?v.getTime():v);else if(function(se){return kt(se)==="[object RegExp]"}(v))E=new RegExp(v);else if(function(se){return kt(se)==="[object Error]"}(v))E={message:v.message};else if(function(se){return kt(se)==="[object Boolean]"}(v))E=new Boolean(v);else if(function(se){return kt(se)==="[object Number]"}(v))E=new Number(v);else if(function(se){return kt(se)==="[object String]"}(v))E=new String(v);else if(Object.create&&Object.getPrototypeOf)E=Object.create(Object.getPrototypeOf(v));else if(v.constructor===Object)E={};else{var V=v.constructor&&v.constructor.prototype||v.__proto__||{},Q=function(){};Q.prototype=V,E=new Q}return wt(Oe(v),function(se){E[se]=v[se]}),E}return v}ue.prototype.get=function(v){for(var E=this.value,V=0;V<v.length;V++){var Q=v[V];if(!E||!Rt.call(E,Q)){E=void 0;break}E=E[Q]}return E},ue.prototype.has=function(v){for(var E=this.value,V=0;V<v.length;V++){var Q=v[V];if(!E||!Rt.call(E,Q))return!1;E=E[Q]}return!0},ue.prototype.set=function(v,E){for(var V=this.value,Q=0;Q<v.length-1;Q++){var se=v[Q];Rt.call(V,se)||(V[se]={}),V=V[se]}return V[v[Q]]=E,E},ue.prototype.map=function(v){return ze(this.value,v,!0)},ue.prototype.forEach=function(v){return this.value=ze(this.value,v,!1),this.value},ue.prototype.reduce=function(v,E){var V=arguments.length===1,Q=V?this.value:E;return this.forEach(function(se){this.isRoot&&V||(Q=v.call(this,Q,se))}),Q},ue.prototype.paths=function(){var v=[];return this.forEach(function(E){v.push(this.path)}),v},ue.prototype.nodes=function(){var v=[];return this.forEach(function(E){v.push(this.node)}),v},ue.prototype.clone=function(){var v=[],E=[];return function V(Q){for(var se=0;se<v.length;se++)if(v[se]===Q)return E[se];if(typeof Q=="object"&&Q!==null){var le=Re(Q);return v.push(Q),E.push(le),wt(Oe(Q),function(xe){le[xe]=V(Q[xe])}),v.pop(),E.pop(),le}return Q}(this.value)};var Oe=Object.keys||function(v){var E=[];for(var V in v)E.push(V);return E};function kt(v){return Object.prototype.toString.call(v)}var Jt=Array.isArray||function(v){return Object.prototype.toString.call(v)==="[object Array]"},wt=function(v,E){if(v.forEach)return v.forEach(E);for(var V=0;V<v.length;V++)E(v[V],V,v)};wt(Oe(ue.prototype),function(v){ne[v]=function(E){var V=[].slice.call(arguments,1),Q=new ue(E);return Q[v].apply(Q,V)}});var Rt=Object.hasOwnProperty||function(v,E){return E in v},ei=ae.exports,zi=si;function si(v){if(!(this instanceof si))return new si(v);this._bbox=v||[1/0,1/0,-1/0,-1/0],this._valid=!!v}si.prototype.include=function(v){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],v[0]),this._bbox[1]=Math.min(this._bbox[1],v[1]),this._bbox[2]=Math.max(this._bbox[2],v[0]),this._bbox[3]=Math.max(this._bbox[3],v[1]),this},si.prototype.equals=function(v){var E;return E=v instanceof si?v.bbox():v,this._bbox[0]==E[0]&&this._bbox[1]==E[1]&&this._bbox[2]==E[2]&&this._bbox[3]==E[3]},si.prototype.center=function(v){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},si.prototype.union=function(v){var E;return this._valid=!0,E=v instanceof si?v.bbox():v,this._bbox[0]=Math.min(this._bbox[0],E[0]),this._bbox[1]=Math.min(this._bbox[1],E[1]),this._bbox[2]=Math.max(this._bbox[2],E[2]),this._bbox[3]=Math.max(this._bbox[3],E[3]),this},si.prototype.bbox=function(){return this._valid?this._bbox:null},si.prototype.contains=function(v){if(!v)return this._fastContains();if(!this._valid)return null;var E=v[0],V=v[1];return this._bbox[0]<=E&&this._bbox[1]<=V&&this._bbox[2]>=E&&this._bbox[3]>=V},si.prototype.intersect=function(v){return this._valid?(E=v instanceof si?v.bbox():v,!(this._bbox[0]>E[2]||this._bbox[2]<E[0]||this._bbox[3]<E[1]||this._bbox[1]>E[3])):null;var E},si.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var v="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",v)},si.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Ii=function(v){if(!v)return[];var E=$(Y(v)),V=[];return E.features.forEach(function(Q){Q.geometry&&(V=V.concat(_e(Q.geometry.coordinates)))}),V},wi=ei,ar=zi,Hi={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Mn=Object.keys(Hi);function Bn(v){for(var E=ar(),V=Ii(v),Q=0;Q<V.length;Q++)E.include(V[Q]);return E}Gr.exports=function(v){return Bn(v).bbox()},Gr.exports.polygon=function(v){return Bn(v).polygon()},Gr.exports.bboxify=function(v){return wi(v).map(function(E){E&&Mn.some(function(V){return!!E[V]&&Hi[V].indexOf(E.type)!==-1})&&(E.bbox=Bn(E).bbox(),this.update(E))})};var Wr=d(Gr.exports),Bs=-90;function Zo(v,E){var V=Bs,Q=90,se=Bs,le=90,xe=270,Ge=-270;v.forEach(function(mt){var _t=Wr(mt),ct=_t[1],ti=_t[3],cn=_t[0],ni=_t[2];ct>V&&(V=ct),ti<Q&&(Q=ti),ti>se&&(se=ti),ct<le&&(le=ct),cn<xe&&(xe=cn),ni>Ge&&(Ge=ni)});var Ye=E;return V+Ye.lat>85&&(Ye.lat=85-V),se+Ye.lat>90&&(Ye.lat=90-se),Q+Ye.lat<-85&&(Ye.lat=-85-Q),le+Ye.lat<Bs&&(Ye.lat=Bs-le),xe+Ye.lng<=-270&&(Ye.lng+=360*Math.ceil(Math.abs(Ye.lng)/360)),Ge+Ye.lng>=270&&(Ye.lng-=360*Math.ceil(Math.abs(Ye.lng)/360)),Ye}function Go(v,E){var V=Zo(v.map(function(Q){return Q.toGeoJSON()}),E);v.forEach(function(Q){var se,le=Q.getCoordinates(),xe=function(Ye){var mt={lng:Ye[0]+V.lng,lat:Ye[1]+V.lat};return[mt.lng,mt.lat]},Ge=function(Ye){return Ye.map(function(mt){return xe(mt)})};Q.type===ye.POINT?se=xe(le):Q.type===ye.LINE_STRING||Q.type===ye.MULTI_POINT?se=le.map(xe):Q.type===ye.POLYGON||Q.type===ye.MULTI_LINE_STRING?se=le.map(Ge):Q.type===ye.MULTI_POLYGON&&(se=le.map(function(Ye){return Ye.map(function(mt){return Ge(mt)})})),Q.incomingCoords(se)})}var Nn={onSetup:function(v){var E=this,V={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:v.featureIds||[]};return this.setSelected(V.initiallySelectedFeatureIds.filter(function(Q){return E.getFeature(Q)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),V},fireUpdate:function(){this.map.fire(Te.UPDATE,{action:De.MOVE,features:this.getSelected().map(function(v){return v.toGeoJSON()})})},fireActionable:function(){var v=this,E=this.getSelected(),V=E.filter(function(Ge){return v.isInstanceOf("MultiFeature",Ge)}),Q=!1;if(E.length>1){Q=!0;var se=E[0].type.replace("Multi","");E.forEach(function(Ge){Ge.type.replace("Multi","")!==se&&(Q=!1)})}var le=V.length>0,xe=E.length>0;this.setActionableState({combineFeatures:Q,uncombineFeatures:le,trash:xe})},getUniqueIds:function(v){return v.length?v.map(function(E){return E.properties.id}).filter(function(E){return E!==void 0}).reduce(function(E,V){return E.add(V),E},new $e).values():[]},stopExtendedInteractions:function(v){v.boxSelectElement&&(v.boxSelectElement.parentNode&&v.boxSelectElement.parentNode.removeChild(v.boxSelectElement),v.boxSelectElement=null),this.map.dragPan.enable(),v.boxSelecting=!1,v.canBoxSelect=!1,v.dragMoving=!1,v.canDragMove=!1},onStop:function(){Gt.enable(this)},onMouseMove:function(v,E){return pi(E)&&v.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(v),!0},onMouseOut:function(v){return!v.dragMoving||this.fireUpdate()}};Nn.onTap=Nn.onClick=function(v,E){return en(E)?this.clickAnywhere(v,E):ii(Ze.VERTEX)(E)?this.clickOnVertex(v,E):pi(E)?this.clickOnFeature(v,E):void 0},Nn.clickAnywhere=function(v){var E=this,V=this.getSelectedIds();V.length&&(this.clearSelectedFeatures(),V.forEach(function(Q){return E.doRender(Q)})),Gt.enable(this),this.stopExtendedInteractions(v)},Nn.clickOnVertex=function(v,E){this.changeMode(me.DIRECT_SELECT,{featureId:E.featureTarget.properties.parent,coordPath:E.featureTarget.properties.coord_path,startPos:E.lngLat}),this.updateUIClasses({mouse:be.MOVE})},Nn.startOnActiveFeature=function(v,E){this.stopExtendedInteractions(v),this.map.dragPan.disable(),this.doRender(E.featureTarget.properties.id),v.canDragMove=!0,v.dragMoveLocation=E.lngLat},Nn.clickOnFeature=function(v,E){var V=this;Gt.disable(this),this.stopExtendedInteractions(v);var Q=wo(E),se=this.getSelectedIds(),le=E.featureTarget.properties.id,xe=this.isSelected(le);if(!Q&&xe&&this.getFeature(le).type!==ye.POINT)return this.changeMode(me.DIRECT_SELECT,{featureId:le});xe&&Q?(this.deselect(le),this.updateUIClasses({mouse:be.POINTER}),se.length===1&&Gt.enable(this)):!xe&&Q?(this.select(le),this.updateUIClasses({mouse:be.MOVE})):xe||Q||(se.forEach(function(Ge){return V.doRender(Ge)}),this.setSelected(le),this.updateUIClasses({mouse:be.MOVE})),this.doRender(le)},Nn.onMouseDown=function(v,E){return Jn(E)?this.startOnActiveFeature(v,E):this.drawConfig.boxSelect&&wr(E)?this.startBoxSelect(v,E):void 0},Nn.startBoxSelect=function(v,E){this.stopExtendedInteractions(v),this.map.dragPan.disable(),v.boxSelectStartLocation=ri(E.originalEvent,this.map.getContainer()),v.canBoxSelect=!0},Nn.onTouchStart=function(v,E){if(Jn(E))return this.startOnActiveFeature(v,E)},Nn.onDrag=function(v,E){return v.canDragMove?this.dragMove(v,E):this.drawConfig.boxSelect&&v.canBoxSelect?this.whileBoxSelect(v,E):void 0},Nn.whileBoxSelect=function(v,E){v.boxSelecting=!0,this.updateUIClasses({mouse:be.ADD}),v.boxSelectElement||(v.boxSelectElement=document.createElement("div"),v.boxSelectElement.classList.add(te.BOX_SELECT),this.map.getContainer().appendChild(v.boxSelectElement));var V=ri(E.originalEvent,this.map.getContainer()),Q=Math.min(v.boxSelectStartLocation.x,V.x),se=Math.max(v.boxSelectStartLocation.x,V.x),le=Math.min(v.boxSelectStartLocation.y,V.y),xe=Math.max(v.boxSelectStartLocation.y,V.y),Ge="translate("+Q+"px, "+le+"px)";v.boxSelectElement.style.transform=Ge,v.boxSelectElement.style.WebkitTransform=Ge,v.boxSelectElement.style.width=se-Q+"px",v.boxSelectElement.style.height=xe-le+"px"},Nn.dragMove=function(v,E){v.dragMoving=!0,E.originalEvent.stopPropagation();var V={lng:E.lngLat.lng-v.dragMoveLocation.lng,lat:E.lngLat.lat-v.dragMoveLocation.lat};Go(this.getSelected(),V),v.dragMoveLocation=E.lngLat},Nn.onTouchEnd=Nn.onMouseUp=function(v,E){var V=this;if(v.dragMoving)this.fireUpdate();else if(v.boxSelecting){var Q=[v.boxSelectStartLocation,ri(E.originalEvent,this.map.getContainer())],se=this.featuresAt(null,Q,"click"),le=this.getUniqueIds(se).filter(function(xe){return!V.isSelected(xe)});le.length&&(this.select(le),le.forEach(function(xe){return V.doRender(xe)}),this.updateUIClasses({mouse:be.MOVE}))}this.stopExtendedInteractions(v)},Nn.toDisplayFeatures=function(v,E,V){E.properties.active=this.isSelected(E.properties.id)?Le.ACTIVE:Le.INACTIVE,V(E),this.fireActionable(),E.properties.active===Le.ACTIVE&&E.geometry.type!==ye.POINT&&Dr(E).forEach(V)},Nn.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Nn.onCombineFeatures=function(){var v=this.getSelected();if(!(v.length===0||v.length<2)){for(var E=[],V=[],Q=v[0].type.replace("Multi",""),se=0;se<v.length;se++){var le=v[se];if(le.type.replace("Multi","")!==Q)return;le.type.includes("Multi")?le.getCoordinates().forEach(function(Ge){E.push(Ge)}):E.push(le.getCoordinates()),V.push(le.toGeoJSON())}if(V.length>1){var xe=this.newFeature({type:ye.FEATURE,properties:V[0].properties,geometry:{type:"Multi"+Q,coordinates:E}});this.addFeature(xe),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([xe.id]),this.map.fire(Te.COMBINE_FEATURES,{createdFeatures:[xe.toGeoJSON()],deletedFeatures:V})}this.fireActionable()}},Nn.onUncombineFeatures=function(){var v=this,E=this.getSelected();if(E.length!==0){for(var V=[],Q=[],se=function(xe){var Ge=E[xe];v.isInstanceOf("MultiFeature",Ge)&&(Ge.getFeatures().forEach(function(Ye){v.addFeature(Ye),Ye.properties=Ge.properties,V.push(Ye.toGeoJSON()),v.select([Ye.id])}),v.deleteFeature(Ge.id,{silent:!0}),Q.push(Ge.toGeoJSON()))},le=0;le<E.length;le++)se(le);V.length>1&&this.map.fire(Te.UNCOMBINE_FEATURES,{createdFeatures:V,deletedFeatures:Q}),this.fireActionable()}};var Ri=ii(Ze.VERTEX),pa=ii(Ze.MIDPOINT),no={fireUpdate:function(){this.map.fire(Te.UPDATE,{action:De.CHANGE_COORDINATES,features:this.getSelected().map(function(v){return v.toGeoJSON()})})},fireActionable:function(v){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:v.selectedCoordPaths.length>0})},startDragging:function(v,E){this.map.dragPan.disable(),v.canDragMove=!0,v.dragMoveLocation=E.lngLat},stopDragging:function(v){this.map.dragPan.enable(),v.dragMoving=!1,v.canDragMove=!1,v.dragMoveLocation=null},onVertex:function(v,E){this.startDragging(v,E);var V=E.featureTarget.properties,Q=v.selectedCoordPaths.indexOf(V.coord_path);wo(E)||Q!==-1?wo(E)&&Q===-1&&v.selectedCoordPaths.push(V.coord_path):v.selectedCoordPaths=[V.coord_path];var se=this.pathsToCoordinates(v.featureId,v.selectedCoordPaths);this.setSelectedCoordinates(se)},onMidpoint:function(v,E){this.startDragging(v,E);var V=E.featureTarget.properties;v.feature.addCoordinate(V.coord_path,V.lng,V.lat),this.fireUpdate(),v.selectedCoordPaths=[V.coord_path]},pathsToCoordinates:function(v,E){return E.map(function(V){return{feature_id:v,coord_path:V}})},onFeature:function(v,E){v.selectedCoordPaths.length===0?this.startDragging(v,E):this.stopDragging(v)},dragFeature:function(v,E,V){Go(this.getSelected(),V),v.dragMoveLocation=E.lngLat},dragVertex:function(v,E,V){for(var Q=v.selectedCoordPaths.map(function(Ge){return v.feature.getCoordinate(Ge)}),se=Zo(Q.map(function(Ge){return{type:ye.FEATURE,properties:{},geometry:{type:ye.POINT,coordinates:Ge}}}),V),le=0;le<Q.length;le++){var xe=Q[le];v.feature.updateCoordinate(v.selectedCoordPaths[le],xe[0]+se.lng,xe[1]+se.lat)}},clickNoTarget:function(){this.changeMode(me.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(me.SIMPLE_SELECT)},clickActiveFeature:function(v){v.selectedCoordPaths=[],this.clearSelectedCoordinates(),v.feature.changed()},onSetup:function(v){var E=v.featureId,V=this.getFeature(E);if(!V)throw new Error("You must provide a featureId to enter direct_select mode");if(V.type===ye.POINT)throw new TypeError("direct_select mode doesn't handle point features");var Q={featureId:E,feature:V,dragMoveLocation:v.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:v.coordPath?[v.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(E,Q.selectedCoordPaths)),this.setSelected(E),Gt.disable(this),this.setActionableState({trash:!0}),Q},onStop:function(){Gt.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(v,E,V){v.featureId===E.properties.id?(E.properties.active=Le.ACTIVE,V(E),Dr(E,{map:this.map,midpoints:!0,selectedPaths:v.selectedCoordPaths}).forEach(V)):(E.properties.active=Le.INACTIVE,V(E)),this.fireActionable(v)},onTrash:function(v){v.selectedCoordPaths.sort(function(E,V){return V.localeCompare(E,"en",{numeric:!0})}).forEach(function(E){return v.feature.removeCoordinate(E)}),this.fireUpdate(),v.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(v),v.feature.isValid()===!1&&(this.deleteFeature([v.featureId]),this.changeMode(me.SIMPLE_SELECT,{}))},onMouseMove:function(v,E){var V=Jn(E),Q=Ri(E),se=pa(E),le=v.selectedCoordPaths.length===0;return V&&le||Q&&!le?this.updateUIClasses({mouse:be.MOVE}):this.updateUIClasses({mouse:be.NONE}),(Q||V||se)&&v.dragMoving&&this.fireUpdate(),this.stopDragging(v),!0},onMouseOut:function(v){return v.dragMoving&&this.fireUpdate(),!0}};no.onTouchStart=no.onMouseDown=function(v,E){return Ri(E)?this.onVertex(v,E):Jn(E)?this.onFeature(v,E):pa(E)?this.onMidpoint(v,E):void 0},no.onDrag=function(v,E){if(v.canDragMove===!0){v.dragMoving=!0,E.originalEvent.stopPropagation();var V={lng:E.lngLat.lng-v.dragMoveLocation.lng,lat:E.lngLat.lat-v.dragMoveLocation.lat};v.selectedCoordPaths.length>0?this.dragVertex(v,E,V):this.dragFeature(v,E,V),v.dragMoveLocation=E.lngLat}},no.onClick=function(v,E){return en(E)?this.clickNoTarget(v,E):Jn(E)?this.clickActiveFeature(v,E):Sn(E)?this.clickInactive(v,E):void this.stopDragging(v)},no.onTap=function(v,E){return en(E)?this.clickNoTarget(v,E):Jn(E)?this.clickActiveFeature(v,E):Sn(E)?this.clickInactive(v,E):void 0},no.onTouchEnd=no.onMouseUp=function(v){v.dragMoving&&this.fireUpdate(),this.stopDragging(v)};var on={};function lr(v,E){return!!v.lngLat&&v.lngLat.lng===E[0]&&v.lngLat.lat===E[1]}on.onSetup=function(){var v=this.newFeature({type:ye.FEATURE,properties:{},geometry:{type:ye.POINT,coordinates:[]}});return this.addFeature(v),this.clearSelectedFeatures(),this.updateUIClasses({mouse:be.ADD}),this.activateUIButton(he.POINT),this.setActionableState({trash:!0}),{point:v}},on.stopDrawingAndRemove=function(v){this.deleteFeature([v.point.id],{silent:!0}),this.changeMode(me.SIMPLE_SELECT)},on.onTap=on.onClick=function(v,E){this.updateUIClasses({mouse:be.MOVE}),v.point.updateCoordinate("",E.lngLat.lng,E.lngLat.lat),this.map.fire(Te.CREATE,{features:[v.point.toGeoJSON()]}),this.changeMode(me.SIMPLE_SELECT,{featureIds:[v.point.id]})},on.onStop=function(v){this.activateUIButton(),v.point.getCoordinate().length||this.deleteFeature([v.point.id],{silent:!0})},on.toDisplayFeatures=function(v,E,V){var Q=E.properties.id===v.point.id;if(E.properties.active=Q?Le.ACTIVE:Le.INACTIVE,!Q)return V(E)},on.onTrash=on.stopDrawingAndRemove,on.onKeyUp=function(v,E){if(it(E)||zr(E))return this.stopDrawingAndRemove(v,E)};var ds={onSetup:function(){var v=this.newFeature({type:ye.FEATURE,properties:{},geometry:{type:ye.POLYGON,coordinates:[[]]}});return this.addFeature(v),this.clearSelectedFeatures(),Gt.disable(this),this.updateUIClasses({mouse:be.ADD}),this.activateUIButton(he.POLYGON),this.setActionableState({trash:!0}),{polygon:v,currentVertexPosition:0}},clickAnywhere:function(v,E){if(v.currentVertexPosition>0&&lr(E,v.polygon.coordinates[0][v.currentVertexPosition-1]))return this.changeMode(me.SIMPLE_SELECT,{featureIds:[v.polygon.id]});this.updateUIClasses({mouse:be.ADD}),v.polygon.updateCoordinate("0."+v.currentVertexPosition,E.lngLat.lng,E.lngLat.lat),v.currentVertexPosition++,v.polygon.updateCoordinate("0."+v.currentVertexPosition,E.lngLat.lng,E.lngLat.lat)},clickOnVertex:function(v){return this.changeMode(me.SIMPLE_SELECT,{featureIds:[v.polygon.id]})},onMouseMove:function(v,E){v.polygon.updateCoordinate("0."+v.currentVertexPosition,E.lngLat.lng,E.lngLat.lat),Ji(E)&&this.updateUIClasses({mouse:be.POINTER})}};ds.onTap=ds.onClick=function(v,E){return Ji(E)?this.clickOnVertex(v,E):this.clickAnywhere(v,E)},ds.onKeyUp=function(v,E){it(E)?(this.deleteFeature([v.polygon.id],{silent:!0}),this.changeMode(me.SIMPLE_SELECT)):zr(E)&&this.changeMode(me.SIMPLE_SELECT,{featureIds:[v.polygon.id]})},ds.onStop=function(v){this.updateUIClasses({mouse:be.NONE}),Gt.enable(this),this.activateUIButton(),this.getFeature(v.polygon.id)!==void 0&&(v.polygon.removeCoordinate("0."+v.currentVertexPosition),v.polygon.isValid()?this.map.fire(Te.CREATE,{features:[v.polygon.toGeoJSON()]}):(this.deleteFeature([v.polygon.id],{silent:!0}),this.changeMode(me.SIMPLE_SELECT,{},{silent:!0})))},ds.toDisplayFeatures=function(v,E,V){var Q=E.properties.id===v.polygon.id;if(E.properties.active=Q?Le.ACTIVE:Le.INACTIVE,!Q)return V(E);if(E.geometry.coordinates.length!==0){var se=E.geometry.coordinates[0].length;if(!(se<3)){if(E.properties.meta=Ze.FEATURE,V(Kt(v.polygon.id,E.geometry.coordinates[0][0],"0.0",!1)),se>3){var le=E.geometry.coordinates[0].length-3;V(Kt(v.polygon.id,E.geometry.coordinates[0][le],"0."+le,!1))}if(se<=4){var xe=[[E.geometry.coordinates[0][0][0],E.geometry.coordinates[0][0][1]],[E.geometry.coordinates[0][1][0],E.geometry.coordinates[0][1][1]]];if(V({type:ye.FEATURE,properties:E.properties,geometry:{coordinates:xe,type:ye.LINE_STRING}}),se===3)return}return V(E)}}},ds.onTrash=function(v){this.deleteFeature([v.polygon.id],{silent:!0}),this.changeMode(me.SIMPLE_SELECT)};var Gn={onSetup:function(v){var E,V,Q=(v=v||{}).featureId,se="forward";if(Q){if(!(E=this.getFeature(Q)))throw new Error("Could not find a feature with the provided featureId");var le=v.from;if(le&&le.type==="Feature"&&le.geometry&&le.geometry.type==="Point"&&(le=le.geometry),le&&le.type==="Point"&&le.coordinates&&le.coordinates.length===2&&(le=le.coordinates),!le||!Array.isArray(le))throw new Error("Please use the `from` property to indicate which point to continue the line from");var xe=E.coordinates.length-1;if(E.coordinates[xe][0]===le[0]&&E.coordinates[xe][1]===le[1])V=xe+1,E.addCoordinate.apply(E,[V].concat(E.coordinates[xe]));else{if(E.coordinates[0][0]!==le[0]||E.coordinates[0][1]!==le[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");se="backwards",V=0,E.addCoordinate.apply(E,[V].concat(E.coordinates[0]))}}else E=this.newFeature({type:ye.FEATURE,properties:{},geometry:{type:ye.LINE_STRING,coordinates:[]}}),V=0,this.addFeature(E);return this.clearSelectedFeatures(),Gt.disable(this),this.updateUIClasses({mouse:be.ADD}),this.activateUIButton(he.LINE),this.setActionableState({trash:!0}),{line:E,currentVertexPosition:V,direction:se}},clickAnywhere:function(v,E){if(v.currentVertexPosition>0&&lr(E,v.line.coordinates[v.currentVertexPosition-1])||v.direction==="backwards"&&lr(E,v.line.coordinates[v.currentVertexPosition+1]))return this.changeMode(me.SIMPLE_SELECT,{featureIds:[v.line.id]});this.updateUIClasses({mouse:be.ADD}),v.line.updateCoordinate(v.currentVertexPosition,E.lngLat.lng,E.lngLat.lat),v.direction==="forward"?(v.currentVertexPosition++,v.line.updateCoordinate(v.currentVertexPosition,E.lngLat.lng,E.lngLat.lat)):v.line.addCoordinate(0,E.lngLat.lng,E.lngLat.lat)},clickOnVertex:function(v){return this.changeMode(me.SIMPLE_SELECT,{featureIds:[v.line.id]})},onMouseMove:function(v,E){v.line.updateCoordinate(v.currentVertexPosition,E.lngLat.lng,E.lngLat.lat),Ji(E)&&this.updateUIClasses({mouse:be.POINTER})}};Gn.onTap=Gn.onClick=function(v,E){if(Ji(E))return this.clickOnVertex(v,E);this.clickAnywhere(v,E)},Gn.onKeyUp=function(v,E){zr(E)?this.changeMode(me.SIMPLE_SELECT,{featureIds:[v.line.id]}):it(E)&&(this.deleteFeature([v.line.id],{silent:!0}),this.changeMode(me.SIMPLE_SELECT))},Gn.onStop=function(v){Gt.enable(this),this.activateUIButton(),this.getFeature(v.line.id)!==void 0&&(v.line.removeCoordinate(""+v.currentVertexPosition),v.line.isValid()?this.map.fire(Te.CREATE,{features:[v.line.toGeoJSON()]}):(this.deleteFeature([v.line.id],{silent:!0}),this.changeMode(me.SIMPLE_SELECT,{},{silent:!0})))},Gn.onTrash=function(v){this.deleteFeature([v.line.id],{silent:!0}),this.changeMode(me.SIMPLE_SELECT)},Gn.toDisplayFeatures=function(v,E,V){var Q=E.properties.id===v.line.id;if(E.properties.active=Q?Le.ACTIVE:Le.INACTIVE,!Q)return V(E);E.geometry.coordinates.length<2||(E.properties.meta=Ze.FEATURE,V(Kt(v.line.id,E.geometry.coordinates[v.direction==="forward"?E.geometry.coordinates.length-2:1],""+(v.direction==="forward"?E.geometry.coordinates.length-2:1),!1)),V(E))};var Wn={simple_select:Nn,direct_select:no,draw_point:on,draw_polygon:ds,draw_line_string:Gn},fa={defaultMode:me.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Ai,modes:Wn,controls:{},userProperties:!1},Ts={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},an={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function Pi(v,E){return v.map(function(V){return V.source?V:Me(V,{id:V.id+"."+E,source:E==="hot"?ce.HOT:ce.COLD})})}var Lo={exports:{}};(function(v,E){var V="__lodash_hash_undefined__",Q=9007199254740991,se="[object Arguments]",le="[object Array]",xe="[object Boolean]",Ge="[object Date]",Ye="[object Error]",mt="[object Function]",_t="[object Map]",ct="[object Number]",ti="[object Object]",cn="[object Promise]",ni="[object RegExp]",Cn="[object Set]",Ue="[object String]",Et="[object Symbol]",Oi="[object WeakMap]",un="[object ArrayBuffer]",gn="[object DataView]",Tr=/^\[object .+?Constructor\]$/,ma=/^(?:0|[1-9]\d*)$/,Xi={};Xi["[object Float32Array]"]=Xi["[object Float64Array]"]=Xi["[object Int8Array]"]=Xi["[object Int16Array]"]=Xi["[object Int32Array]"]=Xi["[object Uint8Array]"]=Xi["[object Uint8ClampedArray]"]=Xi["[object Uint16Array]"]=Xi["[object Uint32Array]"]=!0,Xi[se]=Xi[le]=Xi[un]=Xi[xe]=Xi[gn]=Xi[Ge]=Xi[Ye]=Xi[mt]=Xi[_t]=Xi[ct]=Xi[ti]=Xi[ni]=Xi[Cn]=Xi[Ue]=Xi[Oi]=!1;var Is=typeof Ul=="object"&&Ul&&Ul.Object===Object&&Ul,_a=typeof self=="object"&&self&&self.Object===Object&&self,Ir=Is||_a||Function("return this")(),zo=E&&!E.nodeType&&E,fi=zo&&v&&!v.nodeType&&v,Us=fi&&fi.exports===zo,_r=Us&&Is.process,Cr=function(){try{return _r&&_r.binding&&_r.binding("util")}catch{}}(),ga=Cr&&Cr.isTypedArray;function ya(ge,Ae){for(var ut=-1,jt=ge==null?0:ge.length;++ut<jt;)if(Ae(ge[ut],ut,ge))return!0;return!1}function va(ge){var Ae=-1,ut=Array(ge.size);return ge.forEach(function(jt,nn){ut[++Ae]=[nn,jt]}),ut}function Ya(ge){var Ae=-1,ut=Array(ge.size);return ge.forEach(function(jt){ut[++Ae]=jt}),ut}var ba,js,xa,Qa=Array.prototype,wa=Function.prototype,qs=Object.prototype,Sa=Ir["__core-js_shared__"],ps=wa.toString,So=qs.hasOwnProperty,yl=(ba=/[^.]+$/.exec(Sa&&Sa.keys&&Sa.keys.IE_PROTO||""))?"Symbol(src)_1."+ba:"",vl=qs.toString,Kl=RegExp("^"+ps.call(So).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),bl=Us?Ir.Buffer:void 0,Ta=Ir.Symbol,Ia=Ir.Uint8Array,Zs=qs.propertyIsEnumerable,$a=Qa.splice,Do=Ta?Ta.toStringTag:void 0,fs=Object.getOwnPropertySymbols,xl=bl?bl.isBuffer:void 0,wl=(js=Object.keys,xa=Object,function(ge){return js(xa(ge))}),Gs=ms(Ir,"DataView"),ro=ms(Ir,"Map"),Ca=ms(Ir,"Promise"),To=ms(Ir,"Set"),Ho=ms(Ir,"WeakMap"),Cs=ms(Object,"create"),el=Yo(Gs),Li=Yo(ro),hn=Yo(Ca),Jl=Yo(To),gi=Yo(Ho),Xo=Ta?Ta.prototype:void 0,tn=Xo?Xo.valueOf:void 0;function Bi(ge){var Ae=-1,ut=ge==null?0:ge.length;for(this.clear();++Ae<ut;){var jt=ge[Ae];this.set(jt[0],jt[1])}}function Fr(ge){var Ae=-1,ut=ge==null?0:ge.length;for(this.clear();++Ae<ut;){var jt=ge[Ae];this.set(jt[0],jt[1])}}function Ko(ge){var Ae=-1,ut=ge==null?0:ge.length;for(this.clear();++Ae<ut;){var jt=ge[Ae];this.set(jt[0],jt[1])}}function ks(ge){var Ae=-1,ut=ge==null?0:ge.length;for(this.__data__=new Ko;++Ae<ut;)this.add(ge[Ae])}function oo(ge){var Ae=this.__data__=new Fr(ge);this.size=Ae.size}function ka(ge,Ae){var ut=_s(ge),jt=!ut&&La(ge),nn=!ut&&!jt&&za(ge),Si=!ut&&!jt&&!nn&&Ps(ge),yn=ut||jt||nn||Si,kn=yn?function(Ni,kr){for(var ko=-1,cr=Array(Ni);++ko<Ni;)cr[ko]=kr(ko);return cr}(ge.length,String):[],An=kn.length;for(var vn in ge)!Ae&&!So.call(ge,vn)||yn&&(vn=="length"||nn&&(vn=="offset"||vn=="parent")||Si&&(vn=="buffer"||vn=="byteLength"||vn=="byteOffset")||Tl(vn,An))||kn.push(vn);return kn}function Es(ge,Ae){for(var ut=ge.length;ut--;)if(As(ge[ut][0],Ae))return ut;return-1}function Jo(ge){return ge==null?ge===void 0?"[object Undefined]":"[object Null]":Do&&Do in Object(ge)?function(Ae){var ut=So.call(Ae,Do),jt=Ae[Do];try{Ae[Do]=void 0;var nn=!0}catch{}var Si=vl.call(Ae);return nn&&(ut?Ae[Do]=jt:delete Ae[Do]),Si}(ge):function(Ae){return vl.call(Ae)}(ge)}function Ea(ge){return Co(ge)&&Jo(ge)==se}function Ms(ge,Ae,ut,jt,nn){return ge===Ae||(ge==null||Ae==null||!Co(ge)&&!Co(Ae)?ge!=ge&&Ae!=Ae:function(Si,yn,kn,An,vn,Ni){var kr=_s(Si),ko=_s(yn),cr=kr?le:Io(Si),Eo=ko?le:Io(yn),Er=(cr=cr==se?ti:cr)==ti,Xs=(Eo=Eo==se?ti:Eo)==ti,Yn=cr==Eo;if(Yn&&za(Si)){if(!za(yn))return!1;kr=!0,Er=!1}if(Yn&&!Er)return Ni||(Ni=new oo),kr||Ps(Si)?Sl(Si,yn,kn,An,vn,Ni):function(Yi,Vi,Js,so,$o,Pn,ft){switch(Js){case gn:if(Yi.byteLength!=Vi.byteLength||Yi.byteOffset!=Vi.byteOffset)return!1;Yi=Yi.buffer,Vi=Vi.buffer;case un:return!(Yi.byteLength!=Vi.byteLength||!Pn(new Ia(Yi),new Ia(Vi)));case xe:case Ge:case ct:return As(+Yi,+Vi);case Ye:return Yi.name==Vi.name&&Yi.message==Vi.message;case ni:case Ue:return Yi==Vi+"";case _t:var ao=va;case Cn:var Xr=1&so;if(ao||(ao=Ya),Yi.size!=Vi.size&&!Xr)return!1;var Oo=ft.get(Yi);if(Oo)return Oo==Vi;so|=2,ft.set(Yi,Vi);var gs=Sl(ao(Yi),ao(Vi),so,$o,Pn,ft);return ft.delete(Yi),gs;case Et:if(tn)return tn.call(Yi)==tn.call(Vi)}return!1}(Si,yn,cr,kn,An,vn,Ni);if(!(1&kn)){var Rr=Er&&So.call(Si,"__wrapped__"),Ks=Xs&&So.call(yn,"__wrapped__");if(Rr||Ks){var Fo=Rr?Si.value():Si,Ro=Ks?yn.value():yn;return Ni||(Ni=new oo),vn(Fo,Ro,kn,An,Ni)}}return Yn?(Ni||(Ni=new oo),function(Yi,Vi,Js,so,$o,Pn){var ft=1&Js,ao=Ma(Yi),Xr=ao.length,Oo=Ma(Vi).length;if(Xr!=Oo&&!ft)return!1;for(var gs=Xr;gs--;){var at=ao[gs];if(!(ft?at in Vi:So.call(Vi,at)))return!1}var Fa=Pn.get(Yi);if(Fa&&Pn.get(Vi))return Fa==Vi;var Ls=!0;Pn.set(Yi,Vi),Pn.set(Vi,Yi);for(var tl=ft;++gs<Xr;){var zs=Yi[at=ao[gs]],Ys=Vi[at];if(so)var il=ft?so(Ys,zs,at,Vi,Yi,Pn):so(zs,Ys,at,Yi,Vi,Pn);if(!(il===void 0?zs===Ys||$o(zs,Ys,Js,so,Pn):il)){Ls=!1;break}tl||(tl=at=="constructor")}if(Ls&&!tl){var Qs=Yi.constructor,Ra=Vi.constructor;Qs==Ra||!("constructor"in Yi)||!("constructor"in Vi)||typeof Qs=="function"&&Qs instanceof Qs&&typeof Ra=="function"&&Ra instanceof Ra||(Ls=!1)}return Pn.delete(Yi),Pn.delete(Vi),Ls}(Si,yn,kn,An,vn,Ni)):!1}(ge,Ae,ut,jt,Ms,nn))}function Ws(ge){return!(!gr(ge)||function(Ae){return!!yl&&yl in Ae}(ge))&&(dn(ge)?Kl:Tr).test(Yo(ge))}function Hs(ge){if(ut=(Ae=ge)&&Ae.constructor,jt=typeof ut=="function"&&ut.prototype||qs,Ae!==jt)return wl(ge);var Ae,ut,jt,nn=[];for(var Si in Object(ge))So.call(ge,Si)&&Si!="constructor"&&nn.push(Si);return nn}function Sl(ge,Ae,ut,jt,nn,Si){var yn=1&ut,kn=ge.length,An=Ae.length;if(kn!=An&&!(yn&&An>kn))return!1;var vn=Si.get(ge);if(vn&&Si.get(Ae))return vn==Ae;var Ni=-1,kr=!0,ko=2&ut?new ks:void 0;for(Si.set(ge,Ae),Si.set(Ae,ge);++Ni<kn;){var cr=ge[Ni],Eo=Ae[Ni];if(jt)var Er=yn?jt(Eo,cr,Ni,Ae,ge,Si):jt(cr,Eo,Ni,ge,Ae,Si);if(Er!==void 0){if(Er)continue;kr=!1;break}if(ko){if(!ya(Ae,function(Xs,Yn){if(Rr=Yn,!ko.has(Rr)&&(cr===Xs||nn(cr,Xs,ut,jt,Si)))return ko.push(Yn);var Rr})){kr=!1;break}}else if(cr!==Eo&&!nn(cr,Eo,ut,jt,Si)){kr=!1;break}}return Si.delete(ge),Si.delete(Ae),kr}function Ma(ge){return function(Ae,ut,jt){var nn=ut(Ae);return _s(Ae)?nn:function(Si,yn){for(var kn=-1,An=yn.length,vn=Si.length;++kn<An;)Si[vn+kn]=yn[kn];return Si}(nn,jt(Ae))}(ge,Da,Pa)}function Aa(ge,Ae){var ut,jt,nn=ge.__data__;return((jt=typeof(ut=Ae))=="string"||jt=="number"||jt=="symbol"||jt=="boolean"?ut!=="__proto__":ut===null)?nn[typeof Ae=="string"?"string":"hash"]:nn.map}function ms(ge,Ae){var ut=function(jt,nn){return jt==null?void 0:jt[nn]}(ge,Ae);return Ws(ut)?ut:void 0}Bi.prototype.clear=function(){this.__data__=Cs?Cs(null):{},this.size=0},Bi.prototype.delete=function(ge){var Ae=this.has(ge)&&delete this.__data__[ge];return this.size-=Ae?1:0,Ae},Bi.prototype.get=function(ge){var Ae=this.__data__;if(Cs){var ut=Ae[ge];return ut===V?void 0:ut}return So.call(Ae,ge)?Ae[ge]:void 0},Bi.prototype.has=function(ge){var Ae=this.__data__;return Cs?Ae[ge]!==void 0:So.call(Ae,ge)},Bi.prototype.set=function(ge,Ae){var ut=this.__data__;return this.size+=this.has(ge)?0:1,ut[ge]=Cs&&Ae===void 0?V:Ae,this},Fr.prototype.clear=function(){this.__data__=[],this.size=0},Fr.prototype.delete=function(ge){var Ae=this.__data__,ut=Es(Ae,ge);return!(ut<0)&&(ut==Ae.length-1?Ae.pop():$a.call(Ae,ut,1),--this.size,!0)},Fr.prototype.get=function(ge){var Ae=this.__data__,ut=Es(Ae,ge);return ut<0?void 0:Ae[ut][1]},Fr.prototype.has=function(ge){return Es(this.__data__,ge)>-1},Fr.prototype.set=function(ge,Ae){var ut=this.__data__,jt=Es(ut,ge);return jt<0?(++this.size,ut.push([ge,Ae])):ut[jt][1]=Ae,this},Ko.prototype.clear=function(){this.size=0,this.__data__={hash:new Bi,map:new(ro||Fr),string:new Bi}},Ko.prototype.delete=function(ge){var Ae=Aa(this,ge).delete(ge);return this.size-=Ae?1:0,Ae},Ko.prototype.get=function(ge){return Aa(this,ge).get(ge)},Ko.prototype.has=function(ge){return Aa(this,ge).has(ge)},Ko.prototype.set=function(ge,Ae){var ut=Aa(this,ge),jt=ut.size;return ut.set(ge,Ae),this.size+=ut.size==jt?0:1,this},ks.prototype.add=ks.prototype.push=function(ge){return this.__data__.set(ge,V),this},ks.prototype.has=function(ge){return this.__data__.has(ge)},oo.prototype.clear=function(){this.__data__=new Fr,this.size=0},oo.prototype.delete=function(ge){var Ae=this.__data__,ut=Ae.delete(ge);return this.size=Ae.size,ut},oo.prototype.get=function(ge){return this.__data__.get(ge)},oo.prototype.has=function(ge){return this.__data__.has(ge)},oo.prototype.set=function(ge,Ae){var ut=this.__data__;if(ut instanceof Fr){var jt=ut.__data__;if(!ro||jt.length<199)return jt.push([ge,Ae]),this.size=++ut.size,this;ut=this.__data__=new Ko(jt)}return ut.set(ge,Ae),this.size=ut.size,this};var Pa=fs?function(ge){return ge==null?[]:(ge=Object(ge),function(Ae,ut){for(var jt=-1,nn=Ae==null?0:Ae.length,Si=0,yn=[];++jt<nn;){var kn=Ae[jt];ut(kn,jt,Ae)&&(yn[Si++]=kn)}return yn}(fs(ge),function(Ae){return Zs.call(ge,Ae)}))}:function(){return[]},Io=Jo;function Tl(ge,Ae){return!!(Ae=Ae??Q)&&(typeof ge=="number"||ma.test(ge))&&ge>-1&&ge%1==0&&ge<Ae}function Yo(ge){if(ge!=null){try{return ps.call(ge)}catch{}try{return ge+""}catch{}}return""}function As(ge,Ae){return ge===Ae||ge!=ge&&Ae!=Ae}(Gs&&Io(new Gs(new ArrayBuffer(1)))!=gn||ro&&Io(new ro)!=_t||Ca&&Io(Ca.resolve())!=cn||To&&Io(new To)!=Cn||Ho&&Io(new Ho)!=Oi)&&(Io=function(ge){var Ae=Jo(ge),ut=Ae==ti?ge.constructor:void 0,jt=ut?Yo(ut):"";if(jt)switch(jt){case el:return gn;case Li:return _t;case hn:return cn;case Jl:return Cn;case gi:return Oi}return Ae});var La=Ea(function(){return arguments}())?Ea:function(ge){return Co(ge)&&So.call(ge,"callee")&&!Zs.call(ge,"callee")},_s=Array.isArray,za=xl||function(){return!1};function dn(ge){if(!gr(ge))return!1;var Ae=Jo(ge);return Ae==mt||Ae=="[object GeneratorFunction]"||Ae=="[object AsyncFunction]"||Ae=="[object Proxy]"}function Qo(ge){return typeof ge=="number"&&ge>-1&&ge%1==0&&ge<=Q}function gr(ge){var Ae=typeof ge;return ge!=null&&(Ae=="object"||Ae=="function")}function Co(ge){return ge!=null&&typeof ge=="object"}var Ps=ga?function(ge){return function(Ae){return ge(Ae)}}(ga):function(ge){return Co(ge)&&Qo(ge.length)&&!!Xi[Jo(ge)]};function Da(ge){return(Ae=ge)!=null&&Qo(Ae.length)&&!dn(Ae)?ka(ge):Hs(ge);var Ae}v.exports=function(ge,Ae){return Ms(ge,Ae)}})(Lo,Lo.exports);var ln=d(Lo.exports);function Ns(v,E){return v.length===E.length&&JSON.stringify(v.map(function(V){return V}).sort())===JSON.stringify(E.map(function(V){return V}).sort())}var Hr={Polygon:qe,LineString:ji,Point:bi,MultiPolygon:oi,MultiLineString:oi,MultiPoint:oi},Ja=Object.freeze({__proto__:null,CommonSelectors:_n,constrainFeatureMovement:Zo,createMidPoint:sr,createSupplementaryPoints:Dr,createVertex:Kt,doubleClickZoom:Gt,euclideanDistance:At,featuresAt:rt,getFeatureAtAndSetCursors:Bt,isClick:hi,isEventAtCoordinates:lr,isTap:Rn,mapEventToBoundingBox:Fe,ModeHandler:h,moveFeatures:Go,sortFeatures:qt,stringSetsAreEqual:Ns,StringSet:$e,theme:Ai,toDenseArray:Fi}),Wo=function(v,E){var V={options:v=function(se){se===void 0&&(se={});var le=Me(se);return se.controls||(le.controls={}),se.displayControlsDefault===!1?le.controls=Me(an,se.controls):le.controls=Me(Ts,se.controls),(le=Me(fa,le)).styles=Pi(le.styles,"cold").concat(Pi(le.styles,"hot")),le}(v)};E=function(se,le){return le.modes=me,le.getFeatureIdsAt=function(xe){return rt.click({point:xe},null,se).map(function(Ge){return Ge.properties.id})},le.getSelectedIds=function(){return se.store.getSelectedIds()},le.getSelected=function(){return{type:ye.FEATURE_COLLECTION,features:se.store.getSelectedIds().map(function(xe){return se.store.get(xe)}).map(function(xe){return xe.toGeoJSON()})}},le.getSelectedPoints=function(){return{type:ye.FEATURE_COLLECTION,features:se.store.getSelectedCoordinates().map(function(xe){return{type:ye.FEATURE,properties:{},geometry:{type:ye.POINT,coordinates:xe.coordinates}}})}},le.set=function(xe){if(xe.type===void 0||xe.type!==ye.FEATURE_COLLECTION||!Array.isArray(xe.features))throw new Error("Invalid FeatureCollection");var Ge=se.store.createRenderBatch(),Ye=se.store.getAllIds().slice(),mt=le.add(xe),_t=new $e(mt);return(Ye=Ye.filter(function(ct){return!_t.has(ct)})).length&&le.delete(Ye),Ge(),mt},le.add=function(xe){var Ge=JSON.parse(JSON.stringify(B(xe))).features.map(function(Ye){if(Ye.id=Ye.id||Mi(),Ye.geometry===null)throw new Error("Invalid geometry: null");if(se.store.get(Ye.id)===void 0||se.store.get(Ye.id).type!==Ye.geometry.type){var mt=Hr[Ye.geometry.type];if(mt===void 0)throw new Error("Invalid geometry type: "+Ye.geometry.type+".");var _t=new mt(se,Ye);se.store.add(_t)}else{var ct=se.store.get(Ye.id);ct.properties=Ye.properties,ln(ct.properties,Ye.properties)||se.store.featureChanged(ct.id),ln(ct.getCoordinates(),Ye.geometry.coordinates)||ct.incomingCoords(Ye.geometry.coordinates)}return Ye.id});return se.store.render(),Ge},le.get=function(xe){var Ge=se.store.get(xe);if(Ge)return Ge.toGeoJSON()},le.getAll=function(){return{type:ye.FEATURE_COLLECTION,features:se.store.getAll().map(function(xe){return xe.toGeoJSON()})}},le.delete=function(xe){return se.store.delete(xe,{silent:!0}),le.getMode()!==me.DIRECT_SELECT||se.store.getSelectedIds().length?se.store.render():se.events.changeMode(me.SIMPLE_SELECT,void 0,{silent:!0}),le},le.deleteAll=function(){return se.store.delete(se.store.getAllIds(),{silent:!0}),le.getMode()===me.DIRECT_SELECT?se.events.changeMode(me.SIMPLE_SELECT,void 0,{silent:!0}):se.store.render(),le},le.changeMode=function(xe,Ge){return Ge===void 0&&(Ge={}),xe===me.SIMPLE_SELECT&&le.getMode()===me.SIMPLE_SELECT?(Ns(Ge.featureIds||[],se.store.getSelectedIds())||(se.store.setSelected(Ge.featureIds,{silent:!0}),se.store.render()),le):(xe===me.DIRECT_SELECT&&le.getMode()===me.DIRECT_SELECT&&Ge.featureId===se.store.getSelectedIds()[0]||se.events.changeMode(xe,Ge,{silent:!0}),le)},le.getMode=function(){return se.events.getMode()},le.trash=function(){return se.events.trash({silent:!0}),le},le.combineFeatures=function(){return se.events.combineFeatures({silent:!0}),le},le.uncombineFeatures=function(){return se.events.uncombineFeatures({silent:!0}),le},le.setFeatureProperty=function(xe,Ge,Ye){return se.store.setFeatureProperty(xe,Ge,Ye),le},le}(V,E),V.api=E;var Q=mr(V);return E.onAdd=Q.onAdd,E.onRemove=Q.onRemove,E.types=he,E.options=v,E};function Vs(v){Wo(v,this)}return Vs.modes=Wn,Vs.constants=Qe,Vs.lib=Ja,Vs})})(jf);var Fy=jf.exports;const Wa=Lf(Fy);function Ry(p){let a,h,d;return{c(){a=Ee("button"),a.textContent="Import current view",ui(a,"type","button")},m(y,S){Ke(y,a,S),h||(d=li(a,"click",p[0]),h=!0)},p:_i,i:_i,o:_i,d(y){y&&He(a),h=!1,d()}}}function Oy(p){let a='poly:"';for(let[d,y]of p.geometry.coordinates[0])a+=`${y} ${d} `;return a=a.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${a}); node(w)->.x; <;); out meta;`}`}function Pc(p){return[p.lng,p.lat]}function By(p,a,h){let{map:d}=a;const y=Hc();let S=null;Ss(()=>{d!=null&&d.loaded()&&S&&d.removeControl(S)});async function k(M){try{y("loading","Loading from Overpass");let te=await(await fetch(Oy(M))).text();y("gotXml",te)}catch(q){y("error",q.toString())}}function s(){let M=d.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[Pc(M.getSouthWest()),Pc(M.getNorthWest()),Pc(M.getNorthEast()),Pc(M.getSouthEast()),Pc(M.getSouthWest())]],type:"Polygon"}}}async function D(){if(d){if(d.getZoom()<13){y("error","Zoom in more to import");return}await k(s())}}return p.$$set=M=>{"map"in M&&h(1,d=M.map)},p.$$.update=()=>{p.$$.dirty&14&&d&&!S&&(h(2,Wa.constants.classes.CONTROL_BASE="maplibregl-ctrl",Wa),h(2,Wa.constants.classes.CONTROL_PREFIX="maplibregl-ctrl-",Wa),h(2,Wa.constants.classes.CONTROL_GROUP="maplibregl-ctrl-group",Wa),h(3,S=new Wa({displayControlsDefault:!1,controls:{polygon:!0}})),d.addControl(S),d.on("draw.create",async M=>{let q=M.features[0];S.deleteAll(),await k(q)}))},[D,d,Wa,S]}class Ny extends Wi{constructor(a){super(),Gi(this,a,By,Ry,Di,{map:1})}}function tf(p,a,h){const d=p.slice();return d[1]=a[h][0],d[2]=a[h][1],d}function nf(p){let a,h,d=p[1]+"",y,S,k=p[2]+"",s;return{c(){a=Ee("tr"),h=Ee("td"),y=ki(d),S=Ee("td"),s=ki(k)},m(D,M){Ke(D,a,M),we(a,h),we(h,y),we(a,S),we(S,s)},p(D,M){M&1&&d!==(d=D[1]+"")&&xo(y,d),M&1&&k!==(k=D[2]+"")&&xo(s,k)},d(D){D&&He(a)}}}function Vy(p){let a,h,d=Wl(Object.entries(p[0])),y=[];for(let S=0;S<d.length;S+=1)y[S]=nf(tf(p,d,S));return{c(){a=Ee("table"),h=Ee("tbody");for(let S=0;S<y.length;S+=1)y[S].c();ui(a,"class","svelte-lh2o9l")},m(S,k){Ke(S,a,k),we(a,h);for(let s=0;s<y.length;s+=1)y[s]&&y[s].m(h,null)},p(S,[k]){if(k&1){d=Wl(Object.entries(S[0]));let s;for(s=0;s<d.length;s+=1){const D=tf(S,d,s);y[s]?y[s].p(D,k):(y[s]=nf(D),y[s].c(),y[s].m(h,null))}for(;s<y.length;s+=1)y[s].d(1);y.length=d.length}},i:_i,o:_i,d(S){S&&He(a),Gh(y,S)}}}function Uy(p,a,h){let{properties:d}=a;return p.$$set=y=>{"properties"in y&&h(0,d=y.properties)},[d]}class qf extends Wi{constructor(a){super(),Gi(this,a,Uy,Vy,Di,{properties:0})}}const Qh=["==",["geometry-type"],"Polygon"],Zf=["==",["geometry-type"],"LineString"],Gf=["==",["geometry-type"],"Point"];function Gl(p,a,h){let d=["match",p];for(let[y,S]of Object.entries(a))d.push(y),d.push(S);return d.push(h),d}function jy(p,a){let h=document.createElement("a");h.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(a)),h.setAttribute("download",p),document.body.appendChild(h),h.click(),document.body.removeChild(h)}function Zi(p){if(p==null||p==null)throw new Error("Oops, notNull given something null");return p}const Wf=hr({type:"FeatureCollection",features:[]}),qy=hr(!0),Hf=hr(0),Zy=30;class Gy{constructor(a,h){io(this,"map");io(this,"inner");io(this,"active");io(this,"eventListenersSuccess");io(this,"eventListenersUpdated");io(this,"eventListenersFailure");io(this,"onMouseMove",a=>{if(!this.active)return;const h=[a.point.x-Zy,a.point.y],d=this.map.unproject(a.point).distanceTo(this.map.unproject(h));this.inner.onMouseMove(a.lngLat.lng,a.lngLat.lat,d)&&(this.redraw(),this.dataUpdated())});io(this,"onClick",()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())});io(this,"onDoubleClick",a=>{this.active&&(a.preventDefault(),this.inner.onClick(),this.finish())});io(this,"onDragStart",()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()});io(this,"onMouseUp",()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()});io(this,"onKeyDown",a=>{this.active&&a.key=="Escape"&&(a.stopPropagation(),this.cancel())});io(this,"onKeyPress",a=>{this.active&&a.target.tagName!="INPUT"&&(a.key=="Enter"?(a.stopPropagation(),this.finish()):a.key=="s"?(a.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):a.key=="z"&&a.ctrlKey&&this.undo())});this.map=a,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new zu(h),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(a){a.properties??(a.properties={}),this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),a.properties.waypoints||(a.properties.waypoints=[{lon:a.geometry.coordinates[0][0],lat:a.geometry.coordinates[0][1],snapped:!0},{lon:a.geometry.coordinates[a.geometry.coordinates.length-1][0],lat:a.geometry.coordinates[a.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(a.properties.waypoints),this.redraw()}editExistingArea(a){a.properties??(a.properties={}),this.active&&window.alert("Bug: editExistingArea called when tool is already active"),a.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(a.properties.waypoints),this.redraw()}addEventListenerSuccess(a){this.eventListenersSuccess.push(a)}addEventListenerUpdated(a){this.eventListenersUpdated.push(a)}addEventListenerFailure(a){this.eventListenersFailure.push(a)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let a=this.inner.toFinalFeature();if(a)for(let h of this.eventListenersSuccess)h(JSON.parse(a));else for(let h of this.eventListenersFailure)h();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(a){this.inner.setRouteConfig(a),this.redraw()}addSnappedWaypoint(a){this.inner.addSnappedWaypoint(a[0],a[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}redraw(){let a=JSON.parse(this.inner.renderGeojson());Wf.set(a),this.map.getCanvas().style.cursor=a.cursor,qy.set(a.snap_mode),Hf.set(a.undo_length)}dataUpdated(){let a=this.inner.toFinalFeature();if(a)for(let h of this.eventListenersUpdated)h(JSON.parse(a))}}let jo=hr(null),Fn=hr({mode:"title"}),jh=hr(!0),_l=hr(null),Nc=hr(""),qh=hr(null),Zh=hr(null);const Wy=p=>({}),rf=p=>({}),Hy=p=>({}),of=p=>({});function sf(p){let a;const h=p[7]["line-popup"],d=go(h,p,p[10],of);return{c(){d&&d.c()},m(y,S){d&&d.m(y,S),a=!0},p(y,S){d&&d.p&&(!a||S&1024)&&vo(d,h,y,y[10],a?yo(h,y[10],S,Hy):bo(y[10]),of)},i(y){a||(Pe(d,y),a=!0)},o(y){Ve(d,y),a=!1},d(y){d&&d.d(y)}}}function Xy(p){let a,h,d=p[0]&&sf(p);return{c(){d&&d.c(),a=us()},m(y,S){d&&d.m(y,S),Ke(y,a,S),h=!0},p(y,S){y[0]?d?(d.p(y,S),S&1&&Pe(d,1)):(d=sf(y),d.c(),Pe(d,1),d.m(a.parentNode,a)):d&&(dr(),Ve(d,1,1,()=>{d=null}),pr())},i(y){h||(Pe(d),h=!0)},o(y){Ve(d),h=!1},d(y){y&&He(a),d&&d.d(y)}}}function af(p){let a;const h=p[7]["circle-popup"],d=go(h,p,p[10],rf);return{c(){d&&d.c()},m(y,S){d&&d.m(y,S),a=!0},p(y,S){d&&d.p&&(!a||S&1024)&&vo(d,h,y,y[10],a?yo(h,y[10],S,Wy):bo(y[10]),rf)},i(y){a||(Pe(d,y),a=!0)},o(y){Ve(d,y),a=!1},d(y){d&&d.d(y)}}}function Ky(p){let a,h,d=p[0]&&af(p);return{c(){d&&d.c(),a=us()},m(y,S){d&&d.m(y,S),Ke(y,a,S),h=!0},p(y,S){y[0]?d?(d.p(y,S),S&1&&Pe(d,1)):(d=af(y),d.c(),Pe(d,1),d.m(a.parentNode,a)):d&&(dr(),Ve(d,1,1,()=>{d=null}),pr())},i(y){h||(Pe(d),h=!0)},o(y){Ve(d),h=!1},d(y){y&&He(a),d&&d.d(y)}}}function Jy(p){let a,h,d,y,S,k;return a=new Ru({props:{beforeId:p[5]?"Building":void 0,filter:Qh,manageHoverState:!0,paint:{"fill-color":["get","color"],"fill-opacity":p[0]?Uh(.3,.5):.3}}}),d=new Xl({props:{filter:Zf,paint:{"line-width":5,"line-color":Gl(["get","kind"],{interior_road:["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",p[4],"#A32015"],crosses:"blue"},"red")},hoverCursor:p[0]?"pointer":void 0,$$slots:{default:[Xy]},$$scope:{ctx:p}}}),d.$on("click",p[8]),S=new Rf({props:{filter:Gf,paint:{"circle-radius":15,"circle-color":Gl(["get","kind"],{border_intersection:"green",modal_filter:"black"},"red")},$$slots:{default:[Ky]},$$scope:{ctx:p}}}),S.$on("click",p[9]),{c(){Ft(a.$$.fragment),h=Tt(),Ft(d.$$.fragment),y=Tt(),Ft(S.$$.fragment)},m(s,D){Lt(a,s,D),Ke(s,h,D),Lt(d,s,D),Ke(s,y,D),Lt(S,s,D),k=!0},p(s,D){const M={};D&32&&(M.beforeId=s[5]?"Building":void 0),D&1&&(M.paint={"fill-color":["get","color"],"fill-opacity":s[0]?Uh(.3,.5):.3}),a.$set(M);const q={};D&16&&(q.paint={"line-width":5,"line-color":Gl(["get","kind"],{interior_road:["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",s[4],"#A32015"],crosses:"blue"},"red")}),D&1&&(q.hoverCursor=s[0]?"pointer":void 0),D&1025&&(q.$$scope={dirty:D,ctx:s}),d.$set(q);const te={};D&1025&&(te.$$scope={dirty:D,ctx:s}),S.$set(te)},i(s){k||(Pe(a.$$.fragment,s),Pe(d.$$.fragment,s),Pe(S.$$.fragment,s),k=!0)},o(s){Ve(a.$$.fragment,s),Ve(d.$$.fragment,s),Ve(S.$$.fragment,s),k=!1},d(s){s&&(He(h),He(y)),zt(a,s),zt(d,s),zt(S,s)}}}function Yy(p){let a,h;return a=new Ka({props:{data:p[3],generateId:!0,$$slots:{default:[Jy]},$$scope:{ctx:p}}}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p(d,[y]){const S={};y&8&&(S.data=d[3]),y&1079&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function Qy(p,a,h){let d;$t(p,jh,ye=>h(5,d=ye));let{$$slots:y={},$$scope:S}=a,{gjInput:k}=a,{interactive:s=!0}=a,{onClickLine:D=ye=>{}}=a,{onClickCircle:M=ye=>{}}=a,q,te;function ce(ye){let me=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];h(4,te=Math.max(...k.features.map(Te=>Te.properties.shortcuts??0)));for(let Te of k.features)Te.properties??(Te.properties={}),Te.properties.color=="disconnected"?Te.properties.color="red":Object.hasOwn(Te.properties,"color")&&(Te.properties.color=me[Te.properties.color%me.length]);h(3,q=k)}const be=ye=>s&&D(ye.detail.features[0]),he=ye=>s&&M(ye.detail.features[0]);return p.$$set=ye=>{"gjInput"in ye&&h(6,k=ye.gjInput),"interactive"in ye&&h(0,s=ye.interactive),"onClickLine"in ye&&h(1,D=ye.onClickLine),"onClickCircle"in ye&&h(2,M=ye.onClickCircle),"$$scope"in ye&&h(10,S=ye.$$scope)},p.$$.update=()=>{p.$$.dirty&64&&ce()},[s,D,M,q,te,d,k,y,be,he,S]}class Bu extends Wi{constructor(a){super(),Gi(this,a,Qy,Yy,Di,{gjInput:6,interactive:0,onClickLine:1,onClickCircle:2})}}const $y=p=>({}),lf=p=>({}),e0=p=>({}),cf=p=>({});function t0(p){let a,h,d,y;const S=p[3].sidebar,k=go(S,p,p[2],cf),s=p[3].map,D=go(s,p,p[2],lf);return{c(){a=Ee("div"),k&&k.c(),h=Tt(),d=Ee("div"),D&&D.c()},m(M,q){Ke(M,a,q),k&&k.m(a,null),p[4](a),Ke(M,h,q),Ke(M,d,q),D&&D.m(d,null),p[5](d),y=!0},p(M,[q]){k&&k.p&&(!y||q&4)&&vo(k,S,M,M[2],y?yo(S,M[2],q,e0):bo(M[2]),cf),D&&D.p&&(!y||q&4)&&vo(D,s,M,M[2],y?yo(s,M[2],q,$y):bo(M[2]),lf)},i(M){y||(Pe(k,M),Pe(D,M),y=!0)},o(M){Ve(k,M),Ve(D,M),y=!1},d(M){M&&(He(a),He(h),He(d)),k&&k.d(M),p[4](null),D&&D.d(M),p[5](null)}}}function i0(p,a,h){let d,y;$t(p,qh,M=>h(0,d=M)),$t(p,Zh,M=>h(1,y=M));let{$$slots:S={},$$scope:k}=a;function s(M){qr[M?"unshift":"push"](()=>{d=M,qh.set(d)})}function D(M){qr[M?"unshift":"push"](()=>{y=M,Zh.set(y)})}return p.$$set=M=>{"$$scope"in M&&h(2,k=M.$$scope)},[d,y,k,S,s,D]}class gl extends Wi{constructor(a){super(),Gi(this,a,i0,t0,Di,{})}}function n0(p){let a,h,d,y,S,k,s;return{c(){a=Ee("div"),h=Ee("h1"),h.textContent="Debug mode",d=Tt(),y=Ee("div"),S=Ee("button"),S.textContent="Back to editing",ui(a,"slot","sidebar")},m(D,M){Ke(D,a,M),we(a,h),we(a,d),we(a,y),we(y,S),k||(s=li(S,"click",p[3]),k=!0)},p:_i,d(D){D&&He(a),k=!1,s()}}}function r0(p){let a,h;return a=new qf({props:{properties:Zi(p[4]).properties}}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p(d,y){const S={};y&16&&(S.properties=Zi(d[4]).properties),a.$set(S)},i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function o0(p){let a,h,d;return h=new Kc({props:{openOn:"hover",$$slots:{default:[r0,({data:y})=>({4:y}),({data:y})=>y?16:0]},$$scope:{ctx:p}}}),{c(){a=Ee("div"),Ft(h.$$.fragment),ui(a,"slot","line-popup")},m(y,S){Ke(y,a,S),Lt(h,a,null),d=!0},p(y,S){const k={};S&48&&(k.$$scope={dirty:S,ctx:y}),h.$set(k)},i(y){d||(Pe(h.$$.fragment,y),d=!0)},o(y){Ve(h.$$.fragment,y),d=!1},d(y){y&&He(a),zt(h)}}}function s0(p){let a,h;return a=new qf({props:{properties:Zi(p[4]).properties}}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p(d,y){const S={};y&16&&(S.properties=Zi(d[4]).properties),a.$set(S)},i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function a0(p){let a,h,d;return h=new Kc({props:{openOn:"hover",$$slots:{default:[s0,({data:y})=>({4:y}),({data:y})=>y?16:0]},$$scope:{ctx:p}}}),{c(){a=Ee("div"),Ft(h.$$.fragment),ui(a,"slot","circle-popup")},m(y,S){Ke(y,a,S),Lt(h,a,null),d=!0},p(y,S){const k={};S&48&&(k.$$scope={dirty:S,ctx:y}),h.$set(k)},i(y){d||(Pe(h.$$.fragment,y),d=!0)},o(y){Ve(h.$$.fragment,y),d=!1},d(y){y&&He(a),zt(h)}}}function l0(p){let a,h,d;return h=new Bu({props:{gjInput:JSON.parse(Zi(p[0]).renderNeighbourhood()),interactive:!0,onClickLine:p[2],$$slots:{"circle-popup":[a0],"line-popup":[o0]},$$scope:{ctx:p}}}),{c(){a=Ee("div"),Ft(h.$$.fragment),ui(a,"slot","map")},m(y,S){Ke(y,a,S),Lt(h,a,null),d=!0},p(y,S){const k={};S&1&&(k.gjInput=JSON.parse(Zi(y[0]).renderNeighbourhood())),S&32&&(k.$$scope={dirty:S,ctx:y}),h.$set(k)},i(y){d||(Pe(h.$$.fragment,y),d=!0)},o(y){Ve(h.$$.fragment,y),d=!1},d(y){y&&He(a),zt(h)}}}function c0(p){let a,h;return a=new gl({props:{$$slots:{map:[l0],sidebar:[n0]},$$scope:{ctx:p}}}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p(d,[y]){const S={};y&35&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function u0(p,a,h){let d,y;return $t(p,jo,s=>h(0,d=s)),$t(p,Fn,s=>h(1,y=s)),[d,y,s=>window.open(Zi(s.properties).way,"_blank"),()=>rn(Fn,y={mode:"neighbourhood"},y)]}class h0 extends Wi{constructor(a){super(),Gi(this,a,u0,c0,Di,{})}}function uf(p,a,h){const d=p.slice();return d[7]=a[h][0],d[8]=a[h][1],d[9]=a[h][2],d}function hf(p){let a,h,d,y,S=p[8]+"",k,s,D,M,q;function te(){return p[3](p[7])}return{c(){a=Ee("div"),h=Ee("button"),d=Ee("img"),k=ki(S),D=Tt(),Fh(d.src,y=`/filters/${p[7]}.svg`)||ui(d,"src",y),ui(d,"alt",p[8]),jl(h,"width","100%"),h.disabled=s=p[0]==p[7]},m(ce,be){Ke(ce,a,be),we(a,h),we(h,d),we(h,k),we(a,D),M||(q=li(h,"click",te),M=!0)},p(ce,be){p=ce,be&1&&s!==(s=p[0]==p[7])&&(h.disabled=s)},d(ce){ce&&He(a),M=!1,q()}}}function d0(p){let a,h,d,y,S,k,s,D,M,q,te,ce,be=p[1][2]+"",he,ye,me,Te,De,Ze,Le=Wl(p[2]),tt=[];for(let Qe=0;Qe<Le.length;Qe+=1)tt[Qe]=hf(uf(p,Le,Qe));function xt(){return p[4](p[6])}return{c(){a=Ee("h3"),a.textContent="Choose a modal filter to place on streets",h=Tt(),d=Ee("table"),y=Ee("tr"),S=Ee("td");for(let Qe=0;Qe<tt.length;Qe+=1)tt[Qe].c();k=Tt(),s=Ee("td"),D=Ee("img"),te=Tt(),ce=Ee("p"),he=ki(be),ye=Tt(),me=Ee("center"),Te=Ee("button"),Te.textContent="Confirm",Fh(D.src,M=`/filters/${p[0]}.gif`)||ui(D,"src",M),ui(D,"height","300"),ui(D,"alt",q=p[1][1])},m(Qe,Dt){Ke(Qe,a,Dt),Ke(Qe,h,Dt),Ke(Qe,d,Dt),we(d,y),we(y,S);for(let bt=0;bt<tt.length;bt+=1)tt[bt]&&tt[bt].m(S,null);we(y,k),we(y,s),we(s,D),we(s,te),we(s,ce),we(ce,he),Ke(Qe,ye,Dt),Ke(Qe,me,Dt),we(me,Te),De||(Ze=li(Te,"click",xt),De=!0)},p(Qe,Dt){if(p=Qe,Dt&5){Le=Wl(p[2]);let bt;for(bt=0;bt<Le.length;bt+=1){const qt=uf(p,Le,bt);tt[bt]?tt[bt].p(qt,Dt):(tt[bt]=hf(qt),tt[bt].c(),tt[bt].m(S,null))}for(;bt<tt.length;bt+=1)tt[bt].d(1);tt.length=Le.length}Dt&1&&!Fh(D.src,M=`/filters/${p[0]}.gif`)&&ui(D,"src",M),Dt&2&&q!==(q=p[1][1])&&ui(D,"alt",q),Dt&2&&be!==(be=p[1][2]+"")&&xo(he,be)},d(Qe){Qe&&(He(a),He(h),He(d),He(ye),He(me)),Gh(tt,Qe),De=!1,Ze()}}}function p0(p){let a,h;return a=new Uf({props:{$$slots:{default:[d0,({dialog:d})=>({6:d}),({dialog:d})=>d?64:0]},$$scope:{ctx:p}}}),a.$on("close",p[5]),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p(d,[y]){const S={};y&4163&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function f0(p,a,h){let d,{filterType:y}=a,S=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]];const k=M=>h(0,y=M),s=M=>Zi(M).close();function D(M){ur.call(this,p,M)}return p.$$set=M=>{"filterType"in M&&h(0,y=M.filterType)},p.$$.update=()=>{p.$$.dirty&1&&h(1,d=S.find(M=>M[0]==y))},[y,d,S,k,s,D]}class m0 extends Wi{constructor(a){super(),Gi(this,a,f0,p0,Di,{filterType:0})}}function df(p){let a,h;return a=new Ka({props:{data:p[0],$$slots:{default:[_0]},$$scope:{ctx:p}}}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p(d,y){const S={};y&1&&(S.data=d[0]),y&64&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function _0(p){let a,h;return a=new Xl({props:{paint:{"line-width":5,"line-color":"red"}}}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p:_i,i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function g0(p){let a,h,d=p[0]&&df(p);return{c(){d&&d.c(),a=us()},m(y,S){d&&d.m(y,S),Ke(y,a,S),h=!0},p(y,[S]){y[0]?d?(d.p(y,S),S&1&&Pe(d,1)):(d=df(y),d.c(),Pe(d,1),d.m(a.parentNode,a)):d&&(dr(),Ve(d,1,1,()=>{d=null}),pr())},i(y){h||(Pe(d),h=!0)},o(y){Ve(d),h=!1},d(y){y&&He(a),d&&d.d(y)}}}function y0(p,a,h){let{map:d}=a,y=null;const S=Hc();d.on("dragstart",k),d.on("mousemove",s),d.on("mouseup",D),Ss(()=>{d.dragPan.enable(),d.off("dragstart",k),d.off("mousemove",s),d.off("mouseup",D)});function k(){d.dragPan.disable(),h(0,y={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function s(M){y&&(y.geometry.coordinates.push(M.lngLat.toArray()),h(0,y))}function D(){y&&(S("done",y),h(0,y=null))}return p.$$set=M=>{"map"in M&&h(1,d=M.map)},[y,d]}class v0 extends Wi{constructor(a){super(),Gi(this,a,y0,g0,Di,{map:1})}}function b0(p){let a,h,d,y,S,k,s,D,M,q,te,ce,be,he,ye,me,Te,De,Ze;return me=new Vf({props:{msg:p[0]}}),{c(){a=Ee("details"),h=Ee("summary"),h.textContent="Save / load project",d=Tt(),y=Ee("div"),S=Ee("button"),S.textContent="Save to GJ",k=Tt(),s=Ee("div"),D=Ee("label"),M=ki(`Load edits from GJ
      `),q=Ee("input"),te=Tt(),ce=Ee("div"),be=Ee("button"),be.textContent="Save to local storage",he=Ee("button"),he.textContent="Load from local storage",ye=Tt(),Ft(me.$$.fragment),ui(q,"type","file")},m(Le,tt){Ke(Le,a,tt),we(a,h),we(a,d),we(a,y),we(y,S),we(a,k),we(a,s),we(s,D),we(D,M),we(D,q),p[7](q),we(a,te),we(a,ce),we(ce,be),we(ce,he),Ke(Le,ye,tt),Lt(me,Le,tt),Te=!0,De||(Ze=[li(S,"click",p[2]),li(q,"change",p[3]),li(be,"click",p[5]),li(he,"click",p[4])],De=!0)},p(Le,[tt]){const xt={};tt&1&&(xt.msg=Le[0]),me.$set(xt)},i(Le){Te||(Pe(me.$$.fragment,Le),Te=!0)},o(Le){Ve(me.$$.fragment,Le),Te=!1},d(Le){Le&&(He(a),He(ye)),p[7](null),zt(me,Le),De=!1,qo(Ze)}}}function x0(p,a,h){let d,y,S,k;$t(p,jo,ye=>h(9,y=ye)),$t(p,Fn,ye=>h(10,S=ye)),$t(p,Nc,ye=>h(6,k=ye));let s=null;function D(){jy(d,y.toSavefile())}let M;async function q(ye){h(0,s="Loading project from file");try{be(await M.files[0].text())}catch(me){window.alert(`Couldn't open this file: ${me}`)}h(0,s=null)}function te(){h(0,s="Loading projects from local storage");try{let ye=window.localStorage.getItem(d);ye?be(ye):window.alert("Nothing was saved in local storage")}catch(ye){window.alert(`Couldn't load from local storage: ${ye}`)}h(0,s=null)}function ce(){window.localStorage.setItem(d,y.toSavefile())}function be(ye){y.loadSavefile(JSON.parse(ye)),rn(Fn,S={mode:"network"},S),jo.set(y)}function he(ye){qr[ye?"unshift":"push"](()=>{M=ye,h(1,M)})}return p.$$.update=()=>{p.$$.dirty&64&&(d=`ltn_${k||"custom"}.geojson`)},[s,M,D,q,te,ce,k,he]}class Xf extends Wi{constructor(a){super(),Gi(this,a,x0,b0,Di,{})}}function w0(p){let a,h,d;return{c(){a=ki("Undo ("),h=ki(p[5]),d=ki(")")},m(y,S){Ke(y,a,S),Ke(y,h,S),Ke(y,d,S)},p(y,S){S[0]&32&&xo(h,y[5])},d(y){y&&(He(a),He(h),He(d))}}}function S0(p){let a;return{c(){a=ki("Undo")},m(h,d){Ke(h,a,d)},p:_i,d(h){h&&He(a)}}}function T0(p){let a,h,d;return{c(){a=ki("Redo ("),h=ki(p[6]),d=ki(")")},m(y,S){Ke(y,a,S),Ke(y,h,S),Ke(y,d,S)},p(y,S){S[0]&64&&xo(h,y[6])},d(y){y&&(He(a),He(h),He(d))}}}function I0(p){let a;return{c(){a=ki("Redo")},m(h,d){Ke(h,a,d)},p:_i,d(h){h&&He(a)}}}function pf(p){let a,h,d;function y(k){p[21](k)}let S={};return p[2]!==void 0&&(S.filterType=p[2]),a=new m0({props:S}),qr.push(()=>ml(a,"filterType",y)),a.$on("close",p[22]),{c(){Ft(a.$$.fragment)},m(k,s){Lt(a,k,s),d=!0},p(k,s){const D={};!h&&s[0]&4&&(h=!0,D.filterType=k[2],fl(()=>h=!1)),a.$set(D)},i(k){d||(Pe(a.$$.fragment,k),d=!0)},o(k){Ve(a.$$.fragment,k),d=!1},d(k){zt(a,k)}}}function C0(p){let a,h,d,y=Zi(Zi(p[7]).properties).name+"",S,k,s,D,M,q,te,ce,be,he,ye,me,Te,De,Ze,Le,tt,xt,Qe,Dt,bt,qt,Fe,$e,Wt,rt,Qt,Bt,At,hi,Rn,On,Ei,Mi,Nt,bi,ji,qe,Zt,nt,oi,vt,qi,xn,Je,Fi,wn,xi,Zr,fr,Zn,Me,Kn;function mr(pi,Ji){return pi[5]==0?S0:w0}let Ai=mr(p),ii=Ai(p);function wr(pi,Ji){return pi[6]==0?I0:T0}let Jn=wr(p),Sn=Jn(p),en=p[4]&&pf(p);return fr=new Xf({}),{c(){a=Ee("div"),h=Ee("h1"),d=ki("Editing modal filters in "),S=ki(y),k=Tt(),s=Ee("p"),s.textContent=`Now that you've defined a neighbourhood boundary, you can see the possible
      shortcuts that vehicles are currently able to take through it. You can add
      a new modal filter to try and solve this. The colored "cell" areas show
      what's reachable for drivers without leaving the boundary you've drawn.`,D=Tt(),M=Ee("div"),q=Ee("button"),q.textContent="Start over and change your study area",te=Tt(),ce=Ee("div"),be=Ee("button"),be.textContent="Pick a different neighbourhood boundary",he=Tt(),ye=Ee("div"),me=Ee("button"),me.textContent="Change this neighbourhood boundary",Te=Tt(),De=Ee("hr"),Ze=Tt(),Le=Ee("div"),tt=Ee("button"),xt=ki("Add a modal filter"),Dt=Tt(),bt=Ee("button"),qt=ki("Add many modal filters along line"),$e=Tt(),Wt=Ee("button"),rt=ki("Change modal filter type"),Bt=Tt(),At=Ee("div"),hi=Ee("button"),ii.c(),On=Tt(),Ei=Ee("button"),Sn.c(),Nt=Tt(),en&&en.c(),bi=Tt(),ji=Ee("hr"),qe=Tt(),Zt=Ee("div"),nt=Ee("button"),nt.textContent="View shortcuts",oi=Tt(),vt=Ee("div"),qi=Ee("button"),qi.textContent="Route",xn=Tt(),Je=Ee("div"),Fi=Ee("button"),Fi.textContent="Debug",wn=Tt(),xi=Ee("hr"),Zr=Tt(),Ft(fr.$$.fragment),tt.disabled=Qe=p[0]||p[3],bt.disabled=Fe=p[0]||p[3],Wt.disabled=Qt=p[0]||p[3],hi.disabled=Rn=p[5]==0,Ei.disabled=Mi=p[6]==0,ui(a,"slot","sidebar")},m(pi,Ji){Ke(pi,a,Ji),we(a,h),we(h,d),we(h,S),we(a,k),we(a,s),we(a,D),we(a,M),we(M,q),we(a,te),we(a,ce),we(ce,be),we(a,he),we(a,ye),we(ye,me),we(a,Te),we(a,De),we(a,Ze),we(a,Le),we(Le,tt),we(tt,xt),we(Le,Dt),we(Le,bt),we(bt,qt),we(Le,$e),we(Le,Wt),we(Wt,rt),we(a,Bt),we(a,At),we(At,hi),ii.m(hi,null),we(At,On),we(At,Ei),Sn.m(Ei,null),we(a,Nt),en&&en.m(a,null),we(a,bi),we(a,ji),we(a,qe),we(a,Zt),we(Zt,nt),we(a,oi),we(a,vt),we(vt,qi),we(a,xn),we(a,Je),we(Je,Fi),we(a,wn),we(a,xi),we(a,Zr),Lt(fr,a,null),Zn=!0,Me||(Kn=[li(q,"click",p[16]),li(be,"click",p[14]),li(me,"click",p[17]),li(tt,"click",p[18]),li(bt,"click",p[19]),li(Wt,"click",p[20]),li(hi,"click",p[12]),li(Ei,"click",p[13]),li(nt,"click",p[23]),li(qi,"click",p[24]),li(Fi,"click",p[25])],Me=!0)},p(pi,Ji){(!Zn||Ji[0]&128)&&y!==(y=Zi(Zi(pi[7]).properties).name+"")&&xo(S,y),(!Zn||Ji[0]&9&&Qe!==(Qe=pi[0]||pi[3]))&&(tt.disabled=Qe),(!Zn||Ji[0]&9&&Fe!==(Fe=pi[0]||pi[3]))&&(bt.disabled=Fe),(!Zn||Ji[0]&9&&Qt!==(Qt=pi[0]||pi[3]))&&(Wt.disabled=Qt),Ai===(Ai=mr(pi))&&ii?ii.p(pi,Ji):(ii.d(1),ii=Ai(pi),ii&&(ii.c(),ii.m(hi,null))),(!Zn||Ji[0]&32&&Rn!==(Rn=pi[5]==0))&&(hi.disabled=Rn),Jn===(Jn=wr(pi))&&Sn?Sn.p(pi,Ji):(Sn.d(1),Sn=Jn(pi),Sn&&(Sn.c(),Sn.m(Ei,null))),(!Zn||Ji[0]&64&&Mi!==(Mi=pi[6]==0))&&(Ei.disabled=Mi),pi[4]?en?(en.p(pi,Ji),Ji[0]&16&&Pe(en,1)):(en=pf(pi),en.c(),Pe(en,1),en.m(a,bi)):en&&(dr(),Ve(en,1,1,()=>{en=null}),pr())},i(pi){Zn||(Pe(en),Pe(fr.$$.fragment,pi),Zn=!0)},o(pi){Ve(en),Ve(fr.$$.fragment,pi),Zn=!1},d(pi){pi&&He(a),ii.d(),Sn.d(),en&&en.d(),zt(fr),Me=!1,qo(Kn)}}}function k0(p){let a,h=Zi(p[30]).properties.shortcuts+"",d,y;return{c(){a=Ee("p"),d=ki(h),y=ki(" shortcuts")},m(S,k){Ke(S,a,k),we(a,d),we(a,y)},p(S,k){k[0]&1073741824&&h!==(h=Zi(S[30]).properties.shortcuts+"")&&xo(d,h)},d(S){S&&He(a)}}}function E0(p){let a,h,d;return h=new Kc({props:{openOn:"hover",$$slots:{default:[k0,({data:y})=>({30:y}),({data:y})=>[y?1073741824:0]]},$$scope:{ctx:p}}}),{c(){a=Ee("div"),Ft(h.$$.fragment),ui(a,"slot","line-popup")},m(y,S){Ke(y,a,S),Lt(h,a,null),d=!0},p(y,S){const k={};S[0]&1073741824|S[1]&1&&(k.$$scope={dirty:S,ctx:y}),h.$set(k)},i(y){d||(Pe(h.$$.fragment,y),d=!0)},o(y){Ve(h.$$.fragment,y),d=!1},d(y){y&&He(a),zt(h)}}}function ff(p){let a,h;return a=new v0({props:{map:Zi(p[1])}}),a.$on("done",p[15]),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p(d,y){const S={};y[0]&2&&(S.map=Zi(d[1])),a.$set(S)},i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function M0(p){let a,h,d,y;h=new Bu({props:{gjInput:p[8],interactive:!p[0]&&!p[3],onClickCircle:p[10],$$slots:{"line-popup":[E0]},$$scope:{ctx:p}}});let S=p[3]&&ff(p);return{c(){a=Ee("div"),Ft(h.$$.fragment),d=Tt(),S&&S.c(),ui(a,"slot","map")},m(k,s){Ke(k,a,s),Lt(h,a,null),we(a,d),S&&S.m(a,null),y=!0},p(k,s){const D={};s[0]&256&&(D.gjInput=k[8]),s[0]&9&&(D.interactive=!k[0]&&!k[3]),s[1]&1&&(D.$$scope={dirty:s,ctx:k}),h.$set(D),k[3]?S?(S.p(k,s),s[0]&8&&Pe(S,1)):(S=ff(k),S.c(),Pe(S,1),S.m(a,null)):S&&(dr(),Ve(S,1,1,()=>{S=null}),pr())},i(k){y||(Pe(h.$$.fragment,k),Pe(S),y=!0)},o(k){Ve(h.$$.fragment,k),Ve(S),y=!1},d(k){k&&He(a),zt(h),S&&S.d()}}}function A0(p){let a,h,d,y;return a=new gl({props:{$$slots:{map:[M0],sidebar:[C0]},$$scope:{ctx:p}}}),{c(){Ft(a.$$.fragment)},m(S,k){Lt(a,S,k),h=!0,d||(y=li(window,"keydown",p[11]),d=!0)},p(S,k){const s={};k[0]&1023|k[1]&1&&(s.$$scope={dirty:k,ctx:S}),a.$set(s)},i(S){h||(Pe(a.$$.fragment,S),h=!0)},o(S){Ve(a.$$.fragment,S),h=!1},d(S){zt(a,S),d=!1,y()}}}function P0(p,a,h){let d,y,S;$t(p,jo,At=>h(26,d=At)),$t(p,Fn,At=>h(9,y=At)),$t(p,_l,At=>h(1,S=At));let k="walk_cycle_only",s=!1,D=!1,M=!1,q=0,te=0,ce,be;he(d.renderNeighbourhood());function he(At){h(8,be=JSON.parse(At)),h(7,ce=be.features.find(hi=>hi.properties.kind=="boundary")),h(5,q=be.undo_length),h(6,te=be.redo_length)}Ss(()=>{me()});function ye(At){he(d.addModalFilter(At.lngLat,k)),me()}function me(){h(0,s=!1),S.off("click",ye),S.getCanvas().style.cursor="inherit"}function Te(At){At.properties.kind=="modal_filter"&&he(d.deleteModalFilter(At.properties.road))}function De(At){At.key=="a"&&!s&&!D&&h(0,s=!0),At.key=="z"&&At.ctrlKey&&Ze(),At.key=="y"&&At.ctrlKey&&Le()}function Ze(){he(d.undo())}function Le(){he(d.redo())}function tt(){rn(Fn,y={mode:"network"},y)}function xt(At){let hi=At.detail;hi&&he(d.addManyModalFilters(hi,k)),h(3,D=!1)}function Qe(){rn(Fn,y={mode:"title"},y),rn(jo,d=null,d)}const Dt=()=>rn(Fn,y={mode:"set-boundary",name:Zi(Zi(ce).properties).name,existing:ce},y),bt=()=>h(0,s=!0),qt=()=>h(3,D=!0),Fe=()=>h(4,M=!0);function $e(At){k=At,h(2,k)}const Wt=()=>h(4,M=!1),rt=()=>rn(Fn,y={mode:"view-shortcuts"},y),Qt=()=>rn(Fn,y={mode:"route"},y),Bt=()=>rn(Fn,y={mode:"debug"},y);return p.$$.update=()=>{p.$$.dirty[0]&3&&s&&(S.on("click",ye),S.getCanvas().style.cursor="crosshair")},[s,S,k,D,M,q,te,ce,be,y,Te,De,Ze,Le,tt,xt,Qe,Dt,bt,qt,Fe,$e,Wt,rt,Qt,Bt]}class L0 extends Wi{constructor(a){super(),Gi(this,a,P0,A0,Di,{},null,[-1,-1])}}function mf(p,a,h){const d=p.slice();return d[12]=a[h],d}function _f(p){let a,h,d=p[12]+"",y,S,k,s,D;function M(){return p[8](p[12])}function q(){return p[9](p[12])}return{c(){a=Ee("div"),h=Ee("button"),y=ki(d),S=Tt(),k=Ee("button"),k.textContent="X"},m(te,ce){Ke(te,a,ce),we(a,h),we(h,y),we(a,S),we(a,k),s||(D=[li(h,"click",M),li(k,"click",q)],s=!0)},p(te,ce){p=te,ce&2&&d!==(d=p[12]+"")&&xo(y,d)},d(te){te&&He(a),s=!1,qo(D)}}}function z0(p){let a,h,d,y,S,k,s,D,M,q,te,ce,be,he,ye,me,Te,De,Ze=Wl(p[1]),Le=[];for(let tt=0;tt<Ze.length;tt+=1)Le[tt]=_f(mf(p,Ze,tt));return ye=new Xf({}),{c(){a=Ee("div"),h=Ee("h1"),h.textContent="Define neighbourhood boundaries",d=Tt(),y=Ee("p"),y.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
      deliberately permit) through-traffic. An appropriate neighbourhood
      boundary depends on many factors. The simplest approach is to find the
      area bounded on all sides by "main" roads, which are designed for higher
      traffic volumes. There are many other considerations, though -- maybe
      severances like rivers or rail should be part of a boundary. Bridges and
      tunnels near a boundary may be confusing as well. And note that your
      boundary may not match the conventional definition of "neighbourhood."`,S=Tt(),k=Ee("div"),s=Ee("button"),s.textContent="Start over and change your study area",D=Tt(),M=Ee("div"),q=Ee("button"),q.textContent="Draw a new boundary",te=Tt();for(let tt=0;tt<Le.length;tt+=1)Le[tt].c();ce=Tt(),be=Ee("hr"),he=Tt(),Ft(ye.$$.fragment),ui(a,"slot","sidebar")},m(tt,xt){Ke(tt,a,xt),we(a,h),we(a,d),we(a,y),we(a,S),we(a,k),we(k,s),we(a,D),we(a,M),we(M,q),we(a,te);for(let Qe=0;Qe<Le.length;Qe+=1)Le[Qe]&&Le[Qe].m(a,null);we(a,ce),we(a,be),we(a,he),Lt(ye,a,null),me=!0,Te||(De=[li(s,"click",p[2]),li(q,"click",p[5])],Te=!0)},p(tt,xt){if(xt&26){Ze=Wl(tt[1]);let Qe;for(Qe=0;Qe<Ze.length;Qe+=1){const Dt=mf(tt,Ze,Qe);Le[Qe]?Le[Qe].p(Dt,xt):(Le[Qe]=_f(Dt),Le[Qe].c(),Le[Qe].m(a,ce))}for(;Qe<Le.length;Qe+=1)Le[Qe].d(1);Le.length=Ze.length}},i(tt){me||(Pe(ye.$$.fragment,tt),me=!0)},o(tt){Ve(ye.$$.fragment,tt),me=!1},d(tt){tt&&He(a),Gh(Le,tt),zt(ye),Te=!1,qo(De)}}}function D0(p){let a,h=Zi(p[11]).properties.name+"",d;return{c(){a=Ee("p"),d=ki(h)},m(y,S){Ke(y,a,S),we(a,d)},p(y,S){S&2048&&h!==(h=Zi(y[11]).properties.name+"")&&xo(d,h)},d(y){y&&He(a)}}}function F0(p){let a,h;return a=new Kc({props:{openOn:"hover",$$slots:{default:[D0,({data:d})=>({11:d}),({data:d})=>d?2048:0]},$$scope:{ctx:p}}}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p(d,y){const S={};y&34816&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function R0(p){let a,h;return a=new Ru({props:{filter:Qh,paint:{"fill-color":"red","fill-opacity":Uh(.3,.5)},manageHoverState:!0,hoverCursor:"pointer",$$slots:{default:[F0]},$$scope:{ctx:p}}}),a.$on("click",p[7]),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p(d,y){const S={};y&32768&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function O0(p){let a,h,d;return h=new Ka({props:{data:p[0],generateId:!0,$$slots:{default:[R0]},$$scope:{ctx:p}}}),{c(){a=Ee("div"),Ft(h.$$.fragment),ui(a,"slot","map")},m(y,S){Ke(y,a,S),Lt(h,a,null),d=!0},p(y,S){const k={};S&1&&(k.data=y[0]),S&32768&&(k.$$scope={dirty:S,ctx:y}),h.$set(k)},i(y){d||(Pe(h.$$.fragment,y),d=!0)},o(y){Ve(h.$$.fragment,y),d=!1},d(y){y&&He(a),zt(h)}}}function B0(p){let a,h;return a=new gl({props:{$$slots:{map:[O0],sidebar:[z0]},$$scope:{ctx:p}}}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p(d,[y]){const S={};y&32771&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function N0(p,a,h){let d,y,S,k;$t(p,Fn,he=>h(10,S=he)),$t(p,jo,he=>h(6,k=he));function s(){rn(Fn,S={mode:"title"},S),rn(jo,k=null,k)}function D(he){k.setCurrentNeighbourhood(he),rn(Fn,S={mode:"neighbourhood"},S)}function M(he){k.deleteNeighbourhoodBoundary(he),h(0,d=JSON.parse(Zi(k).toSavefile()))}function q(){let he=window.prompt("What do you want to name the neighbourhood?");he&&rn(Fn,S={mode:"set-boundary",name:he,existing:null},S)}const te=he=>D(Zi(he.detail.features[0].properties).name),ce=he=>D(he),be=he=>M(he);return p.$$.update=()=>{p.$$.dirty&64&&h(0,d=JSON.parse(Zi(k).toSavefile())),p.$$.dirty&1&&h(1,y=d.features.filter(he=>Zi(he.properties).kind=="boundary").map(he=>Zi(he.properties).name))},[d,y,s,D,M,q,k,te,ce,be]}class V0 extends Wi{constructor(a){super(),Gi(this,a,N0,B0,Di,{})}}function U0(p){let a,h,d,y,S,k,s,D,M;return{c(){a=Ee("div"),h=Ee("div"),d=Ee("button"),d.textContent="Back to editing",y=Tt(),S=Ee("p"),S.textContent="Drag markers for a route",k=Tt(),s=Ee("p"),s.innerHTML=`<span style="color: red">Route before</span>,
      <span style="color: blue">route after</span>`,ui(a,"slot","sidebar")},m(q,te){Ke(q,a,te),we(a,h),we(h,d),we(a,y),we(a,S),we(a,k),we(a,s),D||(M=li(d,"click",p[5]),D=!0)},p:_i,d(q){q&&He(a),D=!1,M()}}}function j0(p){let a,h;return a=new Xl({props:{paint:{"line-width":10,"line-color":Gl(["get","kind"],{before:"red",after:"blue"},"red")}}}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p:_i,i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function q0(p){let a;return{c(){a=Ee("span"),a.textContent="A",ui(a,"class","dot svelte-1ukzawy")},m(h,d){Ke(h,a,d)},p:_i,d(h){h&&He(a)}}}function Z0(p){let a;return{c(){a=Ee("span"),a.textContent="B",ui(a,"class","dot svelte-1ukzawy")},m(h,d){Ke(h,a,d)},p:_i,d(h){h&&He(a)}}}function G0(p){let a,h,d,y,S,k,s,D,M,q,te;h=new Bu({props:{gjInput:JSON.parse(Zi(p[2]).renderNeighbourhood()),interactive:!1}}),y=new Ka({props:{data:p[3],$$slots:{default:[j0]},$$scope:{ctx:p}}});function ce(me){p[6](me)}let be={draggable:!0,$$slots:{default:[q0]},$$scope:{ctx:p}};p[0]!==void 0&&(be.lngLat=p[0]),k=new Hp({props:be}),qr.push(()=>ml(k,"lngLat",ce));function he(me){p[7](me)}let ye={draggable:!0,$$slots:{default:[Z0]},$$scope:{ctx:p}};return p[1]!==void 0&&(ye.lngLat=p[1]),M=new Hp({props:ye}),qr.push(()=>ml(M,"lngLat",he)),{c(){a=Ee("div"),Ft(h.$$.fragment),d=Tt(),Ft(y.$$.fragment),S=Tt(),Ft(k.$$.fragment),D=Tt(),Ft(M.$$.fragment),ui(a,"slot","map")},m(me,Te){Ke(me,a,Te),Lt(h,a,null),we(a,d),Lt(y,a,null),we(a,S),Lt(k,a,null),we(a,D),Lt(M,a,null),te=!0},p(me,Te){const De={};Te&4&&(De.gjInput=JSON.parse(Zi(me[2]).renderNeighbourhood())),h.$set(De);const Ze={};Te&8&&(Ze.data=me[3]),Te&2048&&(Ze.$$scope={dirty:Te,ctx:me}),y.$set(Ze);const Le={};Te&2048&&(Le.$$scope={dirty:Te,ctx:me}),!s&&Te&1&&(s=!0,Le.lngLat=me[0],fl(()=>s=!1)),k.$set(Le);const tt={};Te&2048&&(tt.$$scope={dirty:Te,ctx:me}),!q&&Te&2&&(q=!0,tt.lngLat=me[1],fl(()=>q=!1)),M.$set(tt)},i(me){te||(Pe(h.$$.fragment,me),Pe(y.$$.fragment,me),Pe(k.$$.fragment,me),Pe(M.$$.fragment,me),te=!0)},o(me){Ve(h.$$.fragment,me),Ve(y.$$.fragment,me),Ve(k.$$.fragment,me),Ve(M.$$.fragment,me),te=!1},d(me){me&&He(a),zt(h),zt(y),zt(k),zt(M)}}}function W0(p){let a,h,d,y;return a=new gl({props:{$$slots:{map:[G0],sidebar:[U0]},$$scope:{ctx:p}}}),{c(){Ft(a.$$.fragment)},m(S,k){Lt(a,S,k),h=!0,d||(y=li(window,"keydown",p[4]),d=!0)},p(S,[k]){const s={};k&2063&&(s.$$scope={dirty:k,ctx:S}),a.$set(s)},i(S){h||(Pe(a.$$.fragment,S),h=!0)},o(S){Ve(a.$$.fragment,S),h=!1},d(S){zt(a,S),d=!1,y()}}}function H0(p,a,h){let d,y,S,k;$t(p,Fn,he=>h(8,y=he)),$t(p,jo,he=>h(2,S=he)),$t(p,_l,he=>h(9,k=he));let s=M(),D=M();Wc(()=>{k==null||k.keyboard.disable()}),Ss(()=>{k==null||k.keyboard.enable()});function M(){let he=S.getBounds(),ye=he[0]+Math.random()*(he[2]-he[0]),me=he[1]+Math.random()*(he[3]-he[1]);return new Ff.LngLat(ye,me)}function q(he){he.key=="Escape"&&(he.stopPropagation(),te())}function te(){rn(Fn,y={mode:"neighbourhood"},y)}function ce(he){s=he,h(0,s)}function be(he){D=he,h(1,D)}return p.$$.update=()=>{p.$$.dirty&7&&h(3,d=JSON.parse(S.compareRoute(s.lng,s.lat,D.lng,D.lat)))},[s,D,S,d,q,te,ce,be]}class X0 extends Wi{constructor(a){super(),Gi(this,a,H0,W0,Di,{})}}function K0(p){let a,h,d,y,S,k;return a=new Rf({props:{filter:Gf,paint:{"circle-color":Gl(["get","type"],{"snapped-waypoint":"red","free-waypoint":"blue"},"black"),"circle-opacity":["case",["has","hovered"],.5,1],"circle-radius":Gl(["get","type"],{node:gf/2},gf)}}}),d=new Xl({props:{filter:Zf,paint:{"line-color":["case",["get","snapped"],"red","blue"],"line-width":2.5}}}),S=new Ru({props:{filter:Qh,paint:{"fill-color":"black","fill-opacity":.5}}}),{c(){Ft(a.$$.fragment),h=Tt(),Ft(d.$$.fragment),y=Tt(),Ft(S.$$.fragment)},m(s,D){Lt(a,s,D),Ke(s,h,D),Lt(d,s,D),Ke(s,y,D),Lt(S,s,D),k=!0},p:_i,i(s){k||(Pe(a.$$.fragment,s),Pe(d.$$.fragment,s),Pe(S.$$.fragment,s),k=!0)},o(s){Ve(a.$$.fragment,s),Ve(d.$$.fragment,s),Ve(S.$$.fragment,s),k=!1},d(s){s&&(He(h),He(y)),zt(a,s),zt(d,s),zt(S,s)}}}function J0(p){let a,h;return a=new Ka({props:{data:p[0],$$slots:{default:[K0]},$$scope:{ctx:p}}}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p(d,[y]){const S={};y&1&&(S.data=d[0]),y&2&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}const gf=10;function Y0(p,a,h){let d;return $t(p,Wf,y=>h(0,d=y)),[d]}class Q0 extends Wi{constructor(a){super(),Gi(this,a,Y0,J0,Di,{})}}function $0(p){let a,h,d;return{c(){a=ki("Undo ("),h=ki(p[1]),d=ki(")")},m(y,S){Ke(y,a,S),Ke(y,h,S),Ke(y,d,S)},p(y,S){S&2&&xo(h,y[1])},d(y){y&&(He(a),He(h),He(d))}}}function ev(p){let a;return{c(){a=ki("Undo")},m(h,d){Ke(h,a,d)},p:_i,d(h){h&&He(a)}}}function tv(p){let a,h,d,y,S,k;function s(q,te){return q[1]==0?ev:$0}let D=s(p),M=D(p);return{c(){a=Ee("button"),M.c(),d=Tt(),y=Ee("ul"),y.innerHTML=`<li><b>Click</b>
    the map to add points</li> <li><b>Click and drag</b>
    any point to move it</li> <li><b>Click</b>
    a waypoint to delete it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,a.disabled=h=p[1]==0},m(q,te){Ke(q,a,te),M.m(a,null),Ke(q,d,te),Ke(q,y,te),S||(k=li(a,"click",p[2]),S=!0)},p(q,[te]){D===(D=s(q))&&M?M.p(q,te):(M.d(1),M=D(q),M&&(M.c(),M.m(a,null))),te&2&&h!==(h=q[1]==0)&&(a.disabled=h)},i:_i,o:_i,d(q){q&&(He(a),He(d),He(y)),M.d(),S=!1,k()}}}function iv(p,a,h){let d;$t(p,Hf,k=>h(1,d=k));let{route_tool:y}=a;const S=()=>y.undo();return p.$$set=k=>{"route_tool"in k&&h(0,y=k.route_tool)},[y,d,S]}class nv extends Wi{constructor(a){super(),Gi(this,a,iv,tv,Di,{route_tool:0})}}function rv(p){let a,h,d,y,S,k,s,D,M,q,te,ce,be,he,ye,me;return D=new nv({props:{route_tool:p[0]}}),{c(){a=Ee("div"),h=Ee("h1"),d=ki("Draw your neighbourhood boundary for "),y=ki(p[1]),S=Tt(),k=Ee("p"),k.textContent="TODO: maybe move the instructions from the previous screen to here...",s=Tt(),Ft(D.$$.fragment),M=Tt(),q=Ee("div"),te=Ee("button"),te.textContent="Finish",ce=Tt(),be=Ee("button"),be.textContent="Cancel",ui(a,"slot","sidebar")},m(Te,De){Ke(Te,a,De),we(a,h),we(h,d),we(h,y),we(a,S),we(a,k),we(a,s),Lt(D,a,null),we(a,M),we(a,q),we(q,te),we(q,ce),we(q,be),he=!0,ye||(me=[li(te,"click",p[4]),li(be,"click",p[2])],ye=!0)},p(Te,De){(!he||De&2)&&xo(y,Te[1]);const Ze={};De&1&&(Ze.route_tool=Te[0]),D.$set(Ze)},i(Te){he||(Pe(D.$$.fragment,Te),he=!0)},o(Te){Ve(D.$$.fragment,Te),he=!1},d(Te){Te&&He(a),zt(D),ye=!1,qo(me)}}}function ov(p){let a,h,d;return h=new Q0({}),{c(){a=Ee("div"),Ft(h.$$.fragment),ui(a,"slot","map")},m(y,S){Ke(y,a,S),Lt(h,a,null),d=!0},p:_i,i(y){d||(Pe(h.$$.fragment,y),d=!0)},o(y){Ve(h.$$.fragment,y),d=!1},d(y){y&&He(a),zt(h)}}}function sv(p){let a,h;return a=new gl({props:{$$slots:{map:[ov],sidebar:[rv]},$$scope:{ctx:p}}}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p(d,[y]){const S={};y&131&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function av(p,a,h){let d,y;$t(p,Fn,q=>h(5,d=q)),$t(p,jo,q=>h(6,y=q));let{route_tool:S}=a,{name:k}=a,{existing:s}=a;s?S.editExistingArea(s):S.startArea();function D(){rn(Fn,d={mode:"network"},d),S.clearEventListeners()}S.addEventListenerSuccess(q=>{try{y.setNeighbourhoodBoundary(k,q),y.setCurrentNeighbourhood(k),rn(Fn,d={mode:"neighbourhood"},d),S.clearEventListeners()}catch{window.alert("Known georust bug hit, sorry. You may need to just refresh the page now."),D()}}),S.addEventListenerFailure(D);const M=()=>S.finish();return p.$$set=q=>{"route_tool"in q&&h(0,S=q.route_tool),"name"in q&&h(1,k=q.name),"existing"in q&&h(3,s=q.existing)},[S,k,D,s,M]}class lv extends Wi{constructor(a){super(),Gi(this,a,av,sv,Di,{route_tool:0,name:1,existing:3})}}function cv(p){let a,h,d,y,S,k,s,D,M,q,te,ce,be,he,ye,me,Te,De,Ze,Le,tt,xt,Qe,Dt,bt,qt,Fe,$e;return a=new Vf({props:{msg:p[1]}}),bt=new Ny({props:{map:p[3]}}),bt.$on("gotXml",p[5]),bt.$on("loading",p[8]),bt.$on("error",p[9]),{c(){Ft(a.$$.fragment),h=Tt(),d=Ee("div"),y=Ee("label"),S=ki(`Load an example:
    `),k=Ee("select"),s=Ee("option"),s.textContent="Custom file loaded",D=Ee("option"),D.textContent="Akihabara",M=Ee("option"),M.textContent="Hanegi Park",q=Ee("option"),q.textContent="Harujuku",te=Ee("option"),te.textContent="Taipei main station",ce=Ee("option"),ce.textContent="Ximending",be=Ee("option"),be.textContent="Hong Kong",he=Ee("option"),he.textContent="Kowloon",ye=Ee("option"),ye.textContent="Bristol",me=Ee("option"),me.textContent="Elephant & Castle",Te=Ee("option"),Te.textContent="Westminster",De=Ee("option"),De.textContent="Montlake",Ze=Tt(),Le=Ee("div"),tt=Ee("label"),xt=ki(`Load an osm.xml or a .pbf file:
    `),Qe=Ee("input"),Dt=Tt(),Ft(bt.$$.fragment),s.__value="",as(s,s.__value),D.__value="akihabara",as(D,D.__value),M.__value="hanegi",as(M,M.__value),q.__value="harujuku",as(q,q.__value),te.__value="taipei_main_station",as(te,te.__value),ce.__value="ximending",as(ce,ce.__value),be.__value="hong_kong",as(be,be.__value),he.__value="kowloon",as(he,he.__value),ye.__value="bristol",as(ye,ye.__value),me.__value="elephant_castle",as(me,me.__value),Te.__value="westminster",as(Te,Te.__value),De.__value="montlake",as(De,De.__value),p[0]===void 0&&Lu(()=>p[6].call(k)),ui(Qe,"type","file")},m(Wt,rt){Lt(a,Wt,rt),Ke(Wt,h,rt),Ke(Wt,d,rt),we(d,y),we(y,S),we(y,k),we(k,s),we(k,D),we(k,M),we(k,q),we(k,te),we(k,ce),we(k,be),we(k,he),we(k,ye),we(k,me),we(k,Te),we(k,De),Fp(k,p[0],!0),Ke(Wt,Ze,rt),Ke(Wt,Le,rt),we(Le,tt),we(tt,xt),we(tt,Qe),p[7](Qe),Ke(Wt,Dt,rt),Lt(bt,Wt,rt),qt=!0,Fe||($e=[li(k,"change",p[6]),li(Qe,"change",p[4])],Fe=!0)},p(Wt,[rt]){const Qt={};rt&2&&(Qt.msg=Wt[1]),a.$set(Qt),rt&1&&Fp(k,Wt[0]);const Bt={};rt&8&&(Bt.map=Wt[3]),bt.$set(Bt)},i(Wt){qt||(Pe(a.$$.fragment,Wt),Pe(bt.$$.fragment,Wt),qt=!0)},o(Wt){Ve(a.$$.fragment,Wt),Ve(bt.$$.fragment,Wt),qt=!1},d(Wt){Wt&&(He(h),He(d),He(Ze),He(Le),He(Dt)),zt(a,Wt),p[7](null),zt(bt,Wt),Fe=!1,qo($e)}}}function uv(p,a,h){let d,y,S;$t(p,Nc,De=>h(0,d=De)),$t(p,jo,De=>h(11,y=De)),$t(p,_l,De=>h(3,S=De));let k=null,s=!1;Wc(async()=>{await Wh(),await Hh();try{s=(await fetch("/osm/kowloon.pbf",{method:"HEAD"})).ok,console.log("Using local cache, not od2net.org")}catch{}});let D;async function M(De){try{q(await D.files[0].arrayBuffer()),rn(Nc,d="",d)}catch(Ze){window.alert(`Couldn't open this file: ${Ze}`)}h(1,k=null)}function q(De){h(1,k="Building map model from OSM input"),console.time("load"),rn(jo,y=new hg(new Uint8Array(De)),y),console.timeEnd("load")}function te(De){try{q(new TextEncoder().encode(De.detail)),rn(Nc,d="",d)}catch(Ze){window.alert(`Couldn't import from Overpass: ${Ze}`)}h(1,k=null)}async function ce(De){De!=""&&(s?await be(`/osm/${De}.pbf`):await be(`https://assets.od2net.org/severance_pbfs/${De}.pbf`))}async function be(De){try{h(1,k=`Downloading ${De}`);let Ze=await fetch(De);q(await Ze.arrayBuffer())}catch(Ze){window.alert(`Couldn't open from URL ${De}: ${Ze}`)}h(1,k=null)}function he(){d=Y_(this),Nc.set(d)}function ye(De){qr[De?"unshift":"push"](()=>{D=De,h(2,D)})}const me=De=>h(1,k=De.detail),Te=De=>window.alert(De.detail);return p.$$.update=()=>{p.$$.dirty&1&&ce(d)},[d,k,D,S,M,te,he,ye,me,Te]}class hv extends Wi{constructor(a){super(),Gi(this,a,uv,cv,Di,{})}}function yf(p){let a,h;return a=new Uf({props:{$$slots:{default:[dv,({dialog:d})=>({6:d}),({dialog:d})=>d?64:0]},$$scope:{ctx:p}}}),a.$on("close",p[4]),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p(d,y){const S={};y&192&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function dv(p){let a,h,d,y,S,k,s,D,M,q,te,ce,be,he;function ye(){return p[3](p[6])}return{c(){a=Ee("h1"),a.textContent="The Low-traffic neighbourhood (LTN) tool, v2",h=Tt(),d=Ee("p"),d.innerHTML=`This is an <b>experimental</b> version of the
          <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>. Most parts of it do not work yet, and you should probably use the
          other version of the tool instead.`,y=Tt(),S=Ee("p"),S.textContent="To use this tool, you need to:",k=Tt(),s=Ee("ol"),s.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, to fix the basemap data on existing modal filters, turn
            restrictions, one-ways, etc</li> <li>To create one or more proposals with new modal filters, and explore
            their effects</li>`,D=Tt(),M=Ee("p"),M.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
          and relies heavily on
          <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a> data.`,q=Tt(),te=Ee("center"),ce=Ee("button"),ce.textContent="Start!"},m(me,Te){Ke(me,a,Te),Ke(me,h,Te),Ke(me,d,Te),Ke(me,y,Te),Ke(me,S,Te),Ke(me,k,Te),Ke(me,s,Te),Ke(me,D,Te),Ke(me,M,Te),Ke(me,q,Te),Ke(me,te,Te),we(te,ce),be||(he=li(ce,"click",ye),be=!0)},p(me,Te){p=me},d(me){me&&(He(a),He(h),He(d),He(y),He(S),He(k),He(s),He(D),He(M),He(q),He(te)),be=!1,he()}}}function pv(p){let a;return{c(){a=Ee("p"),a.textContent="Waiting for MapLibre and WASM to load..."},m(h,d){Ke(h,a,d)},i:_i,o:_i,d(h){h&&He(a)}}}function fv(p){let a,h;return a=new hv({}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function mv(p){let a,h,d,y,S,k,s,D,M,q,te,ce,be,he=p[1]&&yf(p);const ye=[fv,pv],me=[];function Te(De,Ze){return De[2]&&De[0]?0:1}return M=Te(p),q=me[M]=ye[M](p),{c(){a=Ee("div"),he&&he.c(),h=Tt(),d=Ee("h1"),d.textContent="Choose your study area",y=Tt(),S=Ee("button"),S.textContent="About the LTN tool",k=Tt(),s=Ee("hr"),D=Tt(),q.c(),ui(a,"slot","sidebar")},m(De,Ze){Ke(De,a,Ze),he&&he.m(a,null),we(a,h),we(a,d),we(a,y),we(a,S),we(a,k),we(a,s),we(a,D),me[M].m(a,null),te=!0,ce||(be=li(S,"click",p[5]),ce=!0)},p(De,Ze){De[1]?he?(he.p(De,Ze),Ze&2&&Pe(he,1)):(he=yf(De),he.c(),Pe(he,1),he.m(a,h)):he&&(dr(),Ve(he,1,1,()=>{he=null}),pr());let Le=M;M=Te(De),M!==Le&&(dr(),Ve(me[Le],1,1,()=>{me[Le]=null}),pr(),q=me[M],q||(q=me[M]=ye[M](De),q.c()),Pe(q,1),q.m(a,null))},i(De){te||(Pe(he),Pe(q),te=!0)},o(De){Ve(he),Ve(q),te=!1},d(De){De&&He(a),he&&he.d(),me[M].d(),ce=!1,be()}}}function _v(p){let a;return{c(){a=Ee("div"),ui(a,"slot","map")},m(h,d){Ke(h,a,d)},p:_i,d(h){h&&He(a)}}}function gv(p){let a,h;return a=new gl({props:{$$slots:{map:[_v],sidebar:[mv]},$$scope:{ctx:p}}}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p(d,[y]){const S={};y&135&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function yv(p,a,h){let d;$t(p,_l,M=>h(2,d=M));let{wasmReady:y}=a,S=!0;const k=M=>Zi(M).close(),s=()=>h(1,S=!1),D=()=>h(1,S=!0);return p.$$set=M=>{"wasmReady"in M&&h(0,y=M.wasmReady)},[y,S,d,k,s,D]}class vv extends Wi{constructor(a){super(),Gi(this,a,yv,gv,Di,{wasmReady:0})}}const{window:bv}=K_;function xv(p){let a,h,d,y,S,k=p[0].shortcutIndex+"",s,D,M=p[0].gj.features.length+"",q,te,ce,be,he,ye,me;return{c(){a=Ee("div"),h=Ee("button"),d=ki("Prev"),S=Tt(),s=ki(k),D=ki(" / "),q=ki(M),te=Tt(),ce=Ee("button"),be=ki("Next"),h.disabled=y=p[0].shortcutIndex==null||p[0].shortcutIndex==0,ce.disabled=he=p[0].shortcutIndex==p[0].gj.features.length-1},m(Te,De){Ke(Te,a,De),we(a,h),we(h,d),we(a,S),we(a,s),we(a,D),we(a,q),we(a,te),we(a,ce),we(ce,be),ye||(me=[li(h,"click",p[6]),li(ce,"click",p[7])],ye=!0)},p(Te,De){De&1&&y!==(y=Te[0].shortcutIndex==null||Te[0].shortcutIndex==0)&&(h.disabled=y),De&1&&k!==(k=Te[0].shortcutIndex+"")&&xo(s,k),De&1&&M!==(M=Te[0].gj.features.length+"")&&xo(q,M),De&1&&he!==(he=Te[0].shortcutIndex==Te[0].gj.features.length-1)&&(ce.disabled=he)},d(Te){Te&&He(a),ye=!1,qo(me)}}}function wv(p){let a;return{c(){a=Ee("p"),a.textContent="Click a road to see shortcuts"},m(h,d){Ke(h,a,d)},p:_i,d(h){h&&He(a)}}}function Sv(p){let a,h,d,y,S,k;function s(q,te){if(q[0].state=="neutral")return wv;if(q[0].state=="chose-road")return xv}let D=s(p),M=D&&D(p);return{c(){a=Ee("div"),h=Ee("div"),d=Ee("button"),d.textContent="Back to editing",y=Tt(),M&&M.c(),ui(a,"slot","sidebar")},m(q,te){Ke(q,a,te),we(a,h),we(h,d),we(a,y),M&&M.m(a,null),S||(k=li(d,"click",p[4]),S=!0)},p(q,te){D===(D=s(q))&&M?M.p(q,te):(M&&M.d(1),M=D&&D(q),M&&(M.c(),M.m(a,null)))},d(q){q&&He(a),M&&M.d(),S=!1,k()}}}function Tv(p){let a,h,d,y;const S=[kv,Cv],k=[];function s(D,M){return D[0].shortcutIndex==null?0:1}return a=s(p),h=k[a]=S[a](p),{c(){h.c(),d=us()},m(D,M){k[a].m(D,M),Ke(D,d,M),y=!0},p(D,M){let q=a;a=s(D),a===q?k[a].p(D,M):(dr(),Ve(k[q],1,1,()=>{k[q]=null}),pr(),h=k[a],h?h.p(D,M):(h=k[a]=S[a](D),h.c()),Pe(h,1),h.m(d.parentNode,d))},i(D){y||(Pe(h),y=!0)},o(D){Ve(h),y=!1},d(D){D&&He(d),k[a].d(D)}}}function Iv(p){let a,h;return a=new Bu({props:{gjInput:JSON.parse(Zi(p[1]).renderNeighbourhood()),onClickLine:p[5],$$slots:{"line-popup":[Pv]},$$scope:{ctx:p}}}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p(d,y){const S={};y&2&&(S.gjInput=JSON.parse(Zi(d[1]).renderNeighbourhood())),y&2048&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function Cv(p){let a,h;return a=new Ka({props:{data:p[0].gj.features[p[0].shortcutIndex],$$slots:{default:[Ev]},$$scope:{ctx:p}}}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p(d,y){const S={};y&1&&(S.data=d[0].gj.features[d[0].shortcutIndex]),y&2048&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function kv(p){let a,h;return a=new Ka({props:{data:p[0].gj,$$slots:{default:[Mv]},$$scope:{ctx:p}}}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p(d,y){const S={};y&1&&(S.data=d[0].gj),y&2048&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function Ev(p){let a,h;return a=new Xl({props:{paint:{"line-width":5,"line-color":"red"}}}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p:_i,i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function Mv(p){let a,h;return a=new Xl({props:{paint:{"line-width":5,"line-color":"red"}}}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p:_i,i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function Av(p){let a=Zi(p[10]).properties.shortcuts+"",h;return{c(){h=ki(a)},m(d,y){Ke(d,h,y)},p(d,y){y&1024&&a!==(a=Zi(d[10]).properties.shortcuts+"")&&xo(h,a)},d(d){d&&He(h)}}}function Pv(p){let a,h,d;return h=new Kc({props:{openOn:"hover",$$slots:{default:[Av,({data:y})=>({10:y}),({data:y})=>y?1024:0]},$$scope:{ctx:p}}}),{c(){a=Ee("div"),Ft(h.$$.fragment),ui(a,"slot","line-popup")},m(y,S){Ke(y,a,S),Lt(h,a,null),d=!0},p(y,S){const k={};S&3072&&(k.$$scope={dirty:S,ctx:y}),h.$set(k)},i(y){d||(Pe(h.$$.fragment,y),d=!0)},o(y){Ve(h.$$.fragment,y),d=!1},d(y){y&&He(a),zt(h)}}}function Lv(p){let a,h,d,y;const S=[Iv,Tv],k=[];function s(D,M){return D[0].state=="neutral"?0:D[0].state=="chose-road"?1:-1}return~(h=s(p))&&(d=k[h]=S[h](p)),{c(){a=Ee("div"),d&&d.c(),ui(a,"slot","map")},m(D,M){Ke(D,a,M),~h&&k[h].m(a,null),y=!0},p(D,M){let q=h;h=s(D),h===q?~h&&k[h].p(D,M):(d&&(dr(),Ve(k[q],1,1,()=>{k[q]=null}),pr()),~h?(d=k[h],d?d.p(D,M):(d=k[h]=S[h](D),d.c()),Pe(d,1),d.m(a,null)):d=null)},i(D){y||(Pe(d),y=!0)},o(D){Ve(d),y=!1},d(D){D&&He(a),~h&&k[h].d()}}}function zv(p){let a,h,d,y;return a=new gl({props:{$$slots:{map:[Lv],sidebar:[Sv]},$$scope:{ctx:p}}}),{c(){Ft(a.$$.fragment)},m(S,k){Lt(a,S,k),h=!0,d||(y=li(bv,"keydown",p[3]),d=!0)},p(S,[k]){const s={};k&2051&&(s.$$scope={dirty:k,ctx:S}),a.$set(s)},i(S){h||(Pe(a.$$.fragment,S),h=!0)},o(S){Ve(a.$$.fragment,S),h=!1},d(S){zt(a,S),d=!1,y()}}}function Dv(p,a,h){let d,y,S;$t(p,Fn,be=>h(8,d=be)),$t(p,_l,be=>h(9,y=be)),$t(p,jo,be=>h(1,S=be));let k={state:"neutral"};function s(be){let he=JSON.parse(S.getShortcutsCrossingRoad(be));if(he.features.length==0){window.alert("No shortcuts here");return}h(0,k={state:"chose-road",road:be,gj:he,shortcutIndex:null})}Wc(()=>{y==null||y.keyboard.disable()}),Ss(()=>{y==null||y.keyboard.enable()});function D(be){k.state=="chose-road"&&(be.key=="ArrowLeft"&&k.shortcutIndex&&(be.stopPropagation(),h(0,k.shortcutIndex--,k)),be.key=="ArrowRight"&&(be.stopPropagation(),k.shortcutIndex==null?h(0,k.shortcutIndex=0,k):k.shortcutIndex!=k.gj.features.length-1&&h(0,k.shortcutIndex++,k)),be.key=="Escape"&&(be.stopPropagation(),M()))}function M(){rn(Fn,d={mode:"neighbourhood"},d)}return[k,S,s,D,M,be=>s(Zi(be.properties).id),()=>h(0,k.shortcutIndex--,k),()=>h(0,k.shortcutIndex++,k)]}class Fv extends Wi{constructor(a){super(),Gi(this,a,Dv,zv,Di,{})}}function vf(p){let a,h,d,y;return{c(){a=Ee("div"),h=Ee("button"),h.textContent="Zoom to fit study area"},m(S,k){Ke(S,a,k),we(a,h),d||(y=li(h,"click",p[9]),d=!0)},p:_i,d(S){S&&He(a),d=!1,y()}}}function Rv(p){let a,h,d,y,S,k,s,D,M,q,te,ce,be=p[3]&&vf(p);return{c(){a=Ee("div"),h=Ee("div"),d=Tt(),y=Ee("hr"),S=Tt(),be&&be.c(),k=Tt(),s=Ee("div"),D=Ee("label"),M=Ee("input"),q=ki("Show basemap"),ui(M,"type","checkbox"),ui(a,"slot","left")},m(he,ye){Ke(he,a,ye),we(a,h),p[15](h),we(a,d),we(a,y),we(a,S),be&&be.m(a,null),we(a,k),we(a,s),we(s,D),we(D,M),M.checked=p[4],we(D,q),te||(ce=li(M,"change",p[16]),te=!0)},p(he,ye){he[3]?be?be.p(he,ye):(be=vf(he),be.c(),be.m(a,k)):be&&(be.d(1),be=null),ye&16&&(M.checked=he[4])},d(he){he&&He(a),p[15](null),be&&be.d(),te=!1,ce()}}}function bf(p){let a,h;return a=new vv({props:{wasmReady:p[5]}}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p(d,y){const S={};y&32&&(S.wasmReady=d[5]),a.$set(S)},i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function xf(p){let a,h,d,y,S,k;a=new Ka({props:{data:JSON.parse(p[3].getInvertedBoundary()),$$slots:{default:[Ov]},$$scope:{ctx:p}}});const s=[qv,jv,Uv,Vv,Nv,Bv],D=[];function M(q,te){return q[8].mode=="network"?0:q[8].mode=="set-boundary"?1:q[8].mode=="neighbourhood"?2:q[8].mode=="view-shortcuts"?3:q[8].mode=="route"?4:q[8].mode=="debug"?5:-1}return~(d=M(p))&&(y=D[d]=s[d](p)),{c(){Ft(a.$$.fragment),h=Tt(),y&&y.c(),S=us()},m(q,te){Lt(a,q,te),Ke(q,h,te),~d&&D[d].m(q,te),Ke(q,S,te),k=!0},p(q,te){const ce={};te&8&&(ce.data=JSON.parse(q[3].getInvertedBoundary())),te&524288&&(ce.$$scope={dirty:te,ctx:q}),a.$set(ce);let be=d;d=M(q),d===be?~d&&D[d].p(q,te):(y&&(dr(),Ve(D[be],1,1,()=>{D[be]=null}),pr()),~d?(y=D[d],y?y.p(q,te):(y=D[d]=s[d](q),y.c()),Pe(y,1),y.m(S.parentNode,S)):y=null)},i(q){k||(Pe(a.$$.fragment,q),Pe(y),k=!0)},o(q){Ve(a.$$.fragment,q),Ve(y),k=!1},d(q){q&&(He(h),He(S)),zt(a,q),~d&&D[d].d(q)}}}function Ov(p){let a,h;return a=new Ru({props:{paint:{"fill-color":"black","fill-opacity":.3}}}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p:_i,i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function Bv(p){let a,h;return a=new h0({}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p:_i,i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function Nv(p){let a,h;return a=new X0({}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p:_i,i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function Vv(p){let a,h;return a=new Fv({}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p:_i,i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function Uv(p){let a,h;return a=new L0({}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p:_i,i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function jv(p){let a,h;return a=new lv({props:{route_tool:p[6],name:p[8].name,existing:p[8].existing}}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p(d,y){const S={};y&64&&(S.route_tool=d[6]),y&256&&(S.name=d[8].name),y&256&&(S.existing=d[8].existing),a.$set(S)},i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function qv(p){let a,h;return a=new V0({}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p:_i,i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function Zv(p){let a,h,d,y,S,k=p[8].mode=="title"&&bf(p),s=p[3]&&xf(p);return{c(){a=Ee("div"),h=Tt(),k&&k.c(),d=Tt(),s&&s.c(),y=us()},m(D,M){Ke(D,a,M),p[12](a),Ke(D,h,M),k&&k.m(D,M),Ke(D,d,M),s&&s.m(D,M),Ke(D,y,M),S=!0},p(D,M){D[8].mode=="title"?k?(k.p(D,M),M&256&&Pe(k,1)):(k=bf(D),k.c(),Pe(k,1),k.m(d.parentNode,d)):k&&(dr(),Ve(k,1,1,()=>{k=null}),pr()),D[3]?s?(s.p(D,M),M&8&&Pe(s,1)):(s=xf(D),s.c(),Pe(s,1),s.m(y.parentNode,y)):s&&(dr(),Ve(s,1,1,()=>{s=null}),pr())},i(D){S||(Pe(k),Pe(s),S=!0)},o(D){Ve(k),Ve(s),S=!1},d(D){D&&(He(a),He(h),He(d),He(y)),p[12](null),k&&k.d(D),s&&s.d(D)}}}function Gv(p){let a,h,d,y;function S(s){p[13](s)}let k={style:p[7],standardControls:!0,hash:!0,$$slots:{default:[Zv]},$$scope:{ctx:p}};return p[0]!==void 0&&(k.map=p[0]),h=new ly({props:k}),qr.push(()=>ml(h,"map",S)),h.$on("error",p[14]),{c(){a=Ee("div"),Ft(h.$$.fragment),ui(a,"slot","main"),jl(a,"position","relative"),jl(a,"width","100%"),jl(a,"height","100vh")},m(s,D){Ke(s,a,D),Lt(h,a,null),y=!0},p(s,D){const M={};D&128&&(M.style=s[7]),D&524652&&(M.$$scope={dirty:D,ctx:s}),!d&&D&1&&(d=!0,M.map=s[0],fl(()=>d=!1)),h.$set(M)},i(s){y||(Pe(h.$$.fragment,s),y=!0)},o(s){Ve(h.$$.fragment,s),y=!1},d(s){s&&He(a),zt(h)}}}function Wv(p){let a,h;return a=new My({props:{$$slots:{main:[Gv],left:[Rv]},$$scope:{ctx:p}}}),{c(){Ft(a.$$.fragment)},m(d,y){Lt(a,d,y),h=!0},p(d,[y]){const S={};y&524799&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(Pe(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){zt(a,d)}}}function Hv(p,a,h){let d,y,S,k,s,D,M;$t(p,Zh,xt=>h(10,y=xt)),$t(p,qh,xt=>h(11,S=xt)),$t(p,jo,xt=>h(3,k=xt)),$t(p,_l,xt=>h(17,s=xt)),$t(p,Fn,xt=>h(8,D=xt)),$t(p,jh,xt=>h(4,M=xt));let q=!1;Wc(async()=>{await Wh(),await Hh(),h(5,q=!0)});let te,ce;function be(){s.fitBounds(Array.from(k.getBounds()),{animate:!1})}function he(xt){k&&(console.log("New map model loaded"),be(),rn(Fn,D={mode:"network"},D),h(6,ce=new Gy(s,k.toRouteSnapper())))}let ye,me;function Te(xt){qr[xt?"unshift":"push"](()=>{me=xt,h(2,me),h(10,y)})}function De(xt){te=xt,h(0,te)}const Ze=xt=>{console.log(xt.detail.error)};function Le(xt){qr[xt?"unshift":"push"](()=>{ye=xt,h(1,ye),h(11,S)})}function tt(){M=this.checked,jh.set(M)}return p.$$.update=()=>{p.$$.dirty&16&&h(7,d=M?"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo":{version:8,sources:{},layers:[]}),p.$$.dirty&1&&te&&_l.set(te),p.$$.dirty&8&&he(),p.$$.dirty&2050&&ye&&S&&(h(1,ye.innerHTML="",ye),ye.appendChild(S)),p.$$.dirty&1028&&me&&y&&(h(2,me.innerHTML="",me),me.appendChild(y))},[te,ye,me,k,M,q,ce,d,D,be,y,S,Te,De,Ze,Le,tt]}class Xv extends Wi{constructor(a){super(),Gi(this,a,Hv,Wv,Di,{})}}new Xv({target:document.getElementById("app")});
