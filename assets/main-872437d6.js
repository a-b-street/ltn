var BP=Object.defineProperty;var VP=(t,e,n)=>e in t?BP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Ci=(t,e,n)=>(VP(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function Mt(){}function gi(t,e){for(const n in e)t[n]=e[n];return t}function OE(t){return t()}function Hx(){return Object.create(null)}function Hr(t){t.forEach(OE)}function Nf(t){return typeof t=="function"}function Ht(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let Fg;function si(t,e){return t===e?!0:(Fg||(Fg=document.createElement("a")),Fg.href=e,t===Fg.href)}function UP(t){return Object.keys(t).length===0}function zE(t,...e){if(t==null){for(const r of e)r(void 0);return Mt}const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function rs(t){let e;return zE(t,n=>e=n)(),e}function wt(t,e,n){t.$$.on_destroy.push(zE(e,n))}function hr(t,e,n,r){if(t){const i=FE(t,e,n,r);return t[0](i)}}function FE(t,e,n,r){return t[1]&&r?gi(n.ctx.slice(),t[1](r(e))):n.ctx}function fr(t,e,n,r){if(t[2]&&r){const i=t[2](r(n));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],c=Math.max(e.dirty.length,i.length);for(let l=0;l<c;l+=1)o[l]=e.dirty[l]|i[l];return o}return e.dirty|i}return e.dirty}function pr(t,e,n,r,i,o){if(i){const c=FE(e,n,r,o);t.p(c,i)}}function dr(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let r=0;r<n;r++)e[r]=-1;return e}return-1}function jP(t){const e={};for(const n in t)e[n]=!0;return e}function f_(t){return t??""}function Ut(t,e,n){return t.set(n),e}function cv(t){return t&&Nf(t.destroy)?t.destroy:Mt}const X_=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function te(t,e){t.appendChild(e)}function be(t,e,n){t.insertBefore(e,n||null)}function ve(t){t.parentNode&&t.parentNode.removeChild(t)}function du(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function pe(t){return document.createElement(t)}function hu(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function nt(t){return document.createTextNode(t)}function je(){return nt(" ")}function ki(){return nt("")}function Lt(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function h1(t){return function(e){return e.preventDefault(),t.call(this,e)}}function k0(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function Ce(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function BE(t){let e;return{p(...n){e=n,e.forEach(r=>t.push(r))},r(){e.forEach(n=>t.splice(t.indexOf(n),1))}}}function f1(t){return t===""?null:+t}function GP(t){return Array.from(t.childNodes)}function Kn(t,e){e=""+e,t.data!==e&&(t.data=e)}function qi(t,e){t.value=e??""}function gr(t,e,n,r){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function p_(t,e,n){for(let r=0;r<t.options.length;r+=1){const i=t.options[r];if(i.__value===e){i.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function VE(t){const e=t.querySelector(":checked");return e&&e.__value}function no(t,e,n){t.classList.toggle(e,!!n)}function qP(t,e,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:r})}let Kd;function jd(t){Kd=t}function bm(){if(!Kd)throw new Error("Function called outside component initialization");return Kd}function Y_(t){bm().$$.on_mount.push(t)}function Hi(t){bm().$$.on_destroy.push(t)}function zl(){const t=bm();return(e,n,{cancelable:r=!1}={})=>{const i=t.$$.callbacks[e];if(i){const o=qP(e,n,{cancelable:r});return i.slice().forEach(c=>{c.call(t,o)}),!o.defaultPrevented}return!0}}function p1(t,e){return bm().$$.context.set(t,e),e}function UE(t){return bm().$$.context.get(t)}function xn(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(r=>r.call(this,e))}const Ef=[],Gr=[];let kf=[];const hv=[],jE=Promise.resolve();let fv=!1;function GE(){fv||(fv=!0,jE.then(WE))}function qE(){return GE(),jE}function Jd(t){kf.push(t)}function ba(t){hv.push(t)}const A0=new Set;let _f=0;function WE(){if(_f!==0)return;const t=Kd;do{try{for(;_f<Ef.length;){const e=Ef[_f];_f++,jd(e),WP(e.$$)}}catch(e){throw Ef.length=0,_f=0,e}for(jd(null),Ef.length=0,_f=0;Gr.length;)Gr.pop()();for(let e=0;e<kf.length;e+=1){const n=kf[e];A0.has(n)||(A0.add(n),n())}kf.length=0}while(Ef.length);for(;hv.length;)hv.pop()();fv=!1,A0.clear(),jd(t)}function WP(t){if(t.fragment!==null){t.update(),Hr(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Jd)}}function HP(t){const e=[],n=[];kf.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),kf=e}const Kg=new Set;let Zc;function Rn(){Zc={r:0,c:[],p:Zc}}function Nn(){Zc.r||Hr(Zc.c),Zc=Zc.p}function ne(t,e){t&&t.i&&(Kg.delete(t),t.i(e))}function de(t,e,n,r){if(t&&t.o){if(Kg.has(t))return;Kg.add(t),Zc.c.push(()=>{Kg.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function Oi(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function ZP(t,e){de(t,1,1,()=>{e.delete(t.key)})}function XP(t,e,n,r,i,o,c,l,d,y,S,E){let C=t.length,A=o.length,M=C;const R={};for(;M--;)R[t[M].key]=M;const N=[],B=new Map,O=new Map,G=[];for(M=A;M--;){const ae=E(i,o,M),se=n(ae);let fe=c.get(se);fe?r&&G.push(()=>fe.p(ae,e)):(fe=y(se,ae),fe.c()),B.set(se,N[M]=fe),se in R&&O.set(se,Math.abs(M-R[se]))}const U=new Set,Z=new Set;function ue(ae){ne(ae,1),ae.m(l,S),c.set(ae.key,ae),S=ae.first,A--}for(;C&&A;){const ae=N[A-1],se=t[C-1],fe=ae.key,ke=se.key;ae===se?(S=ae.first,C--,A--):B.has(ke)?!c.has(fe)||U.has(fe)?ue(ae):Z.has(ke)?C--:O.get(fe)>O.get(ke)?(Z.add(fe),ue(ae)):(U.add(ke),C--):(d(se,c),C--)}for(;C--;){const ae=t[C];B.has(ae.key)||d(ae,c)}for(;A;)ue(N[A-1]);return Hr(G),N}function pv(t,e){const n={},r={},i={$$scope:1};let o=t.length;for(;o--;){const c=t[o],l=e[o];if(l){for(const d in c)d in l||(r[d]=1);for(const d in l)i[d]||(n[d]=l[d],i[d]=1);t[o]=l}else for(const d in c)i[d]=1}for(const c in r)c in n||(n[c]=void 0);return n}function xa(t,e,n){const r=t.$$.props[e];r!==void 0&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function Ve(t){t&&t.c()}function Fe(t,e,n){const{fragment:r,after_update:i}=t.$$;r&&r.m(e,n),Jd(()=>{const o=t.$$.on_mount.map(OE).filter(Nf);t.$$.on_destroy?t.$$.on_destroy.push(...o):Hr(o),t.$$.on_mount=[]}),i.forEach(Jd)}function Be(t,e){const n=t.$$;n.fragment!==null&&(HP(n.after_update),Hr(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function YP(t,e){t.$$.dirty[0]===-1&&(Ef.push(t),GE(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Jt(t,e,n,r,i,o,c=null,l=[-1]){const d=Kd;jd(t);const y=t.$$={fragment:null,ctx:[],props:o,update:Mt,not_equal:i,bound:Hx(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:Hx(),dirty:l,skip_bound:!1,root:e.target||d.$$.root};c&&c(y.root);let S=!1;if(y.ctx=n?n(t,e.props||{},(E,C,...A)=>{const M=A.length?A[0]:C;return y.ctx&&i(y.ctx[E],y.ctx[E]=M)&&(!y.skip_bound&&y.bound[E]&&y.bound[E](M),S&&YP(t,E)),C}):[],y.update(),S=!0,Hr(y.before_update),y.fragment=r?r(y.ctx):!1,e.target){if(e.hydrate){const E=GP(e.target);y.fragment&&y.fragment.l(E),E.forEach(ve)}else y.fragment&&y.fragment.c();e.intro&&ne(t.$$.fragment),Fe(t,e.target,e.anchor),WE()}jd(d)}class Qt{constructor(){Ci(this,"$$");Ci(this,"$$set")}$destroy(){Be(this,1),this.$destroy=Mt}$on(e,n){if(!Nf(n))return Mt;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!UP(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const $P="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add($P);function Zx(t){let e,n;return{c(){e=pe("div"),n=nt(t[0]),Ce(e,"class","svelte-1uuov7f")},m(r,i){be(r,e,i),te(e,n)},p(r,i){i&1&&Kn(n,r[0])},d(r){r&&ve(e)}}}function KP(t){let e,n=t[0]&&Zx(t);return{c(){n&&n.c(),e=ki()},m(r,i){n&&n.m(r,i),be(r,e,i)},p(r,[i]){r[0]?n?n.p(r,i):(n=Zx(r),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:Mt,o:Mt,d(r){r&&ve(e),n&&n.d(r)}}}function JP(t,e,n){let{loading:r}=e;return t.$$set=i=>{"loading"in i&&n(0,r=i.loading)},[r]}class HE extends Qt{constructor(e){super(),Jt(this,e,JP,KP,Ht,{loading:0})}}const QP=t=>({dialog:t&1}),Xx=t=>({dialog:t[0]});function eM(t){let e,n,r,i,o;const c=t[4].default,l=hr(c,t,t[3],Xx);return{c(){e=pe("dialog"),n=pe("article"),l&&l.c(),e.open=!0},m(d,y){be(d,e,y),te(e,n),l&&l.m(n,null),t[6](e),r=!0,i||(o=[Lt(window,"click",t[1]),Lt(window,"keydown",t[2]),Lt(e,"close",t[5])],i=!0)},p(d,[y]){l&&l.p&&(!r||y&9)&&pr(l,c,d,d[3],r?fr(c,d[3],y,QP):dr(d[3]),Xx)},i(d){r||(ne(l,d),r=!0)},o(d){de(l,d),r=!1},d(d){d&&ve(e),l&&l.d(d),t[6](null),i=!1,Hr(o)}}}function tM(t,e,n){let{$$slots:r={},$$scope:i}=e,o;function c(S){o.open&&S.target==o&&o.close()}function l(S){(S.key=="Escape"||S.key=="Enter")&&(S.stopPropagation(),o.close())}function d(S){xn.call(this,t,S)}function y(S){Gr[S?"unshift":"push"](()=>{o=S,n(0,o)})}return t.$$set=S=>{"$$scope"in S&&n(3,i=S.$$scope)},[o,c,l,i,r,d,y]}class $_ extends Qt{constructor(e){super(),Jt(this,e,tM,eM,Ht,{})}}function Yx(t,e,n){const r=t.slice();return r[1]=e[n][0],r[2]=e[n][1],r}function $x(t){let e,n,r=t[1]+"",i,o,c,l=t[2]+"",d,y;return{c(){e=pe("tr"),n=pe("td"),i=nt(r),o=je(),c=pe("td"),d=nt(l),y=je()},m(S,E){be(S,e,E),te(e,n),te(n,i),te(e,o),te(e,c),te(c,d),te(e,y)},p(S,E){E&1&&r!==(r=S[1]+"")&&Kn(i,r),E&1&&l!==(l=S[2]+"")&&Kn(d,l)},d(S){S&&ve(e)}}}function nM(t){let e,n,r=Oi(Object.entries(t[0])),i=[];for(let o=0;o<r.length;o+=1)i[o]=$x(Yx(t,r,o));return{c(){e=pe("table"),n=pe("tbody");for(let o=0;o<i.length;o+=1)i[o].c();Ce(e,"class","svelte-lh2o9l")},m(o,c){be(o,e,c),te(e,n);for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(n,null)},p(o,[c]){if(c&1){r=Oi(Object.entries(o[0]));let l;for(l=0;l<r.length;l+=1){const d=Yx(o,r,l);i[l]?i[l].p(d,c):(i[l]=$x(d),i[l].c(),i[l].m(n,null))}for(;l<i.length;l+=1)i[l].d(1);i.length=r.length}},i:Mt,o:Mt,d(o){o&&ve(e),du(i,o)}}}function rM(t,e,n){let{properties:r}=e;return t.$$set=i=>{"properties"in i&&n(0,r=i.properties)},[r]}class K_ extends Qt{constructor(e){super(),Jt(this,e,rM,nM,Ht,{properties:0})}}function d_(t,e){let n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),n.setAttribute("download",t),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function Vr(t){if(t==null||t==null)throw new Error("Oops, notNull given something null");return t}let at;const ZE=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&ZE.decode();let kd=null;function Af(){return(kd===null||kd.byteLength===0)&&(kd=new Uint8Array(at.memory.buffer)),kd}function ys(t,e){return t=t>>>0,ZE.decode(Af().subarray(t,t+e))}const au=new Array(128).fill(void 0);au.push(void 0,null,!0,!1);let Gd=au.length;function cr(t){Gd===au.length&&au.push(au.length+1);const e=Gd;return Gd=au[e],au[e]=t,e}function wn(t){return au[t]}function iM(t){t<132||(au[t]=Gd,Gd=t)}function Oo(t){const e=wn(t);return iM(t),e}let ts=0;const Jg=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},oM=typeof Jg.encodeInto=="function"?function(t,e){return Jg.encodeInto(t,e)}:function(t,e){const n=Jg.encode(t);return e.set(n),{read:t.length,written:n.length}};function Wa(t,e,n){if(n===void 0){const l=Jg.encode(t),d=e(l.length,1)>>>0;return Af().subarray(d,d+l.length).set(l),ts=l.length,d}let r=t.length,i=e(r,1)>>>0;const o=Af();let c=0;for(;c<r;c++){const l=t.charCodeAt(c);if(l>127)break;o[i+c]=l}if(c!==r){c!==0&&(t=t.slice(c)),i=n(i,r,r=c+t.length*3,1)>>>0;const l=Af().subarray(i+c,i+r),d=oM(t,l);c+=d.written}return ts=c,i}function If(t){return t==null}let Ad=null;function Kt(){return(Ad===null||Ad.byteLength===0)&&(Ad=new Int32Array(at.memory.buffer)),Ad}let Dd=null;function XE(){return(Dd===null||Dd.byteLength===0)&&(Dd=new Float64Array(at.memory.buffer)),Dd}let Rd=null;function sM(){return(Rd===null||Rd.byteLength===0)&&(Rd=new BigInt64Array(at.memory.buffer)),Rd}function dv(t){const e=typeof t;if(e=="number"||e=="boolean"||t==null)return`${t}`;if(e=="string")return`"${t}"`;if(e=="symbol"){const i=t.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=t.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(t)){const i=t.length;let o="[";i>0&&(o+=dv(t[0]));for(let c=1;c<i;c++)o+=", "+dv(t[c]);return o+="]",o}const n=/\[object ([^\]]+)\]/.exec(toString.call(t));let r;if(n.length>1)r=n[1];else return toString.call(t);if(r=="Object")try{return"Object("+JSON.stringify(t)+")"}catch{return"Object"}return t instanceof Error?`${t.name}: ${t.message}
${t.stack}`:r}function aM(t,e){const n=e(t.length*1,1)>>>0;return Af().set(t,n/1),ts=t.length,n}function lM(t,e){return t=t>>>0,XE().subarray(t/8,t/8+e)}function uM(t,e){return t=t>>>0,Af().subarray(t/1,t/1+e)}function Hc(t,e){try{return t.apply(this,e)}catch(n){at.__wbindgen_exn_store(cr(n))}}class YE{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();at.__wbg_ltn_free(e)}constructor(e,n,r){try{const y=at.__wbindgen_add_to_stack_pointer(-16),S=aM(e,at.__wbindgen_malloc),E=ts;var i=If(r)?0:Wa(r,at.__wbindgen_malloc,at.__wbindgen_realloc),o=ts;at.ltn_new(y,S,E,cr(n),i,o);var c=Kt()[y/4+0],l=Kt()[y/4+1],d=Kt()[y/4+2];if(d)throw Oo(l);return this.__wbg_ptr=c>>>0,this}finally{at.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let e,n;try{const y=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_getInvertedBoundary(y,this.__wbg_ptr);var r=Kt()[y/4+0],i=Kt()[y/4+1],o=Kt()[y/4+2],c=Kt()[y/4+3],l=r,d=i;if(c)throw l=0,d=0,Oo(o);return e=l,n=d,ys(l,d)}finally{at.__wbindgen_add_to_stack_pointer(16),at.__wbindgen_free(e,n,1)}}getBounds(){try{const i=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_getBounds(i,this.__wbg_ptr);var e=Kt()[i/4+0],n=Kt()[i/4+1],r=lM(e,n).slice();return at.__wbindgen_free(e,n*8,8),r}finally{at.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const i=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_toRouteSnapper(i,this.__wbg_ptr);var e=Kt()[i/4+0],n=Kt()[i/4+1],r=uM(e,n).slice();return at.__wbindgen_free(e,n*1,1),r}finally{at.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let e,n;try{const y=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_toRouteSnapperGj(y,this.__wbg_ptr);var r=Kt()[y/4+0],i=Kt()[y/4+1],o=Kt()[y/4+2],c=Kt()[y/4+3],l=r,d=i;if(c)throw l=0,d=0,Oo(o);return e=l,n=d,ys(l,d)}finally{at.__wbindgen_add_to_stack_pointer(16),at.__wbindgen_free(e,n,1)}}renderModalFilters(){let e,n;try{const y=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_renderModalFilters(y,this.__wbg_ptr);var r=Kt()[y/4+0],i=Kt()[y/4+1],o=Kt()[y/4+2],c=Kt()[y/4+3],l=r,d=i;if(c)throw l=0,d=0,Oo(o);return e=l,n=d,ys(l,d)}finally{at.__wbindgen_add_to_stack_pointer(16),at.__wbindgen_free(e,n,1)}}renderNeighbourhood(){let e,n;try{const y=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_renderNeighbourhood(y,this.__wbg_ptr);var r=Kt()[y/4+0],i=Kt()[y/4+1],o=Kt()[y/4+2],c=Kt()[y/4+3],l=r,d=i;if(c)throw l=0,d=0,Oo(o);return e=l,n=d,ys(l,d)}finally{at.__wbindgen_add_to_stack_pointer(16),at.__wbindgen_free(e,n,1)}}renderAutoBoundaries(){let e,n;try{const y=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_renderAutoBoundaries(y,this.__wbg_ptr);var r=Kt()[y/4+0],i=Kt()[y/4+1],o=Kt()[y/4+2],c=Kt()[y/4+3],l=r,d=i;if(c)throw l=0,d=0,Oo(o);return e=l,n=d,ys(l,d)}finally{at.__wbindgen_add_to_stack_pointer(16),at.__wbindgen_free(e,n,1)}}setNeighbourhoodBoundary(e,n){try{const o=at.__wbindgen_add_to_stack_pointer(-16),c=Wa(e,at.__wbindgen_malloc,at.__wbindgen_realloc),l=ts;at.ltn_setNeighbourhoodBoundary(o,this.__wbg_ptr,c,l,cr(n));var r=Kt()[o/4+0],i=Kt()[o/4+1];if(i)throw Oo(r)}finally{at.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(e){const n=Wa(e,at.__wbindgen_malloc,at.__wbindgen_realloc),r=ts;at.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,n,r)}renameNeighbourhoodBoundary(e,n){const r=Wa(e,at.__wbindgen_malloc,at.__wbindgen_realloc),i=ts,o=Wa(n,at.__wbindgen_malloc,at.__wbindgen_realloc),c=ts;at.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,r,i,o,c)}setCurrentNeighbourhood(e){try{const i=at.__wbindgen_add_to_stack_pointer(-16),o=Wa(e,at.__wbindgen_malloc,at.__wbindgen_realloc),c=ts;at.ltn_setCurrentNeighbourhood(i,this.__wbg_ptr,o,c);var n=Kt()[i/4+0],r=Kt()[i/4+1];if(r)throw Oo(n)}finally{at.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(e,n){try{const o=at.__wbindgen_add_to_stack_pointer(-16),c=Wa(n,at.__wbindgen_malloc,at.__wbindgen_realloc),l=ts;at.ltn_addModalFilter(o,this.__wbg_ptr,cr(e),c,l);var r=Kt()[o/4+0],i=Kt()[o/4+1];if(i)throw Oo(r)}finally{at.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(e,n){try{const o=at.__wbindgen_add_to_stack_pointer(-16),c=Wa(n,at.__wbindgen_malloc,at.__wbindgen_realloc),l=ts;at.ltn_addManyModalFilters(o,this.__wbg_ptr,cr(e),c,l);var r=Kt()[o/4+0],i=Kt()[o/4+1];if(i)throw Oo(r)}finally{at.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(e){at.ltn_deleteModalFilter(this.__wbg_ptr,e)}toggleDirection(e){at.ltn_toggleDirection(this.__wbg_ptr,e)}undo(){at.ltn_undo(this.__wbg_ptr)}redo(){at.ltn_redo(this.__wbg_ptr)}getShortcutsCrossingRoad(e){let n,r;try{const S=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_getShortcutsCrossingRoad(S,this.__wbg_ptr,e);var i=Kt()[S/4+0],o=Kt()[S/4+1],c=Kt()[S/4+2],l=Kt()[S/4+3],d=i,y=o;if(l)throw d=0,y=0,Oo(c);return n=d,r=y,ys(d,y)}finally{at.__wbindgen_add_to_stack_pointer(16),at.__wbindgen_free(n,r,1)}}getAllShortcuts(){let e,n;try{const y=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_getAllShortcuts(y,this.__wbg_ptr);var r=Kt()[y/4+0],i=Kt()[y/4+1],o=Kt()[y/4+2],c=Kt()[y/4+3],l=r,d=i;if(c)throw l=0,d=0,Oo(o);return e=l,n=d,ys(l,d)}finally{at.__wbindgen_add_to_stack_pointer(16),at.__wbindgen_free(e,n,1)}}toSavefile(){let e,n;try{const y=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_toSavefile(y,this.__wbg_ptr);var r=Kt()[y/4+0],i=Kt()[y/4+1],o=Kt()[y/4+2],c=Kt()[y/4+3],l=r,d=i;if(c)throw l=0,d=0,Oo(o);return e=l,n=d,ys(l,d)}finally{at.__wbindgen_add_to_stack_pointer(16),at.__wbindgen_free(e,n,1)}}loadSavefile(e){try{const i=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_loadSavefile(i,this.__wbg_ptr,cr(e));var n=Kt()[i/4+0],r=Kt()[i/4+1];if(r)throw Oo(n)}finally{at.__wbindgen_add_to_stack_pointer(16)}}compareRoute(e,n,r,i,o){let c,l;try{const M=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_compareRoute(M,this.__wbg_ptr,e,n,r,i,o);var d=Kt()[M/4+0],y=Kt()[M/4+1],S=Kt()[M/4+2],E=Kt()[M/4+3],C=d,A=y;if(E)throw C=0,A=0,Oo(S);return c=C,l=A,ys(C,A)}finally{at.__wbindgen_add_to_stack_pointer(16),at.__wbindgen_free(c,l,1)}}}async function cM(t,e){if(typeof Response=="function"&&t instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,e)}catch(r){if(t.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const n=await t.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}function hM(){const t={};return t.wbg={},t.wbg.__wbindgen_error_new=function(e,n){const r=new Error(ys(e,n));return cr(r)},t.wbg.__wbindgen_object_drop_ref=function(e){Oo(e)},t.wbg.__wbindgen_string_get=function(e,n){const r=wn(n),i=typeof r=="string"?r:void 0;var o=If(i)?0:Wa(i,at.__wbindgen_malloc,at.__wbindgen_realloc),c=ts;Kt()[e/4+1]=c,Kt()[e/4+0]=o},t.wbg.__wbindgen_boolean_get=function(e){const n=wn(e);return typeof n=="boolean"?n?1:0:2},t.wbg.__wbindgen_is_bigint=function(e){return typeof wn(e)=="bigint"},t.wbg.__wbindgen_number_get=function(e,n){const r=wn(n),i=typeof r=="number"?r:void 0;XE()[e/8+1]=If(i)?0:i,Kt()[e/4+0]=!If(i)},t.wbg.__wbindgen_is_object=function(e){const n=wn(e);return typeof n=="object"&&n!==null},t.wbg.__wbindgen_in=function(e,n){return wn(e)in wn(n)},t.wbg.__wbindgen_bigint_from_i64=function(e){return cr(e)},t.wbg.__wbindgen_jsval_eq=function(e,n){return wn(e)===wn(n)},t.wbg.__wbindgen_bigint_from_u64=function(e){const n=BigInt.asUintN(64,e);return cr(n)},t.wbg.__wbindgen_is_undefined=function(e){return wn(e)===void 0},t.wbg.__wbindgen_string_new=function(e,n){const r=ys(e,n);return cr(r)},t.wbg.__wbindgen_jsval_loose_eq=function(e,n){return wn(e)==wn(n)},t.wbg.__wbindgen_object_clone_ref=function(e){const n=wn(e);return cr(n)},t.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,n){const r=wn(e)[wn(n)];return cr(r)},t.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(wn(e))},t.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(wn(e))},t.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(wn(e))},t.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(wn(e))},t.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(wn(e))},t.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return cr(e)},t.wbg.__wbg_stack_658279fe44541cf6=function(e,n){const r=wn(n).stack,i=Wa(r,at.__wbindgen_malloc,at.__wbindgen_realloc),o=ts;Kt()[e/4+1]=o,Kt()[e/4+0]=i},t.wbg.__wbg_error_f851667af71bcfc6=function(e,n){let r,i;try{r=e,i=n,console.error(ys(e,n))}finally{at.__wbindgen_free(r,i,1)}},t.wbg.__wbg_performance_3f3012faa4463882=function(e){const n=wn(e).performance;return cr(n)},t.wbg.__wbg_now_2fd65358804c9485=function(e){return wn(e).now()},t.wbg.__wbg_get_f01601b5a68d10e3=function(e,n){const r=wn(e)[n>>>0];return cr(r)},t.wbg.__wbg_length_1009b1af0c481d7b=function(e){return wn(e).length},t.wbg.__wbindgen_is_function=function(e){return typeof wn(e)=="function"},t.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,n){const r=new Function(ys(e,n));return cr(r)},t.wbg.__wbg_next_9b877f231f476d01=function(e){const n=wn(e).next;return cr(n)},t.wbg.__wbg_next_6529ee0cca8d57ed=function(){return Hc(function(e){const n=wn(e).next();return cr(n)},arguments)},t.wbg.__wbg_done_5fe336b092d60cf2=function(e){return wn(e).done},t.wbg.__wbg_value_0c248a78fdc8e19f=function(e){const n=wn(e).value;return cr(n)},t.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return cr(Symbol.iterator)},t.wbg.__wbg_get_7b48513de5dc5ea4=function(){return Hc(function(e,n){const r=Reflect.get(wn(e),wn(n));return cr(r)},arguments)},t.wbg.__wbg_call_90c26b09837aba1c=function(){return Hc(function(e,n){const r=wn(e).call(wn(n));return cr(r)},arguments)},t.wbg.__wbg_self_f0e34d89f33b99fd=function(){return Hc(function(){const e=self.self;return cr(e)},arguments)},t.wbg.__wbg_window_d3b084224f4774d7=function(){return Hc(function(){const e=window.window;return cr(e)},arguments)},t.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return Hc(function(){const e=globalThis.globalThis;return cr(e)},arguments)},t.wbg.__wbg_global_35dfdd59a4da3e74=function(){return Hc(function(){const e=global.global;return cr(e)},arguments)},t.wbg.__wbg_isArray_74fb723e24f76012=function(e){return Array.isArray(wn(e))},t.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let n;try{n=wn(e)instanceof ArrayBuffer}catch{n=!1}return n},t.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(e){return Number.isSafeInteger(wn(e))},t.wbg.__wbg_entries_9e2e2aa45aa5094a=function(e){const n=Object.entries(wn(e));return cr(n)},t.wbg.__wbg_buffer_a448f833075b71ba=function(e){const n=wn(e).buffer;return cr(n)},t.wbg.__wbg_new_8f67e318f15d7254=function(e){const n=new Uint8Array(wn(e));return cr(n)},t.wbg.__wbg_set_2357bf09366ee480=function(e,n,r){wn(e).set(wn(n),r>>>0)},t.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return wn(e).length},t.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let n;try{n=wn(e)instanceof Uint8Array}catch{n=!1}return n},t.wbg.__wbindgen_bigint_get_as_i64=function(e,n){const r=wn(n),i=typeof r=="bigint"?r:void 0;sM()[e/8+1]=If(i)?BigInt(0):i,Kt()[e/4+0]=!If(i)},t.wbg.__wbindgen_debug_string=function(e,n){const r=dv(wn(n)),i=Wa(r,at.__wbindgen_malloc,at.__wbindgen_realloc),o=ts;Kt()[e/4+1]=o,Kt()[e/4+0]=i},t.wbg.__wbindgen_throw=function(e,n){throw new Error(ys(e,n))},t.wbg.__wbindgen_memory=function(){const e=at.memory;return cr(e)},t}function fM(t,e){return at=t.exports,$E.__wbindgen_wasm_module=e,Rd=null,Dd=null,Ad=null,kd=null,at}async function $E(t){if(at!==void 0)return at;typeof t>"u"&&(t="/ltn/assets/backend_bg.wasm");const e=hM();(typeof t=="string"||typeof Request=="function"&&t instanceof Request||typeof URL=="function"&&t instanceof URL)&&(t=fetch(t));const{instance:n,module:r}=await cM(await t,e);return fM(n,r)}var xm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function d1(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function J_(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var KE={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(t,e){(function(n,r){t.exports=r()})(xm,function(){var n={},r={};function i(c,l,d){if(r[c]=d,c==="index"){var y="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",S={};return r.shared(S),r.index(n,S),typeof window<"u"&&n.setWorkerUrl(window.URL.createObjectURL(new Blob([y],{type:"text/javascript"}))),n}}i("shared",["exports"],function(c){function l(u,s,h,p){return new(h||(h=Promise))(function(_,x){function w(D){try{P(p.next(D))}catch(F){x(F)}}function I(D){try{P(p.throw(D))}catch(F){x(F)}}function P(D){var F;D.done?_(D.value):(F=D.value,F instanceof h?F:new h(function(V){V(F)})).then(w,I)}P((p=p.apply(u,s||[])).next())})}function d(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}typeof SuppressedError=="function"&&SuppressedError;var y=S;function S(u,s){this.x=u,this.y=s}S.prototype={clone:function(){return new S(this.x,this.y)},add:function(u){return this.clone()._add(u)},sub:function(u){return this.clone()._sub(u)},multByPoint:function(u){return this.clone()._multByPoint(u)},divByPoint:function(u){return this.clone()._divByPoint(u)},mult:function(u){return this.clone()._mult(u)},div:function(u){return this.clone()._div(u)},rotate:function(u){return this.clone()._rotate(u)},rotateAround:function(u,s){return this.clone()._rotateAround(u,s)},matMult:function(u){return this.clone()._matMult(u)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(u){return this.x===u.x&&this.y===u.y},dist:function(u){return Math.sqrt(this.distSqr(u))},distSqr:function(u){var s=u.x-this.x,h=u.y-this.y;return s*s+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith:function(u){return this.angleWithSep(u.x,u.y)},angleWithSep:function(u,s){return Math.atan2(this.x*s-this.y*u,this.x*u+this.y*s)},_matMult:function(u){var s=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=s,this},_add:function(u){return this.x+=u.x,this.y+=u.y,this},_sub:function(u){return this.x-=u.x,this.y-=u.y,this},_mult:function(u){return this.x*=u,this.y*=u,this},_div:function(u){return this.x/=u,this.y/=u,this},_multByPoint:function(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint:function(u){return this.x/=u.x,this.y/=u.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var u=this.y;return this.y=this.x,this.x=-u,this},_rotate:function(u){var s=Math.cos(u),h=Math.sin(u),p=h*this.x+s*this.y;return this.x=s*this.x-h*this.y,this.y=p,this},_rotateAround:function(u,s){var h=Math.cos(u),p=Math.sin(u),_=s.y+p*(this.x-s.x)+h*(this.y-s.y);return this.x=s.x+h*(this.x-s.x)-p*(this.y-s.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},S.convert=function(u){return u instanceof S?u:Array.isArray(u)?new S(u[0],u[1]):u};var E=d(y),C=A;function A(u,s,h,p){this.cx=3*u,this.bx=3*(h-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(p-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=s,this.p2x=h,this.p2y=p}A.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,s){if(s===void 0&&(s=1e-6),u<0)return 0;if(u>1)return 1;for(var h=u,p=0;p<8;p++){var _=this.sampleCurveX(h)-u;if(Math.abs(_)<s)return h;var x=this.sampleCurveDerivativeX(h);if(Math.abs(x)<1e-6)break;h-=_/x}var w=0,I=1;for(h=u,p=0;p<20&&(_=this.sampleCurveX(h),!(Math.abs(_-u)<s));p++)u>_?w=h:I=h,h=.5*(I-w)+w;return h},solve:function(u,s){return this.sampleCurveY(this.solveCurveX(u,s))}};var M=d(C);let R,N;function B(){return R==null&&(R=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),R}function O(){if(N==null&&(N=!1,B())){const s=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(s){for(let p=0;p<5*5;p++){const _=4*p;s.fillStyle=`rgb(${_},${_+1},${_+2})`,s.fillRect(p%5,Math.floor(p/5),1,1)}const h=s.getImageData(0,0,5,5).data;for(let p=0;p<5*5*4;p++)if(p%4!=3&&h[p]!==p){N=!0;break}}}return N||!1}function G(u,s,h,p){const _=new M(u,s,h,p);return function(x){return _.solve(x)}}const U=G(.25,.1,.25,1);function Z(u,s,h){return Math.min(h,Math.max(s,u))}function ue(u,s,h){const p=h-s,_=((u-s)%p+p)%p+s;return _===s?h:_}function ae(u,...s){for(const h of s)for(const p in h)u[p]=h[p];return u}let se=1;function fe(u,s,h){const p={};for(const _ in u)p[_]=s.call(h||this,u[_],_,u);return p}function ke(u,s,h){const p={};for(const _ in u)s.call(h||this,u[_],_,u)&&(p[_]=u[_]);return p}function K(u){return Array.isArray(u)?u.map(K):typeof u=="object"&&u?fe(u,K):u}const oe={};function Ge(u){oe[u]||(typeof console<"u"&&console.warn(u),oe[u]=!0)}function Te(u,s,h){return(h.y-u.y)*(s.x-u.x)>(s.y-u.y)*(h.x-u.x)}function ot(u){let s=0;for(let h,p,_=0,x=u.length,w=x-1;_<x;w=_++)h=u[_],p=u[w],s+=(p.x-h.x)*(h.y+p.y);return s}function ft(u){return typeof WorkerGlobalScope<"u"&&u!==void 0&&u instanceof WorkerGlobalScope}let At=null;function Ke(u){return typeof ImageBitmap<"u"&&u instanceof ImageBitmap}const Ft="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function bt(u,s,h,p,_){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const x=new VideoFrame(u,{timestamp:0});try{const w=x==null?void 0:x.format;if(!w||!w.startsWith("BGR")&&!w.startsWith("RGB"))throw new Error(`Unrecognized format ${w}`);const I=w.startsWith("BGR"),P=new Uint8ClampedArray(p*_*4);if(yield x.copyTo(P,function(D,F,V,H,Y){const J=4*Math.max(-F,0),ie=(Math.max(0,V)-V)*H*4+J,ge=4*H,we=Math.max(0,F),Ne=Math.max(0,V);return{rect:{x:we,y:Ne,width:Math.min(D.width,F+H)-we,height:Math.min(D.height,V+Y)-Ne},layout:[{offset:ie,stride:ge}]}}(u,s,h,p,_)),I)for(let D=0;D<P.length;D+=4){const F=P[D];P[D]=P[D+2],P[D+2]=F}return P}finally{x.close()}})}let Rt,Ot;const ln="AbortError";function Ln(){return new Error(ln)}const an={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Xt(u){return an.REGISTERED_PROTOCOLS[u.substring(0,u.indexOf("://"))]}const En="global-dispatcher";class In extends Error{constructor(s,h,p,_){super(`AJAXError: ${h} (${s}): ${p}`),this.status=s,this.statusText=h,this.url=p,this.body=_}}const rr=()=>ft(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,mt=function(u,s){if(/:\/\//.test(u.url)&&!/^https?:|^file:/.test(u.url)){const p=Xt(u.url);if(p)return p(u,s);if(ft(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,targetMapId:En},s)}if(!(/^file:/.test(h=u.url)||/^file:/.test(rr())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(p,_){return l(this,void 0,void 0,function*(){const x=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:rr(),signal:_.signal});p.type==="json"&&x.headers.set("Accept","application/json");const w=yield fetch(x);if(!w.ok){const D=yield w.blob();throw new In(w.status,w.statusText,p.url,D)}let I;I=p.type==="arrayBuffer"||p.type==="image"?w.arrayBuffer():p.type==="json"?w.json():w.text();const P=yield I;if(_.signal.aborted)throw Ln();return{data:P,cacheControl:w.headers.get("Cache-Control"),expires:w.headers.get("Expires")}})}(u,s);if(ft(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,mustQueue:!0,targetMapId:En},s)}var h;return function(p,_){return new Promise((x,w)=>{const I=new XMLHttpRequest;I.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(I.responseType="arraybuffer");for(const P in p.headers)I.setRequestHeader(P,p.headers[P]);p.type==="json"&&(I.responseType="text",I.setRequestHeader("Accept","application/json")),I.withCredentials=p.credentials==="include",I.onerror=()=>{w(new Error(I.statusText))},I.onload=()=>{if(!_.signal.aborted)if((I.status>=200&&I.status<300||I.status===0)&&I.response!==null){let P=I.response;if(p.type==="json")try{P=JSON.parse(I.response)}catch(D){return void w(D)}x({data:P,cacheControl:I.getResponseHeader("Cache-Control"),expires:I.getResponseHeader("Expires")})}else{const P=new Blob([I.response],{type:I.getResponseHeader("Content-Type")});w(new In(I.status,I.statusText,p.url,P))}},_.signal.addEventListener("abort",()=>{I.abort(),w(Ln())}),I.send(p.body)})}(u,s)};function Dt(u){if(!u||u.indexOf("://")<=0||u.indexOf("data:image/")===0||u.indexOf("blob:")===0)return!0;const s=new URL(u),h=window.location;return s.protocol===h.protocol&&s.host===h.host}function Sn(u,s,h){h[u]&&h[u].indexOf(s)!==-1||(h[u]=h[u]||[],h[u].push(s))}function Le(u,s,h){if(h&&h[u]){const p=h[u].indexOf(s);p!==-1&&h[u].splice(p,1)}}class rt{constructor(s,h={}){ae(this,h),this.type=s}}class gt extends rt{constructor(s,h={}){super("error",ae({error:s},h))}}class Nt{on(s,h){return this._listeners=this._listeners||{},Sn(s,h,this._listeners),this}off(s,h){return Le(s,h,this._listeners),Le(s,h,this._oneTimeListeners),this}once(s,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},Sn(s,h,this._oneTimeListeners),this):new Promise(p=>this.once(s,p))}fire(s,h){typeof s=="string"&&(s=new rt(s,h||{}));const p=s.type;if(this.listens(p)){s.target=this;const _=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const I of _)I.call(this,s);const x=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const I of x)Le(p,I,this._oneTimeListeners),I.call(this,s);const w=this._eventedParent;w&&(ae(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(s))}else s instanceof gt&&console.error(s.error);return this}listens(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)}setEventedParent(s,h){return this._eventedParent=s,this._eventedParentData=h,this}}var me={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const tn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Xe(u,s){const h={};for(const p in u)p!=="ref"&&(h[p]=u[p]);return tn.forEach(p=>{p in s&&(h[p]=s[p])}),h}function St(u,s){if(Array.isArray(u)){if(!Array.isArray(s)||u.length!==s.length)return!1;for(let h=0;h<u.length;h++)if(!St(u[h],s[h]))return!1;return!0}if(typeof u=="object"&&u!==null&&s!==null){if(typeof s!="object"||Object.keys(u).length!==Object.keys(s).length)return!1;for(const h in u)if(!St(u[h],s[h]))return!1;return!0}return u===s}function hn(u,s){u.push(s)}function Ai(u,s,h){hn(h,{command:"addSource",args:[u,s[u]]})}function Ls(u,s,h){hn(s,{command:"removeSource",args:[u]}),h[u]=!0}function Js(u,s,h,p){Ls(u,h,p),Ai(u,s,h)}function al(u,s,h){let p;for(p in u[h])if(Object.prototype.hasOwnProperty.call(u[h],p)&&p!=="data"&&!St(u[h][p],s[h][p]))return!1;for(p in s[h])if(Object.prototype.hasOwnProperty.call(s[h],p)&&p!=="data"&&!St(u[h][p],s[h][p]))return!1;return!0}function ji(u,s,h,p,_,x){u=u||{},s=s||{};for(const w in u)Object.prototype.hasOwnProperty.call(u,w)&&(St(u[w],s[w])||h.push({command:x,args:[p,w,s[w],_]}));for(const w in s)Object.prototype.hasOwnProperty.call(s,w)&&!Object.prototype.hasOwnProperty.call(u,w)&&(St(u[w],s[w])||h.push({command:x,args:[p,w,s[w],_]}))}function jl(u){return u.id}function Ps(u,s){return u[s.id]=s,u}class lt{constructor(s,h,p,_){this.message=(s?`${s}: `:"")+p,_&&(this.identifier=_),h!=null&&h.__line__&&(this.line=h.__line__)}}function hs(u,...s){for(const h of s)for(const p in h)u[p]=h[p];return u}class fo extends Error{constructor(s,h){super(h),this.message=h,this.key=s}}class Gl{constructor(s,h=[]){this.parent=s,this.bindings={};for(const[p,_]of h)this.bindings[p]=_}concat(s){return new Gl(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const li={kind:"null"},pt={kind:"number"},mn={kind:"string"},pn={kind:"boolean"},Zr={kind:"color"},fs={kind:"object"},fn={kind:"value"},za={kind:"collator"},Jr={kind:"formatted"},_e={kind:"padding"},W={kind:"resolvedImage"},X={kind:"variableAnchorOffsetCollection"};function Q(u,s){return{kind:"array",itemType:u,N:s}}function le(u){if(u.kind==="array"){const s=le(u.itemType);return typeof u.N=="number"?`array<${s}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${s}>`}return u.kind}const Pe=[li,pt,mn,pn,Zr,Jr,fs,Q(fn),_e,W,X];function ee(u,s){if(s.kind==="error")return null;if(u.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!ee(u.itemType,s.itemType))&&(typeof u.N!="number"||u.N===s.N))return null}else{if(u.kind===s.kind)return null;if(u.kind==="value"){for(const h of Pe)if(!ee(h,s))return null}}return`Expected ${le(u)} but found ${le(s)} instead.`}function Me(u,s){return s.some(h=>h.kind===u.kind)}function Se(u,s){return s.some(h=>h==="null"?u===null:h==="array"?Array.isArray(u):h==="object"?u&&!Array.isArray(u)&&typeof u=="object":h===typeof u)}function Re(u,s){return u.kind==="array"&&s.kind==="array"?u.itemType.kind===s.itemType.kind&&typeof u.N=="number":u.kind===s.kind}const We=.96422,Ye=.82521,Je=4/29,Bt=6/29,qt=3*Bt*Bt,sn=Bt*Bt*Bt,un=Math.PI/180,On=180/Math.PI;function ir(u){return(u%=360)<0&&(u+=360),u}function Sr([u,s,h,p]){let _,x;const w=vn((.2225045*(u=ui(u))+.7168786*(s=ui(s))+.0606169*(h=ui(h)))/1);u===s&&s===h?_=x=w:(_=vn((.4360747*u+.3850649*s+.1430804*h)/We),x=vn((.0139322*u+.0971045*s+.7141733*h)/Ye));const I=116*w-16;return[I<0?0:I,500*(_-w),200*(w-x),p]}function ui(u){return u<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function vn(u){return u>sn?Math.pow(u,1/3):u/qt+Je}function Or([u,s,h,p]){let _=(u+16)/116,x=isNaN(s)?_:_+s/500,w=isNaN(h)?_:_-h/200;return _=1*po(_),x=We*po(x),w=Ye*po(w),[_i(3.1338561*x-1.6168667*_-.4906146*w),_i(-.9787684*x+1.9161415*_+.033454*w),_i(.0719453*x-.2289914*_+1.4052427*w),p]}function _i(u){return(u=u<=.00304?12.92*u:1.055*Math.pow(u,1/2.4)-.055)<0?0:u>1?1:u}function po(u){return u>Bt?u*u*u:qt*(u-Je)}function To(u){return parseInt(u.padEnd(2,u),16)/255}function Di(u,s){return Qs(s?u/100:u,0,1)}function Qs(u,s,h){return Math.min(Math.max(s,u),h)}function Dm(u){return!u.some(Number.isNaN)}const Cy={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Qn{constructor(s,h,p,_=1,x=!0){this.r=s,this.g=h,this.b=p,this.a=_,x||(this.r*=_,this.g*=_,this.b*=_,_||this.overwriteGetter("rgb",[s,h,p,_]))}static parse(s){if(s instanceof Qn)return s;if(typeof s!="string")return;const h=function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const _=Cy[p];if(_){const[w,I,P]=_;return[w/255,I/255,P/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const w=p.length<6?1:2;let I=1;return[To(p.slice(I,I+=w)),To(p.slice(I,I+=w)),To(p.slice(I,I+=w)),To(p.slice(I,I+w)||"ff")]}if(p.startsWith("rgb")){const w=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[I,P,D,F,V,H,Y,J,ie,ge,we,Ne]=w,Ee=[F||" ",Y||" ",ge].join("");if(Ee==="  "||Ee==="  /"||Ee===",,"||Ee===",,,"){const Ae=[D,H,ie].join(""),Qe=Ae==="%%%"?100:Ae===""?255:0;if(Qe){const et=[Qs(+P/Qe,0,1),Qs(+V/Qe,0,1),Qs(+J/Qe,0,1),we?Di(+we,Ne):1];if(Dm(et))return et}}return}}const x=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[w,I,P,D,F,V,H,Y,J]=x,ie=[P||" ",F||" ",H].join("");if(ie==="  "||ie==="  /"||ie===",,"||ie===",,,"){const ge=[+I,Qs(+D,0,100),Qs(+V,0,100),Y?Di(+Y,J):1];if(Dm(ge))return function([we,Ne,Ee,Ae]){function Qe(et){const Ct=(et+we/30)%12,zt=Ne*Math.min(Ee,1-Ee);return Ee-zt*Math.max(-1,Math.min(Ct-3,9-Ct,1))}return we=ir(we),Ne/=100,Ee/=100,[Qe(0),Qe(8),Qe(4),Ae]}(ge)}}}(s);return h?new Qn(...h,!1):void 0}get rgb(){const{r:s,g:h,b:p,a:_}=this,x=_||1/0;return this.overwriteGetter("rgb",[s/x,h/x,p/x,_])}get hcl(){return this.overwriteGetter("hcl",function(s){const[h,p,_,x]=Sr(s),w=Math.sqrt(p*p+_*_);return[Math.round(1e4*w)?ir(Math.atan2(_,p)*On):NaN,w,h,x]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Sr(this.rgb))}overwriteGetter(s,h){return Object.defineProperty(this,s,{value:h}),h}toString(){const[s,h,p,_]=this.rgb;return`rgba(${[s,h,p].map(x=>Math.round(255*x)).join(",")},${_})`}}Qn.black=new Qn(0,0,0,1),Qn.white=new Qn(1,1,1,1),Qn.transparent=new Qn(0,0,0,0),Qn.red=new Qn(1,0,0,1);class Sp{constructor(s,h,p){this.sensitivity=s?h?"variant":"case":h?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,h){return this.collator.compare(s,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ep{constructor(s,h,p,_,x){this.text=s,this.image=h,this.scale=p,this.fontStack=_,this.textColor=x}}class Wo{constructor(s){this.sections=s}static fromString(s){return new Wo([new Ep(s,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||s.image&&s.image.name.length!==0)}static factory(s){return s instanceof Wo?s:Wo.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}}class Lo{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof Lo)return s;if(typeof s=="number")return new Lo([s,s,s,s]);if(Array.isArray(s)&&!(s.length<1||s.length>4)){for(const h of s)if(typeof h!="number")return;switch(s.length){case 1:s=[s[0],s[0],s[0],s[0]];break;case 2:s=[s[0],s[1],s[0],s[1]];break;case 3:s=[s[0],s[1],s[2],s[1]]}return new Lo(s)}}toString(){return JSON.stringify(this.values)}}const bc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ps{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof ps)return s;if(Array.isArray(s)&&!(s.length<1)&&s.length%2==0){for(let h=0;h<s.length;h+=2){const p=s[h],_=s[h+1];if(typeof p!="string"||!bc.has(p)||!Array.isArray(_)||_.length!==2||typeof _[0]!="number"||typeof _[1]!="number")return}return new ps(s)}}toString(){return JSON.stringify(this.values)}}class ds{constructor(s){this.name=s.name,this.available=s.available}toString(){return this.name}static fromString(s){return s?new ds({name:s,available:!1}):null}}function Cu(u,s,h,p){return typeof u=="number"&&u>=0&&u<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof h=="number"&&h>=0&&h<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[u,s,h,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[u,s,h,p]:[u,s,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function vh(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof Qn||u instanceof Sp||u instanceof Wo||u instanceof Lo||u instanceof ps||u instanceof ds)return!0;if(Array.isArray(u)){for(const s of u)if(!vh(s))return!1;return!0}if(typeof u=="object"){for(const s in u)if(!vh(u[s]))return!1;return!0}return!1}function ci(u){if(u===null)return li;if(typeof u=="string")return mn;if(typeof u=="boolean")return pn;if(typeof u=="number")return pt;if(u instanceof Qn)return Zr;if(u instanceof Sp)return za;if(u instanceof Wo)return Jr;if(u instanceof Lo)return _e;if(u instanceof ps)return X;if(u instanceof ds)return W;if(Array.isArray(u)){const s=u.length;let h;for(const p of u){const _=ci(p);if(h){if(h===_)continue;h=fn;break}h=_}return Q(h||fn,s)}return fs}function xc(u){const s=typeof u;return u===null?"":s==="string"||s==="number"||s==="boolean"?String(u):u instanceof Qn||u instanceof Wo||u instanceof Lo||u instanceof ps||u instanceof ds?u.toString():JSON.stringify(u)}class ll{constructor(s,h){this.type=s,this.value=h}static parse(s,h){if(s.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!vh(s[1]))return h.error("invalid value");const p=s[1];let _=ci(p);const x=h.expectedType;return _.kind!=="array"||_.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(_=x),new ll(_,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Pr{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}}const bh={string:mn,number:pt,boolean:pn,object:fs};class Ho{constructor(s,h){this.type=s,this.args=h}static parse(s,h){if(s.length<2)return h.error("Expected at least one argument.");let p,_=1;const x=s[0];if(x==="array"){let I,P;if(s.length>2){const D=s[1];if(typeof D!="string"||!(D in bh)||D==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);I=bh[D],_++}else I=fn;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return h.error('The length argument to "array" must be a positive integer literal',2);P=s[2],_++}p=Q(I,P)}else{if(!bh[x])throw new Error(`Types doesn't contain name = ${x}`);p=bh[x]}const w=[];for(;_<s.length;_++){const I=h.parse(s[_],_,fn);if(!I)return null;w.push(I)}return new Ho(p,w)}evaluate(s){for(let h=0;h<this.args.length;h++){const p=this.args[h].evaluate(s);if(!ee(this.type,ci(p)))return p;if(h===this.args.length-1)throw new Pr(`Expected value to be of type ${le(this.type)}, but found ${le(ci(p))} instead.`)}throw new Error}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const xh={"to-boolean":pn,"to-color":Zr,"to-number":pt,"to-string":mn};class ea{constructor(s,h){this.type=s,this.args=h}static parse(s,h){if(s.length<2)return h.error("Expected at least one argument.");const p=s[0];if(!xh[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&s.length!==2)return h.error("Expected one argument.");const _=xh[p],x=[];for(let w=1;w<s.length;w++){const I=h.parse(s[w],w,fn);if(!I)return null;x.push(I)}return new ea(_,x)}evaluate(s){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(s);case"color":{let h,p;for(const _ of this.args){if(h=_.evaluate(s),p=null,h instanceof Qn)return h;if(typeof h=="string"){const x=s.parseColor(h);if(x)return x}else if(Array.isArray(h)&&(p=h.length<3||h.length>4?`Invalid rbga value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:Cu(h[0],h[1],h[2],h[3]),!p))return new Qn(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new Pr(p||`Could not parse color from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"padding":{let h;for(const p of this.args){h=p.evaluate(s);const _=Lo.parse(h);if(_)return _}throw new Pr(`Could not parse padding from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"variableAnchorOffsetCollection":{let h;for(const p of this.args){h=p.evaluate(s);const _=ps.parse(h);if(_)return _}throw new Pr(`Could not parse variableAnchorOffsetCollection from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"number":{let h=null;for(const p of this.args){if(h=p.evaluate(s),h===null)return 0;const _=Number(h);if(!isNaN(_))return _}throw new Pr(`Could not convert ${JSON.stringify(h)} to number.`)}case"formatted":return Wo.fromString(xc(this.args[0].evaluate(s)));case"resolvedImage":return ds.fromString(xc(this.args[0].evaluate(s)));default:return xc(this.args[0].evaluate(s))}}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const wc=["Unknown","Point","LineString","Polygon"];class er{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?wc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(s){let h=this._parseColorCache[s];return h||(h=this._parseColorCache[s]=Qn.parse(s)),h}}class wh{constructor(s,h,p=[],_,x=new Gl,w=[]){this.registry=s,this.path=p,this.key=p.map(I=>`[${I}]`).join(""),this.scope=x,this.errors=w,this.expectedType=_,this._isConstant=h}parse(s,h,p,_,x={}){return h?this.concat(h,p,_)._parse(s,x):this._parse(s,x)}_parse(s,h){function p(_,x,w){return w==="assert"?new Ho(x,[_]):w==="coerce"?new ea(x,[_]):_}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=s[0];if(typeof _!="string")return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[_];if(x){let w=x.parse(s,this);if(!w)return null;if(this.expectedType){const I=this.expectedType,P=w.type;if(I.kind!=="string"&&I.kind!=="number"&&I.kind!=="boolean"&&I.kind!=="object"&&I.kind!=="array"||P.kind!=="value")if(I.kind!=="color"&&I.kind!=="formatted"&&I.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string")if(I.kind!=="padding"||P.kind!=="value"&&P.kind!=="number"&&P.kind!=="array")if(I.kind!=="variableAnchorOffsetCollection"||P.kind!=="value"&&P.kind!=="array"){if(this.checkSubtype(I,P))return null}else w=p(w,I,h.typeAnnotation||"coerce");else w=p(w,I,h.typeAnnotation||"coerce");else w=p(w,I,h.typeAnnotation||"coerce");else w=p(w,I,h.typeAnnotation||"assert")}if(!(w instanceof ll)&&w.type.kind!=="resolvedImage"&&this._isConstant(w)){const I=new er;try{w=new ll(w.type,w.evaluate(I))}catch(P){return this.error(P.message),null}}return w}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,h,p){const _=typeof s=="number"?this.path.concat(s):this.path,x=p?this.scope.concat(p):this.scope;return new wh(this.registry,this._isConstant,_,h||null,x,this.errors)}error(s,...h){const p=`${this.key}${h.map(_=>`[${_}]`).join("")}`;this.errors.push(new fo(p,s))}checkSubtype(s,h){const p=ee(s,h);return p&&this.error(p),p}}class Tu{constructor(s,h,p){this.type=za,this.locale=p,this.caseSensitive=s,this.diacriticSensitive=h}static parse(s,h){if(s.length!==2)return h.error("Expected one argument.");const p=s[1];if(typeof p!="object"||Array.isArray(p))return h.error("Collator options argument must be an object.");const _=h.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,pn);if(!_)return null;const x=h.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,pn);if(!x)return null;let w=null;return p.locale&&(w=h.parse(p.locale,1,mn),!w)?null:new Tu(_,x,w)}evaluate(s){return new Sp(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}}const ul=8192;function Sh(u,s){u[0]=Math.min(u[0],s[0]),u[1]=Math.min(u[1],s[1]),u[2]=Math.max(u[2],s[0]),u[3]=Math.max(u[3],s[1])}function Sc(u,s){return!(u[0]<=s[0]||u[2]>=s[2]||u[1]<=s[1]||u[3]>=s[3])}function Ty(u,s){const h=(180+u[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,_=Math.pow(2,s.z);return[Math.round(h*_*ul),Math.round(p*_*ul)]}function Rm(u,s,h){const p=u[0]-s[0],_=u[1]-s[1],x=u[0]-h[0],w=u[1]-h[1];return p*w-x*_==0&&p*x<=0&&_*w<=0}function Eh(u,s){let h=!1;for(let w=0,I=s.length;w<I;w++){const P=s[w];for(let D=0,F=P.length;D<F-1;D++){if(Rm(u,P[D],P[D+1]))return!1;(_=P[D])[1]>(p=u)[1]!=(x=P[D+1])[1]>p[1]&&p[0]<(x[0]-_[0])*(p[1]-_[1])/(x[1]-_[1])+_[0]&&(h=!h)}}var p,_,x;return h}function Ly(u,s){for(let h=0;h<s.length;h++)if(Eh(u,s[h]))return!0;return!1}function Nm(u,s,h,p){const _=p[0]-h[0],x=p[1]-h[1],w=(u[0]-h[0])*x-_*(u[1]-h[1]),I=(s[0]-h[0])*x-_*(s[1]-h[1]);return w>0&&I<0||w<0&&I>0}function Py(u,s,h){for(const D of h)for(let F=0;F<D.length-1;++F)if((I=[(w=D[F+1])[0]-(x=D[F])[0],w[1]-x[1]])[0]*(P=[(_=s)[0]-(p=u)[0],_[1]-p[1]])[1]-I[1]*P[0]!=0&&Nm(p,_,x,w)&&Nm(x,w,p,_))return!0;var p,_,x,w,I,P;return!1}function Om(u,s){for(let h=0;h<u.length;++h)if(!Eh(u[h],s))return!1;for(let h=0;h<u.length-1;++h)if(Py(u[h],u[h+1],s))return!1;return!0}function zm(u,s){for(let h=0;h<s.length;h++)if(Om(u,s[h]))return!0;return!1}function Ih(u,s,h){const p=[];for(let _=0;_<u.length;_++){const x=[];for(let w=0;w<u[_].length;w++){const I=Ty(u[_][w],h);Sh(s,I),x.push(I)}p.push(x)}return p}function Fm(u,s,h){const p=[];for(let _=0;_<u.length;_++){const x=Ih(u[_],s,h);p.push(x)}return p}function Bm(u,s,h,p){if(u[0]<h[0]||u[0]>h[2]){const _=.5*p;let x=u[0]-h[0]>_?-p:h[0]-u[0]>_?p:0;x===0&&(x=u[0]-h[2]>_?-p:h[2]-u[0]>_?p:0),u[0]+=x}Sh(s,u)}function Ch(u,s,h,p){const _=Math.pow(2,p.z)*ul,x=[p.x*ul,p.y*ul],w=[];for(const I of u)for(const P of I){const D=[P.x+x[0],P.y+x[1]];Bm(D,s,h,_),w.push(D)}return w}function Vm(u,s,h,p){const _=Math.pow(2,p.z)*ul,x=[p.x*ul,p.y*ul],w=[];for(const P of u){const D=[];for(const F of P){const V=[F.x+x[0],F.y+x[1]];Sh(s,V),D.push(V)}w.push(D)}if(s[2]-s[0]<=_/2){(I=s)[0]=I[1]=1/0,I[2]=I[3]=-1/0;for(const P of w)for(const D of P)Bm(D,s,h,_)}var I;return w}class ql{constructor(s,h){this.type=pn,this.geojson=s,this.geometries=h}static parse(s,h){if(s.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(vh(s[1])){const p=s[1];if(p.type==="FeatureCollection"){const _=[];for(const x of p.features){const{type:w,coordinates:I}=x.geometry;w==="Polygon"&&_.push(I),w==="MultiPolygon"&&_.push(...I)}if(_.length)return new ql(p,{type:"MultiPolygon",coordinates:_})}else if(p.type==="Feature"){const _=p.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new ql(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new ql(p,p)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(h,p){const _=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],w=h.canonicalID();if(p.type==="Polygon"){const I=Ih(p.coordinates,x,w),P=Ch(h.geometry(),_,x,w);if(!Sc(_,x))return!1;for(const D of P)if(!Eh(D,I))return!1}if(p.type==="MultiPolygon"){const I=Fm(p.coordinates,x,w),P=Ch(h.geometry(),_,x,w);if(!Sc(_,x))return!1;for(const D of P)if(!Ly(D,I))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(h,p){const _=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],w=h.canonicalID();if(p.type==="Polygon"){const I=Ih(p.coordinates,x,w),P=Vm(h.geometry(),_,x,w);if(!Sc(_,x))return!1;for(const D of P)if(!Om(D,I))return!1}if(p.type==="MultiPolygon"){const I=Fm(p.coordinates,x,w),P=Vm(h.geometry(),_,x,w);if(!Sc(_,x))return!1;for(const D of P)if(!zm(D,I))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Th{constructor(s,h){this.type=h.type,this.name=s,this.boundExpression=h}static parse(s,h){if(s.length!==2||typeof s[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const p=s[1];return h.scope.has(p)?new Th(p,h.scope.get(p)):h.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}}class Zo{constructor(s,h,p,_){this.name=s,this.type=h,this._evaluate=p,this.args=_}evaluate(s){return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}static parse(s,h){const p=s[0],_=Zo.definitions[p];if(!_)return h.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(_)?_[0]:_.type,w=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,I=w.filter(([D])=>!Array.isArray(D)||D.length===s.length-1);let P=null;for(const[D,F]of I){P=new wh(h.registry,Ec,h.path,null,h.scope);const V=[];let H=!1;for(let Y=1;Y<s.length;Y++){const J=s[Y],ie=Array.isArray(D)?D[Y-1]:D.type,ge=P.parse(J,1+V.length,ie);if(!ge){H=!0;break}V.push(ge)}if(!H)if(Array.isArray(D)&&D.length!==V.length)P.error(`Expected ${D.length} arguments, but found ${V.length} instead.`);else{for(let Y=0;Y<V.length;Y++){const J=Array.isArray(D)?D[Y]:D.type,ie=V[Y];P.concat(Y+1).checkSubtype(J,ie.type)}if(P.errors.length===0)return new Zo(p,x,F,V)}}if(I.length===1)h.errors.push(...P.errors);else{const D=(I.length?I:w).map(([V])=>{return H=V,Array.isArray(H)?`(${H.map(le).join(", ")})`:`(${le(H.type)}...)`;var H}).join(" | "),F=[];for(let V=1;V<s.length;V++){const H=h.parse(s[V],1+F.length);if(!H)return null;F.push(le(H.type))}h.error(`Expected arguments of type ${D}, but found (${F.join(", ")}) instead.`)}return null}static register(s,h){Zo.definitions=h;for(const p in h)s[p]=Zo}}function Ec(u){if(u instanceof Th)return Ec(u.boundExpression);if(u instanceof Zo&&u.name==="error"||u instanceof Tu||u instanceof ql)return!1;const s=u instanceof ea||u instanceof Ho;let h=!0;return u.eachChild(p=>{h=s?h&&Ec(p):h&&p instanceof ll}),!!h&&Lh(u)&&Cc(u,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Lh(u){if(u instanceof Zo&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof ql)return!1;let s=!0;return u.eachChild(h=>{s&&!Lh(h)&&(s=!1)}),s}function Ic(u){if(u instanceof Zo&&u.name==="feature-state")return!1;let s=!0;return u.eachChild(h=>{s&&!Ic(h)&&(s=!1)}),s}function Cc(u,s){if(u instanceof Zo&&s.indexOf(u.name)>=0)return!1;let h=!0;return u.eachChild(p=>{h&&!Cc(p,s)&&(h=!1)}),h}function Tc(u,s){const h=u.length-1;let p,_,x=0,w=h,I=0;for(;x<=w;)if(I=Math.floor((x+w)/2),p=u[I],_=u[I+1],p<=s){if(I===h||s<_)return I;x=I+1}else{if(!(p>s))throw new Pr("Input is not a number.");w=I-1}return 0}class Lc{constructor(s,h,p){this.type=s,this.input=h,this.labels=[],this.outputs=[];for(const[_,x]of p)this.labels.push(_),this.outputs.push(x)}static parse(s,h){if(s.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return h.error("Expected an even number of arguments.");const p=h.parse(s[1],1,pt);if(!p)return null;const _=[];let x=null;h.expectedType&&h.expectedType.kind!=="value"&&(x=h.expectedType);for(let w=1;w<s.length;w+=2){const I=w===1?-1/0:s[w],P=s[w+1],D=w,F=w+1;if(typeof I!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(_.length&&_[_.length-1][0]>=I)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const V=h.parse(P,F,x);if(!V)return null;x=x||V.type,_.push([I,V])}return new Lc(x,p,_)}evaluate(s){const h=this.labels,p=this.outputs;if(h.length===1)return p[0].evaluate(s);const _=this.input.evaluate(s);if(_<=h[0])return p[0].evaluate(s);const x=h.length;return _>=h[x-1]?p[x-1].evaluate(s):p[Tc(h,_)].evaluate(s)}eachChild(s){s(this.input);for(const h of this.outputs)s(h)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function My(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var ky=Um;function Um(u,s,h,p){this.cx=3*u,this.bx=3*(h-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(p-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=s,this.p2x=h,this.p2y=p}Um.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,s){if(s===void 0&&(s=1e-6),u<0)return 0;if(u>1)return 1;for(var h=u,p=0;p<8;p++){var _=this.sampleCurveX(h)-u;if(Math.abs(_)<s)return h;var x=this.sampleCurveDerivativeX(h);if(Math.abs(x)<1e-6)break;h-=_/x}var w=0,I=1;for(h=u,p=0;p<20&&(_=this.sampleCurveX(h),!(Math.abs(_-u)<s));p++)u>_?w=h:I=h,h=.5*(I-w)+w;return h},solve:function(u,s){return this.sampleCurveY(this.solveCurveX(u,s))}};var Ay=My(ky);function Wl(u,s,h){return u+h*(s-u)}function Ph(u,s,h){return u.map((p,_)=>Wl(p,s[_],h))}const mo={number:Wl,color:function(u,s,h,p="rgb"){switch(p){case"rgb":{const[_,x,w,I]=Ph(u.rgb,s.rgb,h);return new Qn(_,x,w,I,!1)}case"hcl":{const[_,x,w,I]=u.hcl,[P,D,F,V]=s.hcl;let H,Y;if(isNaN(_)||isNaN(P))isNaN(_)?isNaN(P)?H=NaN:(H=P,w!==1&&w!==0||(Y=D)):(H=_,F!==1&&F!==0||(Y=x));else{let Ne=P-_;P>_&&Ne>180?Ne-=360:P<_&&_-P>180&&(Ne+=360),H=_+h*Ne}const[J,ie,ge,we]=function([Ne,Ee,Ae,Qe]){return Ne=isNaN(Ne)?0:Ne*un,Or([Ae,Math.cos(Ne)*Ee,Math.sin(Ne)*Ee,Qe])}([H,Y??Wl(x,D,h),Wl(w,F,h),Wl(I,V,h)]);return new Qn(J,ie,ge,we,!1)}case"lab":{const[_,x,w,I]=Or(Ph(u.lab,s.lab,h));return new Qn(_,x,w,I,!1)}}},array:Ph,padding:function(u,s,h){return new Lo(Ph(u.values,s.values,h))},variableAnchorOffsetCollection:function(u,s,h){const p=u.values,_=s.values;if(p.length!==_.length)throw new Pr(`Cannot interpolate values of different length. from: ${u.toString()}, to: ${s.toString()}`);const x=[];for(let w=0;w<p.length;w+=2){if(p[w]!==_[w])throw new Pr(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${p[w]}, to[${w}]: ${_[w]}`);x.push(p[w]);const[I,P]=p[w+1],[D,F]=_[w+1];x.push([Wl(I,D,h),Wl(P,F,h)])}return new ps(x)}};class Ki{constructor(s,h,p,_,x){this.type=s,this.operator=h,this.interpolation=p,this.input=_,this.labels=[],this.outputs=[];for(const[w,I]of x)this.labels.push(w),this.outputs.push(I)}static interpolationFactor(s,h,p,_){let x=0;if(s.name==="exponential")x=Zn(h,s.base,p,_);else if(s.name==="linear")x=Zn(h,1,p,_);else if(s.name==="cubic-bezier"){const w=s.controlPoints;x=new Ay(w[0],w[1],w[2],w[3]).solve(Zn(h,1,p,_))}return x}static parse(s,h){let[p,_,x,...w]=s;if(!Array.isArray(_)||_.length===0)return h.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const D=_[1];if(typeof D!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:D}}else{if(_[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const D=_.slice(1);if(D.length!==4||D.some(F=>typeof F!="number"||F<0||F>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:D}}}if(s.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(x=h.parse(x,2,pt),!x)return null;const I=[];let P=null;p==="interpolate-hcl"||p==="interpolate-lab"?P=Zr:h.expectedType&&h.expectedType.kind!=="value"&&(P=h.expectedType);for(let D=0;D<w.length;D+=2){const F=w[D],V=w[D+1],H=D+3,Y=D+4;if(typeof F!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',H);if(I.length&&I[I.length-1][0]>=F)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',H);const J=h.parse(V,Y,P);if(!J)return null;P=P||J.type,I.push([F,J])}return Re(P,pt)||Re(P,Zr)||Re(P,_e)||Re(P,X)||Re(P,Q(pt))?new Ki(P,p,_,x,I):h.error(`Type ${le(P)} is not interpolatable.`)}evaluate(s){const h=this.labels,p=this.outputs;if(h.length===1)return p[0].evaluate(s);const _=this.input.evaluate(s);if(_<=h[0])return p[0].evaluate(s);const x=h.length;if(_>=h[x-1])return p[x-1].evaluate(s);const w=Tc(h,_),I=Ki.interpolationFactor(this.interpolation,_,h[w],h[w+1]),P=p[w].evaluate(s),D=p[w+1].evaluate(s);switch(this.operator){case"interpolate":return mo[this.type.kind](P,D,I);case"interpolate-hcl":return mo.color(P,D,I,"hcl");case"interpolate-lab":return mo.color(P,D,I,"lab")}}eachChild(s){s(this.input);for(const h of this.outputs)s(h)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Zn(u,s,h,p){const _=p-h,x=u-h;return _===0?0:s===1?x/_:(Math.pow(s,x)-1)/(Math.pow(s,_)-1)}class Mh{constructor(s,h){this.type=s,this.args=h}static parse(s,h){if(s.length<2)return h.error("Expectected at least one argument.");let p=null;const _=h.expectedType;_&&_.kind!=="value"&&(p=_);const x=[];for(const I of s.slice(1)){const P=h.parse(I,1+x.length,p,void 0,{typeAnnotation:"omit"});if(!P)return null;p=p||P.type,x.push(P)}if(!p)throw new Error("No output type");const w=_&&x.some(I=>ee(_,I.type));return new Mh(w?fn:p,x)}evaluate(s){let h,p=null,_=0;for(const x of this.args)if(_++,p=x.evaluate(s),p&&p instanceof ds&&!p.available&&(h||(h=p.name),p=null,_===this.args.length&&(p=h)),p!==null)break;return p}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}class kh{constructor(s,h){this.type=h.type,this.bindings=[].concat(s),this.result=h}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const h of this.bindings)s(h[1]);s(this.result)}static parse(s,h){if(s.length<4)return h.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const p=[];for(let x=1;x<s.length-1;x+=2){const w=s[x];if(typeof w!="string")return h.error(`Expected string, but found ${typeof w} instead.`,x);if(/[^a-zA-Z0-9_]/.test(w))return h.error("Variable names must contain only alphanumeric characters or '_'.",x);const I=h.parse(s[x+1],x+1);if(!I)return null;p.push([w,I])}const _=h.parse(s[s.length-1],s.length-1,h.expectedType,p);return _?new kh(p,_):null}outputDefined(){return this.result.outputDefined()}}class Ip{constructor(s,h,p){this.type=s,this.index=h,this.input=p}static parse(s,h){if(s.length!==3)return h.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const p=h.parse(s[1],1,pt),_=h.parse(s[2],2,Q(h.expectedType||fn));return p&&_?new Ip(_.type.itemType,p,_):null}evaluate(s){const h=this.index.evaluate(s),p=this.input.evaluate(s);if(h<0)throw new Pr(`Array index out of bounds: ${h} < 0.`);if(h>=p.length)throw new Pr(`Array index out of bounds: ${h} > ${p.length-1}.`);if(h!==Math.floor(h))throw new Pr(`Array index must be an integer, but found ${h} instead.`);return p[h]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}}class Cp{constructor(s,h){this.type=pn,this.needle=s,this.haystack=h}static parse(s,h){if(s.length!==3)return h.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const p=h.parse(s[1],1,fn),_=h.parse(s[2],2,fn);return p&&_?Me(p.type,[pn,mn,pt,li,fn])?new Cp(p,_):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${le(p.type)} instead`):null}evaluate(s){const h=this.needle.evaluate(s),p=this.haystack.evaluate(s);if(!p)return!1;if(!Se(h,["boolean","string","number","null"]))throw new Pr(`Expected first argument to be of type boolean, string, number or null, but found ${le(ci(h))} instead.`);if(!Se(p,["string","array"]))throw new Pr(`Expected second argument to be of type array or string, but found ${le(ci(p))} instead.`);return p.indexOf(h)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}}class Ah{constructor(s,h,p){this.type=pt,this.needle=s,this.haystack=h,this.fromIndex=p}static parse(s,h){if(s.length<=2||s.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const p=h.parse(s[1],1,fn),_=h.parse(s[2],2,fn);if(!p||!_)return null;if(!Me(p.type,[pn,mn,pt,li,fn]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${le(p.type)} instead`);if(s.length===4){const x=h.parse(s[3],3,pt);return x?new Ah(p,_,x):null}return new Ah(p,_)}evaluate(s){const h=this.needle.evaluate(s),p=this.haystack.evaluate(s);if(!Se(h,["boolean","string","number","null"]))throw new Pr(`Expected first argument to be of type boolean, string, number or null, but found ${le(ci(h))} instead.`);if(!Se(p,["string","array"]))throw new Pr(`Expected second argument to be of type array or string, but found ${le(ci(p))} instead.`);if(this.fromIndex){const _=this.fromIndex.evaluate(s);return p.indexOf(h,_)}return p.indexOf(h)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}}class Tp{constructor(s,h,p,_,x,w){this.inputType=s,this.type=h,this.input=p,this.cases=_,this.outputs=x,this.otherwise=w}static parse(s,h){if(s.length<5)return h.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return h.error("Expected an even number of arguments.");let p,_;h.expectedType&&h.expectedType.kind!=="value"&&(_=h.expectedType);const x={},w=[];for(let D=2;D<s.length-1;D+=2){let F=s[D];const V=s[D+1];Array.isArray(F)||(F=[F]);const H=h.concat(D);if(F.length===0)return H.error("Expected at least one branch label.");for(const J of F){if(typeof J!="number"&&typeof J!="string")return H.error("Branch labels must be numbers or strings.");if(typeof J=="number"&&Math.abs(J)>Number.MAX_SAFE_INTEGER)return H.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof J=="number"&&Math.floor(J)!==J)return H.error("Numeric branch labels must be integer values.");if(p){if(H.checkSubtype(p,ci(J)))return null}else p=ci(J);if(x[String(J)]!==void 0)return H.error("Branch labels must be unique.");x[String(J)]=w.length}const Y=h.parse(V,D,_);if(!Y)return null;_=_||Y.type,w.push(Y)}const I=h.parse(s[1],1,fn);if(!I)return null;const P=h.parse(s[s.length-1],s.length-1,_);return P?I.type.kind!=="value"&&h.concat(1).checkSubtype(p,I.type)?null:new Tp(p,_,I,x,w,P):null}evaluate(s){const h=this.input.evaluate(s);return(ci(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}}class Lp{constructor(s,h,p){this.type=s,this.branches=h,this.otherwise=p}static parse(s,h){if(s.length<4)return h.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return h.error("Expected an odd number of arguments.");let p;h.expectedType&&h.expectedType.kind!=="value"&&(p=h.expectedType);const _=[];for(let w=1;w<s.length-1;w+=2){const I=h.parse(s[w],w,pn);if(!I)return null;const P=h.parse(s[w+1],w+1,p);if(!P)return null;_.push([I,P]),p=p||P.type}const x=h.parse(s[s.length-1],s.length-1,p);if(!x)return null;if(!p)throw new Error("Can't infer output type");return new Lp(p,_,x)}evaluate(s){for(const[h,p]of this.branches)if(h.evaluate(s))return p.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[h,p]of this.branches)s(h),s(p);s(this.otherwise)}outputDefined(){return this.branches.every(([s,h])=>h.outputDefined())&&this.otherwise.outputDefined()}}class Dh{constructor(s,h,p,_){this.type=s,this.input=h,this.beginIndex=p,this.endIndex=_}static parse(s,h){if(s.length<=2||s.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const p=h.parse(s[1],1,fn),_=h.parse(s[2],2,pt);if(!p||!_)return null;if(!Me(p.type,[Q(fn),mn,fn]))return h.error(`Expected first argument to be of type array or string, but found ${le(p.type)} instead`);if(s.length===4){const x=h.parse(s[3],3,pt);return x?new Dh(p.type,p,_,x):null}return new Dh(p.type,p,_)}evaluate(s){const h=this.input.evaluate(s),p=this.beginIndex.evaluate(s);if(!Se(h,["string","array"]))throw new Pr(`Expected first argument to be of type array or string, but found ${le(ci(h))} instead.`);if(this.endIndex){const _=this.endIndex.evaluate(s);return h.slice(p,_)}return h.slice(p)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}}function jm(u,s){return u==="=="||u==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function Gm(u,s,h,p){return p.compare(s,h)===0}function Lu(u,s,h){const p=u!=="=="&&u!=="!=";return class JE{constructor(x,w,I){this.type=pn,this.lhs=x,this.rhs=w,this.collator=I,this.hasUntypedArgument=x.type.kind==="value"||w.type.kind==="value"}static parse(x,w){if(x.length!==3&&x.length!==4)return w.error("Expected two or three arguments.");const I=x[0];let P=w.parse(x[1],1,fn);if(!P)return null;if(!jm(I,P.type))return w.concat(1).error(`"${I}" comparisons are not supported for type '${le(P.type)}'.`);let D=w.parse(x[2],2,fn);if(!D)return null;if(!jm(I,D.type))return w.concat(2).error(`"${I}" comparisons are not supported for type '${le(D.type)}'.`);if(P.type.kind!==D.type.kind&&P.type.kind!=="value"&&D.type.kind!=="value")return w.error(`Cannot compare types '${le(P.type)}' and '${le(D.type)}'.`);p&&(P.type.kind==="value"&&D.type.kind!=="value"?P=new Ho(D.type,[P]):P.type.kind!=="value"&&D.type.kind==="value"&&(D=new Ho(P.type,[D])));let F=null;if(x.length===4){if(P.type.kind!=="string"&&D.type.kind!=="string"&&P.type.kind!=="value"&&D.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(F=w.parse(x[3],3,za),!F)return null}return new JE(P,D,F)}evaluate(x){const w=this.lhs.evaluate(x),I=this.rhs.evaluate(x);if(p&&this.hasUntypedArgument){const P=ci(w),D=ci(I);if(P.kind!==D.kind||P.kind!=="string"&&P.kind!=="number")throw new Pr(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${P.kind}, ${D.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const P=ci(w),D=ci(I);if(P.kind!=="string"||D.kind!=="string")return s(x,w,I)}return this.collator?h(x,w,I,this.collator.evaluate(x)):s(x,w,I)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}}}const Dy=Lu("==",function(u,s,h){return s===h},Gm),Ry=Lu("!=",function(u,s,h){return s!==h},function(u,s,h,p){return!Gm(0,s,h,p)}),Ny=Lu("<",function(u,s,h){return s<h},function(u,s,h,p){return p.compare(s,h)<0}),Oy=Lu(">",function(u,s,h){return s>h},function(u,s,h,p){return p.compare(s,h)>0}),zy=Lu("<=",function(u,s,h){return s<=h},function(u,s,h,p){return p.compare(s,h)<=0}),Fy=Lu(">=",function(u,s,h){return s>=h},function(u,s,h,p){return p.compare(s,h)>=0});class Pp{constructor(s,h,p,_,x){this.type=mn,this.number=s,this.locale=h,this.currency=p,this.minFractionDigits=_,this.maxFractionDigits=x}static parse(s,h){if(s.length!==3)return h.error("Expected two arguments.");const p=h.parse(s[1],1,pt);if(!p)return null;const _=s[2];if(typeof _!="object"||Array.isArray(_))return h.error("NumberFormat options argument must be an object.");let x=null;if(_.locale&&(x=h.parse(_.locale,1,mn),!x))return null;let w=null;if(_.currency&&(w=h.parse(_.currency,1,mn),!w))return null;let I=null;if(_["min-fraction-digits"]&&(I=h.parse(_["min-fraction-digits"],1,pt),!I))return null;let P=null;return _["max-fraction-digits"]&&(P=h.parse(_["max-fraction-digits"],1,pt),!P)?null:new Pp(p,x,w,I,P)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}}class Rh{constructor(s){this.type=Jr,this.sections=s}static parse(s,h){if(s.length<2)return h.error("Expected at least one argument.");const p=s[1];if(!Array.isArray(p)&&typeof p=="object")return h.error("First argument must be an image or text section.");const _=[];let x=!1;for(let w=1;w<=s.length-1;++w){const I=s[w];if(x&&typeof I=="object"&&!Array.isArray(I)){x=!1;let P=null;if(I["font-scale"]&&(P=h.parse(I["font-scale"],1,pt),!P))return null;let D=null;if(I["text-font"]&&(D=h.parse(I["text-font"],1,Q(mn)),!D))return null;let F=null;if(I["text-color"]&&(F=h.parse(I["text-color"],1,Zr),!F))return null;const V=_[_.length-1];V.scale=P,V.font=D,V.textColor=F}else{const P=h.parse(s[w],1,fn);if(!P)return null;const D=P.type.kind;if(D!=="string"&&D!=="value"&&D!=="null"&&D!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,_.push({content:P,scale:null,font:null,textColor:null})}}return new Rh(_)}evaluate(s){return new Wo(this.sections.map(h=>{const p=h.content.evaluate(s);return ci(p)===W?new Ep("",p,null,null,null):new Ep(xc(p),null,h.scale?h.scale.evaluate(s):null,h.font?h.font.evaluate(s).join(","):null,h.textColor?h.textColor.evaluate(s):null)}))}eachChild(s){for(const h of this.sections)s(h.content),h.scale&&s(h.scale),h.font&&s(h.font),h.textColor&&s(h.textColor)}outputDefined(){return!1}}class Mp{constructor(s){this.type=W,this.input=s}static parse(s,h){if(s.length!==2)return h.error("Expected two arguments.");const p=h.parse(s[1],1,mn);return p?new Mp(p):h.error("No image name provided.")}evaluate(s){const h=this.input.evaluate(s),p=ds.fromString(h);return p&&s.availableImages&&(p.available=s.availableImages.indexOf(h)>-1),p}eachChild(s){s(this.input)}outputDefined(){return!1}}class kp{constructor(s){this.type=pt,this.input=s}static parse(s,h){if(s.length!==2)return h.error(`Expected 1 argument, but found ${s.length-1} instead.`);const p=h.parse(s[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${le(p.type)} instead.`):new kp(p):null}evaluate(s){const h=this.input.evaluate(s);if(typeof h=="string"||Array.isArray(h))return h.length;throw new Pr(`Expected value to be of type string or array, but found ${le(ci(h))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}}const Pu={"==":Dy,"!=":Ry,">":Oy,"<":Ny,">=":Fy,"<=":zy,array:Ho,at:Ip,boolean:Ho,case:Lp,coalesce:Mh,collator:Tu,format:Rh,image:Mp,in:Cp,"index-of":Ah,interpolate:Ki,"interpolate-hcl":Ki,"interpolate-lab":Ki,length:kp,let:kh,literal:ll,match:Tp,number:Ho,"number-format":Pp,object:Ho,slice:Dh,step:Lc,string:Ho,"to-boolean":ea,"to-color":ea,"to-number":ea,"to-string":ea,var:Th,within:ql};function qm(u,[s,h,p,_]){s=s.evaluate(u),h=h.evaluate(u),p=p.evaluate(u);const x=_?_.evaluate(u):1,w=Cu(s,h,p,x);if(w)throw new Pr(w);return new Qn(s/255,h/255,p/255,x,!1)}function Wm(u,s){return u in s}function Ap(u,s){const h=s[u];return h===void 0?null:h}function Hl(u){return{type:u}}function Hm(u){return{result:"success",value:u}}function Mu(u){return{result:"error",value:u}}function ku(u){return u["property-type"]==="data-driven"||u["property-type"]==="cross-faded-data-driven"}function Zm(u){return!!u.expression&&u.expression.parameters.indexOf("zoom")>-1}function Dp(u){return!!u.expression&&u.expression.interpolated}function Un(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}function Nh(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function By(u){return u}function Xm(u,s){const h=s.type==="color",p=u.stops&&typeof u.stops[0][0]=="object",_=p||!(p||u.property!==void 0),x=u.type||(Dp(s)?"exponential":"interval");if(h||s.type==="padding"){const F=h?Qn.parse:Lo.parse;(u=hs({},u)).stops&&(u.stops=u.stops.map(V=>[V[0],F(V[1])])),u.default=F(u.default?u.default:s.default)}if(u.colorSpace&&(w=u.colorSpace)!=="rgb"&&w!=="hcl"&&w!=="lab")throw new Error(`Unknown color space: "${u.colorSpace}"`);var w;let I,P,D;if(x==="exponential")I=zn;else if(x==="interval")I=Vy;else if(x==="categorical"){I=Qr,P=Object.create(null);for(const F of u.stops)P[F[0]]=F[1];D=typeof u.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);I=Rp}if(p){const F={},V=[];for(let J=0;J<u.stops.length;J++){const ie=u.stops[J],ge=ie[0].zoom;F[ge]===void 0&&(F[ge]={zoom:ge,type:u.type,property:u.property,default:u.default,stops:[]},V.push(ge)),F[ge].stops.push([ie[0].value,ie[1]])}const H=[];for(const J of V)H.push([F[J].zoom,Xm(F[J],s)]);const Y={name:"linear"};return{kind:"composite",interpolationType:Y,interpolationFactor:Ki.interpolationFactor.bind(void 0,Y),zoomStops:H.map(J=>J[0]),evaluate:({zoom:J},ie)=>zn({stops:H,base:u.base},s,J).evaluate(J,ie)}}if(_){const F=x==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:F,interpolationFactor:Ki.interpolationFactor.bind(void 0,F),zoomStops:u.stops.map(V=>V[0]),evaluate:({zoom:V})=>I(u,s,V,P,D)}}return{kind:"source",evaluate(F,V){const H=V&&V.properties?V.properties[u.property]:void 0;return H===void 0?Pc(u.default,s.default):I(u,s,H,P,D)}}}function Pc(u,s,h){return u!==void 0?u:s!==void 0?s:h!==void 0?h:void 0}function Qr(u,s,h,p,_){return Pc(typeof h===_?p[h]:void 0,u.default,s.default)}function Vy(u,s,h){if(Un(h)!=="number")return Pc(u.default,s.default);const p=u.stops.length;if(p===1||h<=u.stops[0][0])return u.stops[0][1];if(h>=u.stops[p-1][0])return u.stops[p-1][1];const _=Tc(u.stops.map(x=>x[0]),h);return u.stops[_][1]}function zn(u,s,h){const p=u.base!==void 0?u.base:1;if(Un(h)!=="number")return Pc(u.default,s.default);const _=u.stops.length;if(_===1||h<=u.stops[0][0])return u.stops[0][1];if(h>=u.stops[_-1][0])return u.stops[_-1][1];const x=Tc(u.stops.map(F=>F[0]),h),w=function(F,V,H,Y){const J=Y-H,ie=F-H;return J===0?0:V===1?ie/J:(Math.pow(V,ie)-1)/(Math.pow(V,J)-1)}(h,p,u.stops[x][0],u.stops[x+1][0]),I=u.stops[x][1],P=u.stops[x+1][1],D=mo[s.type]||By;return typeof I.evaluate=="function"?{evaluate(...F){const V=I.evaluate.apply(void 0,F),H=P.evaluate.apply(void 0,F);if(V!==void 0&&H!==void 0)return D(V,H,w,u.colorSpace)}}:D(I,P,w,u.colorSpace)}function Rp(u,s,h){switch(s.type){case"color":h=Qn.parse(h);break;case"formatted":h=Wo.fromString(h.toString());break;case"resolvedImage":h=ds.fromString(h.toString());break;case"padding":h=Lo.parse(h);break;default:Un(h)===s.type||s.type==="enum"&&s.values[h]||(h=void 0)}return Pc(h,u.default,s.default)}Zo.register(Pu,{error:[{kind:"error"},[mn],(u,[s])=>{throw new Pr(s.evaluate(u))}],typeof:[mn,[fn],(u,[s])=>le(ci(s.evaluate(u)))],"to-rgba":[Q(pt,4),[Zr],(u,[s])=>{const[h,p,_,x]=s.evaluate(u).rgb;return[255*h,255*p,255*_,x]}],rgb:[Zr,[pt,pt,pt],qm],rgba:[Zr,[pt,pt,pt,pt],qm],has:{type:pn,overloads:[[[mn],(u,[s])=>Wm(s.evaluate(u),u.properties())],[[mn,fs],(u,[s,h])=>Wm(s.evaluate(u),h.evaluate(u))]]},get:{type:fn,overloads:[[[mn],(u,[s])=>Ap(s.evaluate(u),u.properties())],[[mn,fs],(u,[s,h])=>Ap(s.evaluate(u),h.evaluate(u))]]},"feature-state":[fn,[mn],(u,[s])=>Ap(s.evaluate(u),u.featureState||{})],properties:[fs,[],u=>u.properties()],"geometry-type":[mn,[],u=>u.geometryType()],id:[fn,[],u=>u.id()],zoom:[pt,[],u=>u.globals.zoom],"heatmap-density":[pt,[],u=>u.globals.heatmapDensity||0],"line-progress":[pt,[],u=>u.globals.lineProgress||0],accumulated:[fn,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[pt,Hl(pt),(u,s)=>{let h=0;for(const p of s)h+=p.evaluate(u);return h}],"*":[pt,Hl(pt),(u,s)=>{let h=1;for(const p of s)h*=p.evaluate(u);return h}],"-":{type:pt,overloads:[[[pt,pt],(u,[s,h])=>s.evaluate(u)-h.evaluate(u)],[[pt],(u,[s])=>-s.evaluate(u)]]},"/":[pt,[pt,pt],(u,[s,h])=>s.evaluate(u)/h.evaluate(u)],"%":[pt,[pt,pt],(u,[s,h])=>s.evaluate(u)%h.evaluate(u)],ln2:[pt,[],()=>Math.LN2],pi:[pt,[],()=>Math.PI],e:[pt,[],()=>Math.E],"^":[pt,[pt,pt],(u,[s,h])=>Math.pow(s.evaluate(u),h.evaluate(u))],sqrt:[pt,[pt],(u,[s])=>Math.sqrt(s.evaluate(u))],log10:[pt,[pt],(u,[s])=>Math.log(s.evaluate(u))/Math.LN10],ln:[pt,[pt],(u,[s])=>Math.log(s.evaluate(u))],log2:[pt,[pt],(u,[s])=>Math.log(s.evaluate(u))/Math.LN2],sin:[pt,[pt],(u,[s])=>Math.sin(s.evaluate(u))],cos:[pt,[pt],(u,[s])=>Math.cos(s.evaluate(u))],tan:[pt,[pt],(u,[s])=>Math.tan(s.evaluate(u))],asin:[pt,[pt],(u,[s])=>Math.asin(s.evaluate(u))],acos:[pt,[pt],(u,[s])=>Math.acos(s.evaluate(u))],atan:[pt,[pt],(u,[s])=>Math.atan(s.evaluate(u))],min:[pt,Hl(pt),(u,s)=>Math.min(...s.map(h=>h.evaluate(u)))],max:[pt,Hl(pt),(u,s)=>Math.max(...s.map(h=>h.evaluate(u)))],abs:[pt,[pt],(u,[s])=>Math.abs(s.evaluate(u))],round:[pt,[pt],(u,[s])=>{const h=s.evaluate(u);return h<0?-Math.round(-h):Math.round(h)}],floor:[pt,[pt],(u,[s])=>Math.floor(s.evaluate(u))],ceil:[pt,[pt],(u,[s])=>Math.ceil(s.evaluate(u))],"filter-==":[pn,[mn,fn],(u,[s,h])=>u.properties()[s.value]===h.value],"filter-id-==":[pn,[fn],(u,[s])=>u.id()===s.value],"filter-type-==":[pn,[mn],(u,[s])=>u.geometryType()===s.value],"filter-<":[pn,[mn,fn],(u,[s,h])=>{const p=u.properties()[s.value],_=h.value;return typeof p==typeof _&&p<_}],"filter-id-<":[pn,[fn],(u,[s])=>{const h=u.id(),p=s.value;return typeof h==typeof p&&h<p}],"filter->":[pn,[mn,fn],(u,[s,h])=>{const p=u.properties()[s.value],_=h.value;return typeof p==typeof _&&p>_}],"filter-id->":[pn,[fn],(u,[s])=>{const h=u.id(),p=s.value;return typeof h==typeof p&&h>p}],"filter-<=":[pn,[mn,fn],(u,[s,h])=>{const p=u.properties()[s.value],_=h.value;return typeof p==typeof _&&p<=_}],"filter-id-<=":[pn,[fn],(u,[s])=>{const h=u.id(),p=s.value;return typeof h==typeof p&&h<=p}],"filter->=":[pn,[mn,fn],(u,[s,h])=>{const p=u.properties()[s.value],_=h.value;return typeof p==typeof _&&p>=_}],"filter-id->=":[pn,[fn],(u,[s])=>{const h=u.id(),p=s.value;return typeof h==typeof p&&h>=p}],"filter-has":[pn,[fn],(u,[s])=>s.value in u.properties()],"filter-has-id":[pn,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[pn,[Q(mn)],(u,[s])=>s.value.indexOf(u.geometryType())>=0],"filter-id-in":[pn,[Q(fn)],(u,[s])=>s.value.indexOf(u.id())>=0],"filter-in-small":[pn,[mn,Q(fn)],(u,[s,h])=>h.value.indexOf(u.properties()[s.value])>=0],"filter-in-large":[pn,[mn,Q(fn)],(u,[s,h])=>function(p,_,x,w){for(;x<=w;){const I=x+w>>1;if(_[I]===p)return!0;_[I]>p?w=I-1:x=I+1}return!1}(u.properties()[s.value],h.value,0,h.value.length-1)],all:{type:pn,overloads:[[[pn,pn],(u,[s,h])=>s.evaluate(u)&&h.evaluate(u)],[Hl(pn),(u,s)=>{for(const h of s)if(!h.evaluate(u))return!1;return!0}]]},any:{type:pn,overloads:[[[pn,pn],(u,[s,h])=>s.evaluate(u)||h.evaluate(u)],[Hl(pn),(u,s)=>{for(const h of s)if(h.evaluate(u))return!0;return!1}]]},"!":[pn,[pn],(u,[s])=>!s.evaluate(u)],"is-supported-script":[pn,[mn],(u,[s])=>{const h=u.globals&&u.globals.isSupportedScript;return!h||h(s.evaluate(u))}],upcase:[mn,[mn],(u,[s])=>s.evaluate(u).toUpperCase()],downcase:[mn,[mn],(u,[s])=>s.evaluate(u).toLowerCase()],concat:[mn,Hl(fn),(u,s)=>s.map(h=>xc(h.evaluate(u))).join("")],"resolved-locale":[mn,[za],(u,[s])=>s.evaluate(u).resolvedLocale()]});class br{constructor(s,h){var p;this.expression=s,this._warningHistory={},this._evaluator=new er,this._defaultValue=h?(p=h).type==="color"&&Nh(p.default)?new Qn(0,0,0,0):p.type==="color"?Qn.parse(p.default)||null:p.type==="padding"?Lo.parse(p.default)||null:p.type==="variableAnchorOffsetCollection"?ps.parse(p.default)||null:p.default===void 0?null:p.default:null,this._enumValues=h&&h.type==="enum"?h.values:null}evaluateWithoutErrorHandling(s,h,p,_,x,w){return this._evaluator.globals=s,this._evaluator.feature=h,this._evaluator.featureState=p,this._evaluator.canonical=_,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=w,this.expression.evaluate(this._evaluator)}evaluate(s,h,p,_,x,w){this._evaluator.globals=s,this._evaluator.feature=h||null,this._evaluator.featureState=p||null,this._evaluator.canonical=_,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=w||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new Pr(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(I.message)),this._defaultValue}}}function ur(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in Pu}function Zl(u,s){const h=new wh(Pu,Ec,[],s?function(_){const x={color:Zr,string:mn,number:pt,enum:mn,boolean:pn,formatted:Jr,padding:_e,resolvedImage:W,variableAnchorOffsetCollection:X};return _.type==="array"?Q(x[_.value]||fn,_.length):x[_.type]}(s):void 0),p=h.parse(u,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Hm(new br(p,s)):Mu(h.errors)}class Oh{constructor(s,h){this.kind=s,this._styleExpression=h,this.isStateDependent=s!=="constant"&&!Ic(h.expression)}evaluateWithoutErrorHandling(s,h,p,_,x,w){return this._styleExpression.evaluateWithoutErrorHandling(s,h,p,_,x,w)}evaluate(s,h,p,_,x,w){return this._styleExpression.evaluate(s,h,p,_,x,w)}}class Np{constructor(s,h,p,_){this.kind=s,this.zoomStops=p,this._styleExpression=h,this.isStateDependent=s!=="camera"&&!Ic(h.expression),this.interpolationType=_}evaluateWithoutErrorHandling(s,h,p,_,x,w){return this._styleExpression.evaluateWithoutErrorHandling(s,h,p,_,x,w)}evaluate(s,h,p,_,x,w){return this._styleExpression.evaluate(s,h,p,_,x,w)}interpolationFactor(s,h,p){return this.interpolationType?Ki.interpolationFactor(this.interpolationType,s,h,p):0}}function Ym(u,s){const h=Zl(u,s);if(h.result==="error")return h;const p=h.value.expression,_=Lh(p);if(!_&&!ku(s))return Mu([new fo("","data expressions not supported")]);const x=Cc(p,["zoom"]);if(!x&&!Zm(s))return Mu([new fo("","zoom expressions not supported")]);const w=Fh(p);return w||x?w instanceof fo?Mu([w]):w instanceof Ki&&!Dp(s)?Mu([new fo("",'"interpolate" expressions cannot be used with this property')]):Hm(w?new Np(_?"camera":"composite",h.value,w.labels,w instanceof Ki?w.interpolation:void 0):new Oh(_?"constant":"source",h.value)):Mu([new fo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class zh{constructor(s,h){this._parameters=s,this._specification=h,hs(this,Xm(this._parameters,this._specification))}static deserialize(s){return new zh(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function Fh(u){let s=null;if(u instanceof kh)s=Fh(u.result);else if(u instanceof Mh){for(const h of u.args)if(s=Fh(h),s)break}else(u instanceof Lc||u instanceof Ki)&&u.input instanceof Zo&&u.input.name==="zoom"&&(s=u);return s instanceof fo||u.eachChild(h=>{const p=Fh(h);p instanceof fo?s=p:!s&&p?s=new fo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):s&&p&&s!==p&&(s=new fo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}function Bh(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const s of u.slice(1))if(!Bh(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}const $m={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Vh(u){if(u==null)return{filter:()=>!0,needGeometry:!1};Bh(u)||(u=jh(u));const s=Zl(u,$m);if(s.result==="error")throw new Error(s.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,p,_)=>s.value.evaluate(h,p,{},_),needGeometry:Uh(u)}}function Km(u,s){return u<s?-1:u>s?1:0}function Uh(u){if(!Array.isArray(u))return!1;if(u[0]==="within")return!0;for(let s=1;s<u.length;s++)if(Uh(u[s]))return!0;return!1}function jh(u){if(!u)return!0;const s=u[0];return u.length<=1?s!=="any":s==="=="?Op(u[1],u[2],"=="):s==="!="?Gh(Op(u[1],u[2],"==")):s==="<"||s===">"||s==="<="||s===">="?Op(u[1],u[2],s):s==="any"?(h=u.slice(1),["any"].concat(h.map(jh))):s==="all"?["all"].concat(u.slice(1).map(jh)):s==="none"?["all"].concat(u.slice(1).map(jh).map(Gh)):s==="in"?Jm(u[1],u.slice(2)):s==="!in"?Gh(Jm(u[1],u.slice(2))):s==="has"?Qm(u[1]):s==="!has"?Gh(Qm(u[1])):s!=="within"||u;var h}function Op(u,s,h){switch(u){case"$type":return[`filter-type-${h}`,s];case"$id":return[`filter-id-${h}`,s];default:return[`filter-${h}`,u,s]}}function Jm(u,s){if(s.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(h=>typeof h!=typeof s[0])?["filter-in-large",u,["literal",s.sort(Km)]]:["filter-in-small",u,["literal",s]]}}function Qm(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function Gh(u){return["!",u]}function zp(u){const s=typeof u;if(s==="number"||s==="boolean"||s==="string"||u==null)return JSON.stringify(u);if(Array.isArray(u)){let _="[";for(const x of u)_+=`${zp(x)},`;return`${_}]`}const h=Object.keys(u).sort();let p="{";for(let _=0;_<h.length;_++)p+=`${JSON.stringify(h[_])}:${zp(u[h[_]])},`;return`${p}}`}function Uy(u){let s="";for(const h of tn)s+=`/${zp(u[h])}`;return s}function eg(u){const s=u.value;return s?[new lt(u.key,s,"constants have been deprecated as of v8")]:[]}function zr(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function cl(u){if(Array.isArray(u))return u.map(cl);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const s={};for(const h in u)s[h]=cl(u[h]);return s}return zr(u)}function go(u){const s=u.key,h=u.value,p=u.valueSpec||{},_=u.objectElementValidators||{},x=u.style,w=u.styleSpec,I=u.validateSpec;let P=[];const D=Un(h);if(D!=="object")return[new lt(s,h,`object expected, ${D} found`)];for(const F in h){const V=F.split(".")[0],H=p[V]||p["*"];let Y;if(_[V])Y=_[V];else if(p[V])Y=I;else if(_["*"])Y=_["*"];else{if(!p["*"]){P.push(new lt(s,h[F],`unknown property "${F}"`));continue}Y=I}P=P.concat(Y({key:(s&&`${s}.`)+F,value:h[F],valueSpec:H,style:x,styleSpec:w,object:h,objectKey:F,validateSpec:I},h))}for(const F in p)_[F]||p[F].required&&p[F].default===void 0&&h[F]===void 0&&P.push(new lt(s,h,`missing required property "${F}"`));return P}function Fp(u){const s=u.value,h=u.valueSpec,p=u.style,_=u.styleSpec,x=u.key,w=u.arrayElementValidator||u.validateSpec;if(Un(s)!=="array")return[new lt(x,s,`array expected, ${Un(s)} found`)];if(h.length&&s.length!==h.length)return[new lt(x,s,`array length ${h.length} expected, length ${s.length} found`)];if(h["min-length"]&&s.length<h["min-length"])return[new lt(x,s,`array length at least ${h["min-length"]} expected, length ${s.length} found`)];let I={type:h.value,values:h.values};_.$version<7&&(I.function=h.function),Un(h.value)==="object"&&(I=h.value);let P=[];for(let D=0;D<s.length;D++)P=P.concat(w({array:s,arrayIndex:D,value:s[D],valueSpec:I,validateSpec:u.validateSpec,style:p,styleSpec:_,key:`${x}[${D}]`}));return P}function qh(u){const s=u.key,h=u.value,p=u.valueSpec;let _=Un(h);return _==="number"&&h!=h&&(_="NaN"),_!=="number"?[new lt(s,h,`number expected, ${_} found`)]:"minimum"in p&&h<p.minimum?[new lt(s,h,`${h} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&h>p.maximum?[new lt(s,h,`${h} is greater than the maximum value ${p.maximum}`)]:[]}function tg(u){const s=u.valueSpec,h=zr(u.value.type);let p,_,x,w={};const I=h!=="categorical"&&u.value.property===void 0,P=!I,D=Un(u.value.stops)==="array"&&Un(u.value.stops[0])==="array"&&Un(u.value.stops[0][0])==="object",F=go({key:u.key,value:u.value,valueSpec:u.styleSpec.function,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(Y){if(h==="identity")return[new lt(Y.key,Y.value,'identity function may not have a "stops" property')];let J=[];const ie=Y.value;return J=J.concat(Fp({key:Y.key,value:ie,valueSpec:Y.valueSpec,validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec,arrayElementValidator:V})),Un(ie)==="array"&&ie.length===0&&J.push(new lt(Y.key,ie,"array must have at least one stop")),J},default:function(Y){return Y.validateSpec({key:Y.key,value:Y.value,valueSpec:s,validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec})}}});return h==="identity"&&I&&F.push(new lt(u.key,u.value,'missing required property "property"')),h==="identity"||u.value.stops||F.push(new lt(u.key,u.value,'missing required property "stops"')),h==="exponential"&&u.valueSpec.expression&&!Dp(u.valueSpec)&&F.push(new lt(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(P&&!ku(u.valueSpec)?F.push(new lt(u.key,u.value,"property functions not supported")):I&&!Zm(u.valueSpec)&&F.push(new lt(u.key,u.value,"zoom functions not supported"))),h!=="categorical"&&!D||u.value.property!==void 0||F.push(new lt(u.key,u.value,'"property" property is required')),F;function V(Y){let J=[];const ie=Y.value,ge=Y.key;if(Un(ie)!=="array")return[new lt(ge,ie,`array expected, ${Un(ie)} found`)];if(ie.length!==2)return[new lt(ge,ie,`array length 2 expected, length ${ie.length} found`)];if(D){if(Un(ie[0])!=="object")return[new lt(ge,ie,`object expected, ${Un(ie[0])} found`)];if(ie[0].zoom===void 0)return[new lt(ge,ie,"object stop key must have zoom")];if(ie[0].value===void 0)return[new lt(ge,ie,"object stop key must have value")];if(x&&x>zr(ie[0].zoom))return[new lt(ge,ie[0].zoom,"stop zoom values must appear in ascending order")];zr(ie[0].zoom)!==x&&(x=zr(ie[0].zoom),_=void 0,w={}),J=J.concat(go({key:`${ge}[0]`,value:ie[0],valueSpec:{zoom:{}},validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{zoom:qh,value:H}}))}else J=J.concat(H({key:`${ge}[0]`,value:ie[0],valueSpec:{},validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec},ie));return ur(cl(ie[1]))?J.concat([new lt(`${ge}[1]`,ie[1],"expressions are not allowed in function stops.")]):J.concat(Y.validateSpec({key:`${ge}[1]`,value:ie[1],valueSpec:s,validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec}))}function H(Y,J){const ie=Un(Y.value),ge=zr(Y.value),we=Y.value!==null?Y.value:J;if(p){if(ie!==p)return[new lt(Y.key,we,`${ie} stop domain type must match previous stop domain type ${p}`)]}else p=ie;if(ie!=="number"&&ie!=="string"&&ie!=="boolean")return[new lt(Y.key,we,"stop domain value must be a number, string, or boolean")];if(ie!=="number"&&h!=="categorical"){let Ne=`number expected, ${ie} found`;return ku(s)&&h===void 0&&(Ne+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new lt(Y.key,we,Ne)]}return h!=="categorical"||ie!=="number"||isFinite(ge)&&Math.floor(ge)===ge?h!=="categorical"&&ie==="number"&&_!==void 0&&ge<_?[new lt(Y.key,we,"stop domain values must appear in ascending order")]:(_=ge,h==="categorical"&&ge in w?[new lt(Y.key,we,"stop domain values must be unique")]:(w[ge]=!0,[])):[new lt(Y.key,we,`integer expected, found ${ge}`)]}}function hl(u){const s=(u.expressionContext==="property"?Ym:Zl)(cl(u.value),u.valueSpec);if(s.result==="error")return s.value.map(p=>new lt(`${u.key}${p.key}`,u.value,p.message));const h=s.value.expression||s.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!h.outputDefined())return[new lt(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!Ic(h))return[new lt(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter"&&!Ic(h))return[new lt(u.key,u.value,'"feature-state" data expressions are not supported with filters.')];if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!Cc(h,["zoom","feature-state"]))return[new lt(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!Lh(h))return[new lt(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function fl(u){const s=u.key,h=u.value,p=u.valueSpec,_=[];return Array.isArray(p.values)?p.values.indexOf(zr(h))===-1&&_.push(new lt(s,h,`expected one of [${p.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(p.values).indexOf(zr(h))===-1&&_.push(new lt(s,h,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(h)} found`)),_}function Au(u){return Bh(cl(u.value))?hl(hs({},u,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Bp(u)}function Bp(u){const s=u.value,h=u.key;if(Un(s)!=="array")return[new lt(h,s,`array expected, ${Un(s)} found`)];const p=u.styleSpec;let _,x=[];if(s.length<1)return[new lt(h,s,"filter array must have at least 1 element")];switch(x=x.concat(fl({key:`${h}[0]`,value:s[0],valueSpec:p.filter_operator,style:u.style,styleSpec:u.styleSpec})),zr(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&zr(s[1])==="$type"&&x.push(new lt(h,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&x.push(new lt(h,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(_=Un(s[1]),_!=="string"&&x.push(new lt(`${h}[1]`,s[1],`string expected, ${_} found`)));for(let w=2;w<s.length;w++)_=Un(s[w]),zr(s[1])==="$type"?x=x.concat(fl({key:`${h}[${w}]`,value:s[w],valueSpec:p.geometry_type,style:u.style,styleSpec:u.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&x.push(new lt(`${h}[${w}]`,s[w],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let w=1;w<s.length;w++)x=x.concat(Bp({key:`${h}[${w}]`,value:s[w],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":_=Un(s[1]),s.length!==2?x.push(new lt(h,s,`filter array for "${s[0]}" operator must have 2 elements`)):_!=="string"&&x.push(new lt(`${h}[1]`,s[1],`string expected, ${_} found`));break;case"within":_=Un(s[1]),s.length!==2?x.push(new lt(h,s,`filter array for "${s[0]}" operator must have 2 elements`)):_!=="object"&&x.push(new lt(`${h}[1]`,s[1],`object expected, ${_} found`))}return x}function Wh(u,s){const h=u.key,p=u.validateSpec,_=u.style,x=u.styleSpec,w=u.value,I=u.objectKey,P=x[`${s}_${u.layerType}`];if(!P)return[];const D=I.match(/^(.*)-transition$/);if(s==="paint"&&D&&P[D[1]]&&P[D[1]].transition)return p({key:h,value:w,valueSpec:x.transition,style:_,styleSpec:x});const F=u.valueSpec||P[I];if(!F)return[new lt(h,w,`unknown property "${I}"`)];let V;if(Un(w)==="string"&&ku(F)&&!F.tokens&&(V=/^{([^}]+)}$/.exec(w)))return[new lt(h,w,`"${I}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(V[1])} }\`.`)];const H=[];return u.layerType==="symbol"&&(I==="text-field"&&_&&!_.glyphs&&H.push(new lt(h,w,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&Nh(cl(w))&&zr(w.type)==="identity"&&H.push(new lt(h,w,'"text-font" does not support identity functions'))),H.concat(p({key:u.key,value:w,valueSpec:F,style:_,styleSpec:x,expressionContext:"property",propertyType:s,propertyKey:I}))}function Vp(u){return Wh(u,"paint")}function Up(u){return Wh(u,"layout")}function Mc(u){let s=[];const h=u.value,p=u.key,_=u.style,x=u.styleSpec;h.type||h.ref||s.push(new lt(p,h,'either "type" or "ref" is required'));let w=zr(h.type);const I=zr(h.ref);if(h.id){const P=zr(h.id);for(let D=0;D<u.arrayIndex;D++){const F=_.layers[D];zr(F.id)===P&&s.push(new lt(p,h.id,`duplicate layer id "${h.id}", previously used at line ${F.id.__line__}`))}}if("ref"in h){let P;["type","source","source-layer","filter","layout"].forEach(D=>{D in h&&s.push(new lt(p,h[D],`"${D}" is prohibited for ref layers`))}),_.layers.forEach(D=>{zr(D.id)===I&&(P=D)}),P?P.ref?s.push(new lt(p,h.ref,"ref cannot reference another ref layer")):w=zr(P.type):s.push(new lt(p,h.ref,`ref layer "${I}" not found`))}else if(w!=="background")if(h.source){const P=_.sources&&_.sources[h.source],D=P&&zr(P.type);P?D==="vector"&&w==="raster"?s.push(new lt(p,h.source,`layer "${h.id}" requires a raster source`)):D!=="raster-dem"&&w==="hillshade"?s.push(new lt(p,h.source,`layer "${h.id}" requires a raster-dem source`)):D==="raster"&&w!=="raster"?s.push(new lt(p,h.source,`layer "${h.id}" requires a vector source`)):D!=="vector"||h["source-layer"]?D==="raster-dem"&&w!=="hillshade"?s.push(new lt(p,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):w!=="line"||!h.paint||!h.paint["line-gradient"]||D==="geojson"&&P.lineMetrics||s.push(new lt(p,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new lt(p,h,`layer "${h.id}" must specify a "source-layer"`)):s.push(new lt(p,h.source,`source "${h.source}" not found`))}else s.push(new lt(p,h,'missing required property "source"'));return s=s.concat(go({key:p,value:h,valueSpec:x.layer,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*":()=>[],type:()=>u.validateSpec({key:`${p}.type`,value:h.type,valueSpec:x.layer.type,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,object:h,objectKey:"type"}),filter:Au,layout:P=>go({layer:h,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":D=>Up(hs({layerType:w},D))}}),paint:P=>go({layer:h,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":D=>Vp(hs({layerType:w},D))}})}})),s}function Xl(u){const s=u.value,h=u.key,p=Un(s);return p!=="string"?[new lt(h,s,`string expected, ${p} found`)]:[]}const ng={promoteId:function({key:u,value:s}){if(Un(s)==="string")return Xl({key:u,value:s});{const h=[];for(const p in s)h.push(...Xl({key:`${u}.${p}`,value:s[p]}));return h}}};function rg(u){const s=u.value,h=u.key,p=u.styleSpec,_=u.style,x=u.validateSpec;if(!s.type)return[new lt(h,s,'"type" is required')];const w=zr(s.type);let I;switch(w){case"vector":case"raster":return I=go({key:h,value:s,valueSpec:p[`source_${w.replace("-","_")}`],style:u.style,styleSpec:p,objectElementValidators:ng,validateSpec:x}),I;case"raster-dem":return I=function(P){var D;const F=(D=P.sourceName)!==null&&D!==void 0?D:"",V=P.value,H=P.styleSpec,Y=H.source_raster_dem,J=P.style;let ie=[];const ge=Un(V);if(V===void 0)return ie;if(ge!=="object")return ie.push(new lt("source_raster_dem",V,`object expected, ${ge} found`)),ie;const we=zr(V.encoding)==="custom",Ne=["redFactor","greenFactor","blueFactor","baseShift"],Ee=P.value.encoding?`"${P.value.encoding}"`:"Default";for(const Ae in V)!we&&Ne.includes(Ae)?ie.push(new lt(Ae,V[Ae],`In "${F}": "${Ae}" is only valid when "encoding" is set to "custom". ${Ee} encoding found`)):Y[Ae]?ie=ie.concat(P.validateSpec({key:Ae,value:V[Ae],valueSpec:Y[Ae],validateSpec:P.validateSpec,style:J,styleSpec:H})):ie.push(new lt(Ae,V[Ae],`unknown property "${Ae}"`));return ie}({sourceName:h,value:s,style:u.style,styleSpec:p,validateSpec:x}),I;case"geojson":if(I=go({key:h,value:s,valueSpec:p.source_geojson,style:_,styleSpec:p,validateSpec:x,objectElementValidators:ng}),s.cluster)for(const P in s.clusterProperties){const[D,F]=s.clusterProperties[P],V=typeof D=="string"?[D,["accumulated"],["get",P]]:D;I.push(...hl({key:`${h}.${P}.map`,value:F,validateSpec:x,expressionContext:"cluster-map"})),I.push(...hl({key:`${h}.${P}.reduce`,value:V,validateSpec:x,expressionContext:"cluster-reduce"}))}return I;case"video":return go({key:h,value:s,valueSpec:p.source_video,style:_,validateSpec:x,styleSpec:p});case"image":return go({key:h,value:s,valueSpec:p.source_image,style:_,validateSpec:x,styleSpec:p});case"canvas":return[new lt(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return fl({key:`${h}.type`,value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,validateSpec:x,styleSpec:p})}}function ig(u){const s=u.value,h=u.styleSpec,p=h.light,_=u.style;let x=[];const w=Un(s);if(s===void 0)return x;if(w!=="object")return x=x.concat([new lt("light",s,`object expected, ${w} found`)]),x;for(const I in s){const P=I.match(/^(.*)-transition$/);x=x.concat(P&&p[P[1]]&&p[P[1]].transition?u.validateSpec({key:I,value:s[I],valueSpec:h.transition,validateSpec:u.validateSpec,style:_,styleSpec:h}):p[I]?u.validateSpec({key:I,value:s[I],valueSpec:p[I],validateSpec:u.validateSpec,style:_,styleSpec:h}):[new lt(I,s[I],`unknown property "${I}"`)])}return x}function og(u){const s=u.value,h=u.styleSpec,p=h.sky,_=u.style,x=Un(s);if(s===void 0)return[];if(x!=="object")return[new lt("sky",s,`object expected, ${x} found`)];let w=[];for(const I in s)w=w.concat(p[I]?ta({key:I,value:s[I],valueSpec:p[I],style:_,styleSpec:h}):[new lt(I,s[I],`unknown property "${I}"`)]);return w}function kc(u){const s=u.value,h=u.styleSpec,p=h.terrain,_=u.style;let x=[];const w=Un(s);if(s===void 0)return x;if(w!=="object")return x=x.concat([new lt("terrain",s,`object expected, ${w} found`)]),x;for(const I in s)x=x.concat(p[I]?u.validateSpec({key:I,value:s[I],valueSpec:p[I],validateSpec:u.validateSpec,style:_,styleSpec:h}):[new lt(I,s[I],`unknown property "${I}"`)]);return x}function Ac(u){let s=[];const h=u.value,p=u.key;if(Array.isArray(h)){const _=[],x=[];for(const w in h)h[w].id&&_.includes(h[w].id)&&s.push(new lt(p,h,`all the sprites' ids must be unique, but ${h[w].id} is duplicated`)),_.push(h[w].id),h[w].url&&x.includes(h[w].url)&&s.push(new lt(p,h,`all the sprites' URLs must be unique, but ${h[w].url} is duplicated`)),x.push(h[w].url),s=s.concat(go({key:`${p}[${w}]`,value:h[w],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:u.validateSpec}));return s}return Xl({key:p,value:h})}const Po={"*":()=>[],array:Fp,boolean:function(u){const s=u.value,h=u.key,p=Un(s);return p!=="boolean"?[new lt(h,s,`boolean expected, ${p} found`)]:[]},number:qh,color:function(u){const s=u.key,h=u.value,p=Un(h);return p!=="string"?[new lt(s,h,`color expected, ${p} found`)]:Qn.parse(String(h))?[]:[new lt(s,h,`color expected, "${h}" found`)]},constants:eg,enum:fl,filter:Au,function:tg,layer:Mc,object:go,source:rg,light:ig,sky:og,terrain:kc,string:Xl,formatted:function(u){return Xl(u).length===0?[]:hl(u)},resolvedImage:function(u){return Xl(u).length===0?[]:hl(u)},padding:function(u){const s=u.key,h=u.value;if(Un(h)==="array"){if(h.length<1||h.length>4)return[new lt(s,h,`padding requires 1 to 4 values; ${h.length} values found`)];const p={type:"number"};let _=[];for(let x=0;x<h.length;x++)_=_.concat(u.validateSpec({key:`${s}[${x}]`,value:h[x],validateSpec:u.validateSpec,valueSpec:p}));return _}return qh({key:s,value:h,valueSpec:{}})},variableAnchorOffsetCollection:function(u){const s=u.key,h=u.value,p=Un(h),_=u.styleSpec;if(p!=="array"||h.length<1||h.length%2!=0)return[new lt(s,h,"variableAnchorOffsetCollection requires a non-empty array of even length")];let x=[];for(let w=0;w<h.length;w+=2)x=x.concat(fl({key:`${s}[${w}]`,value:h[w],valueSpec:_.layout_symbol["text-anchor"]})),x=x.concat(Fp({key:`${s}[${w+1}]`,value:h[w+1],valueSpec:{length:2,value:"number"},validateSpec:u.validateSpec,style:u.style,styleSpec:_}));return x},sprite:Ac};function ta(u){const s=u.value,h=u.valueSpec,p=u.styleSpec;return u.validateSpec=ta,h.expression&&Nh(zr(s))?tg(u):h.expression&&ur(cl(s))?hl(u):h.type&&Po[h.type]?Po[h.type](u):go(hs({},u,{valueSpec:h.type?p[h.type]:h}))}function jp(u){const s=u.value,h=u.key,p=Xl(u);return p.length||(s.indexOf("{fontstack}")===-1&&p.push(new lt(h,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&p.push(new lt(h,s,'"glyphs" url must include a "{range}" token'))),p}function Ms(u,s=me){let h=[];return h=h.concat(ta({key:"",value:u,valueSpec:s.$root,styleSpec:s,style:u,validateSpec:ta,objectElementValidators:{glyphs:jp,"*":()=>[]}})),u.constants&&(h=h.concat(eg({key:"constants",value:u.constants,style:u,styleSpec:s,validateSpec:ta}))),Du(h)}function na(u){return function(s){return u({...s,validateSpec:ta})}}function Du(u){return[].concat(u).sort((s,h)=>s.line-h.line)}function ks(u){return function(...s){return Du(u.apply(this,s))}}Ms.source=ks(na(rg)),Ms.sprite=ks(na(Ac)),Ms.glyphs=ks(na(jp)),Ms.light=ks(na(ig)),Ms.sky=ks(na(og)),Ms.terrain=ks(na(kc)),Ms.layer=ks(na(Mc)),Ms.filter=ks(na(Au)),Ms.paintProperty=ks(na(Vp)),Ms.layoutProperty=ks(na(Up));const Yl=Ms,jy=Yl.light,Gp=Yl.paintProperty,Gy=Yl.layoutProperty;function Ru(u,s){let h=!1;if(s&&s.length)for(const p of s)u.fire(new gt(new Error(p.message))),h=!0;return h}class Dc{constructor(s,h,p){const _=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;const w=new Int32Array(this.arrayBuffer);s=w[0],this.d=(h=w[1])+2*(p=w[2]);for(let P=0;P<this.d*this.d;P++){const D=w[3+P],F=w[3+P+1];_.push(D===F?null:w.subarray(D,F))}const I=w[3+_.length+1];this.keys=w.subarray(w[3+_.length],I),this.bboxes=w.subarray(I),this.insert=this._insertReadonly}else{this.d=h+2*p;for(let w=0;w<this.d*this.d;w++)_.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=s,this.padding=p,this.scale=h/s,this.uid=0;const x=p/h*s;this.min=-x,this.max=s+x}insert(s,h,p,_,x){this._forEachCell(h,p,_,x,this._insertCell,this.uid++,void 0,void 0),this.keys.push(s),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(x)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(s,h,p,_,x,w){this.cells[x].push(w)}query(s,h,p,_,x){const w=this.min,I=this.max;if(s<=w&&h<=w&&I<=p&&I<=_&&!x)return Array.prototype.slice.call(this.keys);{const P=[];return this._forEachCell(s,h,p,_,this._queryCell,P,{},x),P}}_queryCell(s,h,p,_,x,w,I,P){const D=this.cells[x];if(D!==null){const F=this.keys,V=this.bboxes;for(let H=0;H<D.length;H++){const Y=D[H];if(I[Y]===void 0){const J=4*Y;(P?P(V[J+0],V[J+1],V[J+2],V[J+3]):s<=V[J+2]&&h<=V[J+3]&&p>=V[J+0]&&_>=V[J+1])?(I[Y]=!0,w.push(F[Y])):I[Y]=!1}}}}_forEachCell(s,h,p,_,x,w,I,P){const D=this._convertToCellCoord(s),F=this._convertToCellCoord(h),V=this._convertToCellCoord(p),H=this._convertToCellCoord(_);for(let Y=D;Y<=V;Y++)for(let J=F;J<=H;J++){const ie=this.d*J+Y;if((!P||P(this._convertFromCellCoord(Y),this._convertFromCellCoord(J),this._convertFromCellCoord(Y+1),this._convertFromCellCoord(J+1)))&&x.call(this,s,h,p,_,ie,w,I,P))return}}_convertFromCellCoord(s){return(s-this.padding)/this.scale}_convertToCellCoord(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const s=this.cells,h=3+this.cells.length+1+1;let p=0;for(let w=0;w<this.cells.length;w++)p+=this.cells[w].length;const _=new Int32Array(h+p+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;let x=h;for(let w=0;w<s.length;w++){const I=s[w];_[3+w]=x,_.set(I,x),x+=I.length}return _[3+s.length]=x,_.set(this.keys,x),x+=this.keys.length,_[3+s.length+1]=x,_.set(this.bboxes,x),x+=this.bboxes.length,_.buffer}static serialize(s,h){const p=s.toArrayBuffer();return h&&h.push(p),{buffer:p}}static deserialize(s){return new Dc(s.buffer)}}const ra={};function Pt(u,s,h={}){if(ra[u])throw new Error(`${u} is already registered.`);Object.defineProperty(s,"_classRegistryKey",{value:u,writeable:!1}),ra[u]={klass:s,omit:h.omit||[],shallow:h.shallow||[]}}Pt("Object",Object),Pt("TransferableGridIndex",Dc),Pt("Color",Qn),Pt("Error",Error),Pt("AJAXError",In),Pt("ResolvedImage",ds),Pt("StylePropertyFunction",zh),Pt("StyleExpression",br,{omit:["_evaluator"]}),Pt("ZoomDependentExpression",Np),Pt("ZoomConstantExpression",Oh),Pt("CompoundExpression",Zo,{omit:["_evaluate"]});for(const u in Pu)Pu[u]._classRegistryKey||Pt(`Expression_${u}`,Pu[u]);function Hh(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function Nu(u,s){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error)return u;if(Hh(u)||Ke(u))return s&&s.push(u),u;if(ArrayBuffer.isView(u)){const h=u;return s&&s.push(h.buffer),h}if(u instanceof ImageData)return s&&s.push(u.data.buffer),u;if(Array.isArray(u)){const h=[];for(const p of u)h.push(Nu(p,s));return h}if(typeof u=="object"){const h=u.constructor,p=h._classRegistryKey;if(!p)throw new Error(`can't serialize object of unregistered class ${h.name}`);if(!ra[p])throw new Error(`${p} is not registered.`);const _=h.serialize?h.serialize(u,s):{};if(h.serialize){if(s&&_===s[s.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const x in u){if(!u.hasOwnProperty(x)||ra[p].omit.indexOf(x)>=0)continue;const w=u[x];_[x]=ra[p].shallow.indexOf(x)>=0?w:Nu(w,s)}u instanceof Error&&(_.message=u.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return p!=="Object"&&(_.$name=p),_}throw new Error("can't serialize object of type "+typeof u)}function Ou(u){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error||Hh(u)||Ke(u)||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(Ou);if(typeof u=="object"){const s=u.$name||"Object";if(!ra[s])throw new Error(`can't deserialize unregistered class ${s}`);const{klass:h}=ra[s];if(!h)throw new Error(`can't deserialize unregistered class ${s}`);if(h.deserialize)return h.deserialize(u);const p=Object.create(h.prototype);for(const _ of Object.keys(u)){if(_==="$name")continue;const x=u[_];p[_]=ra[s].shallow.indexOf(_)>=0?x:Ou(x)}return p}throw new Error("can't deserialize object of type "+typeof u)}class sg{constructor(){this.first=!0}update(s,h){const p=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=h),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=p,!0))}}const Et={"Latin-1 Supplement":u=>u>=128&&u<=255,Arabic:u=>u>=1536&&u<=1791,"Arabic Supplement":u=>u>=1872&&u<=1919,"Arabic Extended-A":u=>u>=2208&&u<=2303,"Hangul Jamo":u=>u>=4352&&u<=4607,"Unified Canadian Aboriginal Syllabics":u=>u>=5120&&u<=5759,Khmer:u=>u>=6016&&u<=6143,"Unified Canadian Aboriginal Syllabics Extended":u=>u>=6320&&u<=6399,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"CJK Radicals Supplement":u=>u>=11904&&u<=12031,"Kangxi Radicals":u=>u>=12032&&u<=12255,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Bopomofo:u=>u>=12544&&u<=12591,"Hangul Compatibility Jamo":u=>u>=12592&&u<=12687,Kanbun:u=>u>=12688&&u<=12703,"Bopomofo Extended":u=>u>=12704&&u<=12735,"CJK Strokes":u=>u>=12736&&u<=12783,"Katakana Phonetic Extensions":u=>u>=12784&&u<=12799,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"CJK Unified Ideographs Extension A":u=>u>=13312&&u<=19903,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Yi Syllables":u=>u>=40960&&u<=42127,"Yi Radicals":u=>u>=42128&&u<=42191,"Hangul Jamo Extended-A":u=>u>=43360&&u<=43391,"Hangul Syllables":u=>u>=44032&&u<=55215,"Hangul Jamo Extended-B":u=>u>=55216&&u<=55295,"Private Use Area":u=>u>=57344&&u<=63743,"CJK Compatibility Ideographs":u=>u>=63744&&u<=64255,"Arabic Presentation Forms-A":u=>u>=64336&&u<=65023,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Arabic Presentation Forms-B":u=>u>=65136&&u<=65279,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519};function zu(u){for(const s of u)if(Zh(s.charCodeAt(0)))return!0;return!1}function ag(u){for(const s of u)if(!lg(s.charCodeAt(0)))return!1;return!0}function lg(u){return!(Et.Arabic(u)||Et["Arabic Supplement"](u)||Et["Arabic Extended-A"](u)||Et["Arabic Presentation Forms-A"](u)||Et["Arabic Presentation Forms-B"](u))}function Zh(u){return!(u!==746&&u!==747&&(u<4352||!(Et["Bopomofo Extended"](u)||Et.Bopomofo(u)||Et["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||Et["CJK Compatibility Ideographs"](u)||Et["CJK Compatibility"](u)||Et["CJK Radicals Supplement"](u)||Et["CJK Strokes"](u)||!(!Et["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||Et["CJK Unified Ideographs Extension A"](u)||Et["CJK Unified Ideographs"](u)||Et["Enclosed CJK Letters and Months"](u)||Et["Hangul Compatibility Jamo"](u)||Et["Hangul Jamo Extended-A"](u)||Et["Hangul Jamo Extended-B"](u)||Et["Hangul Jamo"](u)||Et["Hangul Syllables"](u)||Et.Hiragana(u)||Et["Ideographic Description Characters"](u)||Et.Kanbun(u)||Et["Kangxi Radicals"](u)||Et["Katakana Phonetic Extensions"](u)||Et.Katakana(u)&&u!==12540||!(!Et["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!Et["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||Et["Unified Canadian Aboriginal Syllabics"](u)||Et["Unified Canadian Aboriginal Syllabics Extended"](u)||Et["Vertical Forms"](u)||Et["Yijing Hexagram Symbols"](u)||Et["Yi Syllables"](u)||Et["Yi Radicals"](u))))}function qp(u){return!(Zh(u)||function(s){return!!(Et["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||Et["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||Et["Letterlike Symbols"](s)||Et["Number Forms"](s)||Et["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||Et["Control Pictures"](s)&&s!==9251||Et["Optical Character Recognition"](s)||Et["Enclosed Alphanumerics"](s)||Et["Geometric Shapes"](s)||Et["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||Et["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||Et["CJK Symbols and Punctuation"](s)||Et.Katakana(s)||Et["Private Use Area"](s)||Et["CJK Compatibility Forms"](s)||Et["Small Form Variants"](s)||Et["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(u))}function Xh(u){return u>=1424&&u<=2303||Et["Arabic Presentation Forms-A"](u)||Et["Arabic Presentation Forms-B"](u)}function ug(u,s){return!(!s&&Xh(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||Et.Khmer(u))}function qy(u){for(const s of u)if(Xh(s.charCodeAt(0)))return!0;return!1}const pl=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(u){this.pluginStatus=u.pluginStatus,this.pluginURL=u.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(u){this.applyArabicShaping=u.applyArabicShaping,this.processBidirectionalText=u.processBidirectionalText,this.processStyledBidirectionalText=u.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Er{constructor(s,h){this.zoom=s,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new sg,this.transition={})}isSupportedScript(s){return function(h,p){for(const _ of h)if(!ug(_.charCodeAt(0),p))return!1;return!0}(s,pl.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const s=this.zoom,h=s-Math.floor(s),p=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*h}}}class Rc{constructor(s,h){this.property=s,this.value=h,this.expression=function(p,_){if(Nh(p))return new zh(p,_);if(ur(p)){const x=Ym(p,_);if(x.result==="error")throw new Error(x.value.map(w=>`${w.key}: ${w.message}`).join(", "));return x.value}{let x=p;return _.type==="color"&&typeof p=="string"?x=Qn.parse(p):_.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?_.type==="variableAnchorOffsetCollection"&&Array.isArray(p)&&(x=ps.parse(p)):x=Lo.parse(p),{kind:"constant",evaluate:()=>x}}}(h===void 0?s.specification.default:h,s.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(s,h,p){return this.property.possiblyEvaluate(this,s,h,p)}}class Yh{constructor(s){this.property=s,this.value=new Rc(s,void 0)}transitioned(s,h){return new cg(this.property,this.value,h,ae({},s.transition,this.transition),s.now)}untransitioned(){return new cg(this.property,this.value,null,{},0)}}class Wp{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues)}getValue(s){return K(this._values[s].value.value)}setValue(s,h){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new Yh(this._values[s].property)),this._values[s].value=new Rc(this._values[s].property,h===null?void 0:K(h))}getTransition(s){return K(this._values[s].transition)}setTransition(s,h){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new Yh(this._values[s].property)),this._values[s].transition=K(h)||void 0}serialize(){const s={};for(const h of Object.keys(this._values)){const p=this.getValue(h);p!==void 0&&(s[h]=p);const _=this.getTransition(h);_!==void 0&&(s[`${h}-transition`]=_)}return s}transitioned(s,h){const p=new hg(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].transitioned(s,h._values[_]);return p}untransitioned(){const s=new hg(this._properties);for(const h of Object.keys(this._values))s._values[h]=this._values[h].untransitioned();return s}}class cg{constructor(s,h,p,_,x){this.property=s,this.value=h,this.begin=x+_.delay||0,this.end=this.begin+_.duration||0,s.specification.transition&&(_.delay||_.duration)&&(this.prior=p)}possiblyEvaluate(s,h,p){const _=s.now||0,x=this.value.possiblyEvaluate(s,h,p),w=this.prior;if(w){if(_>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(_<this.begin)return w.possiblyEvaluate(s,h,p);{const I=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(s,h,p),x,function(P){if(P<=0)return 0;if(P>=1)return 1;const D=P*P,F=D*P;return 4*(P<.5?F:3*(P-D)+F-.75)}(I))}}return x}}class hg{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,h,p){const _=new Nc(this._properties);for(const x of Object.keys(this._values))_._values[x]=this._values[x].possiblyEvaluate(s,h,p);return _}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class fg{constructor(s){this._properties=s,this._values=Object.create(s.defaultPropertyValues)}hasValue(s){return this._values[s].value!==void 0}getValue(s){return K(this._values[s].value)}setValue(s,h){this._values[s]=new Rc(this._values[s].property,h===null?void 0:K(h))}serialize(){const s={};for(const h of Object.keys(this._values)){const p=this.getValue(h);p!==void 0&&(s[h]=p)}return s}possiblyEvaluate(s,h,p){const _=new Nc(this._properties);for(const x of Object.keys(this._values))_._values[x]=this._values[x].possiblyEvaluate(s,h,p);return _}}class As{constructor(s,h,p){this.property=s,this.value=h,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,h,p,_){return this.property.evaluate(this.value,this.parameters,s,h,p,_)}}class Nc{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class jt{constructor(s){this.specification=s}possiblyEvaluate(s,h){if(s.isDataDriven())throw new Error("Value should not be data driven");return s.expression.evaluate(h)}interpolate(s,h,p){const _=mo[this.specification.type];return _?_(s,h,p):s}}class $t{constructor(s,h){this.specification=s,this.overrides=h}possiblyEvaluate(s,h,p,_){return new As(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(h,null,{},p,_)}:s.expression,h)}interpolate(s,h,p){if(s.value.kind!=="constant"||h.value.kind!=="constant")return s;if(s.value.value===void 0||h.value.value===void 0)return new As(this,{kind:"constant",value:void 0},s.parameters);const _=mo[this.specification.type];if(_){const x=_(s.value.value,h.value.value,p);return new As(this,{kind:"constant",value:x},s.parameters)}return s}evaluate(s,h,p,_,x,w){return s.kind==="constant"?s.value:s.evaluate(h,p,_,x,w)}}class $h extends $t{possiblyEvaluate(s,h,p,_){if(s.value===void 0)return new As(this,{kind:"constant",value:void 0},h);if(s.expression.kind==="constant"){const x=s.expression.evaluate(h,null,{},p,_),w=s.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,I=this._calculate(w,w,w,h);return new As(this,{kind:"constant",value:I},h)}if(s.expression.kind==="camera"){const x=this._calculate(s.expression.evaluate({zoom:h.zoom-1}),s.expression.evaluate({zoom:h.zoom}),s.expression.evaluate({zoom:h.zoom+1}),h);return new As(this,{kind:"constant",value:x},h)}return new As(this,s.expression,h)}evaluate(s,h,p,_,x,w){if(s.kind==="source"){const I=s.evaluate(h,p,_,x,w);return this._calculate(I,I,I,h)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(h.zoom)-1},p,_),s.evaluate({zoom:Math.floor(h.zoom)},p,_),s.evaluate({zoom:Math.floor(h.zoom)+1},p,_),h):s.value}_calculate(s,h,p,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:s,to:h}:{from:p,to:h}}interpolate(s){return s}}class Oc{constructor(s){this.specification=s}possiblyEvaluate(s,h,p,_){if(s.value!==void 0){if(s.expression.kind==="constant"){const x=s.expression.evaluate(h,null,{},p,_);return this._calculate(x,x,x,h)}return this._calculate(s.expression.evaluate(new Er(Math.floor(h.zoom-1),h)),s.expression.evaluate(new Er(Math.floor(h.zoom),h)),s.expression.evaluate(new Er(Math.floor(h.zoom+1),h)),h)}}_calculate(s,h,p,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:s,to:h}:{from:p,to:h}}interpolate(s){return s}}class Hp{constructor(s){this.specification=s}possiblyEvaluate(s,h,p,_){return!!s.expression.evaluate(h,null,{},p,_)}interpolate(){return!1}}class Mo{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in s){const p=s[h];p.specification.overridable&&this.overridableProperties.push(h);const _=this.defaultPropertyValues[h]=new Rc(p,void 0),x=this.defaultTransitionablePropertyValues[h]=new Yh(p);this.defaultTransitioningPropertyValues[h]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=_.possiblyEvaluate({})}}}Pt("DataDrivenProperty",$t),Pt("DataConstantProperty",jt),Pt("CrossFadedDataDrivenProperty",$h),Pt("CrossFadedProperty",Oc),Pt("ColorRampProperty",Hp);const Zp="-transition";class Ds extends Nt{constructor(s,h){if(super(),this.id=s.id,this.type=s.type,this._featureFilter={filter:()=>!0,needGeometry:!1},s.type!=="custom"&&(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),h.layout&&(this._unevaluatedLayout=new fg(h.layout)),h.paint)){this._transitionablePaint=new Wp(h.paint);for(const p in s.paint)this.setPaintProperty(p,s.paint[p],{validate:!1});for(const p in s.layout)this.setLayoutProperty(p,s.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Nc(h.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}setLayoutProperty(s,h,p={}){h!=null&&this._validate(Gy,`layers.${this.id}.layout.${s}`,s,h,p)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,h):this.visibility=h)}getPaintProperty(s){return s.endsWith(Zp)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}setPaintProperty(s,h,p={}){if(h!=null&&this._validate(Gp,`layers.${this.id}.paint.${s}`,s,h,p))return!1;if(s.endsWith(Zp))return this._transitionablePaint.setTransition(s.slice(0,-11),h||void 0),!1;{const _=this._transitionablePaint._values[s],x=_.property.specification["property-type"]==="cross-faded-data-driven",w=_.value.isDataDriven(),I=_.value;this._transitionablePaint.setValue(s,h),this._handleSpecialPaintPropertyUpdate(s);const P=this._transitionablePaint._values[s].value;return P.isDataDriven()||w||x||this._handleOverridablePaintPropertyUpdate(s,I,P)}}_handleSpecialPaintPropertyUpdate(s){}_handleOverridablePaintPropertyUpdate(s,h,p){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,h){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,h)}serialize(){const s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),ke(s,(h,p)=>!(h===void 0||p==="layout"&&!Object.keys(h).length||p==="paint"&&!Object.keys(h).length))}_validate(s,h,p,_,x={}){return(!x||x.validate!==!1)&&Ru(this,s.call(Yl,{key:h,layerType:this.type,objectKey:p,value:_,styleSpec:me,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const s in this.paint._values){const h=this.paint.get(s);if(h instanceof As&&ku(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}}const pg={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class zc{constructor(s,h){this._structArray=s,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Fr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(s,h){return s._trim(),h&&(s.isTransferred=!0,h.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const h=Object.create(this.prototype);return h.arrayBuffer=s.arrayBuffer,h.length=s.length,h.capacity=s.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ei(u,s=1){let h=0,p=0;return{members:u.map(_=>{const x=pg[_.type].BYTES_PER_ELEMENT,w=h=dg(h,Math.max(s,x)),I=_.components||1;return p=Math.max(p,x),h+=x*I,{name:_.name,type:_.type,components:I,offset:w}}),size:dg(h,Math.max(p,s)),alignment:s}}function dg(u,s){return Math.ceil(u/s)*s}class Fc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h){const p=this.length;return this.resize(p+1),this.emplace(p,s,h)}emplace(s,h,p){const _=2*s;return this.int16[_+0]=h,this.int16[_+1]=p,s}}Fc.prototype.bytesPerElement=4,Pt("StructArrayLayout2i4",Fc);class Fa extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,s,h,p)}emplace(s,h,p,_){const x=3*s;return this.int16[x+0]=h,this.int16[x+1]=p,this.int16[x+2]=_,s}}Fa.prototype.bytesPerElement=6,Pt("StructArrayLayout3i6",Fa);class Xp extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,p,_){const x=this.length;return this.resize(x+1),this.emplace(x,s,h,p,_)}emplace(s,h,p,_,x){const w=4*s;return this.int16[w+0]=h,this.int16[w+1]=p,this.int16[w+2]=_,this.int16[w+3]=x,s}}Xp.prototype.bytesPerElement=8,Pt("StructArrayLayout4i8",Xp);class Yp extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,p,_,x,w){const I=this.length;return this.resize(I+1),this.emplace(I,s,h,p,_,x,w)}emplace(s,h,p,_,x,w,I){const P=6*s;return this.int16[P+0]=h,this.int16[P+1]=p,this.int16[P+2]=_,this.int16[P+3]=x,this.int16[P+4]=w,this.int16[P+5]=I,s}}Yp.prototype.bytesPerElement=12,Pt("StructArrayLayout2i4i12",Yp);class $p extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,p,_,x,w){const I=this.length;return this.resize(I+1),this.emplace(I,s,h,p,_,x,w)}emplace(s,h,p,_,x,w,I){const P=4*s,D=8*s;return this.int16[P+0]=h,this.int16[P+1]=p,this.uint8[D+4]=_,this.uint8[D+5]=x,this.uint8[D+6]=w,this.uint8[D+7]=I,s}}$p.prototype.bytesPerElement=8,Pt("StructArrayLayout2i4ub8",$p);class Bc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h){const p=this.length;return this.resize(p+1),this.emplace(p,s,h)}emplace(s,h,p){const _=2*s;return this.float32[_+0]=h,this.float32[_+1]=p,s}}Bc.prototype.bytesPerElement=8,Pt("StructArrayLayout2f8",Bc);class Kh extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,p,_,x,w,I,P,D,F){const V=this.length;return this.resize(V+1),this.emplace(V,s,h,p,_,x,w,I,P,D,F)}emplace(s,h,p,_,x,w,I,P,D,F,V){const H=10*s;return this.uint16[H+0]=h,this.uint16[H+1]=p,this.uint16[H+2]=_,this.uint16[H+3]=x,this.uint16[H+4]=w,this.uint16[H+5]=I,this.uint16[H+6]=P,this.uint16[H+7]=D,this.uint16[H+8]=F,this.uint16[H+9]=V,s}}Kh.prototype.bytesPerElement=20,Pt("StructArrayLayout10ui20",Kh);class Kp extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,p,_,x,w,I,P,D,F,V,H){const Y=this.length;return this.resize(Y+1),this.emplace(Y,s,h,p,_,x,w,I,P,D,F,V,H)}emplace(s,h,p,_,x,w,I,P,D,F,V,H,Y){const J=12*s;return this.int16[J+0]=h,this.int16[J+1]=p,this.int16[J+2]=_,this.int16[J+3]=x,this.uint16[J+4]=w,this.uint16[J+5]=I,this.uint16[J+6]=P,this.uint16[J+7]=D,this.int16[J+8]=F,this.int16[J+9]=V,this.int16[J+10]=H,this.int16[J+11]=Y,s}}Kp.prototype.bytesPerElement=24,Pt("StructArrayLayout4i4ui4i24",Kp);class Jp extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,s,h,p)}emplace(s,h,p,_){const x=3*s;return this.float32[x+0]=h,this.float32[x+1]=p,this.float32[x+2]=_,s}}Jp.prototype.bytesPerElement=12,Pt("StructArrayLayout3f12",Jp);class Ba extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const h=this.length;return this.resize(h+1),this.emplace(h,s)}emplace(s,h){return this.uint32[1*s+0]=h,s}}Ba.prototype.bytesPerElement=4,Pt("StructArrayLayout1ul4",Ba);class Jh extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,p,_,x,w,I,P,D){const F=this.length;return this.resize(F+1),this.emplace(F,s,h,p,_,x,w,I,P,D)}emplace(s,h,p,_,x,w,I,P,D,F){const V=10*s,H=5*s;return this.int16[V+0]=h,this.int16[V+1]=p,this.int16[V+2]=_,this.int16[V+3]=x,this.int16[V+4]=w,this.int16[V+5]=I,this.uint32[H+3]=P,this.uint16[V+8]=D,this.uint16[V+9]=F,s}}Jh.prototype.bytesPerElement=20,Pt("StructArrayLayout6i1ul2ui20",Jh);class Vc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,p,_,x,w){const I=this.length;return this.resize(I+1),this.emplace(I,s,h,p,_,x,w)}emplace(s,h,p,_,x,w,I){const P=6*s;return this.int16[P+0]=h,this.int16[P+1]=p,this.int16[P+2]=_,this.int16[P+3]=x,this.int16[P+4]=w,this.int16[P+5]=I,s}}Vc.prototype.bytesPerElement=12,Pt("StructArrayLayout2i2i2i12",Vc);class Qh extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,p,_,x){const w=this.length;return this.resize(w+1),this.emplace(w,s,h,p,_,x)}emplace(s,h,p,_,x,w){const I=4*s,P=8*s;return this.float32[I+0]=h,this.float32[I+1]=p,this.float32[I+2]=_,this.int16[P+6]=x,this.int16[P+7]=w,s}}Qh.prototype.bytesPerElement=16,Pt("StructArrayLayout2f1f2i16",Qh);class Uc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,p,_){const x=this.length;return this.resize(x+1),this.emplace(x,s,h,p,_)}emplace(s,h,p,_,x){const w=12*s,I=3*s;return this.uint8[w+0]=h,this.uint8[w+1]=p,this.float32[I+1]=_,this.float32[I+2]=x,s}}Uc.prototype.bytesPerElement=12,Pt("StructArrayLayout2ub2f12",Uc);class ef extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,s,h,p)}emplace(s,h,p,_){const x=3*s;return this.uint16[x+0]=h,this.uint16[x+1]=p,this.uint16[x+2]=_,s}}ef.prototype.bytesPerElement=6,Pt("StructArrayLayout3ui6",ef);class Fu extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,p,_,x,w,I,P,D,F,V,H,Y,J,ie,ge,we){const Ne=this.length;return this.resize(Ne+1),this.emplace(Ne,s,h,p,_,x,w,I,P,D,F,V,H,Y,J,ie,ge,we)}emplace(s,h,p,_,x,w,I,P,D,F,V,H,Y,J,ie,ge,we,Ne){const Ee=24*s,Ae=12*s,Qe=48*s;return this.int16[Ee+0]=h,this.int16[Ee+1]=p,this.uint16[Ee+2]=_,this.uint16[Ee+3]=x,this.uint32[Ae+2]=w,this.uint32[Ae+3]=I,this.uint32[Ae+4]=P,this.uint16[Ee+10]=D,this.uint16[Ee+11]=F,this.uint16[Ee+12]=V,this.float32[Ae+7]=H,this.float32[Ae+8]=Y,this.uint8[Qe+36]=J,this.uint8[Qe+37]=ie,this.uint8[Qe+38]=ge,this.uint32[Ae+10]=we,this.int16[Ee+22]=Ne,s}}Fu.prototype.bytesPerElement=48,Pt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Fu);class $l extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,p,_,x,w,I,P,D,F,V,H,Y,J,ie,ge,we,Ne,Ee,Ae,Qe,et,Ct,zt,It,xt,ht,kt){const yt=this.length;return this.resize(yt+1),this.emplace(yt,s,h,p,_,x,w,I,P,D,F,V,H,Y,J,ie,ge,we,Ne,Ee,Ae,Qe,et,Ct,zt,It,xt,ht,kt)}emplace(s,h,p,_,x,w,I,P,D,F,V,H,Y,J,ie,ge,we,Ne,Ee,Ae,Qe,et,Ct,zt,It,xt,ht,kt,yt){const st=32*s,Yt=16*s;return this.int16[st+0]=h,this.int16[st+1]=p,this.int16[st+2]=_,this.int16[st+3]=x,this.int16[st+4]=w,this.int16[st+5]=I,this.int16[st+6]=P,this.int16[st+7]=D,this.uint16[st+8]=F,this.uint16[st+9]=V,this.uint16[st+10]=H,this.uint16[st+11]=Y,this.uint16[st+12]=J,this.uint16[st+13]=ie,this.uint16[st+14]=ge,this.uint16[st+15]=we,this.uint16[st+16]=Ne,this.uint16[st+17]=Ee,this.uint16[st+18]=Ae,this.uint16[st+19]=Qe,this.uint16[st+20]=et,this.uint16[st+21]=Ct,this.uint16[st+22]=zt,this.uint32[Yt+12]=It,this.float32[Yt+13]=xt,this.float32[Yt+14]=ht,this.uint16[st+30]=kt,this.uint16[st+31]=yt,s}}$l.prototype.bytesPerElement=64,Pt("StructArrayLayout8i15ui1ul2f2ui64",$l);class tf extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const h=this.length;return this.resize(h+1),this.emplace(h,s)}emplace(s,h){return this.float32[1*s+0]=h,s}}tf.prototype.bytesPerElement=4,Pt("StructArrayLayout1f4",tf);class nf extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,s,h,p)}emplace(s,h,p,_){const x=3*s;return this.uint16[6*s+0]=h,this.float32[x+1]=p,this.float32[x+2]=_,s}}nf.prototype.bytesPerElement=12,Pt("StructArrayLayout1ui2f12",nf);class Kl extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,s,h,p)}emplace(s,h,p,_){const x=4*s;return this.uint32[2*s+0]=h,this.uint16[x+2]=p,this.uint16[x+3]=_,s}}Kl.prototype.bytesPerElement=8,Pt("StructArrayLayout1ul2ui8",Kl);class Qp extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h){const p=this.length;return this.resize(p+1),this.emplace(p,s,h)}emplace(s,h,p){const _=2*s;return this.uint16[_+0]=h,this.uint16[_+1]=p,s}}Qp.prototype.bytesPerElement=4,Pt("StructArrayLayout2ui4",Qp);class ed extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const h=this.length;return this.resize(h+1),this.emplace(h,s)}emplace(s,h){return this.uint16[1*s+0]=h,s}}ed.prototype.bytesPerElement=2,Pt("StructArrayLayout1ui2",ed);class rf extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,p,_){const x=this.length;return this.resize(x+1),this.emplace(x,s,h,p,_)}emplace(s,h,p,_,x){const w=4*s;return this.float32[w+0]=h,this.float32[w+1]=p,this.float32[w+2]=_,this.float32[w+3]=x,s}}rf.prototype.bytesPerElement=16,Pt("StructArrayLayout4f16",rf);class mg extends zc{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new E(this.anchorPointX,this.anchorPointY)}}mg.prototype.size=20;class v extends Jh{get(s){return new mg(this,s)}}Pt("CollisionBoxArray",v);class a extends zc{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(s){this._structArray.uint8[this._pos1+37]=s}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(s){this._structArray.uint8[this._pos1+38]=s}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(s){this._structArray.uint32[this._pos4+10]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}a.prototype.size=48;class f extends Fu{get(s){return new a(this,s)}}Pt("PlacedSymbolArray",f);class m extends zc{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(s){this._structArray.uint32[this._pos4+12]=s}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}m.prototype.size=64;class g extends $l{get(s){return new m(this,s)}}Pt("SymbolInstanceArray",g);class b extends tf{getoffsetX(s){return this.float32[1*s+0]}}Pt("GlyphOffsetArray",b);class T extends Fa{getx(s){return this.int16[3*s+0]}gety(s){return this.int16[3*s+1]}gettileUnitDistanceFromAnchor(s){return this.int16[3*s+2]}}Pt("SymbolLineVertexArray",T);class L extends zc{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}L.prototype.size=12;class k extends nf{get(s){return new L(this,s)}}Pt("TextAnchorOffsetArray",k);class z extends zc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}z.prototype.size=8;class j extends Kl{get(s){return new z(this,s)}}Pt("FeatureIndexArray",j);class q extends Fc{}class $ extends Fc{}class he extends Fc{}class ce extends Yp{}class ye extends $p{}class re extends Bc{}class Ie extends Kh{}class Ue extends Kp{}class xe extends Jp{}class De extends Ba{}class qe extends Vc{}class He extends Uc{}class $e extends ef{}class it extends Qp{}const tt=ei([{name:"a_pos",components:2,type:"Int16"}],4),{members:ct}=tt;class dt{constructor(s=[]){this.segments=s}prepareSegment(s,h,p,_){let x=this.segments[this.segments.length-1];return s>dt.MAX_VERTEX_ARRAY_LENGTH&&Ge(`Max vertices per segment is ${dt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}`),(!x||x.vertexLength+s>dt.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==_)&&(x={vertexOffset:h.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},_!==void 0&&(x.sortKey=_),this.segments.push(x)),x}get(){return this.segments}destroy(){for(const s of this.segments)for(const h in s.vaos)s.vaos[h].destroy()}static simpleSegment(s,h,p,_){return new dt([{vertexOffset:s,primitiveOffset:h,vertexLength:p,primitiveLength:_,vaos:{},sortKey:0}])}}function gn(u,s){return 256*(u=Z(Math.floor(u),0,255))+Z(Math.floor(s),0,255)}dt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Pt("SegmentVector",dt);const _t=ei([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var en={exports:{}},_n={exports:{}};_n.exports=function(u,s){var h,p,_,x,w,I,P,D;for(p=u.length-(h=3&u.length),_=s,w=3432918353,I=461845907,D=0;D<p;)P=255&u.charCodeAt(D)|(255&u.charCodeAt(++D))<<8|(255&u.charCodeAt(++D))<<16|(255&u.charCodeAt(++D))<<24,++D,_=27492+(65535&(x=5*(65535&(_=(_^=P=(65535&(P=(P=(65535&P)*w+(((P>>>16)*w&65535)<<16)&4294967295)<<15|P>>>17))*I+(((P>>>16)*I&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(P=0,h){case 3:P^=(255&u.charCodeAt(D+2))<<16;case 2:P^=(255&u.charCodeAt(D+1))<<8;case 1:_^=P=(65535&(P=(P=(65535&(P^=255&u.charCodeAt(D)))*w+(((P>>>16)*w&65535)<<16)&4294967295)<<15|P>>>17))*I+(((P>>>16)*I&65535)<<16)&4294967295}return _^=u.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0};var Fn=_n.exports,on={exports:{}};on.exports=function(u,s){for(var h,p=u.length,_=s^p,x=0;p>=4;)h=1540483477*(65535&(h=255&u.charCodeAt(x)|(255&u.charCodeAt(++x))<<8|(255&u.charCodeAt(++x))<<16|(255&u.charCodeAt(++x))<<24))+((1540483477*(h>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),p-=4,++x;switch(p){case 3:_^=(255&u.charCodeAt(x+2))<<16;case 2:_^=(255&u.charCodeAt(x+1))<<8;case 1:_=1540483477*(65535&(_^=255&u.charCodeAt(x)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0};var bn=Fn,Cn=on.exports;en.exports=bn,en.exports.murmur3=bn,en.exports.murmur2=Cn;var Br=d(en.exports);class tr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(s,h,p,_){this.ids.push(Xo(s)),this.positions.push(h,p,_)}getPositions(s){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const h=Xo(s);let p=0,_=this.ids.length-1;for(;p<_;){const w=p+_>>1;this.ids[w]>=h?_=w:p=w+1}const x=[];for(;this.ids[p]===h;)x.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return x}static serialize(s,h){const p=new Float64Array(s.ids),_=new Uint32Array(s.positions);return yi(p,_,0,p.length-1),h&&h.push(p.buffer,_.buffer),{ids:p,positions:_}}static deserialize(s){const h=new tr;return h.ids=s.ids,h.positions=s.positions,h.indexed=!0,h}}function Xo(u){const s=+u;return!isNaN(s)&&s<=Number.MAX_SAFE_INTEGER?s:Br(String(u))}function yi(u,s,h,p){for(;h<p;){const _=u[h+p>>1];let x=h-1,w=p+1;for(;;){do x++;while(u[x]<_);do w--;while(u[w]>_);if(x>=w)break;Mr(u,x,w),Mr(s,3*x,3*w),Mr(s,3*x+1,3*w+1),Mr(s,3*x+2,3*w+2)}w-h<p-w?(yi(u,s,h,w),h=w+1):(yi(u,s,w+1,p),p=w)}}function Mr(u,s,h){const p=u[s];u[s]=u[h],u[h]=p}Pt("FeaturePositionMap",tr);class vi{constructor(s,h){this.gl=s.gl,this.location=h}}class Yo extends vi{constructor(s,h){super(s,h),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class ia extends vi{constructor(s,h){super(s,h),this.current=[0,0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))}}class dl extends vi{constructor(s,h){super(s,h),this.current=Qn.transparent}set(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))}}const jc=new Float32Array(16);function ml(u){return[gn(255*u.r,255*u.g),gn(255*u.b,255*u.a)]}class oa{constructor(s,h,p){this.value=s,this.uniformNames=h.map(_=>`u_${_}`),this.type=p}setUniform(s,h,p){s.set(p.constantOr(this.value))}getBinding(s,h,p){return this.type==="color"?new dl(s,h):new Yo(s,h)}}class hi{constructor(s,h){this.uniformNames=h.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(s,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=s.tlbr}setUniform(s,h,p,_){const x=_==="u_pattern_to"?this.patternTo:_==="u_pattern_from"?this.patternFrom:_==="u_pixel_ratio_to"?this.pixelRatioTo:_==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&s.set(x)}getBinding(s,h,p){return p.substr(0,9)==="u_pattern"?new ia(s,h):new Yo(s,h)}}class kr{constructor(s,h,p,_){this.expression=s,this.type=p,this.maxValue=0,this.paintVertexAttributes=h.map(x=>({name:`a_${x}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(s,h,p,_,x){const w=this.paintVertexArray.length,I=this.expression.evaluate(new Er(0),h,{},_,[],x);this.paintVertexArray.resize(s),this._setPaintValue(w,s,I)}updatePaintArray(s,h,p,_){const x=this.expression.evaluate({zoom:0},p,_);this._setPaintValue(s,h,x)}_setPaintValue(s,h,p){if(this.type==="color"){const _=ml(p);for(let x=s;x<h;x++)this.paintVertexArray.emplace(x,_[0],_[1])}else{for(let _=s;_<h;_++)this.paintVertexArray.emplace(_,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ir{constructor(s,h,p,_,x,w){this.expression=s,this.uniformNames=h.map(I=>`u_${I}_t`),this.type=p,this.useIntegerZoom=_,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=h.map(I=>({name:`a_${I}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new w}populatePaintArray(s,h,p,_,x){const w=this.expression.evaluate(new Er(this.zoom),h,{},_,[],x),I=this.expression.evaluate(new Er(this.zoom+1),h,{},_,[],x),P=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(P,s,w,I)}updatePaintArray(s,h,p,_){const x=this.expression.evaluate({zoom:this.zoom},p,_),w=this.expression.evaluate({zoom:this.zoom+1},p,_);this._setPaintValue(s,h,x,w)}_setPaintValue(s,h,p,_){if(this.type==="color"){const x=ml(p),w=ml(_);for(let I=s;I<h;I++)this.paintVertexArray.emplace(I,x[0],x[1],w[0],w[1])}else{for(let x=s;x<h;x++)this.paintVertexArray.emplace(x,p,_);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(_))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,h){const p=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,_=Z(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);s.set(_)}getBinding(s,h,p){return new Yo(s,h)}}class ms{constructor(s,h,p,_,x,w){this.expression=s,this.type=h,this.useIntegerZoom=p,this.zoom=_,this.layerId=w,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x}populatePaintArray(s,h,p){const _=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(_,s,h.patterns&&h.patterns[this.layerId],p)}updatePaintArray(s,h,p,_,x){this._setPaintValues(s,h,p.patterns&&p.patterns[this.layerId],x)}_setPaintValues(s,h,p,_){if(!_||!p)return;const{min:x,mid:w,max:I}=p,P=_[x],D=_[w],F=_[I];if(P&&D&&F)for(let V=s;V<h;V++)this.zoomInPaintVertexArray.emplace(V,D.tl[0],D.tl[1],D.br[0],D.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],D.pixelRatio,P.pixelRatio),this.zoomOutPaintVertexArray.emplace(V,D.tl[0],D.tl[1],D.br[0],D.br[1],F.tl[0],F.tl[1],F.br[0],F.br[1],D.pixelRatio,F.pixelRatio)}upload(s){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,_t.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,_t.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class fi{constructor(s,h,p){this.binders={},this._buffers=[];const _=[];for(const x in s.paint._values){if(!p(x))continue;const w=s.paint.get(x);if(!(w instanceof As&&ku(w.property.specification)))continue;const I=gs(x,s.type),P=w.value,D=w.property.specification.type,F=w.property.useIntegerZoom,V=w.property.specification["property-type"],H=V==="cross-faded"||V==="cross-faded-data-driven";if(P.kind==="constant")this.binders[x]=H?new hi(P.value,I):new oa(P.value,I,D),_.push(`/u_${x}`);else if(P.kind==="source"||H){const Y=pi(x,D,"source");this.binders[x]=H?new ms(P,D,F,h,Y,s.id):new kr(P,I,D,Y),_.push(`/a_${x}`)}else{const Y=pi(x,D,"composite");this.binders[x]=new Ir(P,I,D,F,h,Y),_.push(`/z_${x}`)}}this.cacheKey=_.sort().join("")}getMaxValue(s){const h=this.binders[s];return h instanceof kr||h instanceof Ir?h.maxValue:0}populatePaintArrays(s,h,p,_,x){for(const w in this.binders){const I=this.binders[w];(I instanceof kr||I instanceof Ir||I instanceof ms)&&I.populatePaintArray(s,h,p,_,x)}}setConstantPatternPositions(s,h){for(const p in this.binders){const _=this.binders[p];_ instanceof hi&&_.setConstantPatternPositions(s,h)}}updatePaintArrays(s,h,p,_,x){let w=!1;for(const I in s){const P=h.getPositions(I);for(const D of P){const F=p.feature(D.index);for(const V in this.binders){const H=this.binders[V];if((H instanceof kr||H instanceof Ir||H instanceof ms)&&H.expression.isStateDependent===!0){const Y=_.paint.get(V);H.expression=Y.value,H.updatePaintArray(D.start,D.end,F,s[I],x),w=!0}}}}return w}defines(){const s=[];for(const h in this.binders){const p=this.binders[h];(p instanceof oa||p instanceof hi)&&s.push(...p.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return s}getBinderAttributes(){const s=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof kr||p instanceof Ir)for(let _=0;_<p.paintVertexAttributes.length;_++)s.push(p.paintVertexAttributes[_].name);else if(p instanceof ms)for(let _=0;_<_t.members.length;_++)s.push(_t.members[_].name)}return s}getBinderUniforms(){const s=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof oa||p instanceof hi||p instanceof Ir)for(const _ of p.uniformNames)s.push(_)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s,h){const p=[];for(const _ in this.binders){const x=this.binders[_];if(x instanceof oa||x instanceof hi||x instanceof Ir){for(const w of x.uniformNames)if(h[w]){const I=x.getBinding(s,h[w],w);p.push({name:w,property:_,binding:I})}}}return p}setUniforms(s,h,p,_){for(const{name:x,property:w,binding:I}of h)this.binders[w].setUniform(I,_,p.get(w),x)}updatePaintBuffers(s){this._buffers=[];for(const h in this.binders){const p=this.binders[h];if(s&&p instanceof ms){const _=s.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;_&&this._buffers.push(_)}else(p instanceof kr||p instanceof Ir)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(s){for(const h in this.binders){const p=this.binders[h];(p instanceof kr||p instanceof Ir||p instanceof ms)&&p.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const h=this.binders[s];(h instanceof kr||h instanceof Ir||h instanceof ms)&&h.destroy()}}}class Ar{constructor(s,h,p=()=>!0){this.programConfigurations={};for(const _ of s)this.programConfigurations[_.id]=new fi(_,h,p);this.needsUpload=!1,this._featureMap=new tr,this._bufferOffset=0}populatePaintArrays(s,h,p,_,x,w){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(s,h,_,x,w);h.id!==void 0&&this._featureMap.add(h.id,p,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,h,p,_){for(const x of p)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(s,this._featureMap,h,x,_)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}function gs(u,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[u]||[u.replace(`${s}-`,"").replace(/-/g,"_")]}function pi(u,s,h){const p={color:{source:Bc,composite:rf},number:{source:tf,composite:Bc}},_=function(x){return{"line-pattern":{source:Ie,composite:Ie},"fill-pattern":{source:Ie,composite:Ie},"fill-extrusion-pattern":{source:Ie,composite:Ie}}[x]}(u);return _&&_[h]||p[s][h]}Pt("ConstantBinder",oa),Pt("CrossFadedConstantBinder",hi),Pt("SourceExpressionBinder",kr),Pt("CrossFadedCompositeBinder",ms),Pt("CompositeExpressionBinder",Ir),Pt("ProgramConfiguration",fi,{omit:["_buffers"]}),Pt("ProgramConfigurationSet",Ar);const Xr=8192,td=Math.pow(2,14)-1,gg=-td-1;function Jl(u){const s=Xr/u.extent,h=u.loadGeometry();for(let p=0;p<h.length;p++){const _=h[p];for(let x=0;x<_.length;x++){const w=_[x],I=Math.round(w.x*s),P=Math.round(w.y*s);w.x=Z(I,gg,td),w.y=Z(P,gg,td),(I<w.x||I>w.x+1||P<w.y||P>w.y+1)&&Ge("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function Ql(u,s){return{type:u.type,id:u.id,properties:u.properties,geometry:s?Jl(u):[]}}function of(u,s,h,p,_){u.emplaceBack(2*s+(p+1)/2,2*h+(_+1)/2)}class gl{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(h=>h.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new $,this.indexArray=new $e,this.segments=new dt,this.programConfigurations=new Ar(s.layers,s.zoom),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(s,h,p){const _=this.layers[0],x=[];let w=null,I=!1;_.type==="circle"&&(w=_.layout.get("circle-sort-key"),I=!w.isConstant());for(const{feature:P,id:D,index:F,sourceLayerIndex:V}of s){const H=this.layers[0]._featureFilter.needGeometry,Y=Ql(P,H);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom),Y,p))continue;const J=I?w.evaluate(Y,{},p):void 0,ie={id:D,properties:P.properties,type:P.type,sourceLayerIndex:V,index:F,geometry:H?Y.geometry:Jl(P),patterns:{},sortKey:J};x.push(ie)}I&&x.sort((P,D)=>P.sortKey-D.sortKey);for(const P of x){const{geometry:D,index:F,sourceLayerIndex:V}=P,H=s[F].feature;this.addFeature(P,D,F,p),h.featureIndex.insert(H,D,F,V,this.index)}}update(s,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,ct),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,h,p,_){for(const x of h)for(const w of x){const I=w.x,P=w.y;if(I<0||I>=Xr||P<0||P>=Xr)continue;const D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),F=D.vertexLength;of(this.layoutVertexArray,I,P,-1,-1),of(this.layoutVertexArray,I,P,1,-1),of(this.layoutVertexArray,I,P,1,1),of(this.layoutVertexArray,I,P,-1,1),this.indexArray.emplaceBack(F,F+1,F+2),this.indexArray.emplaceBack(F,F+3,F+2),D.vertexLength+=4,D.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,p,{},_)}}function nd(u,s){for(let h=0;h<u.length;h++)if(af(s,u[h]))return!0;for(let h=0;h<s.length;h++)if(af(u,s[h]))return!0;return!!sf(u,s)}function _g(u,s,h){return!!af(u,s)||!!Wy(s,u,h)}function rd(u,s){if(u.length===1)return yb(s,u[0]);for(let h=0;h<s.length;h++){const p=s[h];for(let _=0;_<p.length;_++)if(af(u,p[_]))return!0}for(let h=0;h<u.length;h++)if(yb(s,u[h]))return!0;for(let h=0;h<s.length;h++)if(sf(u,s[h]))return!0;return!1}function id(u,s,h){if(u.length>1){if(sf(u,s))return!0;for(let p=0;p<s.length;p++)if(Wy(s[p],u,h))return!0}for(let p=0;p<u.length;p++)if(Wy(u[p],s,h))return!0;return!1}function sf(u,s){if(u.length===0||s.length===0)return!1;for(let h=0;h<u.length-1;h++){const p=u[h],_=u[h+1];for(let x=0;x<s.length-1;x++)if(od(p,_,s[x],s[x+1]))return!0}return!1}function od(u,s,h,p){return Te(u,h,p)!==Te(s,h,p)&&Te(u,s,h)!==Te(u,s,p)}function Wy(u,s,h){const p=h*h;if(s.length===1)return u.distSqr(s[0])<p;for(let _=1;_<s.length;_++)if(_b(u,s[_-1],s[_])<p)return!0;return!1}function _b(u,s,h){const p=s.distSqr(h);if(p===0)return u.distSqr(s);const _=((u.x-s.x)*(h.x-s.x)+(u.y-s.y)*(h.y-s.y))/p;return u.distSqr(_<0?s:_>1?h:h.sub(s)._mult(_)._add(s))}function yb(u,s){let h,p,_,x=!1;for(let w=0;w<u.length;w++){h=u[w];for(let I=0,P=h.length-1;I<h.length;P=I++)p=h[I],_=h[P],p.y>s.y!=_.y>s.y&&s.x<(_.x-p.x)*(s.y-p.y)/(_.y-p.y)+p.x&&(x=!x)}return x}function af(u,s){let h=!1;for(let p=0,_=u.length-1;p<u.length;_=p++){const x=u[p],w=u[_];x.y>s.y!=w.y>s.y&&s.x<(w.x-x.x)*(s.y-x.y)/(w.y-x.y)+x.x&&(h=!h)}return h}function YT(u,s,h){const p=h[0],_=h[2];if(u.x<p.x&&s.x<p.x||u.x>_.x&&s.x>_.x||u.y<p.y&&s.y<p.y||u.y>_.y&&s.y>_.y)return!1;const x=Te(u,s,h[0]);return x!==Te(u,s,h[1])||x!==Te(u,s,h[2])||x!==Te(u,s,h[3])}function sd(u,s,h){const p=s.paint.get(u).value;return p.kind==="constant"?p.value:h.programConfigurations.get(s.id).getMaxValue(u)}function yg(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function vg(u,s,h,p,_){if(!s[0]&&!s[1])return u;const x=E.convert(s)._mult(_);h==="viewport"&&x._rotate(-p);const w=[];for(let I=0;I<u.length;I++)w.push(u[I].sub(x));return w}let vb,bb;Pt("CircleBucket",gl,{omit:["layers"]});var $T={get paint(){return bb=bb||new Mo({"circle-radius":new $t(me.paint_circle["circle-radius"]),"circle-color":new $t(me.paint_circle["circle-color"]),"circle-blur":new $t(me.paint_circle["circle-blur"]),"circle-opacity":new $t(me.paint_circle["circle-opacity"]),"circle-translate":new jt(me.paint_circle["circle-translate"]),"circle-translate-anchor":new jt(me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new jt(me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new jt(me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new $t(me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new $t(me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new $t(me.paint_circle["circle-stroke-opacity"])})},get layout(){return vb=vb||new Mo({"circle-sort-key":new $t(me.layout_circle["circle-sort-key"])})}},ko=1e-6,lf=typeof Float32Array<"u"?Float32Array:Array;function Hy(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function xb(u,s,h){var p=s[0],_=s[1],x=s[2],w=s[3],I=s[4],P=s[5],D=s[6],F=s[7],V=s[8],H=s[9],Y=s[10],J=s[11],ie=s[12],ge=s[13],we=s[14],Ne=s[15],Ee=h[0],Ae=h[1],Qe=h[2],et=h[3];return u[0]=Ee*p+Ae*I+Qe*V+et*ie,u[1]=Ee*_+Ae*P+Qe*H+et*ge,u[2]=Ee*x+Ae*D+Qe*Y+et*we,u[3]=Ee*w+Ae*F+Qe*J+et*Ne,u[4]=(Ee=h[4])*p+(Ae=h[5])*I+(Qe=h[6])*V+(et=h[7])*ie,u[5]=Ee*_+Ae*P+Qe*H+et*ge,u[6]=Ee*x+Ae*D+Qe*Y+et*we,u[7]=Ee*w+Ae*F+Qe*J+et*Ne,u[8]=(Ee=h[8])*p+(Ae=h[9])*I+(Qe=h[10])*V+(et=h[11])*ie,u[9]=Ee*_+Ae*P+Qe*H+et*ge,u[10]=Ee*x+Ae*D+Qe*Y+et*we,u[11]=Ee*w+Ae*F+Qe*J+et*Ne,u[12]=(Ee=h[12])*p+(Ae=h[13])*I+(Qe=h[14])*V+(et=h[15])*ie,u[13]=Ee*_+Ae*P+Qe*H+et*ge,u[14]=Ee*x+Ae*D+Qe*Y+et*we,u[15]=Ee*w+Ae*F+Qe*J+et*Ne,u}Math.hypot||(Math.hypot=function(){for(var u=0,s=arguments.length;s--;)u+=arguments[s]*arguments[s];return Math.sqrt(u)});var ad,KT=xb;function bg(u,s,h){var p=s[0],_=s[1],x=s[2],w=s[3];return u[0]=h[0]*p+h[4]*_+h[8]*x+h[12]*w,u[1]=h[1]*p+h[5]*_+h[9]*x+h[13]*w,u[2]=h[2]*p+h[6]*_+h[10]*x+h[14]*w,u[3]=h[3]*p+h[7]*_+h[11]*x+h[15]*w,u}ad=new lf(4),lf!=Float32Array&&(ad[0]=0,ad[1]=0,ad[2]=0,ad[3]=0);class JT extends Ds{constructor(s){super(s,$T)}createBucket(s){return new gl(s)}queryRadius(s){const h=s;return sd("circle-radius",this,h)+sd("circle-stroke-width",this,h)+yg(this.paint.get("circle-translate"))}queryIntersectsFeature(s,h,p,_,x,w,I,P){const D=vg(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),w.angle,I),F=this.paint.get("circle-radius").evaluate(h,p)+this.paint.get("circle-stroke-width").evaluate(h,p),V=this.paint.get("circle-pitch-alignment")==="map",H=V?D:function(J,ie){return J.map(ge=>wb(ge,ie))}(D,P),Y=V?F*I:F;for(const J of _)for(const ie of J){const ge=V?ie:wb(ie,P);let we=Y;const Ne=bg([],[ie.x,ie.y,0,1],P);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?we*=Ne[3]/w.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(we*=w.cameraToCenterDistance/Ne[3]),_g(H,ge,we))return!0}return!1}}function wb(u,s){const h=bg([],[u.x,u.y,0,1],s);return new E(h[0]/h[3],h[1]/h[3])}class Sb extends gl{}let Eb;Pt("HeatmapBucket",Sb,{omit:["layers"]});var QT={get paint(){return Eb=Eb||new Mo({"heatmap-radius":new $t(me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new $t(me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new jt(me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Hp(me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new jt(me.paint_heatmap["heatmap-opacity"])})}};function Zy(u,{width:s,height:h},p,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==s*h*p)throw new RangeError(`mismatched image size. expected: ${_.length} but got: ${s*h*p}`)}else _=new Uint8Array(s*h*p);return u.width=s,u.height=h,u.data=_,u}function Ib(u,{width:s,height:h},p){if(s===u.width&&h===u.height)return;const _=Zy({},{width:s,height:h},p);Xy(u,_,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,s),height:Math.min(u.height,h)},p),u.width=s,u.height=h,u.data=_.data}function Xy(u,s,h,p,_,x){if(_.width===0||_.height===0)return s;if(_.width>u.width||_.height>u.height||h.x>u.width-_.width||h.y>u.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>s.width||_.height>s.height||p.x>s.width-_.width||p.y>s.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const w=u.data,I=s.data;if(w===I)throw new Error("srcData equals dstData, so image is already copied");for(let P=0;P<_.height;P++){const D=((h.y+P)*u.width+h.x)*x,F=((p.y+P)*s.width+p.x)*x;for(let V=0;V<_.width*x;V++)I[F+V]=w[D+V]}return s}class ld{constructor(s,h){Zy(this,s,1,h)}resize(s){Ib(this,s,1)}clone(){return new ld({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,h,p,_,x){Xy(s,h,p,_,x,1)}}class Rs{constructor(s,h){Zy(this,s,4,h)}resize(s){Ib(this,s,4)}replace(s,h){h?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new Rs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,h,p,_,x){Xy(s,h,p,_,x,4)}}function Cb(u){const s={},h=u.resolution||256,p=u.clips?u.clips.length:1,_=u.image||new Rs({width:h,height:p});if(Math.log(h)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${h}`);const x=(w,I,P)=>{s[u.evaluationKey]=P;const D=u.expression.evaluate(s);_.data[w+I+0]=Math.floor(255*D.r/D.a),_.data[w+I+1]=Math.floor(255*D.g/D.a),_.data[w+I+2]=Math.floor(255*D.b/D.a),_.data[w+I+3]=Math.floor(255*D.a)};if(u.clips)for(let w=0,I=0;w<p;++w,I+=4*h)for(let P=0,D=0;P<h;P++,D+=4){const F=P/(h-1),{start:V,end:H}=u.clips[w];x(I,D,V*(1-F)+H*F)}else for(let w=0,I=0;w<h;w++,I+=4)x(0,I,w/(h-1));return _}Pt("AlphaImage",ld),Pt("RGBAImage",Rs);class eL extends Ds{createBucket(s){return new Sb(s)}constructor(s){super(s,QT),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Cb({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Tb;var tL={get paint(){return Tb=Tb||new Mo({"hillshade-illumination-direction":new jt(me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new jt(me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new jt(me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new jt(me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new jt(me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new jt(me.paint_hillshade["hillshade-accent-color"])})}};class nL extends Ds{constructor(s){super(s,tL)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const rL=ei([{name:"a_pos",components:2,type:"Int16"}],4),{members:iL}=rL;var Yy={exports:{}};function xg(u,s,h){h=h||2;var p,_,x,w,I,P,D,F=s&&s.length,V=F?s[0]*h:u.length,H=Lb(u,0,V,h,!0),Y=[];if(!H||H.next===H.prev)return Y;if(F&&(H=function(ie,ge,we,Ne){var Ee,Ae,Qe,et=[];for(Ee=0,Ae=ge.length;Ee<Ae;Ee++)(Qe=Lb(ie,ge[Ee]*Ne,Ee<Ae-1?ge[Ee+1]*Ne:ie.length,Ne,!1))===Qe.next&&(Qe.steiner=!0),et.push(fL(Qe));for(et.sort(uL),Ee=0;Ee<et.length;Ee++)we=cL(et[Ee],we);return we}(u,s,H,h)),u.length>80*h){p=x=u[0],_=w=u[1];for(var J=h;J<V;J+=h)(I=u[J])<p&&(p=I),(P=u[J+1])<_&&(_=P),I>x&&(x=I),P>w&&(w=P);D=(D=Math.max(x-p,w-_))!==0?32767/D:0}return ud(H,Y,h,p,_,D,0),Y}function Lb(u,s,h,p,_){var x,w;if(_===Jy(u,s,h,p)>0)for(x=s;x<h;x+=p)w=kb(x,u[x],u[x+1],w);else for(x=h-p;x>=s;x-=p)w=kb(x,u[x],u[x+1],w);return w&&wg(w,w.next)&&(hd(w),w=w.next),w}function Gc(u,s){if(!u)return u;s||(s=u);var h,p=u;do if(h=!1,p.steiner||!wg(p,p.next)&&ti(p.prev,p,p.next)!==0)p=p.next;else{if(hd(p),(p=s=p.prev)===p.next)break;h=!0}while(h||p!==s);return s}function ud(u,s,h,p,_,x,w){if(u){!w&&x&&function(F,V,H,Y){var J=F;do J.z===0&&(J.z=$y(J.x,J.y,V,H,Y)),J.prevZ=J.prev,J.nextZ=J.next,J=J.next;while(J!==F);J.prevZ.nextZ=null,J.prevZ=null,function(ie){var ge,we,Ne,Ee,Ae,Qe,et,Ct,zt=1;do{for(we=ie,ie=null,Ae=null,Qe=0;we;){for(Qe++,Ne=we,et=0,ge=0;ge<zt&&(et++,Ne=Ne.nextZ);ge++);for(Ct=zt;et>0||Ct>0&&Ne;)et!==0&&(Ct===0||!Ne||we.z<=Ne.z)?(Ee=we,we=we.nextZ,et--):(Ee=Ne,Ne=Ne.nextZ,Ct--),Ae?Ae.nextZ=Ee:ie=Ee,Ee.prevZ=Ae,Ae=Ee;we=Ne}Ae.nextZ=null,zt*=2}while(Qe>1)}(J)}(u,p,_,x);for(var I,P,D=u;u.prev!==u.next;)if(I=u.prev,P=u.next,x?sL(u,p,_,x):oL(u))s.push(I.i/h|0),s.push(u.i/h|0),s.push(P.i/h|0),hd(u),u=P.next,D=P.next;else if((u=P)===D){w?w===1?ud(u=aL(Gc(u),s,h),s,h,p,_,x,2):w===2&&lL(u,s,h,p,_,x):ud(Gc(u),s,h,p,_,x,1);break}}}function oL(u){var s=u.prev,h=u,p=u.next;if(ti(s,h,p)>=0)return!1;for(var _=s.x,x=h.x,w=p.x,I=s.y,P=h.y,D=p.y,F=_<x?_<w?_:w:x<w?x:w,V=I<P?I<D?I:D:P<D?P:D,H=_>x?_>w?_:w:x>w?x:w,Y=I>P?I>D?I:D:P>D?P:D,J=p.next;J!==s;){if(J.x>=F&&J.x<=H&&J.y>=V&&J.y<=Y&&uf(_,I,x,P,w,D,J.x,J.y)&&ti(J.prev,J,J.next)>=0)return!1;J=J.next}return!0}function sL(u,s,h,p){var _=u.prev,x=u,w=u.next;if(ti(_,x,w)>=0)return!1;for(var I=_.x,P=x.x,D=w.x,F=_.y,V=x.y,H=w.y,Y=I<P?I<D?I:D:P<D?P:D,J=F<V?F<H?F:H:V<H?V:H,ie=I>P?I>D?I:D:P>D?P:D,ge=F>V?F>H?F:H:V>H?V:H,we=$y(Y,J,s,h,p),Ne=$y(ie,ge,s,h,p),Ee=u.prevZ,Ae=u.nextZ;Ee&&Ee.z>=we&&Ae&&Ae.z<=Ne;){if(Ee.x>=Y&&Ee.x<=ie&&Ee.y>=J&&Ee.y<=ge&&Ee!==_&&Ee!==w&&uf(I,F,P,V,D,H,Ee.x,Ee.y)&&ti(Ee.prev,Ee,Ee.next)>=0||(Ee=Ee.prevZ,Ae.x>=Y&&Ae.x<=ie&&Ae.y>=J&&Ae.y<=ge&&Ae!==_&&Ae!==w&&uf(I,F,P,V,D,H,Ae.x,Ae.y)&&ti(Ae.prev,Ae,Ae.next)>=0))return!1;Ae=Ae.nextZ}for(;Ee&&Ee.z>=we;){if(Ee.x>=Y&&Ee.x<=ie&&Ee.y>=J&&Ee.y<=ge&&Ee!==_&&Ee!==w&&uf(I,F,P,V,D,H,Ee.x,Ee.y)&&ti(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.prevZ}for(;Ae&&Ae.z<=Ne;){if(Ae.x>=Y&&Ae.x<=ie&&Ae.y>=J&&Ae.y<=ge&&Ae!==_&&Ae!==w&&uf(I,F,P,V,D,H,Ae.x,Ae.y)&&ti(Ae.prev,Ae,Ae.next)>=0)return!1;Ae=Ae.nextZ}return!0}function aL(u,s,h){var p=u;do{var _=p.prev,x=p.next.next;!wg(_,x)&&Pb(_,p,p.next,x)&&cd(_,x)&&cd(x,_)&&(s.push(_.i/h|0),s.push(p.i/h|0),s.push(x.i/h|0),hd(p),hd(p.next),p=u=x),p=p.next}while(p!==u);return Gc(p)}function lL(u,s,h,p,_,x){var w=u;do{for(var I=w.next.next;I!==w.prev;){if(w.i!==I.i&&pL(w,I)){var P=Mb(w,I);return w=Gc(w,w.next),P=Gc(P,P.next),ud(w,s,h,p,_,x,0),void ud(P,s,h,p,_,x,0)}I=I.next}w=w.next}while(w!==u)}function uL(u,s){return u.x-s.x}function cL(u,s){var h=function(_,x){var w,I=x,P=_.x,D=_.y,F=-1/0;do{if(D<=I.y&&D>=I.next.y&&I.next.y!==I.y){var V=I.x+(D-I.y)*(I.next.x-I.x)/(I.next.y-I.y);if(V<=P&&V>F&&(F=V,w=I.x<I.next.x?I:I.next,V===P))return w}I=I.next}while(I!==x);if(!w)return null;var H,Y=w,J=w.x,ie=w.y,ge=1/0;I=w;do P>=I.x&&I.x>=J&&P!==I.x&&uf(D<ie?P:F,D,J,ie,D<ie?F:P,D,I.x,I.y)&&(H=Math.abs(D-I.y)/(P-I.x),cd(I,_)&&(H<ge||H===ge&&(I.x>w.x||I.x===w.x&&hL(w,I)))&&(w=I,ge=H)),I=I.next;while(I!==Y);return w}(u,s);if(!h)return s;var p=Mb(h,u);return Gc(p,p.next),Gc(h,h.next)}function hL(u,s){return ti(u.prev,u,s.prev)<0&&ti(s.next,u,u.next)<0}function $y(u,s,h,p,_){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-h)*_|0)|u<<8))|u<<4))|u<<2))|u<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-p)*_|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function fL(u){var s=u,h=u;do(s.x<h.x||s.x===h.x&&s.y<h.y)&&(h=s),s=s.next;while(s!==u);return h}function uf(u,s,h,p,_,x,w,I){return(_-w)*(s-I)>=(u-w)*(x-I)&&(u-w)*(p-I)>=(h-w)*(s-I)&&(h-w)*(x-I)>=(_-w)*(p-I)}function pL(u,s){return u.next.i!==s.i&&u.prev.i!==s.i&&!function(h,p){var _=h;do{if(_.i!==h.i&&_.next.i!==h.i&&_.i!==p.i&&_.next.i!==p.i&&Pb(_,_.next,h,p))return!0;_=_.next}while(_!==h);return!1}(u,s)&&(cd(u,s)&&cd(s,u)&&function(h,p){var _=h,x=!1,w=(h.x+p.x)/2,I=(h.y+p.y)/2;do _.y>I!=_.next.y>I&&_.next.y!==_.y&&w<(_.next.x-_.x)*(I-_.y)/(_.next.y-_.y)+_.x&&(x=!x),_=_.next;while(_!==h);return x}(u,s)&&(ti(u.prev,u,s.prev)||ti(u,s.prev,s))||wg(u,s)&&ti(u.prev,u,u.next)>0&&ti(s.prev,s,s.next)>0)}function ti(u,s,h){return(s.y-u.y)*(h.x-s.x)-(s.x-u.x)*(h.y-s.y)}function wg(u,s){return u.x===s.x&&u.y===s.y}function Pb(u,s,h,p){var _=Eg(ti(u,s,h)),x=Eg(ti(u,s,p)),w=Eg(ti(h,p,u)),I=Eg(ti(h,p,s));return _!==x&&w!==I||!(_!==0||!Sg(u,h,s))||!(x!==0||!Sg(u,p,s))||!(w!==0||!Sg(h,u,p))||!(I!==0||!Sg(h,s,p))}function Sg(u,s,h){return s.x<=Math.max(u.x,h.x)&&s.x>=Math.min(u.x,h.x)&&s.y<=Math.max(u.y,h.y)&&s.y>=Math.min(u.y,h.y)}function Eg(u){return u>0?1:u<0?-1:0}function cd(u,s){return ti(u.prev,u,u.next)<0?ti(u,s,u.next)>=0&&ti(u,u.prev,s)>=0:ti(u,s,u.prev)<0||ti(u,u.next,s)<0}function Mb(u,s){var h=new Ky(u.i,u.x,u.y),p=new Ky(s.i,s.x,s.y),_=u.next,x=s.prev;return u.next=s,s.prev=u,h.next=_,_.prev=h,p.next=h,h.prev=p,x.next=p,p.prev=x,p}function kb(u,s,h,p){var _=new Ky(u,s,h);return p?(_.next=p.next,_.prev=p,p.next.prev=_,p.next=_):(_.prev=_,_.next=_),_}function hd(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function Ky(u,s,h){this.i=u,this.x=s,this.y=h,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Jy(u,s,h,p){for(var _=0,x=s,w=h-p;x<h;x+=p)_+=(u[w]-u[x])*(u[x+1]+u[w+1]),w=x;return _}Yy.exports=xg,Yy.exports.default=xg,xg.deviation=function(u,s,h,p){var _=s&&s.length,x=Math.abs(Jy(u,0,_?s[0]*h:u.length,h));if(_)for(var w=0,I=s.length;w<I;w++)x-=Math.abs(Jy(u,s[w]*h,w<I-1?s[w+1]*h:u.length,h));var P=0;for(w=0;w<p.length;w+=3){var D=p[w]*h,F=p[w+1]*h,V=p[w+2]*h;P+=Math.abs((u[D]-u[V])*(u[F+1]-u[D+1])-(u[D]-u[F])*(u[V+1]-u[D+1]))}return x===0&&P===0?0:Math.abs((P-x)/x)},xg.flatten=function(u){for(var s=u[0][0].length,h={vertices:[],holes:[],dimensions:s},p=0,_=0;_<u.length;_++){for(var x=0;x<u[_].length;x++)for(var w=0;w<s;w++)h.vertices.push(u[_][x][w]);_>0&&h.holes.push(p+=u[_-1].length)}return h};var Ab=d(Yy.exports);function dL(u,s,h,p,_){Db(u,s,h||0,p||u.length-1,_||mL)}function Db(u,s,h,p,_){for(;p>h;){if(p-h>600){var x=p-h+1,w=s-h+1,I=Math.log(x),P=.5*Math.exp(2*I/3),D=.5*Math.sqrt(I*P*(x-P)/x)*(w-x/2<0?-1:1);Db(u,s,Math.max(h,Math.floor(s-w*P/x+D)),Math.min(p,Math.floor(s+(x-w)*P/x+D)),_)}var F=u[s],V=h,H=p;for(fd(u,h,s),_(u[p],F)>0&&fd(u,h,p);V<H;){for(fd(u,V,H),V++,H--;_(u[V],F)<0;)V++;for(;_(u[H],F)>0;)H--}_(u[h],F)===0?fd(u,h,H):fd(u,++H,p),H<=s&&(h=H+1),s<=H&&(p=H-1)}}function fd(u,s,h){var p=u[s];u[s]=u[h],u[h]=p}function mL(u,s){return u<s?-1:u>s?1:0}function Qy(u,s){const h=u.length;if(h<=1)return[u];const p=[];let _,x;for(let w=0;w<h;w++){const I=ot(u[w]);I!==0&&(u[w].area=Math.abs(I),x===void 0&&(x=I<0),x===I<0?(_&&p.push(_),_=[u[w]]):_.push(u[w]))}if(_&&p.push(_),s>1)for(let w=0;w<p.length;w++)p[w].length<=s||(dL(p[w],s,1,p[w].length-1,gL),p[w]=p[w].slice(0,s));return p}function gL(u,s){return s.area-u.area}function e0(u,s,h){const p=h.patternDependencies;let _=!1;for(const x of s){const w=x.paint.get(`${u}-pattern`);w.isConstant()||(_=!0);const I=w.constantOr(null);I&&(_=!0,p[I.to]=!0,p[I.from]=!0)}return _}function t0(u,s,h,p,_){const x=_.patternDependencies;for(const w of s){const I=w.paint.get(`${u}-pattern`).value;if(I.kind!=="constant"){let P=I.evaluate({zoom:p-1},h,{},_.availableImages),D=I.evaluate({zoom:p},h,{},_.availableImages),F=I.evaluate({zoom:p+1},h,{},_.availableImages);P=P&&P.name?P.name:P,D=D&&D.name?D.name:D,F=F&&F.name?F.name:F,x[P]=!0,x[D]=!0,x[F]=!0,h.patterns[w.id]={min:P,mid:D,max:F}}}return h}class n0{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(h=>h.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new he,this.indexArray=new $e,this.indexArray2=new it,this.programConfigurations=new Ar(s.layers,s.zoom),this.segments=new dt,this.segments2=new dt,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(s,h,p){this.hasPattern=e0("fill",this.layers,h);const _=this.layers[0].layout.get("fill-sort-key"),x=!_.isConstant(),w=[];for(const{feature:I,id:P,index:D,sourceLayerIndex:F}of s){const V=this.layers[0]._featureFilter.needGeometry,H=Ql(I,V);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom),H,p))continue;const Y=x?_.evaluate(H,{},p,h.availableImages):void 0,J={id:P,properties:I.properties,type:I.type,sourceLayerIndex:F,index:D,geometry:V?H.geometry:Jl(I),patterns:{},sortKey:Y};w.push(J)}x&&w.sort((I,P)=>I.sortKey-P.sortKey);for(const I of w){const{geometry:P,index:D,sourceLayerIndex:F}=I;if(this.hasPattern){const V=t0("fill",this.layers,I,this.zoom,h);this.patternFeatures.push(V)}else this.addFeature(I,P,D,p,{});h.featureIndex.insert(s[D].feature,P,D,F,this.index)}}update(s,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,p)}addFeatures(s,h,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,iL),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(s,h,p,_,x){for(const w of Qy(h,500)){let I=0;for(const Y of w)I+=Y.length;const P=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),D=P.vertexLength,F=[],V=[];for(const Y of w){if(Y.length===0)continue;Y!==w[0]&&V.push(F.length/2);const J=this.segments2.prepareSegment(Y.length,this.layoutVertexArray,this.indexArray2),ie=J.vertexLength;this.layoutVertexArray.emplaceBack(Y[0].x,Y[0].y),this.indexArray2.emplaceBack(ie+Y.length-1,ie),F.push(Y[0].x),F.push(Y[0].y);for(let ge=1;ge<Y.length;ge++)this.layoutVertexArray.emplaceBack(Y[ge].x,Y[ge].y),this.indexArray2.emplaceBack(ie+ge-1,ie+ge),F.push(Y[ge].x),F.push(Y[ge].y);J.vertexLength+=Y.length,J.primitiveLength+=Y.length}const H=Ab(F,V);for(let Y=0;Y<H.length;Y+=3)this.indexArray.emplaceBack(D+H[Y],D+H[Y+1],D+H[Y+2]);P.vertexLength+=I,P.primitiveLength+=H.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,p,x,_)}}let Rb,Nb;Pt("FillBucket",n0,{omit:["layers","patternFeatures"]});var _L={get paint(){return Nb=Nb||new Mo({"fill-antialias":new jt(me.paint_fill["fill-antialias"]),"fill-opacity":new $t(me.paint_fill["fill-opacity"]),"fill-color":new $t(me.paint_fill["fill-color"]),"fill-outline-color":new $t(me.paint_fill["fill-outline-color"]),"fill-translate":new jt(me.paint_fill["fill-translate"]),"fill-translate-anchor":new jt(me.paint_fill["fill-translate-anchor"]),"fill-pattern":new $h(me.paint_fill["fill-pattern"])})},get layout(){return Rb=Rb||new Mo({"fill-sort-key":new $t(me.layout_fill["fill-sort-key"])})}};class yL extends Ds{constructor(s){super(s,_L)}recalculate(s,h){super.recalculate(s,h);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new n0(s)}queryRadius(){return yg(this.paint.get("fill-translate"))}queryIntersectsFeature(s,h,p,_,x,w,I){return rd(vg(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),w.angle,I),_)}isTileClipped(){return!0}}const vL=ei([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),bL=ei([{name:"a_centroid",components:2,type:"Int16"}],4),{members:xL}=vL;var Bu={},wL=y,Ob=cf;function cf(u,s,h,p,_){this.properties={},this.extent=h,this.type=0,this._pbf=u,this._geometry=-1,this._keys=p,this._values=_,u.readFields(SL,this,s)}function SL(u,s,h){u==1?s.id=h.readVarint():u==2?function(p,_){for(var x=p.readVarint()+p.pos;p.pos<x;){var w=_._keys[p.readVarint()],I=_._values[p.readVarint()];_.properties[w]=I}}(h,s):u==3?s.type=h.readVarint():u==4&&(s._geometry=h.pos)}function EL(u){for(var s,h,p=0,_=0,x=u.length,w=x-1;_<x;w=_++)p+=((h=u[w]).x-(s=u[_]).x)*(s.y+h.y);return p}cf.types=["Unknown","Point","LineString","Polygon"],cf.prototype.loadGeometry=function(){var u=this._pbf;u.pos=this._geometry;for(var s,h=u.readVarint()+u.pos,p=1,_=0,x=0,w=0,I=[];u.pos<h;){if(_<=0){var P=u.readVarint();p=7&P,_=P>>3}if(_--,p===1||p===2)x+=u.readSVarint(),w+=u.readSVarint(),p===1&&(s&&I.push(s),s=[]),s.push(new wL(x,w));else{if(p!==7)throw new Error("unknown command "+p);s&&s.push(s[0].clone())}}return s&&I.push(s),I},cf.prototype.bbox=function(){var u=this._pbf;u.pos=this._geometry;for(var s=u.readVarint()+u.pos,h=1,p=0,_=0,x=0,w=1/0,I=-1/0,P=1/0,D=-1/0;u.pos<s;){if(p<=0){var F=u.readVarint();h=7&F,p=F>>3}if(p--,h===1||h===2)(_+=u.readSVarint())<w&&(w=_),_>I&&(I=_),(x+=u.readSVarint())<P&&(P=x),x>D&&(D=x);else if(h!==7)throw new Error("unknown command "+h)}return[w,P,I,D]},cf.prototype.toGeoJSON=function(u,s,h){var p,_,x=this.extent*Math.pow(2,h),w=this.extent*u,I=this.extent*s,P=this.loadGeometry(),D=cf.types[this.type];function F(Y){for(var J=0;J<Y.length;J++){var ie=Y[J];Y[J]=[360*(ie.x+w)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(ie.y+I)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var V=[];for(p=0;p<P.length;p++)V[p]=P[p][0];F(P=V);break;case 2:for(p=0;p<P.length;p++)F(P[p]);break;case 3:for(P=function(Y){var J=Y.length;if(J<=1)return[Y];for(var ie,ge,we=[],Ne=0;Ne<J;Ne++){var Ee=EL(Y[Ne]);Ee!==0&&(ge===void 0&&(ge=Ee<0),ge===Ee<0?(ie&&we.push(ie),ie=[Y[Ne]]):ie.push(Y[Ne]))}return ie&&we.push(ie),we}(P),p=0;p<P.length;p++)for(_=0;_<P[p].length;_++)F(P[p][_])}P.length===1?P=P[0]:D="Multi"+D;var H={type:"Feature",geometry:{type:D,coordinates:P},properties:this.properties};return"id"in this&&(H.id=this.id),H};var IL=Ob,zb=Fb;function Fb(u,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(CL,this,s),this.length=this._features.length}function CL(u,s,h){u===15?s.version=h.readVarint():u===1?s.name=h.readString():u===5?s.extent=h.readVarint():u===2?s._features.push(h.pos):u===3?s._keys.push(h.readString()):u===4&&s._values.push(function(p){for(var _=null,x=p.readVarint()+p.pos;p.pos<x;){var w=p.readVarint()>>3;_=w===1?p.readString():w===2?p.readFloat():w===3?p.readDouble():w===4?p.readVarint64():w===5?p.readVarint():w===6?p.readSVarint():w===7?p.readBoolean():null}return _}(h))}Fb.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var s=this._pbf.readVarint()+this._pbf.pos;return new IL(this._pbf,s,this.extent,this._keys,this._values)};var TL=zb;function LL(u,s,h){if(u===3){var p=new TL(h,h.readVarint()+h.pos);p.length&&(s[p.name]=p)}}Bu.VectorTile=function(u,s){this.layers=u.readFields(LL,{},s)},Bu.VectorTileFeature=Ob,Bu.VectorTileLayer=zb;const PL=Bu.VectorTileFeature.types,r0=Math.pow(2,13);function pd(u,s,h,p,_,x,w,I){u.emplaceBack(s,h,2*Math.floor(p*r0)+w,_*r0*2,x*r0*2,Math.round(I))}class i0{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(h=>h.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new ce,this.centroidVertexArray=new q,this.indexArray=new $e,this.programConfigurations=new Ar(s.layers,s.zoom),this.segments=new dt,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(s,h,p){this.features=[],this.hasPattern=e0("fill-extrusion",this.layers,h);for(const{feature:_,id:x,index:w,sourceLayerIndex:I}of s){const P=this.layers[0]._featureFilter.needGeometry,D=Ql(_,P);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom),D,p))continue;const F={id:x,sourceLayerIndex:I,index:w,geometry:P?D.geometry:Jl(_),properties:_.properties,type:_.type,patterns:{}};this.hasPattern?this.features.push(t0("fill-extrusion",this.layers,F,this.zoom,h)):this.addFeature(F,F.geometry,w,p,{}),h.featureIndex.insert(_,F.geometry,w,I,this.index,!0)}}addFeatures(s,h,p){for(const _ of this.features){const{geometry:x}=_;this.addFeature(_,x,_.index,h,p)}}update(s,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,xL),this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,bL.members,!0),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(s,h,p,_,x){const w={x:0,y:0,vertexCount:0};for(const I of Qy(h,500)){let P=0;for(const J of I)P+=J.length;let D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const J of I){if(J.length===0||kL(J))continue;let ie=0;for(let ge=0;ge<J.length;ge++){const we=J[ge];if(ge>=1){const Ne=J[ge-1];if(!ML(we,Ne)){D.vertexLength+4>dt.MAX_VERTEX_ARRAY_LENGTH&&(D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ee=we.sub(Ne)._perp()._unit(),Ae=Ne.dist(we);ie+Ae>32768&&(ie=0),pd(this.layoutVertexArray,we.x,we.y,Ee.x,Ee.y,0,0,ie),pd(this.layoutVertexArray,we.x,we.y,Ee.x,Ee.y,0,1,ie),w.x+=2*we.x,w.y+=2*we.y,w.vertexCount+=2,ie+=Ae,pd(this.layoutVertexArray,Ne.x,Ne.y,Ee.x,Ee.y,0,0,ie),pd(this.layoutVertexArray,Ne.x,Ne.y,Ee.x,Ee.y,0,1,ie),w.x+=2*Ne.x,w.y+=2*Ne.y,w.vertexCount+=2;const Qe=D.vertexLength;this.indexArray.emplaceBack(Qe,Qe+2,Qe+1),this.indexArray.emplaceBack(Qe+1,Qe+2,Qe+3),D.vertexLength+=4,D.primitiveLength+=2}}}}if(D.vertexLength+P>dt.MAX_VERTEX_ARRAY_LENGTH&&(D=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray)),PL[s.type]!=="Polygon")continue;const F=[],V=[],H=D.vertexLength;for(const J of I)if(J.length!==0){J!==I[0]&&V.push(F.length/2);for(let ie=0;ie<J.length;ie++){const ge=J[ie];pd(this.layoutVertexArray,ge.x,ge.y,0,0,1,1,0),w.x+=ge.x,w.y+=ge.y,w.vertexCount+=1,F.push(ge.x),F.push(ge.y)}}const Y=Ab(F,V);for(let J=0;J<Y.length;J+=3)this.indexArray.emplaceBack(H+Y[J],H+Y[J+2],H+Y[J+1]);D.primitiveLength+=Y.length/3,D.vertexLength+=P}for(let I=0;I<w.vertexCount;I++)this.centroidVertexArray.emplaceBack(Math.floor(w.x/w.vertexCount),Math.floor(w.y/w.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,p,x,_)}}function ML(u,s){return u.x===s.x&&(u.x<0||u.x>Xr)||u.y===s.y&&(u.y<0||u.y>Xr)}function kL(u){return u.every(s=>s.x<0)||u.every(s=>s.x>Xr)||u.every(s=>s.y<0)||u.every(s=>s.y>Xr)}let Bb;Pt("FillExtrusionBucket",i0,{omit:["layers","features"]});var AL={get paint(){return Bb=Bb||new Mo({"fill-extrusion-opacity":new jt(me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new $t(me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new jt(me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new jt(me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new $h(me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new $t(me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new $t(me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new jt(me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class DL extends Ds{constructor(s){super(s,AL)}createBucket(s){return new i0(s)}queryRadius(){return yg(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(s,h,p,_,x,w,I,P){const D=vg(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),w.angle,I),F=this.paint.get("fill-extrusion-height").evaluate(h,p),V=this.paint.get("fill-extrusion-base").evaluate(h,p),H=function(J,ie,ge,we){const Ne=[];for(const Ee of J){const Ae=[Ee.x,Ee.y,0,1];bg(Ae,Ae,ie),Ne.push(new E(Ae[0]/Ae[3],Ae[1]/Ae[3]))}return Ne}(D,P),Y=function(J,ie,ge,we){const Ne=[],Ee=[],Ae=we[8]*ie,Qe=we[9]*ie,et=we[10]*ie,Ct=we[11]*ie,zt=we[8]*ge,It=we[9]*ge,xt=we[10]*ge,ht=we[11]*ge;for(const kt of J){const yt=[],st=[];for(const Yt of kt){const Vt=Yt.x,Pn=Yt.y,xr=we[0]*Vt+we[4]*Pn+we[12],Cr=we[1]*Vt+we[5]*Pn+we[13],xi=we[2]*Vt+we[6]*Pn+we[14],_s=we[3]*Vt+we[7]*Pn+we[15],Ao=xi+et,di=_s+Ct,Gi=xr+zt,Qi=Cr+It,Do=xi+xt,Ro=_s+ht,wi=new E((xr+Ae)/di,(Cr+Qe)/di);wi.z=Ao/di,yt.push(wi);const Si=new E(Gi/Ro,Qi/Ro);Si.z=Do/Ro,st.push(Si)}Ne.push(yt),Ee.push(st)}return[Ne,Ee]}(_,V,F,P);return function(J,ie,ge){let we=1/0;rd(ge,ie)&&(we=Vb(ge,ie[0]));for(let Ne=0;Ne<ie.length;Ne++){const Ee=ie[Ne],Ae=J[Ne];for(let Qe=0;Qe<Ee.length-1;Qe++){const et=Ee[Qe],Ct=[et,Ee[Qe+1],Ae[Qe+1],Ae[Qe],et];nd(ge,Ct)&&(we=Math.min(we,Vb(ge,Ct)))}}return we!==1/0&&we}(Y[0],Y[1],H)}}function dd(u,s){return u.x*s.x+u.y*s.y}function Vb(u,s){if(u.length===1){let h=0;const p=s[h++];let _;for(;!_||p.equals(_);)if(_=s[h++],!_)return 1/0;for(;h<s.length;h++){const x=s[h],w=u[0],I=_.sub(p),P=x.sub(p),D=w.sub(p),F=dd(I,I),V=dd(I,P),H=dd(P,P),Y=dd(D,I),J=dd(D,P),ie=F*H-V*V,ge=(H*Y-V*J)/ie,we=(F*J-V*Y)/ie,Ne=p.z*(1-ge-we)+_.z*ge+x.z*we;if(isFinite(Ne))return Ne}return 1/0}{let h=1/0;for(const p of s)h=Math.min(h,p.z);return h}}const RL=ei([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:NL}=RL,OL=ei([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:zL}=OL,FL=Bu.VectorTileFeature.types,BL=Math.cos(Math.PI/180*37.5),Ub=Math.pow(2,14)/.5;class o0{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(h=>h.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new ye,this.layoutVertexArray2=new re,this.indexArray=new $e,this.programConfigurations=new Ar(s.layers,s.zoom),this.segments=new dt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(s,h,p){this.hasPattern=e0("line",this.layers,h);const _=this.layers[0].layout.get("line-sort-key"),x=!_.isConstant(),w=[];for(const{feature:I,id:P,index:D,sourceLayerIndex:F}of s){const V=this.layers[0]._featureFilter.needGeometry,H=Ql(I,V);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom),H,p))continue;const Y=x?_.evaluate(H,{},p):void 0,J={id:P,properties:I.properties,type:I.type,sourceLayerIndex:F,index:D,geometry:V?H.geometry:Jl(I),patterns:{},sortKey:Y};w.push(J)}x&&w.sort((I,P)=>I.sortKey-P.sortKey);for(const I of w){const{geometry:P,index:D,sourceLayerIndex:F}=I;if(this.hasPattern){const V=t0("line",this.layers,I,this.zoom,h);this.patternFeatures.push(V)}else this.addFeature(I,P,D,p,{});h.featureIndex.insert(s[D].feature,P,D,F,this.index)}}update(s,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,p)}addFeatures(s,h,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,zL)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,NL),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,h,p,_,x){const w=this.layers[0].layout,I=w.get("line-join").evaluate(s,{}),P=w.get("line-cap"),D=w.get("line-miter-limit"),F=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(const V of h)this.addLine(V,s,I,P,D,F);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,p,x,_)}addLine(s,h,p,_,x,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let we=0;we<s.length-1;we++)this.totalDistance+=s[we].dist(s[we+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=FL[h.type]==="Polygon";let P=s.length;for(;P>=2&&s[P-1].equals(s[P-2]);)P--;let D=0;for(;D<P-1&&s[D].equals(s[D+1]);)D++;if(P<(I?3:2))return;p==="bevel"&&(x=1.05);const F=this.overscaling<=16?15*Xr/(512*this.overscaling):0,V=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let H,Y,J,ie,ge;this.e1=this.e2=-1,I&&(H=s[P-2],ge=s[D].sub(H)._unit()._perp());for(let we=D;we<P;we++){if(J=we===P-1?I?s[D+1]:void 0:s[we+1],J&&s[we].equals(J))continue;ge&&(ie=ge),H&&(Y=H),H=s[we],ge=J?J.sub(H)._unit()._perp():ie,ie=ie||ge;let Ne=ie.add(ge);Ne.x===0&&Ne.y===0||Ne._unit();const Ee=ie.x*ge.x+ie.y*ge.y,Ae=Ne.x*ge.x+Ne.y*ge.y,Qe=Ae!==0?1/Ae:1/0,et=2*Math.sqrt(2-2*Ae),Ct=Ae<BL&&Y&&J,zt=ie.x*ge.y-ie.y*ge.x>0;if(Ct&&we>D){const ht=H.dist(Y);if(ht>2*F){const kt=H.sub(H.sub(Y)._mult(F/ht)._round());this.updateDistance(Y,kt),this.addCurrentVertex(kt,ie,0,0,V),Y=kt}}const It=Y&&J;let xt=It?p:I?"butt":_;if(It&&xt==="round"&&(Qe<w?xt="miter":Qe<=2&&(xt="fakeround")),xt==="miter"&&Qe>x&&(xt="bevel"),xt==="bevel"&&(Qe>2&&(xt="flipbevel"),Qe<x&&(xt="miter")),Y&&this.updateDistance(Y,H),xt==="miter")Ne._mult(Qe),this.addCurrentVertex(H,Ne,0,0,V);else if(xt==="flipbevel"){if(Qe>100)Ne=ge.mult(-1);else{const ht=Qe*ie.add(ge).mag()/ie.sub(ge).mag();Ne._perp()._mult(ht*(zt?-1:1))}this.addCurrentVertex(H,Ne,0,0,V),this.addCurrentVertex(H,Ne.mult(-1),0,0,V)}else if(xt==="bevel"||xt==="fakeround"){const ht=-Math.sqrt(Qe*Qe-1),kt=zt?ht:0,yt=zt?0:ht;if(Y&&this.addCurrentVertex(H,ie,kt,yt,V),xt==="fakeround"){const st=Math.round(180*et/Math.PI/20);for(let Yt=1;Yt<st;Yt++){let Vt=Yt/st;if(Vt!==.5){const xr=Vt-.5;Vt+=Vt*xr*(Vt-1)*((1.0904+Ee*(Ee*(3.55645-1.43519*Ee)-3.2452))*xr*xr+(.848013+Ee*(.215638*Ee-1.06021)))}const Pn=ge.sub(ie)._mult(Vt)._add(ie)._unit()._mult(zt?-1:1);this.addHalfVertex(H,Pn.x,Pn.y,!1,zt,0,V)}}J&&this.addCurrentVertex(H,ge,-kt,-yt,V)}else if(xt==="butt")this.addCurrentVertex(H,Ne,0,0,V);else if(xt==="square"){const ht=Y?1:-1;this.addCurrentVertex(H,Ne,ht,ht,V)}else xt==="round"&&(Y&&(this.addCurrentVertex(H,ie,0,0,V),this.addCurrentVertex(H,ie,1,1,V,!0)),J&&(this.addCurrentVertex(H,ge,-1,-1,V,!0),this.addCurrentVertex(H,ge,0,0,V)));if(Ct&&we<P-1){const ht=H.dist(J);if(ht>2*F){const kt=H.add(J.sub(H)._mult(F/ht)._round());this.updateDistance(H,kt),this.addCurrentVertex(kt,ge,0,0,V),H=kt}}}}addCurrentVertex(s,h,p,_,x,w=!1){const I=h.y*_-h.x,P=-h.y-h.x*_;this.addHalfVertex(s,h.x+h.y*p,h.y-h.x*p,w,!1,p,x),this.addHalfVertex(s,I,P,w,!0,-_,x),this.distance>Ub/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(s,h,p,_,x,w))}addHalfVertex({x:s,y:h},p,_,x,w,I,P){const D=.5*(this.lineClips?this.scaledDistance*(Ub-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s<<1)+(x?1:0),(h<<1)+(w?1:0),Math.round(63*p)+128,Math.round(63*_)+128,1+(I===0?0:I<0?-1:1)|(63&D)<<2,D>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const F=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,F),P.primitiveLength++),w?this.e2=F:this.e1=F}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(s,h){this.distance+=s.dist(h),this.updateScaledDistance()}}let jb,Gb;Pt("LineBucket",o0,{omit:["layers","patternFeatures"]});var qb={get paint(){return Gb=Gb||new Mo({"line-opacity":new $t(me.paint_line["line-opacity"]),"line-color":new $t(me.paint_line["line-color"]),"line-translate":new jt(me.paint_line["line-translate"]),"line-translate-anchor":new jt(me.paint_line["line-translate-anchor"]),"line-width":new $t(me.paint_line["line-width"]),"line-gap-width":new $t(me.paint_line["line-gap-width"]),"line-offset":new $t(me.paint_line["line-offset"]),"line-blur":new $t(me.paint_line["line-blur"]),"line-dasharray":new Oc(me.paint_line["line-dasharray"]),"line-pattern":new $h(me.paint_line["line-pattern"]),"line-gradient":new Hp(me.paint_line["line-gradient"])})},get layout(){return jb=jb||new Mo({"line-cap":new jt(me.layout_line["line-cap"]),"line-join":new $t(me.layout_line["line-join"]),"line-miter-limit":new jt(me.layout_line["line-miter-limit"]),"line-round-limit":new jt(me.layout_line["line-round-limit"]),"line-sort-key":new $t(me.layout_line["line-sort-key"])})}};class VL extends $t{possiblyEvaluate(s,h){return h=new Er(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),super.possiblyEvaluate(s,h)}evaluate(s,h,p,_){return h=ae({},h,{zoom:Math.floor(h.zoom)}),super.evaluate(s,h,p,_)}}let Ig;class UL extends Ds{constructor(s){super(s,qb),this.gradientVersion=0,Ig||(Ig=new VL(qb.paint.properties["line-width"].specification),Ig.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const h=this.gradientExpression();this.stepInterpolant=!!function(p){return p._styleExpression!==void 0}(h)&&h._styleExpression.expression instanceof Lc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,h){super.recalculate(s,h),this.paint._values["line-floorwidth"]=Ig.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new o0(s)}queryRadius(s){const h=s,p=Wb(sd("line-width",this,h),sd("line-gap-width",this,h)),_=sd("line-offset",this,h);return p/2+Math.abs(_)+yg(this.paint.get("line-translate"))}queryIntersectsFeature(s,h,p,_,x,w,I){const P=vg(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),w.angle,I),D=I/2*Wb(this.paint.get("line-width").evaluate(h,p),this.paint.get("line-gap-width").evaluate(h,p)),F=this.paint.get("line-offset").evaluate(h,p);return F&&(_=function(V,H){const Y=[];for(let J=0;J<V.length;J++){const ie=V[J],ge=[];for(let we=0;we<ie.length;we++){const Ne=ie[we-1],Ee=ie[we],Ae=ie[we+1],Qe=we===0?new E(0,0):Ee.sub(Ne)._unit()._perp(),et=we===ie.length-1?new E(0,0):Ae.sub(Ee)._unit()._perp(),Ct=Qe._add(et)._unit(),zt=Ct.x*et.x+Ct.y*et.y;zt!==0&&Ct._mult(1/zt),ge.push(Ct._mult(H)._add(Ee))}Y.push(ge)}return Y}(_,F*I)),function(V,H,Y){for(let J=0;J<H.length;J++){const ie=H[J];if(V.length>=3){for(let ge=0;ge<ie.length;ge++)if(af(V,ie[ge]))return!0}if(id(V,ie,Y))return!0}return!1}(P,_,D)}isTileClipped(){return!0}}function Wb(u,s){return s>0?s+2*u:u}const jL=ei([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),GL=ei([{name:"a_projected_pos",components:3,type:"Float32"}],4);ei([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const qL=ei([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);ei([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Hb=ei([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),WL=ei([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function HL(u,s,h){return u.sections.forEach(p=>{p.text=function(_,x,w){const I=x.layout.get("text-transform").evaluate(w,{});return I==="uppercase"?_=_.toLocaleUpperCase():I==="lowercase"&&(_=_.toLocaleLowerCase()),pl.applyArabicShaping&&(_=pl.applyArabicShaping(_)),_}(p.text,s,h)}),u}ei([{name:"triangle",components:3,type:"Uint16"}]),ei([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ei([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),ei([{type:"Float32",name:"offsetX"}]),ei([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),ei([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const md={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var bi=24,Zb=or,Xb=function(u,s,h,p,_){var x,w,I=8*_-p-1,P=(1<<I)-1,D=P>>1,F=-7,V=h?_-1:0,H=h?-1:1,Y=u[s+V];for(V+=H,x=Y&(1<<-F)-1,Y>>=-F,F+=I;F>0;x=256*x+u[s+V],V+=H,F-=8);for(w=x&(1<<-F)-1,x>>=-F,F+=p;F>0;w=256*w+u[s+V],V+=H,F-=8);if(x===0)x=1-D;else{if(x===P)return w?NaN:1/0*(Y?-1:1);w+=Math.pow(2,p),x-=D}return(Y?-1:1)*w*Math.pow(2,x-p)},Yb=function(u,s,h,p,_,x){var w,I,P,D=8*x-_-1,F=(1<<D)-1,V=F>>1,H=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,Y=p?0:x-1,J=p?1:-1,ie=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(I=isNaN(s)?1:0,w=F):(w=Math.floor(Math.log(s)/Math.LN2),s*(P=Math.pow(2,-w))<1&&(w--,P*=2),(s+=w+V>=1?H/P:H*Math.pow(2,1-V))*P>=2&&(w++,P/=2),w+V>=F?(I=0,w=F):w+V>=1?(I=(s*P-1)*Math.pow(2,_),w+=V):(I=s*Math.pow(2,V-1)*Math.pow(2,_),w=0));_>=8;u[h+Y]=255&I,Y+=J,I/=256,_-=8);for(w=w<<_|I,D+=_;D>0;u[h+Y]=255&w,Y+=J,w/=256,D-=8);u[h+Y-J]|=128*ie};function or(u){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(u)?u:new Uint8Array(u||0),this.pos=0,this.type=0,this.length=this.buf.length}or.Varint=0,or.Fixed64=1,or.Bytes=2,or.Fixed32=5;var s0=4294967296,$b=1/s0,Kb=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function eu(u){return u.type===or.Bytes?u.readVarint()+u.pos:u.pos+1}function hf(u,s,h){return h?4294967296*s+(u>>>0):4294967296*(s>>>0)+(u>>>0)}function Jb(u,s,h){var p=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));h.realloc(p);for(var _=h.pos-1;_>=u;_--)h.buf[_+p]=h.buf[_]}function ZL(u,s){for(var h=0;h<u.length;h++)s.writeVarint(u[h])}function XL(u,s){for(var h=0;h<u.length;h++)s.writeSVarint(u[h])}function YL(u,s){for(var h=0;h<u.length;h++)s.writeFloat(u[h])}function $L(u,s){for(var h=0;h<u.length;h++)s.writeDouble(u[h])}function KL(u,s){for(var h=0;h<u.length;h++)s.writeBoolean(u[h])}function JL(u,s){for(var h=0;h<u.length;h++)s.writeFixed32(u[h])}function QL(u,s){for(var h=0;h<u.length;h++)s.writeSFixed32(u[h])}function eP(u,s){for(var h=0;h<u.length;h++)s.writeFixed64(u[h])}function tP(u,s){for(var h=0;h<u.length;h++)s.writeSFixed64(u[h])}function Cg(u,s){return(u[s]|u[s+1]<<8|u[s+2]<<16)+16777216*u[s+3]}function ff(u,s,h){u[h]=s,u[h+1]=s>>>8,u[h+2]=s>>>16,u[h+3]=s>>>24}function Qb(u,s){return(u[s]|u[s+1]<<8|u[s+2]<<16)+(u[s+3]<<24)}or.prototype={destroy:function(){this.buf=null},readFields:function(u,s,h){for(h=h||this.length;this.pos<h;){var p=this.readVarint(),_=p>>3,x=this.pos;this.type=7&p,u(_,s,this),this.pos===x&&this.skip(p)}return s},readMessage:function(u,s){return this.readFields(u,s,this.readVarint()+this.pos)},readFixed32:function(){var u=Cg(this.buf,this.pos);return this.pos+=4,u},readSFixed32:function(){var u=Qb(this.buf,this.pos);return this.pos+=4,u},readFixed64:function(){var u=Cg(this.buf,this.pos)+Cg(this.buf,this.pos+4)*s0;return this.pos+=8,u},readSFixed64:function(){var u=Cg(this.buf,this.pos)+Qb(this.buf,this.pos+4)*s0;return this.pos+=8,u},readFloat:function(){var u=Xb(this.buf,this.pos,!0,23,4);return this.pos+=4,u},readDouble:function(){var u=Xb(this.buf,this.pos,!0,52,8);return this.pos+=8,u},readVarint:function(u){var s,h,p=this.buf;return s=127&(h=p[this.pos++]),h<128?s:(s|=(127&(h=p[this.pos++]))<<7,h<128?s:(s|=(127&(h=p[this.pos++]))<<14,h<128?s:(s|=(127&(h=p[this.pos++]))<<21,h<128?s:function(_,x,w){var I,P,D=w.buf;if(I=(112&(P=D[w.pos++]))>>4,P<128||(I|=(127&(P=D[w.pos++]))<<3,P<128)||(I|=(127&(P=D[w.pos++]))<<10,P<128)||(I|=(127&(P=D[w.pos++]))<<17,P<128)||(I|=(127&(P=D[w.pos++]))<<24,P<128)||(I|=(1&(P=D[w.pos++]))<<31,P<128))return hf(_,I,x);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(h=p[this.pos]))<<28,u,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var u=this.readVarint();return u%2==1?(u+1)/-2:u/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var u=this.readVarint()+this.pos,s=this.pos;return this.pos=u,u-s>=12&&Kb?function(h,p,_){return Kb.decode(h.subarray(p,_))}(this.buf,s,u):function(h,p,_){for(var x="",w=p;w<_;){var I,P,D,F=h[w],V=null,H=F>239?4:F>223?3:F>191?2:1;if(w+H>_)break;H===1?F<128&&(V=F):H===2?(192&(I=h[w+1]))==128&&(V=(31&F)<<6|63&I)<=127&&(V=null):H===3?(P=h[w+2],(192&(I=h[w+1]))==128&&(192&P)==128&&((V=(15&F)<<12|(63&I)<<6|63&P)<=2047||V>=55296&&V<=57343)&&(V=null)):H===4&&(P=h[w+2],D=h[w+3],(192&(I=h[w+1]))==128&&(192&P)==128&&(192&D)==128&&((V=(15&F)<<18|(63&I)<<12|(63&P)<<6|63&D)<=65535||V>=1114112)&&(V=null)),V===null?(V=65533,H=1):V>65535&&(V-=65536,x+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),x+=String.fromCharCode(V),w+=H}return x}(this.buf,s,u)},readBytes:function(){var u=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,u);return this.pos=u,s},readPackedVarint:function(u,s){if(this.type!==or.Bytes)return u.push(this.readVarint(s));var h=eu(this);for(u=u||[];this.pos<h;)u.push(this.readVarint(s));return u},readPackedSVarint:function(u){if(this.type!==or.Bytes)return u.push(this.readSVarint());var s=eu(this);for(u=u||[];this.pos<s;)u.push(this.readSVarint());return u},readPackedBoolean:function(u){if(this.type!==or.Bytes)return u.push(this.readBoolean());var s=eu(this);for(u=u||[];this.pos<s;)u.push(this.readBoolean());return u},readPackedFloat:function(u){if(this.type!==or.Bytes)return u.push(this.readFloat());var s=eu(this);for(u=u||[];this.pos<s;)u.push(this.readFloat());return u},readPackedDouble:function(u){if(this.type!==or.Bytes)return u.push(this.readDouble());var s=eu(this);for(u=u||[];this.pos<s;)u.push(this.readDouble());return u},readPackedFixed32:function(u){if(this.type!==or.Bytes)return u.push(this.readFixed32());var s=eu(this);for(u=u||[];this.pos<s;)u.push(this.readFixed32());return u},readPackedSFixed32:function(u){if(this.type!==or.Bytes)return u.push(this.readSFixed32());var s=eu(this);for(u=u||[];this.pos<s;)u.push(this.readSFixed32());return u},readPackedFixed64:function(u){if(this.type!==or.Bytes)return u.push(this.readFixed64());var s=eu(this);for(u=u||[];this.pos<s;)u.push(this.readFixed64());return u},readPackedSFixed64:function(u){if(this.type!==or.Bytes)return u.push(this.readSFixed64());var s=eu(this);for(u=u||[];this.pos<s;)u.push(this.readSFixed64());return u},skip:function(u){var s=7&u;if(s===or.Varint)for(;this.buf[this.pos++]>127;);else if(s===or.Bytes)this.pos=this.readVarint()+this.pos;else if(s===or.Fixed32)this.pos+=4;else{if(s!==or.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(u,s){this.writeVarint(u<<3|s)},realloc:function(u){for(var s=this.length||16;s<this.pos+u;)s*=2;if(s!==this.length){var h=new Uint8Array(s);h.set(this.buf),this.buf=h,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(u){this.realloc(4),ff(this.buf,u,this.pos),this.pos+=4},writeSFixed32:function(u){this.realloc(4),ff(this.buf,u,this.pos),this.pos+=4},writeFixed64:function(u){this.realloc(8),ff(this.buf,-1&u,this.pos),ff(this.buf,Math.floor(u*$b),this.pos+4),this.pos+=8},writeSFixed64:function(u){this.realloc(8),ff(this.buf,-1&u,this.pos),ff(this.buf,Math.floor(u*$b),this.pos+4),this.pos+=8},writeVarint:function(u){(u=+u||0)>268435455||u<0?function(s,h){var p,_;if(s>=0?(p=s%4294967296|0,_=s/4294967296|0):(_=~(-s/4294967296),4294967295^(p=~(-s%4294967296))?p=p+1|0:(p=0,_=_+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),function(x,w,I){I.buf[I.pos++]=127&x|128,x>>>=7,I.buf[I.pos++]=127&x|128,x>>>=7,I.buf[I.pos++]=127&x|128,x>>>=7,I.buf[I.pos++]=127&x|128,I.buf[I.pos]=127&(x>>>=7)}(p,0,h),function(x,w){var I=(7&x)<<4;w.buf[w.pos++]|=I|((x>>>=3)?128:0),x&&(w.buf[w.pos++]=127&x|((x>>>=7)?128:0),x&&(w.buf[w.pos++]=127&x|((x>>>=7)?128:0),x&&(w.buf[w.pos++]=127&x|((x>>>=7)?128:0),x&&(w.buf[w.pos++]=127&x|((x>>>=7)?128:0),x&&(w.buf[w.pos++]=127&x)))))}(_,h)}(u,this):(this.realloc(4),this.buf[this.pos++]=127&u|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=u>>>7&127))))},writeSVarint:function(u){this.writeVarint(u<0?2*-u-1:2*u)},writeBoolean:function(u){this.writeVarint(!!u)},writeString:function(u){u=String(u),this.realloc(4*u.length),this.pos++;var s=this.pos;this.pos=function(p,_,x){for(var w,I,P=0;P<_.length;P++){if((w=_.charCodeAt(P))>55295&&w<57344){if(!I){w>56319||P+1===_.length?(p[x++]=239,p[x++]=191,p[x++]=189):I=w;continue}if(w<56320){p[x++]=239,p[x++]=191,p[x++]=189,I=w;continue}w=I-55296<<10|w-56320|65536,I=null}else I&&(p[x++]=239,p[x++]=191,p[x++]=189,I=null);w<128?p[x++]=w:(w<2048?p[x++]=w>>6|192:(w<65536?p[x++]=w>>12|224:(p[x++]=w>>18|240,p[x++]=w>>12&63|128),p[x++]=w>>6&63|128),p[x++]=63&w|128)}return x}(this.buf,u,this.pos);var h=this.pos-s;h>=128&&Jb(s,h,this),this.pos=s-1,this.writeVarint(h),this.pos+=h},writeFloat:function(u){this.realloc(4),Yb(this.buf,u,this.pos,!0,23,4),this.pos+=4},writeDouble:function(u){this.realloc(8),Yb(this.buf,u,this.pos,!0,52,8),this.pos+=8},writeBytes:function(u){var s=u.length;this.writeVarint(s),this.realloc(s);for(var h=0;h<s;h++)this.buf[this.pos++]=u[h]},writeRawMessage:function(u,s){this.pos++;var h=this.pos;u(s,this);var p=this.pos-h;p>=128&&Jb(h,p,this),this.pos=h-1,this.writeVarint(p),this.pos+=p},writeMessage:function(u,s,h){this.writeTag(u,or.Bytes),this.writeRawMessage(s,h)},writePackedVarint:function(u,s){s.length&&this.writeMessage(u,ZL,s)},writePackedSVarint:function(u,s){s.length&&this.writeMessage(u,XL,s)},writePackedBoolean:function(u,s){s.length&&this.writeMessage(u,KL,s)},writePackedFloat:function(u,s){s.length&&this.writeMessage(u,YL,s)},writePackedDouble:function(u,s){s.length&&this.writeMessage(u,$L,s)},writePackedFixed32:function(u,s){s.length&&this.writeMessage(u,JL,s)},writePackedSFixed32:function(u,s){s.length&&this.writeMessage(u,QL,s)},writePackedFixed64:function(u,s){s.length&&this.writeMessage(u,eP,s)},writePackedSFixed64:function(u,s){s.length&&this.writeMessage(u,tP,s)},writeBytesField:function(u,s){this.writeTag(u,or.Bytes),this.writeBytes(s)},writeFixed32Field:function(u,s){this.writeTag(u,or.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(u,s){this.writeTag(u,or.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(u,s){this.writeTag(u,or.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(u,s){this.writeTag(u,or.Fixed64),this.writeSFixed64(s)},writeVarintField:function(u,s){this.writeTag(u,or.Varint),this.writeVarint(s)},writeSVarintField:function(u,s){this.writeTag(u,or.Varint),this.writeSVarint(s)},writeStringField:function(u,s){this.writeTag(u,or.Bytes),this.writeString(s)},writeFloatField:function(u,s){this.writeTag(u,or.Fixed32),this.writeFloat(s)},writeDoubleField:function(u,s){this.writeTag(u,or.Fixed64),this.writeDouble(s)},writeBooleanField:function(u,s){this.writeVarintField(u,!!s)}};var a0=d(Zb);const l0=3;function nP(u,s,h){u===1&&h.readMessage(rP,s)}function rP(u,s,h){if(u===3){const{id:p,bitmap:_,width:x,height:w,left:I,top:P,advance:D}=h.readMessage(iP,{});s.push({id:p,bitmap:new ld({width:x+2*l0,height:w+2*l0},_),metrics:{width:x,height:w,left:I,top:P,advance:D}})}}function iP(u,s,h){u===1?s.id=h.readVarint():u===2?s.bitmap=h.readBytes():u===3?s.width=h.readVarint():u===4?s.height=h.readVarint():u===5?s.left=h.readSVarint():u===6?s.top=h.readSVarint():u===7&&(s.advance=h.readVarint())}const ex=l0;function tx(u){let s=0,h=0;for(const w of u)s+=w.w*w.h,h=Math.max(h,w.w);u.sort((w,I)=>I.h-w.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),h),h:1/0}];let _=0,x=0;for(const w of u)for(let I=p.length-1;I>=0;I--){const P=p[I];if(!(w.w>P.w||w.h>P.h)){if(w.x=P.x,w.y=P.y,x=Math.max(x,w.y+w.h),_=Math.max(_,w.x+w.w),w.w===P.w&&w.h===P.h){const D=p.pop();I<p.length&&(p[I]=D)}else w.h===P.h?(P.x+=w.w,P.w-=w.w):w.w===P.w?(P.y+=w.h,P.h-=w.h):(p.push({x:P.x+w.w,y:P.y,w:P.w-w.w,h:w.h}),P.y+=w.h,P.h-=w.h);break}}return{w:_,h:x,fill:s/(_*x)||0}}const $o=1;class u0{constructor(s,{pixelRatio:h,version:p,stretchX:_,stretchY:x,content:w}){this.paddedRect=s,this.pixelRatio=h,this.stretchX=_,this.stretchY=x,this.content=w,this.version=p}get tl(){return[this.paddedRect.x+$o,this.paddedRect.y+$o]}get br(){return[this.paddedRect.x+this.paddedRect.w-$o,this.paddedRect.y+this.paddedRect.h-$o]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*$o)/this.pixelRatio,(this.paddedRect.h-2*$o)/this.pixelRatio]}}class nx{constructor(s,h){const p={},_={};this.haveRenderCallbacks=[];const x=[];this.addImages(s,p,x),this.addImages(h,_,x);const{w,h:I}=tx(x),P=new Rs({width:w||1,height:I||1});for(const D in s){const F=s[D],V=p[D].paddedRect;Rs.copy(F.data,P,{x:0,y:0},{x:V.x+$o,y:V.y+$o},F.data)}for(const D in h){const F=h[D],V=_[D].paddedRect,H=V.x+$o,Y=V.y+$o,J=F.data.width,ie=F.data.height;Rs.copy(F.data,P,{x:0,y:0},{x:H,y:Y},F.data),Rs.copy(F.data,P,{x:0,y:ie-1},{x:H,y:Y-1},{width:J,height:1}),Rs.copy(F.data,P,{x:0,y:0},{x:H,y:Y+ie},{width:J,height:1}),Rs.copy(F.data,P,{x:J-1,y:0},{x:H-1,y:Y},{width:1,height:ie}),Rs.copy(F.data,P,{x:0,y:0},{x:H+J,y:Y},{width:1,height:ie})}this.image=P,this.iconPositions=p,this.patternPositions=_}addImages(s,h,p){for(const _ in s){const x=s[_],w={x:0,y:0,w:x.data.width+2*$o,h:x.data.height+2*$o};p.push(w),h[_]=new u0(w,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(s,h){s.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in s.updatedImages)this.patchUpdatedImage(this.iconPositions[p],s.getImage(p),h),this.patchUpdatedImage(this.patternPositions[p],s.getImage(p),h)}patchUpdatedImage(s,h,p){if(!s||!h||s.version===h.version)return;s.version=h.version;const[_,x]=s.tl;p.update(h.data,void 0,{x:_,y:x})}}var Vu;Pt("ImagePosition",u0),Pt("ImageAtlas",nx),c.ah=void 0,(Vu=c.ah||(c.ah={}))[Vu.none=0]="none",Vu[Vu.horizontal=1]="horizontal",Vu[Vu.vertical=2]="vertical",Vu[Vu.horizontalOnly=3]="horizontalOnly";const gd=-17;class _d{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(s,h){const p=new _d;return p.scale=s||1,p.fontStack=h,p}static forImage(s){const h=new _d;return h.imageName=s,h}}class pf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,h){const p=new pf;for(let _=0;_<s.sections.length;_++){const x=s.sections[_];x.image?p.addImageSection(x):p.addTextSection(x,h)}return p}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSectionIndex(s){return this.sectionIndex[s]}getCharCode(s){return this.text.charCodeAt(s)}verticalizePunctuation(){this.text=function(s){let h="";for(let p=0;p<s.length;p++){const _=s.charCodeAt(p+1)||null,x=s.charCodeAt(p-1)||null;h+=_&&qp(_)&&!md[s[p+1]]||x&&qp(x)&&!md[s[p-1]]||!md[s[p]]?s[p]:md[s[p]]}return h}(this.text)}trim(){let s=0;for(let p=0;p<this.text.length&&Lg[this.text.charCodeAt(p)];p++)s++;let h=this.text.length;for(let p=this.text.length-1;p>=0&&p>=s&&Lg[this.text.charCodeAt(p)];p--)h--;this.text=this.text.substring(s,h),this.sectionIndex=this.sectionIndex.slice(s,h)}substring(s,h){const p=new pf;return p.text=this.text.substring(s,h),p.sectionIndex=this.sectionIndex.slice(s,h),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,h)=>Math.max(s,this.sections[h].scale),0)}addTextSection(s,h){this.text+=s.text,this.sections.push(_d.forText(s.scale,s.fontStack||h));const p=this.sections.length-1;for(let _=0;_<s.text.length;++_)this.sectionIndex.push(p)}addImageSection(s){const h=s.image?s.image.name:"";if(h.length===0)return void Ge("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(_d.forImage(h)),this.sectionIndex.push(this.sections.length-1)):Ge("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Tg(u,s,h,p,_,x,w,I,P,D,F,V,H,Y,J,ie){const ge=pf.fromFeature(u,_);let we;V===c.ah.vertical&&ge.verticalizePunctuation();const{processBidirectionalText:Ne,processStyledBidirectionalText:Ee}=pl;if(Ne&&ge.sections.length===1){we=[];const et=Ne(ge.toString(),c0(ge,D,x,s,p,Y,J));for(const Ct of et){const zt=new pf;zt.text=Ct,zt.sections=ge.sections;for(let It=0;It<Ct.length;It++)zt.sectionIndex.push(0);we.push(zt)}}else if(Ee){we=[];const et=Ee(ge.text,ge.sectionIndex,c0(ge,D,x,s,p,Y,J));for(const Ct of et){const zt=new pf;zt.text=Ct[0],zt.sectionIndex=Ct[1],zt.sections=ge.sections,we.push(zt)}}else we=function(et,Ct){const zt=[],It=et.text;let xt=0;for(const ht of Ct)zt.push(et.substring(xt,ht)),xt=ht;return xt<It.length&&zt.push(et.substring(xt,It.length)),zt}(ge,c0(ge,D,x,s,p,Y,J));const Ae=[],Qe={positionedLines:Ae,text:ge.toString(),top:F[1],bottom:F[1],left:F[0],right:F[0],writingMode:V,iconsInText:!1,verticalizable:!1};return function(et,Ct,zt,It,xt,ht,kt,yt,st,Yt,Vt,Pn){let xr=0,Cr=gd,xi=0,_s=0;const Ao=yt==="right"?1:yt==="left"?0:.5;let di=0;for(const wi of xt){wi.trim();const Si=wi.getMaxScale(),_o=(Si-1)*bi,No={positionedGlyphs:[],lineOffset:0};et.positionedLines[di]=No;const yo=No.positionedGlyphs;let Ko=0;if(!wi.length()){Cr+=ht,++di;continue}for(let Ei=0;Ei<wi.length();Ei++){const An=wi.getSection(Ei),vo=wi.getSectionIndex(Ei),eo=wi.getCharCode(Ei);let Ii=0,sa=null,Va=null,Ua=null,tu=bi;const aa=!(st===c.ah.horizontal||!Vt&&!Zh(eo)||Vt&&(Lg[eo]||(Gi=eo,Et.Arabic(Gi)||Et["Arabic Supplement"](Gi)||Et["Arabic Extended-A"](Gi)||Et["Arabic Presentation Forms-A"](Gi)||Et["Arabic Presentation Forms-B"](Gi))));if(An.imageName){const Os=It[An.imageName];if(!Os)continue;Ua=An.imageName,et.iconsInText=et.iconsInText||!0,Va=Os.paddedRect;const Qo=Os.displaySize;An.scale=An.scale*bi/Pn,sa={width:Qo[0],height:Qo[1],left:$o,top:-ex,advance:aa?Qo[1]:Qo[0]},Ii=_o+(bi-Qo[1]*An.scale),tu=sa.advance;const nu=aa?Qo[0]*An.scale-bi*Si:Qo[1]*An.scale-bi*Si;nu>0&&nu>Ko&&(Ko=nu)}else{const Os=zt[An.fontStack],Qo=Os&&Os[eo];if(Qo&&Qo.rect)Va=Qo.rect,sa=Qo.metrics;else{const nu=Ct[An.fontStack],wd=nu&&nu[eo];if(!wd)continue;sa=wd.metrics}Ii=(Si-An.scale)*bi}aa?(et.verticalizable=!0,yo.push({glyph:eo,imageName:Ua,x:xr,y:Cr+Ii,vertical:aa,scale:An.scale,fontStack:An.fontStack,sectionIndex:vo,metrics:sa,rect:Va}),xr+=tu*An.scale+Yt):(yo.push({glyph:eo,imageName:Ua,x:xr,y:Cr+Ii,vertical:aa,scale:An.scale,fontStack:An.fontStack,sectionIndex:vo,metrics:sa,rect:Va}),xr+=sa.advance*An.scale+Yt)}yo.length!==0&&(xi=Math.max(xr-Yt,xi),aP(yo,0,yo.length-1,Ao,Ko)),xr=0;const Jo=ht*Si+Ko;No.lineOffset=Math.max(Ko,_o),Cr+=Jo,_s=Math.max(Jo,_s),++di}var Gi;const Qi=Cr-gd,{horizontalAlign:Do,verticalAlign:Ro}=h0(kt);(function(wi,Si,_o,No,yo,Ko,Jo,Ei,An){const vo=(Si-_o)*yo;let eo=0;eo=Ko!==Jo?-Ei*No-gd:(-No*An+.5)*Jo;for(const Ii of wi)for(const sa of Ii.positionedGlyphs)sa.x+=vo,sa.y+=eo})(et.positionedLines,Ao,Do,Ro,xi,_s,ht,Qi,xt.length),et.top+=-Ro*Qi,et.bottom=et.top+Qi,et.left+=-Do*xi,et.right=et.left+xi}(Qe,s,h,p,we,w,I,P,V,D,H,ie),!function(et){for(const Ct of et)if(Ct.positionedGlyphs.length!==0)return!1;return!0}(Ae)&&Qe}const Lg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},oP={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function rx(u,s,h,p,_,x){if(s.imageName){const w=p[s.imageName];return w?w.displaySize[0]*s.scale*bi/x+_:0}{const w=h[s.fontStack],I=w&&w[u];return I?I.metrics.advance*s.scale+_:0}}function ix(u,s,h,p){const _=Math.pow(u-s,2);return p?u<s?_/2:2*_:_+Math.abs(h)*h}function sP(u,s,h){let p=0;return u===10&&(p-=1e4),h&&(p+=150),u!==40&&u!==65288||(p+=50),s!==41&&s!==65289||(p+=50),p}function ox(u,s,h,p,_,x){let w=null,I=ix(s,h,_,x);for(const P of p){const D=ix(s-P.x,h,_,x)+P.badness;D<=I&&(w=P,I=D)}return{index:u,x:s,priorBreak:w,badness:I}}function sx(u){return u?sx(u.priorBreak).concat(u.index):[]}function c0(u,s,h,p,_,x,w){if(x!=="point")return[];if(!u)return[];const I=[],P=function(H,Y,J,ie,ge,we){let Ne=0;for(let Ee=0;Ee<H.length();Ee++){const Ae=H.getSection(Ee);Ne+=rx(H.getCharCode(Ee),Ae,ie,ge,Y,we)}return Ne/Math.max(1,Math.ceil(Ne/J))}(u,s,h,p,_,w),D=u.text.indexOf("")>=0;let F=0;for(let H=0;H<u.length();H++){const Y=u.getSection(H),J=u.getCharCode(H);if(Lg[J]||(F+=rx(J,Y,p,_,s,w)),H<u.length()-1){const ie=!((V=J)<11904||!(Et["Bopomofo Extended"](V)||Et.Bopomofo(V)||Et["CJK Compatibility Forms"](V)||Et["CJK Compatibility Ideographs"](V)||Et["CJK Compatibility"](V)||Et["CJK Radicals Supplement"](V)||Et["CJK Strokes"](V)||Et["CJK Symbols and Punctuation"](V)||Et["CJK Unified Ideographs Extension A"](V)||Et["CJK Unified Ideographs"](V)||Et["Enclosed CJK Letters and Months"](V)||Et["Halfwidth and Fullwidth Forms"](V)||Et.Hiragana(V)||Et["Ideographic Description Characters"](V)||Et["Kangxi Radicals"](V)||Et["Katakana Phonetic Extensions"](V)||Et.Katakana(V)||Et["Vertical Forms"](V)||Et["Yi Radicals"](V)||Et["Yi Syllables"](V)));(oP[J]||ie||Y.imageName)&&I.push(ox(H+1,F,P,I,sP(J,u.getCharCode(H+1),ie&&D),!1))}}var V;return sx(ox(u.length(),F,P,I,0,!0))}function h0(u){let s=.5,h=.5;switch(u){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:s,verticalAlign:h}}function aP(u,s,h,p,_){if(!p&&!_)return;const x=u[h],w=(u[h].x+x.metrics.advance*x.scale)*p;for(let I=s;I<=h;I++)u[I].x-=w,u[I].y+=_}function lP(u,s,h){const{horizontalAlign:p,verticalAlign:_}=h0(h),x=s[0]-u.displaySize[0]*p,w=s[1]-u.displaySize[1]*_;return{image:u,top:w,bottom:w+u.displaySize[1],left:x,right:x+u.displaySize[0]}}function ax(u,s,h,p,_,x){const w=u.image;let I;if(w.content){const ge=w.content,we=w.pixelRatio||1;I=[ge[0]/we,ge[1]/we,w.displaySize[0]-ge[2]/we,w.displaySize[1]-ge[3]/we]}const P=s.left*x,D=s.right*x;let F,V,H,Y;h==="width"||h==="both"?(Y=_[0]+P-p[3],V=_[0]+D+p[1]):(Y=_[0]+(P+D-w.displaySize[0])/2,V=Y+w.displaySize[0]);const J=s.top*x,ie=s.bottom*x;return h==="height"||h==="both"?(F=_[1]+J-p[0],H=_[1]+ie+p[2]):(F=_[1]+(J+ie-w.displaySize[1])/2,H=F+w.displaySize[1]),{image:w,top:F,right:V,bottom:H,left:Y,collisionPadding:I}}const yd=255,_l=128,Uu=yd*_l;function lx(u,s){const{expression:h}=s;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new Er(u+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:_}=h;let x=0;for(;x<p.length&&p[x]<=u;)x++;x=Math.max(0,x-1);let w=x;for(;w<p.length&&p[w]<u+1;)w++;w=Math.min(p.length-1,w);const I=p[x],P=p[w];return h.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:P,interpolationType:_}:{kind:"camera",minZoom:I,maxZoom:P,minSize:h.evaluate(new Er(I)),maxSize:h.evaluate(new Er(P)),interpolationType:_}}}function f0(u,s,h){let p="never";const _=u.get(s);return _?p=_:u.get(h)&&(p="always"),p}const uP=Bu.VectorTileFeature.types,cP=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Pg(u,s,h,p,_,x,w,I,P,D,F,V,H){const Y=I?Math.min(Uu,Math.round(I[0])):0,J=I?Math.min(Uu,Math.round(I[1])):0;u.emplaceBack(s,h,Math.round(32*p),Math.round(32*_),x,w,(Y<<1)+(P?1:0),J,16*D,16*F,256*V,256*H)}function p0(u,s,h){u.emplaceBack(s.x,s.y,h),u.emplaceBack(s.x,s.y,h),u.emplaceBack(s.x,s.y,h),u.emplaceBack(s.x,s.y,h)}function hP(u){for(const s of u.sections)if(qy(s.text))return!0;return!1}class d0{constructor(s){this.layoutVertexArray=new Ue,this.indexArray=new $e,this.programConfigurations=s,this.segments=new dt,this.dynamicLayoutVertexArray=new xe,this.opacityVertexArray=new De,this.hasVisibleVertices=!1,this.placedSymbolArray=new f}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(s,h,p,_){this.isEmpty()||(p&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,jL.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,GL.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,cP,!0),this.opacityVertexBuffer.itemSize=1),(p||_)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Pt("SymbolBuffers",d0);class m0{constructor(s,h,p){this.layoutVertexArray=new s,this.layoutAttributes=h,this.indexArray=new p,this.segments=new dt,this.collisionVertexArray=new He}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,qL.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Pt("CollisionBuffers",m0);class df{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(w=>w.id),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Hy([]),this.placementViewportMatrix=Hy([]);const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=lx(this.zoom,h["text-size"]),this.iconSizeData=lx(this.zoom,h["icon-size"]);const p=this.layers[0].layout,_=p.get("symbol-sort-key"),x=p.get("symbol-z-order");this.canOverlap=f0(p,"text-overlap","text-allow-overlap")!=="never"||f0(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&!_.isConstant(),this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(w=>c.ah[w])),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.sourceID=s.sourceID}createArrays(){this.text=new d0(new Ar(this.layers,this.zoom,s=>/^text/.test(s))),this.icon=new d0(new Ar(this.layers,this.zoom,s=>/^icon/.test(s))),this.glyphOffsetArray=new b,this.lineVertexArray=new T,this.symbolInstances=new g,this.textAnchorOffsets=new k}calculateGlyphDependencies(s,h,p,_,x){for(let w=0;w<s.length;w++)if(h[s.charCodeAt(w)]=!0,(p||_)&&x){const I=md[s.charAt(w)];I&&(h[I.charCodeAt(0)]=!0)}}populate(s,h,p){const _=this.layers[0],x=_.layout,w=x.get("text-font"),I=x.get("text-field"),P=x.get("icon-image"),D=(I.value.kind!=="constant"||I.value.value instanceof Wo&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),F=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,V=x.get("symbol-sort-key");if(this.features=[],!D&&!F)return;const H=h.iconDependencies,Y=h.glyphDependencies,J=h.availableImages,ie=new Er(this.zoom);for(const{feature:ge,id:we,index:Ne,sourceLayerIndex:Ee}of s){const Ae=_._featureFilter.needGeometry,Qe=Ql(ge,Ae);if(!_._featureFilter.filter(ie,Qe,p))continue;let et,Ct;if(Ae||(Qe.geometry=Jl(ge)),D){const It=_.getValueAndResolveTokens("text-field",Qe,p,J),xt=Wo.factory(It),ht=this.hasRTLText=this.hasRTLText||hP(xt);(!ht||pl.getRTLTextPluginStatus()==="unavailable"||ht&&pl.isParsed())&&(et=HL(xt,_,Qe))}if(F){const It=_.getValueAndResolveTokens("icon-image",Qe,p,J);Ct=It instanceof ds?It:ds.fromString(It)}if(!et&&!Ct)continue;const zt=this.sortFeaturesByKey?V.evaluate(Qe,{},p):void 0;if(this.features.push({id:we,text:et,icon:Ct,index:Ne,sourceLayerIndex:Ee,geometry:Qe.geometry,properties:ge.properties,type:uP[ge.type],sortKey:zt}),Ct&&(H[Ct.name]=!0),et){const It=w.evaluate(Qe,{},p).join(","),xt=x.get("text-rotation-alignment")!=="viewport"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(c.ah.vertical)>=0;for(const ht of et.sections)if(ht.image)H[ht.image.name]=!0;else{const kt=zu(et.toString()),yt=ht.fontStack||It,st=Y[yt]=Y[yt]||{};this.calculateGlyphDependencies(ht.text,st,xt,this.allowVerticalPlacement,kt)}}}x.get("symbol-placement")==="line"&&(this.features=function(ge){const we={},Ne={},Ee=[];let Ae=0;function Qe(It){Ee.push(ge[It]),Ae++}function et(It,xt,ht){const kt=Ne[It];return delete Ne[It],Ne[xt]=kt,Ee[kt].geometry[0].pop(),Ee[kt].geometry[0]=Ee[kt].geometry[0].concat(ht[0]),kt}function Ct(It,xt,ht){const kt=we[xt];return delete we[xt],we[It]=kt,Ee[kt].geometry[0].shift(),Ee[kt].geometry[0]=ht[0].concat(Ee[kt].geometry[0]),kt}function zt(It,xt,ht){const kt=ht?xt[0][xt[0].length-1]:xt[0][0];return`${It}:${kt.x}:${kt.y}`}for(let It=0;It<ge.length;It++){const xt=ge[It],ht=xt.geometry,kt=xt.text?xt.text.toString():null;if(!kt){Qe(It);continue}const yt=zt(kt,ht),st=zt(kt,ht,!0);if(yt in Ne&&st in we&&Ne[yt]!==we[st]){const Yt=Ct(yt,st,ht),Vt=et(yt,st,Ee[Yt].geometry);delete we[yt],delete Ne[st],Ne[zt(kt,Ee[Vt].geometry,!0)]=Vt,Ee[Yt].geometry=null}else yt in Ne?et(yt,st,ht):st in we?Ct(yt,st,ht):(Qe(It),we[yt]=Ae-1,Ne[st]=Ae-1)}return Ee.filter(It=>It.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ge,we)=>ge.sortKey-we.sortKey)}update(s,h,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,h,this.layers,p),this.icon.programConfigurations.updatePaintArrays(s,h,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,h){const p=this.lineVertexArray.length;if(s.segment!==void 0){let _=s.dist(h[s.segment+1]),x=s.dist(h[s.segment]);const w={};for(let I=s.segment+1;I<h.length;I++)w[I]={x:h[I].x,y:h[I].y,tileUnitDistanceFromAnchor:_},I<h.length-1&&(_+=h[I+1].dist(h[I]));for(let I=s.segment||0;I>=0;I--)w[I]={x:h[I].x,y:h[I].y,tileUnitDistanceFromAnchor:x},I>0&&(x+=h[I-1].dist(h[I]));for(let I=0;I<h.length;I++){const P=w[I];this.lineVertexArray.emplaceBack(P.x,P.y,P.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(s,h,p,_,x,w,I,P,D,F,V,H){const Y=s.indexArray,J=s.layoutVertexArray,ie=s.segments.prepareSegment(4*h.length,J,Y,this.canOverlap?w.sortKey:void 0),ge=this.glyphOffsetArray.length,we=ie.vertexLength,Ne=this.allowVerticalPlacement&&I===c.ah.vertical?Math.PI/2:0,Ee=w.text&&w.text.sections;for(let Ae=0;Ae<h.length;Ae++){const{tl:Qe,tr:et,bl:Ct,br:zt,tex:It,pixelOffsetTL:xt,pixelOffsetBR:ht,minFontScaleX:kt,minFontScaleY:yt,glyphOffset:st,isSDF:Yt,sectionIndex:Vt}=h[Ae],Pn=ie.vertexLength,xr=st[1];Pg(J,P.x,P.y,Qe.x,xr+Qe.y,It.x,It.y,p,Yt,xt.x,xt.y,kt,yt),Pg(J,P.x,P.y,et.x,xr+et.y,It.x+It.w,It.y,p,Yt,ht.x,xt.y,kt,yt),Pg(J,P.x,P.y,Ct.x,xr+Ct.y,It.x,It.y+It.h,p,Yt,xt.x,ht.y,kt,yt),Pg(J,P.x,P.y,zt.x,xr+zt.y,It.x+It.w,It.y+It.h,p,Yt,ht.x,ht.y,kt,yt),p0(s.dynamicLayoutVertexArray,P,Ne),Y.emplaceBack(Pn,Pn+1,Pn+2),Y.emplaceBack(Pn+1,Pn+2,Pn+3),ie.vertexLength+=4,ie.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(st[0]),Ae!==h.length-1&&Vt===h[Ae+1].sectionIndex||s.programConfigurations.populatePaintArrays(J.length,w,w.index,{},H,Ee&&Ee[Vt])}s.placedSymbolArray.emplaceBack(P.x,P.y,ge,this.glyphOffsetArray.length-ge,we,D,F,P.segment,p?p[0]:0,p?p[1]:0,_[0],_[1],I,0,!1,0,V)}_addCollisionDebugVertex(s,h,p,_,x,w){return h.emplaceBack(0,0),s.emplaceBack(p.x,p.y,_,x,Math.round(w.x),Math.round(w.y))}addCollisionDebugVertices(s,h,p,_,x,w,I){const P=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),D=P.vertexLength,F=x.layoutVertexArray,V=x.collisionVertexArray,H=I.anchorX,Y=I.anchorY;this._addCollisionDebugVertex(F,V,w,H,Y,new E(s,h)),this._addCollisionDebugVertex(F,V,w,H,Y,new E(p,h)),this._addCollisionDebugVertex(F,V,w,H,Y,new E(p,_)),this._addCollisionDebugVertex(F,V,w,H,Y,new E(s,_)),P.vertexLength+=4;const J=x.indexArray;J.emplaceBack(D,D+1),J.emplaceBack(D+1,D+2),J.emplaceBack(D+2,D+3),J.emplaceBack(D+3,D),P.primitiveLength+=4}addDebugCollisionBoxes(s,h,p,_){for(let x=s;x<h;x++){const w=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(w.x1,w.y1,w.x2,w.y2,_?this.textCollisionBox:this.iconCollisionBox,w.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new m0(qe,Hb.members,it),this.iconCollisionBox=new m0(qe,Hb.members,it);for(let s=0;s<this.symbolInstances.length;s++){const h=this.symbolInstances.get(s);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(s,h,p,_,x,w,I,P,D){const F={};for(let V=h;V<p;V++){const H=s.get(V);F.textBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},F.textFeatureIndex=H.featureIndex;break}for(let V=_;V<x;V++){const H=s.get(V);F.verticalTextBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},F.verticalTextFeatureIndex=H.featureIndex;break}for(let V=w;V<I;V++){const H=s.get(V);F.iconBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},F.iconFeatureIndex=H.featureIndex;break}for(let V=P;V<D;V++){const H=s.get(V);F.verticalIconBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},F.verticalIconFeatureIndex=H.featureIndex;break}return F}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(s,h){const p=s.placedSymbolArray.get(h),_=p.vertexStartIndex+4*p.numGlyphs;for(let x=p.vertexStartIndex;x<_;x+=4)s.indexArray.emplaceBack(x,x+1,x+2),s.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(s),p=Math.cos(s),_=[],x=[],w=[];for(let I=0;I<this.symbolInstances.length;++I){w.push(I);const P=this.symbolInstances.get(I);_.push(0|Math.round(h*P.anchorX+p*P.anchorY)),x.push(P.featureIndex)}return w.sort((I,P)=>_[I]-_[P]||x[P]-x[I]),w}addToSortKeyRanges(s,h){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===h?p.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const p=this.symbolInstances.get(h);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((_,x,w)=>{_>=0&&w.indexOf(_)===x&&this.addIndicesForPlacedSymbol(this.text,_)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ux,cx;Pt("SymbolBucket",df,{omit:["layers","collisionBoxArray","features","compareText"]}),df.MAX_GLYPHS=65535,df.addDynamicAttributes=p0;var g0={get paint(){return cx=cx||new Mo({"icon-opacity":new $t(me.paint_symbol["icon-opacity"]),"icon-color":new $t(me.paint_symbol["icon-color"]),"icon-halo-color":new $t(me.paint_symbol["icon-halo-color"]),"icon-halo-width":new $t(me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new $t(me.paint_symbol["icon-halo-blur"]),"icon-translate":new jt(me.paint_symbol["icon-translate"]),"icon-translate-anchor":new jt(me.paint_symbol["icon-translate-anchor"]),"text-opacity":new $t(me.paint_symbol["text-opacity"]),"text-color":new $t(me.paint_symbol["text-color"],{runtimeType:Zr,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new $t(me.paint_symbol["text-halo-color"]),"text-halo-width":new $t(me.paint_symbol["text-halo-width"]),"text-halo-blur":new $t(me.paint_symbol["text-halo-blur"]),"text-translate":new jt(me.paint_symbol["text-translate"]),"text-translate-anchor":new jt(me.paint_symbol["text-translate-anchor"])})},get layout(){return ux=ux||new Mo({"symbol-placement":new jt(me.layout_symbol["symbol-placement"]),"symbol-spacing":new jt(me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new jt(me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new $t(me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new jt(me.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new jt(me.layout_symbol["icon-allow-overlap"]),"icon-overlap":new jt(me.layout_symbol["icon-overlap"]),"icon-ignore-placement":new jt(me.layout_symbol["icon-ignore-placement"]),"icon-optional":new jt(me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new jt(me.layout_symbol["icon-rotation-alignment"]),"icon-size":new $t(me.layout_symbol["icon-size"]),"icon-text-fit":new jt(me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new jt(me.layout_symbol["icon-text-fit-padding"]),"icon-image":new $t(me.layout_symbol["icon-image"]),"icon-rotate":new $t(me.layout_symbol["icon-rotate"]),"icon-padding":new $t(me.layout_symbol["icon-padding"]),"icon-keep-upright":new jt(me.layout_symbol["icon-keep-upright"]),"icon-offset":new $t(me.layout_symbol["icon-offset"]),"icon-anchor":new $t(me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new jt(me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new jt(me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new jt(me.layout_symbol["text-rotation-alignment"]),"text-field":new $t(me.layout_symbol["text-field"]),"text-font":new $t(me.layout_symbol["text-font"]),"text-size":new $t(me.layout_symbol["text-size"]),"text-max-width":new $t(me.layout_symbol["text-max-width"]),"text-line-height":new jt(me.layout_symbol["text-line-height"]),"text-letter-spacing":new $t(me.layout_symbol["text-letter-spacing"]),"text-justify":new $t(me.layout_symbol["text-justify"]),"text-radial-offset":new $t(me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new jt(me.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new $t(me.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new $t(me.layout_symbol["text-anchor"]),"text-max-angle":new jt(me.layout_symbol["text-max-angle"]),"text-writing-mode":new jt(me.layout_symbol["text-writing-mode"]),"text-rotate":new $t(me.layout_symbol["text-rotate"]),"text-padding":new jt(me.layout_symbol["text-padding"]),"text-keep-upright":new jt(me.layout_symbol["text-keep-upright"]),"text-transform":new $t(me.layout_symbol["text-transform"]),"text-offset":new $t(me.layout_symbol["text-offset"]),"text-allow-overlap":new jt(me.layout_symbol["text-allow-overlap"]),"text-overlap":new jt(me.layout_symbol["text-overlap"]),"text-ignore-placement":new jt(me.layout_symbol["text-ignore-placement"]),"text-optional":new jt(me.layout_symbol["text-optional"])})}};class hx{constructor(s){if(s.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=s.property.overrides?s.property.overrides.runtimeType:li,this.defaultValue=s}evaluate(s){if(s.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(s.formattedSection))return h.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Pt("FormatSectionOverride",hx,{omit:["defaultValue"]});class Mg extends Ds{constructor(s){super(s,g0)}recalculate(s,h){if(super.recalculate(s,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const _=[];for(const x of p)_.indexOf(x)<0&&_.push(x);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(s,h,p,_){const x=this.layout.get(s).evaluate(h,{},p,_),w=this._unevaluatedLayout._values[s];return w.isDataDriven()||ur(w.value)||!x?x:function(I,P){return P.replace(/{([^{}]+)}/g,(D,F)=>I&&F in I?String(I[F]):"")}(h.properties,x)}createBucket(s){return new df(s)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const s of g0.paint.overridableProperties){if(!Mg.hasPaintOverride(this.layout,s))continue;const h=this.paint.get(s),p=new hx(h),_=new br(p,h.property.specification);let x=null;x=h.value.kind==="constant"||h.value.kind==="source"?new Oh("source",_):new Np("composite",_,h.value.zoomStops),this.paint._values[s]=new As(h.property,x,h.parameters)}}_handleOverridablePaintPropertyUpdate(s,h,p){return!(!this.layout||h.isDataDriven()||p.isDataDriven())&&Mg.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,h){const p=s.get("text-field"),_=g0.paint.properties[h];let x=!1;const w=I=>{for(const P of I)if(_.overrides&&_.overrides.hasOverride(P))return void(x=!0)};if(p.value.kind==="constant"&&p.value.value instanceof Wo)w(p.value.value.sections);else if(p.value.kind==="source"){const I=D=>{x||(D instanceof ll&&ci(D.value)===Jr?w(D.value.sections):D instanceof Rh?w(D.sections):D.eachChild(I))},P=p.value;P._styleExpression&&I(P._styleExpression.expression)}return x}}let fx;var fP={get paint(){return fx=fx||new Mo({"background-color":new jt(me.paint_background["background-color"]),"background-pattern":new Oc(me.paint_background["background-pattern"]),"background-opacity":new jt(me.paint_background["background-opacity"])})}};class pP extends Ds{constructor(s){super(s,fP)}}let px;var dP={get paint(){return px=px||new Mo({"raster-opacity":new jt(me.paint_raster["raster-opacity"]),"raster-hue-rotate":new jt(me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new jt(me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new jt(me.paint_raster["raster-brightness-max"]),"raster-saturation":new jt(me.paint_raster["raster-saturation"]),"raster-contrast":new jt(me.paint_raster["raster-contrast"]),"raster-resampling":new jt(me.paint_raster["raster-resampling"]),"raster-fade-duration":new jt(me.paint_raster["raster-fade-duration"])})}};class mP extends Ds{constructor(s){super(s,dP)}}class gP extends Ds{constructor(s){super(s,{}),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=s}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class _P{constructor(s){this._methodToThrottle=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const _0=63710088e-1;class ju{constructor(s,h){if(isNaN(s)||isNaN(h))throw new Error(`Invalid LngLat object: (${s}, ${h})`);if(this.lng=+s,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ju(ue(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const h=Math.PI/180,p=this.lat*h,_=s.lat*h,x=Math.sin(p)*Math.sin(_)+Math.cos(p)*Math.cos(_)*Math.cos((s.lng-this.lng)*h);return _0*Math.acos(Math.min(x,1))}static convert(s){if(s instanceof ju)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new ju(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new ju(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const dx=2*Math.PI*_0;function mx(u){return dx*Math.cos(u*Math.PI/180)}function gx(u){return(180+u)/360}function _x(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function yx(u,s){return u/mx(s)}function y0(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}class kg{constructor(s,h,p=0){this.x=+s,this.y=+h,this.z=+p}static fromLngLat(s,h=0){const p=ju.convert(s);return new kg(gx(p.lng),_x(p.lat),yx(h,p.lat))}toLngLat(){return new ju(360*this.x-180,y0(this.y))}toAltitude(){return this.z*mx(y0(this.y))}meterInMercatorCoordinateUnits(){return 1/dx*(s=y0(this.y),1/Math.cos(s*Math.PI/180));var s}}function vx(u,s,h){var p=2*Math.PI*6378137/256/Math.pow(2,h);return[u*p-2*Math.PI*6378137/2,s*p-2*Math.PI*6378137/2]}class v0{constructor(s,h,p){if(s<0||s>25||p<0||p>=Math.pow(2,s)||h<0||h>=Math.pow(2,s))throw new Error(`x=${h}, y=${p}, z=${s} outside of bounds. 0<=x<${Math.pow(2,s)}, 0<=y<${Math.pow(2,s)} 0<=z<=25 `);this.z=s,this.x=h,this.y=p,this.key=vd(0,s,s,h,p)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,h,p){const _=(w=this.y,I=this.z,P=vx(256*(x=this.x),256*(w=Math.pow(2,I)-w-1),I),D=vx(256*(x+1),256*(w+1),I),P[0]+","+P[1]+","+D[0]+","+D[1]);var x,w,I,P,D;const F=function(V,H,Y){let J,ie="";for(let ge=V;ge>0;ge--)J=1<<ge-1,ie+=(H&J?1:0)+(Y&J?2:0);return ie}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,F).replace(/{bbox-epsg-3857}/g,_)}isChildOf(s){const h=this.z-s.z;return h>0&&s.x===this.x>>h&&s.y===this.y>>h}getTilePoint(s){const h=Math.pow(2,this.z);return new E((s.x*h-this.x)*Xr,(s.y*h-this.y)*Xr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class bx{constructor(s,h){this.wrap=s,this.canonical=h,this.key=vd(s,h.z,h.z,h.x,h.y)}}class Ns{constructor(s,h,p,_,x){if(s<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${s}; z = ${p}`);this.overscaledZ=s,this.wrap=h,this.canonical=new v0(p,+_,+x),this.key=vd(h,s,p,_,x)}clone(){return new Ns(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-s;return s>this.canonical.z?new Ns(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ns(s,this.wrap,s,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(s,h){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-s;return s>this.canonical.z?vd(this.wrap*+h,s,this.canonical.z,this.canonical.x,this.canonical.y):vd(this.wrap*+h,s,s,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(s){if(s.wrap!==this.wrap)return!1;const h=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.x===this.canonical.x>>h&&s.canonical.y===this.canonical.y>>h}children(s){if(this.overscaledZ>=s)return[new Ns(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,p=2*this.canonical.x,_=2*this.canonical.y;return[new Ns(h,this.wrap,h,p,_),new Ns(h,this.wrap,h,p+1,_),new Ns(h,this.wrap,h,p,_+1),new Ns(h,this.wrap,h,p+1,_+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new Ns(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new Ns(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new bx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(s){return this.canonical.getTilePoint(new kg(s.x-this.wrap,s.y))}}function vd(u,s,h,p,_){(u*=2)<0&&(u=-1*u-1);const x=1<<h;return(x*x*u+x*_+p).toString(36)+h.toString(36)+s.toString(36)}Pt("CanonicalTileID",v0),Pt("OverscaledTileID",Ns,{omit:["posMatrix"]});class xx{constructor(s,h,p,_=1,x=1,w=1,I=0){if(this.uid=s,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void Ge(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=h.height;const P=this.dim=h.height-2;switch(this.data=new Uint32Array(h.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=_,this.greenFactor=x,this.blueFactor=w,this.baseShift=I;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let D=0;D<P;D++)this.data[this._idx(-1,D)]=this.data[this._idx(0,D)],this.data[this._idx(P,D)]=this.data[this._idx(P-1,D)],this.data[this._idx(D,-1)]=this.data[this._idx(D,0)],this.data[this._idx(D,P)]=this.data[this._idx(D,P-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(P,-1)]=this.data[this._idx(P-1,0)],this.data[this._idx(-1,P)]=this.data[this._idx(0,P-1)],this.data[this._idx(P,P)]=this.data[this._idx(P-1,P-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let D=0;D<P;D++)for(let F=0;F<P;F++){const V=this.get(D,F);V>this.max&&(this.max=V),V<this.min&&(this.min=V)}}get(s,h){const p=new Uint8Array(this.data.buffer),_=4*this._idx(s,h);return this.unpack(p[_],p[_+1],p[_+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(s,h){if(s<-1||s>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(s+1)}unpack(s,h,p){return s*this.redFactor+h*this.greenFactor+p*this.blueFactor-this.baseShift}getPixels(){return new Rs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(s,h,p){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let _=h*this.dim,x=h*this.dim+this.dim,w=p*this.dim,I=p*this.dim+this.dim;switch(h){case-1:_=x-1;break;case 1:x=_+1}switch(p){case-1:w=I-1;break;case 1:I=w+1}const P=-h*this.dim,D=-p*this.dim;for(let F=w;F<I;F++)for(let V=_;V<x;V++)this.data[this._idx(V,F)]=s.data[this._idx(V+P,F+D)]}}Pt("DEMData",xx);class wx{constructor(s){this._stringToNumber={},this._numberToString=[];for(let h=0;h<s.length;h++){const p=s[h];this._stringToNumber[p]=h,this._numberToString[h]=p}}encode(s){return this._stringToNumber[s]}decode(s){if(s>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${s} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[s]}}class Sx{constructor(s,h,p,_,x){this.type="Feature",this._vectorTileFeature=s,s._z=h,s._x=p,s._y=_,this.properties=s.properties,this.id=x}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={geometry:this.geometry};for(const h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(s[h]=this[h]);return s}}class Ex{constructor(s,h){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new Dc(Xr,16,0),this.grid3D=new Dc(Xr,16,0),this.featureIndexArray=new j,this.promoteId=h}insert(s,h,p,_,x,w){const I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,_,x);const P=w?this.grid3D:this.grid;for(let D=0;D<h.length;D++){const F=h[D],V=[1/0,1/0,-1/0,-1/0];for(let H=0;H<F.length;H++){const Y=F[H];V[0]=Math.min(V[0],Y.x),V[1]=Math.min(V[1],Y.y),V[2]=Math.max(V[2],Y.x),V[3]=Math.max(V[3],Y.y)}V[0]<Xr&&V[1]<Xr&&V[2]>=0&&V[3]>=0&&P.insert(I,V[0],V[1],V[2],V[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Bu.VectorTile(new a0(this.rawTileData)).layers,this.sourceLayerCoder=new wx(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(s,h,p,_){this.loadVTLayers();const x=s.params||{},w=Xr/s.tileSize/s.scale,I=Vh(x.filter),P=s.queryGeometry,D=s.queryPadding*w,F=Cx(P),V=this.grid.query(F.minX-D,F.minY-D,F.maxX+D,F.maxY+D),H=Cx(s.cameraQueryGeometry),Y=this.grid3D.query(H.minX-D,H.minY-D,H.maxX+D,H.maxY+D,(ge,we,Ne,Ee)=>function(Ae,Qe,et,Ct,zt){for(const xt of Ae)if(Qe<=xt.x&&et<=xt.y&&Ct>=xt.x&&zt>=xt.y)return!0;const It=[new E(Qe,et),new E(Qe,zt),new E(Ct,zt),new E(Ct,et)];if(Ae.length>2){for(const xt of It)if(af(Ae,xt))return!0}for(let xt=0;xt<Ae.length-1;xt++)if(YT(Ae[xt],Ae[xt+1],It))return!0;return!1}(s.cameraQueryGeometry,ge-D,we-D,Ne+D,Ee+D));for(const ge of Y)V.push(ge);V.sort(yP);const J={};let ie;for(let ge=0;ge<V.length;ge++){const we=V[ge];if(we===ie)continue;ie=we;const Ne=this.featureIndexArray.get(we);let Ee=null;this.loadMatchingFeature(J,Ne.bucketIndex,Ne.sourceLayerIndex,Ne.featureIndex,I,x.layers,x.availableImages,h,p,_,(Ae,Qe,et)=>(Ee||(Ee=Jl(Ae)),Qe.queryIntersectsFeature(P,Ae,et,Ee,this.z,s.transform,w,s.pixelPosMatrix)))}return J}loadMatchingFeature(s,h,p,_,x,w,I,P,D,F,V){const H=this.bucketLayerIDs[h];if(w&&!function(ge,we){for(let Ne=0;Ne<ge.length;Ne++)if(we.indexOf(ge[Ne])>=0)return!0;return!1}(w,H))return;const Y=this.sourceLayerCoder.decode(p),J=this.vtLayers[Y].feature(_);if(x.needGeometry){const ge=Ql(J,!0);if(!x.filter(new Er(this.tileID.overscaledZ),ge,this.tileID.canonical))return}else if(!x.filter(new Er(this.tileID.overscaledZ),J))return;const ie=this.getId(J,Y);for(let ge=0;ge<H.length;ge++){const we=H[ge];if(w&&w.indexOf(we)<0)continue;const Ne=P[we];if(!Ne)continue;let Ee={};ie&&F&&(Ee=F.getState(Ne.sourceLayer||"_geojsonTileLayer",ie));const Ae=ae({},D[we]);Ae.paint=Ix(Ae.paint,Ne.paint,J,Ee,I),Ae.layout=Ix(Ae.layout,Ne.layout,J,Ee,I);const Qe=!V||V(J,Ne,Ee);if(!Qe)continue;const et=new Sx(J,this.z,this.x,this.y,ie);et.layer=Ae;let Ct=s[we];Ct===void 0&&(Ct=s[we]=[]),Ct.push({featureIndex:_,feature:et,intersectionZ:Qe})}}lookupSymbolFeatures(s,h,p,_,x,w,I,P){const D={};this.loadVTLayers();const F=Vh(x);for(const V of s)this.loadMatchingFeature(D,p,_,V,F,w,I,P,h);return D}hasLayer(s){for(const h of this.bucketLayerIDs)for(const p of h)if(s===p)return!0;return!1}getId(s,h){let p=s.id;return this.promoteId&&(p=s.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]],typeof p=="boolean"&&(p=Number(p))),p}}function Ix(u,s,h,p,_){return fe(u,(x,w)=>{const I=s instanceof Nc?s.get(w):null;return I&&I.evaluate?I.evaluate(h,p,_):I})}function Cx(u){let s=1/0,h=1/0,p=-1/0,_=-1/0;for(const x of u)s=Math.min(s,x.x),h=Math.min(h,x.y),p=Math.max(p,x.x),_=Math.max(_,x.y);return{minX:s,minY:h,maxX:p,maxY:_}}function yP(u,s){return s-u}function Tx(u,s,h,p,_){const x=[];for(let w=0;w<u.length;w++){const I=u[w];let P;for(let D=0;D<I.length-1;D++){let F=I[D],V=I[D+1];F.x<s&&V.x<s||(F.x<s?F=new E(s,F.y+(s-F.x)/(V.x-F.x)*(V.y-F.y))._round():V.x<s&&(V=new E(s,F.y+(s-F.x)/(V.x-F.x)*(V.y-F.y))._round()),F.y<h&&V.y<h||(F.y<h?F=new E(F.x+(h-F.y)/(V.y-F.y)*(V.x-F.x),h)._round():V.y<h&&(V=new E(F.x+(h-F.y)/(V.y-F.y)*(V.x-F.x),h)._round()),F.x>=p&&V.x>=p||(F.x>=p?F=new E(p,F.y+(p-F.x)/(V.x-F.x)*(V.y-F.y))._round():V.x>=p&&(V=new E(p,F.y+(p-F.x)/(V.x-F.x)*(V.y-F.y))._round()),F.y>=_&&V.y>=_||(F.y>=_?F=new E(F.x+(_-F.y)/(V.y-F.y)*(V.x-F.x),_)._round():V.y>=_&&(V=new E(F.x+(_-F.y)/(V.y-F.y)*(V.x-F.x),_)._round()),P&&F.equals(P[P.length-1])||(P=[F],x.push(P)),P.push(V)))))}}return x}Pt("FeatureIndex",Ex,{omit:["rawTileData","sourceLayerCoder"]});class Gu extends E{constructor(s,h,p,_){super(s,h),this.angle=p,_!==void 0&&(this.segment=_)}clone(){return new Gu(this.x,this.y,this.angle,this.segment)}}function Lx(u,s,h,p,_){if(s.segment===void 0||h===0)return!0;let x=s,w=s.segment+1,I=0;for(;I>-h/2;){if(w--,w<0)return!1;I-=u[w].dist(x),x=u[w]}I+=u[w].dist(u[w+1]),w++;const P=[];let D=0;for(;I<h/2;){const F=u[w],V=u[w+1];if(!V)return!1;let H=u[w-1].angleTo(F)-F.angleTo(V);for(H=Math.abs((H+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:I,angleDelta:H}),D+=H;I-P[0].distance>p;)D-=P.shift().angleDelta;if(D>_)return!1;w++,I+=F.dist(V)}return!0}function Px(u){let s=0;for(let h=0;h<u.length-1;h++)s+=u[h].dist(u[h+1]);return s}function Mx(u,s,h){return u?.6*s*h:0}function kx(u,s){return Math.max(u?u.right-u.left:0,s?s.right-s.left:0)}function vP(u,s,h,p,_,x){const w=Mx(h,_,x),I=kx(h,p)*x;let P=0;const D=Px(u)/2;for(let F=0;F<u.length-1;F++){const V=u[F],H=u[F+1],Y=V.dist(H);if(P+Y>D){const J=(D-P)/Y,ie=mo.number(V.x,H.x,J),ge=mo.number(V.y,H.y,J),we=new Gu(ie,ge,H.angleTo(V),F);return we._round(),!w||Lx(u,we,I,w,s)?we:void 0}P+=Y}}function bP(u,s,h,p,_,x,w,I,P){const D=Mx(p,x,w),F=kx(p,_),V=F*w,H=u[0].x===0||u[0].x===P||u[0].y===0||u[0].y===P;return s-V<s/4&&(s=V+s/4),Ax(u,H?s/2*I%s:(F/2+2*x)*w*I%s,s,D,h,V,H,!1,P)}function Ax(u,s,h,p,_,x,w,I,P){const D=x/2,F=Px(u);let V=0,H=s-h,Y=[];for(let J=0;J<u.length-1;J++){const ie=u[J],ge=u[J+1],we=ie.dist(ge),Ne=ge.angleTo(ie);for(;H+h<V+we;){H+=h;const Ee=(H-V)/we,Ae=mo.number(ie.x,ge.x,Ee),Qe=mo.number(ie.y,ge.y,Ee);if(Ae>=0&&Ae<P&&Qe>=0&&Qe<P&&H-D>=0&&H+D<=F){const et=new Gu(Ae,Qe,Ne,J);et._round(),p&&!Lx(u,et,x,p,_)||Y.push(et)}}V+=we}return I||Y.length||w||(Y=Ax(u,V/2,h,p,_,x,w,!0,P)),Y}Pt("Anchor",Gu);const mf=$o;function Dx(u,s,h,p){const _=[],x=u.image,w=x.pixelRatio,I=x.paddedRect.w-2*mf,P=x.paddedRect.h-2*mf,D=u.right-u.left,F=u.bottom-u.top,V=x.stretchX||[[0,I]],H=x.stretchY||[[0,P]],Y=(ht,kt)=>ht+kt[1]-kt[0],J=V.reduce(Y,0),ie=H.reduce(Y,0),ge=I-J,we=P-ie;let Ne=0,Ee=J,Ae=0,Qe=ie,et=0,Ct=ge,zt=0,It=we;if(x.content&&p){const ht=x.content;Ne=Ag(V,0,ht[0]),Ae=Ag(H,0,ht[1]),Ee=Ag(V,ht[0],ht[2]),Qe=Ag(H,ht[1],ht[3]),et=ht[0]-Ne,zt=ht[1]-Ae,Ct=ht[2]-ht[0]-Ee,It=ht[3]-ht[1]-Qe}const xt=(ht,kt,yt,st)=>{const Yt=Dg(ht.stretch-Ne,Ee,D,u.left),Vt=Rg(ht.fixed-et,Ct,ht.stretch,J),Pn=Dg(kt.stretch-Ae,Qe,F,u.top),xr=Rg(kt.fixed-zt,It,kt.stretch,ie),Cr=Dg(yt.stretch-Ne,Ee,D,u.left),xi=Rg(yt.fixed-et,Ct,yt.stretch,J),_s=Dg(st.stretch-Ae,Qe,F,u.top),Ao=Rg(st.fixed-zt,It,st.stretch,ie),di=new E(Yt,Pn),Gi=new E(Cr,Pn),Qi=new E(Cr,_s),Do=new E(Yt,_s),Ro=new E(Vt/w,xr/w),wi=new E(xi/w,Ao/w),Si=s*Math.PI/180;if(Si){const yo=Math.sin(Si),Ko=Math.cos(Si),Jo=[Ko,-yo,yo,Ko];di._matMult(Jo),Gi._matMult(Jo),Do._matMult(Jo),Qi._matMult(Jo)}const _o=ht.stretch+ht.fixed,No=kt.stretch+kt.fixed;return{tl:di,tr:Gi,bl:Do,br:Qi,tex:{x:x.paddedRect.x+mf+_o,y:x.paddedRect.y+mf+No,w:yt.stretch+yt.fixed-_o,h:st.stretch+st.fixed-No},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ro,pixelOffsetBR:wi,minFontScaleX:Ct/w/D,minFontScaleY:It/w/F,isSDF:h}};if(p&&(x.stretchX||x.stretchY)){const ht=Rx(V,ge,J),kt=Rx(H,we,ie);for(let yt=0;yt<ht.length-1;yt++){const st=ht[yt],Yt=ht[yt+1];for(let Vt=0;Vt<kt.length-1;Vt++)_.push(xt(st,kt[Vt],Yt,kt[Vt+1]))}}else _.push(xt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:P+1}));return _}function Ag(u,s,h){let p=0;for(const _ of u)p+=Math.max(s,Math.min(h,_[1]))-Math.max(s,Math.min(h,_[0]));return p}function Rx(u,s,h){const p=[{fixed:-mf,stretch:0}];for(const[_,x]of u){const w=p[p.length-1];p.push({fixed:_-w.stretch,stretch:w.stretch}),p.push({fixed:_-w.stretch,stretch:w.stretch+(x-_)})}return p.push({fixed:s+mf,stretch:h}),p}function Dg(u,s,h,p){return u/s*h+p}function Rg(u,s,h,p){return u-s*h/p}class Ng{constructor(s,h,p,_,x,w,I,P,D,F){if(this.boxStartIndex=s.length,D){let V=w.top,H=w.bottom;const Y=w.collisionPadding;Y&&(V-=Y[1],H+=Y[3]);let J=H-V;J>0&&(J=Math.max(10,J),this.circleDiameter=J)}else{let V=w.top*I-P[0],H=w.bottom*I+P[2],Y=w.left*I-P[3],J=w.right*I+P[1];const ie=w.collisionPadding;if(ie&&(Y-=ie[0]*I,V-=ie[1]*I,J+=ie[2]*I,H+=ie[3]*I),F){const ge=new E(Y,V),we=new E(J,V),Ne=new E(Y,H),Ee=new E(J,H),Ae=F*Math.PI/180;ge._rotate(Ae),we._rotate(Ae),Ne._rotate(Ae),Ee._rotate(Ae),Y=Math.min(ge.x,we.x,Ne.x,Ee.x),J=Math.max(ge.x,we.x,Ne.x,Ee.x),V=Math.min(ge.y,we.y,Ne.y,Ee.y),H=Math.max(ge.y,we.y,Ne.y,Ee.y)}s.emplaceBack(h.x,h.y,Y,V,J,H,p,_,x)}this.boxEndIndex=s.length}}class xP{constructor(s=[],h=wP){if(this.data=s,this.length=this.data.length,this.compare=h,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(s){this.data.push(s),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const s=this.data[0],h=this.data.pop();return this.length--,this.length>0&&(this.data[0]=h,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:h,compare:p}=this,_=h[s];for(;s>0;){const x=s-1>>1,w=h[x];if(p(_,w)>=0)break;h[s]=w,s=x}h[s]=_}_down(s){const{data:h,compare:p}=this,_=this.length>>1,x=h[s];for(;s<_;){let w=1+(s<<1),I=h[w];const P=w+1;if(P<this.length&&p(h[P],I)<0&&(w=P,I=h[P]),p(I,x)>=0)break;h[s]=I,s=w}h[s]=x}}function wP(u,s){return u<s?-1:u>s?1:0}function SP(u,s=1,h=!1){let p=1/0,_=1/0,x=-1/0,w=-1/0;const I=u[0];for(let Y=0;Y<I.length;Y++){const J=I[Y];(!Y||J.x<p)&&(p=J.x),(!Y||J.y<_)&&(_=J.y),(!Y||J.x>x)&&(x=J.x),(!Y||J.y>w)&&(w=J.y)}const P=Math.min(x-p,w-_);let D=P/2;const F=new xP([],EP);if(P===0)return new E(p,_);for(let Y=p;Y<x;Y+=P)for(let J=_;J<w;J+=P)F.push(new gf(Y+D,J+D,D,u));let V=function(Y){let J=0,ie=0,ge=0;const we=Y[0];for(let Ne=0,Ee=we.length,Ae=Ee-1;Ne<Ee;Ae=Ne++){const Qe=we[Ne],et=we[Ae],Ct=Qe.x*et.y-et.x*Qe.y;ie+=(Qe.x+et.x)*Ct,ge+=(Qe.y+et.y)*Ct,J+=3*Ct}return new gf(ie/J,ge/J,0,Y)}(u),H=F.length;for(;F.length;){const Y=F.pop();(Y.d>V.d||!V.d)&&(V=Y,h&&console.log("found best %d after %d probes",Math.round(1e4*Y.d)/1e4,H)),Y.max-V.d<=s||(D=Y.h/2,F.push(new gf(Y.p.x-D,Y.p.y-D,D,u)),F.push(new gf(Y.p.x+D,Y.p.y-D,D,u)),F.push(new gf(Y.p.x-D,Y.p.y+D,D,u)),F.push(new gf(Y.p.x+D,Y.p.y+D,D,u)),H+=4)}return h&&(console.log(`num probes: ${H}`),console.log(`best distance: ${V.d}`)),V.p}function EP(u,s){return s.max-u.max}function gf(u,s,h,p){this.p=new E(u,s),this.h=h,this.d=function(_,x){let w=!1,I=1/0;for(let P=0;P<x.length;P++){const D=x[P];for(let F=0,V=D.length,H=V-1;F<V;H=F++){const Y=D[F],J=D[H];Y.y>_.y!=J.y>_.y&&_.x<(J.x-Y.x)*(_.y-Y.y)/(J.y-Y.y)+Y.x&&(w=!w),I=Math.min(I,_b(_,Y,J))}}return(w?1:-1)*Math.sqrt(I)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}var Ji;c.ap=void 0,(Ji=c.ap||(c.ap={}))[Ji.center=1]="center",Ji[Ji.left=2]="left",Ji[Ji.right=3]="right",Ji[Ji.top=4]="top",Ji[Ji.bottom=5]="bottom",Ji[Ji["top-left"]=6]="top-left",Ji[Ji["top-right"]=7]="top-right",Ji[Ji["bottom-left"]=8]="bottom-left",Ji[Ji["bottom-right"]=9]="bottom-right";const qu=7,b0=Number.POSITIVE_INFINITY;function Nx(u,s){return s[1]!==b0?function(h,p,_){let x=0,w=0;switch(p=Math.abs(p),_=Math.abs(_),h){case"top-right":case"top-left":case"top":w=_-qu;break;case"bottom-right":case"bottom-left":case"bottom":w=-_+qu}switch(h){case"top-right":case"bottom-right":case"right":x=-p;break;case"top-left":case"bottom-left":case"left":x=p}return[x,w]}(u,s[0],s[1]):function(h,p){let _=0,x=0;p<0&&(p=0);const w=p/Math.SQRT2;switch(h){case"top-right":case"top-left":x=w-qu;break;case"bottom-right":case"bottom-left":x=-w+qu;break;case"bottom":x=-p+qu;break;case"top":x=p-qu}switch(h){case"top-right":case"bottom-right":_=-w;break;case"top-left":case"bottom-left":_=w;break;case"left":_=p;break;case"right":_=-p}return[_,x]}(u,s[0])}function Ox(u,s,h){var p;const _=u.layout,x=(p=_.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(s,{},h);if(x){const I=x.values,P=[];for(let D=0;D<I.length;D+=2){const F=P[D]=I[D],V=I[D+1].map(H=>H*bi);F.startsWith("top")?V[1]-=qu:F.startsWith("bottom")&&(V[1]+=qu),P[D+1]=V}return new ps(P)}const w=_.get("text-variable-anchor");if(w){let I;I=u._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[_.get("text-radial-offset").evaluate(s,{},h)*bi,b0]:_.get("text-offset").evaluate(s,{},h).map(D=>D*bi);const P=[];for(const D of w)P.push(D,Nx(D,I));return new ps(P)}return null}function x0(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function IP(u,s,h,p,_,x,w,I,P,D,F){let V=x.textMaxSize.evaluate(s,{});V===void 0&&(V=w);const H=u.layers[0].layout,Y=H.get("icon-offset").evaluate(s,{},F),J=Fx(h.horizontal),ie=w/24,ge=u.tilePixelRatio*ie,we=u.tilePixelRatio*V/24,Ne=u.tilePixelRatio*I,Ee=u.tilePixelRatio*H.get("symbol-spacing"),Ae=H.get("text-padding")*u.tilePixelRatio,Qe=function(st,Yt,Vt,Pn=1){const xr=st.get("icon-padding").evaluate(Yt,{},Vt),Cr=xr&&xr.values;return[Cr[0]*Pn,Cr[1]*Pn,Cr[2]*Pn,Cr[3]*Pn]}(H,s,F,u.tilePixelRatio),et=H.get("text-max-angle")/180*Math.PI,Ct=H.get("text-rotation-alignment")!=="viewport"&&H.get("symbol-placement")!=="point",zt=H.get("icon-rotation-alignment")==="map"&&H.get("symbol-placement")!=="point",It=H.get("symbol-placement"),xt=Ee/2,ht=H.get("icon-text-fit");let kt;p&&ht!=="none"&&(u.allowVerticalPlacement&&h.vertical&&(kt=ax(p,h.vertical,ht,H.get("icon-text-fit-padding"),Y,ie)),J&&(p=ax(p,J,ht,H.get("icon-text-fit-padding"),Y,ie)));const yt=(st,Yt)=>{Yt.x<0||Yt.x>=Xr||Yt.y<0||Yt.y>=Xr||function(Vt,Pn,xr,Cr,xi,_s,Ao,di,Gi,Qi,Do,Ro,wi,Si,_o,No,yo,Ko,Jo,Ei,An,vo,eo,Ii,sa){const Va=Vt.addToLineVertexArray(Pn,xr);let Ua,tu,aa,Os,Qo=0,nu=0,wd=0,jx=0,P0=-1,M0=-1;const ru={};let Gx=Br("");if(Vt.allowVerticalPlacement&&Cr.vertical){const bo=di.layout.get("text-rotate").evaluate(An,{},Ii)+90;aa=new Ng(Gi,Pn,Qi,Do,Ro,Cr.vertical,wi,Si,_o,bo),Ao&&(Os=new Ng(Gi,Pn,Qi,Do,Ro,Ao,yo,Ko,_o,bo))}if(xi){const bo=di.layout.get("icon-rotate").evaluate(An,{}),zs=di.layout.get("icon-text-fit")!=="none",qc=Dx(xi,bo,eo,zs),Ga=Ao?Dx(Ao,bo,eo,zs):void 0;tu=new Ng(Gi,Pn,Qi,Do,Ro,xi,yo,Ko,!1,bo),Qo=4*qc.length;const Wc=Vt.iconSizeData;let yl=null;Wc.kind==="source"?(yl=[_l*di.layout.get("icon-size").evaluate(An,{})],yl[0]>Uu&&Ge(`${Vt.layerIds[0]}: Value for "icon-size" is >= ${yd}. Reduce your "icon-size".`)):Wc.kind==="composite"&&(yl=[_l*vo.compositeIconSizes[0].evaluate(An,{},Ii),_l*vo.compositeIconSizes[1].evaluate(An,{},Ii)],(yl[0]>Uu||yl[1]>Uu)&&Ge(`${Vt.layerIds[0]}: Value for "icon-size" is >= ${yd}. Reduce your "icon-size".`)),Vt.addSymbols(Vt.icon,qc,yl,Ei,Jo,An,c.ah.none,Pn,Va.lineStartIndex,Va.lineLength,-1,Ii),P0=Vt.icon.placedSymbolArray.length-1,Ga&&(nu=4*Ga.length,Vt.addSymbols(Vt.icon,Ga,yl,Ei,Jo,An,c.ah.vertical,Pn,Va.lineStartIndex,Va.lineLength,-1,Ii),M0=Vt.icon.placedSymbolArray.length-1)}const qx=Object.keys(Cr.horizontal);for(const bo of qx){const zs=Cr.horizontal[bo];if(!Ua){Gx=Br(zs.text);const Ga=di.layout.get("text-rotate").evaluate(An,{},Ii);Ua=new Ng(Gi,Pn,Qi,Do,Ro,zs,wi,Si,_o,Ga)}const qc=zs.positionedLines.length===1;if(wd+=zx(Vt,Pn,zs,_s,di,_o,An,No,Va,Cr.vertical?c.ah.horizontal:c.ah.horizontalOnly,qc?qx:[bo],ru,P0,vo,Ii),qc)break}Cr.vertical&&(jx+=zx(Vt,Pn,Cr.vertical,_s,di,_o,An,No,Va,c.ah.vertical,["vertical"],ru,M0,vo,Ii));const LP=Ua?Ua.boxStartIndex:Vt.collisionBoxArray.length,PP=Ua?Ua.boxEndIndex:Vt.collisionBoxArray.length,MP=aa?aa.boxStartIndex:Vt.collisionBoxArray.length,kP=aa?aa.boxEndIndex:Vt.collisionBoxArray.length,AP=tu?tu.boxStartIndex:Vt.collisionBoxArray.length,DP=tu?tu.boxEndIndex:Vt.collisionBoxArray.length,RP=Os?Os.boxStartIndex:Vt.collisionBoxArray.length,NP=Os?Os.boxEndIndex:Vt.collisionBoxArray.length;let ja=-1;const zg=(bo,zs)=>bo&&bo.circleDiameter?Math.max(bo.circleDiameter,zs):zs;ja=zg(Ua,ja),ja=zg(aa,ja),ja=zg(tu,ja),ja=zg(Os,ja);const Wx=ja>-1?1:0;Wx&&(ja*=sa/bi),Vt.glyphOffsetArray.length>=df.MAX_GLYPHS&&Ge("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),An.sortKey!==void 0&&Vt.addToSortKeyRanges(Vt.symbolInstances.length,An.sortKey);const OP=Ox(di,An,Ii),[zP,FP]=function(bo,zs){const qc=bo.length,Ga=zs==null?void 0:zs.values;if((Ga==null?void 0:Ga.length)>0)for(let Wc=0;Wc<Ga.length;Wc+=2){const yl=Ga[Wc+1];bo.emplaceBack(c.ap[Ga[Wc]],yl[0],yl[1])}return[qc,bo.length]}(Vt.textAnchorOffsets,OP);Vt.symbolInstances.emplaceBack(Pn.x,Pn.y,ru.right>=0?ru.right:-1,ru.center>=0?ru.center:-1,ru.left>=0?ru.left:-1,ru.vertical||-1,P0,M0,Gx,LP,PP,MP,kP,AP,DP,RP,NP,Qi,wd,jx,Qo,nu,Wx,0,wi,ja,zP,FP)}(u,Yt,st,h,p,_,kt,u.layers[0],u.collisionBoxArray,s.index,s.sourceLayerIndex,u.index,ge,[Ae,Ae,Ae,Ae],Ct,P,Ne,Qe,zt,Y,s,x,D,F,w)};if(It==="line")for(const st of Tx(s.geometry,0,0,Xr,Xr)){const Yt=bP(st,Ee,et,h.vertical||J,p,24,we,u.overscaling,Xr);for(const Vt of Yt)J&&CP(u,J.text,xt,Vt)||yt(st,Vt)}else if(It==="line-center"){for(const st of s.geometry)if(st.length>1){const Yt=vP(st,et,h.vertical||J,p,24,we);Yt&&yt(st,Yt)}}else if(s.type==="Polygon")for(const st of Qy(s.geometry,0)){const Yt=SP(st,16);yt(st[0],new Gu(Yt.x,Yt.y,0))}else if(s.type==="LineString")for(const st of s.geometry)yt(st,new Gu(st[0].x,st[0].y,0));else if(s.type==="Point")for(const st of s.geometry)for(const Yt of st)yt([Yt],new Gu(Yt.x,Yt.y,0))}function zx(u,s,h,p,_,x,w,I,P,D,F,V,H,Y,J){const ie=function(Ne,Ee,Ae,Qe,et,Ct,zt,It){const xt=Qe.layout.get("text-rotate").evaluate(Ct,{})*Math.PI/180,ht=[];for(const kt of Ee.positionedLines)for(const yt of kt.positionedGlyphs){if(!yt.rect)continue;const st=yt.rect||{};let Yt=ex+1,Vt=!0,Pn=1,xr=0;const Cr=(et||It)&&yt.vertical,xi=yt.metrics.advance*yt.scale/2;if(It&&Ee.verticalizable&&(xr=kt.lineOffset/2-(yt.imageName?-(bi-yt.metrics.width*yt.scale)/2:(yt.scale-1)*bi)),yt.imageName){const Ei=zt[yt.imageName];Vt=Ei.sdf,Pn=Ei.pixelRatio,Yt=$o/Pn}const _s=et?[yt.x+xi,yt.y]:[0,0];let Ao=et?[0,0]:[yt.x+xi+Ae[0],yt.y+Ae[1]-xr],di=[0,0];Cr&&(di=Ao,Ao=[0,0]);const Gi=yt.metrics.isDoubleResolution?2:1,Qi=(yt.metrics.left-Yt)*yt.scale-xi+Ao[0],Do=(-yt.metrics.top-Yt)*yt.scale+Ao[1],Ro=Qi+st.w/Gi*yt.scale/Pn,wi=Do+st.h/Gi*yt.scale/Pn,Si=new E(Qi,Do),_o=new E(Ro,Do),No=new E(Qi,wi),yo=new E(Ro,wi);if(Cr){const Ei=new E(-xi,xi-gd),An=-Math.PI/2,vo=bi/2-xi,eo=new E(5-gd-vo,-(yt.imageName?vo:0)),Ii=new E(...di);Si._rotateAround(An,Ei)._add(eo)._add(Ii),_o._rotateAround(An,Ei)._add(eo)._add(Ii),No._rotateAround(An,Ei)._add(eo)._add(Ii),yo._rotateAround(An,Ei)._add(eo)._add(Ii)}if(xt){const Ei=Math.sin(xt),An=Math.cos(xt),vo=[An,-Ei,Ei,An];Si._matMult(vo),_o._matMult(vo),No._matMult(vo),yo._matMult(vo)}const Ko=new E(0,0),Jo=new E(0,0);ht.push({tl:Si,tr:_o,bl:No,br:yo,tex:st,writingMode:Ee.writingMode,glyphOffset:_s,sectionIndex:yt.sectionIndex,isSDF:Vt,pixelOffsetTL:Ko,pixelOffsetBR:Jo,minFontScaleX:0,minFontScaleY:0})}return ht}(0,h,I,_,x,w,p,u.allowVerticalPlacement),ge=u.textSizeData;let we=null;ge.kind==="source"?(we=[_l*_.layout.get("text-size").evaluate(w,{})],we[0]>Uu&&Ge(`${u.layerIds[0]}: Value for "text-size" is >= ${yd}. Reduce your "text-size".`)):ge.kind==="composite"&&(we=[_l*Y.compositeTextSizes[0].evaluate(w,{},J),_l*Y.compositeTextSizes[1].evaluate(w,{},J)],(we[0]>Uu||we[1]>Uu)&&Ge(`${u.layerIds[0]}: Value for "text-size" is >= ${yd}. Reduce your "text-size".`)),u.addSymbols(u.text,ie,we,I,x,w,D,s,P.lineStartIndex,P.lineLength,H,J);for(const Ne of F)V[Ne]=u.text.placedSymbolArray.length-1;return 4*ie.length}function Fx(u){for(const s in u)return u[s];return null}function CP(u,s,h,p){const _=u.compareText;if(s in _){const x=_[s];for(let w=x.length-1;w>=0;w--)if(p.dist(x[w])<h)return!0}else _[s]=[];return _[s].push(p),!1}const Bx=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class w0{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[h,p]=new Uint8Array(s,0,2);if(h!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=p>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const x=Bx[15&p];if(!x)throw new Error("Unrecognized array type.");const[w]=new Uint16Array(s,2,1),[I]=new Uint32Array(s,4,1);return new w0(I,w,x,s)}constructor(s,h=64,p=Float64Array,_){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+h,2),65535),this.ArrayType=p,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;const x=Bx.indexOf(this.ArrayType),w=2*s*this.ArrayType.BYTES_PER_ELEMENT,I=s*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-I%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${p}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+I+P,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+w+I+P),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+I+P,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=h,new Uint32Array(this.data,4,1)[0]=s)}add(s,h){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=s,this.coords[this._pos++]=h,p}finish(){const s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return S0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,h,p,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:w,nodeSize:I}=this,P=[0,x.length-1,0],D=[];for(;P.length;){const F=P.pop()||0,V=P.pop()||0,H=P.pop()||0;if(V-H<=I){for(let ge=H;ge<=V;ge++){const we=w[2*ge],Ne=w[2*ge+1];we>=s&&we<=p&&Ne>=h&&Ne<=_&&D.push(x[ge])}continue}const Y=H+V>>1,J=w[2*Y],ie=w[2*Y+1];J>=s&&J<=p&&ie>=h&&ie<=_&&D.push(x[Y]),(F===0?s<=J:h<=ie)&&(P.push(H),P.push(Y-1),P.push(1-F)),(F===0?p>=J:_>=ie)&&(P.push(Y+1),P.push(V),P.push(1-F))}return D}within(s,h,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:x,nodeSize:w}=this,I=[0,_.length-1,0],P=[],D=p*p;for(;I.length;){const F=I.pop()||0,V=I.pop()||0,H=I.pop()||0;if(V-H<=w){for(let ge=H;ge<=V;ge++)Ux(x[2*ge],x[2*ge+1],s,h)<=D&&P.push(_[ge]);continue}const Y=H+V>>1,J=x[2*Y],ie=x[2*Y+1];Ux(J,ie,s,h)<=D&&P.push(_[Y]),(F===0?s-p<=J:h-p<=ie)&&(I.push(H),I.push(Y-1),I.push(1-F)),(F===0?s+p>=J:h+p>=ie)&&(I.push(Y+1),I.push(V),I.push(1-F))}return P}}function S0(u,s,h,p,_,x){if(_-p<=h)return;const w=p+_>>1;Vx(u,s,w,p,_,x),S0(u,s,h,p,w-1,1-x),S0(u,s,h,w+1,_,1-x)}function Vx(u,s,h,p,_,x){for(;_>p;){if(_-p>600){const D=_-p+1,F=h-p+1,V=Math.log(D),H=.5*Math.exp(2*V/3),Y=.5*Math.sqrt(V*H*(D-H)/D)*(F-D/2<0?-1:1);Vx(u,s,h,Math.max(p,Math.floor(h-F*H/D+Y)),Math.min(_,Math.floor(h+(D-F)*H/D+Y)),x)}const w=s[2*h+x];let I=p,P=_;for(bd(u,s,p,h),s[2*_+x]>w&&bd(u,s,p,_);I<P;){for(bd(u,s,I,P),I++,P--;s[2*I+x]<w;)I++;for(;s[2*P+x]>w;)P--}s[2*p+x]===w?bd(u,s,p,P):(P++,bd(u,s,P,_)),P<=h&&(p=P+1),h<=P&&(_=P-1)}}function bd(u,s,h,p){E0(u,h,p),E0(s,2*h,2*p),E0(s,2*h+1,2*p+1)}function E0(u,s,h){const p=u[s];u[s]=u[h],u[h]=p}function Ux(u,s,h,p){const _=u-h,x=s-p;return _*_+x*x}var I0;c.bd=void 0,(I0=c.bd||(c.bd={})).create="create",I0.load="load",I0.fullLoad="fullLoad";let Og=null,xd=[];const C0=1e3/60,T0="loadTime",L0="fullLoadTime",TP={mark(u){performance.mark(u)},frame(u){const s=u;Og!=null&&xd.push(s-Og),Og=s},clearMetrics(){Og=null,xd=[],performance.clearMeasures(T0),performance.clearMeasures(L0);for(const u in c.bd)performance.clearMarks(c.bd[u])},getPerformanceMetrics(){performance.measure(T0,c.bd.create,c.bd.load),performance.measure(L0,c.bd.create,c.bd.fullLoad);const u=performance.getEntriesByName(T0)[0].duration,s=performance.getEntriesByName(L0)[0].duration,h=xd.length,p=1/(xd.reduce((x,w)=>x+w,0)/h/1e3),_=xd.filter(x=>x>C0).reduce((x,w)=>x+(w-C0)/C0,0);return{loadTime:u,fullLoadTime:s,fps:p,percentDroppedFrames:_/(h+_)*100,totalFrames:h}}};c.$=dt,c.A=lf,c.B=function(u){if(At==null){const s=u.navigator?u.navigator.userAgent:null;At=!!u.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return At},c.C=class{constructor(u,s){this.target=u,this.mapId=s,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new _P(()=>this.process()),this.subscription=function(h,p,_,x){return h.addEventListener(p,_,!1),{unsubscribe:()=>{h.removeEventListener(p,_,!1)}}}(this.target,"message",h=>this.receive(h)),this.globalScope=ft(self)?u:window}registerMessageHandler(u,s){this.messageHandlers[u]=s}sendAsync(u,s){return new Promise((h,p)=>{const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[_]={resolve:h,reject:p},s&&s.signal.addEventListener("abort",()=>{delete this.resolveRejects[_];const I={id:_,type:"<cancel>",origin:location.origin,targetMapId:u.targetMapId,sourceMapId:this.mapId};this.target.postMessage(I)},{once:!0});const x=[],w=Object.assign(Object.assign({},u),{id:_,sourceMapId:this.mapId,origin:location.origin,data:Nu(u.data,x)});this.target.postMessage(w,{transfer:x})})}receive(u){const s=u.data,h=s.id;if(!(s.origin!=="file://"&&location.origin!=="file://"&&s.origin!==location.origin||s.targetMapId&&this.mapId!==s.targetMapId)){if(s.type==="<cancel>"){delete this.tasks[h];const p=this.abortControllers[h];return delete this.abortControllers[h],void(p&&p.abort())}if(ft(self)||s.mustQueue)return this.tasks[h]=s,this.taskQueue.push(h),void this.invoker.trigger();this.processTask(h,s)}}process(){if(this.taskQueue.length===0)return;const u=this.taskQueue.shift(),s=this.tasks[u];delete this.tasks[u],this.taskQueue.length>0&&this.invoker.trigger(),s&&this.processTask(u,s)}processTask(u,s){return l(this,void 0,void 0,function*(){if(s.type==="<response>"){const _=this.resolveRejects[u];return delete this.resolveRejects[u],_?void(s.error?_.reject(Ou(s.error)):_.resolve(Ou(s.data))):void 0}if(!this.messageHandlers[s.type])return void this.completeTask(u,new Error(`Could not find a registered handler for ${s.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const h=Ou(s.data),p=new AbortController;this.abortControllers[u]=p;try{const _=yield this.messageHandlers[s.type](s.sourceMapId,h,p);this.completeTask(u,null,_)}catch(_){this.completeTask(u,_)}})}completeTask(u,s,h){const p=[];delete this.abortControllers[u];const _={id:u,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:s?Nu(s):null,data:Nu(h,p)};this.target.postMessage(_,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},c.D=jt,c.E=Nt,c.F=function(){var u=new lf(16);return lf!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u},c.G=En,c.H=function(u,s,h){var p,_,x,w,I,P,D,F,V,H,Y,J,ie=h[0],ge=h[1],we=h[2];return s===u?(u[12]=s[0]*ie+s[4]*ge+s[8]*we+s[12],u[13]=s[1]*ie+s[5]*ge+s[9]*we+s[13],u[14]=s[2]*ie+s[6]*ge+s[10]*we+s[14],u[15]=s[3]*ie+s[7]*ge+s[11]*we+s[15]):(_=s[1],x=s[2],w=s[3],I=s[4],P=s[5],D=s[6],F=s[7],V=s[8],H=s[9],Y=s[10],J=s[11],u[0]=p=s[0],u[1]=_,u[2]=x,u[3]=w,u[4]=I,u[5]=P,u[6]=D,u[7]=F,u[8]=V,u[9]=H,u[10]=Y,u[11]=J,u[12]=p*ie+I*ge+V*we+s[12],u[13]=_*ie+P*ge+H*we+s[13],u[14]=x*ie+D*ge+Y*we+s[14],u[15]=w*ie+F*ge+J*we+s[15]),u},c.I=u0,c.J=function(u,s,h){var p=h[0],_=h[1],x=h[2];return u[0]=s[0]*p,u[1]=s[1]*p,u[2]=s[2]*p,u[3]=s[3]*p,u[4]=s[4]*_,u[5]=s[5]*_,u[6]=s[6]*_,u[7]=s[7]*_,u[8]=s[8]*x,u[9]=s[9]*x,u[10]=s[10]*x,u[11]=s[11]*x,u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15],u},c.K=xb,c.L=function(u,s){const h={};for(let p=0;p<s.length;p++){const _=s[p];_ in u&&(h[_]=u[_])}return h},c.M=ju,c.N=gx,c.O=_x,c.P=E,c.Q=Ns,c.R=Rs,c.S=B,c.T=Wp,c.U=O,c.V=bt,c.W=Xr,c.X=ei,c.Y=kg,c.Z=class extends Xp{},c._=l,c.a=an,c.a$=function(u,s,h){return u[0]=s[0]*h[0],u[1]=s[1]*h[1],u[2]=s[2]*h[2],u[3]=s[3]*h[3],u},c.a0=v0,c.a1=lt,c.a2=u=>{const s=window.document.createElement("video");return s.muted=!0,new Promise(h=>{s.onloadstart=()=>{h(s)};for(const p of u){const _=window.document.createElement("source");Dt(p)||(s.crossOrigin="Anonymous"),_.src=p,s.appendChild(_)}})},c.a3=function(){return se++},c.a4=v,c.a5=df,c.a6=Vh,c.a7=Ql,c.a8=Er,c.a9=Sx,c.aA=K,c.aB=function(u,s){if(!u)return[{command:"setStyle",args:[s]}];let h=[];try{if(!St(u.version,s.version))return[{command:"setStyle",args:[s]}];St(u.center,s.center)||h.push({command:"setCenter",args:[s.center]}),St(u.zoom,s.zoom)||h.push({command:"setZoom",args:[s.zoom]}),St(u.bearing,s.bearing)||h.push({command:"setBearing",args:[s.bearing]}),St(u.pitch,s.pitch)||h.push({command:"setPitch",args:[s.pitch]}),St(u.sprite,s.sprite)||h.push({command:"setSprite",args:[s.sprite]}),St(u.glyphs,s.glyphs)||h.push({command:"setGlyphs",args:[s.glyphs]}),St(u.transition,s.transition)||h.push({command:"setTransition",args:[s.transition]}),St(u.light,s.light)||h.push({command:"setLight",args:[s.light]}),St(u.terrain,s.terrain)||h.push({command:"setTerrain",args:[s.terrain]}),St(u.sky,s.sky)||h.push({command:"setSky",args:[s.sky]});const p={},_=[];(function(w,I,P,D){let F;for(F in I=I||{},w=w||{})Object.prototype.hasOwnProperty.call(w,F)&&(Object.prototype.hasOwnProperty.call(I,F)||Ls(F,P,D));for(F in I)Object.prototype.hasOwnProperty.call(I,F)&&(Object.prototype.hasOwnProperty.call(w,F)?St(w[F],I[F])||(w[F].type==="geojson"&&I[F].type==="geojson"&&al(w,I,F)?hn(P,{command:"setGeoJSONSourceData",args:[F,I[F].data]}):Js(F,I,P,D)):Ai(F,I,P))})(u.sources,s.sources,_,p);const x=[];u.layers&&u.layers.forEach(w=>{"source"in w&&p[w.source]?h.push({command:"removeLayer",args:[w.id]}):x.push(w)}),h=h.concat(_),function(w,I,P){I=I||[];const D=(w=w||[]).map(jl),F=I.map(jl),V=w.reduce(Ps,{}),H=I.reduce(Ps,{}),Y=D.slice(),J=Object.create(null);let ie,ge,we,Ne,Ee;for(let Ae=0,Qe=0;Ae<D.length;Ae++)ie=D[Ae],Object.prototype.hasOwnProperty.call(H,ie)?Qe++:(hn(P,{command:"removeLayer",args:[ie]}),Y.splice(Y.indexOf(ie,Qe),1));for(let Ae=0,Qe=0;Ae<F.length;Ae++)ie=F[F.length-1-Ae],Y[Y.length-1-Ae]!==ie&&(Object.prototype.hasOwnProperty.call(V,ie)?(hn(P,{command:"removeLayer",args:[ie]}),Y.splice(Y.lastIndexOf(ie,Y.length-Qe),1)):Qe++,Ne=Y[Y.length-Ae],hn(P,{command:"addLayer",args:[H[ie],Ne]}),Y.splice(Y.length-Ae,0,ie),J[ie]=!0);for(let Ae=0;Ae<F.length;Ae++)if(ie=F[Ae],ge=V[ie],we=H[ie],!J[ie]&&!St(ge,we))if(St(ge.source,we.source)&&St(ge["source-layer"],we["source-layer"])&&St(ge.type,we.type)){for(Ee in ji(ge.layout,we.layout,P,ie,null,"setLayoutProperty"),ji(ge.paint,we.paint,P,ie,null,"setPaintProperty"),St(ge.filter,we.filter)||hn(P,{command:"setFilter",args:[ie,we.filter]}),St(ge.minzoom,we.minzoom)&&St(ge.maxzoom,we.maxzoom)||hn(P,{command:"setLayerZoomRange",args:[ie,we.minzoom,we.maxzoom]}),ge)Object.prototype.hasOwnProperty.call(ge,Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&(Ee.indexOf("paint.")===0?ji(ge[Ee],we[Ee],P,ie,Ee.slice(6),"setPaintProperty"):St(ge[Ee],we[Ee])||hn(P,{command:"setLayerProperty",args:[ie,Ee,we[Ee]]}));for(Ee in we)Object.prototype.hasOwnProperty.call(we,Ee)&&!Object.prototype.hasOwnProperty.call(ge,Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&(Ee.indexOf("paint.")===0?ji(ge[Ee],we[Ee],P,ie,Ee.slice(6),"setPaintProperty"):St(ge[Ee],we[Ee])||hn(P,{command:"setLayerProperty",args:[ie,Ee,we[Ee]]}))}else hn(P,{command:"removeLayer",args:[ie]}),Ne=Y[Y.lastIndexOf(ie)+1],hn(P,{command:"addLayer",args:[we,Ne]})}(x,s.layers,h)}catch(p){console.warn("Unable to compute style diff:",p),h=[{command:"setStyle",args:[s]}]}return h},c.aC=function(u){const s=[],h=u.id;return h===void 0&&s.push({message:`layers.${h}: missing required property "id"`}),u.render===void 0&&s.push({message:`layers.${h}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&s.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),s},c.aD=function u(s,h){if(Array.isArray(s)){if(!Array.isArray(h)||s.length!==h.length)return!1;for(let p=0;p<s.length;p++)if(!u(s[p],h[p]))return!1;return!0}if(typeof s=="object"&&s!==null&&h!==null){if(typeof h!="object"||Object.keys(s).length!==Object.keys(h).length)return!1;for(const p in s)if(!u(s[p],h[p]))return!1;return!0}return s===h},c.aE=fe,c.aF=ke,c.aG=class extends vi{constructor(u,s){super(u,s),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},c.aH=Yo,c.aI=class extends vi{constructor(u,s){super(u,s),this.current=jc}set(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let s=1;s<16;s++)if(u[s]!==this.current[s]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}},c.aJ=ia,c.aK=class extends vi{constructor(u,s){super(u,s),this.current=[0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))}},c.aL=class extends vi{constructor(u,s){super(u,s),this.current=[0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))}},c.aM=dl,c.aN=function(u,s,h,p,_,x,w){var I=1/(s-h),P=1/(p-_),D=1/(x-w);return u[0]=-2*I,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*P,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*D,u[11]=0,u[12]=(s+h)*I,u[13]=(_+p)*P,u[14]=(w+x)*D,u[15]=1,u},c.aO=Qn,c.aP=KT,c.aQ=class extends Qh{},c.aR=WL,c.aS=class extends ef{},c.aT=function(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))},c.aU=Cb,c.aV=q,c.aW=class extends ed{},c.aX=$e,c.aY=function(u,s){return u[0]===s[0]&&u[1]===s[1]&&u[2]===s[2]&&u[3]===s[3]&&u[4]===s[4]&&u[5]===s[5]&&u[6]===s[6]&&u[7]===s[7]&&u[8]===s[8]&&u[9]===s[9]&&u[10]===s[10]&&u[11]===s[11]&&u[12]===s[12]&&u[13]===s[13]&&u[14]===s[14]&&u[15]===s[15]},c.aZ=function(u,s){var h=u[0],p=u[1],_=u[2],x=u[3],w=u[4],I=u[5],P=u[6],D=u[7],F=u[8],V=u[9],H=u[10],Y=u[11],J=u[12],ie=u[13],ge=u[14],we=u[15],Ne=s[0],Ee=s[1],Ae=s[2],Qe=s[3],et=s[4],Ct=s[5],zt=s[6],It=s[7],xt=s[8],ht=s[9],kt=s[10],yt=s[11],st=s[12],Yt=s[13],Vt=s[14],Pn=s[15];return Math.abs(h-Ne)<=ko*Math.max(1,Math.abs(h),Math.abs(Ne))&&Math.abs(p-Ee)<=ko*Math.max(1,Math.abs(p),Math.abs(Ee))&&Math.abs(_-Ae)<=ko*Math.max(1,Math.abs(_),Math.abs(Ae))&&Math.abs(x-Qe)<=ko*Math.max(1,Math.abs(x),Math.abs(Qe))&&Math.abs(w-et)<=ko*Math.max(1,Math.abs(w),Math.abs(et))&&Math.abs(I-Ct)<=ko*Math.max(1,Math.abs(I),Math.abs(Ct))&&Math.abs(P-zt)<=ko*Math.max(1,Math.abs(P),Math.abs(zt))&&Math.abs(D-It)<=ko*Math.max(1,Math.abs(D),Math.abs(It))&&Math.abs(F-xt)<=ko*Math.max(1,Math.abs(F),Math.abs(xt))&&Math.abs(V-ht)<=ko*Math.max(1,Math.abs(V),Math.abs(ht))&&Math.abs(H-kt)<=ko*Math.max(1,Math.abs(H),Math.abs(kt))&&Math.abs(Y-yt)<=ko*Math.max(1,Math.abs(Y),Math.abs(yt))&&Math.abs(J-st)<=ko*Math.max(1,Math.abs(J),Math.abs(st))&&Math.abs(ie-Yt)<=ko*Math.max(1,Math.abs(ie),Math.abs(Yt))&&Math.abs(ge-Vt)<=ko*Math.max(1,Math.abs(ge),Math.abs(Vt))&&Math.abs(we-Pn)<=ko*Math.max(1,Math.abs(we),Math.abs(Pn))},c.a_=function(u,s){return u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[4]=s[4],u[5]=s[5],u[6]=s[6],u[7]=s[7],u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15],u},c.aa=function(u){const s={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,p,_,x)=>{const w=_||x;return s[p]=!w||w.toLowerCase(),""}),s["max-age"]){const h=parseInt(s["max-age"],10);isNaN(h)?delete s["max-age"]:s["max-age"]=h}return s},c.ab=function(u,s){const h=[];for(const p in u)p in s||h.push(p);return h},c.ac=Z,c.ad=function(u,s,h){var p=Math.sin(h),_=Math.cos(h),x=s[0],w=s[1],I=s[2],P=s[3],D=s[4],F=s[5],V=s[6],H=s[7];return s!==u&&(u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[0]=x*_+D*p,u[1]=w*_+F*p,u[2]=I*_+V*p,u[3]=P*_+H*p,u[4]=D*_-x*p,u[5]=F*_-w*p,u[6]=V*_-I*p,u[7]=H*_-P*p,u},c.ae=function(u){var s=new lf(16);return s[0]=u[0],s[1]=u[1],s[2]=u[2],s[3]=u[3],s[4]=u[4],s[5]=u[5],s[6]=u[6],s[7]=u[7],s[8]=u[8],s[9]=u[9],s[10]=u[10],s[11]=u[11],s[12]=u[12],s[13]=u[13],s[14]=u[14],s[15]=u[15],s},c.af=bg,c.ag=function(u,s){let h=0,p=0;if(u.kind==="constant")p=u.layoutSize;else if(u.kind!=="source"){const{interpolationType:_,minZoom:x,maxZoom:w}=u,I=_?Z(Ki.interpolationFactor(_,s,x,w),0,1):0;u.kind==="camera"?p=mo.number(u.minSize,u.maxSize,I):h=I}return{uSizeT:h,uSize:p}},c.ai=function(u,{uSize:s,uSizeT:h},{lowerSize:p,upperSize:_}){return u.kind==="source"?p/_l:u.kind==="composite"?mo.number(p/_l,_/_l,h):s},c.aj=p0,c.ak=function(u,s,h,p){const _=s.y-u.y,x=s.x-u.x,w=p.y-h.y,I=p.x-h.x,P=w*x-I*_;if(P===0)return null;const D=(I*(u.y-h.y)-w*(u.x-h.x))/P;return new E(u.x+D*x,u.y+D*_)},c.al=Tx,c.am=nd,c.an=Hy,c.ao=bi,c.aq=f0,c.ar=function(u,s){var h=s[0],p=s[1],_=s[2],x=s[3],w=s[4],I=s[5],P=s[6],D=s[7],F=s[8],V=s[9],H=s[10],Y=s[11],J=s[12],ie=s[13],ge=s[14],we=s[15],Ne=h*I-p*w,Ee=h*P-_*w,Ae=h*D-x*w,Qe=p*P-_*I,et=p*D-x*I,Ct=_*D-x*P,zt=F*ie-V*J,It=F*ge-H*J,xt=F*we-Y*J,ht=V*ge-H*ie,kt=V*we-Y*ie,yt=H*we-Y*ge,st=Ne*yt-Ee*kt+Ae*ht+Qe*xt-et*It+Ct*zt;return st?(u[0]=(I*yt-P*kt+D*ht)*(st=1/st),u[1]=(_*kt-p*yt-x*ht)*st,u[2]=(ie*Ct-ge*et+we*Qe)*st,u[3]=(H*et-V*Ct-Y*Qe)*st,u[4]=(P*xt-w*yt-D*It)*st,u[5]=(h*yt-_*xt+x*It)*st,u[6]=(ge*Ae-J*Ct-we*Ee)*st,u[7]=(F*Ct-H*Ae+Y*Ee)*st,u[8]=(w*kt-I*xt+D*zt)*st,u[9]=(p*xt-h*kt-x*zt)*st,u[10]=(J*et-ie*Ae+we*Ne)*st,u[11]=(V*Ae-F*et-Y*Ne)*st,u[12]=(I*It-w*ht-P*zt)*st,u[13]=(h*ht-p*It+_*zt)*st,u[14]=(ie*Ee-J*Qe-ge*Ne)*st,u[15]=(F*Qe-V*Ee+H*Ne)*st,u):null},c.as=x0,c.at=h0,c.au=w0,c.av=function(){const u={},s=me.$version;for(const h in me.$root){const p=me.$root[h];if(p.required){let _=null;_=h==="version"?s:p.type==="array"?[]:{},_!=null&&(u[h]=_)}}return u},c.aw=sg,c.ax=rr,c.ay=function(u){u=u.slice();const s=Object.create(null);for(let h=0;h<u.length;h++)s[u[h].id]=u[h];for(let h=0;h<u.length;h++)"ref"in u[h]&&(u[h]=Xe(u[h],s[u[h].ref]));return u},c.az=function(u){if(u.type==="custom")return new gP(u);switch(u.type){case"background":return new pP(u);case"circle":return new JT(u);case"fill":return new yL(u);case"fill-extrusion":return new DL(u);case"heatmap":return new eL(u);case"hillshade":return new nL(u);case"line":return new UL(u);case"raster":return new mP(u);case"symbol":return new Mg(u)}},c.b=Ke,c.b0=function(u,s){return u[0]*s[0]+u[1]*s[1]+u[2]*s[2]+u[3]*s[3]},c.b1=ue,c.b2=bx,c.b3=yx,c.b4=function(u,s,h,p,_){var x,w=1/Math.tan(s/2);return u[0]=w/h,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=w,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,_!=null&&_!==1/0?(u[10]=(_+p)*(x=1/(p-_)),u[14]=2*_*p*x):(u[10]=-1,u[14]=-2*p),u},c.b5=function(u,s,h){var p=Math.sin(h),_=Math.cos(h),x=s[4],w=s[5],I=s[6],P=s[7],D=s[8],F=s[9],V=s[10],H=s[11];return s!==u&&(u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[4]=x*_+D*p,u[5]=w*_+F*p,u[6]=I*_+V*p,u[7]=P*_+H*p,u[8]=D*_-x*p,u[9]=F*_-w*p,u[10]=V*_-I*p,u[11]=H*_-P*p,u},c.b6=G,c.b7=U,c.b8=function(u){return u*Math.PI/180},c.b9=function(u,s){return u[0]=s[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=s[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=s[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u},c.bA=pl,c.ba=class extends Fa{},c.bb=_0,c.bc=TP,c.be=In,c.bf=function(u,s){an.REGISTERED_PROTOCOLS[u]=s},c.bg=function(u){delete an.REGISTERED_PROTOCOLS[u]},c.bh=function(u,s){const h={};for(let _=0;_<u.length;_++){const x=s&&s[u[_].id]||Uy(u[_]);s&&(s[u[_].id]=x);let w=h[x];w||(w=h[x]=[]),w.push(u[_])}const p=[];for(const _ in h)p.push(h[_]);return p},c.bi=Pt,c.bj=wx,c.bk=Ex,c.bl=nx,c.bm=function(u){u.bucket.createArrays(),u.bucket.tilePixelRatio=Xr/(512*u.bucket.overscaling),u.bucket.compareText={},u.bucket.iconsNeedLinear=!1;const s=u.bucket.layers[0],h=s.layout,p=s._unevaluatedLayout._values,_={layoutIconSize:p["icon-size"].possiblyEvaluate(new Er(u.bucket.zoom+1),u.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new Er(u.bucket.zoom+1),u.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new Er(18))};if(u.bucket.textSizeData.kind==="composite"){const{minZoom:D,maxZoom:F}=u.bucket.textSizeData;_.compositeTextSizes=[p["text-size"].possiblyEvaluate(new Er(D),u.canonical),p["text-size"].possiblyEvaluate(new Er(F),u.canonical)]}if(u.bucket.iconSizeData.kind==="composite"){const{minZoom:D,maxZoom:F}=u.bucket.iconSizeData;_.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new Er(D),u.canonical),p["icon-size"].possiblyEvaluate(new Er(F),u.canonical)]}const x=h.get("text-line-height")*bi,w=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point",I=h.get("text-keep-upright"),P=h.get("text-size");for(const D of u.bucket.features){const F=h.get("text-font").evaluate(D,{},u.canonical).join(","),V=P.evaluate(D,{},u.canonical),H=_.layoutTextSize.evaluate(D,{},u.canonical),Y=_.layoutIconSize.evaluate(D,{},u.canonical),J={horizontal:{},vertical:void 0},ie=D.text;let ge,we=[0,0];if(ie){const Ae=ie.toString(),Qe=h.get("text-letter-spacing").evaluate(D,{},u.canonical)*bi,et=ag(Ae)?Qe:0,Ct=h.get("text-anchor").evaluate(D,{},u.canonical),zt=Ox(s,D,u.canonical);if(!zt){const yt=h.get("text-radial-offset").evaluate(D,{},u.canonical);we=yt?Nx(Ct,[yt*bi,b0]):h.get("text-offset").evaluate(D,{},u.canonical).map(st=>st*bi)}let It=w?"center":h.get("text-justify").evaluate(D,{},u.canonical);const xt=h.get("symbol-placement"),ht=xt==="point"?h.get("text-max-width").evaluate(D,{},u.canonical)*bi:0,kt=()=>{u.bucket.allowVerticalPlacement&&zu(Ae)&&(J.vertical=Tg(ie,u.glyphMap,u.glyphPositions,u.imagePositions,F,ht,x,Ct,"left",et,we,c.ah.vertical,!0,xt,H,V))};if(!w&&zt){const yt=new Set;if(It==="auto")for(let Yt=0;Yt<zt.values.length;Yt+=2)yt.add(x0(zt.values[Yt]));else yt.add(It);let st=!1;for(const Yt of yt)if(!J.horizontal[Yt])if(st)J.horizontal[Yt]=J.horizontal[0];else{const Vt=Tg(ie,u.glyphMap,u.glyphPositions,u.imagePositions,F,ht,x,"center",Yt,et,we,c.ah.horizontal,!1,xt,H,V);Vt&&(J.horizontal[Yt]=Vt,st=Vt.positionedLines.length===1)}kt()}else{It==="auto"&&(It=x0(Ct));const yt=Tg(ie,u.glyphMap,u.glyphPositions,u.imagePositions,F,ht,x,Ct,It,et,we,c.ah.horizontal,!1,xt,H,V);yt&&(J.horizontal[It]=yt),kt(),zu(Ae)&&w&&I&&(J.vertical=Tg(ie,u.glyphMap,u.glyphPositions,u.imagePositions,F,ht,x,Ct,It,et,we,c.ah.vertical,!1,xt,H,V))}}let Ne=!1;if(D.icon&&D.icon.name){const Ae=u.imageMap[D.icon.name];Ae&&(ge=lP(u.imagePositions[D.icon.name],h.get("icon-offset").evaluate(D,{},u.canonical),h.get("icon-anchor").evaluate(D,{},u.canonical)),Ne=!!Ae.sdf,u.bucket.sdfIcons===void 0?u.bucket.sdfIcons=Ne:u.bucket.sdfIcons!==Ne&&Ge("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ae.pixelRatio!==u.bucket.pixelRatio||h.get("icon-rotate").constantOr(1)!==0)&&(u.bucket.iconsNeedLinear=!0))}const Ee=Fx(J.horizontal)||J.vertical;u.bucket.iconsInText=!!Ee&&Ee.iconsInText,(Ee||ge)&&IP(u.bucket,D,J,ge,u.imageMap,_,H,Y,we,Ne,u.canonical)}u.showCollisionBoxes&&u.bucket.generateCollisionDebugBuffers()},c.bn=o0,c.bo=n0,c.bp=i0,c.bq=Bu,c.br=a0,c.bs=class{constructor(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let u=performance.getEntriesByName(this._marks.measure);return u.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),u=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),u}},c.bt=function(u,s,h,p,_){return l(this,void 0,void 0,function*(){if(O())try{return yield bt(u,s,h,p,_)}catch{}return function(x,w,I,P,D){const F=x.width,V=x.height;Rt&&Ot||(Rt=new OffscreenCanvas(F,V),Ot=Rt.getContext("2d",{willReadFrequently:!0})),Rt.width=F,Rt.height=V,Ot.drawImage(x,0,0,F,V);const H=Ot.getImageData(w,I,P,D);return Ot.clearRect(0,0,F,V),H.data}(u,s,h,p,_)})},c.bu=xx,c.bv=d,c.bw=y,c.bx=Zb,c.by=Zl,c.bz=function(u){return u.message===ln},c.c=Ln,c.d=u=>l(void 0,void 0,void 0,function*(){if(u.byteLength===0)return createImageBitmap(new ImageData(1,1));const s=new Blob([new Uint8Array(u)],{type:"image/png"});try{return createImageBitmap(s)}catch(h){throw new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),c.e=ae,c.f=u=>new Promise((s,h)=>{const p=new Image;p.onload=()=>{s(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame(()=>{p.src=Ft})},p.onerror=()=>h(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const _=new Blob([new Uint8Array(u)],{type:"image/png"});p.src=u.byteLength?URL.createObjectURL(_):Ft}),c.g=Xt,c.h=(u,s)=>mt(ae(u,{type:"json"}),s),c.i=ft,c.j=gt,c.k=rt,c.l=(u,s)=>mt(ae(u,{type:"arrayBuffer"}),s),c.m=mt,c.n=function(u){return new a0(u).readFields(nP,[])},c.o=ld,c.p=tx,c.q=Mo,c.r=jy,c.s=Dt,c.t=Ru,c.u=Et,c.v=me,c.w=Ge,c.x=Yl,c.y=function([u,s,h]){return s+=90,s*=Math.PI/180,h*=Math.PI/180,{x:u*Math.cos(s)*Math.sin(h),y:u*Math.sin(s)*Math.sin(h),z:u*Math.cos(h)}},c.z=mo}),i("worker",["./shared"],function(c){class l{constructor(W){this.keyCache={},W&&this.replace(W)}replace(W){this._layerConfigs={},this._layers={},this.update(W,[])}update(W,X){for(const le of W){this._layerConfigs[le.id]=le;const Pe=this._layers[le.id]=c.az(le);Pe._featureFilter=c.a6(Pe.filter),this.keyCache[le.id]&&delete this.keyCache[le.id]}for(const le of X)delete this.keyCache[le],delete this._layerConfigs[le],delete this._layers[le];this.familiesBySource={};const Q=c.bh(Object.values(this._layerConfigs),this.keyCache);for(const le of Q){const Pe=le.map(Ye=>this._layers[Ye.id]),ee=Pe[0];if(ee.visibility==="none")continue;const Me=ee.source||"";let Se=this.familiesBySource[Me];Se||(Se=this.familiesBySource[Me]={});const Re=ee.sourceLayer||"_geojsonTileLayer";let We=Se[Re];We||(We=Se[Re]=[]),We.push(Pe)}}}class d{constructor(W){const X={},Q=[];for(const Me in W){const Se=W[Me],Re=X[Me]={};for(const We in Se){const Ye=Se[+We];if(!Ye||Ye.bitmap.width===0||Ye.bitmap.height===0)continue;const Je={x:0,y:0,w:Ye.bitmap.width+2,h:Ye.bitmap.height+2};Q.push(Je),Re[We]={rect:Je,metrics:Ye.metrics}}}const{w:le,h:Pe}=c.p(Q),ee=new c.o({width:le||1,height:Pe||1});for(const Me in W){const Se=W[Me];for(const Re in Se){const We=Se[+Re];if(!We||We.bitmap.width===0||We.bitmap.height===0)continue;const Ye=X[Me][Re].rect;c.o.copy(We.bitmap,ee,{x:0,y:0},{x:Ye.x+1,y:Ye.y+1},We.bitmap)}}this.image=ee,this.positions=X}}c.bi("GlyphAtlas",d);class y{constructor(W){this.tileID=new c.Q(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.uid=W.uid,this.zoom=W.zoom,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.returnDependencies=!!W.returnDependencies,this.promoteId=W.promoteId,this.inFlightDependencies=[]}parse(W,X,Q,le){return c._(this,void 0,void 0,function*(){this.status="parsing",this.data=W,this.collisionBoxArray=new c.a4;const Pe=new c.bj(Object.keys(W.layers).sort()),ee=new c.bk(this.tileID,this.promoteId);ee.bucketLayerIDs=[];const Me={},Se={featureIndex:ee,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Q},Re=X.familiesBySource[this.source];for(const vn in Re){const Or=W.layers[vn];if(!Or)continue;Or.version===1&&c.w(`Vector tile source "${this.source}" layer "${vn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const _i=Pe.encode(vn),po=[];for(let To=0;To<Or.length;To++){const Di=Or.feature(To),Qs=ee.getId(Di,vn);po.push({feature:Di,id:Qs,index:To,sourceLayerIndex:_i})}for(const To of Re[vn]){const Di=To[0];Di.source!==this.source&&c.w(`layer.source = ${Di.source} does not equal this.source = ${this.source}`),Di.minzoom&&this.zoom<Math.floor(Di.minzoom)||Di.maxzoom&&this.zoom>=Di.maxzoom||Di.visibility!=="none"&&(S(To,this.zoom,Q),(Me[Di.id]=Di.createBucket({index:ee.bucketLayerIDs.length,layers:To,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:_i,sourceID:this.source})).populate(po,Se,this.tileID.canonical),ee.bucketLayerIDs.push(To.map(Qs=>Qs.id)))}}const We=c.aE(Se.glyphDependencies,vn=>Object.keys(vn).map(Number));this.inFlightDependencies.forEach(vn=>vn==null?void 0:vn.abort()),this.inFlightDependencies=[];let Ye=Promise.resolve({});if(Object.keys(We).length){const vn=new AbortController;this.inFlightDependencies.push(vn),Ye=le.sendAsync({type:"GG",data:{stacks:We,source:this.source,tileID:this.tileID,type:"glyphs"}},vn)}const Je=Object.keys(Se.iconDependencies);let Bt=Promise.resolve({});if(Je.length){const vn=new AbortController;this.inFlightDependencies.push(vn),Bt=le.sendAsync({type:"GI",data:{icons:Je,source:this.source,tileID:this.tileID,type:"icons"}},vn)}const qt=Object.keys(Se.patternDependencies);let sn=Promise.resolve({});if(qt.length){const vn=new AbortController;this.inFlightDependencies.push(vn),sn=le.sendAsync({type:"GI",data:{icons:qt,source:this.source,tileID:this.tileID,type:"patterns"}},vn)}const[un,On,ir]=yield Promise.all([Ye,Bt,sn]),Sr=new d(un),ui=new c.bl(On,ir);for(const vn in Me){const Or=Me[vn];Or instanceof c.a5?(S(Or.layers,this.zoom,Q),c.bm({bucket:Or,glyphMap:un,glyphPositions:Sr.positions,imageMap:On,imagePositions:ui.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Or.hasPattern&&(Or instanceof c.bn||Or instanceof c.bo||Or instanceof c.bp)&&(S(Or.layers,this.zoom,Q),Or.addFeatures(Se,this.tileID.canonical,ui.patternPositions))}return this.status="done",{buckets:Object.values(Me).filter(vn=>!vn.isEmpty()),featureIndex:ee,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Sr.image,imageAtlas:ui,glyphMap:this.returnDependencies?un:null,iconMap:this.returnDependencies?On:null,glyphPositions:this.returnDependencies?Sr.positions:null}})}}function S(_e,W,X){const Q=new c.a8(W);for(const le of _e)le.recalculate(Q,X)}class E{constructor(W,X,Q){this.actor=W,this.layerIndex=X,this.availableImages=Q,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(W,X){return c._(this,void 0,void 0,function*(){const Q=yield c.l(W.request,X);try{return{vectorTile:new c.bq.VectorTile(new c.br(Q.data)),rawData:Q.data,cacheControl:Q.cacheControl,expires:Q.expires}}catch(le){const Pe=new Uint8Array(Q.data);let ee=`Unable to parse the tile at ${W.request.url}, `;throw ee+=Pe[0]===31&&Pe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${le.messge}`,new Error(ee)}})}loadTile(W){return c._(this,void 0,void 0,function*(){const X=W.uid,Q=!!(W&&W.request&&W.request.collectResourceTiming)&&new c.bs(W.request),le=new y(W);this.loading[X]=le;const Pe=new AbortController;le.abort=Pe;try{const ee=yield this.loadVectorTile(W,Pe);if(delete this.loading[X],!ee)return null;const Me=ee.rawData,Se={};ee.expires&&(Se.expires=ee.expires),ee.cacheControl&&(Se.cacheControl=ee.cacheControl);const Re={};if(Q){const Ye=Q.finish();Ye&&(Re.resourceTiming=JSON.parse(JSON.stringify(Ye)))}le.vectorTile=ee.vectorTile;const We=le.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[X]=le,this.fetching[X]={rawTileData:Me,cacheControl:Se,resourceTiming:Re};try{const Ye=yield We;return c.e({rawTileData:Me.slice(0)},Ye,Se,Re)}finally{delete this.fetching[X]}}catch(ee){throw delete this.loading[X],le.status="done",this.loaded[X]=le,ee}})}reloadTile(W){return c._(this,void 0,void 0,function*(){const X=W.uid;if(!this.loaded||!this.loaded[X])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Q=this.loaded[X];if(Q.showCollisionBoxes=W.showCollisionBoxes,Q.status==="parsing"){const le=yield Q.parse(Q.vectorTile,this.layerIndex,this.availableImages,this.actor);let Pe;if(this.fetching[X]){const{rawTileData:ee,cacheControl:Me,resourceTiming:Se}=this.fetching[X];delete this.fetching[X],Pe=c.e({rawTileData:ee.slice(0)},le,Me,Se)}else Pe=le;return Pe}if(Q.status==="done"&&Q.vectorTile)return Q.parse(Q.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(W){return c._(this,void 0,void 0,function*(){const X=this.loading,Q=W.uid;X&&X[Q]&&X[Q].abort&&(X[Q].abort.abort(),delete X[Q])})}removeTile(W){return c._(this,void 0,void 0,function*(){this.loaded&&this.loaded[W.uid]&&delete this.loaded[W.uid]})}}class C{constructor(){this.loaded={}}loadTile(W){return c._(this,void 0,void 0,function*(){const{uid:X,encoding:Q,rawImageData:le,redFactor:Pe,greenFactor:ee,blueFactor:Me,baseShift:Se}=W,Re=le.width+2,We=le.height+2,Ye=c.b(le)?new c.R({width:Re,height:We},yield c.bt(le,-1,-1,Re,We)):le,Je=new c.bu(X,Ye,Q,Pe,ee,Me,Se);return this.loaded=this.loaded||{},this.loaded[X]=Je,Je})}removeTile(W){const X=this.loaded,Q=W.uid;X&&X[Q]&&delete X[Q]}}function A(_e,W){if(_e.length!==0){M(_e[0],W);for(var X=1;X<_e.length;X++)M(_e[X],!W)}}function M(_e,W){for(var X=0,Q=0,le=0,Pe=_e.length,ee=Pe-1;le<Pe;ee=le++){var Me=(_e[le][0]-_e[ee][0])*(_e[ee][1]+_e[le][1]),Se=X+Me;Q+=Math.abs(X)>=Math.abs(Me)?X-Se+Me:Me-Se+X,X=Se}X+Q>=0!=!!W&&_e.reverse()}var R=c.bv(function _e(W,X){var Q,le=W&&W.type;if(le==="FeatureCollection")for(Q=0;Q<W.features.length;Q++)_e(W.features[Q],X);else if(le==="GeometryCollection")for(Q=0;Q<W.geometries.length;Q++)_e(W.geometries[Q],X);else if(le==="Feature")_e(W.geometry,X);else if(le==="Polygon")A(W.coordinates,X);else if(le==="MultiPolygon")for(Q=0;Q<W.coordinates.length;Q++)A(W.coordinates[Q],X);return W});const N=c.bq.VectorTileFeature.prototype.toGeoJSON;var B={exports:{}},O=c.bw,G=c.bq.VectorTileFeature,U=Z;function Z(_e,W){this.options=W||{},this.features=_e,this.length=_e.length}function ue(_e,W){this.id=typeof _e.id=="number"?_e.id:void 0,this.type=_e.type,this.rawGeometry=_e.type===1?[_e.geometry]:_e.geometry,this.properties=_e.tags,this.extent=W||4096}Z.prototype.feature=function(_e){return new ue(this.features[_e],this.options.extent)},ue.prototype.loadGeometry=function(){var _e=this.rawGeometry;this.geometry=[];for(var W=0;W<_e.length;W++){for(var X=_e[W],Q=[],le=0;le<X.length;le++)Q.push(new O(X[le][0],X[le][1]));this.geometry.push(Q)}return this.geometry},ue.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var _e=this.geometry,W=1/0,X=-1/0,Q=1/0,le=-1/0,Pe=0;Pe<_e.length;Pe++)for(var ee=_e[Pe],Me=0;Me<ee.length;Me++){var Se=ee[Me];W=Math.min(W,Se.x),X=Math.max(X,Se.x),Q=Math.min(Q,Se.y),le=Math.max(le,Se.y)}return[W,Q,X,le]},ue.prototype.toGeoJSON=G.prototype.toGeoJSON;var ae=c.bx,se=U;function fe(_e){var W=new ae;return function(X,Q){for(var le in X.layers)Q.writeMessage(3,ke,X.layers[le])}(_e,W),W.finish()}function ke(_e,W){var X;W.writeVarintField(15,_e.version||1),W.writeStringField(1,_e.name||""),W.writeVarintField(5,_e.extent||4096);var Q={keys:[],values:[],keycache:{},valuecache:{}};for(X=0;X<_e.length;X++)Q.feature=_e.feature(X),W.writeMessage(2,K,Q);var le=Q.keys;for(X=0;X<le.length;X++)W.writeStringField(3,le[X]);var Pe=Q.values;for(X=0;X<Pe.length;X++)W.writeMessage(4,ft,Pe[X])}function K(_e,W){var X=_e.feature;X.id!==void 0&&W.writeVarintField(1,X.id),W.writeMessage(2,oe,_e),W.writeVarintField(3,X.type),W.writeMessage(4,ot,X)}function oe(_e,W){var X=_e.feature,Q=_e.keys,le=_e.values,Pe=_e.keycache,ee=_e.valuecache;for(var Me in X.properties){var Se=X.properties[Me],Re=Pe[Me];if(Se!==null){Re===void 0&&(Q.push(Me),Pe[Me]=Re=Q.length-1),W.writeVarint(Re);var We=typeof Se;We!=="string"&&We!=="boolean"&&We!=="number"&&(Se=JSON.stringify(Se));var Ye=We+":"+Se,Je=ee[Ye];Je===void 0&&(le.push(Se),ee[Ye]=Je=le.length-1),W.writeVarint(Je)}}}function Ge(_e,W){return(W<<3)+(7&_e)}function Te(_e){return _e<<1^_e>>31}function ot(_e,W){for(var X=_e.loadGeometry(),Q=_e.type,le=0,Pe=0,ee=X.length,Me=0;Me<ee;Me++){var Se=X[Me],Re=1;Q===1&&(Re=Se.length),W.writeVarint(Ge(1,Re));for(var We=Q===3?Se.length-1:Se.length,Ye=0;Ye<We;Ye++){Ye===1&&Q!==1&&W.writeVarint(Ge(2,We-1));var Je=Se[Ye].x-le,Bt=Se[Ye].y-Pe;W.writeVarint(Te(Je)),W.writeVarint(Te(Bt)),le+=Je,Pe+=Bt}Q===3&&W.writeVarint(Ge(7,1))}}function ft(_e,W){var X=typeof _e;X==="string"?W.writeStringField(1,_e):X==="boolean"?W.writeBooleanField(7,_e):X==="number"&&(_e%1!=0?W.writeDoubleField(3,_e):_e<0?W.writeSVarintField(6,_e):W.writeVarintField(5,_e))}B.exports=fe,B.exports.fromVectorTileJs=fe,B.exports.fromGeojsonVt=function(_e,W){W=W||{};var X={};for(var Q in _e)X[Q]=new se(_e[Q].features,W),X[Q].name=Q,X[Q].version=W.version,X[Q].extent=W.extent;return fe({layers:X})},B.exports.GeoJSONWrapper=se;var At=c.bv(B.exports);const Ke={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:_e=>_e},Ft=Math.fround||(bt=new Float32Array(1),_e=>(bt[0]=+_e,bt[0]));var bt;const Rt=3,Ot=5,ln=6;class Ln{constructor(W){this.options=Object.assign(Object.create(Ke),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:X,minZoom:Q,maxZoom:le}=this.options;X&&console.time("total time");const Pe=`prepare ${W.length} points`;X&&console.time(Pe),this.points=W;const ee=[];for(let Se=0;Se<W.length;Se++){const Re=W[Se];if(!Re.geometry)continue;const[We,Ye]=Re.geometry.coordinates,Je=Ft(En(We)),Bt=Ft(In(Ye));ee.push(Je,Bt,1/0,Se,-1,1),this.options.reduce&&ee.push(0)}let Me=this.trees[le+1]=this._createTree(ee);X&&console.timeEnd(Pe);for(let Se=le;Se>=Q;Se--){const Re=+Date.now();Me=this.trees[Se]=this._createTree(this._cluster(Me,Se)),X&&console.log("z%d: %d clusters in %dms",Se,Me.numItems,+Date.now()-Re)}return X&&console.timeEnd("total time"),this}getClusters(W,X){let Q=((W[0]+180)%360+360)%360-180;const le=Math.max(-90,Math.min(90,W[1]));let Pe=W[2]===180?180:((W[2]+180)%360+360)%360-180;const ee=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)Q=-180,Pe=180;else if(Q>Pe){const Ye=this.getClusters([Q,le,180,ee],X),Je=this.getClusters([-180,le,Pe,ee],X);return Ye.concat(Je)}const Me=this.trees[this._limitZoom(X)],Se=Me.range(En(Q),In(ee),En(Pe),In(le)),Re=Me.data,We=[];for(const Ye of Se){const Je=this.stride*Ye;We.push(Re[Je+Ot]>1?an(Re,Je,this.clusterProps):this.points[Re[Je+Rt]])}return We}getChildren(W){const X=this._getOriginId(W),Q=this._getOriginZoom(W),le="No cluster with the specified id.",Pe=this.trees[Q];if(!Pe)throw new Error(le);const ee=Pe.data;if(X*this.stride>=ee.length)throw new Error(le);const Me=this.options.radius/(this.options.extent*Math.pow(2,Q-1)),Se=Pe.within(ee[X*this.stride],ee[X*this.stride+1],Me),Re=[];for(const We of Se){const Ye=We*this.stride;ee[Ye+4]===W&&Re.push(ee[Ye+Ot]>1?an(ee,Ye,this.clusterProps):this.points[ee[Ye+Rt]])}if(Re.length===0)throw new Error(le);return Re}getLeaves(W,X,Q){const le=[];return this._appendLeaves(le,W,X=X||10,Q=Q||0,0),le}getTile(W,X,Q){const le=this.trees[this._limitZoom(W)],Pe=Math.pow(2,W),{extent:ee,radius:Me}=this.options,Se=Me/ee,Re=(Q-Se)/Pe,We=(Q+1+Se)/Pe,Ye={features:[]};return this._addTileFeatures(le.range((X-Se)/Pe,Re,(X+1+Se)/Pe,We),le.data,X,Q,Pe,Ye),X===0&&this._addTileFeatures(le.range(1-Se/Pe,Re,1,We),le.data,Pe,Q,Pe,Ye),X===Pe-1&&this._addTileFeatures(le.range(0,Re,Se/Pe,We),le.data,-1,Q,Pe,Ye),Ye.features.length?Ye:null}getClusterExpansionZoom(W){let X=this._getOriginZoom(W)-1;for(;X<=this.options.maxZoom;){const Q=this.getChildren(W);if(X++,Q.length!==1)break;W=Q[0].properties.cluster_id}return X}_appendLeaves(W,X,Q,le,Pe){const ee=this.getChildren(X);for(const Me of ee){const Se=Me.properties;if(Se&&Se.cluster?Pe+Se.point_count<=le?Pe+=Se.point_count:Pe=this._appendLeaves(W,Se.cluster_id,Q,le,Pe):Pe<le?Pe++:W.push(Me),W.length===Q)break}return Pe}_createTree(W){const X=new c.au(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Q=0;Q<W.length;Q+=this.stride)X.add(W[Q],W[Q+1]);return X.finish(),X.data=W,X}_addTileFeatures(W,X,Q,le,Pe,ee){for(const Me of W){const Se=Me*this.stride,Re=X[Se+Ot]>1;let We,Ye,Je;if(Re)We=Xt(X,Se,this.clusterProps),Ye=X[Se],Je=X[Se+1];else{const sn=this.points[X[Se+Rt]];We=sn.properties;const[un,On]=sn.geometry.coordinates;Ye=En(un),Je=In(On)}const Bt={type:1,geometry:[[Math.round(this.options.extent*(Ye*Pe-Q)),Math.round(this.options.extent*(Je*Pe-le))]],tags:We};let qt;qt=Re||this.options.generateId?X[Se+Rt]:this.points[X[Se+Rt]].id,qt!==void 0&&(Bt.id=qt),ee.features.push(Bt)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,X){const{radius:Q,extent:le,reduce:Pe,minPoints:ee}=this.options,Me=Q/(le*Math.pow(2,X)),Se=W.data,Re=[],We=this.stride;for(let Ye=0;Ye<Se.length;Ye+=We){if(Se[Ye+2]<=X)continue;Se[Ye+2]=X;const Je=Se[Ye],Bt=Se[Ye+1],qt=W.within(Se[Ye],Se[Ye+1],Me),sn=Se[Ye+Ot];let un=sn;for(const On of qt){const ir=On*We;Se[ir+2]>X&&(un+=Se[ir+Ot])}if(un>sn&&un>=ee){let On,ir=Je*sn,Sr=Bt*sn,ui=-1;const vn=((Ye/We|0)<<5)+(X+1)+this.points.length;for(const Or of qt){const _i=Or*We;if(Se[_i+2]<=X)continue;Se[_i+2]=X;const po=Se[_i+Ot];ir+=Se[_i]*po,Sr+=Se[_i+1]*po,Se[_i+4]=vn,Pe&&(On||(On=this._map(Se,Ye,!0),ui=this.clusterProps.length,this.clusterProps.push(On)),Pe(On,this._map(Se,_i)))}Se[Ye+4]=vn,Re.push(ir/un,Sr/un,1/0,vn,-1,un),Pe&&Re.push(ui)}else{for(let On=0;On<We;On++)Re.push(Se[Ye+On]);if(un>1)for(const On of qt){const ir=On*We;if(!(Se[ir+2]<=X)){Se[ir+2]=X;for(let Sr=0;Sr<We;Sr++)Re.push(Se[ir+Sr])}}}}return Re}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,X,Q){if(W[X+Ot]>1){const ee=this.clusterProps[W[X+ln]];return Q?Object.assign({},ee):ee}const le=this.points[W[X+Rt]].properties,Pe=this.options.map(le);return Q&&Pe===le?Object.assign({},Pe):Pe}}function an(_e,W,X){return{type:"Feature",id:_e[W+Rt],properties:Xt(_e,W,X),geometry:{type:"Point",coordinates:[(Q=_e[W],360*(Q-.5)),rr(_e[W+1])]}};var Q}function Xt(_e,W,X){const Q=_e[W+Ot],le=Q>=1e4?`${Math.round(Q/1e3)}k`:Q>=1e3?Math.round(Q/100)/10+"k":Q,Pe=_e[W+ln],ee=Pe===-1?{}:Object.assign({},X[Pe]);return Object.assign(ee,{cluster:!0,cluster_id:_e[W+Rt],point_count:Q,point_count_abbreviated:le})}function En(_e){return _e/360+.5}function In(_e){const W=Math.sin(_e*Math.PI/180),X=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return X<0?0:X>1?1:X}function rr(_e){const W=(180-360*_e)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function mt(_e,W,X,Q){for(var le,Pe=Q,ee=X-W>>1,Me=X-W,Se=_e[W],Re=_e[W+1],We=_e[X],Ye=_e[X+1],Je=W+3;Je<X;Je+=3){var Bt=Dt(_e[Je],_e[Je+1],Se,Re,We,Ye);if(Bt>Pe)le=Je,Pe=Bt;else if(Bt===Pe){var qt=Math.abs(Je-ee);qt<Me&&(le=Je,Me=qt)}}Pe>Q&&(le-W>3&&mt(_e,W,le,Q),_e[le+2]=Pe,X-le>3&&mt(_e,le,X,Q))}function Dt(_e,W,X,Q,le,Pe){var ee=le-X,Me=Pe-Q;if(ee!==0||Me!==0){var Se=((_e-X)*ee+(W-Q)*Me)/(ee*ee+Me*Me);Se>1?(X=le,Q=Pe):Se>0&&(X+=ee*Se,Q+=Me*Se)}return(ee=_e-X)*ee+(Me=W-Q)*Me}function Sn(_e,W,X,Q){var le={id:_e===void 0?null:_e,type:W,geometry:X,tags:Q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Pe){var ee=Pe.geometry,Me=Pe.type;if(Me==="Point"||Me==="MultiPoint"||Me==="LineString")Le(Pe,ee);else if(Me==="Polygon"||Me==="MultiLineString")for(var Se=0;Se<ee.length;Se++)Le(Pe,ee[Se]);else if(Me==="MultiPolygon")for(Se=0;Se<ee.length;Se++)for(var Re=0;Re<ee[Se].length;Re++)Le(Pe,ee[Se][Re])}(le),le}function Le(_e,W){for(var X=0;X<W.length;X+=3)_e.minX=Math.min(_e.minX,W[X]),_e.minY=Math.min(_e.minY,W[X+1]),_e.maxX=Math.max(_e.maxX,W[X]),_e.maxY=Math.max(_e.maxY,W[X+1])}function rt(_e,W,X,Q){if(W.geometry){var le=W.geometry.coordinates,Pe=W.geometry.type,ee=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2),Me=[],Se=W.id;if(X.promoteId?Se=W.properties[X.promoteId]:X.generateId&&(Se=Q||0),Pe==="Point")gt(le,Me);else if(Pe==="MultiPoint")for(var Re=0;Re<le.length;Re++)gt(le[Re],Me);else if(Pe==="LineString")Nt(le,Me,ee,!1);else if(Pe==="MultiLineString"){if(X.lineMetrics){for(Re=0;Re<le.length;Re++)Nt(le[Re],Me=[],ee,!1),_e.push(Sn(Se,"LineString",Me,W.properties));return}me(le,Me,ee,!1)}else if(Pe==="Polygon")me(le,Me,ee,!0);else{if(Pe!=="MultiPolygon"){if(Pe==="GeometryCollection"){for(Re=0;Re<W.geometry.geometries.length;Re++)rt(_e,{id:Se,geometry:W.geometry.geometries[Re],properties:W.properties},X,Q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Re=0;Re<le.length;Re++){var We=[];me(le[Re],We,ee,!0),Me.push(We)}}_e.push(Sn(Se,Pe,Me,W.properties))}}function gt(_e,W){W.push(tn(_e[0])),W.push(Xe(_e[1])),W.push(0)}function Nt(_e,W,X,Q){for(var le,Pe,ee=0,Me=0;Me<_e.length;Me++){var Se=tn(_e[Me][0]),Re=Xe(_e[Me][1]);W.push(Se),W.push(Re),W.push(0),Me>0&&(ee+=Q?(le*Re-Se*Pe)/2:Math.sqrt(Math.pow(Se-le,2)+Math.pow(Re-Pe,2))),le=Se,Pe=Re}var We=W.length-3;W[2]=1,mt(W,0,We,X),W[We+2]=1,W.size=Math.abs(ee),W.start=0,W.end=W.size}function me(_e,W,X,Q){for(var le=0;le<_e.length;le++){var Pe=[];Nt(_e[le],Pe,X,Q),W.push(Pe)}}function tn(_e){return _e/360+.5}function Xe(_e){var W=Math.sin(_e*Math.PI/180),X=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return X<0?0:X>1?1:X}function St(_e,W,X,Q,le,Pe,ee,Me){if(Q/=W,Pe>=(X/=W)&&ee<Q)return _e;if(ee<X||Pe>=Q)return null;for(var Se=[],Re=0;Re<_e.length;Re++){var We=_e[Re],Ye=We.geometry,Je=We.type,Bt=le===0?We.minX:We.minY,qt=le===0?We.maxX:We.maxY;if(Bt>=X&&qt<Q)Se.push(We);else if(!(qt<X||Bt>=Q)){var sn=[];if(Je==="Point"||Je==="MultiPoint")hn(Ye,sn,X,Q,le);else if(Je==="LineString")Ai(Ye,sn,X,Q,le,!1,Me.lineMetrics);else if(Je==="MultiLineString")Js(Ye,sn,X,Q,le,!1);else if(Je==="Polygon")Js(Ye,sn,X,Q,le,!0);else if(Je==="MultiPolygon")for(var un=0;un<Ye.length;un++){var On=[];Js(Ye[un],On,X,Q,le,!0),On.length&&sn.push(On)}if(sn.length){if(Me.lineMetrics&&Je==="LineString"){for(un=0;un<sn.length;un++)Se.push(Sn(We.id,Je,sn[un],We.tags));continue}Je!=="LineString"&&Je!=="MultiLineString"||(sn.length===1?(Je="LineString",sn=sn[0]):Je="MultiLineString"),Je!=="Point"&&Je!=="MultiPoint"||(Je=sn.length===3?"Point":"MultiPoint"),Se.push(Sn(We.id,Je,sn,We.tags))}}}return Se.length?Se:null}function hn(_e,W,X,Q,le){for(var Pe=0;Pe<_e.length;Pe+=3){var ee=_e[Pe+le];ee>=X&&ee<=Q&&(W.push(_e[Pe]),W.push(_e[Pe+1]),W.push(_e[Pe+2]))}}function Ai(_e,W,X,Q,le,Pe,ee){for(var Me,Se,Re=Ls(_e),We=le===0?ji:jl,Ye=_e.start,Je=0;Je<_e.length-3;Je+=3){var Bt=_e[Je],qt=_e[Je+1],sn=_e[Je+2],un=_e[Je+3],On=_e[Je+4],ir=le===0?Bt:qt,Sr=le===0?un:On,ui=!1;ee&&(Me=Math.sqrt(Math.pow(Bt-un,2)+Math.pow(qt-On,2))),ir<X?Sr>X&&(Se=We(Re,Bt,qt,un,On,X),ee&&(Re.start=Ye+Me*Se)):ir>Q?Sr<Q&&(Se=We(Re,Bt,qt,un,On,Q),ee&&(Re.start=Ye+Me*Se)):al(Re,Bt,qt,sn),Sr<X&&ir>=X&&(Se=We(Re,Bt,qt,un,On,X),ui=!0),Sr>Q&&ir<=Q&&(Se=We(Re,Bt,qt,un,On,Q),ui=!0),!Pe&&ui&&(ee&&(Re.end=Ye+Me*Se),W.push(Re),Re=Ls(_e)),ee&&(Ye+=Me)}var vn=_e.length-3;Bt=_e[vn],qt=_e[vn+1],sn=_e[vn+2],(ir=le===0?Bt:qt)>=X&&ir<=Q&&al(Re,Bt,qt,sn),vn=Re.length-3,Pe&&vn>=3&&(Re[vn]!==Re[0]||Re[vn+1]!==Re[1])&&al(Re,Re[0],Re[1],Re[2]),Re.length&&W.push(Re)}function Ls(_e){var W=[];return W.size=_e.size,W.start=_e.start,W.end=_e.end,W}function Js(_e,W,X,Q,le,Pe){for(var ee=0;ee<_e.length;ee++)Ai(_e[ee],W,X,Q,le,Pe,!1)}function al(_e,W,X,Q){_e.push(W),_e.push(X),_e.push(Q)}function ji(_e,W,X,Q,le,Pe){var ee=(Pe-W)/(Q-W);return _e.push(Pe),_e.push(X+(le-X)*ee),_e.push(1),ee}function jl(_e,W,X,Q,le,Pe){var ee=(Pe-X)/(le-X);return _e.push(W+(Q-W)*ee),_e.push(Pe),_e.push(1),ee}function Ps(_e,W){for(var X=[],Q=0;Q<_e.length;Q++){var le,Pe=_e[Q],ee=Pe.type;if(ee==="Point"||ee==="MultiPoint"||ee==="LineString")le=lt(Pe.geometry,W);else if(ee==="MultiLineString"||ee==="Polygon"){le=[];for(var Me=0;Me<Pe.geometry.length;Me++)le.push(lt(Pe.geometry[Me],W))}else if(ee==="MultiPolygon")for(le=[],Me=0;Me<Pe.geometry.length;Me++){for(var Se=[],Re=0;Re<Pe.geometry[Me].length;Re++)Se.push(lt(Pe.geometry[Me][Re],W));le.push(Se)}X.push(Sn(Pe.id,ee,le,Pe.tags))}return X}function lt(_e,W){var X=[];X.size=_e.size,_e.start!==void 0&&(X.start=_e.start,X.end=_e.end);for(var Q=0;Q<_e.length;Q+=3)X.push(_e[Q]+W,_e[Q+1],_e[Q+2]);return X}function hs(_e,W){if(_e.transformed)return _e;var X,Q,le,Pe=1<<_e.z,ee=_e.x,Me=_e.y;for(X=0;X<_e.features.length;X++){var Se=_e.features[X],Re=Se.geometry,We=Se.type;if(Se.geometry=[],We===1)for(Q=0;Q<Re.length;Q+=2)Se.geometry.push(fo(Re[Q],Re[Q+1],W,Pe,ee,Me));else for(Q=0;Q<Re.length;Q++){var Ye=[];for(le=0;le<Re[Q].length;le+=2)Ye.push(fo(Re[Q][le],Re[Q][le+1],W,Pe,ee,Me));Se.geometry.push(Ye)}}return _e.transformed=!0,_e}function fo(_e,W,X,Q,le,Pe){return[Math.round(X*(_e*Q-le)),Math.round(X*(W*Q-Pe))]}function Gl(_e,W,X,Q,le){for(var Pe=W===le.maxZoom?0:le.tolerance/((1<<W)*le.extent),ee={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:X,y:Q,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Me=0;Me<_e.length;Me++){ee.numFeatures++,li(ee,_e[Me],Pe,le);var Se=_e[Me].minX,Re=_e[Me].minY,We=_e[Me].maxX,Ye=_e[Me].maxY;Se<ee.minX&&(ee.minX=Se),Re<ee.minY&&(ee.minY=Re),We>ee.maxX&&(ee.maxX=We),Ye>ee.maxY&&(ee.maxY=Ye)}return ee}function li(_e,W,X,Q){var le=W.geometry,Pe=W.type,ee=[];if(Pe==="Point"||Pe==="MultiPoint")for(var Me=0;Me<le.length;Me+=3)ee.push(le[Me]),ee.push(le[Me+1]),_e.numPoints++,_e.numSimplified++;else if(Pe==="LineString")pt(ee,le,_e,X,!1,!1);else if(Pe==="MultiLineString"||Pe==="Polygon")for(Me=0;Me<le.length;Me++)pt(ee,le[Me],_e,X,Pe==="Polygon",Me===0);else if(Pe==="MultiPolygon")for(var Se=0;Se<le.length;Se++){var Re=le[Se];for(Me=0;Me<Re.length;Me++)pt(ee,Re[Me],_e,X,!0,Me===0)}if(ee.length){var We=W.tags||null;if(Pe==="LineString"&&Q.lineMetrics){for(var Ye in We={},W.tags)We[Ye]=W.tags[Ye];We.mapbox_clip_start=le.start/le.size,We.mapbox_clip_end=le.end/le.size}var Je={geometry:ee,type:Pe==="Polygon"||Pe==="MultiPolygon"?3:Pe==="LineString"||Pe==="MultiLineString"?2:1,tags:We};W.id!==null&&(Je.id=W.id),_e.features.push(Je)}}function pt(_e,W,X,Q,le,Pe){var ee=Q*Q;if(Q>0&&W.size<(le?ee:Q))X.numPoints+=W.length/3;else{for(var Me=[],Se=0;Se<W.length;Se+=3)(Q===0||W[Se+2]>ee)&&(X.numSimplified++,Me.push(W[Se]),Me.push(W[Se+1])),X.numPoints++;le&&function(Re,We){for(var Ye=0,Je=0,Bt=Re.length,qt=Bt-2;Je<Bt;qt=Je,Je+=2)Ye+=(Re[Je]-Re[qt])*(Re[Je+1]+Re[qt+1]);if(Ye>0===We)for(Je=0,Bt=Re.length;Je<Bt/2;Je+=2){var sn=Re[Je],un=Re[Je+1];Re[Je]=Re[Bt-2-Je],Re[Je+1]=Re[Bt-1-Je],Re[Bt-2-Je]=sn,Re[Bt-1-Je]=un}}(Me,Pe),_e.push(Me)}}function mn(_e,W){var X=(W=this.options=function(le,Pe){for(var ee in Pe)le[ee]=Pe[ee];return le}(Object.create(this.options),W)).debug;if(X&&console.time("preprocess data"),W.maxZoom<0||W.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(W.promoteId&&W.generateId)throw new Error("promoteId and generateId cannot be used together.");var Q=function(le,Pe){var ee=[];if(le.type==="FeatureCollection")for(var Me=0;Me<le.features.length;Me++)rt(ee,le.features[Me],Pe,Me);else rt(ee,le.type==="Feature"?le:{geometry:le},Pe);return ee}(_e,W);this.tiles={},this.tileCoords=[],X&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",W.indexMaxZoom,W.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Q=function(le,Pe){var ee=Pe.buffer/Pe.extent,Me=le,Se=St(le,1,-1-ee,ee,0,-1,2,Pe),Re=St(le,1,1-ee,2+ee,0,-1,2,Pe);return(Se||Re)&&(Me=St(le,1,-ee,1+ee,0,-1,2,Pe)||[],Se&&(Me=Ps(Se,1).concat(Me)),Re&&(Me=Me.concat(Ps(Re,-1)))),Me}(Q,W),Q.length&&this.splitTile(Q,0,0,0),X&&(Q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function pn(_e,W,X){return 32*((1<<_e)*X+W)+_e}function Zr(_e,W){return W?_e.properties[W]:_e.id}function fs(_e,W){if(_e==null)return!0;if(_e.type==="Feature")return Zr(_e,W)!=null;if(_e.type==="FeatureCollection"){const X=new Set;for(const Q of _e.features){const le=Zr(Q,W);if(le==null||X.has(le))return!1;X.add(le)}return!0}return!1}function fn(_e,W){const X=new Map;if(_e!=null)if(_e.type==="Feature")X.set(Zr(_e,W),_e);else for(const Q of _e.features)X.set(Zr(Q,W),Q);return X}mn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},mn.prototype.splitTile=function(_e,W,X,Q,le,Pe,ee){for(var Me=[_e,W,X,Q],Se=this.options,Re=Se.debug;Me.length;){Q=Me.pop(),X=Me.pop(),W=Me.pop(),_e=Me.pop();var We=1<<W,Ye=pn(W,X,Q),Je=this.tiles[Ye];if(!Je&&(Re>1&&console.time("creation"),Je=this.tiles[Ye]=Gl(_e,W,X,Q,Se),this.tileCoords.push({z:W,x:X,y:Q}),Re)){Re>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",W,X,Q,Je.numFeatures,Je.numPoints,Je.numSimplified),console.timeEnd("creation"));var Bt="z"+W;this.stats[Bt]=(this.stats[Bt]||0)+1,this.total++}if(Je.source=_e,le){if(W===Se.maxZoom||W===le)continue;var qt=1<<le-W;if(X!==Math.floor(Pe/qt)||Q!==Math.floor(ee/qt))continue}else if(W===Se.indexMaxZoom||Je.numPoints<=Se.indexMaxPoints)continue;if(Je.source=null,_e.length!==0){Re>1&&console.time("clipping");var sn,un,On,ir,Sr,ui,vn=.5*Se.buffer/Se.extent,Or=.5-vn,_i=.5+vn,po=1+vn;sn=un=On=ir=null,Sr=St(_e,We,X-vn,X+_i,0,Je.minX,Je.maxX,Se),ui=St(_e,We,X+Or,X+po,0,Je.minX,Je.maxX,Se),_e=null,Sr&&(sn=St(Sr,We,Q-vn,Q+_i,1,Je.minY,Je.maxY,Se),un=St(Sr,We,Q+Or,Q+po,1,Je.minY,Je.maxY,Se),Sr=null),ui&&(On=St(ui,We,Q-vn,Q+_i,1,Je.minY,Je.maxY,Se),ir=St(ui,We,Q+Or,Q+po,1,Je.minY,Je.maxY,Se),ui=null),Re>1&&console.timeEnd("clipping"),Me.push(sn||[],W+1,2*X,2*Q),Me.push(un||[],W+1,2*X,2*Q+1),Me.push(On||[],W+1,2*X+1,2*Q),Me.push(ir||[],W+1,2*X+1,2*Q+1)}}},mn.prototype.getTile=function(_e,W,X){var Q=this.options,le=Q.extent,Pe=Q.debug;if(_e<0||_e>24)return null;var ee=1<<_e,Me=pn(_e,W=(W%ee+ee)%ee,X);if(this.tiles[Me])return hs(this.tiles[Me],le);Pe>1&&console.log("drilling down to z%d-%d-%d",_e,W,X);for(var Se,Re=_e,We=W,Ye=X;!Se&&Re>0;)Re--,We=Math.floor(We/2),Ye=Math.floor(Ye/2),Se=this.tiles[pn(Re,We,Ye)];return Se&&Se.source?(Pe>1&&console.log("found parent tile z%d-%d-%d",Re,We,Ye),Pe>1&&console.time("drilling down"),this.splitTile(Se.source,Re,We,Ye,_e,W,X),Pe>1&&console.timeEnd("drilling down"),this.tiles[Me]?hs(this.tiles[Me],le):null):null};class za extends E{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(W,X){return c._(this,void 0,void 0,function*(){const Q=W.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const le=this._geoJSONIndex.getTile(Q.z,Q.x,Q.y);if(!le)return null;const Pe=new class{constructor(Me){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.W,this.length=Me.length,this._features=Me}feature(Me){return new class{constructor(Se){this._feature=Se,this.extent=c.W,this.type=Se.type,this.properties=Se.tags,"id"in Se&&!isNaN(Se.id)&&(this.id=parseInt(Se.id,10))}loadGeometry(){if(this._feature.type===1){const Se=[];for(const Re of this._feature.geometry)Se.push([new c.P(Re[0],Re[1])]);return Se}{const Se=[];for(const Re of this._feature.geometry){const We=[];for(const Ye of Re)We.push(new c.P(Ye[0],Ye[1]));Se.push(We)}return Se}}toGeoJSON(Se,Re,We){return N.call(this,Se,Re,We)}}(this._features[Me])}}(le.features);let ee=At(Pe);return ee.byteOffset===0&&ee.byteLength===ee.buffer.byteLength||(ee=new Uint8Array(ee)),{vectorTile:Pe,rawData:ee.buffer}})}loadData(W){return c._(this,void 0,void 0,function*(){var X;(X=this._pendingRequest)===null||X===void 0||X.abort();const Q=!!(W&&W.request&&W.request.collectResourceTiming)&&new c.bs(W.request);this._pendingRequest=new AbortController;try{let le=yield this.loadGeoJSON(W,this._pendingRequest);if(delete this._pendingRequest,typeof le!="object")throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(R(le,!0),W.filter){const ee=c.by(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ee.result==="error")throw new Error(ee.value.map(Se=>`${Se.key}: ${Se.message}`).join(", "));le={type:"FeatureCollection",features:le.features.filter(Se=>ee.value.evaluate({zoom:0},Se))}}this._geoJSONIndex=W.cluster?new Ln(function({superclusterOptions:ee,clusterProperties:Me}){if(!Me||!ee)return ee;const Se={},Re={},We={accumulated:null,zoom:0},Ye={properties:null},Je=Object.keys(Me);for(const Bt of Je){const[qt,sn]=Me[Bt],un=c.by(sn),On=c.by(typeof qt=="string"?[qt,["accumulated"],["get",Bt]]:qt);Se[Bt]=un.value,Re[Bt]=On.value}return ee.map=Bt=>{Ye.properties=Bt;const qt={};for(const sn of Je)qt[sn]=Se[sn].evaluate(We,Ye);return qt},ee.reduce=(Bt,qt)=>{Ye.properties=qt;for(const sn of Je)We.accumulated=Bt[sn],Bt[sn]=Re[sn].evaluate(We,Ye)},ee}(W)).load(le.features):function(ee,Me){return new mn(ee,Me)}(le,W.geojsonVtOptions),this.loaded={};const Pe={};if(Q){const ee=Q.finish();ee&&(Pe.resourceTiming={},Pe.resourceTiming[W.source]=JSON.parse(JSON.stringify(ee)))}return Pe}catch(le){if(delete this._pendingRequest,c.bz(le))return{abandoned:!0};throw le}})}reloadTile(W){const X=this.loaded;return X&&X[W.uid]?super.reloadTile(W):this.loadTile(W)}loadGeoJSON(W,X){return c._(this,void 0,void 0,function*(){const{promoteId:Q}=W;if(W.request){const le=yield c.h(W.request,X);return this._dataUpdateable=fs(le.data,Q)?fn(le.data,Q):void 0,le.data}if(typeof W.data=="string")try{const le=JSON.parse(W.data);return this._dataUpdateable=fs(le,Q)?fn(le,Q):void 0,le}catch{throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`)}if(!W.dataDiff)throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${W.source}`);return function(le,Pe,ee){var Me,Se,Re,We;if(Pe.removeAll&&le.clear(),Pe.remove)for(const Ye of Pe.remove)le.delete(Ye);if(Pe.add)for(const Ye of Pe.add){const Je=Zr(Ye,ee);Je!=null&&le.set(Je,Ye)}if(Pe.update)for(const Ye of Pe.update){let Je=le.get(Ye.id);if(Je==null)continue;const Bt=!Ye.removeAllProperties&&(((Me=Ye.removeProperties)===null||Me===void 0?void 0:Me.length)>0||((Se=Ye.addOrUpdateProperties)===null||Se===void 0?void 0:Se.length)>0);if((Ye.newGeometry||Ye.removeAllProperties||Bt)&&(Je=Object.assign({},Je),le.set(Ye.id,Je),Bt&&(Je.properties=Object.assign({},Je.properties))),Ye.newGeometry&&(Je.geometry=Ye.newGeometry),Ye.removeAllProperties)Je.properties={};else if(((Re=Ye.removeProperties)===null||Re===void 0?void 0:Re.length)>0)for(const qt of Ye.removeProperties)Object.prototype.hasOwnProperty.call(Je.properties,qt)&&delete Je.properties[qt];if(((We=Ye.addOrUpdateProperties)===null||We===void 0?void 0:We.length)>0)for(const{key:qt,value:sn}of Ye.addOrUpdateProperties)Je.properties[qt]=sn}}(this._dataUpdateable,W.dataDiff,Q),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(W){return c._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(W){return this._geoJSONIndex.getClusterExpansionZoom(W.clusterId)}getClusterChildren(W){return this._geoJSONIndex.getChildren(W.clusterId)}getClusterLeaves(W){return this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset)}}class Jr{constructor(W){this.self=W,this.actor=new c.C(W),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(X,Q)=>{if(this.externalWorkerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.externalWorkerSourceTypes[X]=Q},this.self.addProtocol=c.bf,this.self.removeProtocol=c.bg,this.self.registerRTLTextPlugin=X=>{if(c.bA.isParsed())throw new Error("RTL text plugin already registered.");c.bA.setMethods(X)},this.actor.registerMessageHandler("LDT",(X,Q)=>this._getDEMWorkerSource(X,Q.source).loadTile(Q)),this.actor.registerMessageHandler("RDT",(X,Q)=>c._(this,void 0,void 0,function*(){this._getDEMWorkerSource(X,Q.source).removeTile(Q)})),this.actor.registerMessageHandler("GCEZ",(X,Q)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(X,Q.type,Q.source).getClusterExpansionZoom(Q)})),this.actor.registerMessageHandler("GCC",(X,Q)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(X,Q.type,Q.source).getClusterChildren(Q)})),this.actor.registerMessageHandler("GCL",(X,Q)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(X,Q.type,Q.source).getClusterLeaves(Q)})),this.actor.registerMessageHandler("LD",(X,Q)=>this._getWorkerSource(X,Q.type,Q.source).loadData(Q)),this.actor.registerMessageHandler("LT",(X,Q)=>this._getWorkerSource(X,Q.type,Q.source).loadTile(Q)),this.actor.registerMessageHandler("RT",(X,Q)=>this._getWorkerSource(X,Q.type,Q.source).reloadTile(Q)),this.actor.registerMessageHandler("AT",(X,Q)=>this._getWorkerSource(X,Q.type,Q.source).abortTile(Q)),this.actor.registerMessageHandler("RMT",(X,Q)=>this._getWorkerSource(X,Q.type,Q.source).removeTile(Q)),this.actor.registerMessageHandler("RS",(X,Q)=>c._(this,void 0,void 0,function*(){if(!this.workerSources[X]||!this.workerSources[X][Q.type]||!this.workerSources[X][Q.type][Q.source])return;const le=this.workerSources[X][Q.type][Q.source];delete this.workerSources[X][Q.type][Q.source],le.removeSource!==void 0&&le.removeSource(Q)})),this.actor.registerMessageHandler("RM",X=>c._(this,void 0,void 0,function*(){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X]})),this.actor.registerMessageHandler("SR",(X,Q)=>c._(this,void 0,void 0,function*(){this.referrer=Q})),this.actor.registerMessageHandler("SRPS",(X,Q)=>this._syncRTLPluginState(X,Q)),this.actor.registerMessageHandler("IS",(X,Q)=>c._(this,void 0,void 0,function*(){this.self.importScripts(Q)})),this.actor.registerMessageHandler("SI",(X,Q)=>this._setImages(X,Q)),this.actor.registerMessageHandler("UL",(X,Q)=>c._(this,void 0,void 0,function*(){this._getLayerIndex(X).update(Q.layers,Q.removedIds)})),this.actor.registerMessageHandler("SL",(X,Q)=>c._(this,void 0,void 0,function*(){this._getLayerIndex(X).replace(Q)}))}_setImages(W,X){return c._(this,void 0,void 0,function*(){this.availableImages[W]=X;for(const Q in this.workerSources[W]){const le=this.workerSources[W][Q];for(const Pe in le)le[Pe].availableImages=X}})}_syncRTLPluginState(W,X){return c._(this,void 0,void 0,function*(){if(c.bA.isParsed())return c.bA.getState();if(X.pluginStatus!=="loading")return c.bA.setState(X),X;const Q=X.pluginURL;if(this.self.importScripts(Q),c.bA.isParsed()){const le={pluginStatus:"loaded",pluginURL:Q};return c.bA.setState(le),le}throw c.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${Q}`)})}_getAvailableImages(W){let X=this.availableImages[W];return X||(X=[]),X}_getLayerIndex(W){let X=this.layerIndexes[W];return X||(X=this.layerIndexes[W]=new l),X}_getWorkerSource(W,X,Q){if(this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][X]||(this.workerSources[W][X]={}),!this.workerSources[W][X][Q]){const le={sendAsync:(Pe,ee)=>(Pe.targetMapId=W,this.actor.sendAsync(Pe,ee))};switch(X){case"vector":this.workerSources[W][X][Q]=new E(le,this._getLayerIndex(W),this._getAvailableImages(W));break;case"geojson":this.workerSources[W][X][Q]=new za(le,this._getLayerIndex(W),this._getAvailableImages(W));break;default:this.workerSources[W][X][Q]=new this.externalWorkerSourceTypes[X](le,this._getLayerIndex(W),this._getAvailableImages(W))}}return this.workerSources[W][X][Q]}_getDEMWorkerSource(W,X){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][X]||(this.demWorkerSources[W][X]=new C),this.demWorkerSources[W][X]}}return c.i(self)&&(self.worker=new Jr(self)),Jr}),i("index",["exports","./shared"],function(c,l){var d="4.1.3";let y,S;const E={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:v=>new Promise((a,f)=>{const m=requestAnimationFrame(a);v.signal.addEventListener("abort",()=>{cancelAnimationFrame(m),f(l.c())})}),getImageData(v,a=0){return this.getImageCanvasContext(v).getImageData(-a,-a,v.width+2*a,v.height+2*a)},getImageCanvasContext(v){const a=window.document.createElement("canvas"),f=a.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return a.width=v.width,a.height=v.height,f.drawImage(v,0,0,v.width,v.height),f},resolveURL:v=>(y||(y=document.createElement("a")),y.href=v,y.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(S==null&&(S=matchMedia("(prefers-reduced-motion: reduce)")),S.matches)}};class C{static testProp(a){if(!C.docStyle)return a[0];for(let f=0;f<a.length;f++)if(a[f]in C.docStyle)return a[f];return a[0]}static create(a,f,m){const g=window.document.createElement(a);return f!==void 0&&(g.className=f),m&&m.appendChild(g),g}static createNS(a,f){return window.document.createElementNS(a,f)}static disableDrag(){C.docStyle&&C.selectProp&&(C.userSelect=C.docStyle[C.selectProp],C.docStyle[C.selectProp]="none")}static enableDrag(){C.docStyle&&C.selectProp&&(C.docStyle[C.selectProp]=C.userSelect)}static setTransform(a,f){a.style[C.transformProp]=f}static addEventListener(a,f,m,g={}){a.addEventListener(f,m,"passive"in g?g:g.capture)}static removeEventListener(a,f,m,g={}){a.removeEventListener(f,m,"passive"in g?g:g.capture)}static suppressClickInternal(a){a.preventDefault(),a.stopPropagation(),window.removeEventListener("click",C.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",C.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",C.suppressClickInternal,!0)},0)}static getScale(a){const f=a.getBoundingClientRect();return{x:f.width/a.offsetWidth||1,y:f.height/a.offsetHeight||1,boundingClientRect:f}}static getPoint(a,f,m){const g=f.boundingClientRect;return new l.P((m.clientX-g.left)/f.x-a.clientLeft,(m.clientY-g.top)/f.y-a.clientTop)}static mousePos(a,f){const m=C.getScale(a);return C.getPoint(a,m,f)}static touchPos(a,f){const m=[],g=C.getScale(a);for(let b=0;b<f.length;b++)m.push(C.getPoint(a,g,f[b]));return m}static mouseButton(a){return a.button}static remove(a){a.parentNode&&a.parentNode.removeChild(a)}}C.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,C.selectProp=C.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),C.transformProp=C.testProp(["transform","WebkitTransform"]);const A={supported:!1,testSupport:function(v){!N&&R&&(B?O(v):M=v)}};let M,R,N=!1,B=!1;function O(v){const a=v.createTexture();v.bindTexture(v.TEXTURE_2D,a);try{if(v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,R),v.isContextLost())return;A.supported=!0}catch{}v.deleteTexture(a),N=!0}var G;typeof document<"u"&&(R=document.createElement("img"),R.onload=function(){M&&O(M),M=null,B=!0},R.onerror=function(){N=!0,M=null},R.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(v){let a,f,m,g;v.resetRequestQueue=()=>{a=[],f=0,m=0,g={}},v.addThrottleControl=k=>{const z=m++;return g[z]=k,z},v.removeThrottleControl=k=>{delete g[k],T()},v.getImage=(k,z,j=!0)=>new Promise((q,$)=>{A.supported&&(k.headers||(k.headers={}),k.headers.accept="image/webp,*/*"),l.e(k,{type:"image"}),a.push({abortController:z,requestParameters:k,supportImageRefresh:j,state:"queued",onError:he=>{$(he)},onSuccess:he=>{q(he)}}),T()});const b=k=>l._(this,void 0,void 0,function*(){k.state="running";const{requestParameters:z,supportImageRefresh:j,onError:q,onSuccess:$,abortController:he}=k,ce=j===!1&&!l.i(self)&&!l.g(z.url)&&(!z.headers||Object.keys(z.headers).reduce((Ie,Ue)=>Ie&&Ue==="accept",!0));f++;const ye=ce?L(z,he):l.m(z,he);try{const Ie=yield ye;delete k.abortController,k.state="completed",Ie.data instanceof HTMLImageElement||l.b(Ie.data)?$(Ie):Ie.data&&$({data:yield(re=Ie.data,typeof createImageBitmap=="function"?l.d(re):l.f(re)),cacheControl:Ie.cacheControl,expires:Ie.expires})}catch(Ie){delete k.abortController,q(Ie)}finally{f--,T()}var re}),T=()=>{const k=(()=>{for(const z of Object.keys(g))if(g[z]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let z=f;z<k&&a.length>0;z++){const j=a.shift();j.abortController.signal.aborted?z--:b(j)}},L=(k,z)=>new Promise((j,q)=>{const $=new Image,he=k.url,ce=k.credentials;ce&&ce==="include"?$.crossOrigin="use-credentials":(ce&&ce==="same-origin"||!l.s(he))&&($.crossOrigin="anonymous"),z.signal.addEventListener("abort",()=>{$.src="",q(l.c())}),$.fetchPriority="high",$.onload=()=>{$.onerror=$.onload=null,j({data:$})},$.onerror=()=>{$.onerror=$.onload=null,z.signal.aborted||q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},$.src=he})}(G||(G={})),G.resetRequestQueue();class U{constructor(a){this._transformRequestFn=a}transformRequest(a,f){return this._transformRequestFn&&this._transformRequestFn(a,f)||{url:a}}normalizeSpriteURL(a,f,m){const g=function(b){const T=b.match(Z);if(!T)throw new Error(`Unable to parse URL "${b}"`);return{protocol:T[1],authority:T[2],path:T[3]||"/",params:T[4]?T[4].split("&"):[]}}(a);return g.path+=`${f}${m}`,function(b){const T=b.params.length?`?${b.params.join("&")}`:"";return`${b.protocol}://${b.authority}${b.path}${T}`}(g)}setTransformRequest(a){this._transformRequestFn=a}}const Z=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ue(v){var a=new l.A(3);return a[0]=v[0],a[1]=v[1],a[2]=v[2],a}var ae,se=function(v,a,f){return v[0]=a[0]-f[0],v[1]=a[1]-f[1],v[2]=a[2]-f[2],v};ae=new l.A(3),l.A!=Float32Array&&(ae[0]=0,ae[1]=0,ae[2]=0);var fe=function(v){var a=v[0],f=v[1];return a*a+f*f};function ke(v){const a=[];if(typeof v=="string")a.push({id:"default",url:v});else if(v&&v.length>0){const f=[];for(const{id:m,url:g}of v){const b=`${m}${g}`;f.indexOf(b)===-1&&(f.push(b),a.push({id:m,url:g}))}}return a}(function(){var v=new l.A(2);l.A!=Float32Array&&(v[0]=0,v[1]=0)})();class K{constructor(a,f,m,g){this.context=a,this.format=m,this.texture=a.gl.createTexture(),this.update(f,g)}update(a,f,m){const{width:g,height:b}=a,T=!(this.size&&this.size[0]===g&&this.size[1]===b||m),{context:L}=this,{gl:k}=L;if(this.useMipmap=!!(f&&f.useMipmap),k.bindTexture(k.TEXTURE_2D,this.texture),L.pixelStoreUnpackFlipY.set(!1),L.pixelStoreUnpack.set(1),L.pixelStoreUnpackPremultiplyAlpha.set(this.format===k.RGBA&&(!f||f.premultiply!==!1)),T)this.size=[g,b],a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||l.b(a)?k.texImage2D(k.TEXTURE_2D,0,this.format,this.format,k.UNSIGNED_BYTE,a):k.texImage2D(k.TEXTURE_2D,0,this.format,g,b,0,this.format,k.UNSIGNED_BYTE,a.data);else{const{x:z,y:j}=m||{x:0,y:0};a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||l.b(a)?k.texSubImage2D(k.TEXTURE_2D,0,z,j,k.RGBA,k.UNSIGNED_BYTE,a):k.texSubImage2D(k.TEXTURE_2D,0,z,j,g,b,k.RGBA,k.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&k.generateMipmap(k.TEXTURE_2D)}bind(a,f,m){const{context:g}=this,{gl:b}=g;b.bindTexture(b.TEXTURE_2D,this.texture),m!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(m=b.LINEAR),a!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,a),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,m||a),this.filter=a),f!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,f),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,f),this.wrap=f)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}function oe(v){const{userImage:a}=v;return!!(a&&a.render&&a.render())&&(v.data.replace(new Uint8Array(a.data.buffer)),!0)}class Ge extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:f,promiseResolve:m}of this.requestors)m(this._getImagesForIds(f));this.requestors=[]}}getImage(a){const f=this.images[a];if(f&&!f.data&&f.spriteData){const m=f.spriteData;f.data=new l.R({width:m.width,height:m.height},m.context.getImageData(m.x,m.y,m.width,m.height).data),f.spriteData=null}return f}addImage(a,f){if(this.images[a])throw new Error(`Image id ${a} already exist, use updateImage instead`);this._validate(a,f)&&(this.images[a]=f)}_validate(a,f){let m=!0;const g=f.data||f.spriteData;return this._validateStretch(f.stretchX,g&&g.width)||(this.fire(new l.j(new Error(`Image "${a}" has invalid "stretchX" value`))),m=!1),this._validateStretch(f.stretchY,g&&g.height)||(this.fire(new l.j(new Error(`Image "${a}" has invalid "stretchY" value`))),m=!1),this._validateContent(f.content,f)||(this.fire(new l.j(new Error(`Image "${a}" has invalid "content" value`))),m=!1),m}_validateStretch(a,f){if(!a)return!0;let m=0;for(const g of a){if(g[0]<m||g[1]<g[0]||f<g[1])return!1;m=g[1]}return!0}_validateContent(a,f){if(!a)return!0;if(a.length!==4)return!1;const m=f.spriteData,g=m&&m.width||f.data.width,b=m&&m.height||f.data.height;return!(a[0]<0||g<a[0]||a[1]<0||b<a[1]||a[2]<0||g<a[2]||a[3]<0||b<a[3]||a[2]<a[0]||a[3]<a[1])}updateImage(a,f,m=!0){const g=this.getImage(a);if(m&&(g.data.width!==f.data.width||g.data.height!==f.data.height))throw new Error(`size mismatch between old image (${g.data.width}x${g.data.height}) and new image (${f.data.width}x${f.data.height}).`);f.version=g.version+1,this.images[a]=f,this.updatedImages[a]=!0}removeImage(a){const f=this.images[a];delete this.images[a],delete this.patterns[a],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a){return new Promise((f,m)=>{let g=!0;if(!this.isLoaded())for(const b of a)this.images[b]||(g=!1);this.isLoaded()||g?f(this._getImagesForIds(a)):this.requestors.push({ids:a,promiseResolve:f})})}_getImagesForIds(a){const f={};for(const m of a){let g=this.getImage(m);g||(this.fire(new l.k("styleimagemissing",{id:m})),g=this.getImage(m)),g?f[m]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:!!(g.userImage&&g.userImage.render)}:l.w(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return f}getPixelSize(){const{width:a,height:f}=this.atlasImage;return{width:a,height:f}}getPattern(a){const f=this.patterns[a],m=this.getImage(a);if(!m)return null;if(f&&f.position.version===m.version)return f.position;if(f)f.position.version=m.version;else{const g={w:m.data.width+2,h:m.data.height+2,x:0,y:0},b=new l.I(g,m);this.patterns[a]={bin:g,position:b}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const f=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new K(a,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const b in this.patterns)a.push(this.patterns[b].bin);const{w:f,h:m}=l.p(a),g=this.atlasImage;g.resize({width:f||1,height:m||1});for(const b in this.patterns){const{bin:T}=this.patterns[b],L=T.x+1,k=T.y+1,z=this.getImage(b).data,j=z.width,q=z.height;l.R.copy(z,g,{x:0,y:0},{x:L,y:k},{width:j,height:q}),l.R.copy(z,g,{x:0,y:q-1},{x:L,y:k-1},{width:j,height:1}),l.R.copy(z,g,{x:0,y:0},{x:L,y:k+q},{width:j,height:1}),l.R.copy(z,g,{x:j-1,y:0},{x:L-1,y:k},{width:1,height:q}),l.R.copy(z,g,{x:0,y:0},{x:L+j,y:k},{width:1,height:q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const f of a){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const m=this.getImage(f);m||l.w(`Image with ID: "${f}" was not found`),oe(m)&&this.updateImage(f,m)}}}const Te=1e20;function ot(v,a,f,m,g,b,T,L,k){for(let z=a;z<a+m;z++)ft(v,f*b+z,b,g,T,L,k);for(let z=f;z<f+g;z++)ft(v,z*b+a,1,m,T,L,k)}function ft(v,a,f,m,g,b,T){b[0]=0,T[0]=-Te,T[1]=Te,g[0]=v[a];for(let L=1,k=0,z=0;L<m;L++){g[L]=v[a+L*f];const j=L*L;do{const q=b[k];z=(g[L]-g[q]+j-q*q)/(L-q)/2}while(z<=T[k]&&--k>-1);k++,b[k]=L,T[k]=z,T[k+1]=Te}for(let L=0,k=0;L<m;L++){for(;T[k+1]<L;)k++;const z=b[k],j=L-z;v[a+L*f]=g[z]+j*j}}class At{constructor(a,f){this.requestManager=a,this.localIdeographFontFamily=f,this.entries={}}setURL(a){this.url=a}getGlyphs(a){return l._(this,void 0,void 0,function*(){const f=[];for(const b in a)for(const T of a[b])f.push(this._getAndCacheGlyphsPromise(b,T));const m=yield Promise.all(f),g={};for(const{stack:b,id:T,glyph:L}of m)g[b]||(g[b]={}),g[b][T]=L&&{id:L.id,bitmap:L.bitmap.clone(),metrics:L.metrics};return g})}_getAndCacheGlyphsPromise(a,f){return l._(this,void 0,void 0,function*(){let m=this.entries[a];m||(m=this.entries[a]={glyphs:{},requests:{},ranges:{}});let g=m.glyphs[f];if(g!==void 0)return{stack:a,id:f,glyph:g};if(g=this._tinySDF(m,a,f),g)return m.glyphs[f]=g,{stack:a,id:f,glyph:g};const b=Math.floor(f/256);if(256*b>65535)throw new Error("glyphs > 65535 not supported");if(m.ranges[b])return{stack:a,id:f,glyph:g};if(!this.url)throw new Error("glyphsUrl is not set");if(!m.requests[b]){const L=At.loadGlyphRange(a,b,this.url,this.requestManager);m.requests[b]=L}const T=yield m.requests[b];for(const L in T)this._doesCharSupportLocalGlyph(+L)||(m.glyphs[+L]=T[+L]);return m.ranges[b]=!0,{stack:a,id:f,glyph:T[f]||null}})}_doesCharSupportLocalGlyph(a){return!!this.localIdeographFontFamily&&(l.u["CJK Unified Ideographs"](a)||l.u["Hangul Syllables"](a)||l.u.Hiragana(a)||l.u.Katakana(a))}_tinySDF(a,f,m){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(m))return;let b=a.tinySDF;if(!b){let L="400";/bold/i.test(f)?L="900":/medium/i.test(f)?L="500":/light/i.test(f)&&(L="200"),b=a.tinySDF=new At.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:g,fontWeight:L})}const T=b.draw(String.fromCharCode(m));return{id:m,bitmap:new l.o({width:T.width||60,height:T.height||60},T.data),metrics:{width:T.glyphWidth/2||24,height:T.glyphHeight/2||24,left:T.glyphLeft/2+.5||0,top:T.glyphTop/2-27.5||-8,advance:T.glyphAdvance/2||24,isDoubleResolution:!0}}}}At.loadGlyphRange=function(v,a,f,m){return l._(this,void 0,void 0,function*(){const g=256*a,b=g+255,T=m.transformRequest(f.replace("{fontstack}",v).replace("{range}",`${g}-${b}`),"Glyphs"),L=yield l.l(T,new AbortController);if(!L||!L.data)throw new Error(`Could not load glyph range. range: ${a}, ${g}-${b}`);const k={};for(const z of l.n(L.data))k[z.id]=z;return k})},At.TinySDF=class{constructor({fontSize:v=24,buffer:a=3,radius:f=8,cutoff:m=.25,fontFamily:g="sans-serif",fontWeight:b="normal",fontStyle:T="normal"}={}){this.buffer=a,this.cutoff=m,this.radius=f;const L=this.size=v+4*a,k=this._createCanvas(L),z=this.ctx=k.getContext("2d",{willReadFrequently:!0});z.font=`${T} ${b} ${v}px ${g}`,z.textBaseline="alphabetic",z.textAlign="left",z.fillStyle="black",this.gridOuter=new Float64Array(L*L),this.gridInner=new Float64Array(L*L),this.f=new Float64Array(L),this.z=new Float64Array(L+1),this.v=new Uint16Array(L)}_createCanvas(v){const a=document.createElement("canvas");return a.width=a.height=v,a}draw(v){const{width:a,actualBoundingBoxAscent:f,actualBoundingBoxDescent:m,actualBoundingBoxLeft:g,actualBoundingBoxRight:b}=this.ctx.measureText(v),T=Math.ceil(f),L=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-g))),k=Math.min(this.size-this.buffer,T+Math.ceil(m)),z=L+2*this.buffer,j=k+2*this.buffer,q=Math.max(z*j,0),$=new Uint8ClampedArray(q),he={data:$,width:z,height:j,glyphWidth:L,glyphHeight:k,glyphTop:T,glyphLeft:0,glyphAdvance:a};if(L===0||k===0)return he;const{ctx:ce,buffer:ye,gridInner:re,gridOuter:Ie}=this;ce.clearRect(ye,ye,L,k),ce.fillText(v,ye,ye+T);const Ue=ce.getImageData(ye,ye,L,k);Ie.fill(Te,0,q),re.fill(0,0,q);for(let xe=0;xe<k;xe++)for(let De=0;De<L;De++){const qe=Ue.data[4*(xe*L+De)+3]/255;if(qe===0)continue;const He=(xe+ye)*z+De+ye;if(qe===1)Ie[He]=0,re[He]=Te;else{const $e=.5-qe;Ie[He]=$e>0?$e*$e:0,re[He]=$e<0?$e*$e:0}}ot(Ie,0,0,z,j,z,this.f,this.v,this.z),ot(re,ye,ye,L,k,z,this.f,this.v,this.z);for(let xe=0;xe<q;xe++){const De=Math.sqrt(Ie[xe])-Math.sqrt(re[xe]);$[xe]=Math.round(255-255*(De/this.radius+this.cutoff))}return he}};class Ke{constructor(){this.specification=l.v.light.position}possiblyEvaluate(a,f){return l.y(a.expression.evaluate(f))}interpolate(a,f,m){return{x:l.z.number(a.x,f.x,m),y:l.z.number(a.y,f.y,m),z:l.z.number(a.z,f.z,m)}}}let Ft;class bt extends l.E{constructor(a){super(),Ft=Ft||new l.q({anchor:new l.D(l.v.light.anchor),position:new Ke,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(Ft),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,f={}){if(!this._validate(l.r,a,f))for(const m in a){const g=a[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),g):this._transitionable.setValue(m,g)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,f,m){return(!m||m.validate!==!1)&&l.t(this,a.call(l.x,{value:f,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}class Rt{constructor(a,f){this.width=a,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(a,f){const m=a.join(",")+String(f);return this.dashEntry[m]||(this.dashEntry[m]=this.addDash(a,f)),this.dashEntry[m]}getDashRanges(a,f,m){const g=[];let b=a.length%2==1?-a[a.length-1]*m:0,T=a[0]*m,L=!0;g.push({left:b,right:T,isDash:L,zeroLength:a[0]===0});let k=a[0];for(let z=1;z<a.length;z++){L=!L;const j=a[z];b=k*m,k+=j,T=k*m,g.push({left:b,right:T,isDash:L,zeroLength:j===0})}return g}addRoundDash(a,f,m){const g=f/2;for(let b=-m;b<=m;b++){const T=this.width*(this.nextRow+m+b);let L=0,k=a[L];for(let z=0;z<this.width;z++){z/k.right>1&&(k=a[++L]);const j=Math.abs(z-k.left),q=Math.abs(z-k.right),$=Math.min(j,q);let he;const ce=b/m*(g+1);if(k.isDash){const ye=g-Math.abs(ce);he=Math.sqrt($*$+ye*ye)}else he=g-Math.sqrt($*$+ce*ce);this.data[T+z]=Math.max(0,Math.min(255,he+128))}}}addRegularDash(a){for(let L=a.length-1;L>=0;--L){const k=a[L],z=a[L+1];k.zeroLength?a.splice(L,1):z&&z.isDash===k.isDash&&(z.left=k.left,a.splice(L,1))}const f=a[0],m=a[a.length-1];f.isDash===m.isDash&&(f.left=m.left-this.width,m.right=f.right+this.width);const g=this.width*this.nextRow;let b=0,T=a[b];for(let L=0;L<this.width;L++){L/T.right>1&&(T=a[++b]);const k=Math.abs(L-T.left),z=Math.abs(L-T.right),j=Math.min(k,z);this.data[g+L]=Math.max(0,Math.min(255,(T.isDash?j:-j)+128))}}addDash(a,f){const m=f?7:0,g=2*m+1;if(this.nextRow+g>this.height)return l.w("LineAtlas out of space"),null;let b=0;for(let L=0;L<a.length;L++)b+=a[L];if(b!==0){const L=this.width/b,k=this.getDashRanges(a,this.width,L);f?this.addRoundDash(k,L,m):this.addRegularDash(k)}const T={y:(this.nextRow+m+.5)/this.height,height:2*m/this.height,width:b};return this.nextRow+=g,this.dirty=!0,T}bind(a){const f=a.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))}}const Ot="maplibre_preloaded_worker_pool";class ln{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<ln.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.numActive()===0&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ot]}numActive(){return Object.keys(this.active).length}}const Ln=Math.floor(E.hardwareConcurrency/2);let an,Xt;function En(){return an||(an=new ln),an}ln.workerCount=l.B(globalThis)?Math.max(Math.min(Ln,3),1):1;class In{constructor(a,f){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=f;const m=this.workerPool.acquire(f);for(let g=0;g<m.length;g++){const b=new l.C(m[g],f);b.name=`Worker ${g}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(a,f){const m=[];for(const g of this.actors)m.push(g.sendAsync({type:a,data:f}));return Promise.all(m)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(a=!0){this.actors.forEach(f=>{f.remove()}),this.actors=[],a&&this.workerPool.release(this.id)}registerMessageHandler(a,f){for(const m of this.actors)m.registerMessageHandler(a,f)}}function rr(){return Xt||(Xt=new In(En(),l.G),Xt.registerMessageHandler("GR",(v,a,f)=>l.m(a,f))),Xt}function mt(v,a){const f=l.F();return l.H(f,f,[1,1,0]),l.J(f,f,[.5*v.width,.5*v.height,1]),l.K(f,f,v.calculatePosMatrix(a.toUnwrapped()))}function Dt(v,a,f,m,g,b){const T=function(q,$,he){if(q)for(const ce of q){const ye=$[ce];if(ye&&ye.source===he&&ye.type==="fill-extrusion")return!0}else for(const ce in $){const ye=$[ce];if(ye.source===he&&ye.type==="fill-extrusion")return!0}return!1}(g&&g.layers,a,v.id),L=b.maxPitchScaleFactor(),k=v.tilesIn(m,L,T);k.sort(Sn);const z=[];for(const q of k)z.push({wrappedTileID:q.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(a,f,v._state,q.queryGeometry,q.cameraQueryGeometry,q.scale,g,b,L,mt(v.transform,q.tileID))});const j=function(q){const $={},he={};for(const ce of q){const ye=ce.queryResults,re=ce.wrappedTileID,Ie=he[re]=he[re]||{};for(const Ue in ye){const xe=ye[Ue],De=Ie[Ue]=Ie[Ue]||{},qe=$[Ue]=$[Ue]||[];for(const He of xe)De[He.featureIndex]||(De[He.featureIndex]=!0,qe.push(He))}}return $}(z);for(const q in j)j[q].forEach($=>{const he=$.feature,ce=v.getFeatureState(he.layer["source-layer"],he.id);he.source=he.layer.source,he.layer["source-layer"]&&(he.sourceLayer=he.layer["source-layer"]),he.state=ce});return j}function Sn(v,a){const f=v.tileID,m=a.tileID;return f.overscaledZ-m.overscaledZ||f.canonical.y-m.canonical.y||f.wrap-m.wrap||f.canonical.x-m.canonical.x}function Le(v,a,f){return l._(this,void 0,void 0,function*(){let m=v;if(v.url?m=(yield l.h(a.transformRequest(v.url,"Source"),f)).data:yield E.frameAsync(f),!m)return null;const g=l.L(l.e(m,v),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in m&&m.vector_layers&&(g.vectorLayerIds=m.vector_layers.map(b=>b.id)),g})}class rt{constructor(a,f){a&&(f?this.setSouthWest(a).setNorthEast(f):Array.isArray(a)&&(a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1])))}setNorthEast(a){return this._ne=a instanceof l.M?new l.M(a.lng,a.lat):l.M.convert(a),this}setSouthWest(a){return this._sw=a instanceof l.M?new l.M(a.lng,a.lat):l.M.convert(a),this}extend(a){const f=this._sw,m=this._ne;let g,b;if(a instanceof l.M)g=a,b=a;else{if(!(a instanceof rt))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(rt.convert(a)):this.extend(l.M.convert(a)):a&&("lng"in a||"lon"in a)&&"lat"in a?this.extend(l.M.convert(a)):this;if(g=a._sw,b=a._ne,!g||!b)return this}return f||m?(f.lng=Math.min(g.lng,f.lng),f.lat=Math.min(g.lat,f.lat),m.lng=Math.max(b.lng,m.lng),m.lat=Math.max(b.lat,m.lat)):(this._sw=new l.M(g.lng,g.lat),this._ne=new l.M(b.lng,b.lat)),this}getCenter(){return new l.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.M(this.getWest(),this.getNorth())}getSouthEast(){return new l.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(a){const{lng:f,lat:m}=l.M.convert(a);let g=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&g}static convert(a){return a instanceof rt?a:a&&new rt(a)}static fromLngLat(a,f=0){const m=360*f/40075017,g=m/Math.cos(Math.PI/180*a.lat);return new rt(new l.M(a.lng-g,a.lat-m),new l.M(a.lng+g,a.lat+m))}}class gt{constructor(a,f,m){this.bounds=rt.convert(this.validateBounds(a)),this.minzoom=f||0,this.maxzoom=m||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const f=Math.pow(2,a.z),m=Math.floor(l.N(this.bounds.getWest())*f),g=Math.floor(l.O(this.bounds.getNorth())*f),b=Math.ceil(l.N(this.bounds.getEast())*f),T=Math.ceil(l.O(this.bounds.getSouth())*f);return a.x>=m&&a.x<b&&a.y>=g&&a.y<T}}class Nt extends l.E{constructor(a,f,m,g){if(super(),this.id=a,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.L(f,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Le(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),a&&(l.e(this,a),a.bounds&&(this.tileBounds=new gt(a.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(a){this._tileJSONRequest=null,this.fire(new l.j(a))}})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}setSourceProperty(a){this._tileJSONRequest&&this._tileJSONRequest.abort(),a(),this.load()}setTiles(a){return this.setSourceProperty(()=>{this._options.tiles=a}),this}setUrl(a){return this.setSourceProperty(()=>{this.url=a,this._options.url=a}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(a){return l._(this,void 0,void 0,function*(){const f=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(f,"Tile"),uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};m.request.collectResourceTiming=this._collectResourceTiming;let g="RT";if(a.actor&&a.state!=="expired"){if(a.state==="loading")return new Promise((b,T)=>{a.reloadPromise={resolve:b,reject:T}})}else a.actor=this.dispatcher.getActor(),g="LT";a.abortController=new AbortController;try{const b=yield a.actor.sendAsync({type:g,data:m},a.abortController);if(delete a.abortController,a.aborted)return;this._afterTileLoadWorkerResponse(a,b)}catch(b){if(delete a.abortController,a.aborted)return;if(b&&b.status!==404)throw b;this._afterTileLoadWorkerResponse(a,null)}})}_afterTileLoadWorkerResponse(a,f){if(f&&f.resourceTiming&&(a.resourceTiming=f.resourceTiming),f&&this.map._refreshExpiredTiles&&a.setExpiryData(f),a.loadVectorData(f,this.map.painter),a.reloadPromise){const m=a.reloadPromise;a.reloadPromise=null,this.loadTile(a).then(m.resolve).catch(m.reject)}}abortTile(a){return l._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController),a.actor&&(yield a.actor.sendAsync({type:"AT",data:{uid:a.uid,type:this.type,source:this.id}}))})}unloadTile(a){return l._(this,void 0,void 0,function*(){a.unloadVectorData(),a.actor&&(yield a.actor.sendAsync({type:"RMT",data:{uid:a.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class me extends l.E{constructor(a,f,m,g){super(),this.id=a,this.dispatcher=m,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},f),l.e(this,l.L(f,["url","scheme","tileSize"]))}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Le(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(l.e(this,a),a.bounds&&(this.tileBounds=new gt(a.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(a){this._tileJSONRequest=null,this.fire(new l.j(a))}})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(a){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),a(),this.load()}setTiles(a){return this.setSourceProperty(()=>{this._options.tiles=a}),this}setUrl(a){return this.setSourceProperty(()=>{this.url=a,this._options.url=a}),this}serialize(){return l.e({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a){return l._(this,void 0,void 0,function*(){const f=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);a.abortController=new AbortController;try{const m=yield G.getImage(this.map._requestManager.transformRequest(f,"Tile"),a.abortController,this.map._refreshExpiredTiles);if(delete a.abortController,a.aborted)return void(a.state="unloaded");if(m&&m.data){this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&a.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const g=this.map.painter.context,b=g.gl,T=m.data;a.texture=this.map.painter.getTileTexture(T.width),a.texture?a.texture.update(T,{useMipmap:!0}):(a.texture=new K(g,T,b.RGBA,{useMipmap:!0}),a.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),g.extTextureFilterAnisotropic&&b.texParameterf(b.TEXTURE_2D,g.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,g.extTextureFilterAnisotropicMax)),a.state="loaded"}}catch(m){if(delete a.abortController,a.aborted)a.state="unloaded";else if(m)throw a.state="errored",m}})}abortTile(a){return l._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController)})}unloadTile(a){return l._(this,void 0,void 0,function*(){a.texture&&this.map.painter.saveTileTexture(a.texture)})}hasTransition(){return!1}}class tn extends me{constructor(a,f,m,g){super(a,f,m,g),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},f),this.encoding=f.encoding||"mapbox",this.redFactor=f.redFactor,this.greenFactor=f.greenFactor,this.blueFactor=f.blueFactor,this.baseShift=f.baseShift}loadTile(a){return l._(this,void 0,void 0,function*(){const f=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m=this.map._requestManager.transformRequest(f,"Tile");a.neighboringTiles=this._getNeighboringTiles(a.tileID),a.abortController=new AbortController;try{const g=yield G.getImage(m,a.abortController,this.map._refreshExpiredTiles);if(delete a.abortController,a.aborted)return void(a.state="unloaded");if(g&&g.data){const b=g.data;this.map._refreshExpiredTiles&&g.cacheControl&&g.expires&&a.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});const T=l.b(b)&&l.S()?b:yield this.readImageNow(b),L={type:this.type,uid:a.uid,source:this.id,rawImageData:T,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!a.actor||a.state==="expired"){a.actor=this.dispatcher.getActor();const k=yield a.actor.sendAsync({type:"LDT",data:L});a.dem=k,a.needsHillshadePrepare=!0,a.needsTerrainPrepare=!0,a.state="loaded"}}}catch(g){if(delete a.abortController,a.aborted)a.state="unloaded";else if(g)throw a.state="errored",g}})}readImageNow(a){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.U()){const f=a.width+2,m=a.height+2;try{return new l.R({width:f,height:m},yield l.V(a,-1,-1,f,m))}catch{}}return E.getImageData(a,1)})}_getNeighboringTiles(a){const f=a.canonical,m=Math.pow(2,f.z),g=(f.x-1+m)%m,b=f.x===0?a.wrap-1:a.wrap,T=(f.x+1+m)%m,L=f.x+1===m?a.wrap+1:a.wrap,k={};return k[new l.Q(a.overscaledZ,b,f.z,g,f.y).key]={backfilled:!1},k[new l.Q(a.overscaledZ,L,f.z,T,f.y).key]={backfilled:!1},f.y>0&&(k[new l.Q(a.overscaledZ,b,f.z,g,f.y-1).key]={backfilled:!1},k[new l.Q(a.overscaledZ,a.wrap,f.z,f.x,f.y-1).key]={backfilled:!1},k[new l.Q(a.overscaledZ,L,f.z,T,f.y-1).key]={backfilled:!1}),f.y+1<m&&(k[new l.Q(a.overscaledZ,b,f.z,g,f.y+1).key]={backfilled:!1},k[new l.Q(a.overscaledZ,a.wrap,f.z,f.x,f.y+1).key]={backfilled:!1},k[new l.Q(a.overscaledZ,L,f.z,T,f.y+1).key]={backfilled:!1}),k}unloadTile(a){return l._(this,void 0,void 0,function*(){a.demTexture&&this.map.painter.saveTileTexture(a.demTexture),a.fbo&&(a.fbo.destroy(),delete a.fbo),a.dem&&delete a.dem,delete a.neighboringTiles,a.state="unloaded",a.actor&&(yield a.actor.sendAsync({type:"RDT",data:{type:this.type,uid:a.uid,source:this.id}}))})}}class Xe extends l.E{constructor(a,f,m,g){super(),this.id=a,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=m.getActor(),this.setEventedParent(g),this._data=f.data,this._options=l.e({},f),this._collectResourceTiming=f.collectResourceTiming,f.maxzoom!==void 0&&(this.maxzoom=f.maxzoom),f.type&&(this.type=f.type),f.attribution&&(this.attribution=f.attribution),this.promoteId=f.promoteId;const b=l.W/this.tileSize;this.workerOptions=l.e({source:this.id,cluster:f.cluster||!1,geojsonVtOptions:{buffer:(f.buffer!==void 0?f.buffer:128)*b,tolerance:(f.tolerance!==void 0?f.tolerance:.375)*b,extent:l.W,maxZoom:this.maxzoom,lineMetrics:f.lineMetrics||!1,generateId:f.generateId||!1},superclusterOptions:{maxZoom:f.clusterMaxZoom!==void 0?f.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,f.clusterMinPoints||2),extent:l.W,radius:(f.clusterRadius||50)*b,log:!1,generateId:f.generateId||!1},clusterProperties:f.clusterProperties,filter:f.filter},f.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(a){this.map=a,this.load()}setData(a){return this._data=a,this._updateWorkerData(),this}updateData(a){return this._updateWorkerData(a),this}setClusterOptions(a){return this.workerOptions.cluster=a.cluster,a&&(a.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=a.clusterRadius),a.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=a.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(a){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:a,source:this.id}})}getClusterChildren(a){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:a,source:this.id}})}getClusterLeaves(a,f,m){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:a,limit:f,offset:m}})}_updateWorkerData(a){return l._(this,void 0,void 0,function*(){const f=l.e({type:this.type},this.workerOptions);a?f.dataDiff=a:typeof this._data=="string"?(f.request=this.map._requestManager.transformRequest(E.resolveURL(this._data),"Source"),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"}));try{const m=yield this.actor.sendAsync({type:"LD",data:f});if(this._pendingLoads--,this._removed||m.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let g=null;m.resourceTiming&&m.resourceTiming[this.id]&&(g=m.resourceTiming[this.id].slice(0));const b={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&l.e(b,{resourceTiming:g}),this.fire(new l.k("data",Object.assign(Object.assign({},b),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},b),{sourceDataType:"content"})))}catch(m){if(this._pendingLoads--,this._removed)return void this.fire(new l.k("dataabort",{dataType:"source"}));this.fire(new l.j(m))}})}loaded(){return this._pendingLoads===0}loadTile(a){return l._(this,void 0,void 0,function*(){const f=a.actor?"RT":"LT";a.actor=this.actor;const m={type:this.type,uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};a.abortController=new AbortController;const g=yield this.actor.sendAsync({type:f,data:m},a.abortController);delete a.abortController,a.unloadVectorData(),a.aborted||a.loadVectorData(g,this.map.painter,f==="RT")})}abortTile(a){return l._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController),a.aborted=!0})}unloadTile(a){return l._(this,void 0,void 0,function*(){a.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:a.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var St=l.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class hn extends l.E{constructor(a,f,m,g){super(),this.id=a,this.dispatcher=m,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=f}load(a){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const f=yield G.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,f&&f.data&&(this.image=f.data,a&&(this.coordinates=a),this._finishLoading())}catch(f){this._request=null,this._loaded=!0,this.fire(new l.j(f))}})}loaded(){return this._loaded}updateImage(a){return a.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=a.url,this.load(a.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(a){this.coordinates=a;const f=a.map(l.Y.fromLngLat);this.tileID=function(g){let b=1/0,T=1/0,L=-1/0,k=-1/0;for(const $ of g)b=Math.min(b,$.x),T=Math.min(T,$.y),L=Math.max(L,$.x),k=Math.max(k,$.y);const z=Math.max(L-b,k-T),j=Math.max(0,Math.floor(-Math.log(z)/Math.LN2)),q=Math.pow(2,j);return new l.a0(j,Math.floor((b+L)/2*q),Math.floor((T+k)/2*q))}(f),this.minzoom=this.maxzoom=this.tileID.z;const m=f.map(g=>this.tileID.getTilePoint(g)._round());return this._boundsArray=new l.Z,this._boundsArray.emplaceBack(m[0].x,m[0].y,0,0),this._boundsArray.emplaceBack(m[1].x,m[1].y,l.W,0),this._boundsArray.emplaceBack(m[3].x,m[3].y,0,l.W),this._boundsArray.emplaceBack(m[2].x,m[2].y,l.W,l.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const a=this.map.painter.context,f=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,St.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new K(a,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let m=!1;for(const g in this.tiles){const b=this.tiles[g];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,m=!0)}m&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(a){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={}):a.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Ai extends hn{constructor(a,f,m,g){super(a,f,m,g),this.roundZoom=!0,this.type="video",this.options=f}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const a=this.options;this.urls=[];for(const f of a.urls)this.urls.push(this.map._requestManager.transformRequest(f,"Source").url);try{const f=yield l.a2(this.urls);if(this._loaded=!0,!f)return;this.video=f,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(f){this.fire(new l.j(f))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(a){if(this.video){const f=this.video.seekable;a<f.start(0)||a>f.end(0)?this.fire(new l.j(new l.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${f.start(0)} and ${f.end(0)}-second mark.`))):this.video.currentTime=a}}getVideo(){return this.video}onAdd(a){this.map||(this.map=a,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const a=this.map.painter.context,f=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,St.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,f.UNSIGNED_BYTE,this.video)):(this.texture=new K(a,this.video,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let m=!1;for(const g in this.tiles){const b=this.tiles[g];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,m=!0)}m&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ls extends hn{constructor(a,f,m,g){super(a,f,m,g),f.coordinates?Array.isArray(f.coordinates)&&f.coordinates.length===4&&!f.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(T=>typeof T!="number"))||this.fire(new l.j(new l.a1(`sources.${a}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.a1(`sources.${a}`,null,'missing required property "coordinates"'))),f.animate&&typeof f.animate!="boolean"&&this.fire(new l.j(new l.a1(`sources.${a}`,null,'optional "animate" property must be a boolean value'))),f.canvas?typeof f.canvas=="string"||f.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.a1(`sources.${a}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.a1(`sources.${a}`,null,'missing required property "canvas"'))),this.options=f,this.animate=f.animate===void 0||f.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(a){this.map=a,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let a=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,a=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,a=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const f=this.map.painter.context,m=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,St.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?(a||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new K(f,this.canvas,m.RGBA,{premultiply:!0});let g=!1;for(const b in this.tiles){const T=this.tiles[b];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,g=!0)}g&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const a of[this.canvas.width,this.canvas.height])if(isNaN(a)||a<=0)return!0;return!1}}const Js={},al=v=>{switch(v){case"geojson":return Xe;case"image":return hn;case"raster":return me;case"raster-dem":return tn;case"vector":return Nt;case"video":return Ai;case"canvas":return Ls}return Js[v]},ji="RTLPluginLoaded";class jl extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=rr()}_syncState(a){return this.status=a,this.dispatcher.broadcast("SRPS",{pluginStatus:a,pluginURL:this.url}).catch(f=>{throw this.status="error",f})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(a){return l._(this,arguments,void 0,function*(f,m=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=E.resolveURL(f),!this.url)throw new Error(`requested url ${f} is invalid`);if(this.status==="unavailable"){if(!m)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.k(ji))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ps=null;function lt(){return Ps||(Ps=new jl),Ps}class hs{constructor(a,f){this.timeAdded=0,this.fadeEndTime=0,this.tileID=a,this.uid=l.a3(),this.uses=0,this.tileSize=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(a){const f=a+this.timeAdded;f<this.fadeEndTime||(this.fadeEndTime=f)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(a){this.demTexture&&a.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(a,f,m){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(g,b){const T={};if(!b)return T;for(const L of g){const k=L.layerIds.map(z=>b.getLayer(z)).filter(Boolean);if(k.length!==0){L.layers=k,L.stateDependentLayerIds&&(L.stateDependentLayers=L.stateDependentLayerIds.map(z=>k.filter(j=>j.id===z)[0]));for(const z of k)T[z.id]=L}}return T}(a.buckets,f.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const b=this.buckets[g];if(b instanceof l.a5){if(this.hasSymbolBuckets=!0,!m)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const b=this.buckets[g];if(b instanceof l.a5&&b.hasRTLText){this.hasRTLText=!0,lt().lazyLoad();break}}this.queryPadding=0;for(const g in this.buckets){const b=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,f.style.getLayer(g).queryRadius(b))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new l.a4}unloadVectorData(){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(a){return this.buckets[a.id]}upload(a){for(const m in this.buckets){const g=this.buckets[m];g.uploadPending()&&g.upload(a)}const f=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new K(a,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new K(a,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)}prepare(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)}queryRenderedFeatures(a,f,m,g,b,T,L,k,z,j){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:b,scale:T,tileSize:this.tileSize,pixelPosMatrix:j,transform:k,params:L,queryPadding:this.queryPadding*z},a,f,m):{}}querySourceFeatures(a,f){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const g=m.loadVTLayers(),b=f&&f.sourceLayer?f.sourceLayer:"",T=g._geojsonTileLayer||g[b];if(!T)return;const L=l.a6(f&&f.filter),{z:k,x:z,y:j}=this.tileID.canonical,q={z:k,x:z,y:j};for(let $=0;$<T.length;$++){const he=T.feature($);if(L.needGeometry){const re=l.a7(he,!0);if(!L.filter(new l.a8(this.tileID.overscaledZ),re,this.tileID.canonical))continue}else if(!L.filter(new l.a8(this.tileID.overscaledZ),he))continue;const ce=m.getId(he,b),ye=new l.a9(he,k,z,j,ce);ye.tile=q,a.push(ye)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(a){const f=this.expirationTime;if(a.cacheControl){const m=l.aa(a.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){const m=Date.now();let g=!1;if(this.expirationTime>m)g=!1;else if(f)if(this.expirationTime<f)g=!0;else{const b=this.expirationTime-f;b?this.expirationTime=m+Math.max(b,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(a,f){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(a).length===0)return;const m=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!f.style.hasLayer(g))continue;const b=this.buckets[g],T=b.layers[0].sourceLayer||"_geojsonTileLayer",L=m[T],k=a[T];if(!L||!k||Object.keys(k).length===0)continue;b.update(k,L,this.imageAtlas&&this.imageAtlas.patternPositions||{});const z=f&&f.style&&f.style.getLayer(g);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<E.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(a){this.symbolFadeHoldUntil=E.now()+a}setDependencies(a,f){const m={};for(const g of f)m[g]=!0;this.dependencies[a]=m}hasDependency(a,f){for(const m of a){const g=this.dependencies[m];if(g){for(const b of f)if(g[b])return!0}}return!1}}class fo{constructor(a,f){this.max=a,this.onRemove=f,this.reset()}reset(){for(const a in this.data)for(const f of this.data[a])f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value);return this.data={},this.order=[],this}add(a,f,m){const g=a.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const b={value:f,timeout:void 0};if(m!==void 0&&(b.timeout=setTimeout(()=>{this.remove(a,b)},m)),this.data[g].push(b),this.order.push(g),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){const f=this.data[a].shift();return f.timeout&&clearTimeout(f.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),f.value}getByKey(a){const f=this.data[a];return f?f[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,f){if(!this.has(a))return this;const m=a.wrapped().key,g=f===void 0?0:this.data[m].indexOf(f),b=this.data[m][g];return this.data[m].splice(g,1),b.timeout&&clearTimeout(b.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(b.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}filter(a){const f=[];for(const m in this.data)for(const g of this.data[m])a(g.value)||f.push(g);for(const m of f)this.remove(m.value.tileID,m)}}class Gl{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(a,f,m){const g=String(f);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][g]=this.stateChanges[a][g]||{},l.e(this.stateChanges[a][g],m),this.deletedStates[a]===null){this.deletedStates[a]={};for(const b in this.state[a])b!==g&&(this.deletedStates[a][b]=null)}else if(this.deletedStates[a]&&this.deletedStates[a][g]===null){this.deletedStates[a][g]={};for(const b in this.state[a][g])m[b]||(this.deletedStates[a][g][b]=null)}else for(const b in m)this.deletedStates[a]&&this.deletedStates[a][g]&&this.deletedStates[a][g][b]===null&&delete this.deletedStates[a][g][b]}removeFeatureState(a,f,m){if(this.deletedStates[a]===null)return;const g=String(f);if(this.deletedStates[a]=this.deletedStates[a]||{},m&&f!==void 0)this.deletedStates[a][g]!==null&&(this.deletedStates[a][g]=this.deletedStates[a][g]||{},this.deletedStates[a][g][m]=null);else if(f!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][g])for(m in this.deletedStates[a][g]={},this.stateChanges[a][g])this.deletedStates[a][g][m]=null;else this.deletedStates[a][g]=null;else this.deletedStates[a]=null}getState(a,f){const m=String(f),g=l.e({},(this.state[a]||{})[m],(this.stateChanges[a]||{})[m]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){const b=this.deletedStates[a][f];if(b===null)return{};for(const T in b)delete g[T]}return g}initializeTileState(a,f){a.setFeatureState(this.state,f)}coalesceChanges(a,f){const m={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const b={};for(const T in this.stateChanges[g])this.state[g][T]||(this.state[g][T]={}),l.e(this.state[g][T],this.stateChanges[g][T]),b[T]=this.state[g][T];m[g]=b}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const b={};if(this.deletedStates[g]===null)for(const T in this.state[g])b[T]={},this.state[g][T]={};else for(const T in this.deletedStates[g]){if(this.deletedStates[g][T]===null)this.state[g][T]={};else for(const L of Object.keys(this.deletedStates[g][T]))delete this.state[g][T][L];b[T]=this.state[g][T]}m[g]=m[g]||{},l.e(m[g],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const g in a)a[g].setFeatureState(m,f)}}class li extends l.E{constructor(a,f,m){super(),this.id=a,this.dispatcher=m,this.on("data",g=>this._dataHandler(g)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((g,b,T,L)=>{const k=new(al(b.type))(g,b,T,L);if(k.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${k.id}`);return k})(a,f,m,this),this._tiles={},this._cache=new fo(0,g=>this._unloadTile(g)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Gl,this._didEmitContent=!1,this._updated=!1}onAdd(a){this.map=a,this._maxTileCacheSize=a?a._maxTileCacheSize:null,this._maxTileCacheZoomLevels=a?a._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(a)}onRemove(a){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(a)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const a in this._tiles){const f=this._tiles[a];if(f.state!=="loaded"&&f.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(a,f,m){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(a),this._tileLoaded(a,f,m)}catch(g){a.state="errored",g.status!==404?this._source.fire(new l.j(g,{tile:a})):this.update(this.transform,this.terrain)}})}_unloadTile(a){this._source.unloadTile&&this._source.unloadTile(a)}_abortTile(a){this._source.abortTile&&this._source.abortTile(a),this._source.fire(new l.k("dataabort",{tile:a,coord:a.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(a){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const f in this._tiles){const m=this._tiles[f];m.upload(a),m.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(a=>a.tileID).sort(pt).map(a=>a.key)}getRenderableIds(a){const f=[];for(const m in this._tiles)this._isIdRenderable(m,a)&&f.push(this._tiles[m]);return a?f.sort((m,g)=>{const b=m.tileID,T=g.tileID,L=new l.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),k=new l.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-T.overscaledZ||k.y-L.y||k.x-L.x}).map(m=>m.tileID.key):f.map(m=>m.tileID).sort(pt).map(m=>m.key)}hasRenderableParent(a){const f=this.findLoadedParent(a,0);return!!f&&this._isIdRenderable(f.tileID.key)}_isIdRenderable(a,f){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(f||!this._tiles[a].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")}}_reloadTile(a,f){return l._(this,void 0,void 0,function*(){const m=this._tiles[a];m&&(m.state!=="loading"&&(m.state=f),yield this._loadTile(m,a,f))})}_tileLoaded(a,f,m){a.timeAdded=E.now(),m==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(f,a),this.getSource().type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),a.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:a,coord:a.tileID}))}_backfillDEM(a){const f=this.getRenderableIds();for(let g=0;g<f.length;g++){const b=f[g];if(a.neighboringTiles&&a.neighboringTiles[b]){const T=this.getTileByID(b);m(a,T),m(T,a)}}function m(g,b){g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let T=b.tileID.canonical.x-g.tileID.canonical.x;const L=b.tileID.canonical.y-g.tileID.canonical.y,k=Math.pow(2,g.tileID.canonical.z),z=b.tileID.key;T===0&&L===0||Math.abs(L)>1||(Math.abs(T)>1&&(Math.abs(T+k)===1?T+=k:Math.abs(T-k)===1&&(T-=k)),b.dem&&g.dem&&(g.dem.backfillBorder(b.dem,T,L),g.neighboringTiles&&g.neighboringTiles[z]&&(g.neighboringTiles[z].backfilled=!0)))}}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._tiles[a]}_retainLoadedChildren(a,f,m,g){for(const b in this._tiles){let T=this._tiles[b];if(g[b]||!T.hasData()||T.tileID.overscaledZ<=f||T.tileID.overscaledZ>m)continue;let L=T.tileID;for(;T&&T.tileID.overscaledZ>f+1;){const z=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[z.key],T&&T.hasData()&&(L=z)}let k=L;for(;k.overscaledZ>f;)if(k=k.scaledTo(k.overscaledZ-1),a[k.key]){g[L.key]=L;break}}}findLoadedParent(a,f){if(a.key in this._loadedParentTiles){const m=this._loadedParentTiles[a.key];return m&&m.tileID.overscaledZ>=f?m:null}for(let m=a.overscaledZ-1;m>=f;m--){const g=a.scaledTo(m),b=this._getLoadedTile(g);if(b)return b}}_getLoadedTile(a){const f=this._tiles[a.key];return f&&f.hasData()?f:this._cache.getByKey(a.wrapped().key)}updateCacheSize(a){const f=Math.ceil(a.width/this._source.tileSize)+1,m=Math.ceil(a.height/this._source.tileSize)+1,g=Math.floor(f*m*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(b)}handleWrapJump(a){const f=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,f){const m={};for(const g in this._tiles){const b=this._tiles[g];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+f),m[b.tileID.key]=b}this._tiles=m;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}update(a,f){if(!this._sourceLoaded||this._paused)return;let m;this.transform=a,this.terrain=f,this.updateCacheSize(a),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(j=>new l.Q(j.canonical.z,j.wrap,j.canonical.z,j.canonical.x,j.canonical.y)):(m=a.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:f}),this._source.hasTile&&(m=m.filter(j=>this._source.hasTile(j)))):m=[];const g=a.coveringZoomLevel(this._source),b=Math.max(g-li.maxOverzooming,this._source.minzoom),T=Math.max(g+li.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const j={};for(const q of m)if(q.canonical.z>this._source.minzoom){const $=q.scaledTo(q.canonical.z-1);j[$.key]=$;const he=q.scaledTo(Math.max(this._source.minzoom,Math.min(q.canonical.z,5)));j[he.key]=he}m=m.concat(Object.values(j))}const L=m.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,L&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const k=this._updateRetainedTiles(m,g);if(mn(this._source.type)){const j={},q={},$=Object.keys(k),he=E.now();for(const ce of $){const ye=k[ce],re=this._tiles[ce];if(!re||re.fadeEndTime!==0&&re.fadeEndTime<=he)continue;const Ie=this.findLoadedParent(ye,b);Ie&&(this._addTile(Ie.tileID),j[Ie.tileID.key]=Ie.tileID),q[ce]=ye}this._retainLoadedChildren(q,g,T,k);for(const ce in j)k[ce]||(this._coveredTiles[ce]=!0,k[ce]=j[ce]);if(f){const ce={},ye={};for(const re of m)this._tiles[re.key].hasData()?ce[re.key]=re:ye[re.key]=re;for(const re in ye){const Ie=ye[re].children(this._source.maxzoom);this._tiles[Ie[0].key]&&this._tiles[Ie[1].key]&&this._tiles[Ie[2].key]&&this._tiles[Ie[3].key]&&(ce[Ie[0].key]=k[Ie[0].key]=Ie[0],ce[Ie[1].key]=k[Ie[1].key]=Ie[1],ce[Ie[2].key]=k[Ie[2].key]=Ie[2],ce[Ie[3].key]=k[Ie[3].key]=Ie[3],delete ye[re])}for(const re in ye){const Ie=this.findLoadedParent(ye[re],this._source.minzoom);if(Ie){ce[Ie.tileID.key]=k[Ie.tileID.key]=Ie.tileID;for(const Ue in ce)ce[Ue].isChildOf(Ie.tileID)&&delete ce[Ue]}}for(const re in this._tiles)ce[re]||(this._coveredTiles[re]=!0)}}for(const j in k)this._tiles[j].clearFadeHold();const z=l.ab(this._tiles,k);for(const j of z){const q=this._tiles[j];q.hasSymbolBuckets&&!q.holdingForFade()?q.setHoldDuration(this.map._fadeDuration):q.hasSymbolBuckets&&!q.symbolFadeFinished()||this._removeTile(j)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(a)}_updateRetainedTiles(a,f){const m={},g={},b=Math.max(f-li.maxOverzooming,this._source.minzoom),T=Math.max(f+li.maxUnderzooming,this._source.minzoom),L={};for(const k of a){const z=this._addTile(k);m[k.key]=k,z.hasData()||f<this._source.maxzoom&&(L[k.key]=k)}this._retainLoadedChildren(L,f,T,m);for(const k of a){let z=this._tiles[k.key];if(z.hasData())continue;if(f+1>this._source.maxzoom){const q=k.children(this._source.maxzoom)[0],$=this.getTile(q);if($&&$.hasData()){m[q.key]=q;continue}}else{const q=k.children(this._source.maxzoom);if(m[q[0].key]&&m[q[1].key]&&m[q[2].key]&&m[q[3].key])continue}let j=z.wasRequested();for(let q=k.overscaledZ-1;q>=b;--q){const $=k.scaledTo(q);if(g[$.key])break;if(g[$.key]=!0,z=this.getTile($),!z&&j&&(z=this._addTile($)),z){const he=z.hasData();if((j||he)&&(m[$.key]=$),j=z.wasRequested(),he)break}}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const a in this._tiles){const f=[];let m,g=this._tiles[a].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){m=this._loadedParentTiles[g.key];break}f.push(g.key);const b=g.scaledTo(g.overscaledZ-1);if(m=this._getLoadedTile(b),m)break;g=b}for(const b of f)this._loadedParentTiles[b]=m}}_addTile(a){let f=this._tiles[a.key];if(f)return f;f=this._cache.getAndRemove(a),f&&(this._setTileReloadTimer(a.key,f),f.tileID=a,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,f)));const m=f;return f||(f=new hs(a,this._source.tileSize*a.overscaleFactor()),this._loadTile(f,a.key,f.state)),f.uses++,this._tiles[a.key]=f,m||this._source.fire(new l.k("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f}_setTileReloadTimer(a,f){a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);const m=f.getExpiryTimeout();m&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},m))}_removeTile(a){const f=this._tiles[a];f&&(f.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),f.uses>0||(f.hasData()&&f.state!=="reloading"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))}_dataHandler(a){const f=a.sourceDataType;a.dataType==="source"&&f==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&a.dataType==="source"&&f==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const a in this._tiles)this._removeTile(a);this._cache.reset()}tilesIn(a,f,m){const g=[],b=this.transform;if(!b)return g;const T=m?b.getCameraQueryGeometry(a):a,L=a.map(ce=>b.pointCoordinate(ce,this.terrain)),k=T.map(ce=>b.pointCoordinate(ce,this.terrain)),z=this.getIds();let j=1/0,q=1/0,$=-1/0,he=-1/0;for(const ce of k)j=Math.min(j,ce.x),q=Math.min(q,ce.y),$=Math.max($,ce.x),he=Math.max(he,ce.y);for(let ce=0;ce<z.length;ce++){const ye=this._tiles[z[ce]];if(ye.holdingForFade())continue;const re=ye.tileID,Ie=Math.pow(2,b.zoom-ye.tileID.overscaledZ),Ue=f*ye.queryPadding*l.W/ye.tileSize/Ie,xe=[re.getTilePoint(new l.Y(j,q)),re.getTilePoint(new l.Y($,he))];if(xe[0].x-Ue<l.W&&xe[0].y-Ue<l.W&&xe[1].x+Ue>=0&&xe[1].y+Ue>=0){const De=L.map(He=>re.getTilePoint(He)),qe=k.map(He=>re.getTilePoint(He));g.push({tile:ye,tileID:re,queryGeometry:De,cameraQueryGeometry:qe,scale:Ie})}}return g}getVisibleCoordinates(a){const f=this.getRenderableIds(a).map(m=>this._tiles[m].tileID);for(const m of f)m.posMatrix=this.transform.calculatePosMatrix(m.toUnwrapped());return f}hasTransition(){if(this._source.hasTransition())return!0;if(mn(this._source.type)){const a=E.now();for(const f in this._tiles)if(this._tiles[f].fadeEndTime>=a)return!0}return!1}setFeatureState(a,f,m){this._state.updateState(a=a||"_geojsonTileLayer",f,m)}removeFeatureState(a,f,m){this._state.removeFeatureState(a=a||"_geojsonTileLayer",f,m)}getFeatureState(a,f){return this._state.getState(a=a||"_geojsonTileLayer",f)}setDependencies(a,f,m){const g=this._tiles[a];g&&g.setDependencies(f,m)}reloadTilesForDependencies(a,f){for(const m in this._tiles)this._tiles[m].hasDependency(a,f)&&this._reloadTile(m,"reloading");this._cache.filter(m=>!m.hasDependency(a,f))}}function pt(v,a){const f=Math.abs(2*v.wrap)-+(v.wrap<0),m=Math.abs(2*a.wrap)-+(a.wrap<0);return v.overscaledZ-a.overscaledZ||m-f||a.canonical.y-v.canonical.y||a.canonical.x-v.canonical.x}function mn(v){return v==="raster"||v==="image"||v==="video"}li.maxOverzooming=10,li.maxUnderzooming=3;class pn{constructor(a,f){this.reset(a,f)}reset(a,f){this.points=a||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=l.ac(a,0,1);let f=1,m=this._distances[f];const g=a*this.paddedLength+this.padding;for(;m<g&&f<this._distances.length;)m=this._distances[++f];const b=f-1,T=this._distances[b],L=m-T,k=L>0?(g-T)/L:0;return this.points[b].mult(1-k).add(this.points[f].mult(k))}}function Zr(v,a){let f=!0;return v==="always"||v!=="never"&&a!=="never"||(f=!1),f}class fs{constructor(a,f,m){const g=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(a/m),this.yCellCount=Math.ceil(f/m);for(let T=0;T<this.xCellCount*this.yCellCount;T++)g.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=f,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,f,m,g,b){this._forEachCell(f,m,g,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(g),this.bboxes.push(b)}insertCircle(a,f,m,g){this._forEachCell(f-g,m-g,f+g,m+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(f),this.circles.push(m),this.circles.push(g)}_insertBoxCell(a,f,m,g,b,T){this.boxCells[b].push(T)}_insertCircleCell(a,f,m,g,b,T){this.circleCells[b].push(T)}_query(a,f,m,g,b,T,L){if(m<0||a>this.width||g<0||f>this.height)return[];const k=[];if(a<=0&&f<=0&&this.width<=m&&this.height<=g){if(b)return[{key:null,x1:a,y1:f,x2:m,y2:g}];for(let z=0;z<this.boxKeys.length;z++)k.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const j=this.circles[3*z],q=this.circles[3*z+1],$=this.circles[3*z+2];k.push({key:this.circleKeys[z],x1:j-$,y1:q-$,x2:j+$,y2:q+$})}}else this._forEachCell(a,f,m,g,this._queryCell,k,{hitTest:b,overlapMode:T,seenUids:{box:{},circle:{}}},L);return k}query(a,f,m,g){return this._query(a,f,m,g,!1,null)}hitTest(a,f,m,g,b,T){return this._query(a,f,m,g,!0,b,T).length>0}hitTestCircle(a,f,m,g,b){const T=a-m,L=a+m,k=f-m,z=f+m;if(L<0||T>this.width||z<0||k>this.height)return!1;const j=[];return this._forEachCell(T,k,L,z,this._queryCellCircle,j,{hitTest:!0,overlapMode:g,circle:{x:a,y:f,radius:m},seenUids:{box:{},circle:{}}},b),j.length>0}_queryCell(a,f,m,g,b,T,L,k){const{seenUids:z,hitTest:j,overlapMode:q}=L,$=this.boxCells[b];if($!==null){const ce=this.bboxes;for(const ye of $)if(!z.box[ye]){z.box[ye]=!0;const re=4*ye,Ie=this.boxKeys[ye];if(a<=ce[re+2]&&f<=ce[re+3]&&m>=ce[re+0]&&g>=ce[re+1]&&(!k||k(Ie))&&(!j||!Zr(q,Ie.overlapMode))&&(T.push({key:Ie,x1:ce[re],y1:ce[re+1],x2:ce[re+2],y2:ce[re+3]}),j))return!0}}const he=this.circleCells[b];if(he!==null){const ce=this.circles;for(const ye of he)if(!z.circle[ye]){z.circle[ye]=!0;const re=3*ye,Ie=this.circleKeys[ye];if(this._circleAndRectCollide(ce[re],ce[re+1],ce[re+2],a,f,m,g)&&(!k||k(Ie))&&(!j||!Zr(q,Ie.overlapMode))){const Ue=ce[re],xe=ce[re+1],De=ce[re+2];if(T.push({key:Ie,x1:Ue-De,y1:xe-De,x2:Ue+De,y2:xe+De}),j)return!0}}}return!1}_queryCellCircle(a,f,m,g,b,T,L,k){const{circle:z,seenUids:j,overlapMode:q}=L,$=this.boxCells[b];if($!==null){const ce=this.bboxes;for(const ye of $)if(!j.box[ye]){j.box[ye]=!0;const re=4*ye,Ie=this.boxKeys[ye];if(this._circleAndRectCollide(z.x,z.y,z.radius,ce[re+0],ce[re+1],ce[re+2],ce[re+3])&&(!k||k(Ie))&&!Zr(q,Ie.overlapMode))return T.push(!0),!0}}const he=this.circleCells[b];if(he!==null){const ce=this.circles;for(const ye of he)if(!j.circle[ye]){j.circle[ye]=!0;const re=3*ye,Ie=this.circleKeys[ye];if(this._circlesCollide(ce[re],ce[re+1],ce[re+2],z.x,z.y,z.radius)&&(!k||k(Ie))&&!Zr(q,Ie.overlapMode))return T.push(!0),!0}}}_forEachCell(a,f,m,g,b,T,L,k){const z=this._convertToXCellCoord(a),j=this._convertToYCellCoord(f),q=this._convertToXCellCoord(m),$=this._convertToYCellCoord(g);for(let he=z;he<=q;he++)for(let ce=j;ce<=$;ce++)if(b.call(this,a,f,m,g,this.xCellCount*ce+he,T,L,k))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,f,m,g,b,T){const L=g-a,k=b-f,z=m+T;return z*z>L*L+k*k}_circleAndRectCollide(a,f,m,g,b,T,L){const k=(T-g)/2,z=Math.abs(a-(g+k));if(z>k+m)return!1;const j=(L-b)/2,q=Math.abs(f-(b+j));if(q>j+m)return!1;if(z<=k||q<=j)return!0;const $=z-k,he=q-j;return $*$+he*he<=m*m}}function fn(v,a,f,m,g){const b=l.F();return a?(l.J(b,b,[1/g,1/g,1]),f||l.ad(b,b,m.angle)):l.K(b,m.labelPlaneMatrix,v),b}function za(v,a,f,m,g){if(a){const b=l.ae(v);return l.J(b,b,[g,g,1]),f||l.ad(b,b,-m.angle),b}return m.glCoordMatrix}function Jr(v,a,f){let m;f?(m=[v.x,v.y,f(v.x,v.y),1],l.af(m,m,a)):(m=[v.x,v.y,0,1],Bt(m,m,a));const g=m[3];return{point:new l.P(m[0]/g,m[1]/g),signedDistanceFromCamera:g}}function _e(v,a){return .5+v/a*.5}function W(v,a){const f=v[0]/v[3],m=v[1]/v[3];return f>=-a[0]&&f<=a[0]&&m>=-a[1]&&m<=a[1]}function X(v,a,f,m,g,b,T,L,k,z){const j=m?v.textSizeData:v.iconSizeData,q=l.ag(j,f.transform.zoom),$=[256/f.width*2+1,256/f.height*2+1],he=m?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;he.clear();const ce=v.lineVertexArray,ye=m?v.text.placedSymbolArray:v.icon.placedSymbolArray,re=f.transform.width/f.transform.height;let Ie=!1;for(let Ue=0;Ue<ye.length;Ue++){const xe=ye.get(Ue);if(xe.hidden||xe.writingMode===l.ah.vertical&&!Ie){Je(xe.numGlyphs,he);continue}let De;if(Ie=!1,z?(De=[xe.anchorX,xe.anchorY,z(xe.anchorX,xe.anchorY),1],l.af(De,De,a)):(De=[xe.anchorX,xe.anchorY,0,1],Bt(De,De,a)),!W(De,$)){Je(xe.numGlyphs,he);continue}const qe=_e(f.transform.cameraToCenterDistance,De[3]),He=l.ai(j,q,xe),$e=T?He/qe:He*qe,it=new l.P(xe.anchorX,xe.anchorY),tt=Jr(it,g,z).point,ct={projections:{},offsets:{}},dt=Pe(xe,$e,!1,L,a,g,b,v.glyphOffsetArray,ce,he,tt,it,ct,re,k,z);Ie=dt.useVertical,(dt.notEnoughRoom||Ie||dt.needsFlipping&&Pe(xe,$e,!0,L,a,g,b,v.glyphOffsetArray,ce,he,tt,it,ct,re,k,z).notEnoughRoom)&&Je(xe.numGlyphs,he)}m?v.text.dynamicLayoutVertexBuffer.updateData(he):v.icon.dynamicLayoutVertexBuffer.updateData(he)}function Q(v,a,f,m,g,b,T,L,k,z,j,q,$){const he=L.glyphStartIndex+L.numGlyphs,ce=L.lineStartIndex,ye=L.lineStartIndex+L.lineLength,re=a.getoffsetX(L.glyphStartIndex),Ie=a.getoffsetX(he-1),Ue=We(v*re,f,m,g,b,T,L.segment,ce,ye,k,z,j,q,$);if(!Ue)return null;const xe=We(v*Ie,f,m,g,b,T,L.segment,ce,ye,k,z,j,q,$);return xe?{first:Ue,last:xe}:null}function le(v,a,f,m){return v===l.ah.horizontal&&Math.abs(f.y-a.y)>Math.abs(f.x-a.x)*m?{useVertical:!0}:(v===l.ah.vertical?a.y<f.y:a.x>f.x)?{needsFlipping:!0}:null}function Pe(v,a,f,m,g,b,T,L,k,z,j,q,$,he,ce,ye){const re=a/24,Ie=v.lineOffsetX*re,Ue=v.lineOffsetY*re;let xe;if(v.numGlyphs>1){const De=v.glyphStartIndex+v.numGlyphs,qe=v.lineStartIndex,He=v.lineStartIndex+v.lineLength,$e=Q(re,L,Ie,Ue,f,j,q,v,k,b,$,ce,ye);if(!$e)return{notEnoughRoom:!0};const it=Jr($e.first.point,T,ye).point,tt=Jr($e.last.point,T,ye).point;if(m&&!f){const ct=le(v.writingMode,it,tt,he);if(ct)return ct}xe=[$e.first];for(let ct=v.glyphStartIndex+1;ct<De-1;ct++)xe.push(We(re*L.getoffsetX(ct),Ie,Ue,f,j,q,v.segment,qe,He,k,b,$,ce,ye));xe.push($e.last)}else{if(m&&!f){const qe=Jr(q,g,ye).point,He=v.lineStartIndex+v.segment+1,$e=new l.P(k.getx(He),k.gety(He)),it=Jr($e,g,ye),tt=it.signedDistanceFromCamera>0?it.point:ee(q,$e,qe,1,g,ye),ct=le(v.writingMode,qe,tt,he);if(ct)return ct}const De=We(re*L.getoffsetX(v.glyphStartIndex),Ie,Ue,f,j,q,v.segment,v.lineStartIndex,v.lineStartIndex+v.lineLength,k,b,$,ce,ye);if(!De)return{notEnoughRoom:!0};xe=[De]}for(const De of xe)l.aj(z,De.point,De.angle);return{}}function ee(v,a,f,m,g,b){const T=Jr(v.add(v.sub(a)._unit()),g,b).point,L=f.sub(T);return f.add(L._mult(m/L.mag()))}function Me(v,a){const{projectionCache:f,lineVertexArray:m,labelPlaneMatrix:g,tileAnchorPoint:b,distanceFromAnchor:T,getElevation:L,previousVertex:k,direction:z,absOffsetX:j}=a;if(f.projections[v])return f.projections[v];const q=new l.P(m.getx(v),m.gety(v)),$=Jr(q,g,L);if($.signedDistanceFromCamera>0)return f.projections[v]=$.point,$.point;const he=v-z;return ee(T===0?b:new l.P(m.getx(he),m.gety(he)),q,k,j-T+1,g,L)}function Se(v,a,f){return v._unit()._perp()._mult(a*f)}function Re(v,a,f,m,g,b,T,L){const{projectionCache:k,direction:z}=L;if(k.offsets[v])return k.offsets[v];const j=f.add(a);if(v+z<m||v+z>=g)return k.offsets[v]=j,j;const q=Me(v+z,L),$=Se(q.sub(f),T,z),he=f.add($),ce=q.add($);return k.offsets[v]=l.ak(b,j,he,ce)||j,k.offsets[v]}function We(v,a,f,m,g,b,T,L,k,z,j,q,$,he){const ce=m?v-a:v+a;let ye=ce>0?1:-1,re=0;m&&(ye*=-1,re=Math.PI),ye<0&&(re+=Math.PI);let Ie,Ue,xe=ye>0?L+T:L+T+1,De=g,qe=g,He=0,$e=0;const it=Math.abs(ce),tt=[];let ct;for(;He+$e<=it;){if(xe+=ye,xe<L||xe>=k)return null;He+=$e,qe=De,Ue=Ie;const _t={projectionCache:q,lineVertexArray:z,labelPlaneMatrix:j,tileAnchorPoint:b,distanceFromAnchor:He,getElevation:he,previousVertex:qe,direction:ye,absOffsetX:it};if(De=Me(xe,_t),f===0)tt.push(qe),ct=De.sub(qe);else{let en;const _n=De.sub(qe);en=_n.mag()===0?Se(Me(xe+ye,_t).sub(De),f,ye):Se(_n,f,ye),Ue||(Ue=qe.add(en)),Ie=Re(xe,en,De,L,k,Ue,f,_t),tt.push(Ue),ct=Ie.sub(Ue)}$e=ct.mag()}const dt=ct._mult((it-He)/$e)._add(Ue||qe),gn=re+Math.atan2(De.y-qe.y,De.x-qe.x);return tt.push(dt),{point:dt,angle:$?gn:0,path:tt}}const Ye=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Je(v,a){for(let f=0;f<v;f++){const m=a.length;a.resize(m+4),a.float32.set(Ye,3*m)}}function Bt(v,a,f){const m=a[0],g=a[1];return v[0]=f[0]*m+f[4]*g+f[12],v[1]=f[1]*m+f[5]*g+f[13],v[3]=f[3]*m+f[7]*g+f[15],v}const qt=100;class sn{constructor(a,f=new fs(a.width+200,a.height+200,25),m=new fs(a.width+200,a.height+200,25)){this.transform=a,this.grid=f,this.ignoredGrid=m,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+qt,this.screenBottomBoundary=a.height+qt,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(a,f,m,g,b,T){const L=this.projectAndGetPerspectiveRatio(g,a.anchorPointX,a.anchorPointY,T),k=m*L.perspectiveRatio,z=a.x1*k+L.point.x,j=a.y1*k+L.point.y,q=a.x2*k+L.point.x,$=a.y2*k+L.point.y;return!this.isInsideGrid(z,j,q,$)||f!=="always"&&this.grid.hitTest(z,j,q,$,f,b)||L.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[z,j,q,$],offscreen:this.isOffscreen(z,j,q,$)}}placeCollisionCircles(a,f,m,g,b,T,L,k,z,j,q,$,he,ce){const ye=[],re=new l.P(f.anchorX,f.anchorY),Ie=Jr(re,T,ce),Ue=_e(this.transform.cameraToCenterDistance,Ie.signedDistanceFromCamera),xe=(j?b/Ue:b*Ue)/l.ao,De=Jr(re,L,ce).point,qe=Q(xe,g,f.lineOffsetX*xe,f.lineOffsetY*xe,!1,De,re,f,m,L,{projections:{},offsets:{}},!1,ce);let He=!1,$e=!1,it=!0;if(qe){const tt=.5*$*Ue+he,ct=new l.P(-100,-100),dt=new l.P(this.screenRightBoundary,this.screenBottomBoundary),gn=new pn,_t=qe.first,en=qe.last;let _n=[];for(let bn=_t.path.length-1;bn>=1;bn--)_n.push(_t.path[bn]);for(let bn=1;bn<en.path.length;bn++)_n.push(en.path[bn]);const Fn=2.5*tt;if(k){const bn=_n.map(Cn=>Jr(Cn,k,ce));_n=bn.some(Cn=>Cn.signedDistanceFromCamera<=0)?[]:bn.map(Cn=>Cn.point)}let on=[];if(_n.length>0){const bn=_n[0].clone(),Cn=_n[0].clone();for(let Br=1;Br<_n.length;Br++)bn.x=Math.min(bn.x,_n[Br].x),bn.y=Math.min(bn.y,_n[Br].y),Cn.x=Math.max(Cn.x,_n[Br].x),Cn.y=Math.max(Cn.y,_n[Br].y);on=bn.x>=ct.x&&Cn.x<=dt.x&&bn.y>=ct.y&&Cn.y<=dt.y?[_n]:Cn.x<ct.x||bn.x>dt.x||Cn.y<ct.y||bn.y>dt.y?[]:l.al([_n],ct.x,ct.y,dt.x,dt.y)}for(const bn of on){gn.reset(bn,.25*tt);let Cn=0;Cn=gn.length<=.5*tt?1:Math.ceil(gn.paddedLength/Fn)+1;for(let Br=0;Br<Cn;Br++){const tr=Br/Math.max(Cn-1,1),Xo=gn.lerp(tr),yi=Xo.x+qt,Mr=Xo.y+qt;ye.push(yi,Mr,tt,0);const vi=yi-tt,Yo=Mr-tt,ia=yi+tt,dl=Mr+tt;if(it=it&&this.isOffscreen(vi,Yo,ia,dl),$e=$e||this.isInsideGrid(vi,Yo,ia,dl),a!=="always"&&this.grid.hitTestCircle(yi,Mr,tt,a,q)&&(He=!0,!z))return{circles:[],offscreen:!1,collisionDetected:He}}}}return{circles:!z&&He||!$e||Ue<this.perspectiveRatioCutoff?[]:ye,offscreen:it,collisionDetected:He}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let m=1/0,g=1/0,b=-1/0,T=-1/0;for(const j of a){const q=new l.P(j.x+qt,j.y+qt);m=Math.min(m,q.x),g=Math.min(g,q.y),b=Math.max(b,q.x),T=Math.max(T,q.y),f.push(q)}const L=this.grid.query(m,g,b,T).concat(this.ignoredGrid.query(m,g,b,T)),k={},z={};for(const j of L){const q=j.key;if(k[q.bucketInstanceId]===void 0&&(k[q.bucketInstanceId]={}),k[q.bucketInstanceId][q.featureIndex])continue;const $=[new l.P(j.x1,j.y1),new l.P(j.x2,j.y1),new l.P(j.x2,j.y2),new l.P(j.x1,j.y2)];l.am(f,$)&&(k[q.bucketInstanceId][q.featureIndex]=!0,z[q.bucketInstanceId]===void 0&&(z[q.bucketInstanceId]=[]),z[q.bucketInstanceId].push(q.featureIndex))}return z}insertCollisionBox(a,f,m,g,b,T){(m?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:b,collisionGroupID:T,overlapMode:f},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,f,m,g,b,T){const L=m?this.ignoredGrid:this.grid,k={bucketInstanceId:g,featureIndex:b,collisionGroupID:T,overlapMode:f};for(let z=0;z<a.length;z+=4)L.insertCircle(k,a[z],a[z+1],a[z+2])}projectAndGetPerspectiveRatio(a,f,m,g){let b;return g?(b=[f,m,g(f,m),1],l.af(b,b,a)):(b=[f,m,0,1],Bt(b,b,a)),{point:new l.P((b[0]/b[3]+1)/2*this.transform.width+qt,(-b[1]/b[3]+1)/2*this.transform.height+qt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/b[3]*.5}}isOffscreen(a,f,m,g){return m<qt||a>=this.screenRightBoundary||g<qt||f>this.screenBottomBoundary}isInsideGrid(a,f,m,g){return m>=0&&a<this.gridRightBoundary&&g>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const a=l.an([]);return l.H(a,a,[-100,-100,0]),a}}function un(v,a,f){return a*(l.W/(v.tileSize*Math.pow(2,f-v.tileID.overscaledZ)))}class On{constructor(a,f,m,g){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?f:-f))):g&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class ir{constructor(a,f,m,g,b){this.text=new On(a?a.text:null,f,m,b),this.icon=new On(a?a.icon:null,f,g,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Sr{constructor(a,f,m){this.text=a,this.icon=f,this.skipFade=m}}class ui{constructor(){this.invProjMatrix=l.F(),this.viewportMatrix=l.F(),this.circles=[]}}class vn{constructor(a,f,m,g,b){this.bucketInstanceId=a,this.featureIndex=f,this.sourceLayerIndex=m,this.bucketIndex=g,this.tileID=b}}class Or{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const f=++this.maxGroupID;this.collisionGroups[a]={ID:f,predicate:m=>m.collisionGroupID===f}}return this.collisionGroups[a]}}function _i(v,a,f,m,g){const{horizontalAlign:b,verticalAlign:T}=l.at(v);return new l.P(-(b-.5)*a+m[0]*g,-(T-.5)*f+m[1]*g)}function po(v,a,f,m,g,b){const{x1:T,x2:L,y1:k,y2:z,anchorPointX:j,anchorPointY:q}=v,$=new l.P(a,f);return m&&$._rotate(g?b:-b),{x1:T+$.x,y1:k+$.y,x2:L+$.x,y2:z+$.y,anchorPointX:j,anchorPointY:q}}class To{constructor(a,f,m,g,b){this.transform=a.clone(),this.terrain=f,this.collisionIndex=new sn(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new Or(g),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,f,m,g){const b=m.getBucket(f),T=m.latestFeatureIndex;if(!b||!T||f.id!==b.layerIds[0])return;const L=m.collisionBoxArray,k=b.layers[0].layout,z=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),j=m.tileSize/l.W,q=this.transform.calculatePosMatrix(m.tileID.toUnwrapped()),$=k.get("text-pitch-alignment")==="map",he=k.get("text-rotation-alignment")==="map",ce=un(m,1,this.transform.zoom),ye=fn(q,$,he,this.transform,ce);let re=null;if($){const Ue=za(q,$,he,this.transform,ce);re=l.K([],this.transform.labelPlaneMatrix,Ue)}this.retainedQueryData[b.bucketInstanceId]=new vn(b.bucketInstanceId,T,b.sourceLayerIndex,b.index,m.tileID);const Ie={bucket:b,layout:k,posMatrix:q,textLabelPlaneMatrix:ye,labelToScreenMatrix:re,scale:z,textPixelRatio:j,holdingForFade:m.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:l.ag(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(g)for(const Ue of b.sortKeyRanges){const{sortKey:xe,symbolInstanceStart:De,symbolInstanceEnd:qe}=Ue;a.push({sortKey:xe,symbolInstanceStart:De,symbolInstanceEnd:qe,parameters:Ie})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ie})}attemptAnchorPlacement(a,f,m,g,b,T,L,k,z,j,q,$,he,ce,ye,re){const Ie=l.ap[a.textAnchor],Ue=[a.textOffset0,a.textOffset1],xe=_i(Ie,m,g,Ue,b),De=this.collisionIndex.placeCollisionBox(po(f,xe.x,xe.y,T,L,this.transform.angle),q,k,z,j.predicate,re);if((!ye||this.collisionIndex.placeCollisionBox(po(ye,xe.x,xe.y,T,L,this.transform.angle),q,k,z,j.predicate,re).box.length!==0)&&De.box.length>0){let qe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID].text&&(qe=this.prevPlacement.variableOffsets[$.crossTileID].anchor),$.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[$.crossTileID]={textOffset:Ue,width:m,height:g,anchor:Ie,textBoxScale:b,prevAnchor:qe},this.markUsedJustification(he,Ie,$,ce),he.allowVerticalPlacement&&(this.markUsedOrientation(he,ce,$),this.placedOrientations[$.crossTileID]=ce),{shift:xe,placedGlyphBoxes:De}}}placeLayerBucketPart(a,f,m){const{bucket:g,layout:b,posMatrix:T,textLabelPlaneMatrix:L,labelToScreenMatrix:k,textPixelRatio:z,holdingForFade:j,collisionBoxArray:q,partiallyEvaluatedTextSize:$,collisionGroup:he}=a.parameters,ce=b.get("text-optional"),ye=b.get("icon-optional"),re=l.aq(b,"text-overlap","text-allow-overlap"),Ie=re==="always",Ue=l.aq(b,"icon-overlap","icon-allow-overlap"),xe=Ue==="always",De=b.get("text-rotation-alignment")==="map",qe=b.get("text-pitch-alignment")==="map",He=b.get("icon-text-fit")!=="none",$e=b.get("symbol-z-order")==="viewport-y",it=Ie&&(xe||!g.hasIconData()||ye),tt=xe&&(Ie||!g.hasTextData()||ce);!g.collisionArrays&&q&&g.deserializeCollisionBoxes(q);const ct=this.retainedQueryData[g.bucketInstanceId].tileID,dt=this.terrain?(_t,en)=>this.terrain.getElevation(ct,_t,en):null,gn=(_t,en)=>{var _n,Fn;if(f[_t.crossTileID])return;if(j)return void(this.placements[_t.crossTileID]=new Sr(!1,!1,!1));let on=!1,bn=!1,Cn=!0,Br=null,tr={box:null,offscreen:null},Xo={box:null,offscreen:null},yi=null,Mr=null,vi=null,Yo=0,ia=0,dl=0;en.textFeatureIndex?Yo=en.textFeatureIndex:_t.useRuntimeCollisionCircles&&(Yo=_t.featureIndex),en.verticalTextFeatureIndex&&(ia=en.verticalTextFeatureIndex);const jc=en.textBox;if(jc){const hi=fi=>{let Ar=l.ah.horizontal;if(g.allowVerticalPlacement&&!fi&&this.prevPlacement){const gs=this.prevPlacement.placedOrientations[_t.crossTileID];gs&&(this.placedOrientations[_t.crossTileID]=gs,Ar=gs,this.markUsedOrientation(g,Ar,_t))}return Ar},kr=(fi,Ar)=>{if(g.allowVerticalPlacement&&_t.numVerticalGlyphVertices>0&&en.verticalTextBox){for(const gs of g.writingModes)if(gs===l.ah.vertical?(tr=Ar(),Xo=tr):tr=fi(),tr&&tr.box&&tr.box.length)break}else tr=fi()},Ir=_t.textAnchorOffsetStartIndex,ms=_t.textAnchorOffsetEndIndex;if(ms===Ir){const fi=(Ar,gs)=>{const pi=this.collisionIndex.placeCollisionBox(Ar,re,z,T,he.predicate,dt);return pi&&pi.box&&pi.box.length&&(this.markUsedOrientation(g,gs,_t),this.placedOrientations[_t.crossTileID]=gs),pi};kr(()=>fi(jc,l.ah.horizontal),()=>{const Ar=en.verticalTextBox;return g.allowVerticalPlacement&&_t.numVerticalGlyphVertices>0&&Ar?fi(Ar,l.ah.vertical):{box:null,offscreen:null}}),hi(tr&&tr.box&&tr.box.length)}else{let fi=l.ap[(Fn=(_n=this.prevPlacement)===null||_n===void 0?void 0:_n.variableOffsets[_t.crossTileID])===null||Fn===void 0?void 0:Fn.anchor];const Ar=(pi,Xr,td)=>{const gg=pi.x2-pi.x1,Jl=pi.y2-pi.y1,Ql=_t.textBoxScale,of=He&&Ue==="never"?Xr:null;let gl={box:[],offscreen:!1},nd=re==="never"?1:2,_g="never";fi&&nd++;for(let rd=0;rd<nd;rd++){for(let id=Ir;id<ms;id++){const sf=g.textAnchorOffsets.get(id);if(fi&&sf.textAnchor!==fi)continue;const od=this.attemptAnchorPlacement(sf,pi,gg,Jl,Ql,De,qe,z,T,he,_g,_t,g,td,of,dt);if(od&&(gl=od.placedGlyphBoxes,gl&&gl.box&&gl.box.length))return on=!0,Br=od.shift,gl}fi?fi=null:_g=re}return gl};kr(()=>Ar(jc,en.iconBox,l.ah.horizontal),()=>{const pi=en.verticalTextBox;return g.allowVerticalPlacement&&!(tr&&tr.box&&tr.box.length)&&_t.numVerticalGlyphVertices>0&&pi?Ar(pi,en.verticalIconBox,l.ah.vertical):{box:null,offscreen:null}}),tr&&(on=tr.box,Cn=tr.offscreen);const gs=hi(tr&&tr.box);if(!on&&this.prevPlacement){const pi=this.prevPlacement.variableOffsets[_t.crossTileID];pi&&(this.variableOffsets[_t.crossTileID]=pi,this.markUsedJustification(g,pi.anchor,_t,gs))}}}if(yi=tr,on=yi&&yi.box&&yi.box.length>0,Cn=yi&&yi.offscreen,_t.useRuntimeCollisionCircles){const hi=g.text.placedSymbolArray.get(_t.centerJustifiedTextSymbolIndex),kr=l.ai(g.textSizeData,$,hi),Ir=b.get("text-padding");Mr=this.collisionIndex.placeCollisionCircles(re,hi,g.lineVertexArray,g.glyphOffsetArray,kr,T,L,k,m,qe,he.predicate,_t.collisionCircleDiameter,Ir,dt),Mr.circles.length&&Mr.collisionDetected&&!m&&l.w("Collisions detected, but collision boxes are not shown"),on=Ie||Mr.circles.length>0&&!Mr.collisionDetected,Cn=Cn&&Mr.offscreen}if(en.iconFeatureIndex&&(dl=en.iconFeatureIndex),en.iconBox){const hi=kr=>{const Ir=He&&Br?po(kr,Br.x,Br.y,De,qe,this.transform.angle):kr;return this.collisionIndex.placeCollisionBox(Ir,Ue,z,T,he.predicate,dt)};Xo&&Xo.box&&Xo.box.length&&en.verticalIconBox?(vi=hi(en.verticalIconBox),bn=vi.box.length>0):(vi=hi(en.iconBox),bn=vi.box.length>0),Cn=Cn&&vi.offscreen}const ml=ce||_t.numHorizontalGlyphVertices===0&&_t.numVerticalGlyphVertices===0,oa=ye||_t.numIconVertices===0;if(ml||oa?oa?ml||(bn=bn&&on):on=bn&&on:bn=on=bn&&on,on&&yi&&yi.box&&this.collisionIndex.insertCollisionBox(yi.box,re,b.get("text-ignore-placement"),g.bucketInstanceId,Xo&&Xo.box&&ia?ia:Yo,he.ID),bn&&vi&&this.collisionIndex.insertCollisionBox(vi.box,Ue,b.get("icon-ignore-placement"),g.bucketInstanceId,dl,he.ID),Mr&&(on&&this.collisionIndex.insertCollisionCircles(Mr.circles,re,b.get("text-ignore-placement"),g.bucketInstanceId,Yo,he.ID),m)){const hi=g.bucketInstanceId;let kr=this.collisionCircleArrays[hi];kr===void 0&&(kr=this.collisionCircleArrays[hi]=new ui);for(let Ir=0;Ir<Mr.circles.length;Ir+=4)kr.circles.push(Mr.circles[Ir+0]),kr.circles.push(Mr.circles[Ir+1]),kr.circles.push(Mr.circles[Ir+2]),kr.circles.push(Mr.collisionDetected?1:0)}if(_t.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[_t.crossTileID]=new Sr(on||it,bn||tt,Cn||g.justReloaded),f[_t.crossTileID]=!0};if($e){if(a.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const _t=g.getSortedSymbolIndexes(this.transform.angle);for(let en=_t.length-1;en>=0;--en){const _n=_t[en];gn(g.symbolInstances.get(_n),g.collisionArrays[_n])}}else for(let _t=a.symbolInstanceStart;_t<a.symbolInstanceEnd;_t++)gn(g.symbolInstances.get(_t),g.collisionArrays[_t]);if(m&&g.bucketInstanceId in this.collisionCircleArrays){const _t=this.collisionCircleArrays[g.bucketInstanceId];l.ar(_t.invProjMatrix,T),_t.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(a,f,m,g){let b;b=g===l.ah.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[l.as(f)];const T=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const L of T)L>=0&&(a.text.placedSymbolArray.get(L).crossTileID=b>=0&&L!==b?0:m.crossTileID)}markUsedOrientation(a,f,m){const g=f===l.ah.horizontal||f===l.ah.horizontalOnly?f:0,b=f===l.ah.vertical?f:0,T=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const L of T)a.text.placedSymbolArray.get(L).placedOrientation=g;m.verticalPlacedTextSymbolIndex&&(a.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let m=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const g=f?f.symbolFadeChange(a):1,b=f?f.opacities:{},T=f?f.variableOffsets:{},L=f?f.placedOrientations:{};for(const k in this.placements){const z=this.placements[k],j=b[k];j?(this.opacities[k]=new ir(j,g,z.text,z.icon),m=m||z.text!==j.text.placed||z.icon!==j.icon.placed):(this.opacities[k]=new ir(null,g,z.text,z.icon,z.skipFade),m=m||z.text||z.icon)}for(const k in b){const z=b[k];if(!this.opacities[k]){const j=new ir(z,g,!1,!1);j.isHidden()||(this.opacities[k]=j,m=m||z.text.placed||z.icon.placed)}}for(const k in T)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=T[k]);for(const k in L)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=L[k]);if(f&&f.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");m?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:a)}updateLayerOpacities(a,f){const m={};for(const g of f){const b=g.getBucket(a);b&&g.latestFeatureIndex&&a.id===b.layerIds[0]&&this.updateBucketOpacities(b,m,g.collisionBoxArray)}}updateBucketOpacities(a,f,m){a.hasTextData()&&(a.text.opacityVertexArray.clear(),a.text.hasVisibleVertices=!1),a.hasIconData()&&(a.icon.opacityVertexArray.clear(),a.icon.hasVisibleVertices=!1),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const g=a.layers[0],b=g.layout,T=new ir(null,0,!1,!1,!0),L=b.get("text-allow-overlap"),k=b.get("icon-allow-overlap"),z=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),j=b.get("text-rotation-alignment")==="map",q=b.get("text-pitch-alignment")==="map",$=b.get("icon-text-fit")!=="none",he=new ir(null,0,L&&(k||!a.hasIconData()||b.get("icon-optional")),k&&(L||!a.hasTextData()||b.get("text-optional")),!0);!a.collisionArrays&&m&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(m);const ce=(ye,re,Ie)=>{for(let Ue=0;Ue<re/4;Ue++)ye.opacityVertexArray.emplaceBack(Ie);ye.hasVisibleVertices=ye.hasVisibleVertices||Ie!==bc};for(let ye=0;ye<a.symbolInstances.length;ye++){const re=a.symbolInstances.get(ye),{numHorizontalGlyphVertices:Ie,numVerticalGlyphVertices:Ue,crossTileID:xe}=re;let De=this.opacities[xe];f[xe]?De=T:De||(De=he,this.opacities[xe]=De),f[xe]=!0;const qe=re.numIconVertices>0,He=this.placedOrientations[re.crossTileID],$e=He===l.ah.vertical,it=He===l.ah.horizontal||He===l.ah.horizontalOnly;if(Ie>0||Ue>0){const tt=Lo(De.text);ce(a.text,Ie,$e?bc:tt),ce(a.text,Ue,it?bc:tt);const ct=De.text.isHidden();[re.rightJustifiedTextSymbolIndex,re.centerJustifiedTextSymbolIndex,re.leftJustifiedTextSymbolIndex].forEach(_t=>{_t>=0&&(a.text.placedSymbolArray.get(_t).hidden=ct||$e?1:0)}),re.verticalPlacedTextSymbolIndex>=0&&(a.text.placedSymbolArray.get(re.verticalPlacedTextSymbolIndex).hidden=ct||it?1:0);const dt=this.variableOffsets[re.crossTileID];dt&&this.markUsedJustification(a,dt.anchor,re,He);const gn=this.placedOrientations[re.crossTileID];gn&&(this.markUsedJustification(a,"left",re,gn),this.markUsedOrientation(a,gn,re))}if(qe){const tt=Lo(De.icon),ct=!($&&re.verticalPlacedIconSymbolIndex&&$e);re.placedIconSymbolIndex>=0&&(ce(a.icon,re.numIconVertices,ct?tt:bc),a.icon.placedSymbolArray.get(re.placedIconSymbolIndex).hidden=De.icon.isHidden()),re.verticalPlacedIconSymbolIndex>=0&&(ce(a.icon,re.numVerticalIconVertices,ct?bc:tt),a.icon.placedSymbolArray.get(re.verticalPlacedIconSymbolIndex).hidden=De.icon.isHidden())}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const tt=a.collisionArrays[ye];if(tt){let ct=new l.P(0,0);if(tt.textBox||tt.verticalTextBox){let gn=!0;if(z){const _t=this.variableOffsets[xe];_t?(ct=_i(_t.anchor,_t.width,_t.height,_t.textOffset,_t.textBoxScale),j&&ct._rotate(q?this.transform.angle:-this.transform.angle)):gn=!1}tt.textBox&&Di(a.textCollisionBox.collisionVertexArray,De.text.placed,!gn||$e,ct.x,ct.y),tt.verticalTextBox&&Di(a.textCollisionBox.collisionVertexArray,De.text.placed,!gn||it,ct.x,ct.y)}const dt=!!(!it&&tt.verticalIconBox);tt.iconBox&&Di(a.iconCollisionBox.collisionVertexArray,De.icon.placed,dt,$?ct.x:0,$?ct.y:0),tt.verticalIconBox&&Di(a.iconCollisionBox.collisionVertexArray,De.icon.placed,!dt,$?ct.x:0,$?ct.y:0)}}}if(a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.text.opacityVertexArray.length!==a.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${a.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${a.text.layoutVertexArray.length}) / 4`);if(a.icon.opacityVertexArray.length!==a.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${a.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${a.icon.layoutVertexArray.length}) / 4`);if(a.bucketInstanceId in this.collisionCircleArrays){const ye=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=ye.invProjMatrix,a.placementViewportMatrix=ye.viewportMatrix,a.collisionCircleArray=ye.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,f){const m=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*m>a}setStale(){this.stale=!0}}function Di(v,a,f,m,g){v.emplaceBack(a?1:0,f?1:0,m||0,g||0),v.emplaceBack(a?1:0,f?1:0,m||0,g||0),v.emplaceBack(a?1:0,f?1:0,m||0,g||0),v.emplaceBack(a?1:0,f?1:0,m||0,g||0)}const Qs=Math.pow(2,25),Dm=Math.pow(2,24),Cy=Math.pow(2,17),Qn=Math.pow(2,16),Sp=Math.pow(2,9),Ep=Math.pow(2,8),Wo=Math.pow(2,1);function Lo(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const a=v.placed?1:0,f=Math.floor(127*v.opacity);return f*Qs+a*Dm+f*Cy+a*Qn+f*Sp+a*Ep+f*Wo+a}const bc=0;class ps{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&!a.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(a,f,m,g,b){const T=this._bucketParts;for(;this._currentTileIndex<a.length;)if(f.getBucketParts(T,g,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((L,k)=>L.sortKey-k.sortKey));this._currentPartIndex<T.length;)if(f.placeLayerBucketPart(T[this._currentPartIndex],this._seenCrossTileIDs,m),this._currentPartIndex++,b())return!0;return!1}}class ds{constructor(a,f,m,g,b,T,L,k){this.placement=new To(a,f,T,L,k),this._currentPlacementIndex=m.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(a,f,m){const g=E.now(),b=()=>!this._forceFullPlacement&&E.now()-g>2;for(;this._currentPlacementIndex>=0;){const T=f[a[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=L)&&(!T.maxzoom||T.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new ps(T)),this._inProgressLayer.continuePlacement(m[T.source],this.placement,this._showCollisionBoxes,T,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const Cu=512/l.W/2;class vh{constructor(a,f,m){this.tileID=a,this.bucketInstanceId=m,this._symbolsByKey={};const g=new Map;for(let b=0;b<f.length;b++){const T=f.get(b),L=T.key,k=g.get(L);k?k.push(T):g.set(L,[T])}for(const[b,T]of g){const L={positions:T.map(k=>({x:Math.floor(k.anchorX*Cu),y:Math.floor(k.anchorY*Cu)})),crossTileIDs:T.map(k=>k.crossTileID)};if(L.positions.length>128){const k=new l.au(L.positions.length,16,Uint16Array);for(const{x:z,y:j}of L.positions)k.add(z,j);k.finish(),delete L.positions,L.index=k}this._symbolsByKey[b]=L}}getScaledCoordinates(a,f){const{x:m,y:g,z:b}=this.tileID.canonical,{x:T,y:L,z:k}=f.canonical,z=Cu/Math.pow(2,k-b),j=(L*l.W+a.anchorY)*z,q=g*l.W*Cu;return{x:Math.floor((T*l.W+a.anchorX)*z-m*l.W*Cu),y:Math.floor(j-q)}}findMatches(a,f,m){const g=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z);for(let b=0;b<a.length;b++){const T=a.get(b);if(T.crossTileID)continue;const L=this._symbolsByKey[T.key];if(!L)continue;const k=this.getScaledCoordinates(T,f);if(L.index){const z=L.index.range(k.x-g,k.y-g,k.x+g,k.y+g).sort();for(const j of z){const q=L.crossTileIDs[j];if(!m[q]){m[q]=!0,T.crossTileID=q;break}}}else if(L.positions)for(let z=0;z<L.positions.length;z++){const j=L.positions[z],q=L.crossTileIDs[z];if(Math.abs(j.x-k.x)<=g&&Math.abs(j.y-k.y)<=g&&!m[q]){m[q]=!0,T.crossTileID=q;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:a})=>a)}}class ci{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class xc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const f=Math.round((a-this.lng)/360);if(f!==0)for(const m in this.indexes){const g=this.indexes[m],b={};for(const T in g){const L=g[T];L.tileID=L.tileID.unwrapTo(L.tileID.wrap+f),b[L.tileID.key]=L}this.indexes[m]=b}this.lng=a}addBucket(a,f,m){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let b=0;b<f.symbolInstances.length;b++)f.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]={});const g=this.usedCrossTileIDs[a.overscaledZ];for(const b in this.indexes){const T=this.indexes[b];if(Number(b)>a.overscaledZ)for(const L in T){const k=T[L];k.tileID.isChildOf(a)&&k.findMatches(f.symbolInstances,a,g)}else{const L=T[a.scaledTo(Number(b)).key];L&&L.findMatches(f.symbolInstances,a,g)}}for(let b=0;b<f.symbolInstances.length;b++){const T=f.symbolInstances.get(b);T.crossTileID||(T.crossTileID=m.generate(),g[T.crossTileID]=!0)}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new vh(a,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(a,f){for(const m of f.getCrossTileIDsLists())for(const g of m)delete this.usedCrossTileIDs[a][g]}removeStaleBuckets(a){let f=!1;for(const m in this.indexes){const g=this.indexes[m];for(const b in g)a[g[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,g[b]),delete g[b],f=!0)}return f}}class ll{constructor(){this.layerIndexes={},this.crossTileIDs=new ci,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,f,m){let g=this.layerIndexes[a.id];g===void 0&&(g=this.layerIndexes[a.id]=new xc);let b=!1;const T={};g.handleWrapJump(m);for(const L of f){const k=L.getBucket(a);k&&a.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(L.tileID,k,this.crossTileIDs)&&(b=!0),T[k.bucketInstanceId]=!0)}return g.removeStaleBuckets(T)&&(b=!0),b}pruneUnusedLayers(a){const f={};a.forEach(m=>{f[m]=!0});for(const m in this.layerIndexes)f[m]||delete this.layerIndexes[m]}}const Pr=(v,a)=>l.t(v,a&&a.filter(f=>f.identifier!=="source.canvas")),bh=l.av();class Ho extends l.E{constructor(a,f={}){super(),this._rtlPluginLoaded=()=>{for(const m in this.sourceCaches){const g=this.sourceCaches[m].getSource().type;g!=="vector"&&g!=="geojson"||this.sourceCaches[m].reload()}},this.map=a,this.dispatcher=new In(En(),a._getMapId()),this.dispatcher.registerMessageHandler("GG",(m,g)=>this.getGlyphs(m,g)),this.dispatcher.registerMessageHandler("GI",(m,g)=>this.getImages(m,g)),this.imageManager=new Ge,this.imageManager.setEventedParent(this),this.glyphManager=new At(a._requestManager,f.localIdeographFontFamily),this.lineAtlas=new Rt(256,512),this.crossTileSymbolIndex=new ll,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",l.ax()),lt().on(ji,this._rtlPluginLoaded),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const g=this.sourceCaches[m.sourceId];if(!g)return;const b=g.getSource();if(b&&b.vectorLayerIds)for(const T in this._layers){const L=this._layers[T];L.source===b.id&&this._validateLayer(L)}})}loadURL(a,f={},m){this.fire(new l.k("dataloading",{dataType:"style"})),f.validate=typeof f.validate!="boolean"||f.validate;const g=this.map._requestManager.transformRequest(a,"Style");this._loadStyleRequest=new AbortController,l.h(g,this._loadStyleRequest).then(b=>{this._loadStyleRequest=null,this._load(b.data,f,m)}).catch(b=>{this._loadStyleRequest=null,b&&this.fire(new l.j(b))})}loadJSON(a,f={},m){this.fire(new l.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,E.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,f.validate=f.validate!==!1,this._load(a,f,m)}).catch(()=>{})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(bh,{validate:!1})}_load(a,f,m){var g;const b=f.transformStyle?f.transformStyle(m,a):a;if(!f.validate||!Pr(this,l.x(b))){this._loaded=!0,this.stylesheet=b;for(const T in b.sources)this.addSource(T,b.sources[T],{validate:!1});b.sprite?this._loadSprite(b.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(b.glyphs),this._createLayers(),this.light=new bt(this.stylesheet.light),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const a=l.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",a),this._order=a.map(f=>f.id),this._layers={},this._serializedLayers=null;for(const f of a){const m=l.az(f);m.setEventedParent(this,{layer:{id:f.id}}),this._layers[f.id]=m}}_loadSprite(a,f=!1,m=void 0){let g;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(b,T,L,k){return l._(this,void 0,void 0,function*(){const z=ke(b),j=L>1?"@2x":"",q={},$={};for(const{id:he,url:ce}of z){const ye=T.transformRequest(T.normalizeSpriteURL(ce,j,".json"),"SpriteJSON");q[he]=l.h(ye,k);const re=T.transformRequest(T.normalizeSpriteURL(ce,j,".png"),"SpriteImage");$[he]=G.getImage(re,k)}return yield Promise.all([...Object.values(q),...Object.values($)]),function(he,ce){return l._(this,void 0,void 0,function*(){const ye={};for(const re in he){ye[re]={};const Ie=E.getImageCanvasContext((yield ce[re]).data),Ue=(yield he[re]).data;for(const xe in Ue){const{width:De,height:qe,x:He,y:$e,sdf:it,pixelRatio:tt,stretchX:ct,stretchY:dt,content:gn}=Ue[xe];ye[re][xe]={data:null,pixelRatio:tt,sdf:it,stretchX:ct,stretchY:dt,content:gn,spriteData:{width:De,height:qe,x:He,y:$e,context:Ie}}}}return ye})}(q,$)})}(a,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(b=>{if(this._spriteRequest=null,b)for(const T in b){this._spritesImagesIds[T]=[];const L=this._spritesImagesIds[T]?this._spritesImagesIds[T].filter(k=>!(k in b)):[];for(const k of L)this.imageManager.removeImage(k),this._changedImages[k]=!0;for(const k in b[T]){const z=T==="default"?k:`${T}:${k}`;this._spritesImagesIds[T].push(z),z in this.imageManager.images?this.imageManager.updateImage(z,b[T][k],!1):this.imageManager.addImage(z,b[T][k]),f&&(this._changedImages[z]=!0)}}}).catch(b=>{this._spriteRequest=null,g=b,this.fire(new l.j(g))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),f&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),m&&m(g)})}_unloadSprite(){for(const a of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(a),this._changedImages[a]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(a){const f=this.sourceCaches[a.source];if(!f)return;const m=a.sourceLayer;if(!m)return;const g=f.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(m)===-1)&&this.fire(new l.j(new Error(`Source layer "${m}" does not exist on source "${g.id}" as specified by style layer "${a.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this.sourceCaches)if(!this.sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(a){const f=this._serializedAllLayers();if(!a||a.length===0)return Object.values(f);const m=[];for(const g of a)f[g]&&m.push(f[g]);return m}_serializedAllLayers(){let a=this._serializedLayers;if(a)return a;a=this._serializedLayers={};const f=Object.keys(this._layers);for(const m of f){const g=this._layers[m];g.type!=="custom"&&(a[m]=g.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const a in this.sourceCaches)if(this.sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(a){if(!this._loaded)return;const f=this._changed;if(f){const g=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(g.length||b.length)&&this._updateWorkerLayers(g,b);for(const T in this._updatedSources){const L=this._updatedSources[T];if(L==="reload")this._reloadSource(T);else{if(L!=="clear")throw new Error(`Invalid action ${L}`);this._clearSource(T)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(a);this.light.updateTransitions(a),this._resetUpdates()}const m={};for(const g in this.sourceCaches){const b=this.sourceCaches[g];m[g]=b.used,b.used=!1}for(const g of this._order){const b=this._layers[g];b.recalculate(a,this._availableImages),!b.isHidden(a.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const g in m){const b=this.sourceCaches[g];!!m[g]!=!!b.used&&b.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(a),this.z=a.zoom,f&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const f in this.sourceCaches)this.sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(a,f){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(a),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(a,f={}){var m;this._checkLoaded();const g=this.serialize();if(a=f.transformStyle?f.transformStyle(g,a):a,((m=f.validate)===null||m===void 0||m)&&Pr(this,l.x(a)))return!1;(a=l.aA(a)).layers=l.ay(a.layers);const b=l.aB(g,a),T=this._getOperationsToPerform(b);if(T.unimplemented.length>0)throw new Error(`Unimplemented: ${T.unimplemented.join(", ")}.`);if(T.operations.length===0)return!1;for(const L of T.operations)L();return this.stylesheet=a,this._serializedLayers=null,!0}_getOperationsToPerform(a){const f=[],m=[];for(const g of a)switch(g.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":f.push(()=>this.addLayer.apply(this,g.args));break;case"removeLayer":f.push(()=>this.removeLayer.apply(this,g.args));break;case"setPaintProperty":f.push(()=>this.setPaintProperty.apply(this,g.args));break;case"setLayoutProperty":f.push(()=>this.setLayoutProperty.apply(this,g.args));break;case"setFilter":f.push(()=>this.setFilter.apply(this,g.args));break;case"addSource":f.push(()=>this.addSource.apply(this,g.args));break;case"removeSource":f.push(()=>this.removeSource.apply(this,g.args));break;case"setLayerZoomRange":f.push(()=>this.setLayerZoomRange.apply(this,g.args));break;case"setLight":f.push(()=>this.setLight.apply(this,g.args));break;case"setGeoJSONSourceData":f.push(()=>this.setGeoJSONSourceData.apply(this,g.args));break;case"setGlyphs":f.push(()=>this.setGlyphs.apply(this,g.args));break;case"setSprite":f.push(()=>this.setSprite.apply(this,g.args));break;case"setTerrain":f.push(()=>this.map.setTerrain.apply(this,g.args));break;case"setTransition":f.push(()=>{});break;default:m.push(g.command)}return{operations:f,unimplemented:m}}addImage(a,f){if(this.getImage(a))return this.fire(new l.j(new Error(`An image named "${a}" already exists.`)));this.imageManager.addImage(a,f),this._afterImageUpdated(a)}updateImage(a,f){this.imageManager.updateImage(a,f)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){if(!this.getImage(a))return this.fire(new l.j(new Error(`An image named "${a}" does not exist.`)));this.imageManager.removeImage(a),this._afterImageUpdated(a)}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(a,f,m={}){if(this._checkLoaded(),this.sourceCaches[a]!==void 0)throw new Error(`Source "${a}" already exists.`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(l.x.source,`sources.${a}`,f,null,m))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const g=this.sourceCaches[a]=new li(a,f,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:g.loaded(),source:g.serialize(),sourceId:a})),g.onAdd(this.map),this._changed=!0}removeSource(a){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===a)return this.fire(new l.j(new Error(`Source "${a}" cannot be removed while layer "${m}" is using it.`)));const f=this.sourceCaches[a];delete this.sourceCaches[a],delete this._updatedSources[a],f.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:a})),f.setEventedParent(null),f.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(a,f){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error(`There is no source with this ID=${a}`);const m=this.sourceCaches[a].getSource();if(m.type!=="geojson")throw new Error(`geojsonSource.type is ${m.type}, which is !== 'geojson`);m.setData(f),this._changed=!0}getSource(a){return this.sourceCaches[a]&&this.sourceCaches[a].getSource()}addLayer(a,f,m={}){this._checkLoaded();const g=a.id;if(this.getLayer(g))return void this.fire(new l.j(new Error(`Layer "${g}" already exists on this map.`)));let b;if(a.type==="custom"){if(Pr(this,l.aC(a)))return;b=l.az(a)}else{if("source"in a&&typeof a.source=="object"&&(this.addSource(g,a.source),a=l.aA(a),a=l.e(a,{source:g})),this._validate(l.x.layer,`layers.${g}`,a,{arrayIndex:-1},m))return;b=l.az(a),this._validateLayer(b),b.setEventedParent(this,{layer:{id:g}})}const T=f?this._order.indexOf(f):this._order.length;if(f&&T===-1)this.fire(new l.j(new Error(`Cannot add layer "${g}" before non-existing layer "${f}".`)));else{if(this._order.splice(T,0,g),this._layerOrderChanged=!0,this._layers[g]=b,this._removedLayers[g]&&b.source&&b.type!=="custom"){const L=this._removedLayers[g];delete this._removedLayers[g],L.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(a,f){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new l.j(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===f)return;const m=this._order.indexOf(a);this._order.splice(m,1);const g=f?this._order.indexOf(f):this._order.length;f&&g===-1?this.fire(new l.j(new Error(`Cannot move layer "${a}" before non-existing layer "${f}".`))):(this._order.splice(g,0,a),this._layerOrderChanged=!0)}removeLayer(a){this._checkLoaded();const f=this._layers[a];if(!f)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${a}".`)));f.setEventedParent(null);const m=this._order.indexOf(a);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=f,delete this._layers[a],this._serializedLayers&&delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],f.onRemove&&f.onRemove(this.map)}getLayer(a){return this._layers[a]}getLayersOrder(){return[...this._order]}hasLayer(a){return a in this._layers}setLayerZoomRange(a,f,m){this._checkLoaded();const g=this.getLayer(a);g?g.minzoom===f&&g.maxzoom===m||(f!=null&&(g.minzoom=f),m!=null&&(g.maxzoom=m),this._updateLayer(g)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${a}".`)))}setFilter(a,f,m={}){this._checkLoaded();const g=this.getLayer(a);if(g){if(!l.aD(g.filter,f))return f==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(l.x.filter,`layers.${g.id}.filter`,f,null,m)||(g.filter=l.aA(f),this._updateLayer(g)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${a}".`)))}getFilter(a){return l.aA(this.getLayer(a).filter)}setLayoutProperty(a,f,m,g={}){this._checkLoaded();const b=this.getLayer(a);b?l.aD(b.getLayoutProperty(f),m)||(b.setLayoutProperty(f,m,g),this._updateLayer(b)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${a}".`)))}getLayoutProperty(a,f){const m=this.getLayer(a);if(m)return m.getLayoutProperty(f);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${a}".`)))}setPaintProperty(a,f,m,g={}){this._checkLoaded();const b=this.getLayer(a);b?l.aD(b.getPaintProperty(f),m)||(b.setPaintProperty(f,m,g)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[a]=!0,this._serializedLayers=null):this.fire(new l.j(new Error(`Cannot style non-existing layer "${a}".`)))}getPaintProperty(a,f){return this.getLayer(a).getPaintProperty(f)}setFeatureState(a,f){this._checkLoaded();const m=a.source,g=a.sourceLayer,b=this.sourceCaches[m];if(b===void 0)return void this.fire(new l.j(new Error(`The source '${m}' does not exist in the map's style.`)));const T=b.getSource().type;T==="geojson"&&g?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):T!=="vector"||g?(a.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),b.setFeatureState(g,a.id,f)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(a,f){this._checkLoaded();const m=a.source,g=this.sourceCaches[m];if(g===void 0)return void this.fire(new l.j(new Error(`The source '${m}' does not exist in the map's style.`)));const b=g.getSource().type,T=b==="vector"?a.sourceLayer:void 0;b!=="vector"||T?f&&typeof a.id!="string"&&typeof a.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(T,a.id,f):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(a){this._checkLoaded();const f=a.source,m=a.sourceLayer,g=this.sourceCaches[f];if(g!==void 0)return g.getSource().type!=="vector"||m?(a.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),g.getFeatureState(m,a.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const a=l.aE(this.sourceCaches,b=>b.serialize()),f=this._serializeByIds(this._order),m=this.map.getTerrain()||void 0,g=this.stylesheet;return l.aF({version:g.version,name:g.name,metadata:g.metadata,light:g.light,center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,sprite:g.sprite,glyphs:g.glyphs,transition:g.transition,sources:a,layers:f,terrain:m},b=>b!==void 0)}_updateLayer(a){this._updatedLayers[a.id]=!0,a.source&&!this._updatedSources[a.source]&&this.sourceCaches[a.source].getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(a){const f=T=>this._layers[T].type==="fill-extrusion",m={},g=[];for(let T=this._order.length-1;T>=0;T--){const L=this._order[T];if(f(L)){m[L]=T;for(const k of a){const z=k[L];if(z)for(const j of z)g.push(j)}}}g.sort((T,L)=>L.intersectionZ-T.intersectionZ);const b=[];for(let T=this._order.length-1;T>=0;T--){const L=this._order[T];if(f(L))for(let k=g.length-1;k>=0;k--){const z=g[k].feature;if(m[z.layer.id]<T)break;b.push(z),g.pop()}else for(const k of a){const z=k[L];if(z)for(const j of z)b.push(j.feature)}}return b}queryRenderedFeatures(a,f,m){f&&f.filter&&this._validate(l.x.filter,"queryRenderedFeatures.filter",f.filter,null,f);const g={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const L of f.layers){const k=this._layers[L];if(!k)return this.fire(new l.j(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];g[k.source]=!0}}const b=[];f.availableImages=this._availableImages;const T=this._serializedAllLayers();for(const L in this.sourceCaches)f.layers&&!g[L]||b.push(Dt(this.sourceCaches[L],this._layers,T,a,f,m));return this.placement&&b.push(function(L,k,z,j,q,$,he){const ce={},ye=$.queryRenderedSymbols(j),re=[];for(const Ie of Object.keys(ye).map(Number))re.push(he[Ie]);re.sort(Sn);for(const Ie of re){const Ue=Ie.featureIndex.lookupSymbolFeatures(ye[Ie.bucketInstanceId],k,Ie.bucketIndex,Ie.sourceLayerIndex,q.filter,q.layers,q.availableImages,L);for(const xe in Ue){const De=ce[xe]=ce[xe]||[],qe=Ue[xe];qe.sort((He,$e)=>{const it=Ie.featureSortOrder;if(it){const tt=it.indexOf(He.featureIndex);return it.indexOf($e.featureIndex)-tt}return $e.featureIndex-He.featureIndex});for(const He of qe)De.push(He)}}for(const Ie in ce)ce[Ie].forEach(Ue=>{const xe=Ue.feature,De=z[L[Ie].source].getFeatureState(xe.layer["source-layer"],xe.id);xe.source=xe.layer.source,xe.layer["source-layer"]&&(xe.sourceLayer=xe.layer["source-layer"]),xe.state=De});return ce}(this._layers,T,this.sourceCaches,a,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(a,f){f&&f.filter&&this._validate(l.x.filter,"querySourceFeatures.filter",f.filter,null,f);const m=this.sourceCaches[a];return m?function(g,b){const T=g.getRenderableIds().map(z=>g.getTileByID(z)),L=[],k={};for(let z=0;z<T.length;z++){const j=T[z],q=j.tileID.canonical.key;k[q]||(k[q]=!0,j.querySourceFeatures(L,b))}return L}(m,f):[]}getLight(){return this.light.getLight()}setLight(a,f={}){this._checkLoaded();const m=this.light.getLight();let g=!1;for(const T in a)if(!l.aD(a[T],m[T])){g=!0;break}if(!g)return;const b={now:E.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(a,f),this.light.updateTransitions(b)}_validate(a,f,m,g,b={}){return(!b||b.validate!==!1)&&Pr(this,a.call(l.x,l.e({key:f,style:this.serialize(),value:m,styleSpec:l.v},g)))}_remove(a=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),lt().off(ji,this._rtlPluginLoaded);for(const f in this._layers)this._layers[f].setEventedParent(null);for(const f in this.sourceCaches){const m=this.sourceCaches[f];m.setEventedParent(null),m.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),a&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(a)}_clearSource(a){this.sourceCaches[a].clearTiles()}_reloadSource(a){this.sourceCaches[a].resume(),this.sourceCaches[a].reload()}_updateSources(a){for(const f in this.sourceCaches)this.sourceCaches[f].update(a,this.map.terrain)}_generateCollisionBoxes(){for(const a in this.sourceCaches)this._reloadSource(a)}_updatePlacement(a,f,m,g,b=!1){let T=!1,L=!1;const k={};for(const z of this._order){const j=this._layers[z];if(j.type!=="symbol")continue;if(!k[j.source]){const $=this.sourceCaches[j.source];k[j.source]=$.getRenderableIds(!0).map(he=>$.getTileByID(he)).sort((he,ce)=>ce.tileID.overscaledZ-he.tileID.overscaledZ||(he.tileID.isLessThan(ce.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer(j,k[j.source],a.center.lng);T=T||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||m===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(E.now(),a.zoom))&&(this.pauseablePlacement=new ds(a,this.map.terrain,this._order,b,f,m,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(E.now()),L=!0),T&&this.pauseablePlacement.placement.setStale()),L||T)for(const z of this._order){const j=this._layers[z];j.type==="symbol"&&this.placement.updateLayerOpacities(j,k[j.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(E.now())}_releaseSymbolFadeTiles(){for(const a in this.sourceCaches)this.sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,f){return l._(this,void 0,void 0,function*(){const m=yield this.imageManager.getImages(f.icons);this._updateTilesForChangedImages();const g=this.sourceCaches[f.source];return g&&g.setDependencies(f.tileID.key,f.type,f.icons),m})}getGlyphs(a,f){return l._(this,void 0,void 0,function*(){const m=yield this.glyphManager.getGlyphs(f.stacks),g=this.sourceCaches[f.source];return g&&g.setDependencies(f.tileID.key,f.type,[""]),m})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(a,f={}){this._checkLoaded(),a&&this._validate(l.x.glyphs,"glyphs",a,null,f)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=a,this.glyphManager.entries={},this.glyphManager.setURL(a))}addSprite(a,f,m={},g){this._checkLoaded();const b=[{id:a,url:f}],T=[...ke(this.stylesheet.sprite),...b];this._validate(l.x.sprite,"sprite",T,null,m)||(this.stylesheet.sprite=T,this._loadSprite(b,!0,g))}removeSprite(a){this._checkLoaded();const f=ke(this.stylesheet.sprite);if(f.find(m=>m.id===a)){if(this._spritesImagesIds[a])for(const m of this._spritesImagesIds[a])this.imageManager.removeImage(m),this._changedImages[m]=!0;f.splice(f.findIndex(m=>m.id===a),1),this.stylesheet.sprite=f.length>0?f:void 0,delete this._spritesImagesIds[a],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${a}" doesn't exists on this map.`)))}getSprite(){return ke(this.stylesheet.sprite)}setSprite(a,f={},m){this._checkLoaded(),a&&this._validate(l.x.sprite,"sprite",a,null,f)||(this.stylesheet.sprite=a,a?this._loadSprite(a,!0,m):(this._unloadSprite(),m&&m(null)))}}var xh=l.X([{name:"a_pos",type:"Int16",components:2}]),ea="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const wc={prelude:er(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:er(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:er(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:er(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:er("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:er(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:er(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:er("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:er("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:er("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:er(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:er(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:er(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:er(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:er(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:er(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:er(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:er(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:er(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:er(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:er(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:er(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:er(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:er(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:er(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:er(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:er("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",ea),terrainDepth:er("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",ea),terrainCoords:er("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",ea)};function er(v,a){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=a.match(/attribute ([\w]+) ([\w]+)/g),g=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=a.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=b?b.concat(g):g,L={};return{fragmentSource:v=v.replace(f,(k,z,j,q,$)=>(L[$]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${$}
varying ${j} ${q} ${$};
#else
uniform ${j} ${q} u_${$};
#endif
`:`
#ifdef HAS_UNIFORM_u_${$}
    ${j} ${q} ${$} = u_${$};
#endif
`)),vertexSource:a=a.replace(f,(k,z,j,q,$)=>{const he=q==="float"?"vec2":"vec4",ce=$.match(/color/)?"color":he;return L[$]?z==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
attribute ${j} ${he} a_${$};
varying ${j} ${q} ${$};
#else
uniform ${j} ${q} u_${$};
#endif
`:ce==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = a_${$};
#else
    ${j} ${q} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = unpack_mix_${ce}(a_${$}, u_${$}_t);
#else
    ${j} ${q} ${$} = u_${$};
#endif
`:z==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
attribute ${j} ${he} a_${$};
#else
uniform ${j} ${q} u_${$};
#endif
`:ce==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${j} ${q} ${$} = a_${$};
#else
    ${j} ${q} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${j} ${q} ${$} = unpack_mix_${ce}(a_${$}, u_${$}_t);
#else
    ${j} ${q} ${$} = u_${$};
#endif
`}),staticAttributes:m,staticUniforms:T}}class wh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(a,f,m,g,b,T,L,k,z){this.context=a;let j=this.boundPaintVertexBuffers.length!==g.length;for(let q=0;!j&&q<g.length;q++)this.boundPaintVertexBuffers[q]!==g[q]&&(j=!0);!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==m||j||this.boundIndexBuffer!==b||this.boundVertexOffset!==T||this.boundDynamicVertexBuffer!==L||this.boundDynamicVertexBuffer2!==k||this.boundDynamicVertexBuffer3!==z?this.freshBind(f,m,g,b,T,L,k,z):(a.bindVertexArray.set(this.vao),L&&L.bind(),b&&b.dynamicDraw&&b.bind(),k&&k.bind(),z&&z.bind())}freshBind(a,f,m,g,b,T,L,k){const z=a.numAttributes,j=this.context,q=j.gl;this.vao&&this.destroy(),this.vao=j.createVertexArray(),j.bindVertexArray.set(this.vao),this.boundProgram=a,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=g,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=L,this.boundDynamicVertexBuffer3=k,f.enableAttributes(q,a);for(const $ of m)$.enableAttributes(q,a);T&&T.enableAttributes(q,a),L&&L.enableAttributes(q,a),k&&k.enableAttributes(q,a),f.bind(),f.setVertexAttribPointers(q,a,b);for(const $ of m)$.bind(),$.setVertexAttribPointers(q,a,b);T&&(T.bind(),T.setVertexAttribPointers(q,a,b)),g&&g.bind(),L&&(L.bind(),L.setVertexAttribPointers(q,a,b)),k&&(k.bind(),k.setVertexAttribPointers(q,a,b)),j.currentNumAttributes=z}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Tu(v){const a=[];for(let f=0;f<v.length;f++){if(v[f]===null)continue;const m=v[f].split(" ");a.push(m.pop())}return a}class ul{constructor(a,f,m,g,b,T){const L=a.gl;this.program=L.createProgram();const k=Tu(f.staticAttributes),z=m?m.getBinderAttributes():[],j=k.concat(z),q=wc.prelude.staticUniforms?Tu(wc.prelude.staticUniforms):[],$=f.staticUniforms?Tu(f.staticUniforms):[],he=m?m.getBinderUniforms():[],ce=q.concat($).concat(he),ye=[];for(const He of ce)ye.indexOf(He)<0&&ye.push(He);const re=m?m.defines():[];b&&re.push("#define OVERDRAW_INSPECTOR;"),T&&re.push("#define TERRAIN3D;");const Ie=re.concat(wc.prelude.fragmentSource,f.fragmentSource).join(`
`),Ue=re.concat(wc.prelude.vertexSource,f.vertexSource).join(`
`),xe=L.createShader(L.FRAGMENT_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);if(L.shaderSource(xe,Ie),L.compileShader(xe),!L.getShaderParameter(xe,L.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${L.getShaderInfoLog(xe)}`);L.attachShader(this.program,xe);const De=L.createShader(L.VERTEX_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);if(L.shaderSource(De,Ue),L.compileShader(De),!L.getShaderParameter(De,L.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${L.getShaderInfoLog(De)}`);L.attachShader(this.program,De),this.attributes={};const qe={};this.numAttributes=j.length;for(let He=0;He<this.numAttributes;He++)j[He]&&(L.bindAttribLocation(this.program,He,j[He]),this.attributes[j[He]]=He);if(L.linkProgram(this.program),!L.getProgramParameter(this.program,L.LINK_STATUS))throw new Error(`Program failed to link: ${L.getProgramInfoLog(this.program)}`);L.deleteShader(De),L.deleteShader(xe);for(let He=0;He<ye.length;He++){const $e=ye[He];if($e&&!qe[$e]){const it=L.getUniformLocation(this.program,$e);it&&(qe[$e]=it)}}this.fixedUniforms=g(a,qe),this.terrainUniforms=((He,$e)=>({u_depth:new l.aG(He,$e.u_depth),u_terrain:new l.aG(He,$e.u_terrain),u_terrain_dim:new l.aH(He,$e.u_terrain_dim),u_terrain_matrix:new l.aI(He,$e.u_terrain_matrix),u_terrain_unpack:new l.aJ(He,$e.u_terrain_unpack),u_terrain_exaggeration:new l.aH(He,$e.u_terrain_exaggeration)}))(a,qe),this.binderUniforms=m?m.getUniforms(a,qe):[]}draw(a,f,m,g,b,T,L,k,z,j,q,$,he,ce,ye,re,Ie,Ue){const xe=a.gl;if(this.failedToCreate)return;if(a.program.set(this.program),a.setDepthMode(m),a.setStencilMode(g),a.setColorMode(b),a.setCullFace(T),k){a.activeTexture.set(xe.TEXTURE2),xe.bindTexture(xe.TEXTURE_2D,k.depthTexture),a.activeTexture.set(xe.TEXTURE3),xe.bindTexture(xe.TEXTURE_2D,k.texture);for(const qe in this.terrainUniforms)this.terrainUniforms[qe].set(k[qe])}for(const qe in this.fixedUniforms)this.fixedUniforms[qe].set(L[qe]);ye&&ye.setUniforms(a,this.binderUniforms,he,{zoom:ce});let De=0;switch(f){case xe.LINES:De=2;break;case xe.TRIANGLES:De=3;break;case xe.LINE_STRIP:De=1}for(const qe of $.get()){const He=qe.vaos||(qe.vaos={});(He[z]||(He[z]=new wh)).bind(a,this,j,ye?ye.getPaintVertexBuffers():[],q,qe.vertexOffset,re,Ie,Ue),xe.drawElements(f,qe.primitiveLength*De,xe.UNSIGNED_SHORT,qe.primitiveOffset*De*2)}}}function Sh(v,a,f){const m=1/un(f,1,a.transform.tileZoom),g=Math.pow(2,f.tileID.overscaledZ),b=f.tileSize*Math.pow(2,a.transform.tileZoom)/g,T=b*(f.tileID.canonical.x+f.tileID.wrap*g),L=b*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[m,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[T>>16,L>>16],u_pixel_coord_lower:[65535&T,65535&L]}}const Sc=(v,a,f,m)=>{const g=a.style.light,b=g.properties.get("position"),T=[b.x,b.y,b.z],L=function(){var z=new l.A(9);return l.A!=Float32Array&&(z[1]=0,z[2]=0,z[3]=0,z[5]=0,z[6]=0,z[7]=0),z[0]=1,z[4]=1,z[8]=1,z}();g.properties.get("anchor")==="viewport"&&function(z,j){var q=Math.sin(j),$=Math.cos(j);z[0]=$,z[1]=q,z[2]=0,z[3]=-q,z[4]=$,z[5]=0,z[6]=0,z[7]=0,z[8]=1}(L,-a.transform.angle),function(z,j,q){var $=j[0],he=j[1],ce=j[2];z[0]=$*q[0]+he*q[3]+ce*q[6],z[1]=$*q[1]+he*q[4]+ce*q[7],z[2]=$*q[2]+he*q[5]+ce*q[8]}(T,T,L);const k=g.properties.get("color");return{u_matrix:v,u_lightpos:T,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+f,u_opacity:m}},Ty=(v,a,f,m,g,b,T)=>l.e(Sc(v,a,f,m),Sh(b,a,T),{u_height_factor:-Math.pow(2,g.overscaledZ)/T.tileSize/8}),Rm=v=>({u_matrix:v}),Eh=(v,a,f,m)=>l.e(Rm(v),Sh(f,a,m)),Ly=(v,a)=>({u_matrix:v,u_world:a}),Nm=(v,a,f,m,g)=>l.e(Eh(v,a,f,m),{u_world:g}),Py=(v,a,f,m)=>{const g=v.transform;let b,T;if(m.paint.get("circle-pitch-alignment")==="map"){const L=un(f,1,g.zoom);b=!0,T=[L,L]}else b=!1,T=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(m.paint.get("circle-pitch-scale")==="map"),u_matrix:v.translatePosMatrix(a.posMatrix,f,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:v.pixelRatio,u_extrude_scale:T}},Om=(v,a,f)=>{const m=un(f,1,a.zoom),g=Math.pow(2,a.zoom-f.tileID.overscaledZ),b=f.tileID.overscaleFactor();return{u_matrix:v,u_camera_to_center_distance:a.cameraToCenterDistance,u_pixels_to_tile_units:m,u_extrude_scale:[a.pixelsToGLUnits[0]/(m*g),a.pixelsToGLUnits[1]/(m*g)],u_overscale_factor:b}},zm=(v,a,f=1)=>({u_matrix:v,u_color:a,u_overlay:0,u_overlay_scale:f}),Ih=v=>({u_matrix:v}),Fm=(v,a,f,m)=>({u_matrix:v,u_extrude_scale:un(a,1,f),u_intensity:m});function Bm(v,a){const f=Math.pow(2,a.canonical.z),m=a.canonical.y;return[new l.Y(0,m/f).toLngLat().lat,new l.Y(0,(m+1)/f).toLngLat().lat]}const Ch=(v,a,f,m)=>{const g=v.transform;return{u_matrix:Ec(v,a,f,m),u_ratio:1/un(a,1,g.zoom),u_device_pixel_ratio:v.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Vm=(v,a,f,m,g)=>l.e(Ch(v,a,f,g),{u_image:0,u_image_height:m}),ql=(v,a,f,m,g)=>{const b=v.transform,T=Zo(a,b);return{u_matrix:Ec(v,a,f,g),u_texsize:a.imageAtlasTexture.size,u_ratio:1/un(a,1,b.zoom),u_device_pixel_ratio:v.pixelRatio,u_image:0,u_scale:[T,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Th=(v,a,f,m,g,b)=>{const T=v.lineAtlas,L=Zo(a,v.transform),k=f.layout.get("line-cap")==="round",z=T.getDash(m.from,k),j=T.getDash(m.to,k),q=z.width*g.fromScale,$=j.width*g.toScale;return l.e(Ch(v,a,f,b),{u_patternscale_a:[L/q,-z.height/2],u_patternscale_b:[L/$,-j.height/2],u_sdfgamma:T.width/(256*Math.min(q,$)*v.pixelRatio)/2,u_image:0,u_tex_y_a:z.y,u_tex_y_b:j.y,u_mix:g.t})};function Zo(v,a){return 1/un(v,1,a.tileZoom)}function Ec(v,a,f,m){return v.translatePosMatrix(m?m.posMatrix:a.tileID.posMatrix,a,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}const Lh=(v,a,f,m,g)=>{return{u_matrix:v,u_tl_parent:a,u_scale_parent:f,u_buffer_scale:1,u_fade_t:m.mix,u_opacity:m.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(T=g.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(b=g.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:Ic(g.paint.get("raster-hue-rotate"))};var b,T};function Ic(v){v*=Math.PI/180;const a=Math.sin(v),f=Math.cos(v);return[(2*f+1)/3,(-Math.sqrt(3)*a-f+1)/3,(Math.sqrt(3)*a-f+1)/3]}const Cc=(v,a,f,m,g,b,T,L,k,z)=>{const j=g.transform;return{u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:j.cameraToCenterDistance,u_pitch:j.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:j.width/j.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:T,u_coord_matrix:L,u_is_text:+k,u_pitch_with_map:+m,u_texsize:z,u_texture:0}},Tc=(v,a,f,m,g,b,T,L,k,z,j)=>{const q=g.transform;return l.e(Cc(v,a,f,m,g,b,T,L,k,z),{u_gamma_scale:m?Math.cos(q._pitch)*q.cameraToCenterDistance:1,u_device_pixel_ratio:g.pixelRatio,u_is_halo:+j})},Lc=(v,a,f,m,g,b,T,L,k,z)=>l.e(Tc(v,a,f,m,g,b,T,L,!0,k,!0),{u_texsize_icon:z,u_texture_icon:1}),My=(v,a,f)=>({u_matrix:v,u_opacity:a,u_color:f}),ky=(v,a,f,m,g,b)=>l.e(function(T,L,k,z){const j=k.imageManager.getPattern(T.from.toString()),q=k.imageManager.getPattern(T.to.toString()),{width:$,height:he}=k.imageManager.getPixelSize(),ce=Math.pow(2,z.tileID.overscaledZ),ye=z.tileSize*Math.pow(2,k.transform.tileZoom)/ce,re=ye*(z.tileID.canonical.x+z.tileID.wrap*ce),Ie=ye*z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:j.tl,u_pattern_br_a:j.br,u_pattern_tl_b:q.tl,u_pattern_br_b:q.br,u_texsize:[$,he],u_mix:L.t,u_pattern_size_a:j.displaySize,u_pattern_size_b:q.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/un(z,1,k.transform.tileZoom),u_pixel_coord_upper:[re>>16,Ie>>16],u_pixel_coord_lower:[65535&re,65535&Ie]}}(m,b,f,g),{u_matrix:v,u_opacity:a}),Um={fillExtrusion:(v,a)=>({u_matrix:new l.aI(v,a.u_matrix),u_lightpos:new l.aK(v,a.u_lightpos),u_lightintensity:new l.aH(v,a.u_lightintensity),u_lightcolor:new l.aK(v,a.u_lightcolor),u_vertical_gradient:new l.aH(v,a.u_vertical_gradient),u_opacity:new l.aH(v,a.u_opacity)}),fillExtrusionPattern:(v,a)=>({u_matrix:new l.aI(v,a.u_matrix),u_lightpos:new l.aK(v,a.u_lightpos),u_lightintensity:new l.aH(v,a.u_lightintensity),u_lightcolor:new l.aK(v,a.u_lightcolor),u_vertical_gradient:new l.aH(v,a.u_vertical_gradient),u_height_factor:new l.aH(v,a.u_height_factor),u_image:new l.aG(v,a.u_image),u_texsize:new l.aL(v,a.u_texsize),u_pixel_coord_upper:new l.aL(v,a.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(v,a.u_pixel_coord_lower),u_scale:new l.aK(v,a.u_scale),u_fade:new l.aH(v,a.u_fade),u_opacity:new l.aH(v,a.u_opacity)}),fill:(v,a)=>({u_matrix:new l.aI(v,a.u_matrix)}),fillPattern:(v,a)=>({u_matrix:new l.aI(v,a.u_matrix),u_image:new l.aG(v,a.u_image),u_texsize:new l.aL(v,a.u_texsize),u_pixel_coord_upper:new l.aL(v,a.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(v,a.u_pixel_coord_lower),u_scale:new l.aK(v,a.u_scale),u_fade:new l.aH(v,a.u_fade)}),fillOutline:(v,a)=>({u_matrix:new l.aI(v,a.u_matrix),u_world:new l.aL(v,a.u_world)}),fillOutlinePattern:(v,a)=>({u_matrix:new l.aI(v,a.u_matrix),u_world:new l.aL(v,a.u_world),u_image:new l.aG(v,a.u_image),u_texsize:new l.aL(v,a.u_texsize),u_pixel_coord_upper:new l.aL(v,a.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(v,a.u_pixel_coord_lower),u_scale:new l.aK(v,a.u_scale),u_fade:new l.aH(v,a.u_fade)}),circle:(v,a)=>({u_camera_to_center_distance:new l.aH(v,a.u_camera_to_center_distance),u_scale_with_map:new l.aG(v,a.u_scale_with_map),u_pitch_with_map:new l.aG(v,a.u_pitch_with_map),u_extrude_scale:new l.aL(v,a.u_extrude_scale),u_device_pixel_ratio:new l.aH(v,a.u_device_pixel_ratio),u_matrix:new l.aI(v,a.u_matrix)}),collisionBox:(v,a)=>({u_matrix:new l.aI(v,a.u_matrix),u_camera_to_center_distance:new l.aH(v,a.u_camera_to_center_distance),u_pixels_to_tile_units:new l.aH(v,a.u_pixels_to_tile_units),u_extrude_scale:new l.aL(v,a.u_extrude_scale),u_overscale_factor:new l.aH(v,a.u_overscale_factor)}),collisionCircle:(v,a)=>({u_matrix:new l.aI(v,a.u_matrix),u_inv_matrix:new l.aI(v,a.u_inv_matrix),u_camera_to_center_distance:new l.aH(v,a.u_camera_to_center_distance),u_viewport_size:new l.aL(v,a.u_viewport_size)}),debug:(v,a)=>({u_color:new l.aM(v,a.u_color),u_matrix:new l.aI(v,a.u_matrix),u_overlay:new l.aG(v,a.u_overlay),u_overlay_scale:new l.aH(v,a.u_overlay_scale)}),clippingMask:(v,a)=>({u_matrix:new l.aI(v,a.u_matrix)}),heatmap:(v,a)=>({u_extrude_scale:new l.aH(v,a.u_extrude_scale),u_intensity:new l.aH(v,a.u_intensity),u_matrix:new l.aI(v,a.u_matrix)}),heatmapTexture:(v,a)=>({u_matrix:new l.aI(v,a.u_matrix),u_world:new l.aL(v,a.u_world),u_image:new l.aG(v,a.u_image),u_color_ramp:new l.aG(v,a.u_color_ramp),u_opacity:new l.aH(v,a.u_opacity)}),hillshade:(v,a)=>({u_matrix:new l.aI(v,a.u_matrix),u_image:new l.aG(v,a.u_image),u_latrange:new l.aL(v,a.u_latrange),u_light:new l.aL(v,a.u_light),u_shadow:new l.aM(v,a.u_shadow),u_highlight:new l.aM(v,a.u_highlight),u_accent:new l.aM(v,a.u_accent)}),hillshadePrepare:(v,a)=>({u_matrix:new l.aI(v,a.u_matrix),u_image:new l.aG(v,a.u_image),u_dimension:new l.aL(v,a.u_dimension),u_zoom:new l.aH(v,a.u_zoom),u_unpack:new l.aJ(v,a.u_unpack)}),line:(v,a)=>({u_matrix:new l.aI(v,a.u_matrix),u_ratio:new l.aH(v,a.u_ratio),u_device_pixel_ratio:new l.aH(v,a.u_device_pixel_ratio),u_units_to_pixels:new l.aL(v,a.u_units_to_pixels)}),lineGradient:(v,a)=>({u_matrix:new l.aI(v,a.u_matrix),u_ratio:new l.aH(v,a.u_ratio),u_device_pixel_ratio:new l.aH(v,a.u_device_pixel_ratio),u_units_to_pixels:new l.aL(v,a.u_units_to_pixels),u_image:new l.aG(v,a.u_image),u_image_height:new l.aH(v,a.u_image_height)}),linePattern:(v,a)=>({u_matrix:new l.aI(v,a.u_matrix),u_texsize:new l.aL(v,a.u_texsize),u_ratio:new l.aH(v,a.u_ratio),u_device_pixel_ratio:new l.aH(v,a.u_device_pixel_ratio),u_image:new l.aG(v,a.u_image),u_units_to_pixels:new l.aL(v,a.u_units_to_pixels),u_scale:new l.aK(v,a.u_scale),u_fade:new l.aH(v,a.u_fade)}),lineSDF:(v,a)=>({u_matrix:new l.aI(v,a.u_matrix),u_ratio:new l.aH(v,a.u_ratio),u_device_pixel_ratio:new l.aH(v,a.u_device_pixel_ratio),u_units_to_pixels:new l.aL(v,a.u_units_to_pixels),u_patternscale_a:new l.aL(v,a.u_patternscale_a),u_patternscale_b:new l.aL(v,a.u_patternscale_b),u_sdfgamma:new l.aH(v,a.u_sdfgamma),u_image:new l.aG(v,a.u_image),u_tex_y_a:new l.aH(v,a.u_tex_y_a),u_tex_y_b:new l.aH(v,a.u_tex_y_b),u_mix:new l.aH(v,a.u_mix)}),raster:(v,a)=>({u_matrix:new l.aI(v,a.u_matrix),u_tl_parent:new l.aL(v,a.u_tl_parent),u_scale_parent:new l.aH(v,a.u_scale_parent),u_buffer_scale:new l.aH(v,a.u_buffer_scale),u_fade_t:new l.aH(v,a.u_fade_t),u_opacity:new l.aH(v,a.u_opacity),u_image0:new l.aG(v,a.u_image0),u_image1:new l.aG(v,a.u_image1),u_brightness_low:new l.aH(v,a.u_brightness_low),u_brightness_high:new l.aH(v,a.u_brightness_high),u_saturation_factor:new l.aH(v,a.u_saturation_factor),u_contrast_factor:new l.aH(v,a.u_contrast_factor),u_spin_weights:new l.aK(v,a.u_spin_weights)}),symbolIcon:(v,a)=>({u_is_size_zoom_constant:new l.aG(v,a.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(v,a.u_is_size_feature_constant),u_size_t:new l.aH(v,a.u_size_t),u_size:new l.aH(v,a.u_size),u_camera_to_center_distance:new l.aH(v,a.u_camera_to_center_distance),u_pitch:new l.aH(v,a.u_pitch),u_rotate_symbol:new l.aG(v,a.u_rotate_symbol),u_aspect_ratio:new l.aH(v,a.u_aspect_ratio),u_fade_change:new l.aH(v,a.u_fade_change),u_matrix:new l.aI(v,a.u_matrix),u_label_plane_matrix:new l.aI(v,a.u_label_plane_matrix),u_coord_matrix:new l.aI(v,a.u_coord_matrix),u_is_text:new l.aG(v,a.u_is_text),u_pitch_with_map:new l.aG(v,a.u_pitch_with_map),u_texsize:new l.aL(v,a.u_texsize),u_texture:new l.aG(v,a.u_texture)}),symbolSDF:(v,a)=>({u_is_size_zoom_constant:new l.aG(v,a.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(v,a.u_is_size_feature_constant),u_size_t:new l.aH(v,a.u_size_t),u_size:new l.aH(v,a.u_size),u_camera_to_center_distance:new l.aH(v,a.u_camera_to_center_distance),u_pitch:new l.aH(v,a.u_pitch),u_rotate_symbol:new l.aG(v,a.u_rotate_symbol),u_aspect_ratio:new l.aH(v,a.u_aspect_ratio),u_fade_change:new l.aH(v,a.u_fade_change),u_matrix:new l.aI(v,a.u_matrix),u_label_plane_matrix:new l.aI(v,a.u_label_plane_matrix),u_coord_matrix:new l.aI(v,a.u_coord_matrix),u_is_text:new l.aG(v,a.u_is_text),u_pitch_with_map:new l.aG(v,a.u_pitch_with_map),u_texsize:new l.aL(v,a.u_texsize),u_texture:new l.aG(v,a.u_texture),u_gamma_scale:new l.aH(v,a.u_gamma_scale),u_device_pixel_ratio:new l.aH(v,a.u_device_pixel_ratio),u_is_halo:new l.aG(v,a.u_is_halo)}),symbolTextAndIcon:(v,a)=>({u_is_size_zoom_constant:new l.aG(v,a.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(v,a.u_is_size_feature_constant),u_size_t:new l.aH(v,a.u_size_t),u_size:new l.aH(v,a.u_size),u_camera_to_center_distance:new l.aH(v,a.u_camera_to_center_distance),u_pitch:new l.aH(v,a.u_pitch),u_rotate_symbol:new l.aG(v,a.u_rotate_symbol),u_aspect_ratio:new l.aH(v,a.u_aspect_ratio),u_fade_change:new l.aH(v,a.u_fade_change),u_matrix:new l.aI(v,a.u_matrix),u_label_plane_matrix:new l.aI(v,a.u_label_plane_matrix),u_coord_matrix:new l.aI(v,a.u_coord_matrix),u_is_text:new l.aG(v,a.u_is_text),u_pitch_with_map:new l.aG(v,a.u_pitch_with_map),u_texsize:new l.aL(v,a.u_texsize),u_texsize_icon:new l.aL(v,a.u_texsize_icon),u_texture:new l.aG(v,a.u_texture),u_texture_icon:new l.aG(v,a.u_texture_icon),u_gamma_scale:new l.aH(v,a.u_gamma_scale),u_device_pixel_ratio:new l.aH(v,a.u_device_pixel_ratio),u_is_halo:new l.aG(v,a.u_is_halo)}),background:(v,a)=>({u_matrix:new l.aI(v,a.u_matrix),u_opacity:new l.aH(v,a.u_opacity),u_color:new l.aM(v,a.u_color)}),backgroundPattern:(v,a)=>({u_matrix:new l.aI(v,a.u_matrix),u_opacity:new l.aH(v,a.u_opacity),u_image:new l.aG(v,a.u_image),u_pattern_tl_a:new l.aL(v,a.u_pattern_tl_a),u_pattern_br_a:new l.aL(v,a.u_pattern_br_a),u_pattern_tl_b:new l.aL(v,a.u_pattern_tl_b),u_pattern_br_b:new l.aL(v,a.u_pattern_br_b),u_texsize:new l.aL(v,a.u_texsize),u_mix:new l.aH(v,a.u_mix),u_pattern_size_a:new l.aL(v,a.u_pattern_size_a),u_pattern_size_b:new l.aL(v,a.u_pattern_size_b),u_scale_a:new l.aH(v,a.u_scale_a),u_scale_b:new l.aH(v,a.u_scale_b),u_pixel_coord_upper:new l.aL(v,a.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(v,a.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aH(v,a.u_tile_units_to_pixels)}),terrain:(v,a)=>({u_matrix:new l.aI(v,a.u_matrix),u_texture:new l.aG(v,a.u_texture),u_ele_delta:new l.aH(v,a.u_ele_delta)}),terrainDepth:(v,a)=>({u_matrix:new l.aI(v,a.u_matrix),u_ele_delta:new l.aH(v,a.u_ele_delta)}),terrainCoords:(v,a)=>({u_matrix:new l.aI(v,a.u_matrix),u_texture:new l.aG(v,a.u_texture),u_terrain_coords_id:new l.aH(v,a.u_terrain_coords_id),u_ele_delta:new l.aH(v,a.u_ele_delta)})};class Ay{constructor(a,f,m){this.context=a;const g=a.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const f=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Wl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ph{constructor(a,f,m,g){this.length=f.length,this.attributes=m,this.itemSize=f.bytesPerElement,this.dynamicDraw=g,this.context=a;const b=a.gl;this.buffer=b.createBuffer(),a.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){if(a.length!==this.length)throw new Error(`Length of new data is ${a.length}, which doesn't match current length of ${this.length}`);const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,f){for(let m=0;m<this.attributes.length;m++){const g=f.attributes[this.attributes[m].name];g!==void 0&&a.enableVertexAttribArray(g)}}setVertexAttribPointers(a,f,m){for(let g=0;g<this.attributes.length;g++){const b=this.attributes[g],T=f.attributes[b.name];T!==void 0&&a.vertexAttribPointer(T,b.components,a[Wl[b.type]],!1,this.itemSize,b.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const mo=new WeakMap;function Ki(v){var a;if(mo.has(v))return mo.get(v);{const f=(a=v.getParameter(v.VERSION))===null||a===void 0?void 0:a.startsWith("WebGL 2.0");return mo.set(v,f),f}}class Zn{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Mh extends Zn{getDefault(){return l.aO.transparent}set(a){const f=this.current;(a.r!==f.r||a.g!==f.g||a.b!==f.b||a.a!==f.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class kh extends Zn{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class Ip extends Zn{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class Cp extends Zn{getDefault(){return[!0,!0,!0,!0]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||a[3]!==f[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Ah extends Zn{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class Tp extends Zn{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class Lp extends Zn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const f=this.current;(a.func!==f.func||a.ref!==f.ref||a.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class Dh extends Zn{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class jm extends Zn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=a,this.dirty=!1}}class Gm extends Zn{getDefault(){return[0,1]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class Lu extends Zn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=a,this.dirty=!1}}class Dy extends Zn{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Ry extends Zn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.BLEND):f.disable(f.BLEND),this.current=a,this.dirty=!1}}class Ny extends Zn{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class Oy extends Zn{getDefault(){return l.aO.transparent}set(a){const f=this.current;(a.r!==f.r||a.g!==f.g||a.b!==f.b||a.a!==f.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class zy extends Zn{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class Fy extends Zn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=a,this.dirty=!1}}class Pp extends Zn{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class Rh extends Zn{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}class Mp extends Zn{getDefault(){return null}set(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)}}class kp extends Zn{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class Pu extends Zn{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||a[3]!==f[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class qm extends Zn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class Wm extends Zn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Ap extends Zn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class Hl extends Zn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Hm extends Zn{getDefault(){return null}set(a){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Mu extends Zn{getDefault(){return null}set(a){var f;if(a===this.current&&!this.dirty)return;const m=this.gl;Ki(m)?m.bindVertexArray(a):(f=m.getExtension("OES_vertex_array_object"))===null||f===void 0||f.bindVertexArrayOES(a),this.current=a,this.dirty=!1}}class ku extends Zn{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class Zm extends Zn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class Dp extends Zn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class Un extends Zn{constructor(a,f){super(a),this.context=a,this.parent=f}getDefault(){return null}}class Nh extends Un{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class By extends Un{set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Xm extends Un{set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Pc{constructor(a,f,m,g,b){this.context=a,this.width=f,this.height=m;const T=a.gl,L=this.framebuffer=T.createFramebuffer();if(this.colorAttachment=new Nh(a,L),g)this.depthAttachment=b?new Xm(a,L):new By(a,L);else if(b)throw new Error("Stencil cannot be set without depth");if(T.checkFramebufferStatus(T.FRAMEBUFFER)!==T.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const a=this.context.gl,f=this.colorAttachment.get();if(f&&a.deleteTexture(f),this.depthAttachment){const m=this.depthAttachment.get();m&&a.deleteRenderbuffer(m)}a.deleteFramebuffer(this.framebuffer)}}class Qr{constructor(a,f,m){this.blendFunction=a,this.blendColor=f,this.mask=m}}Qr.Replace=[1,0],Qr.disabled=new Qr(Qr.Replace,l.aO.transparent,[!1,!1,!1,!1]),Qr.unblended=new Qr(Qr.Replace,l.aO.transparent,[!0,!0,!0,!0]),Qr.alphaBlended=new Qr([1,771],l.aO.transparent,[!0,!0,!0,!0]);class Vy{constructor(a){var f,m;if(this.gl=a,this.clearColor=new Mh(this),this.clearDepth=new kh(this),this.clearStencil=new Ip(this),this.colorMask=new Cp(this),this.depthMask=new Ah(this),this.stencilMask=new Tp(this),this.stencilFunc=new Lp(this),this.stencilOp=new Dh(this),this.stencilTest=new jm(this),this.depthRange=new Gm(this),this.depthTest=new Lu(this),this.depthFunc=new Dy(this),this.blend=new Ry(this),this.blendFunc=new Ny(this),this.blendColor=new Oy(this),this.blendEquation=new zy(this),this.cullFace=new Fy(this),this.cullFaceSide=new Pp(this),this.frontFace=new Rh(this),this.program=new Mp(this),this.activeTexture=new kp(this),this.viewport=new Pu(this),this.bindFramebuffer=new qm(this),this.bindRenderbuffer=new Wm(this),this.bindTexture=new Ap(this),this.bindVertexBuffer=new Hl(this),this.bindElementBuffer=new Hm(this),this.bindVertexArray=new Mu(this),this.pixelStoreUnpack=new ku(this),this.pixelStoreUnpackPremultiplyAlpha=new Zm(this),this.pixelStoreUnpackFlipY=new Dp(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),Ki(a)){this.HALF_FLOAT=a.HALF_FLOAT;const g=a.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(f=a.RGBA16F)!==null&&f!==void 0?f:g==null?void 0:g.RGBA16F_EXT,this.RGB16F=(m=a.RGB16F)!==null&&m!==void 0?m:g==null?void 0:g.RGB16F_EXT,a.getExtension("EXT_color_buffer_float")}else{a.getExtension("EXT_color_buffer_half_float"),a.getExtension("OES_texture_half_float_linear");const g=a.getExtension("OES_texture_half_float");this.HALF_FLOAT=g==null?void 0:g.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,f){return new Ay(this,a,f)}createVertexBuffer(a,f,m){return new Ph(this,a,f,m)}createRenderbuffer(a,f,m){const g=this.gl,b=g.createRenderbuffer();return this.bindRenderbuffer.set(b),g.renderbufferStorage(g.RENDERBUFFER,a,f,m),this.bindRenderbuffer.set(null),b}createFramebuffer(a,f,m,g){return new Pc(this,a,f,m,g)}clear({color:a,depth:f,stencil:m}){const g=this.gl;let b=0;a&&(b|=g.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(b|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),m!==void 0&&(b|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),g.clear(b)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){l.aD(a.blendFunction,Qr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}createVertexArray(){var a;return Ki(this.gl)?this.gl.createVertexArray():(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.createVertexArrayOES()}deleteVertexArray(a){var f;return Ki(this.gl)?this.gl.deleteVertexArray(a):(f=this.gl.getExtension("OES_vertex_array_object"))===null||f===void 0?void 0:f.deleteVertexArrayOES(a)}unbindVAO(){this.bindVertexArray.set(null)}}class zn{constructor(a,f,m){this.func=a,this.mask=f,this.range=m}}zn.ReadOnly=!1,zn.ReadWrite=!0,zn.disabled=new zn(519,zn.ReadOnly,[0,1]);const Rp=7680;class br{constructor(a,f,m,g,b,T){this.test=a,this.ref=f,this.mask=m,this.fail=g,this.depthFail=b,this.pass=T}}br.disabled=new br({func:519,mask:0},0,0,Rp,Rp,Rp);class ur{constructor(a,f,m){this.enable=a,this.mode=f,this.frontFace=m}}let Zl;function Oh(v,a,f,m,g,b,T){const L=v.context,k=L.gl,z=v.useProgram("collisionBox"),j=[];let q=0,$=0;for(let xe=0;xe<m.length;xe++){const De=m[xe],qe=a.getTile(De),He=qe.getBucket(f);if(!He)continue;let $e=De.posMatrix;g[0]===0&&g[1]===0||($e=v.translatePosMatrix(De.posMatrix,qe,g,b));const it=T?He.textCollisionBox:He.iconCollisionBox,tt=He.collisionCircleArray;if(tt.length>0){const ct=l.F(),dt=$e;l.aP(ct,He.placementInvProjMatrix,v.transform.glCoordMatrix),l.aP(ct,ct,He.placementViewportMatrix),j.push({circleArray:tt,circleOffset:$,transform:dt,invTransform:ct,coord:De}),q+=tt.length/4,$=q}it&&z.draw(L,k.LINES,zn.disabled,br.disabled,v.colorModeForRenderPass(),ur.disabled,Om($e,v.transform,qe),v.style.map.terrain&&v.style.map.terrain.getTerrainData(De),f.id,it.layoutVertexBuffer,it.indexBuffer,it.segments,null,v.transform.zoom,null,null,it.collisionVertexBuffer)}if(!T||!j.length)return;const he=v.useProgram("collisionCircle"),ce=new l.aQ;ce.resize(4*q),ce._trim();let ye=0;for(const xe of j)for(let De=0;De<xe.circleArray.length/4;De++){const qe=4*De,He=xe.circleArray[qe+0],$e=xe.circleArray[qe+1],it=xe.circleArray[qe+2],tt=xe.circleArray[qe+3];ce.emplace(ye++,He,$e,it,tt,0),ce.emplace(ye++,He,$e,it,tt,1),ce.emplace(ye++,He,$e,it,tt,2),ce.emplace(ye++,He,$e,it,tt,3)}(!Zl||Zl.length<2*q)&&(Zl=function(xe){const De=2*xe,qe=new l.aS;qe.resize(De),qe._trim();for(let He=0;He<De;He++){const $e=6*He;qe.uint16[$e+0]=4*He+0,qe.uint16[$e+1]=4*He+1,qe.uint16[$e+2]=4*He+2,qe.uint16[$e+3]=4*He+2,qe.uint16[$e+4]=4*He+3,qe.uint16[$e+5]=4*He+0}return qe}(q));const re=L.createIndexBuffer(Zl,!0),Ie=L.createVertexBuffer(ce,l.aR.members,!0);for(const xe of j){const De={u_matrix:xe.transform,u_inv_matrix:xe.invTransform,u_camera_to_center_distance:(Ue=v.transform).cameraToCenterDistance,u_viewport_size:[Ue.width,Ue.height]};he.draw(L,k.TRIANGLES,zn.disabled,br.disabled,v.colorModeForRenderPass(),ur.disabled,De,v.style.map.terrain&&v.style.map.terrain.getTerrainData(xe.coord),f.id,Ie,re,l.$.simpleSegment(0,2*xe.circleOffset,xe.circleArray.length,xe.circleArray.length/2),null,v.transform.zoom,null,null,null)}var Ue;Ie.destroy(),re.destroy()}ur.disabled=new ur(!1,1029,2305),ur.backCCW=new ur(!0,1029,2305);const Np=l.an(new Float32Array(16));function Ym(v,a,f,m,g,b){const{horizontalAlign:T,verticalAlign:L}=l.at(v);return new l.P((-(T-.5)*a/g+m[0])*b,(-(L-.5)*f/g+m[1])*b)}function zh(v,a,f,m,g,b,T,L,k,z,j){const q=v.text.placedSymbolArray,$=v.text.dynamicLayoutVertexArray,he=v.icon.dynamicLayoutVertexArray,ce={};$.clear();for(let ye=0;ye<q.length;ye++){const re=q.get(ye),Ie=re.hidden||!re.crossTileID||v.allowVerticalPlacement&&!re.placedOrientation?null:m[re.crossTileID];if(Ie){const Ue=new l.P(re.anchorX,re.anchorY),xe=Jr(Ue,f?T:b,j),De=_e(g.cameraToCenterDistance,xe.signedDistanceFromCamera);let qe=l.ai(v.textSizeData,k,re)*De/l.ao;f&&(qe*=v.tilePixelRatio/L);const{width:He,height:$e,anchor:it,textOffset:tt,textBoxScale:ct}=Ie,dt=Ym(it,He,$e,tt,ct,qe),gn=f?Jr(Ue.add(dt),b,j).point:xe.point.add(a?dt.rotate(-g.angle):dt),_t=v.allowVerticalPlacement&&re.placedOrientation===l.ah.vertical?Math.PI/2:0;for(let en=0;en<re.numGlyphs;en++)l.aj($,gn,_t);z&&re.associatedIconIndex>=0&&(ce[re.associatedIconIndex]={shiftedAnchor:gn,angle:_t})}else Je(re.numGlyphs,$)}if(z){he.clear();const ye=v.icon.placedSymbolArray;for(let re=0;re<ye.length;re++){const Ie=ye.get(re);if(Ie.hidden)Je(Ie.numGlyphs,he);else{const Ue=ce[re];if(Ue)for(let xe=0;xe<Ie.numGlyphs;xe++)l.aj(he,Ue.shiftedAnchor,Ue.angle);else Je(Ie.numGlyphs,he)}}v.icon.dynamicLayoutVertexBuffer.updateData(he)}v.text.dynamicLayoutVertexBuffer.updateData($)}function Fh(v,a,f){return f.iconsInText&&a?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function Bh(v,a,f,m,g,b,T,L,k,z,j,q){const $=v.context,he=$.gl,ce=v.transform,ye=L==="map",re=k==="map",Ie=L!=="viewport"&&f.layout.get("symbol-placement")!=="point",Ue=ye&&!re&&!Ie,xe=!f.layout.get("symbol-sort-key").isConstant();let De=!1;const qe=v.depthModeForSublayer(0,zn.ReadOnly),He=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),$e=[];for(const it of m){const tt=a.getTile(it),ct=tt.getBucket(f);if(!ct)continue;const dt=g?ct.text:ct.icon;if(!dt||!dt.segments.get().length||!dt.hasVisibleVertices)continue;const gn=dt.programConfigurations.get(f.id),_t=g||ct.sdfIcons,en=g?ct.textSizeData:ct.iconSizeData,_n=re||ce.pitch!==0,Fn=v.useProgram(Fh(_t,g,ct),gn),on=l.ag(en,ce.zoom),bn=v.style.map.terrain&&v.style.map.terrain.getTerrainData(it);let Cn,Br,tr,Xo,yi=[0,0],Mr=null;if(g)Br=tt.glyphAtlasTexture,tr=he.LINEAR,Cn=tt.glyphAtlasTexture.size,ct.iconsInText&&(yi=tt.imageAtlasTexture.size,Mr=tt.imageAtlasTexture,Xo=_n||v.options.rotating||v.options.zooming||en.kind==="composite"||en.kind==="camera"?he.LINEAR:he.NEAREST);else{const fi=f.layout.get("icon-size").constantOr(0)!==1||ct.iconsNeedLinear;Br=tt.imageAtlasTexture,tr=_t||v.options.rotating||v.options.zooming||fi||_n?he.LINEAR:he.NEAREST,Cn=tt.imageAtlasTexture.size}const vi=un(tt,1,v.transform.zoom),Yo=fn(it.posMatrix,re,ye,v.transform,vi),ia=za(it.posMatrix,re,ye,v.transform,vi),dl=He&&ct.hasTextData(),jc=f.layout.get("icon-text-fit")!=="none"&&dl&&ct.hasIconData();if(Ie){const fi=v.style.map.terrain?(gs,pi)=>v.style.map.terrain.getElevation(it,gs,pi):null,Ar=f.layout.get("text-rotation-alignment")==="map";X(ct,it.posMatrix,v,g,Yo,ia,re,z,Ar,fi)}const ml=v.translatePosMatrix(it.posMatrix,tt,b,T),oa=Ie||g&&He||jc?Np:Yo,hi=v.translatePosMatrix(ia,tt,b,T,!0),kr=_t&&f.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ir;Ir=_t?ct.iconsInText?Lc(en.kind,on,Ue,re,v,ml,oa,hi,Cn,yi):Tc(en.kind,on,Ue,re,v,ml,oa,hi,g,Cn,!0):Cc(en.kind,on,Ue,re,v,ml,oa,hi,g,Cn);const ms={program:Fn,buffers:dt,uniformValues:Ir,atlasTexture:Br,atlasTextureIcon:Mr,atlasInterpolation:tr,atlasInterpolationIcon:Xo,isSDF:_t,hasHalo:kr};if(xe&&ct.canOverlap){De=!0;const fi=dt.segments.get();for(const Ar of fi)$e.push({segments:new l.$([Ar]),sortKey:Ar.sortKey,state:ms,terrainData:bn})}else $e.push({segments:dt.segments,sortKey:0,state:ms,terrainData:bn})}De&&$e.sort((it,tt)=>it.sortKey-tt.sortKey);for(const it of $e){const tt=it.state;if($.activeTexture.set(he.TEXTURE0),tt.atlasTexture.bind(tt.atlasInterpolation,he.CLAMP_TO_EDGE),tt.atlasTextureIcon&&($.activeTexture.set(he.TEXTURE1),tt.atlasTextureIcon&&tt.atlasTextureIcon.bind(tt.atlasInterpolationIcon,he.CLAMP_TO_EDGE)),tt.isSDF){const ct=tt.uniformValues;tt.hasHalo&&(ct.u_is_halo=1,$m(tt.buffers,it.segments,f,v,tt.program,qe,j,q,ct,it.terrainData)),ct.u_is_halo=0}$m(tt.buffers,it.segments,f,v,tt.program,qe,j,q,tt.uniformValues,it.terrainData)}}function $m(v,a,f,m,g,b,T,L,k,z){const j=m.context;g.draw(j,j.gl.TRIANGLES,b,T,L,ur.disabled,k,z,f.id,v.layoutVertexBuffer,v.indexBuffer,a,f.paint,m.transform.zoom,v.programConfigurations.get(f.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function Vh(v,a,f,m,g){if(!f||!m||!m.imageAtlas)return;const b=m.imageAtlas.patternPositions;let T=b[f.to.toString()],L=b[f.from.toString()];if(!T&&L&&(T=L),!L&&T&&(L=T),!T||!L){const k=g.getPaintProperty(a);T=b[k],L=b[k]}T&&L&&v.setConstantPatternPositions(T,L)}function Km(v,a,f,m,g,b,T){const L=v.context.gl,k="fill-pattern",z=f.paint.get(k),j=z&&z.constantOr(1),q=f.getCrossfadeParameters();let $,he,ce,ye,re;T?(he=j&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$=L.LINES):(he=j?"fillPattern":"fill",$=L.TRIANGLES);const Ie=z.constantOr(null);for(const Ue of m){const xe=a.getTile(Ue);if(j&&!xe.patternsLoaded())continue;const De=xe.getBucket(f);if(!De)continue;const qe=De.programConfigurations.get(f.id),He=v.useProgram(he,qe),$e=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ue);j&&(v.context.activeTexture.set(L.TEXTURE0),xe.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),qe.updatePaintBuffers(q)),Vh(qe,k,Ie,xe,f);const it=$e?Ue:null,tt=v.translatePosMatrix(it?it.posMatrix:Ue.posMatrix,xe,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(T){ye=De.indexBuffer2,re=De.segments2;const ct=[L.drawingBufferWidth,L.drawingBufferHeight];ce=he==="fillOutlinePattern"&&j?Nm(tt,v,q,xe,ct):Ly(tt,ct)}else ye=De.indexBuffer,re=De.segments,ce=j?Eh(tt,v,q,xe):Rm(tt);He.draw(v.context,$,g,v.stencilModeForClipping(Ue),b,ur.disabled,ce,$e,f.id,De.layoutVertexBuffer,ye,re,f.paint,v.transform.zoom,qe)}}function Uh(v,a,f,m,g,b,T){const L=v.context,k=L.gl,z="fill-extrusion-pattern",j=f.paint.get(z),q=j.constantOr(1),$=f.getCrossfadeParameters(),he=f.paint.get("fill-extrusion-opacity"),ce=j.constantOr(null);for(const ye of m){const re=a.getTile(ye),Ie=re.getBucket(f);if(!Ie)continue;const Ue=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ye),xe=Ie.programConfigurations.get(f.id),De=v.useProgram(q?"fillExtrusionPattern":"fillExtrusion",xe);q&&(v.context.activeTexture.set(k.TEXTURE0),re.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),xe.updatePaintBuffers($)),Vh(xe,z,ce,re,f);const qe=v.translatePosMatrix(ye.posMatrix,re,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),He=f.paint.get("fill-extrusion-vertical-gradient"),$e=q?Ty(qe,v,He,he,ye,$,re):Sc(qe,v,He,he);De.draw(L,L.gl.TRIANGLES,g,b,T,ur.backCCW,$e,Ue,f.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,f.paint,v.transform.zoom,xe,v.style.map.terrain&&Ie.centroidVertexBuffer)}}function jh(v,a,f,m,g,b,T){const L=v.context,k=L.gl,z=f.fbo;if(!z)return;const j=v.useProgram("hillshade"),q=v.style.map.terrain&&v.style.map.terrain.getTerrainData(a);L.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,z.colorAttachment.get()),j.draw(L,k.TRIANGLES,g,b,T,ur.disabled,(($,he,ce,ye)=>{const re=ce.paint.get("hillshade-shadow-color"),Ie=ce.paint.get("hillshade-highlight-color"),Ue=ce.paint.get("hillshade-accent-color");let xe=ce.paint.get("hillshade-illumination-direction")*(Math.PI/180);ce.paint.get("hillshade-illumination-anchor")==="viewport"&&(xe-=$.transform.angle);const De=!$.options.moving;return{u_matrix:ye?ye.posMatrix:$.transform.calculatePosMatrix(he.tileID.toUnwrapped(),De),u_image:0,u_latrange:Bm(0,he.tileID),u_light:[ce.paint.get("hillshade-exaggeration"),xe],u_shadow:re,u_highlight:Ie,u_accent:Ue}})(v,f,m,q?a:null),q,m.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}function Op(v,a,f,m,g,b){const T=v.context,L=T.gl,k=a.dem;if(k&&k.data){const z=k.dim,j=k.stride,q=k.getPixels();if(T.activeTexture.set(L.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||v.getTileTexture(j),a.demTexture){const he=a.demTexture;he.update(q,{premultiply:!1}),he.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else a.demTexture=new K(T,q,L.RGBA,{premultiply:!1}),a.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);T.activeTexture.set(L.TEXTURE0);let $=a.fbo;if(!$){const he=new K(T,{width:z,height:z,data:null},L.RGBA);he.bind(L.LINEAR,L.CLAMP_TO_EDGE),$=a.fbo=T.createFramebuffer(z,z,!0,!1),$.colorAttachment.set(he.texture)}T.bindFramebuffer.set($.framebuffer),T.viewport.set([0,0,z,z]),v.useProgram("hillshadePrepare").draw(T,L.TRIANGLES,m,g,b,ur.disabled,((he,ce)=>{const ye=ce.stride,re=l.F();return l.aN(re,0,l.W,-l.W,0,0,1),l.H(re,re,[0,-l.W,0]),{u_matrix:re,u_image:1,u_dimension:[ye,ye],u_zoom:he.overscaledZ,u_unpack:ce.getUnpackVector()}})(a.tileID,k),null,f.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments),a.needsHillshadePrepare=!1}}function Jm(v,a,f,m,g,b){const T=m.paint.get("raster-fade-duration");if(!b&&T>0){const L=E.now(),k=(L-v.timeAdded)/T,z=a?(L-a.timeAdded)/T:-1,j=f.getSource(),q=g.coveringZoomLevel({tileSize:j.tileSize,roundZoom:j.roundZoom}),$=!a||Math.abs(a.tileID.overscaledZ-q)>Math.abs(v.tileID.overscaledZ-q),he=$&&v.refreshedUponExpiration?1:l.ac($?k:1-z,0,1);return v.refreshedUponExpiration&&k>=1&&(v.refreshedUponExpiration=!1),a?{opacity:1,mix:1-he}:{opacity:he,mix:0}}return{opacity:1,mix:0}}const Qm=new l.aO(1,0,0,1),Gh=new l.aO(0,1,0,1),zp=new l.aO(0,0,1,1),Uy=new l.aO(1,0,1,1),eg=new l.aO(0,1,1,1);function zr(v,a,f,m){go(v,0,a+f/2,v.transform.width,f,m)}function cl(v,a,f,m){go(v,a-f/2,0,f,v.transform.height,m)}function go(v,a,f,m,g,b){const T=v.context,L=T.gl;L.enable(L.SCISSOR_TEST),L.scissor(a*v.pixelRatio,f*v.pixelRatio,m*v.pixelRatio,g*v.pixelRatio),T.clear({color:b}),L.disable(L.SCISSOR_TEST)}function Fp(v,a,f){const m=v.context,g=m.gl,b=f.posMatrix,T=v.useProgram("debug"),L=zn.disabled,k=br.disabled,z=v.colorModeForRenderPass(),j="$debug",q=v.style.map.terrain&&v.style.map.terrain.getTerrainData(f);m.activeTexture.set(g.TEXTURE0);const $=a.getTileByID(f.key).latestRawTileData,he=Math.floor(($&&$.byteLength||0)/1024),ce=a.getTile(f).tileSize,ye=512/Math.min(ce,512)*(f.overscaledZ/v.transform.zoom)*.5;let re=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(re+=` => ${f.overscaledZ}`),function(Ie,Ue){Ie.initDebugOverlayCanvas();const xe=Ie.debugOverlayCanvas,De=Ie.context.gl,qe=Ie.debugOverlayCanvas.getContext("2d");qe.clearRect(0,0,xe.width,xe.height),qe.shadowColor="white",qe.shadowBlur=2,qe.lineWidth=1.5,qe.strokeStyle="white",qe.textBaseline="top",qe.font="bold 36px Open Sans, sans-serif",qe.fillText(Ue,5,5),qe.strokeText(Ue,5,5),Ie.debugOverlayTexture.update(xe),Ie.debugOverlayTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE)}(v,`${re} ${he}kB`),T.draw(m,g.TRIANGLES,L,k,Qr.alphaBlended,ur.disabled,zm(b,l.aO.transparent,ye),null,j,v.debugBuffer,v.quadTriangleIndexBuffer,v.debugSegments),T.draw(m,g.LINE_STRIP,L,k,z,ur.disabled,zm(b,l.aO.red),q,j,v.debugBuffer,v.tileBorderIndexBuffer,v.debugSegments)}function qh(v,a,f){const m=v.context,g=m.gl,b=v.colorModeForRenderPass(),T=new zn(g.LEQUAL,zn.ReadWrite,v.depthRangeFor3D),L=v.useProgram("terrain"),k=a.getTerrainMesh();m.bindFramebuffer.set(null),m.viewport.set([0,0,v.width,v.height]);for(const z of f){const j=v.renderToTexture.getTexture(z),q=a.getTerrainData(z.tileID);m.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,j.texture);const $={u_matrix:v.transform.calculatePosMatrix(z.tileID.toUnwrapped()),u_texture:0,u_ele_delta:a.getMeshFrameDelta(v.transform.zoom)};L.draw(m,g.TRIANGLES,T,br.disabled,b,ur.backCCW,$,q,"terrain",k.vertexBuffer,k.indexBuffer,k.segments)}}class tg{constructor(a,f){this.context=new Vy(a),this.transform=f,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=li.maxUnderzooming+li.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ll}resize(a,f,m){if(this.width=Math.floor(a*m),this.height=Math.floor(f*m),this.pixelRatio=m,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const a=this.context,f=new l.aV;f.emplaceBack(0,0),f.emplaceBack(l.W,0),f.emplaceBack(0,l.W),f.emplaceBack(l.W,l.W),this.tileExtentBuffer=a.createVertexBuffer(f,xh.members),this.tileExtentSegments=l.$.simpleSegment(0,0,4,2);const m=new l.aV;m.emplaceBack(0,0),m.emplaceBack(l.W,0),m.emplaceBack(0,l.W),m.emplaceBack(l.W,l.W),this.debugBuffer=a.createVertexBuffer(m,xh.members),this.debugSegments=l.$.simpleSegment(0,0,4,5);const g=new l.Z;g.emplaceBack(0,0,0,0),g.emplaceBack(l.W,0,l.W,0),g.emplaceBack(0,l.W,0,l.W),g.emplaceBack(l.W,l.W,l.W,l.W),this.rasterBoundsBuffer=a.createVertexBuffer(g,St.members),this.rasterBoundsSegments=l.$.simpleSegment(0,0,4,2);const b=new l.aV;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(b,xh.members),this.viewportSegments=l.$.simpleSegment(0,0,4,2);const T=new l.aW;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=a.createIndexBuffer(T);const L=new l.aX;L.emplaceBack(0,1,2),L.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(L);const k=this.context.gl;this.stencilClearMode=new br({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO)}clearStencil(){const a=this.context,f=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const m=l.F();l.aN(m,0,this.width,this.height,0,0,1),l.J(m,m,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(a,f.TRIANGLES,zn.disabled,this.stencilClearMode,Qr.disabled,ur.disabled,Ih(m),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(a,f){if(this.currentStencilSource===a.source||!a.isTileClipped()||!f||!f.length)return;this.currentStencilSource=a.source;const m=this.context,g=m.gl;this.nextStencilID+f.length>256&&this.clearStencil(),m.setColorMode(Qr.disabled),m.setDepthMode(zn.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of f){const L=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,k=this.style.map.terrain&&this.style.map.terrain.getTerrainData(T);b.draw(m,g.TRIANGLES,zn.disabled,new br({func:g.ALWAYS,mask:0},L,255,g.KEEP,g.KEEP,g.REPLACE),Qr.disabled,ur.disabled,Ih(T.posMatrix),k,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,f=this.context.gl;return new br({func:f.NOTEQUAL,mask:255},a,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(a){const f=this.context.gl;return new br({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(a){const f=this.context.gl,m=a.sort((T,L)=>L.overscaledZ-T.overscaledZ),g=m[m.length-1].overscaledZ,b=m[0].overscaledZ-g+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const T={};for(let L=0;L<b;L++)T[L+g]=new br({func:f.GEQUAL,mask:255},L+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=b,[T,m]}return[{[g]:br.disabled},m]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new Qr([a.CONSTANT_COLOR,a.ONE],new l.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Qr.unblended:Qr.alphaBlended}depthModeForSublayer(a,f,m){if(!this.opaquePassEnabledForLayer())return zn.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new zn(m||this.context.gl.LEQUAL,f,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,f){this.style=a,this.options=f,this.lineAtlas=a.lineAtlas,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(E.now()),this.imageManager.beginFrame();const m=this.style._order,g=this.style.sourceCaches,b={},T={},L={};for(const k in g){const z=g[k];z.used&&z.prepare(this.context),b[k]=z.getVisibleCoordinates(),T[k]=b[k].slice().reverse(),L[k]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<m.length;k++)if(this.style._layers[m[k]].is3D()){this.opaquePassCutoff=k;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const k of m){const z=this.style._layers[k];if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const j=T[z.source];(z.type==="custom"||j.length)&&this.renderLayer(this,g[z.source],z,j)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?l.aO.black:l.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(a._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[m[this.currentLayer]],z=g[k.source],j=b[k.source];this._renderTileClippingMasks(k,j),this.renderLayer(this,z,k,j)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const k=this.style._layers[m[this.currentLayer]],z=g[k.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(k))continue;const j=(k.type==="symbol"?L:T)[k.source];this._renderTileClippingMasks(k,b[k.source]),this.renderLayer(this,z,k,j)}if(this.options.showTileBoundaries){const k=function(z,j){let q=null;const $=Object.values(z._layers).flatMap(re=>re.source&&!re.isHidden(j)?[z.sourceCaches[re.source]]:[]),he=$.filter(re=>re.getSource().type==="vector"),ce=$.filter(re=>re.getSource().type!=="vector"),ye=re=>{(!q||q.getSource().maxzoom<re.getSource().maxzoom)&&(q=re)};return he.forEach(re=>ye(re)),q||ce.forEach(re=>ye(re)),q}(this.style,this.transform.zoom);k&&function(z,j,q){for(let $=0;$<q.length;$++)Fp(z,j,q[$])}(this,k,k.getVisibleCoordinates())}this.options.showPadding&&function(k){const z=k.transform.padding;zr(k,k.transform.height-(z.top||0),3,Qm),zr(k,z.bottom||0,3,Gh),cl(k,z.left||0,3,zp),cl(k,k.transform.width-(z.right||0),3,Uy);const j=k.transform.centerPoint;(function(q,$,he,ce){go(q,$-1,he-10,2,20,ce),go(q,$-10,he-1,20,2,ce)})(k,j.x,k.transform.height-j.y,eg)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(a){if(!this.style||!this.style.map||!this.style.map.terrain)return;const f=this.terrainFacilitator.matrix,m=this.transform.projMatrix;let g=this.terrainFacilitator.dirty;g||(g=a?!l.aY(f,m):!l.aZ(f,m)),g||(g=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),g&&(l.a_(f,m),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(b,T){const L=b.context,k=L.gl,z=Qr.unblended,j=new zn(k.LEQUAL,zn.ReadWrite,[0,1]),q=T.getTerrainMesh(),$=T.sourceCache.getRenderableTiles(),he=b.useProgram("terrainDepth");L.bindFramebuffer.set(T.getFramebuffer("depth").framebuffer),L.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),L.clear({color:l.aO.transparent,depth:1});for(const ce of $){const ye=T.getTerrainData(ce.tileID),re={u_matrix:b.transform.calculatePosMatrix(ce.tileID.toUnwrapped()),u_ele_delta:T.getMeshFrameDelta(b.transform.zoom)};he.draw(L,k.TRIANGLES,j,br.disabled,z,ur.backCCW,re,ye,"terrain",q.vertexBuffer,q.indexBuffer,q.segments)}L.bindFramebuffer.set(null),L.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain),function(b,T){const L=b.context,k=L.gl,z=Qr.unblended,j=new zn(k.LEQUAL,zn.ReadWrite,[0,1]),q=T.getTerrainMesh(),$=T.getCoordsTexture(),he=T.sourceCache.getRenderableTiles(),ce=b.useProgram("terrainCoords");L.bindFramebuffer.set(T.getFramebuffer("coords").framebuffer),L.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),L.clear({color:l.aO.transparent,depth:1}),T.coordsIndex=[];for(const ye of he){const re=T.getTerrainData(ye.tileID);L.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,$.texture);const Ie={u_matrix:b.transform.calculatePosMatrix(ye.tileID.toUnwrapped()),u_terrain_coords_id:(255-T.coordsIndex.length)/255,u_texture:0,u_ele_delta:T.getMeshFrameDelta(b.transform.zoom)};ce.draw(L,k.TRIANGLES,j,br.disabled,z,ur.backCCW,Ie,re,"terrain",q.vertexBuffer,q.indexBuffer,q.segments),T.coordsIndex.push(ye.tileID.key)}L.bindFramebuffer.set(null),L.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain))}renderLayer(a,f,m,g){if(!m.isHidden(this.transform.zoom)&&(m.type==="background"||m.type==="custom"||(g||[]).length))switch(this.id=m.id,m.type){case"symbol":(function(b,T,L,k,z){if(b.renderPass!=="translucent")return;const j=br.disabled,q=b.colorModeForRenderPass();(L._unevaluatedLayout.hasValue("text-variable-anchor")||L._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function($,he,ce,ye,re,Ie,Ue){const xe=he.transform,De=re==="map",qe=Ie==="map";for(const He of $){const $e=ye.getTile(He),it=$e.getBucket(ce);if(!it||!it.text||!it.text.segments.get().length)continue;const tt=l.ag(it.textSizeData,xe.zoom),ct=un($e,1,he.transform.zoom),dt=fn(He.posMatrix,qe,De,he.transform,ct),gn=ce.layout.get("icon-text-fit")!=="none"&&it.hasIconData();if(tt){const _t=Math.pow(2,xe.zoom-$e.tileID.overscaledZ);zh(it,De,qe,Ue,xe,dt,He.posMatrix,_t,tt,gn,he.style.map.terrain?(en,_n)=>he.style.map.terrain.getElevation(He,en,_n):null)}}}(k,b,L,T,L.layout.get("text-rotation-alignment"),L.layout.get("text-pitch-alignment"),z),L.paint.get("icon-opacity").constantOr(1)!==0&&Bh(b,T,L,k,!1,L.paint.get("icon-translate"),L.paint.get("icon-translate-anchor"),L.layout.get("icon-rotation-alignment"),L.layout.get("icon-pitch-alignment"),L.layout.get("icon-keep-upright"),j,q),L.paint.get("text-opacity").constantOr(1)!==0&&Bh(b,T,L,k,!0,L.paint.get("text-translate"),L.paint.get("text-translate-anchor"),L.layout.get("text-rotation-alignment"),L.layout.get("text-pitch-alignment"),L.layout.get("text-keep-upright"),j,q),T.map.showCollisionBoxes&&(Oh(b,T,L,k,L.paint.get("text-translate"),L.paint.get("text-translate-anchor"),!0),Oh(b,T,L,k,L.paint.get("icon-translate"),L.paint.get("icon-translate-anchor"),!1))})(a,f,m,g,this.style.placement.variableOffsets);break;case"circle":(function(b,T,L,k){if(b.renderPass!=="translucent")return;const z=L.paint.get("circle-opacity"),j=L.paint.get("circle-stroke-width"),q=L.paint.get("circle-stroke-opacity"),$=!L.layout.get("circle-sort-key").isConstant();if(z.constantOr(1)===0&&(j.constantOr(1)===0||q.constantOr(1)===0))return;const he=b.context,ce=he.gl,ye=b.depthModeForSublayer(0,zn.ReadOnly),re=br.disabled,Ie=b.colorModeForRenderPass(),Ue=[];for(let xe=0;xe<k.length;xe++){const De=k[xe],qe=T.getTile(De),He=qe.getBucket(L);if(!He)continue;const $e=He.programConfigurations.get(L.id),it=b.useProgram("circle",$e),tt=He.layoutVertexBuffer,ct=He.indexBuffer,dt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(De),gn={programConfiguration:$e,program:it,layoutVertexBuffer:tt,indexBuffer:ct,uniformValues:Py(b,De,qe,L),terrainData:dt};if($){const _t=He.segments.get();for(const en of _t)Ue.push({segments:new l.$([en]),sortKey:en.sortKey,state:gn})}else Ue.push({segments:He.segments,sortKey:0,state:gn})}$&&Ue.sort((xe,De)=>xe.sortKey-De.sortKey);for(const xe of Ue){const{programConfiguration:De,program:qe,layoutVertexBuffer:He,indexBuffer:$e,uniformValues:it,terrainData:tt}=xe.state;qe.draw(he,ce.TRIANGLES,ye,re,Ie,ur.disabled,it,tt,L.id,He,$e,xe.segments,L.paint,b.transform.zoom,De)}})(a,f,m,g);break;case"heatmap":(function(b,T,L,k){if(L.paint.get("heatmap-opacity")!==0)if(b.renderPass==="offscreen"){const z=b.context,j=z.gl,q=br.disabled,$=new Qr([j.ONE,j.ONE],l.aO.transparent,[!0,!0,!0,!0]);(function(he,ce,ye){const re=he.gl;he.activeTexture.set(re.TEXTURE1),he.viewport.set([0,0,ce.width/4,ce.height/4]);let Ie=ye.heatmapFbo;if(Ie)re.bindTexture(re.TEXTURE_2D,Ie.colorAttachment.get()),he.bindFramebuffer.set(Ie.framebuffer);else{const Ue=re.createTexture();re.bindTexture(re.TEXTURE_2D,Ue),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_S,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_T,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MIN_FILTER,re.LINEAR),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MAG_FILTER,re.LINEAR),Ie=ye.heatmapFbo=he.createFramebuffer(ce.width/4,ce.height/4,!1,!1),function(xe,De,qe,He){var $e,it;const tt=xe.gl,ct=($e=xe.HALF_FLOAT)!==null&&$e!==void 0?$e:tt.UNSIGNED_BYTE,dt=(it=xe.RGBA16F)!==null&&it!==void 0?it:tt.RGBA;tt.texImage2D(tt.TEXTURE_2D,0,dt,De.width/4,De.height/4,0,tt.RGBA,ct,null),He.colorAttachment.set(qe)}(he,ce,Ue,Ie)}})(z,b,L),z.clear({color:l.aO.transparent});for(let he=0;he<k.length;he++){const ce=k[he];if(T.hasRenderableParent(ce))continue;const ye=T.getTile(ce),re=ye.getBucket(L);if(!re)continue;const Ie=re.programConfigurations.get(L.id),Ue=b.useProgram("heatmap",Ie),{zoom:xe}=b.transform;Ue.draw(z,j.TRIANGLES,zn.disabled,q,$,ur.disabled,Fm(ce.posMatrix,ye,xe,L.paint.get("heatmap-intensity")),null,L.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,L.paint,b.transform.zoom,Ie)}z.viewport.set([0,0,b.width,b.height])}else b.renderPass==="translucent"&&(b.context.setColorMode(b.colorModeForRenderPass()),function(z,j){const q=z.context,$=q.gl,he=j.heatmapFbo;if(!he)return;q.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,he.colorAttachment.get()),q.activeTexture.set($.TEXTURE1);let ce=j.colorRampTexture;ce||(ce=j.colorRampTexture=new K(q,j.colorRamp,$.RGBA)),ce.bind($.LINEAR,$.CLAMP_TO_EDGE),z.useProgram("heatmapTexture").draw(q,$.TRIANGLES,zn.disabled,br.disabled,z.colorModeForRenderPass(),ur.disabled,((ye,re,Ie,Ue)=>{const xe=l.F();l.aN(xe,0,ye.width,ye.height,0,0,1);const De=ye.context.gl;return{u_matrix:xe,u_world:[De.drawingBufferWidth,De.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:re.paint.get("heatmap-opacity")}})(z,j),null,j.id,z.viewportBuffer,z.quadTriangleIndexBuffer,z.viewportSegments,j.paint,z.transform.zoom)}(b,L))})(a,f,m,g);break;case"line":(function(b,T,L,k){if(b.renderPass!=="translucent")return;const z=L.paint.get("line-opacity"),j=L.paint.get("line-width");if(z.constantOr(1)===0||j.constantOr(1)===0)return;const q=b.depthModeForSublayer(0,zn.ReadOnly),$=b.colorModeForRenderPass(),he=L.paint.get("line-dasharray"),ce=L.paint.get("line-pattern"),ye=ce.constantOr(1),re=L.paint.get("line-gradient"),Ie=L.getCrossfadeParameters(),Ue=ye?"linePattern":he?"lineSDF":re?"lineGradient":"line",xe=b.context,De=xe.gl;let qe=!0;for(const He of k){const $e=T.getTile(He);if(ye&&!$e.patternsLoaded())continue;const it=$e.getBucket(L);if(!it)continue;const tt=it.programConfigurations.get(L.id),ct=b.context.program.get(),dt=b.useProgram(Ue,tt),gn=qe||dt.program!==ct,_t=b.style.map.terrain&&b.style.map.terrain.getTerrainData(He),en=ce.constantOr(null);if(en&&$e.imageAtlas){const on=$e.imageAtlas,bn=on.patternPositions[en.to.toString()],Cn=on.patternPositions[en.from.toString()];bn&&Cn&&tt.setConstantPatternPositions(bn,Cn)}const _n=_t?He:null,Fn=ye?ql(b,$e,L,Ie,_n):he?Th(b,$e,L,he,Ie,_n):re?Vm(b,$e,L,it.lineClipsArray.length,_n):Ch(b,$e,L,_n);if(ye)xe.activeTexture.set(De.TEXTURE0),$e.imageAtlasTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE),tt.updatePaintBuffers(Ie);else if(he&&(gn||b.lineAtlas.dirty))xe.activeTexture.set(De.TEXTURE0),b.lineAtlas.bind(xe);else if(re){const on=it.gradients[L.id];let bn=on.texture;if(L.gradientVersion!==on.version){let Cn=256;if(L.stepInterpolant){const Br=T.getSource().maxzoom,tr=He.canonical.z===Br?Math.ceil(1<<b.transform.maxZoom-He.canonical.z):1;Cn=l.ac(l.aT(it.maxLineLength/l.W*1024*tr),256,xe.maxTextureSize)}on.gradient=l.aU({expression:L.gradientExpression(),evaluationKey:"lineProgress",resolution:Cn,image:on.gradient||void 0,clips:it.lineClipsArray}),on.texture?on.texture.update(on.gradient):on.texture=new K(xe,on.gradient,De.RGBA),on.version=L.gradientVersion,bn=on.texture}xe.activeTexture.set(De.TEXTURE0),bn.bind(L.stepInterpolant?De.NEAREST:De.LINEAR,De.CLAMP_TO_EDGE)}dt.draw(xe,De.TRIANGLES,q,b.stencilModeForClipping(He),$,ur.disabled,Fn,_t,L.id,it.layoutVertexBuffer,it.indexBuffer,it.segments,L.paint,b.transform.zoom,tt,it.layoutVertexBuffer2),qe=!1}})(a,f,m,g);break;case"fill":(function(b,T,L,k){const z=L.paint.get("fill-color"),j=L.paint.get("fill-opacity");if(j.constantOr(1)===0)return;const q=b.colorModeForRenderPass(),$=L.paint.get("fill-pattern"),he=b.opaquePassEnabledForLayer()&&!$.constantOr(1)&&z.constantOr(l.aO.transparent).a===1&&j.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===he){const ce=b.depthModeForSublayer(1,b.renderPass==="opaque"?zn.ReadWrite:zn.ReadOnly);Km(b,T,L,k,ce,q,!1)}if(b.renderPass==="translucent"&&L.paint.get("fill-antialias")){const ce=b.depthModeForSublayer(L.getPaintProperty("fill-outline-color")?2:0,zn.ReadOnly);Km(b,T,L,k,ce,q,!0)}})(a,f,m,g);break;case"fill-extrusion":(function(b,T,L,k){const z=L.paint.get("fill-extrusion-opacity");if(z!==0&&b.renderPass==="translucent"){const j=new zn(b.context.gl.LEQUAL,zn.ReadWrite,b.depthRangeFor3D);if(z!==1||L.paint.get("fill-extrusion-pattern").constantOr(1))Uh(b,T,L,k,j,br.disabled,Qr.disabled),Uh(b,T,L,k,j,b.stencilModeFor3D(),b.colorModeForRenderPass());else{const q=b.colorModeForRenderPass();Uh(b,T,L,k,j,br.disabled,q)}}})(a,f,m,g);break;case"hillshade":(function(b,T,L,k){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const z=b.context,j=b.depthModeForSublayer(0,zn.ReadOnly),q=b.colorModeForRenderPass(),[$,he]=b.renderPass==="translucent"?b.stencilConfigForOverlap(k):[{},k];for(const ce of he){const ye=T.getTile(ce);ye.needsHillshadePrepare!==void 0&&ye.needsHillshadePrepare&&b.renderPass==="offscreen"?Op(b,ye,L,j,br.disabled,q):b.renderPass==="translucent"&&jh(b,ce,ye,L,j,$[ce.overscaledZ],q)}z.viewport.set([0,0,b.width,b.height])})(a,f,m,g);break;case"raster":(function(b,T,L,k){if(b.renderPass!=="translucent"||L.paint.get("raster-opacity")===0||!k.length)return;const z=b.context,j=z.gl,q=T.getSource(),$=b.useProgram("raster"),he=b.colorModeForRenderPass(),[ce,ye]=q instanceof hn?[{},k]:b.stencilConfigForOverlap(k),re=ye[ye.length-1].overscaledZ,Ie=!b.options.moving;for(const Ue of ye){const xe=b.depthModeForSublayer(Ue.overscaledZ-re,L.paint.get("raster-opacity")===1?zn.ReadWrite:zn.ReadOnly,j.LESS),De=T.getTile(Ue);De.registerFadeDuration(L.paint.get("raster-fade-duration"));const qe=T.findLoadedParent(Ue,0),He=Jm(De,qe,T,L,b.transform,b.style.map.terrain);let $e,it;const tt=L.paint.get("raster-resampling")==="nearest"?j.NEAREST:j.LINEAR;z.activeTexture.set(j.TEXTURE0),De.texture.bind(tt,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST),z.activeTexture.set(j.TEXTURE1),qe?(qe.texture.bind(tt,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST),$e=Math.pow(2,qe.tileID.overscaledZ-De.tileID.overscaledZ),it=[De.tileID.canonical.x*$e%1,De.tileID.canonical.y*$e%1]):De.texture.bind(tt,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST);const ct=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Ue),dt=ct?Ue:null,gn=dt?dt.posMatrix:b.transform.calculatePosMatrix(Ue.toUnwrapped(),Ie),_t=Lh(gn,it||[0,0],$e||1,He,L);q instanceof hn?$.draw(z,j.TRIANGLES,xe,br.disabled,he,ur.disabled,_t,ct,L.id,q.boundsBuffer,b.quadTriangleIndexBuffer,q.boundsSegments):$.draw(z,j.TRIANGLES,xe,ce[Ue.overscaledZ],he,ur.disabled,_t,ct,L.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}})(a,f,m,g);break;case"background":(function(b,T,L,k){const z=L.paint.get("background-color"),j=L.paint.get("background-opacity");if(j===0)return;const q=b.context,$=q.gl,he=b.transform,ce=he.tileSize,ye=L.paint.get("background-pattern");if(b.isPatternMissing(ye))return;const re=!ye&&z.a===1&&j===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==re)return;const Ie=br.disabled,Ue=b.depthModeForSublayer(0,re==="opaque"?zn.ReadWrite:zn.ReadOnly),xe=b.colorModeForRenderPass(),De=b.useProgram(ye?"backgroundPattern":"background"),qe=k||he.coveringTiles({tileSize:ce,terrain:b.style.map.terrain});ye&&(q.activeTexture.set($.TEXTURE0),b.imageManager.bind(b.context));const He=L.getCrossfadeParameters();for(const $e of qe){const it=k?$e.posMatrix:b.transform.calculatePosMatrix($e.toUnwrapped()),tt=ye?ky(it,j,b,ye,{tileID:$e,tileSize:ce},He):My(it,j,z),ct=b.style.map.terrain&&b.style.map.terrain.getTerrainData($e);De.draw(q,$.TRIANGLES,Ue,Ie,xe,ur.disabled,tt,ct,L.id,b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}})(a,0,m,g);break;case"custom":(function(b,T,L){const k=b.context,z=L.implementation;if(b.renderPass==="offscreen"){const j=z.prerender;j&&(b.setCustomLayerDefaults(),k.setColorMode(b.colorModeForRenderPass()),j.call(z,k.gl,b.transform.customLayerMatrix()),k.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),k.setColorMode(b.colorModeForRenderPass()),k.setStencilMode(br.disabled);const j=z.renderingMode==="3d"?new zn(b.context.gl.LEQUAL,zn.ReadWrite,b.depthRangeFor3D):b.depthModeForSublayer(0,zn.ReadOnly);k.setDepthMode(j),z.render(k.gl,b.transform.customLayerMatrix()),k.setDirty(),b.setBaseState(),k.bindFramebuffer.set(null)}})(a,0,m)}}translatePosMatrix(a,f,m,g,b){if(!m[0]&&!m[1])return a;const T=b?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(T){const z=Math.sin(T),j=Math.cos(T);m=[m[0]*j-m[1]*z,m[0]*z+m[1]*j]}const L=[b?m[0]:un(f,m[0],this.transform.zoom),b?m[1]:un(f,m[1],this.transform.zoom),0],k=new Float32Array(16);return l.H(k,a,L),k}saveTileTexture(a){const f=this._tileTextures[a.size[0]];f?f.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const f=this._tileTextures[a];return f&&f.length>0?f.pop():null}isPatternMissing(a){if(!a)return!1;if(!a.from||!a.to)return!0;const f=this.imageManager.getPattern(a.from.toString()),m=this.imageManager.getPattern(a.to.toString());return!f||!m}useProgram(a,f){this.cache=this.cache||{};const m=a+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[m]||(this.cache[m]=new ul(this.context,wc[a],f,Um[a],this._showOverdrawInspector,this.style.map.terrain)),this.cache[m]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new K(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:a,drawingBufferHeight:f}=this.context.gl;return this.width!==a||this.height!==f}}class hl{constructor(a,f){this.points=a,this.planes=f}static fromInvProjectionMatrix(a,f,m){const g=Math.pow(2,m),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(L=>{const k=1/(L=l.af([],L,a))[3]/f*g;return l.a$(L,L,[k,k,1/L[3],k])}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(L=>{const k=function($,he){var ce=he[0],ye=he[1],re=he[2],Ie=ce*ce+ye*ye+re*re;return Ie>0&&(Ie=1/Math.sqrt(Ie)),$[0]=he[0]*Ie,$[1]=he[1]*Ie,$[2]=he[2]*Ie,$}([],function($,he,ce){var ye=he[0],re=he[1],Ie=he[2],Ue=ce[0],xe=ce[1],De=ce[2];return $[0]=re*De-Ie*xe,$[1]=Ie*Ue-ye*De,$[2]=ye*xe-re*Ue,$}([],se([],b[L[0]],b[L[1]]),se([],b[L[2]],b[L[1]]))),z=-((j=k)[0]*(q=b[L[1]])[0]+j[1]*q[1]+j[2]*q[2]);var j,q;return k.concat(z)});return new hl(b,T)}}class fl{constructor(a,f){this.min=a,this.max=f,this.center=function(m,g,b){return m[0]=.5*g[0],m[1]=.5*g[1],m[2]=.5*g[2],m}([],function(m,g,b){return m[0]=g[0]+b[0],m[1]=g[1]+b[1],m[2]=g[2]+b[2],m}([],this.min,this.max))}quadrant(a){const f=[a%2==0,a<2],m=ue(this.min),g=ue(this.max);for(let b=0;b<f.length;b++)m[b]=f[b]?this.min[b]:this.center[b],g[b]=f[b]?this.center[b]:this.max[b];return g[2]=this.max[2],new fl(m,g)}distanceX(a){return Math.max(Math.min(this.max[0],a[0]),this.min[0])-a[0]}distanceY(a){return Math.max(Math.min(this.max[1],a[1]),this.min[1])-a[1]}intersects(a){const f=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let m=!0;for(let g=0;g<a.planes.length;g++){const b=a.planes[g];let T=0;for(let L=0;L<f.length;L++)l.b0(b,f[L])>=0&&T++;if(T===0)return 0;T!==f.length&&(m=!1)}if(m)return 2;for(let g=0;g<3;g++){let b=Number.MAX_VALUE,T=-Number.MAX_VALUE;for(let L=0;L<a.points.length;L++){const k=a.points[L][g]-this.min[g];b=Math.min(b,k),T=Math.max(T,k)}if(T<0||b>this.max[g]-this.min[g])return 0}return 1}}class Au{constructor(a=0,f=0,m=0,g=0){if(isNaN(a)||a<0||isNaN(f)||f<0||isNaN(m)||m<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=f,this.left=m,this.right=g}interpolate(a,f,m){return f.top!=null&&a.top!=null&&(this.top=l.z.number(a.top,f.top,m)),f.bottom!=null&&a.bottom!=null&&(this.bottom=l.z.number(a.bottom,f.bottom,m)),f.left!=null&&a.left!=null&&(this.left=l.z.number(a.left,f.left,m)),f.right!=null&&a.right!=null&&(this.right=l.z.number(a.right,f.right,m)),this}getCenter(a,f){const m=l.ac((this.left+a-this.right)/2,0,a),g=l.ac((this.top+f-this.bottom)/2,0,f);return new l.P(m,g)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new Au(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Bp=85.051129;class Wh{constructor(a,f,m,g,b){this.tileSize=512,this._renderWorldCopies=b===void 0||!!b,this._minZoom=a||0,this._maxZoom=f||22,this._minPitch=m??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Au,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const a=new Wh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return a.apply(this),a}apply(a){this.tileSize=a.tileSize,this.latRange=a.latRange,this.width=a.width,this.height=a.height,this._center=a._center,this._elevation=a._elevation,this.minElevationForCurrentTile=a.minElevationForCurrentTile,this.zoom=a.zoom,this.angle=a.angle,this._fov=a._fov,this._pitch=a._pitch,this._unmodified=a._unmodified,this._edgeInsets=a._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(a){const f=-l.b1(a,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=function(){var m=new l.A(4);return l.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}(),function(m,g,b){var T=g[0],L=g[1],k=g[2],z=g[3],j=Math.sin(b),q=Math.cos(b);m[0]=T*q+k*j,m[1]=L*q+z*j,m[2]=T*-j+k*q,m[3]=L*-j+z*q}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const f=l.ac(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=a/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(a){const f=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.tileZoom=Math.max(0,Math.floor(f)),this.scale=this.zoomScale(f),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(a){a!==this._elevation&&(this._elevation=a,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,f,m){this._unmodified=!1,this._edgeInsets.interpolate(a,f,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const f=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(a){const f=[new l.b2(0,a)];if(this._renderWorldCopies){const m=this.pointCoordinate(new l.P(0,0)),g=this.pointCoordinate(new l.P(this.width,0)),b=this.pointCoordinate(new l.P(this.width,this.height)),T=this.pointCoordinate(new l.P(0,this.height)),L=Math.floor(Math.min(m.x,g.x,b.x,T.x)),k=Math.floor(Math.max(m.x,g.x,b.x,T.x)),z=1;for(let j=L-z;j<=k+z;j++)j!==0&&f.push(new l.b2(j,a))}return f}coveringTiles(a){var f,m;let g=this.coveringZoomLevel(a);const b=g;if(a.minzoom!==void 0&&g<a.minzoom)return[];a.maxzoom!==void 0&&g>a.maxzoom&&(g=a.maxzoom);const T=this.pointCoordinate(this.getCameraPoint()),L=l.Y.fromLngLat(this.center),k=Math.pow(2,g),z=[k*T.x,k*T.y,0],j=[k*L.x,k*L.y,0],q=hl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g);let $=a.minzoom||0;!a.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&($=g);const he=a.terrain?2/Math.min(this.tileSize,a.tileSize)*this.tileSize:3,ce=xe=>({aabb:new fl([xe*k,0,0],[(xe+1)*k,k,0]),zoom:0,x:0,y:0,wrap:xe,fullyVisible:!1}),ye=[],re=[],Ie=g,Ue=a.reparseOverscaled?b:g;if(this._renderWorldCopies)for(let xe=1;xe<=3;xe++)ye.push(ce(-xe)),ye.push(ce(xe));for(ye.push(ce(0));ye.length>0;){const xe=ye.pop(),De=xe.x,qe=xe.y;let He=xe.fullyVisible;if(!He){const dt=xe.aabb.intersects(q);if(dt===0)continue;He=dt===2}const $e=a.terrain?z:j,it=xe.aabb.distanceX($e),tt=xe.aabb.distanceY($e),ct=Math.max(Math.abs(it),Math.abs(tt));if(xe.zoom===Ie||ct>he+(1<<Ie-xe.zoom)-2&&xe.zoom>=$){const dt=Ie-xe.zoom,gn=z[0]-.5-(De<<dt),_t=z[1]-.5-(qe<<dt);re.push({tileID:new l.Q(xe.zoom===Ie?Ue:xe.zoom,xe.wrap,xe.zoom,De,qe),distanceSq:fe([j[0]-.5-De,j[1]-.5-qe]),tileDistanceToCamera:Math.sqrt(gn*gn+_t*_t)})}else for(let dt=0;dt<4;dt++){const gn=(De<<1)+dt%2,_t=(qe<<1)+(dt>>1),en=xe.zoom+1;let _n=xe.aabb.quadrant(dt);if(a.terrain){const Fn=new l.Q(en,xe.wrap,en,gn,_t),on=a.terrain.getMinMaxElevation(Fn),bn=(f=on.minElevation)!==null&&f!==void 0?f:this.elevation,Cn=(m=on.maxElevation)!==null&&m!==void 0?m:this.elevation;_n=new fl([_n.min[0],_n.min[1],bn],[_n.max[0],_n.max[1],Cn])}ye.push({aabb:_n,zoom:en,x:gn,y:_t,wrap:xe.wrap,fullyVisible:He})}}return re.sort((xe,De)=>xe.distanceSq-De.distanceSq).map(xe=>xe.tileID)}resize(a,f){this.width=a,this.height=f,this.pixelsToGLUnits=[2/a,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const f=l.ac(a.lat,-85.051129,Bp);return new l.P(l.N(a.lng)*this.worldSize,l.O(f)*this.worldSize)}unproject(a){return new l.Y(a.x/this.worldSize,a.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(a){const f=this.elevation,m=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,g=this.pointLocation(this.centerPoint,a),b=a.getElevationForLngLatZoom(g,this.tileZoom);if(!(this.elevation-b))return;const T=m+f-b,L=Math.cos(this._pitch)*this.cameraToCenterDistance/T/l.b3(1,g.lat),k=this.scaleZoom(L/this.tileSize);this._elevation=b,this._center=g,this.zoom=k}setLocationAtPoint(a,f){const m=this.pointCoordinate(f),g=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(a),T=new l.Y(b.x-(m.x-g.x),b.y-(m.y-g.y));this.center=this.coordinateLocation(T),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(a,f){return f?this.coordinatePoint(this.locationCoordinate(a),f.getElevationForLngLatZoom(a,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(a))}pointLocation(a,f){return this.coordinateLocation(this.pointCoordinate(a,f))}locationCoordinate(a){return l.Y.fromLngLat(a)}coordinateLocation(a){return a&&a.toLngLat()}pointCoordinate(a,f){if(f){const $=f.pointCoordinate(a);if($!=null)return $}const m=[a.x,a.y,0,1],g=[a.x,a.y,1,1];l.af(m,m,this.pixelMatrixInverse),l.af(g,g,this.pixelMatrixInverse);const b=m[3],T=g[3],L=m[1]/b,k=g[1]/T,z=m[2]/b,j=g[2]/T,q=z===j?0:(0-z)/(j-z);return new l.Y(l.z.number(m[0]/b,g[0]/T,q)/this.worldSize,l.z.number(L,k,q)/this.worldSize)}coordinatePoint(a,f=0,m=this.pixelMatrix){const g=[a.x*this.worldSize,a.y*this.worldSize,f,1];return l.af(g,g,m),new l.P(g[0]/g[3],g[1]/g[3])}getBounds(){const a=Math.max(0,this.height/2-this.getHorizon());return new rt().extend(this.pointLocation(new l.P(0,a))).extend(this.pointLocation(new l.P(this.width,a))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new rt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(a){a?(this.lngRange=[a.getWest(),a.getEast()],this.latRange=[a.getSouth(),a.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Bp])}calculatePosMatrix(a,f=!1){const m=a.key,g=f?this._alignedPosMatrixCache:this._posMatrixCache;if(g[m])return g[m];const b=a.canonical,T=this.worldSize/this.zoomScale(b.z),L=b.x+Math.pow(2,b.z)*a.wrap,k=l.an(new Float64Array(16));return l.H(k,k,[L*T,b.y*T,0]),l.J(k,k,[T/l.W,T/l.W,1]),l.K(k,f?this.alignedProjMatrix:this.projMatrix,k),g[m]=new Float32Array(k),g[m]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(a,f){f=l.ac(+f,this.minZoom,this.maxZoom);const m={center:new l.M(a.lng,a.lat),zoom:f};let g=this.lngRange;if(!this._renderWorldCopies&&g===null){const xe=179.9999999999;g=[-xe,xe]}const b=this.tileSize*this.zoomScale(m.zoom);let T=0,L=b,k=0,z=b,j=0,q=0;const{x:$,y:he}=this.size;if(this.latRange){const xe=this.latRange;T=l.O(xe[1])*b,L=l.O(xe[0])*b,L-T<he&&(j=he/(L-T))}g&&(k=l.b1(l.N(g[0])*b,0,b),z=l.b1(l.N(g[1])*b,0,b),z<k&&(z+=b),z-k<$&&(q=$/(z-k)));const{x:ce,y:ye}=this.project.call({worldSize:b},a);let re,Ie;const Ue=Math.max(q||0,j||0);if(Ue){const xe=new l.P(q?(z+k)/2:ce,j?(L+T)/2:ye);return m.center=this.unproject.call({worldSize:b},xe).wrap(),m.zoom+=this.scaleZoom(Ue),m}if(this.latRange){const xe=he/2;ye-xe<T&&(Ie=T+xe),ye+xe>L&&(Ie=L-xe)}if(g){const xe=(k+z)/2;let De=ce;this._renderWorldCopies&&(De=l.b1(ce,xe-b/2,xe+b/2));const qe=$/2;De-qe<k&&(re=k+qe),De+qe>z&&(re=z-qe)}if(re!==void 0||Ie!==void 0){const xe=new l.P(re??ce,Ie??ye);m.center=this.unproject.call({worldSize:b},xe).wrap()}return m}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a=this._unmodified,{center:f,zoom:m}=this.getConstrained(this.center,this.zoom);this.center=f,this.zoom=m,this._unmodified=a,this._constraining=!1}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,f=this.point.x,m=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b3(1,this.center.lat)*this.worldSize;let g=l.an(new Float64Array(16));l.J(g,g,[this.width/2,-this.height/2,1]),l.H(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=l.an(new Float64Array(16)),l.J(g,g,[1,-1,1]),l.H(g,g,[-1,-1,0]),l.J(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g;const b=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),T=Math.min(this.elevation,this.minElevationForCurrentTile),L=b-T*this._pixelPerMeter/Math.cos(this._pitch),k=T<0?L:b,z=Math.PI/2+this._pitch,j=this._fov*(.5+a.y/this.height),q=Math.sin(j)*k/Math.sin(l.ac(Math.PI-z-j,.01,Math.PI-.01)),$=this.getHorizon(),he=2*Math.atan($/this.cameraToCenterDistance)*(.5+a.y/(2*$)),ce=Math.sin(he)*k/Math.sin(l.ac(Math.PI-z-he,.01,Math.PI-.01)),ye=Math.min(q,ce),re=1.01*(Math.cos(Math.PI/2-this._pitch)*ye+k),Ie=this.height/50;g=new Float64Array(16),l.b4(g,this._fov,this.width/this.height,Ie,re),g[8]=2*-a.x/this.width,g[9]=2*a.y/this.height,l.J(g,g,[1,-1,1]),l.H(g,g,[0,0,-this.cameraToCenterDistance]),l.b5(g,g,this._pitch),l.ad(g,g,this.angle),l.H(g,g,[-f,-m,0]),this.mercatorMatrix=l.J([],g,[this.worldSize,this.worldSize,this.worldSize]),l.J(g,g,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.K(new Float64Array(16),this.labelPlaneMatrix,g),l.H(g,g,[0,0,-this.elevation]),this.projMatrix=g,this.invProjMatrix=l.ar([],g),this.pixelMatrix3D=l.K(new Float64Array(16),this.labelPlaneMatrix,g);const Ue=this.width%2/2,xe=this.height%2/2,De=Math.cos(this.angle),qe=Math.sin(this.angle),He=f-Math.round(f)+De*Ue+qe*xe,$e=m-Math.round(m)+De*xe+qe*Ue,it=new Float64Array(g);if(l.H(it,it,[He>.5?He-1:He,$e>.5?$e-1:$e,0]),this.alignedProjMatrix=it,g=l.ar(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");this.pixelMatrixInverse=g,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const a=this.pointCoordinate(new l.P(0,0)),f=[a.x*this.worldSize,a.y*this.worldSize,0,1];return l.af(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,a))}getCameraQueryGeometry(a){const f=this.getCameraPoint();if(a.length===1)return[a[0],f];{let m=f.x,g=f.y,b=f.x,T=f.y;for(const L of a)m=Math.min(m,L.x),g=Math.min(g,L.y),b=Math.max(b,L.x),T=Math.max(T,L.y);return[new l.P(m,g),new l.P(b,g),new l.P(b,T),new l.P(m,T),new l.P(m,g)]}}lngLatToCameraDepth(a,f){const m=this.locationCoordinate(a),g=[m.x*this.worldSize,m.y*this.worldSize,f,1];return l.af(g,g,this.projMatrix),g[2]/g[3]}}function Vp(v,a){let f,m=!1,g=null,b=null;const T=()=>{g=null,m&&(v.apply(b,f),g=setTimeout(T,a),m=!1)};return(...L)=>(m=!0,b=this,f=L,g||T(),g)}class Up{constructor(a){this._getCurrentHash=()=>{const f=window.location.hash.replace("#","");if(this._hashName){let m;return f.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(m=g)}),(m&&m[1]||"").split("/")}return f.split("/")},this._onHashChange=()=>{const f=this._getCurrentHash();if(f.length>=3&&!f.some(m=>isNaN(m))){const m=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:m,pitch:+(f[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const f=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,f)}catch{}},this._updateHash=Vp(this._updateHashUnthrottled,300),this._hashName=a&&encodeURIComponent(a)}addTo(a){return this._map=a,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(a){const f=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,g=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,g),T=Math.round(f.lng*b)/b,L=Math.round(f.lat*b)/b,k=this._map.getBearing(),z=this._map.getPitch();let j="";if(j+=a?`/${T}/${L}/${m}`:`${m}/${L}/${T}`,(k||z)&&(j+="/"+Math.round(10*k)/10),z&&(j+=`/${Math.round(z)}`),this._hashName){const q=this._hashName;let $=!1;const he=window.location.hash.slice(1).split("&").map(ce=>{const ye=ce.split("=")[0];return ye===q?($=!0,`${ye}=${j}`):ce}).filter(ce=>ce);return $||he.push(`${q}=${j}`),`#${he.join("&")}`}return`#${j}`}}const Mc={linearity:.3,easing:l.b6(0,0,.3,1)},Xl=l.e({deceleration:2500,maxSpeed:1400},Mc),ng=l.e({deceleration:20,maxSpeed:1400},Mc),rg=l.e({deceleration:1e3,maxSpeed:360},Mc),ig=l.e({deceleration:1e3,maxSpeed:90},Mc);class og{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:E.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,f=E.now();for(;a.length>0&&f-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const f={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)f.zoom+=b.zoomDelta||0,f.bearing+=b.bearingDelta||0,f.pitch+=b.pitchDelta||0,b.panDelta&&f.pan._add(b.panDelta),b.around&&(f.around=b.around),b.pinchAround&&(f.pinchAround=b.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(f.pan.mag()){const b=Ac(f.pan.mag(),m,l.e({},Xl,a||{}));g.offset=f.pan.mult(b.amount/f.pan.mag()),g.center=this._map.transform.center,kc(g,b)}if(f.zoom){const b=Ac(f.zoom,m,ng);g.zoom=this._map.transform.zoom+b.amount,kc(g,b)}if(f.bearing){const b=Ac(f.bearing,m,rg);g.bearing=this._map.transform.bearing+l.ac(b.amount,-179,179),kc(g,b)}if(f.pitch){const b=Ac(f.pitch,m,ig);g.pitch=this._map.transform.pitch+b.amount,kc(g,b)}if(g.zoom||g.bearing){const b=f.pinchAround===void 0?f.around:f.pinchAround;g.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),l.e(g,{noMoveStart:!0})}}function kc(v,a){(!v.duration||v.duration<a.duration)&&(v.duration=a.duration,v.easing=a.easing)}function Ac(v,a,f){const{maxSpeed:m,linearity:g,deceleration:b}=f,T=l.ac(v*g/(a/1e3),-m,m),L=Math.abs(T)/(b*g);return{easing:f.easing,duration:1e3*L,amount:T*(L/2)}}class Po extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,m,g={}){const b=C.mousePos(f.getCanvas(),m),T=f.unproject(b);super(a,l.e({point:b,lngLat:T,originalEvent:m},g)),this._defaultPrevented=!1,this.target=f}}class ta extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,m){const g=a==="touchend"?m.changedTouches:m.touches,b=C.touchPos(f.getCanvasContainer(),g),T=b.map(k=>f.unproject(k)),L=b.reduce((k,z,j,q)=>k.add(z.div(q.length)),new l.P(0,0));super(a,{points:b,point:L,lngLats:T,lngLat:f.unproject(L),originalEvent:m}),this._defaultPrevented=!1}}class jp extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,m){super(a,{originalEvent:m}),this._defaultPrevented=!1}}class Ms{constructor(a,f){this._map=a,this._clickTolerance=f.clickTolerance}reset(){delete this._mousedownPos}wheel(a){return this._firePreventable(new jp(a.type,this._map,a))}mousedown(a,f){return this._mousedownPos=f,this._firePreventable(new Po(a.type,this._map,a))}mouseup(a){this._map.fire(new Po(a.type,this._map,a))}click(a,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new Po(a.type,this._map,a))}dblclick(a){return this._firePreventable(new Po(a.type,this._map,a))}mouseover(a){this._map.fire(new Po(a.type,this._map,a))}mouseout(a){this._map.fire(new Po(a.type,this._map,a))}touchstart(a){return this._firePreventable(new ta(a.type,this._map,a))}touchmove(a){this._map.fire(new ta(a.type,this._map,a))}touchend(a){this._map.fire(new ta(a.type,this._map,a))}touchcancel(a){this._map.fire(new ta(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class na{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(a){this._map.fire(new Po(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Po("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._ignoreContextMenu||this._map.fire(new Po(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Du{constructor(a){this._map=a}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(a){return this.transform.pointLocation(l.P.convert(a),this._map.terrain)}}class ks{constructor(a,f){this._map=a,this._tr=new Du(a),this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,f){this.isEnabled()&&a.shiftKey&&a.button===0&&(C.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(a,f){if(!this._active)return;const m=f;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=m,this._box||(this._box=C.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",a));const b=Math.min(g.x,m.x),T=Math.max(g.x,m.x),L=Math.min(g.y,m.y),k=Math.max(g.y,m.y);C.setTransform(this._box,`translate(${b}px,${L}px)`),this._box.style.width=T-b+"px",this._box.style.height=k-L+"px"}mouseupWindow(a,f){if(!this._active||a.button!==0)return;const m=this._startPos,g=f;if(this.reset(),C.suppressClick(),m.x!==g.x||m.y!==g.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:a})),{cameraAnimation:b=>b.fitScreenCoordinates(m,g,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",a)}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(C.remove(this._box),this._box=null),C.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(a,f){return this._map.fire(new l.k(a,{originalEvent:f}))}}function Yl(v,a){if(v.length!==a.length)throw new Error(`The number of touches and points are not equal - touches ${v.length}, points ${a.length}`);const f={};for(let m=0;m<v.length;m++)f[v[m].identifier]=a[m];return f}class jy{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(a,f,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=a.timeStamp),m.length===this.numTouches&&(this.centroid=function(g){const b=new l.P(0,0);for(const T of g)b._add(T);return b.div(g.length)}(f),this.touches=Yl(m,f)))}touchmove(a,f,m){if(this.aborted||!this.centroid)return;const g=Yl(m,f);for(const b in this.touches){const T=g[b];(!T||T.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(a,f,m){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Gp{constructor(a){this.singleTap=new jy(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(a,f,m){this.singleTap.touchstart(a,f,m)}touchmove(a,f,m){this.singleTap.touchmove(a,f,m)}touchend(a,f,m){const g=this.singleTap.touchend(a,f,m);if(g){const b=a.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(g)<30;if(b&&T||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Gy{constructor(a){this._tr=new Du(a),this._zoomIn=new Gp({numTouches:1,numTaps:2}),this._zoomOut=new Gp({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,f,m){this._zoomIn.touchstart(a,f,m),this._zoomOut.touchstart(a,f,m)}touchmove(a,f,m){this._zoomIn.touchmove(a,f,m),this._zoomOut.touchmove(a,f,m)}touchend(a,f,m){const g=this._zoomIn.touchend(a,f,m),b=this._zoomOut.touchend(a,f,m),T=this._tr;return g?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:L=>L.easeTo({duration:300,zoom:T.zoom+1,around:T.unproject(g)},{originalEvent:a})}):b?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:L=>L.easeTo({duration:300,zoom:T.zoom-1,around:T.unproject(b)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ru{constructor(a){this._enabled=!!a.enable,this._moveStateManager=a.moveStateManager,this._clickTolerance=a.clickTolerance||1,this._moveFunction=a.move,this._activateOnStart=!!a.activateOnStart,a.assignEvents(this),this.reset()}reset(a){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(a)}_move(...a){const f=this._moveFunction(...a);if(f.bearingDelta||f.pitchDelta||f.around||f.panDelta)return this._active=!0,f}dragStart(a,f){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(a)&&(this._moveStateManager.startMove(a),this._lastPoint=f.length?f[0]:f,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(a,f){if(!this.isEnabled())return;const m=this._lastPoint;if(!m)return;if(a.preventDefault(),!this._moveStateManager.isValidMoveEvent(a))return void this.reset(a);const g=f.length?f[0]:f;return!this._moved&&g.dist(m)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=g,this._move(m,g))}dragEnd(a){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(a)&&(this._moved&&C.suppressClick(),this.reset(a))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Dc={0:1,2:2};class ra{constructor(a){this._correctEvent=a.checkCorrectEvent}startMove(a){const f=C.mouseButton(a);this._eventButton=f}endMove(a){delete this._eventButton}isValidStartEvent(a){return this._correctEvent(a)}isValidMoveEvent(a){return!function(f,m){const g=Dc[m];return f.buttons===void 0||(f.buttons&g)!==g}(a,this._eventButton)}isValidEndEvent(a){return C.mouseButton(a)===this._eventButton}}class Pt{constructor(){this._firstTouch=void 0}_isOneFingerTouch(a){return a.targetTouches.length===1}_isSameTouchEvent(a){return a.targetTouches[0].identifier===this._firstTouch}startMove(a){this._firstTouch=a.targetTouches[0].identifier}endMove(a){delete this._firstTouch}isValidStartEvent(a){return this._isOneFingerTouch(a)}isValidMoveEvent(a){return this._isOneFingerTouch(a)&&this._isSameTouchEvent(a)}isValidEndEvent(a){return this._isOneFingerTouch(a)&&this._isSameTouchEvent(a)}}const Hh=v=>{v.mousedown=v.dragStart,v.mousemoveWindow=v.dragMove,v.mouseup=v.dragEnd,v.contextmenu=function(a){a.preventDefault()}},Nu=({enable:v,clickTolerance:a,bearingDegreesPerPixelMoved:f=.8})=>{const m=new ra({checkCorrectEvent:g=>C.mouseButton(g)===0&&g.ctrlKey||C.mouseButton(g)===2});return new Ru({clickTolerance:a,move:(g,b)=>({bearingDelta:(b.x-g.x)*f}),moveStateManager:m,enable:v,assignEvents:Hh})},Ou=({enable:v,clickTolerance:a,pitchDegreesPerPixelMoved:f=-.5})=>{const m=new ra({checkCorrectEvent:g=>C.mouseButton(g)===0&&g.ctrlKey||C.mouseButton(g)===2});return new Ru({clickTolerance:a,move:(g,b)=>({pitchDelta:(b.y-g.y)*f}),moveStateManager:m,enable:v,assignEvents:Hh})};class sg{constructor(a,f){this._clickTolerance=a.clickTolerance||1,this._map=f,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(a,f,m){return this._calculateTransform(a,f,m)}touchmove(a,f,m){if(this._active&&!(m.length<this.minTouchs()))return a.preventDefault(),this._calculateTransform(a,f,m)}touchend(a,f,m){this._calculateTransform(a,f,m),this._active&&m.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,f,m){m.length>0&&(this._active=!0);const g=Yl(m,f),b=new l.P(0,0),T=new l.P(0,0);let L=0;for(const z in g){const j=g[z],q=this._touches[z];q&&(b._add(j),T._add(j.sub(q)),L++,g[z]=j)}if(this._touches=g,L<this.minTouchs()||!T.mag())return;const k=T.div(L);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(L),panDelta:k}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Et{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(a,f,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([f[0],f[1]]))}touchmove(a,f,m){if(!this._firstTwoTouches)return;a.preventDefault();const[g,b]=this._firstTwoTouches,T=zu(m,f,g),L=zu(m,f,b);if(!T||!L)return;const k=this._aroundCenter?null:T.add(L).div(2);return this._move([T,L],k,a)}touchend(a,f,m){if(!this._firstTwoTouches)return;const[g,b]=this._firstTwoTouches,T=zu(m,f,g),L=zu(m,f,b);T&&L||(this._active&&C.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function zu(v,a,f){for(let m=0;m<v.length;m++)if(v[m].identifier===f)return a[m]}function ag(v,a){return Math.log(v/a)/Math.LN2}class lg extends Et{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,f){const m=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(ag(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ag(this._distance,m),pinchAround:f}}}function Zh(v,a){return 180*v.angleWith(a)/Math.PI}class qp extends Et{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,f,m){const g=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Zh(this._vector,g),pinchAround:f}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const f=25/(Math.PI*this._minDiameter)*360,m=Zh(a,this._startVector);return Math.abs(m)<f}}function Xh(v){return Math.abs(v.y)>Math.abs(v.x)}class ug extends Et{constructor(a){super(),this._currentTouchCount=0,this._map=a}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(a,f,m){super.touchstart(a,f,m),this._currentTouchCount=m.length}_start(a){this._lastPoints=a,Xh(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,f,m){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const g=a[0].sub(this._lastPoints[0]),b=a[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,b,m.timeStamp),this._valid?(this._lastPoints=a,this._active=!0,{pitchDelta:(g.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(a,f,m){if(this._valid!==void 0)return this._valid;const g=a.mag()>=2,b=f.mag()>=2;if(!g&&!b)return;if(!g||!b)return this._firstMove===void 0&&(this._firstMove=m),m-this._firstMove<100&&void 0;const T=a.y>0==f.y>0;return Xh(a)&&Xh(f)&&T}}const qy={panStep:100,bearingStep:15,pitchStep:10};class pl{constructor(a){this._tr=new Du(a);const f=qy;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let f=0,m=0,g=0,b=0,T=0;switch(a.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:a.shiftKey?m=-1:(a.preventDefault(),b=-1);break;case 39:a.shiftKey?m=1:(a.preventDefault(),b=1);break;case 38:a.shiftKey?g=1:(a.preventDefault(),T=-1);break;case 40:a.shiftKey?g=-1:(a.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(m=0,g=0),{cameraAnimation:L=>{const k=this._tr;L.easeTo({duration:300,easeId:"keyboardHandler",easing:Er,zoom:f?Math.round(k.zoom)+f*(a.shiftKey?2:1):k.zoom,bearing:k.bearing+m*this._bearingStep,pitch:k.pitch+g*this._pitchStep,offset:[-b*this._panStep,-T*this._panStep],center:k.center},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Er(v){return v*(2-v)}const Rc=4.000244140625;class Yh{constructor(a,f){this._onTimeout=m=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(m)},this._map=a,this._tr=new Du(a),this._triggerRenderFrame=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(a){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!a[this._map.cooperativeGestures._bypassKey])return;let f=a.deltaMode===WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const m=E.now(),g=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,f!==0&&f%Rc==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(g*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),a.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=a,this._delta-=f,this._active||this._start(a)),a.preventDefault()}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=C.mousePos(this._map.getCanvas(),a),m=this._tr;this._around=f.y>m.transform.height/2-m.transform.getHorizon()?l.M.convert(this._aroundCenter?m.center:m.unproject(f)):l.M.convert(m.center),this._aroundPoint=m.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._tr.transform;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>Rc?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&k!==0&&(k=1/k);const z=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):a.scale;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(z*k))),this._type==="wheel"&&(this._startZoom=a.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:a.zoom,m=this._startZoom,g=this._easing;let b,T=!1;if(this._type==="wheel"&&m&&g){const L=Math.min((E.now()-this._lastWheelEventTime)/200,1),k=g(L);b=l.z.number(m,f,k),L<1?this._frameId||(this._frameId=!0):T=!0}else b=f,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!T,zoomDelta:b-a.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let f=l.b7;if(this._prevEase){const m=this._prevEase,g=(E.now()-m.start)/m.duration,b=m.easing(g+.01)-m.easing(g),T=.27/Math.sqrt(b*b+1e-4)*.01,L=Math.sqrt(.0729-T*T);f=l.b6(T,L,.25,1)}return this._prevEase={start:E.now(),duration:a,easing:f},f}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Wp{constructor(a,f){this._clickZoom=a,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class cg{constructor(a){this._tr=new Du(a),this.reset()}reset(){this._active=!1}dblclick(a,f){return a.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:this._tr.zoom+(a.shiftKey?-1:1),around:this._tr.unproject(f)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hg{constructor(){this._tap=new Gp({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(a,f,m){if(!this._swipePoint)if(this._tapTime){const g=f[0],b=a.timeStamp-this._tapTime<500,T=this._tapPoint.dist(g)<30;b&&T?m.length>0&&(this._swipePoint=g,this._swipeTouch=m[0].identifier):this.reset()}else this._tap.touchstart(a,f,m)}touchmove(a,f,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const g=f[0],b=g.y-this._swipePoint.y;return this._swipePoint=g,a.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(a,f,m)}touchend(a,f,m){if(this._tapTime)this._swipePoint&&m.length===0&&this.reset();else{const g=this._tap.touchend(a,f,m);g&&(this._tapTime=a.timeStamp,this._tapPoint=g)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fg{constructor(a,f,m){this._el=a,this._mousePan=f,this._touchPan=m}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class As{constructor(a,f,m){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=f,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Nc{constructor(a,f,m,g){this._el=a,this._touchZoom=f,this._touchRotate=m,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class jt{constructor(a,f){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=a,this._options=f,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const a=this._map.getCanvasContainer();a.classList.add("maplibregl-cooperative-gestures"),this._container=C.create("div","maplibregl-cooperative-gesture-screen",a);let f=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(f=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const m=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),g=document.createElement("div");g.className="maplibregl-desktop-message",g.textContent=f,this._container.appendChild(g);const b=document.createElement("div");b.className="maplibregl-mobile-message",b.textContent=m,this._container.appendChild(b),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(C.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(a){this._onCooperativeGesture(a.touches.length===1)}wheel(a){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!a[this._bypassKey])}_onCooperativeGesture(a){this._enabled&&a&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const $t=v=>v.zoom||v.drag||v.pitch||v.rotate;class $h extends l.k{}function Oc(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta}class Hp{constructor(a,f){this.handleWindowEvent=g=>{this.handleEvent(g,`${g.type}Window`)},this.handleEvent=(g,b)=>{if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const T=g.type==="renderFrame"?void 0:g,L={needsRenderFrame:!1},k={},z={},j=g.touches,q=j?this._getMapTouches(j):void 0,$=q?C.touchPos(this._map.getCanvas(),q):C.mousePos(this._map.getCanvas(),g);for(const{handlerName:ye,handler:re,allowed:Ie}of this._handlers){if(!re.isEnabled())continue;let Ue;this._blockedByActive(z,Ie,ye)?re.reset():re[b||g.type]&&(Ue=re[b||g.type](g,$,q),this.mergeHandlerResult(L,k,Ue,ye,T),Ue&&Ue.needsRenderFrame&&this._triggerRenderFrame()),(Ue||re.isActive())&&(z[ye]=re)}const he={};for(const ye in this._previousActiveHandlers)z[ye]||(he[ye]=T);this._previousActiveHandlers=z,(Object.keys(he).length||Oc(L))&&(this._changes.push([L,k,he]),this._triggerRenderFrame()),(Object.keys(z).length||Oc(L))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ce}=L;ce&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ce(this._map))},this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new og(a),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,b,T]of this._listeners)C.addEventListener(g,b,g===document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[a,f,m]of this._listeners)C.removeEventListener(a,f,a===document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(a){const f=this._map,m=f.getCanvasContainer();this._add("mapEvent",new Ms(f,a));const g=f.boxZoom=new ks(f,a);this._add("boxZoom",g),a.interactive&&a.boxZoom&&g.enable();const b=f.cooperativeGestures=new jt(f,a.cooperativeGestures);this._add("cooperativeGestures",b),a.cooperativeGestures&&b.enable();const T=new Gy(f),L=new cg(f);f.doubleClickZoom=new Wp(L,T),this._add("tapZoom",T),this._add("clickZoom",L),a.interactive&&a.doubleClickZoom&&f.doubleClickZoom.enable();const k=new hg;this._add("tapDragZoom",k);const z=f.touchPitch=new ug(f);this._add("touchPitch",z),a.interactive&&a.touchPitch&&f.touchPitch.enable(a.touchPitch);const j=Nu(a),q=Ou(a);f.dragRotate=new As(a,j,q),this._add("mouseRotate",j,["mousePitch"]),this._add("mousePitch",q,["mouseRotate"]),a.interactive&&a.dragRotate&&f.dragRotate.enable();const $=(({enable:Ue,clickTolerance:xe})=>{const De=new ra({checkCorrectEvent:qe=>C.mouseButton(qe)===0&&!qe.ctrlKey});return new Ru({clickTolerance:xe,move:(qe,He)=>({around:He,panDelta:He.sub(qe)}),activateOnStart:!0,moveStateManager:De,enable:Ue,assignEvents:Hh})})(a),he=new sg(a,f);f.dragPan=new fg(m,$,he),this._add("mousePan",$),this._add("touchPan",he,["touchZoom","touchRotate"]),a.interactive&&a.dragPan&&f.dragPan.enable(a.dragPan);const ce=new qp,ye=new lg;f.touchZoomRotate=new Nc(m,ye,ce,k),this._add("touchRotate",ce,["touchPan","touchZoom"]),this._add("touchZoom",ye,["touchPan","touchRotate"]),a.interactive&&a.touchZoomRotate&&f.touchZoomRotate.enable(a.touchZoomRotate);const re=f.scrollZoom=new Yh(f,()=>this._triggerRenderFrame());this._add("scrollZoom",re,["mousePan"]),a.interactive&&a.scrollZoom&&f.scrollZoom.enable(a.scrollZoom);const Ie=f.keyboard=new pl(f);this._add("keyboard",Ie),a.interactive&&a.keyboard&&f.keyboard.enable(),this._add("blockableMapEvent",new na(f))}_add(a,f,m){this._handlers.push({handlerName:a,handler:f,allowed:m}),this._handlersById[a]=f}stop(a){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!$t(this._eventsInProgress)||this.isZooming()}_blockedByActive(a,f,m){for(const g in a)if(g!==m&&(!f||f.indexOf(g)<0))return!0;return!1}_getMapTouches(a){const f=[];for(const m of a)this._el.contains(m.target)&&f.push(m);return f}mergeHandlerResult(a,f,m,g,b){if(!m)return;l.e(a,m);const T={handlerName:g,originalEvent:m.originalEvent||b};m.zoomDelta!==void 0&&(f.zoom=T),m.panDelta!==void 0&&(f.drag=T),m.pitchDelta!==void 0&&(f.pitch=T),m.bearingDelta!==void 0&&(f.rotate=T)}_applyChanges(){const a={},f={},m={};for(const[g,b,T]of this._changes)g.panDelta&&(a.panDelta=(a.panDelta||new l.P(0,0))._add(g.panDelta)),g.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(a.around=g.around),g.pinchAround!==void 0&&(a.pinchAround=g.pinchAround),g.noInertia&&(a.noInertia=g.noInertia),l.e(f,b),l.e(m,T);this._updateMapTransform(a,f,m),this._changes=[]}_updateMapTransform(a,f,m){const g=this._map,b=g._getTransformForUpdate(),T=g.terrain;if(!(Oc(a)||T&&this._terrainMovement))return this._fireEvents(f,m,!0);let{panDelta:L,zoomDelta:k,bearingDelta:z,pitchDelta:j,around:q,pinchAround:$}=a;$!==void 0&&(q=$),g._stop(!0),q=q||g.transform.centerPoint;const he=b.pointLocation(L?q.sub(L):q);z&&(b.bearing+=z),j&&(b.pitch+=j),k&&(b.zoom+=k),T?this._terrainMovement||!f.drag&&!f.zoom?f.drag&&this._terrainMovement?b.center=b.pointLocation(b.centerPoint.sub(L)):b.setLocationAtPoint(he,q):(this._terrainMovement=!0,this._map._elevationFreeze=!0,b.setLocationAtPoint(he,q),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,b.recalculateZoom(g.terrain)})):b.setLocationAtPoint(he,q),g._applyUpdatedTransform(b),this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(f,m,!0)}_fireEvents(a,f,m){const g=$t(this._eventsInProgress),b=$t(a),T={};for(const j in a){const{originalEvent:q}=a[j];this._eventsInProgress[j]||(T[`${j}start`]=q),this._eventsInProgress[j]=a[j]}!g&&b&&this._fireEvent("movestart",b.originalEvent);for(const j in T)this._fireEvent(j,T[j]);b&&this._fireEvent("move",b.originalEvent);for(const j in a){const{originalEvent:q}=a[j];this._fireEvent(j,q)}const L={};let k;for(const j in this._eventsInProgress){const{handlerName:q,originalEvent:$}=this._eventsInProgress[j];this._handlersById[q].isActive()||(delete this._eventsInProgress[j],k=f[q]||$,L[`${j}end`]=k)}for(const j in L)this._fireEvent(j,L[j]);const z=$t(this._eventsInProgress);if(m&&(g||b)&&!z){this._updatingCamera=!0;const j=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;!j||!j.essential&&E.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:k})),q(this._map.getBearing())&&this._map.resetNorth()):(q(j.bearing||this._map.getBearing())&&(j.bearing=0),j.freezeElevation=!0,this._map.easeTo(j,{originalEvent:k})),this._updatingCamera=!1}}_fireEvent(a,f){this._map.fire(new l.k(a,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{delete this._frameId,this.handleEvent(new $h("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Mo extends l.E{constructor(a,f){super(),this._renderFrameCallback=()=>{const m=Math.min((E.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(m)),m<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=f.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.M(this.transform.center.lng,this.transform.center.lat)}setCenter(a,f){return this.jumpTo({center:a},f)}panBy(a,f,m){return a=l.P.convert(a).mult(-1),this.panTo(this.transform.center,l.e({offset:a},f),m)}panTo(a,f,m){return this.easeTo(l.e({center:a},f),m)}getZoom(){return this.transform.zoom}setZoom(a,f){return this.jumpTo({zoom:a},f),this}zoomTo(a,f,m){return this.easeTo(l.e({zoom:a},f),m)}zoomIn(a,f){return this.zoomTo(this.getZoom()+1,a,f),this}zoomOut(a,f){return this.zoomTo(this.getZoom()-1,a,f),this}getBearing(){return this.transform.bearing}setBearing(a,f){return this.jumpTo({bearing:a},f),this}getPadding(){return this.transform.padding}setPadding(a,f){return this.jumpTo({padding:a},f),this}rotateTo(a,f,m){return this.easeTo(l.e({bearing:a},f),m)}resetNorth(a,f){return this.rotateTo(0,l.e({duration:1e3},a),f),this}resetNorthPitch(a,f){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},a),f),this}snapToNorth(a,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,f):this}getPitch(){return this.transform.pitch}setPitch(a,f){return this.jumpTo({pitch:a},f),this}cameraForBounds(a,f){a=rt.convert(a);const m=f&&f.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),m,f)}_cameraForBoxAndBearing(a,f,m,g){const b={top:0,bottom:0,right:0,left:0};if(typeof(g=l.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding=="number"){const dt=g.padding;g.padding={top:dt,bottom:dt,right:dt,left:dt}}g.padding=l.e(b,g.padding);const T=this.transform,L=T.padding,k=new rt(a,f),z=T.project(k.getNorthWest()),j=T.project(k.getNorthEast()),q=T.project(k.getSouthEast()),$=T.project(k.getSouthWest()),he=l.b8(-m),ce=z.rotate(he),ye=j.rotate(he),re=q.rotate(he),Ie=$.rotate(he),Ue=new l.P(Math.max(ce.x,ye.x,Ie.x,re.x),Math.max(ce.y,ye.y,Ie.y,re.y)),xe=new l.P(Math.min(ce.x,ye.x,Ie.x,re.x),Math.min(ce.y,ye.y,Ie.y,re.y)),De=Ue.sub(xe),qe=(T.width-(L.left+L.right+g.padding.left+g.padding.right))/De.x,He=(T.height-(L.top+L.bottom+g.padding.top+g.padding.bottom))/De.y;if(He<0||qe<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const $e=Math.min(T.scaleZoom(T.scale*Math.min(qe,He)),g.maxZoom),it=l.P.convert(g.offset),tt=new l.P((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(l.b8(m)),ct=it.add(tt).mult(T.scale/T.zoomScale($e));return{center:T.unproject(z.add(q).div(2).sub(ct)),zoom:$e,bearing:m}}fitBounds(a,f,m){return this._fitInternal(this.cameraForBounds(a,f),f,m)}fitScreenCoordinates(a,f,m,g,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(a)),this.transform.pointLocation(l.P.convert(f)),m,g),g,b)}_fitInternal(a,f,m){return a?(delete(f=l.e(a,f)).padding,f.linear?this.easeTo(f,m):this.flyTo(f,m)):this}jumpTo(a,f){this.stop();const m=this._getTransformForUpdate();let g=!1,b=!1,T=!1;return"zoom"in a&&m.zoom!==+a.zoom&&(g=!0,m.zoom=+a.zoom),a.center!==void 0&&(m.center=l.M.convert(a.center)),"bearing"in a&&m.bearing!==+a.bearing&&(b=!0,m.bearing=+a.bearing),"pitch"in a&&m.pitch!==+a.pitch&&(T=!0,m.pitch=+a.pitch),a.padding==null||m.isPaddingEqual(a.padding)||(m.padding=a.padding),this._applyUpdatedTransform(m),this.fire(new l.k("movestart",f)).fire(new l.k("move",f)),g&&this.fire(new l.k("zoomstart",f)).fire(new l.k("zoom",f)).fire(new l.k("zoomend",f)),b&&this.fire(new l.k("rotatestart",f)).fire(new l.k("rotate",f)).fire(new l.k("rotateend",f)),T&&this.fire(new l.k("pitchstart",f)).fire(new l.k("pitch",f)).fire(new l.k("pitchend",f)),this.fire(new l.k("moveend",f))}calculateCameraOptionsFromTo(a,f,m,g=0){const b=l.Y.fromLngLat(a,f),T=l.Y.fromLngLat(m,g),L=T.x-b.x,k=T.y-b.y,z=T.z-b.z,j=Math.hypot(L,k,z);if(j===0)throw new Error("Can't calculate camera options with same From and To");const q=Math.hypot(L,k),$=this.transform.scaleZoom(this.transform.cameraToCenterDistance/j/this.transform.tileSize),he=180*Math.atan2(L,-k)/Math.PI;let ce=180*Math.acos(q/j)/Math.PI;return ce=z<0?90-ce:90+ce,{center:T.toLngLat(),zoom:$,pitch:ce,bearing:he}}easeTo(a,f){var m;this._stop(!1,a.easeId),((a=l.e({offset:[0,0],duration:500,easing:l.b7},a)).animate===!1||!a.essential&&E.prefersReducedMotion)&&(a.duration=0);const g=this._getTransformForUpdate(),b=this.getZoom(),T=this.getBearing(),L=this.getPitch(),k=this.getPadding(),z="bearing"in a?this._normalizeBearing(a.bearing,T):T,j="pitch"in a?+a.pitch:L,q="padding"in a?a.padding:g.padding,$=l.P.convert(a.offset);let he=g.centerPoint.add($);const ce=g.pointLocation(he),{center:ye,zoom:re}=g.getConstrained(l.M.convert(a.center||ce),(m=a.zoom)!==null&&m!==void 0?m:b);this._normalizeCenter(ye);const Ie=g.project(ce),Ue=g.project(ye).sub(Ie),xe=g.zoomScale(re-b);let De,qe;a.around&&(De=l.M.convert(a.around),qe=g.locationPoint(De));const He={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||re!==b,this._rotating=this._rotating||T!==z,this._pitching=this._pitching||j!==L,this._padding=!g.isPaddingEqual(q),this._easeId=a.easeId,this._prepareEase(f,a.noMoveStart,He),this.terrain&&this._prepareElevation(ye),this._ease($e=>{if(this._zooming&&(g.zoom=l.z.number(b,re,$e)),this._rotating&&(g.bearing=l.z.number(T,z,$e)),this._pitching&&(g.pitch=l.z.number(L,j,$e)),this._padding&&(g.interpolatePadding(k,q,$e),he=g.centerPoint.add($)),this.terrain&&!a.freezeElevation&&this._updateElevation($e),De)g.setLocationAtPoint(De,qe);else{const it=g.zoomScale(g.zoom-b),tt=re>b?Math.min(2,xe):Math.max(.5,xe),ct=Math.pow(tt,1-$e),dt=g.unproject(Ie.add(Ue.mult($e*ct)).mult(it));g.setLocationAtPoint(g.renderWorldCopies?dt.wrap():dt,he)}this._applyUpdatedTransform(g),this._fireMoveEvents(f)},$e=>{this.terrain&&this._finalizeElevation(),this._afterEase(f,$e)},a),this}_prepareEase(a,f,m={}){this._moving=!0,f||m.moving||this.fire(new l.k("movestart",a)),this._zooming&&!m.zooming&&this.fire(new l.k("zoomstart",a)),this._rotating&&!m.rotating&&this.fire(new l.k("rotatestart",a)),this._pitching&&!m.pitching&&this.fire(new l.k("pitchstart",a))}_prepareElevation(a){this._elevationCenter=a,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(a){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const f=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(a<1&&f!==this._elevationTarget){const m=this._elevationTarget-this._elevationStart;this._elevationStart+=a*(m-(f-(m*a+this._elevationStart))/(1-a)),this._elevationTarget=f}this.transform.elevation=l.z.number(this._elevationStart,this._elevationTarget,a)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(a){if(!this.transformCameraUpdate)return;const f=a.clone(),{center:m,zoom:g,pitch:b,bearing:T,elevation:L}=this.transformCameraUpdate(f);m&&(f.center=m),g!==void 0&&(f.zoom=g),b!==void 0&&(f.pitch=b),T!==void 0&&(f.bearing=T),L!==void 0&&(f.elevation=L),this.transform.apply(f)}_fireMoveEvents(a){this.fire(new l.k("move",a)),this._zooming&&this.fire(new l.k("zoom",a)),this._rotating&&this.fire(new l.k("rotate",a)),this._pitching&&this.fire(new l.k("pitch",a))}_afterEase(a,f){if(this._easeId&&f&&this._easeId===f)return;delete this._easeId;const m=this._zooming,g=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new l.k("zoomend",a)),g&&this.fire(new l.k("rotateend",a)),b&&this.fire(new l.k("pitchend",a)),this.fire(new l.k("moveend",a))}flyTo(a,f){var m;if(!a.essential&&E.prefersReducedMotion){const Fn=l.L(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Fn,f)}this.stop(),a=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.b7},a);const g=this._getTransformForUpdate(),b=this.getZoom(),T=this.getBearing(),L=this.getPitch(),k=this.getPadding(),z="bearing"in a?this._normalizeBearing(a.bearing,T):T,j="pitch"in a?+a.pitch:L,q="padding"in a?a.padding:g.padding,$=l.P.convert(a.offset);let he=g.centerPoint.add($);const ce=g.pointLocation(he),{center:ye,zoom:re}=g.getConstrained(l.M.convert(a.center||ce),(m=a.zoom)!==null&&m!==void 0?m:b);this._normalizeCenter(ye);const Ie=g.zoomScale(re-b),Ue=g.project(ce),xe=g.project(ye).sub(Ue);let De=a.curve;const qe=Math.max(g.width,g.height),He=qe/Ie,$e=xe.mag();if("minZoom"in a){const Fn=l.ac(Math.min(a.minZoom,b,re),g.minZoom,g.maxZoom),on=qe/g.zoomScale(Fn-b);De=Math.sqrt(on/$e*2)}const it=De*De;function tt(Fn){const on=(He*He-qe*qe+(Fn?-1:1)*it*it*$e*$e)/(2*(Fn?He:qe)*it*$e);return Math.log(Math.sqrt(on*on+1)-on)}function ct(Fn){return(Math.exp(Fn)-Math.exp(-Fn))/2}function dt(Fn){return(Math.exp(Fn)+Math.exp(-Fn))/2}const gn=tt(!1);let _t=function(Fn){return dt(gn)/dt(gn+De*Fn)},en=function(Fn){return qe*((dt(gn)*(ct(on=gn+De*Fn)/dt(on))-ct(gn))/it)/$e;var on},_n=(tt(!0)-gn)/De;if(Math.abs($e)<1e-6||!isFinite(_n)){if(Math.abs(qe-He)<1e-6)return this.easeTo(a,f);const Fn=He<qe?-1:1;_n=Math.abs(Math.log(He/qe))/De,en=function(){return 0},_t=function(on){return Math.exp(Fn*De*on)}}return a.duration="duration"in a?+a.duration:1e3*_n/("screenSpeed"in a?+a.screenSpeed/De:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0),this._zooming=!0,this._rotating=T!==z,this._pitching=j!==L,this._padding=!g.isPaddingEqual(q),this._prepareEase(f,!1),this.terrain&&this._prepareElevation(ye),this._ease(Fn=>{const on=Fn*_n,bn=1/_t(on);g.zoom=Fn===1?re:b+g.scaleZoom(bn),this._rotating&&(g.bearing=l.z.number(T,z,Fn)),this._pitching&&(g.pitch=l.z.number(L,j,Fn)),this._padding&&(g.interpolatePadding(k,q,Fn),he=g.centerPoint.add($)),this.terrain&&!a.freezeElevation&&this._updateElevation(Fn);const Cn=Fn===1?ye:g.unproject(Ue.add(xe.mult(en(on))).mult(bn));g.setLocationAtPoint(g.renderWorldCopies?Cn.wrap():Cn,he),this._applyUpdatedTransform(g),this._fireMoveEvents(f)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(f)},a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,f)}if(!a){const m=this.handlers;m&&m.stop(!1)}return this}_ease(a,f,m){m.animate===!1||m.duration===0?(a(1),f()):(this._easeStart=E.now(),this._easeOptions=m,this._onEaseFrame=a,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(a,f){a=l.b1(a,-180,180);const m=Math.abs(a-f);return Math.abs(a-360-f)<m&&(a-=360),Math.abs(a+360-f)<m&&(a+=360),a}_normalizeCenter(a){const f=this.transform;if(!f.renderWorldCopies||f.lngRange)return;const m=a.lng-f.center.lng;a.lng+=m>180?-360:m<-180?360:0}queryTerrainElevation(a){return this.terrain?this.terrain.getElevationForLngLatZoom(l.M.convert(a),this.transform.tileZoom)-this.transform.elevation:null}}const Zp={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ds{constructor(a=Zp){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=f=>{!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"&&f.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=a}getDefaultPosition(){return"bottom-right"}onAdd(a){return this._map=a,this._compact=this.options.compact,this._container=C.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=C.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=C.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){C.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(a,f){const m=this._map._getUIString(`AttributionControl.${f}`);a.title=m,a.setAttribute("aria-label",m)}_updateAttributions(){if(!this._map.style)return;let a=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=a.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&a.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const f=this._map.style.sourceCaches;for(const g in f){const b=f[g];if(b.used||b.usedForTerrain){const T=b.getSource();T.attribution&&a.indexOf(T.attribution)<0&&a.push(T.attribution)}}a=a.filter(g=>String(g).trim()),a.sort((g,b)=>g.length-b.length),a=a.filter((g,b)=>{for(let T=b+1;T<a.length;T++)if(a[T].indexOf(g)>=0)return!1;return!0});const m=a.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,a.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class pg{constructor(a={}){this._updateCompact=()=>{const f=this._container.children;if(f.length){const m=f[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&m.classList.add("maplibregl-compact"):m.classList.remove("maplibregl-compact")}},this.options=a}getDefaultPosition(){return"bottom-left"}onAdd(a){this._map=a,this._compact=this.options&&this.options.compact,this._container=C.create("div","maplibregl-ctrl");const f=C.create("a","maplibregl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://maplibre.org/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){C.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class zc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const f=++this._id;return this._queue.push({callback:a,id:f,cancelled:!1}),f}remove(a){const f=this._currentlyRunning,m=f?this._queue.concat(f):this._queue;for(const g of m)if(g.id===a)return void(g.cancelled=!0)}run(a=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const f=this._currentlyRunning=this._queue;this._queue=[];for(const m of f)if(!m.cancelled&&(m.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Fr=l.X([{name:"a_pos3d",type:"Int16",components:3}]);class ei extends l.E{constructor(a){super(),this.sourceCache=a,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,a.usedForTerrain=!0,a.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(a,f){this.sourceCache.update(a,f),this._renderableTilesKeys=[];const m={};for(const g of a.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:f}))m[g.key]=!0,this._renderableTilesKeys.push(g.key),this._tiles[g.key]||(g.posMatrix=new Float64Array(16),l.aN(g.posMatrix,0,l.W,0,l.W,0,1),this._tiles[g.key]=new hs(g,this.tileSize));for(const g in this._tiles)m[g]||delete this._tiles[g]}freeRtt(a){for(const f in this._tiles){const m=this._tiles[f];(!a||m.tileID.equals(a)||m.tileID.isChildOf(a)||a.isChildOf(m.tileID))&&(m.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(a=>this.getTileByID(a))}getTileByID(a){return this._tiles[a]}getTerrainCoords(a){const f={};for(const m of this._renderableTilesKeys){const g=this._tiles[m].tileID;if(g.canonical.equals(a.canonical)){const b=a.clone();b.posMatrix=new Float64Array(16),l.aN(b.posMatrix,0,l.W,0,l.W,0,1),f[m]=b}else if(g.canonical.isChildOf(a.canonical)){const b=a.clone();b.posMatrix=new Float64Array(16);const T=g.canonical.z-a.canonical.z,L=g.canonical.x-(g.canonical.x>>T<<T),k=g.canonical.y-(g.canonical.y>>T<<T),z=l.W>>T;l.aN(b.posMatrix,0,z,0,z,0,1),l.H(b.posMatrix,b.posMatrix,[-L*z,-k*z,0]),f[m]=b}else if(a.canonical.isChildOf(g.canonical)){const b=a.clone();b.posMatrix=new Float64Array(16);const T=a.canonical.z-g.canonical.z,L=a.canonical.x-(a.canonical.x>>T<<T),k=a.canonical.y-(a.canonical.y>>T<<T),z=l.W>>T;l.aN(b.posMatrix,0,l.W,0,l.W,0,1),l.H(b.posMatrix,b.posMatrix,[L*z,k*z,0]),l.J(b.posMatrix,b.posMatrix,[1/2**T,1/2**T,0]),f[m]=b}}return f}getSourceTile(a,f){const m=this.sourceCache._source;let g=a.overscaledZ-this.deltaZoom;if(g>m.maxzoom&&(g=m.maxzoom),g<m.minzoom)return null;this._sourceTileCache[a.key]||(this._sourceTileCache[a.key]=a.scaledTo(g).key);let b=this.sourceCache.getTileByID(this._sourceTileCache[a.key]);if((!b||!b.dem)&&f)for(;g>=m.minzoom&&(!b||!b.dem);)b=this.sourceCache.getTileByID(a.scaledTo(g--).key);return b}tilesAfterTime(a=Date.now()){return Object.values(this._tiles).filter(f=>f.timeAdded>=a)}}class dg{constructor(a,f,m){this.painter=a,this.sourceCache=new ei(f),this.options=m,this.exaggeration=typeof m.exaggeration=="number"?m.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(a,f,m,g=l.W){var b;if(!(f>=0&&f<g&&m>=0&&m<g))return 0;const T=this.getTerrainData(a),L=(b=T.tile)===null||b===void 0?void 0:b.dem;if(!L)return 0;const k=function(ce,ye,re){var Ie=ye[0],Ue=ye[1];return ce[0]=re[0]*Ie+re[4]*Ue+re[12],ce[1]=re[1]*Ie+re[5]*Ue+re[13],ce}([],[f/g*l.W,m/g*l.W],T.u_terrain_matrix),z=[k[0]*L.dim,k[1]*L.dim],j=Math.floor(z[0]),q=Math.floor(z[1]),$=z[0]-j,he=z[1]-q;return L.get(j,q)*(1-$)*(1-he)+L.get(j+1,q)*$*(1-he)+L.get(j,q+1)*(1-$)*he+L.get(j+1,q+1)*$*he}getElevationForLngLatZoom(a,f){const{tileID:m,mercatorX:g,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(a,f);return this.getElevation(m,g%l.W,b%l.W,l.W)}getElevation(a,f,m,g=l.W){return this.getDEMElevation(a,f,m,g)*this.exaggeration}getTerrainData(a){if(!this._emptyDemTexture){const g=this.painter.context,b=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new K(g,b,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new K(g,new l.R({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.an([])}const f=this.sourceCache.getSourceTile(a,!0);if(f&&f.dem&&(!f.demTexture||f.needsTerrainPrepare)){const g=this.painter.context;f.demTexture=this.painter.getTileTexture(f.dem.stride),f.demTexture?f.demTexture.update(f.dem.getPixels(),{premultiply:!1}):f.demTexture=new K(g,f.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),f.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),f.needsTerrainPrepare=!1}const m=f&&f+f.tileID.key+a.key;if(m&&!this._demMatrixCache[m]){const g=this.sourceCache.sourceCache._source.maxzoom;let b=a.canonical.z-f.tileID.canonical.z;a.overscaledZ>a.canonical.z&&(a.canonical.z>=g?b=a.canonical.z-g:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const T=a.canonical.x-(a.canonical.x>>b<<b),L=a.canonical.y-(a.canonical.y>>b<<b),k=l.b9(new Float64Array(16),[1/(l.W<<b),1/(l.W<<b),0]);l.H(k,k,[T*l.W,L*l.W,0]),this._demMatrixCache[a.key]={matrix:k,coord:a}}return{u_depth:2,u_terrain:3,u_terrain_dim:f&&f.dem&&f.dem.dim||1,u_terrain_matrix:m?this._demMatrixCache[a.key].matrix:this._emptyDemMatrix,u_terrain_unpack:f&&f.dem&&f.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(f&&f.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:f}}getFramebuffer(a){const f=this.painter,m=f.width/devicePixelRatio,g=f.height/devicePixelRatio;return!this._fbo||this._fbo.width===m&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new K(f.context,{width:m,height:g,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new K(f.context,{width:m,height:g,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=f.context.createFramebuffer(m,g,!0,!1),this._fbo.depthAttachment.set(f.context.createRenderbuffer(f.context.gl.DEPTH_COMPONENT16,m,g))),this._fbo.colorAttachment.set(a==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const a=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const f=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,T=0;b<this._coordsTextureSize;b++)for(let L=0;L<this._coordsTextureSize;L++,T+=4)f[T+0]=255&L,f[T+1]=255&b,f[T+2]=L>>8<<4|b>>8,f[T+3]=0;const m=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(f.buffer)),g=new K(a,m,a.gl.RGBA,{premultiply:!1});return g.bind(a.gl.NEAREST,a.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(a){this.painter.maybeDrawDepthAndCoords(!0);const f=new Uint8Array(4),m=this.painter.context,g=m.gl,b=Math.round(a.x*this.painter.pixelRatio/devicePixelRatio),T=Math.round(a.y*this.painter.pixelRatio/devicePixelRatio),L=Math.round(this.painter.height/devicePixelRatio);m.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(b,L-T-1,1,1,g.RGBA,g.UNSIGNED_BYTE,f),m.bindFramebuffer.set(null);const k=f[0]+(f[2]>>4<<8),z=f[1]+((15&f[2])<<8),j=this.coordsIndex[255-f[3]],q=j&&this.sourceCache.getTileByID(j);if(!q)return null;const $=this._coordsTextureSize,he=(1<<q.tileID.canonical.z)*$;return new l.Y((q.tileID.canonical.x*$+k)/he+q.tileID.wrap,(q.tileID.canonical.y*$+z)/he,this.getElevation(q.tileID,k,z,$))}depthAtPoint(a){const f=new Uint8Array(4),m=this.painter.context,g=m.gl;return m.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),g.readPixels(a.x,this.painter.height/devicePixelRatio-a.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,f),m.bindFramebuffer.set(null),(f[0]/16777216+f[1]/65536+f[2]/256+f[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const a=this.painter.context,f=new l.ba,m=new l.aX,g=this.meshSize,b=l.W/g,T=g*g;for(let q=0;q<=g;q++)for(let $=0;$<=g;$++)f.emplaceBack($*b,q*b,0);for(let q=0;q<T;q+=g+1)for(let $=0;$<g;$++)m.emplaceBack($+q,g+$+q+1,g+$+q+2),m.emplaceBack($+q,g+$+q+2,$+q+1);const L=f.length,k=L+2*(g+1);for(const q of[0,1])for(let $=0;$<=g;$++)for(const he of[0,1])f.emplaceBack($*b,q*l.W,he);for(let q=0;q<2*g;q+=2)m.emplaceBack(k+q,k+q+1,k+q+3),m.emplaceBack(k+q,k+q+3,k+q+2),m.emplaceBack(L+q,L+q+3,L+q+1),m.emplaceBack(L+q,L+q+2,L+q+3);const z=f.length,j=z+2*(g+1);for(const q of[0,1])for(let $=0;$<=g;$++)for(const he of[0,1])f.emplaceBack(q*l.W,$*b,he);for(let q=0;q<2*g;q+=2)m.emplaceBack(z+q,z+q+1,z+q+3),m.emplaceBack(z+q,z+q+3,z+q+2),m.emplaceBack(j+q,j+q+3,j+q+1),m.emplaceBack(j+q,j+q+2,j+q+3);return this._mesh={indexBuffer:a.createIndexBuffer(m),vertexBuffer:a.createVertexBuffer(f,Fr.members),segments:l.$.simpleSegment(0,0,f.length,m.length)},this._mesh}getMeshFrameDelta(a){return 2*Math.PI*l.bb/Math.pow(2,a)/5}getMinTileElevationForLngLatZoom(a,f){var m;const{tileID:g}=this._getOverscaledTileIDFromLngLatZoom(a,f);return(m=this.getMinMaxElevation(g).minElevation)!==null&&m!==void 0?m:0}getMinMaxElevation(a){const f=this.getTerrainData(a).tile,m={minElevation:null,maxElevation:null};return f&&f.dem&&(m.minElevation=f.dem.min*this.exaggeration,m.maxElevation=f.dem.max*this.exaggeration),m}_getOverscaledTileIDFromLngLatZoom(a,f){const m=l.Y.fromLngLat(a.wrap()),g=(1<<f)*l.W,b=m.x*g,T=m.y*g,L=Math.floor(b/l.W),k=Math.floor(T/l.W);return{tileID:new l.Q(f,0,f,L,k),mercatorX:b,mercatorY:T}}}class Fc{constructor(a,f,m){this._context=a,this._size=f,this._tileSize=m,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const a of this._objects)a.texture.destroy(),a.fbo.destroy()}_createObject(a){const f=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),m=new K(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return m.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),f.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),f.colorAttachment.set(m.texture),{id:a,fbo:f,texture:m,stamp:-1,inUse:!1}}getObjectForId(a){return this._objects[a]}useObject(a){a.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(f=>a.id!==f),this._recentlyUsed.push(a.id)}stampObject(a){a.stamp=++this._stamp}getOrCreateFreeObject(){for(const f of this._recentlyUsed)if(!this._objects[f].inUse)return this._objects[f];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const a=this._createObject(this._objects.length);return this._objects.push(a),a}freeObject(a){a.inUse=!1}freeAllObjects(){for(const a of this._objects)this.freeObject(a)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(a=>!a.inUse)===!1}}const Fa={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Xp{constructor(a,f){this.painter=a,this.terrain=f,this.pool=new Fc(a.context,30,f.sourceCache.tileSize*f.qualityFactor)}destruct(){this.pool.destruct()}getTexture(a){return this.pool.getObjectForId(a.rtt[this._stacks.length-1].id).texture}prepareForRender(a,f){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=a._order.filter(m=>!a._layers[m].isHidden(f)),this._coordsDescendingInv={};for(const m in a.sourceCaches){this._coordsDescendingInv[m]={};const g=a.sourceCaches[m].getVisibleCoordinates();for(const b of g){const T=this.terrain.sourceCache.getTerrainCoords(b);for(const L in T)this._coordsDescendingInv[m][L]||(this._coordsDescendingInv[m][L]=[]),this._coordsDescendingInv[m][L].push(T[L])}}this._coordsDescendingInvStr={};for(const m of a._order){const g=a._layers[m],b=g.source;if(Fa[g.type]&&!this._coordsDescendingInvStr[b]){this._coordsDescendingInvStr[b]={};for(const T in this._coordsDescendingInv[b])this._coordsDescendingInvStr[b][T]=this._coordsDescendingInv[b][T].map(L=>L.key).sort().join()}}for(const m of this._renderableTiles)for(const g in this._coordsDescendingInvStr){const b=this._coordsDescendingInvStr[g][m.tileID.key];b&&b!==m.rttCoords[g]&&(m.rtt=[])}}renderLayer(a){if(a.isHidden(this.painter.transform.zoom))return!1;const f=a.type,m=this.painter,g=this._renderableLayerIds[this._renderableLayerIds.length-1]===a.id;if(Fa[f]&&(this._prevType&&Fa[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(a.id),!g))return!0;if(Fa[this._prevType]||Fa[f]&&g){this._prevType=f;const b=this._stacks.length-1,T=this._stacks[b]||[];for(const L of this._renderableTiles){if(this.pool.isFull()&&(qh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(L),L.rtt[b]){const z=this.pool.getObjectForId(L.rtt[b].id);if(z.stamp===L.rtt[b].stamp){this.pool.useObject(z);continue}}const k=this.pool.getOrCreateFreeObject();this.pool.useObject(k),this.pool.stampObject(k),L.rtt[b]={id:k.id,stamp:k.stamp},m.context.bindFramebuffer.set(k.fbo.framebuffer),m.context.clear({color:l.aO.transparent,stencil:0}),m.currentStencilSource=void 0;for(let z=0;z<T.length;z++){const j=m.style._layers[T[z]],q=j.source?this._coordsDescendingInv[j.source][L.tileID.key]:[L.tileID];m.context.viewport.set([0,0,k.fbo.width,k.fbo.height]),m._renderTileClippingMasks(j,q),m.renderLayer(m,m.style.sourceCaches[j.source],j,q),j.source&&(L.rttCoords[j.source]=this._coordsDescendingInvStr[j.source][L.tileID.key])}}return qh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Fa[f]}return!1}}const Yp={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},$p=d,Bc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Zp,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Kh=v=>{v.touchstart=v.dragStart,v.touchmoveWindow=v.dragMove,v.touchend=v.dragEnd},Kp={showCompass:!0,showZoom:!0,visualizePitch:!1};class Jp{constructor(a,f,m=!1){this.mousedown=T=>{this.startMouse(l.e({},T,{ctrlKey:!0,preventDefault:()=>T.preventDefault()}),C.mousePos(this.element,T)),C.addEventListener(window,"mousemove",this.mousemove),C.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=T=>{this.moveMouse(T,C.mousePos(this.element,T))},this.mouseup=T=>{this.mouseRotate.dragEnd(T),this.mousePitch&&this.mousePitch.dragEnd(T),this.offTemp()},this.touchstart=T=>{T.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=C.touchPos(this.element,T.targetTouches)[0],this.startTouch(T,this._startPos),C.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.addEventListener(window,"touchend",this.touchend))},this.touchmove=T=>{T.targetTouches.length!==1?this.reset():(this._lastPos=C.touchPos(this.element,T.targetTouches)[0],this.moveTouch(T,this._lastPos))},this.touchend=T=>{T.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const g=a.dragRotate._mouseRotate.getClickTolerance(),b=a.dragRotate._mousePitch.getClickTolerance();this.element=f,this.mouseRotate=Nu({clickTolerance:g,enable:!0}),this.touchRotate=(({enable:T,clickTolerance:L,bearingDegreesPerPixelMoved:k=.8})=>{const z=new Pt;return new Ru({clickTolerance:L,move:(j,q)=>({bearingDelta:(q.x-j.x)*k}),moveStateManager:z,enable:T,assignEvents:Kh})})({clickTolerance:g,enable:!0}),this.map=a,m&&(this.mousePitch=Ou({clickTolerance:b,enable:!0}),this.touchPitch=(({enable:T,clickTolerance:L,pitchDegreesPerPixelMoved:k=-.5})=>{const z=new Pt;return new Ru({clickTolerance:L,move:(j,q)=>({pitchDelta:(q.y-j.y)*k}),moveStateManager:z,enable:T,assignEvents:Kh})})({clickTolerance:b,enable:!0})),C.addEventListener(f,"mousedown",this.mousedown),C.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),C.addEventListener(f,"touchcancel",this.reset)}startMouse(a,f){this.mouseRotate.dragStart(a,f),this.mousePitch&&this.mousePitch.dragStart(a,f),C.disableDrag()}startTouch(a,f){this.touchRotate.dragStart(a,f),this.touchPitch&&this.touchPitch.dragStart(a,f),C.disableDrag()}moveMouse(a,f){const m=this.map,{bearingDelta:g}=this.mouseRotate.dragMove(a,f)||{};if(g&&m.setBearing(m.getBearing()+g),this.mousePitch){const{pitchDelta:b}=this.mousePitch.dragMove(a,f)||{};b&&m.setPitch(m.getPitch()+b)}}moveTouch(a,f){const m=this.map,{bearingDelta:g}=this.touchRotate.dragMove(a,f)||{};if(g&&m.setBearing(m.getBearing()+g),this.touchPitch){const{pitchDelta:b}=this.touchPitch.dragMove(a,f)||{};b&&m.setPitch(m.getPitch()+b)}}off(){const a=this.element;C.removeEventListener(a,"mousedown",this.mousedown),C.removeEventListener(a,"touchstart",this.touchstart,{passive:!1}),C.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.removeEventListener(window,"touchend",this.touchend),C.removeEventListener(a,"touchcancel",this.reset),this.offTemp()}offTemp(){C.enableDrag(),C.removeEventListener(window,"mousemove",this.mousemove),C.removeEventListener(window,"mouseup",this.mouseup),C.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.removeEventListener(window,"touchend",this.touchend)}}let Ba;function Jh(v,a,f){const m=new l.M(v.lng,v.lat);if(v=new l.M(v.lng,v.lat),a){const g=new l.M(v.lng-360,v.lat),b=new l.M(v.lng+360,v.lat),T=f.locationPoint(v).distSqr(a);f.locationPoint(g).distSqr(a)<T?v=g:f.locationPoint(b).distSqr(a)<T&&(v=b)}for(;Math.abs(v.lng-f.center.lng)>180;){const g=f.locationPoint(v);if(g.x>=0&&g.y>=0&&g.x<=f.width&&g.y<=f.height)break;v.lng>f.center.lng?v.lng-=360:v.lng+=360}return v.lng!==m.lng&&f.locationPoint(v).y>f.height/2-f.getHorizon()?v:m}const Vc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Qh(v,a,f){const m=v.classList;for(const g in Vc)m.remove(`maplibregl-${f}-anchor-${g}`);m.add(`maplibregl-${f}-anchor-${a}`)}class Uc extends l.E{constructor(a){if(super(),this._onKeyPress=f=>{const m=f.code,g=f.charCode||f.keyCode;m!=="Space"&&m!=="Enter"&&g!==32&&g!==13||this.togglePopup()},this._onMapClick=f=>{const m=f.originalEvent.target,g=this._element;this._popup&&(m===g||g.contains(m))&&this.togglePopup()},this._update=f=>{var m;if(!this._map)return;const g=this._map.loaded()&&!this._map.isMoving();((f==null?void 0:f.type)==="terrain"||(f==null?void 0:f.type)==="render"&&!g)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Jh(this._lngLat,this._flatPos,this._map.transform):(m=this._lngLat)===null||m===void 0?void 0:m.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let b="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?b=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(b=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let T="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?T="rotateX(0deg)":this._pitchAlignment==="map"&&(T=`rotateX(${this._map.getPitch()}deg)`),f&&f.type!=="moveend"||(this._pos=this._pos.round()),C.setTransform(this._element,`${Vc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${T} ${b}`),E.frameAsync(new AbortController).then(()=>{this._updateOpacity(f&&f.type==="moveend")}).catch(()=>{})},this._onMove=f=>{if(!this._isDragging){const m=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=f=>{this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment!=="auto"?a.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(a==null?void 0:a.opacity,a==null?void 0:a.opacityWhenCovered),a&&a.element)this._element=a.element,this._offset=l.P.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=C.create("div"),this._element.setAttribute("aria-label","Map marker");const f=C.createNS("http://www.w3.org/2000/svg","svg"),m=41,g=27;f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height",`${m}px`),f.setAttributeNS(null,"width",`${g}px`),f.setAttributeNS(null,"viewBox",`0 0 ${g} ${m}`);const b=C.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const T=C.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");const L=C.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ie of k){const Ue=C.createNS("http://www.w3.org/2000/svg","ellipse");Ue.setAttributeNS(null,"opacity","0.04"),Ue.setAttributeNS(null,"cx","10.5"),Ue.setAttributeNS(null,"cy","5.80029008"),Ue.setAttributeNS(null,"rx",Ie.rx),Ue.setAttributeNS(null,"ry",Ie.ry),L.appendChild(Ue)}const z=C.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const j=C.createNS("http://www.w3.org/2000/svg","path");j.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(j);const q=C.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"fill","#000000");const $=C.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),q.appendChild($);const he=C.createNS("http://www.w3.org/2000/svg","g");he.setAttributeNS(null,"transform","translate(6.0, 7.0)"),he.setAttributeNS(null,"fill","#FFFFFF");const ce=C.createNS("http://www.w3.org/2000/svg","g");ce.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ye=C.createNS("http://www.w3.org/2000/svg","circle");ye.setAttributeNS(null,"fill","#000000"),ye.setAttributeNS(null,"opacity","0.25"),ye.setAttributeNS(null,"cx","5.5"),ye.setAttributeNS(null,"cy","5.5"),ye.setAttributeNS(null,"r","5.4999962");const re=C.createNS("http://www.w3.org/2000/svg","circle");re.setAttributeNS(null,"fill","#FFFFFF"),re.setAttributeNS(null,"cx","5.5"),re.setAttributeNS(null,"cy","5.5"),re.setAttributeNS(null,"r","5.4999962"),ce.appendChild(ye),ce.appendChild(re),T.appendChild(L),T.appendChild(z),T.appendChild(q),T.appendChild(he),T.appendChild(ce),f.appendChild(T),f.setAttributeNS(null,"height",m*this._scale+"px"),f.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(f),this._offset=l.P.convert(a&&a.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()}),Qh(this._element,this._anchor,"marker"),a&&a.className)for(const f of a.className.split(" "))this._element.classList.add(f);this._popup=null}addTo(a){return this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._update),a.on("moveend",this._update),a.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),C.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=l.M.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const g=Math.abs(13.5)/Math.SQRT2;a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const a=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:a?(a.isOpen()?a.remove():(a.setLngLat(this._lngLat),a.addTo(this._map)),this):this}_updateOpacity(a=!1){var f,m;if(!(!((f=this._map)===null||f===void 0)&&f.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(a)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const g=this._map,b=g.terrain.depthAtPoint(this._pos),T=g.terrain.getElevationForLngLatZoom(this._lngLat,g.transform.tileZoom);if(g.transform.lngLatToCameraDepth(this._lngLat,T)-b<.006)return void(this._element.style.opacity=this._opacity);const L=-this._offset.y/g.transform._pixelPerMeter,k=Math.sin(g.getPitch()*Math.PI/180)*L,z=g.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),j=g.transform.lngLatToCameraDepth(this._lngLat,T+k)-z>.006;!((m=this._popup)===null||m===void 0)&&m.isOpen()&&j&&this._popup.remove(),this._element.style.opacity=j?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(a){return this._offset=l.P.convert(a),this._update(),this}addClassName(a){this._element.classList.add(a)}removeClassName(a){this._element.classList.remove(a)}toggleClassName(a){return this._element.classList.toggle(a)}setDraggable(a){return this._draggable=!!a,this._map&&(a?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a&&a!=="auto"?a:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(a,f){return a===void 0&&f===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),a!==void 0&&(this._opacity=a),f!==void 0&&(this._opacityWhenCovered=f),this._map&&this._updateOpacity(!0),this}}const ef={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Fu=0,$l=!1;const tf={maxWidth:100,unit:"metric"};function nf(v,a,f){const m=f&&f.maxWidth||100,g=v._container.clientHeight/2,b=v.unproject([0,g]),T=v.unproject([m,g]),L=b.distanceTo(T);if(f&&f.unit==="imperial"){const k=3.2808*L;k>5280?Kl(a,m,k/5280,v._getUIString("ScaleControl.Miles")):Kl(a,m,k,v._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?Kl(a,m,L/1852,v._getUIString("ScaleControl.NauticalMiles")):L>=1e3?Kl(a,m,L/1e3,v._getUIString("ScaleControl.Kilometers")):Kl(a,m,L,v._getUIString("ScaleControl.Meters"))}function Kl(v,a,f,m){const g=function(b){const T=Math.pow(10,`${Math.floor(b)}`.length-1);let L=b/T;return L=L>=10?10:L>=5?5:L>=3?3:L>=2?2:L>=1?1:function(k){const z=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*z)/z}(L),T*L}(f);v.style.width=a*(g/f)+"px",v.innerHTML=`${g}&nbsp;${m}`}const Qp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},ed=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function rf(v){if(v){if(typeof v=="number"){const a=Math.round(Math.abs(v)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,v),"top-left":new l.P(a,a),"top-right":new l.P(-a,a),bottom:new l.P(0,-v),"bottom-left":new l.P(a,-a),"bottom-right":new l.P(-a,-a),left:new l.P(v,0),right:new l.P(-v,0)}}if(v instanceof l.P||Array.isArray(v)){const a=l.P.convert(v);return{center:a,top:a,"top-left":a,"top-right":a,bottom:a,"bottom-left":a,"bottom-right":a,left:a,right:a}}return{center:l.P.convert(v.center||[0,0]),top:l.P.convert(v.top||[0,0]),"top-left":l.P.convert(v["top-left"]||[0,0]),"top-right":l.P.convert(v["top-right"]||[0,0]),bottom:l.P.convert(v.bottom||[0,0]),"bottom-left":l.P.convert(v["bottom-left"]||[0,0]),"bottom-right":l.P.convert(v["bottom-right"]||[0,0]),left:l.P.convert(v.left||[0,0]),right:l.P.convert(v.right||[0,0])}}return rf(new l.P(0,0))}const mg=d;c.AJAXError=l.be,c.Evented=l.E,c.LngLat=l.M,c.MercatorCoordinate=l.Y,c.Point=l.P,c.addProtocol=l.bf,c.config=l.a,c.removeProtocol=l.bg,c.AttributionControl=Ds,c.BoxZoomHandler=ks,c.CanvasSource=Ls,c.CooperativeGesturesHandler=jt,c.DoubleClickZoomHandler=Wp,c.DragPanHandler=fg,c.DragRotateHandler=As,c.EdgeInsets=Au,c.FullscreenControl=class extends l.E{constructor(v={}){super(),this._onFullscreenChange=()=>{var a;let f=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((a=f==null?void 0:f.shadowRoot)===null||a===void 0)&&a.fullscreenElement;)f=f.shadowRoot.fullscreenElement;f===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){C.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const v=this._fullscreenButton=C.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);C.create("span","maplibregl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.title=v}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},c.GeoJSONSource=Xe,c.GeolocateControl=class extends l.E{constructor(v){super(),this._onSuccess=a=>{if(this._map){if(this._isOutOfMapMaxBounds(a))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",a)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=a,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(a),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(a),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",a)),this._finish()}},this._updateCamera=a=>{const f=new l.M(a.coords.longitude,a.coords.latitude),m=a.coords.accuracy,g=this._map.getBearing(),b=l.e({bearing:g},this.options.fitBoundsOptions),T=rt.fromLngLat(f,m);this._map.fitBounds(T,b,{geolocateSource:!0})},this._updateMarker=a=>{if(a){const f=new l.M(a.coords.longitude,a.coords.latitude);this._accuracyCircleMarker.setLngLat(f).addTo(this._map),this._userLocationDotMarker.setLngLat(f).addTo(this._map),this._accuracy=a.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=a=>{if(this._map){if(this.options.trackUserLocation)if(a.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(a.code===3&&$l)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",a)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=a=>{if(this._map){if(this._container.addEventListener("contextmenu",f=>f.preventDefault()),this._geolocateButton=C.create("button","maplibregl-ctrl-geolocate",this._container),C.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",a===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}else{const f=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=C.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Uc({element:this._dotElement}),this._circleElement=C.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Uc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",f=>{f.geolocateSource||this._watchState!=="ACTIVE_LOCK"||f.originalEvent&&f.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")))})}},this.options=l.e({},ef,v)}onAdd(v){return this._map=v,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return l._(this,arguments,void 0,function*(a=!1){if(Ba!==void 0&&!a)return Ba;if(window.navigator.permissions===void 0)return Ba=!!window.navigator.geolocation,Ba;try{Ba=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ba=!!window.navigator.geolocation}return Ba})}().then(a=>this._setupUI(a)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),C.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Fu=0,$l=!1}_isOutOfMapMaxBounds(v){const a=this._map.getMaxBounds(),f=v.coords;return a&&(f.longitude<a.getWest()||f.longitude>a.getEast()||f.latitude<a.getSouth()||f.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const v=this._map.getBounds(),a=v.getSouthEast(),f=v.getNorthEast(),m=a.distanceTo(f),g=Math.ceil(this._accuracy/(m/this._map._container.clientHeight)*2);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Fu--,$l=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Fu++,Fu>1?(v={maximumAge:6e5,timeout:0},$l=!0):(v=this.options.positionOptions,$l=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},c.Hash=Up,c.ImageSource=hn,c.KeyboardHandler=pl,c.LngLatBounds=rt,c.LogoControl=pg,c.Map=class extends Mo{constructor(v){if(l.bc.mark(l.bd.create),(v=l.e({},Bc,v)).minZoom!=null&&v.maxZoom!=null&&v.minZoom>v.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(v.minPitch!=null&&v.maxPitch!=null&&v.minPitch>v.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(v.minPitch!=null&&v.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(v.maxPitch!=null&&v.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Wh(v.minZoom,v.maxZoom,v.minPitch,v.maxPitch,v.renderWorldCopies),{bearingSnap:v.bearingSnap}),this._contextLost=a=>{a.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.k("webglcontextlost",{originalEvent:a}))},this._contextRestored=a=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:a}))},this._onMapScroll=a=>{if(a.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=v.interactive,this._maxTileCacheSize=v.maxTileCacheSize,this._maxTileCacheZoomLevels=v.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=v.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=v.preserveDrawingBuffer,this._antialias=v.antialias,this._trackResize=v.trackResize,this._bearingSnap=v.bearingSnap,this._refreshExpiredTiles=v.refreshExpiredTiles,this._fadeDuration=v.fadeDuration,this._crossSourceCollisions=v.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=v.collectResourceTiming,this._renderTaskQueue=new zc,this._controls=[],this._mapId=l.a3(),this._locale=l.e({},Yp,v.locale),this._clickTolerance=v.clickTolerance,this._overridePixelRatio=v.pixelRatio,this._maxCanvasSize=v.maxCanvasSize,this.transformCameraUpdate=v.transformCameraUpdate,this._imageQueueHandle=G.addThrottleControl(()=>this.isMoving()),this._requestManager=new U(v.transformRequest),typeof v.container=="string"){if(this._container=document.getElementById(v.container),!this._container)throw new Error(`Container '${v.container}' not found.`)}else{if(!(v.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=v.container}if(v.maxBounds&&this.setMaxBounds(v.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let a=!1;const f=Vp(m=>{this._trackResize&&!this._removed&&this.resize(m)._update()},50);this._resizeObserver=new ResizeObserver(m=>{a?f(m):a=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Hp(this,v),this._hash=v.hash&&new Up(typeof v.hash=="string"&&v.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch}),v.bounds&&(this.resize(),this.fitBounds(v.bounds,l.e({},v.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=v.localIdeographFontFamily,this._validateStyle=v.validateStyle,v.style&&this.setStyle(v.style,{localIdeographFontFamily:v.localIdeographFontFamily}),v.attributionControl&&this.addControl(new Ds(typeof v.attributionControl=="boolean"?void 0:v.attributionControl)),v.maplibreLogo&&this.addControl(new pg,v.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new l.k(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new l.k(`${a.dataType}dataloading`,a))}),this.on("dataabort",a=>{this.fire(new l.k("sourcedataabort",a))})}_getMapId(){return this._mapId}addControl(v,a){if(a===void 0&&(a=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=v.onAdd(this);this._controls.push(v);const m=this._controlPositions[a];return a.indexOf("bottom")!==-1?m.insertBefore(f,m.firstChild):m.appendChild(f),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(v);return a>-1&&this._controls.splice(a,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}calculateCameraOptionsFromTo(v,a,f,m){return m==null&&this.terrain&&(m=this.terrain.getElevationForLngLatZoom(f,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(v,a,f,m)}resize(v){var a;const f=this._containerDimensions(),m=f[0],g=f[1],b=this._getClampedPixelRatio(m,g);if(this._resizeCanvas(m,g,b),this.painter.resize(m,g,b),this.painter.overLimit()){const L=this.painter.context.gl;this._maxCanvasSize=[L.drawingBufferWidth,L.drawingBufferHeight];const k=this._getClampedPixelRatio(m,g);this._resizeCanvas(m,g,k),this.painter.resize(m,g,k)}this.transform.resize(m,g),(a=this._requestedCameraState)===null||a===void 0||a.resize(m,g);const T=!this._moving;return T&&(this.stop(),this.fire(new l.k("movestart",v)).fire(new l.k("move",v))),this.fire(new l.k("resize",v)),T&&this.fire(new l.k("moveend",v)),this}_getClampedPixelRatio(v,a){const{0:f,1:m}=this._maxCanvasSize,g=this.getPixelRatio(),b=v*g,T=a*g;return Math.min(b>f?f/b:1,T>m?m/T:1)*g}getPixelRatio(){var v;return(v=this._overridePixelRatio)!==null&&v!==void 0?v:devicePixelRatio}setPixelRatio(v){this._overridePixelRatio=v,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(v){return this.transform.setMaxBounds(rt.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.minZoom=v,this._update(),this.getZoom()<v&&this.setZoom(v),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.maxZoom=v,this._update(),this.getZoom()>v&&this.setZoom(v),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.minPitch=v,this._update(),this.getPitch()<v&&this.setPitch(v),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(v>=this.transform.minPitch)return this.transform.maxPitch=v,this._update(),this.getPitch()>v&&this.setPitch(v),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.renderWorldCopies=v,this._update()}project(v){return this.transform.locationPoint(l.M.convert(v),this.style&&this.terrain)}unproject(v){return this.transform.pointLocation(l.P.convert(v),this.terrain)}isMoving(){var v;return this._moving||((v=this.handlers)===null||v===void 0?void 0:v.isMoving())}isZooming(){var v;return this._zooming||((v=this.handlers)===null||v===void 0?void 0:v.isZooming())}isRotating(){var v;return this._rotating||((v=this.handlers)===null||v===void 0?void 0:v.isRotating())}_createDelegatedListener(v,a,f){if(v==="mouseenter"||v==="mouseover"){let m=!1;return{layer:a,listener:f,delegates:{mousemove:b=>{const T=this.getLayer(a)?this.queryRenderedFeatures(b.point,{layers:[a]}):[];T.length?m||(m=!0,f.call(this,new Po(v,this,b.originalEvent,{features:T}))):m=!1},mouseout:()=>{m=!1}}}}if(v==="mouseleave"||v==="mouseout"){let m=!1;return{layer:a,listener:f,delegates:{mousemove:T=>{(this.getLayer(a)?this.queryRenderedFeatures(T.point,{layers:[a]}):[]).length?m=!0:m&&(m=!1,f.call(this,new Po(v,this,T.originalEvent)))},mouseout:T=>{m&&(m=!1,f.call(this,new Po(v,this,T.originalEvent)))}}}}{const m=g=>{const b=this.getLayer(a)?this.queryRenderedFeatures(g.point,{layers:[a]}):[];b.length&&(g.features=b,f.call(this,g),delete g.features)};return{layer:a,listener:f,delegates:{[v]:m}}}}on(v,a,f){if(f===void 0)return super.on(v,a);const m=this._createDelegatedListener(v,a,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(m);for(const g in m.delegates)this.on(g,m.delegates[g]);return this}once(v,a,f){if(f===void 0)return super.once(v,a);const m=this._createDelegatedListener(v,a,f);for(const g in m.delegates)this.once(g,m.delegates[g]);return this}off(v,a,f){return f===void 0?super.off(v,a):(this._delegatedListeners&&this._delegatedListeners[v]&&(m=>{const g=this._delegatedListeners[v];for(let b=0;b<g.length;b++){const T=g[b];if(T.layer===a&&T.listener===f){for(const L in T.delegates)this.off(L,T.delegates[L]);return g.splice(b,1),this}}})(),this)}queryRenderedFeatures(v,a){if(!this.style)return[];let f;const m=v instanceof l.P||Array.isArray(v),g=m?v:[[0,0],[this.transform.width,this.transform.height]];if(a=a||(m?{}:v)||{},g instanceof l.P||typeof g[0]=="number")f=[l.P.convert(g)];else{const b=l.P.convert(g[0]),T=l.P.convert(g[1]);f=[b,new l.P(T.x,b.y),T,new l.P(b.x,T.y),b]}return this.style.queryRenderedFeatures(f,a,this.transform)}querySourceFeatures(v,a){return this.style.querySourceFeatures(v,a)}setStyle(v,a){return(a=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},a)).diff!==!1&&a.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&v?(this._diffStyle(v,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._updateStyle(v,a))}setTransformRequest(v){return this._requestManager.setTransformRequest(v),this}_getUIString(v){const a=this._locale[v];if(a==null)throw new Error(`Missing UI string '${v}'`);return a}_updateStyle(v,a){if(a.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(v,a));const f=this.style&&a.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!v)),v?(this.style=new Ho(this,a||{}),this.style.setEventedParent(this,{style:this.style}),typeof v=="string"?this.style.loadURL(v,a,f):this.style.loadJSON(v,a,f),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ho(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,a){if(typeof v=="string"){const f=this._requestManager.transformRequest(v,"Style");l.h(f,new AbortController).then(m=>{this._updateDiff(m.data,a)}).catch(m=>{m&&this.fire(new l.j(m))})}else typeof v=="object"&&this._updateDiff(v,a)}_updateDiff(v,a){try{this.style.setState(v,a)&&this._update(!0)}catch(f){l.w(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(v,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(v,a){return this._lazyInitEmptyStyle(),this.style.addSource(v,a),this._update(!0)}isSourceLoaded(v){const a=this.style&&this.style.sourceCaches[v];if(a!==void 0)return a.loaded();this.fire(new l.j(new Error(`There is no source with ID '${v}'`)))}setTerrain(v){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),v){const a=this.style.sourceCaches[v.source];if(!a)throw new Error(`cannot load terrain, because there exists no source with ID: ${v.source}`);this.terrain===null&&a.reload();for(const f in this.style._layers){const m=this.style._layers[f];m.type==="hillshade"&&m.source===v.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new dg(this.painter,a,v),this.painter.renderToTexture=new Xp(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=f=>{f.dataType==="style"?this.terrain.sourceCache.freeRtt():f.dataType==="source"&&f.tile&&(f.sourceId!==v.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(f.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:v})),this}getTerrain(){var v,a;return(a=(v=this.terrain)===null||v===void 0?void 0:v.options)!==null&&a!==void 0?a:null}areTilesLoaded(){const v=this.style&&this.style.sourceCaches;for(const a in v){const f=v[a]._tiles;for(const m in f){const g=f[m];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}removeSource(v){return this.style.removeSource(v),this._update(!0)}getSource(v){return this.style.getSource(v)}addImage(v,a,f={}){const{pixelRatio:m=1,sdf:g=!1,stretchX:b,stretchY:T,content:L}=f;if(this._lazyInitEmptyStyle(),!(a instanceof HTMLImageElement||l.b(a))){if(a.width===void 0||a.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:k,height:z,data:j}=a,q=a;return this.style.addImage(v,{data:new l.R({width:k,height:z},new Uint8Array(j)),pixelRatio:m,stretchX:b,stretchY:T,content:L,sdf:g,version:0,userImage:q}),q.onAdd&&q.onAdd(this,v),this}}{const{width:k,height:z,data:j}=E.getImageData(a);this.style.addImage(v,{data:new l.R({width:k,height:z},j),pixelRatio:m,stretchX:b,stretchY:T,content:L,sdf:g,version:0})}}updateImage(v,a){const f=this.style.getImage(v);if(!f)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=a instanceof HTMLImageElement||l.b(a)?E.getImageData(a):a,{width:g,height:b,data:T}=m;if(g===void 0||b===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==f.data.width||b!==f.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const L=!(a instanceof HTMLImageElement||l.b(a));return f.data.replace(T,L),this.style.updateImage(v,f),this}getImage(v){return this.style.getImage(v)}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v){return G.getImage(this._requestManager.transformRequest(v,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(v,a){return this._lazyInitEmptyStyle(),this.style.addLayer(v,a),this._update(!0)}moveLayer(v,a){return this.style.moveLayer(v,a),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(v,a,f){return this.style.setLayerZoomRange(v,a,f),this._update(!0)}setFilter(v,a,f={}){return this.style.setFilter(v,a,f),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,a,f,m={}){return this.style.setPaintProperty(v,a,f,m),this._update(!0)}getPaintProperty(v,a){return this.style.getPaintProperty(v,a)}setLayoutProperty(v,a,f,m={}){return this.style.setLayoutProperty(v,a,f,m),this._update(!0)}getLayoutProperty(v,a){return this.style.getLayoutProperty(v,a)}setGlyphs(v,a={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(v,a),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(v,a,f={}){return this._lazyInitEmptyStyle(),this.style.addSprite(v,a,f,m=>{m||this._update(!0)}),this}removeSprite(v){return this._lazyInitEmptyStyle(),this.style.removeSprite(v),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(v,a={}){return this._lazyInitEmptyStyle(),this.style.setSprite(v,a,f=>{f||this._update(!0)}),this}setLight(v,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,a),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(v,a){return this.style.setFeatureState(v,a),this._update()}removeFeatureState(v,a){return this.style.removeFeatureState(v,a),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let v=0,a=0;return this._container&&(v=this._container.clientWidth||400,a=this._container.clientHeight||300),[v,a]}_setupContainer(){const v=this._container;v.classList.add("maplibregl-map");const a=this._canvasContainer=C.create("div","maplibregl-canvas-container",v);this._interactive&&a.classList.add("maplibregl-interactive"),this._canvas=C.create("canvas","maplibregl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const f=this._containerDimensions(),m=this._getClampedPixelRatio(f[0],f[1]);this._resizeCanvas(f[0],f[1],m);const g=this._controlContainer=C.create("div","maplibregl-control-container",v),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(T=>{b[T]=C.create("div",`maplibregl-ctrl-${T} `,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,a,f){this._canvas.width=Math.floor(f*v),this._canvas.height=Math.floor(f*a),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${a}px`}_setupPainter(){const v={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let a=null;this._canvas.addEventListener("webglcontextcreationerror",m=>{a={requestedAttributes:v},m&&(a.statusMessage=m.statusMessage,a.type=m.type)},{once:!0});const f=this._canvas.getContext("webgl2",v)||this._canvas.getContext("webgl",v);if(!f){const m="Failed to initialize WebGL";throw a?(a.message=m,new Error(JSON.stringify(a))):new Error(m)}this.painter=new tg(f,this.transform),A.testSupport(f)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_render(v){const a=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),this._removed)return;let f=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const g=this.transform.zoom,b=E.now();this.style.zoomHistory.update(g,b);const T=new l.a8(g,{now:b,fadeDuration:a,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),L=T.crossFadingFactor();L===1&&L===this._crossFadingFactor||(f=!0,this._crossFadingFactor=L),this.style.update(T)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,a,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:a,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bc.mark(l.bd.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||f)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const m=this._sourcesDirty||this._styleDirty||this._placementDirty;return m||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||m||(this._fullyLoaded=!0,l.bc.mark(l.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var v;this._hash&&this._hash.remove();for(const f of this._controls)f.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),G.removeThrottleControl(this._imageQueueHandle),(v=this._resizeObserver)===null||v===void 0||v.disconnect();const a=this.painter.context.gl.getExtension("WEBGL_lose_context");a&&a.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),C.remove(this._canvasContainer),C.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),l.bc.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,E.frameAsync(this._frameRequest).then(v=>{l.bc.frame(v),this._frameRequest=null,this._render(v)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get version(){return $p}getCameraTargetElevation(){return this.transform.elevation}},c.MapMouseEvent=Po,c.MapTouchEvent=ta,c.MapWheelEvent=jp,c.Marker=Uc,c.NavigationControl=class{constructor(v){this._updateZoomButtons=()=>{const a=this._map.getZoom(),f=a===this._map.getMaxZoom(),m=a===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())},this._rotateCompassArrow=()=>{const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=a},this._setButtonTitle=(a,f)=>{const m=this._map._getUIString(`NavigationControl.${f}`);a.title=m,a.setAttribute("aria-label",m)},this.options=l.e({},Kp,v),this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",a=>this._map.zoomIn({},{originalEvent:a})),C.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",a=>this._map.zoomOut({},{originalEvent:a})),C.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",a=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:a}):this._map.resetNorth({},{originalEvent:a})}),this._compassIcon=C.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Jp(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){C.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(v,a){const f=C.create("button",v,this._container);return f.type="button",f.addEventListener("click",a),f}},c.Popup=class extends l.E{constructor(v){super(),this.remove=()=>(this._content&&C.remove(this._content),this._container&&(C.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.k("close"))),this),this._onMouseUp=a=>{this._update(a.point)},this._onMouseMove=a=>{this._update(a.point)},this._onDrag=a=>{this._update(a.point)},this._update=a=>{var f;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=C.create("div","maplibregl-popup",this._map.getContainer()),this._tip=C.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const L of this.options.className.split(" "))this._container.classList.add(L);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Jh(this._lngLat,this._flatPos,this._map.transform):(f=this._lngLat)===null||f===void 0?void 0:f.wrap(),this._trackPointer&&!a)return;const m=this._flatPos=this._pos=this._trackPointer&&a?a:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&a?a:this._map.transform.locationPoint(this._lngLat));let g=this.options.anchor;const b=rf(this.options.offset);if(!g){const L=this._container.offsetWidth,k=this._container.offsetHeight;let z;z=m.y+b.bottom.y<k?["top"]:m.y>this._map.transform.height-k?["bottom"]:[],m.x<L/2?z.push("left"):m.x>this._map.transform.width-L/2&&z.push("right"),g=z.length===0?"bottom":z.join("-")}let T=m.add(b[g]);this.options.subpixelPositioning||(T=T.round()),C.setTransform(this._container,`${Vc[g]} translate(${T.x}px,${T.y}px)`),Qh(this._container,g,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Qp),v)}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(v){return this._lngLat=l.M.convert(v),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){const a=document.createDocumentFragment(),f=document.createElement("body");let m;for(f.innerHTML=v;m=f.firstChild,m;)a.appendChild(m);return this.setDOMContent(a)}getMaxWidth(){var v;return(v=this._container)===null||v===void 0?void 0:v.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=C.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(v),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(v){this._container&&this._container.classList.add(v)}removeClassName(v){this._container&&this._container.classList.remove(v)}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){if(this._container)return this._container.classList.toggle(v)}setSubpixelPositioning(v){this.options.subpixelPositioning=v}_createCloseButton(){this.options.closeButton&&(this._closeButton=C.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(ed);v&&v.focus()}},c.RasterDEMTileSource=tn,c.RasterTileSource=me,c.ScaleControl=class{constructor(v){this._onMove=()=>{nf(this._map,this._container,this.options)},this.setUnit=a=>{this.options.unit=a,nf(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},tf),v)}getDefaultPosition(){return"bottom-left"}onAdd(v){return this._map=v,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){C.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},c.ScrollZoomHandler=Yh,c.Style=Ho,c.TerrainControl=class{constructor(v){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=v}onAdd(v){return this._map=v,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=C.create("button","maplibregl-ctrl-terrain",this._container),C.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){C.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},c.TwoFingersTouchPitchHandler=ug,c.TwoFingersTouchRotateHandler=qp,c.TwoFingersTouchZoomHandler=lg,c.TwoFingersTouchZoomRotateHandler=Nc,c.VectorTileSource=Nt,c.VideoSource=Ai,c.addSourceType=(v,a)=>l._(void 0,void 0,void 0,function*(){if(al(v))throw new Error(`A source type called "${v}" already exists.`);((f,m)=>{Js[f]=m})(v,a)}),c.clearPrewarmedResources=function(){const v=an;v&&(v.isPreloaded()&&v.numActive()===1?(v.release(Ot),an=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},c.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},c.getRTLTextPluginStatus=function(){return lt().getRTLTextPluginStatus()},c.getVersion=function(){return mg},c.getWorkerCount=function(){return ln.workerCount},c.getWorkerUrl=function(){return l.a.WORKER_URL},c.importScriptInWorkers=function(v){return rr().broadcast("IS",v)},c.prewarm=function(){En().acquire(Ot)},c.setMaxParallelImageRequests=function(v){l.a.MAX_PARALLEL_IMAGE_REQUESTS=v},c.setRTLTextPlugin=function(v,a){return lt().setRTLTextPlugin(v,a)},c.setWorkerCount=function(v){ln.workerCount=v},c.setWorkerUrl=function(v){l.a.WORKER_URL=v}});var o=n;return o})})(KE);var Q_=KE.exports;const Vs=d1(Q_),yf=[];function D0(t,e){return{subscribe:Gn(t,e).subscribe}}function Gn(t,e=Mt){let n;const r=new Set;function i(l){if(Ht(t,l)&&(t=l,n)){const d=!yf.length;for(const y of r)y[1](),yf.push(y,t);if(d){for(let y=0;y<yf.length;y+=2)yf[y][0](yf[y+1]);yf.length=0}}}function o(l){i(l(t))}function c(l,d=Mt){const y=[l,d];return r.add(y),r.size===1&&(n=e(i,o)||Mt),l(t),()=>{r.delete(y),r.size===0&&n&&(n(),n=null)}}return{set:i,update:o,subscribe:c}}let Gt;const QE=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&QE.decode();let Nd=null;function qd(){return(Nd===null||Nd.byteLength===0)&&(Nd=new Uint8Array(Gt.memory.buffer)),Nd}function fa(t,e){return t=t>>>0,QE.decode(qd().subarray(t,t+e))}const lu=new Array(128).fill(void 0);lu.push(void 0,null,!0,!1);let Wd=lu.length;function mi(t){Wd===lu.length&&lu.push(lu.length+1);const e=Wd;return Wd=lu[e],lu[e]=t,e}function Bn(t){return lu[t]}function pM(t){t<132||(lu[t]=Wd,Wd=t)}function Cf(t){const e=Bn(t);return pM(t),e}function R0(t){return t==null}let Od=null;function dM(){return(Od===null||Od.byteLength===0)&&(Od=new Float64Array(Gt.memory.buffer)),Od}let zd=null;function Yn(){return(zd===null||zd.byteLength===0)&&(zd=new Int32Array(Gt.memory.buffer)),zd}let Ku=0;const Qg=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},mM=typeof Qg.encodeInto=="function"?function(t,e){return Qg.encodeInto(t,e)}:function(t,e){const n=Qg.encode(t);return e.set(n),{read:t.length,written:n.length}};function Bg(t,e,n){if(n===void 0){const l=Qg.encode(t),d=e(l.length,1)>>>0;return qd().subarray(d,d+l.length).set(l),Ku=l.length,d}let r=t.length,i=e(r,1)>>>0;const o=qd();let c=0;for(;c<r;c++){const l=t.charCodeAt(c);if(l>127)break;o[i+c]=l}if(c!==r){c!==0&&(t=t.slice(c)),i=n(i,r,r=c+t.length*3,1)>>>0;const l=qd().subarray(i+c,i+r),d=mM(t,l);c+=d.written}return Ku=c,i}function mv(t){const e=typeof t;if(e=="number"||e=="boolean"||t==null)return`${t}`;if(e=="string")return`"${t}"`;if(e=="symbol"){const i=t.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=t.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(t)){const i=t.length;let o="[";i>0&&(o+=mv(t[0]));for(let c=1;c<i;c++)o+=", "+mv(t[c]);return o+="]",o}const n=/\[object ([^\]]+)\]/.exec(toString.call(t));let r;if(n.length>1)r=n[1];else return toString.call(t);if(r=="Object")try{return"Object("+JSON.stringify(t)+")"}catch{return"Object"}return t instanceof Error?`${t.name}: ${t.message}
${t.stack}`:r}function gM(t,e){const n=e(t.length*1,1)>>>0;return qd().set(t,n/1),Ku=t.length,n}function N0(t,e){try{return t.apply(this,e)}catch(n){Gt.__wbindgen_exn_store(mi(n))}}class m_{static __wrap(e){e=e>>>0;const n=Object.create(m_.prototype);return n.__wbg_ptr=e,n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Gt.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=Gt.__wbindgen_add_to_stack_pointer(-16),c=gM(e,Gt.__wbindgen_malloc),l=Ku;Gt.jsroutesnapper_new(o,c,l);var n=Yn()[o/4+0],r=Yn()[o/4+1],i=Yn()[o/4+2];if(i)throw Cf(r);return m_.__wrap(n)}finally{Gt.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){Gt.jsroutesnapper_setRouteConfig(this.__wbg_ptr,mi(e))}setAreaMode(){Gt.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,n;try{const o=Gt.__wbindgen_add_to_stack_pointer(-16);Gt.jsroutesnapper_getConfig(o,this.__wbg_ptr);var r=Yn()[o/4+0],i=Yn()[o/4+1];return e=r,n=i,fa(r,i)}finally{Gt.__wbindgen_add_to_stack_pointer(16),Gt.__wbindgen_free(e,n,1)}}toFinalFeature(){try{const r=Gt.__wbindgen_add_to_stack_pointer(-16);Gt.jsroutesnapper_toFinalFeature(r,this.__wbg_ptr);var e=Yn()[r/4+0],n=Yn()[r/4+1];let i;return e!==0&&(i=fa(e,n).slice(),Gt.__wbindgen_free(e,n*1)),i}finally{Gt.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,n;try{const o=Gt.__wbindgen_add_to_stack_pointer(-16);Gt.jsroutesnapper_renderGeojson(o,this.__wbg_ptr);var r=Yn()[o/4+0],i=Yn()[o/4+1];return e=r,n=i,fa(r,i)}finally{Gt.__wbindgen_add_to_stack_pointer(16),Gt.__wbindgen_free(e,n,1)}}toggleSnapMode(){Gt.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,n,r){return Gt.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,n,r)!==0}onClick(){Gt.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return Gt.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return Gt.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){Gt.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const i=Gt.__wbindgen_add_to_stack_pointer(-16);Gt.jsroutesnapper_editExisting(i,this.__wbg_ptr,mi(e));var n=Yn()[i/4+0],r=Yn()[i/4+1];if(r)throw Cf(n)}finally{Gt.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,n;try{const o=Gt.__wbindgen_add_to_stack_pointer(-16);Gt.jsroutesnapper_debugRenderGraph(o,this.__wbg_ptr);var r=Yn()[o/4+0],i=Yn()[o/4+1];return e=r,n=i,fa(r,i)}finally{Gt.__wbindgen_add_to_stack_pointer(16),Gt.__wbindgen_free(e,n,1)}}debugSnappableNodes(){let e,n;try{const o=Gt.__wbindgen_add_to_stack_pointer(-16);Gt.jsroutesnapper_debugSnappableNodes(o,this.__wbg_ptr);var r=Yn()[o/4+0],i=Yn()[o/4+1];return e=r,n=i,fa(r,i)}finally{Gt.__wbindgen_add_to_stack_pointer(16),Gt.__wbindgen_free(e,n,1)}}routeNameForWaypoints(e){let n,r;try{const S=Gt.__wbindgen_add_to_stack_pointer(-16);Gt.jsroutesnapper_routeNameForWaypoints(S,this.__wbg_ptr,mi(e));var i=Yn()[S/4+0],o=Yn()[S/4+1],c=Yn()[S/4+2],l=Yn()[S/4+3],d=i,y=o;if(l)throw d=0,y=0,Cf(c);return n=d,r=y,fa(d,y)}finally{Gt.__wbindgen_add_to_stack_pointer(16),Gt.__wbindgen_free(n,r,1)}}addSnappedWaypoint(e,n){Gt.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,n)}undo(){Gt.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let n,r;try{const S=Gt.__wbindgen_add_to_stack_pointer(-16);Gt.jsroutesnapper_calculateRoute(S,this.__wbg_ptr,mi(e));var i=Yn()[S/4+0],o=Yn()[S/4+1],c=Yn()[S/4+2],l=Yn()[S/4+3],d=i,y=o;if(l)throw d=0,y=0,Cf(c);return n=d,r=y,fa(d,y)}finally{Gt.__wbindgen_add_to_stack_pointer(16),Gt.__wbindgen_free(n,r,1)}}getExtraNodes(e,n){let r,i;try{const E=Gt.__wbindgen_add_to_stack_pointer(-16);Gt.jsroutesnapper_getExtraNodes(E,this.__wbg_ptr,mi(e),mi(n));var o=Yn()[E/4+0],c=Yn()[E/4+1],l=Yn()[E/4+2],d=Yn()[E/4+3],y=o,S=c;if(d)throw y=0,S=0,Cf(l);return r=y,i=S,fa(y,S)}finally{Gt.__wbindgen_add_to_stack_pointer(16),Gt.__wbindgen_free(r,i,1)}}}async function _M(t,e){if(typeof Response=="function"&&t instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,e)}catch(r){if(t.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const n=await t.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}function yM(){const t={};return t.wbg={},t.wbg.__wbindgen_string_new=function(e,n){const r=fa(e,n);return mi(r)},t.wbg.__wbindgen_object_drop_ref=function(e){Cf(e)},t.wbg.__wbindgen_error_new=function(e,n){const r=new Error(fa(e,n));return mi(r)},t.wbg.__wbindgen_number_get=function(e,n){const r=Bn(n),i=typeof r=="number"?r:void 0;dM()[e/8+1]=R0(i)?0:i,Yn()[e/4+0]=!R0(i)},t.wbg.__wbindgen_is_object=function(e){const n=Bn(e);return typeof n=="object"&&n!==null},t.wbg.__wbindgen_is_undefined=function(e){return Bn(e)===void 0},t.wbg.__wbindgen_in=function(e,n){return Bn(e)in Bn(n)},t.wbg.__wbindgen_boolean_get=function(e){const n=Bn(e);return typeof n=="boolean"?n?1:0:2},t.wbg.__wbindgen_jsval_loose_eq=function(e,n){return Bn(e)==Bn(n)},t.wbg.__wbindgen_string_get=function(e,n){const r=Bn(n),i=typeof r=="string"?r:void 0;var o=R0(i)?0:Bg(i,Gt.__wbindgen_malloc,Gt.__wbindgen_realloc),c=Ku;Yn()[e/4+1]=c,Yn()[e/4+0]=o},t.wbg.__wbg_String_4370c5505c674d30=function(e,n){const r=String(Bn(n)),i=Bg(r,Gt.__wbindgen_malloc,Gt.__wbindgen_realloc),o=Ku;Yn()[e/4+1]=o,Yn()[e/4+0]=i},t.wbg.__wbindgen_object_clone_ref=function(e){const n=Bn(e);return mi(n)},t.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,n){const r=Bn(e)[Bn(n)];return mi(r)},t.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return mi(e)},t.wbg.__wbg_stack_658279fe44541cf6=function(e,n){const r=Bn(n).stack,i=Bg(r,Gt.__wbindgen_malloc,Gt.__wbindgen_realloc),o=Ku;Yn()[e/4+1]=o,Yn()[e/4+0]=i},t.wbg.__wbg_error_f851667af71bcfc6=function(e,n){let r,i;try{r=e,i=n,console.error(fa(e,n))}finally{Gt.__wbindgen_free(r,i,1)}},t.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Bn(e))},t.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Bn(e))},t.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Bn(e))},t.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Bn(e))},t.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Bn(e))},t.wbg.__wbg_get_44be0491f933a435=function(e,n){const r=Bn(e)[n>>>0];return mi(r)},t.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Bn(e).length},t.wbg.__wbindgen_is_function=function(e){return typeof Bn(e)=="function"},t.wbg.__wbg_next_526fc47e980da008=function(e){const n=Bn(e).next;return mi(n)},t.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return N0(function(e){const n=Bn(e).next();return mi(n)},arguments)},t.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Bn(e).done},t.wbg.__wbg_value_1695675138684bd5=function(e){const n=Bn(e).value;return mi(n)},t.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return mi(Symbol.iterator)},t.wbg.__wbg_get_97b561fb56f034b5=function(){return N0(function(e,n){const r=Reflect.get(Bn(e),Bn(n));return mi(r)},arguments)},t.wbg.__wbg_call_cb65541d95d71282=function(){return N0(function(e,n){const r=Bn(e).call(Bn(n));return mi(r)},arguments)},t.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Bn(e))},t.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let n;try{n=Bn(e)instanceof ArrayBuffer}catch{n=!1}return n},t.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const n=Bn(e).buffer;return mi(n)},t.wbg.__wbg_new_8125e318e6245eed=function(e){const n=new Uint8Array(Bn(e));return mi(n)},t.wbg.__wbg_set_5cf90238115182c3=function(e,n,r){Bn(e).set(Bn(n),r>>>0)},t.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Bn(e).length},t.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let n;try{n=Bn(e)instanceof Uint8Array}catch{n=!1}return n},t.wbg.__wbindgen_debug_string=function(e,n){const r=mv(Bn(n)),i=Bg(r,Gt.__wbindgen_malloc,Gt.__wbindgen_realloc),o=Ku;Yn()[e/4+1]=o,Yn()[e/4+0]=i},t.wbg.__wbindgen_throw=function(e,n){throw new Error(fa(e,n))},t.wbg.__wbindgen_memory=function(){const e=Gt.memory;return mi(e)},t}function vM(t,e){return Gt=t.exports,eI.__wbindgen_wasm_module=e,Od=null,zd=null,Nd=null,Gt}async function eI(t){if(Gt!==void 0)return Gt;typeof t>"u"&&(t="/ltn/assets/route_snapper_bg.wasm");const e=yM();(typeof t=="string"||typeof Request=="function"&&t instanceof Request||typeof URL=="function"&&t instanceof URL)&&(t=fetch(t));const{instance:n,module:r}=await _M(await t,e);return vM(n,r)}var zo=63710088e-1,m1={centimeters:zo*100,centimetres:zo*100,degrees:zo/111325,feet:zo*3.28084,inches:zo*39.37,kilometers:zo/1e3,kilometres:zo/1e3,meters:zo,metres:zo,miles:zo/1609.344,millimeters:zo*1e3,millimetres:zo*1e3,nauticalmiles:zo/1852,radians:1,yards:zo*1.0936},bM={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/zo,yards:1.0936133},gv={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function wa(t,e,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function xM(t,e,n){switch(t){case"Point":return vs(e).geometry;case"LineString":return ma(e).geometry;case"Polygon":return g1(e).geometry;case"MultiPoint":return nI(e).geometry;case"MultiLineString":return tI(e).geometry;case"MultiPolygon":return rI(e).geometry;default:throw new Error(t+" is invalid")}}function vs(t,e,n){if(n===void 0&&(n={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!g_(t[0])||!g_(t[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:t};return wa(r,e,n)}function wM(t,e,n){return n===void 0&&(n={}),$c(t.map(function(r){return vs(r,e)}),n)}function g1(t,e,n){n===void 0&&(n={});for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var c=0;c<o[o.length-1].length;c++)if(o[o.length-1][c]!==o[0][c])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:t};return wa(l,e,n)}function SM(t,e,n){return n===void 0&&(n={}),$c(t.map(function(r){return g1(r,e)}),n)}function ma(t,e,n){if(n===void 0&&(n={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:t};return wa(r,e,n)}function EM(t,e,n){return n===void 0&&(n={}),$c(t.map(function(r){return ma(r,e)}),n)}function $c(t,e){e===void 0&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function tI(t,e,n){n===void 0&&(n={});var r={type:"MultiLineString",coordinates:t};return wa(r,e,n)}function nI(t,e,n){n===void 0&&(n={});var r={type:"MultiPoint",coordinates:t};return wa(r,e,n)}function rI(t,e,n){n===void 0&&(n={});var r={type:"MultiPolygon",coordinates:t};return wa(r,e,n)}function IM(t,e,n){n===void 0&&(n={});var r={type:"GeometryCollection",geometries:t};return wa(r,e,n)}function CM(t,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,e||0);return Math.round(t*n)/n}function _1(t,e){e===void 0&&(e="kilometers");var n=m1[e];if(!n)throw new Error(e+" units is invalid");return t*n}function ey(t,e){e===void 0&&(e="kilometers");var n=m1[e];if(!n)throw new Error(e+" units is invalid");return t/n}function TM(t,e){return Qd(ey(t,e))}function LM(t){var e=t%360;return e<0&&(e+=360),e}function Qd(t){var e=t%(2*Math.PI);return e*180/Math.PI}function ga(t){var e=t%360;return e*Math.PI/180}function PM(t,e,n){if(e===void 0&&(e="kilometers"),n===void 0&&(n="kilometers"),!(t>=0))throw new Error("length must be a positive number");return _1(ey(t,e),n)}function MM(t,e,n){if(e===void 0&&(e="meters"),n===void 0&&(n="kilometers"),!(t>=0))throw new Error("area must be a positive number");var r=gv[e];if(!r)throw new Error("invalid original units");var i=gv[n];if(!i)throw new Error("invalid final units");return t/r*i}function g_(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function y1(t){return!!t&&t.constructor===Object}function kM(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(function(e){if(!g_(e))throw new Error("bbox must only contain numbers")})}function AM(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}const DM=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:gv,bearingToAzimuth:LM,convertArea:MM,convertLength:PM,degreesToRadians:ga,earthRadius:zo,factors:m1,feature:wa,featureCollection:$c,geometry:xM,geometryCollection:IM,isNumber:g_,isObject:y1,lengthToDegrees:TM,lengthToRadians:ey,lineString:ma,lineStrings:EM,multiLineString:tI,multiPoint:nI,multiPolygon:rI,point:vs,points:wM,polygon:g1,polygons:SM,radiansToDegrees:Qd,radiansToLength:_1,round:CM,unitsFactors:bM,validateBBox:kM,validateId:AM},Symbol.toStringTag,{value:"Module"}));function em(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return t.geometry.coordinates;if(t.type==="Point")return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Of(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Sd(t,e,n){n===void 0&&(n={});var r=em(t),i=em(e),o=ga(i[1]-r[1]),c=ga(i[0]-r[0]),l=ga(r[1]),d=ga(i[1]),y=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(c/2),2)*Math.cos(l)*Math.cos(d);return _1(2*Math.atan2(Math.sqrt(y),Math.sqrt(1-y)),n.units)}function wm(t,e,n){if(t!==null)for(var r,i,o,c,l,d,y,S=0,E=0,C,A=t.type,M=A==="FeatureCollection",R=A==="Feature",N=M?t.features.length:1,B=0;B<N;B++){y=M?t.features[B].geometry:R?t.geometry:t,C=y?y.type==="GeometryCollection":!1,l=C?y.geometries.length:1;for(var O=0;O<l;O++){var G=0,U=0;if(c=C?y.geometries[O]:y,c!==null){d=c.coordinates;var Z=c.type;switch(S=n&&(Z==="Polygon"||Z==="MultiPolygon")?1:0,Z){case null:break;case"Point":if(e(d,E,B,G,U)===!1)return!1;E++,G++;break;case"LineString":case"MultiPoint":for(r=0;r<d.length;r++){if(e(d[r],E,B,G,U)===!1)return!1;E++,Z==="MultiPoint"&&G++}Z==="LineString"&&G++;break;case"Polygon":case"MultiLineString":for(r=0;r<d.length;r++){for(i=0;i<d[r].length-S;i++){if(e(d[r][i],E,B,G,U)===!1)return!1;E++}Z==="MultiLineString"&&G++,Z==="Polygon"&&U++}Z==="Polygon"&&G++;break;case"MultiPolygon":for(r=0;r<d.length;r++){for(U=0,i=0;i<d[r].length;i++){for(o=0;o<d[r][i].length-S;o++){if(e(d[r][i][o],E,B,G,U)===!1)return!1;E++}U++}G++}break;case"GeometryCollection":for(r=0;r<c.geometries.length;r++)if(wm(c.geometries[r],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function RM(t,e,n,r){var i=n;return wm(t,function(o,c,l,d,y){c===0&&n===void 0?i=o:i=e(i,o,c,l,d,y)},r),i}function iI(t,e){var n;switch(t.type){case"FeatureCollection":for(n=0;n<t.features.length&&e(t.features[n].properties,n)!==!1;n++);break;case"Feature":e(t.properties,0);break}}function NM(t,e,n){var r=n;return iI(t,function(i,o){o===0&&n===void 0?r=i:r=e(r,i,o)}),r}function __(t,e){if(t.type==="Feature")e(t,0);else if(t.type==="FeatureCollection")for(var n=0;n<t.features.length&&e(t.features[n],n)!==!1;n++);}function OM(t,e,n){var r=n;return __(t,function(i,o){o===0&&n===void 0?r=i:r=e(r,i,o)}),r}function zM(t){var e=[];return wm(t,function(n){e.push(n)}),e}function v1(t,e){var n,r,i,o,c,l,d,y,S,E,C=0,A=t.type==="FeatureCollection",M=t.type==="Feature",R=A?t.features.length:1;for(n=0;n<R;n++){for(l=A?t.features[n].geometry:M?t.geometry:t,y=A?t.features[n].properties:M?t.properties:{},S=A?t.features[n].bbox:M?t.bbox:void 0,E=A?t.features[n].id:M?t.id:void 0,d=l?l.type==="GeometryCollection":!1,c=d?l.geometries.length:1,i=0;i<c;i++){if(o=d?l.geometries[i]:l,o===null){if(e(null,C,y,S,E)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,C,y,S,E)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<o.geometries.length;r++)if(e(o.geometries[r],C,y,S,E)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}C++}}function FM(t,e,n){var r=n;return v1(t,function(i,o,c,l,d){o===0&&n===void 0?r=i:r=e(r,i,o,c,l,d)}),r}function pp(t,e){v1(t,function(n,r,i,o,c){var l=n===null?null:n.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return e(wa(n,i,{bbox:o,id:c}),r,0)===!1?!1:void 0}var d;switch(l){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var y=0;y<n.coordinates.length;y++){var S=n.coordinates[y],E={type:d,coordinates:S};if(e(wa(E,i),r,y)===!1)return!1}})}function BM(t,e,n){var r=n;return pp(t,function(i,o,c){o===0&&c===0&&n===void 0?r=i:r=e(r,i,o,c)}),r}function oI(t,e){pp(t,function(n,r,i){var o=0;if(n.geometry){var c=n.geometry.type;if(!(c==="Point"||c==="MultiPoint")){var l,d=0,y=0,S=0;if(wm(n,function(E,C,A,M,R){if(l===void 0||r>d||M>y||R>S){l=E,d=r,y=M,S=R,o=0;return}var N=ma([l,E],n.properties);if(e(N,r,i,R,o)===!1)return!1;o++,l=E})===!1)return!1}}})}function VM(t,e,n){var r=n,i=!1;return oI(t,function(o,c,l,d,y){i===!1&&n===void 0?r=o:r=e(r,o,c,l,d,y),i=!0}),r}function sI(t,e){if(!t)throw new Error("geojson is required");pp(t,function(n,r,i){if(n.geometry!==null){var o=n.geometry.type,c=n.geometry.coordinates;switch(o){case"LineString":if(e(n,r,i,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<c.length;l++)if(e(ma(c[l],n.properties),r,i,l)===!1)return!1;break}}})}function UM(t,e,n){var r=n;return sI(t,function(i,o,c,l){o===0&&n===void 0?r=i:r=e(r,i,o,c,l)}),r}function jM(t,e){if(e=e||{},!y1(e))throw new Error("options is invalid");var n=e.featureIndex||0,r=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,c=e.properties,l;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),c=c||t.features[n].properties,l=t.features[n].geometry;break;case"Feature":c=c||t.properties,l=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=t;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var d=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=d.length+o-1),ma([d[o],d[o+1]],c,e);case"Polygon":return i<0&&(i=d.length+i),o<0&&(o=d[i].length+o-1),ma([d[i][o],d[i][o+1]],c,e);case"MultiLineString":return r<0&&(r=d.length+r),o<0&&(o=d[r].length+o-1),ma([d[r][o],d[r][o+1]],c,e);case"MultiPolygon":return r<0&&(r=d.length+r),i<0&&(i=d[r].length+i),o<0&&(o=d[r][i].length-o-1),ma([d[r][i][o],d[r][i][o+1]],c,e)}throw new Error("geojson is invalid")}function GM(t,e){if(e=e||{},!y1(e))throw new Error("options is invalid");var n=e.featureIndex||0,r=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,c=e.properties,l;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),c=c||t.features[n].properties,l=t.features[n].geometry;break;case"Feature":c=c||t.properties,l=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=t;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var d=l.coordinates;switch(l.type){case"Point":return vs(d,c,e);case"MultiPoint":return r<0&&(r=d.length+r),vs(d[r],c,e);case"LineString":return o<0&&(o=d.length+o),vs(d[o],c,e);case"Polygon":return i<0&&(i=d.length+i),o<0&&(o=d[i].length+o),vs(d[i][o],c,e);case"MultiLineString":return r<0&&(r=d.length+r),o<0&&(o=d[r].length+o),vs(d[r][o],c,e);case"MultiPolygon":return r<0&&(r=d.length+r),i<0&&(i=d[r].length+i),o<0&&(o=d[r][i].length-o),vs(d[r][i][o],c,e)}throw new Error("geojson is invalid")}const qM=Object.freeze(Object.defineProperty({__proto__:null,coordAll:zM,coordEach:wm,coordReduce:RM,featureEach:__,featureReduce:OM,findPoint:GM,findSegment:jM,flattenEach:pp,flattenReduce:BM,geomEach:v1,geomReduce:FM,lineEach:sI,lineReduce:UM,propEach:iI,propReduce:NM,segmentEach:oI,segmentReduce:VM},Symbol.toStringTag,{value:"Module"}));function aI(t,e,n){if(n===void 0&&(n={}),n.final===!0)return WM(t,e);var r=em(t),i=em(e),o=ga(r[0]),c=ga(i[0]),l=ga(r[1]),d=ga(i[1]),y=Math.sin(c-o)*Math.cos(d),S=Math.cos(l)*Math.sin(d)-Math.sin(l)*Math.cos(d)*Math.cos(c-o);return Qd(Math.atan2(y,S))}function WM(t,e){var n=aI(e,t);return n=(n+180)%360,n}function Kx(t,e,n,r){r===void 0&&(r={});var i=em(t),o=ga(i[0]),c=ga(i[1]),l=ga(n),d=ey(e,r.units),y=Math.asin(Math.sin(c)*Math.cos(d)+Math.cos(c)*Math.sin(d)*Math.cos(l)),S=o+Math.atan2(Math.sin(l)*Math.sin(d)*Math.cos(c),Math.cos(d)-Math.sin(c)*Math.sin(y)),E=Qd(S),C=Qd(y);return vs([E,C],r.properties)}function Jx(t){if(!t)throw new Error("geojson is required");var e=[];return pp(t,function(n){HM(n,e)}),$c(e)}function HM(t,e){var n=[],r=t.geometry;if(r!==null){switch(r.type){case"Polygon":n=Of(r);break;case"LineString":n=[Of(r)]}n.forEach(function(i){var o=ZM(i,t.properties);o.forEach(function(c){c.id=e.length,e.push(c)})})}}function ZM(t,e){var n=[];return t.reduce(function(r,i){var o=ma([r,i],e);return o.bbox=XM(r,i),n.push(o),i}),n}function XM(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],c=n<i?n:i,l=r<o?r:o,d=n>i?n:i,y=r>o?r:o;return[c,l,d,y]}var b1={exports:{}},lI={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(xm,function(){function n(O,G,U,Z,ue){(function ae(se,fe,ke,K,oe){for(;K>ke;){if(K-ke>600){var Ge=K-ke+1,Te=fe-ke+1,ot=Math.log(Ge),ft=.5*Math.exp(2*ot/3),At=.5*Math.sqrt(ot*ft*(Ge-ft)/Ge)*(Te-Ge/2<0?-1:1),Ke=Math.max(ke,Math.floor(fe-Te*ft/Ge+At)),Ft=Math.min(K,Math.floor(fe+(Ge-Te)*ft/Ge+At));ae(se,fe,Ke,Ft,oe)}var bt=se[fe],Rt=ke,Ot=K;for(r(se,ke,fe),oe(se[K],bt)>0&&r(se,ke,K);Rt<Ot;){for(r(se,Rt,Ot),Rt++,Ot--;oe(se[Rt],bt)<0;)Rt++;for(;oe(se[Ot],bt)>0;)Ot--}oe(se[ke],bt)===0?r(se,ke,Ot):r(se,++Ot,K),Ot<=fe&&(ke=Ot+1),fe<=Ot&&(K=Ot-1)}})(O,G,U||0,Z||O.length-1,ue||i)}function r(O,G,U){var Z=O[G];O[G]=O[U],O[U]=Z}function i(O,G){return O<G?-1:O>G?1:0}var o=function(O){O===void 0&&(O=9),this._maxEntries=Math.max(4,O),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function c(O,G,U){if(!U)return G.indexOf(O);for(var Z=0;Z<G.length;Z++)if(U(O,G[Z]))return Z;return-1}function l(O,G){d(O,0,O.children.length,G,O)}function d(O,G,U,Z,ue){ue||(ue=N(null)),ue.minX=1/0,ue.minY=1/0,ue.maxX=-1/0,ue.maxY=-1/0;for(var ae=G;ae<U;ae++){var se=O.children[ae];y(ue,O.leaf?Z(se):se)}return ue}function y(O,G){return O.minX=Math.min(O.minX,G.minX),O.minY=Math.min(O.minY,G.minY),O.maxX=Math.max(O.maxX,G.maxX),O.maxY=Math.max(O.maxY,G.maxY),O}function S(O,G){return O.minX-G.minX}function E(O,G){return O.minY-G.minY}function C(O){return(O.maxX-O.minX)*(O.maxY-O.minY)}function A(O){return O.maxX-O.minX+(O.maxY-O.minY)}function M(O,G){return O.minX<=G.minX&&O.minY<=G.minY&&G.maxX<=O.maxX&&G.maxY<=O.maxY}function R(O,G){return G.minX<=O.maxX&&G.minY<=O.maxY&&G.maxX>=O.minX&&G.maxY>=O.minY}function N(O){return{children:O,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function B(O,G,U,Z,ue){for(var ae=[G,U];ae.length;)if(!((U=ae.pop())-(G=ae.pop())<=Z)){var se=G+Math.ceil((U-G)/Z/2)*Z;n(O,se,G,U,ue),ae.push(G,se,se,U)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(O){var G=this.data,U=[];if(!R(O,G))return U;for(var Z=this.toBBox,ue=[];G;){for(var ae=0;ae<G.children.length;ae++){var se=G.children[ae],fe=G.leaf?Z(se):se;R(O,fe)&&(G.leaf?U.push(se):M(O,fe)?this._all(se,U):ue.push(se))}G=ue.pop()}return U},o.prototype.collides=function(O){var G=this.data;if(!R(O,G))return!1;for(var U=[];G;){for(var Z=0;Z<G.children.length;Z++){var ue=G.children[Z],ae=G.leaf?this.toBBox(ue):ue;if(R(O,ae)){if(G.leaf||M(O,ae))return!0;U.push(ue)}}G=U.pop()}return!1},o.prototype.load=function(O){if(!O||!O.length)return this;if(O.length<this._minEntries){for(var G=0;G<O.length;G++)this.insert(O[G]);return this}var U=this._build(O.slice(),0,O.length-1,0);if(this.data.children.length)if(this.data.height===U.height)this._splitRoot(this.data,U);else{if(this.data.height<U.height){var Z=this.data;this.data=U,U=Z}this._insert(U,this.data.height-U.height-1,!0)}else this.data=U;return this},o.prototype.insert=function(O){return O&&this._insert(O,this.data.height-1),this},o.prototype.clear=function(){return this.data=N([]),this},o.prototype.remove=function(O,G){if(!O)return this;for(var U,Z,ue,ae=this.data,se=this.toBBox(O),fe=[],ke=[];ae||fe.length;){if(ae||(ae=fe.pop(),Z=fe[fe.length-1],U=ke.pop(),ue=!0),ae.leaf){var K=c(O,ae.children,G);if(K!==-1)return ae.children.splice(K,1),fe.push(ae),this._condense(fe),this}ue||ae.leaf||!M(ae,se)?Z?(U++,ae=Z.children[U],ue=!1):ae=null:(fe.push(ae),ke.push(U),U=0,Z=ae,ae=ae.children[0])}return this},o.prototype.toBBox=function(O){return O},o.prototype.compareMinX=function(O,G){return O.minX-G.minX},o.prototype.compareMinY=function(O,G){return O.minY-G.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(O){return this.data=O,this},o.prototype._all=function(O,G){for(var U=[];O;)O.leaf?G.push.apply(G,O.children):U.push.apply(U,O.children),O=U.pop();return G},o.prototype._build=function(O,G,U,Z){var ue,ae=U-G+1,se=this._maxEntries;if(ae<=se)return l(ue=N(O.slice(G,U+1)),this.toBBox),ue;Z||(Z=Math.ceil(Math.log(ae)/Math.log(se)),se=Math.ceil(ae/Math.pow(se,Z-1))),(ue=N([])).leaf=!1,ue.height=Z;var fe=Math.ceil(ae/se),ke=fe*Math.ceil(Math.sqrt(se));B(O,G,U,ke,this.compareMinX);for(var K=G;K<=U;K+=ke){var oe=Math.min(K+ke-1,U);B(O,K,oe,fe,this.compareMinY);for(var Ge=K;Ge<=oe;Ge+=fe){var Te=Math.min(Ge+fe-1,oe);ue.children.push(this._build(O,Ge,Te,Z-1))}}return l(ue,this.toBBox),ue},o.prototype._chooseSubtree=function(O,G,U,Z){for(;Z.push(G),!G.leaf&&Z.length-1!==U;){for(var ue=1/0,ae=1/0,se=void 0,fe=0;fe<G.children.length;fe++){var ke=G.children[fe],K=C(ke),oe=(Ge=O,Te=ke,(Math.max(Te.maxX,Ge.maxX)-Math.min(Te.minX,Ge.minX))*(Math.max(Te.maxY,Ge.maxY)-Math.min(Te.minY,Ge.minY))-K);oe<ae?(ae=oe,ue=K<ue?K:ue,se=ke):oe===ae&&K<ue&&(ue=K,se=ke)}G=se||G.children[0]}var Ge,Te;return G},o.prototype._insert=function(O,G,U){var Z=U?O:this.toBBox(O),ue=[],ae=this._chooseSubtree(Z,this.data,G,ue);for(ae.children.push(O),y(ae,Z);G>=0&&ue[G].children.length>this._maxEntries;)this._split(ue,G),G--;this._adjustParentBBoxes(Z,ue,G)},o.prototype._split=function(O,G){var U=O[G],Z=U.children.length,ue=this._minEntries;this._chooseSplitAxis(U,ue,Z);var ae=this._chooseSplitIndex(U,ue,Z),se=N(U.children.splice(ae,U.children.length-ae));se.height=U.height,se.leaf=U.leaf,l(U,this.toBBox),l(se,this.toBBox),G?O[G-1].children.push(se):this._splitRoot(U,se)},o.prototype._splitRoot=function(O,G){this.data=N([O,G]),this.data.height=O.height+1,this.data.leaf=!1,l(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(O,G,U){for(var Z,ue,ae,se,fe,ke,K,oe=1/0,Ge=1/0,Te=G;Te<=U-G;Te++){var ot=d(O,0,Te,this.toBBox),ft=d(O,Te,U,this.toBBox),At=(ue=ot,ae=ft,se=void 0,fe=void 0,ke=void 0,K=void 0,se=Math.max(ue.minX,ae.minX),fe=Math.max(ue.minY,ae.minY),ke=Math.min(ue.maxX,ae.maxX),K=Math.min(ue.maxY,ae.maxY),Math.max(0,ke-se)*Math.max(0,K-fe)),Ke=C(ot)+C(ft);At<oe?(oe=At,Z=Te,Ge=Ke<Ge?Ke:Ge):At===oe&&Ke<Ge&&(Ge=Ke,Z=Te)}return Z||U-G},o.prototype._chooseSplitAxis=function(O,G,U){var Z=O.leaf?this.compareMinX:S,ue=O.leaf?this.compareMinY:E;this._allDistMargin(O,G,U,Z)<this._allDistMargin(O,G,U,ue)&&O.children.sort(Z)},o.prototype._allDistMargin=function(O,G,U,Z){O.children.sort(Z);for(var ue=this.toBBox,ae=d(O,0,G,ue),se=d(O,U-G,U,ue),fe=A(ae)+A(se),ke=G;ke<U-G;ke++){var K=O.children[ke];y(ae,O.leaf?ue(K):K),fe+=A(ae)}for(var oe=U-G-1;oe>=G;oe--){var Ge=O.children[oe];y(se,O.leaf?ue(Ge):Ge),fe+=A(se)}return fe},o.prototype._adjustParentBBoxes=function(O,G,U){for(var Z=U;Z>=0;Z--)y(G[Z],O)},o.prototype._condense=function(O){for(var G=O.length-1,U=void 0;G>=0;G--)O[G].children.length===0?G>0?(U=O[G-1].children).splice(U.indexOf(O[G]),1):this.clear():l(O[G],this.toBBox)},o})})(lI);var YM=lI.exports;const $M=J_(DM),KM=J_(qM);var Qx=Object.prototype.toString,uI=function(e){var n=Qx.call(e),r=n==="[object Arguments]";return r||(r=n!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&Qx.call(e.callee)==="[object Function]"),r},O0,ew;function JM(){if(ew)return O0;ew=1;var t;if(!Object.keys){var e=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=uI,i=Object.prototype.propertyIsEnumerable,o=!i.call({toString:null},"toString"),c=i.call(function(){},"prototype"),l=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=function(C){var A=C.constructor;return A&&A.prototype===C},y={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},S=function(){if(typeof window>"u")return!1;for(var C in window)try{if(!y["$"+C]&&e.call(window,C)&&window[C]!==null&&typeof window[C]=="object")try{d(window[C])}catch{return!0}}catch{return!0}return!1}(),E=function(C){if(typeof window>"u"||!S)return d(C);try{return d(C)}catch{return!1}};t=function(A){var M=A!==null&&typeof A=="object",R=n.call(A)==="[object Function]",N=r(A),B=M&&n.call(A)==="[object String]",O=[];if(!M&&!R&&!N)throw new TypeError("Object.keys called on a non-object");var G=c&&R;if(B&&A.length>0&&!e.call(A,0))for(var U=0;U<A.length;++U)O.push(String(U));if(N&&A.length>0)for(var Z=0;Z<A.length;++Z)O.push(String(Z));else for(var ue in A)!(G&&ue==="prototype")&&e.call(A,ue)&&O.push(String(ue));if(o)for(var ae=E(A),se=0;se<l.length;++se)!(ae&&l[se]==="constructor")&&e.call(A,l[se])&&O.push(l[se]);return O}}return O0=t,O0}var QM=Array.prototype.slice,ek=uI,tw=Object.keys,e_=tw?function(e){return tw(e)}:JM(),nw=Object.keys;e_.shim=function(){if(Object.keys){var e=function(){var n=Object.keys(arguments);return n&&n.length===arguments.length}(1,2);e||(Object.keys=function(r){return ek(r)?nw(QM.call(r)):nw(r)})}else Object.keys=e_;return Object.keys||e_};var x1=e_,tk=Error,nk=EvalError,rk=RangeError,ik=ReferenceError,cI=SyntaxError,pc=TypeError,ok=URIError,ty=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},n=Symbol("test"),r=Object(n);if(typeof n=="string"||Object.prototype.toString.call(n)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var i=42;e[n]=i;for(n in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var o=Object.getOwnPropertySymbols(e);if(o.length!==1||o[0]!==n||!Object.prototype.propertyIsEnumerable.call(e,n))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var c=Object.getOwnPropertyDescriptor(e,n);if(c.value!==i||c.enumerable!==!0)return!1}return!0},rw=typeof Symbol<"u"&&Symbol,sk=ty,w1=function(){return typeof rw!="function"||typeof Symbol!="function"||typeof rw("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:sk()},z0={__proto__:null,foo:{}},ak=Object,lk=function(){return{__proto__:z0}.foo===z0.foo&&!(z0 instanceof ak)},uk="Function.prototype.bind called on incompatible ",ck=Object.prototype.toString,hk=Math.max,fk="[object Function]",iw=function(e,n){for(var r=[],i=0;i<e.length;i+=1)r[i]=e[i];for(var o=0;o<n.length;o+=1)r[o+e.length]=n[o];return r},pk=function(e,n){for(var r=[],i=n||0,o=0;i<e.length;i+=1,o+=1)r[o]=e[i];return r},dk=function(t,e){for(var n="",r=0;r<t.length;r+=1)n+=t[r],r+1<t.length&&(n+=e);return n},mk=function(e){var n=this;if(typeof n!="function"||ck.apply(n)!==fk)throw new TypeError(uk+n);for(var r=pk(arguments,1),i,o=function(){if(this instanceof i){var S=n.apply(this,iw(r,arguments));return Object(S)===S?S:this}return n.apply(e,iw(r,arguments))},c=hk(0,n.length-r.length),l=[],d=0;d<c;d++)l[d]="$"+d;if(i=Function("binder","return function ("+dk(l,",")+"){ return binder.apply(this,arguments); }")(o),n.prototype){var y=function(){};y.prototype=n.prototype,i.prototype=new y,y.prototype=null}return i},gk=mk,S1=Function.prototype.bind||gk,_k=Function.prototype.call,yk=Object.prototype.hasOwnProperty,vk=S1,hI=vk.call(_k,yk),Xn,bk=tk,xk=nk,wk=rk,Sk=ik,zf=cI,Df=pc,Ek=ok,fI=Function,F0=function(t){try{return fI('"use strict"; return ('+t+").constructor;")()}catch{}},Xc=Object.getOwnPropertyDescriptor;if(Xc)try{Xc({},"")}catch{Xc=null}var B0=function(){throw new Df},Ik=Xc?function(){try{return arguments.callee,B0}catch{try{return Xc(arguments,"callee").get}catch{return B0}}}():B0,vf=w1(),Ck=lk(),to=Object.getPrototypeOf||(Ck?function(t){return t.__proto__}:null),Tf={},Tk=typeof Uint8Array>"u"||!to?Xn:to(Uint8Array),Yc={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?Xn:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Xn:ArrayBuffer,"%ArrayIteratorPrototype%":vf&&to?to([][Symbol.iterator]()):Xn,"%AsyncFromSyncIteratorPrototype%":Xn,"%AsyncFunction%":Tf,"%AsyncGenerator%":Tf,"%AsyncGeneratorFunction%":Tf,"%AsyncIteratorPrototype%":Tf,"%Atomics%":typeof Atomics>"u"?Xn:Atomics,"%BigInt%":typeof BigInt>"u"?Xn:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Xn:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Xn:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Xn:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":bk,"%eval%":eval,"%EvalError%":xk,"%Float32Array%":typeof Float32Array>"u"?Xn:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Xn:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Xn:FinalizationRegistry,"%Function%":fI,"%GeneratorFunction%":Tf,"%Int8Array%":typeof Int8Array>"u"?Xn:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Xn:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Xn:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":vf&&to?to(to([][Symbol.iterator]())):Xn,"%JSON%":typeof JSON=="object"?JSON:Xn,"%Map%":typeof Map>"u"?Xn:Map,"%MapIteratorPrototype%":typeof Map>"u"||!vf||!to?Xn:to(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Xn:Promise,"%Proxy%":typeof Proxy>"u"?Xn:Proxy,"%RangeError%":wk,"%ReferenceError%":Sk,"%Reflect%":typeof Reflect>"u"?Xn:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Xn:Set,"%SetIteratorPrototype%":typeof Set>"u"||!vf||!to?Xn:to(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Xn:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":vf&&to?to(""[Symbol.iterator]()):Xn,"%Symbol%":vf?Symbol:Xn,"%SyntaxError%":zf,"%ThrowTypeError%":Ik,"%TypedArray%":Tk,"%TypeError%":Df,"%Uint8Array%":typeof Uint8Array>"u"?Xn:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Xn:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Xn:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Xn:Uint32Array,"%URIError%":Ek,"%WeakMap%":typeof WeakMap>"u"?Xn:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Xn:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Xn:WeakSet};if(to)try{null.error}catch(t){var Lk=to(to(t));Yc["%Error.prototype%"]=Lk}var Pk=function t(e){var n;if(e==="%AsyncFunction%")n=F0("async function () {}");else if(e==="%GeneratorFunction%")n=F0("function* () {}");else if(e==="%AsyncGeneratorFunction%")n=F0("async function* () {}");else if(e==="%AsyncGenerator%"){var r=t("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if(e==="%AsyncIteratorPrototype%"){var i=t("%AsyncGenerator%");i&&to&&(n=to(i.prototype))}return Yc[e]=n,n},ow={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Sm=S1,y_=hI,Mk=Sm.call(Function.call,Array.prototype.concat),kk=Sm.call(Function.apply,Array.prototype.splice),sw=Sm.call(Function.call,String.prototype.replace),v_=Sm.call(Function.call,String.prototype.slice),Ak=Sm.call(Function.call,RegExp.prototype.exec),Dk=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Rk=/\\(\\)?/g,Nk=function(e){var n=v_(e,0,1),r=v_(e,-1);if(n==="%"&&r!=="%")throw new zf("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&n!=="%")throw new zf("invalid intrinsic syntax, expected opening `%`");var i=[];return sw(e,Dk,function(o,c,l,d){i[i.length]=l?sw(d,Rk,"$1"):c||o}),i},Ok=function(e,n){var r=e,i;if(y_(ow,r)&&(i=ow[r],r="%"+i[0]+"%"),y_(Yc,r)){var o=Yc[r];if(o===Tf&&(o=Pk(r)),typeof o>"u"&&!n)throw new Df("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:r,value:o}}throw new zf("intrinsic "+e+" does not exist!")},Fl=function(e,n){if(typeof e!="string"||e.length===0)throw new Df("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof n!="boolean")throw new Df('"allowMissing" argument must be a boolean');if(Ak(/^%?[^%]*%?$/,e)===null)throw new zf("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=Nk(e),i=r.length>0?r[0]:"",o=Ok("%"+i+"%",n),c=o.name,l=o.value,d=!1,y=o.alias;y&&(i=y[0],kk(r,Mk([0,1],y)));for(var S=1,E=!0;S<r.length;S+=1){var C=r[S],A=v_(C,0,1),M=v_(C,-1);if((A==='"'||A==="'"||A==="`"||M==='"'||M==="'"||M==="`")&&A!==M)throw new zf("property names with quotes must have matching quotes");if((C==="constructor"||!E)&&(d=!0),i+="."+C,c="%"+i+"%",y_(Yc,c))l=Yc[c];else if(l!=null){if(!(C in l)){if(!n)throw new Df("base intrinsic for "+e+" exists, but the property is not available.");return}if(Xc&&S+1>=r.length){var R=Xc(l,C);E=!!R,E&&"get"in R&&!("originalValue"in R.get)?l=R.get:l=l[C]}else E=y_(l,C),l=l[C];E&&!d&&(Yc[c]=l)}}return l},V0,aw;function E1(){if(aw)return V0;aw=1;var t=Fl,e=t("%Object.defineProperty%",!0)||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return V0=e,V0}var zk=Fl,t_=zk("%Object.getOwnPropertyDescriptor%",!0);if(t_)try{t_([],"length")}catch{t_=null}var I1=t_,lw=E1(),Fk=cI,bf=pc,uw=I1,C1=function(e,n,r){if(!e||typeof e!="object"&&typeof e!="function")throw new bf("`obj` must be an object or a function`");if(typeof n!="string"&&typeof n!="symbol")throw new bf("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new bf("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new bf("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new bf("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new bf("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,o=arguments.length>4?arguments[4]:null,c=arguments.length>5?arguments[5]:null,l=arguments.length>6?arguments[6]:!1,d=!!uw&&uw(e,n);if(lw)lw(e,n,{configurable:c===null&&d?d.configurable:!c,enumerable:i===null&&d?d.enumerable:!i,value:r,writable:o===null&&d?d.writable:!o});else if(l||!i&&!o&&!c)e[n]=r;else throw new Fk("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},_v=E1(),pI=function(){return!!_v};pI.hasArrayLengthDefineBug=function(){if(!_v)return null;try{return _v([],"length",{value:1}).length!==1}catch{return!0}};var T1=pI,Bk=x1,Vk=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",Uk=Object.prototype.toString,jk=Array.prototype.concat,cw=C1,Gk=function(t){return typeof t=="function"&&Uk.call(t)==="[object Function]"},dI=T1(),qk=function(t,e,n,r){if(e in t){if(r===!0){if(t[e]===n)return}else if(!Gk(r)||!r())return}dI?cw(t,e,n,!0):cw(t,e,n)},mI=function(t,e){var n=arguments.length>2?arguments[2]:{},r=Bk(e);Vk&&(r=jk.call(r,Object.getOwnPropertySymbols(e)));for(var i=0;i<r.length;i+=1)qk(t,r[i],e[r[i]],n[r[i]])};mI.supportsDescriptors=!!dI;var hh=mI,gI={exports:{}},Wk=Fl,hw=C1,Hk=T1(),fw=I1,pw=pc,Zk=Wk("%Math.floor%"),Xk=function(e,n){if(typeof e!="function")throw new pw("`fn` is not a function");if(typeof n!="number"||n<0||n>4294967295||Zk(n)!==n)throw new pw("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],i=!0,o=!0;if("length"in e&&fw){var c=fw(e,"length");c&&!c.configurable&&(i=!1),c&&!c.writable&&(o=!1)}return(i||o||!r)&&(Hk?hw(e,"length",n,!0,!0):hw(e,"length",n)),e};(function(t){var e=S1,n=Fl,r=Xk,i=pc,o=n("%Function.prototype.apply%"),c=n("%Function.prototype.call%"),l=n("%Reflect.apply%",!0)||e.call(c,o),d=E1(),y=n("%Math.max%");t.exports=function(C){if(typeof C!="function")throw new i("a function is required");var A=l(e,c,arguments);return r(A,1+y(0,C.length-(arguments.length-1)),!0)};var S=function(){return l(e,o,arguments)};d?d(t.exports,"apply",{value:S}):t.exports.apply=S})(gI);var dp=gI.exports,_I=Fl,yI=dp,Yk=yI(_I("String.prototype.indexOf")),Da=function(e,n){var r=_I(e,!!n);return typeof r=="function"&&Yk(e,".prototype.")>-1?yI(r):r},$k=x1,vI=ty(),bI=Da,dw=Object,Kk=bI("Array.prototype.push"),mw=bI("Object.prototype.propertyIsEnumerable"),Jk=vI?Object.getOwnPropertySymbols:null,xI=function(e,n){if(e==null)throw new TypeError("target must be an object");var r=dw(e);if(arguments.length===1)return r;for(var i=1;i<arguments.length;++i){var o=dw(arguments[i]),c=$k(o),l=vI&&(Object.getOwnPropertySymbols||Jk);if(l)for(var d=l(o),y=0;y<d.length;++y){var S=d[y];mw(o,S)&&Kk(c,S)}for(var E=0;E<c.length;++E){var C=c[E];if(mw(o,C)){var A=o[C];r[C]=A}}}return r},U0=xI,Qk=function(){if(!Object.assign)return!1;for(var t="abcdefghijklmnopqrst",e=t.split(""),n={},r=0;r<e.length;++r)n[e[r]]=e[r];var i=Object.assign({},n),o="";for(var c in i)o+=c;return t!==o},eA=function(){if(!Object.assign||!Object.preventExtensions)return!1;var t=Object.preventExtensions({1:2});try{Object.assign(t,"xy")}catch{return t[1]==="y"}return!1},wI=function(){return!Object.assign||Qk()||eA()?U0:Object.assign},tA=hh,nA=wI,rA=function(){var e=nA();return tA(Object,{assign:e},{assign:function(){return Object.assign!==e}}),e},iA=hh,oA=dp,sA=xI,SI=wI,aA=rA,lA=oA.apply(SI()),EI=function(e,n){return lA(Object,arguments)};iA(EI,{getPolyfill:SI,implementation:sA,shim:aA});var uA=EI,tm=function(){return typeof(function(){}).name=="string"},Hd=Object.getOwnPropertyDescriptor;if(Hd)try{Hd([],"length")}catch{Hd=null}tm.functionsHaveConfigurableNames=function(){if(!tm()||!Hd)return!1;var e=Hd(function(){},"name");return!!e&&!!e.configurable};var cA=Function.prototype.bind;tm.boundFunctionsHaveNames=function(){return tm()&&typeof cA=="function"&&(function(){}).bind().name!==""};var hA=tm,gw=C1,fA=T1(),pA=hA.functionsHaveConfigurableNames(),dA=pc,mA=function(e,n){if(typeof e!="function")throw new dA("`fn` is not a function");var r=arguments.length>2&&!!arguments[2];return(!r||pA)&&(fA?gw(e,"name",n,!0,!0):gw(e,"name",n)),e},gA=mA,_A=pc,yA=Object,II=gA(function(){if(this==null||this!==yA(this))throw new _A("RegExp.prototype.flags getter called on non-object");var e="";return this.hasIndices&&(e+="d"),this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.dotAll&&(e+="s"),this.unicode&&(e+="u"),this.unicodeSets&&(e+="v"),this.sticky&&(e+="y"),e},"get flags",!0),vA=II,bA=hh.supportsDescriptors,xA=Object.getOwnPropertyDescriptor,CI=function(){if(bA&&/a/mig.flags==="gim"){var e=xA(RegExp.prototype,"flags");if(e&&typeof e.get=="function"&&typeof RegExp.prototype.dotAll=="boolean"&&typeof RegExp.prototype.hasIndices=="boolean"){var n="",r={};if(Object.defineProperty(r,"hasIndices",{get:function(){n+="d"}}),Object.defineProperty(r,"sticky",{get:function(){n+="y"}}),n==="dy")return e.get}}return vA},wA=hh.supportsDescriptors,SA=CI,EA=Object.getOwnPropertyDescriptor,IA=Object.defineProperty,CA=TypeError,_w=Object.getPrototypeOf,TA=/a/,LA=function(){if(!wA||!_w)throw new CA("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var e=SA(),n=_w(TA),r=EA(n,"flags");return(!r||r.get!==e)&&IA(n,"flags",{configurable:!0,enumerable:!1,get:e}),e},PA=hh,MA=dp,kA=II,TI=CI,AA=LA,LI=MA(TI());PA(LI,{getPolyfill:TI,implementation:kA,shim:AA});var DA=LI,n_={exports:{}},RA=ty,fh=function(){return RA()&&!!Symbol.toStringTag},NA=fh(),OA=Da,yv=OA("Object.prototype.toString"),ny=function(e){return NA&&e&&typeof e=="object"&&Symbol.toStringTag in e?!1:yv(e)==="[object Arguments]"},PI=function(e){return ny(e)?!0:e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&yv(e)!=="[object Array]"&&yv(e.callee)==="[object Function]"},zA=function(){return ny(arguments)}();ny.isLegacyArguments=PI;var MI=zA?ny:PI;const FA={},BA=Object.freeze(Object.defineProperty({__proto__:null,default:FA},Symbol.toStringTag,{value:"Module"})),VA=J_(BA);var L1=typeof Map=="function"&&Map.prototype,j0=Object.getOwnPropertyDescriptor&&L1?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,b_=L1&&j0&&typeof j0.get=="function"?j0.get:null,yw=L1&&Map.prototype.forEach,P1=typeof Set=="function"&&Set.prototype,G0=Object.getOwnPropertyDescriptor&&P1?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,x_=P1&&G0&&typeof G0.get=="function"?G0.get:null,vw=P1&&Set.prototype.forEach,UA=typeof WeakMap=="function"&&WeakMap.prototype,Zd=UA?WeakMap.prototype.has:null,jA=typeof WeakSet=="function"&&WeakSet.prototype,Xd=jA?WeakSet.prototype.has:null,GA=typeof WeakRef=="function"&&WeakRef.prototype,bw=GA?WeakRef.prototype.deref:null,qA=Boolean.prototype.valueOf,WA=Object.prototype.toString,HA=Function.prototype.toString,ZA=String.prototype.match,M1=String.prototype.slice,Ju=String.prototype.replace,XA=String.prototype.toUpperCase,xw=String.prototype.toLowerCase,kI=RegExp.prototype.test,ww=Array.prototype.concat,Il=Array.prototype.join,YA=Array.prototype.slice,Sw=Math.floor,vv=typeof BigInt=="function"?BigInt.prototype.valueOf:null,q0=Object.getOwnPropertySymbols,bv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Ff=typeof Symbol=="function"&&typeof Symbol.iterator=="object",Vo=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Ff||"symbol")?Symbol.toStringTag:null,AI=Object.prototype.propertyIsEnumerable,Ew=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function Iw(t,e){if(t===1/0||t===-1/0||t!==t||t&&t>-1e3&&t<1e3||kI.call(/e/,e))return e;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof t=="number"){var r=t<0?-Sw(-t):Sw(t);if(r!==t){var i=String(r),o=M1.call(e,i.length+1);return Ju.call(i,n,"$&_")+"."+Ju.call(Ju.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Ju.call(e,n,"$&_")}var xv=VA,Cw=xv.custom,Tw=RI(Cw)?Cw:null,$A=function t(e,n,r,i){var o=n||{};if(Yu(o,"quoteStyle")&&o.quoteStyle!=="single"&&o.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Yu(o,"maxStringLength")&&(typeof o.maxStringLength=="number"?o.maxStringLength<0&&o.maxStringLength!==1/0:o.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var c=Yu(o,"customInspect")?o.customInspect:!0;if(typeof c!="boolean"&&c!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Yu(o,"indent")&&o.indent!==null&&o.indent!=="	"&&!(parseInt(o.indent,10)===o.indent&&o.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Yu(o,"numericSeparator")&&typeof o.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var l=o.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return OI(e,o);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var d=String(e);return l?Iw(e,d):d}if(typeof e=="bigint"){var y=String(e)+"n";return l?Iw(e,y):y}var S=typeof o.depth>"u"?5:o.depth;if(typeof r>"u"&&(r=0),r>=S&&S>0&&typeof e=="object")return wv(e)?"[Array]":"[Object]";var E=d3(o,r);if(typeof i>"u")i=[];else if(NI(i,e)>=0)return"[Circular]";function C(Ge,Te,ot){if(Te&&(i=YA.call(i),i.push(Te)),ot){var ft={depth:o.depth};return Yu(o,"quoteStyle")&&(ft.quoteStyle=o.quoteStyle),t(Ge,ft,r+1,i)}return t(Ge,o,r+1,i)}if(typeof e=="function"&&!Lw(e)){var A=o3(e),M=Vg(e,C);return"[Function"+(A?": "+A:" (anonymous)")+"]"+(M.length>0?" { "+Il.call(M,", ")+" }":"")}if(RI(e)){var R=Ff?Ju.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):bv.call(e);return typeof e=="object"&&!Ff?Ed(R):R}if(h3(e)){for(var N="<"+xw.call(String(e.nodeName)),B=e.attributes||[],O=0;O<B.length;O++)N+=" "+B[O].name+"="+DI(KA(B[O].value),"double",o);return N+=">",e.childNodes&&e.childNodes.length&&(N+="..."),N+="</"+xw.call(String(e.nodeName))+">",N}if(wv(e)){if(e.length===0)return"[]";var G=Vg(e,C);return E&&!p3(G)?"["+Sv(G,E)+"]":"[ "+Il.call(G,", ")+" ]"}if(QA(e)){var U=Vg(e,C);return!("cause"in Error.prototype)&&"cause"in e&&!AI.call(e,"cause")?"{ ["+String(e)+"] "+Il.call(ww.call("[cause]: "+C(e.cause),U),", ")+" }":U.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+Il.call(U,", ")+" }"}if(typeof e=="object"&&c){if(Tw&&typeof e[Tw]=="function"&&xv)return xv(e,{depth:S-r});if(c!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(s3(e)){var Z=[];return yw&&yw.call(e,function(Ge,Te){Z.push(C(Te,e,!0)+" => "+C(Ge,e))}),Pw("Map",b_.call(e),Z,E)}if(u3(e)){var ue=[];return vw&&vw.call(e,function(Ge){ue.push(C(Ge,e))}),Pw("Set",x_.call(e),ue,E)}if(a3(e))return W0("WeakMap");if(c3(e))return W0("WeakSet");if(l3(e))return W0("WeakRef");if(t3(e))return Ed(C(Number(e)));if(r3(e))return Ed(C(vv.call(e)));if(n3(e))return Ed(qA.call(e));if(e3(e))return Ed(C(String(e)));if(typeof window<"u"&&e===window)return"{ [object Window] }";if(e===xm)return"{ [object globalThis] }";if(!JA(e)&&!Lw(e)){var ae=Vg(e,C),se=Ew?Ew(e)===Object.prototype:e instanceof Object||e.constructor===Object,fe=e instanceof Object?"":"null prototype",ke=!se&&Vo&&Object(e)===e&&Vo in e?M1.call(dc(e),8,-1):fe?"Object":"",K=se||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",oe=K+(ke||fe?"["+Il.call(ww.call([],ke||[],fe||[]),": ")+"] ":"");return ae.length===0?oe+"{}":E?oe+"{"+Sv(ae,E)+"}":oe+"{ "+Il.call(ae,", ")+" }"}return String(e)};function DI(t,e,n){var r=(n.quoteStyle||e)==="double"?'"':"'";return r+t+r}function KA(t){return Ju.call(String(t),/"/g,"&quot;")}function wv(t){return dc(t)==="[object Array]"&&(!Vo||!(typeof t=="object"&&Vo in t))}function JA(t){return dc(t)==="[object Date]"&&(!Vo||!(typeof t=="object"&&Vo in t))}function Lw(t){return dc(t)==="[object RegExp]"&&(!Vo||!(typeof t=="object"&&Vo in t))}function QA(t){return dc(t)==="[object Error]"&&(!Vo||!(typeof t=="object"&&Vo in t))}function e3(t){return dc(t)==="[object String]"&&(!Vo||!(typeof t=="object"&&Vo in t))}function t3(t){return dc(t)==="[object Number]"&&(!Vo||!(typeof t=="object"&&Vo in t))}function n3(t){return dc(t)==="[object Boolean]"&&(!Vo||!(typeof t=="object"&&Vo in t))}function RI(t){if(Ff)return t&&typeof t=="object"&&t instanceof Symbol;if(typeof t=="symbol")return!0;if(!t||typeof t!="object"||!bv)return!1;try{return bv.call(t),!0}catch{}return!1}function r3(t){if(!t||typeof t!="object"||!vv)return!1;try{return vv.call(t),!0}catch{}return!1}var i3=Object.prototype.hasOwnProperty||function(t){return t in this};function Yu(t,e){return i3.call(t,e)}function dc(t){return WA.call(t)}function o3(t){if(t.name)return t.name;var e=ZA.call(HA.call(t),/^function\s*([\w$]+)/);return e?e[1]:null}function NI(t,e){if(t.indexOf)return t.indexOf(e);for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1}function s3(t){if(!b_||!t||typeof t!="object")return!1;try{b_.call(t);try{x_.call(t)}catch{return!0}return t instanceof Map}catch{}return!1}function a3(t){if(!Zd||!t||typeof t!="object")return!1;try{Zd.call(t,Zd);try{Xd.call(t,Xd)}catch{return!0}return t instanceof WeakMap}catch{}return!1}function l3(t){if(!bw||!t||typeof t!="object")return!1;try{return bw.call(t),!0}catch{}return!1}function u3(t){if(!x_||!t||typeof t!="object")return!1;try{x_.call(t);try{b_.call(t)}catch{return!0}return t instanceof Set}catch{}return!1}function c3(t){if(!Xd||!t||typeof t!="object")return!1;try{Xd.call(t,Xd);try{Zd.call(t,Zd)}catch{return!0}return t instanceof WeakSet}catch{}return!1}function h3(t){return!t||typeof t!="object"?!1:typeof HTMLElement<"u"&&t instanceof HTMLElement?!0:typeof t.nodeName=="string"&&typeof t.getAttribute=="function"}function OI(t,e){if(t.length>e.maxStringLength){var n=t.length-e.maxStringLength,r="... "+n+" more character"+(n>1?"s":"");return OI(M1.call(t,0,e.maxStringLength),e)+r}var i=Ju.call(Ju.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,f3);return DI(i,"single",e)}function f3(t){var e=t.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return n?"\\"+n:"\\x"+(e<16?"0":"")+XA.call(e.toString(16))}function Ed(t){return"Object("+t+")"}function W0(t){return t+" { ? }"}function Pw(t,e,n,r){var i=r?Sv(n,r):Il.call(n,", ");return t+" ("+e+") {"+i+"}"}function p3(t){for(var e=0;e<t.length;e++)if(NI(t[e],`
`)>=0)return!1;return!0}function d3(t,e){var n;if(t.indent==="	")n="	";else if(typeof t.indent=="number"&&t.indent>0)n=Il.call(Array(t.indent+1)," ");else return null;return{base:n,prev:Il.call(Array(e+1),n)}}function Sv(t,e){if(t.length===0)return"";var n=`
`+e.prev+e.base;return n+Il.call(t,","+n)+`
`+e.prev}function Vg(t,e){var n=wv(t),r=[];if(n){r.length=t.length;for(var i=0;i<t.length;i++)r[i]=Yu(t,i)?e(t[i],t):""}var o=typeof q0=="function"?q0(t):[],c;if(Ff){c={};for(var l=0;l<o.length;l++)c["$"+o[l]]=o[l]}for(var d in t)Yu(t,d)&&(n&&String(Number(d))===d&&d<t.length||Ff&&c["$"+d]instanceof Symbol||(kI.call(/[^\w$]/,d)?r.push(e(d,t)+": "+e(t[d],t)):r.push(d+": "+e(t[d],t))));if(typeof q0=="function")for(var y=0;y<o.length;y++)AI.call(t,o[y])&&r.push("["+e(o[y])+"]: "+e(t[o[y]],t));return r}var zI=Fl,mp=Da,m3=$A,g3=pc,Ug=zI("%WeakMap%",!0),jg=zI("%Map%",!0),_3=mp("WeakMap.prototype.get",!0),y3=mp("WeakMap.prototype.set",!0),v3=mp("WeakMap.prototype.has",!0),b3=mp("Map.prototype.get",!0),x3=mp("Map.prototype.set",!0),w3=mp("Map.prototype.has",!0),k1=function(t,e){for(var n=t,r;(r=n.next)!==null;n=r)if(r.key===e)return n.next=r.next,r.next=t.next,t.next=r,r},S3=function(t,e){var n=k1(t,e);return n&&n.value},E3=function(t,e,n){var r=k1(t,e);r?r.value=n:t.next={key:e,next:t.next,value:n}},I3=function(t,e){return!!k1(t,e)},FI=function(){var e,n,r,i={assert:function(o){if(!i.has(o))throw new g3("Side channel does not contain "+m3(o))},get:function(o){if(Ug&&o&&(typeof o=="object"||typeof o=="function")){if(e)return _3(e,o)}else if(jg){if(n)return b3(n,o)}else if(r)return S3(r,o)},has:function(o){if(Ug&&o&&(typeof o=="object"||typeof o=="function")){if(e)return v3(e,o)}else if(jg){if(n)return w3(n,o)}else if(r)return I3(r,o);return!1},set:function(o,c){Ug&&o&&(typeof o=="object"||typeof o=="function")?(e||(e=new Ug),y3(e,o,c)):jg?(n||(n=new jg),x3(n,o,c)):(r||(r={key:{},next:null}),E3(r,o,c))}};return i},C3=hI,Id=FI(),iu=pc,A1={assert:function(t,e){if(!t||typeof t!="object"&&typeof t!="function")throw new iu("`O` is not an object");if(typeof e!="string")throw new iu("`slot` must be a string");if(Id.assert(t),!A1.has(t,e))throw new iu("`"+e+"` is not present on `O`")},get:function(t,e){if(!t||typeof t!="object"&&typeof t!="function")throw new iu("`O` is not an object");if(typeof e!="string")throw new iu("`slot` must be a string");var n=Id.get(t);return n&&n["$"+e]},has:function(t,e){if(!t||typeof t!="object"&&typeof t!="function")throw new iu("`O` is not an object");if(typeof e!="string")throw new iu("`slot` must be a string");var n=Id.get(t);return!!n&&C3(n,"$"+e)},set:function(t,e,n){if(!t||typeof t!="object"&&typeof t!="function")throw new iu("`O` is not an object");if(typeof e!="string")throw new iu("`slot` must be a string");var r=Id.get(t);r||(r={},Id.set(t,r)),r["$"+e]=n}};Object.freeze&&Object.freeze(A1);var T3=A1,Cd=T3,L3=SyntaxError,Mw=typeof StopIteration=="object"?StopIteration:null,P3=function(e){if(!Mw)throw new L3("this environment lacks StopIteration");Cd.set(e,"[[Done]]",!1);var n={next:function(){var i=Cd.get(this,"[[Iterator]]"),o=Cd.get(i,"[[Done]]");try{return{done:o,value:o?void 0:i.next()}}catch(c){if(Cd.set(i,"[[Done]]",!0),c!==Mw)throw c;return{done:!0,value:void 0}}}};return Cd.set(n,"[[Iterator]]",e),n},M3={}.toString,BI=Array.isArray||function(t){return M3.call(t)=="[object Array]"},k3=String.prototype.valueOf,A3=function(e){try{return k3.call(e),!0}catch{return!1}},D3=Object.prototype.toString,R3="[object String]",N3=fh(),VI=function(e){return typeof e=="string"?!0:typeof e!="object"?!1:N3?A3(e):D3.call(e)===R3},D1=typeof Map=="function"&&Map.prototype?Map:null,O3=typeof Set=="function"&&Set.prototype?Set:null,w_;D1||(w_=function(e){return!1});var UI=D1?Map.prototype.has:null,kw=O3?Set.prototype.has:null;!w_&&!UI&&(w_=function(e){return!1});var jI=w_||function(e){if(!e||typeof e!="object")return!1;try{if(UI.call(e),kw)try{kw.call(e)}catch{return!0}return e instanceof D1}catch{}return!1},z3=typeof Map=="function"&&Map.prototype?Map:null,R1=typeof Set=="function"&&Set.prototype?Set:null,S_;R1||(S_=function(e){return!1});var Aw=z3?Map.prototype.has:null,GI=R1?Set.prototype.has:null;!S_&&!GI&&(S_=function(e){return!1});var qI=S_||function(e){if(!e||typeof e!="object")return!1;try{if(GI.call(e),Aw)try{Aw.call(e)}catch{return!0}return e instanceof R1}catch{}return!1},Dw=MI,Rw=P3;if(w1()||ty()){var H0=Symbol.iterator;n_.exports=function(e){if(e!=null&&typeof e[H0]<"u")return e[H0]();if(Dw(e))return Array.prototype[H0].call(e)}}else{var F3=BI,B3=VI,Nw=Fl,V3=Nw("%Map%",!0),U3=Nw("%Set%",!0),qa=Da,Ow=qa("Array.prototype.push"),zw=qa("String.prototype.charCodeAt"),j3=qa("String.prototype.slice"),G3=function(e,n){var r=e.length;if(n+1>=r)return n+1;var i=zw(e,n);if(i<55296||i>56319)return n+1;var o=zw(e,n+1);return o<56320||o>57343?n+1:n+2},Z0=function(e){var n=0;return{next:function(){var i=n>=e.length,o;return i||(o=e[n],n+=1),{done:i,value:o}}}},Fw=function(e,n){if(F3(e)||Dw(e))return Z0(e);if(B3(e)){var r=0;return{next:function(){var o=G3(e,r),c=j3(e,r,o);return r=o,{done:o>e.length,value:c}}}}if(n&&typeof e["_es6-shim iterator_"]<"u")return e["_es6-shim iterator_"]()};if(!V3&&!U3)n_.exports=function(e){if(e!=null)return Fw(e,!0)};else{var q3=jI,W3=qI,Bw=qa("Map.prototype.forEach",!0),Vw=qa("Set.prototype.forEach",!0);if(typeof process>"u"||!process.versions||!process.versions.node)var Uw=qa("Map.prototype.iterator",!0),jw=qa("Set.prototype.iterator",!0);var Gw=qa("Map.prototype.@@iterator",!0)||qa("Map.prototype._es6-shim iterator_",!0),qw=qa("Set.prototype.@@iterator",!0)||qa("Set.prototype._es6-shim iterator_",!0),H3=function(e){if(q3(e)){if(Uw)return Rw(Uw(e));if(Gw)return Gw(e);if(Bw){var n=[];return Bw(e,function(i,o){Ow(n,[o,i])}),Z0(n)}}if(W3(e)){if(jw)return Rw(jw(e));if(qw)return qw(e);if(Vw){var r=[];return Vw(e,function(i){Ow(r,i)}),Z0(r)}}};n_.exports=function(e){return H3(e)||Fw(e)}}}var Z3=n_.exports,Ww=function(t){return t!==t},WI=function(e,n){return e===0&&n===0?1/e===1/n:!!(e===n||Ww(e)&&Ww(n))},X3=WI,HI=function(){return typeof Object.is=="function"?Object.is:X3},Y3=HI,$3=hh,K3=function(){var e=Y3();return $3(Object,{is:e},{is:function(){return Object.is!==e}}),e},J3=hh,Q3=dp,e4=WI,ZI=HI,t4=K3,XI=Q3(ZI(),Object);J3(XI,{getPolyfill:ZI,implementation:e4,shim:t4});var n4=XI,r4=dp,YI=Da,i4=Fl,Ev=i4("%ArrayBuffer%",!0),r_=YI("ArrayBuffer.prototype.byteLength",!0),o4=YI("Object.prototype.toString"),Hw=!!Ev&&!r_&&new Ev(0).slice,Zw=!!Hw&&r4(Hw),$I=r_||Zw?function(e){if(!e||typeof e!="object")return!1;try{return r_?r_(e):Zw(e,0),!0}catch{return!1}}:Ev?function(e){return o4(e)==="[object ArrayBuffer]"}:function(e){return!1},s4=Date.prototype.getDay,a4=function(e){try{return s4.call(e),!0}catch{return!1}},l4=Object.prototype.toString,u4="[object Date]",c4=fh(),h4=function(e){return typeof e!="object"||e===null?!1:c4?a4(e):l4.call(e)===u4},Iv=Da,KI=fh(),JI,QI,Cv,Tv;if(KI){JI=Iv("Object.prototype.hasOwnProperty"),QI=Iv("RegExp.prototype.exec"),Cv={};var X0=function(){throw Cv};Tv={toString:X0,valueOf:X0},typeof Symbol.toPrimitive=="symbol"&&(Tv[Symbol.toPrimitive]=X0)}var f4=Iv("Object.prototype.toString"),p4=Object.getOwnPropertyDescriptor,d4="[object RegExp]",m4=KI?function(e){if(!e||typeof e!="object")return!1;var n=p4(e,"lastIndex"),r=n&&JI(n,"value");if(!r)return!1;try{QI(e,Tv)}catch(i){return i===Cv}}:function(e){return!e||typeof e!="object"&&typeof e!="function"?!1:f4(e)===d4},g4=Da,Xw=g4("SharedArrayBuffer.prototype.byteLength",!0),_4=Xw?function(e){if(!e||typeof e!="object")return!1;try{return Xw(e),!0}catch{return!1}}:function(e){return!1},y4=Number.prototype.toString,v4=function(e){try{return y4.call(e),!0}catch{return!1}},b4=Object.prototype.toString,x4="[object Number]",w4=fh(),S4=function(e){return typeof e=="number"?!0:typeof e!="object"?!1:w4?v4(e):b4.call(e)===x4},eC=Da,E4=eC("Boolean.prototype.toString"),I4=eC("Object.prototype.toString"),C4=function(e){try{return E4(e),!0}catch{return!1}},T4="[object Boolean]",L4=fh(),P4=function(e){return typeof e=="boolean"?!0:e===null||typeof e!="object"?!1:L4&&Symbol.toStringTag in e?C4(e):I4(e)===T4},Lv={exports:{}},M4=Object.prototype.toString,k4=w1();if(k4){var A4=Symbol.prototype.toString,D4=/^Symbol\(.*\)$/,R4=function(e){return typeof e.valueOf()!="symbol"?!1:D4.test(A4.call(e))};Lv.exports=function(e){if(typeof e=="symbol")return!0;if(M4.call(e)!=="[object Symbol]")return!1;try{return R4(e)}catch{return!1}}}else Lv.exports=function(e){return!1};var N4=Lv.exports,Pv={exports:{}},Yw=typeof BigInt<"u"&&BigInt,O4=function(){return typeof Yw=="function"&&typeof BigInt=="function"&&typeof Yw(42)=="bigint"&&typeof BigInt(42)=="bigint"},z4=O4();if(z4){var F4=BigInt.prototype.valueOf,B4=function(e){try{return F4.call(e),!0}catch{}return!1};Pv.exports=function(e){return e===null||typeof e>"u"||typeof e=="boolean"||typeof e=="string"||typeof e=="number"||typeof e=="symbol"||typeof e=="function"?!1:typeof e=="bigint"?!0:B4(e)}}else Pv.exports=function(e){return!1};var V4=Pv.exports,U4=VI,j4=S4,G4=P4,q4=N4,W4=V4,H4=function(e){if(e==null||typeof e!="object"&&typeof e!="function")return null;if(U4(e))return"String";if(j4(e))return"Number";if(G4(e))return"Boolean";if(q4(e))return"Symbol";if(W4(e))return"BigInt"},E_=typeof WeakMap=="function"&&WeakMap.prototype?WeakMap:null,$w=typeof WeakSet=="function"&&WeakSet.prototype?WeakSet:null,I_;E_||(I_=function(e){return!1});var Mv=E_?E_.prototype.has:null,Y0=$w?$w.prototype.has:null;!I_&&!Mv&&(I_=function(e){return!1});var Z4=I_||function(e){if(!e||typeof e!="object")return!1;try{if(Mv.call(e,Mv),Y0)try{Y0.call(e,Y0)}catch{return!0}return e instanceof E_}catch{}return!1},kv={exports:{}},X4=Fl,tC=Da,Y4=X4("%WeakSet%",!0),$0=tC("WeakSet.prototype.has",!0);if($0){var K0=tC("WeakMap.prototype.has",!0);kv.exports=function(e){if(!e||typeof e!="object")return!1;try{if($0(e,$0),K0)try{K0(e,K0)}catch{return!0}return e instanceof Y4}catch{}return!1}}else kv.exports=function(e){return!1};var $4=kv.exports,K4=jI,J4=qI,Q4=Z4,eD=$4,tD=function(e){if(e&&typeof e=="object"){if(K4(e))return"Map";if(J4(e))return"Set";if(Q4(e))return"WeakMap";if(eD(e))return"WeakSet"}return!1},nC=Function.prototype.toString,Pf=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,Av,i_;if(typeof Pf=="function"&&typeof Object.defineProperty=="function")try{Av=Object.defineProperty({},"length",{get:function(){throw i_}}),i_={},Pf(function(){throw 42},null,Av)}catch(t){t!==i_&&(Pf=null)}else Pf=null;var nD=/^\s*class\b/,Dv=function(e){try{var n=nC.call(e);return nD.test(n)}catch{return!1}},J0=function(e){try{return Dv(e)?!1:(nC.call(e),!0)}catch{return!1}},o_=Object.prototype.toString,rD="[object Object]",iD="[object Function]",oD="[object GeneratorFunction]",sD="[object HTMLAllCollection]",aD="[object HTML document.all class]",lD="[object HTMLCollection]",uD=typeof Symbol=="function"&&!!Symbol.toStringTag,cD=!(0 in[,]),Rv=function(){return!1};if(typeof document=="object"){var hD=document.all;o_.call(hD)===o_.call(document.all)&&(Rv=function(e){if((cD||!e)&&(typeof e>"u"||typeof e=="object"))try{var n=o_.call(e);return(n===sD||n===aD||n===lD||n===rD)&&e("")==null}catch{}return!1})}var fD=Pf?function(e){if(Rv(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;try{Pf(e,null,Av)}catch(n){if(n!==i_)return!1}return!Dv(e)&&J0(e)}:function(e){if(Rv(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(uD)return J0(e);if(Dv(e))return!1;var n=o_.call(e);return n!==iD&&n!==oD&&!/^\[object HTML/.test(n)?!1:J0(e)},pD=fD,dD=Object.prototype.toString,rC=Object.prototype.hasOwnProperty,mD=function(e,n,r){for(var i=0,o=e.length;i<o;i++)rC.call(e,i)&&(r==null?n(e[i],i,e):n.call(r,e[i],i,e))},gD=function(e,n,r){for(var i=0,o=e.length;i<o;i++)r==null?n(e.charAt(i),i,e):n.call(r,e.charAt(i),i,e)},_D=function(e,n,r){for(var i in e)rC.call(e,i)&&(r==null?n(e[i],i,e):n.call(r,e[i],i,e))},yD=function(e,n,r){if(!pD(n))throw new TypeError("iterator must be a function");var i;arguments.length>=3&&(i=r),dD.call(e)==="[object Array]"?mD(e,n,i):typeof e=="string"?gD(e,n,i):_D(e,n,i)},vD=yD,bD=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],Q0=bD,xD=typeof globalThis>"u"?xm:globalThis,wD=function(){for(var e=[],n=0;n<Q0.length;n++)typeof xD[Q0[n]]=="function"&&(e[e.length]=Q0[n]);return e},C_=vD,SD=wD,Kw=dp,N1=Da,s_=I1,ED=N1("Object.prototype.toString"),iC=fh(),Jw=typeof globalThis>"u"?xm:globalThis,Nv=SD(),O1=N1("String.prototype.slice"),ev=Object.getPrototypeOf,ID=N1("Array.prototype.indexOf",!0)||function(e,n){for(var r=0;r<e.length;r+=1)if(e[r]===n)return r;return-1},T_={__proto__:null};iC&&s_&&ev?C_(Nv,function(t){var e=new Jw[t];if(Symbol.toStringTag in e){var n=ev(e),r=s_(n,Symbol.toStringTag);if(!r){var i=ev(n);r=s_(i,Symbol.toStringTag)}T_["$"+t]=Kw(r.get)}}):C_(Nv,function(t){var e=new Jw[t],n=e.slice||e.set;n&&(T_["$"+t]=Kw(n))});var CD=function(e){var n=!1;return C_(T_,function(r,i){if(!n)try{"$"+r(e)===i&&(n=O1(i,1))}catch{}}),n},TD=function(e){var n=!1;return C_(T_,function(r,i){if(!n)try{r(e),n=O1(i,1)}catch{}}),n},LD=function(e){if(!e||typeof e!="object")return!1;if(!iC){var n=O1(ED(e),8,-1);return ID(Nv,n)>-1?n:n!=="Object"?!1:TD(e)}return s_?CD(e):null},PD=Da,Qw=PD("ArrayBuffer.prototype.byteLength",!0),MD=$I,kD=function(e){return MD(e)?Qw?Qw(e):e.byteLength:NaN},oC=uA,Bl=Da,e2=DA,AD=Fl,Bf=Z3,DD=FI,t2=n4,n2=MI,r2=BI,i2=$I,o2=h4,s2=m4,a2=_4,l2=x1,u2=H4,c2=tD,h2=LD,f2=kD,p2=Bl("SharedArrayBuffer.prototype.byteLength",!0),d2=Bl("Date.prototype.getTime"),tv=Object.getPrototypeOf,m2=Bl("Object.prototype.toString"),L_=AD("%Set%",!0),Ov=Bl("Map.prototype.has",!0),P_=Bl("Map.prototype.get",!0),g2=Bl("Map.prototype.size",!0),M_=Bl("Set.prototype.add",!0),sC=Bl("Set.prototype.delete",!0),k_=Bl("Set.prototype.has",!0),a_=Bl("Set.prototype.size",!0);function _2(t,e,n,r){for(var i=Bf(t),o;(o=i.next())&&!o.done;)if(Xa(e,o.value,n,r))return sC(t,o.value),!0;return!1}function aC(t){if(typeof t>"u")return null;if(typeof t!="object")return typeof t=="symbol"?!1:typeof t=="string"||typeof t=="number"?+t==+t:!0}function RD(t,e,n,r,i,o){var c=aC(n);if(c!=null)return c;var l=P_(e,c),d=oC({},i,{strict:!1});return typeof l>"u"&&!Ov(e,c)||!Xa(r,l,d,o)?!1:!Ov(t,c)&&Xa(r,l,d,o)}function ND(t,e,n){var r=aC(n);return r??(k_(e,r)&&!k_(t,r))}function y2(t,e,n,r,i,o){for(var c=Bf(t),l,d;(l=c.next())&&!l.done;)if(d=l.value,Xa(n,d,i,o)&&Xa(r,P_(e,d),i,o))return sC(t,d),!0;return!1}function Xa(t,e,n,r){var i=n||{};if(i.strict?t2(t,e):t===e)return!0;var o=u2(t),c=u2(e);if(o!==c)return!1;if(!t||!e||typeof t!="object"&&typeof e!="object")return i.strict?t2(t,e):t==e;var l=r.has(t),d=r.has(e),y;if(l&&d){if(r.get(t)===r.get(e))return!0}else y={};return l||r.set(t,y),d||r.set(e,y),FD(t,e,i,r)}function v2(t){return!t||typeof t!="object"||typeof t.length!="number"||typeof t.copy!="function"||typeof t.slice!="function"||t.length>0&&typeof t[0]!="number"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}function OD(t,e,n,r){if(a_(t)!==a_(e))return!1;for(var i=Bf(t),o=Bf(e),c,l,d;(c=i.next())&&!c.done;)if(c.value&&typeof c.value=="object")d||(d=new L_),M_(d,c.value);else if(!k_(e,c.value)){if(n.strict||!ND(t,e,c.value))return!1;d||(d=new L_),M_(d,c.value)}if(d){for(;(l=o.next())&&!l.done;)if(l.value&&typeof l.value=="object"){if(!_2(d,l.value,n.strict,r))return!1}else if(!n.strict&&!k_(t,l.value)&&!_2(d,l.value,n.strict,r))return!1;return a_(d)===0}return!0}function zD(t,e,n,r){if(g2(t)!==g2(e))return!1;for(var i=Bf(t),o=Bf(e),c,l,d,y,S,E;(c=i.next())&&!c.done;)if(y=c.value[0],S=c.value[1],y&&typeof y=="object")d||(d=new L_),M_(d,y);else if(E=P_(e,y),typeof E>"u"&&!Ov(e,y)||!Xa(S,E,n,r)){if(n.strict||!RD(t,e,y,S,n,r))return!1;d||(d=new L_),M_(d,y)}if(d){for(;(l=o.next())&&!l.done;)if(y=l.value[0],E=l.value[1],y&&typeof y=="object"){if(!y2(d,t,y,E,n,r))return!1}else if(!n.strict&&(!t.has(y)||!Xa(P_(t,y),E,n,r))&&!y2(d,t,y,E,oC({},n,{strict:!1}),r))return!1;return a_(d)===0}return!0}function FD(t,e,n,r){var i,o;if(typeof t!=typeof e||t==null||e==null||m2(t)!==m2(e)||n2(t)!==n2(e))return!1;var c=r2(t),l=r2(e);if(c!==l)return!1;var d=t instanceof Error,y=e instanceof Error;if(d!==y||(d||y)&&(t.name!==e.name||t.message!==e.message))return!1;var S=s2(t),E=s2(e);if(S!==E||(S||E)&&(t.source!==e.source||e2(t)!==e2(e)))return!1;var C=o2(t),A=o2(e);if(C!==A||(C||A)&&d2(t)!==d2(e)||n.strict&&tv&&tv(t)!==tv(e))return!1;var M=h2(t),R=h2(e);if(M!==R)return!1;if(M||R){if(t.length!==e.length)return!1;for(i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}var N=v2(t),B=v2(e);if(N!==B)return!1;if(N||B){if(t.length!==e.length)return!1;for(i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}var O=i2(t),G=i2(e);if(O!==G)return!1;if(O||G)return f2(t)!==f2(e)?!1:typeof Uint8Array=="function"&&Xa(new Uint8Array(t),new Uint8Array(e),n,r);var U=a2(t),Z=a2(e);if(U!==Z)return!1;if(U||Z)return p2(t)!==p2(e)?!1:typeof Uint8Array=="function"&&Xa(new Uint8Array(t),new Uint8Array(e),n,r);if(typeof t!=typeof e)return!1;var ue=l2(t),ae=l2(e);if(ue.length!==ae.length)return!1;for(ue.sort(),ae.sort(),i=ue.length-1;i>=0;i--)if(ue[i]!=ae[i])return!1;for(i=ue.length-1;i>=0;i--)if(o=ue[i],!Xa(t[o],e[o],n,r))return!1;var se=c2(t),fe=c2(e);return se!==fe?!1:se==="Set"||fe==="Set"?OD(t,e,n,r):se==="Map"?zD(t,e,n,r):!0}var BD=function(e,n,r){return Xa(e,n,r,DD())};const lC=d1(BD);var VD=Object.defineProperty,yr=(t,e)=>VD(t,"name",{value:e,configurable:!0}),UD=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,i;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(i=e==null?void 0:e.compareProperties)!=null?i:!0}compare(e,n){if(e.type!==n.type||!Fd(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=zv(e),i=zv(n);return r.every(o=>i.some(c=>this.compare(o,c)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,i)=>Math.abs(r-n[i])<this.precision)}compareLine(e,n,r=0,i=!1){if(!Fd(e,n))return!1;const o=e;let c=n;if(i&&!this.compareCoord(o[0],c[0])){const d=this.fixStartIndex(c,o);if(d)c=d;else return!1}const l=this.compareCoord(o[r],c[r]);return this.direction||l?this.comparePath(o,c):this.compareCoord(o[r],c[c.length-(1+r)])?this.comparePath(o.slice().reverse(),c):!1}fixStartIndex(e,n){let r,i=-1;for(let o=0;o<e.length;o++)if(this.compareCoord(e[o],n[0])){i=o;break}return i>=0&&(r=[].concat(e.slice(i,e.length),e.slice(1,i+1))),r}comparePath(e,n){return e.every((r,i)=>this.compareCoord(r,n[i]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),i=n.coordinates.slice(1,n.coordinates.length);return r.every(o=>i.some(c=>this.compareLine(o,c,1,!0)))}return!1}compareGeometryCollection(e,n){return Fd(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,i)=>this.compare(r,n.geometries[i]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?lC(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Fd(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,i)=>this.compare(r,n.features[i]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};yr(UD,"GeojsonEquality");function Fd(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}yr(Fd,"sameLength");function zv(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}yr(zv,"explode");var Fs=63710088e-1,uC={centimeters:Fs*100,centimetres:Fs*100,degrees:360/(2*Math.PI),feet:Fs*3.28084,inches:Fs*39.37,kilometers:Fs/1e3,kilometres:Fs/1e3,meters:Fs,metres:Fs,miles:Fs/1609.344,millimeters:Fs*1e3,millimetres:Fs*1e3,nauticalmiles:Fs/1852,radians:1,yards:Fs*1.0936},b2={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Ll(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}yr(Ll,"feature");function jD(t,e,n={}){switch(t){case"Point":return su(e).geometry;case"LineString":return uu(e).geometry;case"Polygon":return z1(e).geometry;case"MultiPoint":return hC(e).geometry;case"MultiLineString":return cC(e).geometry;case"MultiPolygon":return fC(e).geometry;default:throw new Error(t+" is invalid")}}yr(jD,"geometry");function su(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!A_(t[0])||!A_(t[1]))throw new Error("coordinates must contain numbers");return Ll({type:"Point",coordinates:t},e,n)}yr(su,"point");function GD(t,e,n={}){return ry(t.map(r=>su(r,e)),n)}yr(GD,"points");function z1(t,e,n={}){for(const i of t){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let o=0;o<i[i.length-1].length;o++)if(i[i.length-1][o]!==i[0][o])throw new Error("First and last Position are not equivalent.")}return Ll({type:"Polygon",coordinates:t},e,n)}yr(z1,"polygon");function qD(t,e,n={}){return ry(t.map(r=>z1(r,e)),n)}yr(qD,"polygons");function uu(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return Ll({type:"LineString",coordinates:t},e,n)}yr(uu,"lineString");function WD(t,e,n={}){return ry(t.map(r=>uu(r,e)),n)}yr(WD,"lineStrings");function ry(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}yr(ry,"featureCollection");function cC(t,e,n={}){return Ll({type:"MultiLineString",coordinates:t},e,n)}yr(cC,"multiLineString");function hC(t,e,n={}){return Ll({type:"MultiPoint",coordinates:t},e,n)}yr(hC,"multiPoint");function fC(t,e,n={}){return Ll({type:"MultiPolygon",coordinates:t},e,n)}yr(fC,"multiPolygon");function HD(t,e,n={}){return Ll({type:"GeometryCollection",geometries:t},e,n)}yr(HD,"geometryCollection");function ZD(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}yr(ZD,"round");function pC(t,e="kilometers"){const n=uC[e];if(!n)throw new Error(e+" units is invalid");return t*n}yr(pC,"radiansToLength");function F1(t,e="kilometers"){const n=uC[e];if(!n)throw new Error(e+" units is invalid");return t/n}yr(F1,"lengthToRadians");function XD(t,e){return dC(F1(t,e))}yr(XD,"lengthToDegrees");function YD(t){let e=t%360;return e<0&&(e+=360),e}yr(YD,"bearingToAzimuth");function dC(t){return t%(2*Math.PI)*180/Math.PI}yr(dC,"radiansToDegrees");function $D(t){return t%360*Math.PI/180}yr($D,"degreesToRadians");function KD(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return pC(F1(t,e),n)}yr(KD,"convertLength");function JD(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=b2[e];if(!r)throw new Error("invalid original units");const i=b2[n];if(!i)throw new Error("invalid final units");return t/r*i}yr(JD,"convertArea");function A_(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}yr(A_,"isNumber");function B1(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}yr(B1,"isObject");function QD(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!A_(e))throw new Error("bbox must only contain numbers")})}yr(QD,"validateBBox");function eR(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}yr(eR,"validateId");var tR=Object.defineProperty,Co=(t,e)=>tR(t,"name",{value:e,configurable:!0});function gp(t,e,n){if(t!==null)for(var r,i,o,c,l,d,y,S=0,E=0,C,A=t.type,M=A==="FeatureCollection",R=A==="Feature",N=M?t.features.length:1,B=0;B<N;B++){y=M?t.features[B].geometry:R?t.geometry:t,C=y?y.type==="GeometryCollection":!1,l=C?y.geometries.length:1;for(var O=0;O<l;O++){var G=0,U=0;if(c=C?y.geometries[O]:y,c!==null){d=c.coordinates;var Z=c.type;switch(S=n&&(Z==="Polygon"||Z==="MultiPolygon")?1:0,Z){case null:break;case"Point":if(e(d,E,B,G,U)===!1)return!1;E++,G++;break;case"LineString":case"MultiPoint":for(r=0;r<d.length;r++){if(e(d[r],E,B,G,U)===!1)return!1;E++,Z==="MultiPoint"&&G++}Z==="LineString"&&G++;break;case"Polygon":case"MultiLineString":for(r=0;r<d.length;r++){for(i=0;i<d[r].length-S;i++){if(e(d[r][i],E,B,G,U)===!1)return!1;E++}Z==="MultiLineString"&&G++,Z==="Polygon"&&U++}Z==="Polygon"&&G++;break;case"MultiPolygon":for(r=0;r<d.length;r++){for(U=0,i=0;i<d[r].length;i++){for(o=0;o<d[r][i].length-S;o++){if(e(d[r][i][o],E,B,G,U)===!1)return!1;E++}U++}G++}break;case"GeometryCollection":for(r=0;r<c.geometries.length;r++)if(gp(c.geometries[r],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}Co(gp,"coordEach");function nR(t,e,n,r){var i=n;return gp(t,function(o,c,l,d,y){c===0&&n===void 0?i=o:i=e(i,o,c,l,d,y)},r),i}Co(nR,"coordReduce");function mC(t,e){var n;switch(t.type){case"FeatureCollection":for(n=0;n<t.features.length&&e(t.features[n].properties,n)!==!1;n++);break;case"Feature":e(t.properties,0);break}}Co(mC,"propEach");function rR(t,e,n){var r=n;return mC(t,function(i,o){o===0&&n===void 0?r=i:r=e(r,i,o)}),r}Co(rR,"propReduce");function gC(t,e){if(t.type==="Feature")e(t,0);else if(t.type==="FeatureCollection")for(var n=0;n<t.features.length&&e(t.features[n],n)!==!1;n++);}Co(gC,"featureEach");function iR(t,e,n){var r=n;return gC(t,function(i,o){o===0&&n===void 0?r=i:r=e(r,i,o)}),r}Co(iR,"featureReduce");function oR(t){var e=[];return gp(t,function(n){e.push(n)}),e}Co(oR,"coordAll");function V1(t,e){var n,r,i,o,c,l,d,y,S,E,C=0,A=t.type==="FeatureCollection",M=t.type==="Feature",R=A?t.features.length:1;for(n=0;n<R;n++){for(l=A?t.features[n].geometry:M?t.geometry:t,y=A?t.features[n].properties:M?t.properties:{},S=A?t.features[n].bbox:M?t.bbox:void 0,E=A?t.features[n].id:M?t.id:void 0,d=l?l.type==="GeometryCollection":!1,c=d?l.geometries.length:1,i=0;i<c;i++){if(o=d?l.geometries[i]:l,o===null){if(e(null,C,y,S,E)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,C,y,S,E)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<o.geometries.length;r++)if(e(o.geometries[r],C,y,S,E)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}C++}}Co(V1,"geomEach");function sR(t,e,n){var r=n;return V1(t,function(i,o,c,l,d){o===0&&n===void 0?r=i:r=e(r,i,o,c,l,d)}),r}Co(sR,"geomReduce");function iy(t,e){V1(t,function(n,r,i,o,c){var l=n===null?null:n.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return e(Ll(n,i,{bbox:o,id:c}),r,0)===!1?!1:void 0}var d;switch(l){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var y=0;y<n.coordinates.length;y++){var S=n.coordinates[y],E={type:d,coordinates:S};if(e(Ll(E,i),r,y)===!1)return!1}})}Co(iy,"flattenEach");function aR(t,e,n){var r=n;return iy(t,function(i,o,c){o===0&&c===0&&n===void 0?r=i:r=e(r,i,o,c)}),r}Co(aR,"flattenReduce");function _C(t,e){iy(t,function(n,r,i){var o=0;if(n.geometry){var c=n.geometry.type;if(!(c==="Point"||c==="MultiPoint")){var l,d=0,y=0,S=0;if(gp(n,function(E,C,A,M,R){if(l===void 0||r>d||M>y||R>S){l=E,d=r,y=M,S=R,o=0;return}var N=uu([l,E],n.properties);if(e(N,r,i,R,o)===!1)return!1;o++,l=E})===!1)return!1}}})}Co(_C,"segmentEach");function lR(t,e,n){var r=n,i=!1;return _C(t,function(o,c,l,d,y){i===!1&&n===void 0?r=o:r=e(r,o,c,l,d,y),i=!0}),r}Co(lR,"segmentReduce");function yC(t,e){if(!t)throw new Error("geojson is required");iy(t,function(n,r,i){if(n.geometry!==null){var o=n.geometry.type,c=n.geometry.coordinates;switch(o){case"LineString":if(e(n,r,i,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<c.length;l++)if(e(uu(c[l],n.properties),r,i,l)===!1)return!1;break}}})}Co(yC,"lineEach");function uR(t,e,n){var r=n;return yC(t,function(i,o,c,l){o===0&&n===void 0?r=i:r=e(r,i,o,c,l)}),r}Co(uR,"lineReduce");function cR(t,e){if(e=e||{},!B1(e))throw new Error("options is invalid");var n=e.featureIndex||0,r=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,c=e.properties,l;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),c=c||t.features[n].properties,l=t.features[n].geometry;break;case"Feature":c=c||t.properties,l=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=t;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var d=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=d.length+o-1),uu([d[o],d[o+1]],c,e);case"Polygon":return i<0&&(i=d.length+i),o<0&&(o=d[i].length+o-1),uu([d[i][o],d[i][o+1]],c,e);case"MultiLineString":return r<0&&(r=d.length+r),o<0&&(o=d[r].length+o-1),uu([d[r][o],d[r][o+1]],c,e);case"MultiPolygon":return r<0&&(r=d.length+r),i<0&&(i=d[r].length+i),o<0&&(o=d[r][i].length-o-1),uu([d[r][i][o],d[r][i][o+1]],c,e)}throw new Error("geojson is invalid")}Co(cR,"findSegment");function hR(t,e){if(e=e||{},!B1(e))throw new Error("options is invalid");var n=e.featureIndex||0,r=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,c=e.properties,l;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),c=c||t.features[n].properties,l=t.features[n].geometry;break;case"Feature":c=c||t.properties,l=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=t;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var d=l.coordinates;switch(l.type){case"Point":return su(d,c,e);case"MultiPoint":return r<0&&(r=d.length+r),su(d[r],c,e);case"LineString":return o<0&&(o=d.length+o),su(d[o],c,e);case"Polygon":return i<0&&(i=d.length+i),o<0&&(o=d[i].length+o),su(d[i][o],c,e);case"MultiLineString":return r<0&&(r=d.length+r),o<0&&(o=d[r].length+o),su(d[r][o],c,e);case"MultiPolygon":return r<0&&(r=d.length+r),i<0&&(i=d[r].length+i),o<0&&(o=d[r][i].length-o),su(d[r][i][o],c,e)}throw new Error("geojson is invalid")}Co(hR,"findPoint");var fR=Object.defineProperty,pR=(t,e)=>fR(t,"name",{value:e,configurable:!0});function U1(t,e={}){if(t.bbox!=null&&e.recompute!==!0)return t.bbox;const n=[1/0,1/0,-1/0,-1/0];return gp(t,r=>{n[0]>r[0]&&(n[0]=r[0]),n[1]>r[1]&&(n[1]=r[1]),n[2]<r[0]&&(n[2]=r[0]),n[3]<r[1]&&(n[3]=r[1])}),n}pR(U1,"bbox");var dR=U1;const mR=Object.freeze(Object.defineProperty({__proto__:null,bbox:U1,default:dR},Symbol.toStringTag,{value:"Module"})),gR=J_(mR);var vl=YM,vC=$M,bC=KM,xf=gR.default,_R=bC.featureEach;bC.coordEach;vC.polygon;var x2=vC.featureCollection;function xC(t){var e=new vl(t);return e.insert=function(n){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:xf(n),vl.prototype.insert.call(this,n)},e.load=function(n){var r=[];return Array.isArray(n)?n.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:xf(i),r.push(i)}):_R(n,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:xf(i),r.push(i)}),vl.prototype.load.call(this,r)},e.remove=function(n,r){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:xf(n),vl.prototype.remove.call(this,n,r)},e.clear=function(){return vl.prototype.clear.call(this)},e.search=function(n){var r=vl.prototype.search.call(this,this.toBBox(n));return x2(r)},e.collides=function(n){return vl.prototype.collides.call(this,this.toBBox(n))},e.all=function(){var n=vl.prototype.all.call(this);return x2(n)},e.toJSON=function(){return vl.prototype.toJSON.call(this)},e.fromJSON=function(n){return vl.prototype.fromJSON.call(this,n)},e.toBBox=function(n){var r;if(n.bbox)r=n.bbox;else if(Array.isArray(n)&&n.length===4)r=n;else if(Array.isArray(n)&&n.length===6)r=[n[0],n[1],n[3],n[4]];else if(n.type==="Feature")r=xf(n);else if(n.type==="FeatureCollection")r=xf(n);else throw new Error("invalid geojson");return{minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]}},e}b1.exports=xC;b1.exports.default=xC;var yR=b1.exports;const vR=d1(yR);function bR(t,e){var n={},r=[];if(t.type==="LineString"&&(t=wa(t)),e.type==="LineString"&&(e=wa(e)),t.type==="Feature"&&e.type==="Feature"&&t.geometry!==null&&e.geometry!==null&&t.geometry.type==="LineString"&&e.geometry.type==="LineString"&&t.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=w2(t,e);return i&&r.push(i),$c(r)}var o=vR();return o.load(Jx(e)),__(Jx(t),function(c){__(o.search(c),function(l){var d=w2(c,l);if(d){var y=Of(d).join(",");n[y]||(n[y]=!0,r.push(d))}})}),$c(r)}function w2(t,e){var n=Of(t),r=Of(e);if(n.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(r.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=n[0][0],o=n[0][1],c=n[1][0],l=n[1][1],d=r[0][0],y=r[0][1],S=r[1][0],E=r[1][1],C=(E-y)*(c-i)-(S-d)*(l-o),A=(S-d)*(o-y)-(E-y)*(i-d),M=(c-i)*(o-y)-(l-o)*(i-d);if(C===0)return null;var R=A/C,N=M/C;if(R>=0&&R<=1&&N>=0&&N<=1){var B=i+R*(c-i),O=o+R*(l-o);return vs([B,O])}return null}function xR(t,e,n){n===void 0&&(n={});var r=vs([1/0,1/0],{dist:1/0}),i=0;return pp(t,function(o){for(var c=Of(o),l=0;l<c.length-1;l++){var d=vs(c[l]);d.properties.dist=Sd(e,d,n);var y=vs(c[l+1]);y.properties.dist=Sd(e,y,n);var S=Sd(d,y,n),E=Math.max(d.properties.dist,y.properties.dist),C=aI(d,y),A=Kx(e,E,C+90,n),M=Kx(e,E,C-90,n),R=bR(ma([A.geometry.coordinates,M.geometry.coordinates]),ma([d.geometry.coordinates,y.geometry.coordinates])),N=null;R.features.length>0&&(N=R.features[0],N.properties.dist=Sd(e,N,n),N.properties.location=i+Sd(d,N,n)),d.properties.dist<r.properties.dist&&(r=d,r.properties.index=l,r.properties.location=i),y.properties.dist<r.properties.dist&&(r=y,r.properties.index=l+1,r.properties.location=i+S),N&&N.properties.dist<r.properties.dist&&(r=N,r.properties.index=l),i+=S}}),r}const wR=30;class SR{constructor(e,n,r,i,o){this.onMouseMove=c=>{if(!this.active)return;const l=[c.point.x-wR,c.point.y],d=this.map.unproject(c.point).distanceTo(this.map.unproject(l));this.inner.onMouseMove(c.lngLat.lng,c.lngLat.lat,d)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=c=>{this.active&&(c.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=c=>{if(!this.active)return;let l=c.target.tagName;l=="INPUT"||l=="TEXTAREA"||c.key=="Escape"&&(c.stopPropagation(),this.cancel())},this.onKeyPress=c=>{if(!this.active)return;let l=c.target.tagName;l=="INPUT"||l=="TEXTAREA"||(c.key=="Enter"?(c.stopPropagation(),this.finish()):c.key=="s"||c.key=="S"?(c.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):c.key=="z"&&c.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new m_(n),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=r,this.snapMode=i,this.undoLength=o,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let n of this.eventListenersSuccess)n(JSON.parse(e));else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let n of this.eventListenersUpdated)n(JSON.parse(e))}}const Fv="MZEJTanw3WpxRvt7qDfo";let Pl=Gn(null),Bv=Gn("streets-v2"),nm=Gn(!1),nc=Gn(""),D_=Gn(!0),Zi=Gn(null),Vv=Gn(new Q_.LngLat(0,0)),Uv=Gn(new Q_.LngLat(0,0)),S2=Gn(1),Xu=Gn(1),Tn=Gn({mode:"title"}),jv=Gn("walk_cycle_only"),E2=Gn(!1);function Vf(){let t=rs(nc);t||window.alert("Autosave failed; no projectName set?!"),window.localStorage.setItem(t,rs(Zi).toSavefile())}function I2(t){let e,n;return e=new $_({props:{$$slots:{default:[ER,({dialog:r})=>({3:r}),({dialog:r})=>r?8:0]},$$scope:{ctx:t}}}),e.$on("close",t[2]),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,i){const o={};i&24&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function ER(t){let e,n,r,i,o,c,l,d,y,S,E,C,A,M;function R(){return t[1](t[3])}return{c(){e=pe("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",n=je(),r=pe("p"),r.innerHTML=`This is an <b>experimental</b>
      version of the
      <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>
      . Most parts of it do not work yet, and you should probably use the other version
      of the tool instead.`,i=je(),o=pe("p"),o.textContent="To use this tool, you need to:",c=je(),l=pe("ol"),l.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, fix the basemap data on existing modal filters, turn
        restrictions, one-ways, etc</li> <li>Create one or more proposals with new modal filters, and explore their
        effects</li>`,d=je(),y=pe("p"),y.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
      and relies heavily on
      <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
      data.`,S=je(),E=pe("center"),C=pe("button"),C.textContent="Start!"},m(N,B){be(N,e,B),be(N,n,B),be(N,r,B),be(N,i,B),be(N,o,B),be(N,c,B),be(N,l,B),be(N,d,B),be(N,y,B),be(N,S,B),be(N,E,B),te(E,C),A||(M=Lt(C,"click",R),A=!0)},p(N,B){t=N},d(N){N&&(ve(e),ve(n),ve(r),ve(i),ve(o),ve(c),ve(l),ve(d),ve(y),ve(S),ve(E)),A=!1,M()}}}function IR(t){let e,n,r=t[0]&&I2(t);return{c(){r&&r.c(),e=ki()},m(i,o){r&&r.m(i,o),be(i,e,o),n=!0},p(i,[o]){i[0]?r?(r.p(i,o),o&1&&ne(r,1)):(r=I2(i),r.c(),ne(r,1),r.m(e.parentNode,e)):r&&(Rn(),de(r,1,1,()=>{r=null}),Nn())},i(i){n||(ne(r),n=!0)},o(i){de(r),n=!1},d(i){i&&ve(e),r&&r.d(i)}}}function CR(t,e,n){let r;return wt(t,D_,c=>n(0,r=c)),[r,c=>Vr(c).close(),()=>Ut(D_,r=!1,r)]}class TR extends Qt{constructor(e){super(),Jt(this,e,CR,IR,Ht,{})}}const LR="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",PR="/ltn/assets/logo-97f2d067.svg";let MR=Date.now();function _p(t){return`${t}-${MR++}`}const j1=Symbol.for("svelte-maplibre");function ph(){return UE(j1)}function kR(t){let e=new WeakMap;return n=>{var c;let r=e.get(n.originalEvent);if(r!==void 0)return r;let o=(c=n.target.queryRenderedFeatures(n.point).find(l=>{var d;return(d=t.get(l.layer.id))==null?void 0:d.interactive}))==null?void 0:c.layer.id;return e.set(n.originalEvent,o),o}}function AR(){let t=new Map;return p1(j1,{map:Gn(null),source:D0(null),layer:D0(null),popupTarget:D0(null),cluster:Gn(),loadedImages:Gn(new Set),minzoom:Gn(0),maxzoom:Gn(24),layerEvent:Gn(null),layerInfo:t,eventTopMost:kR(t),markerClickManager:new zR})}function C2(t){return{subscribe:t.subscribe}}function G1({key:t,setPopupTarget:e=!1,setCluster:n=!1,setMouseEvent:r=!1}){let i=ph(),o=Gn(null),c=C2(o),l={...i,[t]:C2(o)};if(e&&(l.popupTarget=c),r){let d=Gn(null);l.layerEvent=d,i.layerEvent=d}return n&&(l.cluster=Gn()),p1(j1,l),{...i,self:o}}function DR(){return G1({key:"source",setCluster:!0})}function RR(t=!0){return G1({key:"layer",setPopupTarget:t,setMouseEvent:t})}function NR(){return G1({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}function OR(t){return"layerType"in t&&t.layerType==="deckgl"}class zR{constructor(){Ci(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const n of this._handlers)n(e)}}function T2(t){let e;return n=>{if(n)for(let r in n){let i=e==null?void 0:e[r],o=n[r];i!==o&&t(r,o,i)}else if(e)for(let r in e)t(r,void 0,e[r]);e=n}}function FR(t,...e){let n=[t];for(let r of e)if(r)Array.isArray(r)&&r[0]===t?n.push(...r.slice(1)):n.push(r);else continue;if(n.length!==1)return n.length===2?n[1]:n}function BR(t){return t===!0?["has","point_count"]:t===!1?["!",["has","point_count"]]:void 0}function Uf(t,e){return["case",["boolean",["feature-state","hover"],!1],e,t]}var Kc=VR;function VR(t){var e,n,r;if(t){if(Array.isArray(t)){for(e=[],n=t.length,r=0;r<n;r++){var i=t[r];i!=null&&e.push(i)}return e}if(typeof t=="object"){e={};var o=Object.keys(t);for(n=o.length,r=0;r<n;r++){var c=o[r],l=t[c];l!=null&&(e[c]=l)}return e}}}function L2(t){let e=t[0],n,r,i=P2(t);return{c(){i.c(),n=ki()},m(o,c){i.m(o,c),be(o,n,c),r=!0},p(o,c){c[0]&1&&Ht(e,e=o[0])?(Rn(),de(i,1,1,Mt),Nn(),i=P2(o),i.c(),ne(i,1),i.m(n.parentNode,n)):i.p(o,c)},i(o){r||(ne(i),r=!0)},o(o){de(i),r=!1},d(o){o&&ve(n),i.d(o)}}}function P2(t){let e;const n=t[36].default,r=hr(n,t,t[35],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),e=!0},p(i,o){r&&r.p&&(!e||o[1]&16)&&pr(r,n,i,i[35],e?fr(n,i[35],o,null):dr(i[35]),null)},i(i){e||(ne(r,i),e=!0)},o(i){de(r,i),e=!1},d(i){r&&r.d(i)}}}function UR(t){let e,n,r=t[0]&&L2(t);return{c(){r&&r.c(),e=ki()},m(i,o){r&&r.m(i,o),be(i,e,o),n=!0},p(i,o){i[0]?r?(r.p(i,o),o[0]&1&&ne(r,1)):(r=L2(i),r.c(),ne(r,1),r.m(e.parentNode,e)):r&&(Rn(),de(r,1,1,()=>{r=null}),Nn())},i(i){n||(ne(r),n=!0)},o(i){de(r),n=!1},d(i){i&&ve(e),r&&r.d(i)}}}function jR(t,e,n){let r,i,o,c,l,d,y,S,E,C,A,M,{$$slots:R={},$$scope:N}=e,{id:B=_p("layer")}=e,{source:O=void 0}=e,{sourceLayer:G=void 0}=e,{beforeId:U=void 0}=e,{beforeLayerType:Z=void 0}=e,{type:ue}=e,{paint:ae=void 0}=e,{layout:se=void 0}=e,{filter:fe=void 0}=e,{applyToClusters:ke=void 0}=e,{minzoom:K=void 0}=e,{maxzoom:oe=void 0}=e,{manageHoverState:Ge=!1}=e,{hovered:Te=null}=e,{interactive:ot=!0}=e,{hoverCursor:ft=void 0}=e,{eventsIfTopMost:At=!1}=e;const Ke=zl(),{map:Ft,source:bt,self:Rt,minzoom:Ot,maxzoom:ln,eventTopMost:Ln,layerInfo:an}=RR();wt(t,Ft,Le=>n(31,E=Le)),wt(t,bt,Le=>n(32,C=Le)),wt(t,Rt,Le=>n(0,S=Le)),wt(t,Ot,Le=>n(34,M=Le)),wt(t,ln,Le=>n(33,A=Le)),Hi(()=>{S&&E&&(an.delete(S),E==null||E.removeLayer(S))});let Xt;function En(Le){var me,tn;if(!ot||!S||!E||At&&Ln(Le)!==S)return;let rt=Le.features??[],gt=(tn=(me=rt[0])==null?void 0:me.properties)==null?void 0:tn.cluster_id,Nt={event:Le,map:E,clusterId:gt,layer:S,source:l,features:rt};Ke(Le.type,Nt)}function In(Le){var me,tn;if(!ot||!S||!E||At&&Ln(Le)!==S)return;ft&&(E.getCanvas().style.cursor=ft);let rt=Le.features??[];n(6,Te=rt[0]??null);let gt=(tn=(me=rt[0])==null?void 0:me.properties)==null?void 0:tn.cluster_id;Ke("mouseenter",{event:Le,map:E,clusterId:gt,layer:S,source:l,features:rt})}function rr(Le){var me,tn,Xe;if(!ot||!E)return;if(At&&Ln(Le)!==S){n(6,Te=null),Ge&&Xt!==void 0&&(E==null||E.setFeatureState({source:l,sourceLayer:G,id:Xt},{hover:!1}),Xt=void 0);return}E.getCanvas().style.cursor=ft;let rt=Le.features??[],gt=(tn=(me=rt[0])==null?void 0:me.properties)==null?void 0:tn.cluster_id,Nt=(Xe=rt[0])==null?void 0:Xe.id;Nt!==Xt&&(Ge&&(Xt!==void 0&&(E==null||E.setFeatureState({source:l,id:Xt,sourceLayer:G},{hover:!1})),E==null||E.setFeatureState({source:l,id:Nt,sourceLayer:G},{hover:!0})),Xt=Nt,n(6,Te=rt[0]??null)),Ke("mousemove",{event:Le,map:E,clusterId:gt,layer:S,source:l,features:rt})}function mt(Le){if(!(!ot||!S||!E)){if(ft&&(E.getCanvas().style.cursor=""),n(6,Te=null),Ge&&Xt!==void 0){const rt={source:l,id:Xt,sourceLayer:G};E==null||E.setFeatureState(rt,{hover:!1}),Xt=void 0}Ke("mouseleave",{map:E,layer:S,source:l})}}let Dt=!0;function Sn(Le){E&&(E.off("click",Le,En),E.off("dblclick",Le,En),E.off("contextmenu",Le,En),E.off("mouseenter",Le,In),E.off("mousemove",Le,rr),E.off("mouseleave",Le,mt))}return Hi(()=>{E&&S&&Sn(S)}),t.$$set=Le=>{"id"in Le&&n(7,B=Le.id),"source"in Le&&n(8,O=Le.source),"sourceLayer"in Le&&n(9,G=Le.sourceLayer),"beforeId"in Le&&n(10,U=Le.beforeId),"beforeLayerType"in Le&&n(11,Z=Le.beforeLayerType),"type"in Le&&n(12,ue=Le.type),"paint"in Le&&n(13,ae=Le.paint),"layout"in Le&&n(14,se=Le.layout),"filter"in Le&&n(15,fe=Le.filter),"applyToClusters"in Le&&n(16,ke=Le.applyToClusters),"minzoom"in Le&&n(17,K=Le.minzoom),"maxzoom"in Le&&n(18,oe=Le.maxzoom),"manageHoverState"in Le&&n(19,Ge=Le.manageHoverState),"hovered"in Le&&n(6,Te=Le.hovered),"interactive"in Le&&n(20,ot=Le.interactive),"hoverCursor"in Le&&n(21,ft=Le.hoverCursor),"eventsIfTopMost"in Le&&n(22,At=Le.eventsIfTopMost),"$$scope"in Le&&n(35,N=Le.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&65536&&n(30,r=BR(ke)),t.$$.dirty[0]&1073774592&&n(24,i=FR("all",r,fe)),t.$$.dirty[0]&131072|t.$$.dirty[1]&8&&n(26,o=K??M),t.$$.dirty[0]&262144|t.$$.dirty[1]&4&&n(25,c=oe??A),t.$$.dirty[0]&256|t.$$.dirty[1]&2&&n(29,l=O||C),t.$$.dirty[0]&654343809|t.$$.dirty[1]&1&&E&&S!==B&&l){S&&(Sn(S),an.delete(S));let Le=U;if(!U&&Z){let rt=E.getStyle().layers,gt=typeof Z=="function"?Z:me=>me.type===Z,Nt=rt==null?void 0:rt.find(gt);Nt&&(Le=Nt.id)}Ut(Rt,S=B,S),E.addLayer(Kc({id:S,type:ue,source:l,"source-layer":G,filter:i,paint:ae,layout:se,minzoom:o,maxzoom:c}),Le),n(23,Dt=!0),E.on("click",S,En),E.on("dblclick",S,En),E.on("contextmenu",S,En),E.on("mouseenter",S,In),E.on("mousemove",S,rr),E.on("mouseleave",S,mt)}t.$$.dirty[0]&1048577&&S&&an.set(S,{interactive:ot}),t.$$.dirty[0]&1|t.$$.dirty[1]&1&&n(28,d=S?T2((Le,rt)=>{E!=null&&E.style._loaded?E.setPaintProperty(S,Le,rt):E==null||E.once("styledata",()=>E==null?void 0:E.setPaintProperty(S,Le,rt))}):void 0),t.$$.dirty[0]&1|t.$$.dirty[1]&1&&n(27,y=S?T2((Le,rt)=>{E!=null&&E.style._loaded?E.setLayoutProperty(S,Le,rt):E==null||E.once("styledata",()=>E==null?void 0:E.setLayoutProperty(S,Le,rt))}):void 0),t.$$.dirty[0]&268443648&&(d==null||d(ae)),t.$$.dirty[0]&134234112&&(y==null||y(se)),t.$$.dirty[0]&100663297|t.$$.dirty[1]&1&&S&&(E==null||E.setLayerZoomRange(S,o,c)),t.$$.dirty[0]&25165825|t.$$.dirty[1]&1&&S&&(Dt?n(23,Dt=!1):E==null||E.setFilter(S,i))},[S,Ft,bt,Rt,Ot,ln,Te,B,O,G,U,Z,ue,ae,se,fe,ke,K,oe,Ge,ot,ft,At,Dt,i,c,o,y,d,l,r,E,C,A,M,N,R]}let oy=class extends Qt{constructor(e){super(),Jt(this,e,jR,UR,Ht,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function GR(t){let e;const n=t[16].default,r=hr(n,t,t[24],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),e=!0},p(i,o){r&&r.p&&(!e||o&16777216)&&pr(r,n,i,i[24],e?fr(n,i[24],o,null):dr(i[24]),null)},i(i){e||(ne(r,i),e=!0)},o(i){de(r,i),e=!1},d(i){r&&r.d(i)}}}function qR(t){let e,n,r;function i(c){t[17](c)}let o={id:t[1],type:"circle",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[GR]},$$scope:{ctx:t}};return t[0]!==void 0&&(o.hovered=t[0]),e=new oy({props:o}),Gr.push(()=>xa(e,"hovered",i)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){Ve(e.$$.fragment)},m(c,l){Fe(e,c,l),r=!0},p(c,[l]){const d={};l&2&&(d.id=c[1]),l&4&&(d.source=c[2]),l&8&&(d.sourceLayer=c[3]),l&16&&(d.beforeId=c[4]),l&32&&(d.beforeLayerType=c[5]),l&64&&(d.paint=c[6]),l&128&&(d.layout=c[7]),l&256&&(d.filter=c[8]),l&512&&(d.applyToClusters=c[9]),l&1024&&(d.minzoom=c[10]),l&2048&&(d.maxzoom=c[11]),l&4096&&(d.hoverCursor=c[12]),l&8192&&(d.manageHoverState=c[13]),l&16384&&(d.eventsIfTopMost=c[14]),l&32768&&(d.interactive=c[15]),l&16777216&&(d.$$scope={dirty:l,ctx:c}),!n&&l&1&&(n=!0,d.hovered=c[0],ba(()=>n=!1)),e.$set(d)},i(c){r||(ne(e.$$.fragment,c),r=!0)},o(c){de(e.$$.fragment,c),r=!1},d(c){Be(e,c)}}}function WR(t,e,n){let{$$slots:r={},$$scope:i}=e,{id:o=_p("circle")}=e,{source:c=void 0}=e,{sourceLayer:l=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:y=void 0}=e,{paint:S}=e,{layout:E=void 0}=e,{filter:C=void 0}=e,{applyToClusters:A=void 0}=e,{minzoom:M=void 0}=e,{maxzoom:R=void 0}=e,{hoverCursor:N=void 0}=e,{manageHoverState:B=!1}=e,{hovered:O=null}=e,{eventsIfTopMost:G=!1}=e,{interactive:U=!0}=e;function Z(oe){O=oe,n(0,O)}function ue(oe){xn.call(this,t,oe)}function ae(oe){xn.call(this,t,oe)}function se(oe){xn.call(this,t,oe)}function fe(oe){xn.call(this,t,oe)}function ke(oe){xn.call(this,t,oe)}function K(oe){xn.call(this,t,oe)}return t.$$set=oe=>{"id"in oe&&n(1,o=oe.id),"source"in oe&&n(2,c=oe.source),"sourceLayer"in oe&&n(3,l=oe.sourceLayer),"beforeId"in oe&&n(4,d=oe.beforeId),"beforeLayerType"in oe&&n(5,y=oe.beforeLayerType),"paint"in oe&&n(6,S=oe.paint),"layout"in oe&&n(7,E=oe.layout),"filter"in oe&&n(8,C=oe.filter),"applyToClusters"in oe&&n(9,A=oe.applyToClusters),"minzoom"in oe&&n(10,M=oe.minzoom),"maxzoom"in oe&&n(11,R=oe.maxzoom),"hoverCursor"in oe&&n(12,N=oe.hoverCursor),"manageHoverState"in oe&&n(13,B=oe.manageHoverState),"hovered"in oe&&n(0,O=oe.hovered),"eventsIfTopMost"in oe&&n(14,G=oe.eventsIfTopMost),"interactive"in oe&&n(15,U=oe.interactive),"$$scope"in oe&&n(24,i=oe.$$scope)},[O,o,c,l,d,y,S,E,C,A,M,R,N,B,G,U,r,Z,ue,ae,se,fe,ke,K,i]}let q1=class extends Qt{constructor(e){super(),Jt(this,e,WR,qR,Ht,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function HR(t){let e;const n=t[15].default,r=hr(n,t,t[23],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),e=!0},p(i,o){r&&r.p&&(!e||o&8388608)&&pr(r,n,i,i[23],e?fr(n,i[23],o,null):dr(i[23]),null)},i(i){e||(ne(r,i),e=!0)},o(i){de(r,i),e=!1},d(i){r&&r.d(i)}}}function ZR(t){let e,n,r;function i(c){t[16](c)}let o={id:t[1],type:"fill",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],minzoom:t[9],maxzoom:t[10],hoverCursor:t[11],manageHoverState:t[12],eventsIfTopMost:t[13],interactive:t[14],$$slots:{default:[HR]},$$scope:{ctx:t}};return t[0]!==void 0&&(o.hovered=t[0]),e=new oy({props:o}),Gr.push(()=>xa(e,"hovered",i)),e.$on("click",t[17]),e.$on("dblclick",t[18]),e.$on("contextmenu",t[19]),e.$on("mouseenter",t[20]),e.$on("mousemove",t[21]),e.$on("mouseleave",t[22]),{c(){Ve(e.$$.fragment)},m(c,l){Fe(e,c,l),r=!0},p(c,[l]){const d={};l&2&&(d.id=c[1]),l&4&&(d.source=c[2]),l&8&&(d.sourceLayer=c[3]),l&16&&(d.beforeId=c[4]),l&32&&(d.beforeLayerType=c[5]),l&64&&(d.paint=c[6]),l&128&&(d.layout=c[7]),l&256&&(d.filter=c[8]),l&512&&(d.minzoom=c[9]),l&1024&&(d.maxzoom=c[10]),l&2048&&(d.hoverCursor=c[11]),l&4096&&(d.manageHoverState=c[12]),l&8192&&(d.eventsIfTopMost=c[13]),l&16384&&(d.interactive=c[14]),l&8388608&&(d.$$scope={dirty:l,ctx:c}),!n&&l&1&&(n=!0,d.hovered=c[0],ba(()=>n=!1)),e.$set(d)},i(c){r||(ne(e.$$.fragment,c),r=!0)},o(c){de(e.$$.fragment,c),r=!1},d(c){Be(e,c)}}}function XR(t,e,n){let{$$slots:r={},$$scope:i}=e,{id:o=_p("fill")}=e,{source:c=void 0}=e,{sourceLayer:l=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:y=void 0}=e,{paint:S}=e,{layout:E=void 0}=e,{filter:C=void 0}=e,{minzoom:A=void 0}=e,{maxzoom:M=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:N=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:G=!0}=e;function U(K){B=K,n(0,B)}function Z(K){xn.call(this,t,K)}function ue(K){xn.call(this,t,K)}function ae(K){xn.call(this,t,K)}function se(K){xn.call(this,t,K)}function fe(K){xn.call(this,t,K)}function ke(K){xn.call(this,t,K)}return t.$$set=K=>{"id"in K&&n(1,o=K.id),"source"in K&&n(2,c=K.source),"sourceLayer"in K&&n(3,l=K.sourceLayer),"beforeId"in K&&n(4,d=K.beforeId),"beforeLayerType"in K&&n(5,y=K.beforeLayerType),"paint"in K&&n(6,S=K.paint),"layout"in K&&n(7,E=K.layout),"filter"in K&&n(8,C=K.filter),"minzoom"in K&&n(9,A=K.minzoom),"maxzoom"in K&&n(10,M=K.maxzoom),"hoverCursor"in K&&n(11,R=K.hoverCursor),"manageHoverState"in K&&n(12,N=K.manageHoverState),"hovered"in K&&n(0,B=K.hovered),"eventsIfTopMost"in K&&n(13,O=K.eventsIfTopMost),"interactive"in K&&n(14,G=K.interactive),"$$scope"in K&&n(23,i=K.$$scope)},[B,o,c,l,d,y,S,E,C,A,M,R,N,O,G,r,U,Z,ue,ae,se,fe,ke,i]}let mc=class extends Qt{constructor(e){super(),Jt(this,e,XR,ZR,Ht,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function YR(t,e,n){let r;const{map:i}=ph();wt(t,i,d=>n(4,r=d));let{position:o="top-left"}=e,{container:c=void 0}=e,l=null;return Hi(()=>{r!=null&&r.loaded()&&l&&r.removeControl(l)}),t.$$set=d=>{"position"in d&&n(1,o=d.position),"container"in d&&n(2,c=d.container)},t.$$.update=()=>{if(t.$$.dirty&30&&r&&!l){let d;typeof c=="string"?d=document.querySelector(c)??void 0:d=c,n(3,l=new Vs.FullscreenControl({container:d})),r.addControl(l,o)}},[i,o,c,l,r]}class $R extends Qt{constructor(e){super(),Jt(this,e,YR,null,Ht,{position:1,container:2})}}function KR(t,e,n,r,i){let o=!1;t.getSource(e)&&(o=!0,t.removeSource(e));const c=()=>{r(e)&&(t.addSource(e,n),i())};if(o){const l=()=>{e&&(t.getSource(e)?setTimeout(l,1):c())};l()}else c()}function JR(t,e,n){qE().then(()=>{let r=rs(t);if(!r)return;r.getSource(e)===n&&r.removeSource(e)})}function M2(t){let e=t[0],n,r,i=k2(t);return{c(){i.c(),n=ki()},m(o,c){i.m(o,c),be(o,n,c),r=!0},p(o,c){c&1&&Ht(e,e=o[0])?(Rn(),de(i,1,1,Mt),Nn(),i=k2(o),i.c(),ne(i,1),i.m(n.parentNode,n)):i.p(o,c)},i(o){r||(ne(i),r=!0)},o(o){de(i),r=!1},d(o){o&&ve(n),i.d(o)}}}function k2(t){let e;const n=t[19].default,r=hr(n,t,t[18],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),e=!0},p(i,o){r&&r.p&&(!e||o&262144)&&pr(r,n,i,i[18],e?fr(n,i[18],o,null):dr(i[18]),null)},i(i){e||(ne(r,i),e=!0)},o(i){de(r,i),e=!1},d(i){r&&r.d(i)}}}function QR(t){let e,n,r=t[0]&&M2(t);return{c(){r&&r.c(),e=ki()},m(i,o){r&&r.m(i,o),be(i,e,o),n=!0},p(i,[o]){i[0]?r?(r.p(i,o),o&1&&ne(r,1)):(r=M2(i),r.c(),ne(r,1),r.m(e.parentNode,e)):r&&(Rn(),de(r,1,1,()=>{r=null}),Nn())},i(i){n||(ne(r),n=!0)},o(i){de(r),n=!1},d(i){i&&ve(e),r&&r.d(i)}}}function eN(t,e,n){let r,i,o,{$$slots:c={},$$scope:l}=e,{id:d=_p("geojson")}=e,{data:y}=e,{generateId:S=!1}=e,{promoteId:E=void 0}=e,{filter:C=void 0}=e,{lineMetrics:A=void 0}=e,{cluster:M=void 0}=e,{maxzoom:R=void 0}=e,{attribution:N=void 0}=e,{buffer:B=void 0}=e,{tolerance:O=void 0}=e;const{map:G,cluster:U,self:Z}=DR();wt(t,G,se=>n(17,i=se)),wt(t,U,se=>n(20,o=se)),wt(t,Z,se=>n(0,r=se));let ue,ae=!0;return Hi(()=>{r&&ue&&i&&(JR(G,r,ue),Ut(Z,r=null,r),n(15,ue=void 0))}),t.$$set=se=>{"id"in se&&n(4,d=se.id),"data"in se&&n(5,y=se.data),"generateId"in se&&n(6,S=se.generateId),"promoteId"in se&&n(7,E=se.promoteId),"filter"in se&&n(8,C=se.filter),"lineMetrics"in se&&n(9,A=se.lineMetrics),"cluster"in se&&n(10,M=se.cluster),"maxzoom"in se&&n(11,R=se.maxzoom),"attribution"in se&&n(12,N=se.attribution),"buffer"in se&&n(13,B=se.buffer),"tolerance"in se&&n(14,O=se.tolerance),"$$scope"in se&&n(18,l=se.$$scope)},t.$$.update=()=>{t.$$.dirty&1024&&Ut(U,o=M,o),t.$$.dirty&196593&&i&&r!==d&&(Ut(Z,r=d,r),KR(i,r,Kc({type:"geojson",data:y,filter:C,lineMetrics:A,generateId:S,promoteId:E,cluster:!!M,clusterMinPoints:M==null?void 0:M.minPoints,clusterMaxZoom:M==null?void 0:M.maxZoom,clusterRadius:M==null?void 0:M.radius,clusterProperties:M==null?void 0:M.properties,maxzoom:R,attribution:N,buffer:B,tolerance:O}),se=>i&&se===r,()=>{r&&(n(15,ue=i==null?void 0:i.getSource(r)),n(16,ae=!0))})),t.$$.dirty&131088&&(i==null||i.on("style.load",()=>{n(15,ue=i==null?void 0:i.getSource(d))})),t.$$.dirty&98336&&ue&&(ae?n(16,ae=!1):ue.setData(y)),t.$$.dirty&33792&&(ue==null||ue.setClusterOptions(Kc({cluster:!!M,clusterMaxZoom:M==null?void 0:M.maxZoom,clusterRadius:M==null?void 0:M.radius})))},[r,G,U,Z,d,y,S,E,C,A,M,R,N,B,O,ue,ae,i,l,c]}let Fo=class extends Qt{constructor(e){super(),Jt(this,e,eN,QR,Ht,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}};function tN(t,e,n){let r;const{map:i}=ph();wt(t,i,C=>n(8,r=C));let{position:o="top-left"}=e,{positionOptions:c=void 0}=e,{fitBoundsOptions:l=void 0}=e,{trackUserLocation:d=!1}=e,{showAccuracyCircle:y=!0}=e,{showUserLocation:S=!0}=e,{control:E=null}=e;return Hi(()=>{r!=null&&r.loaded()&&E&&r.removeControl(E)}),t.$$set=C=>{"position"in C&&n(2,o=C.position),"positionOptions"in C&&n(3,c=C.positionOptions),"fitBoundsOptions"in C&&n(4,l=C.fitBoundsOptions),"trackUserLocation"in C&&n(5,d=C.trackUserLocation),"showAccuracyCircle"in C&&n(6,y=C.showAccuracyCircle),"showUserLocation"in C&&n(7,S=C.showUserLocation),"control"in C&&n(1,E=C.control)},t.$$.update=()=>{t.$$.dirty&510&&r&&!E&&(n(1,E=new Vs.GeolocateControl({positionOptions:c,fitBoundsOptions:l,trackUserLocation:d,showAccuracyCircle:y,showUserLocation:S})),r.addControl(E,o))},[i,E,o,c,l,d,y,S,r]}class nN extends Qt{constructor(e){super(),Jt(this,e,tN,null,Ht,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function rN(t){let e;const n=t[15].default,r=hr(n,t,t[23],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),e=!0},p(i,o){r&&r.p&&(!e||o&8388608)&&pr(r,n,i,i[23],e?fr(n,i[23],o,null):dr(i[23]),null)},i(i){e||(ne(r,i),e=!0)},o(i){de(r,i),e=!1},d(i){r&&r.d(i)}}}function iN(t){let e,n,r;function i(c){t[16](c)}let o={id:t[1],type:"line",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],minzoom:t[9],maxzoom:t[10],hoverCursor:t[11],manageHoverState:t[12],eventsIfTopMost:t[13],interactive:t[14],$$slots:{default:[rN]},$$scope:{ctx:t}};return t[0]!==void 0&&(o.hovered=t[0]),e=new oy({props:o}),Gr.push(()=>xa(e,"hovered",i)),e.$on("click",t[17]),e.$on("dblclick",t[18]),e.$on("contextmenu",t[19]),e.$on("mouseenter",t[20]),e.$on("mousemove",t[21]),e.$on("mouseleave",t[22]),{c(){Ve(e.$$.fragment)},m(c,l){Fe(e,c,l),r=!0},p(c,[l]){const d={};l&2&&(d.id=c[1]),l&4&&(d.source=c[2]),l&8&&(d.sourceLayer=c[3]),l&16&&(d.beforeId=c[4]),l&32&&(d.beforeLayerType=c[5]),l&64&&(d.paint=c[6]),l&128&&(d.layout=c[7]),l&256&&(d.filter=c[8]),l&512&&(d.minzoom=c[9]),l&1024&&(d.maxzoom=c[10]),l&2048&&(d.hoverCursor=c[11]),l&4096&&(d.manageHoverState=c[12]),l&8192&&(d.eventsIfTopMost=c[13]),l&16384&&(d.interactive=c[14]),l&8388608&&(d.$$scope={dirty:l,ctx:c}),!n&&l&1&&(n=!0,d.hovered=c[0],ba(()=>n=!1)),e.$set(d)},i(c){r||(ne(e.$$.fragment,c),r=!0)},o(c){de(e.$$.fragment,c),r=!1},d(c){Be(e,c)}}}function oN(t,e,n){let{$$slots:r={},$$scope:i}=e,{id:o=_p("line")}=e,{source:c=void 0}=e,{sourceLayer:l=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:y=void 0}=e,{paint:S}=e,{layout:E=void 0}=e,{filter:C=void 0}=e,{minzoom:A=void 0}=e,{maxzoom:M=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:N=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:G=!0}=e;function U(K){B=K,n(0,B)}function Z(K){xn.call(this,t,K)}function ue(K){xn.call(this,t,K)}function ae(K){xn.call(this,t,K)}function se(K){xn.call(this,t,K)}function fe(K){xn.call(this,t,K)}function ke(K){xn.call(this,t,K)}return t.$$set=K=>{"id"in K&&n(1,o=K.id),"source"in K&&n(2,c=K.source),"sourceLayer"in K&&n(3,l=K.sourceLayer),"beforeId"in K&&n(4,d=K.beforeId),"beforeLayerType"in K&&n(5,y=K.beforeLayerType),"paint"in K&&n(6,S=K.paint),"layout"in K&&n(7,E=K.layout),"filter"in K&&n(8,C=K.filter),"minzoom"in K&&n(9,A=K.minzoom),"maxzoom"in K&&n(10,M=K.maxzoom),"hoverCursor"in K&&n(11,R=K.hoverCursor),"manageHoverState"in K&&n(12,N=K.manageHoverState),"hovered"in K&&n(0,B=K.hovered),"eventsIfTopMost"in K&&n(13,O=K.eventsIfTopMost),"interactive"in K&&n(14,G=K.interactive),"$$scope"in K&&n(23,i=K.$$scope)},[B,o,c,l,d,y,S,E,C,A,M,R,N,O,G,r,U,Z,ue,ae,se,fe,ke,i]}let Ml=class extends Qt{constructor(e){super(),Jt(this,e,oN,iN,Ht,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function sN(t,e,n){let r;const i=zl();let{layer:o=void 0}=e;const{map:c}=ph();wt(t,c,S=>n(2,r=S));function l(S){i(S.type,{...S,map:c})}const d=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],y=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Hi(()=>{if(r)if(o)for(const S of d)r.off(S,o,l);else for(const S of y)r.off(S,l)}),t.$$set=S=>{"layer"in S&&n(1,o=S.layer)},t.$$.update=()=>{if(t.$$.dirty&6&&r)if(o)for(const S of d)r.on(S,o,l);else for(const S of y)r.on(S,l)},[c,o,r]}class aN extends Qt{constructor(e){super(),Jt(this,e,sN,null,Ht,{layer:1})}}function lN(t){let e=t.getCenter(),n=Math.round(t.getZoom()*100)/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,r),o=Math.round(e.lat*i)/i,c=Math.round(e.lng*i)/i,l=`${n}/${o}/${c}`,d=t.getBearing(),y=t.getPitch();return(d||y)&&(l+=`/${Math.round(d*10)/10}`),y&&(l+=`/${Math.round(y)}`),`#${l}`}function uN(t){return t.replace("#","").split("/").map(parseFloat)}var wf=W1;function W1(t,e){return t===e||t!==t&&e!==e?!0:typeof t!=typeof e||{}.toString.call(t)!={}.toString.call(e)||t!==Object(t)||!t?!1:Array.isArray(t)?A2(t,e):{}.toString.call(t)=="[object Set]"?A2(Array.from(t),Array.from(e)):{}.toString.call(t)=="[object Object]"?hN(t,e):cN(t,e)}function cN(t,e){return t.toString()===e.toString()}function A2(t,e){var n=t.length;if(n!=e.length)return!1;for(var r=0;r<n;r++)if(!W1(t[r],e[r]))return!1;return!0}function hN(t,e){var n=Object.keys(t),r=n.length;if(r!=Object.keys(e).length)return!1;for(var i=0;i<r;i++){var o=n[i];if(!(e.hasOwnProperty(o)&&W1(t[o],e[o])))return!1}return!0}function fN(t,e,n){let r;const{map:i}=ph();wt(t,i,S=>n(6,r=S));let{position:o="top-left"}=e,{showCompass:c=!0}=e,{showZoom:l=!0}=e,{visualizePitch:d=!1}=e,y=null;return Hi(()=>{r!=null&&r.loaded()&&y&&r.removeControl(y)}),t.$$set=S=>{"position"in S&&n(1,o=S.position),"showCompass"in S&&n(2,c=S.showCompass),"showZoom"in S&&n(3,l=S.showZoom),"visualizePitch"in S&&n(4,d=S.visualizePitch)},t.$$.update=()=>{t.$$.dirty&126&&r&&!y&&(n(5,y=new Vs.NavigationControl({showCompass:c,showZoom:l,visualizePitch:d})),r.addControl(y,o))},[i,o,c,l,d,y,r]}class pN extends Qt{constructor(e){super(),Jt(this,e,fN,null,Ht,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function dN(t,e,n){let r;const{map:i}=ph();wt(t,i,y=>n(5,r=y));let{position:o="bottom-left"}=e,{maxWidth:c=void 0}=e,{unit:l="metric"}=e,d=null;return Hi(()=>{r!=null&&r.loaded()&&d&&r.removeControl(d)}),t.$$set=y=>{"position"in y&&n(1,o=y.position),"maxWidth"in y&&n(2,c=y.maxWidth),"unit"in y&&n(3,l=y.unit)},t.$$.update=()=>{t.$$.dirty&62&&r&&!d&&(n(4,d=new Vs.ScaleControl({maxWidth:c,unit:l})),r.addControl(d,o))},[i,o,c,l,d,r]}class mN extends Qt{constructor(e){super(),Jt(this,e,dN,null,Ht,{position:1,maxWidth:2,unit:3})}}const{window:gN}=X_,_N=t=>({map:t[0]&16,loadedImages:t[0]&32,allImagesLoaded:t[0]&64}),D2=t=>({map:t[4],loadedImages:t[5],allImagesLoaded:t[6]});function R2(t){let e,n,r=t[3]&&N2(t);const i=t[46].default,o=hr(i,t,t[45],D2);return{c(){r&&r.c(),e=je(),o&&o.c()},m(c,l){r&&r.m(c,l),be(c,e,l),o&&o.m(c,l),n=!0},p(c,l){c[3]?r?(r.p(c,l),l[0]&8&&ne(r,1)):(r=N2(c),r.c(),ne(r,1),r.m(e.parentNode,e)):r&&(Rn(),de(r,1,1,()=>{r=null}),Nn()),o&&o.p&&(!n||l[0]&112|l[1]&16384)&&pr(o,i,c,c[45],n?fr(i,c[45],l,_N):dr(c[45]),D2)},i(c){n||(ne(r),ne(o,c),n=!0)},o(c){de(r),de(o,c),n=!1},d(c){c&&ve(e),r&&r.d(c),o&&o.d(c)}}}function N2(t){let e,n,r,i,o,c,l,d;return e=new pN({props:{position:t[7]}}),r=new nN({props:{position:t[7],fitBoundsOptions:{maxZoom:12}}}),o=new $R({props:{position:t[7]}}),l=new mN({props:{position:t[7]}}),{c(){Ve(e.$$.fragment),n=je(),Ve(r.$$.fragment),i=je(),Ve(o.$$.fragment),c=je(),Ve(l.$$.fragment)},m(y,S){Fe(e,y,S),be(y,n,S),Fe(r,y,S),be(y,i,S),Fe(o,y,S),be(y,c,S),Fe(l,y,S),d=!0},p(y,S){const E={};S[0]&128&&(E.position=y[7]),e.$set(E);const C={};S[0]&128&&(C.position=y[7]),r.$set(C);const A={};S[0]&128&&(A.position=y[7]),o.$set(A);const M={};S[0]&128&&(M.position=y[7]),l.$set(M)},i(y){d||(ne(e.$$.fragment,y),ne(r.$$.fragment,y),ne(o.$$.fragment,y),ne(l.$$.fragment,y),d=!0)},o(y){de(e.$$.fragment,y),de(r.$$.fragment,y),de(o.$$.fragment,y),de(l.$$.fragment,y),d=!1},d(y){y&&(ve(n),ve(i),ve(c)),Be(e,y),Be(r,y),Be(o,y),Be(l,y)}}}function yN(t){let e,n,r,i,o,c=t[4]&&t[0]&&R2(t);return{c(){e=pe("div"),c&&c.c(),Ce(e,"class",n=f_(t[2])+" svelte-p00lfq"),Ce(e,"data-testid","map-container"),no(e,"expand-map",!t[2])},m(l,d){be(l,e,d),c&&c.m(e,null),t[47](e),r=!0,i||(o=[Lt(gN,"hashchange",t[11]),cv(t[10].call(null,e))],i=!0)},p(l,d){l[4]&&l[0]?c?(c.p(l,d),d[0]&17&&ne(c,1)):(c=R2(l),c.c(),ne(c,1),c.m(e,null)):c&&(Rn(),de(c,1,1,()=>{c=null}),Nn()),(!r||d[0]&4&&n!==(n=f_(l[2])+" svelte-p00lfq"))&&Ce(e,"class",n),(!r||d[0]&4)&&no(e,"expand-map",!l[2])},i(l){r||(ne(c),r=!0)},o(l){de(c),r=!1},d(l){l&&ve(e),c&&c.d(),t[47](null),i=!1,Hr(o)}}}function vN(t,e,n){let r,i,o,c,{$$slots:l={},$$scope:d}=e,{map:y=null}=e,{mapContainer:S=void 0}=e,{class:E=void 0}=e,{style:C}=e,{diffStyleUpdates:A=!1}=e,{center:M=void 0}=e,{zoom:R=void 0}=e,{pitch:N=0}=e,{bearing:B=0}=e,{bounds:O=void 0}=e,{hash:G=!1}=e,{updateHash:U=Xe=>{window.history.replaceState(window.history.state,"",Xe)}}=e,{loaded:Z=!1}=e,{minZoom:ue=0}=e,{maxZoom:ae=22}=e,{minPitch:se=0}=e,{maxPitch:fe=60}=e,{renderWorldCopies:ke=void 0}=e,{dragPan:K=void 0}=e,{dragRotate:oe=void 0}=e,{pitchWithRotate:Ge=void 0}=e,{antialias:Te=void 0}=e,{zoomOnDoubleClick:ot=!0}=e,{locale:ft=void 0}=e,{interactive:At=!0}=e,{attributionControl:Ke=!0}=e,{cooperativeGestures:Ft=!1}=e,{preserveDrawingBuffer:bt=!1}=e,{maxBounds:Rt=void 0}=e,{images:Ot=[]}=e,{standardControls:ln=!1}=e,{filterLayers:Ln=void 0}=e,{transformRequest:an=void 0}=e;const Xt=zl(),{map:En,loadedImages:In}=AR();wt(t,En,Xe=>n(4,o=Xe)),wt(t,In,Xe=>n(5,c=Xe));let rr=new Set;async function mt(Xe,St=!1){if(o&&!(!o.loaded()&&!St))if("url"in Xe){rr.add(Xe.id);try{let hn=await o.loadImage(Xe.url);o==null||o.addImage(Xe.id,hn.data,Xe.options),c.add(Xe.id),In.set(c)}catch(hn){Xt("error",hn)}finally{rr.delete(Xe.id)}}else o.addImage(Xe.id,Xe.data,Xe.options),c.add(Xe.id),In.set(c)}let Dt,Sn,Le,rt;function gt(Xe){return me(),Ut(En,o=new Vs.Map(Kc({container:Xe,style:C,locale:ft,center:M,zoom:R,pitch:N,bearing:B,minZoom:ue,maxZoom:ae,minPitch:se,maxPitch:fe,renderWorldCopies:ke,dragPan:K,dragRotate:oe,pitchWithRotate:Ge,antialias:Te,interactive:At,preserveDrawingBuffer:bt,maxBounds:Rt,bounds:O,attributionControl:Ke,transformRequest:an,cooperativeGestures:Ft})),o),o.on("load",St=>{St.target.getContainer().setAttribute("data-testid","map"),St.target.getCanvas().setAttribute("data-testid","map-canvas"),n(0,Z=!0),Xt("load",o)}),o.on("error",St=>Xt("error",{...St,map:o})),o.on("movestart",St=>Xt("movestart",{...St,map:o})),o.on("moveend",St=>{if(n(12,M=St.target.getCenter()),n(13,R=St.target.getZoom()),n(14,N=St.target.getPitch()),n(15,B=St.target.getBearing()),n(16,O=St.target.getBounds()),Xt("moveend",{...St,map:o}),G){let hn=new URL(window.location.href.replace(/(#.+)?$/,lN(o)));U(hn)}}),o.on("click",St=>Xt("click",{...St,map:o})),o.on("dblclick",St=>Xt("dblclick",{...St,map:o})),o.on("contextmenu",St=>Xt("contextmenu",{...St,map:o})),o.on("zoomstart",St=>Xt("zoomstart",{...St,map:o})),o.on("zoom",St=>{Xt("zoom",{...St,map:o})}),o.on("zoomend",St=>{Xt("zoomend",{...St,map:o})}),o.on("style.load",()=>{if(o){const St=o.getStyle();if(n(42,Dt=St.layers.map(hn=>hn.id)),n(43,Sn=Object.keys(St.sources)),rt)for(const[hn,Ai]of Object.entries(rt))o.addSource(hn,Ai);if(Le)for(const hn of Le)o.addLayer(hn);for(const hn of Ot)mt(hn,!0)}}),o.on("styledata",St=>{if(o&&Ln){const hn=o.getStyle().layers;if(hn)for(let Ai of hn)Ln(Ai)||o.setLayoutProperty(Ai.id,"visibility","none")}Xt("styledata",{...St,map:o})}),{destroy(){n(0,Z=!1),o==null||o.remove(),Ut(En,o=null,o)}}}let Nt=C;function me(){if(G){let Xe=uN(window.location.hash);Xe.length>=3&&(n(13,R=Xe[0]),n(12,M=[Xe[2],Xe[1]])),Xe.length==5&&(n(15,B=Xe[3]),n(14,N=Xe[4]))}}function tn(Xe){Gr[Xe?"unshift":"push"](()=>{S=Xe,n(1,S)})}return t.$$set=Xe=>{"map"in Xe&&n(17,y=Xe.map),"mapContainer"in Xe&&n(1,S=Xe.mapContainer),"class"in Xe&&n(2,E=Xe.class),"style"in Xe&&n(18,C=Xe.style),"diffStyleUpdates"in Xe&&n(19,A=Xe.diffStyleUpdates),"center"in Xe&&n(12,M=Xe.center),"zoom"in Xe&&n(13,R=Xe.zoom),"pitch"in Xe&&n(14,N=Xe.pitch),"bearing"in Xe&&n(15,B=Xe.bearing),"bounds"in Xe&&n(16,O=Xe.bounds),"hash"in Xe&&n(20,G=Xe.hash),"updateHash"in Xe&&n(21,U=Xe.updateHash),"loaded"in Xe&&n(0,Z=Xe.loaded),"minZoom"in Xe&&n(22,ue=Xe.minZoom),"maxZoom"in Xe&&n(23,ae=Xe.maxZoom),"minPitch"in Xe&&n(24,se=Xe.minPitch),"maxPitch"in Xe&&n(25,fe=Xe.maxPitch),"renderWorldCopies"in Xe&&n(26,ke=Xe.renderWorldCopies),"dragPan"in Xe&&n(27,K=Xe.dragPan),"dragRotate"in Xe&&n(28,oe=Xe.dragRotate),"pitchWithRotate"in Xe&&n(29,Ge=Xe.pitchWithRotate),"antialias"in Xe&&n(30,Te=Xe.antialias),"zoomOnDoubleClick"in Xe&&n(31,ot=Xe.zoomOnDoubleClick),"locale"in Xe&&n(32,ft=Xe.locale),"interactive"in Xe&&n(33,At=Xe.interactive),"attributionControl"in Xe&&n(34,Ke=Xe.attributionControl),"cooperativeGestures"in Xe&&n(35,Ft=Xe.cooperativeGestures),"preserveDrawingBuffer"in Xe&&n(36,bt=Xe.preserveDrawingBuffer),"maxBounds"in Xe&&n(37,Rt=Xe.maxBounds),"images"in Xe&&n(38,Ot=Xe.images),"standardControls"in Xe&&n(3,ln=Xe.standardControls),"filterLayers"in Xe&&n(39,Ln=Xe.filterLayers),"transformRequest"in Xe&&n(40,an=Xe.transformRequest),"$$scope"in Xe&&n(45,d=Xe.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&8&&n(7,r=typeof ln=="boolean"?void 0:ln),t.$$.dirty[0]&16&&n(17,y=o),t.$$.dirty[0]&786448|t.$$.dirty[1]&14336&&o&&!wf(C,Nt)){const Xe=o.getStyle();if(Dt&&(Le=Xe.layers.filter(St=>!Dt.includes(St.id))),Sn){const St=Object.keys(Xe.sources).filter(hn=>!Sn.includes(hn));rt={};for(const hn of St)rt[hn]=Xe.sources[hn]}n(44,Nt=C),o.setStyle(C,{diff:A}),Ut(In,c=new Set,c),n(41,rr=new Set)}if(t.$$.dirty[0]&49|t.$$.dirty[1]&1152&&Z&&o!=null&&o.loaded())for(let Xe of Ot)!c.has(Xe.id)&&!rr.has(Xe.id)&&!o.hasImage(Xe.id)&&mt(Xe);if(t.$$.dirty[0]&32|t.$$.dirty[1]&128&&n(6,i=Ot.every(Xe=>c.has(Xe.id))),t.$$.dirty[0]&61456&&o){let Xe={};M!=null&&!wf(M,o==null?void 0:o.getCenter())&&(Xe.center=M),R!=null&&!wf(R,o==null?void 0:o.getZoom())&&(Xe.zoom=R),B!=null&&!wf(B,o==null?void 0:o.getBearing())&&(Xe.bearing=B),N!=null&&!wf(N,o==null?void 0:o.getPitch())&&(Xe.pitch=N),Object.keys(Xe).length&&o.easeTo(Xe)}t.$$.dirty[0]&65552&&O&&!wf(O,o==null?void 0:o.getBounds())&&(o==null||o.fitBounds(O)),t.$$.dirty[0]&16|t.$$.dirty[1]&1&&(ot?o==null||o.doubleClickZoom.enable():o==null||o.doubleClickZoom.disable())},[Z,S,E,ln,o,c,i,r,En,In,gt,me,M,R,N,B,O,y,C,A,G,U,ue,ae,se,fe,ke,K,oe,Ge,Te,ot,ft,At,Ke,Ft,bt,Rt,Ot,Ln,an,rr,Dt,Sn,Nt,d,l,tn]}class bN extends Qt{constructor(e){super(),Jt(this,e,vN,yN,Ht,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const xN=t=>({marker:t&8}),O2=t=>({marker:t[3]});function wN(t){let e,n,r,i,o,c,l;const d=t[19].default,y=hr(d,t,t[18],O2);return{c(){e=pe("div"),y&&y.c(),Ce(e,"tabindex",n=t[1]?0:void 0),Ce(e,"role",r=t[1]?"button":void 0),gr(e,"z-index",t[2])},m(S,E){be(S,e,E),y&&y.m(e,null),o=!0,c||(l=[cv(t[7].call(null,e)),cv(i=SN.call(null,e,t[0])),Lt(e,"click",k0(t[20])),Lt(e,"dblclick",k0(t[21])),Lt(e,"contextmenu",k0(h1(t[22]))),Lt(e,"mouseenter",t[23]),Lt(e,"mouseleave",t[24]),Lt(e,"mousemove",t[25]),Lt(e,"keydown",t[8])],c=!0)},p(S,[E]){y&&y.p&&(!o||E&262152)&&pr(y,d,S,S[18],o?fr(d,S[18],E,xN):dr(S[18]),O2),(!o||E&2&&n!==(n=S[1]?0:void 0))&&Ce(e,"tabindex",n),(!o||E&2&&r!==(r=S[1]?"button":void 0))&&Ce(e,"role",r),i&&Nf(i.update)&&E&1&&i.update.call(null,S[0]),E&4&&gr(e,"z-index",S[2])},i(S){o||(ne(y,S),o=!0)},o(S){de(y,S),o=!1},d(S){S&&ve(e),y&&y.d(S),c=!1,Hr(l)}}}function SN(t,e){const n=t.className;function r(i){i?t.className=`${n} ${i}`:t.className=n}return r(e),{update:r}}function EN(t,e,n){let r,i,o,{$$slots:c={},$$scope:l}=e,{marker:d=void 0}=e,{lngLat:y}=e,{class:S=void 0}=e,{interactive:E=!0}=e,{asButton:C=!1}=e,{draggable:A=!1}=e,{feature:M=null}=e,{offset:R=void 0}=e,{zIndex:N=void 0}=e,{rotation:B=0}=e,{opacity:O=1}=e;const G=zl(),{map:U,layerEvent:Z,self:ue,markerClickManager:ae}=NR();wt(t,U,Ke=>n(27,o=Ke)),wt(t,Z,Ke=>n(26,r=Ke)),wt(t,ue,Ke=>n(3,i=Ke));function se(Ke){Ut(ue,i=new Vs.Marker({element:Ke,rotation:B,draggable:A,offset:R,opacity:O.toString()}).setLngLat(y).addTo(o),i),n(11,d=i);const Ft=()=>K("dragstart"),bt=()=>{fe(),K("drag")},Rt=()=>{fe(),K("dragend")};return A&&(i.on("dragstart",Ft),i.on("drag",bt),i.on("dragend",Rt)),{destroy(){A&&(i==null||i.off("dragstart",Ft),i==null||i.off("drag",bt),i==null||i.off("dragend",Rt)),n(11,d=void 0),i==null||i.remove()}}}function fe(){let Ke=i==null?void 0:i.getLngLat();Ke&&(Array.isArray(y)?n(10,y=[Ke.lng,Ke.lat]):y&&"lon"in y?n(10,y={lon:Ke.lng,lat:Ke.lat}):n(10,y=Ke))}function ke(Ke){Ke.key===" "&&(Ke.preventDefault(),Ke.stopPropagation(),K("click"))}function K(Ke){if(!E)return;let Ft=i==null?void 0:i.getLngLat();if(!Ft)return;const bt=[Ft.lng,Ft.lat];let Rt={map:o,marker:i,lngLat:bt,features:[{type:"Feature",properties:(M==null?void 0:M.properties)??{},geometry:{type:"Point",coordinates:bt}}]};(Ke==="click"||Ke==="contextmenu")&&ae.handleClick(Rt),Ut(Z,r={...Rt,layerType:"marker",type:Ke},r),G(Ke,Rt)}const oe=()=>K("click"),Ge=()=>K("dblclick"),Te=()=>{K("contextmenu")},ot=()=>{K("mouseenter")},ft=()=>{K("mouseleave")},At=()=>K("mousemove");return t.$$set=Ke=>{"marker"in Ke&&n(11,d=Ke.marker),"lngLat"in Ke&&n(10,y=Ke.lngLat),"class"in Ke&&n(0,S=Ke.class),"interactive"in Ke&&n(12,E=Ke.interactive),"asButton"in Ke&&n(1,C=Ke.asButton),"draggable"in Ke&&n(13,A=Ke.draggable),"feature"in Ke&&n(14,M=Ke.feature),"offset"in Ke&&n(15,R=Ke.offset),"zIndex"in Ke&&n(2,N=Ke.zIndex),"rotation"in Ke&&n(16,B=Ke.rotation),"opacity"in Ke&&n(17,O=Ke.opacity),"$$scope"in Ke&&n(18,l=Ke.$$scope)},t.$$.update=()=>{t.$$.dirty&1032&&(i==null||i.setLngLat(y)),t.$$.dirty&32776&&(i==null||i.setOffset(R??[0,0])),t.$$.dirty&65544&&(i==null||i.setRotation(B)),t.$$.dirty&131080&&(i==null||i.setOpacity(O.toString()))},[S,C,N,i,U,Z,ue,se,ke,K,y,d,E,A,M,R,B,O,l,c,oe,Ge,Te,ot,ft,At]}class R_ extends Qt{constructor(e){super(),Jt(this,e,EN,wN,Ht,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}const IN=t=>({features:t[0]&16,data:t[0]&16,map:t[0]&4,close:t[0]&1}),z2=t=>{var e;return{features:t[4],data:((e=t[4])==null?void 0:e[0])??null,map:t[2],close:t[31]}};function F2(t){var i;let e,n,r=(((i=t[4])==null?void 0:i.length)||t[3]instanceof Vs.Marker)&&B2(t);return{c(){e=pe("div"),r&&r.c()},m(o,c){be(o,e,c),r&&r.m(e,null),t[32](e),n=!0},p(o,c){var l;(l=o[4])!=null&&l.length||o[3]instanceof Vs.Marker?r?(r.p(o,c),c[0]&24&&ne(r,1)):(r=B2(o),r.c(),ne(r,1),r.m(e,null)):r&&(Rn(),de(r,1,1,()=>{r=null}),Nn())},i(o){n||(ne(r),n=!0)},o(o){de(r),n=!1},d(o){o&&ve(e),r&&r.d(),t[32](null)}}}function B2(t){let e;const n=t[30].default,r=hr(n,t,t[29],z2);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),e=!0},p(i,o){r&&r.p&&(!e||o[0]&536870933)&&pr(r,n,i,i[29],e?fr(n,i[29],o,IN):dr(i[29]),z2)},i(i){e||(ne(r,i),e=!0)},o(i){de(r,i),e=!1},d(i){r&&r.d(i)}}}function CN(t){let e,n,r=t[9].default&&F2(t);return{c(){r&&r.c(),e=ki()},m(i,o){r&&r.m(i,o),be(i,e,o),n=!0},p(i,o){i[9].default?r?(r.p(i,o),o[0]&512&&ne(r,1)):(r=F2(i),r.c(),ne(r,1),r.m(e.parentNode,e)):r&&(Rn(),de(r,1,1,()=>{r=null}),Nn())},i(i){n||(ne(r),n=!0)},o(i){de(r),n=!1},d(i){i&&ve(e),r&&r.d(i)}}}function TN(t,e,n){let r,i,o,c,l,d,{$$slots:y={},$$scope:S}=e;const E=jP(y);let{closeButton:C=void 0}=e,{closeOnClickOutside:A=!0}=e,{closeOnClickInside:M=!1}=e,{closeOnMove:R=!1}=e,{openOn:N="click"}=e,{openIfTopMost:B=!0}=e,{focusAfterOpen:O=!0}=e,{anchor:G=void 0}=e,{offset:U=void 0}=e,{popupClass:Z=void 0}=e,{maxWidth:ue=void 0}=e,{lngLat:ae=void 0}=e,{html:se=void 0}=e,{open:fe=!1}=e;const ke=zl(),{map:K,popupTarget:oe,layerEvent:Ge,layer:Te,eventTopMost:ot,markerClickManager:ft}=ph();wt(t,K,me=>n(2,o=me)),wt(t,oe,me=>n(3,l=me)),wt(t,Ge,me=>n(28,c=me)),wt(t,Te,me=>n(35,d=me));const At=["click","dblclick","contextmenu"];let Ke,Ft=!1,bt;function Rt(){if(!Ke)return;let me=Ke.getElement();!me||me===bt||(bt=me,N==="hover"&&(bt.style.pointerEvents="none"),bt.addEventListener("mouseenter",()=>{n(24,Ft=!0)},{passive:!0}),bt.addEventListener("mouseleave",()=>{n(24,Ft=!1)},{passive:!0}),bt.addEventListener("click",()=>{M&&n(0,fe=!1)},{passive:!0}))}Y_(()=>{if(o)return o.on("click",Sn),o.on("contextmenu",Sn),ft.add(Le),typeof l=="string"&&(o.on("click",l,Xt),o.on("dblclick",l,Xt),o.on("contextmenu",l,Xt),o.on("mousemove",l,Dt),o.on("mouseleave",l,mt),o.on("touchstart",l,In),o.on("touchend",l,rr)),()=>{o!=null&&o.loaded()&&(Ke==null||Ke.remove(),o.off("click",Sn),o.off("contextmenu",Sn),ft.remove(Le),l instanceof Vs.Marker?l.getPopup()===Ke&&l.setPopup(void 0):typeof l=="string"&&(o.off("click",l,Xt),o.off("dblclick",l,Xt),o.off("contextmenu",l,Xt),o.off("mousemove",l,Dt),o.off("mouseleave",l,mt),o.off("touchstart",l,In),o.off("touchend",l,rr)))}});function Ot(me){return B?!("marker"in me)&&!OR(me)&&ot(me)!==d:!1}let ln=null,Ln="normal";function an(me){"layerType"in me&&me.layerType==="deckgl"?(n(10,ae=me.coordinate),n(4,ln=me.object?[me.object]:null)):(n(10,ae=me.lngLat),n(4,ln=me.features??[]))}function Xt(me){me.type!==N||Ot(me)||(an(me),setTimeout(()=>n(0,fe=!0)))}let En=null;function In(me){En=me.point}function rr(me){if(!En||N!=="hover")return;let tn=En.dist(me.point);En=null,tn<3&&(n(10,ae=me.lngLat),n(4,ln=me.features??[]),Ke.isOpen()?n(25,Ln="justOpened"):(n(25,Ln="opening"),n(0,fe=!0)))}function mt(me){N!=="hover"||En||Ln!=="normal"||(n(0,fe=!1),n(4,ln=null))}function Dt(me){if(!(N!=="hover"||En||Ln!=="normal")){if(Ot(me)){n(0,fe=!1),n(4,ln=null);return}n(0,fe=!0),n(4,ln=me.features??[]),n(10,ae=me.lngLat)}}function Sn(me){if(Ln==="justOpened"){n(25,Ln="normal");return}if(!A)return;let tn=[bt,l instanceof Vs.Marker?l==null?void 0:l.getElement():null];fe&&Ke.isOpen()&&!tn.some(Xe=>Xe==null?void 0:Xe.contains(me.originalEvent.target))&&(me.type==="contextmenu"&&N==="contextmenu"||me.type!=="contextmenu")&&n(0,fe=!1)}function Le(me){A&&fe&&Ke.isOpen()&&me.marker!==l&&n(0,fe=!1)}Hi(()=>{o&&(Ke!=null&&Ke.isOpen())&&Ke.remove()});let rt;const gt=()=>n(0,fe=!1);function Nt(me){Gr[me?"unshift":"push"](()=>{rt=me,n(1,rt)})}return t.$$set=me=>{"closeButton"in me&&n(11,C=me.closeButton),"closeOnClickOutside"in me&&n(12,A=me.closeOnClickOutside),"closeOnClickInside"in me&&n(13,M=me.closeOnClickInside),"closeOnMove"in me&&n(14,R=me.closeOnMove),"openOn"in me&&n(15,N=me.openOn),"openIfTopMost"in me&&n(16,B=me.openIfTopMost),"focusAfterOpen"in me&&n(17,O=me.focusAfterOpen),"anchor"in me&&n(18,G=me.anchor),"offset"in me&&n(19,U=me.offset),"popupClass"in me&&n(20,Z=me.popupClass),"maxWidth"in me&&n(21,ue=me.maxWidth),"lngLat"in me&&n(10,ae=me.lngLat),"html"in me&&n(22,se=me.html),"open"in me&&n(0,fe=me.open),"$$scope"in me&&n(29,S=me.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&14336&&n(27,r=C??(!A&&!M)),t.$$.dirty[0]&146685952&&(Ke||(n(23,Ke=new Vs.Popup({closeButton:r,closeOnClick:!1,closeOnMove:R,focusAfterOpen:O,maxWidth:ue,className:Z,anchor:G,offset:U})),bt=Ke.getElement(),Ke.on("open",()=>{n(0,fe=!0),Rt(),ke("open",Ke)}),Ke.on("close",()=>{n(0,fe=!1),ke("close",Ke)}),Ke.on("hover",()=>{ke("hover",Ke)}))),t.$$.dirty[0]&8421384&&Ke&&l instanceof Vs.Marker&&(N==="click"?l.setPopup(Ke):l.getPopup()===Ke&&l.setPopup(void 0)),t.$$.dirty[0]&268468224&&At.includes(N)&&(c==null?void 0:c.type)===N&&(Xt(c),Ut(Ge,c=null,c)),t.$$.dirty[0]&268468224&&n(26,i=N==="hover"&&((c==null?void 0:c.type)==="mousemove"||(c==null?void 0:c.type)==="mouseenter")),t.$$.dirty[0]&352354304&&N==="hover"&&Ge&&(i&&c&&an(c),n(0,fe=(i||Ft)??!1)),t.$$.dirty[0]&12582914&&(rt?Ke.setDOMContent(rt):se&&Ke.setHTML(se)),t.$$.dirty[0]&8389632&&ae&&Ke.setLngLat(ae),t.$$.dirty[0]&41943045&&o){let me=Ke.isOpen();fe&&!me?(Ke.addTo(o),Ln==="opening"&&n(25,Ln="justOpened")):!fe&&me&&Ke.remove()}},[fe,rt,o,l,ln,K,oe,Ge,Te,E,ae,C,A,M,R,N,B,O,G,U,Z,ue,se,Ke,Ft,Ln,i,r,c,S,y,gt,Nt]}class LN extends Qt{constructor(e){super(),Jt(this,e,TN,CN,Ht,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}var Em=Uint8Array,wC=Uint16Array,PN=Int32Array,MN=new Em([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),kN=new Em([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),SC=function(t,e){for(var n=new wC(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];for(var i=new PN(n[30]),r=1;r<30;++r)for(var o=n[r];o<n[r+1];++o)i[o]=o-n[r]<<5|r;return{b:n,r:i}},EC=SC(MN,2),AN=EC.b,DN=EC.r;AN[28]=258,DN[258]=28;SC(kN,0);var RN=new wC(32768);for(lr=0;lr<32768;++lr)ou=(lr&43690)>>1|(lr&21845)<<1,ou=(ou&52428)>>2|(ou&13107)<<2,ou=(ou&61680)>>4|(ou&3855)<<4,RN[lr]=((ou&65280)>>8|(ou&255)<<8)>>1;var ou,lr,sy=new Em(288);for(lr=0;lr<144;++lr)sy[lr]=8;var lr;for(lr=144;lr<256;++lr)sy[lr]=9;var lr;for(lr=256;lr<280;++lr)sy[lr]=7;var lr;for(lr=280;lr<288;++lr)sy[lr]=8;var lr,NN=new Em(32);for(lr=0;lr<32;++lr)NN[lr]=5;var lr,ON=new Em(0),zN=typeof TextDecoder<"u"&&new TextDecoder,FN=0;try{zN.decode(ON,{stream:!0}),FN=1}catch{}function BN(t){let e;const n=t[16].default,r=hr(n,t,t[24],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),e=!0},p(i,o){r&&r.p&&(!e||o&16777216)&&pr(r,n,i,i[24],e?fr(n,i[24],o,null):dr(i[24]),null)},i(i){e||(ne(r,i),e=!0)},o(i){de(r,i),e=!1},d(i){r&&r.d(i)}}}function VN(t){let e,n,r;function i(c){t[17](c)}let o={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[BN]},$$scope:{ctx:t}};return t[0]!==void 0&&(o.hovered=t[0]),e=new oy({props:o}),Gr.push(()=>xa(e,"hovered",i)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){Ve(e.$$.fragment)},m(c,l){Fe(e,c,l),r=!0},p(c,[l]){const d={};l&2&&(d.id=c[1]),l&4&&(d.source=c[2]),l&8&&(d.sourceLayer=c[3]),l&16&&(d.beforeId=c[4]),l&32&&(d.beforeLayerType=c[5]),l&64&&(d.paint=c[6]),l&128&&(d.layout=c[7]),l&256&&(d.filter=c[8]),l&512&&(d.applyToClusters=c[9]),l&1024&&(d.minzoom=c[10]),l&2048&&(d.maxzoom=c[11]),l&4096&&(d.hoverCursor=c[12]),l&8192&&(d.manageHoverState=c[13]),l&16384&&(d.eventsIfTopMost=c[14]),l&32768&&(d.interactive=c[15]),l&16777216&&(d.$$scope={dirty:l,ctx:c}),!n&&l&1&&(n=!0,d.hovered=c[0],ba(()=>n=!1)),e.$set(d)},i(c){r||(ne(e.$$.fragment,c),r=!0)},o(c){de(e.$$.fragment,c),r=!1},d(c){Be(e,c)}}}function UN(t,e,n){let{$$slots:r={},$$scope:i}=e,{id:o=_p("symbol")}=e,{source:c=void 0}=e,{sourceLayer:l=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:y=void 0}=e,{paint:S=void 0}=e,{layout:E=void 0}=e,{filter:C=void 0}=e,{applyToClusters:A=void 0}=e,{minzoom:M=void 0}=e,{maxzoom:R=void 0}=e,{hoverCursor:N=void 0}=e,{manageHoverState:B=!1}=e,{hovered:O=null}=e,{eventsIfTopMost:G=!1}=e,{interactive:U=!0}=e;function Z(oe){O=oe,n(0,O)}function ue(oe){xn.call(this,t,oe)}function ae(oe){xn.call(this,t,oe)}function se(oe){xn.call(this,t,oe)}function fe(oe){xn.call(this,t,oe)}function ke(oe){xn.call(this,t,oe)}function K(oe){xn.call(this,t,oe)}return t.$$set=oe=>{"id"in oe&&n(1,o=oe.id),"source"in oe&&n(2,c=oe.source),"sourceLayer"in oe&&n(3,l=oe.sourceLayer),"beforeId"in oe&&n(4,d=oe.beforeId),"beforeLayerType"in oe&&n(5,y=oe.beforeLayerType),"paint"in oe&&n(6,S=oe.paint),"layout"in oe&&n(7,E=oe.layout),"filter"in oe&&n(8,C=oe.filter),"applyToClusters"in oe&&n(9,A=oe.applyToClusters),"minzoom"in oe&&n(10,M=oe.minzoom),"maxzoom"in oe&&n(11,R=oe.maxzoom),"hoverCursor"in oe&&n(12,N=oe.hoverCursor),"manageHoverState"in oe&&n(13,B=oe.manageHoverState),"hovered"in oe&&n(0,O=oe.hovered),"eventsIfTopMost"in oe&&n(14,G=oe.eventsIfTopMost),"interactive"in oe&&n(15,U=oe.interactive),"$$scope"in oe&&n(24,i=oe.$$scope)},[O,o,c,l,d,y,S,E,C,A,M,R,N,B,G,U,r,Z,ue,ae,se,fe,ke,K,i]}class IC extends Qt{constructor(e){super(),Jt(this,e,UN,VN,Ht,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var jN=Object.defineProperty,GN=(t,e,n)=>e in t?jN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,V2=(t,e,n)=>(GN(t,typeof e!="symbol"?e+"":e,n),n);function rm(){}function CC(t){return t()}function U2(){return Object.create(null)}function ay(t){t.forEach(CC)}function TC(t){return typeof t=="function"}function qN(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function WN(t){return Object.keys(t).length===0}function HN(t,e){t.appendChild(e)}function ZN(t,e,n){t.insertBefore(e,n||null)}function LC(t){t.parentNode&&t.parentNode.removeChild(t)}function j2(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Wu(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function XN(t){return Array.from(t.childNodes)}function Gg(t,e,n){t.classList.toggle(e,!!n)}let H1;function Yd(t){H1=t}const Lf=[],G2=[];let Rf=[];const q2=[],YN=Promise.resolve();let Gv=!1;function $N(){Gv||(Gv=!0,YN.then(PC))}function qv(t){Rf.push(t)}const nv=new Set;let Sf=0;function PC(){if(Sf!==0)return;const t=H1;do{try{for(;Sf<Lf.length;){const e=Lf[Sf];Sf++,Yd(e),KN(e.$$)}}catch(e){throw Lf.length=0,Sf=0,e}for(Yd(null),Lf.length=0,Sf=0;G2.length;)G2.pop()();for(let e=0;e<Rf.length;e+=1){const n=Rf[e];nv.has(n)||(nv.add(n),n())}Rf.length=0}while(Lf.length);for(;q2.length;)q2.pop()();Gv=!1,nv.clear(),Yd(t)}function KN(t){if(t.fragment!==null){t.update(),ay(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(qv)}}function JN(t){const e=[],n=[];Rf.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),Rf=e}const QN=new Set;function eO(t,e){t&&t.i&&(QN.delete(t),t.i(e))}function tO(t,e,n){const{fragment:r,after_update:i}=t.$$;r&&r.m(e,n),qv(()=>{const o=t.$$.on_mount.map(CC).filter(TC);t.$$.on_destroy?t.$$.on_destroy.push(...o):ay(o),t.$$.on_mount=[]}),i.forEach(qv)}function nO(t,e){const n=t.$$;n.fragment!==null&&(JN(n.after_update),ay(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function rO(t,e){t.$$.dirty[0]===-1&&(Lf.push(t),$N(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function iO(t,e,n,r,i,o,c=null,l=[-1]){const d=H1;Yd(t);const y=t.$$={fragment:null,ctx:[],props:o,update:rm,not_equal:i,bound:U2(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:U2(),dirty:l,skip_bound:!1,root:e.target||d.$$.root};c&&c(y.root);let S=!1;if(y.ctx=n?n(t,e.props||{},(E,C,...A)=>{const M=A.length?A[0]:C;return y.ctx&&i(y.ctx[E],y.ctx[E]=M)&&(!y.skip_bound&&y.bound[E]&&y.bound[E](M),S&&rO(t,E)),C}):[],y.update(),S=!0,ay(y.before_update),y.fragment=r?r(y.ctx):!1,e.target){if(e.hydrate){const E=XN(e.target);y.fragment&&y.fragment.l(E),E.forEach(LC)}else y.fragment&&y.fragment.c();e.intro&&eO(t.$$.fragment),tO(t,e.target,e.anchor),PC()}Yd(d)}class oO{constructor(){V2(this,"$$"),V2(this,"$$set")}$destroy(){nO(this,1),this.$destroy=rm}$on(e,n){if(!TC(n))return rm;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!WN(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const sO="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(sO);function aO(t){let e,n,r;return{c(){e=j2("svg"),n=j2("path"),Wu(n,"stroke-width","4"),Wu(n,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),Wu(n,"class","svelte-gzo3ar"),Wu(e,"width",r=t[0]==="list"?20:void 0),Wu(e,"viewBox","0 0 70 85"),Wu(e,"fill","none"),Wu(e,"class","svelte-gzo3ar"),Gg(e,"in-map",t[0]!=="list"),Gg(e,"list-icon",t[0]==="list")},m(i,o){ZN(i,e,o),HN(e,n)},p(i,[o]){o&1&&r!==(r=i[0]==="list"?20:void 0)&&Wu(e,"width",r),o&1&&Gg(e,"in-map",i[0]!=="list"),o&1&&Gg(e,"list-icon",i[0]==="list")},i:rm,o:rm,d(i){i&&LC(e)}}}function lO(t,e,n){let{displayIn:r}=e;return t.$$set=i=>{"displayIn"in i&&n(0,r=i.displayIn)},[r]}class uO extends oO{constructor(e){super(),iO(this,e,lO,aO,qN,{displayIn:0})}}const cO=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],hO={decimalLatitude:40.123,decimalLongitude:-74.123},fO=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],pO=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222}];function dO(){const t=[];return cO.forEach(e=>{e.decimalLatitude?t.push(e):t.push({...e,...hO})}),[...t,...fO,...pO]}const mO=dO();mO.map(t=>t.verbatimCoordinates);/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function gO(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,c;return c={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function l(y){return function(S){return d([y,S])}}function d(y){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=y[0]&2?i.return:y[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,y[1])).done)return o;switch(i=0,o&&(y=[y[0]&2,o.value]),y[0]){case 0:case 1:o=y;break;case 4:return n.label++,{value:y[1],done:!1};case 5:n.label++,i=y[1],y=[0];continue;case 7:y=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(y[0]===6||y[0]===2)){n=0;continue}if(y[0]===3&&(!o||y[1]>o[0]&&y[1]<o[3])){n.label=y[1];break}if(y[0]===6&&n.label<o[1]){n.label=o[1],o=y;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(y);break}o[2]&&n.ops.pop(),n.trys.pop();continue}y=e.call(t,n)}catch(S){y=[6,S],i=0}finally{r=o=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}var rc=function(){function t(e,n){this.next=null,this.key=e,this.data=n,this.left=null,this.right=null}return t}();function _O(t,e){return t>e?1:t<e?-1:0}function $u(t,e,n){for(var r=new rc(null,null),i=r,o=r;;){var c=n(t,e.key);if(c<0){if(e.left===null)break;if(n(t,e.left.key)<0){var l=e.left;if(e.left=l.right,l.right=e,e=l,e.left===null)break}o.left=e,o=e,e=e.left}else if(c>0){if(e.right===null)break;if(n(t,e.right.key)>0){var l=e.right;if(e.right=l.left,l.left=e,e=l,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=r.right,e.right=r.left,e}function rv(t,e,n,r){var i=new rc(t,e);if(n===null)return i.left=i.right=null,i;n=$u(t,n,r);var o=r(t,n.key);return o<0?(i.left=n.left,i.right=n,n.left=null):o>=0&&(i.right=n.right,i.left=n,n.right=null),i}function W2(t,e,n){var r=null,i=null;if(e){e=$u(t,e,n);var o=n(e.key,t);o===0?(r=e.left,i=e.right):o<0?(i=e.right,e.right=null,r=e):(r=e.left,e.left=null,i=e)}return{left:r,right:i}}function yO(t,e,n){return e===null?t:(t===null||(e=$u(t.key,e,n),e.left=t),e)}function Wv(t,e,n,r,i){if(t){r(""+e+(n?" ":" ")+i(t)+`
`);var o=e+(n?"    ":"   ");t.left&&Wv(t.left,o,!1,r,i),t.right&&Wv(t.right,o,!0,r,i)}}var Z1=function(){function t(e){e===void 0&&(e=_O),this._root=null,this._size=0,this._comparator=e}return t.prototype.insert=function(e,n){return this._size++,this._root=rv(e,n,this._root,this._comparator)},t.prototype.add=function(e,n){var r=new rc(e,n);this._root===null&&(r.left=r.right=null,this._size++,this._root=r);var i=this._comparator,o=$u(e,this._root,i),c=i(e,o.key);return c===0?this._root=o:(c<0?(r.left=o.left,r.right=o,o.left=null):c>0&&(r.right=o.right,r.left=o,o.right=null),this._size++,this._root=r),this._root},t.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},t.prototype._remove=function(e,n,r){var i;if(n===null)return null;n=$u(e,n,r);var o=r(e,n.key);return o===0?(n.left===null?i=n.right:(i=$u(e,n.left,r),i.right=n.right),this._size--,i):n},t.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=$u(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},t.prototype.findStatic=function(e){for(var n=this._root,r=this._comparator;n;){var i=r(e,n.key);if(i===0)return n;i<0?n=n.left:n=n.right}return null},t.prototype.find=function(e){return this._root&&(this._root=$u(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},t.prototype.contains=function(e){for(var n=this._root,r=this._comparator;n;){var i=r(e,n.key);if(i===0)return!0;i<0?n=n.left:n=n.right}return!1},t.prototype.forEach=function(e,n){for(var r=this._root,i=[],o=!1;!o;)r!==null?(i.push(r),r=r.left):i.length!==0?(r=i.pop(),e.call(n,r),r=r.right):o=!0;return this},t.prototype.range=function(e,n,r,i){for(var o=[],c=this._comparator,l=this._root,d;o.length!==0||l;)if(l)o.push(l),l=l.left;else{if(l=o.pop(),d=c(l.key,n),d>0)break;if(c(l.key,e)>=0&&r.call(i,l))return this;l=l.right}return this},t.prototype.keys=function(){var e=[];return this.forEach(function(n){var r=n.key;return e.push(r)}),e},t.prototype.values=function(){var e=[];return this.forEach(function(n){var r=n.data;return e.push(r)}),e},t.prototype.min=function(){return this._root?this.minNode(this._root).key:null},t.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},t.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},t.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},t.prototype.at=function(e){for(var n=this._root,r=!1,i=0,o=[];!r;)if(n)o.push(n),n=n.left;else if(o.length>0){if(n=o.pop(),i===e)return n;i++,n=n.right}else r=!0;return null},t.prototype.next=function(e){var n=this._root,r=null;if(e.right){for(r=e.right;r.left;)r=r.left;return r}for(var i=this._comparator;n;){var o=i(e.key,n.key);if(o===0)break;o<0?(r=n,n=n.left):n=n.right}return r},t.prototype.prev=function(e){var n=this._root,r=null;if(e.left!==null){for(r=e.left;r.right;)r=r.right;return r}for(var i=this._comparator;n;){var o=i(e.key,n.key);if(o===0)break;o<0?n=n.left:(r=n,n=n.right)}return r},t.prototype.clear=function(){return this._root=null,this._size=0,this},t.prototype.toList=function(){return bO(this._root)},t.prototype.load=function(e,n,r){n===void 0&&(n=[]),r===void 0&&(r=!1);var i=e.length,o=this._comparator;if(r&&Xv(e,n,0,i-1,o),this._root===null)this._root=Hv(e,n,0,i),this._size=i;else{var c=xO(this.toList(),vO(e,n),o);i=this._size+i,this._root=Zv({head:c},0,i)}return this},t.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),t.prototype.toString=function(e){e===void 0&&(e=function(r){return String(r.key)});var n=[];return Wv(this._root,"",!0,function(r){return n.push(r)},e),n.join("")},t.prototype.update=function(e,n,r){var i=this._comparator,o=W2(e,this._root,i),c=o.left,l=o.right;i(e,n)<0?l=rv(n,r,l,i):c=rv(n,r,c,i),this._root=yO(c,l,i)},t.prototype.split=function(e){return W2(e,this._root,this._comparator)},t.prototype[Symbol.iterator]=function(){var e,n,r;return gO(this,function(i){switch(i.label){case 0:e=this._root,n=[],r=!1,i.label=1;case 1:return r?[3,6]:e===null?[3,2]:(n.push(e),e=e.left,[3,5]);case 2:return n.length===0?[3,4]:(e=n.pop(),[4,e]);case 3:return i.sent(),e=e.right,[3,5];case 4:r=!0,i.label=5;case 5:return[3,1];case 6:return[2]}})},t}();function Hv(t,e,n,r){var i=r-n;if(i>0){var o=n+Math.floor(i/2),c=t[o],l=e[o],d=new rc(c,l);return d.left=Hv(t,e,n,o),d.right=Hv(t,e,o+1,r),d}return null}function vO(t,e){for(var n=new rc(null,null),r=n,i=0;i<t.length;i++)r=r.next=new rc(t[i],e[i]);return r.next=null,n.next}function bO(t){for(var e=t,n=[],r=!1,i=new rc(null,null),o=i;!r;)e?(n.push(e),e=e.left):n.length>0?(e=o=o.next=n.pop(),e=e.right):r=!0;return o.next=null,i.next}function Zv(t,e,n){var r=n-e;if(r>0){var i=e+Math.floor(r/2),o=Zv(t,e,i),c=t.head;return c.left=o,t.head=t.head.next,c.right=Zv(t,i+1,n),c}return null}function xO(t,e,n){for(var r=new rc(null,null),i=r,o=t,c=e;o!==null&&c!==null;)n(o.key,c.key)<0?(i.next=o,o=o.next):(i.next=c,c=c.next),i=i.next;return o!==null?i.next=o:c!==null&&(i.next=c),r.next}function Xv(t,e,n,r,i){if(!(n>=r)){for(var o=t[n+r>>1],c=n-1,l=r+1;;){do c++;while(i(t[c],o)<0);do l--;while(i(t[l],o)>0);if(c>=l)break;var d=t[c];t[c]=t[l],t[l]=d,d=e[c],e[c]=e[l],e[l]=d}Xv(t,e,n,l,i),Xv(t,e,l+1,r,i)}}function Ra(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function H2(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function os(t,e,n){return e&&H2(t.prototype,e),n&&H2(t,n),t}var Td=function(t,e){return t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y},Yv=function(t,e){if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;var n=t.ll.x<e.ll.x?e.ll.x:t.ll.x,r=t.ur.x<e.ur.x?t.ur.x:e.ur.x,i=t.ll.y<e.ll.y?e.ll.y:t.ll.y,o=t.ur.y<e.ur.y?t.ur.y:e.ur.y;return{ll:{x:n,y:i},ur:{x:r,y:o}}},Qu=Number.EPSILON;Qu===void 0&&(Qu=Math.pow(2,-52));var wO=Qu*Qu,$v=function(t,e){if(-Qu<t&&t<Qu&&-Qu<e&&e<Qu)return 0;var n=t-e;return n*n<wO*t*e?0:t<e?-1:1},SO=function(){function t(){Ra(this,t),this.reset()}return os(t,[{key:"reset",value:function(){this.xRounder=new Z2,this.yRounder=new Z2}},{key:"round",value:function(e,n){return{x:this.xRounder.round(e),y:this.yRounder.round(n)}}}]),t}(),Z2=function(){function t(){Ra(this,t),this.tree=new Z1,this.round(0)}return os(t,[{key:"round",value:function(e){var n=this.tree.add(e),r=this.tree.prev(n);if(r!==null&&$v(n.key,r.key)===0)return this.tree.remove(e),r.key;var i=this.tree.next(n);return i!==null&&$v(n.key,i.key)===0?(this.tree.remove(e),i.key):e}}]),t}(),im=new SO,$d=function(t,e){return t.x*e.y-t.y*e.x},MC=function(t,e){return t.x*e.x+t.y*e.y},X2=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y},o=$d(r,i);return $v(o,0)},N_=function(t){return Math.sqrt(MC(t,t))},EO=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y};return $d(i,r)/N_(i)/N_(r)},IO=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y};return MC(i,r)/N_(i)/N_(r)},Y2=function(t,e,n){return e.y===0?null:{x:t.x+e.x/e.y*(n-t.y),y:n}},$2=function(t,e,n){return e.x===0?null:{x:n,y:t.y+e.y/e.x*(n-t.x)}},CO=function(t,e,n,r){if(e.x===0)return $2(n,r,t.x);if(r.x===0)return $2(t,e,n.x);if(e.y===0)return Y2(n,r,t.y);if(r.y===0)return Y2(t,e,n.y);var i=$d(e,r);if(i==0)return null;var o={x:n.x-t.x,y:n.y-t.y},c=$d(o,e)/i,l=$d(o,r)/i,d=t.x+l*e.x,y=n.x+c*r.x,S=t.y+l*e.y,E=n.y+c*r.y,C=(d+y)/2,A=(S+E)/2;return{x:C,y:A}},Sl=function(){os(t,null,[{key:"compare",value:function(e,n){var r=t.comparePoints(e.point,n.point);return r!==0?r:(e.point!==n.point&&e.link(n),e.isLeft!==n.isLeft?e.isLeft?1:-1:O_.compare(e.segment,n.segment))}},{key:"comparePoints",value:function(e,n){return e.x<n.x?-1:e.x>n.x?1:e.y<n.y?-1:e.y>n.y?1:0}}]);function t(e,n){Ra(this,t),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=n}return os(t,[{key:"link",value:function(e){if(e.point===this.point)throw new Error("Tried to link already linked events");for(var n=e.point.events,r=0,i=n.length;r<i;r++){var o=n[r];this.point.events.push(o),o.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var e=this.point.events.length,n=0;n<e;n++){var r=this.point.events[n];if(r.segment.consumedBy===void 0)for(var i=n+1;i<e;i++){var o=this.point.events[i];o.consumedBy===void 0&&r.otherSE.point.events===o.otherSE.point.events&&r.segment.consume(o.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var e=[],n=0,r=this.point.events.length;n<r;n++){var i=this.point.events[n];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&e.push(i)}return e}},{key:"getLeftmostComparator",value:function(e){var n=this,r=new Map,i=function(o){var c=o.otherSE;r.set(o,{sine:EO(n.point,e.point,c.point),cosine:IO(n.point,e.point,c.point)})};return function(o,c){r.has(o)||i(o),r.has(c)||i(c);var l=r.get(o),d=l.sine,y=l.cosine,S=r.get(c),E=S.sine,C=S.cosine;return d>=0&&E>=0?y<C?1:y>C?-1:0:d<0&&E<0?y<C?-1:y>C?1:0:E<d?-1:E>d?1:0}}}]),t}(),TO=0,O_=function(){os(t,null,[{key:"compare",value:function(e,n){var r=e.leftSE.point.x,i=n.leftSE.point.x,o=e.rightSE.point.x,c=n.rightSE.point.x;if(c<r)return 1;if(o<i)return-1;var l=e.leftSE.point.y,d=n.leftSE.point.y,y=e.rightSE.point.y,S=n.rightSE.point.y;if(r<i){if(d<l&&d<y)return 1;if(d>l&&d>y)return-1;var E=e.comparePoint(n.leftSE.point);if(E<0)return 1;if(E>0)return-1;var C=n.comparePoint(e.rightSE.point);return C!==0?C:-1}if(r>i){if(l<d&&l<S)return-1;if(l>d&&l>S)return 1;var A=n.comparePoint(e.leftSE.point);if(A!==0)return A;var M=e.comparePoint(n.rightSE.point);return M<0?1:M>0?-1:1}if(l<d)return-1;if(l>d)return 1;if(o<c){var R=n.comparePoint(e.rightSE.point);if(R!==0)return R}if(o>c){var N=e.comparePoint(n.rightSE.point);if(N<0)return 1;if(N>0)return-1}if(o!==c){var B=y-l,O=o-r,G=S-d,U=c-i;if(B>O&&G<U)return 1;if(B<O&&G>U)return-1}return o>c?1:o<c||y<S?-1:y>S?1:e.id<n.id?-1:e.id>n.id?1:0}}]);function t(e,n,r,i){Ra(this,t),this.id=++TO,this.leftSE=e,e.segment=this,e.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=e,this.rings=r,this.windings=i}return os(t,[{key:"replaceRightSE",value:function(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var e=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<n?e:n},ur:{x:this.rightSE.point.x,y:e>n?e:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}},{key:"comparePoint",value:function(e){if(this.isAnEndpoint(e))return 0;var n=this.leftSE.point,r=this.rightSE.point,i=this.vector();if(n.x===r.x)return e.x===n.x?0:e.x<n.x?1:-1;var o=(e.y-n.y)/i.y,c=n.x+o*i.x;if(e.x===c)return 0;var l=(e.x-n.x)/i.x,d=n.y+l*i.y;return e.y===d?0:e.y<d?-1:1}},{key:"getIntersection",value:function(e){var n=this.bbox(),r=e.bbox(),i=Yv(n,r);if(i===null)return null;var o=this.leftSE.point,c=this.rightSE.point,l=e.leftSE.point,d=e.rightSE.point,y=Td(n,l)&&this.comparePoint(l)===0,S=Td(r,o)&&e.comparePoint(o)===0,E=Td(n,d)&&this.comparePoint(d)===0,C=Td(r,c)&&e.comparePoint(c)===0;if(S&&y)return C&&!E?c:!C&&E?d:null;if(S)return E&&o.x===d.x&&o.y===d.y?null:o;if(y)return C&&c.x===l.x&&c.y===l.y?null:l;if(C&&E)return null;if(C)return c;if(E)return d;var A=CO(o,this.vector(),l,e.vector());return A===null||!Td(i,A)?null:im.round(A.x,A.y)}},{key:"split",value:function(e){var n=[],r=e.events!==void 0,i=new Sl(e,!0),o=new Sl(e,!1),c=this.rightSE;this.replaceRightSE(o),n.push(o),n.push(i);var l=new t(i,c,this.rings.slice(),this.windings.slice());return Sl.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),Sl.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),o.checkForConsuming()),n}},{key:"swapEvents",value:function(){var e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,r=this.windings.length;n<r;n++)this.windings[n]*=-1}},{key:"consume",value:function(e){for(var n=this,r=e;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var i=t.compare(n,r);if(i!==0){if(i>0){var o=n;n=r,r=o}if(n.prev===r){var c=n;n=r,r=c}for(var l=0,d=r.rings.length;l<d;l++){var y=r.rings[l],S=r.windings[l],E=n.rings.indexOf(y);E===-1?(n.rings.push(y),n.windings.push(S)):n.windings[E]+=S}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,r=this._afterState.windings,i=this._afterState.multiPolys,o=0,c=this.rings.length;o<c;o++){var l=this.rings[o],d=this.windings[o],y=n.indexOf(l);y===-1?(n.push(l),r.push(d)):r[y]+=d}for(var S=[],E=[],C=0,A=n.length;C<A;C++)if(r[C]!==0){var M=n[C],R=M.poly;if(E.indexOf(R)===-1)if(M.isExterior)S.push(R);else{E.indexOf(R)===-1&&E.push(R);var N=S.indexOf(M.poly);N!==-1&&S.splice(N,1)}}for(var B=0,O=S.length;B<O;B++){var G=S[B].multiPoly;i.indexOf(G)===-1&&i.push(G)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var e=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Za.type){case"union":{var r=e.length===0,i=n.length===0;this._isInResult=r!==i;break}case"intersection":{var o,c;e.length<n.length?(o=e.length,c=n.length):(o=n.length,c=e.length),this._isInResult=c===Za.numMultiPolys&&o<c;break}case"xor":{var l=Math.abs(e.length-n.length);this._isInResult=l%2===1;break}case"difference":{var d=function(y){return y.length===1&&y[0].isSubject};this._isInResult=d(e)!==d(n);break}default:throw new Error("Unrecognized operation type found ".concat(Za.type))}return this._isInResult}}],[{key:"fromRing",value:function(e,n,r){var i,o,c,l=Sl.comparePoints(e,n);if(l<0)i=e,o=n,c=1;else if(l>0)i=n,o=e,c=-1;else throw new Error("Tried to create degenerate segment at [".concat(e.x,", ").concat(e.y,"]"));var d=new Sl(i,!0),y=new Sl(o,!1);return new t(d,y,[r],[c])}}]),t}(),K2=function(){function t(e,n,r){if(Ra(this,t),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=r,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=im.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,c=1,l=e.length;c<l;c++){if(typeof e[c][0]!="number"||typeof e[c][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var d=im.round(e[c][0],e[c][1]);d.x===o.x&&d.y===o.y||(this.segments.push(O_.fromRing(o,d,this)),d.x<this.bbox.ll.x&&(this.bbox.ll.x=d.x),d.y<this.bbox.ll.y&&(this.bbox.ll.y=d.y),d.x>this.bbox.ur.x&&(this.bbox.ur.x=d.x),d.y>this.bbox.ur.y&&(this.bbox.ur.y=d.y),o=d)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(O_.fromRing(o,i,this))}return os(t,[{key:"getSweepEvents",value:function(){for(var e=[],n=0,r=this.segments.length;n<r;n++){var i=this.segments[n];e.push(i.leftSE),e.push(i.rightSE)}return e}}]),t}(),LO=function(){function t(e,n){if(Ra(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new K2(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var r=1,i=e.length;r<i;r++){var o=new K2(e[r],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=n}return os(t,[{key:"getSweepEvents",value:function(){for(var e=this.exteriorRing.getSweepEvents(),n=0,r=this.interiorRings.length;n<r;n++)for(var i=this.interiorRings[n].getSweepEvents(),o=0,c=i.length;o<c;o++)e.push(i[o]);return e}}]),t}(),J2=function(){function t(e,n){if(Ra(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var r=0,i=e.length;r<i;r++){var o=new LO(e[r],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=n}return os(t,[{key:"getSweepEvents",value:function(){for(var e=[],n=0,r=this.polys.length;n<r;n++)for(var i=this.polys[n].getSweepEvents(),o=0,c=i.length;o<c;o++)e.push(i[o]);return e}}]),t}(),PO=function(){os(t,null,[{key:"factory",value:function(e){for(var n=[],r=0,i=e.length;r<i;r++){var o=e[r];if(!(!o.isInResult()||o.ringOut)){for(var c=null,l=o.leftSE,d=o.rightSE,y=[l],S=l.point,E=[];c=l,l=d,y.push(l),l.point!==S;)for(;;){var C=l.getAvailableLinkedEvents();if(C.length===0){var A=y[0].point,M=y[y.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(A.x,",")+" ".concat(A.y,"]. Last matching segment found ends at")+" [".concat(M.x,", ").concat(M.y,"]."))}if(C.length===1){d=C[0].otherSE;break}for(var R=null,N=0,B=E.length;N<B;N++)if(E[N].point===l.point){R=N;break}if(R!==null){var O=E.splice(R)[0],G=y.splice(O.index);G.unshift(G[0].otherSE),n.push(new t(G.reverse()));continue}E.push({index:y.length,point:l.point});var U=l.getLeftmostComparator(c);d=C.sort(U)[0].otherSE;break}n.push(new t(y))}}return n}}]);function t(e){Ra(this,t),this.events=e;for(var n=0,r=e.length;n<r;n++)e[n].segment.ringOut=this;this.poly=null}return os(t,[{key:"getGeom",value:function(){for(var e=this.events[0].point,n=[e],r=1,i=this.events.length-1;r<i;r++){var o=this.events[r].point,c=this.events[r+1].point;X2(o,e,c)!==0&&(n.push(o),e=o)}if(n.length===1)return null;var l=n[0],d=n[1];X2(l,e,d)===0&&n.shift(),n.push(n[0]);for(var y=this.isExteriorRing()?1:-1,S=this.isExteriorRing()?0:n.length-1,E=this.isExteriorRing()?n.length:-1,C=[],A=S;A!=E;A+=y)C.push([n[A].x,n[A].y]);return C}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var e=this.events[0],n=1,r=this.events.length;n<r;n++){var i=this.events[n];Sl.compare(e,i)>0&&(e=i)}for(var o=e.segment.prevInResult(),c=o?o.prevInResult():null;;){if(!o)return null;if(!c)return o.ringOut;if(c.ringOut!==o.ringOut)return c.ringOut.enclosingRing()!==o.ringOut?o.ringOut:o.ringOut.enclosingRing();o=c.prevInResult(),c=o?o.prevInResult():null}}}]),t}(),Q2=function(){function t(e){Ra(this,t),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return os(t,[{key:"addInterior",value:function(e){this.interiorRings.push(e),e.poly=this}},{key:"getGeom",value:function(){var e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(var n=0,r=this.interiorRings.length;n<r;n++){var i=this.interiorRings[n].getGeom();i!==null&&e.push(i)}return e}}]),t}(),MO=function(){function t(e){Ra(this,t),this.rings=e,this.polys=this._composePolys(e)}return os(t,[{key:"getGeom",value:function(){for(var e=[],n=0,r=this.polys.length;n<r;n++){var i=this.polys[n].getGeom();i!==null&&e.push(i)}return e}},{key:"_composePolys",value:function(e){for(var n=[],r=0,i=e.length;r<i;r++){var o=e[r];if(!o.poly)if(o.isExteriorRing())n.push(new Q2(o));else{var c=o.enclosingRing();c.poly||n.push(new Q2(c)),c.poly.addInterior(o)}}return n}}]),t}(),kO=function(){function t(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:O_.compare;Ra(this,t),this.queue=e,this.tree=new Z1(n),this.segments=[]}return os(t,[{key:"process",value:function(e){var n=e.segment,r=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(n),r;var i=e.isLeft?this.tree.insert(n):this.tree.find(n);if(!i)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var o=i,c=i,l=void 0,d=void 0;l===void 0;)o=this.tree.prev(o),o===null?l=null:o.key.consumedBy===void 0&&(l=o.key);for(;d===void 0;)c=this.tree.next(c),c===null?d=null:c.key.consumedBy===void 0&&(d=c.key);if(e.isLeft){var y=null;if(l){var S=l.getIntersection(n);if(S!==null&&(n.isAnEndpoint(S)||(y=S),!l.isAnEndpoint(S)))for(var E=this._splitSafely(l,S),C=0,A=E.length;C<A;C++)r.push(E[C])}var M=null;if(d){var R=d.getIntersection(n);if(R!==null&&(n.isAnEndpoint(R)||(M=R),!d.isAnEndpoint(R)))for(var N=this._splitSafely(d,R),B=0,O=N.length;B<O;B++)r.push(N[B])}if(y!==null||M!==null){var G=null;if(y===null)G=M;else if(M===null)G=y;else{var U=Sl.comparePoints(y,M);G=U<=0?y:M}this.queue.remove(n.rightSE),r.push(n.rightSE);for(var Z=n.split(G),ue=0,ae=Z.length;ue<ae;ue++)r.push(Z[ue])}r.length>0?(this.tree.remove(n),r.push(e)):(this.segments.push(n),n.prev=l)}else{if(l&&d){var se=l.getIntersection(d);if(se!==null){if(!l.isAnEndpoint(se))for(var fe=this._splitSafely(l,se),ke=0,K=fe.length;ke<K;ke++)r.push(fe[ke]);if(!d.isAnEndpoint(se))for(var oe=this._splitSafely(d,se),Ge=0,Te=oe.length;Ge<Te;Ge++)r.push(oe[Ge])}}this.tree.remove(n)}return r}},{key:"_splitSafely",value:function(e,n){this.tree.remove(e);var r=e.rightSE;this.queue.remove(r);var i=e.split(n);return i.push(r),e.consumedBy===void 0&&this.tree.insert(e),i}}]),t}(),eS=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,AO=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,DO=function(){function t(){Ra(this,t)}return os(t,[{key:"run",value:function(e,n,r){Za.type=e,im.reset();for(var i=[new J2(n,!0)],o=0,c=r.length;o<c;o++)i.push(new J2(r[o],!1));if(Za.numMultiPolys=i.length,Za.type==="difference")for(var l=i[0],d=1;d<i.length;)Yv(i[d].bbox,l.bbox)!==null?d++:i.splice(d,1);if(Za.type==="intersection"){for(var y=0,S=i.length;y<S;y++)for(var E=i[y],C=y+1,A=i.length;C<A;C++)if(Yv(E.bbox,i[C].bbox)===null)return[]}for(var M=new Z1(Sl.compare),R=0,N=i.length;R<N;R++)for(var B=i[R].getSweepEvents(),O=0,G=B.length;O<G;O++)if(M.insert(B[O]),M.size>eS)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var U=new kO(M),Z=M.size,ue=M.pop();ue;){var ae=ue.key;if(M.size===Z){var se=ae.segment;throw new Error("Unable to pop() ".concat(ae.isLeft?"left":"right"," SweepEvent ")+"[".concat(ae.point.x,", ").concat(ae.point.y,"] from segment #").concat(se.id," ")+"[".concat(se.leftSE.point.x,", ").concat(se.leftSE.point.y,"] -> ")+"[".concat(se.rightSE.point.x,", ").concat(se.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(M.size>eS)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(U.segments.length>AO)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var fe=U.process(ae),ke=0,K=fe.length;ke<K;ke++){var oe=fe[ke];oe.consumedBy===void 0&&M.insert(oe)}Z=M.size,ue=M.pop()}im.reset();var Ge=PO.factory(U.segments),Te=new MO(Ge);return Te.getGeom()}}]),t}(),Za=new DO,RO=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Za.run("union",t,n)},NO=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Za.run("intersection",t,n)},OO=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Za.run("xor",t,n)},zO=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Za.run("difference",t,n)},kC={union:RO,intersection:NO,xor:OO,difference:zO},es=63710088e-1,AC={centimeters:es*100,centimetres:es*100,degrees:es/111325,feet:es*3.28084,inches:es*39.37,kilometers:es/1e3,kilometres:es/1e3,meters:es,metres:es,miles:es/1609.344,millimeters:es*1e3,millimetres:es*1e3,nauticalmiles:es/1852,radians:1,yards:es*1.0936};function ly(t,e,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function FO(t,e,n){if(n===void 0&&(n={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!tS(t[0])||!tS(t[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:t};return ly(r,e,n)}function DC(t,e,n){n===void 0&&(n={});for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var c=0;c<o[o.length-1].length;c++)if(o[o.length-1][c]!==o[0][c])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:t};return ly(l,e,n)}function Kv(t,e){e===void 0&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function RC(t,e,n){n===void 0&&(n={});var r={type:"MultiPolygon",coordinates:t};return ly(r,e,n)}function BO(t,e){e===void 0&&(e="kilometers");var n=AC[e];if(!n)throw new Error(e+" units is invalid");return t*n}function VO(t,e){e===void 0&&(e="kilometers");var n=AC[e];if(!n)throw new Error(e+" units is invalid");return t/n}function tS(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function z_(t){return t.type==="Feature"?t.geometry:t}function UO(t,e,n){n===void 0&&(n={});var r=z_(t),i=z_(e),o=kC.union(r.coordinates,i.coordinates);return o.length===0?null:o.length===1?DC(o[0],n.properties):RC(o,n.properties)}function NC(t,e,n){if(t!==null)for(var r,i,o,c,l,d,y,S=0,E=0,C,A=t.type,M=A==="FeatureCollection",R=A==="Feature",N=M?t.features.length:1,B=0;B<N;B++){y=M?t.features[B].geometry:R?t.geometry:t,C=y?y.type==="GeometryCollection":!1,l=C?y.geometries.length:1;for(var O=0;O<l;O++){var G=0,U=0;if(c=C?y.geometries[O]:y,c!==null){d=c.coordinates;var Z=c.type;switch(S=n&&(Z==="Polygon"||Z==="MultiPolygon")?1:0,Z){case null:break;case"Point":if(e(d,E,B,G,U)===!1)return!1;E++,G++;break;case"LineString":case"MultiPoint":for(r=0;r<d.length;r++){if(e(d[r],E,B,G,U)===!1)return!1;E++,Z==="MultiPoint"&&G++}Z==="LineString"&&G++;break;case"Polygon":case"MultiLineString":for(r=0;r<d.length;r++){for(i=0;i<d[r].length-S;i++){if(e(d[r][i],E,B,G,U)===!1)return!1;E++}Z==="MultiLineString"&&G++,Z==="Polygon"&&U++}Z==="Polygon"&&G++;break;case"MultiPolygon":for(r=0;r<d.length;r++){for(U=0,i=0;i<d[r].length;i++){for(o=0;o<d[r][i].length-S;o++){if(e(d[r][i][o],E,B,G,U)===!1)return!1;E++}U++}G++}break;case"GeometryCollection":for(r=0;r<c.geometries.length;r++)if(NC(c.geometries[r],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function nS(t,e){if(t.type==="Feature")e(t,0);else if(t.type==="FeatureCollection")for(var n=0;n<t.features.length&&e(t.features[n],n)!==!1;n++);}function OC(t,e){var n,r,i,o,c,l,d,y,S,E,C=0,A=t.type==="FeatureCollection",M=t.type==="Feature",R=A?t.features.length:1;for(n=0;n<R;n++){for(l=A?t.features[n].geometry:M?t.geometry:t,y=A?t.features[n].properties:M?t.properties:{},S=A?t.features[n].bbox:M?t.bbox:void 0,E=A?t.features[n].id:M?t.id:void 0,d=l?l.type==="GeometryCollection":!1,c=d?l.geometries.length:1,i=0;i<c;i++){if(o=d?l.geometries[i]:l,o===null){if(e(null,C,y,S,E)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,C,y,S,E)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<o.geometries.length;r++)if(e(o.geometries[r],C,y,S,E)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}C++}}function Jv(t){var e=[1/0,1/0,-1/0,-1/0];return NC(t,function(n){e[0]>n[0]&&(e[0]=n[0]),e[1]>n[1]&&(e[1]=n[1]),e[2]<n[0]&&(e[2]=n[0]),e[3]<n[1]&&(e[3]=n[1])}),e}Jv.default=Jv;function jO(t,e){e===void 0&&(e={});var n=Jv(t),r=(n[0]+n[2])/2,i=(n[1]+n[3])/2;return FO([r,i],e.properties,e)}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(t){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var e=Object(this),n=Math.max(Math.min(e.length,9007199254740991),0)||0,r=1 in arguments&&parseInt(Number(arguments[1]),10)||0;r=r<0?Math.max(n+r,0):Math.min(r,n);var i=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:n;for(i=i<0?Math.max(n+arguments[2],0):Math.min(i,n);r<i;)e[r]=t,++r;return e},writable:!0});Number.isFinite=Number.isFinite||function(t){return typeof t=="number"&&isFinite(t)};Number.isInteger=Number.isInteger||function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(t){return t!==t};Math.trunc=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};var Jc=function(){};Jc.prototype.interfaces_=function(){return[]};Jc.prototype.getClass=function(){return Jc};Jc.prototype.equalsWithTolerance=function(t,e,n){return Math.abs(t-e)<=n};var wr=function(t){function e(n){t.call(this,n),this.name="IllegalArgumentException",this.message=n,this.stack=new t().stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),cn=function(){},zC={MAX_VALUE:{configurable:!0}};cn.isNaN=function(t){return Number.isNaN(t)};cn.doubleToLongBits=function(t){return t};cn.longBitsToDouble=function(t){return t};cn.isInfinite=function(t){return!Number.isFinite(t)};zC.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(cn,zC);var Cs=function(){},uy=function(){},jf=function(){};function Ts(){}var Oe=function t(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=t.NULL_ORDINATE;else if(arguments.length===1){var e=arguments[0];this.x=e.x,this.y=e.y,this.z=e.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=t.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},dh={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};Oe.prototype.setOrdinate=function(t,e){switch(t){case Oe.X:this.x=e;break;case Oe.Y:this.y=e;break;case Oe.Z:this.z=e;break;default:throw new wr("Invalid ordinate index: "+t)}};Oe.prototype.equals2D=function(){if(arguments.length===1){var t=arguments[0];return!(this.x!==t.x||this.y!==t.y)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return!(!Jc.equalsWithTolerance(this.x,e.x,n)||!Jc.equalsWithTolerance(this.y,e.y,n))}};Oe.prototype.getOrdinate=function(t){switch(t){case Oe.X:return this.x;case Oe.Y:return this.y;case Oe.Z:return this.z}throw new wr("Invalid ordinate index: "+t)};Oe.prototype.equals3D=function(t){return this.x===t.x&&this.y===t.y&&(this.z===t.z||cn.isNaN(this.z))&&cn.isNaN(t.z)};Oe.prototype.equals=function(t){return t instanceof Oe?this.equals2D(t):!1};Oe.prototype.equalInZ=function(t,e){return Jc.equalsWithTolerance(this.z,t.z,e)};Oe.prototype.compareTo=function(t){var e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0};Oe.prototype.clone=function(){};Oe.prototype.copy=function(){return new Oe(this)};Oe.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};Oe.prototype.distance3D=function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return Math.sqrt(e*e+n*n+r*r)};Oe.prototype.distance=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)};Oe.prototype.hashCode=function(){var t=17;return t=37*t+Oe.hashCode(this.x),t=37*t+Oe.hashCode(this.y),t};Oe.prototype.setCoordinate=function(t){this.x=t.x,this.y=t.y,this.z=t.z};Oe.prototype.interfaces_=function(){return[Cs,uy,Ts]};Oe.prototype.getClass=function(){return Oe};Oe.hashCode=function(){if(arguments.length===1){var t=arguments[0],e=cn.doubleToLongBits(t);return Math.trunc((e^e)>>>32)}};dh.DimensionalComparator.get=function(){return cu};dh.serialVersionUID.get=function(){return 6683108902428367e3};dh.NULL_ORDINATE.get=function(){return cn.NaN};dh.X.get=function(){return 0};dh.Y.get=function(){return 1};dh.Z.get=function(){return 2};Object.defineProperties(Oe,dh);var cu=function(t){if(this._dimensionsToTest=2,arguments.length!==0&&arguments.length===1){var e=arguments[0];if(e!==2&&e!==3)throw new wr("only 2 or 3 dimensions may be specified");this._dimensionsToTest=e}};cu.prototype.compare=function(t,e){var n=t,r=e,i=cu.compare(n.x,r.x);if(i!==0)return i;var o=cu.compare(n.y,r.y);if(o!==0)return o;if(this._dimensionsToTest<=2)return 0;var c=cu.compare(n.z,r.z);return c};cu.prototype.interfaces_=function(){return[jf]};cu.prototype.getClass=function(){return cu};cu.compare=function(t,e){return t<e?-1:t>e?1:cn.isNaN(t)?cn.isNaN(e)?0:-1:cn.isNaN(e)?1:0};var Gf=function(){};Gf.prototype.create=function(){};Gf.prototype.interfaces_=function(){return[]};Gf.prototype.getClass=function(){return Gf};var ze=function(){},Im={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};ze.prototype.interfaces_=function(){return[]};ze.prototype.getClass=function(){return ze};ze.toLocationSymbol=function(t){switch(t){case ze.EXTERIOR:return"e";case ze.BOUNDARY:return"b";case ze.INTERIOR:return"i";case ze.NONE:return"-"}throw new wr("Unknown location value: "+t)};Im.INTERIOR.get=function(){return 0};Im.BOUNDARY.get=function(){return 1};Im.EXTERIOR.get=function(){return 2};Im.NONE.get=function(){return-1};Object.defineProperties(ze,Im);var rn=function(t,e){return t.interfaces_&&t.interfaces_().indexOf(e)>-1},ss=function(){},FC={LOG_10:{configurable:!0}};ss.prototype.interfaces_=function(){return[]};ss.prototype.getClass=function(){return ss};ss.log10=function(t){var e=Math.log(t);return cn.isInfinite(e)||cn.isNaN(e)?e:e/ss.LOG_10};ss.min=function(t,e,n,r){var i=t;return e<i&&(i=e),n<i&&(i=n),r<i&&(i=r),i};ss.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],e=arguments[1],n=arguments[2];return t<e?e:t>n?n:t}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var r=arguments[0],i=arguments[1],o=arguments[2];return r<i?i:r>o?o:r}};ss.wrap=function(t,e){return t<0?e- -t%e:t%e};ss.max=function(){if(arguments.length===3){var t=arguments[0],e=arguments[1],n=arguments[2],r=t;return e>r&&(r=e),n>r&&(r=n),r}else if(arguments.length===4){var i=arguments[0],o=arguments[1],c=arguments[2],l=arguments[3],d=i;return o>d&&(d=o),c>d&&(d=c),l>d&&(d=l),d}};ss.average=function(t,e){return(t+e)/2};FC.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(ss,FC);var Na=function(t){this.str=t};Na.prototype.append=function(t){this.str+=t};Na.prototype.setCharAt=function(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)};Na.prototype.toString=function(t){return this.str};var Sa=function(t){this.value=t};Sa.prototype.intValue=function(){return this.value};Sa.prototype.compareTo=function(t){return this.value<t?-1:this.value>t?1:0};Sa.isNaN=function(t){return Number.isNaN(t)};var om=function(){};om.isWhitespace=function(t){return t<=32&&t>=0||t===127};om.toUpperCase=function(t){return t.toUpperCase()};var Ze=function t(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this.init(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.init(n)}else if(typeof arguments[0]=="string"){var r=arguments[0];t.call(this,t.parse(r))}}else if(arguments.length===2){var i=arguments[0],o=arguments[1];this.init(i,o)}},$s={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Ze.prototype.le=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<=t._lo};Ze.prototype.extractSignificantDigits=function(t,e){var n=this.abs(),r=Ze.magnitude(n._hi),i=Ze.TEN.pow(r);n=n.divide(i),n.gt(Ze.TEN)?(n=n.divide(Ze.TEN),r+=1):n.lt(Ze.ONE)&&(n=n.multiply(Ze.TEN),r-=1);for(var o=r+1,c=new Na,l=Ze.MAX_PRINT_DIGITS-1,d=0;d<=l;d++){t&&d===o&&c.append(".");var y=Math.trunc(n._hi);if(y<0)break;var S=!1,E=0;y>9?(S=!0,E="9"):E="0"+y,c.append(E),n=n.subtract(Ze.valueOf(y)).multiply(Ze.TEN),S&&n.selfAdd(Ze.TEN);var C=!0,A=Ze.magnitude(n._hi);if(A<0&&Math.abs(A)>=l-d&&(C=!1),!C)break}return e[0]=r,c.toString()};Ze.prototype.sqr=function(){return this.multiply(this)};Ze.prototype.doubleValue=function(){return this._hi+this._lo};Ze.prototype.subtract=function(){if(arguments[0]instanceof Ze){var t=arguments[0];return this.add(t.negate())}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.add(-e)}};Ze.prototype.equals=function(){if(arguments.length===1){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}};Ze.prototype.isZero=function(){return this._hi===0&&this._lo===0};Ze.prototype.selfSubtract=function(){if(arguments[0]instanceof Ze){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e,0)}};Ze.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};Ze.prototype.min=function(t){return this.le(t)?this:t};Ze.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof Ze){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.selfDivide(e,0)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1],i=null,o=null,c=null,l=null,d=null,y=null,S=null,E=null;return d=this._hi/n,y=Ze.SPLIT*d,i=y-d,E=Ze.SPLIT*n,i=y-i,o=d-i,c=E-n,S=d*n,c=E-c,l=n-c,E=i*c-S+i*l+o*c+o*l,y=(this._hi-S-E+this._lo-d*r)/n,E=d+y,this._hi=E,this._lo=d-E+y,this}};Ze.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};Ze.prototype.divide=function(){if(arguments[0]instanceof Ze){var t=arguments[0],e=null,n=null,r=null,i=null,o=null,c=null,l=null,d=null;o=this._hi/t._hi,c=Ze.SPLIT*o,e=c-o,d=Ze.SPLIT*t._hi,e=c-e,n=o-e,r=d-t._hi,l=o*t._hi,r=d-r,i=t._hi-r,d=e*r-l+e*i+n*r+n*i,c=(this._hi-l-d+this._lo-o*t._lo)/t._hi,d=o+c;var y=d,S=o-d+c;return new Ze(y,S)}else if(typeof arguments[0]=="number"){var E=arguments[0];return cn.isNaN(E)?Ze.createNaN():Ze.copy(this).selfDivide(E,0)}};Ze.prototype.ge=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>=t._lo};Ze.prototype.pow=function(t){if(t===0)return Ze.valueOf(1);var e=new Ze(this),n=Ze.valueOf(1),r=Math.abs(t);if(r>1)for(;r>0;)r%2===1&&n.selfMultiply(e),r/=2,r>0&&(e=e.sqr());else n=e;return t<0?n.reciprocal():n};Ze.prototype.ceil=function(){if(this.isNaN())return Ze.NaN;var t=Math.ceil(this._hi),e=0;return t===this._hi&&(e=Math.ceil(this._lo)),new Ze(t,e)};Ze.prototype.compareTo=function(t){var e=t;return this._hi<e._hi?-1:this._hi>e._hi?1:this._lo<e._lo?-1:this._lo>e._lo?1:0};Ze.prototype.rint=function(){if(this.isNaN())return this;var t=this.add(.5);return t.floor()};Ze.prototype.setValue=function(){if(arguments[0]instanceof Ze){var t=arguments[0];return this.init(t),this}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.init(e),this}};Ze.prototype.max=function(t){return this.ge(t)?this:t};Ze.prototype.sqrt=function(){if(this.isZero())return Ze.valueOf(0);if(this.isNegative())return Ze.NaN;var t=1/Math.sqrt(this._hi),e=this._hi*t,n=Ze.valueOf(e),r=this.subtract(n.sqr()),i=r._hi*(t*.5);return n.add(i)};Ze.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof Ze){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0],n=null,r=null,i=null,o=null,c=null,l=null;return i=this._hi+e,c=i-this._hi,o=i-c,o=e-c+(this._hi-o),l=o+this._lo,n=i+l,r=l+(i-n),this._hi=n+r,this._lo=r+(n-this._hi),this}}else if(arguments.length===2){var d=arguments[0],y=arguments[1],S=null,E=null,C=null,A=null,M=null,R=null,N=null,B=null;M=this._hi+d,C=this._lo+y,N=M-this._hi,B=C-this._lo,R=M-N,A=C-B,R=d-N+(this._hi-R),A=y-B+(this._lo-A),N=R+C,S=M+N,E=N+(M-S),N=A+E;var O=S+N,G=N+(S-O);return this._hi=O,this._lo=G,this}};Ze.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof Ze){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.selfMultiply(e,0)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1],i=null,o=null,c=null,l=null,d=null,y=null;d=Ze.SPLIT*this._hi,i=d-this._hi,y=Ze.SPLIT*n,i=d-i,o=this._hi-i,c=y-n,d=this._hi*n,c=y-c,l=n-c,y=i*c-d+i*l+o*c+o*l+(this._hi*r+this._lo*n);var S=d+y;i=d-S;var E=y+i;return this._hi=S,this._lo=E,this}};Ze.prototype.selfSqr=function(){return this.selfMultiply(this)};Ze.prototype.floor=function(){if(this.isNaN())return Ze.NaN;var t=Math.floor(this._hi),e=0;return t===this._hi&&(e=Math.floor(this._lo)),new Ze(t,e)};Ze.prototype.negate=function(){return this.isNaN()?this:new Ze(-this._hi,-this._lo)};Ze.prototype.clone=function(){};Ze.prototype.multiply=function(){if(arguments[0]instanceof Ze){var t=arguments[0];return t.isNaN()?Ze.createNaN():Ze.copy(this).selfMultiply(t)}else if(typeof arguments[0]=="number"){var e=arguments[0];return cn.isNaN(e)?Ze.createNaN():Ze.copy(this).selfMultiply(e,0)}};Ze.prototype.isNaN=function(){return cn.isNaN(this._hi)};Ze.prototype.intValue=function(){return Math.trunc(this._hi)};Ze.prototype.toString=function(){var t=Ze.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()};Ze.prototype.toStandardNotation=function(){var t=this.getSpecialNumberString();if(t!==null)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!0,e),r=e[0]+1,i=n;if(n.charAt(0)===".")i="0"+n;else if(r<0)i="0."+Ze.stringOfChar("0",-r)+n;else if(n.indexOf(".")===-1){var o=r-n.length,c=Ze.stringOfChar("0",o);i=n+c+".0"}return this.isNegative()?"-"+i:i};Ze.prototype.reciprocal=function(){var t=null,e=null,n=null,r=null,i=null,o=null,c=null,l=null;i=1/this._hi,o=Ze.SPLIT*i,t=o-i,l=Ze.SPLIT*this._hi,t=o-t,e=i-t,n=l-this._hi,c=i*this._hi,n=l-n,r=this._hi-n,l=t*n-c+t*r+e*n+e*r,o=(1-c-l-i*this._lo)/this._hi;var d=i+o,y=i-d+o;return new Ze(d,y)};Ze.prototype.toSciNotation=function(){if(this.isZero())return Ze.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(t!==null)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!1,e),r=Ze.SCI_NOT_EXPONENT_CHAR+e[0];if(n.charAt(0)==="0")throw new Error("Found leading zero: "+n);var i="";n.length>1&&(i=n.substring(1));var o=n.charAt(0)+"."+i;return this.isNegative()?"-"+o+r:o+r};Ze.prototype.abs=function(){return this.isNaN()?Ze.NaN:this.isNegative()?this.negate():new Ze(this)};Ze.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};Ze.prototype.lt=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<t._lo};Ze.prototype.add=function(){if(arguments[0]instanceof Ze){var t=arguments[0];return Ze.copy(this).selfAdd(t)}else if(typeof arguments[0]=="number"){var e=arguments[0];return Ze.copy(this).selfAdd(e)}};Ze.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof Ze){var e=arguments[0];this._hi=e._hi,this._lo=e._lo}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this._hi=n,this._lo=r}};Ze.prototype.gt=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>t._lo};Ze.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};Ze.prototype.trunc=function(){return this.isNaN()?Ze.NaN:this.isPositive()?this.floor():this.ceil()};Ze.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};Ze.prototype.interfaces_=function(){return[Ts,Cs,uy]};Ze.prototype.getClass=function(){return Ze};Ze.sqr=function(t){return Ze.valueOf(t).selfMultiply(t)};Ze.valueOf=function(){if(typeof arguments[0]=="string"){var t=arguments[0];return Ze.parse(t)}else if(typeof arguments[0]=="number"){var e=arguments[0];return new Ze(e)}};Ze.sqrt=function(t){return Ze.valueOf(t).sqrt()};Ze.parse=function(t){for(var e=0,n=t.length;om.isWhitespace(t.charAt(e));)e++;var r=!1;if(e<n){var i=t.charAt(e);(i==="-"||i==="+")&&(e++,i==="-"&&(r=!0))}for(var o=new Ze,c=0,l=0,d=0;!(e>=n);){var y=t.charAt(e);if(e++,om.isDigit(y)){var S=y-"0";o.selfMultiply(Ze.TEN),o.selfAdd(S),c++;continue}if(y==="."){l=c;continue}if(y==="e"||y==="E"){var E=t.substring(e);try{d=Sa.parseInt(E)}catch(N){throw N instanceof Error?new Error("Invalid exponent "+E+" in string "+t):N}finally{}break}throw new Error("Unexpected character '"+y+"' at position "+e+" in string "+t)}var C=o,A=c-l-d;if(A===0)C=o;else if(A>0){var M=Ze.TEN.pow(A);C=o.divide(M)}else if(A<0){var R=Ze.TEN.pow(-A);C=o.multiply(R)}return r?C.negate():C};Ze.createNaN=function(){return new Ze(cn.NaN,cn.NaN)};Ze.copy=function(t){return new Ze(t)};Ze.magnitude=function(t){var e=Math.abs(t),n=Math.log(e)/Math.log(10),r=Math.trunc(Math.floor(n)),i=Math.pow(10,r);return i*10<=e&&(r+=1),r};Ze.stringOfChar=function(t,e){for(var n=new Na,r=0;r<e;r++)n.append(t);return n.toString()};$s.PI.get=function(){return new Ze(3.141592653589793,12246467991473532e-32)};$s.TWO_PI.get=function(){return new Ze(6.283185307179586,24492935982947064e-32)};$s.PI_2.get=function(){return new Ze(1.5707963267948966,6123233995736766e-32)};$s.E.get=function(){return new Ze(2.718281828459045,14456468917292502e-32)};$s.NaN.get=function(){return new Ze(cn.NaN,cn.NaN)};$s.EPS.get=function(){return 123259516440783e-46};$s.SPLIT.get=function(){return 134217729};$s.MAX_PRINT_DIGITS.get=function(){return 32};$s.TEN.get=function(){return Ze.valueOf(10)};$s.ONE.get=function(){return Ze.valueOf(1)};$s.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};$s.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(Ze,$s);var wo=function(){},BC={DP_SAFE_EPSILON:{configurable:!0}};wo.prototype.interfaces_=function(){return[]};wo.prototype.getClass=function(){return wo};wo.orientationIndex=function(t,e,n){var r=wo.orientationIndexFilter(t,e,n);if(r<=1)return r;var i=Ze.valueOf(e.x).selfAdd(-t.x),o=Ze.valueOf(e.y).selfAdd(-t.y),c=Ze.valueOf(n.x).selfAdd(-e.x),l=Ze.valueOf(n.y).selfAdd(-e.y);return i.selfMultiply(l).selfSubtract(o.selfMultiply(c)).signum()};wo.signOfDet2x2=function(t,e,n,r){var i=t.multiply(r).selfSubtract(e.multiply(n));return i.signum()};wo.intersection=function(t,e,n,r){var i=Ze.valueOf(r.y).selfSubtract(n.y).selfMultiply(Ze.valueOf(e.x).selfSubtract(t.x)),o=Ze.valueOf(r.x).selfSubtract(n.x).selfMultiply(Ze.valueOf(e.y).selfSubtract(t.y)),c=i.subtract(o),l=Ze.valueOf(r.x).selfSubtract(n.x).selfMultiply(Ze.valueOf(t.y).selfSubtract(n.y)),d=Ze.valueOf(r.y).selfSubtract(n.y).selfMultiply(Ze.valueOf(t.x).selfSubtract(n.x)),y=l.subtract(d),S=y.selfDivide(c).doubleValue(),E=Ze.valueOf(t.x).selfAdd(Ze.valueOf(e.x).selfSubtract(t.x).selfMultiply(S)).doubleValue(),C=Ze.valueOf(e.x).selfSubtract(t.x).selfMultiply(Ze.valueOf(t.y).selfSubtract(n.y)),A=Ze.valueOf(e.y).selfSubtract(t.y).selfMultiply(Ze.valueOf(t.x).selfSubtract(n.x)),M=C.subtract(A),R=M.selfDivide(c).doubleValue(),N=Ze.valueOf(n.y).selfAdd(Ze.valueOf(r.y).selfSubtract(n.y).selfMultiply(R)).doubleValue();return new Oe(E,N)};wo.orientationIndexFilter=function(t,e,n){var r=null,i=(t.x-n.x)*(e.y-n.y),o=(t.y-n.y)*(e.x-n.x),c=i-o;if(i>0){if(o<=0)return wo.signum(c);r=i+o}else if(i<0){if(o>=0)return wo.signum(c);r=-i-o}else return wo.signum(c);var l=wo.DP_SAFE_EPSILON*r;return c>=l||-c>=l?wo.signum(c):2};wo.signum=function(t){return t>0?1:t<0?-1:0};BC.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(wo,BC);var Vn=function(){},Cm={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};Cm.X.get=function(){return 0};Cm.Y.get=function(){return 1};Cm.Z.get=function(){return 2};Cm.M.get=function(){return 3};Vn.prototype.setOrdinate=function(t,e,n){};Vn.prototype.size=function(){};Vn.prototype.getOrdinate=function(t,e){};Vn.prototype.getCoordinate=function(){};Vn.prototype.getCoordinateCopy=function(t){};Vn.prototype.getDimension=function(){};Vn.prototype.getX=function(t){};Vn.prototype.clone=function(){};Vn.prototype.expandEnvelope=function(t){};Vn.prototype.copy=function(){};Vn.prototype.getY=function(t){};Vn.prototype.toCoordinateArray=function(){};Vn.prototype.interfaces_=function(){return[uy]};Vn.prototype.getClass=function(){return Vn};Object.defineProperties(Vn,Cm);var VC=function(){},yp=function(t){function e(){t.call(this,"Projective point not representable on the Cartesian plane.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(VC),Fi=function(){};Fi.arraycopy=function(t,e,n,r,i){for(var o=0,c=e;c<e+i;c++)n[r+o]=t[c],o++};Fi.getProperty=function(t){return{"line.separator":`
`}[t]};var Us=function t(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var e=arguments[0];this.x=e.x,this.y=e.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],r=arguments[1];this.x=n,this.y=r,this.w=1}else if(arguments[0]instanceof t&&arguments[1]instanceof t){var i=arguments[0],o=arguments[1];this.x=i.y*o.w-o.y*i.w,this.y=o.x*i.w-i.x*o.w,this.w=i.x*o.y-o.x*i.y}else if(arguments[0]instanceof Oe&&arguments[1]instanceof Oe){var c=arguments[0],l=arguments[1];this.x=c.y-l.y,this.y=l.x-c.x,this.w=c.x*l.y-l.x*c.y}}else if(arguments.length===3){var d=arguments[0],y=arguments[1],S=arguments[2];this.x=d,this.y=y,this.w=S}else if(arguments.length===4){var E=arguments[0],C=arguments[1],A=arguments[2],M=arguments[3],R=E.y-C.y,N=C.x-E.x,B=E.x*C.y-C.x*E.y,O=A.y-M.y,G=M.x-A.x,U=A.x*M.y-M.x*A.y;this.x=N*U-G*B,this.y=O*B-R*U,this.w=R*G-O*N}};Us.prototype.getY=function(){var t=this.y/this.w;if(cn.isNaN(t)||cn.isInfinite(t))throw new yp;return t};Us.prototype.getX=function(){var t=this.x/this.w;if(cn.isNaN(t)||cn.isInfinite(t))throw new yp;return t};Us.prototype.getCoordinate=function(){var t=new Oe;return t.x=this.getX(),t.y=this.getY(),t};Us.prototype.interfaces_=function(){return[]};Us.prototype.getClass=function(){return Us};Us.intersection=function(t,e,n,r){var i=t.y-e.y,o=e.x-t.x,c=t.x*e.y-e.x*t.y,l=n.y-r.y,d=r.x-n.x,y=n.x*r.y-r.x*n.y,S=o*y-d*c,E=l*c-i*y,C=i*d-l*o,A=S/C,M=E/C;if(cn.isNaN(A)||cn.isInfinite(A)||cn.isNaN(M)||cn.isInfinite(M))throw new yp;return new Oe(A,M)};var Wt=function t(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof Oe){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof t){var n=arguments[0];this.init(n)}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this.init(r.x,i.x,r.y,i.y)}else if(arguments.length===4){var o=arguments[0],c=arguments[1],l=arguments[2],d=arguments[3];this.init(o,c,l,d)}},UC={serialVersionUID:{configurable:!0}};Wt.prototype.getArea=function(){return this.getWidth()*this.getHeight()};Wt.prototype.equals=function(t){if(!(t instanceof Wt))return!1;var e=t;return this.isNull()?e.isNull():this._maxx===e.getMaxX()&&this._maxy===e.getMaxY()&&this._minx===e.getMinX()&&this._miny===e.getMinY()};Wt.prototype.intersection=function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new Wt;var e=this._minx>t._minx?this._minx:t._minx,n=this._miny>t._miny?this._miny:t._miny,r=this._maxx<t._maxx?this._maxx:t._maxx,i=this._maxy<t._maxy?this._maxy:t._maxy;return new Wt(e,r,n,i)};Wt.prototype.isNull=function(){return this._maxx<this._minx};Wt.prototype.getMaxX=function(){return this._maxx};Wt.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof Oe){var t=arguments[0];return this.covers(t.x,t.y)}else if(arguments[0]instanceof Wt){var e=arguments[0];return this.isNull()||e.isNull()?!1:e.getMinX()>=this._minx&&e.getMaxX()<=this._maxx&&e.getMinY()>=this._miny&&e.getMaxY()<=this._maxy}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.isNull()?!1:n>=this._minx&&n<=this._maxx&&r>=this._miny&&r<=this._maxy}};Wt.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof Wt){var t=arguments[0];return this.isNull()||t.isNull()?!1:!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}else if(arguments[0]instanceof Oe){var e=arguments[0];return this.intersects(e.x,e.y)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.isNull()?!1:!(n>this._maxx||n<this._minx||r>this._maxy||r<this._miny)}};Wt.prototype.getMinY=function(){return this._miny};Wt.prototype.getMinX=function(){return this._minx};Wt.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof Oe){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof Wt){var e=arguments[0];if(e.isNull())return null;this.isNull()?(this._minx=e.getMinX(),this._maxx=e.getMaxX(),this._miny=e.getMinY(),this._maxy=e.getMaxY()):(e._minx<this._minx&&(this._minx=e._minx),e._maxx>this._maxx&&(this._maxx=e._maxx),e._miny<this._miny&&(this._miny=e._miny),e._maxy>this._maxy&&(this._maxy=e._maxy))}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.isNull()?(this._minx=n,this._maxx=n,this._miny=r,this._maxy=r):(n<this._minx&&(this._minx=n),n>this._maxx&&(this._maxx=n),r<this._miny&&(this._miny=r),r>this._maxy&&(this._maxy=r))}};Wt.prototype.minExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t<e?t:e};Wt.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};Wt.prototype.compareTo=function(t){var e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this._minx<e._minx?-1:this._minx>e._minx?1:this._miny<e._miny?-1:this._miny>e._miny?1:this._maxx<e._maxx?-1:this._maxx>e._maxx?1:this._maxy<e._maxy?-1:this._maxy>e._maxy?1:0};Wt.prototype.translate=function(t,e){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)};Wt.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};Wt.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};Wt.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};Wt.prototype.maxExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t>e?t:e};Wt.prototype.expandBy=function(){if(arguments.length===1){var t=arguments[0];this.expandBy(t,t)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=e,this._maxx+=e,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};Wt.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof Wt){var t=arguments[0];return this.covers(t)}else if(arguments[0]instanceof Oe){var e=arguments[0];return this.covers(e)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.covers(n,r)}};Wt.prototype.centre=function(){return this.isNull()?null:new Oe((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};Wt.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof Oe){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof Wt){var e=arguments[0];this._minx=e._minx,this._maxx=e._maxx,this._miny=e._miny,this._maxy=e._maxy}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.init(n.x,r.x,n.y,r.y)}else if(arguments.length===4){var i=arguments[0],o=arguments[1],c=arguments[2],l=arguments[3];i<o?(this._minx=i,this._maxx=o):(this._minx=o,this._maxx=i),c<l?(this._miny=c,this._maxy=l):(this._miny=l,this._maxy=c)}};Wt.prototype.getMaxY=function(){return this._maxy};Wt.prototype.distance=function(t){if(this.intersects(t))return 0;var e=0;this._maxx<t._minx?e=t._minx-this._maxx:this._minx>t._maxx&&(e=this._minx-t._maxx);var n=0;return this._maxy<t._miny?n=t._miny-this._maxy:this._miny>t._maxy&&(n=this._miny-t._maxy),e===0?n:n===0?e:Math.sqrt(e*e+n*n)};Wt.prototype.hashCode=function(){var t=17;return t=37*t+Oe.hashCode(this._minx),t=37*t+Oe.hashCode(this._maxx),t=37*t+Oe.hashCode(this._miny),t=37*t+Oe.hashCode(this._maxy),t};Wt.prototype.interfaces_=function(){return[Cs,Ts]};Wt.prototype.getClass=function(){return Wt};Wt.intersects=function(){if(arguments.length===3){var t=arguments[0],e=arguments[1],n=arguments[2];return n.x>=(t.x<e.x?t.x:e.x)&&n.x<=(t.x>e.x?t.x:e.x)&&n.y>=(t.y<e.y?t.y:e.y)&&n.y<=(t.y>e.y?t.y:e.y)}else if(arguments.length===4){var r=arguments[0],i=arguments[1],o=arguments[2],c=arguments[3],l=Math.min(o.x,c.x),d=Math.max(o.x,c.x),y=Math.min(r.x,i.x),S=Math.max(r.x,i.x);return!(y>d||S<l||(l=Math.min(o.y,c.y),d=Math.max(o.y,c.y),y=Math.min(r.y,i.y),S=Math.max(r.y,i.y),y>d)||S<l)}};UC.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties(Wt,UC);var ua={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},cy=function(t){this.geometryFactory=t||new Mn};cy.prototype.read=function(t){var e,n,r;t=t.replace(/[\n\r]/g," ");var i=ua.typeStr.exec(t);if(t.search("EMPTY")!==-1&&(i=ua.emptyTypeStr.exec(t),i[2]=void 0),i&&(n=i[1].toLowerCase(),r=i[2],Mf[n]&&(e=Mf[n].apply(this,[r]))),e===void 0)throw new Error("Could not parse WKT "+t);return e};cy.prototype.write=function(t){return this.extractGeometry(t)};cy.prototype.extractGeometry=function(t){var e=t.getGeometryType().toLowerCase();if(!xl[e])return null;var n=e.toUpperCase(),r;return t.isEmpty()?r=n+" EMPTY":r=n+"("+xl[e].apply(this,[t])+")",r};var xl={coordinate:function(t){return t.x+" "+t.y},point:function(t){return xl.coordinate.call(this,t._coordinates._coordinates[0])},multipoint:function(t){for(var e=this,n=[],r=0,i=t._geometries.length;r<i;++r)n.push("("+xl.point.apply(e,[t._geometries[r]])+")");return n.join(",")},linestring:function(t){for(var e=this,n=[],r=0,i=t._points._coordinates.length;r<i;++r)n.push(xl.coordinate.apply(e,[t._points._coordinates[r]]));return n.join(",")},linearring:function(t){for(var e=this,n=[],r=0,i=t._points._coordinates.length;r<i;++r)n.push(xl.coordinate.apply(e,[t._points._coordinates[r]]));return n.join(",")},multilinestring:function(t){for(var e=this,n=[],r=0,i=t._geometries.length;r<i;++r)n.push("("+xl.linestring.apply(e,[t._geometries[r]])+")");return n.join(",")},polygon:function(t){var e=this,n=[];n.push("("+xl.linestring.apply(this,[t._shell])+")");for(var r=0,i=t._holes.length;r<i;++r)n.push("("+xl.linestring.apply(e,[t._holes[r]])+")");return n.join(",")},multipolygon:function(t){for(var e=this,n=[],r=0,i=t._geometries.length;r<i;++r)n.push("("+xl.polygon.apply(e,[t._geometries[r]])+")");return n.join(",")},geometrycollection:function(t){for(var e=this,n=[],r=0,i=t._geometries.length;r<i;++r)n.push(e.extractGeometry(t._geometries[r]));return n.join(",")}},Mf={point:function(t){if(t===void 0)return this.geometryFactory.createPoint();var e=t.trim().split(ua.spaces);return this.geometryFactory.createPoint(new Oe(Number.parseFloat(e[0]),Number.parseFloat(e[1])))},multipoint:function(t){var e=this;if(t===void 0)return this.geometryFactory.createMultiPoint();for(var n,r=t.trim().split(","),i=[],o=0,c=r.length;o<c;++o)n=r[o].replace(ua.trimParens,"$1"),i.push(Mf.point.apply(e,[n]));return this.geometryFactory.createMultiPoint(i)},linestring:function(t){if(t===void 0)return this.geometryFactory.createLineString();for(var e=t.trim().split(","),n=[],r,i=0,o=e.length;i<o;++i)r=e[i].trim().split(ua.spaces),n.push(new Oe(Number.parseFloat(r[0]),Number.parseFloat(r[1])));return this.geometryFactory.createLineString(n)},linearring:function(t){if(t===void 0)return this.geometryFactory.createLinearRing();for(var e=t.trim().split(","),n=[],r,i=0,o=e.length;i<o;++i)r=e[i].trim().split(ua.spaces),n.push(new Oe(Number.parseFloat(r[0]),Number.parseFloat(r[1])));return this.geometryFactory.createLinearRing(n)},multilinestring:function(t){var e=this;if(t===void 0)return this.geometryFactory.createMultiLineString();for(var n,r=t.trim().split(ua.parenComma),i=[],o=0,c=r.length;o<c;++o)n=r[o].replace(ua.trimParens,"$1"),i.push(Mf.linestring.apply(e,[n]));return this.geometryFactory.createMultiLineString(i)},polygon:function(t){var e=this;if(t===void 0)return this.geometryFactory.createPolygon();for(var n,r,i,o=t.trim().split(ua.parenComma),c,l=[],d=0,y=o.length;d<y;++d)n=o[d].replace(ua.trimParens,"$1"),r=Mf.linestring.apply(e,[n]),i=e.geometryFactory.createLinearRing(r._points),d===0?c=i:l.push(i);return this.geometryFactory.createPolygon(c,l)},multipolygon:function(t){var e=this;if(t===void 0)return this.geometryFactory.createMultiPolygon();for(var n,r=t.trim().split(ua.doubleParenComma),i=[],o=0,c=r.length;o<c;++o)n=r[o].replace(ua.trimParens,"$1"),i.push(Mf.polygon.apply(e,[n]));return this.geometryFactory.createMultiPolygon(i)},geometrycollection:function(t){var e=this;if(t===void 0)return this.geometryFactory.createGeometryCollection();t=t.replace(/,\s*([A-Za-z])/g,"|$1");for(var n=t.trim().split("|"),r=[],i=0,o=n.length;i<o;++i)r.push(e.read(n[i]));return this.geometryFactory.createGeometryCollection(r)}},Gs=function(t){this.parser=new cy(t)};Gs.prototype.write=function(t){return this.parser.write(t)};Gs.toLineString=function(t,e){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"};var kl=function(t){function e(n){t.call(this,n),this.name="RuntimeException",this.message=n,this.stack=new t().stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),F_=function(t){function e(){if(t.call(this),arguments.length===0)t.call(this);else if(arguments.length===1){var n=arguments[0];t.call(this,n)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(kl),yn=function(){};yn.prototype.interfaces_=function(){return[]};yn.prototype.getClass=function(){return yn};yn.shouldNeverReachHere=function(){if(arguments.length===0)yn.shouldNeverReachHere(null);else if(arguments.length===1){var t=arguments[0];throw new F_("Should never reach here"+(t!==null?": "+t:""))}};yn.isTrue=function(){var t,e;if(arguments.length===1)t=arguments[0],yn.isTrue(t,null);else if(arguments.length===2&&(t=arguments[0],e=arguments[1],!t))throw e===null?new F_:new F_(e)};yn.equals=function(){var t,e,n;if(arguments.length===2)t=arguments[0],e=arguments[1],yn.equals(t,e,null);else if(arguments.length===3&&(t=arguments[0],e=arguments[1],n=arguments[2],!e.equals(t)))throw new F_("Expected "+t+" but encountered "+e+(n!==null?": "+n:""))};var Tr=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Oe,this._intPt[1]=new Oe,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},mh={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};Tr.prototype.getIndexAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intLineIndex[t][e]};Tr.prototype.getTopologySummary=function(){var t=new Na;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()};Tr.prototype.computeIntersection=function(t,e,n,r){this._inputLines[0][0]=t,this._inputLines[0][1]=e,this._inputLines[1][0]=n,this._inputLines[1][1]=r,this._result=this.computeIntersect(t,e,n,r)};Tr.prototype.getIntersectionNum=function(){return this._result};Tr.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var t=arguments[0],e=this.getEdgeDistance(t,0),n=this.getEdgeDistance(t,1);e>n?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0)}};Tr.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};Tr.prototype.setPrecisionModel=function(t){this._precisionModel=t};Tr.prototype.isInteriorIntersection=function(){var t=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var e=arguments[0],n=0;n<this._result;n++)if(!(t._intPt[n].equals2D(t._inputLines[e][0])||t._intPt[n].equals2D(t._inputLines[e][1])))return!0;return!1}};Tr.prototype.getIntersection=function(t){return this._intPt[t]};Tr.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};Tr.prototype.hasIntersection=function(){return this._result!==Tr.NO_INTERSECTION};Tr.prototype.getEdgeDistance=function(t,e){var n=Tr.computeEdgeDistance(this._intPt[e],this._inputLines[t][0],this._inputLines[t][1]);return n};Tr.prototype.isCollinear=function(){return this._result===Tr.COLLINEAR_INTERSECTION};Tr.prototype.toString=function(){return Gs.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Gs.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};Tr.prototype.getEndpoint=function(t,e){return this._inputLines[t][e]};Tr.prototype.isIntersection=function(t){for(var e=this,n=0;n<this._result;n++)if(e._intPt[n].equals2D(t))return!0;return!1};Tr.prototype.getIntersectionAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][e]]};Tr.prototype.interfaces_=function(){return[]};Tr.prototype.getClass=function(){return Tr};Tr.computeEdgeDistance=function(t,e,n){var r=Math.abs(n.x-e.x),i=Math.abs(n.y-e.y),o=-1;if(t.equals(e))o=0;else if(t.equals(n))r>i?o=r:o=i;else{var c=Math.abs(t.x-e.x),l=Math.abs(t.y-e.y);r>i?o=c:o=l,o===0&&!t.equals(e)&&(o=Math.max(c,l))}return yn.isTrue(!(o===0&&!t.equals(e)),"Bad distance calculation"),o};Tr.nonRobustComputeEdgeDistance=function(t,e,n){var r=t.x-e.x,i=t.y-e.y,o=Math.sqrt(r*r+i*i);return yn.isTrue(!(o===0&&!t.equals(e)),"Invalid distance calculation"),o};mh.DONT_INTERSECT.get=function(){return 0};mh.DO_INTERSECT.get=function(){return 1};mh.COLLINEAR.get=function(){return 2};mh.NO_INTERSECTION.get=function(){return 0};mh.POINT_INTERSECTION.get=function(){return 1};mh.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(Tr,mh);var gc=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isInSegmentEnvelopes=function(n){var r=new Wt(this._inputLines[0][0],this._inputLines[0][1]),i=new Wt(this._inputLines[1][0],this._inputLines[1][1]);return r.contains(n)&&i.contains(n)},e.prototype.computeIntersection=function(){if(arguments.length===3){var n=arguments[0],r=arguments[1],i=arguments[2];if(this._isProper=!1,Wt.intersects(r,i,n)&&Tt.orientationIndex(r,i,n)===0&&Tt.orientationIndex(i,r,n)===0)return this._isProper=!0,(n.equals(r)||n.equals(i))&&(this._isProper=!1),this._result=t.POINT_INTERSECTION,null;this._result=t.NO_INTERSECTION}else return t.prototype.computeIntersection.apply(this,arguments)},e.prototype.normalizeToMinimum=function(n,r,i,o,c){c.x=this.smallestInAbsValue(n.x,r.x,i.x,o.x),c.y=this.smallestInAbsValue(n.y,r.y,i.y,o.y),n.x-=c.x,n.y-=c.y,r.x-=c.x,r.y-=c.y,i.x-=c.x,i.y-=c.y,o.x-=c.x,o.y-=c.y},e.prototype.safeHCoordinateIntersection=function(n,r,i,o){var c=null;try{c=Us.intersection(n,r,i,o)}catch(l){if(l instanceof yp)c=e.nearestEndpoint(n,r,i,o);else throw l}finally{}return c},e.prototype.intersection=function(n,r,i,o){var c=this.intersectionWithNormalization(n,r,i,o);return this.isInSegmentEnvelopes(c)||(c=new Oe(e.nearestEndpoint(n,r,i,o))),this._precisionModel!==null&&this._precisionModel.makePrecise(c),c},e.prototype.smallestInAbsValue=function(n,r,i,o){var c=n,l=Math.abs(c);return Math.abs(r)<l&&(c=r,l=Math.abs(r)),Math.abs(i)<l&&(c=i,l=Math.abs(i)),Math.abs(o)<l&&(c=o),c},e.prototype.checkDD=function(n,r,i,o,c){var l=wo.intersection(n,r,i,o),d=this.isInSegmentEnvelopes(l);Fi.out.println("DD in env = "+d+"  --------------------- "+l),c.distance(l)>1e-4&&Fi.out.println("Distance = "+c.distance(l))},e.prototype.intersectionWithNormalization=function(n,r,i,o){var c=new Oe(n),l=new Oe(r),d=new Oe(i),y=new Oe(o),S=new Oe;this.normalizeToEnvCentre(c,l,d,y,S);var E=this.safeHCoordinateIntersection(c,l,d,y);return E.x+=S.x,E.y+=S.y,E},e.prototype.computeCollinearIntersection=function(n,r,i,o){var c=Wt.intersects(n,r,i),l=Wt.intersects(n,r,o),d=Wt.intersects(i,o,n),y=Wt.intersects(i,o,r);return c&&l?(this._intPt[0]=i,this._intPt[1]=o,t.COLLINEAR_INTERSECTION):d&&y?(this._intPt[0]=n,this._intPt[1]=r,t.COLLINEAR_INTERSECTION):c&&d?(this._intPt[0]=i,this._intPt[1]=n,i.equals(n)&&!l&&!y?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):c&&y?(this._intPt[0]=i,this._intPt[1]=r,i.equals(r)&&!l&&!d?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):l&&d?(this._intPt[0]=o,this._intPt[1]=n,o.equals(n)&&!c&&!y?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):l&&y?(this._intPt[0]=o,this._intPt[1]=r,o.equals(r)&&!c&&!d?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):t.NO_INTERSECTION},e.prototype.normalizeToEnvCentre=function(n,r,i,o,c){var l=n.x<r.x?n.x:r.x,d=n.y<r.y?n.y:r.y,y=n.x>r.x?n.x:r.x,S=n.y>r.y?n.y:r.y,E=i.x<o.x?i.x:o.x,C=i.y<o.y?i.y:o.y,A=i.x>o.x?i.x:o.x,M=i.y>o.y?i.y:o.y,R=l>E?l:E,N=y<A?y:A,B=d>C?d:C,O=S<M?S:M,G=(R+N)/2,U=(B+O)/2;c.x=G,c.y=U,n.x-=c.x,n.y-=c.y,r.x-=c.x,r.y-=c.y,i.x-=c.x,i.y-=c.y,o.x-=c.x,o.y-=c.y},e.prototype.computeIntersect=function(n,r,i,o){if(this._isProper=!1,!Wt.intersects(n,r,i,o))return t.NO_INTERSECTION;var c=Tt.orientationIndex(n,r,i),l=Tt.orientationIndex(n,r,o);if(c>0&&l>0||c<0&&l<0)return t.NO_INTERSECTION;var d=Tt.orientationIndex(i,o,n),y=Tt.orientationIndex(i,o,r);if(d>0&&y>0||d<0&&y<0)return t.NO_INTERSECTION;var S=c===0&&l===0&&d===0&&y===0;return S?this.computeCollinearIntersection(n,r,i,o):(c===0||l===0||d===0||y===0?(this._isProper=!1,n.equals2D(i)||n.equals2D(o)?this._intPt[0]=n:r.equals2D(i)||r.equals2D(o)?this._intPt[0]=r:c===0?this._intPt[0]=new Oe(i):l===0?this._intPt[0]=new Oe(o):d===0?this._intPt[0]=new Oe(n):y===0&&(this._intPt[0]=new Oe(r))):(this._isProper=!0,this._intPt[0]=this.intersection(n,r,i,o)),t.POINT_INTERSECTION)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.nearestEndpoint=function(n,r,i,o){var c=n,l=Tt.distancePointLine(n,i,o),d=Tt.distancePointLine(r,i,o);return d<l&&(l=d,c=r),d=Tt.distancePointLine(i,n,r),d<l&&(l=d,c=i),d=Tt.distancePointLine(o,n,r),d<l&&(l=d,c=o),c},e}(Tr),Qc=function(){};Qc.prototype.interfaces_=function(){return[]};Qc.prototype.getClass=function(){return Qc};Qc.orientationIndex=function(t,e,n){var r=e.x-t.x,i=e.y-t.y,o=n.x-e.x,c=n.y-e.y;return Qc.signOfDet2x2(r,i,o,c)};Qc.signOfDet2x2=function(t,e,n,r){var i=null,o=null,c=null;if(i=1,t===0||r===0)return e===0||n===0?0:e>0?n>0?-i:i:n>0?i:-i;if(e===0||n===0)return r>0?t>0?i:-i:t>0?-i:i;if(e>0?r>0?e<=r||(i=-i,o=t,t=n,n=o,o=e,e=r,r=o):e<=-r?(i=-i,n=-n,r=-r):(o=t,t=-n,n=o,o=e,e=-r,r=o):r>0?-e<=r?(i=-i,t=-t,e=-e):(o=-t,t=n,n=o,o=-e,e=r,r=o):e>=r?(t=-t,e=-e,n=-n,r=-r):(i=-i,o=-t,t=-n,n=o,o=-e,e=-r,r=o),t>0)if(n>0){if(!(t<=n))return i}else return i;else{if(n>0)return-i;if(t>=n)i=-i,t=-t,n=-n;else return-i}for(;;){if(c=Math.floor(n/t),n=n-c*t,r=r-c*e,r<0)return-i;if(r>e)return i;if(t>n+n){if(e<r+r)return i}else{if(e>r+r)return-i;n=t-n,r=e-r,i=-i}if(r===0)return n===0?0:-i;if(n===0||(c=Math.floor(t/n),t=t-c*n,e=e-c*r,e<0))return i;if(e>r)return-i;if(n>t+t){if(r<e+e)return-i}else{if(r>e+e)return i;t=n-t,e=r-e,i=-i}if(e===0)return t===0?0:i;if(t===0)return-i}};var ya=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var t=arguments[0];this._p=t};ya.prototype.countSegment=function(t,e){if(t.x<this._p.x&&e.x<this._p.x)return null;if(this._p.x===e.x&&this._p.y===e.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&e.y===this._p.y){var n=t.x,r=e.x;return n>r&&(n=e.x,r=t.x),this._p.x>=n&&this._p.x<=r&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&e.y<=this._p.y||e.y>this._p.y&&t.y<=this._p.y){var i=t.x-this._p.x,o=t.y-this._p.y,c=e.x-this._p.x,l=e.y-this._p.y,d=Qc.signOfDet2x2(i,o,c,l);if(d===0)return this._isPointOnSegment=!0,null;l<o&&(d=-d),d>0&&this._crossingCount++}};ya.prototype.isPointInPolygon=function(){return this.getLocation()!==ze.EXTERIOR};ya.prototype.getLocation=function(){return this._isPointOnSegment?ze.BOUNDARY:this._crossingCount%2===1?ze.INTERIOR:ze.EXTERIOR};ya.prototype.isOnSegment=function(){return this._isPointOnSegment};ya.prototype.interfaces_=function(){return[]};ya.prototype.getClass=function(){return ya};ya.locatePointInRing=function(){if(arguments[0]instanceof Oe&&rn(arguments[1],Vn)){for(var t=arguments[0],e=arguments[1],n=new ya(t),r=new Oe,i=new Oe,o=1;o<e.size();o++)if(e.getCoordinate(o,r),e.getCoordinate(o-1,i),n.countSegment(r,i),n.isOnSegment())return n.getLocation();return n.getLocation()}else if(arguments[0]instanceof Oe&&arguments[1]instanceof Array){for(var c=arguments[0],l=arguments[1],d=new ya(c),y=1;y<l.length;y++){var S=l[y],E=l[y-1];if(d.countSegment(S,E),d.isOnSegment())return d.getLocation()}return d.getLocation()}};var Tt=function(){},gh={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};Tt.prototype.interfaces_=function(){return[]};Tt.prototype.getClass=function(){return Tt};Tt.orientationIndex=function(t,e,n){return wo.orientationIndex(t,e,n)};Tt.signedArea=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var e=0,n=t[0].x,r=1;r<t.length-1;r++){var i=t[r].x-n,o=t[r+1].y,c=t[r-1].y;e+=i*(c-o)}return e/2}else if(rn(arguments[0],Vn)){var l=arguments[0],d=l.size();if(d<3)return 0;var y=new Oe,S=new Oe,E=new Oe;l.getCoordinate(0,S),l.getCoordinate(1,E);var C=S.x;E.x-=C;for(var A=0,M=1;M<d-1;M++)y.y=S.y,S.x=E.x,S.y=E.y,l.getCoordinate(M+1,E),E.x-=C,A+=S.x*(y.y-E.y);return A/2}};Tt.distanceLineLine=function(t,e,n,r){if(t.equals(e))return Tt.distancePointLine(t,n,r);if(n.equals(r))return Tt.distancePointLine(r,t,e);var i=!1;if(!Wt.intersects(t,e,n,r))i=!0;else{var o=(e.x-t.x)*(r.y-n.y)-(e.y-t.y)*(r.x-n.x);if(o===0)i=!0;else{var c=(t.y-n.y)*(r.x-n.x)-(t.x-n.x)*(r.y-n.y),l=(t.y-n.y)*(e.x-t.x)-(t.x-n.x)*(e.y-t.y),d=l/o,y=c/o;(y<0||y>1||d<0||d>1)&&(i=!0)}}return i?ss.min(Tt.distancePointLine(t,n,r),Tt.distancePointLine(e,n,r),Tt.distancePointLine(n,t,e),Tt.distancePointLine(r,t,e)):0};Tt.isPointInRing=function(t,e){return Tt.locatePointInRing(t,e)!==ze.EXTERIOR};Tt.computeLength=function(t){var e=t.size();if(e<=1)return 0;var n=0,r=new Oe;t.getCoordinate(0,r);for(var i=r.x,o=r.y,c=1;c<e;c++){t.getCoordinate(c,r);var l=r.x,d=r.y,y=l-i,S=d-o;n+=Math.sqrt(y*y+S*S),i=l,o=d}return n};Tt.isCCW=function(t){var e=t.length-1;if(e<3)throw new wr("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=t[0],r=0,i=1;i<=e;i++){var o=t[i];o.y>n.y&&(n=o,r=i)}var c=r;do c=c-1,c<0&&(c=e);while(t[c].equals2D(n)&&c!==r);var l=r;do l=(l+1)%e;while(t[l].equals2D(n)&&l!==r);var d=t[c],y=t[l];if(d.equals2D(n)||y.equals2D(n)||d.equals2D(y))return!1;var S=Tt.computeOrientation(d,n,y),E=!1;return S===0?E=d.x>y.x:E=S>0,E};Tt.locatePointInRing=function(t,e){return ya.locatePointInRing(t,e)};Tt.distancePointLinePerpendicular=function(t,e,n){var r=(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y),i=((e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y))/r;return Math.abs(i)*Math.sqrt(r)};Tt.computeOrientation=function(t,e,n){return Tt.orientationIndex(t,e,n)};Tt.distancePointLine=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1];if(e.length===0)throw new wr("Line array must contain at least one vertex");for(var n=t.distance(e[0]),r=0;r<e.length-1;r++){var i=Tt.distancePointLine(t,e[r],e[r+1]);i<n&&(n=i)}return n}else if(arguments.length===3){var o=arguments[0],c=arguments[1],l=arguments[2];if(c.x===l.x&&c.y===l.y)return o.distance(c);var d=(l.x-c.x)*(l.x-c.x)+(l.y-c.y)*(l.y-c.y),y=((o.x-c.x)*(l.x-c.x)+(o.y-c.y)*(l.y-c.y))/d;if(y<=0)return o.distance(c);if(y>=1)return o.distance(l);var S=((c.y-o.y)*(l.x-c.x)-(c.x-o.x)*(l.y-c.y))/d;return Math.abs(S)*Math.sqrt(d)}};Tt.isOnLine=function(t,e){for(var n=new gc,r=1;r<e.length;r++){var i=e[r-1],o=e[r];if(n.computeIntersection(t,i,o),n.hasIntersection())return!0}return!1};gh.CLOCKWISE.get=function(){return-1};gh.RIGHT.get=function(){return Tt.CLOCKWISE};gh.COUNTERCLOCKWISE.get=function(){return 1};gh.LEFT.get=function(){return Tt.COUNTERCLOCKWISE};gh.COLLINEAR.get=function(){return 0};gh.STRAIGHT.get=function(){return Tt.COLLINEAR};Object.defineProperties(Tt,gh);var Al=function(){};Al.prototype.filter=function(t){};Al.prototype.interfaces_=function(){return[]};Al.prototype.getClass=function(){return Al};var nn=function(){var t=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=t,this._SRID=t.getSRID()},sl={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};nn.prototype.isGeometryCollection=function(){return this.getSortIndex()===nn.SORTINDEX_GEOMETRYCOLLECTION};nn.prototype.getFactory=function(){return this._factory};nn.prototype.getGeometryN=function(t){return this};nn.prototype.getArea=function(){return 0};nn.prototype.isRectangle=function(){return!1};nn.prototype.equals=function(){if(arguments[0]instanceof nn){var t=arguments[0];return t===null?!1:this.equalsTopo(t)}else if(arguments[0]instanceof Object){var e=arguments[0];if(!(e instanceof nn))return!1;var n=e;return this.equalsExact(n)}};nn.prototype.equalsExact=function(t){return this===t||this.equalsExact(t,0)};nn.prototype.geometryChanged=function(){this.apply(nn.geometryChangedFilter)};nn.prototype.geometryChangedAction=function(){this._envelope=null};nn.prototype.equalsNorm=function(t){return t===null?!1:this.norm().equalsExact(t.norm())};nn.prototype.getLength=function(){return 0};nn.prototype.getNumGeometries=function(){return 1};nn.prototype.compareTo=function(){if(arguments.length===1){var t=arguments[0],e=t;return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(n,r)}};nn.prototype.getUserData=function(){return this._userData};nn.prototype.getSRID=function(){return this._SRID};nn.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};nn.prototype.checkNotGeometryCollection=function(t){if(t.getSortIndex()===nn.SORTINDEX_GEOMETRYCOLLECTION)throw new wr("This method does not support GeometryCollection arguments")};nn.prototype.equal=function(t,e,n){return n===0?t.equals(e):t.distance(e)<=n};nn.prototype.norm=function(){var t=this.copy();return t.normalize(),t};nn.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};nn.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new Wt(this._envelope)};nn.prototype.setSRID=function(t){this._SRID=t};nn.prototype.setUserData=function(t){this._userData=t};nn.prototype.compare=function(t,e){for(var n=t.iterator(),r=e.iterator();n.hasNext()&&r.hasNext();){var i=n.next(),o=r.next(),c=i.compareTo(o);if(c!==0)return c}return n.hasNext()?1:r.hasNext()?-1:0};nn.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};nn.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===nn.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===nn.SORTINDEX_MULTIPOINT||this.getSortIndex()===nn.SORTINDEX_MULTILINESTRING||this.getSortIndex()===nn.SORTINDEX_MULTIPOLYGON};nn.prototype.interfaces_=function(){return[uy,Cs,Ts]};nn.prototype.getClass=function(){return nn};nn.hasNonEmptyElements=function(t){for(var e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1};nn.hasNullElements=function(t){for(var e=0;e<t.length;e++)if(t[e]===null)return!0;return!1};sl.serialVersionUID.get=function(){return 8763622679187377e3};sl.SORTINDEX_POINT.get=function(){return 0};sl.SORTINDEX_MULTIPOINT.get=function(){return 1};sl.SORTINDEX_LINESTRING.get=function(){return 2};sl.SORTINDEX_LINEARRING.get=function(){return 3};sl.SORTINDEX_MULTILINESTRING.get=function(){return 4};sl.SORTINDEX_POLYGON.get=function(){return 5};sl.SORTINDEX_MULTIPOLYGON.get=function(){return 6};sl.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};sl.geometryChangedFilter.get=function(){return X1};Object.defineProperties(nn,sl);var X1=function(){};X1.interfaces_=function(){return[Al]};X1.filter=function(t){t.geometryChangedAction()};var Ka=function(){};Ka.prototype.filter=function(t){};Ka.prototype.interfaces_=function(){return[]};Ka.prototype.getClass=function(){return Ka};var Ss=function(){},Vl={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};Ss.prototype.isInBoundary=function(t){};Ss.prototype.interfaces_=function(){return[]};Ss.prototype.getClass=function(){return Ss};Vl.Mod2BoundaryNodeRule.get=function(){return qf};Vl.EndPointBoundaryNodeRule.get=function(){return Wf};Vl.MultiValentEndPointBoundaryNodeRule.get=function(){return Hf};Vl.MonoValentEndPointBoundaryNodeRule.get=function(){return Zf};Vl.MOD2_BOUNDARY_RULE.get=function(){return new qf};Vl.ENDPOINT_BOUNDARY_RULE.get=function(){return new Wf};Vl.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Hf};Vl.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Zf};Vl.OGC_SFS_BOUNDARY_RULE.get=function(){return Ss.MOD2_BOUNDARY_RULE};Object.defineProperties(Ss,Vl);var qf=function(){};qf.prototype.isInBoundary=function(t){return t%2===1};qf.prototype.interfaces_=function(){return[Ss]};qf.prototype.getClass=function(){return qf};var Wf=function(){};Wf.prototype.isInBoundary=function(t){return t>0};Wf.prototype.interfaces_=function(){return[Ss]};Wf.prototype.getClass=function(){return Wf};var Hf=function(){};Hf.prototype.isInBoundary=function(t){return t>1};Hf.prototype.interfaces_=function(){return[Ss]};Hf.prototype.getClass=function(){return Hf};var Zf=function(){};Zf.prototype.isInBoundary=function(t){return t===1};Zf.prototype.interfaces_=function(){return[Ss]};Zf.prototype.getClass=function(){return Zf};var ni=function(){};ni.prototype.add=function(){};ni.prototype.addAll=function(){};ni.prototype.isEmpty=function(){};ni.prototype.iterator=function(){};ni.prototype.size=function(){};ni.prototype.toArray=function(){};ni.prototype.remove=function(){};function Y1(t){this.message=t||""}Y1.prototype=new Error;Y1.prototype.name="IndexOutOfBoundsException";var vp=function(){};vp.prototype.hasNext=function(){};vp.prototype.next=function(){};vp.prototype.remove=function(){};var js=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(){},e.prototype.set=function(){},e.prototype.isEmpty=function(){},e}(ni);function bp(t){this.message=t||""}bp.prototype=new Error;bp.prototype.name="NoSuchElementException";var vt=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof ni&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.ensureCapacity=function(){},e.prototype.interfaces_=function(){return[t,ni]},e.prototype.add=function(n){return arguments.length===1?this.array_.push(n):this.array_.splice(arguments[0],arguments[1]),!0},e.prototype.clear=function(){this.array_=[]},e.prototype.addAll=function(n){for(var r=this,i=n.iterator();i.hasNext();)r.add(i.next());return!0},e.prototype.set=function(n,r){var i=this.array_[n];return this.array_[n]=r,i},e.prototype.iterator=function(){return new GO(this)},e.prototype.get=function(n){if(n<0||n>=this.size())throw new Y1;return this.array_[n]},e.prototype.isEmpty=function(){return this.array_.length===0},e.prototype.size=function(){return this.array_.length},e.prototype.toArray=function(){for(var n=this,r=[],i=0,o=this.array_.length;i<o;i++)r.push(n.array_[i]);return r},e.prototype.remove=function(n){for(var r=this,i=!1,o=0,c=this.array_.length;o<c;o++)if(r.array_[o]===n){r.array_.splice(o,1),i=!0;break}return i},e}(js),GO=function(t){function e(n){t.call(this),this.arrayList_=n,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new bp;return this.arrayList_.get(this.position_++)},e.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},e.prototype.set=function(n){return this.arrayList_.set(this.position_-1,n)},e.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},e}(vp),Tm=function(t){function e(){if(t.call(this),arguments.length!==0){if(arguments.length===1){var r=arguments[0];this.ensureCapacity(r.length),this.add(r,!0)}else if(arguments.length===2){var i=arguments[0],o=arguments[1];this.ensureCapacity(i.length),this.add(i,o)}}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return new Array(0).fill(null)},e.prototype.getCoordinate=function(r){return this.get(r)},e.prototype.addAll=function(){var r=this;if(arguments.length===2){for(var i=arguments[0],o=arguments[1],c=!1,l=i.iterator();l.hasNext();)r.add(l.next(),o),c=!0;return c}else return t.prototype.addAll.apply(this,arguments)},e.prototype.clone=function(){for(var r=this,i=t.prototype.clone.call(this),o=0;o<this.size();o++)i.add(o,r.get(o).copy());return i},e.prototype.toCoordinateArray=function(){return this.toArray(e.coordArrayType)},e.prototype.add=function(){var r=this;if(arguments.length===1){var i=arguments[0];t.prototype.add.call(this,i)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var o=arguments[0],c=arguments[1];return this.add(o,c,!0),!0}else if(arguments[0]instanceof Oe&&typeof arguments[1]=="boolean"){var l=arguments[0],d=arguments[1];if(!d&&this.size()>=1){var y=this.get(this.size()-1);if(y.equals2D(l))return null}t.prototype.add.call(this,l)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var S=arguments[0],E=arguments[1];return this.add(S,E),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var C=arguments[0],A=arguments[1],M=arguments[2];if(M)for(var R=0;R<C.length;R++)r.add(C[R],A);else for(var N=C.length-1;N>=0;N--)r.add(C[N],A);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof Oe){var B=arguments[0],O=arguments[1],G=arguments[2];if(!G){var U=this.size();if(U>0){if(B>0){var Z=this.get(B-1);if(Z.equals2D(O))return null}if(B<U){var ue=this.get(B);if(ue.equals2D(O))return null}}}t.prototype.add.call(this,B,O)}}else if(arguments.length===4){var ae=arguments[0],se=arguments[1],fe=arguments[2],ke=arguments[3],K=1;fe>ke&&(K=-1);for(var oe=fe;oe!==ke;oe+=K)r.add(ae[oe],se);return!0}},e.prototype.closeRing=function(){this.size()>0&&this.add(new Oe(this.get(0)),!1)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},Object.defineProperties(e,n),e}(vt),kn=function(){},hy={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};hy.ForwardComparator.get=function(){return sm};hy.BidirectionalComparator.get=function(){return Xf};hy.coordArrayType.get=function(){return new Array(0).fill(null)};kn.prototype.interfaces_=function(){return[]};kn.prototype.getClass=function(){return kn};kn.isRing=function(t){return!(t.length<4||!t[0].equals2D(t[t.length-1]))};kn.ptNotInList=function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(kn.indexOf(r,e)<0)return r}return null};kn.scroll=function(t,e){var n=kn.indexOf(e,t);if(n<0)return null;var r=new Array(t.length).fill(null);Fi.arraycopy(t,n,r,0,t.length-n),Fi.arraycopy(t,0,r,t.length-n,n),Fi.arraycopy(r,0,t,0,t.length)};kn.equals=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1];if(t===e)return!0;if(t===null||e===null||t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].equals(e[n]))return!1;return!0}else if(arguments.length===3){var r=arguments[0],i=arguments[1],o=arguments[2];if(r===i)return!0;if(r===null||i===null||r.length!==i.length)return!1;for(var c=0;c<r.length;c++)if(o.compare(r[c],i[c])!==0)return!1;return!0}};kn.intersection=function(t,e){for(var n=new Tm,r=0;r<t.length;r++)e.intersects(t[r])&&n.add(t[r],!0);return n.toCoordinateArray()};kn.hasRepeatedPoints=function(t){for(var e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1};kn.removeRepeatedPoints=function(t){if(!kn.hasRepeatedPoints(t))return t;var e=new Tm(t,!1);return e.toCoordinateArray()};kn.reverse=function(t){for(var e=t.length-1,n=Math.trunc(e/2),r=0;r<=n;r++){var i=t[r];t[r]=t[e-r],t[e-r]=i}};kn.removeNull=function(t){for(var e=0,n=0;n<t.length;n++)t[n]!==null&&e++;var r=new Array(e).fill(null);if(e===0)return r;for(var i=0,o=0;o<t.length;o++)t[o]!==null&&(r[i++]=t[o]);return r};kn.copyDeep=function(){if(arguments.length===1){for(var t=arguments[0],e=new Array(t.length).fill(null),n=0;n<t.length;n++)e[n]=new Oe(t[n]);return e}else if(arguments.length===5)for(var r=arguments[0],i=arguments[1],o=arguments[2],c=arguments[3],l=arguments[4],d=0;d<l;d++)o[c+d]=new Oe(r[i+d])};kn.isEqualReversed=function(t,e){for(var n=0;n<t.length;n++){var r=t[n],i=e[t.length-n-1];if(r.compareTo(i)!==0)return!1}return!0};kn.envelope=function(t){for(var e=new Wt,n=0;n<t.length;n++)e.expandToInclude(t[n]);return e};kn.toCoordinateArray=function(t){return t.toArray(kn.coordArrayType)};kn.atLeastNCoordinatesOrNothing=function(t,e){return e.length>=t?e:[]};kn.indexOf=function(t,e){for(var n=0;n<e.length;n++)if(t.equals(e[n]))return n;return-1};kn.increasingDirection=function(t){for(var e=0;e<Math.trunc(t.length/2);e++){var n=t.length-1-e,r=t[e].compareTo(t[n]);if(r!==0)return r}return 1};kn.compare=function(t,e){for(var n=0;n<t.length&&n<e.length;){var r=t[n].compareTo(e[n]);if(r!==0)return r;n++}return n<e.length?-1:n<t.length?1:0};kn.minCoordinate=function(t){for(var e=null,n=0;n<t.length;n++)(e===null||e.compareTo(t[n])>0)&&(e=t[n]);return e};kn.extract=function(t,e,n){e=ss.clamp(e,0,t.length),n=ss.clamp(n,-1,t.length);var r=n-e+1;n<0&&(r=0),e>=t.length&&(r=0),n<e&&(r=0);var i=new Array(r).fill(null);if(r===0)return i;for(var o=0,c=e;c<=n;c++)i[o++]=t[c];return i};Object.defineProperties(kn,hy);var sm=function(){};sm.prototype.compare=function(t,e){var n=t,r=e;return kn.compare(n,r)};sm.prototype.interfaces_=function(){return[jf]};sm.prototype.getClass=function(){return sm};var Xf=function(){};Xf.prototype.compare=function(t,e){var n=t,r=e;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(n.length===0)return 0;var i=kn.compare(n,r),o=kn.isEqualReversed(n,r);return o?0:i};Xf.prototype.OLDcompare=function(t,e){var n=t,r=e;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(n.length===0)return 0;for(var i=kn.increasingDirection(n),o=kn.increasingDirection(r),c=i>0?0:n.length-1,l=o>0?0:n.length-1,d=0;d<n.length;d++){var y=n[c].compareTo(r[l]);if(y!==0)return y;c+=i,l+=o}return 0};Xf.prototype.interfaces_=function(){return[jf]};Xf.prototype.getClass=function(){return Xf};var _h=function(){};_h.prototype.get=function(){};_h.prototype.put=function(){};_h.prototype.size=function(){};_h.prototype.values=function(){};_h.prototype.entrySet=function(){};var qO=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(_h);function Lm(t){this.message=t||""}Lm.prototype=new Error;Lm.prototype.name="OperationNotSupported";function fy(){}fy.prototype=new ni;fy.prototype.contains=function(){};var $1=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof ni&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contains=function(n){for(var r=this,i=0,o=this.array_.length;i<o;i++){var c=r.array_[i];if(c===n)return!0}return!1},e.prototype.add=function(n){return this.contains(n)?!1:(this.array_.push(n),!0)},e.prototype.addAll=function(n){for(var r=this,i=n.iterator();i.hasNext();)r.add(i.next());return!0},e.prototype.remove=function(n){throw new Error},e.prototype.size=function(){return this.array_.length},e.prototype.isEmpty=function(){return this.array_.length===0},e.prototype.toArray=function(){for(var n=this,r=[],i=0,o=this.array_.length;i<o;i++)r.push(n.array_[i]);return r},e.prototype.iterator=function(){return new WO(this)},e}(fy),WO=function(t){function e(n){t.call(this),this.hashSet_=n,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new bp;return this.hashSet_.array_[this.position_++]},e.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},e.prototype.remove=function(){throw new Lm},e}(vp),El=0,Hu=1;function rS(t){return t===null?El:t.color}function sr(t){return t===null?null:t.parent}function bl(t,e){t!==null&&(t.color=e)}function iv(t){return t===null?null:t.left}function iS(t){return t===null?null:t.right}function Xi(){this.root_=null,this.size_=0}Xi.prototype=new qO;Xi.prototype.get=function(t){for(var e=this.root_;e!==null;){var n=t.compareTo(e.key);if(n<0)e=e.left;else if(n>0)e=e.right;else return e.value}return null};Xi.prototype.put=function(t,e){if(this.root_===null)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:El,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n=this.root_,r,i;do if(r=n,i=t.compareTo(n.key),i<0)n=n.left;else if(i>0)n=n.right;else{var o=n.value;return n.value=e,o}while(n!==null);var c={key:t,left:null,right:null,value:e,parent:r,color:El,getValue:function(){return this.value},getKey:function(){return this.key}};return i<0?r.left=c:r.right=c,this.fixAfterInsertion(c),this.size_++,null};Xi.prototype.fixAfterInsertion=function(t){var e=this;for(t.color=Hu;t!=null&&t!==this.root_&&t.parent.color===Hu;)if(sr(t)===iv(sr(sr(t)))){var n=iS(sr(sr(t)));rS(n)===Hu?(bl(sr(t),El),bl(n,El),bl(sr(sr(t)),Hu),t=sr(sr(t))):(t===iS(sr(t))&&(t=sr(t),e.rotateLeft(t)),bl(sr(t),El),bl(sr(sr(t)),Hu),e.rotateRight(sr(sr(t))))}else{var r=iv(sr(sr(t)));rS(r)===Hu?(bl(sr(t),El),bl(r,El),bl(sr(sr(t)),Hu),t=sr(sr(t))):(t===iv(sr(t))&&(t=sr(t),e.rotateRight(t)),bl(sr(t),El),bl(sr(sr(t)),Hu),e.rotateLeft(sr(sr(t))))}this.root_.color=El};Xi.prototype.values=function(){var t=new vt,e=this.getFirstEntry();if(e!==null)for(t.add(e.value);(e=Xi.successor(e))!==null;)t.add(e.value);return t};Xi.prototype.entrySet=function(){var t=new $1,e=this.getFirstEntry();if(e!==null)for(t.add(e);(e=Xi.successor(e))!==null;)t.add(e);return t};Xi.prototype.rotateLeft=function(t){if(t!=null){var e=t.right;t.right=e.left,e.left!=null&&(e.left.parent=t),e.parent=t.parent,t.parent===null?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}};Xi.prototype.rotateRight=function(t){if(t!=null){var e=t.left;t.left=e.right,e.right!=null&&(e.right.parent=t),e.parent=t.parent,t.parent===null?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}};Xi.prototype.getFirstEntry=function(){var t=this.root_;if(t!=null)for(;t.left!=null;)t=t.left;return t};Xi.successor=function(t){if(t===null)return null;if(t.right!==null){for(var e=t.right;e.left!==null;)e=e.left;return e}else{for(var n=t.parent,r=t;n!==null&&r===n.right;)r=n,n=n.parent;return n}};Xi.prototype.size=function(){return this.size_};var am=function(){};am.prototype.interfaces_=function(){return[]};am.prototype.getClass=function(){return am};function jC(){}jC.prototype=new fy;function Ea(){this.array_=[],arguments[0]instanceof ni&&this.addAll(arguments[0])}Ea.prototype=new jC;Ea.prototype.contains=function(t){for(var e=this,n=0,r=this.array_.length;n<r;n++){var i=e.array_[n];if(i.compareTo(t)===0)return!0}return!1};Ea.prototype.add=function(t){var e=this;if(this.contains(t))return!1;for(var n=0,r=this.array_.length;n<r;n++){var i=e.array_[n];if(i.compareTo(t)===1)return e.array_.splice(n,0,t),!0}return this.array_.push(t),!0};Ea.prototype.addAll=function(t){for(var e=this,n=t.iterator();n.hasNext();)e.add(n.next());return!0};Ea.prototype.remove=function(t){throw new Lm};Ea.prototype.size=function(){return this.array_.length};Ea.prototype.isEmpty=function(){return this.array_.length===0};Ea.prototype.toArray=function(){for(var t=this,e=[],n=0,r=this.array_.length;n<r;n++)e.push(t.array_[n]);return e};Ea.prototype.iterator=function(){return new py(this)};var py=function(t){this.treeSet_=t,this.position_=0};py.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new bp;return this.treeSet_.array_[this.position_++]};py.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};py.prototype.remove=function(){throw new Lm};var ec=function(){};ec.sort=function(){var t=arguments[0],e,n,r,i;if(arguments.length===1)i=function(c,l){return c.compareTo(l)},t.sort(i);else if(arguments.length===2)r=arguments[1],i=function(c,l){return r.compare(c,l)},t.sort(i);else if(arguments.length===3){n=t.slice(arguments[1],arguments[2]),n.sort();var o=t.slice(0,arguments[1]).concat(n,t.slice(arguments[2],t.length));for(t.splice(0,t.length),e=0;e<o.length;e++)t.push(o[e])}else if(arguments.length===4)for(n=t.slice(arguments[1],arguments[2]),r=arguments[3],i=function(c,l){return r.compare(c,l)},n.sort(i),o=t.slice(0,arguments[1]).concat(n,t.slice(arguments[2],t.length)),t.splice(0,t.length),e=0;e<o.length;e++)t.push(o[e])};ec.asList=function(t){for(var e=new vt,n=0,r=t.length;n<r;n++)e.add(t[n]);return e};var jn=function(){},Ks={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Ks.P.get=function(){return 0};Ks.L.get=function(){return 1};Ks.A.get=function(){return 2};Ks.FALSE.get=function(){return-1};Ks.TRUE.get=function(){return-2};Ks.DONTCARE.get=function(){return-3};Ks.SYM_FALSE.get=function(){return"F"};Ks.SYM_TRUE.get=function(){return"T"};Ks.SYM_DONTCARE.get=function(){return"*"};Ks.SYM_P.get=function(){return"0"};Ks.SYM_L.get=function(){return"1"};Ks.SYM_A.get=function(){return"2"};jn.prototype.interfaces_=function(){return[]};jn.prototype.getClass=function(){return jn};jn.toDimensionSymbol=function(t){switch(t){case jn.FALSE:return jn.SYM_FALSE;case jn.TRUE:return jn.SYM_TRUE;case jn.DONTCARE:return jn.SYM_DONTCARE;case jn.P:return jn.SYM_P;case jn.L:return jn.SYM_L;case jn.A:return jn.SYM_A}throw new wr("Unknown dimension value: "+t)};jn.toDimensionValue=function(t){switch(om.toUpperCase(t)){case jn.SYM_FALSE:return jn.FALSE;case jn.SYM_TRUE:return jn.TRUE;case jn.SYM_DONTCARE:return jn.DONTCARE;case jn.SYM_P:return jn.P;case jn.SYM_L:return jn.L;case jn.SYM_A:return jn.A}throw new wr("Unknown dimension symbol: "+t)};Object.defineProperties(jn,Ks);var Ia=function(){};Ia.prototype.filter=function(t){};Ia.prototype.interfaces_=function(){return[]};Ia.prototype.getClass=function(){return Ia};var qs=function(){};qs.prototype.filter=function(t,e){};qs.prototype.isDone=function(){};qs.prototype.isGeometryChanged=function(){};qs.prototype.interfaces_=function(){return[]};qs.prototype.getClass=function(){return qs};var lo=function(t){function e(r,i){if(t.call(this,i),this._geometries=r||[],t.hasNullElements(this._geometries))throw new wr("geometries must not contain null elements")}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){for(var r=this,i=new Wt,o=0;o<this._geometries.length;o++)i.expandToInclude(r._geometries[o].getEnvelopeInternal());return i},e.prototype.getGeometryN=function(r){return this._geometries[r]},e.prototype.getSortIndex=function(){return t.SORTINDEX_GEOMETRYCOLLECTION},e.prototype.getCoordinates=function(){for(var r=this,i=new Array(this.getNumPoints()).fill(null),o=-1,c=0;c<this._geometries.length;c++)for(var l=r._geometries[c].getCoordinates(),d=0;d<l.length;d++)o++,i[o]=l[d];return i},e.prototype.getArea=function(){for(var r=this,i=0,o=0;o<this._geometries.length;o++)i+=r._geometries[o].getArea();return i},e.prototype.equalsExact=function(){var r=this;if(arguments.length===2){var i=arguments[0],o=arguments[1];if(!this.isEquivalentClass(i))return!1;var c=i;if(this._geometries.length!==c._geometries.length)return!1;for(var l=0;l<this._geometries.length;l++)if(!r._geometries[l].equalsExact(c._geometries[l],o))return!1;return!0}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var r=this,i=0;i<this._geometries.length;i++)r._geometries[i].normalize();ec.sort(this._geometries)},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},e.prototype.getBoundaryDimension=function(){for(var r=this,i=jn.FALSE,o=0;o<this._geometries.length;o++)i=Math.max(i,r._geometries[o].getBoundaryDimension());return i},e.prototype.getDimension=function(){for(var r=this,i=jn.FALSE,o=0;o<this._geometries.length;o++)i=Math.max(i,r._geometries[o].getDimension());return i},e.prototype.getLength=function(){for(var r=this,i=0,o=0;o<this._geometries.length;o++)i+=r._geometries[o].getLength();return i},e.prototype.getNumPoints=function(){for(var r=this,i=0,o=0;o<this._geometries.length;o++)i+=r._geometries[o].getNumPoints();return i},e.prototype.getNumGeometries=function(){return this._geometries.length},e.prototype.reverse=function(){for(var r=this,i=this._geometries.length,o=new Array(i).fill(null),c=0;c<this._geometries.length;c++)o[c]=r._geometries[c].reverse();return this.getFactory().createGeometryCollection(o)},e.prototype.compareToSameClass=function(){var r=this;if(arguments.length===1){var i=arguments[0],o=new Ea(ec.asList(this._geometries)),c=new Ea(ec.asList(i._geometries));return this.compare(o,c)}else if(arguments.length===2){for(var l=arguments[0],d=arguments[1],y=l,S=this.getNumGeometries(),E=y.getNumGeometries(),C=0;C<S&&C<E;){var A=r.getGeometryN(C),M=y.getGeometryN(C),R=A.compareToSameClass(M,d);if(R!==0)return R;C++}return C<S?1:C<E?-1:0}},e.prototype.apply=function(){var r=this;if(rn(arguments[0],Ka))for(var i=arguments[0],o=0;o<this._geometries.length;o++)r._geometries[o].apply(i);else if(rn(arguments[0],qs)){var c=arguments[0];if(this._geometries.length===0)return null;for(var l=0;l<this._geometries.length&&(r._geometries[l].apply(c),!c.isDone());l++);c.isGeometryChanged()&&this.geometryChanged()}else if(rn(arguments[0],Ia)){var d=arguments[0];d.filter(this);for(var y=0;y<this._geometries.length;y++)r._geometries[y].apply(d)}else if(rn(arguments[0],Al)){var S=arguments[0];S.filter(this);for(var E=0;E<this._geometries.length;E++)r._geometries[E].apply(S)}},e.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),yn.shouldNeverReachHere(),null},e.prototype.clone=function(){var r=this,i=t.prototype.clone.call(this);i._geometries=new Array(this._geometries.length).fill(null);for(var o=0;o<this._geometries.length;o++)i._geometries[o]=r._geometries[o].clone();return i},e.prototype.getGeometryType=function(){return"GeometryCollection"},e.prototype.copy=function(){for(var r=this,i=new Array(this._geometries.length).fill(null),o=0;o<i.length;o++)i[o]=r._geometries[o].copy();return new e(i,this._factory)},e.prototype.isEmpty=function(){for(var r=this,i=0;i<this._geometries.length;i++)if(!r._geometries[i].isEmpty())return!1;return!0},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(e,n),e}(nn),ic=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return nn.SORTINDEX_MULTILINESTRING},e.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.isEquivalentClass(r)?t.prototype.equalsExact.call(this,r,i):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?jn.FALSE:0},e.prototype.isClosed=function(){var r=this;if(this.isEmpty())return!1;for(var i=0;i<this._geometries.length;i++)if(!r._geometries[i].isClosed())return!1;return!0},e.prototype.getDimension=function(){return 1},e.prototype.reverse=function(){for(var r=this,i=this._geometries.length,o=new Array(i).fill(null),c=0;c<this._geometries.length;c++)o[i-1-c]=r._geometries[c].reverse();return this.getFactory().createMultiLineString(o)},e.prototype.getBoundary=function(){return new bs(this).getBoundary()},e.prototype.getGeometryType=function(){return"MultiLineString"},e.prototype.copy=function(){for(var r=this,i=new Array(this._geometries.length).fill(null),o=0;o<i.length;o++)i[o]=r._geometries[o].copy();return new e(i,this._factory)},e.prototype.interfaces_=function(){return[am]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(e,n),e}(lo),bs=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var t=arguments[0],e=Ss.MOD2_BOUNDARY_RULE;this._geom=t,this._geomFact=t.getFactory(),this._bnRule=e}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this._geom=n,this._geomFact=n.getFactory(),this._bnRule=r}};bs.prototype.boundaryMultiLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var e=this.computeBoundaryCoordinates(t);return e.length===1?this._geomFact.createPoint(e[0]):this._geomFact.createMultiPointFromCoords(e)};bs.prototype.getBoundary=function(){return this._geom instanceof Rr?this.boundaryLineString(this._geom):this._geom instanceof ic?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};bs.prototype.boundaryLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(t.isClosed()){var e=this._bnRule.isInBoundary(2);return e?t.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([t.getStartPoint(),t.getEndPoint()])};bs.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};bs.prototype.computeBoundaryCoordinates=function(t){var e=this,n=new vt;this._endpointMap=new Xi;for(var r=0;r<t.getNumGeometries();r++){var i=t.getGeometryN(r);i.getNumPoints()!==0&&(e.addEndpoint(i.getCoordinateN(0)),e.addEndpoint(i.getCoordinateN(i.getNumPoints()-1)))}for(var o=this._endpointMap.entrySet().iterator();o.hasNext();){var c=o.next(),l=c.getValue(),d=l.count;e._bnRule.isInBoundary(d)&&n.add(c.getKey())}return kn.toCoordinateArray(n)};bs.prototype.addEndpoint=function(t){var e=this._endpointMap.get(t);e===null&&(e=new B_,this._endpointMap.put(t,e)),e.count++};bs.prototype.interfaces_=function(){return[]};bs.prototype.getClass=function(){return bs};bs.getBoundary=function(){if(arguments.length===1){var t=arguments[0],e=new bs(t);return e.getBoundary()}else if(arguments.length===2){var n=arguments[0],r=arguments[1],i=new bs(n,r);return i.getBoundary()}};var B_=function(){this.count=null};B_.prototype.interfaces_=function(){return[]};B_.prototype.getClass=function(){return B_};function HO(){}function ZO(){}var XO=function(){};function YO(){}function $O(){}function KO(){}var xs=function(){},K1={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};xs.prototype.interfaces_=function(){return[]};xs.prototype.getClass=function(){return xs};xs.chars=function(t,e){for(var n=new Array(e).fill(null),r=0;r<e;r++)n[r]=t;return String(n)};xs.getStackTrace=function(){if(arguments.length===1){var t=arguments[0],e=new YO,n=new HO;return t.printStackTrace(n),e.toString()}else if(arguments.length===2){var r=arguments[0],i=arguments[1],o="";new ZO(xs.getStackTrace(r));for(var c=new KO,l=0;l<i;l++)try{o+=c.readLine()+xs.NEWLINE}catch(d){if(d instanceof $O)yn.shouldNeverReachHere();else throw d}finally{}return o}};xs.split=function(t,e){for(var n=e.length,r=new vt,i=""+t,o=i.indexOf(e);o>=0;){var c=i.substring(0,o);r.add(c),i=i.substring(o+n),o=i.indexOf(e)}i.length>0&&r.add(i);for(var l=new Array(r.size()).fill(null),d=0;d<l.length;d++)l[d]=r.get(d);return l};xs.toString=function(){if(arguments.length===1){var t=arguments[0];return xs.SIMPLE_ORDINATE_FORMAT.format(t)}};xs.spaces=function(t){return xs.chars(" ",t)};K1.NEWLINE.get=function(){return Fi.getProperty("line.separator")};K1.SIMPLE_ORDINATE_FORMAT.get=function(){return new XO};Object.defineProperties(xs,K1);var qr=function(){};qr.prototype.interfaces_=function(){return[]};qr.prototype.getClass=function(){return qr};qr.copyCoord=function(t,e,n,r){for(var i=Math.min(t.getDimension(),n.getDimension()),o=0;o<i;o++)n.setOrdinate(r,o,t.getOrdinate(e,o))};qr.isRing=function(t){var e=t.size();return e===0?!0:e<=3?!1:t.getOrdinate(0,Vn.X)===t.getOrdinate(e-1,Vn.X)&&t.getOrdinate(0,Vn.Y)===t.getOrdinate(e-1,Vn.Y)};qr.isEqual=function(t,e){var n=t.size(),r=e.size();if(n!==r)return!1;for(var i=Math.min(t.getDimension(),e.getDimension()),o=0;o<n;o++)for(var c=0;c<i;c++){var l=t.getOrdinate(o,c),d=e.getOrdinate(o,c);if(t.getOrdinate(o,c)!==e.getOrdinate(o,c)&&!(cn.isNaN(l)&&cn.isNaN(d)))return!1}return!0};qr.extend=function(t,e,n){var r=t.create(n,e.getDimension()),i=e.size();if(qr.copy(e,0,r,0,i),i>0)for(var o=i;o<n;o++)qr.copy(e,i-1,r,o,1);return r};qr.reverse=function(t){for(var e=t.size()-1,n=Math.trunc(e/2),r=0;r<=n;r++)qr.swap(t,r,e-r)};qr.swap=function(t,e,n){if(e===n)return null;for(var r=0;r<t.getDimension();r++){var i=t.getOrdinate(e,r);t.setOrdinate(e,r,t.getOrdinate(n,r)),t.setOrdinate(n,r,i)}};qr.copy=function(t,e,n,r,i){for(var o=0;o<i;o++)qr.copyCoord(t,e+o,n,r+o)};qr.toString=function(){if(arguments.length===1){var t=arguments[0],e=t.size();if(e===0)return"()";var n=t.getDimension(),r=new Na;r.append("(");for(var i=0;i<e;i++){i>0&&r.append(" ");for(var o=0;o<n;o++)o>0&&r.append(","),r.append(xs.toString(t.getOrdinate(i,o)))}return r.append(")"),r.toString()}};qr.ensureValidRing=function(t,e){var n=e.size();if(n===0)return e;if(n<=3)return qr.createClosedRing(t,e,4);var r=e.getOrdinate(0,Vn.X)===e.getOrdinate(n-1,Vn.X)&&e.getOrdinate(0,Vn.Y)===e.getOrdinate(n-1,Vn.Y);return r?e:qr.createClosedRing(t,e,n+1)};qr.createClosedRing=function(t,e,n){var r=t.create(n,e.getDimension()),i=e.size();qr.copy(e,0,r,0,i);for(var o=i;o<n;o++)qr.copy(e,0,r,o,1);return r};var Rr=function(t){function e(r,i){t.call(this,i),this._points=null,this.init(r)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new Wt:this._points.expandEnvelope(new Wt)},e.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},e.prototype.getSortIndex=function(){return t.SORTINDEX_LINESTRING},e.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},e.prototype.equalsExact=function(){var r=this;if(arguments.length===2){var i=arguments[0],o=arguments[1];if(!this.isEquivalentClass(i))return!1;var c=i;if(this._points.size()!==c._points.size())return!1;for(var l=0;l<this._points.size();l++)if(!r.equal(r._points.getCoordinate(l),c._points.getCoordinate(l),o))return!1;return!0}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var r=this,i=0;i<Math.trunc(this._points.size()/2);i++){var o=r._points.size()-1-i;if(!r._points.getCoordinate(i).equals(r._points.getCoordinate(o)))return r._points.getCoordinate(i).compareTo(r._points.getCoordinate(o))>0&&qr.reverse(r._points),null}},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?jn.FALSE:0},e.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},e.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},e.prototype.getDimension=function(){return 1},e.prototype.getLength=function(){return Tt.computeLength(this._points)},e.prototype.getNumPoints=function(){return this._points.size()},e.prototype.reverse=function(){var r=this._points.copy();qr.reverse(r);var i=this.getFactory().createLineString(r);return i},e.prototype.compareToSameClass=function(){var r=this;if(arguments.length===1){for(var i=arguments[0],o=i,c=0,l=0;c<this._points.size()&&l<o._points.size();){var d=r._points.getCoordinate(c).compareTo(o._points.getCoordinate(l));if(d!==0)return d;c++,l++}return c<this._points.size()?1:l<o._points.size()?-1:0}else if(arguments.length===2){var y=arguments[0],S=arguments[1],E=y;return S.compare(this._points,E._points)}},e.prototype.apply=function(){var r=this;if(rn(arguments[0],Ka))for(var i=arguments[0],o=0;o<this._points.size();o++)i.filter(r._points.getCoordinate(o));else if(rn(arguments[0],qs)){var c=arguments[0];if(this._points.size()===0)return null;for(var l=0;l<this._points.size()&&(c.filter(r._points,l),!c.isDone());l++);c.isGeometryChanged()&&this.geometryChanged()}else if(rn(arguments[0],Ia)){var d=arguments[0];d.filter(this)}else if(rn(arguments[0],Al)){var y=arguments[0];y.filter(this)}},e.prototype.getBoundary=function(){return new bs(this).getBoundary()},e.prototype.isEquivalentClass=function(r){return r instanceof e},e.prototype.clone=function(){var r=t.prototype.clone.call(this);return r._points=this._points.clone(),r},e.prototype.getCoordinateN=function(r){return this._points.getCoordinate(r)},e.prototype.getGeometryType=function(){return"LineString"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._points},e.prototype.isEmpty=function(){return this._points.size()===0},e.prototype.init=function(r){if(r===null&&(r=this.getFactory().getCoordinateSequenceFactory().create([])),r.size()===1)throw new wr("Invalid number of points in LineString (found "+r.size()+" - must be 0 or >= 2)");this._points=r},e.prototype.isCoordinate=function(r){for(var i=this,o=0;o<this._points.size();o++)if(i._points.getCoordinate(o).equals(r))return!0;return!1},e.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},e.prototype.getPointN=function(r){return this.getFactory().createPoint(this._points.getCoordinate(r))},e.prototype.interfaces_=function(){return[am]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(e,n),e}(nn),lm=function(){};lm.prototype.interfaces_=function(){return[]};lm.prototype.getClass=function(){return lm};var Uo=function(t){function e(r,i){t.call(this,i),this._coordinates=r||null,this.init(this._coordinates)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new Wt;var r=new Wt;return r.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),r},e.prototype.getSortIndex=function(){return t.SORTINDEX_POINT},e.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},e.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.isEquivalentClass(r)?this.isEmpty()&&r.isEmpty()?!0:this.isEmpty()!==r.isEmpty()?!1:this.equal(r.getCoordinate(),this.getCoordinate(),i):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){},e.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},e.prototype.getBoundaryDimension=function(){return jn.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getNumPoints=function(){return this.isEmpty()?0:1},e.prototype.reverse=function(){return this.copy()},e.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},e.prototype.compareToSameClass=function(){if(arguments.length===1){var r=arguments[0],i=r;return this.getCoordinate().compareTo(i.getCoordinate())}else if(arguments.length===2){var o=arguments[0],c=arguments[1],l=o;return c.compare(this._coordinates,l._coordinates)}},e.prototype.apply=function(){if(rn(arguments[0],Ka)){var r=arguments[0];if(this.isEmpty())return null;r.filter(this.getCoordinate())}else if(rn(arguments[0],qs)){var i=arguments[0];if(this.isEmpty())return null;i.filter(this._coordinates,0),i.isGeometryChanged()&&this.geometryChanged()}else if(rn(arguments[0],Ia)){var o=arguments[0];o.filter(this)}else if(rn(arguments[0],Al)){var c=arguments[0];c.filter(this)}},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.clone=function(){var r=t.prototype.clone.call(this);return r._coordinates=this._coordinates.clone(),r},e.prototype.getGeometryType=function(){return"Point"},e.prototype.copy=function(){return new e(this._coordinates.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._coordinates},e.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},e.prototype.isEmpty=function(){return this._coordinates.size()===0},e.prototype.init=function(r){r===null&&(r=this.getFactory().getCoordinateSequenceFactory().create([])),yn.isTrue(r.size()<=1),this._coordinates=r},e.prototype.isSimple=function(){return!0},e.prototype.interfaces_=function(){return[lm]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(e,n),e}(nn),mu=function(){};mu.prototype.interfaces_=function(){return[]};mu.prototype.getClass=function(){return mu};var ai=function(t){function e(r,i,o){if(t.call(this,o),this._shell=null,this._holes=null,r===null&&(r=this.getFactory().createLinearRing()),i===null&&(i=[]),t.hasNullElements(i))throw new wr("holes must not contain null elements");if(r.isEmpty()&&t.hasNonEmptyElements(i))throw new wr("shell is empty but holes are not");this._shell=r,this._holes=i}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},e.prototype.getSortIndex=function(){return t.SORTINDEX_POLYGON},e.prototype.getCoordinates=function(){var r=this;if(this.isEmpty())return[];for(var i=new Array(this.getNumPoints()).fill(null),o=-1,c=this._shell.getCoordinates(),l=0;l<c.length;l++)o++,i[o]=c[l];for(var d=0;d<this._holes.length;d++)for(var y=r._holes[d].getCoordinates(),S=0;S<y.length;S++)o++,i[o]=y[S];return i},e.prototype.getArea=function(){var r=this,i=0;i+=Math.abs(Tt.signedArea(this._shell.getCoordinateSequence()));for(var o=0;o<this._holes.length;o++)i-=Math.abs(Tt.signedArea(r._holes[o].getCoordinateSequence()));return i},e.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var r=this._shell.getCoordinateSequence(),i=this.getEnvelopeInternal(),o=0;o<5;o++){var c=r.getX(o);if(!(c===i.getMinX()||c===i.getMaxX()))return!1;var l=r.getY(o);if(!(l===i.getMinY()||l===i.getMaxY()))return!1}for(var d=r.getX(0),y=r.getY(0),S=1;S<=4;S++){var E=r.getX(S),C=r.getY(S),A=E!==d,M=C!==y;if(A===M)return!1;d=E,y=C}return!0},e.prototype.equalsExact=function(){var r=this;if(arguments.length===2){var i=arguments[0],o=arguments[1];if(!this.isEquivalentClass(i))return!1;var c=i,l=this._shell,d=c._shell;if(!l.equalsExact(d,o)||this._holes.length!==c._holes.length)return!1;for(var y=0;y<this._holes.length;y++)if(!r._holes[y].equalsExact(c._holes[y],o))return!1;return!0}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){var r=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var i=0;i<this._holes.length;i++)r.normalize(r._holes[i],!1);ec.sort(this._holes)}else if(arguments.length===2){var o=arguments[0],c=arguments[1];if(o.isEmpty())return null;var l=new Array(o.getCoordinates().length-1).fill(null);Fi.arraycopy(o.getCoordinates(),0,l,0,l.length);var d=kn.minCoordinate(o.getCoordinates());kn.scroll(l,d),Fi.arraycopy(l,0,o.getCoordinates(),0,l.length),o.getCoordinates()[l.length]=l[0],Tt.isCCW(o.getCoordinates())===c&&kn.reverse(o.getCoordinates())}},e.prototype.getCoordinate=function(){return this._shell.getCoordinate()},e.prototype.getNumInteriorRing=function(){return this._holes.length},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.getLength=function(){var r=this,i=0;i+=this._shell.getLength();for(var o=0;o<this._holes.length;o++)i+=r._holes[o].getLength();return i},e.prototype.getNumPoints=function(){for(var r=this,i=this._shell.getNumPoints(),o=0;o<this._holes.length;o++)i+=r._holes[o].getNumPoints();return i},e.prototype.reverse=function(){var r=this,i=this.copy();i._shell=this._shell.copy().reverse(),i._holes=new Array(this._holes.length).fill(null);for(var o=0;o<this._holes.length;o++)i._holes[o]=r._holes[o].copy().reverse();return i},e.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},e.prototype.compareToSameClass=function(){var r=this;if(arguments.length===1){var i=arguments[0],o=this._shell,c=i._shell;return o.compareToSameClass(c)}else if(arguments.length===2){var l=arguments[0],d=arguments[1],y=l,S=this._shell,E=y._shell,C=S.compareToSameClass(E,d);if(C!==0)return C;for(var A=this.getNumInteriorRing(),M=y.getNumInteriorRing(),R=0;R<A&&R<M;){var N=r.getInteriorRingN(R),B=y.getInteriorRingN(R),O=N.compareToSameClass(B,d);if(O!==0)return O;R++}return R<A?1:R<M?-1:0}},e.prototype.apply=function(r){var i=this;if(rn(r,Ka)){this._shell.apply(r);for(var o=0;o<this._holes.length;o++)i._holes[o].apply(r)}else if(rn(r,qs)){if(this._shell.apply(r),!r.isDone())for(var c=0;c<this._holes.length&&(i._holes[c].apply(r),!r.isDone());c++);r.isGeometryChanged()&&this.geometryChanged()}else if(rn(r,Ia))r.filter(this);else if(rn(r,Al)){r.filter(this),this._shell.apply(r);for(var l=0;l<this._holes.length;l++)i._holes[l].apply(r)}},e.prototype.getBoundary=function(){var r=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var i=new Array(this._holes.length+1).fill(null);i[0]=this._shell;for(var o=0;o<this._holes.length;o++)i[o+1]=r._holes[o];return i.length<=1?this.getFactory().createLinearRing(i[0].getCoordinateSequence()):this.getFactory().createMultiLineString(i)},e.prototype.clone=function(){var r=this,i=t.prototype.clone.call(this);i._shell=this._shell.clone(),i._holes=new Array(this._holes.length).fill(null);for(var o=0;o<this._holes.length;o++)i._holes[o]=r._holes[o].clone();return i},e.prototype.getGeometryType=function(){return"Polygon"},e.prototype.copy=function(){for(var r=this,i=this._shell.copy(),o=new Array(this._holes.length).fill(null),c=0;c<o.length;c++)o[c]=r._holes[c].copy();return new e(i,o,this._factory)},e.prototype.getExteriorRing=function(){return this._shell},e.prototype.isEmpty=function(){return this._shell.isEmpty()},e.prototype.getInteriorRingN=function(r){return this._holes[r]},e.prototype.interfaces_=function(){return[mu]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(e,n),e}(nn),Yf=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return nn.SORTINDEX_MULTIPOINT},e.prototype.isValid=function(){return!0},e.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.isEquivalentClass(r)?t.prototype.equalsExact.call(this,r,i):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getCoordinate=function(){if(arguments.length===1){var r=arguments[0];return this._geometries[r].getCoordinate()}else return t.prototype.getCoordinate.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return jn.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.getGeometryType=function(){return"MultiPoint"},e.prototype.copy=function(){for(var r=this,i=new Array(this._geometries.length).fill(null),o=0;o<i.length;o++)i[o]=r._geometries[o].copy();return new e(i,this._factory)},e.prototype.interfaces_=function(){return[lm]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(e,n),e}(lo),Ja=function(t){function e(r,i){r instanceof Oe&&i instanceof Mn&&(r=i.getCoordinateSequenceFactory().create(r)),t.call(this,r,i),this.validateConstruction()}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return nn.SORTINDEX_LINEARRING},e.prototype.getBoundaryDimension=function(){return jn.FALSE},e.prototype.isClosed=function(){return this.isEmpty()?!0:t.prototype.isClosed.call(this)},e.prototype.reverse=function(){var r=this._points.copy();qr.reverse(r);var i=this.getFactory().createLinearRing(r);return i},e.prototype.validateConstruction=function(){if(!this.isEmpty()&&!t.prototype.isClosed.call(this))throw new wr("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new wr("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},e.prototype.getGeometryType=function(){return"LinearRing"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(e,n),e}(Rr),Ya=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return nn.SORTINDEX_MULTIPOLYGON},e.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.isEquivalentClass(r)?t.prototype.equalsExact.call(this,r,i):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.reverse=function(){for(var r=this,i=this._geometries.length,o=new Array(i).fill(null),c=0;c<this._geometries.length;c++)o[c]=r._geometries[c].reverse();return this.getFactory().createMultiPolygon(o)},e.prototype.getBoundary=function(){var r=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var i=new vt,o=0;o<this._geometries.length;o++)for(var c=r._geometries[o],l=c.getBoundary(),d=0;d<l.getNumGeometries();d++)i.add(l.getGeometryN(d));var y=new Array(i.size()).fill(null);return this.getFactory().createMultiLineString(i.toArray(y))},e.prototype.getGeometryType=function(){return"MultiPolygon"},e.prototype.copy=function(){for(var r=this,i=new Array(this._geometries.length).fill(null),o=0;o<i.length;o++)i[o]=r._geometries[o].copy();return new e(i,this._factory)},e.prototype.interfaces_=function(){return[mu]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(e,n),e}(lo),Es=function(t){this._factory=t||null,this._isUserDataCopied=!1},dy={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};Es.prototype.setCopyUserData=function(t){this._isUserDataCopied=t};Es.prototype.edit=function(t,e){if(t===null)return null;var n=this.editInternal(t,e);return this._isUserDataCopied&&n.setUserData(t.getUserData()),n};Es.prototype.editInternal=function(t,e){return this._factory===null&&(this._factory=t.getFactory()),t instanceof lo?this.editGeometryCollection(t,e):t instanceof ai?this.editPolygon(t,e):t instanceof Uo?e.edit(t,this._factory):t instanceof Rr?e.edit(t,this._factory):(yn.shouldNeverReachHere("Unsupported Geometry class: "+t.getClass().getName()),null)};Es.prototype.editGeometryCollection=function(t,e){for(var n=this,r=e.edit(t,this._factory),i=new vt,o=0;o<r.getNumGeometries();o++){var c=n.edit(r.getGeometryN(o),e);c===null||c.isEmpty()||i.add(c)}return r.getClass()===Yf?this._factory.createMultiPoint(i.toArray([])):r.getClass()===ic?this._factory.createMultiLineString(i.toArray([])):r.getClass()===Ya?this._factory.createMultiPolygon(i.toArray([])):this._factory.createGeometryCollection(i.toArray([]))};Es.prototype.editPolygon=function(t,e){var n=this,r=e.edit(t,this._factory);if(r===null&&(r=this._factory.createPolygon(null)),r.isEmpty())return r;var i=this.edit(r.getExteriorRing(),e);if(i===null||i.isEmpty())return this._factory.createPolygon();for(var o=new vt,c=0;c<r.getNumInteriorRing();c++){var l=n.edit(r.getInteriorRingN(c),e);l===null||l.isEmpty()||o.add(l)}return this._factory.createPolygon(i,o.toArray([]))};Es.prototype.interfaces_=function(){return[]};Es.prototype.getClass=function(){return Es};Es.GeometryEditorOperation=function(){};dy.NoOpGeometryOperation.get=function(){return um};dy.CoordinateOperation.get=function(){return cm};dy.CoordinateSequenceOperation.get=function(){return hm};Object.defineProperties(Es,dy);var um=function(){};um.prototype.edit=function(t,e){return t};um.prototype.interfaces_=function(){return[Es.GeometryEditorOperation]};um.prototype.getClass=function(){return um};var cm=function(){};cm.prototype.edit=function(t,e){var n=this.editCoordinates(t.getCoordinates(),t);return n===null?t:t instanceof Ja?e.createLinearRing(n):t instanceof Rr?e.createLineString(n):t instanceof Uo?n.length>0?e.createPoint(n[0]):e.createPoint():t};cm.prototype.interfaces_=function(){return[Es.GeometryEditorOperation]};cm.prototype.getClass=function(){return cm};var hm=function(){};hm.prototype.edit=function(t,e){return t instanceof Ja?e.createLinearRing(this.edit(t.getCoordinateSequence(),t)):t instanceof Rr?e.createLineString(this.edit(t.getCoordinateSequence(),t)):t instanceof Uo?e.createPoint(this.edit(t.getCoordinateSequence(),t)):t};hm.prototype.interfaces_=function(){return[Es.GeometryEditorOperation]};hm.prototype.getClass=function(){return hm};var Ur=function(){var t=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var e=arguments[0];this._coordinates=new Array(e).fill(null);for(var n=0;n<e;n++)t._coordinates[n]=new Oe}else if(rn(arguments[0],Vn)){var r=arguments[0];if(r===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=r.getDimension(),this._coordinates=new Array(r.size()).fill(null);for(var i=0;i<this._coordinates.length;i++)t._coordinates[i]=r.getCoordinateCopy(i)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var o=arguments[0],c=arguments[1];this._coordinates=o,this._dimension=c,o===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var l=arguments[0],d=arguments[1];this._coordinates=new Array(l).fill(null),this._dimension=d;for(var y=0;y<l;y++)t._coordinates[y]=new Oe}}},GC={serialVersionUID:{configurable:!0}};Ur.prototype.setOrdinate=function(t,e,n){switch(e){case Vn.X:this._coordinates[t].x=n;break;case Vn.Y:this._coordinates[t].y=n;break;case Vn.Z:this._coordinates[t].z=n;break;default:throw new wr("invalid ordinateIndex")}};Ur.prototype.size=function(){return this._coordinates.length};Ur.prototype.getOrdinate=function(t,e){switch(e){case Vn.X:return this._coordinates[t].x;case Vn.Y:return this._coordinates[t].y;case Vn.Z:return this._coordinates[t].z}return cn.NaN};Ur.prototype.getCoordinate=function(){if(arguments.length===1){var t=arguments[0];return this._coordinates[t]}else if(arguments.length===2){var e=arguments[0],n=arguments[1];n.x=this._coordinates[e].x,n.y=this._coordinates[e].y,n.z=this._coordinates[e].z}};Ur.prototype.getCoordinateCopy=function(t){return new Oe(this._coordinates[t])};Ur.prototype.getDimension=function(){return this._dimension};Ur.prototype.getX=function(t){return this._coordinates[t].x};Ur.prototype.clone=function(){for(var t=this,e=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)e[n]=t._coordinates[n].clone();return new Ur(e,this._dimension)};Ur.prototype.expandEnvelope=function(t){for(var e=this,n=0;n<this._coordinates.length;n++)t.expandToInclude(e._coordinates[n]);return t};Ur.prototype.copy=function(){for(var t=this,e=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)e[n]=t._coordinates[n].copy();return new Ur(e,this._dimension)};Ur.prototype.toString=function(){var t=this;if(this._coordinates.length>0){var e=new Na(17*this._coordinates.length);e.append("("),e.append(this._coordinates[0]);for(var n=1;n<this._coordinates.length;n++)e.append(", "),e.append(t._coordinates[n]);return e.append(")"),e.toString()}else return"()"};Ur.prototype.getY=function(t){return this._coordinates[t].y};Ur.prototype.toCoordinateArray=function(){return this._coordinates};Ur.prototype.interfaces_=function(){return[Vn,Ts]};Ur.prototype.getClass=function(){return Ur};GC.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties(Ur,GC);var Qa=function(){},J1={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};Qa.prototype.readResolve=function(){return Qa.instance()};Qa.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return new Ur(t)}else if(rn(arguments[0],Vn)){var e=arguments[0];return new Ur(e)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return r>3&&(r=3),r<2?new Ur(n):new Ur(n,r)}};Qa.prototype.interfaces_=function(){return[Gf,Ts]};Qa.prototype.getClass=function(){return Qa};Qa.instance=function(){return Qa.instanceObject};J1.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};J1.instanceObject.get=function(){return new Qa};Object.defineProperties(Qa,J1);var qC=function(t){function e(){t.call(this),this.map_=new Map}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(n){return this.map_.get(n)||null},e.prototype.put=function(n,r){return this.map_.set(n,r),r},e.prototype.values=function(){for(var n=new vt,r=this.map_.values(),i=r.next();!i.done;)n.add(i.value),i=r.next();return n},e.prototype.entrySet=function(){var n=new $1;return this.map_.entries().forEach(function(r){return n.add(r)}),n},e.prototype.size=function(){return this.map_.size()},e}(_h),Wn=function t(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=t.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof Ca){var e=arguments[0];this._modelType=e,e===t.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var n=arguments[0];this._modelType=t.FIXED,this.setScale(n)}else if(arguments[0]instanceof t){var r=arguments[0];this._modelType=r._modelType,this._scale=r._scale}}},Q1={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};Wn.prototype.equals=function(t){if(!(t instanceof Wn))return!1;var e=t;return this._modelType===e._modelType&&this._scale===e._scale};Wn.prototype.compareTo=function(t){var e=t,n=this.getMaximumSignificantDigits(),r=e.getMaximumSignificantDigits();return new Sa(n).compareTo(new Sa(r))};Wn.prototype.getScale=function(){return this._scale};Wn.prototype.isFloating=function(){return this._modelType===Wn.FLOATING||this._modelType===Wn.FLOATING_SINGLE};Wn.prototype.getType=function(){return this._modelType};Wn.prototype.toString=function(){var t="UNKNOWN";return this._modelType===Wn.FLOATING?t="Floating":this._modelType===Wn.FLOATING_SINGLE?t="Floating-Single":this._modelType===Wn.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t};Wn.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var t=arguments[0];if(cn.isNaN(t))return t;if(this._modelType===Wn.FLOATING_SINGLE){var e=t;return e}return this._modelType===Wn.FIXED?Math.round(t*this._scale)/this._scale:t}else if(arguments[0]instanceof Oe){var n=arguments[0];if(this._modelType===Wn.FLOATING)return null;n.x=this.makePrecise(n.x),n.y=this.makePrecise(n.y)}};Wn.prototype.getMaximumSignificantDigits=function(){var t=16;return this._modelType===Wn.FLOATING?t=16:this._modelType===Wn.FLOATING_SINGLE?t=6:this._modelType===Wn.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t};Wn.prototype.setScale=function(t){this._scale=Math.abs(t)};Wn.prototype.interfaces_=function(){return[Ts,Cs]};Wn.prototype.getClass=function(){return Wn};Wn.mostPrecise=function(t,e){return t.compareTo(e)>=0?t:e};Q1.serialVersionUID.get=function(){return 7777263578777804e3};Q1.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties(Wn,Q1);var Ca=function t(e){this._name=e||null,t.nameToTypeMap.put(e,this)},eb={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};Ca.prototype.readResolve=function(){return Ca.nameToTypeMap.get(this._name)};Ca.prototype.toString=function(){return this._name};Ca.prototype.interfaces_=function(){return[Ts]};Ca.prototype.getClass=function(){return Ca};eb.serialVersionUID.get=function(){return-552860263173159e4};eb.nameToTypeMap.get=function(){return new qC};Object.defineProperties(Ca,eb);Wn.Type=Ca;Wn.FIXED=new Ca("FIXED");Wn.FLOATING=new Ca("FLOATING");Wn.FLOATING_SINGLE=new Ca("FLOATING SINGLE");var Mn=function t(){this._precisionModel=new Wn,this._SRID=0,this._coordinateSequenceFactory=t.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?rn(arguments[0],Gf)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof Wn&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},WC={serialVersionUID:{configurable:!0}};Mn.prototype.toGeometry=function(t){return t.isNull()?this.createPoint(null):t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new Oe(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new Oe(t.getMinX(),t.getMinY()),new Oe(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new Oe(t.getMinX(),t.getMinY()),new Oe(t.getMinX(),t.getMaxY()),new Oe(t.getMaxX(),t.getMaxY()),new Oe(t.getMaxX(),t.getMinY()),new Oe(t.getMinX(),t.getMinY())]),null)};Mn.prototype.createLineString=function(t){if(t){if(t instanceof Array)return new Rr(this.getCoordinateSequenceFactory().create(t),this);if(rn(t,Vn))return new Rr(t,this)}else return new Rr(this.getCoordinateSequenceFactory().create([]),this)};Mn.prototype.createMultiLineString=function(){if(arguments.length===0)return new ic(null,this);if(arguments.length===1){var t=arguments[0];return new ic(t,this)}};Mn.prototype.buildGeometry=function(t){for(var e=null,n=!1,r=!1,i=t.iterator();i.hasNext();){var o=i.next(),c=o.getClass();e===null&&(e=c),c!==e&&(n=!0),o.isGeometryCollectionOrDerived()&&(r=!0)}if(e===null)return this.createGeometryCollection();if(n||r)return this.createGeometryCollection(Mn.toGeometryArray(t));var l=t.iterator().next(),d=t.size()>1;if(d){if(l instanceof ai)return this.createMultiPolygon(Mn.toPolygonArray(t));if(l instanceof Rr)return this.createMultiLineString(Mn.toLineStringArray(t));if(l instanceof Uo)return this.createMultiPoint(Mn.toPointArray(t));yn.shouldNeverReachHere("Unhandled class: "+l.getClass().getName())}return l};Mn.prototype.createMultiPointFromCoords=function(t){return this.createMultiPoint(t!==null?this.getCoordinateSequenceFactory().create(t):null)};Mn.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Oe){var t=arguments[0];return this.createPoint(t!==null?this.getCoordinateSequenceFactory().create([t]):null)}else if(rn(arguments[0],Vn)){var e=arguments[0];return new Uo(e,this)}}};Mn.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};Mn.prototype.createPolygon=function(){if(arguments.length===0)return new ai(null,null,this);if(arguments.length===1){if(rn(arguments[0],Vn)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}else if(arguments[0]instanceof Array){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}else if(arguments[0]instanceof Ja){var n=arguments[0];return this.createPolygon(n,null)}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];return new ai(r,i,this)}};Mn.prototype.getSRID=function(){return this._SRID};Mn.prototype.createGeometryCollection=function(){if(arguments.length===0)return new lo(null,this);if(arguments.length===1){var t=arguments[0];return new lo(t,this)}};Mn.prototype.createGeometry=function(t){var e=new Es(this);return e.edit(t,{edit:function(){if(arguments.length===2){var n=arguments[0];return this._coordinateSequenceFactory.create(n)}}})};Mn.prototype.getPrecisionModel=function(){return this._precisionModel};Mn.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(t!==null?this.getCoordinateSequenceFactory().create(t):null)}else if(rn(arguments[0],Vn)){var e=arguments[0];return new Ja(e,this)}}};Mn.prototype.createMultiPolygon=function(){if(arguments.length===0)return new Ya(null,this);if(arguments.length===1){var t=arguments[0];return new Ya(t,this)}};Mn.prototype.createMultiPoint=function(){var t=this;if(arguments.length===0)return new Yf(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return new Yf(e,this)}else if(arguments[0]instanceof Array){var n=arguments[0];return this.createMultiPoint(n!==null?this.getCoordinateSequenceFactory().create(n):null)}else if(rn(arguments[0],Vn)){var r=arguments[0];if(r===null)return this.createMultiPoint(new Array(0).fill(null));for(var i=new Array(r.size()).fill(null),o=0;o<r.size();o++){var c=t.getCoordinateSequenceFactory().create(1,r.getDimension());qr.copy(r,o,c,0,1),i[o]=t.createPoint(c)}return this.createMultiPoint(i)}}};Mn.prototype.interfaces_=function(){return[Ts]};Mn.prototype.getClass=function(){return Mn};Mn.toMultiPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};Mn.toGeometryArray=function(t){if(t===null)return null;var e=new Array(t.size()).fill(null);return t.toArray(e)};Mn.getDefaultCoordinateSequenceFactory=function(){return Qa.instance()};Mn.toMultiLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};Mn.toLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};Mn.toMultiPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};Mn.toLinearRingArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};Mn.toPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};Mn.toPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};Mn.createPointFromInternalCoord=function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)};WC.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties(Mn,WC);var JO=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],my=function(t){this.geometryFactory=t||new Mn};my.prototype.read=function(t){var e;typeof t=="string"?e=JSON.parse(t):e=t;var n=e.type;if(!pa[n])throw new Error("Unknown GeoJSON type: "+e.type);return JO.indexOf(n)!==-1?pa[n].apply(this,[e.coordinates]):n==="GeometryCollection"?pa[n].apply(this,[e.geometries]):pa[n].apply(this,[e])};my.prototype.write=function(t){var e=t.getGeometryType();if(!wl[e])throw new Error("Geometry is not supported");return wl[e].apply(this,[t])};var pa={Feature:function(t){var e={};for(var n in t)e[n]=t[n];if(t.geometry){var r=t.geometry.type;if(!pa[r])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=pa.bbox.apply(this,[t.bbox])),e},FeatureCollection:function(t){var e=this,n={};if(t.features){n.features=[];for(var r=0;r<t.features.length;++r)n.features.push(e.read(t.features[r]))}return t.bbox&&(n.bbox=this.parse.bbox.apply(this,[t.bbox])),n},coordinates:function(t){for(var e=[],n=0;n<t.length;++n){var r=t[n];e.push(new Oe(r[0],r[1]))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new Oe(t[0],t[1]),new Oe(t[2],t[1]),new Oe(t[2],t[3]),new Oe(t[0],t[3]),new Oe(t[0],t[1])])},Point:function(t){var e=new Oe(t[0],t[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=this,n=[],r=0;r<t.length;++r)n.push(pa.Point.apply(e,[t[r]]));return this.geometryFactory.createMultiPoint(n)},LineString:function(t){var e=pa.coordinates.apply(this,[t]);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=this,n=[],r=0;r<t.length;++r)n.push(pa.LineString.apply(e,[t[r]]));return this.geometryFactory.createMultiLineString(n)},Polygon:function(t){for(var e=this,n=pa.coordinates.apply(this,[t[0]]),r=this.geometryFactory.createLinearRing(n),i=[],o=1;o<t.length;++o){var c=t[o],l=pa.coordinates.apply(e,[c]),d=e.geometryFactory.createLinearRing(l);i.push(d)}return this.geometryFactory.createPolygon(r,i)},MultiPolygon:function(t){for(var e=this,n=[],r=0;r<t.length;++r){var i=t[r];n.push(pa.Polygon.apply(e,[i]))}return this.geometryFactory.createMultiPolygon(n)},GeometryCollection:function(t){for(var e=this,n=[],r=0;r<t.length;++r){var i=t[r];n.push(e.read(i))}return this.geometryFactory.createGeometryCollection(n)}},wl={coordinate:function(t){return[t.x,t.y]},Point:function(t){var e=wl.coordinate.apply(this,[t.getCoordinate()]);return{type:"Point",coordinates:e}},MultiPoint:function(t){for(var e=this,n=[],r=0;r<t._geometries.length;++r){var i=t._geometries[r],o=wl.Point.apply(e,[i]);n.push(o.coordinates)}return{type:"MultiPoint",coordinates:n}},LineString:function(t){for(var e=this,n=[],r=t.getCoordinates(),i=0;i<r.length;++i){var o=r[i];n.push(wl.coordinate.apply(e,[o]))}return{type:"LineString",coordinates:n}},MultiLineString:function(t){for(var e=this,n=[],r=0;r<t._geometries.length;++r){var i=t._geometries[r],o=wl.LineString.apply(e,[i]);n.push(o.coordinates)}return{type:"MultiLineString",coordinates:n}},Polygon:function(t){var e=this,n=[],r=wl.LineString.apply(this,[t._shell]);n.push(r.coordinates);for(var i=0;i<t._holes.length;++i){var o=t._holes[i],c=wl.LineString.apply(e,[o]);n.push(c.coordinates)}return{type:"Polygon",coordinates:n}},MultiPolygon:function(t){for(var e=this,n=[],r=0;r<t._geometries.length;++r){var i=t._geometries[r],o=wl.Polygon.apply(e,[i]);n.push(o.coordinates)}return{type:"MultiPolygon",coordinates:n}},GeometryCollection:function(t){for(var e=this,n=[],r=0;r<t._geometries.length;++r){var i=t._geometries[r],o=i.getGeometryType();n.push(wl[o].apply(e,[i]))}return{type:"GeometryCollection",geometries:n}}},tb=function(t){this.geometryFactory=t||new Mn,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new my(this.geometryFactory)};tb.prototype.read=function(t){var e=this.parser.read(t);return this.precisionModel.getType()===Wn.FIXED&&this.reducePrecision(e),e};tb.prototype.reducePrecision=function(t){var e=this,n,r;if(t.coordinate)this.precisionModel.makePrecise(t.coordinate);else if(t.points)for(n=0,r=t.points.length;n<r;n++)e.precisionModel.makePrecise(t.points[n]);else if(t.geometries)for(n=0,r=t.geometries.length;n<r;n++)e.reducePrecision(t.geometries[n])};var HC=function(){this.parser=new my(this.geometryFactory)};HC.prototype.write=function(t){return this.parser.write(t)};var ut=function(){},gy={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};ut.prototype.interfaces_=function(){return[]};ut.prototype.getClass=function(){return ut};ut.opposite=function(t){return t===ut.LEFT?ut.RIGHT:t===ut.RIGHT?ut.LEFT:t};gy.ON.get=function(){return 0};gy.LEFT.get=function(){return 1};gy.RIGHT.get=function(){return 2};Object.defineProperties(ut,gy);function _y(t){this.message=t||""}_y.prototype=new Error;_y.prototype.name="EmptyStackException";function Oa(){this.array_=[]}Oa.prototype=new js;Oa.prototype.add=function(t){return this.array_.push(t),!0};Oa.prototype.get=function(t){if(t<0||t>=this.size())throw new Error;return this.array_[t]};Oa.prototype.push=function(t){return this.array_.push(t),t};Oa.prototype.pop=function(t){if(this.array_.length===0)throw new _y;return this.array_.pop()};Oa.prototype.peek=function(){if(this.array_.length===0)throw new _y;return this.array_[this.array_.length-1]};Oa.prototype.empty=function(){return this.array_.length===0};Oa.prototype.isEmpty=function(){return this.empty()};Oa.prototype.search=function(t){return this.array_.indexOf(t)};Oa.prototype.size=function(){return this.array_.length};Oa.prototype.toArray=function(){for(var t=this,e=[],n=0,r=this.array_.length;n<r;n++)e.push(t.array_[n]);return e};var Ta=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};Ta.prototype.getCoordinate=function(){return this._minCoord};Ta.prototype.getRightmostSide=function(t,e){var n=this.getRightmostSideOfSegment(t,e);return n<0&&(n=this.getRightmostSideOfSegment(t,e-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(t)),n};Ta.prototype.findRightmostEdgeAtVertex=function(){var t=this._minDe.getEdge().getCoordinates();yn.isTrue(this._minIndex>0&&this._minIndex<t.length,"rightmost point expected to be interior vertex of edge");var e=t[this._minIndex-1],n=t[this._minIndex+1],r=Tt.computeOrientation(this._minCoord,n,e),i=!1;(e.y<this._minCoord.y&&n.y<this._minCoord.y&&r===Tt.COUNTERCLOCKWISE||e.y>this._minCoord.y&&n.y>this._minCoord.y&&r===Tt.CLOCKWISE)&&(i=!0),i&&(this._minIndex=this._minIndex-1)};Ta.prototype.getRightmostSideOfSegment=function(t,e){var n=t.getEdge(),r=n.getCoordinates();if(e<0||e+1>=r.length||r[e].y===r[e+1].y)return-1;var i=ut.LEFT;return r[e].y<r[e+1].y&&(i=ut.RIGHT),i};Ta.prototype.getEdge=function(){return this._orientedDe};Ta.prototype.checkForRightmostCoordinate=function(t){for(var e=this,n=t.getEdge().getCoordinates(),r=0;r<n.length-1;r++)(e._minCoord===null||n[r].x>e._minCoord.x)&&(e._minDe=t,e._minIndex=r,e._minCoord=n[r])};Ta.prototype.findRightmostEdgeAtNode=function(){var t=this._minDe.getNode(),e=t.getEdges();this._minDe=e.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};Ta.prototype.findEdge=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next();r.isForward()&&e.checkForRightmostCoordinate(r)}yn.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var i=this.getRightmostSide(this._minDe,this._minIndex);i===ut.LEFT&&(this._orientedDe=this._minDe.getSym())};Ta.prototype.interfaces_=function(){return[]};Ta.prototype.getClass=function(){return Ta};var Dl=function(t){function e(n,r){t.call(this,e.msgWithCoord(n,r)),this.pt=r?new Oe(r):null,this.name="TopologyException"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCoordinate=function(){return this.pt},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.msgWithCoord=function(n,r){return r?n:n+" [ "+r+" ]"},e}(kl),yy=function(){this.array_=[]};yy.prototype.addLast=function(t){this.array_.push(t)};yy.prototype.removeFirst=function(){return this.array_.shift()};yy.prototype.isEmpty=function(){return this.array_.length===0};var uo=function(){this._finder=null,this._dirEdgeList=new vt,this._nodes=new vt,this._rightMostCoord=null,this._env=null,this._finder=new Ta};uo.prototype.clearVisitedEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();e.setVisited(!1)}};uo.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};uo.prototype.computeNodeDepth=function(t){for(var e=this,n=null,r=t.getEdges().iterator();r.hasNext();){var i=r.next();if(i.isVisited()||i.getSym().isVisited()){n=i;break}}if(n===null)throw new Dl("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(n);for(var o=t.getEdges().iterator();o.hasNext();){var c=o.next();c.setVisited(!0),e.copySymDepths(c)}};uo.prototype.computeDepth=function(t){this.clearVisitedEdges();var e=this._finder.getEdge();e.setEdgeDepths(ut.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)};uo.prototype.create=function(t){this.addReachable(t),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};uo.prototype.findResultEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();e.getDepth(ut.RIGHT)>=1&&e.getDepth(ut.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}};uo.prototype.computeDepths=function(t){var e=this,n=new $1,r=new yy,i=t.getNode();for(r.addLast(i),n.add(i),t.setVisited(!0);!r.isEmpty();){var o=r.removeFirst();n.add(o),e.computeNodeDepth(o);for(var c=o.getEdges().iterator();c.hasNext();){var l=c.next(),d=l.getSym();if(!d.isVisited()){var y=d.getNode();n.contains(y)||(r.addLast(y),n.add(y))}}}};uo.prototype.compareTo=function(t){var e=t;return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0};uo.prototype.getEnvelope=function(){if(this._env===null){for(var t=new Wt,e=this._dirEdgeList.iterator();e.hasNext();)for(var n=e.next(),r=n.getEdge().getCoordinates(),i=0;i<r.length-1;i++)t.expandToInclude(r[i]);this._env=t}return this._env};uo.prototype.addReachable=function(t){var e=this,n=new Oa;for(n.add(t);!n.empty();){var r=n.pop();e.add(r,n)}};uo.prototype.copySymDepths=function(t){var e=t.getSym();e.setDepth(ut.LEFT,t.getDepth(ut.RIGHT)),e.setDepth(ut.RIGHT,t.getDepth(ut.LEFT))};uo.prototype.add=function(t,e){var n=this;t.setVisited(!0),this._nodes.add(t);for(var r=t.getEdges().iterator();r.hasNext();){var i=r.next();n._dirEdgeList.add(i);var o=i.getSym(),c=o.getNode();c.isVisited()||e.push(c)}};uo.prototype.getNodes=function(){return this._nodes};uo.prototype.getDirectedEdges=function(){return this._dirEdgeList};uo.prototype.interfaces_=function(){return[Cs]};uo.prototype.getClass=function(){return uo};var ar=function t(){var e=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];this.init(n.length)}else if(Number.isInteger(arguments[0])){var r=arguments[0];this.init(1),this.location[ut.ON]=r}else if(arguments[0]instanceof t){var i=arguments[0];if(this.init(i.location.length),i!==null)for(var o=0;o<this.location.length;o++)e.location[o]=i.location[o]}}else if(arguments.length===3){var c=arguments[0],l=arguments[1],d=arguments[2];this.init(3),this.location[ut.ON]=c,this.location[ut.LEFT]=l,this.location[ut.RIGHT]=d}};ar.prototype.setAllLocations=function(t){for(var e=this,n=0;n<this.location.length;n++)e.location[n]=t};ar.prototype.isNull=function(){for(var t=this,e=0;e<this.location.length;e++)if(t.location[e]!==ze.NONE)return!1;return!0};ar.prototype.setAllLocationsIfNull=function(t){for(var e=this,n=0;n<this.location.length;n++)e.location[n]===ze.NONE&&(e.location[n]=t)};ar.prototype.isLine=function(){return this.location.length===1};ar.prototype.merge=function(t){var e=this;if(t.location.length>this.location.length){var n=new Array(3).fill(null);n[ut.ON]=this.location[ut.ON],n[ut.LEFT]=ze.NONE,n[ut.RIGHT]=ze.NONE,this.location=n}for(var r=0;r<this.location.length;r++)e.location[r]===ze.NONE&&r<t.location.length&&(e.location[r]=t.location[r])};ar.prototype.getLocations=function(){return this.location};ar.prototype.flip=function(){if(this.location.length<=1)return null;var t=this.location[ut.LEFT];this.location[ut.LEFT]=this.location[ut.RIGHT],this.location[ut.RIGHT]=t};ar.prototype.toString=function(){var t=new Na;return this.location.length>1&&t.append(ze.toLocationSymbol(this.location[ut.LEFT])),t.append(ze.toLocationSymbol(this.location[ut.ON])),this.location.length>1&&t.append(ze.toLocationSymbol(this.location[ut.RIGHT])),t.toString()};ar.prototype.setLocations=function(t,e,n){this.location[ut.ON]=t,this.location[ut.LEFT]=e,this.location[ut.RIGHT]=n};ar.prototype.get=function(t){return t<this.location.length?this.location[t]:ze.NONE};ar.prototype.isArea=function(){return this.location.length>1};ar.prototype.isAnyNull=function(){for(var t=this,e=0;e<this.location.length;e++)if(t.location[e]===ze.NONE)return!0;return!1};ar.prototype.setLocation=function(){if(arguments.length===1){var t=arguments[0];this.setLocation(ut.ON,t)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this.location[e]=n}};ar.prototype.init=function(t){this.location=new Array(t).fill(null),this.setAllLocations(ze.NONE)};ar.prototype.isEqualOnSide=function(t,e){return this.location[e]===t.location[e]};ar.prototype.allPositionsEqual=function(t){for(var e=this,n=0;n<this.location.length;n++)if(e.location[n]!==t)return!1;return!0};ar.prototype.interfaces_=function(){return[]};ar.prototype.getClass=function(){return ar};var $n=function t(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var e=arguments[0];this.elt[0]=new ar(e),this.elt[1]=new ar(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.elt[0]=new ar(n.elt[0]),this.elt[1]=new ar(n.elt[1])}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this.elt[0]=new ar(ze.NONE),this.elt[1]=new ar(ze.NONE),this.elt[r].setLocation(i)}else if(arguments.length===3){var o=arguments[0],c=arguments[1],l=arguments[2];this.elt[0]=new ar(o,c,l),this.elt[1]=new ar(o,c,l)}else if(arguments.length===4){var d=arguments[0],y=arguments[1],S=arguments[2],E=arguments[3];this.elt[0]=new ar(ze.NONE,ze.NONE,ze.NONE),this.elt[1]=new ar(ze.NONE,ze.NONE,ze.NONE),this.elt[d].setLocations(y,S,E)}};$n.prototype.getGeometryCount=function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t};$n.prototype.setAllLocations=function(t,e){this.elt[t].setAllLocations(e)};$n.prototype.isNull=function(t){return this.elt[t].isNull()};$n.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this.elt[e].setAllLocationsIfNull(n)}};$n.prototype.isLine=function(t){return this.elt[t].isLine()};$n.prototype.merge=function(t){for(var e=this,n=0;n<2;n++)e.elt[n]===null&&t.elt[n]!==null?e.elt[n]=new ar(t.elt[n]):e.elt[n].merge(t.elt[n])};$n.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};$n.prototype.getLocation=function(){if(arguments.length===1){var t=arguments[0];return this.elt[t].get(ut.ON)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return this.elt[e].get(n)}};$n.prototype.toString=function(){var t=new Na;return this.elt[0]!==null&&(t.append("A:"),t.append(this.elt[0].toString())),this.elt[1]!==null&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()};$n.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var t=arguments[0];return this.elt[t].isArea()}};$n.prototype.isAnyNull=function(t){return this.elt[t].isAnyNull()};$n.prototype.setLocation=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1];this.elt[t].setLocation(ut.ON,e)}else if(arguments.length===3){var n=arguments[0],r=arguments[1],i=arguments[2];this.elt[n].setLocation(r,i)}};$n.prototype.isEqualOnSide=function(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)};$n.prototype.allPositionsEqual=function(t,e){return this.elt[t].allPositionsEqual(e)};$n.prototype.toLine=function(t){this.elt[t].isArea()&&(this.elt[t]=new ar(this.elt[t].location[0]))};$n.prototype.interfaces_=function(){return[]};$n.prototype.getClass=function(){return $n};$n.toLineLabel=function(t){for(var e=new $n(ze.NONE),n=0;n<2;n++)e.setLocation(n,t.getLocation(n));return e};var Kr=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new vt,this._pts=new vt,this._label=new $n(ze.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new vt,this._geometryFactory=null;var t=arguments[0],e=arguments[1];this._geometryFactory=e,this.computePoints(t),this.computeRing()};Kr.prototype.computeRing=function(){var t=this;if(this._ring!==null)return null;for(var e=new Array(this._pts.size()).fill(null),n=0;n<this._pts.size();n++)e[n]=t._pts.get(n);this._ring=this._geometryFactory.createLinearRing(e),this._isHole=Tt.isCCW(this._ring.getCoordinates())};Kr.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};Kr.prototype.computePoints=function(t){var e=this;this._startDe=t;var n=t,r=!0;do{if(n===null)throw new Dl("Found null DirectedEdge");if(n.getEdgeRing()===e)throw new Dl("Directed Edge visited twice during ring-building at "+n.getCoordinate());e._edges.add(n);var i=n.getLabel();yn.isTrue(i.isArea()),e.mergeLabel(i),e.addPoints(n.getEdge(),n.isForward(),r),r=!1,e.setEdgeRing(n,e),n=e.getNext(n)}while(n!==this._startDe)};Kr.prototype.getLinearRing=function(){return this._ring};Kr.prototype.getCoordinate=function(t){return this._pts.get(t)};Kr.prototype.computeMaxNodeDegree=function(){var t=this;this._maxNodeDegree=0;var e=this._startDe;do{var n=e.getNode(),r=n.getEdges().getOutgoingDegree(t);r>t._maxNodeDegree&&(t._maxNodeDegree=r),e=t.getNext(e)}while(e!==this._startDe);this._maxNodeDegree*=2};Kr.prototype.addPoints=function(t,e,n){var r=this,i=t.getCoordinates();if(e){var o=1;n&&(o=0);for(var c=o;c<i.length;c++)r._pts.add(i[c])}else{var l=i.length-2;n&&(l=i.length-1);for(var d=l;d>=0;d--)r._pts.add(i[d])}};Kr.prototype.isHole=function(){return this._isHole};Kr.prototype.setInResult=function(){var t=this._startDe;do t.getEdge().setInResult(!0),t=t.getNext();while(t!==this._startDe)};Kr.prototype.containsPoint=function(t){var e=this.getLinearRing(),n=e.getEnvelopeInternal();if(!n.contains(t)||!Tt.isPointInRing(t,e.getCoordinates()))return!1;for(var r=this._holes.iterator();r.hasNext();){var i=r.next();if(i.containsPoint(t))return!1}return!0};Kr.prototype.addHole=function(t){this._holes.add(t)};Kr.prototype.isShell=function(){return this._shell===null};Kr.prototype.getLabel=function(){return this._label};Kr.prototype.getEdges=function(){return this._edges};Kr.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};Kr.prototype.getShell=function(){return this._shell};Kr.prototype.mergeLabel=function(){if(arguments.length===1){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(arguments.length===2){var e=arguments[0],n=arguments[1],r=e.getLocation(n,ut.RIGHT);if(r===ze.NONE)return null;if(this._label.getLocation(n)===ze.NONE)return this._label.setLocation(n,r),null}};Kr.prototype.setShell=function(t){this._shell=t,t!==null&&t.addHole(this)};Kr.prototype.toPolygon=function(t){for(var e=this,n=new Array(this._holes.size()).fill(null),r=0;r<this._holes.size();r++)n[r]=e._holes.get(r).getLinearRing();var i=t.createPolygon(this.getLinearRing(),n);return i};Kr.prototype.interfaces_=function(){return[]};Kr.prototype.getClass=function(){return Kr};var QO=function(t){function e(){var n=arguments[0],r=arguments[1];t.call(this,n,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setEdgeRing=function(n,r){n.setMinEdgeRing(r)},e.prototype.getNext=function(n){return n.getNextMin()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Kr),e5=function(t){function e(){var n=arguments[0],r=arguments[1];t.call(this,n,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildMinimalRings=function(){var n=this,r=new vt,i=this._startDe;do{if(i.getMinEdgeRing()===null){var o=new QO(i,n._geometryFactory);r.add(o)}i=i.getNext()}while(i!==this._startDe);return r},e.prototype.setEdgeRing=function(n,r){n.setEdgeRing(r)},e.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var n=this,r=this._startDe;do{var i=r.getNode();i.getEdges().linkMinimalDirectedEdges(n),r=r.getNext()}while(r!==this._startDe)},e.prototype.getNext=function(n){return n.getNext()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Kr),as=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0&&arguments.length===1){var t=arguments[0];this._label=t}};as.prototype.setVisited=function(t){this._isVisited=t};as.prototype.setInResult=function(t){this._isInResult=t};as.prototype.isCovered=function(){return this._isCovered};as.prototype.isCoveredSet=function(){return this._isCoveredSet};as.prototype.setLabel=function(t){this._label=t};as.prototype.getLabel=function(){return this._label};as.prototype.setCovered=function(t){this._isCovered=t,this._isCoveredSet=!0};as.prototype.updateIM=function(t){yn.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(t)};as.prototype.isInResult=function(){return this._isInResult};as.prototype.isVisited=function(){return this._isVisited};as.prototype.interfaces_=function(){return[]};as.prototype.getClass=function(){return as};var vy=function(t){function e(){t.call(this),this._coord=null,this._edges=null;var n=arguments[0],r=arguments[1];this._coord=n,this._edges=r,this._label=new $n(0,ze.NONE)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isIncidentEdgeInResult=function(){for(var n=this.getEdges().getEdges().iterator();n.hasNext();){var r=n.next();if(r.getEdge().isInResult())return!0}return!1},e.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},e.prototype.getCoordinate=function(){return this._coord},e.prototype.print=function(n){n.println("node "+this._coord+" lbl: "+this._label)},e.prototype.computeIM=function(n){},e.prototype.computeMergedLocation=function(n,r){var i=ze.NONE;if(i=this._label.getLocation(r),!n.isNull(r)){var o=n.getLocation(r);i!==ze.BOUNDARY&&(i=o)}return i},e.prototype.setLabel=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1];this._label===null?this._label=new $n(n,r):this._label.setLocation(n,r)}else return t.prototype.setLabel.apply(this,arguments)},e.prototype.getEdges=function(){return this._edges},e.prototype.mergeLabel=function(){var n=this;if(arguments[0]instanceof e){var r=arguments[0];this.mergeLabel(r._label)}else if(arguments[0]instanceof $n)for(var i=arguments[0],o=0;o<2;o++){var c=n.computeMergedLocation(i,o),l=n._label.getLocation(o);l===ze.NONE&&n._label.setLocation(o,c)}},e.prototype.add=function(n){this._edges.insert(n),n.setNode(this)},e.prototype.setLabelBoundary=function(n){if(this._label===null)return null;var r=ze.NONE;this._label!==null&&(r=this._label.getLocation(n));var i=null;switch(r){case ze.BOUNDARY:i=ze.INTERIOR;break;case ze.INTERIOR:i=ze.BOUNDARY;break;default:i=ze.BOUNDARY;break}this._label.setLocation(n,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(as),La=function(){this.nodeMap=new Xi,this.nodeFact=null;var t=arguments[0];this.nodeFact=t};La.prototype.find=function(t){return this.nodeMap.get(t)};La.prototype.addNode=function(){if(arguments[0]instanceof Oe){var t=arguments[0],e=this.nodeMap.get(t);return e===null&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}else if(arguments[0]instanceof vy){var n=arguments[0],r=this.nodeMap.get(n.getCoordinate());return r===null?(this.nodeMap.put(n.getCoordinate(),n),n):(r.mergeLabel(n),r)}};La.prototype.print=function(t){for(var e=this.iterator();e.hasNext();){var n=e.next();n.print(t)}};La.prototype.iterator=function(){return this.nodeMap.values().iterator()};La.prototype.values=function(){return this.nodeMap.values()};La.prototype.getBoundaryNodes=function(t){for(var e=new vt,n=this.iterator();n.hasNext();){var r=n.next();r.getLabel().getLocation(t)===ze.BOUNDARY&&e.add(r)}return e};La.prototype.add=function(t){var e=t.getCoordinate(),n=this.addNode(e);n.add(t)};La.prototype.interfaces_=function(){return[]};La.prototype.getClass=function(){return La};var Jn=function(){},Pm={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Jn.prototype.interfaces_=function(){return[]};Jn.prototype.getClass=function(){return Jn};Jn.isNorthern=function(t){return t===Jn.NE||t===Jn.NW};Jn.isOpposite=function(t,e){if(t===e)return!1;var n=(t-e+4)%4;return n===2};Jn.commonHalfPlane=function(t,e){if(t===e)return t;var n=(t-e+4)%4;if(n===2)return-1;var r=t<e?t:e,i=t>e?t:e;return r===0&&i===3?3:r};Jn.isInHalfPlane=function(t,e){return e===Jn.SE?t===Jn.SE||t===Jn.SW:t===e||t===e+1};Jn.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],e=arguments[1];if(t===0&&e===0)throw new wr("Cannot compute the quadrant for point ( "+t+", "+e+" )");return t>=0?e>=0?Jn.NE:Jn.SE:e>=0?Jn.NW:Jn.SW}else if(arguments[0]instanceof Oe&&arguments[1]instanceof Oe){var n=arguments[0],r=arguments[1];if(r.x===n.x&&r.y===n.y)throw new wr("Cannot compute the quadrant for two identical points "+n);return r.x>=n.x?r.y>=n.y?Jn.NE:Jn.SE:r.y>=n.y?Jn.NW:Jn.SW}};Pm.NE.get=function(){return 0};Pm.NW.get=function(){return 1};Pm.SW.get=function(){return 2};Pm.SE.get=function(){return 3};Object.defineProperties(Jn,Pm);var Yi=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var t=arguments[0];this._edge=t}else if(arguments.length===3){var e=arguments[0],n=arguments[1],r=arguments[2],i=null;this._edge=e,this.init(n,r),this._label=i}else if(arguments.length===4){var o=arguments[0],c=arguments[1],l=arguments[2],d=arguments[3];this._edge=o,this.init(c,l),this._label=d}};Yi.prototype.compareDirection=function(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:Tt.computeOrientation(t._p0,t._p1,this._p1)};Yi.prototype.getDy=function(){return this._dy};Yi.prototype.getCoordinate=function(){return this._p0};Yi.prototype.setNode=function(t){this._node=t};Yi.prototype.print=function(t){var e=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),r=n.lastIndexOf("."),i=n.substring(r+1);t.print("  "+i+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label)};Yi.prototype.compareTo=function(t){var e=t;return this.compareDirection(e)};Yi.prototype.getDirectedCoordinate=function(){return this._p1};Yi.prototype.getDx=function(){return this._dx};Yi.prototype.getLabel=function(){return this._label};Yi.prototype.getEdge=function(){return this._edge};Yi.prototype.getQuadrant=function(){return this._quadrant};Yi.prototype.getNode=function(){return this._node};Yi.prototype.toString=function(){var t=Math.atan2(this._dy,this._dx),e=this.getClass().getName(),n=e.lastIndexOf("."),r=e.substring(n+1);return"  "+r+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label};Yi.prototype.computeLabel=function(t){};Yi.prototype.init=function(t,e){this._p0=t,this._p1=e,this._dx=e.x-t.x,this._dy=e.y-t.y,this._quadrant=Jn.quadrant(this._dx,this._dy),yn.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};Yi.prototype.interfaces_=function(){return[Cs]};Yi.prototype.getClass=function(){return Yi};var Qv=function(t){function e(){var n=arguments[0],r=arguments[1];if(t.call(this,n),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=r,r)this.init(n.getCoordinate(0),n.getCoordinate(1));else{var i=n.getNumPoints()-1;this.init(n.getCoordinate(i),n.getCoordinate(i-1))}this.computeDirectedLabel()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getNextMin=function(){return this._nextMin},e.prototype.getDepth=function(n){return this._depth[n]},e.prototype.setVisited=function(n){this._isVisited=n},e.prototype.computeDirectedLabel=function(){this._label=new $n(this._edge.getLabel()),this._isForward||this._label.flip()},e.prototype.getNext=function(){return this._next},e.prototype.setDepth=function(n,r){if(this._depth[n]!==-999&&this._depth[n]!==r)throw new Dl("assigned depths do not match",this.getCoordinate());this._depth[n]=r},e.prototype.isInteriorAreaEdge=function(){for(var n=this,r=!0,i=0;i<2;i++)n._label.isArea(i)&&n._label.getLocation(i,ut.LEFT)===ze.INTERIOR&&n._label.getLocation(i,ut.RIGHT)===ze.INTERIOR||(r=!1);return r},e.prototype.setNextMin=function(n){this._nextMin=n},e.prototype.print=function(n){t.prototype.print.call(this,n),n.print(" "+this._depth[ut.LEFT]+"/"+this._depth[ut.RIGHT]),n.print(" ("+this.getDepthDelta()+")"),this._isInResult&&n.print(" inResult")},e.prototype.setMinEdgeRing=function(n){this._minEdgeRing=n},e.prototype.isLineEdge=function(){var n=this._label.isLine(0)||this._label.isLine(1),r=!this._label.isArea(0)||this._label.allPositionsEqual(0,ze.EXTERIOR),i=!this._label.isArea(1)||this._label.allPositionsEqual(1,ze.EXTERIOR);return n&&r&&i},e.prototype.setEdgeRing=function(n){this._edgeRing=n},e.prototype.getMinEdgeRing=function(){return this._minEdgeRing},e.prototype.getDepthDelta=function(){var n=this._edge.getDepthDelta();return this._isForward||(n=-n),n},e.prototype.setInResult=function(n){this._isInResult=n},e.prototype.getSym=function(){return this._sym},e.prototype.isForward=function(){return this._isForward},e.prototype.getEdge=function(){return this._edge},e.prototype.printEdge=function(n){this.print(n),n.print(" "),this._isForward?this._edge.print(n):this._edge.printReverse(n)},e.prototype.setSym=function(n){this._sym=n},e.prototype.setVisitedEdge=function(n){this.setVisited(n),this._sym.setVisited(n)},e.prototype.setEdgeDepths=function(n,r){var i=this.getEdge().getDepthDelta();this._isForward||(i=-i);var o=1;n===ut.LEFT&&(o=-1);var c=ut.opposite(n),l=i*o,d=r+l;this.setDepth(n,r),this.setDepth(c,d)},e.prototype.getEdgeRing=function(){return this._edgeRing},e.prototype.isInResult=function(){return this._isInResult},e.prototype.setNext=function(n){this._next=n},e.prototype.isVisited=function(){return this._isVisited},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.depthFactor=function(n,r){return n===ze.EXTERIOR&&r===ze.INTERIOR?1:n===ze.INTERIOR&&r===ze.EXTERIOR?-1:0},e}(Yi),$f=function(){};$f.prototype.createNode=function(t){return new vy(t,null)};$f.prototype.interfaces_=function(){return[]};$f.prototype.getClass=function(){return $f};var Lr=function(){if(this._edges=new vt,this._nodes=null,this._edgeEndList=new vt,arguments.length===0)this._nodes=new La(new $f);else if(arguments.length===1){var t=arguments[0];this._nodes=new La(t)}};Lr.prototype.printEdges=function(t){var e=this;t.println("Edges:");for(var n=0;n<this._edges.size();n++){t.println("edge "+n+":");var r=e._edges.get(n);r.print(t),r.eiList.print(t)}};Lr.prototype.find=function(t){return this._nodes.find(t)};Lr.prototype.addNode=function(){if(arguments[0]instanceof vy){var t=arguments[0];return this._nodes.addNode(t)}else if(arguments[0]instanceof Oe){var e=arguments[0];return this._nodes.addNode(e)}};Lr.prototype.getNodeIterator=function(){return this._nodes.iterator()};Lr.prototype.linkResultDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();){var e=t.next();e.getEdges().linkResultDirectedEdges()}};Lr.prototype.debugPrintln=function(t){Fi.out.println(t)};Lr.prototype.isBoundaryNode=function(t,e){var n=this._nodes.find(e);if(n===null)return!1;var r=n.getLabel();return r!==null&&r.getLocation(t)===ze.BOUNDARY};Lr.prototype.linkAllDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();){var e=t.next();e.getEdges().linkAllDirectedEdges()}};Lr.prototype.matchInSameDirection=function(t,e,n,r){return t.equals(n)?Tt.computeOrientation(t,e,r)===Tt.COLLINEAR&&Jn.quadrant(t,e)===Jn.quadrant(n,r):!1};Lr.prototype.getEdgeEnds=function(){return this._edgeEndList};Lr.prototype.debugPrint=function(t){Fi.out.print(t)};Lr.prototype.getEdgeIterator=function(){return this._edges.iterator()};Lr.prototype.findEdgeInSameDirection=function(t,e){for(var n=this,r=0;r<this._edges.size();r++){var i=n._edges.get(r),o=i.getCoordinates();if(n.matchInSameDirection(t,e,o[0],o[1])||n.matchInSameDirection(t,e,o[o.length-1],o[o.length-2]))return i}return null};Lr.prototype.insertEdge=function(t){this._edges.add(t)};Lr.prototype.findEdgeEnd=function(t){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var n=e.next();if(n.getEdge()===t)return n}return null};Lr.prototype.addEdges=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next();e._edges.add(r);var i=new Qv(r,!0),o=new Qv(r,!1);i.setSym(o),o.setSym(i),e.add(i),e.add(o)}};Lr.prototype.add=function(t){this._nodes.add(t),this._edgeEndList.add(t)};Lr.prototype.getNodes=function(){return this._nodes.values()};Lr.prototype.findEdge=function(t,e){for(var n=this,r=0;r<this._edges.size();r++){var i=n._edges.get(r),o=i.getCoordinates();if(t.equals(o[0])&&e.equals(o[1]))return i}return null};Lr.prototype.interfaces_=function(){return[]};Lr.prototype.getClass=function(){return Lr};Lr.linkResultDirectedEdges=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();n.getEdges().linkResultDirectedEdges()}};var jo=function(){this._geometryFactory=null,this._shellList=new vt;var t=arguments[0];this._geometryFactory=t};jo.prototype.sortShellsAndHoles=function(t,e,n){for(var r=t.iterator();r.hasNext();){var i=r.next();i.isHole()?n.add(i):e.add(i)}};jo.prototype.computePolygons=function(t){for(var e=this,n=new vt,r=t.iterator();r.hasNext();){var i=r.next(),o=i.toPolygon(e._geometryFactory);n.add(o)}return n};jo.prototype.placeFreeHoles=function(t,e){for(var n=this,r=e.iterator();r.hasNext();){var i=r.next();if(i.getShell()===null){var o=n.findEdgeRingContaining(i,t);if(o===null)throw new Dl("unable to assign hole to a shell",i.getCoordinate(0));i.setShell(o)}}};jo.prototype.buildMinimalEdgeRings=function(t,e,n){for(var r=this,i=new vt,o=t.iterator();o.hasNext();){var c=o.next();if(c.getMaxNodeDegree()>2){c.linkDirectedEdgesForMinimalEdgeRings();var l=c.buildMinimalRings(),d=r.findShell(l);d!==null?(r.placePolygonHoles(d,l),e.add(d)):n.addAll(l)}else i.add(c)}return i};jo.prototype.containsPoint=function(t){for(var e=this._shellList.iterator();e.hasNext();){var n=e.next();if(n.containsPoint(t))return!0}return!1};jo.prototype.buildMaximalEdgeRings=function(t){for(var e=this,n=new vt,r=t.iterator();r.hasNext();){var i=r.next();if(i.isInResult()&&i.getLabel().isArea()&&i.getEdgeRing()===null){var o=new e5(i,e._geometryFactory);n.add(o),o.setInResult()}}return n};jo.prototype.placePolygonHoles=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next();r.isHole()&&r.setShell(t)}};jo.prototype.getPolygons=function(){var t=this.computePolygons(this._shellList);return t};jo.prototype.findEdgeRingContaining=function(t,e){for(var n=t.getLinearRing(),r=n.getEnvelopeInternal(),i=n.getCoordinateN(0),o=null,c=null,l=e.iterator();l.hasNext();){var d=l.next(),y=d.getLinearRing(),S=y.getEnvelopeInternal();o!==null&&(c=o.getLinearRing().getEnvelopeInternal());var E=!1;S.contains(r)&&Tt.isPointInRing(i,y.getCoordinates())&&(E=!0),E&&(o===null||c.contains(S))&&(o=d)}return o};jo.prototype.findShell=function(t){for(var e=0,n=null,r=t.iterator();r.hasNext();){var i=r.next();i.isHole()||(n=i,e++)}return yn.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),n};jo.prototype.add=function(){if(arguments.length===1){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(arguments.length===2){var e=arguments[0],n=arguments[1];Lr.linkResultDirectedEdges(n);var r=this.buildMaximalEdgeRings(e),i=new vt,o=this.buildMinimalEdgeRings(r,this._shellList,i);this.sortShellsAndHoles(o,this._shellList,i),this.placeFreeHoles(this._shellList,i)}};jo.prototype.interfaces_=function(){return[]};jo.prototype.getClass=function(){return jo};var Kf=function(){};Kf.prototype.getBounds=function(){};Kf.prototype.interfaces_=function(){return[]};Kf.prototype.getClass=function(){return Kf};var Ws=function(){this._bounds=null,this._item=null;var t=arguments[0],e=arguments[1];this._bounds=t,this._item=e};Ws.prototype.getItem=function(){return this._item};Ws.prototype.getBounds=function(){return this._bounds};Ws.prototype.interfaces_=function(){return[Kf,Ts]};Ws.prototype.getClass=function(){return Ws};var Rl=function(){this._size=null,this._items=null,this._size=0,this._items=new vt,this._items.add(null)};Rl.prototype.poll=function(){if(this.isEmpty())return null;var t=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),t};Rl.prototype.size=function(){return this._size};Rl.prototype.reorder=function(t){for(var e=this,n=null,r=this._items.get(t);t*2<=this._size&&(n=t*2,n!==e._size&&e._items.get(n+1).compareTo(e._items.get(n))<0&&n++,e._items.get(n).compareTo(r)<0);t=n)e._items.set(t,e._items.get(n));this._items.set(t,r)};Rl.prototype.clear=function(){this._size=0,this._items.clear()};Rl.prototype.isEmpty=function(){return this._size===0};Rl.prototype.add=function(t){var e=this;this._items.add(null),this._size+=1;var n=this._size;for(this._items.set(0,t);t.compareTo(this._items.get(Math.trunc(n/2)))<0;n/=2)e._items.set(n,e._items.get(Math.trunc(n/2)));this._items.set(n,t)};Rl.prototype.interfaces_=function(){return[]};Rl.prototype.getClass=function(){return Rl};var gu=function(){};gu.prototype.visitItem=function(t){};gu.prototype.interfaces_=function(){return[]};gu.prototype.getClass=function(){return gu};var eh=function(){};eh.prototype.insert=function(t,e){};eh.prototype.remove=function(t,e){};eh.prototype.query=function(){};eh.prototype.interfaces_=function(){return[]};eh.prototype.getClass=function(){return eh};var oi=function(){if(this._childBoundables=new vt,this._bounds=null,this._level=null,arguments.length!==0&&arguments.length===1){var t=arguments[0];this._level=t}},ZC={serialVersionUID:{configurable:!0}};oi.prototype.getLevel=function(){return this._level};oi.prototype.size=function(){return this._childBoundables.size()};oi.prototype.getChildBoundables=function(){return this._childBoundables};oi.prototype.addChildBoundable=function(t){yn.isTrue(this._bounds===null),this._childBoundables.add(t)};oi.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};oi.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};oi.prototype.interfaces_=function(){return[Kf,Ts]};oi.prototype.getClass=function(){return oi};ZC.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(oi,ZC);var Hs=function(){};Hs.reverseOrder=function(){return{compare:function(t,e){return e.compareTo(t)}}};Hs.min=function(t){return Hs.sort(t),t.get(0)};Hs.sort=function(t,e){var n=t.toArray();e?ec.sort(n,e):ec.sort(n);for(var r=t.iterator(),i=0,o=n.length;i<o;i++)r.next(),r.set(n[i])};Hs.singletonList=function(t){var e=new vt;return e.add(t),e};var Yr=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var t=arguments[0],e=arguments[1],n=arguments[2];this._boundable1=t,this._boundable2=e,this._itemDistance=n,this._distance=this.distance()};Yr.prototype.expandToQueue=function(t,e){var n=Yr.isComposite(this._boundable1),r=Yr.isComposite(this._boundable2);if(n&&r)return Yr.area(this._boundable1)>Yr.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,t,e),null):(this.expand(this._boundable2,this._boundable1,t,e),null);if(n)return this.expand(this._boundable1,this._boundable2,t,e),null;if(r)return this.expand(this._boundable2,this._boundable1,t,e),null;throw new wr("neither boundable is composite")};Yr.prototype.isLeaves=function(){return!(Yr.isComposite(this._boundable1)||Yr.isComposite(this._boundable2))};Yr.prototype.compareTo=function(t){var e=t;return this._distance<e._distance?-1:this._distance>e._distance?1:0};Yr.prototype.expand=function(t,e,n,r){for(var i=this,o=t.getChildBoundables(),c=o.iterator();c.hasNext();){var l=c.next(),d=new Yr(l,e,i._itemDistance);d.getDistance()<r&&n.add(d)}};Yr.prototype.getBoundable=function(t){return t===0?this._boundable1:this._boundable2};Yr.prototype.getDistance=function(){return this._distance};Yr.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};Yr.prototype.interfaces_=function(){return[Cs]};Yr.prototype.getClass=function(){return Yr};Yr.area=function(t){return t.getBounds().getArea()};Yr.isComposite=function(t){return t instanceof oi};var Li=function t(){if(this._root=null,this._built=!1,this._itemBoundables=new vt,this._nodeCapacity=null,arguments.length===0){var e=t.DEFAULT_NODE_CAPACITY;this._nodeCapacity=e}else if(arguments.length===1){var n=arguments[0];yn.isTrue(n>1,"Node capacity must be greater than 1"),this._nodeCapacity=n}},by={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};Li.prototype.getNodeCapacity=function(){return this._nodeCapacity};Li.prototype.lastNode=function(t){return t.get(t.size()-1)};Li.prototype.size=function(){var t=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var e=arguments[0],n=0,r=e.getChildBoundables().iterator();r.hasNext();){var i=r.next();i instanceof oi?n+=t.size(i):i instanceof Ws&&(n+=1)}return n}};Li.prototype.removeItem=function(t,e){for(var n=null,r=t.getChildBoundables().iterator();r.hasNext();){var i=r.next();i instanceof Ws&&i.getItem()===e&&(n=i)}return n!==null?(t.getChildBoundables().remove(n),!0):!1};Li.prototype.itemsTree=function(){var t=this;if(arguments.length===0){this.build();var e=this.itemsTree(this._root);return e===null?new vt:e}else if(arguments.length===1){for(var n=arguments[0],r=new vt,i=n.getChildBoundables().iterator();i.hasNext();){var o=i.next();if(o instanceof oi){var c=t.itemsTree(o);c!==null&&r.add(c)}else o instanceof Ws?r.add(o.getItem()):yn.shouldNeverReachHere()}return r.size()<=0?null:r}};Li.prototype.insert=function(t,e){yn.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Ws(t,e))};Li.prototype.boundablesAtLevel=function(){var t=this;if(arguments.length===1){var e=arguments[0],n=new vt;return this.boundablesAtLevel(e,this._root,n),n}else if(arguments.length===3){var r=arguments[0],i=arguments[1],o=arguments[2];if(yn.isTrue(r>-2),i.getLevel()===r)return o.add(i),null;for(var c=i.getChildBoundables().iterator();c.hasNext();){var l=c.next();l instanceof oi?t.boundablesAtLevel(r,l,o):(yn.isTrue(l instanceof Ws),r===-1&&o.add(l))}return null}};Li.prototype.query=function(){var t=this;if(arguments.length===1){var e=arguments[0];this.build();var n=new vt;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.query(e,this._root,n),n}else if(arguments.length===2){var r=arguments[0],i=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),r)&&this.query(r,this._root,i)}else if(arguments.length===3){if(rn(arguments[2],gu)&&arguments[0]instanceof Object&&arguments[1]instanceof oi)for(var o=arguments[0],c=arguments[1],l=arguments[2],d=c.getChildBoundables(),y=0;y<d.size();y++){var S=d.get(y);t.getIntersectsOp().intersects(S.getBounds(),o)&&(S instanceof oi?t.query(o,S,l):S instanceof Ws?l.visitItem(S.getItem()):yn.shouldNeverReachHere())}else if(rn(arguments[2],js)&&arguments[0]instanceof Object&&arguments[1]instanceof oi)for(var E=arguments[0],C=arguments[1],A=arguments[2],M=C.getChildBoundables(),R=0;R<M.size();R++){var N=M.get(R);t.getIntersectsOp().intersects(N.getBounds(),E)&&(N instanceof oi?t.query(E,N,A):N instanceof Ws?A.add(N.getItem()):yn.shouldNeverReachHere())}}};Li.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};Li.prototype.getRoot=function(){return this.build(),this._root};Li.prototype.remove=function(){var t=this;if(arguments.length===2){var e=arguments[0],n=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),e)?this.remove(e,this._root,n):!1}else if(arguments.length===3){var r=arguments[0],i=arguments[1],o=arguments[2],c=this.removeItem(i,o);if(c)return!0;for(var l=null,d=i.getChildBoundables().iterator();d.hasNext();){var y=d.next();if(t.getIntersectsOp().intersects(y.getBounds(),r)&&y instanceof oi&&(c=t.remove(r,y,o),c)){l=y;break}}return l!==null&&l.getChildBoundables().isEmpty()&&i.getChildBoundables().remove(l),c}};Li.prototype.createHigherLevels=function(t,e){yn.isTrue(!t.isEmpty());var n=this.createParentBoundables(t,e+1);return n.size()===1?n.get(0):this.createHigherLevels(n,e+1)};Li.prototype.depth=function(){var t=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var e=arguments[0],n=0,r=e.getChildBoundables().iterator();r.hasNext();){var i=r.next();if(i instanceof oi){var o=t.depth(i);o>n&&(n=o)}}return n+1}};Li.prototype.createParentBoundables=function(t,e){var n=this;yn.isTrue(!t.isEmpty());var r=new vt;r.add(this.createNode(e));var i=new vt(t);Hs.sort(i,this.getComparator());for(var o=i.iterator();o.hasNext();){var c=o.next();n.lastNode(r).getChildBoundables().size()===n.getNodeCapacity()&&r.add(n.createNode(e)),n.lastNode(r).addChildBoundable(c)}return r};Li.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};Li.prototype.interfaces_=function(){return[Ts]};Li.prototype.getClass=function(){return Li};Li.compareDoubles=function(t,e){return t>e?1:t<e?-1:0};by.IntersectsOp.get=function(){return t5};by.serialVersionUID.get=function(){return-3886435814360241e3};by.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(Li,by);var t5=function(){},Jf=function(){};Jf.prototype.distance=function(t,e){};Jf.prototype.interfaces_=function(){return[]};Jf.prototype.getClass=function(){return Jf};var XC=function(t){function e(r){r=r||e.DEFAULT_NODE_CAPACITY,t.call(this,r)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return e.prototype.createParentBoundablesFromVerticalSlices=function(r,i){var o=this;yn.isTrue(r.length>0);for(var c=new vt,l=0;l<r.length;l++)c.addAll(o.createParentBoundablesFromVerticalSlice(r[l],i));return c},e.prototype.createNode=function(r){return new oS(r)},e.prototype.size=function(){return arguments.length===0?t.prototype.size.call(this):t.prototype.size.apply(this,arguments)},e.prototype.insert=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];if(r.isNull())return null;t.prototype.insert.call(this,r,i)}else return t.prototype.insert.apply(this,arguments)},e.prototype.getIntersectsOp=function(){return e.intersectsOp},e.prototype.verticalSlices=function(r,i){for(var o=Math.trunc(Math.ceil(r.size()/i)),c=new Array(i).fill(null),l=r.iterator(),d=0;d<i;d++){c[d]=new vt;for(var y=0;l.hasNext()&&y<o;){var S=l.next();c[d].add(S),y++}}return c},e.prototype.query=function(){if(arguments.length===1){var r=arguments[0];return t.prototype.query.call(this,r)}else if(arguments.length===2){var i=arguments[0],o=arguments[1];t.prototype.query.call(this,i,o)}else if(arguments.length===3){if(rn(arguments[2],gu)&&arguments[0]instanceof Object&&arguments[1]instanceof oi){var c=arguments[0],l=arguments[1],d=arguments[2];t.prototype.query.call(this,c,l,d)}else if(rn(arguments[2],js)&&arguments[0]instanceof Object&&arguments[1]instanceof oi){var y=arguments[0],S=arguments[1],E=arguments[2];t.prototype.query.call(this,y,S,E)}}},e.prototype.getComparator=function(){return e.yComparator},e.prototype.createParentBoundablesFromVerticalSlice=function(r,i){return t.prototype.createParentBoundables.call(this,r,i)},e.prototype.remove=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];return t.prototype.remove.call(this,r,i)}else return t.prototype.remove.apply(this,arguments)},e.prototype.depth=function(){return arguments.length===0?t.prototype.depth.call(this):t.prototype.depth.apply(this,arguments)},e.prototype.createParentBoundables=function(r,i){yn.isTrue(!r.isEmpty());var o=Math.trunc(Math.ceil(r.size()/this.getNodeCapacity())),c=new vt(r);Hs.sort(c,e.xComparator);var l=this.verticalSlices(c,Math.trunc(Math.ceil(Math.sqrt(o))));return this.createParentBoundablesFromVerticalSlices(l,i)},e.prototype.nearestNeighbour=function(){if(arguments.length===1){if(rn(arguments[0],Jf)){var r=arguments[0],i=new Yr(this.getRoot(),this.getRoot(),r);return this.nearestNeighbour(i)}else if(arguments[0]instanceof Yr){var o=arguments[0];return this.nearestNeighbour(o,cn.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof e&&rn(arguments[1],Jf)){var c=arguments[0],l=arguments[1],d=new Yr(this.getRoot(),c.getRoot(),l);return this.nearestNeighbour(d)}else if(arguments[0]instanceof Yr&&typeof arguments[1]=="number"){var y=arguments[0],S=arguments[1],E=S,C=null,A=new Rl;for(A.add(y);!A.isEmpty()&&E>0;){var M=A.poll(),R=M.getDistance();if(R>=E)break;M.isLeaves()?(E=R,C=M):M.expandToQueue(A,E)}return[C.getBoundable(0).getItem(),C.getBoundable(1).getItem()]}}else if(arguments.length===3){var N=arguments[0],B=arguments[1],O=arguments[2],G=new Ws(N,B),U=new Yr(this.getRoot(),G,O);return this.nearestNeighbour(U)[0]}},e.prototype.interfaces_=function(){return[eh,Ts]},e.prototype.getClass=function(){return e},e.centreX=function(r){return e.avg(r.getMinX(),r.getMaxX())},e.avg=function(r,i){return(r+i)/2},e.centreY=function(r){return e.avg(r.getMinY(),r.getMaxY())},n.STRtreeNode.get=function(){return oS},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[jf]},compare:function(r,i){return t.compareDoubles(e.centreX(r.getBounds()),e.centreX(i.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[jf]},compare:function(r,i){return t.compareDoubles(e.centreY(r.getBounds()),e.centreY(i.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[t.IntersectsOp]},intersects:function(r,i){return r.intersects(i)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(e,n),e}(Li),oS=function(t){function e(){var n=arguments[0];t.call(this,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeBounds=function(){for(var n=null,r=this.getChildBoundables().iterator();r.hasNext();){var i=r.next();n===null?n=new Wt(i.getBounds()):n.expandToInclude(i.getBounds())}return n},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(oi),xo=function(){};xo.prototype.interfaces_=function(){return[]};xo.prototype.getClass=function(){return xo};xo.relativeSign=function(t,e){return t<e?-1:t>e?1:0};xo.compare=function(t,e,n){if(e.equals2D(n))return 0;var r=xo.relativeSign(e.x,n.x),i=xo.relativeSign(e.y,n.y);switch(t){case 0:return xo.compareValue(r,i);case 1:return xo.compareValue(i,r);case 2:return xo.compareValue(i,-r);case 3:return xo.compareValue(-r,i);case 4:return xo.compareValue(-r,-i);case 5:return xo.compareValue(-i,-r);case 6:return xo.compareValue(-i,r);case 7:return xo.compareValue(r,-i)}return yn.shouldNeverReachHere("invalid octant value"),0};xo.compareValue=function(t,e){return t<0?-1:t>0?1:e<0?-1:e>0?1:0};var _u=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this._segString=t,this.coord=new Oe(e),this.segmentIndex=n,this._segmentOctant=r,this._isInterior=!e.equals2D(t.getCoordinate(n))};_u.prototype.getCoordinate=function(){return this.coord};_u.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)};_u.prototype.compareTo=function(t){var e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:xo.compare(this._segmentOctant,this.coord,e.coord)};_u.prototype.isEndPoint=function(t){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===t};_u.prototype.isInterior=function(){return this._isInterior};_u.prototype.interfaces_=function(){return[Cs]};_u.prototype.getClass=function(){return _u};var co=function(){this._nodeMap=new Xi,this._edge=null;var t=arguments[0];this._edge=t};co.prototype.getSplitCoordinates=function(){var t=this,e=new Tm;this.addEndpoints();for(var n=this.iterator(),r=n.next();n.hasNext();){var i=n.next();t.addEdgeCoordinates(r,i,e),r=i}return e.toCoordinateArray()};co.prototype.addCollapsedNodes=function(){var t=this,e=new vt;this.findCollapsesFromInsertedNodes(e),this.findCollapsesFromExistingVertices(e);for(var n=e.iterator();n.hasNext();){var r=n.next().intValue();t.add(t._edge.getCoordinate(r),r)}};co.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();){var n=e.next();n.print(t)}};co.prototype.findCollapsesFromExistingVertices=function(t){for(var e=this,n=0;n<this._edge.size()-2;n++){var r=e._edge.getCoordinate(n),i=e._edge.getCoordinate(n+2);r.equals2D(i)&&t.add(new Sa(n+1))}};co.prototype.addEdgeCoordinates=function(t,e,n){var r=this,i=this._edge.getCoordinate(e.segmentIndex),o=e.isInterior()||!e.coord.equals2D(i);n.add(new Oe(t.coord),!1);for(var c=t.segmentIndex+1;c<=e.segmentIndex;c++)n.add(r._edge.getCoordinate(c));o&&n.add(new Oe(e.coord))};co.prototype.iterator=function(){return this._nodeMap.values().iterator()};co.prototype.addSplitEdges=function(t){var e=this;this.addEndpoints(),this.addCollapsedNodes();for(var n=this.iterator(),r=n.next();n.hasNext();){var i=n.next(),o=e.createSplitEdge(r,i);t.add(o),r=i}};co.prototype.findCollapseIndex=function(t,e,n){if(!t.coord.equals2D(e.coord))return!1;var r=e.segmentIndex-t.segmentIndex;return e.isInterior()||r--,r===1?(n[0]=t.segmentIndex+1,!0):!1};co.prototype.findCollapsesFromInsertedNodes=function(t){for(var e=this,n=new Array(1).fill(null),r=this.iterator(),i=r.next();r.hasNext();){var o=r.next(),c=e.findCollapseIndex(i,o,n);c&&t.add(new Sa(n[0])),i=o}};co.prototype.getEdge=function(){return this._edge};co.prototype.addEndpoints=function(){var t=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(t),t)};co.prototype.createSplitEdge=function(t,e){var n=this,r=e.segmentIndex-t.segmentIndex+2,i=this._edge.getCoordinate(e.segmentIndex),o=e.isInterior()||!e.coord.equals2D(i);o||r--;var c=new Array(r).fill(null),l=0;c[l++]=new Oe(t.coord);for(var d=t.segmentIndex+1;d<=e.segmentIndex;d++)c[l++]=n._edge.getCoordinate(d);return o&&(c[l]=new Oe(e.coord)),new Wr(c,this._edge.getData())};co.prototype.add=function(t,e){var n=new _u(this._edge,t,e,this._edge.getSegmentOctant(e)),r=this._nodeMap.get(n);return r!==null?(yn.isTrue(r.coord.equals2D(t),"Found equal nodes with different coordinates"),r):(this._nodeMap.put(n,n),n)};co.prototype.checkSplitEdgesCorrectness=function(t){var e=this._edge.getCoordinates(),n=t.get(0),r=n.getCoordinate(0);if(!r.equals2D(e[0]))throw new kl("bad split edge start point at "+r);var i=t.get(t.size()-1),o=i.getCoordinates(),c=o[o.length-1];if(!c.equals2D(e[e.length-1]))throw new kl("bad split edge end point at "+c)};co.prototype.interfaces_=function(){return[]};co.prototype.getClass=function(){return co};var th=function(){};th.prototype.interfaces_=function(){return[]};th.prototype.getClass=function(){return th};th.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],e=arguments[1];if(t===0&&e===0)throw new wr("Cannot compute the octant for point ( "+t+", "+e+" )");var n=Math.abs(t),r=Math.abs(e);return t>=0?e>=0?n>=r?0:1:n>=r?7:6:e>=0?n>=r?3:2:n>=r?4:5}else if(arguments[0]instanceof Oe&&arguments[1]instanceof Oe){var i=arguments[0],o=arguments[1],c=o.x-i.x,l=o.y-i.y;if(c===0&&l===0)throw new wr("Cannot compute the octant for two identical points "+i);return th.octant(c,l)}};var el=function(){};el.prototype.getCoordinates=function(){};el.prototype.size=function(){};el.prototype.getCoordinate=function(t){};el.prototype.isClosed=function(){};el.prototype.setData=function(t){};el.prototype.getData=function(){};el.prototype.interfaces_=function(){return[]};el.prototype.getClass=function(){return el};var fm=function(){};fm.prototype.addIntersection=function(t,e){};fm.prototype.interfaces_=function(){return[el]};fm.prototype.getClass=function(){return fm};var Wr=function(){this._nodeList=new co(this),this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};Wr.prototype.getCoordinates=function(){return this._pts};Wr.prototype.size=function(){return this._pts.length};Wr.prototype.getCoordinate=function(t){return this._pts[t]};Wr.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};Wr.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))};Wr.prototype.setData=function(t){this._data=t};Wr.prototype.safeOctant=function(t,e){return t.equals2D(e)?0:th.octant(t,e)};Wr.prototype.getData=function(){return this._data};Wr.prototype.addIntersection=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(arguments.length===4){var n=arguments[0],r=arguments[1],i=arguments[3],o=new Oe(n.getIntersection(i));this.addIntersection(o,r)}};Wr.prototype.toString=function(){return Gs.toLineString(new Ur(this._pts))};Wr.prototype.getNodeList=function(){return this._nodeList};Wr.prototype.addIntersectionNode=function(t,e){var n=e,r=n+1;if(r<this._pts.length){var i=this._pts[r];t.equals2D(i)&&(n=r)}var o=this._nodeList.add(t,n);return o};Wr.prototype.addIntersections=function(t,e,n){for(var r=this,i=0;i<t.getIntersectionNum();i++)r.addIntersection(t,e,n,i)};Wr.prototype.interfaces_=function(){return[fm]};Wr.prototype.getClass=function(){return Wr};Wr.getNodedSubstrings=function(){if(arguments.length===1){var t=arguments[0],e=new vt;return Wr.getNodedSubstrings(t,e),e}else if(arguments.length===2)for(var n=arguments[0],r=arguments[1],i=n.iterator();i.hasNext();){var o=i.next();o.getNodeList().addSplitEdges(r)}};var Zt=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new Oe,this.p1=new Oe;else if(arguments.length===1){var t=arguments[0];this.p0=new Oe(t.p0),this.p1=new Oe(t.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var e=arguments[0],n=arguments[1],r=arguments[2],i=arguments[3];this.p0=new Oe(e,n),this.p1=new Oe(r,i)}},YC={serialVersionUID:{configurable:!0}};Zt.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};Zt.prototype.orientationIndex=function(){if(arguments[0]instanceof Zt){var t=arguments[0],e=Tt.orientationIndex(this.p0,this.p1,t.p0),n=Tt.orientationIndex(this.p0,this.p1,t.p1);return e>=0&&n>=0||e<=0&&n<=0?Math.max(e,n):0}else if(arguments[0]instanceof Oe){var r=arguments[0];return Tt.orientationIndex(this.p0,this.p1,r)}};Zt.prototype.toGeometry=function(t){return t.createLineString([this.p0,this.p1])};Zt.prototype.isVertical=function(){return this.p0.x===this.p1.x};Zt.prototype.equals=function(t){if(!(t instanceof Zt))return!1;var e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)};Zt.prototype.intersection=function(t){var e=new gc;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null};Zt.prototype.project=function(){if(arguments[0]instanceof Oe){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new Oe(t);var e=this.projectionFactor(t),n=new Oe;return n.x=this.p0.x+e*(this.p1.x-this.p0.x),n.y=this.p0.y+e*(this.p1.y-this.p0.y),n}else if(arguments[0]instanceof Zt){var r=arguments[0],i=this.projectionFactor(r.p0),o=this.projectionFactor(r.p1);if(i>=1&&o>=1||i<=0&&o<=0)return null;var c=this.project(r.p0);i<0&&(c=this.p0),i>1&&(c=this.p1);var l=this.project(r.p1);return o<0&&(l=this.p0),o>1&&(l=this.p1),new Zt(c,l)}};Zt.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};Zt.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};Zt.prototype.getCoordinate=function(t){return t===0?this.p0:this.p1};Zt.prototype.distancePerpendicular=function(t){return Tt.distancePointLinePerpendicular(t,this.p0,this.p1)};Zt.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};Zt.prototype.midPoint=function(){return Zt.midPoint(this.p0,this.p1)};Zt.prototype.projectionFactor=function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var e=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,r=e*e+n*n;if(r<=0)return cn.NaN;var i=((t.x-this.p0.x)*e+(t.y-this.p0.y)*n)/r;return i};Zt.prototype.closestPoints=function(t){var e=this.intersection(t);if(e!==null)return[e,e];var n=new Array(2).fill(null),r=cn.MAX_VALUE,i=null,o=this.closestPoint(t.p0);r=o.distance(t.p0),n[0]=o,n[1]=t.p0;var c=this.closestPoint(t.p1);i=c.distance(t.p1),i<r&&(r=i,n[0]=c,n[1]=t.p1);var l=t.closestPoint(this.p0);i=l.distance(this.p0),i<r&&(r=i,n[0]=this.p0,n[1]=l);var d=t.closestPoint(this.p1);return i=d.distance(this.p1),i<r&&(r=i,n[0]=this.p1,n[1]=d),n};Zt.prototype.closestPoint=function(t){var e=this.projectionFactor(t);if(e>0&&e<1)return this.project(t);var n=this.p0.distance(t),r=this.p1.distance(t);return n<r?this.p0:this.p1};Zt.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};Zt.prototype.getLength=function(){return this.p0.distance(this.p1)};Zt.prototype.compareTo=function(t){var e=t,n=this.p0.compareTo(e.p0);return n!==0?n:this.p1.compareTo(e.p1)};Zt.prototype.reverse=function(){var t=this.p0;this.p0=this.p1,this.p1=t};Zt.prototype.equalsTopo=function(t){return this.p0.equals(t.p0)&&(this.p1.equals(t.p1)||this.p0.equals(t.p1))&&this.p1.equals(t.p0)};Zt.prototype.lineIntersection=function(t){try{var e=Us.intersection(this.p0,this.p1,t.p0,t.p1);return e}catch(n){if(!(n instanceof yp))throw n}finally{}return null};Zt.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};Zt.prototype.pointAlongOffset=function(t,e){var n=this.p0.x+t*(this.p1.x-this.p0.x),r=this.p0.y+t*(this.p1.y-this.p0.y),i=this.p1.x-this.p0.x,o=this.p1.y-this.p0.y,c=Math.sqrt(i*i+o*o),l=0,d=0;if(e!==0){if(c<=0)throw new Error("Cannot compute offset from zero-length line segment");l=e*i/c,d=e*o/c}var y=n-d,S=r+l,E=new Oe(y,S);return E};Zt.prototype.setCoordinates=function(){if(arguments.length===1){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this.p0.x=e.x,this.p0.y=e.y,this.p1.x=n.x,this.p1.y=n.y}};Zt.prototype.segmentFraction=function(t){var e=this.projectionFactor(t);return e<0?e=0:(e>1||cn.isNaN(e))&&(e=1),e};Zt.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};Zt.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};Zt.prototype.distance=function(){if(arguments[0]instanceof Zt){var t=arguments[0];return Tt.distanceLineLine(this.p0,this.p1,t.p0,t.p1)}else if(arguments[0]instanceof Oe){var e=arguments[0];return Tt.distancePointLine(e,this.p0,this.p1)}};Zt.prototype.pointAlong=function(t){var e=new Oe;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e};Zt.prototype.hashCode=function(){var t=cn.doubleToLongBits(this.p0.x);t^=cn.doubleToLongBits(this.p0.y)*31;var e=Math.trunc(t)^Math.trunc(t>>32),n=cn.doubleToLongBits(this.p1.x);n^=cn.doubleToLongBits(this.p1.y)*31;var r=Math.trunc(n)^Math.trunc(n>>32);return e^r};Zt.prototype.interfaces_=function(){return[Cs,Ts]};Zt.prototype.getClass=function(){return Zt};Zt.midPoint=function(t,e){return new Oe((t.x+e.x)/2,(t.y+e.y)/2)};YC.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(Zt,YC);var pm=function(){this.tempEnv1=new Wt,this.tempEnv2=new Wt,this._overlapSeg1=new Zt,this._overlapSeg2=new Zt};pm.prototype.overlap=function(){if(arguments.length!==2&&arguments.length===4){var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];t.getLineSegment(e,this._overlapSeg1),n.getLineSegment(r,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}};pm.prototype.interfaces_=function(){return[]};pm.prototype.getClass=function(){return pm};var Go=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this._pts=t,this._start=e,this._end=n,this._context=r};Go.prototype.getLineSegment=function(t,e){e.p0=this._pts[t],e.p1=this._pts[t+1]};Go.prototype.computeSelect=function(t,e,n,r){var i=this._pts[e],o=this._pts[n];if(r.tempEnv1.init(i,o),n-e===1)return r.select(this,e),null;if(!t.intersects(r.tempEnv1))return null;var c=Math.trunc((e+n)/2);e<c&&this.computeSelect(t,e,c,r),c<n&&this.computeSelect(t,c,n,r)};Go.prototype.getCoordinates=function(){for(var t=this,e=new Array(this._end-this._start+1).fill(null),n=0,r=this._start;r<=this._end;r++)e[n++]=t._pts[r];return e};Go.prototype.computeOverlaps=function(t,e){this.computeOverlapsInternal(this._start,this._end,t,t._start,t._end,e)};Go.prototype.setId=function(t){this._id=t};Go.prototype.select=function(t,e){this.computeSelect(t,this._start,this._end,e)};Go.prototype.getEnvelope=function(){if(this._env===null){var t=this._pts[this._start],e=this._pts[this._end];this._env=new Wt(t,e)}return this._env};Go.prototype.getEndIndex=function(){return this._end};Go.prototype.getStartIndex=function(){return this._start};Go.prototype.getContext=function(){return this._context};Go.prototype.getId=function(){return this._id};Go.prototype.computeOverlapsInternal=function(t,e,n,r,i,o){var c=this._pts[t],l=this._pts[e],d=n._pts[r],y=n._pts[i];if(e-t===1&&i-r===1)return o.overlap(this,t,n,r),null;if(o.tempEnv1.init(c,l),o.tempEnv2.init(d,y),!o.tempEnv1.intersects(o.tempEnv2))return null;var S=Math.trunc((t+e)/2),E=Math.trunc((r+i)/2);t<S&&(r<E&&this.computeOverlapsInternal(t,S,n,r,E,o),E<i&&this.computeOverlapsInternal(t,S,n,E,i,o)),S<e&&(r<E&&this.computeOverlapsInternal(S,e,n,r,E,o),E<i&&this.computeOverlapsInternal(S,e,n,E,i,o))};Go.prototype.interfaces_=function(){return[]};Go.prototype.getClass=function(){return Go};var va=function(){};va.prototype.interfaces_=function(){return[]};va.prototype.getClass=function(){return va};va.getChainStartIndices=function(t){var e=0,n=new vt;n.add(new Sa(e));do{var r=va.findChainEnd(t,e);n.add(new Sa(r)),e=r}while(e<t.length-1);var i=va.toIntArray(n);return i};va.findChainEnd=function(t,e){for(var n=e;n<t.length-1&&t[n].equals2D(t[n+1]);)n++;if(n>=t.length-1)return t.length-1;for(var r=Jn.quadrant(t[n],t[n+1]),i=e+1;i<t.length;){if(!t[i-1].equals2D(t[i])){var o=Jn.quadrant(t[i-1],t[i]);if(o!==r)break}i++}return i-1};va.getChains=function(){if(arguments.length===1){var t=arguments[0];return va.getChains(t,null)}else if(arguments.length===2){for(var e=arguments[0],n=arguments[1],r=new vt,i=va.getChainStartIndices(e),o=0;o<i.length-1;o++){var c=new Go(e,i[o],i[o+1],n);r.add(c)}return r}};va.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e};var oc=function(){};oc.prototype.computeNodes=function(t){};oc.prototype.getNodedSubstrings=function(){};oc.prototype.interfaces_=function(){return[]};oc.prototype.getClass=function(){return oc};var dm=function(){if(this._segInt=null,arguments.length!==0&&arguments.length===1){var t=arguments[0];this.setSegmentIntersector(t)}};dm.prototype.setSegmentIntersector=function(t){this._segInt=t};dm.prototype.interfaces_=function(){return[oc]};dm.prototype.getClass=function(){return dm};var nb=function(t){function e(r){r?t.call(this,r):t.call(this),this._monoChains=new vt,this._index=new XC,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={SegmentOverlapAction:{configurable:!0}};return e.prototype.getMonotoneChains=function(){return this._monoChains},e.prototype.getNodedSubstrings=function(){return Wr.getNodedSubstrings(this._nodedSegStrings)},e.prototype.getIndex=function(){return this._index},e.prototype.add=function(r){for(var i=this,o=va.getChains(r.getCoordinates(),r),c=o.iterator();c.hasNext();){var l=c.next();l.setId(i._idCounter++),i._index.insert(l.getEnvelope(),l),i._monoChains.add(l)}},e.prototype.computeNodes=function(r){var i=this;this._nodedSegStrings=r;for(var o=r.iterator();o.hasNext();)i.add(o.next());this.intersectChains()},e.prototype.intersectChains=function(){for(var r=this,i=new sS(this._segInt),o=this._monoChains.iterator();o.hasNext();)for(var c=o.next(),l=r._index.query(c.getEnvelope()),d=l.iterator();d.hasNext();){var y=d.next();if(y.getId()>c.getId()&&(c.computeOverlaps(y,i),r._nOverlaps++),r._segInt.isDone())return null}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.SegmentOverlapAction.get=function(){return sS},Object.defineProperties(e,n),e}(dm),sS=function(t){function e(){t.call(this),this._si=null;var n=arguments[0];this._si=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.overlap=function(){if(arguments.length===4){var n=arguments[0],r=arguments[1],i=arguments[2],o=arguments[3],c=n.getContext(),l=i.getContext();this._si.processIntersections(c,r,l,o)}else return t.prototype.overlap.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(pm),qn=function t(){if(this._quadrantSegments=t.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=t.CAP_ROUND,this._joinStyle=t.JOIN_ROUND,this._mitreLimit=t.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=t.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this.setQuadrantSegments(e)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(r)}else if(arguments.length===4){var i=arguments[0],o=arguments[1],c=arguments[2],l=arguments[3];this.setQuadrantSegments(i),this.setEndCapStyle(o),this.setJoinStyle(c),this.setMitreLimit(l)}}},Ul={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};qn.prototype.getEndCapStyle=function(){return this._endCapStyle};qn.prototype.isSingleSided=function(){return this._isSingleSided};qn.prototype.setQuadrantSegments=function(t){this._quadrantSegments=t,this._quadrantSegments===0&&(this._joinStyle=qn.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=qn.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==qn.JOIN_ROUND&&(this._quadrantSegments=qn.DEFAULT_QUADRANT_SEGMENTS)};qn.prototype.getJoinStyle=function(){return this._joinStyle};qn.prototype.setJoinStyle=function(t){this._joinStyle=t};qn.prototype.setSimplifyFactor=function(t){this._simplifyFactor=t<0?0:t};qn.prototype.getSimplifyFactor=function(){return this._simplifyFactor};qn.prototype.getQuadrantSegments=function(){return this._quadrantSegments};qn.prototype.setEndCapStyle=function(t){this._endCapStyle=t};qn.prototype.getMitreLimit=function(){return this._mitreLimit};qn.prototype.setMitreLimit=function(t){this._mitreLimit=t};qn.prototype.setSingleSided=function(t){this._isSingleSided=t};qn.prototype.interfaces_=function(){return[]};qn.prototype.getClass=function(){return qn};qn.bufferDistanceError=function(t){var e=Math.PI/2/t;return 1-Math.cos(e/2)};Ul.CAP_ROUND.get=function(){return 1};Ul.CAP_FLAT.get=function(){return 2};Ul.CAP_SQUARE.get=function(){return 3};Ul.JOIN_ROUND.get=function(){return 1};Ul.JOIN_MITRE.get=function(){return 2};Ul.JOIN_BEVEL.get=function(){return 3};Ul.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};Ul.DEFAULT_MITRE_LIMIT.get=function(){return 5};Ul.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(qn,Ul);var Nr=function(t){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=Tt.COUNTERCLOCKWISE,this._inputLine=t||null},Mm={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Nr.prototype.isDeletable=function(t,e,n,r){var i=this._inputLine[t],o=this._inputLine[e],c=this._inputLine[n];return!this.isConcave(i,o,c)||!this.isShallow(i,o,c,r)?!1:this.isShallowSampled(i,o,t,n,r)};Nr.prototype.deleteShallowConcavities=function(){for(var t=this,e=1,n=this.findNextNonDeletedIndex(e),r=this.findNextNonDeletedIndex(n),i=!1;r<this._inputLine.length;){var o=!1;t.isDeletable(e,n,r,t._distanceTol)&&(t._isDeleted[n]=Nr.DELETE,o=!0,i=!0),o?e=r:e=n,n=t.findNextNonDeletedIndex(e),r=t.findNextNonDeletedIndex(n)}return i};Nr.prototype.isShallowConcavity=function(t,e,n,r){var i=Tt.computeOrientation(t,e,n),o=i===this._angleOrientation;if(!o)return!1;var c=Tt.distancePointLine(e,t,n);return c<r};Nr.prototype.isShallowSampled=function(t,e,n,r,i){var o=this,c=Math.trunc((r-n)/Nr.NUM_PTS_TO_CHECK);c<=0&&(c=1);for(var l=n;l<r;l+=c)if(!o.isShallow(t,e,o._inputLine[l],i))return!1;return!0};Nr.prototype.isConcave=function(t,e,n){var r=Tt.computeOrientation(t,e,n),i=r===this._angleOrientation;return i};Nr.prototype.simplify=function(t){var e=this;this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=Tt.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var n=!1;do n=e.deleteShallowConcavities();while(n);return this.collapseLine()};Nr.prototype.findNextNonDeletedIndex=function(t){for(var e=t+1;e<this._inputLine.length&&this._isDeleted[e]===Nr.DELETE;)e++;return e};Nr.prototype.isShallow=function(t,e,n,r){var i=Tt.distancePointLine(e,t,n);return i<r};Nr.prototype.collapseLine=function(){for(var t=this,e=new Tm,n=0;n<this._inputLine.length;n++)t._isDeleted[n]!==Nr.DELETE&&e.add(t._inputLine[n]);return e.toCoordinateArray()};Nr.prototype.interfaces_=function(){return[]};Nr.prototype.getClass=function(){return Nr};Nr.simplify=function(t,e){var n=new Nr(t);return n.simplify(e)};Mm.INIT.get=function(){return 0};Mm.DELETE.get=function(){return 1};Mm.KEEP.get=function(){return 1};Mm.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(Nr,Mm);var ls=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new vt},$C={COORDINATE_ARRAY_TYPE:{configurable:!0}};ls.prototype.getCoordinates=function(){var t=this._ptList.toArray(ls.COORDINATE_ARRAY_TYPE);return t};ls.prototype.setPrecisionModel=function(t){this._precisionModel=t};ls.prototype.addPt=function(t){var e=new Oe(t);if(this._precisionModel.makePrecise(e),this.isRedundant(e))return null;this._ptList.add(e)};ls.prototype.revere=function(){};ls.prototype.addPts=function(t,e){var n=this;if(e)for(var r=0;r<t.length;r++)n.addPt(t[r]);else for(var i=t.length-1;i>=0;i--)n.addPt(t[i])};ls.prototype.isRedundant=function(t){if(this._ptList.size()<1)return!1;var e=this._ptList.get(this._ptList.size()-1),n=t.distance(e);return n<this._minimimVertexDistance};ls.prototype.toString=function(){var t=new Mn,e=t.createLineString(this.getCoordinates());return e.toString()};ls.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var t=new Oe(this._ptList.get(0)),e=this._ptList.get(this._ptList.size()-1);if(t.equals(e))return null;this._ptList.add(t)};ls.prototype.setMinimumVertexDistance=function(t){this._minimimVertexDistance=t};ls.prototype.interfaces_=function(){return[]};ls.prototype.getClass=function(){return ls};$C.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties(ls,$C);var Dn=function(){},yh={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Dn.prototype.interfaces_=function(){return[]};Dn.prototype.getClass=function(){return Dn};Dn.toDegrees=function(t){return t*180/Math.PI};Dn.normalize=function(t){for(;t>Math.PI;)t-=Dn.PI_TIMES_2;for(;t<=-Math.PI;)t+=Dn.PI_TIMES_2;return t};Dn.angle=function(){if(arguments.length===1){var t=arguments[0];return Math.atan2(t.y,t.x)}else if(arguments.length===2){var e=arguments[0],n=arguments[1],r=n.x-e.x,i=n.y-e.y;return Math.atan2(i,r)}};Dn.isAcute=function(t,e,n){var r=t.x-e.x,i=t.y-e.y,o=n.x-e.x,c=n.y-e.y,l=r*o+i*c;return l>0};Dn.isObtuse=function(t,e,n){var r=t.x-e.x,i=t.y-e.y,o=n.x-e.x,c=n.y-e.y,l=r*o+i*c;return l<0};Dn.interiorAngle=function(t,e,n){var r=Dn.angle(e,t),i=Dn.angle(e,n);return Math.abs(i-r)};Dn.normalizePositive=function(t){if(t<0){for(;t<0;)t+=Dn.PI_TIMES_2;t>=Dn.PI_TIMES_2&&(t=0)}else{for(;t>=Dn.PI_TIMES_2;)t-=Dn.PI_TIMES_2;t<0&&(t=0)}return t};Dn.angleBetween=function(t,e,n){var r=Dn.angle(e,t),i=Dn.angle(e,n);return Dn.diff(r,i)};Dn.diff=function(t,e){var n=null;return t<e?n=e-t:n=t-e,n>Math.PI&&(n=2*Math.PI-n),n};Dn.toRadians=function(t){return t*Math.PI/180};Dn.getTurn=function(t,e){var n=Math.sin(e-t);return n>0?Dn.COUNTERCLOCKWISE:n<0?Dn.CLOCKWISE:Dn.NONE};Dn.angleBetweenOriented=function(t,e,n){var r=Dn.angle(e,t),i=Dn.angle(e,n),o=i-r;return o<=-Math.PI?o+Dn.PI_TIMES_2:o>Math.PI?o-Dn.PI_TIMES_2:o};yh.PI_TIMES_2.get=function(){return 2*Math.PI};yh.PI_OVER_2.get=function(){return Math.PI/2};yh.PI_OVER_4.get=function(){return Math.PI/4};yh.COUNTERCLOCKWISE.get=function(){return Tt.COUNTERCLOCKWISE};yh.CLOCKWISE.get=function(){return Tt.CLOCKWISE};yh.NONE.get=function(){return Tt.COLLINEAR};Object.defineProperties(Dn,yh);var _r=function t(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Zt,this._seg1=new Zt,this._offset0=new Zt,this._offset1=new Zt,this._side=0,this._hasNarrowConcaveAngle=!1;var e=arguments[0],n=arguments[1],r=arguments[2];this._precisionModel=e,this._bufParams=n,this._li=new gc,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===qn.JOIN_ROUND&&(this._closingSegLengthFactor=t.MAX_CLOSING_SEG_LEN_FACTOR),this.init(r)},km={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};_r.prototype.addNextSegment=function(t,e){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=Tt.computeOrientation(this._s0,this._s1,this._s2),r=n===Tt.CLOCKWISE&&this._side===ut.LEFT||n===Tt.COUNTERCLOCKWISE&&this._side===ut.RIGHT;n===0?this.addCollinear(e):r?this.addOutsideTurn(n,e):this.addInsideTurn(n,e)};_r.prototype.addLineEndCap=function(t,e){var n=new Zt(t,e),r=new Zt;this.computeOffsetSegment(n,ut.LEFT,this._distance,r);var i=new Zt;this.computeOffsetSegment(n,ut.RIGHT,this._distance,i);var o=e.x-t.x,c=e.y-t.y,l=Math.atan2(c,o);switch(this._bufParams.getEndCapStyle()){case qn.CAP_ROUND:this._segList.addPt(r.p1),this.addFilletArc(e,l+Math.PI/2,l-Math.PI/2,Tt.CLOCKWISE,this._distance),this._segList.addPt(i.p1);break;case qn.CAP_FLAT:this._segList.addPt(r.p1),this._segList.addPt(i.p1);break;case qn.CAP_SQUARE:var d=new Oe;d.x=Math.abs(this._distance)*Math.cos(l),d.y=Math.abs(this._distance)*Math.sin(l);var y=new Oe(r.p1.x+d.x,r.p1.y+d.y),S=new Oe(i.p1.x+d.x,i.p1.y+d.y);this._segList.addPt(y),this._segList.addPt(S);break}};_r.prototype.getCoordinates=function(){var t=this._segList.getCoordinates();return t};_r.prototype.addMitreJoin=function(t,e,n,r){var i=!0,o=null;try{o=Us.intersection(e.p0,e.p1,n.p0,n.p1);var c=r<=0?1:o.distance(t)/Math.abs(r);c>this._bufParams.getMitreLimit()&&(i=!1)}catch(l){if(l instanceof yp)o=new Oe(0,0),i=!1;else throw l}finally{}i?this._segList.addPt(o):this.addLimitedMitreJoin(e,n,r,this._bufParams.getMitreLimit())};_r.prototype.addFilletCorner=function(t,e,n,r,i){var o=e.x-t.x,c=e.y-t.y,l=Math.atan2(c,o),d=n.x-t.x,y=n.y-t.y,S=Math.atan2(y,d);r===Tt.CLOCKWISE?l<=S&&(l+=2*Math.PI):l>=S&&(l-=2*Math.PI),this._segList.addPt(e),this.addFilletArc(t,l,S,r,i),this._segList.addPt(n)};_r.prototype.addOutsideTurn=function(t,e){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*_r.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===qn.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===qn.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(e&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))};_r.prototype.createSquare=function(t){this._segList.addPt(new Oe(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new Oe(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new Oe(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new Oe(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()};_r.prototype.addSegments=function(t,e){this._segList.addPts(t,e)};_r.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};_r.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};_r.prototype.initSideSegments=function(t,e,n){this._s1=t,this._s2=e,this._side=n,this._seg1.setCoordinates(t,e),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)};_r.prototype.addLimitedMitreJoin=function(t,e,n,r){var i=this._seg0.p1,o=Dn.angle(i,this._seg0.p0),c=Dn.angleBetweenOriented(this._seg0.p0,i,this._seg1.p1),l=c/2,d=Dn.normalize(o+l),y=Dn.normalize(d+Math.PI),S=r*n,E=S*Math.abs(Math.sin(l)),C=n-E,A=i.x+S*Math.cos(y),M=i.y+S*Math.sin(y),R=new Oe(A,M),N=new Zt(i,R),B=N.pointAlongOffset(1,C),O=N.pointAlongOffset(1,-C);this._side===ut.LEFT?(this._segList.addPt(B),this._segList.addPt(O)):(this._segList.addPt(O),this._segList.addPt(B))};_r.prototype.computeOffsetSegment=function(t,e,n,r){var i=e===ut.LEFT?1:-1,o=t.p1.x-t.p0.x,c=t.p1.y-t.p0.y,l=Math.sqrt(o*o+c*c),d=i*n*o/l,y=i*n*c/l;r.p0.x=t.p0.x-y,r.p0.y=t.p0.y+d,r.p1.x=t.p1.x-y,r.p1.y=t.p1.y+d};_r.prototype.addFilletArc=function(t,e,n,r,i){var o=this,c=r===Tt.CLOCKWISE?-1:1,l=Math.abs(e-n),d=Math.trunc(l/this._filletAngleQuantum+.5);if(d<1)return null;for(var y=0,S=l/d,E=y,C=new Oe;E<l;){var A=e+c*E;C.x=t.x+i*Math.cos(A),C.y=t.y+i*Math.sin(A),o._segList.addPt(C),E+=S}};_r.prototype.addInsideTurn=function(t,e){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*_r.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var n=new Oe((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n);var r=new Oe((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};_r.prototype.createCircle=function(t){var e=new Oe(t.x+this._distance,t.y);this._segList.addPt(e),this.addFilletArc(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};_r.prototype.addBevelJoin=function(t,e){this._segList.addPt(t.p1),this._segList.addPt(e.p0)};_r.prototype.init=function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new ls,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*_r.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};_r.prototype.addCollinear=function(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var e=this._li.getIntersectionNum();e>=2&&(this._bufParams.getJoinStyle()===qn.JOIN_BEVEL||this._bufParams.getJoinStyle()===qn.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,Tt.CLOCKWISE,this._distance))};_r.prototype.closeRing=function(){this._segList.closeRing()};_r.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};_r.prototype.interfaces_=function(){return[]};_r.prototype.getClass=function(){return _r};km.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};km.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};km.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};km.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(_r,km);var So=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var t=arguments[0],e=arguments[1];this._precisionModel=t,this._bufParams=e};So.prototype.getOffsetCurve=function(t,e){if(this._distance=e,e===0)return null;var n=e<0,r=Math.abs(e),i=this.getSegGen(r);t.length<=1?this.computePointCurve(t[0],i):this.computeOffsetCurve(t,n,i);var o=i.getCoordinates();return n&&kn.reverse(o),o};So.prototype.computeSingleSidedBufferCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);if(e){n.addSegments(t,!0);var i=Nr.simplify(t,-r),o=i.length-1;n.initSideSegments(i[o],i[o-1],ut.LEFT),n.addFirstSegment();for(var c=o-2;c>=0;c--)n.addNextSegment(i[c],!0)}else{n.addSegments(t,!1);var l=Nr.simplify(t,r),d=l.length-1;n.initSideSegments(l[0],l[1],ut.LEFT),n.addFirstSegment();for(var y=2;y<=d;y++)n.addNextSegment(l[y],!0)}n.addLastSegment(),n.closeRing()};So.prototype.computeRingBufferCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);e===ut.RIGHT&&(r=-r);var i=Nr.simplify(t,r),o=i.length-1;n.initSideSegments(i[o-1],i[0],e);for(var c=1;c<=o;c++){var l=c!==1;n.addNextSegment(i[c],l)}n.closeRing()};So.prototype.computeLineBufferCurve=function(t,e){var n=this.simplifyTolerance(this._distance),r=Nr.simplify(t,n),i=r.length-1;e.initSideSegments(r[0],r[1],ut.LEFT);for(var o=2;o<=i;o++)e.addNextSegment(r[o],!0);e.addLastSegment(),e.addLineEndCap(r[i-1],r[i]);var c=Nr.simplify(t,-n),l=c.length-1;e.initSideSegments(c[l],c[l-1],ut.LEFT);for(var d=l-2;d>=0;d--)e.addNextSegment(c[d],!0);e.addLastSegment(),e.addLineEndCap(c[1],c[0]),e.closeRing()};So.prototype.computePointCurve=function(t,e){switch(this._bufParams.getEndCapStyle()){case qn.CAP_ROUND:e.createCircle(t);break;case qn.CAP_SQUARE:e.createSquare(t);break}};So.prototype.getLineCurve=function(t,e){if(this._distance=e,e<0&&!this._bufParams.isSingleSided()||e===0)return null;var n=Math.abs(e),r=this.getSegGen(n);if(t.length<=1)this.computePointCurve(t[0],r);else if(this._bufParams.isSingleSided()){var i=e<0;this.computeSingleSidedBufferCurve(t,i,r)}else this.computeLineBufferCurve(t,r);var o=r.getCoordinates();return o};So.prototype.getBufferParameters=function(){return this._bufParams};So.prototype.simplifyTolerance=function(t){return t*this._bufParams.getSimplifyFactor()};So.prototype.getRingCurve=function(t,e,n){if(this._distance=n,t.length<=2)return this.getLineCurve(t,n);if(n===0)return So.copyCoordinates(t);var r=this.getSegGen(n);return this.computeRingBufferCurve(t,e,r),r.getCoordinates()};So.prototype.computeOffsetCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);if(e){var i=Nr.simplify(t,-r),o=i.length-1;n.initSideSegments(i[o],i[o-1],ut.LEFT),n.addFirstSegment();for(var c=o-2;c>=0;c--)n.addNextSegment(i[c],!0)}else{var l=Nr.simplify(t,r),d=l.length-1;n.initSideSegments(l[0],l[1],ut.LEFT),n.addFirstSegment();for(var y=2;y<=d;y++)n.addNextSegment(l[y],!0)}n.addLastSegment()};So.prototype.getSegGen=function(t){return new _r(this._precisionModel,this._bufParams,t)};So.prototype.interfaces_=function(){return[]};So.prototype.getClass=function(){return So};So.copyCoordinates=function(t){for(var e=new Array(t.length).fill(null),n=0;n<e.length;n++)e[n]=new Oe(t[n]);return e};var nh=function(){this._subgraphs=null,this._seg=new Zt,this._cga=new Tt;var t=arguments[0];this._subgraphs=t},KC={DepthSegment:{configurable:!0}};nh.prototype.findStabbedSegments=function(){var t=this;if(arguments.length===1){for(var e=arguments[0],n=new vt,r=this._subgraphs.iterator();r.hasNext();){var i=r.next(),o=i.getEnvelope();e.y<o.getMinY()||e.y>o.getMaxY()||t.findStabbedSegments(e,i.getDirectedEdges(),n)}return n}else if(arguments.length===3){if(rn(arguments[2],js)&&arguments[0]instanceof Oe&&arguments[1]instanceof Qv)for(var c=arguments[0],l=arguments[1],d=arguments[2],y=l.getEdge().getCoordinates(),S=0;S<y.length-1;S++){t._seg.p0=y[S],t._seg.p1=y[S+1],t._seg.p0.y>t._seg.p1.y&&t._seg.reverse();var E=Math.max(t._seg.p0.x,t._seg.p1.x);if(!(E<c.x)&&!t._seg.isHorizontal()&&!(c.y<t._seg.p0.y||c.y>t._seg.p1.y)&&Tt.computeOrientation(t._seg.p0,t._seg.p1,c)!==Tt.RIGHT){var C=l.getDepth(ut.LEFT);t._seg.p0.equals(y[S])||(C=l.getDepth(ut.RIGHT));var A=new sc(t._seg,C);d.add(A)}}else if(rn(arguments[2],js)&&arguments[0]instanceof Oe&&rn(arguments[1],js))for(var M=arguments[0],R=arguments[1],N=arguments[2],B=R.iterator();B.hasNext();){var O=B.next();O.isForward()&&t.findStabbedSegments(M,O,N)}}};nh.prototype.getDepth=function(t){var e=this.findStabbedSegments(t);if(e.size()===0)return 0;var n=Hs.min(e);return n._leftDepth};nh.prototype.interfaces_=function(){return[]};nh.prototype.getClass=function(){return nh};KC.DepthSegment.get=function(){return sc};Object.defineProperties(nh,KC);var sc=function(){this._upwardSeg=null,this._leftDepth=null;var t=arguments[0],e=arguments[1];this._upwardSeg=new Zt(t),this._leftDepth=e};sc.prototype.compareTo=function(t){var e=t;if(this._upwardSeg.minX()>=e._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=e._upwardSeg.minX())return-1;var n=this._upwardSeg.orientationIndex(e._upwardSeg);return n!==0||(n=-1*e._upwardSeg.orientationIndex(this._upwardSeg),n!==0)?n:this._upwardSeg.compareTo(e._upwardSeg)};sc.prototype.compareX=function(t,e){var n=t.p0.compareTo(e.p0);return n!==0?n:t.p1.compareTo(e.p1)};sc.prototype.toString=function(){return this._upwardSeg.toString()};sc.prototype.interfaces_=function(){return[Cs]};sc.prototype.getClass=function(){return sc};var Hn=function(t,e,n){this.p0=t||null,this.p1=e||null,this.p2=n||null};Hn.prototype.area=function(){return Hn.area(this.p0,this.p1,this.p2)};Hn.prototype.signedArea=function(){return Hn.signedArea(this.p0,this.p1,this.p2)};Hn.prototype.interpolateZ=function(t){if(t===null)throw new wr("Supplied point is null.");return Hn.interpolateZ(t,this.p0,this.p1,this.p2)};Hn.prototype.longestSideLength=function(){return Hn.longestSideLength(this.p0,this.p1,this.p2)};Hn.prototype.isAcute=function(){return Hn.isAcute(this.p0,this.p1,this.p2)};Hn.prototype.circumcentre=function(){return Hn.circumcentre(this.p0,this.p1,this.p2)};Hn.prototype.area3D=function(){return Hn.area3D(this.p0,this.p1,this.p2)};Hn.prototype.centroid=function(){return Hn.centroid(this.p0,this.p1,this.p2)};Hn.prototype.inCentre=function(){return Hn.inCentre(this.p0,this.p1,this.p2)};Hn.prototype.interfaces_=function(){return[]};Hn.prototype.getClass=function(){return Hn};Hn.area=function(t,e,n){return Math.abs(((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2)};Hn.signedArea=function(t,e,n){return((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2};Hn.det=function(t,e,n,r){return t*r-e*n};Hn.interpolateZ=function(t,e,n,r){var i=e.x,o=e.y,c=n.x-i,l=r.x-i,d=n.y-o,y=r.y-o,S=c*y-l*d,E=t.x-i,C=t.y-o,A=(y*E-l*C)/S,M=(-d*E+c*C)/S,R=e.z+A*(n.z-e.z)+M*(r.z-e.z);return R};Hn.longestSideLength=function(t,e,n){var r=t.distance(e),i=e.distance(n),o=n.distance(t),c=r;return i>c&&(c=i),o>c&&(c=o),c};Hn.isAcute=function(t,e,n){return!(!Dn.isAcute(t,e,n)||!Dn.isAcute(e,n,t)||!Dn.isAcute(n,t,e))};Hn.circumcentre=function(t,e,n){var r=n.x,i=n.y,o=t.x-r,c=t.y-i,l=e.x-r,d=e.y-i,y=2*Hn.det(o,c,l,d),S=Hn.det(c,o*o+c*c,d,l*l+d*d),E=Hn.det(o,o*o+c*c,l,l*l+d*d),C=r-S/y,A=i+E/y;return new Oe(C,A)};Hn.perpendicularBisector=function(t,e){var n=e.x-t.x,r=e.y-t.y,i=new Us(t.x+n/2,t.y+r/2,1),o=new Us(t.x-r+n/2,t.y+n+r/2,1);return new Us(i,o)};Hn.angleBisector=function(t,e,n){var r=e.distance(t),i=e.distance(n),o=r/(r+i),c=n.x-t.x,l=n.y-t.y,d=new Oe(t.x+o*c,t.y+o*l);return d};Hn.area3D=function(t,e,n){var r=e.x-t.x,i=e.y-t.y,o=e.z-t.z,c=n.x-t.x,l=n.y-t.y,d=n.z-t.z,y=i*d-o*l,S=o*c-r*d,E=r*l-i*c,C=y*y+S*S+E*E,A=Math.sqrt(C)/2;return A};Hn.centroid=function(t,e,n){var r=(t.x+e.x+n.x)/3,i=(t.y+e.y+n.y)/3;return new Oe(r,i)};Hn.inCentre=function(t,e,n){var r=e.distance(n),i=t.distance(n),o=t.distance(e),c=r+i+o,l=(r*t.x+i*e.x+o*n.x)/c,d=(r*t.y+i*e.y+o*n.y)/c;return new Oe(l,d)};var Is=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new vt;var t=arguments[0],e=arguments[1],n=arguments[2];this._inputGeom=t,this._distance=e,this._curveBuilder=n};Is.prototype.addPoint=function(t){if(this._distance<=0)return null;var e=t.getCoordinates(),n=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(n,ze.EXTERIOR,ze.INTERIOR)};Is.prototype.addPolygon=function(t){var e=this,n=this._distance,r=ut.LEFT;this._distance<0&&(n=-this._distance,r=ut.RIGHT);var i=t.getExteriorRing(),o=kn.removeRepeatedPoints(i.getCoordinates());if(this._distance<0&&this.isErodedCompletely(i,this._distance)||this._distance<=0&&o.length<3)return null;this.addPolygonRing(o,n,r,ze.EXTERIOR,ze.INTERIOR);for(var c=0;c<t.getNumInteriorRing();c++){var l=t.getInteriorRingN(c),d=kn.removeRepeatedPoints(l.getCoordinates());e._distance>0&&e.isErodedCompletely(l,-e._distance)||e.addPolygonRing(d,n,ut.opposite(r),ze.INTERIOR,ze.EXTERIOR)}};Is.prototype.isTriangleErodedCompletely=function(t,e){var n=new Hn(t[0],t[1],t[2]),r=n.inCentre(),i=Tt.distancePointLine(r,n.p0,n.p1);return i<Math.abs(e)};Is.prototype.addLineString=function(t){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var e=kn.removeRepeatedPoints(t.getCoordinates()),n=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(n,ze.EXTERIOR,ze.INTERIOR)};Is.prototype.addCurve=function(t,e,n){if(t===null||t.length<2)return null;var r=new Wr(t,new $n(0,ze.BOUNDARY,e,n));this._curveList.add(r)};Is.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};Is.prototype.addPolygonRing=function(t,e,n,r,i){if(e===0&&t.length<Ja.MINIMUM_VALID_SIZE)return null;var o=r,c=i;t.length>=Ja.MINIMUM_VALID_SIZE&&Tt.isCCW(t)&&(o=i,c=r,n=ut.opposite(n));var l=this._curveBuilder.getRingCurve(t,n,e);this.addCurve(l,o,c)};Is.prototype.add=function(t){if(t.isEmpty())return null;t instanceof ai?this.addPolygon(t):t instanceof Rr?this.addLineString(t):t instanceof Uo?this.addPoint(t):t instanceof Yf?this.addCollection(t):t instanceof ic?this.addCollection(t):t instanceof Ya?this.addCollection(t):t instanceof lo&&this.addCollection(t)};Is.prototype.isErodedCompletely=function(t,e){var n=t.getCoordinates();if(n.length<4)return e<0;if(n.length===4)return this.isTriangleErodedCompletely(n,e);var r=t.getEnvelopeInternal(),i=Math.min(r.getHeight(),r.getWidth());return e<0&&2*Math.abs(e)>i};Is.prototype.addCollection=function(t){for(var e=this,n=0;n<t.getNumGeometries();n++){var r=t.getGeometryN(n);e.add(r)}};Is.prototype.interfaces_=function(){return[]};Is.prototype.getClass=function(){return Is};var Qf=function(){};Qf.prototype.locate=function(t){};Qf.prototype.interfaces_=function(){return[]};Qf.prototype.getClass=function(){return Qf};var $a=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()};$a.prototype.next=function(){if(this._atStart)return this._atStart=!1,$a.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new bp;var t=this._parent.getGeometryN(this._index++);return t instanceof lo?(this._subcollectionIterator=new $a(t),this._subcollectionIterator.next()):t};$a.prototype.remove=function(){throw new Error(this.getClass().getName())};$a.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};$a.prototype.interfaces_=function(){return[vp]};$a.prototype.getClass=function(){return $a};$a.isAtomic=function(t){return!(t instanceof lo)};var is=function(){this._geom=null;var t=arguments[0];this._geom=t};is.prototype.locate=function(t){return is.locate(t,this._geom)};is.prototype.interfaces_=function(){return[Qf]};is.prototype.getClass=function(){return is};is.isPointInRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?Tt.isPointInRing(t,e.getCoordinates()):!1};is.containsPointInPolygon=function(t,e){if(e.isEmpty())return!1;var n=e.getExteriorRing();if(!is.isPointInRing(t,n))return!1;for(var r=0;r<e.getNumInteriorRing();r++){var i=e.getInteriorRingN(r);if(is.isPointInRing(t,i))return!1}return!0};is.containsPoint=function(t,e){if(e instanceof ai)return is.containsPointInPolygon(t,e);if(e instanceof lo)for(var n=new $a(e);n.hasNext();){var r=n.next();if(r!==e&&is.containsPoint(t,r))return!0}return!1};is.locate=function(t,e){return e.isEmpty()?ze.EXTERIOR:is.containsPoint(t,e)?ze.INTERIOR:ze.EXTERIOR};var $i=function(){this._edgeMap=new Xi,this._edgeList=null,this._ptInAreaLocation=[ze.NONE,ze.NONE]};$i.prototype.getNextCW=function(t){this.getEdges();var e=this._edgeList.indexOf(t),n=e-1;return e===0&&(n=this._edgeList.size()-1),this._edgeList.get(n)};$i.prototype.propagateSideLabels=function(t){for(var e=ze.NONE,n=this.iterator();n.hasNext();){var r=n.next(),i=r.getLabel();i.isArea(t)&&i.getLocation(t,ut.LEFT)!==ze.NONE&&(e=i.getLocation(t,ut.LEFT))}if(e===ze.NONE)return null;for(var o=e,c=this.iterator();c.hasNext();){var l=c.next(),d=l.getLabel();if(d.getLocation(t,ut.ON)===ze.NONE&&d.setLocation(t,ut.ON,o),d.isArea(t)){var y=d.getLocation(t,ut.LEFT),S=d.getLocation(t,ut.RIGHT);if(S!==ze.NONE){if(S!==o)throw new Dl("side location conflict",l.getCoordinate());y===ze.NONE&&yn.shouldNeverReachHere("found single null side (at "+l.getCoordinate()+")"),o=y}else yn.isTrue(d.getLocation(t,ut.LEFT)===ze.NONE,"found single null side"),d.setLocation(t,ut.RIGHT,o),d.setLocation(t,ut.LEFT,o)}}};$i.prototype.getCoordinate=function(){var t=this.iterator();if(!t.hasNext())return null;var e=t.next();return e.getCoordinate()};$i.prototype.print=function(t){Fi.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){var n=e.next();n.print(t)}};$i.prototype.isAreaLabelsConsistent=function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};$i.prototype.checkAreaLabelsConsistent=function(t){var e=this.getEdges();if(e.size()<=0)return!0;var n=e.size()-1,r=e.get(n).getLabel(),i=r.getLocation(t,ut.LEFT);yn.isTrue(i!==ze.NONE,"Found unlabelled area edge");for(var o=i,c=this.iterator();c.hasNext();){var l=c.next(),d=l.getLabel();yn.isTrue(d.isArea(t),"Found non-area edge");var y=d.getLocation(t,ut.LEFT),S=d.getLocation(t,ut.RIGHT);if(y===S||S!==o)return!1;o=y}return!0};$i.prototype.findIndex=function(t){var e=this;this.iterator();for(var n=0;n<this._edgeList.size();n++){var r=e._edgeList.get(n);if(r===t)return n}return-1};$i.prototype.iterator=function(){return this.getEdges().iterator()};$i.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new vt(this._edgeMap.values())),this._edgeList};$i.prototype.getLocation=function(t,e,n){return this._ptInAreaLocation[t]===ze.NONE&&(this._ptInAreaLocation[t]=is.locate(e,n[t].getGeometry())),this._ptInAreaLocation[t]};$i.prototype.toString=function(){var t=new Na;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append(`
`);for(var e=this.iterator();e.hasNext();){var n=e.next();t.append(n),t.append(`
`)}return t.toString()};$i.prototype.computeEdgeEndLabels=function(t){for(var e=this.iterator();e.hasNext();){var n=e.next();n.computeLabel(t)}};$i.prototype.computeLabelling=function(t){var e=this;this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var n=[!1,!1],r=this.iterator();r.hasNext();)for(var i=r.next(),o=i.getLabel(),c=0;c<2;c++)o.isLine(c)&&o.getLocation(c)===ze.BOUNDARY&&(n[c]=!0);for(var l=this.iterator();l.hasNext();)for(var d=l.next(),y=d.getLabel(),S=0;S<2;S++)if(y.isAnyNull(S)){var E=ze.NONE;if(n[S])E=ze.EXTERIOR;else{var C=d.getCoordinate();E=e.getLocation(S,C,t)}y.setAllLocationsIfNull(S,E)}};$i.prototype.getDegree=function(){return this._edgeMap.size()};$i.prototype.insertEdgeEnd=function(t,e){this._edgeMap.put(t,e),this._edgeList=null};$i.prototype.interfaces_=function(){return[]};$i.prototype.getClass=function(){return $i};var n5=function(t){function e(){t.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.linkResultDirectedEdges=function(){var n=this;this.getResultAreaEdges();for(var r=null,i=null,o=this._SCANNING_FOR_INCOMING,c=0;c<this._resultAreaEdgeList.size();c++){var l=n._resultAreaEdgeList.get(c),d=l.getSym();if(l.getLabel().isArea())switch(r===null&&l.isInResult()&&(r=l),o){case n._SCANNING_FOR_INCOMING:if(!d.isInResult())continue;i=d,o=n._LINKING_TO_OUTGOING;break;case n._LINKING_TO_OUTGOING:if(!l.isInResult())continue;i.setNext(l),o=n._SCANNING_FOR_INCOMING;break}}if(o===this._LINKING_TO_OUTGOING){if(r===null)throw new Dl("no outgoing dirEdge found",this.getCoordinate());yn.isTrue(r.isInResult(),"unable to link last incoming dirEdge"),i.setNext(r)}},e.prototype.insert=function(n){var r=n;this.insertEdgeEnd(r,r)},e.prototype.getRightmostEdge=function(){var n=this.getEdges(),r=n.size();if(r<1)return null;var i=n.get(0);if(r===1)return i;var o=n.get(r-1),c=i.getQuadrant(),l=o.getQuadrant();return Jn.isNorthern(c)&&Jn.isNorthern(l)?i:!Jn.isNorthern(c)&&!Jn.isNorthern(l)?o:i.getDy()!==0?i:o.getDy()!==0?o:(yn.shouldNeverReachHere("found two horizontal edges incident on node"),null)},e.prototype.print=function(n){Fi.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var r=this.iterator();r.hasNext();){var i=r.next();n.print("out "),i.print(n),n.println(),n.print("in "),i.getSym().print(n),n.println()}},e.prototype.getResultAreaEdges=function(){var n=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new vt;for(var r=this.iterator();r.hasNext();){var i=r.next();(i.isInResult()||i.getSym().isInResult())&&n._resultAreaEdgeList.add(i)}return this._resultAreaEdgeList},e.prototype.updateLabelling=function(n){for(var r=this.iterator();r.hasNext();){var i=r.next(),o=i.getLabel();o.setAllLocationsIfNull(0,n.getLocation(0)),o.setAllLocationsIfNull(1,n.getLocation(1))}},e.prototype.linkAllDirectedEdges=function(){var n=this;this.getEdges();for(var r=null,i=null,o=this._edgeList.size()-1;o>=0;o--){var c=n._edgeList.get(o),l=c.getSym();i===null&&(i=l),r!==null&&l.setNext(r),r=c}i.setNext(r)},e.prototype.computeDepths=function(){var n=this;if(arguments.length===1){var r=arguments[0],i=this.findIndex(r),o=r.getDepth(ut.LEFT),c=r.getDepth(ut.RIGHT),l=this.computeDepths(i+1,this._edgeList.size(),o),d=this.computeDepths(0,i,l);if(d!==c)throw new Dl("depth mismatch at "+r.getCoordinate())}else if(arguments.length===3){for(var y=arguments[0],S=arguments[1],E=arguments[2],C=E,A=y;A<S;A++){var M=n._edgeList.get(A);M.setEdgeDepths(ut.RIGHT,C),C=M.getDepth(ut.LEFT)}return C}},e.prototype.mergeSymLabels=function(){for(var n=this.iterator();n.hasNext();){var r=n.next(),i=r.getLabel();i.merge(r.getSym().getLabel())}},e.prototype.linkMinimalDirectedEdges=function(n){for(var r=this,i=null,o=null,c=this._SCANNING_FOR_INCOMING,l=this._resultAreaEdgeList.size()-1;l>=0;l--){var d=r._resultAreaEdgeList.get(l),y=d.getSym();switch(i===null&&d.getEdgeRing()===n&&(i=d),c){case r._SCANNING_FOR_INCOMING:if(y.getEdgeRing()!==n)continue;o=y,c=r._LINKING_TO_OUTGOING;break;case r._LINKING_TO_OUTGOING:if(d.getEdgeRing()!==n)continue;o.setNextMin(d),c=r._SCANNING_FOR_INCOMING;break}}c===this._LINKING_TO_OUTGOING&&(yn.isTrue(i!==null,"found null for first outgoing dirEdge"),yn.isTrue(i.getEdgeRing()===n,"unable to link last incoming dirEdge"),o.setNextMin(i))},e.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var n=0,r=this.iterator();r.hasNext();){var i=r.next();i.isInResult()&&n++}return n}else if(arguments.length===1){for(var o=arguments[0],c=0,l=this.iterator();l.hasNext();){var d=l.next();d.getEdgeRing()===o&&c++}return c}},e.prototype.getLabel=function(){return this._label},e.prototype.findCoveredLineEdges=function(){for(var n=ze.NONE,r=this.iterator();r.hasNext();){var i=r.next(),o=i.getSym();if(!i.isLineEdge()){if(i.isInResult()){n=ze.INTERIOR;break}if(o.isInResult()){n=ze.EXTERIOR;break}}}if(n===ze.NONE)return null;for(var c=n,l=this.iterator();l.hasNext();){var d=l.next(),y=d.getSym();d.isLineEdge()?d.getEdge().setCovered(c===ze.INTERIOR):(d.isInResult()&&(c=ze.EXTERIOR),y.isInResult()&&(c=ze.INTERIOR))}},e.prototype.computeLabelling=function(n){var r=this;t.prototype.computeLabelling.call(this,n),this._label=new $n(ze.NONE);for(var i=this.iterator();i.hasNext();)for(var o=i.next(),c=o.getEdge(),l=c.getLabel(),d=0;d<2;d++){var y=l.getLocation(d);(y===ze.INTERIOR||y===ze.BOUNDARY)&&r._label.setLocation(d,ze.INTERIOR)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}($i),JC=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createNode=function(n){return new vy(n,new n5)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}($f),yu=function t(){this._pts=null,this._orientation=null;var e=arguments[0];this._pts=e,this._orientation=t.orientation(e)};yu.prototype.compareTo=function(t){var e=t,n=yu.compareOriented(this._pts,this._orientation,e._pts,e._orientation);return n};yu.prototype.interfaces_=function(){return[Cs]};yu.prototype.getClass=function(){return yu};yu.orientation=function(t){return kn.increasingDirection(t)===1};yu.compareOriented=function(t,e,n,r){for(var i=e?1:-1,o=r?1:-1,c=e?t.length:-1,l=r?n.length:-1,d=e?0:t.length-1,y=r?0:n.length-1;;){var S=t[d].compareTo(n[y]);if(S!==0)return S;d+=i,y+=o;var E=d===c,C=y===l;if(E&&!C)return-1;if(!E&&C)return 1;if(E&&C)return 0}};var Zs=function(){this._edges=new vt,this._ocaMap=new Xi};Zs.prototype.print=function(t){var e=this;t.print("MULTILINESTRING ( ");for(var n=0;n<this._edges.size();n++){var r=e._edges.get(n);n>0&&t.print(","),t.print("(");for(var i=r.getCoordinates(),o=0;o<i.length;o++)o>0&&t.print(","),t.print(i[o].x+" "+i[o].y);t.println(")")}t.print(")  ")};Zs.prototype.addAll=function(t){for(var e=this,n=t.iterator();n.hasNext();)e.add(n.next())};Zs.prototype.findEdgeIndex=function(t){for(var e=this,n=0;n<this._edges.size();n++)if(e._edges.get(n).equals(t))return n;return-1};Zs.prototype.iterator=function(){return this._edges.iterator()};Zs.prototype.getEdges=function(){return this._edges};Zs.prototype.get=function(t){return this._edges.get(t)};Zs.prototype.findEqualEdge=function(t){var e=new yu(t.getCoordinates()),n=this._ocaMap.get(e);return n};Zs.prototype.add=function(t){this._edges.add(t);var e=new yu(t.getCoordinates());this._ocaMap.put(e,t)};Zs.prototype.interfaces_=function(){return[]};Zs.prototype.getClass=function(){return Zs};var ac=function(){};ac.prototype.processIntersections=function(t,e,n,r){};ac.prototype.isDone=function(){};ac.prototype.interfaces_=function(){return[]};ac.prototype.getClass=function(){return ac};var us=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var t=arguments[0];this._li=t};us.prototype.isTrivialIntersection=function(t,e,n,r){if(t===n&&this._li.getIntersectionNum()===1){if(us.isAdjacentSegments(e,r))return!0;if(t.isClosed()){var i=t.size()-1;if(e===0&&r===i||r===0&&e===i)return!0}}return!1};us.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};us.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};us.prototype.getLineIntersector=function(){return this._li};us.prototype.hasProperIntersection=function(){return this._hasProper};us.prototype.processIntersections=function(t,e,n,r){if(t===n&&e===r)return null;this.numTests++;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],c=n.getCoordinates()[r],l=n.getCoordinates()[r+1];this._li.computeIntersection(i,o,c,l),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,e,n,r)||(this._hasIntersection=!0,t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};us.prototype.hasIntersection=function(){return this._hasIntersection};us.prototype.isDone=function(){return!1};us.prototype.hasInteriorIntersection=function(){return this._hasInterior};us.prototype.interfaces_=function(){return[ac]};us.prototype.getClass=function(){return us};us.isAdjacentSegments=function(t,e){return Math.abs(t-e)===1};var Pa=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[0],e=arguments[1],n=arguments[2];this.coord=new Oe(t),this.segmentIndex=e,this.dist=n};Pa.prototype.getSegmentIndex=function(){return this.segmentIndex};Pa.prototype.getCoordinate=function(){return this.coord};Pa.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)};Pa.prototype.compareTo=function(t){var e=t;return this.compare(e.segmentIndex,e.dist)};Pa.prototype.isEndPoint=function(t){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===t};Pa.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};Pa.prototype.getDistance=function(){return this.dist};Pa.prototype.compare=function(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0};Pa.prototype.interfaces_=function(){return[Cs]};Pa.prototype.getClass=function(){return Pa};var tl=function(){this._nodeMap=new Xi,this.edge=null;var t=arguments[0];this.edge=t};tl.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();){var n=e.next();n.print(t)}};tl.prototype.iterator=function(){return this._nodeMap.values().iterator()};tl.prototype.addSplitEdges=function(t){var e=this;this.addEndpoints();for(var n=this.iterator(),r=n.next();n.hasNext();){var i=n.next(),o=e.createSplitEdge(r,i);t.add(o),r=i}};tl.prototype.addEndpoints=function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)};tl.prototype.createSplitEdge=function(t,e){var n=this,r=e.segmentIndex-t.segmentIndex+2,i=this.edge.pts[e.segmentIndex],o=e.dist>0||!e.coord.equals2D(i);o||r--;var c=new Array(r).fill(null),l=0;c[l++]=new Oe(t.coord);for(var d=t.segmentIndex+1;d<=e.segmentIndex;d++)c[l++]=n.edge.pts[d];return o&&(c[l]=e.coord),new V_(c,new $n(this.edge._label))};tl.prototype.add=function(t,e,n){var r=new Pa(t,e,n),i=this._nodeMap.get(r);return i!==null?i:(this._nodeMap.put(r,r),r)};tl.prototype.isIntersection=function(t){for(var e=this.iterator();e.hasNext();){var n=e.next();if(n.coord.equals(t))return!0}return!1};tl.prototype.interfaces_=function(){return[]};tl.prototype.getClass=function(){return tl};var lc=function(){};lc.prototype.getChainStartIndices=function(t){var e=this,n=0,r=new vt;r.add(new Sa(n));do{var i=e.findChainEnd(t,n);r.add(new Sa(i)),n=i}while(n<t.length-1);var o=lc.toIntArray(r);return o};lc.prototype.findChainEnd=function(t,e){for(var n=Jn.quadrant(t[e],t[e+1]),r=e+1;r<t.length;){var i=Jn.quadrant(t[r-1],t[r]);if(i!==n)break;r++}return r-1};lc.prototype.interfaces_=function(){return[]};lc.prototype.getClass=function(){return lc};lc.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e};var Nl=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new Wt,this.env2=new Wt;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var e=new lc;this.startIndex=e.getChainStartIndices(this.pts)};Nl.prototype.getCoordinates=function(){return this.pts};Nl.prototype.getMaxX=function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e>n?e:n};Nl.prototype.getMinX=function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e<n?e:n};Nl.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[n],e.startIndex[n+1],r)}else if(arguments.length===6){var i=arguments[0],o=arguments[1],c=arguments[2],l=arguments[3],d=arguments[4],y=arguments[5],S=this.pts[i],E=this.pts[o],C=c.pts[l],A=c.pts[d];if(o-i===1&&d-l===1)return y.addIntersections(this.e,i,c.e,l),null;if(this.env1.init(S,E),this.env2.init(C,A),!this.env1.intersects(this.env2))return null;var M=Math.trunc((i+o)/2),R=Math.trunc((l+d)/2);i<M&&(l<R&&this.computeIntersectsForChain(i,M,c,l,R,y),R<d&&this.computeIntersectsForChain(i,M,c,R,d,y)),M<o&&(l<R&&this.computeIntersectsForChain(M,o,c,l,R,y),R<d&&this.computeIntersectsForChain(M,o,c,R,d,y))}};Nl.prototype.getStartIndexes=function(){return this.startIndex};Nl.prototype.computeIntersects=function(t,e){for(var n=this,r=0;r<this.startIndex.length-1;r++)for(var i=0;i<t.startIndex.length-1;i++)n.computeIntersectsForChain(r,t,i,e)};Nl.prototype.interfaces_=function(){return[]};Nl.prototype.getClass=function(){return Nl};var zi=function t(){var e=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var n=0;n<2;n++)for(var r=0;r<3;r++)e._depth[n][r]=t.NULL_VALUE},QC={NULL_VALUE:{configurable:!0}};zi.prototype.getDepth=function(t,e){return this._depth[t][e]};zi.prototype.setDepth=function(t,e,n){this._depth[t][e]=n};zi.prototype.isNull=function(){var t=this;if(arguments.length===0){for(var e=0;e<2;e++)for(var n=0;n<3;n++)if(t._depth[e][n]!==zi.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var r=arguments[0];return this._depth[r][1]===zi.NULL_VALUE}else if(arguments.length===2){var i=arguments[0],o=arguments[1];return this._depth[i][o]===zi.NULL_VALUE}};zi.prototype.normalize=function(){for(var t=this,e=0;e<2;e++)if(!t.isNull(e)){var n=t._depth[e][1];t._depth[e][2]<n&&(n=t._depth[e][2]),n<0&&(n=0);for(var r=1;r<3;r++){var i=0;t._depth[e][r]>n&&(i=1),t._depth[e][r]=i}}};zi.prototype.getDelta=function(t){return this._depth[t][ut.RIGHT]-this._depth[t][ut.LEFT]};zi.prototype.getLocation=function(t,e){return this._depth[t][e]<=0?ze.EXTERIOR:ze.INTERIOR};zi.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};zi.prototype.add=function(){var t=this;if(arguments.length===1)for(var e=arguments[0],n=0;n<2;n++)for(var r=1;r<3;r++){var i=e.getLocation(n,r);(i===ze.EXTERIOR||i===ze.INTERIOR)&&(t.isNull(n,r)?t._depth[n][r]=zi.depthAtLocation(i):t._depth[n][r]+=zi.depthAtLocation(i))}else if(arguments.length===3){var o=arguments[0],c=arguments[1],l=arguments[2];l===ze.INTERIOR&&this._depth[o][c]++}};zi.prototype.interfaces_=function(){return[]};zi.prototype.getClass=function(){return zi};zi.depthAtLocation=function(t){return t===ze.EXTERIOR?0:t===ze.INTERIOR?1:zi.NULL_VALUE};QC.NULL_VALUE.get=function(){return-1};Object.defineProperties(zi,QC);var V_=function(t){function e(){if(t.call(this),this.pts=null,this._env=null,this.eiList=new tl(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new zi,this._depthDelta=0,arguments.length===1){var n=arguments[0];e.call(this,n,null)}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this.pts=r,this._label=i}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDepth=function(){return this._depth},e.prototype.getCollapsedEdge=function(){var n=new Array(2).fill(null);n[0]=this.pts[0],n[1]=this.pts[1];var r=new e(n,$n.toLineLabel(this._label));return r},e.prototype.isIsolated=function(){return this._isIsolated},e.prototype.getCoordinates=function(){return this.pts},e.prototype.setIsolated=function(n){this._isIsolated=n},e.prototype.setName=function(n){this._name=n},e.prototype.equals=function(n){var r=this;if(!(n instanceof e))return!1;var i=n;if(this.pts.length!==i.pts.length)return!1;for(var o=!0,c=!0,l=this.pts.length,d=0;d<this.pts.length;d++)if(r.pts[d].equals2D(i.pts[d])||(o=!1),r.pts[d].equals2D(i.pts[--l])||(c=!1),!o&&!c)return!1;return!0},e.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var n=arguments[0];return this.pts[n]}},e.prototype.print=function(n){var r=this;n.print("edge "+this._name+": "),n.print("LINESTRING (");for(var i=0;i<this.pts.length;i++)i>0&&n.print(","),n.print(r.pts[i].x+" "+r.pts[i].y);n.print(")  "+this._label+" "+this._depthDelta)},e.prototype.computeIM=function(n){e.updateIM(this._label,n)},e.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},e.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},e.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},e.prototype.getDepthDelta=function(){return this._depthDelta},e.prototype.getNumPoints=function(){return this.pts.length},e.prototype.printReverse=function(n){var r=this;n.print("edge "+this._name+": ");for(var i=this.pts.length-1;i>=0;i--)n.print(r.pts[i]+" ");n.println("")},e.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new Nl(this)),this._mce},e.prototype.getEnvelope=function(){var n=this;if(this._env===null){this._env=new Wt;for(var r=0;r<this.pts.length;r++)n._env.expandToInclude(n.pts[r])}return this._env},e.prototype.addIntersection=function(n,r,i,o){var c=new Oe(n.getIntersection(o)),l=r,d=n.getEdgeDistance(i,o),y=l+1;if(y<this.pts.length){var S=this.pts[y];c.equals2D(S)&&(l=y,d=0)}this.eiList.add(c,l,d)},e.prototype.toString=function(){var n=this,r=new Na;r.append("edge "+this._name+": "),r.append("LINESTRING (");for(var i=0;i<this.pts.length;i++)i>0&&r.append(","),r.append(n.pts[i].x+" "+n.pts[i].y);return r.append(")  "+this._label+" "+this._depthDelta),r.toString()},e.prototype.isPointwiseEqual=function(n){var r=this;if(this.pts.length!==n.pts.length)return!1;for(var i=0;i<this.pts.length;i++)if(!r.pts[i].equals2D(n.pts[i]))return!1;return!0},e.prototype.setDepthDelta=function(n){this._depthDelta=n},e.prototype.getEdgeIntersectionList=function(){return this.eiList},e.prototype.addIntersections=function(n,r,i){for(var o=this,c=0;c<n.getIntersectionNum();c++)o.addIntersection(n,r,i,c)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.updateIM=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1];r.setAtLeastIfValid(n.getLocation(0,ut.ON),n.getLocation(1,ut.ON),1),n.isArea()&&(r.setAtLeastIfValid(n.getLocation(0,ut.LEFT),n.getLocation(1,ut.LEFT),2),r.setAtLeastIfValid(n.getLocation(0,ut.RIGHT),n.getLocation(1,ut.RIGHT),2))}else return t.prototype.updateIM.apply(this,arguments)},e}(as),ao=function(t){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Zs,this._bufParams=t||null};ao.prototype.setWorkingPrecisionModel=function(t){this._workingPrecisionModel=t};ao.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(e!==null){var n=e.getLabel(),r=t.getLabel();e.isPointwiseEqual(t)||(r=new $n(t.getLabel()),r.flip()),n.merge(r);var i=ao.depthDelta(r),o=e.getDepthDelta(),c=o+i;e.setDepthDelta(c)}else this._edgeList.add(t),t.setDepthDelta(ao.depthDelta(t.getLabel()))};ao.prototype.buildSubgraphs=function(t,e){for(var n=new vt,r=t.iterator();r.hasNext();){var i=r.next(),o=i.getRightmostCoordinate(),c=new nh(n),l=c.getDepth(o);i.computeDepth(l),i.findResultEdges(),n.add(i),e.add(i.getDirectedEdges(),i.getNodes())}};ao.prototype.createSubgraphs=function(t){for(var e=new vt,n=t.getNodes().iterator();n.hasNext();){var r=n.next();if(!r.isVisited()){var i=new uo;i.create(r),e.add(i)}}return Hs.sort(e,Hs.reverseOrder()),e};ao.prototype.createEmptyResultGeometry=function(){var t=this._geomFact.createPolygon();return t};ao.prototype.getNoder=function(t){if(this._workingNoder!==null)return this._workingNoder;var e=new nb,n=new gc;return n.setPrecisionModel(t),e.setSegmentIntersector(new us(n)),e};ao.prototype.buffer=function(t,e){var n=this._workingPrecisionModel;n===null&&(n=t.getPrecisionModel()),this._geomFact=t.getFactory();var r=new So(n,this._bufParams),i=new Is(t,e,r),o=i.getCurves();if(o.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(o,n),this._graph=new Lr(new JC),this._graph.addEdges(this._edgeList.getEdges());var c=this.createSubgraphs(this._graph),l=new jo(this._geomFact);this.buildSubgraphs(c,l);var d=l.getPolygons();if(d.size()<=0)return this.createEmptyResultGeometry();var y=this._geomFact.buildGeometry(d);return y};ao.prototype.computeNodedEdges=function(t,e){var n=this,r=this.getNoder(e);r.computeNodes(t);for(var i=r.getNodedSubstrings(),o=i.iterator();o.hasNext();){var c=o.next(),l=c.getCoordinates();if(!(l.length===2&&l[0].equals2D(l[1]))){var d=c.getData(),y=new V_(c.getCoordinates(),new $n(d));n.insertUniqueEdge(y)}}};ao.prototype.setNoder=function(t){this._workingNoder=t};ao.prototype.interfaces_=function(){return[]};ao.prototype.getClass=function(){return ao};ao.depthDelta=function(t){var e=t.getLocation(0,ut.LEFT),n=t.getLocation(0,ut.RIGHT);return e===ze.INTERIOR&&n===ze.EXTERIOR?1:e===ze.EXTERIOR&&n===ze.INTERIOR?-1:0};ao.convertSegStrings=function(t){for(var e=new Mn,n=new vt;t.hasNext();){var r=t.next(),i=e.createLineString(r.getCoordinates());n.add(i)}return e.buildGeometry(n)};var vu=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var t=arguments[0],e=arguments[1];this._noder=t,this._scaleFactor=e,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var n=arguments[0],r=arguments[1],i=arguments[2],o=arguments[3];this._noder=n,this._scaleFactor=r,this._offsetX=i,this._offsetY=o,this._isScaled=!this.isIntegerPrecision()}};vu.prototype.rescale=function(){var t=this;if(rn(arguments[0],ni))for(var e=arguments[0],n=e.iterator();n.hasNext();){var r=n.next();t.rescale(r.getCoordinates())}else if(arguments[0]instanceof Array){for(var i=arguments[0],o=0;o<i.length;o++)i[o].x=i[o].x/t._scaleFactor+t._offsetX,i[o].y=i[o].y/t._scaleFactor+t._offsetY;i.length===2&&i[0].equals2D(i[1])&&Fi.out.println(i)}};vu.prototype.scale=function(){var t=this;if(rn(arguments[0],ni)){for(var e=arguments[0],n=new vt,r=e.iterator();r.hasNext();){var i=r.next();n.add(new Wr(t.scale(i.getCoordinates()),i.getData()))}return n}else if(arguments[0]instanceof Array){for(var o=arguments[0],c=new Array(o.length).fill(null),l=0;l<o.length;l++)c[l]=new Oe(Math.round((o[l].x-t._offsetX)*t._scaleFactor),Math.round((o[l].y-t._offsetY)*t._scaleFactor),o[l].z);var d=kn.removeRepeatedPoints(c);return d}};vu.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};vu.prototype.getNodedSubstrings=function(){var t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t};vu.prototype.computeNodes=function(t){var e=t;this._isScaled&&(e=this.scale(t)),this._noder.computeNodes(e)};vu.prototype.interfaces_=function(){return[oc]};vu.prototype.getClass=function(){return vu};var Ma=function(){this._li=new gc,this._segStrings=null;var t=arguments[0];this._segStrings=t},eT={fact:{configurable:!0}};Ma.prototype.checkEndPtVertexIntersections=function(){var t=this;if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();){var n=e.next(),r=n.getCoordinates();t.checkEndPtVertexIntersections(r[0],t._segStrings),t.checkEndPtVertexIntersections(r[r.length-1],t._segStrings)}else if(arguments.length===2){for(var i=arguments[0],o=arguments[1],c=o.iterator();c.hasNext();)for(var l=c.next(),d=l.getCoordinates(),y=1;y<d.length-1;y++)if(d[y].equals(i))throw new kl("found endpt/interior pt intersection at index "+y+" :pt "+i)}};Ma.prototype.checkInteriorIntersections=function(){var t=this;if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();)for(var n=e.next(),r=this._segStrings.iterator();r.hasNext();){var i=r.next();t.checkInteriorIntersections(n,i)}else if(arguments.length===2)for(var o=arguments[0],c=arguments[1],l=o.getCoordinates(),d=c.getCoordinates(),y=0;y<l.length-1;y++)for(var S=0;S<d.length-1;S++)t.checkInteriorIntersections(o,y,c,S);else if(arguments.length===4){var E=arguments[0],C=arguments[1],A=arguments[2],M=arguments[3];if(E===A&&C===M)return null;var R=E.getCoordinates()[C],N=E.getCoordinates()[C+1],B=A.getCoordinates()[M],O=A.getCoordinates()[M+1];if(this._li.computeIntersection(R,N,B,O),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,R,N)||this.hasInteriorIntersection(this._li,B,O)))throw new kl("found non-noded intersection at "+R+"-"+N+" and "+B+"-"+O)}};Ma.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};Ma.prototype.checkCollapses=function(){var t=this;if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();){var n=e.next();t.checkCollapses(n)}else if(arguments.length===1)for(var r=arguments[0],i=r.getCoordinates(),o=0;o<i.length-2;o++)t.checkCollapse(i[o],i[o+1],i[o+2])};Ma.prototype.hasInteriorIntersection=function(t,e,n){for(var r=0;r<t.getIntersectionNum();r++){var i=t.getIntersection(r);if(!(i.equals(e)||i.equals(n)))return!0}return!1};Ma.prototype.checkCollapse=function(t,e,n){if(t.equals(n))throw new kl("found non-noded collapse at "+Ma.fact.createLineString([t,e,n]))};Ma.prototype.interfaces_=function(){return[]};Ma.prototype.getClass=function(){return Ma};eT.fact.get=function(){return new Mn};Object.defineProperties(Ma,eT);var Eo=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var t=arguments[0],e=arguments[1],n=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=e,this._li=n,e<=0)throw new wr("Scale factor must be non-zero");e!==1&&(this._pt=new Oe(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new Oe,this._p1Scaled=new Oe),this.initCorners(this._pt)},tT={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};Eo.prototype.intersectsScaled=function(t,e){var n=Math.min(t.x,e.x),r=Math.max(t.x,e.x),i=Math.min(t.y,e.y),o=Math.max(t.y,e.y),c=this._maxx<n||this._minx>r||this._maxy<i||this._miny>o;if(c)return!1;var l=this.intersectsToleranceSquare(t,e);return yn.isTrue(!(c&&l),"Found bad envelope test"),l};Eo.prototype.initCorners=function(t){var e=.5;this._minx=t.x-e,this._maxx=t.x+e,this._miny=t.y-e,this._maxy=t.y+e,this._corner[0]=new Oe(this._maxx,this._maxy),this._corner[1]=new Oe(this._minx,this._maxy),this._corner[2]=new Oe(this._minx,this._miny),this._corner[3]=new Oe(this._maxx,this._miny)};Eo.prototype.intersects=function(t,e){return this._scaleFactor===1?this.intersectsScaled(t,e):(this.copyScaled(t,this._p0Scaled),this.copyScaled(e,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};Eo.prototype.scale=function(t){return Math.round(t*this._scaleFactor)};Eo.prototype.getCoordinate=function(){return this._originalPt};Eo.prototype.copyScaled=function(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)};Eo.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var t=Eo.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Wt(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv};Eo.prototype.intersectsPixelClosure=function(t,e){return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.hasIntersection()))};Eo.prototype.intersectsToleranceSquare=function(t,e){var n=!1,r=!1;return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.isProper())||n&&r||t.equals(this._pt)||e.equals(this._pt))};Eo.prototype.addSnappedNode=function(t,e){var n=t.getCoordinate(e),r=t.getCoordinate(e+1);return this.intersects(n,r)?(t.addIntersection(this.getCoordinate(),e),!0):!1};Eo.prototype.interfaces_=function(){return[]};Eo.prototype.getClass=function(){return Eo};tT.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties(Eo,tT);var mm=function(){this.tempEnv1=new Wt,this.selectedSegment=new Zt};mm.prototype.select=function(){if(arguments.length!==1&&arguments.length===2){var t=arguments[0],e=arguments[1];t.getLineSegment(e,this.selectedSegment),this.select(this.selectedSegment)}};mm.prototype.interfaces_=function(){return[]};mm.prototype.getClass=function(){return mm};var ep=function(){this._index=null;var t=arguments[0];this._index=t},nT={HotPixelSnapAction:{configurable:!0}};ep.prototype.snap=function(){if(arguments.length===1){var t=arguments[0];return this.snap(t,null,-1)}else if(arguments.length===3){var e=arguments[0],n=arguments[1],r=arguments[2],i=e.getSafeEnvelope(),o=new rT(e,n,r);return this._index.query(i,{interfaces_:function(){return[gu]},visitItem:function(c){var l=c;l.select(i,o)}}),o.isNodeAdded()}};ep.prototype.interfaces_=function(){return[]};ep.prototype.getClass=function(){return ep};nT.HotPixelSnapAction.get=function(){return rT};Object.defineProperties(ep,nT);var rT=function(t){function e(){t.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var n=arguments[0],r=arguments[1],i=arguments[2];this._hotPixel=n,this._parentEdge=r,this._hotPixelVertexIndex=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isNodeAdded=function(){return this._isNodeAdded},e.prototype.select=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1],i=n.getContext();if(this._parentEdge!==null&&i===this._parentEdge&&r===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(i,r)}else return t.prototype.select.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(mm),rh=function(){this._li=null,this._interiorIntersections=null;var t=arguments[0];this._li=t,this._interiorIntersections=new vt};rh.prototype.processIntersections=function(t,e,n,r){var i=this;if(t===n&&e===r)return null;var o=t.getCoordinates()[e],c=t.getCoordinates()[e+1],l=n.getCoordinates()[r],d=n.getCoordinates()[r+1];if(this._li.computeIntersection(o,c,l,d),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var y=0;y<this._li.getIntersectionNum();y++)i._interiorIntersections.add(i._li.getIntersection(y));t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1)}};rh.prototype.isDone=function(){return!1};rh.prototype.getInteriorIntersections=function(){return this._interiorIntersections};rh.prototype.interfaces_=function(){return[ac]};rh.prototype.getClass=function(){return rh};var nl=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var t=arguments[0];this._pm=t,this._li=new gc,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()};nl.prototype.checkCorrectness=function(t){var e=Wr.getNodedSubstrings(t),n=new Ma(e);try{n.checkValid()}catch(r){if(r instanceof VC)r.printStackTrace();else throw r}finally{}};nl.prototype.getNodedSubstrings=function(){return Wr.getNodedSubstrings(this._nodedSegStrings)};nl.prototype.snapRound=function(t,e){var n=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(n),this.computeVertexSnaps(t)};nl.prototype.findInteriorIntersections=function(t,e){var n=new rh(e);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(t),n.getInteriorIntersections()};nl.prototype.computeVertexSnaps=function(){var t=this;if(rn(arguments[0],ni))for(var e=arguments[0],n=e.iterator();n.hasNext();){var r=n.next();t.computeVertexSnaps(r)}else if(arguments[0]instanceof Wr)for(var i=arguments[0],o=i.getCoordinates(),c=0;c<o.length;c++){var l=new Eo(o[c],t._scaleFactor,t._li),d=t._pointSnapper.snap(l,i,c);d&&i.addIntersection(o[c],c)}};nl.prototype.computeNodes=function(t){this._nodedSegStrings=t,this._noder=new nb,this._pointSnapper=new ep(this._noder.getIndex()),this.snapRound(t,this._li)};nl.prototype.computeIntersectionSnaps=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next(),i=new Eo(r,e._scaleFactor,e._li);e._pointSnapper.snap(i)}};nl.prototype.interfaces_=function(){return[oc]};nl.prototype.getClass=function(){return nl};var Ni=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new qn,this._resultGeometry=null,this._saveException=null,arguments.length===1){var t=arguments[0];this._argGeom=t}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this._argGeom=e,this._bufParams=n}},xp={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};Ni.prototype.bufferFixedPrecision=function(t){var e=new vu(new nl(new Wn(1)),t.getScale()),n=new ao(this._bufParams);n.setWorkingPrecisionModel(t),n.setNoder(e),this._resultGeometry=n.buffer(this._argGeom,this._distance)};Ni.prototype.bufferReducedPrecision=function(){var t=this;if(arguments.length===0){for(var e=Ni.MAX_PRECISION_DIGITS;e>=0;e--){try{t.bufferReducedPrecision(e)}catch(o){if(o instanceof Dl)t._saveException=o;else throw o}finally{}if(t._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var n=arguments[0],r=Ni.precisionScaleFactor(this._argGeom,this._distance,n),i=new Wn(r);this.bufferFixedPrecision(i)}};Ni.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var t=this._argGeom.getFactory().getPrecisionModel();t.getType()===Wn.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()};Ni.prototype.setQuadrantSegments=function(t){this._bufParams.setQuadrantSegments(t)};Ni.prototype.bufferOriginalPrecision=function(){try{var t=new ao(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(e){if(e instanceof kl)this._saveException=e;else throw e}finally{}};Ni.prototype.getResultGeometry=function(t){return this._distance=t,this.computeGeometry(),this._resultGeometry};Ni.prototype.setEndCapStyle=function(t){this._bufParams.setEndCapStyle(t)};Ni.prototype.interfaces_=function(){return[]};Ni.prototype.getClass=function(){return Ni};Ni.bufferOp=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=new Ni(t),r=n.getResultGeometry(e);return r}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof nn&&typeof arguments[1]=="number"){var i=arguments[0],o=arguments[1],c=arguments[2],l=new Ni(i);l.setQuadrantSegments(c);var d=l.getResultGeometry(o);return d}else if(arguments[2]instanceof qn&&arguments[0]instanceof nn&&typeof arguments[1]=="number"){var y=arguments[0],S=arguments[1],E=arguments[2],C=new Ni(y,E),A=C.getResultGeometry(S);return A}}else if(arguments.length===4){var M=arguments[0],R=arguments[1],N=arguments[2],B=arguments[3],O=new Ni(M);O.setQuadrantSegments(N),O.setEndCapStyle(B);var G=O.getResultGeometry(R);return G}};Ni.precisionScaleFactor=function(t,e,n){var r=t.getEnvelopeInternal(),i=ss.max(Math.abs(r.getMaxX()),Math.abs(r.getMaxY()),Math.abs(r.getMinX()),Math.abs(r.getMinY())),o=e>0?e:0,c=i+2*o,l=Math.trunc(Math.log(c)/Math.log(10)+1),d=n-l,y=Math.pow(10,d);return y};xp.CAP_ROUND.get=function(){return qn.CAP_ROUND};xp.CAP_BUTT.get=function(){return qn.CAP_FLAT};xp.CAP_FLAT.get=function(){return qn.CAP_FLAT};xp.CAP_SQUARE.get=function(){return qn.CAP_SQUARE};xp.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(Ni,xp);var io=function(){this._pt=[new Oe,new Oe],this._distance=cn.NaN,this._isNull=!0};io.prototype.getCoordinates=function(){return this._pt};io.prototype.getCoordinate=function(t){return this._pt[t]};io.prototype.setMinimum=function(){if(arguments.length===1){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r<this._distance&&this.initialize(e,n,r)}};io.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],r=arguments[1],i=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=i,this._isNull=!1}};io.prototype.getDistance=function(){return this._distance};io.prototype.setMaximum=function(){if(arguments.length===1){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r>this._distance&&this.initialize(e,n,r)}};io.prototype.interfaces_=function(){return[]};io.prototype.getClass=function(){return io};var Ha=function(){};Ha.prototype.interfaces_=function(){return[]};Ha.prototype.getClass=function(){return Ha};Ha.computeDistance=function(){if(arguments[2]instanceof io&&arguments[0]instanceof Rr&&arguments[1]instanceof Oe)for(var t=arguments[0],e=arguments[1],n=arguments[2],r=t.getCoordinates(),i=new Zt,o=0;o<r.length-1;o++){i.setCoordinates(r[o],r[o+1]);var c=i.closestPoint(e);n.setMinimum(c,e)}else if(arguments[2]instanceof io&&arguments[0]instanceof ai&&arguments[1]instanceof Oe){var l=arguments[0],d=arguments[1],y=arguments[2];Ha.computeDistance(l.getExteriorRing(),d,y);for(var S=0;S<l.getNumInteriorRing();S++)Ha.computeDistance(l.getInteriorRingN(S),d,y)}else if(arguments[2]instanceof io&&arguments[0]instanceof nn&&arguments[1]instanceof Oe){var E=arguments[0],C=arguments[1],A=arguments[2];if(E instanceof Rr)Ha.computeDistance(E,C,A);else if(E instanceof ai)Ha.computeDistance(E,C,A);else if(E instanceof lo)for(var M=E,R=0;R<M.getNumGeometries();R++){var N=M.getGeometryN(R);Ha.computeDistance(N,C,A)}else A.setMinimum(E.getCoordinate(),C)}else if(arguments[2]instanceof io&&arguments[0]instanceof Zt&&arguments[1]instanceof Oe){var B=arguments[0],O=arguments[1],G=arguments[2],U=B.closestPoint(O);G.setMinimum(U,O)}};var uc=function(t){this._maxPtDist=new io,this._inputGeom=t||null},rb={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};uc.prototype.computeMaxMidpointDistance=function(t){var e=new bu(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())};uc.prototype.computeMaxVertexDistance=function(t){var e=new ih(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())};uc.prototype.findDistance=function(t){return this.computeMaxVertexDistance(t),this.computeMaxMidpointDistance(t),this._maxPtDist.getDistance()};uc.prototype.getDistancePoints=function(){return this._maxPtDist};uc.prototype.interfaces_=function(){return[]};uc.prototype.getClass=function(){return uc};rb.MaxPointDistanceFilter.get=function(){return ih};rb.MaxMidpointDistanceFilter.get=function(){return bu};Object.defineProperties(uc,rb);var ih=function(t){this._maxPtDist=new io,this._minPtDist=new io,this._geom=t||null};ih.prototype.filter=function(t){this._minPtDist.initialize(),Ha.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};ih.prototype.getMaxPointDistance=function(){return this._maxPtDist};ih.prototype.interfaces_=function(){return[Ka]};ih.prototype.getClass=function(){return ih};var bu=function(t){this._maxPtDist=new io,this._minPtDist=new io,this._geom=t||null};bu.prototype.filter=function(t,e){if(e===0)return null;var n=t.getCoordinate(e-1),r=t.getCoordinate(e),i=new Oe((n.x+r.x)/2,(n.y+r.y)/2);this._minPtDist.initialize(),Ha.computeDistance(this._geom,i,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};bu.prototype.isDone=function(){return!1};bu.prototype.isGeometryChanged=function(){return!1};bu.prototype.getMaxPointDistance=function(){return this._maxPtDist};bu.prototype.interfaces_=function(){return[qs]};bu.prototype.getClass=function(){return bu};var Tl=function(t){this._comps=t||null};Tl.prototype.filter=function(t){t instanceof ai&&this._comps.add(t)};Tl.prototype.interfaces_=function(){return[Ia]};Tl.prototype.getClass=function(){return Tl};Tl.getPolygons=function(){if(arguments.length===1){var t=arguments[0];return Tl.getPolygons(t,new vt)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return e instanceof ai?n.add(e):e instanceof lo&&e.apply(new Tl(n)),n}};var Ri=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var t=arguments[0];this._lines=t}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this._lines=e,this._isForcedToLineString=n}};Ri.prototype.filter=function(t){if(this._isForcedToLineString&&t instanceof Ja){var e=t.getFactory().createLineString(t.getCoordinateSequence());return this._lines.add(e),null}t instanceof Rr&&this._lines.add(t)};Ri.prototype.setForceToLineString=function(t){this._isForcedToLineString=t};Ri.prototype.interfaces_=function(){return[Al]};Ri.prototype.getClass=function(){return Ri};Ri.getGeometry=function(){if(arguments.length===1){var t=arguments[0];return t.getFactory().buildGeometry(Ri.getLines(t))}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return e.getFactory().buildGeometry(Ri.getLines(e,n))}};Ri.getLines=function(){if(arguments.length===1){var t=arguments[0];return Ri.getLines(t,!1)}else if(arguments.length===2){if(rn(arguments[0],ni)&&rn(arguments[1],ni)){for(var e=arguments[0],n=arguments[1],r=e.iterator();r.hasNext();){var i=r.next();Ri.getLines(i,n)}return n}else if(arguments[0]instanceof nn&&typeof arguments[1]=="boolean"){var o=arguments[0],c=arguments[1],l=new vt;return o.apply(new Ri(l,c)),l}else if(arguments[0]instanceof nn&&rn(arguments[1],ni)){var d=arguments[0],y=arguments[1];return d instanceof Rr?y.add(d):d.apply(new Ri(y)),y}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&rn(arguments[0],ni)&&rn(arguments[1],ni)){for(var S=arguments[0],E=arguments[1],C=arguments[2],A=S.iterator();A.hasNext();){var M=A.next();Ri.getLines(M,E,C)}return E}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof nn&&rn(arguments[1],ni)){var R=arguments[0],N=arguments[1],B=arguments[2];return R.apply(new Ri(N,B)),N}}};var Xs=function(){if(this._boundaryRule=Ss.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0&&arguments.length===1){var t=arguments[0];if(t===null)throw new wr("Rule must be non-null");this._boundaryRule=t}};Xs.prototype.locateInternal=function(){var t=this;if(arguments[0]instanceof Oe&&arguments[1]instanceof ai){var e=arguments[0],n=arguments[1];if(n.isEmpty())return ze.EXTERIOR;var r=n.getExteriorRing(),i=this.locateInPolygonRing(e,r);if(i===ze.EXTERIOR)return ze.EXTERIOR;if(i===ze.BOUNDARY)return ze.BOUNDARY;for(var o=0;o<n.getNumInteriorRing();o++){var c=n.getInteriorRingN(o),l=t.locateInPolygonRing(e,c);if(l===ze.INTERIOR)return ze.EXTERIOR;if(l===ze.BOUNDARY)return ze.BOUNDARY}return ze.INTERIOR}else if(arguments[0]instanceof Oe&&arguments[1]instanceof Rr){var d=arguments[0],y=arguments[1];if(!y.getEnvelopeInternal().intersects(d))return ze.EXTERIOR;var S=y.getCoordinates();return!y.isClosed()&&(d.equals(S[0])||d.equals(S[S.length-1]))?ze.BOUNDARY:Tt.isOnLine(d,S)?ze.INTERIOR:ze.EXTERIOR}else if(arguments[0]instanceof Oe&&arguments[1]instanceof Uo){var E=arguments[0],C=arguments[1],A=C.getCoordinate();return A.equals2D(E)?ze.INTERIOR:ze.EXTERIOR}};Xs.prototype.locateInPolygonRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?Tt.locatePointInRing(t,e.getCoordinates()):ze.EXTERIOR};Xs.prototype.intersects=function(t,e){return this.locate(t,e)!==ze.EXTERIOR};Xs.prototype.updateLocationInfo=function(t){t===ze.INTERIOR&&(this._isIn=!0),t===ze.BOUNDARY&&this._numBoundaries++};Xs.prototype.computeLocation=function(t,e){var n=this;if(e instanceof Uo&&this.updateLocationInfo(this.locateInternal(t,e)),e instanceof Rr)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof ai)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof ic)for(var r=e,i=0;i<r.getNumGeometries();i++){var o=r.getGeometryN(i);n.updateLocationInfo(n.locateInternal(t,o))}else if(e instanceof Ya)for(var c=e,l=0;l<c.getNumGeometries();l++){var d=c.getGeometryN(l);n.updateLocationInfo(n.locateInternal(t,d))}else if(e instanceof lo)for(var y=new $a(e);y.hasNext();){var S=y.next();S!==e&&n.computeLocation(t,S)}};Xs.prototype.locate=function(t,e){return e.isEmpty()?ze.EXTERIOR:e instanceof Rr?this.locateInternal(t,e):e instanceof ai?this.locateInternal(t,e):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(t,e),this._boundaryRule.isInBoundary(this._numBoundaries)?ze.BOUNDARY:this._numBoundaries>0||this._isIn?ze.INTERIOR:ze.EXTERIOR)};Xs.prototype.interfaces_=function(){return[]};Xs.prototype.getClass=function(){return Xs};var oo=function t(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var e=arguments[0],n=arguments[1];t.call(this,e,t.INSIDE_AREA,n)}else if(arguments.length===3){var r=arguments[0],i=arguments[1],o=arguments[2];this._component=r,this._segIndex=i,this._pt=o}},iT={INSIDE_AREA:{configurable:!0}};oo.prototype.isInsideArea=function(){return this._segIndex===oo.INSIDE_AREA};oo.prototype.getCoordinate=function(){return this._pt};oo.prototype.getGeometryComponent=function(){return this._component};oo.prototype.getSegmentIndex=function(){return this._segIndex};oo.prototype.interfaces_=function(){return[]};oo.prototype.getClass=function(){return oo};iT.INSIDE_AREA.get=function(){return-1};Object.defineProperties(oo,iT);var fu=function(t){this._pts=t||null};fu.prototype.filter=function(t){t instanceof Uo&&this._pts.add(t)};fu.prototype.interfaces_=function(){return[Ia]};fu.prototype.getClass=function(){return fu};fu.getPoints=function(){if(arguments.length===1){var t=arguments[0];return t instanceof Uo?Hs.singletonList(t):fu.getPoints(t,new vt)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return e instanceof Uo?n.add(e):e instanceof lo&&e.apply(new fu(n)),n}};var oh=function(){this._locations=null;var t=arguments[0];this._locations=t};oh.prototype.filter=function(t){(t instanceof Uo||t instanceof Rr||t instanceof ai)&&this._locations.add(new oo(t,0,t.getCoordinate()))};oh.prototype.interfaces_=function(){return[Ia]};oh.prototype.getClass=function(){return oh};oh.getLocations=function(t){var e=new vt;return t.apply(new oh(e)),e};var Bi=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Xs,this._minDistanceLocation=null,this._minDistance=cn.MAX_VALUE,arguments.length===2){var t=arguments[0],e=arguments[1];this._geom=[t,e],this._terminateDistance=0}else if(arguments.length===3){var n=arguments[0],r=arguments[1],i=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=n,this._geom[1]=r,this._terminateDistance=i}};Bi.prototype.computeContainmentDistance=function(){var t=this;if(arguments.length===0){var e=new Array(2).fill(null);if(this.computeContainmentDistance(0,e),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,e)}else if(arguments.length===2){var n=arguments[0],r=arguments[1],i=1-n,o=Tl.getPolygons(this._geom[n]);if(o.size()>0){var c=oh.getLocations(this._geom[i]);if(this.computeContainmentDistance(c,o,r),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[i]=r[0],this._minDistanceLocation[n]=r[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&rn(arguments[0],js)&&rn(arguments[1],js)){for(var l=arguments[0],d=arguments[1],y=arguments[2],S=0;S<l.size();S++)for(var E=l.get(S),C=0;C<d.size();C++)if(t.computeContainmentDistance(E,d.get(C),y),t._minDistance<=t._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof oo&&arguments[1]instanceof ai){var A=arguments[0],M=arguments[1],R=arguments[2],N=A.getCoordinate();if(ze.EXTERIOR!==this._ptLocator.locate(N,M))return this._minDistance=0,R[0]=A,R[1]=new oo(M,N),null}}};Bi.prototype.computeMinDistanceLinesPoints=function(t,e,n){for(var r=this,i=0;i<t.size();i++)for(var o=t.get(i),c=0;c<e.size();c++){var l=e.get(c);if(r.computeMinDistance(o,l,n),r._minDistance<=r._terminateDistance)return null}};Bi.prototype.computeFacetDistance=function(){var t=new Array(2).fill(null),e=Ri.getLines(this._geom[0]),n=Ri.getLines(this._geom[1]),r=fu.getPoints(this._geom[0]),i=fu.getPoints(this._geom[1]);if(this.computeMinDistanceLines(e,n,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance||(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(e,i,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance)||(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(n,r,t),this.updateMinDistance(t,!0),this._minDistance<=this._terminateDistance))return null;t[0]=null,t[1]=null,this.computeMinDistancePoints(r,i,t),this.updateMinDistance(t,!1)};Bi.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};Bi.prototype.updateMinDistance=function(t,e){if(t[0]===null)return null;e?(this._minDistanceLocation[0]=t[1],this._minDistanceLocation[1]=t[0]):(this._minDistanceLocation[0]=t[0],this._minDistanceLocation[1]=t[1])};Bi.prototype.nearestPoints=function(){this.computeMinDistance();var t=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return t};Bi.prototype.computeMinDistance=function(){var t=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof Rr&&arguments[1]instanceof Uo){var e=arguments[0],n=arguments[1],r=arguments[2];if(e.getEnvelopeInternal().distance(n.getEnvelopeInternal())>this._minDistance)return null;for(var i=e.getCoordinates(),o=n.getCoordinate(),c=0;c<i.length-1;c++){var l=Tt.distancePointLine(o,i[c],i[c+1]);if(l<t._minDistance){t._minDistance=l;var d=new Zt(i[c],i[c+1]),y=d.closestPoint(o);r[0]=new oo(e,c,y),r[1]=new oo(n,0,o)}if(t._minDistance<=t._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Rr&&arguments[1]instanceof Rr){var S=arguments[0],E=arguments[1],C=arguments[2];if(S.getEnvelopeInternal().distance(E.getEnvelopeInternal())>this._minDistance)return null;for(var A=S.getCoordinates(),M=E.getCoordinates(),R=0;R<A.length-1;R++)for(var N=0;N<M.length-1;N++){var B=Tt.distanceLineLine(A[R],A[R+1],M[N],M[N+1]);if(B<t._minDistance){t._minDistance=B;var O=new Zt(A[R],A[R+1]),G=new Zt(M[N],M[N+1]),U=O.closestPoints(G);C[0]=new oo(S,R,U[0]),C[1]=new oo(E,N,U[1])}if(t._minDistance<=t._terminateDistance)return null}}}};Bi.prototype.computeMinDistancePoints=function(t,e,n){for(var r=this,i=0;i<t.size();i++)for(var o=t.get(i),c=0;c<e.size();c++){var l=e.get(c),d=o.getCoordinate().distance(l.getCoordinate());if(d<r._minDistance&&(r._minDistance=d,n[0]=new oo(o,0,o.getCoordinate()),n[1]=new oo(l,0,l.getCoordinate())),r._minDistance<=r._terminateDistance)return null}};Bi.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new wr("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};Bi.prototype.computeMinDistanceLines=function(t,e,n){for(var r=this,i=0;i<t.size();i++)for(var o=t.get(i),c=0;c<e.size();c++){var l=e.get(c);if(r.computeMinDistance(o,l,n),r._minDistance<=r._terminateDistance)return null}};Bi.prototype.interfaces_=function(){return[]};Bi.prototype.getClass=function(){return Bi};Bi.distance=function(t,e){var n=new Bi(t,e);return n.distance()};Bi.isWithinDistance=function(t,e,n){var r=new Bi(t,e,n);return r.distance()<=n};Bi.nearestPoints=function(t,e){var n=new Bi(t,e);return n.nearestPoints()};var Wi=function(){this._pt=[new Oe,new Oe],this._distance=cn.NaN,this._isNull=!0};Wi.prototype.getCoordinates=function(){return this._pt};Wi.prototype.getCoordinate=function(t){return this._pt[t]};Wi.prototype.setMinimum=function(){if(arguments.length===1){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r<this._distance&&this.initialize(e,n,r)}};Wi.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],r=arguments[1],i=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=i,this._isNull=!1}};Wi.prototype.toString=function(){return Gs.toLineString(this._pt[0],this._pt[1])};Wi.prototype.getDistance=function(){return this._distance};Wi.prototype.setMaximum=function(){if(arguments.length===1){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r>this._distance&&this.initialize(e,n,r)}};Wi.prototype.interfaces_=function(){return[]};Wi.prototype.getClass=function(){return Wi};var da=function(){};da.prototype.interfaces_=function(){return[]};da.prototype.getClass=function(){return da};da.computeDistance=function(){if(arguments[2]instanceof Wi&&arguments[0]instanceof Rr&&arguments[1]instanceof Oe)for(var t=arguments[0],e=arguments[1],n=arguments[2],r=new Zt,i=t.getCoordinates(),o=0;o<i.length-1;o++){r.setCoordinates(i[o],i[o+1]);var c=r.closestPoint(e);n.setMinimum(c,e)}else if(arguments[2]instanceof Wi&&arguments[0]instanceof ai&&arguments[1]instanceof Oe){var l=arguments[0],d=arguments[1],y=arguments[2];da.computeDistance(l.getExteriorRing(),d,y);for(var S=0;S<l.getNumInteriorRing();S++)da.computeDistance(l.getInteriorRingN(S),d,y)}else if(arguments[2]instanceof Wi&&arguments[0]instanceof nn&&arguments[1]instanceof Oe){var E=arguments[0],C=arguments[1],A=arguments[2];if(E instanceof Rr)da.computeDistance(E,C,A);else if(E instanceof ai)da.computeDistance(E,C,A);else if(E instanceof lo)for(var M=E,R=0;R<M.getNumGeometries();R++){var N=M.getGeometryN(R);da.computeDistance(N,C,A)}else A.setMinimum(E.getCoordinate(),C)}else if(arguments[2]instanceof Wi&&arguments[0]instanceof Zt&&arguments[1]instanceof Oe){var B=arguments[0],O=arguments[1],G=arguments[2],U=B.closestPoint(O);G.setMinimum(U,O)}};var ws=function(){this._g0=null,this._g1=null,this._ptDist=new Wi,this._densifyFrac=0;var t=arguments[0],e=arguments[1];this._g0=t,this._g1=e},ib={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};ws.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};ws.prototype.setDensifyFraction=function(t){if(t>1||t<=0)throw new wr("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=t};ws.prototype.compute=function(t,e){this.computeOrientedDistance(t,e,this._ptDist),this.computeOrientedDistance(e,t,this._ptDist)};ws.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};ws.prototype.computeOrientedDistance=function(t,e,n){var r=new sh(e);if(t.apply(r),n.setMaximum(r.getMaxPointDistance()),this._densifyFrac>0){var i=new xu(e,this._densifyFrac);t.apply(i),n.setMaximum(i.getMaxPointDistance())}};ws.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};ws.prototype.interfaces_=function(){return[]};ws.prototype.getClass=function(){return ws};ws.distance=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=new ws(t,e);return n.distance()}else if(arguments.length===3){var r=arguments[0],i=arguments[1],o=arguments[2],c=new ws(r,i);return c.setDensifyFraction(o),c.distance()}};ib.MaxPointDistanceFilter.get=function(){return sh};ib.MaxDensifiedByFractionDistanceFilter.get=function(){return xu};Object.defineProperties(ws,ib);var sh=function(){this._maxPtDist=new Wi,this._minPtDist=new Wi,this._euclideanDist=new da,this._geom=null;var t=arguments[0];this._geom=t};sh.prototype.filter=function(t){this._minPtDist.initialize(),da.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};sh.prototype.getMaxPointDistance=function(){return this._maxPtDist};sh.prototype.interfaces_=function(){return[Ka]};sh.prototype.getClass=function(){return sh};var xu=function(){this._maxPtDist=new Wi,this._minPtDist=new Wi,this._geom=null,this._numSubSegs=0;var t=arguments[0],e=arguments[1];this._geom=t,this._numSubSegs=Math.trunc(Math.round(1/e))};xu.prototype.filter=function(t,e){var n=this;if(e===0)return null;for(var r=t.getCoordinate(e-1),i=t.getCoordinate(e),o=(i.x-r.x)/this._numSubSegs,c=(i.y-r.y)/this._numSubSegs,l=0;l<this._numSubSegs;l++){var d=r.x+l*o,y=r.y+l*c,S=new Oe(d,y);n._minPtDist.initialize(),da.computeDistance(n._geom,S,n._minPtDist),n._maxPtDist.setMaximum(n._minPtDist)}};xu.prototype.isDone=function(){return!1};xu.prototype.isGeometryChanged=function(){return!1};xu.prototype.getMaxPointDistance=function(){return this._maxPtDist};xu.prototype.interfaces_=function(){return[qs]};xu.prototype.getClass=function(){return xu};var Bo=function(t,e,n){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._bufDistance=e||null,this._result=n||null},ob={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Bo.prototype.checkMaximumDistance=function(t,e,n){var r=new ws(e,t);if(r.setDensifyFraction(.25),this._maxDistanceFound=r.orientedDistance(),this._maxDistanceFound>n){this._isValid=!1;var i=r.getCoordinates();this._errorLocation=i[1],this._errorIndicator=t.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+Gs.toLineString(i[0],i[1])+")"}};Bo.prototype.isValid=function(){var t=Math.abs(this._bufDistance),e=Bo.MAX_DISTANCE_DIFF_FRAC*t;return this._minValidDistance=t-e,this._maxValidDistance=t+e,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Bo.VERBOSE&&Fi.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};Bo.prototype.checkNegativeValid=function(){if(!(this._input instanceof ai||this._input instanceof Ya||this._input instanceof lo))return null;var t=this.getPolygonLines(this._input);if(this.checkMinimumDistance(t,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(t,this._result,this._maxValidDistance)};Bo.prototype.getErrorIndicator=function(){return this._errorIndicator};Bo.prototype.checkMinimumDistance=function(t,e,n){var r=new Bi(t,e,n);if(this._minDistanceFound=r.distance(),this._minDistanceFound<n){this._isValid=!1;var i=r.nearestPoints();this._errorLocation=r.nearestPoints()[1],this._errorIndicator=t.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+Gs.toLineString(i[0],i[1])+" )"}};Bo.prototype.checkPositiveValid=function(){var t=this._result.getBoundary();if(this.checkMinimumDistance(this._input,t,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,t,this._maxValidDistance)};Bo.prototype.getErrorLocation=function(){return this._errorLocation};Bo.prototype.getPolygonLines=function(t){for(var e=new vt,n=new Ri(e),r=Tl.getPolygons(t),i=r.iterator();i.hasNext();){var o=i.next();o.apply(n)}return t.getFactory().buildGeometry(e)};Bo.prototype.getErrorMessage=function(){return this._errMsg};Bo.prototype.interfaces_=function(){return[]};Bo.prototype.getClass=function(){return Bo};ob.VERBOSE.get=function(){return!1};ob.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties(Bo,ob);var Vi=function(t,e,n){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._distance=e||null,this._result=n||null},sb={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Vi.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};Vi.prototype.checkEnvelope=function(){if(this._distance<0)return null;var t=this._distance*Vi.MAX_ENV_DIFF_FRAC;t===0&&(t=.001);var e=new Wt(this._input.getEnvelopeInternal());e.expandBy(this._distance);var n=new Wt(this._result.getEnvelopeInternal());n.expandBy(t),n.contains(e)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(n)),this.report("Envelope")};Vi.prototype.checkDistance=function(){var t=new Bo(this._input,this._distance,this._result);t.isValid()||(this._isValid=!1,this._errorMsg=t.getErrorMessage(),this._errorLocation=t.getErrorLocation(),this._errorIndicator=t.getErrorIndicator()),this.report("Distance")};Vi.prototype.checkArea=function(){var t=this._input.getArea(),e=this._result.getArea();this._distance>0&&t>e&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&t<e&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};Vi.prototype.checkPolygonal=function(){this._result instanceof ai||this._result instanceof Ya||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};Vi.prototype.getErrorIndicator=function(){return this._errorIndicator};Vi.prototype.getErrorLocation=function(){return this._errorLocation};Vi.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};Vi.prototype.report=function(t){if(!Vi.VERBOSE)return null;Fi.out.println("Check "+t+": "+(this._isValid?"passed":"FAILED"))};Vi.prototype.getErrorMessage=function(){return this._errorMsg};Vi.prototype.interfaces_=function(){return[]};Vi.prototype.getClass=function(){return Vi};Vi.isValidMsg=function(t,e,n){var r=new Vi(t,e,n);return r.isValid()?null:r.getErrorMessage()};Vi.isValid=function(t,e,n){var r=new Vi(t,e,n);return!!r.isValid()};sb.VERBOSE.get=function(){return!1};sb.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(Vi,sb);var ka=function(){this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};ka.prototype.getCoordinates=function(){return this._pts};ka.prototype.size=function(){return this._pts.length};ka.prototype.getCoordinate=function(t){return this._pts[t]};ka.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};ka.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:th.octant(this.getCoordinate(t),this.getCoordinate(t+1))};ka.prototype.setData=function(t){this._data=t};ka.prototype.getData=function(){return this._data};ka.prototype.toString=function(){return Gs.toLineString(new Ur(this._pts))};ka.prototype.interfaces_=function(){return[el]};ka.prototype.getClass=function(){return ka};var Pi=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new vt,this._intersectionCount=0,this._keepIntersections=!0;var t=arguments[0];this._li=t,this._interiorIntersection=null};Pi.prototype.getInteriorIntersection=function(){return this._interiorIntersection};Pi.prototype.setCheckEndSegmentsOnly=function(t){this._isCheckEndSegmentsOnly=t};Pi.prototype.getIntersectionSegments=function(){return this._intSegments};Pi.prototype.count=function(){return this._intersectionCount};Pi.prototype.getIntersections=function(){return this._intersections};Pi.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t};Pi.prototype.setKeepIntersections=function(t){this._keepIntersections=t};Pi.prototype.processIntersections=function(t,e,n,r){if(!this._findAllIntersections&&this.hasIntersection()||t===n&&e===r)return null;if(this._isCheckEndSegmentsOnly){var i=this.isEndSegment(t,e)||this.isEndSegment(n,r);if(!i)return null}var o=t.getCoordinates()[e],c=t.getCoordinates()[e+1],l=n.getCoordinates()[r],d=n.getCoordinates()[r+1];this._li.computeIntersection(o,c,l,d),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=o,this._intSegments[1]=c,this._intSegments[2]=l,this._intSegments[3]=d,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};Pi.prototype.isEndSegment=function(t,e){return e===0||e>=t.size()-2};Pi.prototype.hasIntersection=function(){return this._interiorIntersection!==null};Pi.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};Pi.prototype.interfaces_=function(){return[ac]};Pi.prototype.getClass=function(){return Pi};Pi.createAllIntersectionsFinder=function(t){var e=new Pi(t);return e.setFindAllIntersections(!0),e};Pi.createAnyIntersectionFinder=function(t){return new Pi(t)};Pi.createIntersectionCounter=function(t){var e=new Pi(t);return e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e};var Ys=function(){this._li=new gc,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var t=arguments[0];this._segStrings=t};Ys.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};Ys.prototype.getIntersections=function(){return this._segInt.getIntersections()};Ys.prototype.isValid=function(){return this.execute(),this._isValid};Ys.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t};Ys.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Pi(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var t=new nb;if(t.setSegmentIntersector(this._segInt),t.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};Ys.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Dl(this.getErrorMessage(),this._segInt.getInteriorIntersection())};Ys.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var t=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+Gs.toLineString(t[0],t[1])+" and "+Gs.toLineString(t[2],t[3])};Ys.prototype.interfaces_=function(){return[]};Ys.prototype.getClass=function(){return Ys};Ys.computeIntersections=function(t){var e=new Ys(t);return e.setFindAllIntersections(!0),e.isValid(),e.getIntersections()};var cc=function t(){this._nv=null;var e=arguments[0];this._nv=new Ys(t.toSegmentStrings(e))};cc.prototype.checkValid=function(){this._nv.checkValid()};cc.prototype.interfaces_=function(){return[]};cc.prototype.getClass=function(){return cc};cc.toSegmentStrings=function(t){for(var e=new vt,n=t.iterator();n.hasNext();){var r=n.next();e.add(new ka(r.getCoordinates(),r))}return e};cc.checkValid=function(t){var e=new cc(t);e.checkValid()};var ah=function(t){this._mapOp=t};ah.prototype.map=function(t){for(var e=this,n=new vt,r=0;r<t.getNumGeometries();r++){var i=e._mapOp.map(t.getGeometryN(r));i.isEmpty()||n.add(i)}return t.getFactory().createGeometryCollection(Mn.toGeometryArray(n))};ah.prototype.interfaces_=function(){return[]};ah.prototype.getClass=function(){return ah};ah.map=function(t,e){var n=new ah(e);return n.map(t)};var Aa=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new vt,this._resultLineList=new vt;var t=arguments[0],e=arguments[1],n=arguments[2];this._op=t,this._geometryFactory=e,this._ptLocator=n};Aa.prototype.collectLines=function(t){for(var e=this,n=this._op.getGraph().getEdgeEnds().iterator();n.hasNext();){var r=n.next();e.collectLineEdge(r,t,e._lineEdgesList),e.collectBoundaryTouchEdge(r,t,e._lineEdgesList)}};Aa.prototype.labelIsolatedLine=function(t,e){var n=this._ptLocator.locate(t.getCoordinate(),this._op.getArgGeometry(e));t.getLabel().setLocation(e,n)};Aa.prototype.build=function(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this._resultLineList};Aa.prototype.collectLineEdge=function(t,e,n){var r=t.getLabel(),i=t.getEdge();t.isLineEdge()&&!t.isVisited()&&dn.isResultOfOp(r,e)&&!i.isCovered()&&(n.add(i),t.setVisitedEdge(!0))};Aa.prototype.findCoveredLineEdges=function(){for(var t=this,e=this._op.getGraph().getNodes().iterator();e.hasNext();){var n=e.next();n.getEdges().findCoveredLineEdges()}for(var r=this._op.getGraph().getEdgeEnds().iterator();r.hasNext();){var i=r.next(),o=i.getEdge();if(i.isLineEdge()&&!o.isCoveredSet()){var c=t._op.isCoveredByA(i.getCoordinate());o.setCovered(c)}}};Aa.prototype.labelIsolatedLines=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next(),i=r.getLabel();r.isIsolated()&&(i.isNull(0)?e.labelIsolatedLine(r,0):e.labelIsolatedLine(r,1))}};Aa.prototype.buildLines=function(t){for(var e=this,n=this._lineEdgesList.iterator();n.hasNext();){var r=n.next(),i=e._geometryFactory.createLineString(r.getCoordinates());e._resultLineList.add(i),r.setInResult(!0)}};Aa.prototype.collectBoundaryTouchEdge=function(t,e,n){var r=t.getLabel();if(t.isLineEdge()||t.isVisited()||t.isInteriorAreaEdge()||t.getEdge().isInResult())return null;yn.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),dn.isResultOfOp(r,e)&&e===dn.INTERSECTION&&(n.add(t.getEdge()),t.setVisitedEdge(!0))};Aa.prototype.interfaces_=function(){return[]};Aa.prototype.getClass=function(){return Aa};var lh=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new vt;var t=arguments[0],e=arguments[1];this._op=t,this._geometryFactory=e};lh.prototype.filterCoveredNodeToPoint=function(t){var e=t.getCoordinate();if(!this._op.isCoveredByLA(e)){var n=this._geometryFactory.createPoint(e);this._resultPointList.add(n)}};lh.prototype.extractNonCoveredResultNodes=function(t){for(var e=this,n=this._op.getGraph().getNodes().iterator();n.hasNext();){var r=n.next();if(!r.isInResult()&&!r.isIncidentEdgeInResult()&&(r.getEdges().getDegree()===0||t===dn.INTERSECTION)){var i=r.getLabel();dn.isResultOfOp(i,t)&&e.filterCoveredNodeToPoint(r)}}};lh.prototype.build=function(t){return this.extractNonCoveredResultNodes(t),this._resultPointList};lh.prototype.interfaces_=function(){return[]};lh.prototype.getClass=function(){return lh};var Io=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};Io.prototype.transformPoint=function(t,e){return this._factory.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))};Io.prototype.transformPolygon=function(t,e){var n=this,r=!0,i=this.transformLinearRing(t.getExteriorRing(),t);(i===null||!(i instanceof Ja)||i.isEmpty())&&(r=!1);for(var o=new vt,c=0;c<t.getNumInteriorRing();c++){var l=n.transformLinearRing(t.getInteriorRingN(c),t);l===null||l.isEmpty()||(l instanceof Ja||(r=!1),o.add(l))}if(r)return this._factory.createPolygon(i,o.toArray([]));var d=new vt;return i!==null&&d.add(i),d.addAll(o),this._factory.buildGeometry(d)};Io.prototype.createCoordinateSequence=function(t){return this._factory.getCoordinateSequenceFactory().create(t)};Io.prototype.getInputGeometry=function(){return this._inputGeom};Io.prototype.transformMultiLineString=function(t,e){for(var n=this,r=new vt,i=0;i<t.getNumGeometries();i++){var o=n.transformLineString(t.getGeometryN(i),t);o!==null&&(o.isEmpty()||r.add(o))}return this._factory.buildGeometry(r)};Io.prototype.transformCoordinates=function(t,e){return this.copy(t)};Io.prototype.transformLineString=function(t,e){return this._factory.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))};Io.prototype.transformMultiPoint=function(t,e){for(var n=this,r=new vt,i=0;i<t.getNumGeometries();i++){var o=n.transformPoint(t.getGeometryN(i),t);o!==null&&(o.isEmpty()||r.add(o))}return this._factory.buildGeometry(r)};Io.prototype.transformMultiPolygon=function(t,e){for(var n=this,r=new vt,i=0;i<t.getNumGeometries();i++){var o=n.transformPolygon(t.getGeometryN(i),t);o!==null&&(o.isEmpty()||r.add(o))}return this._factory.buildGeometry(r)};Io.prototype.copy=function(t){return t.copy()};Io.prototype.transformGeometryCollection=function(t,e){for(var n=this,r=new vt,i=0;i<t.getNumGeometries();i++){var o=n.transform(t.getGeometryN(i));o!==null&&(n._pruneEmptyGeometry&&o.isEmpty()||r.add(o))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(Mn.toGeometryArray(r)):this._factory.buildGeometry(r)};Io.prototype.transform=function(t){if(this._inputGeom=t,this._factory=t.getFactory(),t instanceof Uo)return this.transformPoint(t,null);if(t instanceof Yf)return this.transformMultiPoint(t,null);if(t instanceof Ja)return this.transformLinearRing(t,null);if(t instanceof Rr)return this.transformLineString(t,null);if(t instanceof ic)return this.transformMultiLineString(t,null);if(t instanceof ai)return this.transformPolygon(t,null);if(t instanceof Ya)return this.transformMultiPolygon(t,null);if(t instanceof lo)return this.transformGeometryCollection(t,null);throw new wr("Unknown Geometry subtype: "+t.getClass().getName())};Io.prototype.transformLinearRing=function(t,e){var n=this.transformCoordinates(t.getCoordinateSequence(),t);if(n===null)return this._factory.createLinearRing(null);var r=n.size();return r>0&&r<4&&!this._preserveType?this._factory.createLineString(n):this._factory.createLinearRing(n)};Io.prototype.interfaces_=function(){return[]};Io.prototype.getClass=function(){return Io};var rl=function t(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new Zt,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof Rr&&typeof arguments[1]=="number"){var e=arguments[0],n=arguments[1];t.call(this,e.getCoordinates(),n)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var r=arguments[0],i=arguments[1];this._srcPts=r,this._isClosed=t.isClosed(r),this._snapTolerance=i}};rl.prototype.snapVertices=function(t,e){for(var n=this,r=this._isClosed?t.size()-1:t.size(),i=0;i<r;i++){var o=t.get(i),c=n.findSnapForVertex(o,e);c!==null&&(t.set(i,new Oe(c)),i===0&&n._isClosed&&t.set(t.size()-1,new Oe(c)))}};rl.prototype.findSnapForVertex=function(t,e){for(var n=this,r=0;r<e.length;r++){if(t.equals2D(e[r]))return null;if(t.distance(e[r])<n._snapTolerance)return e[r]}return null};rl.prototype.snapTo=function(t){var e=new Tm(this._srcPts);this.snapVertices(e,t),this.snapSegments(e,t);var n=e.toCoordinateArray();return n};rl.prototype.snapSegments=function(t,e){var n=this;if(e.length===0)return null;var r=e.length;e[0].equals2D(e[e.length-1])&&(r=e.length-1);for(var i=0;i<r;i++){var o=e[i],c=n.findSegmentIndexToSnap(o,t);c>=0&&t.add(c+1,new Oe(o),!1)}};rl.prototype.findSegmentIndexToSnap=function(t,e){for(var n=this,r=cn.MAX_VALUE,i=-1,o=0;o<e.size()-1;o++){if(n._seg.p0=e.get(o),n._seg.p1=e.get(o+1),n._seg.p0.equals2D(t)||n._seg.p1.equals2D(t)){if(n._allowSnappingToSourceVertices)continue;return-1}var c=n._seg.distance(t);c<n._snapTolerance&&c<r&&(r=c,i=o)}return i};rl.prototype.setAllowSnappingToSourceVertices=function(t){this._allowSnappingToSourceVertices=t};rl.prototype.interfaces_=function(){return[]};rl.prototype.getClass=function(){return rl};rl.isClosed=function(t){return t.length<=1?!1:t[0].equals2D(t[t.length-1])};var jr=function(t){this._srcGeom=t||null},oT={SNAP_PRECISION_FACTOR:{configurable:!0}};jr.prototype.snapTo=function(t,e){var n=this.extractTargetCoordinates(t),r=new sT(e,n);return r.transform(this._srcGeom)};jr.prototype.snapToSelf=function(t,e){var n=this.extractTargetCoordinates(this._srcGeom),r=new sT(t,n,!0),i=r.transform(this._srcGeom),o=i;return e&&rn(o,mu)&&(o=i.buffer(0)),o};jr.prototype.computeSnapTolerance=function(t){var e=this.computeMinimumSegmentLength(t),n=e/10;return n};jr.prototype.extractTargetCoordinates=function(t){for(var e=new Ea,n=t.getCoordinates(),r=0;r<n.length;r++)e.add(n[r]);return e.toArray(new Array(0).fill(null))};jr.prototype.computeMinimumSegmentLength=function(t){for(var e=cn.MAX_VALUE,n=0;n<t.length-1;n++){var r=t[n].distance(t[n+1]);r<e&&(e=r)}return e};jr.prototype.interfaces_=function(){return[]};jr.prototype.getClass=function(){return jr};jr.snap=function(t,e,n){var r=new Array(2).fill(null),i=new jr(t);r[0]=i.snapTo(e,n);var o=new jr(e);return r[1]=o.snapTo(r[0],n),r};jr.computeOverlaySnapTolerance=function(){if(arguments.length===1){var t=arguments[0],e=jr.computeSizeBasedSnapTolerance(t),n=t.getPrecisionModel();if(n.getType()===Wn.FIXED){var r=1/n.getScale()*2/1.415;r>e&&(e=r)}return e}else if(arguments.length===2){var i=arguments[0],o=arguments[1];return Math.min(jr.computeOverlaySnapTolerance(i),jr.computeOverlaySnapTolerance(o))}};jr.computeSizeBasedSnapTolerance=function(t){var e=t.getEnvelopeInternal(),n=Math.min(e.getHeight(),e.getWidth()),r=n*jr.SNAP_PRECISION_FACTOR;return r};jr.snapToSelf=function(t,e,n){var r=new jr(t);return r.snapToSelf(e,n)};oT.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(jr,oT);var sT=function(t){function e(n,r,i){t.call(this),this._snapTolerance=n||null,this._snapPts=r||null,this._isSelfSnap=i!==void 0?i:!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.snapLine=function(n,r){var i=new rl(n,this._snapTolerance);return i.setAllowSnappingToSourceVertices(this._isSelfSnap),i.snapTo(r)},e.prototype.transformCoordinates=function(n,r){var i=n.toCoordinateArray(),o=this.snapLine(i,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(o)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Io),ro=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};ro.prototype.getCommon=function(){return cn.longBitsToDouble(this._commonBits)};ro.prototype.add=function(t){var e=cn.doubleToLongBits(t);if(this._isFirst)return this._commonBits=e,this._commonSignExp=ro.signExpBits(this._commonBits),this._isFirst=!1,null;var n=ro.signExpBits(e);if(n!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=ro.numCommonMostSigMantissaBits(this._commonBits,e),this._commonBits=ro.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};ro.prototype.toString=function(){if(arguments.length===1){var t=arguments[0],e=cn.longBitsToDouble(t),n=cn.toBinaryString(t),r="0000000000000000000000000000000000000000000000000000000000000000"+n,i=r.substring(r.length-64),o=i.substring(0,1)+"  "+i.substring(1,12)+"(exp) "+i.substring(12)+" [ "+e+" ]";return o}};ro.prototype.interfaces_=function(){return[]};ro.prototype.getClass=function(){return ro};ro.getBit=function(t,e){var n=1<<e;return t&n?1:0};ro.signExpBits=function(t){return t>>52};ro.zeroLowerBits=function(t,e){var n=(1<<e)-1,r=~n,i=t&r;return i};ro.numCommonMostSigMantissaBits=function(t,e){for(var n=0,r=52;r>=0;r--){if(ro.getBit(t,r)!==ro.getBit(e,r))return n;n++}return 52};var wu=function(){this._commonCoord=null,this._ccFilter=new uh},ab={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};wu.prototype.addCommonBits=function(t){var e=new Su(this._commonCoord);t.apply(e),t.geometryChanged()};wu.prototype.removeCommonBits=function(t){if(this._commonCoord.x===0&&this._commonCoord.y===0)return t;var e=new Oe(this._commonCoord);e.x=-e.x,e.y=-e.y;var n=new Su(e);return t.apply(n),t.geometryChanged(),t};wu.prototype.getCommonCoordinate=function(){return this._commonCoord};wu.prototype.add=function(t){t.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};wu.prototype.interfaces_=function(){return[]};wu.prototype.getClass=function(){return wu};ab.CommonCoordinateFilter.get=function(){return uh};ab.Translater.get=function(){return Su};Object.defineProperties(wu,ab);var uh=function(){this._commonBitsX=new ro,this._commonBitsY=new ro};uh.prototype.filter=function(t){this._commonBitsX.add(t.x),this._commonBitsY.add(t.y)};uh.prototype.getCommonCoordinate=function(){return new Oe(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};uh.prototype.interfaces_=function(){return[Ka]};uh.prototype.getClass=function(){return uh};var Su=function(){this.trans=null;var t=arguments[0];this.trans=t};Su.prototype.filter=function(t,e){var n=t.getOrdinate(e,0)+this.trans.x,r=t.getOrdinate(e,1)+this.trans.y;t.setOrdinate(e,0,n),t.setOrdinate(e,1,r)};Su.prototype.isDone=function(){return!1};Su.prototype.isGeometryChanged=function(){return!0};Su.prototype.interfaces_=function(){return[qs]};Su.prototype.getClass=function(){return Su};var Mi=function(t,e){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=t,this._geom[1]=e,this.computeSnapTolerance()};Mi.prototype.selfSnap=function(t){var e=new jr(t),n=e.snapTo(t,this._snapTolerance);return n};Mi.prototype.removeCommonBits=function(t){this._cbr=new wu,this._cbr.add(t[0]),this._cbr.add(t[1]);var e=new Array(2).fill(null);return e[0]=this._cbr.removeCommonBits(t[0].copy()),e[1]=this._cbr.removeCommonBits(t[1].copy()),e};Mi.prototype.prepareResult=function(t){return this._cbr.addCommonBits(t),t};Mi.prototype.getResultGeometry=function(t){var e=this.snap(this._geom),n=dn.overlayOp(e[0],e[1],t);return this.prepareResult(n)};Mi.prototype.checkValid=function(t){t.isValid()||Fi.out.println("Snapped geometry is invalid")};Mi.prototype.computeSnapTolerance=function(){this._snapTolerance=jr.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};Mi.prototype.snap=function(t){var e=this.removeCommonBits(t),n=jr.snap(e[0],e[1],this._snapTolerance);return n};Mi.prototype.interfaces_=function(){return[]};Mi.prototype.getClass=function(){return Mi};Mi.overlayOp=function(t,e,n){var r=new Mi(t,e);return r.getResultGeometry(n)};Mi.union=function(t,e){return Mi.overlayOp(t,e,dn.UNION)};Mi.intersection=function(t,e){return Mi.overlayOp(t,e,dn.INTERSECTION)};Mi.symDifference=function(t,e){return Mi.overlayOp(t,e,dn.SYMDIFFERENCE)};Mi.difference=function(t,e){return Mi.overlayOp(t,e,dn.DIFFERENCE)};var ho=function(t,e){this._geom=new Array(2).fill(null),this._geom[0]=t,this._geom[1]=e};ho.prototype.getResultGeometry=function(t){var e=null,n=!1,r=null;try{e=dn.overlayOp(this._geom[0],this._geom[1],t);var i=!0;i&&(n=!0)}catch(o){if(o instanceof kl)r=o;else throw o}finally{}if(!n)try{e=Mi.overlayOp(this._geom[0],this._geom[1],t)}catch(o){throw o instanceof kl?r:o}finally{}return e};ho.prototype.interfaces_=function(){return[]};ho.prototype.getClass=function(){return ho};ho.overlayOp=function(t,e,n){var r=new ho(t,e);return r.getResultGeometry(n)};ho.union=function(t,e){return ho.overlayOp(t,e,dn.UNION)};ho.intersection=function(t,e){return ho.overlayOp(t,e,dn.INTERSECTION)};ho.symDifference=function(t,e){return ho.overlayOp(t,e,dn.SYMDIFFERENCE)};ho.difference=function(t,e){return ho.overlayOp(t,e,dn.DIFFERENCE)};var gm=function(){this.mce=null,this.chainIndex=null;var t=arguments[0],e=arguments[1];this.mce=t,this.chainIndex=e};gm.prototype.computeIntersections=function(t,e){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,e)};gm.prototype.interfaces_=function(){return[]};gm.prototype.getClass=function(){return gm};var qo=function t(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var e=arguments[0],n=arguments[1];this._eventType=t.DELETE,this._xValue=e,this._insertEvent=n}else if(arguments.length===3){var r=arguments[0],i=arguments[1],o=arguments[2];this._eventType=t.INSERT,this._label=r,this._xValue=i,this._obj=o}},lb={INSERT:{configurable:!0},DELETE:{configurable:!0}};qo.prototype.isDelete=function(){return this._eventType===qo.DELETE};qo.prototype.setDeleteEventIndex=function(t){this._deleteEventIndex=t};qo.prototype.getObject=function(){return this._obj};qo.prototype.compareTo=function(t){var e=t;return this._xValue<e._xValue?-1:this._xValue>e._xValue?1:this._eventType<e._eventType?-1:this._eventType>e._eventType?1:0};qo.prototype.getInsertEvent=function(){return this._insertEvent};qo.prototype.isInsert=function(){return this._eventType===qo.INSERT};qo.prototype.isSameLabel=function(t){return this._label===null?!1:this._label===t._label};qo.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};qo.prototype.interfaces_=function(){return[Cs]};qo.prototype.getClass=function(){return qo};lb.INSERT.get=function(){return 1};lb.DELETE.get=function(){return 2};Object.defineProperties(qo,lb);var U_=function(){};U_.prototype.interfaces_=function(){return[]};U_.prototype.getClass=function(){return U_};var Ui=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var t=arguments[0],e=arguments[1],n=arguments[2];this._li=t,this._includeProper=e,this._recordIsolated=n};Ui.prototype.isTrivialIntersection=function(t,e,n,r){if(t===n&&this._li.getIntersectionNum()===1){if(Ui.isAdjacentSegments(e,r))return!0;if(t.isClosed()){var i=t.getNumPoints()-1;if(e===0&&r===i||r===0&&e===i)return!0}}return!1};Ui.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Ui.prototype.setIsDoneIfProperInt=function(t){this._isDoneWhenProperInt=t};Ui.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Ui.prototype.isBoundaryPointInternal=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next(),i=r.getCoordinate();if(t.isIntersection(i))return!0}return!1};Ui.prototype.hasProperIntersection=function(){return this._hasProper};Ui.prototype.hasIntersection=function(){return this._hasIntersection};Ui.prototype.isDone=function(){return this._isDone};Ui.prototype.isBoundaryPoint=function(t,e){return e===null?!1:!!(this.isBoundaryPointInternal(t,e[0])||this.isBoundaryPointInternal(t,e[1]))};Ui.prototype.setBoundaryNodes=function(t,e){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=t,this._bdyNodes[1]=e};Ui.prototype.addIntersections=function(t,e,n,r){if(t===n&&e===r)return null;this.numTests++;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],c=n.getCoordinates()[r],l=n.getCoordinates()[r+1];this._li.computeIntersection(i,o,c,l),this._li.hasIntersection()&&(this._recordIsolated&&(t.setIsolated(!1),n.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(t,e,n,r)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};Ui.prototype.interfaces_=function(){return[]};Ui.prototype.getClass=function(){return Ui};Ui.isAdjacentSegments=function(t,e){return Math.abs(t-e)===1};var r5=function(t){function e(){t.call(this),this.events=new vt,this.nOverlaps=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.prepareEvents=function(){var n=this;Hs.sort(this.events);for(var r=0;r<this.events.size();r++){var i=n.events.get(r);i.isDelete()&&i.getInsertEvent().setDeleteEventIndex(r)}},e.prototype.computeIntersections=function(){var n=this;if(arguments.length===1){var r=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var i=0;i<this.events.size();i++){var o=n.events.get(i);if(o.isInsert()&&n.processOverlaps(i,o.getDeleteEventIndex(),o,r),r.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof Ui&&rn(arguments[0],js)&&rn(arguments[1],js)){var c=arguments[0],l=arguments[1],d=arguments[2];this.addEdges(c,c),this.addEdges(l,l),this.computeIntersections(d)}else if(typeof arguments[2]=="boolean"&&rn(arguments[0],js)&&arguments[1]instanceof Ui){var y=arguments[0],S=arguments[1],E=arguments[2];E?this.addEdges(y,null):this.addEdges(y),this.computeIntersections(S)}}},e.prototype.addEdge=function(n,r){for(var i=this,o=n.getMonotoneChainEdge(),c=o.getStartIndexes(),l=0;l<c.length-1;l++){var d=new gm(o,l),y=new qo(r,o.getMinX(l),d);i.events.add(y),i.events.add(new qo(o.getMaxX(l),y))}},e.prototype.processOverlaps=function(n,r,i,o){for(var c=this,l=i.getObject(),d=n;d<r;d++){var y=c.events.get(d);if(y.isInsert()){var S=y.getObject();i.isSameLabel(y)||(l.computeIntersections(S,o),c.nOverlaps++)}}},e.prototype.addEdges=function(){var n=this;if(arguments.length===1)for(var r=arguments[0],i=r.iterator();i.hasNext();){var o=i.next();n.addEdge(o,o)}else if(arguments.length===2)for(var c=arguments[0],l=arguments[1],d=c.iterator();d.hasNext();){var y=d.next();n.addEdge(y,l)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(U_),il=function(){this._min=cn.POSITIVE_INFINITY,this._max=cn.NEGATIVE_INFINITY},aT={NodeComparator:{configurable:!0}};il.prototype.getMin=function(){return this._min};il.prototype.intersects=function(t,e){return!(this._min>e||this._max<t)};il.prototype.getMax=function(){return this._max};il.prototype.toString=function(){return Gs.toLineString(new Oe(this._min,0),new Oe(this._max,0))};il.prototype.interfaces_=function(){return[]};il.prototype.getClass=function(){return il};aT.NodeComparator.get=function(){return _m};Object.defineProperties(il,aT);var _m=function(){};_m.prototype.compare=function(t,e){var n=t,r=e,i=(n._min+n._max)/2,o=(r._min+r._max)/2;return i<o?-1:i>o?1:0};_m.prototype.interfaces_=function(){return[jf]};_m.prototype.getClass=function(){return _m};var i5=function(t){function e(){t.call(this),this._item=null;var n=arguments[0],r=arguments[1],i=arguments[2];this._min=n,this._max=r,this._item=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.query=function(n,r,i){if(!this.intersects(n,r))return null;i.visitItem(this._item)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(il),o5=function(t){function e(){t.call(this),this._node1=null,this._node2=null;var n=arguments[0],r=arguments[1];this._node1=n,this._node2=r,this.buildExtent(this._node1,this._node2)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildExtent=function(n,r){this._min=Math.min(n._min,r._min),this._max=Math.max(n._max,r._max)},e.prototype.query=function(n,r,i){if(!this.intersects(n,r))return null;this._node1!==null&&this._node1.query(n,r,i),this._node2!==null&&this._node2.query(n,r,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(il),ol=function(){this._leaves=new vt,this._root=null,this._level=0};ol.prototype.buildTree=function(){var t=this;Hs.sort(this._leaves,new il.NodeComparator);for(var e=this._leaves,n=null,r=new vt;;){if(t.buildLevel(e,r),r.size()===1)return r.get(0);n=e,e=r,r=n}};ol.prototype.insert=function(t,e,n){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new i5(t,e,n))};ol.prototype.query=function(t,e,n){this.init(),this._root.query(t,e,n)};ol.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};ol.prototype.printNode=function(t){Fi.out.println(Gs.toLineString(new Oe(t._min,this._level),new Oe(t._max,this._level)))};ol.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};ol.prototype.buildLevel=function(t,e){this._level++,e.clear();for(var n=0;n<t.size();n+=2){var r=t.get(n),i=n+1<t.size()?t.get(n):null;if(i===null)e.add(r);else{var o=new o5(t.get(n),t.get(n+1));e.add(o)}}};ol.prototype.interfaces_=function(){return[]};ol.prototype.getClass=function(){return ol};var tp=function(){this._items=new vt};tp.prototype.visitItem=function(t){this._items.add(t)};tp.prototype.getItems=function(){return this._items};tp.prototype.interfaces_=function(){return[gu]};tp.prototype.getClass=function(){return tp};var np=function(){this._index=null;var t=arguments[0];if(!rn(t,mu))throw new wr("Argument must be Polygonal");this._index=new hc(t)},ub={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};np.prototype.locate=function(t){var e=new ya(t),n=new rp(e);return this._index.query(t.y,t.y,n),e.getLocation()};np.prototype.interfaces_=function(){return[Qf]};np.prototype.getClass=function(){return np};ub.SegmentVisitor.get=function(){return rp};ub.IntervalIndexedGeometry.get=function(){return hc};Object.defineProperties(np,ub);var rp=function(){this._counter=null;var t=arguments[0];this._counter=t};rp.prototype.visitItem=function(t){var e=t;this._counter.countSegment(e.getCoordinate(0),e.getCoordinate(1))};rp.prototype.interfaces_=function(){return[gu]};rp.prototype.getClass=function(){return rp};var hc=function(){this._index=new ol;var t=arguments[0];this.init(t)};hc.prototype.init=function(t){for(var e=this,n=Ri.getLines(t),r=n.iterator();r.hasNext();){var i=r.next(),o=i.getCoordinates();e.addLine(o)}};hc.prototype.addLine=function(t){for(var e=this,n=1;n<t.length;n++){var r=new Zt(t[n-1],t[n]),i=Math.min(r.p0.y,r.p1.y),o=Math.max(r.p0.y,r.p1.y);e._index.insert(i,o,r)}};hc.prototype.query=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=new tp;return this._index.query(t,e,n),n.getItems()}else if(arguments.length===3){var r=arguments[0],i=arguments[1],o=arguments[2];this._index.query(r,i,o)}};hc.prototype.interfaces_=function(){return[]};hc.prototype.getClass=function(){return hc};var Ld=function(t){function e(){if(t.call(this),this._parentGeom=null,this._lineEdgeMap=new qC,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Xs,arguments.length===2){var n=arguments[0],r=arguments[1],i=Ss.OGC_SFS_BOUNDARY_RULE;this._argIndex=n,this._parentGeom=r,this._boundaryNodeRule=i,r!==null&&this.add(r)}else if(arguments.length===3){var o=arguments[0],c=arguments[1],l=arguments[2];this._argIndex=o,this._parentGeom=c,this._boundaryNodeRule=l,c!==null&&this.add(c)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertBoundaryPoint=function(n,r){var i=this._nodes.addNode(r),o=i.getLabel(),c=1,l=ze.NONE;l=o.getLocation(n,ut.ON),l===ze.BOUNDARY&&c++;var d=e.determineBoundary(this._boundaryNodeRule,c);o.setLocation(n,d)},e.prototype.computeSelfNodes=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.computeSelfNodes(n,r,!1)}else if(arguments.length===3){var i=arguments[0],o=arguments[1],c=arguments[2],l=new Ui(i,!0,!1);l.setIsDoneIfProperInt(c);var d=this.createEdgeSetIntersector(),y=this._parentGeom instanceof Ja||this._parentGeom instanceof ai||this._parentGeom instanceof Ya,S=o||!y;return d.computeIntersections(this._edges,l,S),this.addSelfIntersectionNodes(this._argIndex),l}},e.prototype.computeSplitEdges=function(n){for(var r=this._edges.iterator();r.hasNext();){var i=r.next();i.eiList.addSplitEdges(n)}},e.prototype.computeEdgeIntersections=function(n,r,i){var o=new Ui(r,i,!0);o.setBoundaryNodes(this.getBoundaryNodes(),n.getBoundaryNodes());var c=this.createEdgeSetIntersector();return c.computeIntersections(this._edges,n._edges,o),o},e.prototype.getGeometry=function(){return this._parentGeom},e.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},e.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},e.prototype.addPoint=function(){if(arguments[0]instanceof Uo){var n=arguments[0],r=n.getCoordinate();this.insertPoint(this._argIndex,r,ze.INTERIOR)}else if(arguments[0]instanceof Oe){var i=arguments[0];this.insertPoint(this._argIndex,i,ze.INTERIOR)}},e.prototype.addPolygon=function(n){var r=this;this.addPolygonRing(n.getExteriorRing(),ze.EXTERIOR,ze.INTERIOR);for(var i=0;i<n.getNumInteriorRing();i++){var o=n.getInteriorRingN(i);r.addPolygonRing(o,ze.INTERIOR,ze.EXTERIOR)}},e.prototype.addEdge=function(n){this.insertEdge(n);var r=n.getCoordinates();this.insertPoint(this._argIndex,r[0],ze.BOUNDARY),this.insertPoint(this._argIndex,r[r.length-1],ze.BOUNDARY)},e.prototype.addLineString=function(n){var r=kn.removeRepeatedPoints(n.getCoordinates());if(r.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=r[0],null;var i=new V_(r,new $n(this._argIndex,ze.INTERIOR));this._lineEdgeMap.put(n,i),this.insertEdge(i),yn.isTrue(r.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,r[0]),this.insertBoundaryPoint(this._argIndex,r[r.length-1])},e.prototype.getInvalidPoint=function(){return this._invalidPoint},e.prototype.getBoundaryPoints=function(){for(var n=this.getBoundaryNodes(),r=new Array(n.size()).fill(null),i=0,o=n.iterator();o.hasNext();){var c=o.next();r[i++]=c.getCoordinate().copy()}return r},e.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},e.prototype.addSelfIntersectionNode=function(n,r,i){if(this.isBoundaryNode(n,r))return null;i===ze.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(n,r):this.insertPoint(n,r,i)},e.prototype.addPolygonRing=function(n,r,i){if(n.isEmpty())return null;var o=kn.removeRepeatedPoints(n.getCoordinates());if(o.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=o[0],null;var c=r,l=i;Tt.isCCW(o)&&(c=i,l=r);var d=new V_(o,new $n(this._argIndex,ze.BOUNDARY,c,l));this._lineEdgeMap.put(n,d),this.insertEdge(d),this.insertPoint(this._argIndex,o[0],ze.BOUNDARY)},e.prototype.insertPoint=function(n,r,i){var o=this._nodes.addNode(r),c=o.getLabel();c===null?o._label=new $n(n,i):c.setLocation(n,i)},e.prototype.createEdgeSetIntersector=function(){return new r5},e.prototype.addSelfIntersectionNodes=function(n){for(var r=this,i=this._edges.iterator();i.hasNext();)for(var o=i.next(),c=o.getLabel().getLocation(n),l=o.eiList.iterator();l.hasNext();){var d=l.next();r.addSelfIntersectionNode(n,d.coord,c)}},e.prototype.add=function(){if(arguments.length===1){var n=arguments[0];if(n.isEmpty())return null;if(n instanceof Ya&&(this._useBoundaryDeterminationRule=!1),n instanceof ai)this.addPolygon(n);else if(n instanceof Rr)this.addLineString(n);else if(n instanceof Uo)this.addPoint(n);else if(n instanceof Yf)this.addCollection(n);else if(n instanceof ic)this.addCollection(n);else if(n instanceof Ya)this.addCollection(n);else if(n instanceof lo)this.addCollection(n);else throw new Error(n.getClass().getName())}else return t.prototype.add.apply(this,arguments)},e.prototype.addCollection=function(n){for(var r=this,i=0;i<n.getNumGeometries();i++){var o=n.getGeometryN(i);r.add(o)}},e.prototype.locate=function(n){return rn(this._parentGeom,mu)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new np(this._parentGeom)),this._areaPtLocator.locate(n)):this._ptLocator.locate(n,this._parentGeom)},e.prototype.findEdge=function(){if(arguments.length===1){var n=arguments[0];return this._lineEdgeMap.get(n)}else return t.prototype.findEdge.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.determineBoundary=function(n,r){return n.isInBoundary(r)?ze.BOUNDARY:ze.INTERIOR},e}(Lr),ip=function(){if(this._li=new gc,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new Ld(0,t)}else if(arguments.length===2){var e=arguments[0],n=arguments[1],r=Ss.OGC_SFS_BOUNDARY_RULE;e.getPrecisionModel().compareTo(n.getPrecisionModel())>=0?this.setComputationPrecision(e.getPrecisionModel()):this.setComputationPrecision(n.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Ld(0,e,r),this._arg[1]=new Ld(1,n,r)}else if(arguments.length===3){var i=arguments[0],o=arguments[1],c=arguments[2];i.getPrecisionModel().compareTo(o.getPrecisionModel())>=0?this.setComputationPrecision(i.getPrecisionModel()):this.setComputationPrecision(o.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Ld(0,i,c),this._arg[1]=new Ld(1,o,c)}};ip.prototype.getArgGeometry=function(t){return this._arg[t].getGeometry()};ip.prototype.setComputationPrecision=function(t){this._resultPrecisionModel=t,this._li.setPrecisionModel(this._resultPrecisionModel)};ip.prototype.interfaces_=function(){return[]};ip.prototype.getClass=function(){return ip};var tc=function(){};tc.prototype.interfaces_=function(){return[]};tc.prototype.getClass=function(){return tc};tc.map=function(){if(arguments[0]instanceof nn&&rn(arguments[1],tc.MapOp)){for(var t=arguments[0],e=arguments[1],n=new vt,r=0;r<t.getNumGeometries();r++){var i=e.map(t.getGeometryN(r));i!==null&&n.add(i)}return t.getFactory().buildGeometry(n)}else if(rn(arguments[0],ni)&&rn(arguments[1],tc.MapOp)){for(var o=arguments[0],c=arguments[1],l=new vt,d=o.iterator();d.hasNext();){var y=d.next(),S=c.map(y);S!==null&&l.add(S)}return l}};tc.MapOp=function(){};var dn=function(t){function e(){var n=arguments[0],r=arguments[1];t.call(this,n,r),this._ptLocator=new Xs,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new Zs,this._resultPolyList=new vt,this._resultLineList=new vt,this._resultPointList=new vt,this._graph=new Lr(new JC),this._geomFact=n.getFactory()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertUniqueEdge=function(n){var r=this._edgeList.findEqualEdge(n);if(r!==null){var i=r.getLabel(),o=n.getLabel();r.isPointwiseEqual(n)||(o=new $n(n.getLabel()),o.flip());var c=r.getDepth();c.isNull()&&c.add(i),c.add(o),i.merge(o)}else this._edgeList.add(n)},e.prototype.getGraph=function(){return this._graph},e.prototype.cancelDuplicateResultEdges=function(){for(var n=this._graph.getEdgeEnds().iterator();n.hasNext();){var r=n.next(),i=r.getSym();r.isInResult()&&i.isInResult()&&(r.setInResult(!1),i.setInResult(!1))}},e.prototype.isCoveredByLA=function(n){return!!(this.isCovered(n,this._resultLineList)||this.isCovered(n,this._resultPolyList))},e.prototype.computeGeometry=function(n,r,i,o){var c=new vt;return c.addAll(n),c.addAll(r),c.addAll(i),c.isEmpty()?e.createEmptyResult(o,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(c)},e.prototype.mergeSymLabels=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var r=n.next();r.getEdges().mergeSymLabels()}},e.prototype.isCovered=function(n,r){for(var i=this,o=r.iterator();o.hasNext();){var c=o.next(),l=i._ptLocator.locate(n,c);if(l!==ze.EXTERIOR)return!0}return!1},e.prototype.replaceCollapsedEdges=function(){for(var n=new vt,r=this._edgeList.iterator();r.hasNext();){var i=r.next();i.isCollapsed()&&(r.remove(),n.add(i.getCollapsedEdge()))}this._edgeList.addAll(n)},e.prototype.updateNodeLabelling=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var r=n.next(),i=r.getEdges().getLabel();r.getLabel().merge(i)}},e.prototype.getResultGeometry=function(n){return this.computeOverlay(n),this._resultGeom},e.prototype.insertUniqueEdges=function(n){for(var r=this,i=n.iterator();i.hasNext();){var o=i.next();r.insertUniqueEdge(o)}},e.prototype.computeOverlay=function(n){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var r=new vt;this._arg[0].computeSplitEdges(r),this._arg[1].computeSplitEdges(r),this.insertUniqueEdges(r),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),cc.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(n),this.cancelDuplicateResultEdges();var i=new jo(this._geomFact);i.add(this._graph),this._resultPolyList=i.getPolygons();var o=new Aa(this,this._geomFact,this._ptLocator);this._resultLineList=o.build(n);var c=new lh(this,this._geomFact,this._ptLocator);this._resultPointList=c.build(n),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,n)},e.prototype.labelIncompleteNode=function(n,r){var i=this._ptLocator.locate(n.getCoordinate(),this._arg[r].getGeometry());n.getLabel().setLocation(r,i)},e.prototype.copyPoints=function(n){for(var r=this,i=this._arg[n].getNodeIterator();i.hasNext();){var o=i.next(),c=r._graph.addNode(o.getCoordinate());c.setLabel(n,o.getLabel().getLocation(n))}},e.prototype.findResultAreaEdges=function(n){for(var r=this._graph.getEdgeEnds().iterator();r.hasNext();){var i=r.next(),o=i.getLabel();o.isArea()&&!i.isInteriorAreaEdge()&&e.isResultOfOp(o.getLocation(0,ut.RIGHT),o.getLocation(1,ut.RIGHT),n)&&i.setInResult(!0)}},e.prototype.computeLabelsFromDepths=function(){for(var n=this._edgeList.iterator();n.hasNext();){var r=n.next(),i=r.getLabel(),o=r.getDepth();if(!o.isNull()){o.normalize();for(var c=0;c<2;c++)!i.isNull(c)&&i.isArea()&&!o.isNull(c)&&(o.getDelta(c)===0?i.toLine(c):(yn.isTrue(!o.isNull(c,ut.LEFT),"depth of LEFT side has not been initialized"),i.setLocation(c,ut.LEFT,o.getLocation(c,ut.LEFT)),yn.isTrue(!o.isNull(c,ut.RIGHT),"depth of RIGHT side has not been initialized"),i.setLocation(c,ut.RIGHT,o.getLocation(c,ut.RIGHT))))}}},e.prototype.computeLabelling=function(){for(var n=this,r=this._graph.getNodes().iterator();r.hasNext();){var i=r.next();i.getEdges().computeLabelling(n._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},e.prototype.labelIncompleteNodes=function(){for(var n=this,r=this._graph.getNodes().iterator();r.hasNext();){var i=r.next(),o=i.getLabel();i.isIsolated()&&(o.isNull(0)?n.labelIncompleteNode(i,0):n.labelIncompleteNode(i,1)),i.getEdges().updateLabelling(o)}},e.prototype.isCoveredByA=function(n){return!!this.isCovered(n,this._resultPolyList)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(ip);dn.overlayOp=function(t,e,n){var r=new dn(t,e),i=r.getResultGeometry(n);return i};dn.intersection=function(t,e){if(t.isEmpty()||e.isEmpty())return dn.createEmptyResult(dn.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){var n=e;return ah.map(t,{interfaces_:function(){return[tc.MapOp]},map:function(r){return r.intersection(n)}})}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),ho.overlayOp(t,e,dn.INTERSECTION)};dn.symDifference=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return dn.createEmptyResult(dn.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),ho.overlayOp(t,e,dn.SYMDIFFERENCE)};dn.resultDimension=function(t,e,n){var r=e.getDimension(),i=n.getDimension(),o=-1;switch(t){case dn.INTERSECTION:o=Math.min(r,i);break;case dn.UNION:o=Math.max(r,i);break;case dn.DIFFERENCE:o=r;break;case dn.SYMDIFFERENCE:o=Math.max(r,i);break}return o};dn.createEmptyResult=function(t,e,n,r){var i=null;switch(dn.resultDimension(t,e,n)){case-1:i=r.createGeometryCollection(new Array(0).fill(null));break;case 0:i=r.createPoint();break;case 1:i=r.createLineString();break;case 2:i=r.createPolygon();break}return i};dn.difference=function(t,e){return t.isEmpty()?dn.createEmptyResult(dn.DIFFERENCE,t,e,t.getFactory()):e.isEmpty()?t.copy():(t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),ho.overlayOp(t,e,dn.DIFFERENCE))};dn.isResultOfOp=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=t.getLocation(0),r=t.getLocation(1);return dn.isResultOfOp(n,r,e)}else if(arguments.length===3){var i=arguments[0],o=arguments[1],c=arguments[2];switch(i===ze.BOUNDARY&&(i=ze.INTERIOR),o===ze.BOUNDARY&&(o=ze.INTERIOR),c){case dn.INTERSECTION:return i===ze.INTERIOR&&o===ze.INTERIOR;case dn.UNION:return i===ze.INTERIOR||o===ze.INTERIOR;case dn.DIFFERENCE:return i===ze.INTERIOR&&o!==ze.INTERIOR;case dn.SYMDIFFERENCE:return i===ze.INTERIOR&&o!==ze.INTERIOR||i!==ze.INTERIOR&&o===ze.INTERIOR}return!1}};dn.INTERSECTION=1;dn.UNION=2;dn.DIFFERENCE=3;dn.SYMDIFFERENCE=4;var pu=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Xs,this._seg=new Zt;var t=arguments[0],e=arguments[1];this._g=t,this._boundaryDistanceTolerance=e,this._linework=this.extractLinework(t)};pu.prototype.isWithinToleranceOfBoundary=function(t){for(var e=this,n=0;n<this._linework.getNumGeometries();n++)for(var r=e._linework.getGeometryN(n),i=r.getCoordinateSequence(),o=0;o<i.size()-1;o++){i.getCoordinate(o,e._seg.p0),i.getCoordinate(o+1,e._seg.p1);var c=e._seg.distance(t);if(c<=e._boundaryDistanceTolerance)return!0}return!1};pu.prototype.getLocation=function(t){return this.isWithinToleranceOfBoundary(t)?ze.BOUNDARY:this._ptLocator.locate(t,this._g)};pu.prototype.extractLinework=function(t){var e=new op;t.apply(e);var n=e.getLinework(),r=Mn.toLineStringArray(n);return t.getFactory().createMultiLineString(r)};pu.prototype.interfaces_=function(){return[]};pu.prototype.getClass=function(){return pu};var op=function(){this._linework=null,this._linework=new vt};op.prototype.getLinework=function(){return this._linework};op.prototype.filter=function(t){var e=this;if(t instanceof ai){var n=t;this._linework.add(n.getExteriorRing());for(var r=0;r<n.getNumInteriorRing();r++)e._linework.add(n.getInteriorRingN(r))}};op.prototype.interfaces_=function(){return[Ia]};op.prototype.getClass=function(){return op};var fc=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var t=arguments[0];this._g=t};fc.prototype.extractPoints=function(t,e,n){for(var r=this,i=t.getCoordinates(),o=0;o<i.length-1;o++)r.computeOffsetPoints(i[o],i[o+1],e,n)};fc.prototype.setSidesToGenerate=function(t,e){this._doLeft=t,this._doRight=e};fc.prototype.getPoints=function(t){for(var e=this,n=new vt,r=Ri.getLines(this._g),i=r.iterator();i.hasNext();){var o=i.next();e.extractPoints(o,t,n)}return n};fc.prototype.computeOffsetPoints=function(t,e,n,r){var i=e.x-t.x,o=e.y-t.y,c=Math.sqrt(i*i+o*o),l=n*i/c,d=n*o/c,y=(e.x+t.x)/2,S=(e.y+t.y)/2;if(this._doLeft){var E=new Oe(y-d,S+l);r.add(E)}if(this._doRight){var C=new Oe(y+d,S-l);r.add(C)}};fc.prototype.interfaces_=function(){return[]};fc.prototype.getClass=function(){return fc};var cs=function t(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=t.TOLERANCE,this._testCoords=new vt;var e=arguments[0],n=arguments[1],r=arguments[2];this._boundaryDistanceTolerance=t.computeBoundaryDistanceTolerance(e,n),this._geom=[e,n,r],this._locFinder=[new pu(this._geom[0],this._boundaryDistanceTolerance),new pu(this._geom[1],this._boundaryDistanceTolerance),new pu(this._geom[2],this._boundaryDistanceTolerance)]},lT={TOLERANCE:{configurable:!0}};cs.prototype.reportResult=function(t,e,n){Fi.out.println("Overlay result invalid - A:"+ze.toLocationSymbol(e[0])+" B:"+ze.toLocationSymbol(e[1])+" expected:"+(n?"i":"e")+" actual:"+ze.toLocationSymbol(e[2]))};cs.prototype.isValid=function(t){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var e=this.checkValid(t);return e};cs.prototype.checkValid=function(){var t=this;if(arguments.length===1){for(var e=arguments[0],n=0;n<this._testCoords.size();n++){var r=t._testCoords.get(n);if(!t.checkValid(e,r))return t._invalidLocation=r,!1}return!0}else if(arguments.length===2){var i=arguments[0],o=arguments[1];return this._location[0]=this._locFinder[0].getLocation(o),this._location[1]=this._locFinder[1].getLocation(o),this._location[2]=this._locFinder[2].getLocation(o),cs.hasLocation(this._location,ze.BOUNDARY)?!0:this.isValidResult(i,this._location)}};cs.prototype.addTestPts=function(t){var e=new fc(t);this._testCoords.addAll(e.getPoints(5*this._boundaryDistanceTolerance))};cs.prototype.isValidResult=function(t,e){var n=dn.isResultOfOp(e[0],e[1],t),r=e[2]===ze.INTERIOR,i=!(n^r);return i||this.reportResult(t,e,n),i};cs.prototype.getInvalidLocation=function(){return this._invalidLocation};cs.prototype.interfaces_=function(){return[]};cs.prototype.getClass=function(){return cs};cs.hasLocation=function(t,e){for(var n=0;n<3;n++)if(t[n]===e)return!0;return!1};cs.computeBoundaryDistanceTolerance=function(t,e){return Math.min(jr.computeSizeBasedSnapTolerance(t),jr.computeSizeBasedSnapTolerance(e))};cs.isValid=function(t,e,n,r){var i=new cs(t,e,r);return i.isValid(n)};lT.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(cs,lT);var ns=function t(e){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=t.extractFactory(e),this._inputGeoms=e};ns.prototype.extractElements=function(t,e){var n=this;if(t===null)return null;for(var r=0;r<t.getNumGeometries();r++){var i=t.getGeometryN(r);n._skipEmpty&&i.isEmpty()||e.add(i)}};ns.prototype.combine=function(){for(var t=this,e=new vt,n=this._inputGeoms.iterator();n.hasNext();){var r=n.next();t.extractElements(r,e)}return e.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(e)};ns.prototype.interfaces_=function(){return[]};ns.prototype.getClass=function(){return ns};ns.combine=function(){if(arguments.length===1){var t=arguments[0],e=new ns(t);return e.combine()}else if(arguments.length===2){var n=arguments[0],r=arguments[1],i=new ns(ns.createList(n,r));return i.combine()}else if(arguments.length===3){var o=arguments[0],c=arguments[1],l=arguments[2],d=new ns(ns.createList(o,c,l));return d.combine()}};ns.extractFactory=function(t){return t.isEmpty()?null:t.iterator().next().getFactory()};ns.createList=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=new vt;return n.add(t),n.add(e),n}else if(arguments.length===3){var r=arguments[0],i=arguments[1],o=arguments[2],c=new vt;return c.add(r),c.add(i),c.add(o),c}};var $r=function(){this._inputPolys=null,this._geomFactory=null;var t=arguments[0];this._inputPolys=t,this._inputPolys===null&&(this._inputPolys=new vt)},uT={STRTREE_NODE_CAPACITY:{configurable:!0}};$r.prototype.reduceToGeometries=function(t){for(var e=this,n=new vt,r=t.iterator();r.hasNext();){var i=r.next(),o=null;rn(i,js)?o=e.unionTree(i):i instanceof nn&&(o=i),n.add(o)}return n};$r.prototype.extractByEnvelope=function(t,e,n){for(var r=new vt,i=0;i<e.getNumGeometries();i++){var o=e.getGeometryN(i);o.getEnvelopeInternal().intersects(t)?r.add(o):n.add(o)}return this._geomFactory.buildGeometry(r)};$r.prototype.unionOptimized=function(t,e){var n=t.getEnvelopeInternal(),r=e.getEnvelopeInternal();if(!n.intersects(r)){var i=ns.combine(t,e);return i}if(t.getNumGeometries()<=1&&e.getNumGeometries()<=1)return this.unionActual(t,e);var o=n.intersection(r);return this.unionUsingEnvelopeIntersection(t,e,o)};$r.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var t=new XC($r.STRTREE_NODE_CAPACITY),e=this._inputPolys.iterator();e.hasNext();){var n=e.next();t.insert(n.getEnvelopeInternal(),n)}this._inputPolys=null;var r=t.itemsTree(),i=this.unionTree(r);return i};$r.prototype.binaryUnion=function(){if(arguments.length===1){var t=arguments[0];return this.binaryUnion(t,0,t.size())}else if(arguments.length===3){var e=arguments[0],n=arguments[1],r=arguments[2];if(r-n<=1){var i=$r.getGeometry(e,n);return this.unionSafe(i,null)}else{if(r-n===2)return this.unionSafe($r.getGeometry(e,n),$r.getGeometry(e,n+1));var o=Math.trunc((r+n)/2),c=this.binaryUnion(e,n,o),l=this.binaryUnion(e,o,r);return this.unionSafe(c,l)}}};$r.prototype.repeatedUnion=function(t){for(var e=null,n=t.iterator();n.hasNext();){var r=n.next();e===null?e=r.copy():e=e.union(r)}return e};$r.prototype.unionSafe=function(t,e){return t===null&&e===null?null:t===null?e.copy():e===null?t.copy():this.unionOptimized(t,e)};$r.prototype.unionActual=function(t,e){return $r.restrictToPolygons(t.union(e))};$r.prototype.unionTree=function(t){var e=this.reduceToGeometries(t),n=this.binaryUnion(e);return n};$r.prototype.unionUsingEnvelopeIntersection=function(t,e,n){var r=new vt,i=this.extractByEnvelope(n,t,r),o=this.extractByEnvelope(n,e,r),c=this.unionActual(i,o);r.add(c);var l=ns.combine(r);return l};$r.prototype.bufferUnion=function(){if(arguments.length===1){var t=arguments[0],e=t.get(0).getFactory(),n=e.buildGeometry(t),r=n.buffer(0);return r}else if(arguments.length===2){var i=arguments[0],o=arguments[1],c=i.getFactory(),l=c.createGeometryCollection([i,o]),d=l.buffer(0);return d}};$r.prototype.interfaces_=function(){return[]};$r.prototype.getClass=function(){return $r};$r.restrictToPolygons=function(t){if(rn(t,mu))return t;var e=Tl.getPolygons(t);return e.size()===1?e.get(0):t.getFactory().createMultiPolygon(Mn.toPolygonArray(e))};$r.getGeometry=function(t,e){return e>=t.size()?null:t.get(e)};$r.union=function(t){var e=new $r(t);return e.union()};uT.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties($r,uT);var j_=function(){};j_.prototype.interfaces_=function(){return[]};j_.prototype.getClass=function(){return j_};j_.union=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return dn.createEmptyResult(dn.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),ho.overlayOp(t,e,dn.UNION)};function _c(){return new G_}function G_(){this.reset()}G_.prototype={constructor:G_,reset:function(){this.s=this.t=0},add:function(t){aS(qg,t,this.t),aS(this,qg.s,this.s),this.s?this.t+=qg.t:this.s=qg.t},valueOf:function(){return this.s}};var qg=new G_;function aS(t,e,n){var r=t.s=e+n,i=r-e,o=r-i;t.t=e-o+(n-i)}var Dr=1e-6,nr=Math.PI,Cl=nr/2,lS=nr/4,Ol=nr*2,Zu=180/nr,ca=nr/180,so=Math.abs,s5=Math.atan,sp=Math.atan2,ri=Math.cos,ii=Math.sin,wp=Math.sqrt;function cT(t){return t>1?0:t<-1?nr:Math.acos(t)}function ch(t){return t>1?Cl:t<-1?-Cl:Math.asin(t)}function Bd(){}function q_(t,e){t&&cS.hasOwnProperty(t.type)&&cS[t.type](t,e)}var uS={Feature:function(t,e){q_(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)q_(n[r].geometry,e)}},cS={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){e1(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)e1(n[r],e,0)},Polygon:function(t,e){hS(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)hS(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)q_(n[r],e)}};function e1(t,e,n){var r=-1,i=t.length-n,o;for(e.lineStart();++r<i;)o=t[r],e.point(o[0],o[1],o[2]);e.lineEnd()}function hS(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)e1(t[n],e,1);e.polygonEnd()}function a5(t,e){t&&uS.hasOwnProperty(t.type)?uS[t.type](t,e):q_(t,e)}_c();_c();function t1(t){return[sp(t[1],t[0]),ch(t[2])]}function ap(t){var e=t[0],n=t[1],r=ri(n);return[r*ri(e),r*ii(e),ii(n)]}function Wg(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function W_(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function ov(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function Hg(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function n1(t){var e=wp(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}_c();function hT(t,e){function n(r,i){return r=t(r,i),e(r[0],r[1])}return t.invert&&e.invert&&(n.invert=function(r,i){return r=e.invert(r,i),r&&t.invert(r[0],r[1])}),n}function r1(t,e){return[t>nr?t-Ol:t<-nr?t+Ol:t,e]}r1.invert=r1;function l5(t,e,n){return(t%=Ol)?e||n?hT(pS(t),dS(e,n)):pS(t):e||n?dS(e,n):r1}function fS(t){return function(e,n){return e+=t,[e>nr?e-Ol:e<-nr?e+Ol:e,n]}}function pS(t){var e=fS(t);return e.invert=fS(-t),e}function dS(t,e){var n=ri(t),r=ii(t),i=ri(e),o=ii(e);function c(l,d){var y=ri(d),S=ri(l)*y,E=ii(l)*y,C=ii(d),A=C*n+S*r;return[sp(E*i-A*o,S*n-C*r),ch(A*i+E*o)]}return c.invert=function(l,d){var y=ri(d),S=ri(l)*y,E=ii(l)*y,C=ii(d),A=C*i-E*o;return[sp(E*i+C*o,S*n+A*r),ch(A*n-S*r)]},c}function u5(t,e,n,r,i,o){if(n){var c=ri(e),l=ii(e),d=r*n;i==null?(i=e+r*Ol,o=e-d/2):(i=mS(c,i),o=mS(c,o),(r>0?i<o:i>o)&&(i+=r*Ol));for(var y,S=i;r>0?S>o:S<o;S-=d)y=t1([c,-l*ri(S),-l*ii(S)]),t.point(y[0],y[1])}}function mS(t,e){e=ap(e),e[0]-=t,n1(e);var n=cT(-e[1]);return((-e[2]<0?-n:n)+Ol-Dr)%Ol}function fT(){var t=[],e;return{point:function(n,r){e.push([n,r])},lineStart:function(){t.push(e=[])},lineEnd:Bd,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function c5(t,e,n,r,i,o){var c=t[0],l=t[1],d=e[0],y=e[1],S=0,E=1,C=d-c,A=y-l,M;if(M=n-c,!(!C&&M>0)){if(M/=C,C<0){if(M<S)return;M<E&&(E=M)}else if(C>0){if(M>E)return;M>S&&(S=M)}if(M=i-c,!(!C&&M<0)){if(M/=C,C<0){if(M>E)return;M>S&&(S=M)}else if(C>0){if(M<S)return;M<E&&(E=M)}if(M=r-l,!(!A&&M>0)){if(M/=A,A<0){if(M<S)return;M<E&&(E=M)}else if(A>0){if(M>E)return;M>S&&(S=M)}if(M=o-l,!(!A&&M<0)){if(M/=A,A<0){if(M>E)return;M>S&&(S=M)}else if(A>0){if(M<S)return;M<E&&(E=M)}return S>0&&(t[0]=c+S*C,t[1]=l+S*A),E<1&&(e[0]=c+E*C,e[1]=l+E*A),!0}}}}}function l_(t,e){return so(t[0]-e[0])<Dr&&so(t[1]-e[1])<Dr}function Zg(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function pT(t,e,n,r,i){var o=[],c=[],l,d;if(t.forEach(function(M){if(!((R=M.length-1)<=0)){var R,N=M[0],B=M[R],O;if(l_(N,B)){for(i.lineStart(),l=0;l<R;++l)i.point((N=M[l])[0],N[1]);i.lineEnd();return}o.push(O=new Zg(N,M,null,!0)),c.push(O.o=new Zg(N,null,O,!1)),o.push(O=new Zg(B,M,null,!1)),c.push(O.o=new Zg(B,null,O,!0))}}),!!o.length){for(c.sort(e),gS(o),gS(c),l=0,d=c.length;l<d;++l)c[l].e=n=!n;for(var y=o[0],S,E;;){for(var C=y,A=!0;C.v;)if((C=C.n)===y)return;S=C.z,i.lineStart();do{if(C.v=C.o.v=!0,C.e){if(A)for(l=0,d=S.length;l<d;++l)i.point((E=S[l])[0],E[1]);else r(C.x,C.n.x,1,i);C=C.n}else{if(A)for(S=C.p.z,l=S.length-1;l>=0;--l)i.point((E=S[l])[0],E[1]);else r(C.x,C.p.x,-1,i);C=C.p}C=C.o,S=C.z,A=!A}while(!C.v);i.lineEnd()}}}function gS(t){if(e=t.length){for(var e,n=0,r=t[0],i;++n<e;)r.n=i=t[n],i.p=r,r=i;r.n=i=t[0],i.p=r}}function dT(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function h5(t){return t.length===1&&(t=f5(t)),{left:function(e,n,r,i){for(r==null&&(r=0),i==null&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)<0?r=o+1:i=o}return r},right:function(e,n,r,i){for(r==null&&(r=0),i==null&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)>0?i=o:r=o+1}return r}}}function f5(t){return function(e,n){return dT(t(e),n)}}h5(dT);function mT(t){for(var e=t.length,n,r=-1,i=0,o,c;++r<e;)i+=t[r].length;for(o=new Array(i);--e>=0;)for(c=t[e],n=c.length;--n>=0;)o[--i]=c[n];return o}var Vd=1e9,Xg=-Vd;function p5(t,e,n,r){function i(y,S){return t<=y&&y<=n&&e<=S&&S<=r}function o(y,S,E,C){var A=0,M=0;if(y==null||(A=c(y,E))!==(M=c(S,E))||d(y,S)<0^E>0)do C.point(A===0||A===3?t:n,A>1?r:e);while((A=(A+E+4)%4)!==M);else C.point(S[0],S[1])}function c(y,S){return so(y[0]-t)<Dr?S>0?0:3:so(y[0]-n)<Dr?S>0?2:1:so(y[1]-e)<Dr?S>0?1:0:S>0?3:2}function l(y,S){return d(y.x,S.x)}function d(y,S){var E=c(y,1),C=c(S,1);return E!==C?E-C:E===0?S[1]-y[1]:E===1?y[0]-S[0]:E===2?y[1]-S[1]:S[0]-y[0]}return function(y){var S=y,E=fT(),C,A,M,R,N,B,O,G,U,Z,ue,ae={point:se,lineStart:oe,lineEnd:Ge,polygonStart:ke,polygonEnd:K};function se(ot,ft){i(ot,ft)&&S.point(ot,ft)}function fe(){for(var ot=0,ft=0,At=A.length;ft<At;++ft)for(var Ke=A[ft],Ft=1,bt=Ke.length,Rt=Ke[0],Ot,ln,Ln=Rt[0],an=Rt[1];Ft<bt;++Ft)Ot=Ln,ln=an,Rt=Ke[Ft],Ln=Rt[0],an=Rt[1],ln<=r?an>r&&(Ln-Ot)*(r-ln)>(an-ln)*(t-Ot)&&++ot:an<=r&&(Ln-Ot)*(r-ln)<(an-ln)*(t-Ot)&&--ot;return ot}function ke(){S=E,C=[],A=[],ue=!0}function K(){var ot=fe(),ft=ue&&ot,At=(C=mT(C)).length;(ft||At)&&(y.polygonStart(),ft&&(y.lineStart(),o(null,null,1,y),y.lineEnd()),At&&pT(C,l,ot,o,y),y.polygonEnd()),S=y,C=A=M=null}function oe(){ae.point=Te,A&&A.push(M=[]),Z=!0,U=!1,O=G=NaN}function Ge(){C&&(Te(R,N),B&&U&&E.rejoin(),C.push(E.result())),ae.point=se,U&&S.lineEnd()}function Te(ot,ft){var At=i(ot,ft);if(A&&M.push([ot,ft]),Z)R=ot,N=ft,B=At,Z=!1,At&&(S.lineStart(),S.point(ot,ft));else if(At&&U)S.point(ot,ft);else{var Ke=[O=Math.max(Xg,Math.min(Vd,O)),G=Math.max(Xg,Math.min(Vd,G))],Ft=[ot=Math.max(Xg,Math.min(Vd,ot)),ft=Math.max(Xg,Math.min(Vd,ft))];c5(Ke,Ft,t,e,n,r)?(U||(S.lineStart(),S.point(Ke[0],Ke[1])),S.point(Ft[0],Ft[1]),At||S.lineEnd(),ue=!1):At&&(S.lineStart(),S.point(ot,ft),ue=!1)}O=ot,G=ft,U=At}return ae}}var sv=_c();function d5(t,e){var n=e[0],r=e[1],i=[ii(n),-ri(n),0],o=0,c=0;sv.reset();for(var l=0,d=t.length;l<d;++l)if(S=(y=t[l]).length)for(var y,S,E=y[S-1],C=E[0],A=E[1]/2+lS,M=ii(A),R=ri(A),N=0;N<S;++N,C=O,M=U,R=Z,E=B){var B=y[N],O=B[0],G=B[1]/2+lS,U=ii(G),Z=ri(G),ue=O-C,ae=ue>=0?1:-1,se=ae*ue,fe=se>nr,ke=M*U;if(sv.add(sp(ke*ae*ii(se),R*Z+ke*ri(se))),o+=fe?ue+ae*Ol:ue,fe^C>=n^O>=n){var K=W_(ap(E),ap(B));n1(K);var oe=W_(i,K);n1(oe);var Ge=(fe^ue>=0?-1:1)*ch(oe[2]);(r>Ge||r===Ge&&(K[0]||K[1]))&&(c+=fe^ue>=0?1:-1)}}return(o<-Dr||o<Dr&&sv<-Dr)^c&1}_c();function _S(t){return t}_c();_c();var lp=1/0,H_=lp,ym=-lp,Z_=ym,yS={point:m5,lineStart:Bd,lineEnd:Bd,polygonStart:Bd,polygonEnd:Bd,result:function(){var t=[[lp,H_],[ym,Z_]];return ym=Z_=-(H_=lp=1/0),t}};function m5(t,e){t<lp&&(lp=t),t>ym&&(ym=t),e<H_&&(H_=e),e>Z_&&(Z_=e)}_c();function gT(t,e,n,r){return function(i,o){var c=e(o),l=i.invert(r[0],r[1]),d=fT(),y=e(d),S=!1,E,C,A,M={point:R,lineStart:B,lineEnd:O,polygonStart:function(){M.point=G,M.lineStart=U,M.lineEnd=Z,C=[],E=[]},polygonEnd:function(){M.point=R,M.lineStart=B,M.lineEnd=O,C=mT(C);var ue=d5(E,l);C.length?(S||(o.polygonStart(),S=!0),pT(C,_5,ue,n,o)):ue&&(S||(o.polygonStart(),S=!0),o.lineStart(),n(null,null,1,o),o.lineEnd()),S&&(o.polygonEnd(),S=!1),C=E=null},sphere:function(){o.polygonStart(),o.lineStart(),n(null,null,1,o),o.lineEnd(),o.polygonEnd()}};function R(ue,ae){var se=i(ue,ae);t(ue=se[0],ae=se[1])&&o.point(ue,ae)}function N(ue,ae){var se=i(ue,ae);c.point(se[0],se[1])}function B(){M.point=N,c.lineStart()}function O(){M.point=R,c.lineEnd()}function G(ue,ae){A.push([ue,ae]);var se=i(ue,ae);y.point(se[0],se[1])}function U(){y.lineStart(),A=[]}function Z(){G(A[0][0],A[0][1]),y.lineEnd();var ue=y.clean(),ae=d.result(),se,fe=ae.length,ke,K,oe;if(A.pop(),E.push(A),A=null,!!fe){if(ue&1){if(K=ae[0],(ke=K.length-1)>0){for(S||(o.polygonStart(),S=!0),o.lineStart(),se=0;se<ke;++se)o.point((oe=K[se])[0],oe[1]);o.lineEnd()}return}fe>1&&ue&2&&ae.push(ae.pop().concat(ae.shift())),C.push(ae.filter(g5))}}return M}}function g5(t){return t.length>1}function _5(t,e){return((t=t.x)[0]<0?t[1]-Cl-Dr:Cl-t[1])-((e=e.x)[0]<0?e[1]-Cl-Dr:Cl-e[1])}const vS=gT(function(){return!0},y5,b5,[-nr,-Cl]);function y5(t){var e=NaN,n=NaN,r=NaN,i;return{lineStart:function(){t.lineStart(),i=1},point:function(o,c){var l=o>0?nr:-nr,d=so(o-e);so(d-nr)<Dr?(t.point(e,n=(n+c)/2>0?Cl:-Cl),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(l,n),t.point(o,n),i=0):r!==l&&d>=nr&&(so(e-r)<Dr&&(e-=r*Dr),so(o-l)<Dr&&(o-=l*Dr),n=v5(e,n,o,c),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(l,n),i=0),t.point(e=o,n=c),r=l},lineEnd:function(){t.lineEnd(),e=n=NaN},clean:function(){return 2-i}}}function v5(t,e,n,r){var i,o,c=ii(t-n);return so(c)>Dr?s5((ii(e)*(o=ri(r))*ii(n)-ii(r)*(i=ri(e))*ii(t))/(i*o*c)):(e+r)/2}function b5(t,e,n,r){var i;if(t==null)i=n*Cl,r.point(-nr,i),r.point(0,i),r.point(nr,i),r.point(nr,0),r.point(nr,-i),r.point(0,-i),r.point(-nr,-i),r.point(-nr,0),r.point(-nr,i);else if(so(t[0]-e[0])>Dr){var o=t[0]<e[0]?nr:-nr;i=n*o/2,r.point(-o,i),r.point(0,i),r.point(o,i)}else r.point(e[0],e[1])}function x5(t,e){var n=ri(t),r=n>0,i=so(n)>Dr;function o(S,E,C,A){u5(A,t,e,C,S,E)}function c(S,E){return ri(S)*ri(E)>n}function l(S){var E,C,A,M,R;return{lineStart:function(){M=A=!1,R=1},point:function(N,B){var O=[N,B],G,U=c(N,B),Z=r?U?0:y(N,B):U?y(N+(N<0?nr:-nr),B):0;if(!E&&(M=A=U)&&S.lineStart(),U!==A&&(G=d(E,O),(!G||l_(E,G)||l_(O,G))&&(O[0]+=Dr,O[1]+=Dr,U=c(O[0],O[1]))),U!==A)R=0,U?(S.lineStart(),G=d(O,E),S.point(G[0],G[1])):(G=d(E,O),S.point(G[0],G[1]),S.lineEnd()),E=G;else if(i&&E&&r^U){var ue;!(Z&C)&&(ue=d(O,E,!0))&&(R=0,r?(S.lineStart(),S.point(ue[0][0],ue[0][1]),S.point(ue[1][0],ue[1][1]),S.lineEnd()):(S.point(ue[1][0],ue[1][1]),S.lineEnd(),S.lineStart(),S.point(ue[0][0],ue[0][1])))}U&&(!E||!l_(E,O))&&S.point(O[0],O[1]),E=O,A=U,C=Z},lineEnd:function(){A&&S.lineEnd(),E=null},clean:function(){return R|(M&&A)<<1}}}function d(S,E,C){var A=ap(S),M=ap(E),R=[1,0,0],N=W_(A,M),B=Wg(N,N),O=N[0],G=B-O*O;if(!G)return!C&&S;var U=n*B/G,Z=-n*O/G,ue=W_(R,N),ae=Hg(R,U),se=Hg(N,Z);ov(ae,se);var fe=ue,ke=Wg(ae,fe),K=Wg(fe,fe),oe=ke*ke-K*(Wg(ae,ae)-1);if(!(oe<0)){var Ge=wp(oe),Te=Hg(fe,(-ke-Ge)/K);if(ov(Te,ae),Te=t1(Te),!C)return Te;var ot=S[0],ft=E[0],At=S[1],Ke=E[1],Ft;ft<ot&&(Ft=ot,ot=ft,ft=Ft);var bt=ft-ot,Rt=so(bt-nr)<Dr,Ot=Rt||bt<Dr;if(!Rt&&Ke<At&&(Ft=At,At=Ke,Ke=Ft),Ot?Rt?At+Ke>0^Te[1]<(so(Te[0]-ot)<Dr?At:Ke):At<=Te[1]&&Te[1]<=Ke:bt>nr^(ot<=Te[0]&&Te[0]<=ft)){var ln=Hg(fe,(-ke+Ge)/K);return ov(ln,ae),[Te,t1(ln)]}}}function y(S,E){var C=r?t:nr-t,A=0;return S<-C?A|=1:S>C&&(A|=2),E<-C?A|=4:E>C&&(A|=8),A}return gT(c,l,o,r?[0,-t]:[-nr,t-nr])}function _T(t){return function(e){var n=new i1;for(var r in t)n[r]=t[r];return n.stream=e,n}}function i1(){}i1.prototype={constructor:i1,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function yT(t,e,n){var r=e[1][0]-e[0][0],i=e[1][1]-e[0][1],o=t.clipExtent&&t.clipExtent();t.scale(150).translate([0,0]),o!=null&&t.clipExtent(null),a5(n,t.stream(yS));var c=yS.result(),l=Math.min(r/(c[1][0]-c[0][0]),i/(c[1][1]-c[0][1])),d=+e[0][0]+(r-l*(c[1][0]+c[0][0]))/2,y=+e[0][1]+(i-l*(c[1][1]+c[0][1]))/2;return o!=null&&t.clipExtent(o),t.scale(l*150).translate([d,y])}function w5(t,e,n){return yT(t,[[0,0],e],n)}var bS=16,S5=ri(30*ca);function xS(t,e){return+e?I5(t,e):E5(t)}function E5(t){return _T({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}function I5(t,e){function n(r,i,o,c,l,d,y,S,E,C,A,M,R,N){var B=y-r,O=S-i,G=B*B+O*O;if(G>4*e&&R--){var U=c+C,Z=l+A,ue=d+M,ae=wp(U*U+Z*Z+ue*ue),se=ch(ue/=ae),fe=so(so(ue)-1)<Dr||so(o-E)<Dr?(o+E)/2:sp(Z,U),ke=t(fe,se),K=ke[0],oe=ke[1],Ge=K-r,Te=oe-i,ot=O*Ge-B*Te;(ot*ot/G>e||so((B*Ge+O*Te)/G-.5)>.3||c*C+l*A+d*M<S5)&&(n(r,i,o,c,l,d,K,oe,fe,U/=ae,Z/=ae,ue,R,N),N.point(K,oe),n(K,oe,fe,U,Z,ue,y,S,E,C,A,M,R,N))}}return function(r){var i,o,c,l,d,y,S,E,C,A,M,R,N={point:B,lineStart:O,lineEnd:U,polygonStart:function(){r.polygonStart(),N.lineStart=Z},polygonEnd:function(){r.polygonEnd(),N.lineStart=O}};function B(se,fe){se=t(se,fe),r.point(se[0],se[1])}function O(){E=NaN,N.point=G,r.lineStart()}function G(se,fe){var ke=ap([se,fe]),K=t(se,fe);n(E,C,S,A,M,R,E=K[0],C=K[1],S=se,A=ke[0],M=ke[1],R=ke[2],bS,r),r.point(E,C)}function U(){N.point=B,r.lineEnd()}function Z(){O(),N.point=ue,N.lineEnd=ae}function ue(se,fe){G(i=se,fe),o=E,c=C,l=A,d=M,y=R,N.point=G}function ae(){n(E,C,S,A,M,R,o,c,i,l,d,y,bS,r),N.lineEnd=U,U()}return N}}var C5=_T({point:function(t,e){this.stream.point(t*ca,e*ca)}});function T5(t){return L5(function(){return t})()}function L5(t){var e,n=150,r=480,i=250,o,c,l=0,d=0,y=0,S=0,E=0,C,A,M=null,R=vS,N=null,B,O,G,U=_S,Z=.5,ue=xS(K,Z),ae,se;function fe(Te){return Te=A(Te[0]*ca,Te[1]*ca),[Te[0]*n+o,c-Te[1]*n]}function ke(Te){return Te=A.invert((Te[0]-o)/n,(c-Te[1])/n),Te&&[Te[0]*Zu,Te[1]*Zu]}function K(Te,ot){return Te=e(Te,ot),[Te[0]*n+o,c-Te[1]*n]}fe.stream=function(Te){return ae&&se===Te?ae:ae=C5(R(C,ue(U(se=Te))))},fe.clipAngle=function(Te){return arguments.length?(R=+Te?x5(M=Te*ca,6*ca):(M=null,vS),Ge()):M*Zu},fe.clipExtent=function(Te){return arguments.length?(U=Te==null?(N=B=O=G=null,_S):p5(N=+Te[0][0],B=+Te[0][1],O=+Te[1][0],G=+Te[1][1]),Ge()):N==null?null:[[N,B],[O,G]]},fe.scale=function(Te){return arguments.length?(n=+Te,oe()):n},fe.translate=function(Te){return arguments.length?(r=+Te[0],i=+Te[1],oe()):[r,i]},fe.center=function(Te){return arguments.length?(l=Te[0]%360*ca,d=Te[1]%360*ca,oe()):[l*Zu,d*Zu]},fe.rotate=function(Te){return arguments.length?(y=Te[0]%360*ca,S=Te[1]%360*ca,E=Te.length>2?Te[2]%360*ca:0,oe()):[y*Zu,S*Zu,E*Zu]},fe.precision=function(Te){return arguments.length?(ue=xS(K,Z=Te*Te),Ge()):wp(Z)},fe.fitExtent=function(Te,ot){return yT(fe,Te,ot)},fe.fitSize=function(Te,ot){return w5(fe,Te,ot)};function oe(){A=hT(C=l5(y,S,E),e);var Te=e(l,d);return o=r-Te[0]*n,c=i+Te[1]*n,Ge()}function Ge(){return ae=se=null,fe}return function(){return e=t.apply(this,arguments),fe.invert=e.invert&&ke,oe()}}function vT(t){return function(e,n){var r=ri(e),i=ri(n),o=t(r*i);return[o*i*ii(e),o*ii(n)]}}function bT(t){return function(e,n){var r=wp(e*e+n*n),i=t(r),o=ii(i),c=ri(i);return[sp(e*o,r*c),ch(r&&n*o/r)]}}var P5=vT(function(t){return wp(2/(1+t))});P5.invert=bT(function(t){return 2*ch(t/2)});var xT=vT(function(t){return(t=cT(t))&&t/ii(t)});xT.invert=bT(function(t){return t});function M5(){return T5(xT).scale(79.4188).clipAngle(180-.001)}function wS(t,e){return[t,e]}wS.invert=wS;function k5(t,e,n){n=n||{};var r=n.units||"kilometers",i=n.steps||8;if(!t)throw new Error("geojson is required");if(typeof n!="object")throw new Error("options must be an object");if(typeof i!="number")throw new Error("steps must be an number");if(e===void 0)throw new Error("radius is required");if(i<=0)throw new Error("steps must be greater than 0");var o=[];switch(t.type){case"GeometryCollection":return OC(t,function(c){var l=u_(c,e,r,i);l&&o.push(l)}),Kv(o);case"FeatureCollection":return nS(t,function(c){var l=u_(c,e,r,i);l&&nS(l,function(d){d&&o.push(d)})}),Kv(o)}return u_(t,e,r,i)}function u_(t,e,n,r){var i=t.properties||{},o=t.type==="Feature"?t.geometry:t;if(o.type==="GeometryCollection"){var c=[];return OC(t,function(R){var N=u_(R,e,n,r);N&&c.push(N)}),Kv(c)}var l=A5(o),d={type:o.type,coordinates:ST(o.coordinates,l)},y=new tb,S=y.read(d),E=BO(VO(e,n),"meters"),C=Ni.bufferOp(S,E,r),A=new HC;if(C=A.write(C),!wT(C.coordinates)){var M={type:C.type,coordinates:ET(C.coordinates,l)};return ly(M,i)}}function wT(t){return Array.isArray(t[0])?wT(t[0]):isNaN(t[0])}function ST(t,e){return typeof t[0]!="object"?e(t):t.map(function(n){return ST(n,e)})}function ET(t,e){return typeof t[0]!="object"?e.invert(t):t.map(function(n){return ET(n,e)})}function A5(t){var e=jO(t).geometry.coordinates,n=[-e[0],-e[1]];return M5().rotate(n).scale(es)}function D5(t,e){var n=z_(t),r=z_(e),i=t.properties||{},o=kC.difference(n.coordinates,r.coordinates);return o.length===0?null:o.length===1?DC(o[0],i):RC(o,i)}function SS(t){let e;for(const n of t)e&&n[0]-e[0]>=180?n[0]-=360:e&&n[0]-e[0]<-180&&(n[0]+=360),e=n}function ES(t,e){const n=D5({type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]},t);if(!n)return;n.properties={isMask:"y"};const r=k5(t,0);if(r.geometry.type==="Polygon")for(const i of r.geometry.coordinates)SS(i);else for(const i of r.geometry.coordinates)for(const o of i)SS(o);e({type:"FeatureCollection",features:[r,n]})}let IS={type:"FeatureCollection",features:[]};function R5(t,e,n=!0,r=!0,i={},o={},c={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}}){let l,d=[],y,S;function E(){(c!=null&&c.fill||c!=null&&c.line)&&t.addSource("full-geom",{type:"geojson",data:IS}),c!=null&&c.fill&&t.addLayer({...c==null?void 0:c.fill,id:"full-geom-fill",type:"fill",source:"full-geom"}),c!=null&&c.line&&t.addLayer({...c==null?void 0:c.line,id:"full-geom-line",type:"line",source:"full-geom"})}t.loaded()?E():t.once("load",()=>{E()});const C=M=>{l==null||l({type:"mapClick",coordinates:[M.lngLat.lng,M.lngLat.lat]})};function A(M=!1){if(!e)throw new Error;const R=document.createElement("div");return M&&R.classList.add("marker-interactive"),new uO({props:{displayIn:"maplibre"},target:R}),new e.Marker({element:R,offset:[1,-13]})}return{setEventHandler(M){M?(l=M,t.on("click",C)):(l=void 0,t.off("click",C))},flyTo(M,R){t.flyTo({center:M,zoom:R,...i})},fitBounds(M,R,N){t.fitBounds([[M[0],M[1]],[M[2],M[3]]],{padding:R,maxZoom:N,...o})},indicateReverse(M){t.getCanvasContainer().style.cursor=M?"crosshair":""},setReverseMarker(M){!e||!n||(S?M?S.setLngLat(M):(S.remove(),S=void 0):M&&(S=(typeof n=="object"?new e.Marker(n):A()).setLngLat(M).addTo(t),S.getElement().classList.add("marker-reverse")))},setMarkers(M,R){if(!n)return;function N(B){var O;(O=t.getSource("full-geom"))==null||O.setData(B)}for(const B of d)B.remove();if(d.length=0,N(IS),!!e){if(R){let B=!1;if(R.geometry.type==="GeometryCollection"){const O=R.geometry.geometries.filter(G=>G.type==="Polygon"||G.type==="MultiPolygon");if(O.length>0){let G=O.pop();for(const U of O)G=UO(G,U);ES({...R,geometry:G},N),B=!0}else{const G=R.geometry.geometries.filter(U=>U.type==="LineString"||U.type==="MultiLineString");G.length>0&&(N({...R,geometry:{type:"GeometryCollection",geometries:G}}),B=!0)}}if(!B){if(R.geometry.type==="Polygon"||R.geometry.type==="MultiPolygon")ES(R,N);else if(R.geometry.type==="LineString"||R.geometry.type==="MultiLineString"){N(R);return}}n&&d.push((typeof n=="object"?new e.Marker(n):A()).setLngLat(R.center).addTo(t))}if(r)for(const B of M??[]){if(B===R)continue;const O=(typeof r=="object"?new e.Marker(r):A(!0)).setLngLat(B.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(B.place_type[0]==="reverse"?B.place_name:B.place_name.replace(/,.*/,""))).addTo(t),G=O.getElement();G.addEventListener("click",U=>{U.stopPropagation(),l==null||l({type:"markerClick",id:B.id})}),G.addEventListener("mouseenter",()=>{l==null||l({type:"markerMouseEnter",id:B.id}),O.togglePopup()}),G.addEventListener("mouseleave",()=>{l==null||l({type:"markerMouseLeave",id:B.id}),O.togglePopup()}),d.push(O)}}},setSelectedMarker(M){y&&y.getElement().classList.toggle("marker-selected",!1),y=M>-1?d[M]:void 0,y==null||y.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const M=t.getCenter();return[t.getZoom(),M.lng,M.lat]}}}function N5(t){let e,n;return{c(){e=hu("svg"),n=hu("path"),Ce(n,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Ce(e,"viewBox","0 0 14 14"),Ce(e,"width","13"),Ce(e,"height","13"),Ce(e,"class","svelte-en2qvf")},m(r,i){be(r,e,i),te(e,n)},p:Mt,i:Mt,o:Mt,d(r){r&&ve(e)}}}class IT extends Qt{constructor(e){super(),Jt(this,e,null,N5,Ht,{})}}function O5(t){let e,n;return{c(){e=hu("svg"),n=hu("path"),Ce(n,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Ce(e,"viewBox","0 0 30 30"),Ce(e,"fill","none"),Ce(e,"xmlns","http://www.w3.org/2000/svg"),Ce(e,"class","svelte-d2loi5")},m(r,i){be(r,e,i),te(e,n)},p:Mt,i:Mt,o:Mt,d(r){r&&ve(e)}}}class CT extends Qt{constructor(e){super(),Jt(this,e,null,O5,Ht,{})}}function z5(t){let e,n;return{c(){e=pe("img"),si(e.src,n=t[3]+"area.svg")||Ce(e,"src",n),Ce(e,"alt",t[6]),Ce(e,"class","svelte-ltkwvy")},m(r,i){be(r,e,i)},p(r,i){i&8&&!si(e.src,n=r[3]+"area.svg")&&Ce(e,"src",n),i&64&&Ce(e,"alt",r[6])},d(r){r&&ve(e)}}}function F5(t){let e,n;return{c(){e=pe("img"),si(e.src,n=t[3]+"reverse.svg")||Ce(e,"src",n),Ce(e,"alt",t[6]),Ce(e,"class","svelte-ltkwvy")},m(r,i){be(r,e,i)},p(r,i){i&8&&!si(e.src,n=r[3]+"reverse.svg")&&Ce(e,"src",n),i&64&&Ce(e,"alt",r[6])},d(r){r&&ve(e)}}}function B5(t){let e,n;return{c(){e=pe("img"),si(e.src,n=t[3]+"poi.svg")||Ce(e,"src",n),Ce(e,"alt",t[6]),Ce(e,"class","svelte-ltkwvy")},m(r,i){be(r,e,i)},p(r,i){i&8&&!si(e.src,n=r[3]+"poi.svg")&&Ce(e,"src",n),i&64&&Ce(e,"alt",r[6])},d(r){r&&ve(e)}}}function V5(t){let e,n;return{c(){e=pe("img"),si(e.src,n=t[3]+"postal_code.svg")||Ce(e,"src",n),Ce(e,"alt",t[6]),Ce(e,"class","svelte-ltkwvy")},m(r,i){be(r,e,i)},p(r,i){i&8&&!si(e.src,n=r[3]+"postal_code.svg")&&Ce(e,"src",n),i&64&&Ce(e,"alt",r[6])},d(r){r&&ve(e)}}}function U5(t){let e,n;return{c(){e=pe("img"),si(e.src,n=t[3]+"street.svg")||Ce(e,"src",n),Ce(e,"alt",t[6]),Ce(e,"class","svelte-ltkwvy")},m(r,i){be(r,e,i)},p(r,i){i&8&&!si(e.src,n=r[3]+"street.svg")&&Ce(e,"src",n),i&64&&Ce(e,"alt",r[6])},d(r){r&&ve(e)}}}function j5(t){let e,n;return{c(){e=pe("img"),si(e.src,n=t[3]+"road.svg")||Ce(e,"src",n),Ce(e,"alt",t[6]),Ce(e,"class","svelte-ltkwvy")},m(r,i){be(r,e,i)},p(r,i){i&8&&!si(e.src,n=r[3]+"road.svg")&&Ce(e,"src",n),i&64&&Ce(e,"alt",r[6])},d(r){r&&ve(e)}}}function G5(t){let e,n;return{c(){e=pe("img"),si(e.src,n=t[3]+"housenumber.svg")||Ce(e,"src",n),Ce(e,"alt",t[6]),Ce(e,"class","svelte-ltkwvy")},m(r,i){be(r,e,i)},p(r,i){i&8&&!si(e.src,n=r[3]+"housenumber.svg")&&Ce(e,"src",n),i&64&&Ce(e,"alt",r[6])},d(r){r&&ve(e)}}}function q5(t){let e,n,r,i;return{c(){e=pe("img"),si(e.src,n=t[5])||Ce(e,"src",n),Ce(e,"alt",t[4]),Ce(e,"class","svelte-ltkwvy")},m(o,c){be(o,e,c),r||(i=Lt(e,"error",t[14]),r=!0)},p(o,c){c&32&&!si(e.src,n=o[5])&&Ce(e,"src",n),c&16&&Ce(e,"alt",o[4])},d(o){o&&ve(e),r=!1,i()}}}function CS(t){let e,n;return{c(){e=pe("span"),n=nt(t[6]),Ce(e,"class","secondary svelte-ltkwvy")},m(r,i){be(r,e,i),te(e,n)},p(r,i){i&64&&Kn(n,r[6])},d(r){r&&ve(e)}}}function W5(t){var ae,se;let e,n,r,i,o,c,l,d,y=(t[7]?t[0].place_name:t[0].place_name.replace(/,.*/,""))+"",S,E,C=t[2]==="always"||t[2]&&!t[0].address&&((ae=t[0].properties)==null?void 0:ae.kind)!=="road"&&((se=t[0].properties)==null?void 0:se.kind)!=="road_relation"&&!t[0].id.startsWith("address.")&&!t[0].id.startsWith("postal_code.")&&(!t[0].id.startsWith("poi.")||!t[5])&&!t[7],A,M,R=(t[7]?"":t[0].place_name.replace(/[^,]*,?\s*/,""))+"",N,B,O;function G(fe,ke){var K,oe;return ke&1&&(n=null),ke&1&&(r=null),ke&1&&(i=null),fe[5]?q5:fe[0].address?G5:((K=fe[0].properties)==null?void 0:K.kind)==="road"||((oe=fe[0].properties)==null?void 0:oe.kind)==="road_relation"?j5:(n==null&&(n=!!fe[0].id.startsWith("address.")),n?U5:(r==null&&(r=!!fe[0].id.startsWith("postal_code.")),r?V5:(i==null&&(i=!!fe[0].id.startsWith("poi.")),i?B5:fe[7]?F5:z5)))}let U=G(t,-1),Z=U(t),ue=C&&CS(t);return{c(){e=pe("li"),Z.c(),o=je(),c=pe("span"),l=pe("span"),d=pe("span"),S=nt(y),E=je(),ue&&ue.c(),A=je(),M=pe("span"),N=nt(R),Ce(d,"class","primary svelte-ltkwvy"),Ce(l,"class","svelte-ltkwvy"),Ce(M,"class","line2 svelte-ltkwvy"),Ce(c,"class","texts svelte-ltkwvy"),Ce(e,"tabindex","0"),Ce(e,"data-selected",t[1]),Ce(e,"class","svelte-ltkwvy"),no(e,"selected",t[1])},m(fe,ke){be(fe,e,ke),Z.m(e,null),te(e,o),te(e,c),te(c,l),te(l,d),te(d,S),te(l,E),ue&&ue.m(l,null),te(c,A),te(c,M),te(M,N),B||(O=[Lt(e,"mouseenter",t[12]),Lt(e,"focus",t[13])],B=!0)},p(fe,[ke]){var K,oe;U===(U=G(fe,ke))&&Z?Z.p(fe,ke):(Z.d(1),Z=U(fe),Z&&(Z.c(),Z.m(e,o))),ke&1&&y!==(y=(fe[7]?fe[0].place_name:fe[0].place_name.replace(/,.*/,""))+"")&&Kn(S,y),ke&37&&(C=fe[2]==="always"||fe[2]&&!fe[0].address&&((K=fe[0].properties)==null?void 0:K.kind)!=="road"&&((oe=fe[0].properties)==null?void 0:oe.kind)!=="road_relation"&&!fe[0].id.startsWith("address.")&&!fe[0].id.startsWith("postal_code.")&&(!fe[0].id.startsWith("poi.")||!fe[5])&&!fe[7]),C?ue?ue.p(fe,ke):(ue=CS(fe),ue.c(),ue.m(l,null)):ue&&(ue.d(1),ue=null),ke&1&&R!==(R=(fe[7]?"":fe[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Kn(N,R),ke&2&&Ce(e,"data-selected",fe[1]),ke&2&&no(e,"selected",fe[1])},i:Mt,o:Mt,d(fe){fe&&ve(e),Z.d(),ue&&ue.d(),B=!1,Hr(O)}}}function H5(t,e,n){var G;let r,i,{feature:o}=e,{selected:c=!1}=e,{showPlaceType:l}=e,{missingIconsCache:d}=e,{iconsBaseUrl:y}=e;const S=(G=o.properties)==null?void 0:G.categories;let E,C,A=0,M=o.place_type[0]==="reverse";function R(U){C&&d.add(C),n(10,A++,A)}function N(U){xn.call(this,t,U)}function B(U){xn.call(this,t,U)}const O=U=>R(U.currentTarget);return t.$$set=U=>{"feature"in U&&n(0,o=U.feature),"selected"in U&&n(1,c=U.selected),"showPlaceType"in U&&n(2,l=U.showPlaceType),"missingIconsCache"in U&&n(9,d=U.missingIconsCache),"iconsBaseUrl"in U&&n(3,y=U.iconsBaseUrl)},t.$$.update=()=>{var U,Z,ue,ae;if(t.$$.dirty&3640)do n(11,r--,r),n(4,E=S==null?void 0:S[r]),n(5,C=E?y+E.replace(/ /g,"_")+".svg":void 0);while(r>-1&&(!C||d.has(C)));t.$$.dirty&1&&n(6,i=o.id.startsWith("poi.")?(Z=(U=o.properties)==null?void 0:U.categories)==null?void 0:Z.join(", "):((ae=(ue=o.properties)==null?void 0:ue.place_type_name)==null?void 0:ae[0])??o.place_type[0])},n(11,r=(S==null?void 0:S.length)??0),[o,c,l,y,E,C,i,M,R,d,A,r,N,B,O]}class Z5 extends Qt{constructor(e){super(),Jt(this,e,H5,W5,Ht,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function X5(t){let e;return{c(){e=pe("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Ce(e,"class","svelte-7cmwmc")},m(n,r){be(n,e,r)},p:Mt,i:Mt,o:Mt,d(n){n&&ve(e)}}}class Y5 extends Qt{constructor(e){super(),Jt(this,e,null,X5,Ht,{})}}function $5(t){let e,n;return{c(){e=hu("svg"),n=hu("path"),Ce(n,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Ce(e,"viewBox","0 0 60.006 21.412"),Ce(e,"width","14"),Ce(e,"height","20"),Ce(e,"class","svelte-en2qvf")},m(r,i){be(r,e,i),te(e,n)},p:Mt,i:Mt,o:Mt,d(r){r&&ve(e)}}}class K5 extends Qt{constructor(e){super(),Jt(this,e,null,$5,Ht,{})}}function J5(t){let e,n,r;return{c(){e=hu("svg"),n=hu("circle"),r=hu("path"),Ce(n,"cx","4.789"),Ce(n,"cy","4.787"),Ce(n,"r","3.85"),gr(n,"stroke-width","1.875"),gr(n,"fill","none"),Ce(r,"d","M12.063 12.063 7.635 7.635"),gr(r,"stroke-width","1.875"),gr(r,"stroke-linecap","round"),Ce(e,"xmlns","http://www.w3.org/2000/svg"),Ce(e,"width","13"),Ce(e,"height","13"),Ce(e,"viewBox","0 0 13 13"),Ce(e,"class","svelte-1bpbt60")},m(i,o){be(i,e,o),te(e,n),te(e,r)},p:Mt,i:Mt,o:Mt,d(i){i&&ve(e)}}}class Q5 extends Qt{constructor(e){super(),Jt(this,e,null,J5,Ht,{})}}function ez(t,e,n){const r=e[1],i=e[0],o=r-i;return t===r&&n?t:((t-i)%o+o)%o+i}function TS(t){const e=[...t];return e[2]<e[0]&&(e[2]+=360),e}let Pd;async function tz(t,e,n){const r=t==null?void 0:t.getCenterAndZoom();for(const i of e??[])if(!(r&&(i.minZoom!=null&&i.minZoom>r[0]||i.maxZoom!=null&&i.maxZoom<r[0]))){if(i.type==="fixed")return i.coordinates.join(",");e:if(i.type==="client-geolocation"){if(Pd&&i.cachedLocationExpiry&&Pd.time+i.cachedLocationExpiry>Date.now()){if(!Pd.coords)break e;return Pd.coords}let o;try{return o=await new Promise((c,l)=>{n.signal.addEventListener("abort",()=>{l(Error("aborted"))}),navigator.geolocation.getCurrentPosition(d=>{c([d.coords.longitude,d.coords.latitude].map(y=>y.toFixed(6)).join(","))},d=>{l(d)},i)}),o}catch{}finally{i.cachedLocationExpiry&&(Pd={time:Date.now(),coords:o})}if(n.signal.aborted)return}if(i.type==="server-geolocation")return"ip";if(r&&i.type==="map-center")return r[1].toFixed(6)+","+r[2].toFixed(6)}}const LS=/(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?/i,PS=/(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?/i,MS=/(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?/i,kS=/(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?/i;function nz(t){if(!["DMS","DM","DD"].includes(t))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){if(t=="DD")return this.decimalCoordinates;const e=this.decimalCoordinates.split(",").map(c=>Number(c.trim()));let n=AS(e[0],t),r=AS(e[1],t);n.endsWith('.0"')&&r.endsWith('.0"')&&(n=n.replace(/\.0"$/,'"'),r=r.replace(/\.0"$/,'"'));const i=e[0]>=0?" N":" S",o=e[1]>=0?" E":" W";return`${n+i}, ${r+o}`}else throw new Error("no decimal coordinates to convert")}function AS(t,e){const n=Math.abs(t),r=Math.floor(n),i=(n-r)*60;if(e=="DM"){let l=rz(i,3).toFixed(3).padStart(6,"0");return`${r} ${l}'`}let o=Math.floor(i),c=((i-o)*60).toFixed(1).padStart(4,"0");return o=o.toString().padStart(2,"0"),`${r} ${o}' ${c}"`}function rz(t,e){const n=Math.pow(10,e);return Math.round((t+Number.EPSILON)*n)/n}function cb(t,e){e||(e=5),t=t.replace(/\s+/g," ").trim();let n=null,r=null,i="",o="",c=[],l=!1;if(LS.test(t))if(c=LS.exec(t),l=Yg(c),l){if(n=c[2],r=c[6],n.includes(",")&&(n=n.replace(",",".")),r.includes(",")&&(r=r.replace(",",".")),Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");if(Number(Math.round(r))==Number(r))throw new Error("integer only coordinate provided");c[1]?(i=c[1],o=c[5]):c[4]&&(i=c[4],o=c[8])}else throw new Error("invalid decimal coordinate format");else if(PS.test(t))if(c=PS.exec(t),l=Yg(c),l)n=Math.abs(parseInt(c[2])),c[4]&&(n+=c[4]/60),c[6]&&(n+=c[6].replace(",",".")/3600),parseInt(c[2])<0&&(n=-1*n),r=Math.abs(parseInt(c[9])),c[11]&&(r+=c[11]/60),c[13]&&(r+=c[13].replace(",",".")/3600),parseInt(c[9])<0&&(r=-1*r),c[1]?(i=c[1],o=c[8]):c[7]&&(i=c[7],o=c[14]);else throw new Error("invalid DMS coordinates format");else if(MS.test(t))if(c=MS.exec(t),l=Yg(c),l)n=Math.abs(parseInt(c[2])),c[4]&&(n+=c[4]/60),c[6]&&(n+=c[6]/3600),parseInt(c[2])<0&&(n=-1*n),r=Math.abs(parseInt(c[10])),c[12]&&(r+=c[12]/60),c[14]&&(r+=c[14]/3600),parseInt(c[10])<0&&(r=-1*r),c[1]?(i=c[1],o=c[9]):c[8]&&(i=c[8],o=c[16]);else throw new Error("invalid DMS coordinates format");else if(kS.test(t))if(c=kS.exec(t),l=Yg(c),l)n=Math.abs(parseInt(c[2])),c[4]&&(n+=c[4]/60),c[6]&&(n+=c[6]/3600),parseInt(c[2])<0&&(n=-1*n),r=Math.abs(parseInt(c[10])),c[12]&&(r+=c[12]/60),c[14]&&(r+=c[14]/3600),parseInt(c[10])<0&&(r=-1*r),c[1]?(i=c[1],o=c[9]):c[8]&&(i=c[8],o=c[16]);else throw new Error("invalid coordinates format");if(l){if(Math.abs(r)>=180)throw new Error("invalid longitude value");if(Math.abs(n)>=90)throw new Error("invalid latitude value");if((i||o)&&(!i||!o))throw new Error("invalid coordinates format");if(i&&i==o)throw new Error("invalid coordinates format");let d=/S|SOUTH/i;d.test(i)&&n>0&&(n=-1*n),d=/W|WEST/i,d.test(o)&&r>0&&(r=-1*r);const y=c[0].trim();let S,E;const C=/[,/;\u0020]/g,A=y.match(C);if(A==null){const N=Math.floor(t.length/2);S=y.substring(0,N).trim(),E=y.substring(N).trim()}else{let N;A.length%2==1?N=Math.floor(A.length/2):N=A.length/2-1;let B=0;if(N==0)B=y.indexOf(A[0]),S=y.substring(0,B).trim(),E=y.substring(B+1).trim();else{let O=0,G=0;for(;O<=N;)B=y.indexOf(A[O],G),G=B+1,O++;S=y.substring(0,B).trim(),E=y.substring(B+1).trim()}}const M=S.split(".");if(M.length==2&&M[1]==0&&M[1].length!=2)throw new Error("invalid coordinates format");const R=E.split(".");if(R.length==2&&R[1]==0&&R[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(S)||/^\d+$/.test(E))throw new Error("degree only coordinate/s provided");return isNaN(n)&&n.includes(",")&&(n=n.replace(",",".")),n=Number(Number(n).toFixed(e)),isNaN(r)&&r.includes(",")&&(r=r.replace(",",".")),r=Number(Number(r).toFixed(e)),Object.freeze({verbatimCoordinates:y,verbatimLatitude:S,verbatimLongitude:E,decimalLatitude:n,decimalLongitude:r,decimalCoordinates:`${n},${r}`,closeEnough:iz,toCoordinateFormat:nz})}else throw new Error("coordinates pattern match failed")}function Yg(t){if(!isNaN(t[0]))return!1;const e=[...t];if(e.shift(),e.length%2>0)return!1;const n=/^[-+]?\d+([\.,]\d+)?$/,r=/[eastsouthnorthwest]+/i,i=e.length/2;for(let o=0;o<i;o++){const c=e[o],l=e[o+i],d=n.test(c)&&n.test(l),y=r.test(c)&&r.test(l),S=c==l;if(!(c==null&&l==null)){if(c==null||l==null)return!1;if(d||y||S)continue;return!1}}return!0}function DS(t,e){const n=Math.abs(t-e);return Number(n.toFixed(6))<=1e-5}function iz(t){if(t.includes(",")){const e=t.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return DS(this.decimalLatitude,Number(e[0]))&&DS(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const oz=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});cb.to=oz;const sz=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],az={decimalLatitude:40.123,decimalLongitude:-74.123},lz=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],uz=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222}];function cz(){const t=[];return sz.forEach(e=>{e.decimalLatitude?t.push(e):t.push({...e,...az})}),[...t,...lz,...uz]}const hz=cz();cb.formats=hz.map(t=>t.verbatimCoordinates);const fz=cb;function RS(t,e,n){const r=t.slice();return r[81]=e[n],r[83]=n,r}function NS(t){let e,n;return e=new Y5({}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function OS(t){let e,n,r,i,o;return n=new K5({}),{c(){e=pe("button"),Ve(n.$$.fragment),Ce(e,"type","button"),Ce(e,"title",t[9]),Ce(e,"class","svelte-zh3kmv"),no(e,"active",t[0])},m(c,l){be(c,e,l),Fe(n,e,null),r=!0,i||(o=Lt(e,"click",t[67]),i=!0)},p(c,l){(!r||l[0]&512)&&Ce(e,"title",c[9]),(!r||l[0]&1)&&no(e,"active",c[0])},i(c){r||(ne(n.$$.fragment,c),r=!0)},o(c){de(n.$$.fragment,c),r=!1},d(c){c&&ve(e),Be(n),i=!1,o()}}}function pz(t){let e,n=[],r=new Map,i,o,c,l=Oi(t[14]);const d=y=>y[81].id+(y[81].address?","+y[81].address:"");for(let y=0;y<l.length;y+=1){let S=RS(t,l,y),E=d(S);r.set(E,n[y]=zS(E,S))}return{c(){e=pe("ul");for(let y=0;y<n.length;y+=1)n[y].c();Ce(e,"class","svelte-zh3kmv")},m(y,S){be(y,e,S);for(let E=0;E<n.length;E+=1)n[E]&&n[E].m(e,null);i=!0,o||(c=[Lt(e,"mouseleave",t[71]),Lt(e,"blur",t[72])],o=!0)},p(y,S){S[0]&17880064&&(l=Oi(y[14]),Rn(),n=XP(n,S,d,1,y,l,r,e,ZP,zS,null,RS),Nn())},i(y){if(!i){for(let S=0;S<l.length;S+=1)ne(n[S]);i=!0}},o(y){for(let S=0;S<n.length;S+=1)de(n[S]);i=!1},d(y){y&&ve(e);for(let S=0;S<n.length;S+=1)n[S].d();o=!1,Hr(c)}}}function dz(t){let e,n,r,i,o,c;return n=new CT({}),{c(){e=pe("div"),Ve(n.$$.fragment),r=je(),i=pe("div"),o=nt(t[7]),Ce(i,"class","svelte-zh3kmv"),Ce(e,"class","no-results svelte-zh3kmv")},m(l,d){be(l,e,d),Fe(n,e,null),te(e,r),te(e,i),te(i,o),c=!0},p(l,d){(!c||d[0]&128)&&Kn(o,l[7])},i(l){c||(ne(n.$$.fragment,l),c=!0)},o(l){de(n.$$.fragment,l),c=!1},d(l){l&&ve(e),Be(n)}}}function mz(t){let e="",n;return{c(){n=nt(e)},m(r,i){be(r,n,i)},p:Mt,i:Mt,o:Mt,d(r){r&&ve(n)}}}function gz(t){let e,n,r,i,o,c,l,d,y,S,E;return n=new CT({}),d=new IT({}),{c(){e=pe("div"),Ve(n.$$.fragment),r=je(),i=pe("div"),o=nt(t[6]),c=je(),l=pe("button"),Ve(d.$$.fragment),Ce(i,"class","svelte-zh3kmv"),Ce(l,"class","svelte-zh3kmv"),Ce(e,"class","error svelte-zh3kmv")},m(C,A){be(C,e,A),Fe(n,e,null),te(e,r),te(e,i),te(i,o),te(e,c),te(e,l),Fe(d,l,null),y=!0,S||(E=Lt(l,"click",t[68]),S=!0)},p(C,A){(!y||A[0]&64)&&Kn(o,C[6])},i(C){y||(ne(n.$$.fragment,C),ne(d.$$.fragment,C),y=!0)},o(C){de(n.$$.fragment,C),de(d.$$.fragment,C),y=!1},d(C){C&&ve(e),Be(n),Be(d),S=!1,E()}}}function zS(t,e){let n,r,i;function o(){return e[69](e[83])}function c(){return e[70](e[81])}return r=new Z5({props:{feature:e[81],showPlaceType:e[10],selected:e[15]===e[83],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),r.$on("mouseenter",o),r.$on("focus",c),{key:t,first:null,c(){n=ki(),Ve(r.$$.fragment),this.first=n},m(l,d){be(l,n,d),Fe(r,l,d),i=!0},p(l,d){e=l;const y={};d[0]&16384&&(y.feature=e[81]),d[0]&1024&&(y.showPlaceType=e[10]),d[0]&49152&&(y.selected=e[15]===e[83]),d[0]&4096&&(y.iconsBaseUrl=e[12]),r.$set(y)},i(l){i||(ne(r.$$.fragment,l),i=!0)},o(l){de(r.$$.fragment,l),i=!1},d(l){l&&ve(n),Be(r,l)}}}function _z(t){let e,n,r,i,o,c,l,d,y,S,E,C,A,M,R,N,B,O,G,U,Z,ue=!1;o=new Q5({}),E=new IT({});let ae=t[19]&&NS(),se=t[5]===!0&&OS(t);const fe=t[59].default,ke=hr(fe,t,t[58],null),K=[gz,mz,dz,pz],oe=[];function Ge(Te,ot){var ft,At;return Te[18]?0:Te[16]?((ft=Te[14])==null?void 0:ft.length)===0?2:Te[16]&&((At=Te[14])!=null&&At.length)?3:-1:1}return~(N=Ge(t))&&(B=oe[N]=K[N](t)),{c(){e=je(),n=pe("form"),r=pe("div"),i=pe("button"),Ve(o.$$.fragment),c=je(),l=pe("input"),d=je(),y=pe("div"),S=pe("button"),Ve(E.$$.fragment),C=je(),ae&&ae.c(),A=je(),se&&se.c(),M=je(),ke&&ke.c(),R=je(),B&&B.c(),Ce(i,"class","search-button svelte-zh3kmv"),Ce(i,"type","button"),Ce(l,"placeholder",t[8]),Ce(l,"aria-label",t[8]),Ce(l,"class","svelte-zh3kmv"),Ce(S,"type","button"),Ce(S,"title",t[3]),Ce(S,"class","svelte-zh3kmv"),Ce(y,"class","clear-button-container svelte-zh3kmv"),no(y,"displayable",t[1]!==""),Ce(r,"class","input-group svelte-zh3kmv"),Ce(n,"tabindex","0"),Ce(n,"class",O=f_(t[2])+" svelte-zh3kmv"),no(n,"can-collapse",t[4]&&t[1]==="")},m(Te,ot){be(Te,e,ot),be(Te,n,ot),te(n,r),te(r,i),Fe(o,i,null),te(r,c),te(r,l),t[61](l),qi(l,t[1]),te(r,d),te(r,y),te(y,S),Fe(E,S,null),te(y,C),ae&&ae.m(y,null),te(r,A),se&&se.m(r,null),te(r,M),ke&&ke.m(r,null),te(n,R),~N&&oe[N].m(n,null),G=!0,U||(Z=[Lt(i,"click",t[60]),Lt(l,"input",t[62]),Lt(l,"focus",t[63]),Lt(l,"blur",t[64]),Lt(l,"keydown",t[22]),Lt(l,"input",t[65]),Lt(S,"click",t[66]),Lt(n,"submit",h1(t[21]))],U=!0)},p(Te,ot){(!G||ot[0]&256)&&Ce(l,"placeholder",Te[8]),(!G||ot[0]&256)&&Ce(l,"aria-label",Te[8]),ot[0]&2&&l.value!==Te[1]&&qi(l,Te[1]),(!G||ot[0]&8)&&Ce(S,"title",Te[3]),Te[19]?ae?ot[0]&524288&&ne(ae,1):(ae=NS(),ae.c(),ne(ae,1),ae.m(y,null)):ae&&(Rn(),de(ae,1,1,()=>{ae=null}),Nn()),(!G||ot[0]&2)&&no(y,"displayable",Te[1]!==""),Te[5]===!0?se?(se.p(Te,ot),ot[0]&32&&ne(se,1)):(se=OS(Te),se.c(),ne(se,1),se.m(r,M)):se&&(Rn(),de(se,1,1,()=>{se=null}),Nn()),ke&&ke.p&&(!G||ot[1]&134217728)&&pr(ke,fe,Te,Te[58],G?fr(fe,Te[58],ot,null):dr(Te[58]),null);let ft=N;N=Ge(Te),N===ft?~N&&oe[N].p(Te,ot):(B&&(Rn(),de(oe[ft],1,1,()=>{oe[ft]=null}),Nn()),~N?(B=oe[N],B?B.p(Te,ot):(B=oe[N]=K[N](Te),B.c()),ne(B,1),B.m(n,null)):B=null),(!G||ot[0]&4&&O!==(O=f_(Te[2])+" svelte-zh3kmv"))&&Ce(n,"class",O),(!G||ot[0]&22)&&no(n,"can-collapse",Te[4]&&Te[1]==="")},i(Te){G||(ne(ue),ne(o.$$.fragment,Te),ne(E.$$.fragment,Te),ne(ae),ne(se),ne(ke,Te),ne(B),G=!0)},o(Te){de(ue),de(o.$$.fragment,Te),de(E.$$.fragment,Te),de(ae),de(se),de(ke,Te),de(B),G=!1},d(Te){Te&&(ve(e),ve(n)),Be(o),t[61](null),Be(E),ae&&ae.d(),se&&se.d(),ke&&ke.d(Te),~N&&oe[N].d(),U=!1,Hr(Z)}}}function yz(t,e,n){let r,{$$slots:i={},$$scope:o}=e,{class:c=void 0}=e,{apiKey:l}=e,{bbox:d=void 0}=e,{clearButtonTitle:y="clear"}=e,{clearOnBlur:S=!1}=e,{collapsed:E=!1}=e,{country:C=void 0}=e,{debounceSearch:A=200}=e,{enableReverse:M=!1}=e,{errorMessage:R="Something went wrong"}=e,{filter:N=()=>!0}=e,{flyTo:B=!0}=e,{fuzzyMatch:O=!0}=e,{language:G=void 0}=e,{limit:U=void 0}=e,{mapController:Z=void 0}=e,{minLength:ue=2}=e,{noResultsMessage:ae="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:se="Search"}=e,{proximity:fe=[{type:"server-geolocation"}]}=e,{reverseActive:ke=M==="always"}=e,{reverseButtonTitle:K="toggle reverse geocoding"}=e,{searchValue:oe=""}=e,{showFullGeometry:Ge=!0}=e,{showPlaceType:Te="ifNeeded"}=e,{showResultsWhileTyping:ot=!0}=e,{selectFirst:ft=!0}=e,{flyToSelected:At=!1}=e,{markerOnSelected:Ke=!0}=e,{types:Ft=void 0}=e,{excludeTypes:bt=!1}=e,{zoom:Rt=16}=e,{maxZoom:Ot=18}=e,{apiUrl:ln="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Ln={}}=e,{iconsBaseUrl:an="https://cdn.maptiler.com/maptiler-geocoding-control/v1.2.2/icons/"}=e,{adjustUrlQuery:Xt=ee=>{}}=e;function En(){me.focus()}function In(){me.blur()}function rr(ee,Me=!0){n(1,oe=ee),Me?(n(15,tn=-1),jl()):(li(),setTimeout(()=>{me.focus(),me.select()}))}function mt(){n(14,Le=void 0),n(55,gt=void 0),n(15,tn=-1)}function Dt(){n(54,rt=[]),n(55,gt=void 0)}let Sn=!1,Le,rt,gt,Nt="",me,tn=-1,Xe,St=[],hn,Ai,Ls,Js;const al=new Set,ji=zl();Hi(()=>{Z&&(Z.setEventHandler(void 0),Z.indicateReverse(!1),Z.setSelectedMarker(-1),Z.setMarkers(void 0,void 0))});function jl(ee){if(Ai&&(clearTimeout(Ai),Ai=void 0),tn>-1&&Le)n(55,gt=Le[tn]),n(1,oe=gt.place_type[0]==="reverse"?gt.place_name:gt.place_name.replace(/,.*/,"")),n(18,Xe=void 0),n(54,rt=void 0),n(15,tn=-1);else if(oe){const Me=ee||!Ps(oe);lt(oe,{exact:!0}).then(()=>{n(54,rt=Le),n(55,gt=void 0),Me&&hs()}).catch(Se=>n(18,Xe=Se))}}function Ps(ee){try{return fz(ee,6)}catch{return!1}}async function lt(ee,{byId:Me=!1,exact:Se=!1}={}){n(18,Xe=void 0),hn==null||hn.abort();const Re=new AbortController;n(19,hn=Re);try{const We=Ps(ee),Ye=new URLSearchParams;if(G!==void 0&&Ye.set("language",Array.isArray(G)?G.join(","):G??""),Ft&&Ye.set("types",Ft.join(",")),bt&&Ye.set("excludeTypes",String(bt)),d&&Ye.set("bbox",d.map(sn=>sn.toFixed(6)).join(",")),C&&Ye.set("country",Array.isArray(C)?C.join(","):C),!Me&&!We){const sn=await tz(Z,fe,Re);sn&&Ye.set("proximity",sn),(Se||!ot)&&Ye.set("autocomplete","false"),Ye.set("fuzzyMatch",String(O))}U!==void 0&&(!We||(Ft==null?void 0:Ft.length)===1)&&Ye.set("limit",String(U)),Ye.set("key",l),Xt(Ye);const Je=ln+"/"+encodeURIComponent(We?We.decimalLongitude+","+We.decimalLatitude:ee)+".json?"+Ye.toString();if(Je===Nt){Me?(n(14,Le=void 0),n(55,gt=St[0])):n(14,Le=St);return}Nt=Je;const Bt=await fetch(Je,{signal:Re.signal,...Ln});if(!Bt.ok)throw new Error(await Bt.text());const qt=await Bt.json();ji("response",{url:Je,featureCollection:qt}),Me?(n(14,Le=void 0),n(55,gt=qt.features[0]),St=[gt]):(n(14,Le=qt.features.filter(N)),We&&Le.unshift({type:"Feature",properties:{},id:"reverse_"+We.decimalLongitude+"_"+We.decimalLatitude,text:We.decimalLatitude+", "+We.decimalLongitude,place_name:We.decimalLatitude+", "+We.decimalLongitude,place_type:["reverse"],center:[We.decimalLongitude,We.decimalLatitude],bbox:[We.decimalLongitude,We.decimalLatitude,We.decimalLongitude,We.decimalLatitude],geometry:{type:"Point",coordinates:[We.decimalLongitude,We.decimalLatitude]}}),St=Le,We&&me.focus())}catch(We){if(We&&typeof We=="object"&&"name"in We&&We.name==="AbortError")return;throw We}finally{Re===hn&&n(19,hn=void 0)}}function hs(){var Se;if(!(rt!=null&&rt.length)||!B)return;const ee=[180,90,-180,-90],Me=!rt.some(Re=>!Re.matching_text);for(const Re of rt)if(Me||!Re.matching_text)for(const We of[0,1,2,3])ee[We]=Math[We<2?"min":"max"](ee[We],((Se=Re.bbox)==null?void 0:Se[We])??Re.center[We%2]);Z&&rt.length>0&&(gt&&ee[0]===ee[2]&&ee[1]===ee[3]?Z.flyTo(gt.center,Rt):Z.fitBounds(TS(ee),50,Ot))}function fo(ee){n(0,ke=M==="always"),n(14,Le=void 0),n(55,gt=void 0),n(15,tn=-1),rr(ee[1].toFixed(6)+", "+ez(ee[0],[-180,180],!0).toFixed(6),!1)}function Gl(ee){if(!Le)return;let Me=ee.key==="ArrowDown"?1:ee.key==="ArrowUp"?-1:0;Me&&(tn===(ft?0:-1)&&Me===-1&&n(15,tn=Le.length),n(15,tn+=Me),tn>=Le.length&&n(15,tn=-1),tn<0&&ft&&n(15,tn=0),ee.preventDefault())}function li(ee=!0){if(n(18,Xe=void 0),ot){if(Ai&&clearTimeout(Ai),oe.length<ue)return;const Me=oe;Ai=window.setTimeout(()=>{lt(Me).catch(Se=>n(18,Xe=Se))},ee?A:0)}else n(14,Le=void 0),n(18,Xe=void 0)}function pt(ee){n(55,gt=ee),n(1,oe=ee.place_name),n(15,tn=-1)}const mn=()=>me.focus();function pn(ee){Gr[ee?"unshift":"push"](()=>{me=ee,n(17,me)})}function Zr(){oe=this.value,n(1,oe),n(13,Sn),n(27,S)}const fs=()=>n(13,Sn=!0),fn=()=>n(13,Sn=!1),za=()=>li(),Jr=()=>{n(1,oe=""),me.focus()},_e=()=>n(0,ke=!ke),W=()=>n(18,Xe=void 0),X=ee=>n(15,tn=ee),Q=ee=>pt(ee),le=()=>{ft||n(15,tn=-1)},Pe=()=>{};return t.$$set=ee=>{"class"in ee&&n(2,c=ee.class),"apiKey"in ee&&n(25,l=ee.apiKey),"bbox"in ee&&n(26,d=ee.bbox),"clearButtonTitle"in ee&&n(3,y=ee.clearButtonTitle),"clearOnBlur"in ee&&n(27,S=ee.clearOnBlur),"collapsed"in ee&&n(4,E=ee.collapsed),"country"in ee&&n(28,C=ee.country),"debounceSearch"in ee&&n(29,A=ee.debounceSearch),"enableReverse"in ee&&n(5,M=ee.enableReverse),"errorMessage"in ee&&n(6,R=ee.errorMessage),"filter"in ee&&n(30,N=ee.filter),"flyTo"in ee&&n(31,B=ee.flyTo),"fuzzyMatch"in ee&&n(32,O=ee.fuzzyMatch),"language"in ee&&n(33,G=ee.language),"limit"in ee&&n(34,U=ee.limit),"mapController"in ee&&n(35,Z=ee.mapController),"minLength"in ee&&n(36,ue=ee.minLength),"noResultsMessage"in ee&&n(7,ae=ee.noResultsMessage),"placeholder"in ee&&n(8,se=ee.placeholder),"proximity"in ee&&n(37,fe=ee.proximity),"reverseActive"in ee&&n(0,ke=ee.reverseActive),"reverseButtonTitle"in ee&&n(9,K=ee.reverseButtonTitle),"searchValue"in ee&&n(1,oe=ee.searchValue),"showFullGeometry"in ee&&n(38,Ge=ee.showFullGeometry),"showPlaceType"in ee&&n(10,Te=ee.showPlaceType),"showResultsWhileTyping"in ee&&n(39,ot=ee.showResultsWhileTyping),"selectFirst"in ee&&n(11,ft=ee.selectFirst),"flyToSelected"in ee&&n(40,At=ee.flyToSelected),"markerOnSelected"in ee&&n(41,Ke=ee.markerOnSelected),"types"in ee&&n(42,Ft=ee.types),"excludeTypes"in ee&&n(43,bt=ee.excludeTypes),"zoom"in ee&&n(44,Rt=ee.zoom),"maxZoom"in ee&&n(45,Ot=ee.maxZoom),"apiUrl"in ee&&n(46,ln=ee.apiUrl),"fetchParameters"in ee&&n(47,Ln=ee.fetchParameters),"iconsBaseUrl"in ee&&n(12,an=ee.iconsBaseUrl),"adjustUrlQuery"in ee&&n(48,Xt=ee.adjustUrlQuery),"$$scope"in ee&&n(58,o=ee.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&134225920&&setTimeout(()=>{n(16,Ls=Sn),S&&!Sn&&n(1,oe="")}),t.$$.dirty[0]&16386|t.$$.dirty[1]&32&&oe.length<ue&&(n(55,gt=void 0),n(14,Le=void 0),n(18,Xe=void 0),n(54,rt=Le)),t.$$.dirty[1]&16777344&&Ge&&gt&&!gt.address&&gt.geometry.type==="Point"&&gt.place_type[0]!=="reverse"&&lt(gt.id,{byId:!0}).catch(ee=>n(18,Xe=ee)),t.$$.dirty[1]&50356241&&(Z&&gt&&gt.id!==Js&&B&&(!gt.bbox||gt.bbox[0]===gt.bbox[2]&&gt.bbox[1]===gt.bbox[3]?Z.flyTo(gt.center,gt.id.startsWith("poi.")||gt.id.startsWith("address.")?Ot:Rt):Z.fitBounds(TS(gt.bbox),50,Ot),n(14,Le=void 0),n(54,rt=void 0),n(15,tn=-1)),n(56,Js=gt==null?void 0:gt.id)),t.$$.dirty[0]&18432&&ft&&Le!=null&&Le.length&&n(15,tn=0),t.$$.dirty[0]&2050&&(ft||n(15,tn=-1)),t.$$.dirty[0]&16384|t.$$.dirty[1]&8388608&&rt!==Le&&n(54,rt=void 0),t.$$.dirty[0]&81921|t.$$.dirty[1]&8388624&&Z&&Z.setEventHandler(ee=>{switch(ee.type){case"mapClick":ke&&fo(ee.coordinates);break;case"markerClick":{const Me=Le==null?void 0:Le.find(Se=>Se.id===ee.id);Me&&pt(Me)}break;case"markerMouseEnter":rt&&n(15,tn=Ls?(Le==null?void 0:Le.findIndex(Me=>Me.id===ee.id))??-1:-1);break;case"markerMouseLeave":rt&&n(15,tn=-1);break}}),t.$$.dirty[0]&49152&&n(57,r=Le==null?void 0:Le[tn]),t.$$.dirty[1]&67133969&&Z&&r&&B&&At&&Z.flyTo(r.center,r.id.startsWith("poi.")||r.id.startsWith("address.")?Ot:Rt),t.$$.dirty[1]&1040&&(Ke||Z==null||Z.setMarkers(void 0,void 0)),t.$$.dirty[1]&75498512&&Z&&Ke&&!rt&&(Z.setMarkers(r?[r]:void 0,void 0),Z.setSelectedMarker(r?0:-1)),t.$$.dirty[1]&25165840&&Z&&Z.setMarkers(rt,gt),t.$$.dirty[0]&32768|t.$$.dirty[1]&8388624&&rt&&Z&&Z.setSelectedMarker(tn),t.$$.dirty[0]&2|t.$$.dirty[1]&16&&Z){const ee=Ps(oe);Z.setReverseMarker(ee?[ee.decimalLongitude,ee.decimalLatitude]:void 0)}t.$$.dirty[1]&67108864&&ji("select",r),t.$$.dirty[1]&16777216&&ji("pick",gt),t.$$.dirty[0]&81920&&ji("optionsVisibilityChange",Ls&&!!Le),t.$$.dirty[0]&16384&&ji("featuresListed",Le),t.$$.dirty[1]&8388608&&ji("featuresMarked",rt),t.$$.dirty[0]&1&&ji("reverseToggle",ke),t.$$.dirty[0]&2&&ji("queryChange",oe),t.$$.dirty[0]&1|t.$$.dirty[1]&16&&Z&&Z.indicateReverse(ke)},[ke,oe,c,y,E,M,R,ae,se,K,Te,ft,an,Sn,Le,tn,Ls,me,Xe,hn,al,jl,Gl,li,pt,l,d,S,C,A,N,B,O,G,U,Z,ue,fe,Ge,ot,At,Ke,Ft,bt,Rt,Ot,ln,Ln,Xt,En,In,rr,mt,Dt,rt,gt,Js,r,o,i,mn,pn,Zr,fs,fn,za,Jr,_e,W,X,Q,le,Pe]}class vz extends Qt{constructor(e){super(),Jt(this,e,yz,_z,Ht,{class:2,apiKey:25,bbox:26,clearButtonTitle:3,clearOnBlur:27,collapsed:4,country:28,debounceSearch:29,enableReverse:5,errorMessage:6,filter:30,flyTo:31,fuzzyMatch:32,language:33,limit:34,mapController:35,minLength:36,noResultsMessage:7,placeholder:8,proximity:37,reverseActive:0,reverseButtonTitle:9,searchValue:1,showFullGeometry:38,showPlaceType:10,showResultsWhileTyping:39,selectFirst:11,flyToSelected:40,markerOnSelected:41,types:42,excludeTypes:43,zoom:44,maxZoom:45,apiUrl:46,fetchParameters:47,iconsBaseUrl:12,adjustUrlQuery:48,focus:49,blur:50,setQuery:51,clearList:52,clearMap:53},null,[-1,-1,-1])}get focus(){return this.$$.ctx[49]}get blur(){return this.$$.ctx[50]}get setQuery(){return this.$$.ctx[51]}get clearList(){return this.$$.ctx[52]}get clearMap(){return this.$$.ctx[53]}}function FS(t){let e,n,r;return n=new vz({props:{mapController:t[1],apiKey:t[0]}}),{c(){e=pe("div"),Ve(n.$$.fragment),Ce(e,"class","svelte-ixhnie")},m(i,o){be(i,e,o),Fe(n,e,null),r=!0},p(i,o){const c={};o&2&&(c.mapController=i[1]),o&1&&(c.apiKey=i[0]),n.$set(c)},i(i){r||(ne(n.$$.fragment,i),r=!0)},o(i){de(n.$$.fragment,i),r=!1},d(i){i&&ve(e),Be(n)}}}function bz(t){let e,n,r=t[1]&&FS(t);return{c(){r&&r.c(),e=ki()},m(i,o){r&&r.m(i,o),be(i,e,o),n=!0},p(i,[o]){i[1]?r?(r.p(i,o),o&2&&ne(r,1)):(r=FS(i),r.c(),ne(r,1),r.m(e.parentNode,e)):r&&(Rn(),de(r,1,1,()=>{r=null}),Nn())},i(i){n||(ne(r),n=!0)},o(i){de(r),n=!1},d(i){i&&ve(e),r&&r.d(i)}}}function xz(t,e,n){let r,{apiKey:i}=e,{map:o}=e;return t.$$set=c=>{"apiKey"in c&&n(0,i=c.apiKey),"map"in c&&n(2,o=c.map)},t.$$.update=()=>{t.$$.dirty&4&&n(1,r=o?R5(o,Vs):null)},[i,r,o]}class wz extends Qt{constructor(e){super(),Jt(this,e,xz,bz,Ht,{apiKey:0,map:2})}}const Sz=["==",["geometry-type"],"Polygon"],Ez=["==",["geometry-type"],"LineString"];function Iz(t,e,n){let r=["match",t];for(let[i,o]of Object.entries(e))r.push(i),r.push(o);return r.push(n),r}function c_(){return{type:"FeatureCollection",features:[]}}const Cz=t=>({}),BS=t=>({}),Tz=t=>({}),VS=t=>({}),Lz=t=>({}),US=t=>({});function Pz(t){let e,n,r,i,o,c;const l=t[1].top,d=hr(l,t,t[0],US),y=t[1].left,S=hr(y,t,t[0],VS),E=t[1].main,C=hr(E,t,t[0],BS);return{c(){e=pe("div"),d&&d.c(),n=je(),r=pe("div"),S&&S.c(),i=je(),o=pe("div"),C&&C.c(),Ce(e,"class","top svelte-mpick2"),Ce(r,"class","left svelte-mpick2"),Ce(o,"class","main svelte-mpick2")},m(A,M){be(A,e,M),d&&d.m(e,null),be(A,n,M),be(A,r,M),S&&S.m(r,null),be(A,i,M),be(A,o,M),C&&C.m(o,null),c=!0},p(A,[M]){d&&d.p&&(!c||M&1)&&pr(d,l,A,A[0],c?fr(l,A[0],M,Lz):dr(A[0]),US),S&&S.p&&(!c||M&1)&&pr(S,y,A,A[0],c?fr(y,A[0],M,Tz):dr(A[0]),VS),C&&C.p&&(!c||M&1)&&pr(C,E,A,A[0],c?fr(E,A[0],M,Cz):dr(A[0]),BS)},i(A){c||(ne(d,A),ne(S,A),ne(C,A),c=!0)},o(A){de(d,A),de(S,A),de(C,A),c=!1},d(A){A&&(ve(e),ve(n),ve(r),ve(i),ve(o)),d&&d.d(A),S&&S.d(A),C&&C.d(A)}}}function Mz(t,e,n){let{$$slots:r={},$$scope:i}=e;return t.$$set=o=>{"$$scope"in o&&n(0,i=o.$$scope)},[i,r]}class kz extends Qt{constructor(e){super(),Jt(this,e,Mz,Pz,Ht,{})}}const Az=t=>({}),jS=t=>({}),Dz=t=>({}),GS=t=>({}),Rz=t=>({}),qS=t=>({});function Nz(t){let e,n,r,i,o,c;const l=t[4].top,d=hr(l,t,t[3],qS),y=t[4].sidebar,S=hr(y,t,t[3],GS),E=t[4].map,C=hr(E,t,t[3],jS);return{c(){e=pe("div"),d&&d.c(),n=je(),r=pe("div"),S&&S.c(),i=je(),o=pe("div"),C&&C.c()},m(A,M){be(A,e,M),d&&d.m(e,null),t[5](e),be(A,n,M),be(A,r,M),S&&S.m(r,null),t[6](r),be(A,i,M),be(A,o,M),C&&C.m(o,null),t[7](o),c=!0},p(A,[M]){d&&d.p&&(!c||M&8)&&pr(d,l,A,A[3],c?fr(l,A[3],M,Rz):dr(A[3]),qS),S&&S.p&&(!c||M&8)&&pr(S,y,A,A[3],c?fr(y,A[3],M,Dz):dr(A[3]),GS),C&&C.p&&(!c||M&8)&&pr(C,E,A,A[3],c?fr(E,A[3],M,Az):dr(A[3]),jS)},i(A){c||(ne(d,A),ne(S,A),ne(C,A),c=!0)},o(A){de(d,A),de(S,A),de(C,A),c=!1},d(A){A&&(ve(e),ve(n),ve(r),ve(i),ve(o)),d&&d.d(A),t[5](null),S&&S.d(A),t[6](null),C&&C.d(A),t[7](null)}}}function Oz(t,e,n){let r,i,o;wt(t,o1,E=>n(0,r=E)),wt(t,s1,E=>n(1,i=E)),wt(t,a1,E=>n(2,o=E));let{$$slots:c={},$$scope:l}=e;function d(E){Gr[E?"unshift":"push"](()=>{r=E,o1.set(r)})}function y(E){Gr[E?"unshift":"push"](()=>{i=E,s1.set(i)})}function S(E){Gr[E?"unshift":"push"](()=>{o=E,a1.set(o)})}return t.$$set=E=>{"$$scope"in E&&n(3,l=E.$$scope)},[r,i,o,l,c,d,y,S]}class Eu extends Qt{constructor(e){super(),Jt(this,e,Oz,Nz,Ht,{})}}let o1=Gn(null),s1=Gn(null),a1=Gn(null);function zz(t){let e,n,r,i,o,c,l,d,y;return{c(){e=pe("label"),n=nt(`Basemap:
  `),r=pe("select"),i=pe("option"),i.textContent="MapTiler Dataviz",o=pe("option"),o.textContent="MapTiler Streets",c=pe("option"),c.textContent="MapTiler Satellite",l=pe("option"),l.textContent="OS Open Zoomstack",i.__value="dataviz",qi(i,i.__value),o.__value="streets-v2",qi(o,o.__value),c.__value="hybrid",qi(c,c.__value),l.__value="uk-openzoomstack-light",qi(l,l.__value),t[0]===void 0&&Jd(()=>t[1].call(r))},m(S,E){be(S,e,E),te(e,n),te(e,r),te(r,i),te(r,o),te(r,c),te(r,l),p_(r,t[0],!0),d||(y=Lt(r,"change",t[1]),d=!0)},p(S,[E]){E&1&&p_(r,S[0])},i:Mt,o:Mt,d(S){S&&ve(e),d=!1,y()}}}function Fz(t,e,n){let r;wt(t,Bv,o=>n(0,r=o));function i(){r=VE(this),Bv.set(r)}return[r,i]}class Bz extends Qt{constructor(e){super(),Jt(this,e,Fz,zz,Ht,{})}}let h_=Gn(!0);function Vz(t){let e,n;return e=new mc({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:t[0]?"none":"visible"}}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,i){const o={};i&1&&(o.layout={visibility:r[0]?"none":"visible"}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function Uz(t){let e,n;return e=new Fo({props:{data:t[1],$$slots:{default:[Vz]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,[i]){const o={};i&5&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function jz(t,e,n){let r;return wt(t,h_,o=>n(0,r=o)),[r,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class Gz extends Qt{constructor(e){super(),Jt(this,e,jz,Uz,Ht,{})}}const qz="/ltn/assets/help-d011708a.svg";function WS(t){let e,n;return e=new $_({props:{$$slots:{default:[Wz]},$$scope:{ctx:t}}}),e.$on("close",t[3]),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,i){const o={};i&16&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function Wz(t){let e,n,r;const i=t[1].default,o=hr(i,t,t[4],null);return{c(){e=pe("h2"),e.textContent="Help",n=je(),o&&o.c()},m(c,l){be(c,e,l),be(c,n,l),o&&o.m(c,l),r=!0},p(c,l){o&&o.p&&(!r||l&16)&&pr(o,i,c,c[4],r?fr(i,c[4],l,null):dr(c[4]),null)},i(c){r||(ne(o,c),r=!0)},o(c){de(o,c),r=!1},d(c){c&&(ve(e),ve(n)),o&&o.d(c)}}}function Hz(t){let e,n,r,i,o,c,l=t[0]&&WS(t);return{c(){e=pe("button"),e.innerHTML=`<img src="${qz}" title="Help" alt="Help"/>`,n=je(),l&&l.c(),r=ki(),Ce(e,"class","svelte-gb6dzm")},m(d,y){be(d,e,y),be(d,n,y),l&&l.m(d,y),be(d,r,y),i=!0,o||(c=Lt(e,"click",t[2]),o=!0)},p(d,[y]){d[0]?l?(l.p(d,y),y&1&&ne(l,1)):(l=WS(d),l.c(),ne(l,1),l.m(r.parentNode,r)):l&&(Rn(),de(l,1,1,()=>{l=null}),Nn())},i(d){i||(ne(l),i=!0)},o(d){de(l),i=!1},d(d){d&&(ve(e),ve(n),ve(r)),l&&l.d(d),o=!1,c()}}}function Zz(t,e,n){let{$$slots:r={},$$scope:i}=e,o=!1;const c=()=>n(0,o=!0),l=()=>n(0,o=!1);return t.$$set=d=>{"$$scope"in d&&n(4,i=d.$$scope)},[o,r,c,l,i]}class hb extends Qt{constructor(e){super(),Jt(this,e,Zz,Hz,Ht,{})}}function Xz(t){let e,n,r,i;const o=t[1].default,c=hr(o,t,t[0],null);return{c(){e=pe("a"),c&&c.c(),Ce(e,"href","#")},m(l,d){be(l,e,d),c&&c.m(e,null),n=!0,r||(i=Lt(e,"click",h1(t[2])),r=!0)},p(l,[d]){c&&c.p&&(!n||d&1)&&pr(c,o,l,l[0],n?fr(o,l[0],d,null):dr(l[0]),null)},i(l){n||(ne(c,l),n=!0)},o(l){de(c,l),n=!1},d(l){l&&ve(e),c&&c.d(l),r=!1,i()}}}function Yz(t,e,n){let{$$slots:r={},$$scope:i}=e;function o(c){xn.call(this,t,c)}return t.$$set=c=>{"$$scope"in c&&n(0,i=c.$$scope)},[i,r,o]}class mr extends Qt{constructor(e){super(),Jt(this,e,Yz,Xz,Ht,{})}}const $z=t=>({props:t&8}),HS=t=>({props:Qz(t[3])});function Kz(t){let e;const n=t[1].default,r=hr(n,t,t[2],HS);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),e=!0},p(i,o){r&&r.p&&(!e||o&12)&&pr(r,n,i,i[2],e?fr(n,i[2],o,$z):dr(i[2]),HS)},i(i){e||(ne(r,i),e=!0)},o(i){de(r,i),e=!1},d(i){r&&r.d(i)}}}function Jz(t){let e,n;return e=new LN({props:{openOn:t[0],popupClass:"popup",$$slots:{default:[Kz,({features:r})=>({3:r}),({features:r})=>r?8:0]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,[i]){const o={};i&1&&(o.openOn=r[0]),i&12&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function Qz(t){return t?t[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function e6(t,e,n){let{$$slots:r={},$$scope:i}=e,{openOn:o="hover"}=e;return t.$$set=c=>{"openOn"in c&&n(0,o=c.openOn),"$$scope"in c&&n(2,i=c.$$scope)},[o,r,i]}class Iu extends Qt{constructor(e){super(),Jt(this,e,e6,Jz,Ht,{openOn:0})}}function t6(t,e){let n=new Set(t.getStyle().layers.filter(r=>r.type=="line").map(r=>r.id));return e=="dataviz"?["Road network","Path"].filter(r=>n.has(r)):e=="hybrid"?["Path","Road","Tunnel"].filter(r=>n.has(r)):e=="streets-v2"?t.getStyle().layers.filter(r=>r["source-layer"]=="transportation"&&r.type=="line").map(r=>r.id):e=="uk-openzoomstack-light"?t.getStyle().layers.filter(r=>r["source-layer"]=="roads"&&r.type=="line").map(r=>r.id):[]}const{window:n6}=X_;function r6(t){let e,n,r,i,o,c,l,d,y,S,E,C,A,M,R;return A=BE(t[8][0]),{c(){e=pe("button"),e.textContent="Stop StreetView",n=je(),r=pe("fieldset"),i=pe("legend"),i.textContent="Source:",o=je(),c=pe("label"),l=pe("input"),d=nt(`
      Google Street View`),y=je(),S=pe("label"),E=pe("input"),C=nt(`
      Bing Streetside`),Ce(e,"class","secondary"),Ce(l,"type","radio"),l.__value="google",qi(l,l.__value),Ce(E,"type","radio"),E.__value="bing",qi(E,E.__value),A.p(l,E)},m(N,B){be(N,e,B),be(N,n,B),be(N,r,B),te(r,i),te(r,o),te(r,c),te(c,l),l.checked=l.__value===t[0],te(c,d),te(r,y),te(r,S),te(S,E),E.checked=E.__value===t[0],te(S,C),M||(R=[Lt(e,"click",t[3]),Lt(l,"change",t[7]),Lt(E,"change",t[9])],M=!0)},p(N,B){B&1&&(l.checked=l.__value===N[0]),B&1&&(E.checked=E.__value===N[0])},d(N){N&&(ve(e),ve(n),ve(r)),A.r(),M=!1,Hr(R)}}}function i6(t){let e,n,r;return{c(){e=pe("button"),e.textContent="StreetView",Ce(e,"class","secondary")},m(i,o){be(i,e,o),n||(r=Lt(e,"click",t[2]),n=!0)},p:Mt,d(i){i&&ve(e),n=!1,r()}}}function o6(t){let e,n,r;function i(l,d){return l[1]?i6:r6}let o=i(t),c=o(t);return{c(){c.c(),e=ki()},m(l,d){c.m(l,d),be(l,e,d),n||(r=Lt(n6,"keydown",t[4]),n=!0)},p(l,[d]){o===(o=i(l))&&c?c.p(l,d):(c.d(1),c=o(l),c&&(c.c(),c.m(e.parentNode,e)))},i:Mt,o:Mt,d(l){l&&ve(e),c.d(l),n=!1,r()}}}function s6(t,e,n){let r;wt(t,h_,R=>n(1,r=R));let{map:i}=e,{maptilerBasemap:o}=e,c="google",l=[];function d(){Ut(h_,r=!1,r),i.on("click",S),i.getCanvas().style.cursor="crosshair";for(let R of t6(i,o))l.push([R,i.getPaintProperty(R,"line-color")]),i.setPaintProperty(R,"line-color","cyan")}function y(){Ut(h_,r=!0,r),i.off("click",S),i.getCanvas().style.cursor="inherit";for(let[R,N]of l)i.setPaintProperty(R,"line-color",N);l=[]}Hi(y);function S(R){let N=R.lngLat.lng,B=R.lngLat.lat;c=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${B},${N}&cbp=11,0,0,0,0`,"_blank"):c=="bing"&&window.open(`https://www.bing.com/maps?cp=${B}~${N}&style=x`,"_blank")}function E(R){!r&&R.key=="Escape"&&(R.stopPropagation(),y())}const C=[[]];function A(){c=this.__value,n(0,c)}function M(){c=this.__value,n(0,c)}return t.$$set=R=>{"map"in R&&n(5,i=R.map),"maptilerBasemap"in R&&n(6,o=R.maptilerBasemap)},[c,r,d,y,E,i,o,A,C,M]}class a6 extends Qt{constructor(e){super(),Jt(this,e,s6,o6,Ht,{map:5,maptilerBasemap:6})}}function Ti(t){return{id:t,beforeId:l6(t)}}function l6(t){let e=rs(Pl);if(!e){console.warn(`getBeforeId(${t}) called before map is ready. Z-ordering may be incorrect.`);return}let n,r=!1;for(let i=ZS.length-1;i>=0;i--){let o=ZS[i];if(o==t){r=!0;break}e.getLayer(o)&&(n=o)}if(!r)throw new Error(`Layer ID ${t} not defined in layerZorder`);return n}let av=t=>t,lv=t=>t;const ZS=[av(lv("Background")),"neighbourhood-boundaries",av("Ferry line"),"debug-borders","debug-crosses","debug-filters","cells","interior-roads-outlines","interior-roads","compare-route","shortcuts","shortcuts-focus",lv("Building"),"draw-area-lines","draw-area-preview","one-ways",lv("Road labels"),av("road_label"),"animate-shortcuts","modal-filters","boundary","neighbourhood-boundary","auto-boundaries-areas","auto-boundaries-severances","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];function u6(t){let e;return{c(){e=nt("Back")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function c6(t){let e,n,r,i;return e=new mr({props:{$$slots:{default:[u6]},$$scope:{ctx:t}}}),e.$on("click",t[2]),{c(){Ve(e.$$.fragment)},m(o,c){Fe(e,o,c),n=!0,r||(i=Lt(window,"keydown",t[1]),r=!0)},p(o,[c]){const l={};c&8&&(l.$$scope={dirty:c,ctx:o}),e.$set(l)},i(o){n||(ne(e.$$.fragment,o),n=!0)},o(o){de(e.$$.fragment,o),n=!1},d(o){Be(e,o),r=!1,i()}}}function h6(t){let e=zl();function n(i){i.key=="Escape"&&(i.stopPropagation(),e("click"))}return[e,n,()=>e("click")]}class xy extends Qt{constructor(e){super(),Jt(this,e,h6,c6,Ht,{})}}function f6(t){let e,n;const r=[Ti("one-ways"),{filter:["all",["==",["get","kind"],"interior_road"],["!=",["get","direction"],"both"]]},{layout:{"icon-image":"oneway-arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","direction"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","direction_edited"],1,.5]}}];let i={};for(let o=0;o<r.length;o+=1)i=gi(i,r[o]);return e=new IC({props:i}),{c(){Ve(e.$$.fragment)},m(o,c){Fe(e,o,c),n=!0},p(o,[c]){const l={};e.$set(l)},i(o){n||(ne(e.$$.fragment,o),n=!0)},o(o){de(e.$$.fragment,o),n=!1},d(o){Be(e,o)}}}class p6 extends Qt{constructor(e){super(),Jt(this,e,null,f6,Ht,{})}}function l1(t){let e=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];for(let n of t.features)n.properties.kind=="cell"&&(n.properties.cell_color=="disconnected"?n.properties.color="red":n.properties.color=e[n.properties.cell_color%e.length]);return t}const d6=t=>({}),XS=t=>({}),m6=t=>({}),YS=t=>({});function g6(t){let e,n;const r=[Ti("neighbourhood-boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let i={};for(let o=0;o<r.length;o+=1)i=gi(i,r[o]);return e=new mc({props:i}),{c(){Ve(e.$$.fragment)},m(o,c){Fe(e,o,c),n=!0},p(o,c){const l={};e.$set(l)},i(o){n||(ne(e.$$.fragment,o),n=!0)},o(o){de(e.$$.fragment,o),n=!1},d(o){Be(e,o)}}}function $S(t){let e;const n=t[6]["line-popup"],r=hr(n,t,t[8],YS);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),e=!0},p(i,o){r&&r.p&&(!e||o&256)&&pr(r,n,i,i[8],e?fr(n,i[8],o,m6):dr(i[8]),YS)},i(i){e||(ne(r,i),e=!0)},o(i){de(r,i),e=!1},d(i){r&&r.d(i)}}}function _6(t){let e,n,r=t[0]&&$S(t);return{c(){r&&r.c(),e=ki()},m(i,o){r&&r.m(i,o),be(i,e,o),n=!0},p(i,o){i[0]?r?(r.p(i,o),o&1&&ne(r,1)):(r=$S(i),r.c(),ne(r,1),r.m(e.parentNode,e)):r&&(Rn(),de(r,1,1,()=>{r=null}),Nn())},i(i){n||(ne(r),n=!0)},o(i){de(r),n=!1},d(i){i&&ve(e),r&&r.d(i)}}}function y6(t){let e,n,r,i,o,c,l,d,y,S,E;e=new Fo({props:{data:KS(t[3]),$$slots:{default:[g6]},$$scope:{ctx:t}}});const C=[Ti("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.8}}];let A={};for(let U=0;U<C.length;U+=1)A=gi(A,C[U]);r=new mc({props:A});const M=[Ti("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":["interpolate",["linear",2],["zoom"],5,.5+la,10,1+la,12,1.5+la,14,4+la,16,7+la,20,24+la],"line-color":"black"}}];let R={};for(let U=0;U<M.length;U+=1)R=gi(R,M[U]);o=new Ml({props:R});const N=[Ti("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":["interpolate",["linear",2],["zoom"],5,.5,10,1,12,1.5,14,4,16,7,20,24],"line-color":t[2],"line-opacity":Uf(1,.5)}},{manageHoverState:t[0]},{hoverCursor:t[0]?"pointer":void 0}];let B={$$slots:{default:[_6]},$$scope:{ctx:t}};for(let U=0;U<N.length;U+=1)B=gi(B,N[U]);l=new Ml({props:B}),l.$on("click",t[7]),y=new p6({});const O=t[6]["more-layers"],G=hr(O,t,t[8],XS);return{c(){Ve(e.$$.fragment),n=je(),Ve(r.$$.fragment),i=je(),Ve(o.$$.fragment),c=je(),Ve(l.$$.fragment),d=je(),Ve(y.$$.fragment),S=je(),G&&G.c()},m(U,Z){Fe(e,U,Z),be(U,n,Z),Fe(r,U,Z),be(U,i,Z),Fe(o,U,Z),be(U,c,Z),Fe(l,U,Z),be(U,d,Z),Fe(y,U,Z),be(U,S,Z),G&&G.m(U,Z),E=!0},p(U,Z){const ue={};Z&8&&(ue.data=KS(U[3])),Z&256&&(ue.$$scope={dirty:Z,ctx:U}),e.$set(ue);const ae={};r.$set(ae);const se=Z&0?pv(M,[M[0],M[1],{paint:{"line-width":["interpolate",["linear",2],["zoom"],5,.5+la,10,1+la,12,1.5+la,14,4+la,16,7+la,20,24+la],"line-color":"black"}}]):{};o.$set(se);const fe=Z&5?pv(N,[N[0],N[1],Z&4&&{paint:{"line-width":["interpolate",["linear",2],["zoom"],5,.5,10,1,12,1.5,14,4,16,7,20,24],"line-color":U[2],"line-opacity":Uf(1,.5)}},Z&1&&{manageHoverState:U[0]},Z&1&&{hoverCursor:U[0]?"pointer":void 0}]):{};Z&257&&(fe.$$scope={dirty:Z,ctx:U}),l.$set(fe),G&&G.p&&(!E||Z&256)&&pr(G,O,U,U[8],E?fr(O,U[8],Z,d6):dr(U[8]),XS)},i(U){E||(ne(e.$$.fragment,U),ne(r.$$.fragment,U),ne(o.$$.fragment,U),ne(l.$$.fragment,U),ne(y.$$.fragment,U),ne(G,U),E=!0)},o(U){de(e.$$.fragment,U),de(r.$$.fragment,U),de(o.$$.fragment,U),de(l.$$.fragment,U),de(y.$$.fragment,U),de(G,U),E=!1},d(U){U&&(ve(n),ve(i),ve(c),ve(d),ve(S)),Be(e,U),Be(r,U),Be(o,U),Be(l,U),Be(y,U),G&&G.d(U)}}}function v6(t){let e,n;return e=new Fo({props:{data:t[3],generateId:!0,$$slots:{default:[y6]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,[i]){const o={};i&8&&(o.data=r[3]),i&271&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}let la=2;function KS(t){let e=t.features.find(n=>n.properties.kind=="boundary");return{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]],e.geometry.coordinates[0]]}}}function b6(t,e,n){let r,i,o,{$$slots:c={},$$scope:l}=e,{gjInput:d}=e,{interactive:y=!0}=e,{onClickLine:S=(C,A)=>{}}=e;const E=C=>y&&S(C.detail.features[0],C.detail.event.lngLat);return t.$$set=C=>{"gjInput"in C&&n(4,d=C.gjInput),"interactive"in C&&n(0,y=C.interactive),"onClickLine"in C&&n(1,S=C.onClickLine),"$$scope"in C&&n(8,l=C.$$scope)},t.$$.update=()=>{t.$$.dirty&16&&n(3,r=l1(d)),t.$$.dirty&16&&n(5,i=Math.max(...d.features.map(C=>C.properties.kind=="interior_road"?C.properties.shortcuts:0))),t.$$.dirty&32&&n(2,o=Uf(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",i,"#A32015"],"blue"))},[y,S,o,r,d,i,c,E,l]}class wy extends Qt{constructor(e){super(),Jt(this,e,b6,v6,Ht,{gjInput:4,interactive:0,onClickLine:1})}}function x6(t){let e;return{c(){e=nt("Choose project")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function w6(t){let e;return{c(){e=nt("Pick neighbourhood")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function S6(t){let e;return{c(){e=nt("Editing")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function E6(t){let e,n,r,i,o,c,l,d,y,S,E,C,A,M;return o=new mr({props:{$$slots:{default:[x6]},$$scope:{ctx:t}}}),o.$on("click",t[4]),d=new mr({props:{$$slots:{default:[w6]},$$scope:{ctx:t}}}),d.$on("click",t[5]),E=new mr({props:{$$slots:{default:[S6]},$$scope:{ctx:t}}}),E.$on("click",t[6]),{c(){e=pe("div"),n=pe("nav"),r=pe("ul"),i=pe("li"),Ve(o.$$.fragment),c=je(),l=pe("li"),Ve(d.$$.fragment),y=je(),S=pe("li"),Ve(E.$$.fragment),C=je(),A=pe("li"),A.textContent="Debug mode",Ce(n,"aria-label","breadcrumb"),Ce(e,"slot","top")},m(R,N){be(R,e,N),te(e,n),te(n,r),te(r,i),Fe(o,i,null),te(r,c),te(r,l),Fe(d,l,null),te(r,y),te(r,S),Fe(E,S,null),te(r,C),te(r,A),M=!0},p(R,N){const B={};N&256&&(B.$$scope={dirty:N,ctx:R}),o.$set(B);const O={};N&256&&(O.$$scope={dirty:N,ctx:R}),d.$set(O);const G={};N&256&&(G.$$scope={dirty:N,ctx:R}),E.$set(G)},i(R){M||(ne(o.$$.fragment,R),ne(d.$$.fragment,R),ne(E.$$.fragment,R),M=!0)},o(R){de(o.$$.fragment,R),de(d.$$.fragment,R),de(E.$$.fragment,R),M=!1},d(R){R&&ve(e),Be(o),Be(d),Be(E)}}}function I6(t){let e,n,r;return n=new xy({}),n.$on("click",t[3]),{c(){e=pe("div"),Ve(n.$$.fragment),Ce(e,"slot","sidebar")},m(i,o){be(i,e,o),Fe(n,e,null),r=!0},p:Mt,i(i){r||(ne(n.$$.fragment,i),r=!0)},o(i){de(n.$$.fragment,i),r=!1},d(i){i&&ve(e),Be(n)}}}function C6(t){let e,n;return e=new K_({props:{properties:t[7]}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,i){const o={};i&128&&(o.properties=r[7]),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function T6(t){let e,n,r;return n=new Iu({props:{openOn:"hover",$$slots:{default:[C6,({props:i})=>({7:i}),({props:i})=>i?128:0]},$$scope:{ctx:t}}}),{c(){e=pe("div"),Ve(n.$$.fragment),Ce(e,"slot","line-popup")},m(i,o){be(i,e,o),Fe(n,e,null),r=!0},p(i,o){const c={};o&384&&(c.$$scope={dirty:o,ctx:i}),n.$set(c)},i(i){r||(ne(n.$$.fragment,i),r=!0)},o(i){de(n.$$.fragment,i),r=!1},d(i){i&&ve(e),Be(n)}}}function L6(t){let e,n;return e=new K_({props:{properties:t[7]}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,i){const o={};i&128&&(o.properties=r[7]),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function P6(t){let e,n;return e=new Iu({props:{openOn:"hover",$$slots:{default:[L6,({props:r})=>({7:r}),({props:r})=>r?128:0]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function M6(t){let e,n;return e=new K_({props:{properties:t[7]}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,i){const o={};i&128&&(o.properties=r[7]),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function k6(t){let e,n;return e=new Iu({props:{openOn:"hover",$$slots:{default:[M6,({props:r})=>({7:r}),({props:r})=>r?128:0]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function A6(t){let e,n,r,i;const o=[Ti("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let c={$$slots:{default:[P6]},$$scope:{ctx:t}};for(let y=0;y<o.length;y+=1)c=gi(c,o[y]);e=new q1({props:c});const l=[Ti("debug-crosses"),{filter:["==",["get","kind"],"crosses"]},{paint:{"line-width":5,"line-color":"blue"}}];let d={$$slots:{default:[k6]},$$scope:{ctx:t}};for(let y=0;y<l.length;y+=1)d=gi(d,l[y]);return r=new Ml({props:d}),{c(){Ve(e.$$.fragment),n=je(),Ve(r.$$.fragment)},m(y,S){Fe(e,y,S),be(y,n,S),Fe(r,y,S),i=!0},p(y,S){const E={};S&256&&(E.$$scope={dirty:S,ctx:y}),e.$set(E);const C={};S&256&&(C.$$scope={dirty:S,ctx:y}),r.$set(C)},i(y){i||(ne(e.$$.fragment,y),ne(r.$$.fragment,y),i=!0)},o(y){de(e.$$.fragment,y),de(r.$$.fragment,y),i=!1},d(y){y&&ve(n),Be(e,y),Be(r,y)}}}function D6(t){let e,n;return e=new K_({props:{properties:t[7]}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,i){const o={};i&128&&(o.properties=r[7]),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function R6(t){let e,n;return e=new Iu({props:{openOn:"hover",$$slots:{default:[D6,({props:r})=>({7:r}),({props:r})=>r?128:0]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function N6(t){let e,n;const r=[Ti("debug-filters"),{paint:{"circle-radius":15,"circle-color":"black"}}];let i={$$slots:{default:[R6]},$$scope:{ctx:t}};for(let o=0;o<r.length;o+=1)i=gi(i,r[o]);return e=new q1({props:i}),{c(){Ve(e.$$.fragment)},m(o,c){Fe(e,o,c),n=!0},p(o,c){const l={};c&256&&(l.$$scope={dirty:c,ctx:o}),e.$set(l)},i(o){n||(ne(e.$$.fragment,o),n=!0)},o(o){de(e.$$.fragment,o),n=!1},d(o){Be(e,o)}}}function O6(t){let e,n,r,i,o;return n=new wy({props:{gjInput:JSON.parse(Vr(t[0]).renderNeighbourhood()),interactive:!0,onClickLine:t[2],$$slots:{"more-layers":[A6],"line-popup":[T6]},$$scope:{ctx:t}}}),i=new Fo({props:{data:JSON.parse(Vr(t[0]).renderModalFilters()),generateId:!0,$$slots:{default:[N6]},$$scope:{ctx:t}}}),{c(){e=pe("div"),Ve(n.$$.fragment),r=je(),Ve(i.$$.fragment),Ce(e,"slot","map")},m(c,l){be(c,e,l),Fe(n,e,null),te(e,r),Fe(i,e,null),o=!0},p(c,l){const d={};l&1&&(d.gjInput=JSON.parse(Vr(c[0]).renderNeighbourhood())),l&256&&(d.$$scope={dirty:l,ctx:c}),n.$set(d);const y={};l&1&&(y.data=JSON.parse(Vr(c[0]).renderModalFilters())),l&256&&(y.$$scope={dirty:l,ctx:c}),i.$set(y)},i(c){o||(ne(n.$$.fragment,c),ne(i.$$.fragment,c),o=!0)},o(c){de(n.$$.fragment,c),de(i.$$.fragment,c),o=!1},d(c){c&&ve(e),Be(n),Be(i)}}}function z6(t){let e,n;return e=new Eu({props:{$$slots:{map:[O6],sidebar:[I6],top:[E6]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,[i]){const o={};i&259&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function F6(t,e,n){let r,i;return wt(t,Zi,S=>n(0,r=S)),wt(t,Tn,S=>n(1,i=S)),[r,i,(S,E)=>window.open(Vr(S.properties).way,"_blank"),()=>Ut(Tn,i={mode:"neighbourhood"},i),()=>Ut(Tn,i={mode:"title"},i),()=>Ut(Tn,i={mode:"network"},i),()=>Ut(Tn,i={mode:"neighbourhood"},i)]}class B6 extends Qt{constructor(e){super(),Jt(this,e,F6,z6,Ht,{})}}function JS(t,e,n){const r=t.slice();return r[7]=e[n][0],r[8]=e[n][1],r[9]=e[n][2],r}function QS(t){let e,n,r,i,o,c,l=t[8]+"",d,y,S,E,C;function A(){return t[3](t[7])}return{c(){e=pe("button"),n=pe("img"),i=je(),o=pe("br"),c=je(),d=nt(l),y=je(),si(n.src,r=`/ltn//filters/${t[7]}_icon.gif`)||Ce(n,"src",r),Ce(n,"width","80"),Ce(n,"alt",t[8]),Ce(e,"class","outline"),gr(e,"width","100%"),e.disabled=S=t[0]==t[7]},m(M,R){be(M,e,R),te(e,n),te(e,i),te(e,o),te(e,c),te(e,d),te(e,y),E||(C=Lt(e,"click",A),E=!0)},p(M,R){t=M,R&1&&S!==(S=t[0]==t[7])&&(e.disabled=S)},d(M){M&&ve(e),E=!1,C()}}}function V6(t){let e,n,r,i,o,c,l,d,y,S,E,C,A=t[1][2]+"",M,R,N,B,O,G,U=Oi(t[2]),Z=[];for(let ae=0;ae<U.length;ae+=1)Z[ae]=QS(JS(t,U,ae));function ue(){return t[4](t[6])}return{c(){e=pe("h3"),e.textContent="Choose a modal filter to place on streets",n=je(),r=pe("table"),i=pe("tr"),o=pe("td");for(let ae=0;ae<Z.length;ae+=1)Z[ae].c();c=je(),l=pe("td"),d=pe("img"),E=je(),C=pe("p"),M=nt(A),R=je(),N=pe("center"),B=pe("button"),B.textContent="Confirm",si(d.src,y=`/ltn//filters/${t[0]}.gif`)||Ce(d,"src",y),Ce(d,"height","300"),Ce(d,"alt",S=t[1][1])},m(ae,se){be(ae,e,se),be(ae,n,se),be(ae,r,se),te(r,i),te(i,o);for(let fe=0;fe<Z.length;fe+=1)Z[fe]&&Z[fe].m(o,null);te(i,c),te(i,l),te(l,d),te(l,E),te(l,C),te(C,M),be(ae,R,se),be(ae,N,se),te(N,B),O||(G=Lt(B,"click",ue),O=!0)},p(ae,se){if(t=ae,se&5){U=Oi(t[2]);let fe;for(fe=0;fe<U.length;fe+=1){const ke=JS(t,U,fe);Z[fe]?Z[fe].p(ke,se):(Z[fe]=QS(ke),Z[fe].c(),Z[fe].m(o,null))}for(;fe<Z.length;fe+=1)Z[fe].d(1);Z.length=U.length}se&1&&!si(d.src,y=`/ltn//filters/${t[0]}.gif`)&&Ce(d,"src",y),se&2&&S!==(S=t[1][1])&&Ce(d,"alt",S),se&2&&A!==(A=t[1][2]+"")&&Kn(M,A)},d(ae){ae&&(ve(e),ve(n),ve(r),ve(R),ve(N)),du(Z,ae),O=!1,G()}}}function U6(t){let e,n;return e=new $_({props:{$$slots:{default:[V6,({dialog:r})=>({6:r}),({dialog:r})=>r?64:0]},$$scope:{ctx:t}}}),e.$on("close",t[5]),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,[i]){const o={};i&4163&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function j6(t,e,n){let r,i;wt(t,jv,y=>n(0,i=y));let o=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]];const c=y=>Ut(jv,i=y,i),l=y=>Vr(y).close();function d(y){xn.call(this,t,y)}return t.$$.update=()=>{t.$$.dirty&1&&n(1,r=o.find(y=>y[0]==i))},[i,r,o,c,l,d]}class G6 extends Qt{constructor(e){super(),Jt(this,e,j6,U6,Ht,{})}}function eE(t){let e,n;return e=new Fo({props:{data:t[0],$$slots:{default:[q6]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,i){const o={};i&1&&(o.data=r[0]),i&64&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function q6(t){let e,n;const r=[Ti("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let i={};for(let o=0;o<r.length;o+=1)i=gi(i,r[o]);return e=new Ml({props:i}),{c(){Ve(e.$$.fragment)},m(o,c){Fe(e,o,c),n=!0},p(o,c){const l={};e.$set(l)},i(o){n||(ne(e.$$.fragment,o),n=!0)},o(o){de(e.$$.fragment,o),n=!1},d(o){Be(e,o)}}}function W6(t){let e,n,r=t[0]&&eE(t);return{c(){r&&r.c(),e=ki()},m(i,o){r&&r.m(i,o),be(i,e,o),n=!0},p(i,[o]){i[0]?r?(r.p(i,o),o&1&&ne(r,1)):(r=eE(i),r.c(),ne(r,1),r.m(e.parentNode,e)):r&&(Rn(),de(r,1,1,()=>{r=null}),Nn())},i(i){n||(ne(r),n=!0)},o(i){de(r),n=!1},d(i){i&&ve(e),r&&r.d(i)}}}function H6(t,e,n){let{map:r}=e,i=null;const o=zl();r.on("dragstart",c),r.on("mousemove",l),r.on("mouseup",d),Hi(()=>{r.dragPan.enable(),r.off("dragstart",c),r.off("mousemove",l),r.off("mouseup",d)});function c(){r.dragPan.disable(),n(0,i={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function l(y){i&&(i.geometry.coordinates.push(y.lngLat.toArray()),n(0,i))}function d(){i&&(o("done",i),n(0,i=null))}return t.$$set=y=>{"map"in y&&n(1,r=y.map)},[i,r]}class Z6 extends Qt{constructor(e){super(),Jt(this,e,H6,W6,Ht,{map:1})}}function X6(t){let e;const n=t[3].default,r=hr(n,t,t[5],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),e=!0},p(i,o){r&&r.p&&(!e||o&32)&&pr(r,n,i,i[5],e?fr(n,i[5],o,null):dr(i[5]),null)},i(i){e||(ne(r,i),e=!0)},o(i){de(r,i),e=!1},d(i){r&&r.d(i)}}}function Y6(t){let e,n;const r=[Ti("modal-filters"),{layout:{"icon-image":["get","filter_kind"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let i={$$slots:{default:[X6]},$$scope:{ctx:t}};for(let o=0;o<r.length;o+=1)i=gi(i,r[o]);return e=new IC({props:i}),e.$on("click",t[4]),{c(){Ve(e.$$.fragment)},m(o,c){Fe(e,o,c),n=!0},p(o,c){const l={};c&32&&(l.$$scope={dirty:c,ctx:o}),e.$set(l)},i(o){n||(ne(e.$$.fragment,o),n=!0)},o(o){de(e.$$.fragment,o),n=!1},d(o){Be(e,o)}}}function $6(t){let e,n;return e=new Fo({props:{data:t[0],generateId:!0,$$slots:{default:[Y6]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,[i]){const o={};i&1&&(o.data=r[0]),i&32&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function K6(t,e,n){let r,i,o;wt(t,Zi,y=>n(1,i=y)),wt(t,Xu,y=>n(2,o=y));let{$$slots:c={},$$scope:l}=e;function d(y){xn.call(this,t,y)}return t.$$set=y=>{"$$scope"in y&&n(5,l=y.$$scope)},t.$$.update=()=>{t.$$.dirty&6&&n(0,r=o>0?JSON.parse(i.renderModalFilters()):null)},[r,i,o,c,d,l]}class Sy extends Qt{constructor(e){super(),Jt(this,e,K6,$6,Ht,{})}}var J6=Object.defineProperty,vr=(t,e)=>J6(t,"name",{value:e,configurable:!0}),Q6=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,i;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(i=e==null?void 0:e.compareProperties)!=null?i:!0}compare(e,n){if(e.type!==n.type||!Ud(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=u1(e),i=u1(n);return r.every(o=>i.some(c=>this.compare(o,c)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,i)=>Math.abs(r-n[i])<this.precision)}compareLine(e,n,r=0,i=!1){if(!Ud(e,n))return!1;const o=e;let c=n;if(i&&!this.compareCoord(o[0],c[0])){const d=this.fixStartIndex(c,o);if(d)c=d;else return!1}const l=this.compareCoord(o[r],c[r]);return this.direction||l?this.comparePath(o,c):this.compareCoord(o[r],c[c.length-(1+r)])?this.comparePath(o.slice().reverse(),c):!1}fixStartIndex(e,n){let r,i=-1;for(let o=0;o<e.length;o++)if(this.compareCoord(e[o],n[0])){i=o;break}return i>=0&&(r=[].concat(e.slice(i,e.length),e.slice(1,i+1))),r}comparePath(e,n){return e.every((r,i)=>this.compareCoord(r,n[i]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),i=n.coordinates.slice(1,n.coordinates.length);return r.every(o=>i.some(c=>this.compareLine(o,c,1,!0)))}return!1}compareGeometryCollection(e,n){return Ud(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,i)=>this.compare(r,n.geometries[i]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?lC(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Ud(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,i)=>this.compare(r,n.features[i]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};vr(Q6,"GeojsonEquality");function Ud(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}vr(Ud,"sameLength");function u1(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}vr(u1,"explode");var Bs=63710088e-1,TT={centimeters:Bs*100,centimetres:Bs*100,degrees:360/(2*Math.PI),feet:Bs*3.28084,inches:Bs*39.37,kilometers:Bs/1e3,kilometres:Bs/1e3,meters:Bs,metres:Bs,miles:Bs/1609.344,millimeters:Bs*1e3,millimetres:Bs*1e3,nauticalmiles:Bs/1852,radians:1,yards:Bs*1.0936},tE={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function yc(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}vr(yc,"feature");function eF(t,e,n={}){switch(t){case"Point":return up(e).geometry;case"LineString":return pb(e).geometry;case"Polygon":return fb(e).geometry;case"MultiPoint":return PT(e).geometry;case"MultiLineString":return LT(e).geometry;case"MultiPolygon":return MT(e).geometry;default:throw new Error(t+" is invalid")}}vr(eF,"geometry");function up(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!cp(t[0])||!cp(t[1]))throw new Error("coordinates must contain numbers");return yc({type:"Point",coordinates:t},e,n)}vr(up,"point");function tF(t,e,n={}){return Ey(t.map(r=>up(r,e)),n)}vr(tF,"points");function fb(t,e,n={}){for(const i of t){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let o=0;o<i[i.length-1].length;o++)if(i[i.length-1][o]!==i[0][o])throw new Error("First and last Position are not equivalent.")}return yc({type:"Polygon",coordinates:t},e,n)}vr(fb,"polygon");function nF(t,e,n={}){return Ey(t.map(r=>fb(r,e)),n)}vr(nF,"polygons");function pb(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return yc({type:"LineString",coordinates:t},e,n)}vr(pb,"lineString");function rF(t,e,n={}){return Ey(t.map(r=>pb(r,e)),n)}vr(rF,"lineStrings");function Ey(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}vr(Ey,"featureCollection");function LT(t,e,n={}){return yc({type:"MultiLineString",coordinates:t},e,n)}vr(LT,"multiLineString");function PT(t,e,n={}){return yc({type:"MultiPoint",coordinates:t},e,n)}vr(PT,"multiPoint");function MT(t,e,n={}){return yc({type:"MultiPolygon",coordinates:t},e,n)}vr(MT,"multiPolygon");function iF(t,e,n={}){return yc({type:"GeometryCollection",geometries:t},e,n)}vr(iF,"geometryCollection");function oF(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}vr(oF,"round");function db(t,e="kilometers"){const n=TT[e];if(!n)throw new Error(e+" units is invalid");return t*n}vr(db,"radiansToLength");function Iy(t,e="kilometers"){const n=TT[e];if(!n)throw new Error(e+" units is invalid");return t/n}vr(Iy,"lengthToRadians");function sF(t,e){return vm(Iy(t,e))}vr(sF,"lengthToDegrees");function aF(t){let e=t%360;return e<0&&(e+=360),e}vr(aF,"bearingToAzimuth");function vm(t){return t%(2*Math.PI)*180/Math.PI}vr(vm,"radiansToDegrees");function _a(t){return t%360*Math.PI/180}vr(_a,"degreesToRadians");function lF(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return db(Iy(t,e),n)}vr(lF,"convertLength");function uF(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=tE[e];if(!r)throw new Error("invalid original units");const i=tE[n];if(!i)throw new Error("invalid final units");return t/r*i}vr(uF,"convertArea");function cp(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}vr(cp,"isNumber");function cF(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}vr(cF,"isObject");function hF(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!cp(e))throw new Error("bbox must only contain numbers")})}vr(hF,"validateBBox");function fF(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}vr(fF,"validateId");var pF=Object.defineProperty,vc=(t,e)=>pF(t,"name",{value:e,configurable:!0});function hp(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}vc(hp,"getCoord");function dF(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}vc(dF,"getCoords");function kT(t){if(t.length>1&&cp(t[0])&&cp(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return kT(t[0]);throw new Error("coordinates must only contain numbers")}vc(kT,"containsNumber");function mF(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}vc(mF,"geojsonType");function gF(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}vc(gF,"featureOf");function _F(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}vc(_F,"collectionOf");function AT(t){return t.type==="Feature"?t.geometry:t}vc(AT,"getGeom");function yF(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}vc(yF,"getType");var vF=Object.defineProperty,DT=(t,e)=>vF(t,"name",{value:e,configurable:!0});function mb(t,e,n={}){if(n.final===!0)return RT(t,e);const r=hp(t),i=hp(e),o=_a(r[0]),c=_a(i[0]),l=_a(r[1]),d=_a(i[1]),y=Math.sin(c-o)*Math.cos(d),S=Math.cos(l)*Math.sin(d)-Math.sin(l)*Math.cos(d)*Math.cos(c-o);return vm(Math.atan2(y,S))}DT(mb,"bearing");function RT(t,e){let n=mb(e,t);return n=(n+180)%360,n}DT(RT,"calculateFinalBearing");var bF=Object.defineProperty,xF=(t,e)=>bF(t,"name",{value:e,configurable:!0});function NT(t,e,n,r={}){const i=hp(t),o=_a(i[0]),c=_a(i[1]),l=_a(n),d=Iy(e,r.units),y=Math.asin(Math.sin(c)*Math.cos(d)+Math.cos(c)*Math.sin(d)*Math.cos(l)),S=o+Math.atan2(Math.sin(l)*Math.sin(d)*Math.cos(c),Math.cos(d)-Math.sin(c)*Math.sin(y)),E=vm(S),C=vm(y);return up([E,C],r.properties)}xF(NT,"destination");var wF=Object.defineProperty,SF=(t,e)=>wF(t,"name",{value:e,configurable:!0});function OT(t,e,n={}){var r=hp(t),i=hp(e),o=_a(i[1]-r[1]),c=_a(i[0]-r[0]),l=_a(r[1]),d=_a(i[1]),y=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(c/2),2)*Math.cos(l)*Math.cos(d);return db(2*Math.atan2(Math.sqrt(y),Math.sqrt(1-y)),n.units)}SF(OT,"distance");var EF=Object.defineProperty,IF=(t,e)=>EF(t,"name",{value:e,configurable:!0});function zT(t,e,n={}){const i=AT(t).coordinates;let o=0;for(let c=0;c<i.length&&!(e>=o&&c===i.length-1);c++)if(o>=e){const l=e-o;if(l){const d=mb(i[c],i[c-1])-180;return NT(i[c],l,d,n)}else return up(i[c])}else o+=OT(i[c],i[c+1],n);return up(i[i.length-1])}IF(zT,"along");var CF=zT;function TF(t){let e,n;const r=[Ti("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let i={};for(let o=0;o<r.length;o+=1)i=gi(i,r[o]);return e=new q1({props:i}),{c(){Ve(e.$$.fragment)},m(o,c){Fe(e,o,c),n=!0},p(o,c){const l={};e.$set(l)},i(o){n||(ne(e.$$.fragment,o),n=!0)},o(o){de(e.$$.fragment,o),n=!1},d(o){Be(e,o)}}}function LF(t){let e,n;return e=new Fo({props:{data:t[0],$$slots:{default:[TF]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,[i]){const o={};i&1&&(o.data=r[0]),i&1024&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}let PF=50,MF=100,kF=.01;function AF(t,e,n){let{paths:r}=e,i=d(),o=y(),c=E(),l=setInterval(C,MF);Hi(()=>clearInterval(l));function d(){return r.features.map(A=>1/A.properties.directness).reduce((A,M)=>A+M,0)}function y(){return r.features.length==0?[]:Array.from({length:PF},S)}function S(){let A=Math.random()*i,M=0;for(let[R,N]of r.features.entries())if(M+=1/N.properties.directness,A<M)return{idx:R,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${i}`)}function E(){return{type:"FeatureCollection",features:o.map(({idx:A,distance:M})=>CF(r.features[A],M,{units:"kilometers"}))}}function C(){for(let[A,M]of o.entries())M.distance+=kF,M.distance>=r.features[M.idx].properties.length_meters/1e3&&(o[A]=S());n(0,c=E())}return t.$$set=A=>{"paths"in A&&n(1,r=A.paths)},t.$$.update=()=>{t.$$.dirty&2&&r&&(i=d(),o=y())},[c,r]}class DF extends Qt{constructor(e){super(),Jt(this,e,AF,LF,Ht,{paths:1})}}function RF(t){let e;return{c(){e=nt("Choose project")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function NF(t){let e;return{c(){e=nt("Pick neighbourhood")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function OF(t){let e;return{c(){e=pe("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(n,r){be(n,e,r)},p:Mt,d(n){n&&ve(e)}}}function zF(t){let e;return{c(){e=nt("View shortcuts")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function FF(t){let e;return{c(){e=nt("Route")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function BF(t){let e;return{c(){e=nt("Change this boundary")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function VF(t){let e;return{c(){e=nt("Debug")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function UF(t){let e,n,r,i,o,c,l,d,y,S,E,C,A,M,R,N,B,O,G,U,Z,ue,ae,se,fe,ke,K;return o=new mr({props:{$$slots:{default:[RF]},$$scope:{ctx:t}}}),o.$on("click",t[25]),d=new mr({props:{$$slots:{default:[NF]},$$scope:{ctx:t}}}),d.$on("click",t[26]),C=new hb({props:{$$slots:{default:[OF]},$$scope:{ctx:t}}}),B=new mr({props:{$$slots:{default:[zF]},$$scope:{ctx:t}}}),B.$on("click",t[27]),U=new mr({props:{$$slots:{default:[FF]},$$scope:{ctx:t}}}),U.$on("click",t[28]),ae=new mr({props:{$$slots:{default:[BF]},$$scope:{ctx:t}}}),ae.$on("click",t[29]),ke=new mr({props:{$$slots:{default:[VF]},$$scope:{ctx:t}}}),ke.$on("click",t[30]),{c(){e=pe("div"),n=pe("nav"),r=pe("ul"),i=pe("li"),Ve(o.$$.fragment),c=je(),l=pe("li"),Ve(d.$$.fragment),y=je(),S=pe("li"),E=nt(`Editing
          `),Ve(C.$$.fragment),A=je(),M=pe("nav"),R=pe("ul"),N=pe("li"),Ve(B.$$.fragment),O=je(),G=pe("li"),Ve(U.$$.fragment),Z=je(),ue=pe("li"),Ve(ae.$$.fragment),se=je(),fe=pe("li"),Ve(ke.$$.fragment),Ce(n,"aria-label","breadcrumb"),Ce(e,"slot","top"),gr(e,"display","flex"),gr(e,"justify-content","space-between")},m(oe,Ge){be(oe,e,Ge),te(e,n),te(n,r),te(r,i),Fe(o,i,null),te(r,c),te(r,l),Fe(d,l,null),te(r,y),te(r,S),te(S,E),Fe(C,S,null),te(e,A),te(e,M),te(M,R),te(R,N),Fe(B,N,null),te(R,O),te(R,G),Fe(U,G,null),te(R,Z),te(R,ue),Fe(ae,ue,null),te(R,se),te(R,fe),Fe(ke,fe,null),K=!0},p(oe,Ge){const Te={};Ge[1]&8&&(Te.$$scope={dirty:Ge,ctx:oe}),o.$set(Te);const ot={};Ge[1]&8&&(ot.$$scope={dirty:Ge,ctx:oe}),d.$set(ot);const ft={};Ge[1]&8&&(ft.$$scope={dirty:Ge,ctx:oe}),C.$set(ft);const At={};Ge[1]&8&&(At.$$scope={dirty:Ge,ctx:oe}),B.$set(At);const Ke={};Ge[1]&8&&(Ke.$$scope={dirty:Ge,ctx:oe}),U.$set(Ke);const Ft={};Ge[1]&8&&(Ft.$$scope={dirty:Ge,ctx:oe}),ae.$set(Ft);const bt={};Ge[1]&8&&(bt.$$scope={dirty:Ge,ctx:oe}),ke.$set(bt)},i(oe){K||(ne(o.$$.fragment,oe),ne(d.$$.fragment,oe),ne(C.$$.fragment,oe),ne(B.$$.fragment,oe),ne(U.$$.fragment,oe),ne(ae.$$.fragment,oe),ne(ke.$$.fragment,oe),K=!0)},o(oe){de(o.$$.fragment,oe),de(d.$$.fragment,oe),de(C.$$.fragment,oe),de(B.$$.fragment,oe),de(U.$$.fragment,oe),de(ae.$$.fragment,oe),de(ke.$$.fragment,oe),K=!1},d(oe){oe&&ve(e),Be(o),Be(d),Be(C),Be(B),Be(U),Be(ae),Be(ke)}}}function nE(t){let e;return{c(){e=pe("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function jF(t){let e,n,r;return{c(){e=nt("Undo ("),n=nt(t[4]),r=nt(")")},m(i,o){be(i,e,o),be(i,n,o),be(i,r,o)},p(i,o){o[0]&16&&Kn(n,i[4])},d(i){i&&(ve(e),ve(n),ve(r))}}}function GF(t){let e;return{c(){e=nt("Undo")},m(n,r){be(n,e,r)},p:Mt,d(n){n&&ve(e)}}}function qF(t){let e,n,r;return{c(){e=nt("Redo ("),n=nt(t[5]),r=nt(")")},m(i,o){be(i,e,o),be(i,n,o),be(i,r,o)},p(i,o){o[0]&32&&Kn(n,i[5])},d(i){i&&(ve(e),ve(n),ve(r))}}}function WF(t){let e;return{c(){e=nt("Redo")},m(n,r){be(n,e,r)},p:Mt,d(n){n&&ve(e)}}}function rE(t){let e,n;return e=new G6({}),e.$on("close",t[24]),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p:Mt,i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function HF(t){let e,n,r,i,o=Vr(t[6]).properties.name+"",c,l,d=t[1].area_km2.toFixed(1)+"",y,S,E,C,A,M,R,N,B,O,G,U,Z,ue,ae,se,fe,ke,K,oe,Ge,Te,ot,ft,At,Ke,Ft,bt,Rt,Ot,ln,Ln,an,Xt,En,In=t[8]>0&&nE();function rr(Nt,me){return Nt[4]==0?GF:jF}let mt=rr(t),Dt=mt(t);function Sn(Nt,me){return Nt[5]==0?WF:qF}let Le=Sn(t),rt=Le(t),gt=t[3]&&rE(t);return{c(){e=pe("div"),n=pe("p"),r=nt("Editing neighbourhood "),i=pe("u"),c=nt(o),l=nt(`
      , with an area of `),y=nt(d),S=nt(" km"),E=je(),In&&In.c(),C=je(),A=pe("div"),M=pe("button"),R=pe("img"),B=nt(`
        Add a modal filter`),G=je(),U=pe("button"),Z=nt("Add many modal filters along line"),ae=je(),se=pe("button"),fe=nt("Reverse directions"),K=je(),oe=pe("button"),oe.textContent="Change modal filter type",Ge=je(),Te=pe("label"),ot=pe("input"),ft=nt(`
      Animate shortcuts`),At=je(),Ke=pe("div"),Ft=pe("button"),Dt.c(),Rt=je(),Ot=pe("button"),rt.c(),Ln=je(),gt&&gt.c(),si(R.src,N=`/ltn//filters/${t[9]}_icon.gif`)||Ce(R,"src",N),Ce(R,"width","30"),Ce(R,"alt","Add a modal filter"),M.disabled=O=t[0]=="filter",Ce(M,"data-tooltip","hotkey 1"),U.disabled=ue=t[0]=="freehand-filters",Ce(U,"data-tooltip","hotkey 2"),se.disabled=ke=t[0]=="oneway",Ce(se,"data-tooltip","hotkey 3"),gr(A,"display","flex"),gr(A,"justify-content","space-between"),Ce(ot,"type","checkbox"),Ft.disabled=bt=t[4]==0,Ce(Ft,"data-tooltip","Ctrl+Z"),Ot.disabled=ln=t[5]==0,Ce(Ot,"data-tooltip","Ctrl+Y"),gr(Ke,"display","flex"),gr(Ke,"justify-content","space-between"),Ce(e,"slot","sidebar")},m(Nt,me){be(Nt,e,me),te(e,n),te(n,r),te(n,i),te(i,c),te(n,l),te(n,y),te(n,S),te(e,E),In&&In.m(e,null),te(e,C),te(e,A),te(A,M),te(M,R),te(M,B),te(A,G),te(A,U),te(U,Z),te(A,ae),te(A,se),te(se,fe),te(e,K),te(e,oe),te(e,Ge),te(e,Te),te(Te,ot),ot.checked=t[10],te(Te,ft),te(e,At),te(e,Ke),te(Ke,Ft),Dt.m(Ft,null),te(Ke,Rt),te(Ke,Ot),rt.m(Ot,null),te(e,Ln),gt&&gt.m(e,null),an=!0,Xt||(En=[Lt(M,"click",t[19]),Lt(U,"click",t[20]),Lt(se,"click",t[21]),Lt(oe,"click",t[22]),Lt(ot,"change",t[23]),Lt(Ft,"click",t[15]),Lt(Ot,"click",t[16])],Xt=!0)},p(Nt,me){(!an||me[0]&64)&&o!==(o=Vr(Nt[6]).properties.name+"")&&Kn(c,o),(!an||me[0]&2)&&d!==(d=Nt[1].area_km2.toFixed(1)+"")&&Kn(y,d),Nt[8]>0?In||(In=nE(),In.c(),In.m(e,C)):In&&(In.d(1),In=null),(!an||me[0]&512&&!si(R.src,N=`/ltn//filters/${Nt[9]}_icon.gif`))&&Ce(R,"src",N),(!an||me[0]&1&&O!==(O=Nt[0]=="filter"))&&(M.disabled=O),(!an||me[0]&1&&ue!==(ue=Nt[0]=="freehand-filters"))&&(U.disabled=ue),(!an||me[0]&1&&ke!==(ke=Nt[0]=="oneway"))&&(se.disabled=ke),me[0]&1024&&(ot.checked=Nt[10]),mt===(mt=rr(Nt))&&Dt?Dt.p(Nt,me):(Dt.d(1),Dt=mt(Nt),Dt&&(Dt.c(),Dt.m(Ft,null))),(!an||me[0]&16&&bt!==(bt=Nt[4]==0))&&(Ft.disabled=bt),Le===(Le=Sn(Nt))&&rt?rt.p(Nt,me):(rt.d(1),rt=Le(Nt),rt&&(rt.c(),rt.m(Ot,null))),(!an||me[0]&32&&ln!==(ln=Nt[5]==0))&&(Ot.disabled=ln),Nt[3]?gt?(gt.p(Nt,me),me[0]&8&&ne(gt,1)):(gt=rE(Nt),gt.c(),ne(gt,1),gt.m(e,null)):gt&&(Rn(),de(gt,1,1,()=>{gt=null}),Nn())},i(Nt){an||(ne(gt),an=!0)},o(Nt){de(gt),an=!1},d(Nt){Nt&&ve(e),In&&In.d(),Dt.d(),rt.d(),gt&&gt.d(),Xt=!1,Hr(En)}}}function ZF(t){let e;return{c(){e=pe("p"),e.textContent="Click to change direction"},m(n,r){be(n,e,r)},p:Mt,d(n){n&&ve(e)}}}function XF(t){let e,n,r,i;return{c(){e=pe("div"),n=pe("img"),i=nt(`
              Click to add modal filter`),si(n.src,r=`/ltn//filters/${t[9]}_icon.gif`)||Ce(n,"src",r),Ce(n,"width","20"),Ce(n,"alt","Add modal filter")},m(o,c){be(o,e,c),te(e,n),te(e,i)},p(o,c){c[0]&512&&!si(n.src,r=`/ltn//filters/${o[9]}_icon.gif`)&&Ce(n,"src",r)},d(o){o&&ve(e)}}}function YF(t){let e,n=t[33].shortcuts+"",r,i,o=(t[33].name??"unnamed road")+"",c,l,d;function y(C,A){return C[0]=="filter"?XF:ZF}let S=y(t),E=S(t);return{c(){e=pe("p"),r=nt(n),i=nt(" shortcuts through "),c=nt(o),l=je(),E.c(),d=ki()},m(C,A){be(C,e,A),te(e,r),te(e,i),te(e,c),be(C,l,A),E.m(C,A),be(C,d,A)},p(C,A){A[1]&4&&n!==(n=C[33].shortcuts+"")&&Kn(r,n),A[1]&4&&o!==(o=(C[33].name??"unnamed road")+"")&&Kn(c,o),S===(S=y(C))&&E?E.p(C,A):(E.d(1),E=S(C),E&&(E.c(),E.m(d.parentNode,d)))},d(C){C&&(ve(e),ve(l),ve(d)),E.d(C)}}}function $F(t){let e,n,r;return n=new Iu({props:{openOn:"hover",$$slots:{default:[YF,({props:i})=>({33:i}),({props:i})=>[0,i?4:0]]},$$scope:{ctx:t}}}),{c(){e=pe("div"),Ve(n.$$.fragment),Ce(e,"slot","line-popup")},m(i,o){be(i,e,o),Fe(n,e,null),r=!0},p(i,o){const c={};o[0]&513|o[1]&12&&(c.$$scope={dirty:o,ctx:i}),n.$set(c)},i(i){r||(ne(n.$$.fragment,i),r=!0)},o(i){de(n.$$.fragment,i),r=!1},d(i){i&&ve(e),Be(n)}}}function iE(t){let e,n;return e=new DF({props:{paths:t[7]}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,i){const o={};i[0]&128&&(o.paths=r[7]),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function KF(t){let e;return{c(){e=nt("Click to delete")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function JF(t){let e,n;return e=new Iu({props:{openOn:"hover",$$slots:{default:[KF]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,i){const o={};i[1]&8&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function oE(t){let e,n;return e=new Z6({props:{map:Vr(t[2])}}),e.$on("done",t[17]),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,i){const o={};i[0]&4&&(o.map=Vr(r[2])),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function QF(t){let e,n,r,i,o,c,l;n=new wy({props:{gjInput:t[1],interactive:t[0]=="filter"||t[0]=="oneway",onClickLine:t[12],$$slots:{"line-popup":[$F]},$$scope:{ctx:t}}});let d=t[10]&&iE(t);o=new Sy({props:{$$slots:{default:[JF]},$$scope:{ctx:t}}}),o.$on("click",t[13]);let y=t[0]=="freehand-filters"&&oE(t);return{c(){e=pe("div"),Ve(n.$$.fragment),r=je(),d&&d.c(),i=je(),Ve(o.$$.fragment),c=je(),y&&y.c(),Ce(e,"slot","map")},m(S,E){be(S,e,E),Fe(n,e,null),te(e,r),d&&d.m(e,null),te(e,i),Fe(o,e,null),te(e,c),y&&y.m(e,null),l=!0},p(S,E){const C={};E[0]&2&&(C.gjInput=S[1]),E[0]&1&&(C.interactive=S[0]=="filter"||S[0]=="oneway"),E[0]&513|E[1]&8&&(C.$$scope={dirty:E,ctx:S}),n.$set(C),S[10]?d?(d.p(S,E),E[0]&1024&&ne(d,1)):(d=iE(S),d.c(),ne(d,1),d.m(e,i)):d&&(Rn(),de(d,1,1,()=>{d=null}),Nn());const A={};E[1]&8&&(A.$$scope={dirty:E,ctx:S}),o.$set(A),S[0]=="freehand-filters"?y?(y.p(S,E),E[0]&1&&ne(y,1)):(y=oE(S),y.c(),ne(y,1),y.m(e,null)):y&&(Rn(),de(y,1,1,()=>{y=null}),Nn())},i(S){l||(ne(n.$$.fragment,S),ne(d),ne(o.$$.fragment,S),ne(y),l=!0)},o(S){de(n.$$.fragment,S),de(d),de(o.$$.fragment,S),de(y),l=!1},d(S){S&&ve(e),Be(n),d&&d.d(),Be(o),y&&y.d()}}}function eB(t){let e,n,r,i;return e=new Eu({props:{$$slots:{map:[QF],sidebar:[HF],top:[UF]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment)},m(o,c){Fe(e,o,c),n=!0,r||(i=Lt(window,"keydown",t[14]),r=!0)},p(o,c){const l={};c[0]&4095|c[1]&8&&(l.$$scope={dirty:c,ctx:o}),e.$set(l)},i(o){n||(ne(e.$$.fragment,o),n=!0)},o(o){de(e.$$.fragment,o),n=!1},d(o){Be(e,o),r=!1,i()}}}function tB(t,e,n){let r,i,o,c,l,d,y;wt(t,Xu,bt=>n(18,i=bt)),wt(t,jv,bt=>n(9,o=bt)),wt(t,Zi,bt=>n(31,c=bt)),wt(t,Pl,bt=>n(2,l=bt)),wt(t,E2,bt=>n(10,d=bt)),wt(t,Tn,bt=>n(11,y=bt));let S="filter",E=!1,C=0,A=0,M,R,N=JSON.parse(c.getAllShortcuts());Hi(()=>{l.doubleClickZoom.enable()});function B(bt){n(1,R=JSON.parse(c.renderNeighbourhood())),n(6,M=R.features.find(Rt=>Rt.properties.kind=="boundary")),n(4,C=R.undo_length),n(5,A=R.redo_length),n(7,N=JSON.parse(c.getAllShortcuts())),Vf()}function O(bt,Rt){S=="filter"?(c.addModalFilter(Rt,o),Ut(Xu,i++,i)):S=="oneway"&&(c.toggleDirection(bt.properties.road),Ut(Xu,i++,i))}function G(bt){let Rt=bt.detail.features[0];c.deleteModalFilter(Rt.properties.road),Ut(Xu,i++,i)}function U(bt){bt.target.tagName!="INPUT"&&(bt.ctrlKey&&bt.key=="z"&&Z(),bt.ctrlKey&&bt.key=="y"&&ue(),bt.key=="1"&&n(0,S="filter"),bt.key=="2"&&n(0,S="freehand-filters"),bt.key=="3"&&n(0,S="oneway"))}function Z(){c.undo(),Ut(Xu,i++,i)}function ue(){c.redo(),Ut(Xu,i++,i)}function ae(bt){let Rt=bt.detail;Rt&&(c.addManyModalFilters(Rt,o),Ut(Xu,i++,i)),n(0,S="filter")}const se=()=>n(0,S="filter"),fe=()=>n(0,S="freehand-filters"),ke=()=>n(0,S="oneway"),K=()=>n(3,E=!0);function oe(){d=this.checked,E2.set(d)}const Ge=()=>n(3,E=!1),Te=()=>Ut(Tn,y={mode:"title"},y),ot=()=>Ut(Tn,y={mode:"network"},y),ft=()=>Ut(Tn,y={mode:"view-shortcuts"},y),At=()=>Ut(Tn,y={mode:"route",prevMode:"neighbourhood"},y),Ke=()=>Ut(Tn,y={mode:"set-boundary",name:Vr(M).properties.name,existing:M},y),Ft=()=>Ut(Tn,y={mode:"debug"},y);return t.$$.update=()=>{t.$$.dirty[0]&5&&(S=="oneway"?l.doubleClickZoom.disable():l.doubleClickZoom.enable()),t.$$.dirty[0]&262144&&B(),t.$$.dirty[0]&2&&n(8,r=R.features.filter(bt=>bt.properties.kind=="cell"&&bt.properties.cell_color=="disconnected").length)},[S,R,l,E,C,A,M,N,r,o,d,y,O,G,U,Z,ue,ae,i,se,fe,ke,K,oe,Ge,Te,ot,ft,At,Ke,Ft]}class nB extends Qt{constructor(e){super(),Jt(this,e,tB,eB,Ht,{},null,[-1,-1])}}const FT="/ltn/assets/delete-ec75e756.svg",BT="/ltn/assets/edit-f3f51206.svg";function sE(t,e,n){const r=t.slice();return r[19]=e[n],r}function rB(t){let e;return{c(){e=nt("Choose project")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function iB(t){let e;return{c(){e=pe("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(n,r){be(n,e,r)},p:Mt,d(n){n&&ve(e)}}}function oB(t){let e;return{c(){e=nt("Route")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function sB(t){let e,n,r,i,o,c,l,d,y,S,E,C,A,M,R;return o=new mr({props:{$$slots:{default:[rB]},$$scope:{ctx:t}}}),o.$on("click",t[16]),y=new hb({props:{$$slots:{default:[iB]},$$scope:{ctx:t}}}),M=new mr({props:{$$slots:{default:[oB]},$$scope:{ctx:t}}}),M.$on("click",t[17]),{c(){e=pe("div"),n=pe("nav"),r=pe("ul"),i=pe("li"),Ve(o.$$.fragment),c=je(),l=pe("li"),d=nt(`Pick neighbourhood
          `),Ve(y.$$.fragment),S=je(),E=pe("nav"),C=pe("ul"),A=pe("li"),Ve(M.$$.fragment),Ce(n,"aria-label","breadcrumb"),Ce(e,"slot","top"),gr(e,"display","flex"),gr(e,"justify-content","space-between")},m(N,B){be(N,e,B),te(e,n),te(n,r),te(r,i),Fe(o,i,null),te(r,c),te(r,l),te(l,d),Fe(y,l,null),te(e,S),te(e,E),te(E,C),te(C,A),Fe(M,A,null),R=!0},p(N,B){const O={};B&4194304&&(O.$$scope={dirty:B,ctx:N}),o.$set(O);const G={};B&4194304&&(G.$$scope={dirty:B,ctx:N}),y.$set(G);const U={};B&4194304&&(U.$$scope={dirty:B,ctx:N}),M.$set(U)},i(N){R||(ne(o.$$.fragment,N),ne(y.$$.fragment,N),ne(M.$$.fragment,N),R=!0)},o(N){de(o.$$.fragment,N),de(y.$$.fragment,N),de(M.$$.fragment,N),R=!1},d(N){N&&ve(e),Be(o),Be(y),Be(M)}}}function aB(t){let e;return{c(){e=nt("Draw a new boundary")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function lB(t){let e;return{c(){e=nt("Use an auto-generated boundary")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function uB(t){let e=t[19]+"",n;return{c(){n=nt(e)},m(r,i){be(r,n,i)},p(r,i){i&2&&e!==(e=r[19]+"")&&Kn(n,e)},d(r){r&&ve(n)}}}function aE(t){let e,n,r,i,o,c,l,d,y,S,E;function C(){return t[13](t[19])}r=new mr({props:{$$slots:{default:[uB]},$$scope:{ctx:t}}}),r.$on("click",C);function A(){return t[14](t[19])}function M(){return t[15](t[19])}return{c(){e=pe("li"),n=pe("span"),Ve(r.$$.fragment),i=je(),o=pe("button"),o.innerHTML=`<img src="${BT}" alt="Rename neighbourhood"/>`,c=je(),l=pe("button"),l.innerHTML=`<img src="${FT}" alt="Delete neighbourhood"/>`,d=je(),Ce(o,"class","secondary"),Ce(l,"class","secondary"),gr(n,"display","flex"),gr(n,"justify-content","space-between")},m(R,N){be(R,e,N),te(e,n),Fe(r,n,null),te(n,i),te(n,o),te(n,c),te(n,l),te(e,d),y=!0,S||(E=[Lt(o,"click",A),Lt(l,"click",M)],S=!0)},p(R,N){t=R;const B={};N&4194306&&(B.$$scope={dirty:N,ctx:t}),r.$set(B)},i(R){y||(ne(r.$$.fragment,R),y=!0)},o(R){de(r.$$.fragment,R),y=!1},d(R){R&&ve(e),Be(r),S=!1,Hr(E)}}}function cB(t){let e,n,r,i,o,c,l,d,y,S,E,C,A,M,R,N,B,O,G,U,Z;r=new mr({props:{$$slots:{default:[aB]},$$scope:{ctx:t}}}),r.$on("click",t[7]),c=new mr({props:{$$slots:{default:[lB]},$$scope:{ctx:t}}}),c.$on("click",t[12]);let ue=Oi(t[1]),ae=[];for(let fe=0;fe<ue.length;fe+=1)ae[fe]=aE(sE(t,ue,fe));const se=fe=>de(ae[fe],1,1,()=>{ae[fe]=null});return{c(){e=pe("div"),n=pe("div"),Ve(r.$$.fragment),i=je(),o=pe("div"),Ve(c.$$.fragment),l=je(),d=pe("ul");for(let fe=0;fe<ae.length;fe+=1)ae[fe].c();y=je(),S=pe("hr"),E=je(),C=pe("p"),A=nt("Current project: "),M=nt(t[2]),R=je(),N=pe("button"),N.textContent="Export project to GeoJSON",B=je(),O=pe("button"),O.textContent="Debug route-snapper",Ce(O,"class","secondary"),Ce(e,"slot","sidebar")},m(fe,ke){be(fe,e,ke),te(e,n),Fe(r,n,null),te(e,i),te(e,o),Fe(c,o,null),te(e,l),te(e,d);for(let K=0;K<ae.length;K+=1)ae[K]&&ae[K].m(d,null);te(e,y),te(e,S),te(e,E),te(e,C),te(C,A),te(C,M),te(e,R),te(e,N),te(e,B),te(e,O),G=!0,U||(Z=[Lt(N,"click",t[8]),Lt(O,"click",t[9])],U=!0)},p(fe,ke){const K={};ke&4194304&&(K.$$scope={dirty:ke,ctx:fe}),r.$set(K);const oe={};if(ke&4194304&&(oe.$$scope={dirty:ke,ctx:fe}),c.$set(oe),ke&114){ue=Oi(fe[1]);let Ge;for(Ge=0;Ge<ue.length;Ge+=1){const Te=sE(fe,ue,Ge);ae[Ge]?(ae[Ge].p(Te,ke),ne(ae[Ge],1)):(ae[Ge]=aE(Te),ae[Ge].c(),ne(ae[Ge],1),ae[Ge].m(d,null))}for(Rn(),Ge=ue.length;Ge<ae.length;Ge+=1)se(Ge);Nn()}(!G||ke&4)&&Kn(M,fe[2])},i(fe){if(!G){ne(r.$$.fragment,fe),ne(c.$$.fragment,fe);for(let ke=0;ke<ue.length;ke+=1)ne(ae[ke]);G=!0}},o(fe){de(r.$$.fragment,fe),de(c.$$.fragment,fe),ae=ae.filter(Boolean);for(let ke=0;ke<ae.length;ke+=1)de(ae[ke]);G=!1},d(fe){fe&&ve(e),Be(r),Be(c),du(ae,fe),U=!1,Hr(Z)}}}function hB(t){let e,n=t[18].name+"",r;return{c(){e=pe("p"),r=nt(n)},m(i,o){be(i,e,o),te(e,r)},p(i,o){o&262144&&n!==(n=i[18].name+"")&&Kn(r,n)},d(i){i&&ve(e)}}}function fB(t){let e,n;return e=new Iu({props:{openOn:"hover",$$slots:{default:[hB,({props:r})=>({18:r}),({props:r})=>r?262144:0]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,i){const o={};i&4456448&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function pB(t){let e,n;const r=[Ti("neighbourhood-boundaries"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"red","fill-opacity":Uf(.3,.5)}},{eventsIfTopMost:!0},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={$$slots:{default:[fB]},$$scope:{ctx:t}};for(let o=0;o<r.length;o+=1)i=gi(i,r[o]);return e=new mc({props:i}),e.$on("click",t[11]),{c(){Ve(e.$$.fragment)},m(o,c){Fe(e,o,c),n=!0},p(o,c){const l={};c&4194304&&(l.$$scope={dirty:c,ctx:o}),e.$set(l)},i(o){n||(ne(e.$$.fragment,o),n=!0)},o(o){de(e.$$.fragment,o),n=!1},d(o){Be(e,o)}}}function dB(t){let e,n,r,i,o;return n=new Fo({props:{data:t[0],generateId:!0,$$slots:{default:[pB]},$$scope:{ctx:t}}}),i=new Sy({}),{c(){e=pe("div"),Ve(n.$$.fragment),r=je(),Ve(i.$$.fragment),Ce(e,"slot","map")},m(c,l){be(c,e,l),Fe(n,e,null),te(e,r),Fe(i,e,null),o=!0},p(c,l){const d={};l&1&&(d.data=c[0]),l&4194304&&(d.$$scope={dirty:l,ctx:c}),n.$set(d)},i(c){o||(ne(n.$$.fragment,c),ne(i.$$.fragment,c),o=!0)},o(c){de(n.$$.fragment,c),de(i.$$.fragment,c),o=!1},d(c){c&&ve(e),Be(n),Be(i)}}}function mB(t){let e,n;return e=new Eu({props:{$$slots:{map:[dB],sidebar:[cB],top:[sB]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,[i]){const o={};i&4194319&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function gB(t,e,n){let r,i,o,c,l;wt(t,Zi,Z=>n(10,o=Z)),wt(t,nc,Z=>n(2,c=Z)),wt(t,Tn,Z=>n(3,l=Z));function d(Z){o.setCurrentNeighbourhood(Z),Ut(Tn,l={mode:"neighbourhood"},l)}function y(Z){window.confirm(`Really delete neighbourhood ${Z}? You can't undo this.`)&&(o.deleteNeighbourhoodBoundary(Z),Vf(),n(0,r=JSON.parse(o.toSavefile())))}function S(Z){let ue=window.prompt(`Rename neighbourhood ${Z} to what?`,Z);ue&&(o.renameNeighbourhoodBoundary(Z,ue),Vf(),n(0,r=JSON.parse(o.toSavefile())))}function E(){let Z=window.prompt("What do you want to name the neighbourhood?");Z&&Ut(Tn,l={mode:"set-boundary",name:Z,existing:null},l)}function C(){d_(c+".geojson",o.toSavefile())}function A(){d_("debug_route_snapper.geojson",o.toRouteSnapperGj())}const M=Z=>d(Vr(Z.detail.features[0].properties).name),R=()=>Ut(Tn,l={mode:"auto-boundaries"},l),N=Z=>d(Z),B=Z=>S(Z),O=Z=>y(Z),G=()=>Ut(Tn,l={mode:"title"},l),U=()=>Ut(Tn,l={mode:"route",prevMode:"network"},l);return t.$$.update=()=>{t.$$.dirty&1024&&n(0,r=JSON.parse(o.toSavefile())),t.$$.dirty&1&&n(1,i=r.features.filter(Z=>Z.properties.kind=="boundary").map(Z=>Z.properties.name))},[r,i,c,l,d,y,S,E,C,A,o,M,R,N,B,O,G,U]}class _B extends Qt{constructor(e){super(),Jt(this,e,gB,mB,Ht,{})}}function yB(t){let e;return{c(){e=nt("Choose project")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function vB(t){let e;return{c(){e=nt("Pick neighbourhood")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function lE(t){let e,n,r;return n=new mr({props:{$$slots:{default:[bB]},$$scope:{ctx:t}}}),n.$on("click",t[13]),{c(){e=pe("li"),Ve(n.$$.fragment)},m(i,o){be(i,e,o),Fe(n,e,null),r=!0},p(i,o){const c={};o&16384&&(c.$$scope={dirty:o,ctx:i}),n.$set(c)},i(i){r||(ne(n.$$.fragment,i),r=!0)},o(i){de(n.$$.fragment,i),r=!1},d(i){i&&ve(e),Be(n)}}}function bB(t){let e;return{c(){e=nt("Editing")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function xB(t){let e,n,r,i,o,c,l,d,y,S,E,C;o=new mr({props:{$$slots:{default:[yB]},$$scope:{ctx:t}}}),o.$on("click",t[11]),d=new mr({props:{$$slots:{default:[vB]},$$scope:{ctx:t}}}),d.$on("click",t[12]);let A=t[0]=="neighbourhood"&&lE(t);return{c(){e=pe("div"),n=pe("nav"),r=pe("ul"),i=pe("li"),Ve(o.$$.fragment),c=je(),l=pe("li"),Ve(d.$$.fragment),y=je(),A&&A.c(),S=je(),E=pe("li"),E.textContent="Routing",Ce(n,"aria-label","breadcrumb"),Ce(e,"slot","top")},m(M,R){be(M,e,R),te(e,n),te(n,r),te(r,i),Fe(o,i,null),te(r,c),te(r,l),Fe(d,l,null),te(r,y),A&&A.m(r,null),te(r,S),te(r,E),C=!0},p(M,R){const N={};R&16384&&(N.$$scope={dirty:R,ctx:M}),o.$set(N);const B={};R&16384&&(B.$$scope={dirty:R,ctx:M}),d.$set(B),M[0]=="neighbourhood"?A?(A.p(M,R),R&1&&ne(A,1)):(A=lE(M),A.c(),ne(A,1),A.m(r,S)):A&&(Rn(),de(A,1,1,()=>{A=null}),Nn())},i(M){C||(ne(o.$$.fragment,M),ne(d.$$.fragment,M),ne(A),C=!0)},o(M){de(o.$$.fragment,M),de(d.$$.fragment,M),de(A),C=!1},d(M){M&&ve(e),Be(o),Be(d),A&&A.d()}}}function wB(t){let e,n,r,i,o,c,l,d,y,S,E,C,A,M,R,N,B;return n=new xy({}),n.$on("click",t[7]),{c(){e=pe("div"),Ve(n.$$.fragment),r=je(),i=pe("p"),i.textContent="Drag markers for a route",o=je(),c=pe("p"),c.innerHTML=`<span style="color: red">Route before</span>
      ,
      <span style="color: blue">route after</span>`,l=je(),d=pe("label"),y=nt("Slow-down factor for main roads: "),S=nt(t[1]),E=je(),C=pe("input"),A=je(),M=pe("i"),M.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,Ce(C,"type","range"),Ce(C,"min","1.0"),Ce(C,"max","5.0"),Ce(C,"step","0.1"),Ce(e,"slot","sidebar")},m(O,G){be(O,e,G),Fe(n,e,null),te(e,r),te(e,i),te(e,o),te(e,c),te(e,l),te(e,d),te(d,y),te(d,S),te(d,E),te(d,C),qi(C,t[1]),te(e,A),te(e,M),R=!0,N||(B=[Lt(C,"change",t[10]),Lt(C,"input",t[10])],N=!0)},p(O,G){(!R||G&2)&&Kn(S,O[1]),G&2&&qi(C,O[1])},i(O){R||(ne(n.$$.fragment,O),R=!0)},o(O){de(n.$$.fragment,O),R=!1},d(O){O&&ve(e),Be(n),N=!1,Hr(B)}}}function uE(t){let e,n;return e=new wy({props:{gjInput:JSON.parse(Vr(t[4]).renderNeighbourhood()),interactive:!1}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,i){const o={};i&16&&(o.gjInput=JSON.parse(Vr(r[4]).renderNeighbourhood())),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function SB(t){let e,n;const r=[Ti("compare-route"),{paint:{"line-width":10,"line-color":Iz(["get","kind"],{before:"red",after:"blue"},"red")}}];let i={};for(let o=0;o<r.length;o+=1)i=gi(i,r[o]);return e=new Ml({props:i}),{c(){Ve(e.$$.fragment)},m(o,c){Fe(e,o,c),n=!0},p(o,c){const l={};e.$set(l)},i(o){n||(ne(e.$$.fragment,o),n=!0)},o(o){de(e.$$.fragment,o),n=!1},d(o){Be(e,o)}}}function EB(t){let e;return{c(){e=pe("span"),e.textContent="A",Ce(e,"class","dot svelte-1gcxp27")},m(n,r){be(n,e,r)},p:Mt,d(n){n&&ve(e)}}}function IB(t){let e;return{c(){e=pe("span"),e.textContent="B",Ce(e,"class","dot svelte-1gcxp27")},m(n,r){be(n,e,r)},p:Mt,d(n){n&&ve(e)}}}function CB(t){let e,n,r,i,o,c,l,d,y,S,E,C,A=t[0]=="neighbourhood"&&uE(t);r=new Sy({}),o=new Fo({props:{data:t[5],$$slots:{default:[SB]},$$scope:{ctx:t}}});function M(O){t[8](O)}let R={draggable:!0,$$slots:{default:[EB]},$$scope:{ctx:t}};t[3]!==void 0&&(R.lngLat=t[3]),l=new R_({props:R}),Gr.push(()=>xa(l,"lngLat",M));function N(O){t[9](O)}let B={draggable:!0,$$slots:{default:[IB]},$$scope:{ctx:t}};return t[2]!==void 0&&(B.lngLat=t[2]),S=new R_({props:B}),Gr.push(()=>xa(S,"lngLat",N)),{c(){e=pe("div"),A&&A.c(),n=je(),Ve(r.$$.fragment),i=je(),Ve(o.$$.fragment),c=je(),Ve(l.$$.fragment),y=je(),Ve(S.$$.fragment),Ce(e,"slot","map")},m(O,G){be(O,e,G),A&&A.m(e,null),te(e,n),Fe(r,e,null),te(e,i),Fe(o,e,null),te(e,c),Fe(l,e,null),te(e,y),Fe(S,e,null),C=!0},p(O,G){O[0]=="neighbourhood"?A?(A.p(O,G),G&1&&ne(A,1)):(A=uE(O),A.c(),ne(A,1),A.m(e,n)):A&&(Rn(),de(A,1,1,()=>{A=null}),Nn());const U={};G&32&&(U.data=O[5]),G&16384&&(U.$$scope={dirty:G,ctx:O}),o.$set(U);const Z={};G&16384&&(Z.$$scope={dirty:G,ctx:O}),!d&&G&8&&(d=!0,Z.lngLat=O[3],ba(()=>d=!1)),l.$set(Z);const ue={};G&16384&&(ue.$$scope={dirty:G,ctx:O}),!E&&G&4&&(E=!0,ue.lngLat=O[2],ba(()=>E=!1)),S.$set(ue)},i(O){C||(ne(A),ne(r.$$.fragment,O),ne(o.$$.fragment,O),ne(l.$$.fragment,O),ne(S.$$.fragment,O),C=!0)},o(O){de(A),de(r.$$.fragment,O),de(o.$$.fragment,O),de(l.$$.fragment,O),de(S.$$.fragment,O),C=!1},d(O){O&&ve(e),A&&A.d(),Be(r),Be(o),Be(l),Be(S)}}}function TB(t){let e,n;return e=new Eu({props:{$$slots:{map:[CB],sidebar:[wB],top:[xB]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,[i]){const o={};i&16511&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function LB(t,e,n){let r,i,o,c,l,d;wt(t,Tn,B=>n(6,i=B)),wt(t,S2,B=>n(1,o=B)),wt(t,Uv,B=>n(2,c=B)),wt(t,Vv,B=>n(3,l=B)),wt(t,Zi,B=>n(4,d=B));let{prevMode:y}=e;function S(){Ut(Tn,i={mode:y},i)}function E(B){l=B,Vv.set(l)}function C(B){c=B,Uv.set(c)}function A(){o=f1(this.value),S2.set(o)}const M=()=>Ut(Tn,i={mode:"title"},i),R=()=>Ut(Tn,i={mode:"network"},i),N=()=>Ut(Tn,i={mode:"neighbourhood"},i);return t.$$set=B=>{"prevMode"in B&&n(0,y=B.prevMode)},t.$$.update=()=>{t.$$.dirty&30&&n(5,r=JSON.parse(d.compareRoute(l.lng,l.lat,c.lng,c.lat,o)))},[y,o,c,l,d,r,i,S,E,C,A,M,R,N]}class PB extends Qt{constructor(e){super(),Jt(this,e,LB,TB,Ht,{prevMode:0})}}const MB="/ltn/assets/settings-342fb430.svg";function cE(t){let e,n;return e=new $_({props:{$$slots:{default:[kB]},$$scope:{ctx:t}}}),e.$on("close",t[3]),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,i){const o={};i&17&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function kB(t){let e,n,r,i,o,c,l,d,y;return r=new Bz({}),{c(){e=pe("h1"),e.textContent="Settings",n=je(),Ve(r.$$.fragment),i=je(),o=pe("center"),c=pe("button"),c.textContent="Confirm"},m(S,E){be(S,e,E),be(S,n,E),Fe(r,S,E),be(S,i,E),be(S,o,E),te(o,c),l=!0,d||(y=Lt(c,"click",t[2]),d=!0)},p:Mt,i(S){l||(ne(r.$$.fragment,S),l=!0)},o(S){de(r.$$.fragment,S),l=!1},d(S){S&&(ve(e),ve(n),ve(i),ve(o)),Be(r,S),d=!1,y()}}}function AB(t){let e,n,r,i,o,c,l=t[0]&&cE(t);return{c(){e=pe("button"),e.innerHTML=`<img src="${MB}" alt="Settings"/>`,n=je(),l&&l.c(),r=ki(),Ce(e,"class","outline")},m(d,y){be(d,e,y),be(d,n,y),l&&l.m(d,y),be(d,r,y),i=!0,o||(c=Lt(e,"click",t[1]),o=!0)},p(d,[y]){d[0]?l?(l.p(d,y),y&1&&ne(l,1)):(l=cE(d),l.c(),ne(l,1),l.m(r.parentNode,r)):l&&(Rn(),de(l,1,1,()=>{l=null}),Nn())},i(d){i||(ne(l),i=!0)},o(d){de(l),i=!1},d(d){d&&(ve(e),ve(n),ve(r)),l&&l.d(d),o=!1,c()}}}function DB(t,e,n){let r=!1;return[r,()=>n(0,r=!0),()=>n(0,r=!1),()=>n(0,r=!1)]}class RB extends Qt{constructor(e){super(),Jt(this,e,DB,AB,Ht,{})}}let fp=Gn(null);const ha=Gn([]);function VT(t){if(t.length<3)return JSON.parse(rs(fp).inner.calculateRoute(t));let e=JSON.parse(JSON.stringify(t));e.push(e[0]);let n=JSON.parse(rs(fp).inner.calculateRoute(e));return n.properties.waypoints.pop(),n.geometry.type="Polygon",n.geometry.coordinates=[n.geometry.coordinates],n}const{window:NB}=X_,OB=t=>({}),hE=t=>({}),zB=t=>({}),fE=t=>({});function pE(t,e,n){const r=t.slice();return r[43]=e[n],r[44]=e,r[45]=n,r}function dE(t,e,n){const r=t.slice();return r[46]=e[n],r[47]=e,r[48]=n,r}function FB(t){let e,n;const r=t[24]["extra-top"],i=hr(r,t,t[37],hE);return{c(){e=pe("div"),i&&i.c(),Ce(e,"slot","top")},m(o,c){be(o,e,c),i&&i.m(e,null),n=!0},p(o,c){i&&i.p&&(!n||c[1]&64)&&pr(i,r,o,o[37],n?fr(r,o[37],c,OB):dr(o[37]),hE)},i(o){n||(ne(i,o),n=!0)},o(o){de(i,o),n=!1},d(o){o&&ve(e),i&&i.d(o)}}}function BB(t){let e,n,r,i,o;return{c(){e=pe("ul"),e.innerHTML=`<li><b>Click</b>
            the map to add new points, until there are at least 3 points</li> <li><b>Click and drag</b>
            any point to move it</li> <li><b>Click</b>
            a waypoint to toggle snapping</li> <li><b>Right click</b>
            a waypoint to delete it</li>`,n=je(),r=pe("p"),r.textContent="Keyboard shortcuts:",i=je(),o=pe("ul"),o.innerHTML=`<li><b>s</b>
            to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
            to undo your last change</li> <li><b>Enter</b>
            or
            <b>Escape</b>
            to finish</li> <li>From the main mode, <b>3</b>
            to draw a new area</li>`},m(c,l){be(c,e,l),be(c,n,l),be(c,r,l),be(c,i,l),be(c,o,l)},p:Mt,d(c){c&&(ve(e),ve(n),ve(r),ve(i),ve(o))}}}function VB(t){let e,n=t[8].length+"",r,i;return{c(){e=nt("Undo ("),r=nt(n),i=nt(")")},m(o,c){be(o,e,c),be(o,r,c),be(o,i,c)},p(o,c){c[0]&256&&n!==(n=o[8].length+"")&&Kn(r,n)},d(o){o&&(ve(e),ve(r),ve(i))}}}function UB(t){let e;return{c(){e=nt("Undo")},m(n,r){be(n,e,r)},p:Mt,d(n){n&&ve(e)}}}function jB(t){let e;return{c(){e=pe("p"),e.textContent="Drag to adjust. Click to toggle snapped. Right click to delete."},m(n,r){be(n,e,r)},p:Mt,d(n){n&&ve(e)}}}function GB(t){let e,n,r,i,o,c,l,d,y,S,E,C,A;return E=BE(t[35][0]),{c(){e=pe("fieldset"),n=pe("label"),r=pe("input"),i=nt(`
          Snap to roads`),o=je(),c=pe("label"),l=pe("input"),d=nt(`
          Draw anywhere`),y=je(),S=pe("p"),S.textContent="Click to add at least 3 points",Ce(r,"type","radio"),r.__value="snap",qi(r,r.__value),Ce(l,"type","radio"),l.__value="free",qi(l,l.__value),E.p(r,l)},m(M,R){be(M,e,R),te(e,n),te(n,r),r.checked=r.__value===t[7],te(n,i),te(e,o),te(e,c),te(c,l),l.checked=l.__value===t[7],te(c,d),be(M,y,R),be(M,S,R),C||(A=[Lt(r,"change",t[34]),Lt(l,"change",t[36])],C=!0)},p(M,R){R[0]&128&&(r.checked=r.__value===M[7]),R[0]&128&&(l.checked=l.__value===M[7])},d(M){M&&(ve(e),ve(y),ve(S)),E.r(),C=!1,Hr(A)}}}function qB(t){let e,n,r,i,o,c,l,d,y,S,E,C,A,M,R,N,B;const O=t[24]["extra-sidebar"],G=hr(O,t,t[37],fE);S=new hb({props:{$$slots:{default:[BB]},$$scope:{ctx:t}}});function U(ke,K){return ke[8].length==0?UB:VB}let Z=U(t),ue=Z(t);function ae(ke,K){return ke[5].length<3?GB:jB}let se=ae(t),fe=se(t);return{c(){e=pe("div"),G&&G.c(),n=je(),r=pe("div"),i=pe("button"),o=nt("Finish"),l=je(),d=pe("button"),d.textContent="Cancel",y=je(),Ve(S.$$.fragment),E=je(),C=pe("button"),ue.c(),M=je(),fe.c(),i.disabled=c=t[5].length<3,Ce(d,"class","secondary"),gr(r,"display","flex"),Ce(C,"class","secondary"),C.disabled=A=t[8].length==0,Ce(e,"slot","sidebar")},m(ke,K){be(ke,e,K),G&&G.m(e,null),te(e,n),te(e,r),te(r,i),te(i,o),te(r,l),te(r,d),te(r,y),Fe(S,r,null),te(e,E),te(e,C),ue.m(C,null),te(e,M),fe.m(e,null),R=!0,N||(B=[Lt(i,"click",function(){Nf(t[0])&&t[0].apply(this,arguments)}),Lt(d,"click",function(){Nf(t[1])&&t[1].apply(this,arguments)}),Lt(C,"click",t[11])],N=!0)},p(ke,K){t=ke,G&&G.p&&(!R||K[1]&64)&&pr(G,O,t,t[37],R?fr(O,t[37],K,zB):dr(t[37]),fE),(!R||K[0]&32&&c!==(c=t[5].length<3))&&(i.disabled=c);const oe={};K[1]&64&&(oe.$$scope={dirty:K,ctx:t}),S.$set(oe),Z===(Z=U(t))&&ue?ue.p(t,K):(ue.d(1),ue=Z(t),ue&&(ue.c(),ue.m(C,null))),(!R||K[0]&256&&A!==(A=t[8].length==0))&&(C.disabled=A),se===(se=ae(t))&&fe?fe.p(t,K):(fe.d(1),fe=se(t),fe&&(fe.c(),fe.m(e,null)))},i(ke){R||(ne(G,ke),ne(S.$$.fragment,ke),R=!0)},o(ke){de(G,ke),de(S.$$.fragment,ke),R=!1},d(ke){ke&&ve(e),G&&G.d(ke),Be(S),ue.d(),fe.d(),N=!1,Hr(B)}}}function WB(t){let e;return{c(){e=pe("span"),Ce(e,"class","dot svelte-1cj4rwq"),no(e,"snapped-node",t[46].snapped),no(e,"free-node",!t[46].snapped),no(e,"hide",t[4])},m(n,r){be(n,e,r)},p(n,r){r[0]&512&&no(e,"snapped-node",n[46].snapped),r[0]&512&&no(e,"free-node",!n[46].snapped),r[0]&16&&no(e,"hide",n[4])},d(n){n&&ve(e)}}}function mE(t){let e,n,r;function i(d){t[25](d,t[46])}function o(){return t[26](t[46])}function c(){return t[27](t[46])}let l={draggable:!0,zIndex:0,$$slots:{default:[WB]},$$scope:{ctx:t}};return t[46].point!==void 0&&(l.lngLat=t[46].point),e=new R_({props:l}),Gr.push(()=>xa(e,"lngLat",i)),e.$on("dragstart",o),e.$on("drag",c),e.$on("dragend",t[19]),{c(){Ve(e.$$.fragment)},m(d,y){Fe(e,d,y),r=!0},p(d,y){t=d;const S={};y[0]&528|y[1]&64&&(S.$$scope={dirty:y,ctx:t}),!n&&y[0]&512&&(n=!0,S.lngLat=t[46].point,ba(()=>n=!1)),e.$set(S)},i(d){r||(ne(e.$$.fragment,d),r=!0)},o(d){de(e.$$.fragment,d),r=!1},d(d){Be(e,d)}}}function HB(t){let e;return{c(){e=pe("span"),e.textContent=`${t[45]+1}`,Ce(e,"class","dot svelte-1cj4rwq"),no(e,"snapped",t[43].snapped)},m(n,r){be(n,e,r)},p(n,r){r[0]&32&&no(e,"snapped",n[43].snapped)},d(n){n&&ve(e)}}}function gE(t){let e,n,r;function i(d){t[28](d,t[43])}function o(){return t[29](t[45])}function c(){return t[30](t[45])}let l={draggable:!0,zIndex:1,$$slots:{default:[HB]},$$scope:{ctx:t}};return t[43].point!==void 0&&(l.lngLat=t[43].point),e=new R_({props:l}),Gr.push(()=>xa(e,"lngLat",i)),e.$on("click",o),e.$on("contextmenu",c),e.$on("mouseenter",t[31]),e.$on("mouseleave",t[32]),e.$on("dragstart",t[21]),e.$on("dragend",t[33]),{c(){Ve(e.$$.fragment)},m(d,y){Fe(e,d,y),r=!0},p(d,y){t=d;const S={};y[0]&32|y[1]&64&&(S.$$scope={dirty:y,ctx:t}),!n&&y[0]&32&&(n=!0,S.lngLat=t[43].point,ba(()=>n=!1)),e.$set(S)},i(d){r||(ne(e.$$.fragment,d),r=!0)},o(d){de(e.$$.fragment,d),r=!1},d(d){Be(e,d)}}}function ZB(t){let e,n,r,i;const o=[Ti("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let c={};for(let y=0;y<o.length;y+=1)c=gi(c,o[y]);e=new Ml({props:c});const l=[Ti("draw-area-preview"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let d={};for(let y=0;y<l.length;y+=1)d=gi(d,l[y]);return r=new mc({props:d}),{c(){Ve(e.$$.fragment),n=je(),Ve(r.$$.fragment)},m(y,S){Fe(e,y,S),be(y,n,S),Fe(r,y,S),i=!0},p(y,S){const E={};e.$set(E);const C={};r.$set(C)},i(y){i||(ne(e.$$.fragment,y),ne(r.$$.fragment,y),i=!0)},o(y){de(e.$$.fragment,y),de(r.$$.fragment,y),i=!1},d(y){y&&ve(n),Be(e,y),Be(r,y)}}}function XB(t){let e,n;return e=new Ml({props:{paint:{"line-color":"black","line-width":3}}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p:Mt,i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function YB(t){let e,n,r,i,o,c,l,d,y;n=new aN({}),n.$on("click",t[12]),n.$on("mousemove",t[13]);let S=Oi(t[9]),E=[];for(let N=0;N<S.length;N+=1)E[N]=mE(dE(t,S,N));const C=N=>de(E[N],1,1,()=>{E[N]=null});let A=Oi(t[5]),M=[];for(let N=0;N<A.length;N+=1)M[N]=gE(pE(t,A,N));const R=N=>de(M[N],1,1,()=>{M[N]=null});return c=new Fo({props:{data:t[16](t[6],t[5]),generateId:!0,$$slots:{default:[ZB]},$$scope:{ctx:t}}}),d=new Fo({props:{data:t[10],$$slots:{default:[XB]},$$scope:{ctx:t}}}),{c(){e=pe("div"),Ve(n.$$.fragment),r=je();for(let N=0;N<E.length;N+=1)E[N].c();i=je();for(let N=0;N<M.length;N+=1)M[N].c();o=je(),Ve(c.$$.fragment),l=je(),Ve(d.$$.fragment),Ce(e,"slot","map")},m(N,B){be(N,e,B),Fe(n,e,null),te(e,r);for(let O=0;O<E.length;O+=1)E[O]&&E[O].m(e,null);te(e,i);for(let O=0;O<M.length;O+=1)M[O]&&M[O].m(e,null);te(e,o),Fe(c,e,null),te(e,l),Fe(d,e,null),y=!0},p(N,B){if(B[0]&918032){S=Oi(N[9]);let U;for(U=0;U<S.length;U+=1){const Z=dE(N,S,U);E[U]?(E[U].p(Z,B),ne(E[U],1)):(E[U]=mE(Z),E[U].c(),ne(E[U],1),E[U].m(e,i))}for(Rn(),U=S.length;U<E.length;U+=1)C(U);Nn()}if(B[0]&2146348){A=Oi(N[5]);let U;for(U=0;U<A.length;U+=1){const Z=pE(N,A,U);M[U]?(M[U].p(Z,B),ne(M[U],1)):(M[U]=gE(Z),M[U].c(),ne(M[U],1),M[U].m(e,o))}for(Rn(),U=A.length;U<M.length;U+=1)R(U);Nn()}const O={};B[0]&96&&(O.data=N[16](N[6],N[5])),B[1]&64&&(O.$$scope={dirty:B,ctx:N}),c.$set(O);const G={};B[0]&1024&&(G.data=N[10]),B[1]&64&&(G.$$scope={dirty:B,ctx:N}),d.$set(G)},i(N){if(!y){ne(n.$$.fragment,N);for(let B=0;B<S.length;B+=1)ne(E[B]);for(let B=0;B<A.length;B+=1)ne(M[B]);ne(c.$$.fragment,N),ne(d.$$.fragment,N),y=!0}},o(N){de(n.$$.fragment,N),E=E.filter(Boolean);for(let B=0;B<E.length;B+=1)de(E[B]);M=M.filter(Boolean);for(let B=0;B<M.length;B+=1)de(M[B]);de(c.$$.fragment,N),de(d.$$.fragment,N),y=!1},d(N){N&&ve(e),Be(n),du(E,N),du(M,N),Be(c),Be(d)}}}function $B(t){let e,n,r,i;return e=new Eu({props:{$$slots:{map:[YB],sidebar:[qB],top:[FB]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment)},m(o,c){Fe(e,o,c),n=!0,r||(i=Lt(NB,"keydown",t[20]),r=!0)},p(o,c){const l={};c[0]&2047|c[1]&64&&(l.$$scope={dirty:c,ctx:o}),e.$set(l)},i(o){n||(ne(e.$$.fragment,o),n=!0)},o(o){de(e.$$.fragment,o),n=!1},d(o){Be(e,o),r=!1,i()}}}function KB(t,e,n){let r,i,o;wt(t,ha,mt=>n(5,i=mt)),wt(t,fp,mt=>n(6,o=mt));let{$$slots:c={},$$scope:l}=e,{map:d}=e,{finish:y}=e,{cancel:S}=e;Hi(()=>{Ut(ha,i=[],i),o==null||o.stop(),d.getCanvas().style.cursor="inherit"});let E="snap",C=[],A=[],M=null,R=!1,N=!1,B=!1;function O(mt){let Dt=mt.length==0?"crosshair":"inherit";d.getCanvas().style.cursor=Dt}function G(){let mt=C.pop();n(8,C),mt&&Ut(ha,i=mt,i)}function U(){C.length==100&&C.shift(),n(8,C=[...C,JSON.parse(JSON.stringify(i))])}function Z(){n(7,E=E=="snap"?"free":"snap"),M&&n(23,M.snapped=E=="snap",M)}function ue(mt){i.length>=3||(U(),ha.update(Dt=>(Dt.push({point:mt.detail.lngLat.toArray(),snapped:E=="snap"}),Dt)))}function ae(mt){n(23,M={point:mt.detail.lngLat.toArray(),snapped:E=="snap"})}function se(mt){U(),ha.update(Dt=>(Dt[mt].snapped=!Dt[mt].snapped,Dt))}function fe(mt){U(),ha.update(Dt=>(Dt.splice(mt,1),Dt)),n(2,R=!1)}function ke(mt,Dt){try{if(mt)return VT(Dt)}catch{}return c_()}function K(mt,Dt,Sn,Le){if(Le||Dt.length>=3)return c_();try{if(mt&&Dt.length>0&&Sn)return JSON.parse(mt.inner.calculateRoute([Dt[Dt.length-1],Sn]))}catch{}return c_()}function oe(mt,Dt,Sn){if(Sn)return;if(!mt||Dt.length<3){n(9,A=[]);return}let Le=[],rt=1,gt=JSON.parse(JSON.stringify(Dt));gt.push(gt[0]);for(let Nt=0;Nt<gt.length-1;Nt++){let me=JSON.parse(mt.inner.getExtraNodes(gt[Nt],gt[Nt+1]));for(let[tn,Xe,St]of me)Le.push({point:[tn,Xe],snapped:St,insertIdx:rt});rt++}n(9,A=Le)}function Ge(mt){U(),ha.update(Dt=>(Dt.splice(mt.insertIdx,0,{point:mt.point,snapped:mt.snapped}),Dt)),n(4,B=!0)}function Te(mt){ha.update(Dt=>(Dt[mt.insertIdx].point=mt.point,Dt))}function ot(){n(4,B=!1)}function ft(mt){let Dt=mt.target.tagName,Sn=Dt=="INPUT"||Dt=="TEXTAREA";mt.key=="Enter"&&!Sn||mt.key=="Escape"?(mt.stopPropagation(),i.length>=3?y():window.alert("You can't save this area unless it has at least three points. Press 'Cancel' to discard these changes.")):mt.key=="s"&&!Sn?Z():mt.key=="z"&&mt.ctrlKey&&(mt.stopPropagation(),G())}function At(){U(),n(3,N=!0)}const Ke=[[]];function Ft(mt,Dt){t.$$.not_equal(Dt.point,mt)&&(Dt.point=mt,n(9,A))}const bt=mt=>Ge(mt),Rt=mt=>Te(mt);function Ot(mt,Dt){t.$$.not_equal(Dt.point,mt)&&(Dt.point=mt,ha.set(i))}const ln=mt=>se(mt),Ln=mt=>fe(mt),an=()=>n(2,R=!0),Xt=()=>n(2,R=!1),En=()=>n(3,N=!1);function In(){E=this.__value,n(7,E)}function rr(){E=this.__value,n(7,E)}return t.$$set=mt=>{"map"in mt&&n(22,d=mt.map),"finish"in mt&&n(0,y=mt.finish),"cancel"in mt&&n(1,S=mt.cancel),"$$scope"in mt&&n(37,l=mt.$$scope)},t.$$.update=()=>{t.$$.dirty[0]&112&&oe(o,i,B),t.$$.dirty[0]&8388716&&n(10,r=K(o,i,M,R||N)),t.$$.dirty[0]&32&&O(i)},[y,S,R,N,B,i,o,E,C,A,r,G,ue,ae,se,fe,ke,Ge,Te,ot,ft,At,d,M,c,Ft,bt,Rt,Ot,ln,Ln,an,Xt,En,In,Ke,rr,l]}class JB extends Qt{constructor(e){super(),Jt(this,e,KB,$B,Ht,{map:22,finish:0,cancel:1},null,[-1,-1])}}function QB(t){let e;return{c(){e=nt("Choose project")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function e8(t){let e;return{c(){e=nt("Pick neighbourhood")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function t8(t){let e;return{c(){e=pe("li"),e.textContent="Creating new neighbourhood boundary"},m(n,r){be(n,e,r)},p:Mt,i:Mt,o:Mt,d(n){n&&ve(e)}}}function n8(t){let e,n,r,i,o;return n=new mr({props:{$$slots:{default:[r8]},$$scope:{ctx:t}}}),n.$on("click",t[8]),{c(){e=pe("li"),Ve(n.$$.fragment),r=je(),i=pe("li"),i.textContent="Changing neighbourhood boundary"},m(c,l){be(c,e,l),Fe(n,e,null),be(c,r,l),be(c,i,l),o=!0},p(c,l){const d={};l&2048&&(d.$$scope={dirty:l,ctx:c}),n.$set(d)},i(c){o||(ne(n.$$.fragment,c),o=!0)},o(c){de(n.$$.fragment,c),o=!1},d(c){c&&(ve(e),ve(r),ve(i)),Be(n)}}}function r8(t){let e;return{c(){e=nt("Editing")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function i8(t){let e,n,r,i,o,c,l,d,y,S,E,C;o=new mr({props:{$$slots:{default:[QB]},$$scope:{ctx:t}}}),o.$on("click",t[6]),d=new mr({props:{$$slots:{default:[e8]},$$scope:{ctx:t}}}),d.$on("click",t[7]);const A=[n8,t8],M=[];function R(N,B){return N[1]?0:1}return S=R(t),E=M[S]=A[S](t),{c(){e=pe("div"),n=pe("nav"),r=pe("ul"),i=pe("li"),Ve(o.$$.fragment),c=je(),l=pe("li"),Ve(d.$$.fragment),y=je(),E.c(),Ce(n,"aria-label","breadcrumb"),Ce(e,"slot","extra-top")},m(N,B){be(N,e,B),te(e,n),te(n,r),te(r,i),Fe(o,i,null),te(r,c),te(r,l),Fe(d,l,null),te(r,y),M[S].m(r,null),C=!0},p(N,B){const O={};B&2048&&(O.$$scope={dirty:B,ctx:N}),o.$set(O);const G={};B&2048&&(G.$$scope={dirty:B,ctx:N}),d.$set(G);let U=S;S=R(N),S===U?M[S].p(N,B):(Rn(),de(M[U],1,1,()=>{M[U]=null}),Nn(),E=M[S],E?E.p(N,B):(E=M[S]=A[S](N),E.c()),ne(E,1),E.m(r,null))},i(N){C||(ne(o.$$.fragment,N),ne(d.$$.fragment,N),ne(E),C=!0)},o(N){de(o.$$.fragment,N),de(d.$$.fragment,N),de(E),C=!1},d(N){N&&ve(e),Be(o),Be(d),M[S].d()}}}function o8(t){let e,n,r,i;return{c(){e=pe("div"),n=pe("h1"),r=nt("Draw your neighbourhood boundary for "),i=nt(t[0]),Ce(e,"slot","extra-sidebar")},m(o,c){be(o,e,c),te(e,n),te(n,r),te(n,i)},p(o,c){c&1&&Kn(i,o[0])},d(o){o&&ve(e)}}}function s8(t){let e,n;return e=new JB({props:{map:Vr(t[3]),finish:t[4],cancel:t[5],$$slots:{"extra-sidebar":[o8],"extra-top":[i8]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,[i]){const o={};i&8&&(o.map=Vr(r[3])),i&2055&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function a8(t,e,n){let r,i,o,c;wt(t,Tn,M=>n(2,r=M)),wt(t,Zi,M=>n(9,i=M)),wt(t,ha,M=>n(10,o=M)),wt(t,Pl,M=>n(3,c=M));let{name:l}=e,{existing:d}=e;d&&(d.properties.waypoints?Ut(ha,o=d.properties.waypoints.map(M=>({point:[M.lon,M.lat],snapped:M.snapped})),o):Ut(ha,o=d.geometry.coordinates[0].slice(1).map(M=>({point:M,snapped:!1})),o));function y(){if(o.length>=3)try{let M=VT(o);i.setNeighbourhoodBoundary(l,M),Vf(),i.setCurrentNeighbourhood(l),Ut(Tn,r={mode:"neighbourhood"},r)}catch{window.alert("Known georust bug hit, sorry. You may need to just refresh the page now."),S()}}function S(){d?Ut(Tn,r={mode:"neighbourhood"},r):Ut(Tn,r={mode:"network"},r)}const E=()=>Ut(Tn,r={mode:"title"},r),C=()=>Ut(Tn,r={mode:"network"},r),A=()=>Ut(Tn,r={mode:"neighbourhood"},r);return t.$$set=M=>{"name"in M&&n(0,l=M.name),"existing"in M&&n(1,d=M.existing)},[l,d,r,c,y,S,E,C,A]}class l8 extends Qt{constructor(e){super(),Jt(this,e,a8,s8,Ht,{name:0,existing:1})}}function u8(t){let e;return{c(){e=nt("Choose project")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function c8(t){let e;return{c(){e=nt("Pick neighbourhood")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function h8(t){let e,n,r,i,o,c,l,d,y,S,E;return o=new mr({props:{$$slots:{default:[u8]},$$scope:{ctx:t}}}),o.$on("click",t[10]),d=new mr({props:{$$slots:{default:[c8]},$$scope:{ctx:t}}}),d.$on("click",t[11]),{c(){e=pe("div"),n=pe("nav"),r=pe("ul"),i=pe("li"),Ve(o.$$.fragment),c=je(),l=pe("li"),Ve(d.$$.fragment),y=je(),S=pe("li"),S.textContent="Use an auto-generated boundary",Ce(n,"aria-label","breadcrumb"),Ce(e,"slot","top")},m(C,A){be(C,e,A),te(e,n),te(n,r),te(r,i),Fe(o,i,null),te(r,c),te(r,l),Fe(d,l,null),te(r,y),te(r,S),E=!0},p(C,A){const M={};A&16384&&(M.$$scope={dirty:A,ctx:C}),o.$set(M);const R={};A&16384&&(R.$$scope={dirty:A,ctx:C}),d.$set(R)},i(C){E||(ne(o.$$.fragment,C),ne(d.$$.fragment,C),E=!0)},o(C){de(o.$$.fragment,C),de(d.$$.fragment,C),E=!1},d(C){C&&ve(e),Be(o),Be(d)}}}function f8(t){let e,n,r,i,o,c,l,d,y,S,E,C,A,M,R,N,B;return n=new xy({}),n.$on("click",t[7]),{c(){e=pe("div"),Ve(n.$$.fragment),r=je(),i=pe("p"),i.textContent=`Click an area to use it as a neighbourhood. These are generated by finding
      roads, railways, and water that form severances. There are many bugs; this
      is experimental. The colors are arbitrary, just to distinguish better.`,o=je(),c=pe("button"),c.textContent="Export to GeoJSON",l=je(),d=pe("label"),y=nt(`Minimum area (km)
      `),S=pe("input"),E=je(),C=pe("label"),A=pe("input"),M=nt(`
      Remove areas not touching a big road`),Ce(c,"class","secondary"),Ce(S,"type","number"),Ce(S,"min","0"),Ce(S,"max","1"),Ce(S,"step","0.01"),Ce(A,"type","checkbox"),Ce(e,"slot","sidebar")},m(O,G){be(O,e,G),Fe(n,e,null),te(e,r),te(e,i),te(e,o),te(e,c),te(e,l),te(e,d),te(d,y),te(d,S),qi(S,t[0]),te(e,E),te(e,C),te(C,A),A.checked=t[1],te(C,M),R=!0,N||(B=[Lt(c,"click",t[5]),Lt(S,"input",t[8]),Lt(A,"change",t[9])],N=!0)},p(O,G){G&1&&f1(S.value)!==O[0]&&qi(S,O[0]),G&2&&(A.checked=O[1])},i(O){R||(ne(n.$$.fragment,O),R=!0)},o(O){de(n.$$.fragment,O),R=!1},d(O){O&&ve(e),Be(n),N=!1,Hr(B)}}}function p8(t){let e,n,r=t[13].area_km2.toFixed(1)+"",i,o,c,l,d,y=t[13].touches_big_road+"",S,E,C=t[13].touches_railway+"",A,M,R=t[13].touches_waterway+"",N;return{c(){e=pe("p"),n=nt("Area: "),i=nt(r),o=nt(" km"),c=je(),l=pe("p"),d=nt("Borders roads = "),S=nt(y),E=nt(", railway = "),A=nt(C),M=nt(`,
            water = `),N=nt(R)},m(B,O){be(B,e,O),te(e,n),te(e,i),te(e,o),be(B,c,O),be(B,l,O),te(l,d),te(l,S),te(l,E),te(l,A),te(l,M),te(l,N)},p(B,O){O&8192&&r!==(r=B[13].area_km2.toFixed(1)+"")&&Kn(i,r),O&8192&&y!==(y=B[13].touches_big_road+"")&&Kn(S,y),O&8192&&C!==(C=B[13].touches_railway+"")&&Kn(A,C),O&8192&&R!==(R=B[13].touches_waterway+"")&&Kn(N,R)},d(B){B&&(ve(e),ve(c),ve(l))}}}function d8(t){let e,n;return e=new Iu({props:{openOn:"hover",$$slots:{default:[p8,({props:r})=>({13:r}),({props:r})=>r?8192:0]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,i){const o={};i&24576&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function m8(t){let e,n,r,i;const o=[Ti("auto-boundaries-areas"),{filter:t[6](t[0],t[1])},{manageHoverState:!0},{paint:{"fill-color":["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"],"fill-opacity":Uf(.3,.7)}},{hoverCursor:"pointer"}];let c={$$slots:{default:[d8]},$$scope:{ctx:t}};for(let y=0;y<o.length;y+=1)c=gi(c,o[y]);e=new mc({props:c}),e.$on("click",t[4]);const l=[Ti("auto-boundaries-severances"),{filter:Ez},{manageHoverState:!0},{paint:{"line-color":Uf("black","red"),"line-width":3}}];let d={};for(let y=0;y<l.length;y+=1)d=gi(d,l[y]);return r=new Ml({props:d}),{c(){Ve(e.$$.fragment),n=je(),Ve(r.$$.fragment)},m(y,S){Fe(e,y,S),be(y,n,S),Fe(r,y,S),i=!0},p(y,S){const E=S&67?pv(o,[o[0],{filter:y[6](y[0],y[1])},o[2],o[3],o[4]]):{};S&16384&&(E.$$scope={dirty:S,ctx:y}),e.$set(E);const C={};r.$set(C)},i(y){i||(ne(e.$$.fragment,y),ne(r.$$.fragment,y),i=!0)},o(y){de(e.$$.fragment,y),de(r.$$.fragment,y),i=!1},d(y){y&&ve(n),Be(e,y),Be(r,y)}}}function g8(t){let e,n,r;return n=new Fo({props:{data:t[3],generateId:!0,$$slots:{default:[m8]},$$scope:{ctx:t}}}),{c(){e=pe("div"),Ve(n.$$.fragment),Ce(e,"slot","map")},m(i,o){be(i,e,o),Fe(n,e,null),r=!0},p(i,o){const c={};o&16387&&(c.$$scope={dirty:o,ctx:i}),n.$set(c)},i(i){r||(ne(n.$$.fragment,i),r=!0)},o(i){de(n.$$.fragment,i),r=!1},d(i){i&&ve(e),Be(n)}}}function _8(t){let e,n;return e=new Eu({props:{$$slots:{map:[g8],sidebar:[f8],top:[h8]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,[i]){const o={};i&16391&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function y8(t,e,n){let r,i;wt(t,Tn,N=>n(2,r=N)),wt(t,Zi,N=>n(12,i=N));let o=JSON.parse(i.renderAutoBoundaries()),c=0,l=!0;function d(N){let B=window.prompt("What do you want to name the neighbourhood?");if(B)try{let O={type:"Feature",properties:{},geometry:o.features[N.detail.features[0].id].geometry};i.setNeighbourhoodBoundary(B,O),Vf(),i.setCurrentNeighbourhood(B),Ut(Tn,r={mode:"neighbourhood"},r)}catch(O){console.log(O),window.alert("Known georust bug hit, sorry. You may need to just refresh the page now.")}}function y(){d_("auto_boundaries.geojson",JSON.stringify(o,null,"  "))}function S(N,B){let O=["all",Sz,[">=",["get","area_km2"],N]];return B&&O.push(["get","touches_big_road"]),O}const E=()=>Ut(Tn,r={mode:"network"},r);function C(){c=f1(this.value),n(0,c)}function A(){l=this.checked,n(1,l)}return[c,l,r,o,d,y,S,E,C,A,()=>Ut(Tn,r={mode:"title"},r),()=>Ut(Tn,r={mode:"network"},r)]}class v8 extends Qt{constructor(e){super(),Jt(this,e,y8,_8,Ht,{})}}const b8=["==",["geometry-type"],"Polygon"],x8=["==",["geometry-type"],"LineString"],w8=["==",["geometry-type"],"Point"];function UT(){return{type:"FeatureCollection",features:[]}}function uv(t){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:jT(t)}}}function jT(t){return[Math.round(t[0]*1e7)/1e7,Math.round(t[1]*1e7)/1e7]}const GT=Gn(UT()),qT=Gn(0),S8=100;class E8{constructor(e){Ci(this,"map");Ci(this,"active");Ci(this,"eventListenersSuccess");Ci(this,"eventListenersUpdated");Ci(this,"eventListenersFailure");Ci(this,"points");Ci(this,"cursor");Ci(this,"hover");Ci(this,"dragFrom");Ci(this,"previousStates");Ci(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let n=this.dragFrom[0]-e.lngLat.lng,r=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=n,i[1]-=r}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});Ci(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let n=[];if(_E(this.points).forEach((r,i)=>{n.push([i+1,xR(r,this.cursor).properties.dist])}),n.sort((r,i)=>r[1]-i[1]),n.length>0){let r=n[0][0];this.points.splice(r,0,this.cursor.geometry.coordinates),this.hover=r}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});Ci(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=uv(e.lngLat.toArray()),this.onClick(e),this.finish())});Ci(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});Ci(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});Ci(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});Ci(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let n of this.eventListenersSuccess)n(e);else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=UT();this.points.forEach((i,o)=>{let c=uv(i);c.properties.hover=this.hover==o,c.properties.idx=o,e.features.push(c)}),e.features=e.features.concat(_E(this.points));let n=this.polygonFeature();n&&(n.properties.hover=this.hover=="polygon",e.features.push(n)),GT.set(e);let r="crosshair";this.hover!=null&&(r=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=r,qT.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let n of this.eventListenersUpdated)n(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let n of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(n.geometry.type=="Polygon"){this.hover="polygon";break}else if(n.geometry.type=="Point"&&Object.hasOwn(n.properties,"idx")){this.hover=n.properties.idx;break}this.hover==null&&(this.cursor=uv(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(jT),n=[JSON.parse(JSON.stringify(e))];return n[0].push(JSON.parse(JSON.stringify(n[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:n},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>S8&&this.previousStates.shift()}}function _E(t){let e=[];for(let n=0;n<t.length-1;n++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[t[n],t[n+1]]},properties:{}});return t.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[t[t.length-1],t[0]]},properties:{}}),e}function I8(t){let e,n,r;return{c(){e=nt("Undo ("),n=nt(t[1]),r=nt(")")},m(i,o){be(i,e,o),be(i,n,o),be(i,r,o)},p(i,o){o&2&&Kn(n,i[1])},d(i){i&&(ve(e),ve(n),ve(r))}}}function C8(t){let e;return{c(){e=nt("Undo")},m(n,r){be(n,e,r)},p:Mt,d(n){n&&ve(e)}}}function T8(t){let e,n,r,i,o,c,l,d,y,S,E;function C(R,N){return R[1]==0?C8:I8}let A=C(t),M=A(t);return{c(){e=pe("div"),n=pe("button"),n.textContent="Finish",r=je(),i=pe("button"),i.textContent="Cancel",o=je(),c=pe("button"),M.c(),d=je(),y=pe("ul"),y.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,c.disabled=l=t[1]==0,gr(e,"display","flex"),gr(e,"justify-content","space-between")},m(R,N){be(R,e,N),te(e,n),te(e,r),te(e,i),te(e,o),te(e,c),M.m(c,null),be(R,d,N),be(R,y,N),S||(E=[Lt(n,"click",t[2]),Lt(i,"click",t[3]),Lt(c,"click",t[4])],S=!0)},p(R,[N]){A===(A=C(R))&&M?M.p(R,N):(M.d(1),M=A(R),M&&(M.c(),M.m(c,null))),N&2&&l!==(l=R[1]==0)&&(c.disabled=l)},i:Mt,o:Mt,d(R){R&&(ve(e),ve(d),ve(y)),M.d(),S=!1,Hr(E)}}}function L8(t,e,n){let r;wt(t,qT,d=>n(1,r=d));let{polygonTool:i}=e;const o=()=>i.finish(),c=()=>i.cancel(),l=()=>i.undo();return t.$$set=d=>{"polygonTool"in d&&n(0,i=d.polygonTool)},[i,r,o,c,l]}class P8 extends Qt{constructor(e){super(),Jt(this,e,L8,T8,Ht,{polygonTool:0})}}let M8=Date.now();function Am(t){return`${t}-${M8++}`}const WT=Symbol.for("svelte-maplibre");function k8(){return UE(WT)}function yE(t){return{subscribe:t.subscribe}}function HT({key:t,setPopupTarget:e=!1,setCluster:n=!1,setMouseEvent:r=!1}){let i=k8(),o=Gn(null),c=yE(o),l={...i,[t]:yE(o)};if(e&&(l.popupTarget=c),r){let d=Gn(null);l.layerEvent=d,i.layerEvent=d}return n&&(l.cluster=Gn()),p1(WT,l),{...i,self:o}}function A8(){return HT({key:"source",setCluster:!0})}function D8(t=!0){return HT({key:"layer",setPopupTarget:t,setMouseEvent:t})}function vE(t){let e;return n=>{if(n)for(let r in n){let i=e==null?void 0:e[r],o=n[r];i!==o&&t(r,o,i)}else if(e)for(let r in e)t(r,void 0,e[r]);e=n}}function R8(t,...e){let n=[t];for(let r of e)if(r)Array.isArray(r)&&r[0]===t?n.push(...r.slice(1)):n.push(r);else continue;if(n.length!==1)return n.length===2?n[1]:n}function N8(t){return t===!0?["has","point_count"]:t===!1?["!",["has","point_count"]]:void 0}function bE(t){let e=t[0],n,r,i=xE(t);return{c(){i.c(),n=ki()},m(o,c){i.m(o,c),be(o,n,c),r=!0},p(o,c){c[0]&1&&Ht(e,e=o[0])?(Rn(),de(i,1,1,Mt),Nn(),i=xE(o),i.c(),ne(i,1),i.m(n.parentNode,n)):i.p(o,c)},i(o){r||(ne(i),r=!0)},o(o){de(i),r=!1},d(o){o&&ve(n),i.d(o)}}}function xE(t){let e;const n=t[36].default,r=hr(n,t,t[35],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),e=!0},p(i,o){r&&r.p&&(!e||o[1]&16)&&pr(r,n,i,i[35],e?fr(n,i[35],o,null):dr(i[35]),null)},i(i){e||(ne(r,i),e=!0)},o(i){de(r,i),e=!1},d(i){r&&r.d(i)}}}function O8(t){let e,n,r=t[0]&&bE(t);return{c(){r&&r.c(),e=ki()},m(i,o){r&&r.m(i,o),be(i,e,o),n=!0},p(i,o){i[0]?r?(r.p(i,o),o[0]&1&&ne(r,1)):(r=bE(i),r.c(),ne(r,1),r.m(e.parentNode,e)):r&&(Rn(),de(r,1,1,()=>{r=null}),Nn())},i(i){n||(ne(r),n=!0)},o(i){de(r),n=!1},d(i){i&&ve(e),r&&r.d(i)}}}function z8(t,e,n){let r,i,o,c,l,d,y,S,E,C,A,M,{$$slots:R={},$$scope:N}=e,{id:B=Am("layer")}=e,{source:O=void 0}=e,{sourceLayer:G=void 0}=e,{beforeId:U=void 0}=e,{beforeLayerType:Z=void 0}=e,{type:ue}=e,{paint:ae=void 0}=e,{layout:se=void 0}=e,{filter:fe=void 0}=e,{applyToClusters:ke=void 0}=e,{minzoom:K=void 0}=e,{maxzoom:oe=void 0}=e,{manageHoverState:Ge=!1}=e,{hovered:Te=null}=e,{interactive:ot=!0}=e,{hoverCursor:ft=void 0}=e,{eventsIfTopMost:At=!1}=e;const Ke=zl(),{map:Ft,source:bt,self:Rt,minzoom:Ot,maxzoom:ln,eventTopMost:Ln,layerInfo:an}=D8();wt(t,Ft,Le=>n(31,E=Le)),wt(t,bt,Le=>n(32,C=Le)),wt(t,Rt,Le=>n(0,S=Le)),wt(t,Ot,Le=>n(34,M=Le)),wt(t,ln,Le=>n(33,A=Le)),Hi(()=>{S&&E&&(an.delete(S),E==null||E.removeLayer(S))});let Xt;function En(Le){var me,tn;if(!ot||!S||!E||At&&Ln(Le)!==S)return;let rt=Le.features??[],gt=(tn=(me=rt[0])==null?void 0:me.properties)==null?void 0:tn.cluster_id,Nt={event:Le,map:E,clusterId:gt,layer:S,source:l,features:rt};Ke(Le.type,Nt)}function In(Le){var me,tn;if(!ot||!S||!E||At&&Ln(Le)!==S)return;ft&&(E.getCanvas().style.cursor=ft);let rt=Le.features??[];n(6,Te=rt[0]??null);let gt=(tn=(me=rt[0])==null?void 0:me.properties)==null?void 0:tn.cluster_id;Ke("mouseenter",{event:Le,map:E,clusterId:gt,layer:S,source:l,features:rt})}function rr(Le){var me,tn,Xe;if(!ot||!E)return;if(At&&Ln(Le)!==S){n(6,Te=null),Ge&&Xt!==void 0&&(E==null||E.setFeatureState({source:l,sourceLayer:G,id:Xt},{hover:!1}),Xt=void 0);return}E.getCanvas().style.cursor=ft;let rt=Le.features??[],gt=(tn=(me=rt[0])==null?void 0:me.properties)==null?void 0:tn.cluster_id,Nt=(Xe=rt[0])==null?void 0:Xe.id;Nt!==Xt&&(Ge&&(Xt!==void 0&&(E==null||E.setFeatureState({source:l,id:Xt,sourceLayer:G},{hover:!1})),E==null||E.setFeatureState({source:l,id:Nt,sourceLayer:G},{hover:!0})),Xt=Nt,n(6,Te=rt[0]??null)),Ke("mousemove",{event:Le,map:E,clusterId:gt,layer:S,source:l,features:rt})}function mt(Le){if(!(!ot||!S||!E)){if(ft&&(E.getCanvas().style.cursor=""),n(6,Te=null),Ge&&Xt!==void 0){const rt={source:l,id:Xt,sourceLayer:G};E==null||E.setFeatureState(rt,{hover:!1}),Xt=void 0}Ke("mouseleave",{map:E,layer:S,source:l})}}let Dt=!0;function Sn(Le){E&&(E.off("click",Le,En),E.off("dblclick",Le,En),E.off("contextmenu",Le,En),E.off("mouseenter",Le,In),E.off("mousemove",Le,rr),E.off("mouseleave",Le,mt))}return Hi(()=>{E&&S&&Sn(S)}),t.$$set=Le=>{"id"in Le&&n(7,B=Le.id),"source"in Le&&n(8,O=Le.source),"sourceLayer"in Le&&n(9,G=Le.sourceLayer),"beforeId"in Le&&n(10,U=Le.beforeId),"beforeLayerType"in Le&&n(11,Z=Le.beforeLayerType),"type"in Le&&n(12,ue=Le.type),"paint"in Le&&n(13,ae=Le.paint),"layout"in Le&&n(14,se=Le.layout),"filter"in Le&&n(15,fe=Le.filter),"applyToClusters"in Le&&n(16,ke=Le.applyToClusters),"minzoom"in Le&&n(17,K=Le.minzoom),"maxzoom"in Le&&n(18,oe=Le.maxzoom),"manageHoverState"in Le&&n(19,Ge=Le.manageHoverState),"hovered"in Le&&n(6,Te=Le.hovered),"interactive"in Le&&n(20,ot=Le.interactive),"hoverCursor"in Le&&n(21,ft=Le.hoverCursor),"eventsIfTopMost"in Le&&n(22,At=Le.eventsIfTopMost),"$$scope"in Le&&n(35,N=Le.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&65536&&n(30,r=N8(ke)),t.$$.dirty[0]&1073774592&&n(24,i=R8("all",r,fe)),t.$$.dirty[0]&131072|t.$$.dirty[1]&8&&n(26,o=K??M),t.$$.dirty[0]&262144|t.$$.dirty[1]&4&&n(25,c=oe??A),t.$$.dirty[0]&256|t.$$.dirty[1]&2&&n(29,l=O||C),t.$$.dirty[0]&654343809|t.$$.dirty[1]&1&&E&&S!==B&&l){S&&(Sn(S),an.delete(S));let Le=U;if(!U&&Z){let rt=E.getStyle().layers,gt=typeof Z=="function"?Z:me=>me.type===Z,Nt=rt==null?void 0:rt.find(gt);Nt&&(Le=Nt.id)}Ut(Rt,S=B,S),E.addLayer(Kc({id:S,type:ue,source:l,"source-layer":G,filter:i,paint:ae,layout:se,minzoom:o,maxzoom:c}),Le),n(23,Dt=!0),E.on("click",S,En),E.on("dblclick",S,En),E.on("contextmenu",S,En),E.on("mouseenter",S,In),E.on("mousemove",S,rr),E.on("mouseleave",S,mt)}t.$$.dirty[0]&1048577&&S&&an.set(S,{interactive:ot}),t.$$.dirty[0]&1|t.$$.dirty[1]&1&&n(28,d=S?vE((Le,rt)=>E==null?void 0:E.setPaintProperty(S,Le,rt)):void 0),t.$$.dirty[0]&1|t.$$.dirty[1]&1&&n(27,y=S?vE((Le,rt)=>E==null?void 0:E.setLayoutProperty(S,Le,rt)):void 0),t.$$.dirty[0]&268443648&&(d==null||d(ae)),t.$$.dirty[0]&134234112&&(y==null||y(se)),t.$$.dirty[0]&100663297|t.$$.dirty[1]&1&&S&&(E==null||E.setLayerZoomRange(S,o,c)),t.$$.dirty[0]&25165825|t.$$.dirty[1]&1&&S&&(Dt?n(23,Dt=!1):E==null||E.setFilter(S,i))},[S,Ft,bt,Rt,Ot,ln,Te,B,O,G,U,Z,ue,ae,se,fe,ke,K,oe,Ge,ot,ft,At,Dt,i,c,o,y,d,l,r,E,C,A,M,N,R]}class gb extends Qt{constructor(e){super(),Jt(this,e,z8,O8,Ht,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function F8(t){let e;const n=t[16].default,r=hr(n,t,t[24],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),e=!0},p(i,o){r&&r.p&&(!e||o&16777216)&&pr(r,n,i,i[24],e?fr(n,i[24],o,null):dr(i[24]),null)},i(i){e||(ne(r,i),e=!0)},o(i){de(r,i),e=!1},d(i){r&&r.d(i)}}}function B8(t){let e,n,r;function i(c){t[17](c)}let o={id:t[1],type:"circle",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[F8]},$$scope:{ctx:t}};return t[0]!==void 0&&(o.hovered=t[0]),e=new gb({props:o}),Gr.push(()=>xa(e,"hovered",i)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){Ve(e.$$.fragment)},m(c,l){Fe(e,c,l),r=!0},p(c,[l]){const d={};l&2&&(d.id=c[1]),l&4&&(d.source=c[2]),l&8&&(d.sourceLayer=c[3]),l&16&&(d.beforeId=c[4]),l&32&&(d.beforeLayerType=c[5]),l&64&&(d.paint=c[6]),l&128&&(d.layout=c[7]),l&256&&(d.filter=c[8]),l&512&&(d.applyToClusters=c[9]),l&1024&&(d.minzoom=c[10]),l&2048&&(d.maxzoom=c[11]),l&4096&&(d.hoverCursor=c[12]),l&8192&&(d.manageHoverState=c[13]),l&16384&&(d.eventsIfTopMost=c[14]),l&32768&&(d.interactive=c[15]),l&16777216&&(d.$$scope={dirty:l,ctx:c}),!n&&l&1&&(n=!0,d.hovered=c[0],ba(()=>n=!1)),e.$set(d)},i(c){r||(ne(e.$$.fragment,c),r=!0)},o(c){de(e.$$.fragment,c),r=!1},d(c){Be(e,c)}}}function V8(t,e,n){let{$$slots:r={},$$scope:i}=e,{id:o=Am("circle")}=e,{source:c=void 0}=e,{sourceLayer:l=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:y=void 0}=e,{paint:S}=e,{layout:E=void 0}=e,{filter:C=void 0}=e,{applyToClusters:A=void 0}=e,{minzoom:M=void 0}=e,{maxzoom:R=void 0}=e,{hoverCursor:N=void 0}=e,{manageHoverState:B=!1}=e,{hovered:O=null}=e,{eventsIfTopMost:G=!1}=e,{interactive:U=!0}=e;function Z(oe){O=oe,n(0,O)}function ue(oe){xn.call(this,t,oe)}function ae(oe){xn.call(this,t,oe)}function se(oe){xn.call(this,t,oe)}function fe(oe){xn.call(this,t,oe)}function ke(oe){xn.call(this,t,oe)}function K(oe){xn.call(this,t,oe)}return t.$$set=oe=>{"id"in oe&&n(1,o=oe.id),"source"in oe&&n(2,c=oe.source),"sourceLayer"in oe&&n(3,l=oe.sourceLayer),"beforeId"in oe&&n(4,d=oe.beforeId),"beforeLayerType"in oe&&n(5,y=oe.beforeLayerType),"paint"in oe&&n(6,S=oe.paint),"layout"in oe&&n(7,E=oe.layout),"filter"in oe&&n(8,C=oe.filter),"applyToClusters"in oe&&n(9,A=oe.applyToClusters),"minzoom"in oe&&n(10,M=oe.minzoom),"maxzoom"in oe&&n(11,R=oe.maxzoom),"hoverCursor"in oe&&n(12,N=oe.hoverCursor),"manageHoverState"in oe&&n(13,B=oe.manageHoverState),"hovered"in oe&&n(0,O=oe.hovered),"eventsIfTopMost"in oe&&n(14,G=oe.eventsIfTopMost),"interactive"in oe&&n(15,U=oe.interactive),"$$scope"in oe&&n(24,i=oe.$$scope)},[O,o,c,l,d,y,S,E,C,A,M,R,N,B,G,U,r,Z,ue,ae,se,fe,ke,K,i]}class U8 extends Qt{constructor(e){super(),Jt(this,e,V8,B8,Ht,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function j8(t){let e;const n=t[15].default,r=hr(n,t,t[23],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),e=!0},p(i,o){r&&r.p&&(!e||o&8388608)&&pr(r,n,i,i[23],e?fr(n,i[23],o,null):dr(i[23]),null)},i(i){e||(ne(r,i),e=!0)},o(i){de(r,i),e=!1},d(i){r&&r.d(i)}}}function G8(t){let e,n,r;function i(c){t[16](c)}let o={id:t[1],type:"fill",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],minzoom:t[9],maxzoom:t[10],hoverCursor:t[11],manageHoverState:t[12],eventsIfTopMost:t[13],interactive:t[14],$$slots:{default:[j8]},$$scope:{ctx:t}};return t[0]!==void 0&&(o.hovered=t[0]),e=new gb({props:o}),Gr.push(()=>xa(e,"hovered",i)),e.$on("click",t[17]),e.$on("dblclick",t[18]),e.$on("contextmenu",t[19]),e.$on("mouseenter",t[20]),e.$on("mousemove",t[21]),e.$on("mouseleave",t[22]),{c(){Ve(e.$$.fragment)},m(c,l){Fe(e,c,l),r=!0},p(c,[l]){const d={};l&2&&(d.id=c[1]),l&4&&(d.source=c[2]),l&8&&(d.sourceLayer=c[3]),l&16&&(d.beforeId=c[4]),l&32&&(d.beforeLayerType=c[5]),l&64&&(d.paint=c[6]),l&128&&(d.layout=c[7]),l&256&&(d.filter=c[8]),l&512&&(d.minzoom=c[9]),l&1024&&(d.maxzoom=c[10]),l&2048&&(d.hoverCursor=c[11]),l&4096&&(d.manageHoverState=c[12]),l&8192&&(d.eventsIfTopMost=c[13]),l&16384&&(d.interactive=c[14]),l&8388608&&(d.$$scope={dirty:l,ctx:c}),!n&&l&1&&(n=!0,d.hovered=c[0],ba(()=>n=!1)),e.$set(d)},i(c){r||(ne(e.$$.fragment,c),r=!0)},o(c){de(e.$$.fragment,c),r=!1},d(c){Be(e,c)}}}function q8(t,e,n){let{$$slots:r={},$$scope:i}=e,{id:o=Am("fill")}=e,{source:c=void 0}=e,{sourceLayer:l=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:y=void 0}=e,{paint:S}=e,{layout:E=void 0}=e,{filter:C=void 0}=e,{minzoom:A=void 0}=e,{maxzoom:M=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:N=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:G=!0}=e;function U(K){B=K,n(0,B)}function Z(K){xn.call(this,t,K)}function ue(K){xn.call(this,t,K)}function ae(K){xn.call(this,t,K)}function se(K){xn.call(this,t,K)}function fe(K){xn.call(this,t,K)}function ke(K){xn.call(this,t,K)}return t.$$set=K=>{"id"in K&&n(1,o=K.id),"source"in K&&n(2,c=K.source),"sourceLayer"in K&&n(3,l=K.sourceLayer),"beforeId"in K&&n(4,d=K.beforeId),"beforeLayerType"in K&&n(5,y=K.beforeLayerType),"paint"in K&&n(6,S=K.paint),"layout"in K&&n(7,E=K.layout),"filter"in K&&n(8,C=K.filter),"minzoom"in K&&n(9,A=K.minzoom),"maxzoom"in K&&n(10,M=K.maxzoom),"hoverCursor"in K&&n(11,R=K.hoverCursor),"manageHoverState"in K&&n(12,N=K.manageHoverState),"hovered"in K&&n(0,B=K.hovered),"eventsIfTopMost"in K&&n(13,O=K.eventsIfTopMost),"interactive"in K&&n(14,G=K.interactive),"$$scope"in K&&n(23,i=K.$$scope)},[B,o,c,l,d,y,S,E,C,A,M,R,N,O,G,r,U,Z,ue,ae,se,fe,ke,i]}class W8 extends Qt{constructor(e){super(),Jt(this,e,q8,G8,Ht,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function H8(t,e,n,r,i){let o=!1;t.getSource(e)&&(o=!0,t.removeSource(e));const c=()=>{r(e)&&(t.addSource(e,n),i())};if(o){const l=()=>{e&&(t.getSource(e)?setTimeout(l,1):c())};l()}else c()}function Z8(t,e,n){qE().then(()=>{let r=rs(t);if(!r)return;r.getSource(e)===n&&r.removeSource(e)})}function wE(t){let e=t[0],n,r,i=SE(t);return{c(){i.c(),n=ki()},m(o,c){i.m(o,c),be(o,n,c),r=!0},p(o,c){c&1&&Ht(e,e=o[0])?(Rn(),de(i,1,1,Mt),Nn(),i=SE(o),i.c(),ne(i,1),i.m(n.parentNode,n)):i.p(o,c)},i(o){r||(ne(i),r=!0)},o(o){de(i),r=!1},d(o){o&&ve(n),i.d(o)}}}function SE(t){let e;const n=t[15].default,r=hr(n,t,t[14],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),e=!0},p(i,o){r&&r.p&&(!e||o&16384)&&pr(r,n,i,i[14],e?fr(n,i[14],o,null):dr(i[14]),null)},i(i){e||(ne(r,i),e=!0)},o(i){de(r,i),e=!1},d(i){r&&r.d(i)}}}function X8(t){let e,n,r=t[0]&&wE(t);return{c(){r&&r.c(),e=ki()},m(i,o){r&&r.m(i,o),be(i,e,o),n=!0},p(i,[o]){i[0]?r?(r.p(i,o),o&1&&ne(r,1)):(r=wE(i),r.c(),ne(r,1),r.m(e.parentNode,e)):r&&(Rn(),de(r,1,1,()=>{r=null}),Nn())},i(i){n||(ne(r),n=!0)},o(i){de(r),n=!1},d(i){i&&ve(e),r&&r.d(i)}}}function Y8(t,e,n){let r,i,o,{$$slots:c={},$$scope:l}=e,{id:d=Am("geojson")}=e,{data:y}=e,{generateId:S=!1}=e,{promoteId:E=void 0}=e,{filter:C=void 0}=e,{lineMetrics:A=void 0}=e,{cluster:M=void 0}=e;const{map:R,cluster:N,self:B}=A8();wt(t,R,U=>n(13,i=U)),wt(t,N,U=>n(16,o=U)),wt(t,B,U=>n(0,r=U));let O,G=!0;return Hi(()=>{r&&O&&i&&(Z8(R,r,O),Ut(B,r=null,r),n(11,O=void 0))}),t.$$set=U=>{"id"in U&&n(4,d=U.id),"data"in U&&n(5,y=U.data),"generateId"in U&&n(6,S=U.generateId),"promoteId"in U&&n(7,E=U.promoteId),"filter"in U&&n(8,C=U.filter),"lineMetrics"in U&&n(9,A=U.lineMetrics),"cluster"in U&&n(10,M=U.cluster),"$$scope"in U&&n(14,l=U.$$scope)},t.$$.update=()=>{t.$$.dirty&1024&&Ut(N,o=M,o),t.$$.dirty&12273&&i&&r!==d&&(Ut(B,r=d,r),H8(i,r,Kc({type:"geojson",data:y,filter:C,lineMetrics:A,generateId:S,promoteId:E,cluster:!!M,clusterMinPoints:M==null?void 0:M.minPoints,clusterMaxZoom:M==null?void 0:M.maxZoom,clusterRadius:M==null?void 0:M.radius,clusterProperties:M==null?void 0:M.properties}),U=>i&&U===r,()=>{r&&(n(11,O=i==null?void 0:i.getSource(r)),n(12,G=!0))})),t.$$.dirty&8208&&(i==null||i.on("style.load",()=>{n(11,O=i==null?void 0:i.getSource(d))})),t.$$.dirty&6176&&O&&(G?n(12,G=!1):O.setData(y)),t.$$.dirty&3072&&(O==null||O.setClusterOptions(Kc({cluster:!!M,clusterMaxZoom:M==null?void 0:M.maxZoom,clusterRadius:M==null?void 0:M.radius})))},[r,R,N,B,d,y,S,E,C,A,M,O,G,i,l,c]}class $8 extends Qt{constructor(e){super(),Jt(this,e,Y8,X8,Ht,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function K8(t){let e;const n=t[15].default,r=hr(n,t,t[23],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),e=!0},p(i,o){r&&r.p&&(!e||o&8388608)&&pr(r,n,i,i[23],e?fr(n,i[23],o,null):dr(i[23]),null)},i(i){e||(ne(r,i),e=!0)},o(i){de(r,i),e=!1},d(i){r&&r.d(i)}}}function J8(t){let e,n,r;function i(c){t[16](c)}let o={id:t[1],type:"line",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],minzoom:t[9],maxzoom:t[10],hoverCursor:t[11],manageHoverState:t[12],eventsIfTopMost:t[13],interactive:t[14],$$slots:{default:[K8]},$$scope:{ctx:t}};return t[0]!==void 0&&(o.hovered=t[0]),e=new gb({props:o}),Gr.push(()=>xa(e,"hovered",i)),e.$on("click",t[17]),e.$on("dblclick",t[18]),e.$on("contextmenu",t[19]),e.$on("mouseenter",t[20]),e.$on("mousemove",t[21]),e.$on("mouseleave",t[22]),{c(){Ve(e.$$.fragment)},m(c,l){Fe(e,c,l),r=!0},p(c,[l]){const d={};l&2&&(d.id=c[1]),l&4&&(d.source=c[2]),l&8&&(d.sourceLayer=c[3]),l&16&&(d.beforeId=c[4]),l&32&&(d.beforeLayerType=c[5]),l&64&&(d.paint=c[6]),l&128&&(d.layout=c[7]),l&256&&(d.filter=c[8]),l&512&&(d.minzoom=c[9]),l&1024&&(d.maxzoom=c[10]),l&2048&&(d.hoverCursor=c[11]),l&4096&&(d.manageHoverState=c[12]),l&8192&&(d.eventsIfTopMost=c[13]),l&16384&&(d.interactive=c[14]),l&8388608&&(d.$$scope={dirty:l,ctx:c}),!n&&l&1&&(n=!0,d.hovered=c[0],ba(()=>n=!1)),e.$set(d)},i(c){r||(ne(e.$$.fragment,c),r=!0)},o(c){de(e.$$.fragment,c),r=!1},d(c){Be(e,c)}}}function Q8(t,e,n){let{$$slots:r={},$$scope:i}=e,{id:o=Am("line")}=e,{source:c=void 0}=e,{sourceLayer:l=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:y=void 0}=e,{paint:S}=e,{layout:E=void 0}=e,{filter:C=void 0}=e,{minzoom:A=void 0}=e,{maxzoom:M=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:N=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:G=!0}=e;function U(K){B=K,n(0,B)}function Z(K){xn.call(this,t,K)}function ue(K){xn.call(this,t,K)}function ae(K){xn.call(this,t,K)}function se(K){xn.call(this,t,K)}function fe(K){xn.call(this,t,K)}function ke(K){xn.call(this,t,K)}return t.$$set=K=>{"id"in K&&n(1,o=K.id),"source"in K&&n(2,c=K.source),"sourceLayer"in K&&n(3,l=K.sourceLayer),"beforeId"in K&&n(4,d=K.beforeId),"beforeLayerType"in K&&n(5,y=K.beforeLayerType),"paint"in K&&n(6,S=K.paint),"layout"in K&&n(7,E=K.layout),"filter"in K&&n(8,C=K.filter),"minzoom"in K&&n(9,A=K.minzoom),"maxzoom"in K&&n(10,M=K.maxzoom),"hoverCursor"in K&&n(11,R=K.hoverCursor),"manageHoverState"in K&&n(12,N=K.manageHoverState),"hovered"in K&&n(0,B=K.hovered),"eventsIfTopMost"in K&&n(13,O=K.eventsIfTopMost),"interactive"in K&&n(14,G=K.interactive),"$$scope"in K&&n(23,i=K.$$scope)},[B,o,c,l,d,y,S,E,C,A,M,R,N,O,G,r,U,Z,ue,ae,se,fe,ke,i]}class e7 extends Qt{constructor(e){super(),Jt(this,e,Q8,J8,Ht,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function t7(t){let e,n,r,i,o,c;return e=new W8({props:{id:"edit-polygon-fill",filter:b8,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),r=new e7({props:{id:"edit-polygon-lines",filter:x8,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),o=new U8({props:{id:"edit-polygon-vertices",filter:w8,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){Ve(e.$$.fragment),n=je(),Ve(r.$$.fragment),i=je(),Ve(o.$$.fragment)},m(l,d){Fe(e,l,d),be(l,n,d),Fe(r,l,d),be(l,i,d),Fe(o,l,d),c=!0},p:Mt,i(l){c||(ne(e.$$.fragment,l),ne(r.$$.fragment,l),ne(o.$$.fragment,l),c=!0)},o(l){de(e.$$.fragment,l),de(r.$$.fragment,l),de(o.$$.fragment,l),c=!1},d(l){l&&(ve(n),ve(i)),Be(e,l),Be(r,l),Be(o,l)}}}function n7(t){let e,n;return e=new $8({props:{data:t[0],$$slots:{default:[t7]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,[i]){const o={};i&1&&(o.data=r[0]),i&2&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function r7(t,e,n){let r;return wt(t,GT,i=>n(0,r=i)),[r]}class i7 extends Qt{constructor(e){super(),Jt(this,e,r7,n7,Ht,{})}}function o7(t){let e,n,r,i,o,c,l;return{c(){e=pe("button"),e.textContent="Import current view",n=je(),r=pe("i"),r.textContent="or...",i=je(),o=pe("button"),o.textContent="Draw an area to import on the map",Ce(e,"type","button"),Ce(o,"type","button")},m(d,y){be(d,e,y),be(d,n,y),be(d,r,y),be(d,i,y),be(d,o,y),c||(l=[Lt(e,"click",t[2]),Lt(o,"click",t[3])],c=!0)},p:Mt,i:Mt,o:Mt,d(d){d&&(ve(e),ve(n),ve(r),ve(i),ve(o)),c=!1,Hr(l)}}}function s7(t){let e,n;return e=new P8({props:{polygonTool:t[0]}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,i){const o={};i&1&&(o.polygonTool=r[0]),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function a7(t){let e,n,r,i,o,c,l,d,y;const S=[s7,o7],E=[];function C(A,M){return A[0]?0:1}return e=C(t),n=E[e]=S[e](t),{c(){n.c(),r=je(),i=pe("label"),o=pe("input"),c=nt(`Save a copy of the osm.xml
  after importing`),Ce(o,"type","checkbox")},m(A,M){E[e].m(A,M),be(A,r,M),be(A,i,M),te(i,o),o.checked=t[1],te(i,c),l=!0,d||(y=Lt(o,"change",t[5]),d=!0)},p(A,[M]){let R=e;e=C(A),e===R?E[e].p(A,M):(Rn(),de(E[R],1,1,()=>{E[R]=null}),Nn(),n=E[e],n?n.p(A,M):(n=E[e]=S[e](A),n.c()),ne(n,1),n.m(r.parentNode,r)),M&2&&(o.checked=A[1])},i(A){l||(ne(n),l=!0)},o(A){de(n),l=!1},d(A){A&&(ve(r),ve(i)),E[e].d(A),d=!1,y()}}}function Md(t){return[t.lng,t.lat]}function l7(t,e,n){let{map:r}=e;const i=zl();let o=null,c=!1;async function l(C){try{i("loading","Loading from Overpass");let M=await(await fetch(ZT(C))).text();c&&d_("osm.xml",M),i("gotXml",{xml:M,boundary:C})}catch(A){i("error",A.toString())}}function d(){let C=r.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[Md(C.getSouthWest()),Md(C.getNorthWest()),Md(C.getNorthEast()),Md(C.getSouthEast()),Md(C.getSouthWest())]],type:"Polygon"}}}async function y(){if(r){if(r.getZoom()<13){i("error","Zoom in more to import");return}await l(d())}}function S(){r&&(n(0,o=new E8(r)),o.startNew(),o.addEventListenerSuccess(async C=>{n(0,o=null),await l(C)}),o.addEventListenerFailure(()=>{n(0,o=null)}))}function E(){c=this.checked,n(1,c)}return t.$$set=C=>{"map"in C&&n(4,r=C.map)},[o,c,y,S,r,E]}class u7 extends Qt{constructor(e){super(),Jt(this,e,l7,a7,Ht,{map:4})}}function ZT(t){let e='poly:"';for(let[r,i]of t.geometry.coordinates[0])e+=`${i} ${r} `;return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}async function c1(t){nc.set(t);try{let e=JSON.parse(window.localStorage.getItem(t));console.time("get OSM input");let[n,r]=await c7(e);console.timeEnd("get OSM input"),console.time("load"),Zi.set(new YE(new Uint8Array(n),r,e.study_area_name||void 0)),rs(Zi).loadSavefile(e),console.timeEnd("load"),XT()}catch(e){window.alert(`Couldn't open project: ${e}`),nc.set("")}}async function c7(t){if(t.study_area_name){let e=rs(nm)?`/osm/${t.study_area_name}.pbf`:`https://assets.od2net.org/severance_pbfs/${t.study_area_name}.pbf`;console.log(`Grabbing ${e}`);let r=await(await fetch(e)).arrayBuffer(),i=rs(nm)?`/boundaries/${t.study_area_name}.geojson`:`https://assets.od2net.org/boundaries/${t.study_area_name}.geojson`,c=await(await fetch(i)).json();return[r,c]}else{console.log("Grabbing from Overpass");let e=t.features.find(i=>i.properties.kind=="study_area_boundary");return[await(await fetch(ZT(e))).arrayBuffer(),e]}}function XT(){Tn.set({mode:"network"}),fp.set(new SR(rs(Pl),rs(Zi).toRouteSnapper(),Gn(c_()),Gn(!0),Gn(0))),rs(Pl).fitBounds(Array.from(rs(Zi).getBounds()),{animate:!1}),Vv.set(EE()),Uv.set(EE())}function EE(){let t=rs(Zi).getBounds(),e=t[0]+Math.random()*(t[2]-t[0]),n=t[1]+Math.random()*(t[3]-t[1]);return new Q_.LngLat(e,n)}function IE(t,e,n){const r=t.slice();return r[18]=e[n][0],r[19]=e[n][1],r}function CE(t,e,n){const r=t.slice();return r[22]=e[n],r}function h7(t){let e;return{c(){e=pe("div"),e.innerHTML='<nav aria-label="breadcrumb"><ul><li>Choose project</li></ul></nav>',Ce(e,"slot","top")},m(n,r){be(n,e,r)},p:Mt,d(n){n&&ve(e)}}}function f7(t){let e;return{c(){e=pe("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(n,r){be(n,e,r)},p:Mt,i:Mt,o:Mt,d(n){n&&ve(e)}}}function p7(t){let e,n,r,i,o,c,l,d,y,S,E,C,A;n=new mr({props:{$$slots:{default:[d7]},$$scope:{ctx:t}}}),n.$on("click",t[10]);let M=Oi(t[2].entries()),R=[];for(let B=0;B<M.length;B+=1)R[B]=LE(IE(t,M,B));const N=B=>de(R[B],1,1,()=>{R[B]=null});return{c(){e=pe("div"),Ve(n.$$.fragment),r=je(),i=pe("p"),i.textContent="Load a saved project:",o=je(),c=pe("ul");for(let B=0;B<R.length;B+=1)R[B].c();l=je(),d=pe("label"),y=nt(`Load a project from a file
        `),S=pe("input"),Ce(S,"type","file")},m(B,O){be(B,e,O),Fe(n,e,null),be(B,r,O),be(B,i,O),be(B,o,O),be(B,c,O);for(let G=0;G<R.length;G+=1)R[G]&&R[G].m(c,null);be(B,l,O),be(B,d,O),te(d,y),te(d,S),t[14](S),E=!0,C||(A=Lt(S,"change",t[6]),C=!0)},p(B,O){const G={};if(O&33554432&&(G.$$scope={dirty:O,ctx:B}),n.$set(G),O&900){M=Oi(B[2].entries());let U;for(U=0;U<M.length;U+=1){const Z=IE(B,M,U);R[U]?(R[U].p(Z,O),ne(R[U],1)):(R[U]=LE(Z),R[U].c(),ne(R[U],1),R[U].m(c,null))}for(Rn(),U=M.length;U<R.length;U+=1)N(U);Nn()}},i(B){if(!E){ne(n.$$.fragment,B);for(let O=0;O<M.length;O+=1)ne(R[O]);E=!0}},o(B){de(n.$$.fragment,B),R=R.filter(Boolean);for(let O=0;O<R.length;O+=1)de(R[O]);E=!1},d(B){B&&(ve(e),ve(r),ve(i),ve(o),ve(c),ve(l),ve(d)),Be(n),du(R,B),t[14](null),C=!1,A()}}}function d7(t){let e;return{c(){e=nt("New project")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function m7(t){let e=t[22].slice(4)+"",n;return{c(){n=nt(e)},m(r,i){be(r,n,i)},p(r,i){i&4&&e!==(e=r[22].slice(4)+"")&&Kn(n,e)},d(r){r&&ve(n)}}}function TE(t){let e,n,r,i,o,c,l,d,y,S,E;function C(){return t[11](t[22])}r=new mr({props:{$$slots:{default:[m7]},$$scope:{ctx:t}}}),r.$on("click",C);function A(){return t[12](t[22])}function M(){return t[13](t[22])}return{c(){e=pe("li"),n=pe("span"),Ve(r.$$.fragment),i=je(),o=pe("button"),o.innerHTML=`<img src="${BT}" alt="Rename project"/>`,c=je(),l=pe("button"),l.innerHTML=`<img src="${FT}" alt="Delete project"/>`,d=je(),Ce(o,"class","secondary"),Ce(l,"class","secondary"),gr(n,"display","flex"),gr(n,"justify-content","space-between")},m(R,N){be(R,e,N),te(e,n),Fe(r,n,null),te(n,i),te(n,o),te(n,c),te(n,l),te(e,d),y=!0,S||(E=[Lt(o,"click",A),Lt(l,"click",M)],S=!0)},p(R,N){t=R;const B={};N&33554436&&(B.$$scope={dirty:N,ctx:t}),r.$set(B)},i(R){y||(ne(r.$$.fragment,R),y=!0)},o(R){de(r.$$.fragment,R),y=!1},d(R){R&&ve(e),Be(r),S=!1,Hr(E)}}}function LE(t){let e,n=(t[18]??"custom area")+"",r,i,o,c,l=Oi(t[19]),d=[];for(let S=0;S<l.length;S+=1)d[S]=TE(CE(t,l,S));const y=S=>de(d[S],1,1,()=>{d[S]=null});return{c(){e=pe("u"),r=nt(n),i=je();for(let S=0;S<d.length;S+=1)d[S].c();o=ki()},m(S,E){be(S,e,E),te(e,r),be(S,i,E);for(let C=0;C<d.length;C+=1)d[C]&&d[C].m(S,E);be(S,o,E),c=!0},p(S,E){if((!c||E&4)&&n!==(n=(S[18]??"custom area")+"")&&Kn(r,n),E&900){l=Oi(S[19]);let C;for(C=0;C<l.length;C+=1){const A=CE(S,l,C);d[C]?(d[C].p(A,E),ne(d[C],1)):(d[C]=TE(A),d[C].c(),ne(d[C],1),d[C].m(o.parentNode,o))}for(Rn(),C=l.length;C<d.length;C+=1)y(C);Nn()}},i(S){if(!c){for(let E=0;E<l.length;E+=1)ne(d[E]);c=!0}},o(S){d=d.filter(Boolean);for(let E=0;E<d.length;E+=1)de(d[E]);c=!1},d(S){S&&(ve(e),ve(i),ve(o)),du(d,S)}}}function g7(t){let e,n,r,i;const o=[p7,f7],c=[];function l(d,y){return d[4]&&d[0]?0:1}return n=l(t),r=c[n]=o[n](t),{c(){e=pe("div"),r.c(),Ce(e,"slot","sidebar")},m(d,y){be(d,e,y),c[n].m(e,null),i=!0},p(d,y){let S=n;n=l(d),n===S?c[n].p(d,y):(Rn(),de(c[S],1,1,()=>{c[S]=null}),Nn(),r=c[n],r?r.p(d,y):(r=c[n]=o[n](d),r.c()),ne(r,1),r.m(e,null))},i(d){i||(ne(r),i=!0)},o(d){de(r),i=!1},d(d){d&&ve(e),c[n].d()}}}function _7(t){let e,n,r,i;return e=new HE({props:{loading:t[1]}}),r=new Eu({props:{$$slots:{sidebar:[g7],top:[h7]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment),n=je(),Ve(r.$$.fragment)},m(o,c){Fe(e,o,c),be(o,n,c),Fe(r,o,c),i=!0},p(o,[c]){const l={};c&2&&(l.loading=o[1]),e.$set(l);const d={};c&33554493&&(d.$$scope={dirty:c,ctx:o}),r.$set(d)},i(o){i||(ne(e.$$.fragment,o),ne(r.$$.fragment,o),i=!0)},o(o){de(e.$$.fragment,o),de(r.$$.fragment,o),i=!1},d(o){o&&ve(n),Be(e,o),Be(r,o)}}}function $g(){let t=new Map;for(let e=0;e<window.localStorage.length;e++){let n=window.localStorage.key(e);if(n.startsWith("ltn_")){let r="";try{r=JSON.parse(window.localStorage.getItem(n)).study_area_name}catch{}t.has(r)||t.set(r,[]),t.get(r).push(n)}}return t}function y7(t,e,n){let r,i,o,c,l;wt(t,nc,Z=>n(15,r=Z)),wt(t,fp,Z=>n(16,i=Z)),wt(t,Zi,Z=>n(17,o=Z)),wt(t,Pl,Z=>n(4,c=Z)),wt(t,Tn,Z=>n(5,l=Z));let{wasmReady:d}=e,y="";Ut(Zi,o=null,o),Ut(fp,i=null,i),Ut(nc,r="",r);let S=$g(),E;async function C(Z){let ue="ltn_"+E.files[0].name;n(1,y=`Loading from file ${ue}`),window.localStorage.setItem(ue,await E.files[0].text()),n(2,S=$g()),await c1(ue),n(1,y="")}function A(Z){window.confirm(`Really delete project ${Z}? You can't undo this.`)&&(window.localStorage.removeItem(Z),n(2,S=$g()))}function M(Z){let ue=window.prompt(`Rename project ${Z} to what?`,Z);if(ue){ue.startsWith("ltn_")||(ue=`ltn_${ue}`);let ae=window.localStorage.getItem(Z);window.localStorage.setItem(ue,ae),window.localStorage.removeItem(Z),n(2,S=$g())}}async function R(Z){n(1,y=`Loading project ${Z}`),await c1(Z),n(1,y="")}const N=()=>Ut(Tn,l={mode:"new-project"},l),B=Z=>R(Z),O=Z=>M(Z),G=Z=>A(Z);function U(Z){Gr[Z?"unshift":"push"](()=>{E=Z,n(3,E)})}return t.$$set=Z=>{"wasmReady"in Z&&n(0,d=Z.wasmReady)},[d,y,S,E,c,l,C,A,M,R,N,B,O,G,U]}class v7 extends Qt{constructor(e){super(),Jt(this,e,y7,_7,Ht,{wasmReady:0})}}function PE(t,e,n){const r=t.slice();return r[17]=e[n][0],r[18]=e[n][1],r}function ME(t,e,n){const r=t.slice();return r[21]=e[n][0],r[22]=e[n][1],r}function b7(t){let e;return{c(){e=nt("Choose project")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function x7(t){let e,n,r,i,o,c,l,d;return o=new mr({props:{$$slots:{default:[b7]},$$scope:{ctx:t}}}),o.$on("click",t[13]),{c(){e=pe("div"),n=pe("nav"),r=pe("ul"),i=pe("li"),Ve(o.$$.fragment),c=je(),l=pe("li"),l.textContent="New project",Ce(n,"aria-label","breadcrumb"),Ce(e,"slot","top")},m(y,S){be(y,e,S),te(e,n),te(n,r),te(r,i),Fe(o,i,null),te(r,c),te(r,l),d=!0},p(y,S){const E={};S&33554432&&(E.$$scope={dirty:S,ctx:y}),o.$set(E)},i(y){d||(ne(o.$$.fragment,y),d=!0)},o(y){de(o.$$.fragment,y),d=!1},d(y){y&&ve(e),Be(o)}}}function kE(t){let e,n,r,i,o,c,l,d,y,S,E,C,A,M;e=new HE({props:{loading:t[4]}});let R=Oi(t[3]),N=[];for(let B=0;B<R.length;B+=1)N[B]=DE(PE(t,R,B));return E=new u7({props:{map:t[5]}}),E.$on("gotXml",t[7]),E.$on("loading",t[11]),E.$on("error",t[12]),{c(){Ve(e.$$.fragment),n=je(),r=pe("label"),i=nt(`Load a built-in area:
        `),o=pe("select"),c=pe("option");for(let B=0;B<N.length;B+=1)N[B].c();l=je(),d=pe("i"),d.textContent="or...",y=je(),S=pe("div"),Ve(E.$$.fragment),c.__value="",qi(c,c.__value),t[2]===void 0&&Jd(()=>t[9].call(o))},m(B,O){Fe(e,B,O),be(B,n,O),be(B,r,O),te(r,i),te(r,o),te(o,c);for(let G=0;G<N.length;G+=1)N[G]&&N[G].m(o,null);p_(o,t[2],!0),be(B,l,O),be(B,d,O),be(B,y,O),be(B,S,O),Fe(E,S,null),C=!0,A||(M=[Lt(o,"change",t[9]),Lt(o,"change",t[10])],A=!0)},p(B,O){const G={};if(O&16&&(G.loading=B[4]),e.$set(G),O&8){R=Oi(B[3]);let Z;for(Z=0;Z<R.length;Z+=1){const ue=PE(B,R,Z);N[Z]?N[Z].p(ue,O):(N[Z]=DE(ue),N[Z].c(),N[Z].m(o,null))}for(;Z<N.length;Z+=1)N[Z].d(1);N.length=R.length}O&12&&p_(o,B[2]);const U={};O&32&&(U.map=B[5]),E.$set(U)},i(B){C||(ne(e.$$.fragment,B),ne(E.$$.fragment,B),C=!0)},o(B){de(e.$$.fragment,B),de(E.$$.fragment,B),C=!1},d(B){B&&(ve(n),ve(r),ve(l),ve(d),ve(y),ve(S)),Be(e,B),du(N,B),Be(E),A=!1,Hr(M)}}}function AE(t){let e,n=t[22]+"",r,i;return{c(){e=pe("option"),r=nt(n),e.__value=i=t[21],qi(e,e.__value)},m(o,c){be(o,e,c),te(e,r)},p(o,c){c&8&&n!==(n=o[22]+"")&&Kn(r,n),c&8&&i!==(i=o[21])&&(e.__value=i,qi(e,e.__value))},d(o){o&&ve(e)}}}function DE(t){let e,n,r=Oi(t[18]),i=[];for(let o=0;o<r.length;o+=1)i[o]=AE(ME(t,r,o));return{c(){e=pe("optgroup");for(let o=0;o<i.length;o+=1)i[o].c();Ce(e,"label",n=t[17])},m(o,c){be(o,e,c);for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(e,null)},p(o,c){if(c&8){r=Oi(o[18]);let l;for(l=0;l<r.length;l+=1){const d=ME(o,r,l);i[l]?i[l].p(d,c):(i[l]=AE(d),i[l].c(),i[l].m(e,null))}for(;l<i.length;l+=1)i[l].d(1);i.length=r.length}c&8&&n!==(n=o[17])&&Ce(e,"label",n)},d(o){o&&ve(e),du(i,o)}}}function w7(t){let e,n,r,i,o,c,l,d,y,S=t[1]&&kE(t);return{c(){e=pe("div"),n=pe("div"),r=pe("label"),i=nt(`Project name:
        `),o=pe("input"),c=je(),S&&S.c(),Ce(o,"type","text"),Ce(e,"slot","sidebar")},m(E,C){be(E,e,C),te(e,n),te(n,r),te(r,i),te(r,o),qi(o,t[1]),te(e,c),S&&S.m(e,null),l=!0,d||(y=Lt(o,"input",t[8]),d=!0)},p(E,C){C&2&&o.value!==E[1]&&qi(o,E[1]),E[1]?S?(S.p(E,C),C&2&&ne(S,1)):(S=kE(E),S.c(),ne(S,1),S.m(e,null)):S&&(Rn(),de(S,1,1,()=>{S=null}),Nn())},i(E){l||(ne(S),l=!0)},o(E){de(S),l=!1},d(E){E&&ve(e),S&&S.d(),d=!1,y()}}}function S7(t){let e,n,r;return n=new i7({}),{c(){e=pe("div"),Ve(n.$$.fragment),Ce(e,"slot","map")},m(i,o){be(i,e,o),Fe(n,e,null),r=!0},p:Mt,i(i){r||(ne(n.$$.fragment,i),r=!0)},o(i){de(n.$$.fragment,i),r=!1},d(i){i&&ve(e),Be(n)}}}function E7(t){let e,n;return e=new Eu({props:{$$slots:{map:[S7],sidebar:[w7],top:[x7]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,[i]){const o={};i&33554558&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function I7(t,e,n){let r,i,o,c,l;wt(t,nc,U=>n(14,r=U)),wt(t,Zi,U=>n(15,i=U)),wt(t,nm,U=>n(16,o=U)),wt(t,Pl,U=>n(5,c=U)),wt(t,Tn,U=>n(6,l=U));let d="",y="",S=[],E="";Y_(async()=>{let U=await fetch(o?"/osm/areas.json":"https://assets.od2net.org/severance_pbfs/areas.json");n(3,S=await U.json())});function C(U){n(4,E="Loading OSM");try{Ut(Zi,i=new YE(new TextEncoder().encode(U.detail.xml),U.detail.boundary,void 0),i),Ut(nc,r=`ltn_${d}`,r),XT(),Vf()}catch(Z){window.alert(`Couldn't import from Overpass: ${Z}`)}n(4,E="")}async function A(){if(y=="")return;let U=`ltn_${d}`;window.localStorage.setItem(U,JSON.stringify({type:"FeatureCollection",features:[],study_area_name:y})),n(4,E=`Loading pre-clipped OSM area ${y}`),await c1(U),n(4,E="")}function M(){d=this.value,n(1,d)}function R(){y=VE(this),n(2,y),n(3,S)}return[A,d,y,S,E,c,l,C,M,R,()=>A(),U=>n(4,E=U.detail),U=>window.alert(U.detail),()=>Ut(Tn,l={mode:"title"},l)]}class C7 extends Qt{constructor(e){super(),Jt(this,e,I7,E7,Ht,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}const{window:T7}=X_;function L7(t){let e;return{c(){e=nt("Choose project")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function P7(t){let e;return{c(){e=nt("Pick neighbourhood")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function M7(t){let e;return{c(){e=nt("Editing")},m(n,r){be(n,e,r)},d(n){n&&ve(e)}}}function k7(t){let e,n,r,i,o,c,l,d,y,S,E,C,A,M;return o=new mr({props:{$$slots:{default:[L7]},$$scope:{ctx:t}}}),o.$on("click",t[9]),d=new mr({props:{$$slots:{default:[P7]},$$scope:{ctx:t}}}),d.$on("click",t[10]),E=new mr({props:{$$slots:{default:[M7]},$$scope:{ctx:t}}}),E.$on("click",t[5]),{c(){e=pe("div"),n=pe("nav"),r=pe("ul"),i=pe("li"),Ve(o.$$.fragment),c=je(),l=pe("li"),Ve(d.$$.fragment),y=je(),S=pe("li"),Ve(E.$$.fragment),C=je(),A=pe("li"),A.textContent="Viewing shortcuts",Ce(n,"aria-label","breadcrumb"),Ce(e,"slot","top")},m(R,N){be(R,e,N),te(e,n),te(n,r),te(r,i),Fe(o,i,null),te(r,c),te(r,l),Fe(d,l,null),te(r,y),te(r,S),Fe(E,S,null),te(r,C),te(r,A),M=!0},p(R,N){const B={};N&8192&&(B.$$scope={dirty:N,ctx:R}),o.$set(B);const O={};N&8192&&(O.$$scope={dirty:N,ctx:R}),d.$set(O);const G={};N&8192&&(G.$$scope={dirty:N,ctx:R}),E.$set(G)},i(R){M||(ne(o.$$.fragment,R),ne(d.$$.fragment,R),ne(E.$$.fragment,R),M=!0)},o(R){de(o.$$.fragment,R),de(d.$$.fragment,R),de(E.$$.fragment,R),M=!1},d(R){R&&ve(e),Be(o),Be(d),Be(E)}}}function A7(t){let e,n,r,i,o,c,l,d,y,S=t[0].shortcutIndex+1+"",E,C,A=t[0].gj.features.length+"",M,R,N,B,O,G,U,Z,ue,ae=Vr(t[0].gj.features[t[0].shortcutIndex].properties).directness.toFixed(1)+"",se,fe,ke,K,oe;return{c(){e=pe("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending outside the
        neighbourhood, but cutting through it. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,n=je(),r=pe("button"),r.textContent="Pick a different road",i=je(),o=pe("div"),c=pe("button"),l=nt("Previous"),y=je(),E=nt(S),C=nt(" / "),M=nt(A),R=je(),N=pe("button"),B=nt("Next"),G=je(),U=pe("p"),Z=nt("This shortcut is "),ue=pe("b"),se=nt(ae),fe=nt("x"),ke=nt(`
        the length of the shortest route using all roads, not just this neighbourhood`),c.disabled=d=t[0].shortcutIndex==0,Ce(c,"data-tooltip","Left"),N.disabled=O=t[0].shortcutIndex==t[0].gj.features.length-1,Ce(N,"data-tooltip","Right"),gr(o,"display","flex"),gr(o,"justify-content","space-between")},m(Ge,Te){be(Ge,e,Te),be(Ge,n,Te),be(Ge,r,Te),be(Ge,i,Te),be(Ge,o,Te),te(o,c),te(c,l),te(o,y),te(o,E),te(o,C),te(o,M),te(o,R),te(o,N),te(N,B),be(Ge,G,Te),be(Ge,U,Te),te(U,Z),te(U,ue),te(ue,se),te(ue,fe),te(U,ke),K||(oe=[Lt(r,"click",t[8]),Lt(c,"click",t[6]),Lt(N,"click",t[7])],K=!0)},p(Ge,Te){Te&1&&d!==(d=Ge[0].shortcutIndex==0)&&(c.disabled=d),Te&1&&S!==(S=Ge[0].shortcutIndex+1+"")&&Kn(E,S),Te&1&&A!==(A=Ge[0].gj.features.length+"")&&Kn(M,A),Te&1&&O!==(O=Ge[0].shortcutIndex==Ge[0].gj.features.length-1)&&(N.disabled=O),Te&1&&ae!==(ae=Vr(Ge[0].gj.features[Ge[0].shortcutIndex].properties).directness.toFixed(1)+"")&&Kn(se,ae)},d(Ge){Ge&&(ve(e),ve(n),ve(r),ve(i),ve(o),ve(G),ve(U)),K=!1,Hr(oe)}}}function D7(t){let e;return{c(){e=pe("p"),e.textContent="Click a road to see shortcuts"},m(n,r){be(n,e,r)},p:Mt,d(n){n&&ve(e)}}}function R7(t){let e,n,r,i;n=new xy({}),n.$on("click",t[5]);function o(d,y){if(d[0].state=="neutral")return D7;if(d[0].state=="chose-road")return A7}let c=o(t),l=c&&c(t);return{c(){e=pe("div"),Ve(n.$$.fragment),r=je(),l&&l.c(),Ce(e,"slot","sidebar")},m(d,y){be(d,e,y),Fe(n,e,null),te(e,r),l&&l.m(e,null),i=!0},p(d,y){c===(c=o(d))&&l?l.p(d,y):(l&&l.d(1),l=c&&c(d),l&&(l.c(),l.m(e,null)))},i(d){i||(ne(n.$$.fragment,d),i=!0)},o(d){de(n.$$.fragment,d),i=!1},d(d){d&&ve(e),Be(n),l&&l.d()}}}function N7(t){let e,n,r,i,o,c;return e=new Fo({props:{data:l1(JSON.parse(Vr(t[2]).renderNeighbourhood())),$$slots:{default:[z7]},$$scope:{ctx:t}}}),r=new Fo({props:{data:t[0].gj.features[t[0].shortcutIndex],$$slots:{default:[F7]},$$scope:{ctx:t}}}),o=new Fo({props:{data:t[0].roadGj,$$slots:{default:[B7]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment),n=je(),Ve(r.$$.fragment),i=je(),Ve(o.$$.fragment)},m(l,d){Fe(e,l,d),be(l,n,d),Fe(r,l,d),be(l,i,d),Fe(o,l,d),c=!0},p(l,d){const y={};d&4&&(y.data=l1(JSON.parse(Vr(l[2]).renderNeighbourhood()))),d&8192&&(y.$$scope={dirty:d,ctx:l}),e.$set(y);const S={};d&1&&(S.data=l[0].gj.features[l[0].shortcutIndex]),d&8192&&(S.$$scope={dirty:d,ctx:l}),r.$set(S);const E={};d&1&&(E.data=l[0].roadGj),d&8192&&(E.$$scope={dirty:d,ctx:l}),o.$set(E)},i(l){c||(ne(e.$$.fragment,l),ne(r.$$.fragment,l),ne(o.$$.fragment,l),c=!0)},o(l){de(e.$$.fragment,l),de(r.$$.fragment,l),de(o.$$.fragment,l),c=!1},d(l){l&&(ve(n),ve(i)),Be(e,l),Be(r,l),Be(o,l)}}}function O7(t){let e,n;return e=new wy({props:{gjInput:JSON.parse(Vr(t[2]).renderNeighbourhood()),onClickLine:t[3],$$slots:{"line-popup":[U7]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,i){const o={};i&4&&(o.gjInput=JSON.parse(Vr(r[2]).renderNeighbourhood())),i&8192&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function z7(t){let e,n;const r=[Ti("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.3}}];let i={};for(let o=0;o<r.length;o+=1)i=gi(i,r[o]);return e=new mc({props:i}),{c(){Ve(e.$$.fragment)},m(o,c){Fe(e,o,c),n=!0},p(o,c){const l={};e.$set(l)},i(o){n||(ne(e.$$.fragment,o),n=!0)},o(o){de(e.$$.fragment,o),n=!1},d(o){Be(e,o)}}}function F7(t){let e,n;const r=[Ti("shortcuts"),{paint:{"line-width":5,"line-color":"red"}}];let i={};for(let o=0;o<r.length;o+=1)i=gi(i,r[o]);return e=new Ml({props:i}),{c(){Ve(e.$$.fragment)},m(o,c){Fe(e,o,c),n=!0},p(o,c){const l={};e.$set(l)},i(o){n||(ne(e.$$.fragment,o),n=!0)},o(o){de(e.$$.fragment,o),n=!1},d(o){Be(e,o)}}}function B7(t){let e,n;const r=[Ti("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let i={};for(let o=0;o<r.length;o+=1)i=gi(i,r[o]);return e=new Ml({props:i}),{c(){Ve(e.$$.fragment)},m(o,c){Fe(e,o,c),n=!0},p(o,c){const l={};e.$set(l)},i(o){n||(ne(e.$$.fragment,o),n=!0)},o(o){de(e.$$.fragment,o),n=!1},d(o){Be(e,o)}}}function V7(t){let e,n=t[12].shortcuts+"",r,i,o=(t[12].name??"unnamed road")+"",c;return{c(){e=pe("p"),r=nt(n),i=nt(" shortcuts through "),c=nt(o)},m(l,d){be(l,e,d),te(e,r),te(e,i),te(e,c)},p(l,d){d&4096&&n!==(n=l[12].shortcuts+"")&&Kn(r,n),d&4096&&o!==(o=(l[12].name??"unnamed road")+"")&&Kn(c,o)},d(l){l&&ve(e)}}}function U7(t){let e,n,r;return n=new Iu({props:{openOn:"hover",$$slots:{default:[V7,({props:i})=>({12:i}),({props:i})=>i?4096:0]},$$scope:{ctx:t}}}),{c(){e=pe("div"),Ve(n.$$.fragment),Ce(e,"slot","line-popup")},m(i,o){be(i,e,o),Fe(n,e,null),r=!0},p(i,o){const c={};o&12288&&(c.$$scope={dirty:o,ctx:i}),n.$set(c)},i(i){r||(ne(n.$$.fragment,i),r=!0)},o(i){de(n.$$.fragment,i),r=!1},d(i){i&&ve(e),Be(n)}}}function j7(t){let e,n,r,i,o,c;const l=[O7,N7],d=[];function y(S,E){return S[0].state=="neutral"?0:S[0].state=="chose-road"?1:-1}return~(n=y(t))&&(r=d[n]=l[n](t)),o=new Sy({}),{c(){e=pe("div"),r&&r.c(),i=je(),Ve(o.$$.fragment),Ce(e,"slot","map")},m(S,E){be(S,e,E),~n&&d[n].m(e,null),te(e,i),Fe(o,e,null),c=!0},p(S,E){let C=n;n=y(S),n===C?~n&&d[n].p(S,E):(r&&(Rn(),de(d[C],1,1,()=>{d[C]=null}),Nn()),~n?(r=d[n],r?r.p(S,E):(r=d[n]=l[n](S),r.c()),ne(r,1),r.m(e,i)):r=null)},i(S){c||(ne(r),ne(o.$$.fragment,S),c=!0)},o(S){de(r),de(o.$$.fragment,S),c=!1},d(S){S&&ve(e),~n&&d[n].d(),Be(o)}}}function G7(t){let e,n,r,i;return e=new Eu({props:{$$slots:{map:[j7],sidebar:[R7],top:[k7]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment)},m(o,c){Fe(e,o,c),n=!0,r||(i=Lt(T7,"keydown",t[4]),r=!0)},p(o,[c]){const l={};c&8199&&(l.$$scope={dirty:c,ctx:o}),e.$set(l)},i(o){n||(ne(e.$$.fragment,o),n=!0)},o(o){de(e.$$.fragment,o),n=!1},d(o){Be(e,o),r=!1,i()}}}function q7(t,e,n){let r,i,o;wt(t,Tn,R=>n(1,r=R)),wt(t,Pl,R=>n(11,i=R)),wt(t,Zi,R=>n(2,o=R));let c={state:"neutral"};function l(R,N){let B=JSON.parse(o.getShortcutsCrossingRoad(R.properties.id));if(B.features.length==0){window.alert("No shortcuts here");return}n(0,c={state:"chose-road",roadGj:R,gj:B,shortcutIndex:0})}Y_(()=>{i==null||i.keyboard.disable()}),Hi(()=>{i==null||i.keyboard.enable()});function d(R){c.state=="chose-road"&&(R.key=="ArrowLeft"&&c.shortcutIndex>0&&(R.stopPropagation(),n(0,c.shortcutIndex--,c)),R.key=="ArrowRight"&&(R.stopPropagation(),c.shortcutIndex!=c.gj.features.length-1&&n(0,c.shortcutIndex++,c)))}function y(){Ut(Tn,r={mode:"neighbourhood"},r)}function S(){c.state=="chose-road"&&n(0,c.shortcutIndex--,c)}function E(){c.state=="chose-road"&&n(0,c.shortcutIndex++,c)}return[c,r,o,l,d,y,S,E,()=>n(0,c={state:"neutral"}),()=>Ut(Tn,r={mode:"title"},r),()=>Ut(Tn,r={mode:"network"},r)]}class W7 extends Qt{constructor(e){super(),Jt(this,e,q7,G7,Ht,{})}}function H7(t){let e,n,r,i,o,c,l,d,y;return i=new RB({}),{c(){e=pe("div"),n=pe("button"),n.innerHTML=`<img src="${PR}" style="height: 6vh;" alt="A/B Street logo"/>`,r=je(),Ve(i.$$.fragment),o=je(),c=pe("span"),Ce(n,"class","outline"),gr(c,"width","100%"),Ce(e,"slot","top"),gr(e,"display","flex")},m(S,E){be(S,e,E),te(e,n),te(e,r),Fe(i,e,null),te(e,o),te(e,c),t[19](c),l=!0,d||(y=Lt(n,"click",t[18]),d=!0)},p:Mt,i(S){l||(ne(i.$$.fragment,S),l=!0)},o(S){de(i.$$.fragment,S),l=!1},d(S){S&&ve(e),Be(i),t[19](null),d=!1,y()}}}function RE(t){let e,n,r,i,o,c;return r=new a6({props:{map:Vr(t[6]),maptilerBasemap:t[7]}}),{c(){e=pe("button"),e.textContent="Zoom to fit study area",n=je(),Ve(r.$$.fragment),Ce(e,"class","secondary")},m(l,d){be(l,e,d),be(l,n,d),Fe(r,l,d),i=!0,o||(c=Lt(e,"click",t[10]),o=!0)},p(l,d){const y={};d&64&&(y.map=Vr(l[6])),d&128&&(y.maptilerBasemap=l[7]),r.$set(y)},i(l){i||(ne(r.$$.fragment,l),i=!0)},o(l){de(r.$$.fragment,l),i=!1},d(l){l&&(ve(e),ve(n)),Be(r,l),o=!1,c()}}}function Z7(t){let e,n,r,i,o,c,l=t[5]&&RE(t);return{c(){e=pe("div"),n=pe("div"),r=je(),i=pe("hr"),o=je(),l&&l.c(),Ce(e,"slot","left")},m(d,y){be(d,e,y),te(e,n),t[17](n),te(e,r),te(e,i),te(e,o),l&&l.m(e,null),c=!0},p(d,y){d[5]?l?(l.p(d,y),y&32&&ne(l,1)):(l=RE(d),l.c(),ne(l,1),l.m(e,null)):l&&(Rn(),de(l,1,1,()=>{l=null}),Nn())},i(d){c||(ne(l),c=!0)},o(d){de(l),c=!1},d(d){d&&ve(e),t[17](null),l&&l.d()}}}function X7(t){let e,n;return e=new C7({}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p:Mt,i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function Y7(t){let e,n;return e=new v7({props:{wasmReady:t[4]}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,i){const o={};i&16&&(o.wasmReady=r[4]),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function NE(t){let e,n,r,i,o,c;e=new Fo({props:{data:JSON.parse(t[5].getInvertedBoundary()),$$slots:{default:[$7]},$$scope:{ctx:t}}});const l=[r9,n9,t9,e9,Q7,J7,K7],d=[];function y(S,E){return S[8].mode=="network"?0:S[8].mode=="set-boundary"?1:S[8].mode=="auto-boundaries"?2:S[8].mode=="neighbourhood"?3:S[8].mode=="view-shortcuts"?4:S[8].mode=="route"?5:S[8].mode=="debug"?6:-1}return~(r=y(t))&&(i=d[r]=l[r](t)),{c(){Ve(e.$$.fragment),n=je(),i&&i.c(),o=ki()},m(S,E){Fe(e,S,E),be(S,n,E),~r&&d[r].m(S,E),be(S,o,E),c=!0},p(S,E){const C={};E&32&&(C.data=JSON.parse(S[5].getInvertedBoundary())),E&2097152&&(C.$$scope={dirty:E,ctx:S}),e.$set(C);let A=r;r=y(S),r===A?~r&&d[r].p(S,E):(i&&(Rn(),de(d[A],1,1,()=>{d[A]=null}),Nn()),~r?(i=d[r],i?i.p(S,E):(i=d[r]=l[r](S),i.c()),ne(i,1),i.m(o.parentNode,o)):i=null)},i(S){c||(ne(e.$$.fragment,S),ne(i),c=!0)},o(S){de(e.$$.fragment,S),de(i),c=!1},d(S){S&&(ve(n),ve(o)),Be(e,S),~r&&d[r].d(S)}}}function $7(t){let e,n;const r=[Ti("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let i={};for(let o=0;o<r.length;o+=1)i=gi(i,r[o]);return e=new mc({props:i}),{c(){Ve(e.$$.fragment)},m(o,c){Fe(e,o,c),n=!0},p(o,c){const l={};e.$set(l)},i(o){n||(ne(e.$$.fragment,o),n=!0)},o(o){de(e.$$.fragment,o),n=!1},d(o){Be(e,o)}}}function K7(t){let e,n;return e=new B6({}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p:Mt,i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function J7(t){let e,n;return e=new PB({props:{prevMode:t[8].prevMode}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,i){const o={};i&256&&(o.prevMode=r[8].prevMode),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function Q7(t){let e,n;return e=new W7({}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p:Mt,i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function e9(t){let e,n;return e=new nB({}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p:Mt,i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function t9(t){let e,n;return e=new v8({}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p:Mt,i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function n9(t){let e,n;return e=new l8({props:{name:t[8].name,existing:t[8].existing}}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p(r,i){const o={};i&256&&(o.name=r[8].name),i&256&&(o.existing=r[8].existing),e.$set(o)},i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function r9(t){let e,n;return e=new _B({}),{c(){Ve(e.$$.fragment)},m(r,i){Fe(e,r,i),n=!0},p:Mt,i(r){n||(ne(e.$$.fragment,r),n=!0)},o(r){de(e.$$.fragment,r),n=!1},d(r){Be(e,r)}}}function i9(t){let e,n,r,i,o,c,l,d,y,S;e=new wz({props:{map:t[0],apiKey:Fv}});const E=[Y7,X7],C=[];function A(R,N){return R[8].mode=="title"?0:R[8].mode=="new-project"?1:-1}~(o=A(t))&&(c=C[o]=E[o](t));let M=t[5]&&NE(t);return y=new Gz({}),{c(){Ve(e.$$.fragment),n=je(),r=pe("div"),i=je(),c&&c.c(),l=je(),M&&M.c(),d=je(),Ve(y.$$.fragment)},m(R,N){Fe(e,R,N),be(R,n,N),be(R,r,N),t[14](r),be(R,i,N),~o&&C[o].m(R,N),be(R,l,N),M&&M.m(R,N),be(R,d,N),Fe(y,R,N),S=!0},p(R,N){const B={};N&1&&(B.map=R[0]),e.$set(B);let O=o;o=A(R),o===O?~o&&C[o].p(R,N):(c&&(Rn(),de(C[O],1,1,()=>{C[O]=null}),Nn()),~o?(c=C[o],c?c.p(R,N):(c=C[o]=E[o](R),c.c()),ne(c,1),c.m(l.parentNode,l)):c=null),R[5]?M?(M.p(R,N),N&32&&ne(M,1)):(M=NE(R),M.c(),ne(M,1),M.m(d.parentNode,d)):M&&(Rn(),de(M,1,1,()=>{M=null}),Nn())},i(R){S||(ne(e.$$.fragment,R),ne(c),ne(M),ne(y.$$.fragment,R),S=!0)},o(R){de(e.$$.fragment,R),de(c),de(M),de(y.$$.fragment,R),S=!1},d(R){R&&(ve(n),ve(r),ve(i),ve(l),ve(d)),Be(e,R),t[14](null),~o&&C[o].d(R),M&&M.d(R),Be(y,R)}}}function o9(t){let e,n,r,i;function o(l){t[15](l)}let c={style:`https://api.maptiler.com/maps/${t[7]}/style.json?key=${Fv}`,standardControls:!0,hash:!0,images:[{id:"walk_cycle_only",url:"/ltn//filters/walk_cycle_only_icon.gif"},{id:"no_entry",url:"/ltn//filters/no_entry_icon.gif"},{id:"bus_gate",url:"/ltn//filters/bus_gate_icon.gif"},{id:"school_street",url:"/ltn//filters/school_street_icon.gif"},{id:"oneway-arrow",url:LR}],$$slots:{default:[i9]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.map=t[0]),n=new bN({props:c}),Gr.push(()=>xa(n,"map",o)),n.$on("error",t[16]),{c(){e=pe("div"),Ve(n.$$.fragment),Ce(e,"slot","main"),gr(e,"position","relative"),gr(e,"width","100%"),gr(e,"height","100%")},m(l,d){be(l,e,d),Fe(n,e,null),i=!0},p(l,d){const y={};d&128&&(y.style=`https://api.maptiler.com/maps/${l[7]}/style.json?key=${Fv}`),d&2097465&&(y.$$scope={dirty:d,ctx:l}),!r&&d&1&&(r=!0,y.map=l[0],ba(()=>r=!1)),n.$set(y)},i(l){i||(ne(n.$$.fragment,l),i=!0)},o(l){de(n.$$.fragment,l),i=!1},d(l){l&&ve(e),Be(n)}}}function s9(t){let e,n,r,i;return e=new TR({}),r=new kz({props:{$$slots:{main:[o9],left:[Z7],top:[H7]},$$scope:{ctx:t}}}),{c(){Ve(e.$$.fragment),n=je(),Ve(r.$$.fragment)},m(o,c){Fe(e,o,c),be(o,n,c),Fe(r,o,c),i=!0},p(o,[c]){const l={};c&2098175&&(l.$$scope={dirty:c,ctx:o}),r.$set(l)},i(o){i||(ne(e.$$.fragment,o),ne(r.$$.fragment,o),i=!0)},o(o){de(e.$$.fragment,o),de(r.$$.fragment,o),i=!1},d(o){o&&ve(n),Be(e,o),Be(r,o)}}}function a9(t,e,n){let r,i,o,c,l,d,y,S,E;wt(t,a1,se=>n(11,r=se)),wt(t,s1,se=>n(12,i=se)),wt(t,o1,se=>n(13,o=se)),wt(t,Zi,se=>n(5,c=se)),wt(t,Pl,se=>n(6,l=se)),wt(t,nm,se=>n(20,d=se)),wt(t,Bv,se=>n(7,y=se)),wt(t,Tn,se=>n(8,S=se)),wt(t,D_,se=>n(9,E=se));let C=!1;Y_(async()=>{await $E(),await eI(),n(4,C=!0);try{(await fetch("/osm/areas.json")).ok&&(Ut(nm,d=!0,d),console.log("Using local cache, not od2net.org"))}catch{}});let A;function M(){l.fitBounds(Array.from(c.getBounds()),{animate:!1})}let R,N,B;function O(se){Gr[se?"unshift":"push"](()=>{B=se,n(3,B),n(11,r)})}function G(se){A=se,n(0,A)}const U=se=>{console.log(se.detail.error)};function Z(se){Gr[se?"unshift":"push"](()=>{N=se,n(2,N),n(12,i)})}const ue=()=>Ut(D_,E=!0,E);function ae(se){Gr[se?"unshift":"push"](()=>{R=se,n(1,R),n(13,o)})}return t.$$.update=()=>{t.$$.dirty&1&&A&&Pl.set(A),t.$$.dirty&8194&&R&&o&&(n(1,R.innerHTML="",R),R.appendChild(o)),t.$$.dirty&4100&&N&&i&&(n(2,N.innerHTML="",N),N.appendChild(i)),t.$$.dirty&2056&&B&&r&&(n(3,B.innerHTML="",B),B.appendChild(r))},[A,R,N,B,C,c,l,y,S,E,M,r,i,o,O,G,U,Z,ue,ae]}class l9 extends Qt{constructor(e){super(),Jt(this,e,a9,s9,Ht,{})}}new l9({target:document.getElementById("app")});
