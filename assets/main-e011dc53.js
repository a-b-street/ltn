var Zv=Object.defineProperty;var Gv=(o,e,t)=>e in o?Zv(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var Dn=(o,e,t)=>(Gv(o,typeof e!="symbol"?e+"":e,t),t);function Wv(o,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const c in n)if(c!=="default"&&!(c in o)){const u=Object.getOwnPropertyDescriptor(n,c);u&&Object.defineProperty(o,c,u.get?u:{enumerable:!0,get:()=>n[c]})}}}return Object.freeze(Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))n(c);new MutationObserver(c=>{for(const u of c)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&n(f)}).observe(document,{childList:!0,subtree:!0});function t(c){const u={};return c.integrity&&(u.integrity=c.integrity),c.referrerPolicy&&(u.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?u.credentials="include":c.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function n(c){if(c.ep)return;c.ep=!0;const u=t(c);fetch(c.href,u)}})();function Dt(){}function an(o,e){for(const t in e)o[t]=e[t];return o}function Oy(o){return o()}function _g(){return Object.create(null)}function ln(o){o.forEach(Oy)}function Kl(o){return typeof o=="function"}function Ut(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}let Yh;function En(o,e){return o===e?!0:(Yh||(Yh=document.createElement("a")),Yh.href=e,o===Yh.href)}function Hv(o){return Object.keys(o).length===0}function Ny(o,...e){if(o==null){for(const n of e)n(void 0);return Dt}const t=o.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Lr(o){let e;return Ny(o,t=>e=t)(),e}function dt(o,e,t){o.$$.on_destroy.push(Ny(e,t))}function Bi(o,e,t,n){if(o){const c=jy(o,e,t,n);return o[0](c)}}function jy(o,e,t,n){return o[1]&&n?an(t.ctx.slice(),o[1](n(e))):t.ctx}function Fi(o,e,t,n){if(o[2]&&n){const c=o[2](n(t));if(e.dirty===void 0)return c;if(typeof c=="object"){const u=[],f=Math.max(e.dirty.length,c.length);for(let a=0;a<f;a+=1)u[a]=e.dirty[a]|c[a];return u}return e.dirty|c}return e.dirty}function Oi(o,e,t,n,c,u){if(c){const f=jy(e,t,n,u);o.p(f,c)}}function Ni(o){if(o.ctx.length>32){const e=[],t=o.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function $v(o){const e={};for(const t in o)e[t]=!0;return e}function fd(o){return o??""}function At(o,e,t){return o.set(t),e}function $f(o){return o&&Kl(o.destroy)?o.destroy:Dt}const xd=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function ie(o,e){o.appendChild(e)}function de(o,e,t){o.insertBefore(e,t||null)}function he(o){o.parentNode&&o.parentNode.removeChild(o)}function Ss(o,e){for(let t=0;t<o.length;t+=1)o[t]&&o[t].d(e)}function ue(o){return document.createElement(o)}function xs(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function Qe(o){return document.createTextNode(o)}function Fe(){return Qe(" ")}function Bn(){return Qe("")}function Et(o,e,t,n){return o.addEventListener(e,t,n),()=>o.removeEventListener(e,t,n)}function vp(o){return function(e){return e.preventDefault(),o.call(this,e)}}function Bf(o){return function(e){return e.stopPropagation(),o.call(this,e)}}function Te(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}function Uy(o){let e;return{p(...t){e=t,e.forEach(n=>o.push(n))},r(){e.forEach(t=>o.splice(o.indexOf(t),1))}}}function bp(o){return o===""?null:+o}function Xv(o){return Array.from(o.childNodes)}function Ci(o,e){e=""+e,o.data!==e&&(o.data=e)}function Hn(o,e){o.value=e??""}function mn(o,e,t,n){t==null?o.style.removeProperty(e):o.style.setProperty(e,t,n?"important":"")}function Jl(o,e,t){for(let n=0;n<o.options.length;n+=1){const c=o.options[n];if(c.__value===e){c.selected=!0;return}}(!t||e!==void 0)&&(o.selectedIndex=-1)}function wp(o){const e=o.querySelector(":checked");return e&&e.__value}function lr(o,e,t){o.classList.toggle(e,!!t)}function Kv(o,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:n})}let Tu;function vu(o){Tu=o}function Nu(){if(!Tu)throw new Error("Function called outside component initialization");return Tu}function kd(o){Nu().$$.on_mount.push(o)}function er(o){Nu().$$.on_destroy.push(o)}function ts(){const o=Nu();return(e,t,{cancelable:n=!1}={})=>{const c=o.$$.callbacks[e];if(c){const u=Kv(e,t,{cancelable:n});return c.slice().forEach(f=>{f.call(o,u)}),!u.defaultPrevented}return!0}}function xp(o,e){return Nu().$$.context.set(o,e),e}function kp(o){return Nu().$$.context.get(o)}function ui(o,e){const t=o.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const Vl=[],Xi=[];let Wl=[];const Xf=[],Vy=Promise.resolve();let Kf=!1;function qy(){Kf||(Kf=!0,Vy.then(Gy))}function Zy(){return qy(),Vy}function Yl(o){Wl.push(o)}function Gr(o){Xf.push(o)}const Ff=new Set;let Bl=0;function Gy(){if(Bl!==0)return;const o=Tu;do{try{for(;Bl<Vl.length;){const e=Vl[Bl];Bl++,vu(e),Jv(e.$$)}}catch(e){throw Vl.length=0,Bl=0,e}for(vu(null),Vl.length=0,Bl=0;Xi.length;)Xi.pop()();for(let e=0;e<Wl.length;e+=1){const t=Wl[e];Ff.has(t)||(Ff.add(t),t())}Wl.length=0}while(Vl.length);for(;Xf.length;)Xf.pop()();Kf=!1,Ff.clear(),vu(o)}function Jv(o){if(o.fragment!==null){o.update(),ln(o.before_update);const e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(Yl)}}function Yv(o){const e=[],t=[];Wl.forEach(n=>o.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Wl=e}const nd=new Set;let Da;function _i(){Da={r:0,c:[],p:Da}}function yi(){Da.r||ln(Da.c),Da=Da.p}function re(o,e){o&&o.i&&(nd.delete(o),o.i(e))}function ce(o,e,t,n){if(o&&o.o){if(nd.has(o))return;nd.add(o),Da.c.push(()=>{nd.delete(o),n&&(t&&o.d(1),n())}),o.o(e)}else n&&n()}function Kn(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function Qv(o,e){ce(o,1,1,()=>{e.delete(o.key)})}function eb(o,e,t,n,c,u,f,a,_,x,S,k){let I=o.length,P=u.length,D=I;const R={};for(;D--;)R[o[D].key]=D;const z=[],B=new Map,N=new Map,V=[];for(D=P;D--;){const $=k(c,u,D),Y=t($);let ve=f.get(Y);ve?n&&V.push(()=>ve.p($,e)):(ve=x(Y,$),ve.c()),B.set(Y,z[D]=ve),Y in R&&N.set(Y,Math.abs(D-R[Y]))}const j=new Set,le=new Set;function oe($){re($,1),$.m(a,S),f.set($.key,$),S=$.first,P--}for(;I&&P;){const $=z[P-1],Y=o[I-1],ve=$.key,Be=Y.key;$===Y?(S=$.first,I--,P--):B.has(Be)?!f.has(ve)||j.has(ve)?oe($):le.has(Be)?I--:N.get(ve)>N.get(Be)?(le.add(ve),oe($)):(j.add(Be),I--):(_(Y,f),I--)}for(;I--;){const $=o[I];B.has($.key)||_($,f)}for(;P;)oe(z[P-1]);return ln(V),z}function bu(o,e){const t={},n={},c={$$scope:1};let u=o.length;for(;u--;){const f=o[u],a=e[u];if(a){for(const _ in f)_ in a||(n[_]=1);for(const _ in a)c[_]||(t[_]=a[_],c[_]=1);o[u]=a}else for(const _ in f)c[_]=1}for(const f in n)f in t||(t[f]=void 0);return t}function Wr(o,e,t){const n=o.$$.props[e];n!==void 0&&(o.$$.bound[n]=t,t(o.$$.ctx[n]))}function Re(o){o&&o.c()}function ze(o,e,t){const{fragment:n,after_update:c}=o.$$;n&&n.m(e,t),Yl(()=>{const u=o.$$.on_mount.map(Oy).filter(Kl);o.$$.on_destroy?o.$$.on_destroy.push(...u):ln(u),o.$$.on_mount=[]}),c.forEach(Yl)}function De(o,e){const t=o.$$;t.fragment!==null&&(Yv(t.after_update),ln(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function tb(o,e){o.$$.dirty[0]===-1&&(Vl.push(o),qy(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function Wt(o,e,t,n,c,u,f=null,a=[-1]){const _=Tu;vu(o);const x=o.$$={fragment:null,ctx:[],props:u,update:Dt,not_equal:c,bound:_g(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(_?_.$$.context:[])),callbacks:_g(),dirty:a,skip_bound:!1,root:e.target||_.$$.root};f&&f(x.root);let S=!1;if(x.ctx=t?t(o,e.props||{},(k,I,...P)=>{const D=P.length?P[0]:I;return x.ctx&&c(x.ctx[k],x.ctx[k]=D)&&(!x.skip_bound&&x.bound[k]&&x.bound[k](D),S&&tb(o,k)),I}):[],x.update(),S=!0,ln(x.before_update),x.fragment=n?n(x.ctx):!1,e.target){if(e.hydrate){const k=Xv(e.target);x.fragment&&x.fragment.l(k),k.forEach(he)}else x.fragment&&x.fragment.c();e.intro&&re(o.$$.fragment),ze(o,e.target,e.anchor),Gy()}vu(_)}class Ht{constructor(){Dn(this,"$$");Dn(this,"$$set")}$destroy(){De(this,1),this.$destroy=Dt}$on(e,t){if(!Kl(t))return Dt;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const c=n.indexOf(t);c!==-1&&n.splice(c,1)}}$set(e){this.$$set&&!Hv(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const ib="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ib);const nb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",rb="/ltn/assets/logo-97f2d067.svg";function yg(o){let e,t;return{c(){e=ue("div"),t=Qe(o[0]),Te(e,"class","svelte-1uuov7f")},m(n,c){de(n,e,c),ie(e,t)},p(n,c){c&1&&Ci(t,n[0])},d(n){n&&he(e)}}}function ob(o){let e,t=o[0]&&yg(o);return{c(){t&&t.c(),e=Bn()},m(n,c){t&&t.m(n,c),de(n,e,c)},p(n,[c]){n[0]?t?t.p(n,c):(t=yg(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Dt,o:Dt,d(n){n&&he(e),t&&t.d(n)}}}function sb(o,e,t){let{loading:n}=e;return o.$$set=c=>{"loading"in c&&t(0,n=c.loading)},[n]}class Wy extends Ht{constructor(e){super(),Wt(this,e,sb,ob,Ut,{loading:0})}}const ab=o=>({dialog:o&1}),vg=o=>({dialog:o[0]});function lb(o){let e,t,n,c,u;const f=o[4].default,a=Bi(f,o,o[3],vg);return{c(){e=ue("dialog"),t=ue("article"),a&&a.c(),e.open=!0},m(_,x){de(_,e,x),ie(e,t),a&&a.m(t,null),o[6](e),n=!0,c||(u=[Et(window,"click",o[1]),Et(window,"keydown",o[2]),Et(e,"close",o[5])],c=!0)},p(_,[x]){a&&a.p&&(!n||x&9)&&Oi(a,f,_,_[3],n?Fi(f,_[3],x,ab):Ni(_[3]),vg)},i(_){n||(re(a,_),n=!0)},o(_){ce(a,_),n=!1},d(_){_&&he(e),a&&a.d(_),o[6](null),c=!1,ln(u)}}}function cb(o,e,t){let{$$slots:n={},$$scope:c}=e,u;function f(S){u.open&&S.target==u&&u.close()}function a(S){(S.key=="Escape"||S.key=="Enter")&&(S.stopPropagation(),u.close())}function _(S){ui.call(this,o,S)}function x(S){Xi[S?"unshift":"push"](()=>{u=S,t(0,u)})}return o.$$set=S=>{"$$scope"in S&&t(3,c=S.$$scope)},[u,f,a,c,n,_,x]}class Sd extends Ht{constructor(e){super(),Wt(this,e,cb,lb,Ut,{})}}function bg(o,e,t){const n=o.slice();return n[1]=e[t][0],n[2]=e[t][1],n}function wg(o){let e,t,n=o[1]+"",c,u,f,a=o[2]+"",_,x;return{c(){e=ue("tr"),t=ue("td"),c=Qe(n),u=Fe(),f=ue("td"),_=Qe(a),x=Fe()},m(S,k){de(S,e,k),ie(e,t),ie(t,c),ie(e,u),ie(e,f),ie(f,_),ie(e,x)},p(S,k){k&1&&n!==(n=S[1]+"")&&Ci(c,n),k&1&&a!==(a=S[2]+"")&&Ci(_,a)},d(S){S&&he(e)}}}function ub(o){let e,t,n=Kn(Object.entries(o[0])),c=[];for(let u=0;u<n.length;u+=1)c[u]=wg(bg(o,n,u));return{c(){e=ue("table"),t=ue("tbody");for(let u=0;u<c.length;u+=1)c[u].c();Te(e,"class","svelte-lh2o9l")},m(u,f){de(u,e,f),ie(e,t);for(let a=0;a<c.length;a+=1)c[a]&&c[a].m(t,null)},p(u,[f]){if(f&1){n=Kn(Object.entries(u[0]));let a;for(a=0;a<n.length;a+=1){const _=bg(u,n,a);c[a]?c[a].p(_,f):(c[a]=wg(_),c[a].c(),c[a].m(t,null))}for(;a<c.length;a+=1)c[a].d(1);c.length=n.length}},i:Dt,o:Dt,d(u){u&&he(e),Ss(c,u)}}}function hb(o,e,t){let{properties:n}=e;return o.$$set=c=>{"properties"in c&&t(0,n=c.properties)},[n]}class Td extends Ht{constructor(e){super(),Wt(this,e,hb,ub,Ut,{properties:0})}}function pd(o,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",o),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function tn(o){if(o==null||o==null)throw new Error("Oops, notNull given something null");return o}var Hy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $y(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function Sp(o){if(o.__esModule)return o;var e=o.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(o).forEach(function(n){var c=Object.getOwnPropertyDescriptor(o,n);Object.defineProperty(t,n,c.get?c:{enumerable:!0,get:function(){return o[n]}})}),t}var Xy={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(o,e){(function(t,n){o.exports=n()})(Hy,function(){var t={},n={};function c(f,a,_){if(n[f]=_,f==="index"){var x="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",S={};return n.shared(S),n.index(t,S),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([x],{type:"text/javascript"}))),t}}c("shared",["exports"],function(f){function a(s,i,l,d){return new(l||(l=Promise))(function(g,b){function w(A){try{M(d.next(A))}catch(O){b(O)}}function T(A){try{M(d.throw(A))}catch(O){b(O)}}function M(A){var O;A.done?g(A.value):(O=A.value,O instanceof l?O:new l(function(U){U(O)})).then(w,T)}M((d=d.apply(s,i||[])).next())})}function _(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}typeof SuppressedError=="function"&&SuppressedError;var x=S;function S(s,i){this.x=s,this.y=i}S.prototype={clone:function(){return new S(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,i){return this.clone()._rotateAround(s,i)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var i=s.x-this.x,l=s.y-this.y;return i*i+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,i){return Math.atan2(this.x*i-this.y*s,this.x*s+this.y*i)},_matMult:function(s){var i=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=i,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var i=Math.cos(s),l=Math.sin(s),d=l*this.x+i*this.y;return this.x=i*this.x-l*this.y,this.y=d,this},_rotateAround:function(s,i){var l=Math.cos(s),d=Math.sin(s),g=i.y+d*(this.x-i.x)+l*(this.y-i.y);return this.x=i.x+l*(this.x-i.x)-d*(this.y-i.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},S.convert=function(s){return s instanceof S?s:Array.isArray(s)?new S(s[0],s[1]):s};var k=_(x),I=P;function P(s,i,l,d){this.cx=3*s,this.bx=3*(l-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(d-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=l,this.p2y=d}P.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(i===void 0&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var l=s,d=0;d<8;d++){var g=this.sampleCurveX(l)-s;if(Math.abs(g)<i)return l;var b=this.sampleCurveDerivativeX(l);if(Math.abs(b)<1e-6)break;l-=g/b}var w=0,T=1;for(l=s,d=0;d<20&&(g=this.sampleCurveX(l),!(Math.abs(g-s)<i));d++)s>g?w=l:T=l,l=.5*(T-w)+w;return l},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}};var D=_(I);let R,z;function B(){return R==null&&(R=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),R}function N(){if(z==null&&(z=!1,B())){const i=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(i){for(let d=0;d<5*5;d++){const g=4*d;i.fillStyle=`rgb(${g},${g+1},${g+2})`,i.fillRect(d%5,Math.floor(d/5),1,1)}const l=i.getImageData(0,0,5,5).data;for(let d=0;d<5*5*4;d++)if(d%4!=3&&l[d]!==d){z=!0;break}}}return z||!1}function V(s,i,l,d){const g=new D(s,i,l,d);return function(b){return g.solve(b)}}const j=V(.25,.1,.25,1);function le(s,i,l){return Math.min(l,Math.max(i,s))}function oe(s,i,l){const d=l-i,g=((s-i)%d+d)%d+i;return g===i?l:g}function $(s,...i){for(const l of i)for(const d in l)s[d]=l[d];return s}let Y=1;function ve(s,i,l){const d={};for(const g in s)d[g]=i.call(l||this,s[g],g,s);return d}function Be(s,i,l){const d={};for(const g in s)i.call(l||this,s[g],g,s)&&(d[g]=s[g]);return d}function te(s){return Array.isArray(s)?s.map(te):typeof s=="object"&&s?ve(s,te):s}const ne={};function qe(s){ne[s]||(typeof console<"u"&&console.warn(s),ne[s]=!0)}function Ce(s,i,l){return(l.y-s.y)*(i.x-s.x)>(i.y-s.y)*(l.x-s.x)}function et(s){let i=0;for(let l,d,g=0,b=s.length,w=b-1;g<b;w=g++)l=s[g],d=s[w],i+=(d.x-l.x)*(l.y+d.y);return i}function bt(s){return typeof WorkerGlobalScope<"u"&&s!==void 0&&s instanceof WorkerGlobalScope}let ft=null;function ot(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap}const Zt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ii(s,i,l,d,g){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const b=new VideoFrame(s,{timestamp:0});try{const w=b==null?void 0:b.format;if(!w||!w.startsWith("BGR")&&!w.startsWith("RGB"))throw new Error(`Unrecognized format ${w}`);const T=w.startsWith("BGR"),M=new Uint8ClampedArray(d*g*4);if(yield b.copyTo(M,function(A,O,U,H,K){const Q=4*Math.max(-O,0),ae=(Math.max(0,U)-U)*H*4+Q,_e=4*H,xe=Math.max(0,O),Oe=Math.max(0,U);return{rect:{x:xe,y:Oe,width:Math.min(A.width,O+H)-xe,height:Math.min(A.height,U+K)-Oe},layout:[{offset:ae,stride:_e}]}}(s,i,l,d,g)),T)for(let A=0;A<M.length;A+=4){const O=M[A];M[A]=M[A+2],M[A+2]=O}return M}finally{b.close()}})}let Ft,Pt;const Jt="AbortError";function Mt(){return new Error(Jt)}const ei={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Vt(s){return ei.REGISTERED_PROTOCOLS[s.substring(0,s.indexOf("://"))]}const hi="global-dispatcher";class xi extends Error{constructor(i,l,d,g){super(`AJAXError: ${l} (${i}): ${d}`),this.status=i,this.statusText=l,this.url=d,this.body=g}}const gi=()=>bt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ai=function(s,i){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){const d=Vt(s.url);if(d)return d(s,i);if(bt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,targetMapId:hi},i)}if(!(/^file:/.test(l=s.url)||/^file:/.test(gi())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(d,g){return a(this,void 0,void 0,function*(){const b=new Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,cache:d.cache,referrer:gi(),signal:g.signal});d.type==="json"&&b.headers.set("Accept","application/json");const w=yield fetch(b);if(!w.ok){const A=yield w.blob();throw new xi(w.status,w.statusText,d.url,A)}let T;T=d.type==="arrayBuffer"||d.type==="image"?w.arrayBuffer():d.type==="json"?w.json():w.text();const M=yield T;if(g.signal.aborted)throw Mt();return{data:M,cacheControl:w.headers.get("Cache-Control"),expires:w.headers.get("Expires")}})}(s,i);if(bt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,mustQueue:!0,targetMapId:hi},i)}var l;return function(d,g){return new Promise((b,w)=>{const T=new XMLHttpRequest;T.open(d.method||"GET",d.url,!0),d.type!=="arrayBuffer"&&d.type!=="image"||(T.responseType="arraybuffer");for(const M in d.headers)T.setRequestHeader(M,d.headers[M]);d.type==="json"&&(T.responseType="text",T.setRequestHeader("Accept","application/json")),T.withCredentials=d.credentials==="include",T.onerror=()=>{w(new Error(T.statusText))},T.onload=()=>{if(!g.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let M=T.response;if(d.type==="json")try{M=JSON.parse(T.response)}catch(A){return void w(A)}b({data:M,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const M=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});w(new xi(T.status,T.statusText,d.url,M))}},g.signal.addEventListener("abort",()=>{T.abort(),w(Mt())}),T.send(d.body)})}(s,i)};function ct(s){if(!s||s.indexOf("://")<=0||s.indexOf("data:image/")===0||s.indexOf("blob:")===0)return!0;const i=new URL(s),l=window.location;return i.protocol===l.protocol&&i.host===l.host}function It(s,i,l){l[s]&&l[s].indexOf(i)!==-1||(l[s]=l[s]||[],l[s].push(i))}function Ne(s,i,l){if(l&&l[s]){const d=l[s].indexOf(i);d!==-1&&l[s].splice(d,1)}}class je{constructor(i,l={}){$(this,l),this.type=i}}class rt extends je{constructor(i,l={}){super("error",$({error:i},l))}}class xt{on(i,l){return this._listeners=this._listeners||{},It(i,l,this._listeners),this}off(i,l){return Ne(i,l,this._listeners),Ne(i,l,this._oneTimeListeners),this}once(i,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},It(i,l,this._oneTimeListeners),this):new Promise(d=>this.once(i,d))}fire(i,l){typeof i=="string"&&(i=new je(i,l||{}));const d=i.type;if(this.listens(d)){i.target=this;const g=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const T of g)T.call(this,i);const b=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const T of b)Ne(d,T,this._oneTimeListeners),T.call(this,i);const w=this._eventedParent;w&&($(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(i))}else i instanceof rt&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,l){return this._eventedParent=i,this._eventedParentData=l,this}}var we={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const di=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ve(s,i){const l={};for(const d in s)d!=="ref"&&(l[d]=s[d]);return di.forEach(d=>{d in i&&(l[d]=i[d])}),l}function $e(s,i){if(Array.isArray(s)){if(!Array.isArray(i)||s.length!==i.length)return!1;for(let l=0;l<s.length;l++)if(!$e(s[l],i[l]))return!1;return!0}if(typeof s=="object"&&s!==null&&i!==null){if(typeof i!="object"||Object.keys(s).length!==Object.keys(i).length)return!1;for(const l in s)if(!$e(s[l],i[l]))return!1;return!0}return s===i}function kt(s,i){s.push(i)}function bn(s,i,l){kt(l,{command:"addSource",args:[s,i[s]]})}function wn(s,i,l){kt(i,{command:"removeSource",args:[s]}),l[s]=!0}function Cn(s,i,l,d){wn(s,l,d),bn(s,i,l)}function tr(s,i,l){let d;for(d in s[l])if(Object.prototype.hasOwnProperty.call(s[l],d)&&d!=="data"&&!$e(s[l][d],i[l][d]))return!1;for(d in i[l])if(Object.prototype.hasOwnProperty.call(i[l],d)&&d!=="data"&&!$e(s[l][d],i[l][d]))return!1;return!0}function ir(s,i,l,d,g,b){s=s||{},i=i||{};for(const w in s)Object.prototype.hasOwnProperty.call(s,w)&&($e(s[w],i[w])||l.push({command:b,args:[d,w,i[w],g]}));for(const w in i)Object.prototype.hasOwnProperty.call(i,w)&&!Object.prototype.hasOwnProperty.call(s,w)&&($e(s[w],i[w])||l.push({command:b,args:[d,w,i[w],g]}))}function Uo(s){return s.id}function Ki(s,i){return s[i.id]=i,s}class ut{constructor(i,l,d,g){this.message=(i?`${i}: `:"")+d,g&&(this.identifier=g),l!=null&&l.__line__&&(this.line=l.__line__)}}function $n(s,...i){for(const l of i)for(const d in l)s[d]=l[d];return s}class xn extends Error{constructor(i,l){super(l),this.message=l,this.key=i}}class Lo{constructor(i,l=[]){this.parent=i,this.bindings={};for(const[d,g]of l)this.bindings[d]=g}concat(i){return new Lo(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Vi={kind:"null"},gt={kind:"number"},ni={kind:"string"},Yt={kind:"boolean"},qi={kind:"color"},yr={kind:"object"},ti={kind:"value"},eo={kind:"collator"},cn={kind:"formatted"},ge={kind:"padding"},W={kind:"resolvedImage"},X={kind:"variableAnchorOffsetCollection"};function ee(s,i){return{kind:"array",itemType:s,N:i}}function fe(s){if(s.kind==="array"){const i=fe(s.itemType);return typeof s.N=="number"?`array<${i}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${i}>`}return s.kind}const Me=[Vi,gt,ni,Yt,qi,cn,yr,ee(ti),ge,W,X];function Ie(s,i){if(i.kind==="error")return null;if(s.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!Ie(s.itemType,i.itemType))&&(typeof s.N!="number"||s.N===i.N))return null}else{if(s.kind===i.kind)return null;if(s.kind==="value"){for(const l of Me)if(!Ie(l,i))return null}}return`Expected ${fe(s)} but found ${fe(i)} instead.`}function Pe(s,i){return i.some(l=>l.kind===s.kind)}function ke(s,i){return i.some(l=>l==="null"?s===null:l==="array"?Array.isArray(s):l==="object"?s&&!Array.isArray(s)&&typeof s=="object":l===typeof s)}function G(s,i){return s.kind==="array"&&i.kind==="array"?s.itemType.kind===i.itemType.kind&&typeof s.N=="number":s.kind===i.kind}const Ue=.96422,Ze=.82521,We=4/29,Je=6/29,ht=3*Je*Je,Rt=Je*Je*Je,Xt=Math.PI/180,ai=180/Math.PI;function vi(s){return(s%=360)<0&&(s+=360),s}function Ji([s,i,l,d]){let g,b;const w=li((.2225045*(s=Mn(s))+.7168786*(i=Mn(i))+.0606169*(l=Mn(l)))/1);s===i&&i===l?g=b=w:(g=li((.4360747*s+.3850649*i+.1430804*l)/Ue),b=li((.0139322*s+.0971045*i+.7141733*l)/Ze));const T=116*w-16;return[T<0?0:T,500*(g-w),200*(w-b),d]}function Mn(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function li(s){return s>Rt?Math.pow(s,1/3):s/ht+We}function un([s,i,l,d]){let g=(s+16)/116,b=isNaN(i)?g:g+i/500,w=isNaN(l)?g:g-l/200;return g=1*ur(g),b=Ue*ur(b),w=Ze*ur(w),[Fn(3.1338561*b-1.6168667*g-.4906146*w),Fn(-.9787684*b+1.9161415*g+.033454*w),Fn(.0719453*b-.2289914*g+1.4052427*w),d]}function Fn(s){return(s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055)<0?0:s>1?1:s}function ur(s){return s>Je?s*s*s:ht*(s-We)}function vr(s){return parseInt(s.padEnd(2,s),16)/255}function Xn(s,i){return po(i?s/100:s,0,1)}function po(s,i,l){return Math.min(Math.max(i,s),l)}function Hu(s){return!s.some(Number.isNaN)}const Ld={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class zi{constructor(i,l,d,g=1,b=!0){this.r=i,this.g=l,this.b=d,this.a=g,b||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[i,l,d,g]))}static parse(i){if(i instanceof zi)return i;if(typeof i!="string")return;const l=function(d){if((d=d.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=Ld[d];if(g){const[w,T,M]=g;return[w/255,T/255,M/255,1]}if(d.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(d)){const w=d.length<6?1:2;let T=1;return[vr(d.slice(T,T+=w)),vr(d.slice(T,T+=w)),vr(d.slice(T,T+=w)),vr(d.slice(T,T+w)||"ff")]}if(d.startsWith("rgb")){const w=d.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[T,M,A,O,U,H,K,Q,ae,_e,xe,Oe]=w,Se=[O||" ",K||" ",_e].join("");if(Se==="  "||Se==="  /"||Se===",,"||Se===",,,"){const Le=[A,H,ae].join(""),Ye=Le==="%%%"?100:Le===""?255:0;if(Ye){const tt=[po(+M/Ye,0,1),po(+U/Ye,0,1),po(+Q/Ye,0,1),xe?Xn(+xe,Oe):1];if(Hu(tt))return tt}}return}}const b=d.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[w,T,M,A,O,U,H,K,Q]=b,ae=[M||" ",O||" ",H].join("");if(ae==="  "||ae==="  /"||ae===",,"||ae===",,,"){const _e=[+T,po(+A,0,100),po(+U,0,100),K?Xn(+K,Q):1];if(Hu(_e))return function([xe,Oe,Se,Le]){function Ye(tt){const Ct=(tt+xe/30)%12,Bt=Oe*Math.min(Se,1-Se);return Se-Bt*Math.max(-1,Math.min(Ct-3,9-Ct,1))}return xe=vi(xe),Oe/=100,Se/=100,[Ye(0),Ye(8),Ye(4),Le]}(_e)}}}(i);return l?new zi(...l,!1):void 0}get rgb(){const{r:i,g:l,b:d,a:g}=this,b=g||1/0;return this.overwriteGetter("rgb",[i/b,l/b,d/b,g])}get hcl(){return this.overwriteGetter("hcl",function(i){const[l,d,g,b]=Ji(i),w=Math.sqrt(d*d+g*g);return[Math.round(1e4*w)?vi(Math.atan2(g,d)*ai):NaN,w,l,b]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ji(this.rgb))}overwriteGetter(i,l){return Object.defineProperty(this,i,{value:l}),l}toString(){const[i,l,d,g]=this.rgb;return`rgba(${[i,l,d].map(b=>Math.round(255*b)).join(",")},${g})`}}zi.black=new zi(0,0,0,1),zi.white=new zi(1,1,1,1),zi.transparent=new zi(0,0,0,0),zi.red=new zi(1,0,0,1);class oc{constructor(i,l,d){this.sensitivity=i?l?"variant":"case":l?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,l){return this.collator.compare(i,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class sc{constructor(i,l,d,g,b){this.text=i,this.image=l,this.scale=d,this.fontStack=g,this.textColor=b}}class Pr{constructor(i){this.sections=i}static fromString(i){return new Pr([new sc(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof Pr?i:Pr.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}}class br{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof br)return i;if(typeof i=="number")return new br([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const l of i)if(typeof l!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new br(i)}}toString(){return JSON.stringify(this.values)}}const aa=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Hr{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Hr)return i;if(Array.isArray(i)&&!(i.length<1)&&i.length%2==0){for(let l=0;l<i.length;l+=2){const d=i[l],g=i[l+1];if(typeof d!="string"||!aa.has(d)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new Hr(i)}}toString(){return JSON.stringify(this.values)}}class $r{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new $r({name:i,available:!1}):null}}function As(s,i,l,d){return typeof s=="number"&&s>=0&&s<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof l=="number"&&l>=0&&l<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[s,i,l,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[s,i,l,d]:[s,i,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Na(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof zi||s instanceof oc||s instanceof Pr||s instanceof br||s instanceof Hr||s instanceof $r)return!0;if(Array.isArray(s)){for(const i of s)if(!Na(i))return!1;return!0}if(typeof s=="object"){for(const i in s)if(!Na(s[i]))return!1;return!0}return!1}function In(s){if(s===null)return Vi;if(typeof s=="string")return ni;if(typeof s=="boolean")return Yt;if(typeof s=="number")return gt;if(s instanceof zi)return qi;if(s instanceof oc)return eo;if(s instanceof Pr)return cn;if(s instanceof br)return ge;if(s instanceof Hr)return X;if(s instanceof $r)return W;if(Array.isArray(s)){const i=s.length;let l;for(const d of s){const g=In(d);if(l){if(l===g)continue;l=ti;break}l=g}return ee(l||ti,i)}return yr}function la(s){const i=typeof s;return s===null?"":i==="string"||i==="number"||i==="boolean"?String(s):s instanceof zi||s instanceof Pr||s instanceof br||s instanceof Hr||s instanceof $r?s.toString():JSON.stringify(s)}class Vo{constructor(i,l){this.type=i,this.value=l}static parse(i,l){if(i.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Na(i[1]))return l.error("invalid value");const d=i[1];let g=In(d);const b=l.expectedType;return g.kind!=="array"||g.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(g=b),new Vo(g,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class nn{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const ja={string:ni,number:gt,boolean:Yt,object:yr};class zr{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let d,g=1;const b=i[0];if(b==="array"){let T,M;if(i.length>2){const A=i[1];if(typeof A!="string"||!(A in ja)||A==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);T=ja[A],g++}else T=ti;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return l.error('The length argument to "array" must be a positive integer literal',2);M=i[2],g++}d=ee(T,M)}else{if(!ja[b])throw new Error(`Types doesn't contain name = ${b}`);d=ja[b]}const w=[];for(;g<i.length;g++){const T=l.parse(i[g],g,ti);if(!T)return null;w.push(T)}return new zr(d,w)}evaluate(i){for(let l=0;l<this.args.length;l++){const d=this.args[l].evaluate(i);if(!Ie(this.type,In(d)))return d;if(l===this.args.length-1)throw new nn(`Expected value to be of type ${fe(this.type)}, but found ${fe(In(d))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const Ua={"to-boolean":Yt,"to-color":qi,"to-number":gt,"to-string":ni};class mo{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const d=i[0];if(!Ua[d])throw new Error(`Can't parse ${d} as it is not part of the known types`);if((d==="to-boolean"||d==="to-string")&&i.length!==2)return l.error("Expected one argument.");const g=Ua[d],b=[];for(let w=1;w<i.length;w++){const T=l.parse(i[w],w,ti);if(!T)return null;b.push(T)}return new mo(g,b)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let l,d;for(const g of this.args){if(l=g.evaluate(i),d=null,l instanceof zi)return l;if(typeof l=="string"){const b=i.parseColor(l);if(b)return b}else if(Array.isArray(l)&&(d=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:As(l[0],l[1],l[2],l[3]),!d))return new zi(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new nn(d||`Could not parse color from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"padding":{let l;for(const d of this.args){l=d.evaluate(i);const g=br.parse(l);if(g)return g}throw new nn(`Could not parse padding from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"variableAnchorOffsetCollection":{let l;for(const d of this.args){l=d.evaluate(i);const g=Hr.parse(l);if(g)return g}throw new nn(`Could not parse variableAnchorOffsetCollection from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"number":{let l=null;for(const d of this.args){if(l=d.evaluate(i),l===null)return 0;const g=Number(l);if(!isNaN(g))return g}throw new nn(`Could not convert ${JSON.stringify(l)} to number.`)}case"formatted":return Pr.fromString(la(this.args[0].evaluate(i)));case"resolvedImage":return $r.fromString(la(this.args[0].evaluate(i)));default:return la(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const ca=["Unknown","Point","LineString","Polygon"];class Di{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ca[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let l=this._parseColorCache[i];return l||(l=this._parseColorCache[i]=zi.parse(i)),l}}class Va{constructor(i,l,d=[],g,b=new Lo,w=[]){this.registry=i,this.path=d,this.key=d.map(T=>`[${T}]`).join(""),this.scope=b,this.errors=w,this.expectedType=g,this._isConstant=l}parse(i,l,d,g,b={}){return l?this.concat(l,d,g)._parse(i,b):this._parse(i,b)}_parse(i,l){function d(g,b,w){return w==="assert"?new zr(b,[g]):w==="coerce"?new mo(b,[g]):g}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=i[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[g];if(b){let w=b.parse(i,this);if(!w)return null;if(this.expectedType){const T=this.expectedType,M=w.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||M.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string")if(T.kind!=="padding"||M.kind!=="value"&&M.kind!=="number"&&M.kind!=="array")if(T.kind!=="variableAnchorOffsetCollection"||M.kind!=="value"&&M.kind!=="array"){if(this.checkSubtype(T,M))return null}else w=d(w,T,l.typeAnnotation||"coerce");else w=d(w,T,l.typeAnnotation||"coerce");else w=d(w,T,l.typeAnnotation||"coerce");else w=d(w,T,l.typeAnnotation||"assert")}if(!(w instanceof Vo)&&w.type.kind!=="resolvedImage"&&this._isConstant(w)){const T=new Di;try{w=new Vo(w.type,w.evaluate(T))}catch(M){return this.error(M.message),null}}return w}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,l,d){const g=typeof i=="number"?this.path.concat(i):this.path,b=d?this.scope.concat(d):this.scope;return new Va(this.registry,this._isConstant,g,l||null,b,this.errors)}error(i,...l){const d=`${this.key}${l.map(g=>`[${g}]`).join("")}`;this.errors.push(new xn(d,i))}checkSubtype(i,l){const d=Ie(i,l);return d&&this.error(d),d}}class Ps{constructor(i,l,d){this.type=eo,this.locale=d,this.caseSensitive=i,this.diacriticSensitive=l}static parse(i,l){if(i.length!==2)return l.error("Expected one argument.");const d=i[1];if(typeof d!="object"||Array.isArray(d))return l.error("Collator options argument must be an object.");const g=l.parse(d["case-sensitive"]!==void 0&&d["case-sensitive"],1,Yt);if(!g)return null;const b=l.parse(d["diacritic-sensitive"]!==void 0&&d["diacritic-sensitive"],1,Yt);if(!b)return null;let w=null;return d.locale&&(w=l.parse(d.locale,1,ni),!w)?null:new Ps(g,b,w)}evaluate(i){return new oc(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}const qo=8192;function qa(s,i){s[0]=Math.min(s[0],i[0]),s[1]=Math.min(s[1],i[1]),s[2]=Math.max(s[2],i[0]),s[3]=Math.max(s[3],i[1])}function ua(s,i){return!(s[0]<=i[0]||s[2]>=i[2]||s[1]<=i[1]||s[3]>=i[3])}function Ad(s,i){const l=(180+s[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,g=Math.pow(2,i.z);return[Math.round(l*g*qo),Math.round(d*g*qo)]}function $u(s,i,l){const d=s[0]-i[0],g=s[1]-i[1],b=s[0]-l[0],w=s[1]-l[1];return d*w-b*g==0&&d*b<=0&&g*w<=0}function Za(s,i){let l=!1;for(let w=0,T=i.length;w<T;w++){const M=i[w];for(let A=0,O=M.length;A<O-1;A++){if($u(s,M[A],M[A+1]))return!1;(g=M[A])[1]>(d=s)[1]!=(b=M[A+1])[1]>d[1]&&d[0]<(b[0]-g[0])*(d[1]-g[1])/(b[1]-g[1])+g[0]&&(l=!l)}}var d,g,b;return l}function Pd(s,i){for(let l=0;l<i.length;l++)if(Za(s,i[l]))return!0;return!1}function Xu(s,i,l,d){const g=d[0]-l[0],b=d[1]-l[1],w=(s[0]-l[0])*b-g*(s[1]-l[1]),T=(i[0]-l[0])*b-g*(i[1]-l[1]);return w>0&&T<0||w<0&&T>0}function zd(s,i,l){for(const A of l)for(let O=0;O<A.length-1;++O)if((T=[(w=A[O+1])[0]-(b=A[O])[0],w[1]-b[1]])[0]*(M=[(g=i)[0]-(d=s)[0],g[1]-d[1]])[1]-T[1]*M[0]!=0&&Xu(d,g,b,w)&&Xu(b,w,d,g))return!0;var d,g,b,w,T,M;return!1}function Ku(s,i){for(let l=0;l<s.length;++l)if(!Za(s[l],i))return!1;for(let l=0;l<s.length-1;++l)if(zd(s[l],s[l+1],i))return!1;return!0}function Ju(s,i){for(let l=0;l<i.length;l++)if(Ku(s,i[l]))return!0;return!1}function Ga(s,i,l){const d=[];for(let g=0;g<s.length;g++){const b=[];for(let w=0;w<s[g].length;w++){const T=Ad(s[g][w],l);qa(i,T),b.push(T)}d.push(b)}return d}function Yu(s,i,l){const d=[];for(let g=0;g<s.length;g++){const b=Ga(s[g],i,l);d.push(b)}return d}function Qu(s,i,l,d){if(s[0]<l[0]||s[0]>l[2]){const g=.5*d;let b=s[0]-l[0]>g?-d:l[0]-s[0]>g?d:0;b===0&&(b=s[0]-l[2]>g?-d:l[2]-s[0]>g?d:0),s[0]+=b}qa(i,s)}function Wa(s,i,l,d){const g=Math.pow(2,d.z)*qo,b=[d.x*qo,d.y*qo],w=[];for(const T of s)for(const M of T){const A=[M.x+b[0],M.y+b[1]];Qu(A,i,l,g),w.push(A)}return w}function eh(s,i,l,d){const g=Math.pow(2,d.z)*qo,b=[d.x*qo,d.y*qo],w=[];for(const M of s){const A=[];for(const O of M){const U=[O.x+b[0],O.y+b[1]];qa(i,U),A.push(U)}w.push(A)}if(i[2]-i[0]<=g/2){(T=i)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const M of w)for(const A of M)Qu(A,i,l,g)}var T;return w}class rs{constructor(i,l){this.type=Yt,this.geojson=i,this.geometries=l}static parse(i,l){if(i.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Na(i[1])){const d=i[1];if(d.type==="FeatureCollection"){const g=[];for(const b of d.features){const{type:w,coordinates:T}=b.geometry;w==="Polygon"&&g.push(T),w==="MultiPolygon"&&g.push(...T)}if(g.length)return new rs(d,{type:"MultiPolygon",coordinates:g})}else if(d.type==="Feature"){const g=d.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new rs(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new rs(d,d)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(l,d){const g=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],w=l.canonicalID();if(d.type==="Polygon"){const T=Ga(d.coordinates,b,w),M=Wa(l.geometry(),g,b,w);if(!ua(g,b))return!1;for(const A of M)if(!Za(A,T))return!1}if(d.type==="MultiPolygon"){const T=Yu(d.coordinates,b,w),M=Wa(l.geometry(),g,b,w);if(!ua(g,b))return!1;for(const A of M)if(!Pd(A,T))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(l,d){const g=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],w=l.canonicalID();if(d.type==="Polygon"){const T=Ga(d.coordinates,b,w),M=eh(l.geometry(),g,b,w);if(!ua(g,b))return!1;for(const A of M)if(!Ku(A,T))return!1}if(d.type==="MultiPolygon"){const T=Yu(d.coordinates,b,w),M=eh(l.geometry(),g,b,w);if(!ua(g,b))return!1;for(const A of M)if(!Ju(A,T))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Ha{constructor(i,l){this.type=l.type,this.name=i,this.boundExpression=l}static parse(i,l){if(i.length!==2||typeof i[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const d=i[1];return l.scope.has(d)?new Ha(d,l.scope.get(d)):l.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class Dr{constructor(i,l,d,g){this.name=i,this.type=l,this._evaluate=d,this.args=g}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,l){const d=i[0],g=Dr.definitions[d];if(!g)return l.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(g)?g[0]:g.type,w=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,T=w.filter(([A])=>!Array.isArray(A)||A.length===i.length-1);let M=null;for(const[A,O]of T){M=new Va(l.registry,ha,l.path,null,l.scope);const U=[];let H=!1;for(let K=1;K<i.length;K++){const Q=i[K],ae=Array.isArray(A)?A[K-1]:A.type,_e=M.parse(Q,1+U.length,ae);if(!_e){H=!0;break}U.push(_e)}if(!H)if(Array.isArray(A)&&A.length!==U.length)M.error(`Expected ${A.length} arguments, but found ${U.length} instead.`);else{for(let K=0;K<U.length;K++){const Q=Array.isArray(A)?A[K]:A.type,ae=U[K];M.concat(K+1).checkSubtype(Q,ae.type)}if(M.errors.length===0)return new Dr(d,b,O,U)}}if(T.length===1)l.errors.push(...M.errors);else{const A=(T.length?T:w).map(([U])=>{return H=U,Array.isArray(H)?`(${H.map(fe).join(", ")})`:`(${fe(H.type)}...)`;var H}).join(" | "),O=[];for(let U=1;U<i.length;U++){const H=l.parse(i[U],1+O.length);if(!H)return null;O.push(fe(H.type))}l.error(`Expected arguments of type ${A}, but found (${O.join(", ")}) instead.`)}return null}static register(i,l){Dr.definitions=l;for(const d in l)i[d]=Dr}}function ha(s){if(s instanceof Ha)return ha(s.boundExpression);if(s instanceof Dr&&s.name==="error"||s instanceof Ps||s instanceof rs)return!1;const i=s instanceof mo||s instanceof zr;let l=!0;return s.eachChild(d=>{l=i?l&&ha(d):l&&d instanceof Vo}),!!l&&$a(s)&&fa(s,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function $a(s){if(s instanceof Dr&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof rs)return!1;let i=!0;return s.eachChild(l=>{i&&!$a(l)&&(i=!1)}),i}function da(s){if(s instanceof Dr&&s.name==="feature-state")return!1;let i=!0;return s.eachChild(l=>{i&&!da(l)&&(i=!1)}),i}function fa(s,i){if(s instanceof Dr&&i.indexOf(s.name)>=0)return!1;let l=!0;return s.eachChild(d=>{l&&!fa(d,i)&&(l=!1)}),l}function pa(s,i){const l=s.length-1;let d,g,b=0,w=l,T=0;for(;b<=w;)if(T=Math.floor((b+w)/2),d=s[T],g=s[T+1],d<=i){if(T===l||i<g)return T;b=T+1}else{if(!(d>i))throw new nn("Input is not a number.");w=T-1}return 0}class ma{constructor(i,l,d){this.type=i,this.input=l,this.labels=[],this.outputs=[];for(const[g,b]of d)this.labels.push(g),this.outputs.push(b)}static parse(i,l){if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");const d=l.parse(i[1],1,gt);if(!d)return null;const g=[];let b=null;l.expectedType&&l.expectedType.kind!=="value"&&(b=l.expectedType);for(let w=1;w<i.length;w+=2){const T=w===1?-1/0:i[w],M=i[w+1],A=w,O=w+1;if(typeof T!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(g.length&&g[g.length-1][0]>=T)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const U=l.parse(M,O,b);if(!U)return null;b=b||U.type,g.push([T,U])}return new ma(b,d,g)}evaluate(i){const l=this.labels,d=this.outputs;if(l.length===1)return d[0].evaluate(i);const g=this.input.evaluate(i);if(g<=l[0])return d[0].evaluate(i);const b=l.length;return g>=l[b-1]?d[b-1].evaluate(i):d[pa(l,g)].evaluate(i)}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Dd(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Rd=th;function th(s,i,l,d){this.cx=3*s,this.bx=3*(l-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(d-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=l,this.p2y=d}th.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(i===void 0&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var l=s,d=0;d<8;d++){var g=this.sampleCurveX(l)-s;if(Math.abs(g)<i)return l;var b=this.sampleCurveDerivativeX(l);if(Math.abs(b)<1e-6)break;l-=g/b}var w=0,T=1;for(l=s,d=0;d<20&&(g=this.sampleCurveX(l),!(Math.abs(g-s)<i));d++)s>g?w=l:T=l,l=.5*(T-w)+w;return l},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}};var Bd=Dd(Rd);function os(s,i,l){return s+l*(i-s)}function Xa(s,i,l){return s.map((d,g)=>os(d,i[g],l))}const hr={number:os,color:function(s,i,l,d="rgb"){switch(d){case"rgb":{const[g,b,w,T]=Xa(s.rgb,i.rgb,l);return new zi(g,b,w,T,!1)}case"hcl":{const[g,b,w,T]=s.hcl,[M,A,O,U]=i.hcl;let H,K;if(isNaN(g)||isNaN(M))isNaN(g)?isNaN(M)?H=NaN:(H=M,w!==1&&w!==0||(K=A)):(H=g,O!==1&&O!==0||(K=b));else{let Oe=M-g;M>g&&Oe>180?Oe-=360:M<g&&g-M>180&&(Oe+=360),H=g+l*Oe}const[Q,ae,_e,xe]=function([Oe,Se,Le,Ye]){return Oe=isNaN(Oe)?0:Oe*Xt,un([Le,Math.cos(Oe)*Se,Math.sin(Oe)*Se,Ye])}([H,K??os(b,A,l),os(w,O,l),os(T,U,l)]);return new zi(Q,ae,_e,xe,!1)}case"lab":{const[g,b,w,T]=un(Xa(s.lab,i.lab,l));return new zi(g,b,w,T,!1)}}},array:Xa,padding:function(s,i,l){return new br(Xa(s.values,i.values,l))},variableAnchorOffsetCollection:function(s,i,l){const d=s.values,g=i.values;if(d.length!==g.length)throw new nn(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${i.toString()}`);const b=[];for(let w=0;w<d.length;w+=2){if(d[w]!==g[w])throw new nn(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${d[w]}, to[${w}]: ${g[w]}`);b.push(d[w]);const[T,M]=d[w+1],[A,O]=g[w+1];b.push([os(T,A,l),os(M,O,l)])}return new Hr(b)}};class nr{constructor(i,l,d,g,b){this.type=i,this.operator=l,this.interpolation=d,this.input=g,this.labels=[],this.outputs=[];for(const[w,T]of b)this.labels.push(w),this.outputs.push(T)}static interpolationFactor(i,l,d,g){let b=0;if(i.name==="exponential")b=Mi(l,i.base,d,g);else if(i.name==="linear")b=Mi(l,1,d,g);else if(i.name==="cubic-bezier"){const w=i.controlPoints;b=new Bd(w[0],w[1],w[2],w[3]).solve(Mi(l,1,d,g))}return b}static parse(i,l){let[d,g,b,...w]=i;if(!Array.isArray(g)||g.length===0)return l.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const A=g[1];if(typeof A!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:A}}else{if(g[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const A=g.slice(1);if(A.length!==4||A.some(O=>typeof O!="number"||O<0||O>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:A}}}if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(b=l.parse(b,2,gt),!b)return null;const T=[];let M=null;d==="interpolate-hcl"||d==="interpolate-lab"?M=qi:l.expectedType&&l.expectedType.kind!=="value"&&(M=l.expectedType);for(let A=0;A<w.length;A+=2){const O=w[A],U=w[A+1],H=A+3,K=A+4;if(typeof O!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',H);if(T.length&&T[T.length-1][0]>=O)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',H);const Q=l.parse(U,K,M);if(!Q)return null;M=M||Q.type,T.push([O,Q])}return G(M,gt)||G(M,qi)||G(M,ge)||G(M,X)||G(M,ee(gt))?new nr(M,d,g,b,T):l.error(`Type ${fe(M)} is not interpolatable.`)}evaluate(i){const l=this.labels,d=this.outputs;if(l.length===1)return d[0].evaluate(i);const g=this.input.evaluate(i);if(g<=l[0])return d[0].evaluate(i);const b=l.length;if(g>=l[b-1])return d[b-1].evaluate(i);const w=pa(l,g),T=nr.interpolationFactor(this.interpolation,g,l[w],l[w+1]),M=d[w].evaluate(i),A=d[w+1].evaluate(i);switch(this.operator){case"interpolate":return hr[this.type.kind](M,A,T);case"interpolate-hcl":return hr.color(M,A,T,"hcl");case"interpolate-lab":return hr.color(M,A,T,"lab")}}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Mi(s,i,l,d){const g=d-l,b=s-l;return g===0?0:i===1?b/g:(Math.pow(i,b)-1)/(Math.pow(i,g)-1)}class Ka{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expectected at least one argument.");let d=null;const g=l.expectedType;g&&g.kind!=="value"&&(d=g);const b=[];for(const T of i.slice(1)){const M=l.parse(T,1+b.length,d,void 0,{typeAnnotation:"omit"});if(!M)return null;d=d||M.type,b.push(M)}if(!d)throw new Error("No output type");const w=g&&b.some(T=>Ie(g,T.type));return new Ka(w?ti:d,b)}evaluate(i){let l,d=null,g=0;for(const b of this.args)if(g++,d=b.evaluate(i),d&&d instanceof $r&&!d.available&&(l||(l=d.name),d=null,g===this.args.length&&(d=l)),d!==null)break;return d}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}class Ja{constructor(i,l){this.type=l.type,this.bindings=[].concat(i),this.result=l}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const l of this.bindings)i(l[1]);i(this.result)}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const d=[];for(let b=1;b<i.length-1;b+=2){const w=i[b];if(typeof w!="string")return l.error(`Expected string, but found ${typeof w} instead.`,b);if(/[^a-zA-Z0-9_]/.test(w))return l.error("Variable names must contain only alphanumeric characters or '_'.",b);const T=l.parse(i[b+1],b+1);if(!T)return null;d.push([w,T])}const g=l.parse(i[i.length-1],i.length-1,l.expectedType,d);return g?new Ja(d,g):null}outputDefined(){return this.result.outputDefined()}}class ac{constructor(i,l,d){this.type=i,this.index=l,this.input=d}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=l.parse(i[1],1,gt),g=l.parse(i[2],2,ee(l.expectedType||ti));return d&&g?new ac(g.type.itemType,d,g):null}evaluate(i){const l=this.index.evaluate(i),d=this.input.evaluate(i);if(l<0)throw new nn(`Array index out of bounds: ${l} < 0.`);if(l>=d.length)throw new nn(`Array index out of bounds: ${l} > ${d.length-1}.`);if(l!==Math.floor(l))throw new nn(`Array index must be an integer, but found ${l} instead.`);return d[l]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class lc{constructor(i,l){this.type=Yt,this.needle=i,this.haystack=l}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=l.parse(i[1],1,ti),g=l.parse(i[2],2,ti);return d&&g?Pe(d.type,[Yt,ni,gt,Vi,ti])?new lc(d,g):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${fe(d.type)} instead`):null}evaluate(i){const l=this.needle.evaluate(i),d=this.haystack.evaluate(i);if(!d)return!1;if(!ke(l,["boolean","string","number","null"]))throw new nn(`Expected first argument to be of type boolean, string, number or null, but found ${fe(In(l))} instead.`);if(!ke(d,["string","array"]))throw new nn(`Expected second argument to be of type array or string, but found ${fe(In(d))} instead.`);return d.indexOf(l)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class Ya{constructor(i,l,d){this.type=gt,this.needle=i,this.haystack=l,this.fromIndex=d}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const d=l.parse(i[1],1,ti),g=l.parse(i[2],2,ti);if(!d||!g)return null;if(!Pe(d.type,[Yt,ni,gt,Vi,ti]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${fe(d.type)} instead`);if(i.length===4){const b=l.parse(i[3],3,gt);return b?new Ya(d,g,b):null}return new Ya(d,g)}evaluate(i){const l=this.needle.evaluate(i),d=this.haystack.evaluate(i);if(!ke(l,["boolean","string","number","null"]))throw new nn(`Expected first argument to be of type boolean, string, number or null, but found ${fe(In(l))} instead.`);if(!ke(d,["string","array"]))throw new nn(`Expected second argument to be of type array or string, but found ${fe(In(d))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(i);return d.indexOf(l,g)}return d.indexOf(l)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class cc{constructor(i,l,d,g,b,w){this.inputType=i,this.type=l,this.input=d,this.cases=g,this.outputs=b,this.otherwise=w}static parse(i,l){if(i.length<5)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return l.error("Expected an even number of arguments.");let d,g;l.expectedType&&l.expectedType.kind!=="value"&&(g=l.expectedType);const b={},w=[];for(let A=2;A<i.length-1;A+=2){let O=i[A];const U=i[A+1];Array.isArray(O)||(O=[O]);const H=l.concat(A);if(O.length===0)return H.error("Expected at least one branch label.");for(const Q of O){if(typeof Q!="number"&&typeof Q!="string")return H.error("Branch labels must be numbers or strings.");if(typeof Q=="number"&&Math.abs(Q)>Number.MAX_SAFE_INTEGER)return H.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Q=="number"&&Math.floor(Q)!==Q)return H.error("Numeric branch labels must be integer values.");if(d){if(H.checkSubtype(d,In(Q)))return null}else d=In(Q);if(b[String(Q)]!==void 0)return H.error("Branch labels must be unique.");b[String(Q)]=w.length}const K=l.parse(U,A,g);if(!K)return null;g=g||K.type,w.push(K)}const T=l.parse(i[1],1,ti);if(!T)return null;const M=l.parse(i[i.length-1],i.length-1,g);return M?T.type.kind!=="value"&&l.concat(1).checkSubtype(d,T.type)?null:new cc(d,g,T,b,w,M):null}evaluate(i){const l=this.input.evaluate(i);return(In(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}}class uc{constructor(i,l,d){this.type=i,this.branches=l,this.otherwise=d}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return l.error("Expected an odd number of arguments.");let d;l.expectedType&&l.expectedType.kind!=="value"&&(d=l.expectedType);const g=[];for(let w=1;w<i.length-1;w+=2){const T=l.parse(i[w],w,Yt);if(!T)return null;const M=l.parse(i[w+1],w+1,d);if(!M)return null;g.push([T,M]),d=d||M.type}const b=l.parse(i[i.length-1],i.length-1,d);if(!b)return null;if(!d)throw new Error("Can't infer output type");return new uc(d,g,b)}evaluate(i){for(const[l,d]of this.branches)if(l.evaluate(i))return d.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[l,d]of this.branches)i(l),i(d);i(this.otherwise)}outputDefined(){return this.branches.every(([i,l])=>l.outputDefined())&&this.otherwise.outputDefined()}}class Qa{constructor(i,l,d,g){this.type=i,this.input=l,this.beginIndex=d,this.endIndex=g}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const d=l.parse(i[1],1,ti),g=l.parse(i[2],2,gt);if(!d||!g)return null;if(!Pe(d.type,[ee(ti),ni,ti]))return l.error(`Expected first argument to be of type array or string, but found ${fe(d.type)} instead`);if(i.length===4){const b=l.parse(i[3],3,gt);return b?new Qa(d.type,d,g,b):null}return new Qa(d.type,d,g)}evaluate(i){const l=this.input.evaluate(i),d=this.beginIndex.evaluate(i);if(!ke(l,["string","array"]))throw new nn(`Expected first argument to be of type array or string, but found ${fe(In(l))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(i);return l.slice(d,g)}return l.slice(d)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function ih(s,i){return s==="=="||s==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function nh(s,i,l,d){return d.compare(i,l)===0}function zs(s,i,l){const d=s!=="=="&&s!=="!=";return class Ky{constructor(b,w,T){this.type=Yt,this.lhs=b,this.rhs=w,this.collator=T,this.hasUntypedArgument=b.type.kind==="value"||w.type.kind==="value"}static parse(b,w){if(b.length!==3&&b.length!==4)return w.error("Expected two or three arguments.");const T=b[0];let M=w.parse(b[1],1,ti);if(!M)return null;if(!ih(T,M.type))return w.concat(1).error(`"${T}" comparisons are not supported for type '${fe(M.type)}'.`);let A=w.parse(b[2],2,ti);if(!A)return null;if(!ih(T,A.type))return w.concat(2).error(`"${T}" comparisons are not supported for type '${fe(A.type)}'.`);if(M.type.kind!==A.type.kind&&M.type.kind!=="value"&&A.type.kind!=="value")return w.error(`Cannot compare types '${fe(M.type)}' and '${fe(A.type)}'.`);d&&(M.type.kind==="value"&&A.type.kind!=="value"?M=new zr(A.type,[M]):M.type.kind!=="value"&&A.type.kind==="value"&&(A=new zr(M.type,[A])));let O=null;if(b.length===4){if(M.type.kind!=="string"&&A.type.kind!=="string"&&M.type.kind!=="value"&&A.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(O=w.parse(b[3],3,eo),!O)return null}return new Ky(M,A,O)}evaluate(b){const w=this.lhs.evaluate(b),T=this.rhs.evaluate(b);if(d&&this.hasUntypedArgument){const M=In(w),A=In(T);if(M.kind!==A.kind||M.kind!=="string"&&M.kind!=="number")throw new nn(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${M.kind}, ${A.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const M=In(w),A=In(T);if(M.kind!=="string"||A.kind!=="string")return i(b,w,T)}return this.collator?l(b,w,T,this.collator.evaluate(b)):i(b,w,T)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}}}const Fd=zs("==",function(s,i,l){return i===l},nh),Od=zs("!=",function(s,i,l){return i!==l},function(s,i,l,d){return!nh(0,i,l,d)}),Nd=zs("<",function(s,i,l){return i<l},function(s,i,l,d){return d.compare(i,l)<0}),jd=zs(">",function(s,i,l){return i>l},function(s,i,l,d){return d.compare(i,l)>0}),Ud=zs("<=",function(s,i,l){return i<=l},function(s,i,l,d){return d.compare(i,l)<=0}),Vd=zs(">=",function(s,i,l){return i>=l},function(s,i,l,d){return d.compare(i,l)>=0});class hc{constructor(i,l,d,g,b){this.type=ni,this.number=i,this.locale=l,this.currency=d,this.minFractionDigits=g,this.maxFractionDigits=b}static parse(i,l){if(i.length!==3)return l.error("Expected two arguments.");const d=l.parse(i[1],1,gt);if(!d)return null;const g=i[2];if(typeof g!="object"||Array.isArray(g))return l.error("NumberFormat options argument must be an object.");let b=null;if(g.locale&&(b=l.parse(g.locale,1,ni),!b))return null;let w=null;if(g.currency&&(w=l.parse(g.currency,1,ni),!w))return null;let T=null;if(g["min-fraction-digits"]&&(T=l.parse(g["min-fraction-digits"],1,gt),!T))return null;let M=null;return g["max-fraction-digits"]&&(M=l.parse(g["max-fraction-digits"],1,gt),!M)?null:new hc(d,b,w,T,M)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class el{constructor(i){this.type=cn,this.sections=i}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const d=i[1];if(!Array.isArray(d)&&typeof d=="object")return l.error("First argument must be an image or text section.");const g=[];let b=!1;for(let w=1;w<=i.length-1;++w){const T=i[w];if(b&&typeof T=="object"&&!Array.isArray(T)){b=!1;let M=null;if(T["font-scale"]&&(M=l.parse(T["font-scale"],1,gt),!M))return null;let A=null;if(T["text-font"]&&(A=l.parse(T["text-font"],1,ee(ni)),!A))return null;let O=null;if(T["text-color"]&&(O=l.parse(T["text-color"],1,qi),!O))return null;const U=g[g.length-1];U.scale=M,U.font=A,U.textColor=O}else{const M=l.parse(i[w],1,ti);if(!M)return null;const A=M.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,g.push({content:M,scale:null,font:null,textColor:null})}}return new el(g)}evaluate(i){return new Pr(this.sections.map(l=>{const d=l.content.evaluate(i);return In(d)===W?new sc("",d,null,null,null):new sc(la(d),null,l.scale?l.scale.evaluate(i):null,l.font?l.font.evaluate(i).join(","):null,l.textColor?l.textColor.evaluate(i):null)}))}eachChild(i){for(const l of this.sections)i(l.content),l.scale&&i(l.scale),l.font&&i(l.font),l.textColor&&i(l.textColor)}outputDefined(){return!1}}class dc{constructor(i){this.type=W,this.input=i}static parse(i,l){if(i.length!==2)return l.error("Expected two arguments.");const d=l.parse(i[1],1,ni);return d?new dc(d):l.error("No image name provided.")}evaluate(i){const l=this.input.evaluate(i),d=$r.fromString(l);return d&&i.availableImages&&(d.available=i.availableImages.indexOf(l)>-1),d}eachChild(i){i(this.input)}outputDefined(){return!1}}class fc{constructor(i){this.type=gt,this.input=i}static parse(i,l){if(i.length!==2)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);const d=l.parse(i[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${fe(d.type)} instead.`):new fc(d):null}evaluate(i){const l=this.input.evaluate(i);if(typeof l=="string"||Array.isArray(l))return l.length;throw new nn(`Expected value to be of type string or array, but found ${fe(In(l))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const Ds={"==":Fd,"!=":Od,">":jd,"<":Nd,">=":Vd,"<=":Ud,array:zr,at:ac,boolean:zr,case:uc,coalesce:Ka,collator:Ps,format:el,image:dc,in:lc,"index-of":Ya,interpolate:nr,"interpolate-hcl":nr,"interpolate-lab":nr,length:fc,let:Ja,literal:Vo,match:cc,number:zr,"number-format":hc,object:zr,slice:Qa,step:ma,string:zr,"to-boolean":mo,"to-color":mo,"to-number":mo,"to-string":mo,var:Ha,within:rs};function rh(s,[i,l,d,g]){i=i.evaluate(s),l=l.evaluate(s),d=d.evaluate(s);const b=g?g.evaluate(s):1,w=As(i,l,d,b);if(w)throw new nn(w);return new zi(i/255,l/255,d/255,b,!1)}function oh(s,i){return s in i}function pc(s,i){const l=i[s];return l===void 0?null:l}function ss(s){return{type:s}}function sh(s){return{result:"success",value:s}}function Rs(s){return{result:"error",value:s}}function Bs(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function ah(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function mc(s){return!!s.expression&&s.expression.interpolated}function Ei(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function tl(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function qd(s){return s}function lh(s,i){const l=i.type==="color",d=s.stops&&typeof s.stops[0][0]=="object",g=d||!(d||s.property!==void 0),b=s.type||(mc(i)?"exponential":"interval");if(l||i.type==="padding"){const O=l?zi.parse:br.parse;(s=$n({},s)).stops&&(s.stops=s.stops.map(U=>[U[0],O(U[1])])),s.default=O(s.default?s.default:i.default)}if(s.colorSpace&&(w=s.colorSpace)!=="rgb"&&w!=="hcl"&&w!=="lab")throw new Error(`Unknown color space: "${s.colorSpace}"`);var w;let T,M,A;if(b==="exponential")T=ki;else if(b==="interval")T=Zd;else if(b==="categorical"){T=kn,M=Object.create(null);for(const O of s.stops)M[O[0]]=O[1];A=typeof s.stops[0][0]}else{if(b!=="identity")throw new Error(`Unknown function type "${b}"`);T=gc}if(d){const O={},U=[];for(let Q=0;Q<s.stops.length;Q++){const ae=s.stops[Q],_e=ae[0].zoom;O[_e]===void 0&&(O[_e]={zoom:_e,type:s.type,property:s.property,default:s.default,stops:[]},U.push(_e)),O[_e].stops.push([ae[0].value,ae[1]])}const H=[];for(const Q of U)H.push([O[Q].zoom,lh(O[Q],i)]);const K={name:"linear"};return{kind:"composite",interpolationType:K,interpolationFactor:nr.interpolationFactor.bind(void 0,K),zoomStops:H.map(Q=>Q[0]),evaluate:({zoom:Q},ae)=>ki({stops:H,base:s.base},i,Q).evaluate(Q,ae)}}if(g){const O=b==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:O,interpolationFactor:nr.interpolationFactor.bind(void 0,O),zoomStops:s.stops.map(U=>U[0]),evaluate:({zoom:U})=>T(s,i,U,M,A)}}return{kind:"source",evaluate(O,U){const H=U&&U.properties?U.properties[s.property]:void 0;return H===void 0?ga(s.default,i.default):T(s,i,H,M,A)}}}function ga(s,i,l){return s!==void 0?s:i!==void 0?i:l!==void 0?l:void 0}function kn(s,i,l,d,g){return ga(typeof l===g?d[l]:void 0,s.default,i.default)}function Zd(s,i,l){if(Ei(l)!=="number")return ga(s.default,i.default);const d=s.stops.length;if(d===1||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[d-1][0])return s.stops[d-1][1];const g=pa(s.stops.map(b=>b[0]),l);return s.stops[g][1]}function ki(s,i,l){const d=s.base!==void 0?s.base:1;if(Ei(l)!=="number")return ga(s.default,i.default);const g=s.stops.length;if(g===1||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[g-1][0])return s.stops[g-1][1];const b=pa(s.stops.map(O=>O[0]),l),w=function(O,U,H,K){const Q=K-H,ae=O-H;return Q===0?0:U===1?ae/Q:(Math.pow(U,ae)-1)/(Math.pow(U,Q)-1)}(l,d,s.stops[b][0],s.stops[b+1][0]),T=s.stops[b][1],M=s.stops[b+1][1],A=hr[i.type]||qd;return typeof T.evaluate=="function"?{evaluate(...O){const U=T.evaluate.apply(void 0,O),H=M.evaluate.apply(void 0,O);if(U!==void 0&&H!==void 0)return A(U,H,w,s.colorSpace)}}:A(T,M,w,s.colorSpace)}function gc(s,i,l){switch(i.type){case"color":l=zi.parse(l);break;case"formatted":l=Pr.fromString(l.toString());break;case"resolvedImage":l=$r.fromString(l.toString());break;case"padding":l=br.parse(l);break;default:Ei(l)===i.type||i.type==="enum"&&i.values[l]||(l=void 0)}return ga(l,s.default,i.default)}Dr.register(Ds,{error:[{kind:"error"},[ni],(s,[i])=>{throw new nn(i.evaluate(s))}],typeof:[ni,[ti],(s,[i])=>fe(In(i.evaluate(s)))],"to-rgba":[ee(gt,4),[qi],(s,[i])=>{const[l,d,g,b]=i.evaluate(s).rgb;return[255*l,255*d,255*g,b]}],rgb:[qi,[gt,gt,gt],rh],rgba:[qi,[gt,gt,gt,gt],rh],has:{type:Yt,overloads:[[[ni],(s,[i])=>oh(i.evaluate(s),s.properties())],[[ni,yr],(s,[i,l])=>oh(i.evaluate(s),l.evaluate(s))]]},get:{type:ti,overloads:[[[ni],(s,[i])=>pc(i.evaluate(s),s.properties())],[[ni,yr],(s,[i,l])=>pc(i.evaluate(s),l.evaluate(s))]]},"feature-state":[ti,[ni],(s,[i])=>pc(i.evaluate(s),s.featureState||{})],properties:[yr,[],s=>s.properties()],"geometry-type":[ni,[],s=>s.geometryType()],id:[ti,[],s=>s.id()],zoom:[gt,[],s=>s.globals.zoom],"heatmap-density":[gt,[],s=>s.globals.heatmapDensity||0],"line-progress":[gt,[],s=>s.globals.lineProgress||0],accumulated:[ti,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[gt,ss(gt),(s,i)=>{let l=0;for(const d of i)l+=d.evaluate(s);return l}],"*":[gt,ss(gt),(s,i)=>{let l=1;for(const d of i)l*=d.evaluate(s);return l}],"-":{type:gt,overloads:[[[gt,gt],(s,[i,l])=>i.evaluate(s)-l.evaluate(s)],[[gt],(s,[i])=>-i.evaluate(s)]]},"/":[gt,[gt,gt],(s,[i,l])=>i.evaluate(s)/l.evaluate(s)],"%":[gt,[gt,gt],(s,[i,l])=>i.evaluate(s)%l.evaluate(s)],ln2:[gt,[],()=>Math.LN2],pi:[gt,[],()=>Math.PI],e:[gt,[],()=>Math.E],"^":[gt,[gt,gt],(s,[i,l])=>Math.pow(i.evaluate(s),l.evaluate(s))],sqrt:[gt,[gt],(s,[i])=>Math.sqrt(i.evaluate(s))],log10:[gt,[gt],(s,[i])=>Math.log(i.evaluate(s))/Math.LN10],ln:[gt,[gt],(s,[i])=>Math.log(i.evaluate(s))],log2:[gt,[gt],(s,[i])=>Math.log(i.evaluate(s))/Math.LN2],sin:[gt,[gt],(s,[i])=>Math.sin(i.evaluate(s))],cos:[gt,[gt],(s,[i])=>Math.cos(i.evaluate(s))],tan:[gt,[gt],(s,[i])=>Math.tan(i.evaluate(s))],asin:[gt,[gt],(s,[i])=>Math.asin(i.evaluate(s))],acos:[gt,[gt],(s,[i])=>Math.acos(i.evaluate(s))],atan:[gt,[gt],(s,[i])=>Math.atan(i.evaluate(s))],min:[gt,ss(gt),(s,i)=>Math.min(...i.map(l=>l.evaluate(s)))],max:[gt,ss(gt),(s,i)=>Math.max(...i.map(l=>l.evaluate(s)))],abs:[gt,[gt],(s,[i])=>Math.abs(i.evaluate(s))],round:[gt,[gt],(s,[i])=>{const l=i.evaluate(s);return l<0?-Math.round(-l):Math.round(l)}],floor:[gt,[gt],(s,[i])=>Math.floor(i.evaluate(s))],ceil:[gt,[gt],(s,[i])=>Math.ceil(i.evaluate(s))],"filter-==":[Yt,[ni,ti],(s,[i,l])=>s.properties()[i.value]===l.value],"filter-id-==":[Yt,[ti],(s,[i])=>s.id()===i.value],"filter-type-==":[Yt,[ni],(s,[i])=>s.geometryType()===i.value],"filter-<":[Yt,[ni,ti],(s,[i,l])=>{const d=s.properties()[i.value],g=l.value;return typeof d==typeof g&&d<g}],"filter-id-<":[Yt,[ti],(s,[i])=>{const l=s.id(),d=i.value;return typeof l==typeof d&&l<d}],"filter->":[Yt,[ni,ti],(s,[i,l])=>{const d=s.properties()[i.value],g=l.value;return typeof d==typeof g&&d>g}],"filter-id->":[Yt,[ti],(s,[i])=>{const l=s.id(),d=i.value;return typeof l==typeof d&&l>d}],"filter-<=":[Yt,[ni,ti],(s,[i,l])=>{const d=s.properties()[i.value],g=l.value;return typeof d==typeof g&&d<=g}],"filter-id-<=":[Yt,[ti],(s,[i])=>{const l=s.id(),d=i.value;return typeof l==typeof d&&l<=d}],"filter->=":[Yt,[ni,ti],(s,[i,l])=>{const d=s.properties()[i.value],g=l.value;return typeof d==typeof g&&d>=g}],"filter-id->=":[Yt,[ti],(s,[i])=>{const l=s.id(),d=i.value;return typeof l==typeof d&&l>=d}],"filter-has":[Yt,[ti],(s,[i])=>i.value in s.properties()],"filter-has-id":[Yt,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Yt,[ee(ni)],(s,[i])=>i.value.indexOf(s.geometryType())>=0],"filter-id-in":[Yt,[ee(ti)],(s,[i])=>i.value.indexOf(s.id())>=0],"filter-in-small":[Yt,[ni,ee(ti)],(s,[i,l])=>l.value.indexOf(s.properties()[i.value])>=0],"filter-in-large":[Yt,[ni,ee(ti)],(s,[i,l])=>function(d,g,b,w){for(;b<=w;){const T=b+w>>1;if(g[T]===d)return!0;g[T]>d?w=T-1:b=T+1}return!1}(s.properties()[i.value],l.value,0,l.value.length-1)],all:{type:Yt,overloads:[[[Yt,Yt],(s,[i,l])=>i.evaluate(s)&&l.evaluate(s)],[ss(Yt),(s,i)=>{for(const l of i)if(!l.evaluate(s))return!1;return!0}]]},any:{type:Yt,overloads:[[[Yt,Yt],(s,[i,l])=>i.evaluate(s)||l.evaluate(s)],[ss(Yt),(s,i)=>{for(const l of i)if(l.evaluate(s))return!0;return!1}]]},"!":[Yt,[Yt],(s,[i])=>!i.evaluate(s)],"is-supported-script":[Yt,[ni],(s,[i])=>{const l=s.globals&&s.globals.isSupportedScript;return!l||l(i.evaluate(s))}],upcase:[ni,[ni],(s,[i])=>i.evaluate(s).toUpperCase()],downcase:[ni,[ni],(s,[i])=>i.evaluate(s).toLowerCase()],concat:[ni,ss(ti),(s,i)=>i.map(l=>la(l.evaluate(s))).join("")],"resolved-locale":[ni,[eo],(s,[i])=>i.evaluate(s).resolvedLocale()]});class Wi{constructor(i,l){var d;this.expression=i,this._warningHistory={},this._evaluator=new Di,this._defaultValue=l?(d=l).type==="color"&&tl(d.default)?new zi(0,0,0,0):d.type==="color"?zi.parse(d.default)||null:d.type==="padding"?br.parse(d.default)||null:d.type==="variableAnchorOffsetCollection"?Hr.parse(d.default)||null:d.default===void 0?null:d.default:null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(i,l,d,g,b,w){return this._evaluator.globals=i,this._evaluator.feature=l,this._evaluator.featureState=d,this._evaluator.canonical=g,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=w,this.expression.evaluate(this._evaluator)}evaluate(i,l,d,g,b,w){this._evaluator.globals=i,this._evaluator.feature=l||null,this._evaluator.featureState=d||null,this._evaluator.canonical=g,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=w||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new nn(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function Zi(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Ds}function as(s,i){const l=new Va(Ds,ha,[],i?function(g){const b={color:qi,string:ni,number:gt,enum:ni,boolean:Yt,formatted:cn,padding:ge,resolvedImage:W,variableAnchorOffsetCollection:X};return g.type==="array"?ee(b[g.value]||ti,g.length):b[g.type]}(i):void 0),d=l.parse(s,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?sh(new Wi(d,i)):Rs(l.errors)}class il{constructor(i,l){this.kind=i,this._styleExpression=l,this.isStateDependent=i!=="constant"&&!da(l.expression)}evaluateWithoutErrorHandling(i,l,d,g,b,w){return this._styleExpression.evaluateWithoutErrorHandling(i,l,d,g,b,w)}evaluate(i,l,d,g,b,w){return this._styleExpression.evaluate(i,l,d,g,b,w)}}class _c{constructor(i,l,d,g){this.kind=i,this.zoomStops=d,this._styleExpression=l,this.isStateDependent=i!=="camera"&&!da(l.expression),this.interpolationType=g}evaluateWithoutErrorHandling(i,l,d,g,b,w){return this._styleExpression.evaluateWithoutErrorHandling(i,l,d,g,b,w)}evaluate(i,l,d,g,b,w){return this._styleExpression.evaluate(i,l,d,g,b,w)}interpolationFactor(i,l,d){return this.interpolationType?nr.interpolationFactor(this.interpolationType,i,l,d):0}}function ch(s,i){const l=as(s,i);if(l.result==="error")return l;const d=l.value.expression,g=$a(d);if(!g&&!Bs(i))return Rs([new xn("","data expressions not supported")]);const b=fa(d,["zoom"]);if(!b&&!ah(i))return Rs([new xn("","zoom expressions not supported")]);const w=rl(d);return w||b?w instanceof xn?Rs([w]):w instanceof nr&&!mc(i)?Rs([new xn("",'"interpolate" expressions cannot be used with this property')]):sh(w?new _c(g?"camera":"composite",l.value,w.labels,w instanceof nr?w.interpolation:void 0):new il(g?"constant":"source",l.value)):Rs([new xn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class nl{constructor(i,l){this._parameters=i,this._specification=l,$n(this,lh(this._parameters,this._specification))}static deserialize(i){return new nl(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function rl(s){let i=null;if(s instanceof Ja)i=rl(s.result);else if(s instanceof Ka){for(const l of s.args)if(i=rl(l),i)break}else(s instanceof ma||s instanceof nr)&&s.input instanceof Dr&&s.input.name==="zoom"&&(i=s);return i instanceof xn||s.eachChild(l=>{const d=rl(l);d instanceof xn?i=d:!i&&d?i=new xn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&d&&i!==d&&(i=new xn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function ol(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const i of s.slice(1))if(!ol(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}const uh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function sl(s){if(s==null)return{filter:()=>!0,needGeometry:!1};ol(s)||(s=ll(s));const i=as(s,uh);if(i.result==="error")throw new Error(i.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,d,g)=>i.value.evaluate(l,d,{},g),needGeometry:al(s)}}function hh(s,i){return s<i?-1:s>i?1:0}function al(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let i=1;i<s.length;i++)if(al(s[i]))return!0;return!1}function ll(s){if(!s)return!0;const i=s[0];return s.length<=1?i!=="any":i==="=="?yc(s[1],s[2],"=="):i==="!="?cl(yc(s[1],s[2],"==")):i==="<"||i===">"||i==="<="||i===">="?yc(s[1],s[2],i):i==="any"?(l=s.slice(1),["any"].concat(l.map(ll))):i==="all"?["all"].concat(s.slice(1).map(ll)):i==="none"?["all"].concat(s.slice(1).map(ll).map(cl)):i==="in"?dh(s[1],s.slice(2)):i==="!in"?cl(dh(s[1],s.slice(2))):i==="has"?fh(s[1]):i==="!has"?cl(fh(s[1])):i!=="within"||s;var l}function yc(s,i,l){switch(s){case"$type":return[`filter-type-${l}`,i];case"$id":return[`filter-id-${l}`,i];default:return[`filter-${l}`,s,i]}}function dh(s,i){if(i.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(l=>typeof l!=typeof i[0])?["filter-in-large",s,["literal",i.sort(hh)]]:["filter-in-small",s,["literal",i]]}}function fh(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function cl(s){return["!",s]}function vc(s){const i=typeof s;if(i==="number"||i==="boolean"||i==="string"||s==null)return JSON.stringify(s);if(Array.isArray(s)){let g="[";for(const b of s)g+=`${vc(b)},`;return`${g}]`}const l=Object.keys(s).sort();let d="{";for(let g=0;g<l.length;g++)d+=`${JSON.stringify(l[g])}:${vc(s[l[g]])},`;return`${d}}`}function Gd(s){let i="";for(const l of di)i+=`/${vc(s[l])}`;return i}function ph(s){const i=s.value;return i?[new ut(s.key,i,"constants have been deprecated as of v8")]:[]}function hn(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Zo(s){if(Array.isArray(s))return s.map(Zo);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const i={};for(const l in s)i[l]=Zo(s[l]);return i}return hn(s)}function dr(s){const i=s.key,l=s.value,d=s.valueSpec||{},g=s.objectElementValidators||{},b=s.style,w=s.styleSpec,T=s.validateSpec;let M=[];const A=Ei(l);if(A!=="object")return[new ut(i,l,`object expected, ${A} found`)];for(const O in l){const U=O.split(".")[0],H=d[U]||d["*"];let K;if(g[U])K=g[U];else if(d[U])K=T;else if(g["*"])K=g["*"];else{if(!d["*"]){M.push(new ut(i,l[O],`unknown property "${O}"`));continue}K=T}M=M.concat(K({key:(i&&`${i}.`)+O,value:l[O],valueSpec:H,style:b,styleSpec:w,object:l,objectKey:O,validateSpec:T},l))}for(const O in d)g[O]||d[O].required&&d[O].default===void 0&&l[O]===void 0&&M.push(new ut(i,l,`missing required property "${O}"`));return M}function bc(s){const i=s.value,l=s.valueSpec,d=s.style,g=s.styleSpec,b=s.key,w=s.arrayElementValidator||s.validateSpec;if(Ei(i)!=="array")return[new ut(b,i,`array expected, ${Ei(i)} found`)];if(l.length&&i.length!==l.length)return[new ut(b,i,`array length ${l.length} expected, length ${i.length} found`)];if(l["min-length"]&&i.length<l["min-length"])return[new ut(b,i,`array length at least ${l["min-length"]} expected, length ${i.length} found`)];let T={type:l.value,values:l.values};g.$version<7&&(T.function=l.function),Ei(l.value)==="object"&&(T=l.value);let M=[];for(let A=0;A<i.length;A++)M=M.concat(w({array:i,arrayIndex:A,value:i[A],valueSpec:T,validateSpec:s.validateSpec,style:d,styleSpec:g,key:`${b}[${A}]`}));return M}function ul(s){const i=s.key,l=s.value,d=s.valueSpec;let g=Ei(l);return g==="number"&&l!=l&&(g="NaN"),g!=="number"?[new ut(i,l,`number expected, ${g} found`)]:"minimum"in d&&l<d.minimum?[new ut(i,l,`${l} is less than the minimum value ${d.minimum}`)]:"maximum"in d&&l>d.maximum?[new ut(i,l,`${l} is greater than the maximum value ${d.maximum}`)]:[]}function mh(s){const i=s.valueSpec,l=hn(s.value.type);let d,g,b,w={};const T=l!=="categorical"&&s.value.property===void 0,M=!T,A=Ei(s.value.stops)==="array"&&Ei(s.value.stops[0])==="array"&&Ei(s.value.stops[0][0])==="object",O=dr({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(K){if(l==="identity")return[new ut(K.key,K.value,'identity function may not have a "stops" property')];let Q=[];const ae=K.value;return Q=Q.concat(bc({key:K.key,value:ae,valueSpec:K.valueSpec,validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec,arrayElementValidator:U})),Ei(ae)==="array"&&ae.length===0&&Q.push(new ut(K.key,ae,"array must have at least one stop")),Q},default:function(K){return K.validateSpec({key:K.key,value:K.value,valueSpec:i,validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec})}}});return l==="identity"&&T&&O.push(new ut(s.key,s.value,'missing required property "property"')),l==="identity"||s.value.stops||O.push(new ut(s.key,s.value,'missing required property "stops"')),l==="exponential"&&s.valueSpec.expression&&!mc(s.valueSpec)&&O.push(new ut(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(M&&!Bs(s.valueSpec)?O.push(new ut(s.key,s.value,"property functions not supported")):T&&!ah(s.valueSpec)&&O.push(new ut(s.key,s.value,"zoom functions not supported"))),l!=="categorical"&&!A||s.value.property!==void 0||O.push(new ut(s.key,s.value,'"property" property is required')),O;function U(K){let Q=[];const ae=K.value,_e=K.key;if(Ei(ae)!=="array")return[new ut(_e,ae,`array expected, ${Ei(ae)} found`)];if(ae.length!==2)return[new ut(_e,ae,`array length 2 expected, length ${ae.length} found`)];if(A){if(Ei(ae[0])!=="object")return[new ut(_e,ae,`object expected, ${Ei(ae[0])} found`)];if(ae[0].zoom===void 0)return[new ut(_e,ae,"object stop key must have zoom")];if(ae[0].value===void 0)return[new ut(_e,ae,"object stop key must have value")];if(b&&b>hn(ae[0].zoom))return[new ut(_e,ae[0].zoom,"stop zoom values must appear in ascending order")];hn(ae[0].zoom)!==b&&(b=hn(ae[0].zoom),g=void 0,w={}),Q=Q.concat(dr({key:`${_e}[0]`,value:ae[0],valueSpec:{zoom:{}},validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec,objectElementValidators:{zoom:ul,value:H}}))}else Q=Q.concat(H({key:`${_e}[0]`,value:ae[0],valueSpec:{},validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec},ae));return Zi(Zo(ae[1]))?Q.concat([new ut(`${_e}[1]`,ae[1],"expressions are not allowed in function stops.")]):Q.concat(K.validateSpec({key:`${_e}[1]`,value:ae[1],valueSpec:i,validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec}))}function H(K,Q){const ae=Ei(K.value),_e=hn(K.value),xe=K.value!==null?K.value:Q;if(d){if(ae!==d)return[new ut(K.key,xe,`${ae} stop domain type must match previous stop domain type ${d}`)]}else d=ae;if(ae!=="number"&&ae!=="string"&&ae!=="boolean")return[new ut(K.key,xe,"stop domain value must be a number, string, or boolean")];if(ae!=="number"&&l!=="categorical"){let Oe=`number expected, ${ae} found`;return Bs(i)&&l===void 0&&(Oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ut(K.key,xe,Oe)]}return l!=="categorical"||ae!=="number"||isFinite(_e)&&Math.floor(_e)===_e?l!=="categorical"&&ae==="number"&&g!==void 0&&_e<g?[new ut(K.key,xe,"stop domain values must appear in ascending order")]:(g=_e,l==="categorical"&&_e in w?[new ut(K.key,xe,"stop domain values must be unique")]:(w[_e]=!0,[])):[new ut(K.key,xe,`integer expected, found ${_e}`)]}}function Go(s){const i=(s.expressionContext==="property"?ch:as)(Zo(s.value),s.valueSpec);if(i.result==="error")return i.value.map(d=>new ut(`${s.key}${d.key}`,s.value,d.message));const l=i.value.expression||i.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!l.outputDefined())return[new ut(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!da(l))return[new ut(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!da(l))return[new ut(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!fa(l,["zoom","feature-state"]))return[new ut(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!$a(l))return[new ut(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Wo(s){const i=s.key,l=s.value,d=s.valueSpec,g=[];return Array.isArray(d.values)?d.values.indexOf(hn(l))===-1&&g.push(new ut(i,l,`expected one of [${d.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(d.values).indexOf(hn(l))===-1&&g.push(new ut(i,l,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(l)} found`)),g}function Fs(s){return ol(Zo(s.value))?Go($n({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):wc(s)}function wc(s){const i=s.value,l=s.key;if(Ei(i)!=="array")return[new ut(l,i,`array expected, ${Ei(i)} found`)];const d=s.styleSpec;let g,b=[];if(i.length<1)return[new ut(l,i,"filter array must have at least 1 element")];switch(b=b.concat(Wo({key:`${l}[0]`,value:i[0],valueSpec:d.filter_operator,style:s.style,styleSpec:s.styleSpec})),hn(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&hn(i[1])==="$type"&&b.push(new ut(l,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&b.push(new ut(l,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(g=Ei(i[1]),g!=="string"&&b.push(new ut(`${l}[1]`,i[1],`string expected, ${g} found`)));for(let w=2;w<i.length;w++)g=Ei(i[w]),hn(i[1])==="$type"?b=b.concat(Wo({key:`${l}[${w}]`,value:i[w],valueSpec:d.geometry_type,style:s.style,styleSpec:s.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&b.push(new ut(`${l}[${w}]`,i[w],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let w=1;w<i.length;w++)b=b.concat(wc({key:`${l}[${w}]`,value:i[w],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":g=Ei(i[1]),i.length!==2?b.push(new ut(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="string"&&b.push(new ut(`${l}[1]`,i[1],`string expected, ${g} found`));break;case"within":g=Ei(i[1]),i.length!==2?b.push(new ut(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="object"&&b.push(new ut(`${l}[1]`,i[1],`object expected, ${g} found`))}return b}function hl(s,i){const l=s.key,d=s.validateSpec,g=s.style,b=s.styleSpec,w=s.value,T=s.objectKey,M=b[`${i}_${s.layerType}`];if(!M)return[];const A=T.match(/^(.*)-transition$/);if(i==="paint"&&A&&M[A[1]]&&M[A[1]].transition)return d({key:l,value:w,valueSpec:b.transition,style:g,styleSpec:b});const O=s.valueSpec||M[T];if(!O)return[new ut(l,w,`unknown property "${T}"`)];let U;if(Ei(w)==="string"&&Bs(O)&&!O.tokens&&(U=/^{([^}]+)}$/.exec(w)))return[new ut(l,w,`"${T}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(U[1])} }\`.`)];const H=[];return s.layerType==="symbol"&&(T==="text-field"&&g&&!g.glyphs&&H.push(new ut(l,w,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&tl(Zo(w))&&hn(w.type)==="identity"&&H.push(new ut(l,w,'"text-font" does not support identity functions'))),H.concat(d({key:s.key,value:w,valueSpec:O,style:g,styleSpec:b,expressionContext:"property",propertyType:i,propertyKey:T}))}function xc(s){return hl(s,"paint")}function kc(s){return hl(s,"layout")}function _a(s){let i=[];const l=s.value,d=s.key,g=s.style,b=s.styleSpec;l.type||l.ref||i.push(new ut(d,l,'either "type" or "ref" is required'));let w=hn(l.type);const T=hn(l.ref);if(l.id){const M=hn(l.id);for(let A=0;A<s.arrayIndex;A++){const O=g.layers[A];hn(O.id)===M&&i.push(new ut(d,l.id,`duplicate layer id "${l.id}", previously used at line ${O.id.__line__}`))}}if("ref"in l){let M;["type","source","source-layer","filter","layout"].forEach(A=>{A in l&&i.push(new ut(d,l[A],`"${A}" is prohibited for ref layers`))}),g.layers.forEach(A=>{hn(A.id)===T&&(M=A)}),M?M.ref?i.push(new ut(d,l.ref,"ref cannot reference another ref layer")):w=hn(M.type):i.push(new ut(d,l.ref,`ref layer "${T}" not found`))}else if(w!=="background")if(l.source){const M=g.sources&&g.sources[l.source],A=M&&hn(M.type);M?A==="vector"&&w==="raster"?i.push(new ut(d,l.source,`layer "${l.id}" requires a raster source`)):A!=="raster-dem"&&w==="hillshade"?i.push(new ut(d,l.source,`layer "${l.id}" requires a raster-dem source`)):A==="raster"&&w!=="raster"?i.push(new ut(d,l.source,`layer "${l.id}" requires a vector source`)):A!=="vector"||l["source-layer"]?A==="raster-dem"&&w!=="hillshade"?i.push(new ut(d,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):w!=="line"||!l.paint||!l.paint["line-gradient"]||A==="geojson"&&M.lineMetrics||i.push(new ut(d,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new ut(d,l,`layer "${l.id}" must specify a "source-layer"`)):i.push(new ut(d,l.source,`source "${l.source}" not found`))}else i.push(new ut(d,l,'missing required property "source"'));return i=i.concat(dr({key:d,value:l,valueSpec:b.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*":()=>[],type:()=>s.validateSpec({key:`${d}.type`,value:l.type,valueSpec:b.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:l,objectKey:"type"}),filter:Fs,layout:M=>dr({layer:l,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":A=>kc($n({layerType:w},A))}}),paint:M=>dr({layer:l,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":A=>xc($n({layerType:w},A))}})}})),i}function ls(s){const i=s.value,l=s.key,d=Ei(i);return d!=="string"?[new ut(l,i,`string expected, ${d} found`)]:[]}const gh={promoteId:function({key:s,value:i}){if(Ei(i)==="string")return ls({key:s,value:i});{const l=[];for(const d in i)l.push(...ls({key:`${s}.${d}`,value:i[d]}));return l}}};function _h(s){const i=s.value,l=s.key,d=s.styleSpec,g=s.style,b=s.validateSpec;if(!i.type)return[new ut(l,i,'"type" is required')];const w=hn(i.type);let T;switch(w){case"vector":case"raster":return T=dr({key:l,value:i,valueSpec:d[`source_${w.replace("-","_")}`],style:s.style,styleSpec:d,objectElementValidators:gh,validateSpec:b}),T;case"raster-dem":return T=function(M){var A;const O=(A=M.sourceName)!==null&&A!==void 0?A:"",U=M.value,H=M.styleSpec,K=H.source_raster_dem,Q=M.style;let ae=[];const _e=Ei(U);if(U===void 0)return ae;if(_e!=="object")return ae.push(new ut("source_raster_dem",U,`object expected, ${_e} found`)),ae;const xe=hn(U.encoding)==="custom",Oe=["redFactor","greenFactor","blueFactor","baseShift"],Se=M.value.encoding?`"${M.value.encoding}"`:"Default";for(const Le in U)!xe&&Oe.includes(Le)?ae.push(new ut(Le,U[Le],`In "${O}": "${Le}" is only valid when "encoding" is set to "custom". ${Se} encoding found`)):K[Le]?ae=ae.concat(M.validateSpec({key:Le,value:U[Le],valueSpec:K[Le],validateSpec:M.validateSpec,style:Q,styleSpec:H})):ae.push(new ut(Le,U[Le],`unknown property "${Le}"`));return ae}({sourceName:l,value:i,style:s.style,styleSpec:d,validateSpec:b}),T;case"geojson":if(T=dr({key:l,value:i,valueSpec:d.source_geojson,style:g,styleSpec:d,validateSpec:b,objectElementValidators:gh}),i.cluster)for(const M in i.clusterProperties){const[A,O]=i.clusterProperties[M],U=typeof A=="string"?[A,["accumulated"],["get",M]]:A;T.push(...Go({key:`${l}.${M}.map`,value:O,validateSpec:b,expressionContext:"cluster-map"})),T.push(...Go({key:`${l}.${M}.reduce`,value:U,validateSpec:b,expressionContext:"cluster-reduce"}))}return T;case"video":return dr({key:l,value:i,valueSpec:d.source_video,style:g,validateSpec:b,styleSpec:d});case"image":return dr({key:l,value:i,valueSpec:d.source_image,style:g,validateSpec:b,styleSpec:d});case"canvas":return[new ut(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Wo({key:`${l}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,validateSpec:b,styleSpec:d})}}function yh(s){const i=s.value,l=s.styleSpec,d=l.light,g=s.style;let b=[];const w=Ei(i);if(i===void 0)return b;if(w!=="object")return b=b.concat([new ut("light",i,`object expected, ${w} found`)]),b;for(const T in i){const M=T.match(/^(.*)-transition$/);b=b.concat(M&&d[M[1]]&&d[M[1]].transition?s.validateSpec({key:T,value:i[T],valueSpec:l.transition,validateSpec:s.validateSpec,style:g,styleSpec:l}):d[T]?s.validateSpec({key:T,value:i[T],valueSpec:d[T],validateSpec:s.validateSpec,style:g,styleSpec:l}):[new ut(T,i[T],`unknown property "${T}"`)])}return b}function vh(s){const i=s.value,l=s.styleSpec,d=l.sky,g=s.style,b=Ei(i);if(i===void 0)return[];if(b!=="object")return[new ut("sky",i,`object expected, ${b} found`)];let w=[];for(const T in i)w=w.concat(d[T]?go({key:T,value:i[T],valueSpec:d[T],style:g,styleSpec:l}):[new ut(T,i[T],`unknown property "${T}"`)]);return w}function ya(s){const i=s.value,l=s.styleSpec,d=l.terrain,g=s.style;let b=[];const w=Ei(i);if(i===void 0)return b;if(w!=="object")return b=b.concat([new ut("terrain",i,`object expected, ${w} found`)]),b;for(const T in i)b=b.concat(d[T]?s.validateSpec({key:T,value:i[T],valueSpec:d[T],validateSpec:s.validateSpec,style:g,styleSpec:l}):[new ut(T,i[T],`unknown property "${T}"`)]);return b}function va(s){let i=[];const l=s.value,d=s.key;if(Array.isArray(l)){const g=[],b=[];for(const w in l)l[w].id&&g.includes(l[w].id)&&i.push(new ut(d,l,`all the sprites' ids must be unique, but ${l[w].id} is duplicated`)),g.push(l[w].id),l[w].url&&b.includes(l[w].url)&&i.push(new ut(d,l,`all the sprites' URLs must be unique, but ${l[w].url} is duplicated`)),b.push(l[w].url),i=i.concat(dr({key:`${d}[${w}]`,value:l[w],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:s.validateSpec}));return i}return ls({key:d,value:l})}const wr={"*":()=>[],array:bc,boolean:function(s){const i=s.value,l=s.key,d=Ei(i);return d!=="boolean"?[new ut(l,i,`boolean expected, ${d} found`)]:[]},number:ul,color:function(s){const i=s.key,l=s.value,d=Ei(l);return d!=="string"?[new ut(i,l,`color expected, ${d} found`)]:zi.parse(String(l))?[]:[new ut(i,l,`color expected, "${l}" found`)]},constants:ph,enum:Wo,filter:Fs,function:mh,layer:_a,object:dr,source:_h,light:yh,sky:vh,terrain:ya,string:ls,formatted:function(s){return ls(s).length===0?[]:Go(s)},resolvedImage:function(s){return ls(s).length===0?[]:Go(s)},padding:function(s){const i=s.key,l=s.value;if(Ei(l)==="array"){if(l.length<1||l.length>4)return[new ut(i,l,`padding requires 1 to 4 values; ${l.length} values found`)];const d={type:"number"};let g=[];for(let b=0;b<l.length;b++)g=g.concat(s.validateSpec({key:`${i}[${b}]`,value:l[b],validateSpec:s.validateSpec,valueSpec:d}));return g}return ul({key:i,value:l,valueSpec:{}})},variableAnchorOffsetCollection:function(s){const i=s.key,l=s.value,d=Ei(l),g=s.styleSpec;if(d!=="array"||l.length<1||l.length%2!=0)return[new ut(i,l,"variableAnchorOffsetCollection requires a non-empty array of even length")];let b=[];for(let w=0;w<l.length;w+=2)b=b.concat(Wo({key:`${i}[${w}]`,value:l[w],valueSpec:g.layout_symbol["text-anchor"]})),b=b.concat(bc({key:`${i}[${w+1}]`,value:l[w+1],valueSpec:{length:2,value:"number"},validateSpec:s.validateSpec,style:s.style,styleSpec:g}));return b},sprite:va};function go(s){const i=s.value,l=s.valueSpec,d=s.styleSpec;return s.validateSpec=go,l.expression&&tl(hn(i))?mh(s):l.expression&&Zi(Zo(i))?Go(s):l.type&&wr[l.type]?wr[l.type](s):dr($n({},s,{valueSpec:l.type?d[l.type]:l}))}function Sc(s){const i=s.value,l=s.key,d=ls(s);return d.length||(i.indexOf("{fontstack}")===-1&&d.push(new ut(l,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&d.push(new ut(l,i,'"glyphs" url must include a "{range}" token'))),d}function to(s,i=we){let l=[];return l=l.concat(go({key:"",value:s,valueSpec:i.$root,styleSpec:i,style:s,validateSpec:go,objectElementValidators:{glyphs:Sc,"*":()=>[]}})),s.constants&&(l=l.concat(ph({key:"constants",value:s.constants,style:s,styleSpec:i,validateSpec:go}))),Os(l)}function _o(s){return function(i){return s({...i,validateSpec:go})}}function Os(s){return[].concat(s).sort((i,l)=>i.line-l.line)}function io(s){return function(...i){return Os(s.apply(this,i))}}to.source=io(_o(_h)),to.sprite=io(_o(va)),to.glyphs=io(_o(Sc)),to.light=io(_o(yh)),to.sky=io(_o(vh)),to.terrain=io(_o(ya)),to.layer=io(_o(_a)),to.filter=io(_o(Fs)),to.paintProperty=io(_o(xc)),to.layoutProperty=io(_o(kc));const cs=to,Wd=cs.light,Tc=cs.paintProperty,Hd=cs.layoutProperty;function Ns(s,i){let l=!1;if(i&&i.length)for(const d of i)s.fire(new rt(new Error(d.message))),l=!0;return l}class ba{constructor(i,l,d){const g=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const w=new Int32Array(this.arrayBuffer);i=w[0],this.d=(l=w[1])+2*(d=w[2]);for(let M=0;M<this.d*this.d;M++){const A=w[3+M],O=w[3+M+1];g.push(A===O?null:w.subarray(A,O))}const T=w[3+g.length+1];this.keys=w.subarray(w[3+g.length],T),this.bboxes=w.subarray(T),this.insert=this._insertReadonly}else{this.d=l+2*d;for(let w=0;w<this.d*this.d;w++)g.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=i,this.padding=d,this.scale=l/i,this.uid=0;const b=d/l*i;this.min=-b,this.max=i+b}insert(i,l,d,g,b){this._forEachCell(l,d,g,b,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(b)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,l,d,g,b,w){this.cells[b].push(w)}query(i,l,d,g,b){const w=this.min,T=this.max;if(i<=w&&l<=w&&T<=d&&T<=g&&!b)return Array.prototype.slice.call(this.keys);{const M=[];return this._forEachCell(i,l,d,g,this._queryCell,M,{},b),M}}_queryCell(i,l,d,g,b,w,T,M){const A=this.cells[b];if(A!==null){const O=this.keys,U=this.bboxes;for(let H=0;H<A.length;H++){const K=A[H];if(T[K]===void 0){const Q=4*K;(M?M(U[Q+0],U[Q+1],U[Q+2],U[Q+3]):i<=U[Q+2]&&l<=U[Q+3]&&d>=U[Q+0]&&g>=U[Q+1])?(T[K]=!0,w.push(O[K])):T[K]=!1}}}}_forEachCell(i,l,d,g,b,w,T,M){const A=this._convertToCellCoord(i),O=this._convertToCellCoord(l),U=this._convertToCellCoord(d),H=this._convertToCellCoord(g);for(let K=A;K<=U;K++)for(let Q=O;Q<=H;Q++){const ae=this.d*Q+K;if((!M||M(this._convertFromCellCoord(K),this._convertFromCellCoord(Q),this._convertFromCellCoord(K+1),this._convertFromCellCoord(Q+1)))&&b.call(this,i,l,d,g,ae,w,T,M))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,l=3+this.cells.length+1+1;let d=0;for(let w=0;w<this.cells.length;w++)d+=this.cells[w].length;const g=new Int32Array(l+d+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let b=l;for(let w=0;w<i.length;w++){const T=i[w];g[3+w]=b,g.set(T,b),b+=T.length}return g[3+i.length]=b,g.set(this.keys,b),b+=this.keys.length,g[3+i.length+1]=b,g.set(this.bboxes,b),b+=this.bboxes.length,g.buffer}static serialize(i,l){const d=i.toArrayBuffer();return l&&l.push(d),{buffer:d}}static deserialize(i){return new ba(i.buffer)}}const yo={};function Lt(s,i,l={}){if(yo[s])throw new Error(`${s} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:s,writeable:!1}),yo[s]={klass:i,omit:l.omit||[],shallow:l.shallow||[]}}Lt("Object",Object),Lt("TransferableGridIndex",ba),Lt("Color",zi),Lt("Error",Error),Lt("AJAXError",xi),Lt("ResolvedImage",$r),Lt("StylePropertyFunction",nl),Lt("StyleExpression",Wi,{omit:["_evaluator"]}),Lt("ZoomDependentExpression",_c),Lt("ZoomConstantExpression",il),Lt("CompoundExpression",Dr,{omit:["_evaluate"]});for(const s in Ds)Ds[s]._classRegistryKey||Lt(`Expression_${s}`,Ds[s]);function dl(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function js(s,i){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error)return s;if(dl(s)||ot(s))return i&&i.push(s),s;if(ArrayBuffer.isView(s)){const l=s;return i&&i.push(l.buffer),l}if(s instanceof ImageData)return i&&i.push(s.data.buffer),s;if(Array.isArray(s)){const l=[];for(const d of s)l.push(js(d,i));return l}if(typeof s=="object"){const l=s.constructor,d=l._classRegistryKey;if(!d)throw new Error(`can't serialize object of unregistered class ${l.name}`);if(!yo[d])throw new Error(`${d} is not registered.`);const g=l.serialize?l.serialize(s,i):{};if(l.serialize){if(i&&g===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const b in s){if(!s.hasOwnProperty(b)||yo[d].omit.indexOf(b)>=0)continue;const w=s[b];g[b]=yo[d].shallow.indexOf(b)>=0?w:js(w,i)}s instanceof Error&&(g.message=s.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(g.$name=d),g}throw new Error("can't serialize object of type "+typeof s)}function Us(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error||dl(s)||ot(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(Us);if(typeof s=="object"){const i=s.$name||"Object";if(!yo[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:l}=yo[i];if(!l)throw new Error(`can't deserialize unregistered class ${i}`);if(l.deserialize)return l.deserialize(s);const d=Object.create(l.prototype);for(const g of Object.keys(s)){if(g==="$name")continue;const b=s[g];d[g]=yo[i].shallow.indexOf(g)>=0?b:Us(b)}return d}throw new Error("can't deserialize object of type "+typeof s)}class bh{constructor(){this.first=!0}update(i,l){const d=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=d,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=d,!0):(this.lastFloorZoom>d?(this.lastIntegerZoom=d+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<d&&(this.lastIntegerZoom=d,this.lastIntegerZoomTime=l),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=d,!0))}}const St={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function Vs(s){for(const i of s)if(fl(i.charCodeAt(0)))return!0;return!1}function wh(s){for(const i of s)if(!xh(i.charCodeAt(0)))return!1;return!0}function xh(s){return!(St.Arabic(s)||St["Arabic Supplement"](s)||St["Arabic Extended-A"](s)||St["Arabic Presentation Forms-A"](s)||St["Arabic Presentation Forms-B"](s))}function fl(s){return!(s!==746&&s!==747&&(s<4352||!(St["Bopomofo Extended"](s)||St.Bopomofo(s)||St["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||St["CJK Compatibility Ideographs"](s)||St["CJK Compatibility"](s)||St["CJK Radicals Supplement"](s)||St["CJK Strokes"](s)||!(!St["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||St["CJK Unified Ideographs Extension A"](s)||St["CJK Unified Ideographs"](s)||St["Enclosed CJK Letters and Months"](s)||St["Hangul Compatibility Jamo"](s)||St["Hangul Jamo Extended-A"](s)||St["Hangul Jamo Extended-B"](s)||St["Hangul Jamo"](s)||St["Hangul Syllables"](s)||St.Hiragana(s)||St["Ideographic Description Characters"](s)||St.Kanbun(s)||St["Kangxi Radicals"](s)||St["Katakana Phonetic Extensions"](s)||St.Katakana(s)&&s!==12540||!(!St["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!St["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||St["Unified Canadian Aboriginal Syllabics"](s)||St["Unified Canadian Aboriginal Syllabics Extended"](s)||St["Vertical Forms"](s)||St["Yijing Hexagram Symbols"](s)||St["Yi Syllables"](s)||St["Yi Radicals"](s))))}function Ec(s){return!(fl(s)||function(i){return!!(St["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||St["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||St["Letterlike Symbols"](i)||St["Number Forms"](i)||St["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||St["Control Pictures"](i)&&i!==9251||St["Optical Character Recognition"](i)||St["Enclosed Alphanumerics"](i)||St["Geometric Shapes"](i)||St["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||St["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||St["CJK Symbols and Punctuation"](i)||St.Katakana(i)||St["Private Use Area"](i)||St["CJK Compatibility Forms"](i)||St["Small Form Variants"](i)||St["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(s))}function pl(s){return s>=1424&&s<=2303||St["Arabic Presentation Forms-A"](s)||St["Arabic Presentation Forms-B"](s)}function kh(s,i){return!(!i&&pl(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||St.Khmer(s))}function $d(s){for(const i of s)if(pl(i.charCodeAt(0)))return!0;return!1}const Ho=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(s){this.pluginStatus=s.pluginStatus,this.pluginURL=s.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(s){this.applyArabicShaping=s.applyArabicShaping,this.processBidirectionalText=s.processBidirectionalText,this.processStyledBidirectionalText=s.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Yi{constructor(i,l){this.zoom=i,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new bh,this.transition={})}isSupportedScript(i){return function(l,d){for(const g of l)if(!kh(g.charCodeAt(0),d))return!1;return!0}(i,Ho.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,l=i-Math.floor(i),d=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*d}:{fromScale:.5,toScale:1,t:1-(1-d)*l}}}class wa{constructor(i,l){this.property=i,this.value=l,this.expression=function(d,g){if(tl(d))return new nl(d,g);if(Zi(d)){const b=ch(d,g);if(b.result==="error")throw new Error(b.value.map(w=>`${w.key}: ${w.message}`).join(", "));return b.value}{let b=d;return g.type==="color"&&typeof d=="string"?b=zi.parse(d):g.type!=="padding"||typeof d!="number"&&!Array.isArray(d)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(d)&&(b=Hr.parse(d)):b=br.parse(d),{kind:"constant",evaluate:()=>b}}}(l===void 0?i.specification.default:l,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,l,d){return this.property.possiblyEvaluate(this,i,l,d)}}class ml{constructor(i){this.property=i,this.value=new wa(i,void 0)}transitioned(i,l){return new Sh(this.property,this.value,l,$({},i.transition,this.transition),i.now)}untransitioned(){return new Sh(this.property,this.value,null,{},0)}}class Cc{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return te(this._values[i].value.value)}setValue(i,l){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new ml(this._values[i].property)),this._values[i].value=new wa(this._values[i].property,l===null?void 0:te(l))}getTransition(i){return te(this._values[i].transition)}setTransition(i,l){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new ml(this._values[i].property)),this._values[i].transition=te(l)||void 0}serialize(){const i={};for(const l of Object.keys(this._values)){const d=this.getValue(l);d!==void 0&&(i[l]=d);const g=this.getTransition(l);g!==void 0&&(i[`${l}-transition`]=g)}return i}transitioned(i,l){const d=new Th(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].transitioned(i,l._values[g]);return d}untransitioned(){const i=new Th(this._properties);for(const l of Object.keys(this._values))i._values[l]=this._values[l].untransitioned();return i}}class Sh{constructor(i,l,d,g,b){this.property=i,this.value=l,this.begin=b+g.delay||0,this.end=this.begin+g.duration||0,i.specification.transition&&(g.delay||g.duration)&&(this.prior=d)}possiblyEvaluate(i,l,d){const g=i.now||0,b=this.value.possiblyEvaluate(i,l,d),w=this.prior;if(w){if(g>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(g<this.begin)return w.possiblyEvaluate(i,l,d);{const T=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(i,l,d),b,function(M){if(M<=0)return 0;if(M>=1)return 1;const A=M*M,O=A*M;return 4*(M<.5?O:3*(M-A)+O-.75)}(T))}}return b}}class Th{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,l,d){const g=new xa(this._properties);for(const b of Object.keys(this._values))g._values[b]=this._values[b].possiblyEvaluate(i,l,d);return g}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Eh{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}hasValue(i){return this._values[i].value!==void 0}getValue(i){return te(this._values[i].value)}setValue(i,l){this._values[i]=new wa(this._values[i].property,l===null?void 0:te(l))}serialize(){const i={};for(const l of Object.keys(this._values)){const d=this.getValue(l);d!==void 0&&(i[l]=d)}return i}possiblyEvaluate(i,l,d){const g=new xa(this._properties);for(const b of Object.keys(this._values))g._values[b]=this._values[b].possiblyEvaluate(i,l,d);return g}}class no{constructor(i,l,d){this.property=i,this.value=l,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,l,d,g){return this.property.evaluate(this.value,this.parameters,i,l,d,g)}}class xa{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Nt{constructor(i){this.specification=i}possiblyEvaluate(i,l){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(l)}interpolate(i,l,d){const g=hr[this.specification.type];return g?g(i,l,d):i}}class $t{constructor(i,l){this.specification=i,this.overrides=l}possiblyEvaluate(i,l,d,g){return new no(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(l,null,{},d,g)}:i.expression,l)}interpolate(i,l,d){if(i.value.kind!=="constant"||l.value.kind!=="constant")return i;if(i.value.value===void 0||l.value.value===void 0)return new no(this,{kind:"constant",value:void 0},i.parameters);const g=hr[this.specification.type];if(g){const b=g(i.value.value,l.value.value,d);return new no(this,{kind:"constant",value:b},i.parameters)}return i}evaluate(i,l,d,g,b,w){return i.kind==="constant"?i.value:i.evaluate(l,d,g,b,w)}}class gl extends $t{possiblyEvaluate(i,l,d,g){if(i.value===void 0)return new no(this,{kind:"constant",value:void 0},l);if(i.expression.kind==="constant"){const b=i.expression.evaluate(l,null,{},d,g),w=i.property.specification.type==="resolvedImage"&&typeof b!="string"?b.name:b,T=this._calculate(w,w,w,l);return new no(this,{kind:"constant",value:T},l)}if(i.expression.kind==="camera"){const b=this._calculate(i.expression.evaluate({zoom:l.zoom-1}),i.expression.evaluate({zoom:l.zoom}),i.expression.evaluate({zoom:l.zoom+1}),l);return new no(this,{kind:"constant",value:b},l)}return new no(this,i.expression,l)}evaluate(i,l,d,g,b,w){if(i.kind==="source"){const T=i.evaluate(l,d,g,b,w);return this._calculate(T,T,T,l)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(l.zoom)-1},d,g),i.evaluate({zoom:Math.floor(l.zoom)},d,g),i.evaluate({zoom:Math.floor(l.zoom)+1},d,g),l):i.value}_calculate(i,l,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:d,to:l}}interpolate(i){return i}}class ka{constructor(i){this.specification=i}possiblyEvaluate(i,l,d,g){if(i.value!==void 0){if(i.expression.kind==="constant"){const b=i.expression.evaluate(l,null,{},d,g);return this._calculate(b,b,b,l)}return this._calculate(i.expression.evaluate(new Yi(Math.floor(l.zoom-1),l)),i.expression.evaluate(new Yi(Math.floor(l.zoom),l)),i.expression.evaluate(new Yi(Math.floor(l.zoom+1),l)),l)}}_calculate(i,l,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:d,to:l}}interpolate(i){return i}}class Mc{constructor(i){this.specification=i}possiblyEvaluate(i,l,d,g){return!!i.expression.evaluate(l,null,{},d,g)}interpolate(){return!1}}class xr{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in i){const d=i[l];d.specification.overridable&&this.overridableProperties.push(l);const g=this.defaultPropertyValues[l]=new wa(d,void 0),b=this.defaultTransitionablePropertyValues[l]=new ml(d);this.defaultTransitioningPropertyValues[l]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=g.possiblyEvaluate({})}}}Lt("DataDrivenProperty",$t),Lt("DataConstantProperty",Nt),Lt("CrossFadedDataDrivenProperty",gl),Lt("CrossFadedProperty",ka),Lt("ColorRampProperty",Mc);const Ic="-transition";class ro extends xt{constructor(i,l){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),l.layout&&(this._unevaluatedLayout=new Eh(l.layout)),l.paint)){this._transitionablePaint=new Cc(l.paint);for(const d in i.paint)this.setPaintProperty(d,i.paint[d],{validate:!1});for(const d in i.layout)this.setLayoutProperty(d,i.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xa(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,l,d={}){l!=null&&this._validate(Hd,`layers.${this.id}.layout.${i}`,i,l,d)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,l):this.visibility=l)}getPaintProperty(i){return i.endsWith(Ic)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,l,d={}){if(l!=null&&this._validate(Tc,`layers.${this.id}.paint.${i}`,i,l,d))return!1;if(i.endsWith(Ic))return this._transitionablePaint.setTransition(i.slice(0,-11),l||void 0),!1;{const g=this._transitionablePaint._values[i],b=g.property.specification["property-type"]==="cross-faded-data-driven",w=g.value.isDataDriven(),T=g.value;this._transitionablePaint.setValue(i,l),this._handleSpecialPaintPropertyUpdate(i);const M=this._transitionablePaint._values[i].value;return M.isDataDriven()||w||b||this._handleOverridablePaintPropertyUpdate(i,T,M)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,l,d){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,l){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,l)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),Be(i,(l,d)=>!(l===void 0||d==="layout"&&!Object.keys(l).length||d==="paint"&&!Object.keys(l).length))}_validate(i,l,d,g,b={}){return(!b||b.validate!==!1)&&Ns(this,i.call(cs,{key:l,layerType:this.type,objectKey:d,value:g,styleSpec:we,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const l=this.paint.get(i);if(l instanceof no&&Bs(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}}const Ch={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Sa{constructor(i,l){this._structArray=i,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class dn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,l){return i._trim(),l&&(i.isTransferred=!0,l.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const l=Object.create(this.prototype);return l.arrayBuffer=i.arrayBuffer,l.length=i.length,l.capacity=i.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Sn(s,i=1){let l=0,d=0;return{members:s.map(g=>{const b=Ch[g.type].BYTES_PER_ELEMENT,w=l=Mh(l,Math.max(i,b)),T=g.components||1;return d=Math.max(d,b),l+=b*T,{name:g.name,type:g.type,components:T,offset:w}}),size:Mh(l,Math.max(d,i)),alignment:i}}function Mh(s,i){return Math.ceil(s/i)*i}class Ta extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l){const d=this.length;return this.resize(d+1),this.emplace(d,i,l)}emplace(i,l,d){const g=2*i;return this.int16[g+0]=l,this.int16[g+1]=d,i}}Ta.prototype.bytesPerElement=4,Lt("StructArrayLayout2i4",Ta);class Ao extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,d)}emplace(i,l,d,g){const b=3*i;return this.int16[b+0]=l,this.int16[b+1]=d,this.int16[b+2]=g,i}}Ao.prototype.bytesPerElement=6,Lt("StructArrayLayout3i6",Ao);class Lc extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,d,g){const b=this.length;return this.resize(b+1),this.emplace(b,i,l,d,g)}emplace(i,l,d,g,b){const w=4*i;return this.int16[w+0]=l,this.int16[w+1]=d,this.int16[w+2]=g,this.int16[w+3]=b,i}}Lc.prototype.bytesPerElement=8,Lt("StructArrayLayout4i8",Lc);class Ac extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,d,g,b,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,l,d,g,b,w)}emplace(i,l,d,g,b,w,T){const M=6*i;return this.int16[M+0]=l,this.int16[M+1]=d,this.int16[M+2]=g,this.int16[M+3]=b,this.int16[M+4]=w,this.int16[M+5]=T,i}}Ac.prototype.bytesPerElement=12,Lt("StructArrayLayout2i4i12",Ac);class Pc extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,d,g,b,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,l,d,g,b,w)}emplace(i,l,d,g,b,w,T){const M=4*i,A=8*i;return this.int16[M+0]=l,this.int16[M+1]=d,this.uint8[A+4]=g,this.uint8[A+5]=b,this.uint8[A+6]=w,this.uint8[A+7]=T,i}}Pc.prototype.bytesPerElement=8,Lt("StructArrayLayout2i4ub8",Pc);class Ea extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l){const d=this.length;return this.resize(d+1),this.emplace(d,i,l)}emplace(i,l,d){const g=2*i;return this.float32[g+0]=l,this.float32[g+1]=d,i}}Ea.prototype.bytesPerElement=8,Lt("StructArrayLayout2f8",Ea);class _l extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,d,g,b,w,T,M,A,O){const U=this.length;return this.resize(U+1),this.emplace(U,i,l,d,g,b,w,T,M,A,O)}emplace(i,l,d,g,b,w,T,M,A,O,U){const H=10*i;return this.uint16[H+0]=l,this.uint16[H+1]=d,this.uint16[H+2]=g,this.uint16[H+3]=b,this.uint16[H+4]=w,this.uint16[H+5]=T,this.uint16[H+6]=M,this.uint16[H+7]=A,this.uint16[H+8]=O,this.uint16[H+9]=U,i}}_l.prototype.bytesPerElement=20,Lt("StructArrayLayout10ui20",_l);class zc extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,d,g,b,w,T,M,A,O,U,H){const K=this.length;return this.resize(K+1),this.emplace(K,i,l,d,g,b,w,T,M,A,O,U,H)}emplace(i,l,d,g,b,w,T,M,A,O,U,H,K){const Q=12*i;return this.int16[Q+0]=l,this.int16[Q+1]=d,this.int16[Q+2]=g,this.int16[Q+3]=b,this.uint16[Q+4]=w,this.uint16[Q+5]=T,this.uint16[Q+6]=M,this.uint16[Q+7]=A,this.int16[Q+8]=O,this.int16[Q+9]=U,this.int16[Q+10]=H,this.int16[Q+11]=K,i}}zc.prototype.bytesPerElement=24,Lt("StructArrayLayout4i4ui4i24",zc);class Dc extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,d)}emplace(i,l,d,g){const b=3*i;return this.float32[b+0]=l,this.float32[b+1]=d,this.float32[b+2]=g,i}}Dc.prototype.bytesPerElement=12,Lt("StructArrayLayout3f12",Dc);class Po extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint32[1*i+0]=l,i}}Po.prototype.bytesPerElement=4,Lt("StructArrayLayout1ul4",Po);class yl extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,d,g,b,w,T,M,A){const O=this.length;return this.resize(O+1),this.emplace(O,i,l,d,g,b,w,T,M,A)}emplace(i,l,d,g,b,w,T,M,A,O){const U=10*i,H=5*i;return this.int16[U+0]=l,this.int16[U+1]=d,this.int16[U+2]=g,this.int16[U+3]=b,this.int16[U+4]=w,this.int16[U+5]=T,this.uint32[H+3]=M,this.uint16[U+8]=A,this.uint16[U+9]=O,i}}yl.prototype.bytesPerElement=20,Lt("StructArrayLayout6i1ul2ui20",yl);class Ca extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,d,g,b,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,l,d,g,b,w)}emplace(i,l,d,g,b,w,T){const M=6*i;return this.int16[M+0]=l,this.int16[M+1]=d,this.int16[M+2]=g,this.int16[M+3]=b,this.int16[M+4]=w,this.int16[M+5]=T,i}}Ca.prototype.bytesPerElement=12,Lt("StructArrayLayout2i2i2i12",Ca);class vl extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,d,g,b){const w=this.length;return this.resize(w+1),this.emplace(w,i,l,d,g,b)}emplace(i,l,d,g,b,w){const T=4*i,M=8*i;return this.float32[T+0]=l,this.float32[T+1]=d,this.float32[T+2]=g,this.int16[M+6]=b,this.int16[M+7]=w,i}}vl.prototype.bytesPerElement=16,Lt("StructArrayLayout2f1f2i16",vl);class Ma extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,d,g){const b=this.length;return this.resize(b+1),this.emplace(b,i,l,d,g)}emplace(i,l,d,g,b){const w=12*i,T=3*i;return this.uint8[w+0]=l,this.uint8[w+1]=d,this.float32[T+1]=g,this.float32[T+2]=b,i}}Ma.prototype.bytesPerElement=12,Lt("StructArrayLayout2ub2f12",Ma);class bl extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,d)}emplace(i,l,d,g){const b=3*i;return this.uint16[b+0]=l,this.uint16[b+1]=d,this.uint16[b+2]=g,i}}bl.prototype.bytesPerElement=6,Lt("StructArrayLayout3ui6",bl);class qs extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,d,g,b,w,T,M,A,O,U,H,K,Q,ae,_e,xe){const Oe=this.length;return this.resize(Oe+1),this.emplace(Oe,i,l,d,g,b,w,T,M,A,O,U,H,K,Q,ae,_e,xe)}emplace(i,l,d,g,b,w,T,M,A,O,U,H,K,Q,ae,_e,xe,Oe){const Se=24*i,Le=12*i,Ye=48*i;return this.int16[Se+0]=l,this.int16[Se+1]=d,this.uint16[Se+2]=g,this.uint16[Se+3]=b,this.uint32[Le+2]=w,this.uint32[Le+3]=T,this.uint32[Le+4]=M,this.uint16[Se+10]=A,this.uint16[Se+11]=O,this.uint16[Se+12]=U,this.float32[Le+7]=H,this.float32[Le+8]=K,this.uint8[Ye+36]=Q,this.uint8[Ye+37]=ae,this.uint8[Ye+38]=_e,this.uint32[Le+10]=xe,this.int16[Se+22]=Oe,i}}qs.prototype.bytesPerElement=48,Lt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",qs);class us extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,d,g,b,w,T,M,A,O,U,H,K,Q,ae,_e,xe,Oe,Se,Le,Ye,tt,Ct,Bt,Tt,wt,mt,zt){const vt=this.length;return this.resize(vt+1),this.emplace(vt,i,l,d,g,b,w,T,M,A,O,U,H,K,Q,ae,_e,xe,Oe,Se,Le,Ye,tt,Ct,Bt,Tt,wt,mt,zt)}emplace(i,l,d,g,b,w,T,M,A,O,U,H,K,Q,ae,_e,xe,Oe,Se,Le,Ye,tt,Ct,Bt,Tt,wt,mt,zt,vt){const at=32*i,Gt=16*i;return this.int16[at+0]=l,this.int16[at+1]=d,this.int16[at+2]=g,this.int16[at+3]=b,this.int16[at+4]=w,this.int16[at+5]=T,this.int16[at+6]=M,this.int16[at+7]=A,this.uint16[at+8]=O,this.uint16[at+9]=U,this.uint16[at+10]=H,this.uint16[at+11]=K,this.uint16[at+12]=Q,this.uint16[at+13]=ae,this.uint16[at+14]=_e,this.uint16[at+15]=xe,this.uint16[at+16]=Oe,this.uint16[at+17]=Se,this.uint16[at+18]=Le,this.uint16[at+19]=Ye,this.uint16[at+20]=tt,this.uint16[at+21]=Ct,this.uint16[at+22]=Bt,this.uint32[Gt+12]=Tt,this.float32[Gt+13]=wt,this.float32[Gt+14]=mt,this.uint16[at+30]=zt,this.uint16[at+31]=vt,i}}us.prototype.bytesPerElement=64,Lt("StructArrayLayout8i15ui1ul2f2ui64",us);class wl extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.float32[1*i+0]=l,i}}wl.prototype.bytesPerElement=4,Lt("StructArrayLayout1f4",wl);class xl extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,d)}emplace(i,l,d,g){const b=3*i;return this.uint16[6*i+0]=l,this.float32[b+1]=d,this.float32[b+2]=g,i}}xl.prototype.bytesPerElement=12,Lt("StructArrayLayout1ui2f12",xl);class hs extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,d)}emplace(i,l,d,g){const b=4*i;return this.uint32[2*i+0]=l,this.uint16[b+2]=d,this.uint16[b+3]=g,i}}hs.prototype.bytesPerElement=8,Lt("StructArrayLayout1ul2ui8",hs);class Rc extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l){const d=this.length;return this.resize(d+1),this.emplace(d,i,l)}emplace(i,l,d){const g=2*i;return this.uint16[g+0]=l,this.uint16[g+1]=d,i}}Rc.prototype.bytesPerElement=4,Lt("StructArrayLayout2ui4",Rc);class Bc extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint16[1*i+0]=l,i}}Bc.prototype.bytesPerElement=2,Lt("StructArrayLayout1ui2",Bc);class kl extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,d,g){const b=this.length;return this.resize(b+1),this.emplace(b,i,l,d,g)}emplace(i,l,d,g,b){const w=4*i;return this.float32[w+0]=l,this.float32[w+1]=d,this.float32[w+2]=g,this.float32[w+3]=b,i}}kl.prototype.bytesPerElement=16,Lt("StructArrayLayout4f16",kl);class Ih extends Sa{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new k(this.anchorPointX,this.anchorPointY)}}Ih.prototype.size=20;class y extends yl{get(i){return new Ih(this,i)}}Lt("CollisionBoxArray",y);class r extends Sa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}r.prototype.size=48;class h extends qs{get(i){return new r(this,i)}}Lt("PlacedSymbolArray",h);class p extends Sa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}p.prototype.size=64;class m extends us{get(i){return new p(this,i)}}Lt("SymbolInstanceArray",m);class v extends wl{getoffsetX(i){return this.float32[1*i+0]}}Lt("GlyphOffsetArray",v);class E extends Ao{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}Lt("SymbolLineVertexArray",E);class C extends Sa{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}C.prototype.size=12;class L extends xl{get(i){return new C(this,i)}}Lt("TextAnchorOffsetArray",L);class F extends Sa{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}F.prototype.size=8;class q extends hs{get(i){return new F(this,i)}}Lt("FeatureIndexArray",q);class Z extends Ta{}class J extends Ta{}class me extends Ta{}class pe extends Ac{}class ye extends Pc{}class se extends Ea{}class Ee extends _l{}class Ge extends zc{}class be extends Dc{}class Ae extends Po{}class He extends Ca{}class Xe extends Ma{}class Ke extends bl{}class nt extends Rc{}const it=Sn([{name:"a_pos",components:2,type:"Int16"}],4),{members:pt}=it;class _t{constructor(i=[]){this.segments=i}prepareSegment(i,l,d,g){let b=this.segments[this.segments.length-1];return i>_t.MAX_VERTEX_ARRAY_LENGTH&&qe(`Max vertices per segment is ${_t.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!b||b.vertexLength+i>_t.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==g)&&(b={vertexOffset:l.length,primitiveOffset:d.length,vertexLength:0,primitiveLength:0},g!==void 0&&(b.sortKey=g),this.segments.push(b)),b}get(){return this.segments}destroy(){for(const i of this.segments)for(const l in i.vaos)i.vaos[l].destroy()}static simpleSegment(i,l,d,g){return new _t([{vertexOffset:i,primitiveOffset:l,vertexLength:d,primitiveLength:g,vaos:{},sortKey:0}])}}function oi(s,i){return 256*(s=le(Math.floor(s),0,255))+le(Math.floor(i),0,255)}_t.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Lt("SegmentVector",_t);const yt=Sn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Kt={exports:{}},si={exports:{}};si.exports=function(s,i){var l,d,g,b,w,T,M,A;for(d=s.length-(l=3&s.length),g=i,w=3432918353,T=461845907,A=0;A<d;)M=255&s.charCodeAt(A)|(255&s.charCodeAt(++A))<<8|(255&s.charCodeAt(++A))<<16|(255&s.charCodeAt(++A))<<24,++A,g=27492+(65535&(b=5*(65535&(g=(g^=M=(65535&(M=(M=(65535&M)*w+(((M>>>16)*w&65535)<<16)&4294967295)<<15|M>>>17))*T+(((M>>>16)*T&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(M=0,l){case 3:M^=(255&s.charCodeAt(A+2))<<16;case 2:M^=(255&s.charCodeAt(A+1))<<8;case 1:g^=M=(65535&(M=(M=(65535&(M^=255&s.charCodeAt(A)))*w+(((M>>>16)*w&65535)<<16)&4294967295)<<15|M>>>17))*T+(((M>>>16)*T&65535)<<16)&4294967295}return g^=s.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var Si=si.exports,Qt={exports:{}};Qt.exports=function(s,i){for(var l,d=s.length,g=i^d,b=0;d>=4;)l=1540483477*(65535&(l=255&s.charCodeAt(b)|(255&s.charCodeAt(++b))<<8|(255&s.charCodeAt(++b))<<16|(255&s.charCodeAt(++b))<<24))+((1540483477*(l>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),d-=4,++b;switch(d){case 3:g^=(255&s.charCodeAt(b+2))<<16;case 2:g^=(255&s.charCodeAt(b+1))<<8;case 1:g=1540483477*(65535&(g^=255&s.charCodeAt(b)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var ci=Si,pi=Qt.exports;Kt.exports=ci,Kt.exports.murmur3=ci,Kt.exports.murmur2=pi;var fn=_(Kt.exports);class Ri{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,l,d,g){this.ids.push(Rr(i)),this.positions.push(l,d,g)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const l=Rr(i);let d=0,g=this.ids.length-1;for(;d<g;){const w=d+g>>1;this.ids[w]>=l?g=w:d=w+1}const b=[];for(;this.ids[d]===l;)b.push({index:this.positions[3*d],start:this.positions[3*d+1],end:this.positions[3*d+2]}),d++;return b}static serialize(i,l){const d=new Float64Array(i.ids),g=new Uint32Array(i.positions);return On(d,g,0,d.length-1),l&&l.push(d.buffer,g.buffer),{ids:d,positions:g}}static deserialize(i){const l=new Ri;return l.ids=i.ids,l.positions=i.positions,l.indexed=!0,l}}function Rr(s){const i=+s;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:fn(String(s))}function On(s,i,l,d){for(;l<d;){const g=s[l+d>>1];let b=l-1,w=d+1;for(;;){do b++;while(s[b]<g);do w--;while(s[w]>g);if(b>=w)break;rn(s,b,w),rn(i,3*b,3*w),rn(i,3*b+1,3*w+1),rn(i,3*b+2,3*w+2)}w-l<d-w?(On(s,i,l,w),l=w+1):(On(s,i,w+1,d),d=w)}}function rn(s,i,l){const d=s[i];s[i]=s[l],s[l]=d}Lt("FeaturePositionMap",Ri);class Nn{constructor(i,l){this.gl=i.gl,this.location=l}}class Br extends Nn{constructor(i,l){super(i,l),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class vo extends Nn{constructor(i,l){super(i,l),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class $o extends Nn{constructor(i,l){super(i,l),this.current=zi.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const Ia=new Float32Array(16);function Xo(s){return[oi(255*s.r,255*s.g),oi(255*s.b,255*s.a)]}class bo{constructor(i,l,d){this.value=i,this.uniformNames=l.map(g=>`u_${g}`),this.type=d}setUniform(i,l,d){i.set(d.constantOr(this.value))}getBinding(i,l,d){return this.type==="color"?new $o(i,l):new Br(i,l)}}class Ln{constructor(i,l){this.uniformNames=l.map(d=>`u_${d}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=i.tlbr}setUniform(i,l,d,g){const b=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;b&&i.set(b)}getBinding(i,l,d){return d.substr(0,9)==="u_pattern"?new vo(i,l):new Br(i,l)}}class on{constructor(i,l,d,g){this.expression=i,this.type=d,this.maxValue=0,this.paintVertexAttributes=l.map(b=>({name:`a_${b}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(i,l,d,g,b){const w=this.paintVertexArray.length,T=this.expression.evaluate(new Yi(0),l,{},g,[],b);this.paintVertexArray.resize(i),this._setPaintValue(w,i,T)}updatePaintArray(i,l,d,g){const b=this.expression.evaluate({zoom:0},d,g);this._setPaintValue(i,l,b)}_setPaintValue(i,l,d){if(this.type==="color"){const g=Xo(d);for(let b=i;b<l;b++)this.paintVertexArray.emplace(b,g[0],g[1])}else{for(let g=i;g<l;g++)this.paintVertexArray.emplace(g,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Qi{constructor(i,l,d,g,b,w){this.expression=i,this.uniformNames=l.map(T=>`u_${T}_t`),this.type=d,this.useIntegerZoom=g,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=l.map(T=>({name:`a_${T}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new w}populatePaintArray(i,l,d,g,b){const w=this.expression.evaluate(new Yi(this.zoom),l,{},g,[],b),T=this.expression.evaluate(new Yi(this.zoom+1),l,{},g,[],b),M=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(M,i,w,T)}updatePaintArray(i,l,d,g){const b=this.expression.evaluate({zoom:this.zoom},d,g),w=this.expression.evaluate({zoom:this.zoom+1},d,g);this._setPaintValue(i,l,b,w)}_setPaintValue(i,l,d,g){if(this.type==="color"){const b=Xo(d),w=Xo(g);for(let T=i;T<l;T++)this.paintVertexArray.emplace(T,b[0],b[1],w[0],w[1])}else{for(let b=i;b<l;b++)this.paintVertexArray.emplace(b,d,g);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(g))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,l){const d=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,g=le(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);i.set(g)}getBinding(i,l,d){return new Br(i,l)}}class Xr{constructor(i,l,d,g,b,w){this.expression=i,this.type=l,this.useIntegerZoom=d,this.zoom=g,this.layerId=w,this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b}populatePaintArray(i,l,d){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(g,i,l.patterns&&l.patterns[this.layerId],d)}updatePaintArray(i,l,d,g,b){this._setPaintValues(i,l,d.patterns&&d.patterns[this.layerId],b)}_setPaintValues(i,l,d,g){if(!g||!d)return;const{min:b,mid:w,max:T}=d,M=g[b],A=g[w],O=g[T];if(M&&A&&O)for(let U=i;U<l;U++)this.zoomInPaintVertexArray.emplace(U,A.tl[0],A.tl[1],A.br[0],A.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],A.pixelRatio,M.pixelRatio),this.zoomOutPaintVertexArray.emplace(U,A.tl[0],A.tl[1],A.br[0],A.br[1],O.tl[0],O.tl[1],O.br[0],O.br[1],A.pixelRatio,O.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,yt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,yt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class An{constructor(i,l,d){this.binders={},this._buffers=[];const g=[];for(const b in i.paint._values){if(!d(b))continue;const w=i.paint.get(b);if(!(w instanceof no&&Bs(w.property.specification)))continue;const T=Kr(b,i.type),M=w.value,A=w.property.specification.type,O=w.property.useIntegerZoom,U=w.property.specification["property-type"],H=U==="cross-faded"||U==="cross-faded-data-driven";if(M.kind==="constant")this.binders[b]=H?new Ln(M.value,T):new bo(M.value,T,A),g.push(`/u_${b}`);else if(M.kind==="source"||H){const K=Pn(b,A,"source");this.binders[b]=H?new Xr(M,A,O,l,K,i.id):new on(M,T,A,K),g.push(`/a_${b}`)}else{const K=Pn(b,A,"composite");this.binders[b]=new Qi(M,T,A,O,l,K),g.push(`/z_${b}`)}}this.cacheKey=g.sort().join("")}getMaxValue(i){const l=this.binders[i];return l instanceof on||l instanceof Qi?l.maxValue:0}populatePaintArrays(i,l,d,g,b){for(const w in this.binders){const T=this.binders[w];(T instanceof on||T instanceof Qi||T instanceof Xr)&&T.populatePaintArray(i,l,d,g,b)}}setConstantPatternPositions(i,l){for(const d in this.binders){const g=this.binders[d];g instanceof Ln&&g.setConstantPatternPositions(i,l)}}updatePaintArrays(i,l,d,g,b){let w=!1;for(const T in i){const M=l.getPositions(T);for(const A of M){const O=d.feature(A.index);for(const U in this.binders){const H=this.binders[U];if((H instanceof on||H instanceof Qi||H instanceof Xr)&&H.expression.isStateDependent===!0){const K=g.paint.get(U);H.expression=K.value,H.updatePaintArray(A.start,A.end,O,i[T],b),w=!0}}}}return w}defines(){const i=[];for(const l in this.binders){const d=this.binders[l];(d instanceof bo||d instanceof Ln)&&i.push(...d.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return i}getBinderAttributes(){const i=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof on||d instanceof Qi)for(let g=0;g<d.paintVertexAttributes.length;g++)i.push(d.paintVertexAttributes[g].name);else if(d instanceof Xr)for(let g=0;g<yt.members.length;g++)i.push(yt.members[g].name)}return i}getBinderUniforms(){const i=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof bo||d instanceof Ln||d instanceof Qi)for(const g of d.uniformNames)i.push(g)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,l){const d=[];for(const g in this.binders){const b=this.binders[g];if(b instanceof bo||b instanceof Ln||b instanceof Qi){for(const w of b.uniformNames)if(l[w]){const T=b.getBinding(i,l[w],w);d.push({name:w,property:g,binding:T})}}}return d}setUniforms(i,l,d,g){for(const{name:b,property:w,binding:T}of l)this.binders[w].setUniform(T,g,d.get(w),b)}updatePaintBuffers(i){this._buffers=[];for(const l in this.binders){const d=this.binders[l];if(i&&d instanceof Xr){const g=i.fromScale===2?d.zoomInPaintVertexBuffer:d.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(d instanceof on||d instanceof Qi)&&d.paintVertexBuffer&&this._buffers.push(d.paintVertexBuffer)}}upload(i){for(const l in this.binders){const d=this.binders[l];(d instanceof on||d instanceof Qi||d instanceof Xr)&&d.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const l=this.binders[i];(l instanceof on||l instanceof Qi||l instanceof Xr)&&l.destroy()}}}class sn{constructor(i,l,d=()=>!0){this.programConfigurations={};for(const g of i)this.programConfigurations[g.id]=new An(g,l,d);this.needsUpload=!1,this._featureMap=new Ri,this._bufferOffset=0}populatePaintArrays(i,l,d,g,b,w){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(i,l,g,b,w);l.id!==void 0&&this._featureMap.add(l.id,d,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,l,d,g){for(const b of d)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(i,this._featureMap,l,b,g)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function Kr(s,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(`${i}-`,"").replace(/-/g,"_")]}function Pn(s,i,l){const d={color:{source:Ea,composite:kl},number:{source:wl,composite:Ea}},g=function(b){return{"line-pattern":{source:Ee,composite:Ee},"fill-pattern":{source:Ee,composite:Ee},"fill-extrusion-pattern":{source:Ee,composite:Ee}}[b]}(s);return g&&g[l]||d[i][l]}Lt("ConstantBinder",bo),Lt("CrossFadedConstantBinder",Ln),Lt("SourceExpressionBinder",on),Lt("CrossFadedCompositeBinder",Xr),Lt("CompositeExpressionBinder",Qi),Lt("ProgramConfiguration",An,{omit:["_buffers"]}),Lt("ProgramConfigurationSet",sn);const yn=8192,Fc=Math.pow(2,14)-1,Lh=-Fc-1;function ds(s){const i=yn/s.extent,l=s.loadGeometry();for(let d=0;d<l.length;d++){const g=l[d];for(let b=0;b<g.length;b++){const w=g[b],T=Math.round(w.x*i),M=Math.round(w.y*i);w.x=le(T,Lh,Fc),w.y=le(M,Lh,Fc),(T<w.x||T>w.x+1||M<w.y||M>w.y+1)&&qe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function fs(s,i){return{type:s.type,id:s.id,properties:s.properties,geometry:i?ds(s):[]}}function Sl(s,i,l,d,g){s.emplaceBack(2*i+(d+1)/2,2*l+(g+1)/2)}class Ko{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new J,this.indexArray=new Ke,this.segments=new _t,this.programConfigurations=new sn(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,d){const g=this.layers[0],b=[];let w=null,T=!1;g.type==="circle"&&(w=g.layout.get("circle-sort-key"),T=!w.isConstant());for(const{feature:M,id:A,index:O,sourceLayerIndex:U}of i){const H=this.layers[0]._featureFilter.needGeometry,K=fs(M,H);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom),K,d))continue;const Q=T?w.evaluate(K,{},d):void 0,ae={id:A,properties:M.properties,type:M.type,sourceLayerIndex:U,index:O,geometry:H?K.geometry:ds(M),patterns:{},sortKey:Q};b.push(ae)}T&&b.sort((M,A)=>M.sortKey-A.sortKey);for(const M of b){const{geometry:A,index:O,sourceLayerIndex:U}=M,H=i[O].feature;this.addFeature(M,A,O,d),l.featureIndex.insert(H,A,O,U,this.index)}}update(i,l,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,pt),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,l,d,g){for(const b of l)for(const w of b){const T=w.x,M=w.y;if(T<0||T>=yn||M<0||M>=yn)continue;const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),O=A.vertexLength;Sl(this.layoutVertexArray,T,M,-1,-1),Sl(this.layoutVertexArray,T,M,1,-1),Sl(this.layoutVertexArray,T,M,1,1),Sl(this.layoutVertexArray,T,M,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+3,O+2),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,{},g)}}function Oc(s,i){for(let l=0;l<s.length;l++)if(El(i,s[l]))return!0;for(let l=0;l<i.length;l++)if(El(s,i[l]))return!0;return!!Tl(s,i)}function Ah(s,i,l){return!!El(s,i)||!!Xd(i,s,l)}function Nc(s,i){if(s.length===1)return qp(i,s[0]);for(let l=0;l<i.length;l++){const d=i[l];for(let g=0;g<d.length;g++)if(El(s,d[g]))return!0}for(let l=0;l<s.length;l++)if(qp(i,s[l]))return!0;for(let l=0;l<i.length;l++)if(Tl(s,i[l]))return!0;return!1}function jc(s,i,l){if(s.length>1){if(Tl(s,i))return!0;for(let d=0;d<i.length;d++)if(Xd(i[d],s,l))return!0}for(let d=0;d<s.length;d++)if(Xd(s[d],i,l))return!0;return!1}function Tl(s,i){if(s.length===0||i.length===0)return!1;for(let l=0;l<s.length-1;l++){const d=s[l],g=s[l+1];for(let b=0;b<i.length-1;b++)if(Uc(d,g,i[b],i[b+1]))return!0}return!1}function Uc(s,i,l,d){return Ce(s,l,d)!==Ce(i,l,d)&&Ce(s,i,l)!==Ce(s,i,d)}function Xd(s,i,l){const d=l*l;if(i.length===1)return s.distSqr(i[0])<d;for(let g=1;g<i.length;g++)if(Vp(s,i[g-1],i[g])<d)return!0;return!1}function Vp(s,i,l){const d=i.distSqr(l);if(d===0)return s.distSqr(i);const g=((s.x-i.x)*(l.x-i.x)+(s.y-i.y)*(l.y-i.y))/d;return s.distSqr(g<0?i:g>1?l:l.sub(i)._mult(g)._add(i))}function qp(s,i){let l,d,g,b=!1;for(let w=0;w<s.length;w++){l=s[w];for(let T=0,M=l.length-1;T<l.length;M=T++)d=l[T],g=l[M],d.y>i.y!=g.y>i.y&&i.x<(g.x-d.x)*(i.y-d.y)/(g.y-d.y)+d.x&&(b=!b)}return b}function El(s,i){let l=!1;for(let d=0,g=s.length-1;d<s.length;g=d++){const b=s[d],w=s[g];b.y>i.y!=w.y>i.y&&i.x<(w.x-b.x)*(i.y-b.y)/(w.y-b.y)+b.x&&(l=!l)}return l}function e1(s,i,l){const d=l[0],g=l[2];if(s.x<d.x&&i.x<d.x||s.x>g.x&&i.x>g.x||s.y<d.y&&i.y<d.y||s.y>g.y&&i.y>g.y)return!1;const b=Ce(s,i,l[0]);return b!==Ce(s,i,l[1])||b!==Ce(s,i,l[2])||b!==Ce(s,i,l[3])}function Vc(s,i,l){const d=i.paint.get(s).value;return d.kind==="constant"?d.value:l.programConfigurations.get(i.id).getMaxValue(s)}function Ph(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function zh(s,i,l,d,g){if(!i[0]&&!i[1])return s;const b=k.convert(i)._mult(g);l==="viewport"&&b._rotate(-d);const w=[];for(let T=0;T<s.length;T++)w.push(s[T].sub(b));return w}let Zp,Gp;Lt("CircleBucket",Ko,{omit:["layers"]});var t1={get paint(){return Gp=Gp||new xr({"circle-radius":new $t(we.paint_circle["circle-radius"]),"circle-color":new $t(we.paint_circle["circle-color"]),"circle-blur":new $t(we.paint_circle["circle-blur"]),"circle-opacity":new $t(we.paint_circle["circle-opacity"]),"circle-translate":new Nt(we.paint_circle["circle-translate"]),"circle-translate-anchor":new Nt(we.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Nt(we.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Nt(we.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new $t(we.paint_circle["circle-stroke-width"]),"circle-stroke-color":new $t(we.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new $t(we.paint_circle["circle-stroke-opacity"])})},get layout(){return Zp=Zp||new xr({"circle-sort-key":new $t(we.layout_circle["circle-sort-key"])})}},kr=1e-6,Cl=typeof Float32Array<"u"?Float32Array:Array;function Kd(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Wp(s,i,l){var d=i[0],g=i[1],b=i[2],w=i[3],T=i[4],M=i[5],A=i[6],O=i[7],U=i[8],H=i[9],K=i[10],Q=i[11],ae=i[12],_e=i[13],xe=i[14],Oe=i[15],Se=l[0],Le=l[1],Ye=l[2],tt=l[3];return s[0]=Se*d+Le*T+Ye*U+tt*ae,s[1]=Se*g+Le*M+Ye*H+tt*_e,s[2]=Se*b+Le*A+Ye*K+tt*xe,s[3]=Se*w+Le*O+Ye*Q+tt*Oe,s[4]=(Se=l[4])*d+(Le=l[5])*T+(Ye=l[6])*U+(tt=l[7])*ae,s[5]=Se*g+Le*M+Ye*H+tt*_e,s[6]=Se*b+Le*A+Ye*K+tt*xe,s[7]=Se*w+Le*O+Ye*Q+tt*Oe,s[8]=(Se=l[8])*d+(Le=l[9])*T+(Ye=l[10])*U+(tt=l[11])*ae,s[9]=Se*g+Le*M+Ye*H+tt*_e,s[10]=Se*b+Le*A+Ye*K+tt*xe,s[11]=Se*w+Le*O+Ye*Q+tt*Oe,s[12]=(Se=l[12])*d+(Le=l[13])*T+(Ye=l[14])*U+(tt=l[15])*ae,s[13]=Se*g+Le*M+Ye*H+tt*_e,s[14]=Se*b+Le*A+Ye*K+tt*xe,s[15]=Se*w+Le*O+Ye*Q+tt*Oe,s}Math.hypot||(Math.hypot=function(){for(var s=0,i=arguments.length;i--;)s+=arguments[i]*arguments[i];return Math.sqrt(s)});var qc,i1=Wp;function Dh(s,i,l){var d=i[0],g=i[1],b=i[2],w=i[3];return s[0]=l[0]*d+l[4]*g+l[8]*b+l[12]*w,s[1]=l[1]*d+l[5]*g+l[9]*b+l[13]*w,s[2]=l[2]*d+l[6]*g+l[10]*b+l[14]*w,s[3]=l[3]*d+l[7]*g+l[11]*b+l[15]*w,s}qc=new Cl(4),Cl!=Float32Array&&(qc[0]=0,qc[1]=0,qc[2]=0,qc[3]=0);class n1 extends ro{constructor(i){super(i,t1)}createBucket(i){return new Ko(i)}queryRadius(i){const l=i;return Vc("circle-radius",this,l)+Vc("circle-stroke-width",this,l)+Ph(this.paint.get("circle-translate"))}queryIntersectsFeature(i,l,d,g,b,w,T,M){const A=zh(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),w.angle,T),O=this.paint.get("circle-radius").evaluate(l,d)+this.paint.get("circle-stroke-width").evaluate(l,d),U=this.paint.get("circle-pitch-alignment")==="map",H=U?A:function(Q,ae){return Q.map(_e=>Hp(_e,ae))}(A,M),K=U?O*T:O;for(const Q of g)for(const ae of Q){const _e=U?ae:Hp(ae,M);let xe=K;const Oe=Dh([],[ae.x,ae.y,0,1],M);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?xe*=Oe[3]/w.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(xe*=w.cameraToCenterDistance/Oe[3]),Ah(H,_e,xe))return!0}return!1}}function Hp(s,i){const l=Dh([],[s.x,s.y,0,1],i);return new k(l[0]/l[3],l[1]/l[3])}class $p extends Ko{}let Xp;Lt("HeatmapBucket",$p,{omit:["layers"]});var r1={get paint(){return Xp=Xp||new xr({"heatmap-radius":new $t(we.paint_heatmap["heatmap-radius"]),"heatmap-weight":new $t(we.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Nt(we.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Mc(we.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Nt(we.paint_heatmap["heatmap-opacity"])})}};function Jd(s,{width:i,height:l},d,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==i*l*d)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${i*l*d}`)}else g=new Uint8Array(i*l*d);return s.width=i,s.height=l,s.data=g,s}function Kp(s,{width:i,height:l},d){if(i===s.width&&l===s.height)return;const g=Jd({},{width:i,height:l},d);Yd(s,g,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,i),height:Math.min(s.height,l)},d),s.width=i,s.height=l,s.data=g.data}function Yd(s,i,l,d,g,b){if(g.width===0||g.height===0)return i;if(g.width>s.width||g.height>s.height||l.x>s.width-g.width||l.y>s.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>i.width||g.height>i.height||d.x>i.width-g.width||d.y>i.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const w=s.data,T=i.data;if(w===T)throw new Error("srcData equals dstData, so image is already copied");for(let M=0;M<g.height;M++){const A=((l.y+M)*s.width+l.x)*b,O=((d.y+M)*i.width+d.x)*b;for(let U=0;U<g.width*b;U++)T[O+U]=w[A+U]}return i}class Zc{constructor(i,l){Jd(this,i,1,l)}resize(i){Kp(this,i,1)}clone(){return new Zc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,d,g,b){Yd(i,l,d,g,b,1)}}class oo{constructor(i,l){Jd(this,i,4,l)}resize(i){Kp(this,i,4)}replace(i,l){l?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new oo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,d,g,b){Yd(i,l,d,g,b,4)}}function Jp(s){const i={},l=s.resolution||256,d=s.clips?s.clips.length:1,g=s.image||new oo({width:l,height:d});if(Math.log(l)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${l}`);const b=(w,T,M)=>{i[s.evaluationKey]=M;const A=s.expression.evaluate(i);g.data[w+T+0]=Math.floor(255*A.r/A.a),g.data[w+T+1]=Math.floor(255*A.g/A.a),g.data[w+T+2]=Math.floor(255*A.b/A.a),g.data[w+T+3]=Math.floor(255*A.a)};if(s.clips)for(let w=0,T=0;w<d;++w,T+=4*l)for(let M=0,A=0;M<l;M++,A+=4){const O=M/(l-1),{start:U,end:H}=s.clips[w];b(T,A,U*(1-O)+H*O)}else for(let w=0,T=0;w<l;w++,T+=4)b(0,T,w/(l-1));return g}Lt("AlphaImage",Zc),Lt("RGBAImage",oo);class o1 extends ro{createBucket(i){return new $p(i)}constructor(i){super(i,r1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Jp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Yp;var s1={get paint(){return Yp=Yp||new xr({"hillshade-illumination-direction":new Nt(we.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Nt(we.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Nt(we.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Nt(we.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Nt(we.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Nt(we.paint_hillshade["hillshade-accent-color"])})}};class a1 extends ro{constructor(i){super(i,s1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const l1=Sn([{name:"a_pos",components:2,type:"Int16"}],4),{members:c1}=l1;var Qd={exports:{}};function Rh(s,i,l){l=l||2;var d,g,b,w,T,M,A,O=i&&i.length,U=O?i[0]*l:s.length,H=Qp(s,0,U,l,!0),K=[];if(!H||H.next===H.prev)return K;if(O&&(H=function(ae,_e,xe,Oe){var Se,Le,Ye,tt=[];for(Se=0,Le=_e.length;Se<Le;Se++)(Ye=Qp(ae,_e[Se]*Oe,Se<Le-1?_e[Se+1]*Oe:ae.length,Oe,!1))===Ye.next&&(Ye.steiner=!0),tt.push(_1(Ye));for(tt.sort(p1),Se=0;Se<tt.length;Se++)xe=m1(tt[Se],xe);return xe}(s,i,H,l)),s.length>80*l){d=b=s[0],g=w=s[1];for(var Q=l;Q<U;Q+=l)(T=s[Q])<d&&(d=T),(M=s[Q+1])<g&&(g=M),T>b&&(b=T),M>w&&(w=M);A=(A=Math.max(b-d,w-g))!==0?32767/A:0}return Gc(H,K,l,d,g,A,0),K}function Qp(s,i,l,d,g){var b,w;if(g===nf(s,i,l,d)>0)for(b=i;b<l;b+=d)w=im(b,s[b],s[b+1],w);else for(b=l-d;b>=i;b-=d)w=im(b,s[b],s[b+1],w);return w&&Bh(w,w.next)&&(Hc(w),w=w.next),w}function La(s,i){if(!s)return s;i||(i=s);var l,d=s;do if(l=!1,d.steiner||!Bh(d,d.next)&&Tn(d.prev,d,d.next)!==0)d=d.next;else{if(Hc(d),(d=i=d.prev)===d.next)break;l=!0}while(l||d!==i);return i}function Gc(s,i,l,d,g,b,w){if(s){!w&&b&&function(O,U,H,K){var Q=O;do Q.z===0&&(Q.z=ef(Q.x,Q.y,U,H,K)),Q.prevZ=Q.prev,Q.nextZ=Q.next,Q=Q.next;while(Q!==O);Q.prevZ.nextZ=null,Q.prevZ=null,function(ae){var _e,xe,Oe,Se,Le,Ye,tt,Ct,Bt=1;do{for(xe=ae,ae=null,Le=null,Ye=0;xe;){for(Ye++,Oe=xe,tt=0,_e=0;_e<Bt&&(tt++,Oe=Oe.nextZ);_e++);for(Ct=Bt;tt>0||Ct>0&&Oe;)tt!==0&&(Ct===0||!Oe||xe.z<=Oe.z)?(Se=xe,xe=xe.nextZ,tt--):(Se=Oe,Oe=Oe.nextZ,Ct--),Le?Le.nextZ=Se:ae=Se,Se.prevZ=Le,Le=Se;xe=Oe}Le.nextZ=null,Bt*=2}while(Ye>1)}(Q)}(s,d,g,b);for(var T,M,A=s;s.prev!==s.next;)if(T=s.prev,M=s.next,b?h1(s,d,g,b):u1(s))i.push(T.i/l|0),i.push(s.i/l|0),i.push(M.i/l|0),Hc(s),s=M.next,A=M.next;else if((s=M)===A){w?w===1?Gc(s=d1(La(s),i,l),i,l,d,g,b,2):w===2&&f1(s,i,l,d,g,b):Gc(La(s),i,l,d,g,b,1);break}}}function u1(s){var i=s.prev,l=s,d=s.next;if(Tn(i,l,d)>=0)return!1;for(var g=i.x,b=l.x,w=d.x,T=i.y,M=l.y,A=d.y,O=g<b?g<w?g:w:b<w?b:w,U=T<M?T<A?T:A:M<A?M:A,H=g>b?g>w?g:w:b>w?b:w,K=T>M?T>A?T:A:M>A?M:A,Q=d.next;Q!==i;){if(Q.x>=O&&Q.x<=H&&Q.y>=U&&Q.y<=K&&Ml(g,T,b,M,w,A,Q.x,Q.y)&&Tn(Q.prev,Q,Q.next)>=0)return!1;Q=Q.next}return!0}function h1(s,i,l,d){var g=s.prev,b=s,w=s.next;if(Tn(g,b,w)>=0)return!1;for(var T=g.x,M=b.x,A=w.x,O=g.y,U=b.y,H=w.y,K=T<M?T<A?T:A:M<A?M:A,Q=O<U?O<H?O:H:U<H?U:H,ae=T>M?T>A?T:A:M>A?M:A,_e=O>U?O>H?O:H:U>H?U:H,xe=ef(K,Q,i,l,d),Oe=ef(ae,_e,i,l,d),Se=s.prevZ,Le=s.nextZ;Se&&Se.z>=xe&&Le&&Le.z<=Oe;){if(Se.x>=K&&Se.x<=ae&&Se.y>=Q&&Se.y<=_e&&Se!==g&&Se!==w&&Ml(T,O,M,U,A,H,Se.x,Se.y)&&Tn(Se.prev,Se,Se.next)>=0||(Se=Se.prevZ,Le.x>=K&&Le.x<=ae&&Le.y>=Q&&Le.y<=_e&&Le!==g&&Le!==w&&Ml(T,O,M,U,A,H,Le.x,Le.y)&&Tn(Le.prev,Le,Le.next)>=0))return!1;Le=Le.nextZ}for(;Se&&Se.z>=xe;){if(Se.x>=K&&Se.x<=ae&&Se.y>=Q&&Se.y<=_e&&Se!==g&&Se!==w&&Ml(T,O,M,U,A,H,Se.x,Se.y)&&Tn(Se.prev,Se,Se.next)>=0)return!1;Se=Se.prevZ}for(;Le&&Le.z<=Oe;){if(Le.x>=K&&Le.x<=ae&&Le.y>=Q&&Le.y<=_e&&Le!==g&&Le!==w&&Ml(T,O,M,U,A,H,Le.x,Le.y)&&Tn(Le.prev,Le,Le.next)>=0)return!1;Le=Le.nextZ}return!0}function d1(s,i,l){var d=s;do{var g=d.prev,b=d.next.next;!Bh(g,b)&&em(g,d,d.next,b)&&Wc(g,b)&&Wc(b,g)&&(i.push(g.i/l|0),i.push(d.i/l|0),i.push(b.i/l|0),Hc(d),Hc(d.next),d=s=b),d=d.next}while(d!==s);return La(d)}function f1(s,i,l,d,g,b){var w=s;do{for(var T=w.next.next;T!==w.prev;){if(w.i!==T.i&&y1(w,T)){var M=tm(w,T);return w=La(w,w.next),M=La(M,M.next),Gc(w,i,l,d,g,b,0),void Gc(M,i,l,d,g,b,0)}T=T.next}w=w.next}while(w!==s)}function p1(s,i){return s.x-i.x}function m1(s,i){var l=function(g,b){var w,T=b,M=g.x,A=g.y,O=-1/0;do{if(A<=T.y&&A>=T.next.y&&T.next.y!==T.y){var U=T.x+(A-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(U<=M&&U>O&&(O=U,w=T.x<T.next.x?T:T.next,U===M))return w}T=T.next}while(T!==b);if(!w)return null;var H,K=w,Q=w.x,ae=w.y,_e=1/0;T=w;do M>=T.x&&T.x>=Q&&M!==T.x&&Ml(A<ae?M:O,A,Q,ae,A<ae?O:M,A,T.x,T.y)&&(H=Math.abs(A-T.y)/(M-T.x),Wc(T,g)&&(H<_e||H===_e&&(T.x>w.x||T.x===w.x&&g1(w,T)))&&(w=T,_e=H)),T=T.next;while(T!==K);return w}(s,i);if(!l)return i;var d=tm(l,s);return La(d,d.next),La(l,l.next)}function g1(s,i){return Tn(s.prev,s,i.prev)<0&&Tn(i.next,s,s.next)<0}function ef(s,i,l,d,g){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-l)*g|0)|s<<8))|s<<4))|s<<2))|s<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-d)*g|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function _1(s){var i=s,l=s;do(i.x<l.x||i.x===l.x&&i.y<l.y)&&(l=i),i=i.next;while(i!==s);return l}function Ml(s,i,l,d,g,b,w,T){return(g-w)*(i-T)>=(s-w)*(b-T)&&(s-w)*(d-T)>=(l-w)*(i-T)&&(l-w)*(b-T)>=(g-w)*(d-T)}function y1(s,i){return s.next.i!==i.i&&s.prev.i!==i.i&&!function(l,d){var g=l;do{if(g.i!==l.i&&g.next.i!==l.i&&g.i!==d.i&&g.next.i!==d.i&&em(g,g.next,l,d))return!0;g=g.next}while(g!==l);return!1}(s,i)&&(Wc(s,i)&&Wc(i,s)&&function(l,d){var g=l,b=!1,w=(l.x+d.x)/2,T=(l.y+d.y)/2;do g.y>T!=g.next.y>T&&g.next.y!==g.y&&w<(g.next.x-g.x)*(T-g.y)/(g.next.y-g.y)+g.x&&(b=!b),g=g.next;while(g!==l);return b}(s,i)&&(Tn(s.prev,s,i.prev)||Tn(s,i.prev,i))||Bh(s,i)&&Tn(s.prev,s,s.next)>0&&Tn(i.prev,i,i.next)>0)}function Tn(s,i,l){return(i.y-s.y)*(l.x-i.x)-(i.x-s.x)*(l.y-i.y)}function Bh(s,i){return s.x===i.x&&s.y===i.y}function em(s,i,l,d){var g=Oh(Tn(s,i,l)),b=Oh(Tn(s,i,d)),w=Oh(Tn(l,d,s)),T=Oh(Tn(l,d,i));return g!==b&&w!==T||!(g!==0||!Fh(s,l,i))||!(b!==0||!Fh(s,d,i))||!(w!==0||!Fh(l,s,d))||!(T!==0||!Fh(l,i,d))}function Fh(s,i,l){return i.x<=Math.max(s.x,l.x)&&i.x>=Math.min(s.x,l.x)&&i.y<=Math.max(s.y,l.y)&&i.y>=Math.min(s.y,l.y)}function Oh(s){return s>0?1:s<0?-1:0}function Wc(s,i){return Tn(s.prev,s,s.next)<0?Tn(s,i,s.next)>=0&&Tn(s,s.prev,i)>=0:Tn(s,i,s.prev)<0||Tn(s,s.next,i)<0}function tm(s,i){var l=new tf(s.i,s.x,s.y),d=new tf(i.i,i.x,i.y),g=s.next,b=i.prev;return s.next=i,i.prev=s,l.next=g,g.prev=l,d.next=l,l.prev=d,b.next=d,d.prev=b,d}function im(s,i,l,d){var g=new tf(s,i,l);return d?(g.next=d.next,g.prev=d,d.next.prev=g,d.next=g):(g.prev=g,g.next=g),g}function Hc(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function tf(s,i,l){this.i=s,this.x=i,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function nf(s,i,l,d){for(var g=0,b=i,w=l-d;b<l;b+=d)g+=(s[w]-s[b])*(s[b+1]+s[w+1]),w=b;return g}Qd.exports=Rh,Qd.exports.default=Rh,Rh.deviation=function(s,i,l,d){var g=i&&i.length,b=Math.abs(nf(s,0,g?i[0]*l:s.length,l));if(g)for(var w=0,T=i.length;w<T;w++)b-=Math.abs(nf(s,i[w]*l,w<T-1?i[w+1]*l:s.length,l));var M=0;for(w=0;w<d.length;w+=3){var A=d[w]*l,O=d[w+1]*l,U=d[w+2]*l;M+=Math.abs((s[A]-s[U])*(s[O+1]-s[A+1])-(s[A]-s[O])*(s[U+1]-s[A+1]))}return b===0&&M===0?0:Math.abs((M-b)/b)},Rh.flatten=function(s){for(var i=s[0][0].length,l={vertices:[],holes:[],dimensions:i},d=0,g=0;g<s.length;g++){for(var b=0;b<s[g].length;b++)for(var w=0;w<i;w++)l.vertices.push(s[g][b][w]);g>0&&l.holes.push(d+=s[g-1].length)}return l};var nm=_(Qd.exports);function v1(s,i,l,d,g){rm(s,i,l||0,d||s.length-1,g||b1)}function rm(s,i,l,d,g){for(;d>l;){if(d-l>600){var b=d-l+1,w=i-l+1,T=Math.log(b),M=.5*Math.exp(2*T/3),A=.5*Math.sqrt(T*M*(b-M)/b)*(w-b/2<0?-1:1);rm(s,i,Math.max(l,Math.floor(i-w*M/b+A)),Math.min(d,Math.floor(i+(b-w)*M/b+A)),g)}var O=s[i],U=l,H=d;for($c(s,l,i),g(s[d],O)>0&&$c(s,l,d);U<H;){for($c(s,U,H),U++,H--;g(s[U],O)<0;)U++;for(;g(s[H],O)>0;)H--}g(s[l],O)===0?$c(s,l,H):$c(s,++H,d),H<=i&&(l=H+1),i<=H&&(d=H-1)}}function $c(s,i,l){var d=s[i];s[i]=s[l],s[l]=d}function b1(s,i){return s<i?-1:s>i?1:0}function rf(s,i){const l=s.length;if(l<=1)return[s];const d=[];let g,b;for(let w=0;w<l;w++){const T=et(s[w]);T!==0&&(s[w].area=Math.abs(T),b===void 0&&(b=T<0),b===T<0?(g&&d.push(g),g=[s[w]]):g.push(s[w]))}if(g&&d.push(g),i>1)for(let w=0;w<d.length;w++)d[w].length<=i||(v1(d[w],i,1,d[w].length-1,w1),d[w]=d[w].slice(0,i));return d}function w1(s,i){return i.area-s.area}function of(s,i,l){const d=l.patternDependencies;let g=!1;for(const b of i){const w=b.paint.get(`${s}-pattern`);w.isConstant()||(g=!0);const T=w.constantOr(null);T&&(g=!0,d[T.to]=!0,d[T.from]=!0)}return g}function sf(s,i,l,d,g){const b=g.patternDependencies;for(const w of i){const T=w.paint.get(`${s}-pattern`).value;if(T.kind!=="constant"){let M=T.evaluate({zoom:d-1},l,{},g.availableImages),A=T.evaluate({zoom:d},l,{},g.availableImages),O=T.evaluate({zoom:d+1},l,{},g.availableImages);M=M&&M.name?M.name:M,A=A&&A.name?A.name:A,O=O&&O.name?O.name:O,b[M]=!0,b[A]=!0,b[O]=!0,l.patterns[w.id]={min:M,mid:A,max:O}}}return l}class af{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new me,this.indexArray=new Ke,this.indexArray2=new nt,this.programConfigurations=new sn(i.layers,i.zoom),this.segments=new _t,this.segments2=new _t,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,d){this.hasPattern=of("fill",this.layers,l);const g=this.layers[0].layout.get("fill-sort-key"),b=!g.isConstant(),w=[];for(const{feature:T,id:M,index:A,sourceLayerIndex:O}of i){const U=this.layers[0]._featureFilter.needGeometry,H=fs(T,U);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom),H,d))continue;const K=b?g.evaluate(H,{},d,l.availableImages):void 0,Q={id:M,properties:T.properties,type:T.type,sourceLayerIndex:O,index:A,geometry:U?H.geometry:ds(T),patterns:{},sortKey:K};w.push(Q)}b&&w.sort((T,M)=>T.sortKey-M.sortKey);for(const T of w){const{geometry:M,index:A,sourceLayerIndex:O}=T;if(this.hasPattern){const U=sf("fill",this.layers,T,this.zoom,l);this.patternFeatures.push(U)}else this.addFeature(T,M,A,d,{});l.featureIndex.insert(i[A].feature,M,A,O,this.index)}}update(i,l,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,d)}addFeatures(i,l,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,c1),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,l,d,g,b){for(const w of rf(l,500)){let T=0;for(const K of w)T+=K.length;const M=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),A=M.vertexLength,O=[],U=[];for(const K of w){if(K.length===0)continue;K!==w[0]&&U.push(O.length/2);const Q=this.segments2.prepareSegment(K.length,this.layoutVertexArray,this.indexArray2),ae=Q.vertexLength;this.layoutVertexArray.emplaceBack(K[0].x,K[0].y),this.indexArray2.emplaceBack(ae+K.length-1,ae),O.push(K[0].x),O.push(K[0].y);for(let _e=1;_e<K.length;_e++)this.layoutVertexArray.emplaceBack(K[_e].x,K[_e].y),this.indexArray2.emplaceBack(ae+_e-1,ae+_e),O.push(K[_e].x),O.push(K[_e].y);Q.vertexLength+=K.length,Q.primitiveLength+=K.length}const H=nm(O,U);for(let K=0;K<H.length;K+=3)this.indexArray.emplaceBack(A+H[K],A+H[K+1],A+H[K+2]);M.vertexLength+=T,M.primitiveLength+=H.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,b,g)}}let om,sm;Lt("FillBucket",af,{omit:["layers","patternFeatures"]});var x1={get paint(){return sm=sm||new xr({"fill-antialias":new Nt(we.paint_fill["fill-antialias"]),"fill-opacity":new $t(we.paint_fill["fill-opacity"]),"fill-color":new $t(we.paint_fill["fill-color"]),"fill-outline-color":new $t(we.paint_fill["fill-outline-color"]),"fill-translate":new Nt(we.paint_fill["fill-translate"]),"fill-translate-anchor":new Nt(we.paint_fill["fill-translate-anchor"]),"fill-pattern":new gl(we.paint_fill["fill-pattern"])})},get layout(){return om=om||new xr({"fill-sort-key":new $t(we.layout_fill["fill-sort-key"])})}};class k1 extends ro{constructor(i){super(i,x1)}recalculate(i,l){super.recalculate(i,l);const d=this.paint._values["fill-outline-color"];d.value.kind==="constant"&&d.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new af(i)}queryRadius(){return Ph(this.paint.get("fill-translate"))}queryIntersectsFeature(i,l,d,g,b,w,T){return Nc(zh(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),w.angle,T),g)}isTileClipped(){return!0}}const S1=Sn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),T1=Sn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:E1}=S1;var Zs={},C1=x,am=Il;function Il(s,i,l,d,g){this.properties={},this.extent=l,this.type=0,this._pbf=s,this._geometry=-1,this._keys=d,this._values=g,s.readFields(M1,this,i)}function M1(s,i,l){s==1?i.id=l.readVarint():s==2?function(d,g){for(var b=d.readVarint()+d.pos;d.pos<b;){var w=g._keys[d.readVarint()],T=g._values[d.readVarint()];g.properties[w]=T}}(l,i):s==3?i.type=l.readVarint():s==4&&(i._geometry=l.pos)}function I1(s){for(var i,l,d=0,g=0,b=s.length,w=b-1;g<b;w=g++)d+=((l=s[w]).x-(i=s[g]).x)*(i.y+l.y);return d}Il.types=["Unknown","Point","LineString","Polygon"],Il.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var i,l=s.readVarint()+s.pos,d=1,g=0,b=0,w=0,T=[];s.pos<l;){if(g<=0){var M=s.readVarint();d=7&M,g=M>>3}if(g--,d===1||d===2)b+=s.readSVarint(),w+=s.readSVarint(),d===1&&(i&&T.push(i),i=[]),i.push(new C1(b,w));else{if(d!==7)throw new Error("unknown command "+d);i&&i.push(i[0].clone())}}return i&&T.push(i),T},Il.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var i=s.readVarint()+s.pos,l=1,d=0,g=0,b=0,w=1/0,T=-1/0,M=1/0,A=-1/0;s.pos<i;){if(d<=0){var O=s.readVarint();l=7&O,d=O>>3}if(d--,l===1||l===2)(g+=s.readSVarint())<w&&(w=g),g>T&&(T=g),(b+=s.readSVarint())<M&&(M=b),b>A&&(A=b);else if(l!==7)throw new Error("unknown command "+l)}return[w,M,T,A]},Il.prototype.toGeoJSON=function(s,i,l){var d,g,b=this.extent*Math.pow(2,l),w=this.extent*s,T=this.extent*i,M=this.loadGeometry(),A=Il.types[this.type];function O(K){for(var Q=0;Q<K.length;Q++){var ae=K[Q];K[Q]=[360*(ae.x+w)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(ae.y+T)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var U=[];for(d=0;d<M.length;d++)U[d]=M[d][0];O(M=U);break;case 2:for(d=0;d<M.length;d++)O(M[d]);break;case 3:for(M=function(K){var Q=K.length;if(Q<=1)return[K];for(var ae,_e,xe=[],Oe=0;Oe<Q;Oe++){var Se=I1(K[Oe]);Se!==0&&(_e===void 0&&(_e=Se<0),_e===Se<0?(ae&&xe.push(ae),ae=[K[Oe]]):ae.push(K[Oe]))}return ae&&xe.push(ae),xe}(M),d=0;d<M.length;d++)for(g=0;g<M[d].length;g++)O(M[d][g])}M.length===1?M=M[0]:A="Multi"+A;var H={type:"Feature",geometry:{type:A,coordinates:M},properties:this.properties};return"id"in this&&(H.id=this.id),H};var L1=am,lm=cm;function cm(s,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(A1,this,i),this.length=this._features.length}function A1(s,i,l){s===15?i.version=l.readVarint():s===1?i.name=l.readString():s===5?i.extent=l.readVarint():s===2?i._features.push(l.pos):s===3?i._keys.push(l.readString()):s===4&&i._values.push(function(d){for(var g=null,b=d.readVarint()+d.pos;d.pos<b;){var w=d.readVarint()>>3;g=w===1?d.readString():w===2?d.readFloat():w===3?d.readDouble():w===4?d.readVarint64():w===5?d.readVarint():w===6?d.readSVarint():w===7?d.readBoolean():null}return g}(l))}cm.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var i=this._pbf.readVarint()+this._pbf.pos;return new L1(this._pbf,i,this.extent,this._keys,this._values)};var P1=lm;function z1(s,i,l){if(s===3){var d=new P1(l,l.readVarint()+l.pos);d.length&&(i[d.name]=d)}}Zs.VectorTile=function(s,i){this.layers=s.readFields(z1,{},i)},Zs.VectorTileFeature=am,Zs.VectorTileLayer=lm;const D1=Zs.VectorTileFeature.types,lf=Math.pow(2,13);function Xc(s,i,l,d,g,b,w,T){s.emplaceBack(i,l,2*Math.floor(d*lf)+w,g*lf*2,b*lf*2,Math.round(T))}class cf{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new pe,this.centroidVertexArray=new Z,this.indexArray=new Ke,this.programConfigurations=new sn(i.layers,i.zoom),this.segments=new _t,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,d){this.features=[],this.hasPattern=of("fill-extrusion",this.layers,l);for(const{feature:g,id:b,index:w,sourceLayerIndex:T}of i){const M=this.layers[0]._featureFilter.needGeometry,A=fs(g,M);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom),A,d))continue;const O={id:b,sourceLayerIndex:T,index:w,geometry:M?A.geometry:ds(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(sf("fill-extrusion",this.layers,O,this.zoom,l)):this.addFeature(O,O.geometry,w,d,{}),l.featureIndex.insert(g,O.geometry,w,T,this.index,!0)}}addFeatures(i,l,d){for(const g of this.features){const{geometry:b}=g;this.addFeature(g,b,g.index,l,d)}}update(i,l,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,d)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,E1),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,T1.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,l,d,g,b){const w={x:0,y:0,vertexCount:0};for(const T of rf(l,500)){let M=0;for(const Q of T)M+=Q.length;let A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Q of T){if(Q.length===0||B1(Q))continue;let ae=0;for(let _e=0;_e<Q.length;_e++){const xe=Q[_e];if(_e>=1){const Oe=Q[_e-1];if(!R1(xe,Oe)){A.vertexLength+4>_t.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Se=xe.sub(Oe)._perp()._unit(),Le=Oe.dist(xe);ae+Le>32768&&(ae=0),Xc(this.layoutVertexArray,xe.x,xe.y,Se.x,Se.y,0,0,ae),Xc(this.layoutVertexArray,xe.x,xe.y,Se.x,Se.y,0,1,ae),w.x+=2*xe.x,w.y+=2*xe.y,w.vertexCount+=2,ae+=Le,Xc(this.layoutVertexArray,Oe.x,Oe.y,Se.x,Se.y,0,0,ae),Xc(this.layoutVertexArray,Oe.x,Oe.y,Se.x,Se.y,0,1,ae),w.x+=2*Oe.x,w.y+=2*Oe.y,w.vertexCount+=2;const Ye=A.vertexLength;this.indexArray.emplaceBack(Ye,Ye+2,Ye+1),this.indexArray.emplaceBack(Ye+1,Ye+2,Ye+3),A.vertexLength+=4,A.primitiveLength+=2}}}}if(A.vertexLength+M>_t.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray)),D1[i.type]!=="Polygon")continue;const O=[],U=[],H=A.vertexLength;for(const Q of T)if(Q.length!==0){Q!==T[0]&&U.push(O.length/2);for(let ae=0;ae<Q.length;ae++){const _e=Q[ae];Xc(this.layoutVertexArray,_e.x,_e.y,0,0,1,1,0),w.x+=_e.x,w.y+=_e.y,w.vertexCount+=1,O.push(_e.x),O.push(_e.y)}}const K=nm(O,U);for(let Q=0;Q<K.length;Q+=3)this.indexArray.emplaceBack(H+K[Q],H+K[Q+2],H+K[Q+1]);A.primitiveLength+=K.length/3,A.vertexLength+=M}for(let T=0;T<w.vertexCount;T++)this.centroidVertexArray.emplaceBack(Math.floor(w.x/w.vertexCount),Math.floor(w.y/w.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,b,g)}}function R1(s,i){return s.x===i.x&&(s.x<0||s.x>yn)||s.y===i.y&&(s.y<0||s.y>yn)}function B1(s){return s.every(i=>i.x<0)||s.every(i=>i.x>yn)||s.every(i=>i.y<0)||s.every(i=>i.y>yn)}let um;Lt("FillExtrusionBucket",cf,{omit:["layers","features"]});var F1={get paint(){return um=um||new xr({"fill-extrusion-opacity":new Nt(we["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new $t(we["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Nt(we["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Nt(we["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new gl(we["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new $t(we["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new $t(we["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Nt(we["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class O1 extends ro{constructor(i){super(i,F1)}createBucket(i){return new cf(i)}queryRadius(){return Ph(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,l,d,g,b,w,T,M){const A=zh(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),w.angle,T),O=this.paint.get("fill-extrusion-height").evaluate(l,d),U=this.paint.get("fill-extrusion-base").evaluate(l,d),H=function(Q,ae,_e,xe){const Oe=[];for(const Se of Q){const Le=[Se.x,Se.y,0,1];Dh(Le,Le,ae),Oe.push(new k(Le[0]/Le[3],Le[1]/Le[3]))}return Oe}(A,M),K=function(Q,ae,_e,xe){const Oe=[],Se=[],Le=xe[8]*ae,Ye=xe[9]*ae,tt=xe[10]*ae,Ct=xe[11]*ae,Bt=xe[8]*_e,Tt=xe[9]*_e,wt=xe[10]*_e,mt=xe[11]*_e;for(const zt of Q){const vt=[],at=[];for(const Gt of zt){const Ot=Gt.x,mi=Gt.y,Hi=xe[0]*Ot+xe[4]*mi+xe[12],en=xe[1]*Ot+xe[5]*mi+xe[13],Un=xe[2]*Ot+xe[6]*mi+xe[14],Jr=xe[3]*Ot+xe[7]*mi+xe[15],Sr=Un+tt,zn=Jr+Ct,Yn=Hi+Bt,or=en+Tt,Tr=Un+wt,Er=Jr+mt,Vn=new k((Hi+Le)/zn,(en+Ye)/zn);Vn.z=Sr/zn,vt.push(Vn);const qn=new k(Yn/Er,or/Er);qn.z=Tr/Er,at.push(qn)}Oe.push(vt),Se.push(at)}return[Oe,Se]}(g,U,O,M);return function(Q,ae,_e){let xe=1/0;Nc(_e,ae)&&(xe=hm(_e,ae[0]));for(let Oe=0;Oe<ae.length;Oe++){const Se=ae[Oe],Le=Q[Oe];for(let Ye=0;Ye<Se.length-1;Ye++){const tt=Se[Ye],Ct=[tt,Se[Ye+1],Le[Ye+1],Le[Ye],tt];Oc(_e,Ct)&&(xe=Math.min(xe,hm(_e,Ct)))}}return xe!==1/0&&xe}(K[0],K[1],H)}}function Kc(s,i){return s.x*i.x+s.y*i.y}function hm(s,i){if(s.length===1){let l=0;const d=i[l++];let g;for(;!g||d.equals(g);)if(g=i[l++],!g)return 1/0;for(;l<i.length;l++){const b=i[l],w=s[0],T=g.sub(d),M=b.sub(d),A=w.sub(d),O=Kc(T,T),U=Kc(T,M),H=Kc(M,M),K=Kc(A,T),Q=Kc(A,M),ae=O*H-U*U,_e=(H*K-U*Q)/ae,xe=(O*Q-U*K)/ae,Oe=d.z*(1-_e-xe)+g.z*_e+b.z*xe;if(isFinite(Oe))return Oe}return 1/0}{let l=1/0;for(const d of i)l=Math.min(l,d.z);return l}}const N1=Sn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:j1}=N1,U1=Sn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:V1}=U1,q1=Zs.VectorTileFeature.types,Z1=Math.cos(Math.PI/180*37.5),dm=Math.pow(2,14)/.5;class uf{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new ye,this.layoutVertexArray2=new se,this.indexArray=new Ke,this.programConfigurations=new sn(i.layers,i.zoom),this.segments=new _t,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,d){this.hasPattern=of("line",this.layers,l);const g=this.layers[0].layout.get("line-sort-key"),b=!g.isConstant(),w=[];for(const{feature:T,id:M,index:A,sourceLayerIndex:O}of i){const U=this.layers[0]._featureFilter.needGeometry,H=fs(T,U);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom),H,d))continue;const K=b?g.evaluate(H,{},d):void 0,Q={id:M,properties:T.properties,type:T.type,sourceLayerIndex:O,index:A,geometry:U?H.geometry:ds(T),patterns:{},sortKey:K};w.push(Q)}b&&w.sort((T,M)=>T.sortKey-M.sortKey);for(const T of w){const{geometry:M,index:A,sourceLayerIndex:O}=T;if(this.hasPattern){const U=sf("line",this.layers,T,this.zoom,l);this.patternFeatures.push(U)}else this.addFeature(T,M,A,d,{});l.featureIndex.insert(i[A].feature,M,A,O,this.index)}}update(i,l,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,d)}addFeatures(i,l,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,V1)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,j1),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,l,d,g,b){const w=this.layers[0].layout,T=w.get("line-join").evaluate(i,{}),M=w.get("line-cap"),A=w.get("line-miter-limit"),O=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const U of l)this.addLine(U,i,T,M,A,O);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,b,g)}addLine(i,l,d,g,b,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let xe=0;xe<i.length-1;xe++)this.totalDistance+=i[xe].dist(i[xe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=q1[l.type]==="Polygon";let M=i.length;for(;M>=2&&i[M-1].equals(i[M-2]);)M--;let A=0;for(;A<M-1&&i[A].equals(i[A+1]);)A++;if(M<(T?3:2))return;d==="bevel"&&(b=1.05);const O=this.overscaling<=16?15*yn/(512*this.overscaling):0,U=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);let H,K,Q,ae,_e;this.e1=this.e2=-1,T&&(H=i[M-2],_e=i[A].sub(H)._unit()._perp());for(let xe=A;xe<M;xe++){if(Q=xe===M-1?T?i[A+1]:void 0:i[xe+1],Q&&i[xe].equals(Q))continue;_e&&(ae=_e),H&&(K=H),H=i[xe],_e=Q?Q.sub(H)._unit()._perp():ae,ae=ae||_e;let Oe=ae.add(_e);Oe.x===0&&Oe.y===0||Oe._unit();const Se=ae.x*_e.x+ae.y*_e.y,Le=Oe.x*_e.x+Oe.y*_e.y,Ye=Le!==0?1/Le:1/0,tt=2*Math.sqrt(2-2*Le),Ct=Le<Z1&&K&&Q,Bt=ae.x*_e.y-ae.y*_e.x>0;if(Ct&&xe>A){const mt=H.dist(K);if(mt>2*O){const zt=H.sub(H.sub(K)._mult(O/mt)._round());this.updateDistance(K,zt),this.addCurrentVertex(zt,ae,0,0,U),K=zt}}const Tt=K&&Q;let wt=Tt?d:T?"butt":g;if(Tt&&wt==="round"&&(Ye<w?wt="miter":Ye<=2&&(wt="fakeround")),wt==="miter"&&Ye>b&&(wt="bevel"),wt==="bevel"&&(Ye>2&&(wt="flipbevel"),Ye<b&&(wt="miter")),K&&this.updateDistance(K,H),wt==="miter")Oe._mult(Ye),this.addCurrentVertex(H,Oe,0,0,U);else if(wt==="flipbevel"){if(Ye>100)Oe=_e.mult(-1);else{const mt=Ye*ae.add(_e).mag()/ae.sub(_e).mag();Oe._perp()._mult(mt*(Bt?-1:1))}this.addCurrentVertex(H,Oe,0,0,U),this.addCurrentVertex(H,Oe.mult(-1),0,0,U)}else if(wt==="bevel"||wt==="fakeround"){const mt=-Math.sqrt(Ye*Ye-1),zt=Bt?mt:0,vt=Bt?0:mt;if(K&&this.addCurrentVertex(H,ae,zt,vt,U),wt==="fakeround"){const at=Math.round(180*tt/Math.PI/20);for(let Gt=1;Gt<at;Gt++){let Ot=Gt/at;if(Ot!==.5){const Hi=Ot-.5;Ot+=Ot*Hi*(Ot-1)*((1.0904+Se*(Se*(3.55645-1.43519*Se)-3.2452))*Hi*Hi+(.848013+Se*(.215638*Se-1.06021)))}const mi=_e.sub(ae)._mult(Ot)._add(ae)._unit()._mult(Bt?-1:1);this.addHalfVertex(H,mi.x,mi.y,!1,Bt,0,U)}}Q&&this.addCurrentVertex(H,_e,-zt,-vt,U)}else if(wt==="butt")this.addCurrentVertex(H,Oe,0,0,U);else if(wt==="square"){const mt=K?1:-1;this.addCurrentVertex(H,Oe,mt,mt,U)}else wt==="round"&&(K&&(this.addCurrentVertex(H,ae,0,0,U),this.addCurrentVertex(H,ae,1,1,U,!0)),Q&&(this.addCurrentVertex(H,_e,-1,-1,U,!0),this.addCurrentVertex(H,_e,0,0,U)));if(Ct&&xe<M-1){const mt=H.dist(Q);if(mt>2*O){const zt=H.add(Q.sub(H)._mult(O/mt)._round());this.updateDistance(H,zt),this.addCurrentVertex(zt,_e,0,0,U),H=zt}}}}addCurrentVertex(i,l,d,g,b,w=!1){const T=l.y*g-l.x,M=-l.y-l.x*g;this.addHalfVertex(i,l.x+l.y*d,l.y-l.x*d,w,!1,d,b),this.addHalfVertex(i,T,M,w,!0,-g,b),this.distance>dm/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(i,l,d,g,b,w))}addHalfVertex({x:i,y:l},d,g,b,w,T,M){const A=.5*(this.lineClips?this.scaledDistance*(dm-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(b?1:0),(l<<1)+(w?1:0),Math.round(63*d)+128,Math.round(63*g)+128,1+(T===0?0:T<0?-1:1)|(63&A)<<2,A>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const O=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,O),M.primitiveLength++),w?this.e2=O:this.e1=O}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,l){this.distance+=i.dist(l),this.updateScaledDistance()}}let fm,pm;Lt("LineBucket",uf,{omit:["layers","patternFeatures"]});var mm={get paint(){return pm=pm||new xr({"line-opacity":new $t(we.paint_line["line-opacity"]),"line-color":new $t(we.paint_line["line-color"]),"line-translate":new Nt(we.paint_line["line-translate"]),"line-translate-anchor":new Nt(we.paint_line["line-translate-anchor"]),"line-width":new $t(we.paint_line["line-width"]),"line-gap-width":new $t(we.paint_line["line-gap-width"]),"line-offset":new $t(we.paint_line["line-offset"]),"line-blur":new $t(we.paint_line["line-blur"]),"line-dasharray":new ka(we.paint_line["line-dasharray"]),"line-pattern":new gl(we.paint_line["line-pattern"]),"line-gradient":new Mc(we.paint_line["line-gradient"])})},get layout(){return fm=fm||new xr({"line-cap":new Nt(we.layout_line["line-cap"]),"line-join":new $t(we.layout_line["line-join"]),"line-miter-limit":new Nt(we.layout_line["line-miter-limit"]),"line-round-limit":new Nt(we.layout_line["line-round-limit"]),"line-sort-key":new $t(we.layout_line["line-sort-key"])})}};class G1 extends $t{possiblyEvaluate(i,l){return l=new Yi(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,zoomHistory:l.zoomHistory,transition:l.transition}),super.possiblyEvaluate(i,l)}evaluate(i,l,d,g){return l=$({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(i,l,d,g)}}let Nh;class W1 extends ro{constructor(i){super(i,mm),this.gradientVersion=0,Nh||(Nh=new G1(mm.paint.properties["line-width"].specification),Nh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const l=this.gradientExpression();this.stepInterpolant=!!function(d){return d._styleExpression!==void 0}(l)&&l._styleExpression.expression instanceof ma,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,l){super.recalculate(i,l),this.paint._values["line-floorwidth"]=Nh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new uf(i)}queryRadius(i){const l=i,d=gm(Vc("line-width",this,l),Vc("line-gap-width",this,l)),g=Vc("line-offset",this,l);return d/2+Math.abs(g)+Ph(this.paint.get("line-translate"))}queryIntersectsFeature(i,l,d,g,b,w,T){const M=zh(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),w.angle,T),A=T/2*gm(this.paint.get("line-width").evaluate(l,d),this.paint.get("line-gap-width").evaluate(l,d)),O=this.paint.get("line-offset").evaluate(l,d);return O&&(g=function(U,H){const K=[];for(let Q=0;Q<U.length;Q++){const ae=U[Q],_e=[];for(let xe=0;xe<ae.length;xe++){const Oe=ae[xe-1],Se=ae[xe],Le=ae[xe+1],Ye=xe===0?new k(0,0):Se.sub(Oe)._unit()._perp(),tt=xe===ae.length-1?new k(0,0):Le.sub(Se)._unit()._perp(),Ct=Ye._add(tt)._unit(),Bt=Ct.x*tt.x+Ct.y*tt.y;Bt!==0&&Ct._mult(1/Bt),_e.push(Ct._mult(H)._add(Se))}K.push(_e)}return K}(g,O*T)),function(U,H,K){for(let Q=0;Q<H.length;Q++){const ae=H[Q];if(U.length>=3){for(let _e=0;_e<ae.length;_e++)if(El(U,ae[_e]))return!0}if(jc(U,ae,K))return!0}return!1}(M,g,A)}isTileClipped(){return!0}}function gm(s,i){return i>0?i+2*s:s}const H1=Sn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),$1=Sn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Sn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const X1=Sn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Sn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const _m=Sn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),K1=Sn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function J1(s,i,l){return s.sections.forEach(d=>{d.text=function(g,b,w){const T=b.layout.get("text-transform").evaluate(w,{});return T==="uppercase"?g=g.toLocaleUpperCase():T==="lowercase"&&(g=g.toLocaleLowerCase()),Ho.applyArabicShaping&&(g=Ho.applyArabicShaping(g)),g}(d.text,i,l)}),s}Sn([{name:"triangle",components:3,type:"Uint16"}]),Sn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Sn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Sn([{type:"Float32",name:"offsetX"}]),Sn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Sn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Jc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var jn=24,ym=ji,vm=function(s,i,l,d,g){var b,w,T=8*g-d-1,M=(1<<T)-1,A=M>>1,O=-7,U=l?g-1:0,H=l?-1:1,K=s[i+U];for(U+=H,b=K&(1<<-O)-1,K>>=-O,O+=T;O>0;b=256*b+s[i+U],U+=H,O-=8);for(w=b&(1<<-O)-1,b>>=-O,O+=d;O>0;w=256*w+s[i+U],U+=H,O-=8);if(b===0)b=1-A;else{if(b===M)return w?NaN:1/0*(K?-1:1);w+=Math.pow(2,d),b-=A}return(K?-1:1)*w*Math.pow(2,b-d)},bm=function(s,i,l,d,g,b){var w,T,M,A=8*b-g-1,O=(1<<A)-1,U=O>>1,H=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,K=d?0:b-1,Q=d?1:-1,ae=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(T=isNaN(i)?1:0,w=O):(w=Math.floor(Math.log(i)/Math.LN2),i*(M=Math.pow(2,-w))<1&&(w--,M*=2),(i+=w+U>=1?H/M:H*Math.pow(2,1-U))*M>=2&&(w++,M/=2),w+U>=O?(T=0,w=O):w+U>=1?(T=(i*M-1)*Math.pow(2,g),w+=U):(T=i*Math.pow(2,U-1)*Math.pow(2,g),w=0));g>=8;s[l+K]=255&T,K+=Q,T/=256,g-=8);for(w=w<<g|T,A+=g;A>0;s[l+K]=255&w,K+=Q,w/=256,A-=8);s[l+K-Q]|=128*ae};function ji(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}ji.Varint=0,ji.Fixed64=1,ji.Bytes=2,ji.Fixed32=5;var hf=4294967296,wm=1/hf,xm=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ps(s){return s.type===ji.Bytes?s.readVarint()+s.pos:s.pos+1}function Ll(s,i,l){return l?4294967296*i+(s>>>0):4294967296*(i>>>0)+(s>>>0)}function km(s,i,l){var d=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));l.realloc(d);for(var g=l.pos-1;g>=s;g--)l.buf[g+d]=l.buf[g]}function Y1(s,i){for(var l=0;l<s.length;l++)i.writeVarint(s[l])}function Q1(s,i){for(var l=0;l<s.length;l++)i.writeSVarint(s[l])}function ev(s,i){for(var l=0;l<s.length;l++)i.writeFloat(s[l])}function tv(s,i){for(var l=0;l<s.length;l++)i.writeDouble(s[l])}function iv(s,i){for(var l=0;l<s.length;l++)i.writeBoolean(s[l])}function nv(s,i){for(var l=0;l<s.length;l++)i.writeFixed32(s[l])}function rv(s,i){for(var l=0;l<s.length;l++)i.writeSFixed32(s[l])}function ov(s,i){for(var l=0;l<s.length;l++)i.writeFixed64(s[l])}function sv(s,i){for(var l=0;l<s.length;l++)i.writeSFixed64(s[l])}function jh(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+16777216*s[i+3]}function Al(s,i,l){s[l]=i,s[l+1]=i>>>8,s[l+2]=i>>>16,s[l+3]=i>>>24}function Sm(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+(s[i+3]<<24)}ji.prototype={destroy:function(){this.buf=null},readFields:function(s,i,l){for(l=l||this.length;this.pos<l;){var d=this.readVarint(),g=d>>3,b=this.pos;this.type=7&d,s(g,i,this),this.pos===b&&this.skip(d)}return i},readMessage:function(s,i){return this.readFields(s,i,this.readVarint()+this.pos)},readFixed32:function(){var s=jh(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=Sm(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=jh(this.buf,this.pos)+jh(this.buf,this.pos+4)*hf;return this.pos+=8,s},readSFixed64:function(){var s=jh(this.buf,this.pos)+Sm(this.buf,this.pos+4)*hf;return this.pos+=8,s},readFloat:function(){var s=vm(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=vm(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var i,l,d=this.buf;return i=127&(l=d[this.pos++]),l<128?i:(i|=(127&(l=d[this.pos++]))<<7,l<128?i:(i|=(127&(l=d[this.pos++]))<<14,l<128?i:(i|=(127&(l=d[this.pos++]))<<21,l<128?i:function(g,b,w){var T,M,A=w.buf;if(T=(112&(M=A[w.pos++]))>>4,M<128||(T|=(127&(M=A[w.pos++]))<<3,M<128)||(T|=(127&(M=A[w.pos++]))<<10,M<128)||(T|=(127&(M=A[w.pos++]))<<17,M<128)||(T|=(127&(M=A[w.pos++]))<<24,M<128)||(T|=(1&(M=A[w.pos++]))<<31,M<128))return Ll(g,T,b);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(l=d[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,i=this.pos;return this.pos=s,s-i>=12&&xm?function(l,d,g){return xm.decode(l.subarray(d,g))}(this.buf,i,s):function(l,d,g){for(var b="",w=d;w<g;){var T,M,A,O=l[w],U=null,H=O>239?4:O>223?3:O>191?2:1;if(w+H>g)break;H===1?O<128&&(U=O):H===2?(192&(T=l[w+1]))==128&&(U=(31&O)<<6|63&T)<=127&&(U=null):H===3?(M=l[w+2],(192&(T=l[w+1]))==128&&(192&M)==128&&((U=(15&O)<<12|(63&T)<<6|63&M)<=2047||U>=55296&&U<=57343)&&(U=null)):H===4&&(M=l[w+2],A=l[w+3],(192&(T=l[w+1]))==128&&(192&M)==128&&(192&A)==128&&((U=(15&O)<<18|(63&T)<<12|(63&M)<<6|63&A)<=65535||U>=1114112)&&(U=null)),U===null?(U=65533,H=1):U>65535&&(U-=65536,b+=String.fromCharCode(U>>>10&1023|55296),U=56320|1023&U),b+=String.fromCharCode(U),w+=H}return b}(this.buf,i,s)},readBytes:function(){var s=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,s);return this.pos=s,i},readPackedVarint:function(s,i){if(this.type!==ji.Bytes)return s.push(this.readVarint(i));var l=ps(this);for(s=s||[];this.pos<l;)s.push(this.readVarint(i));return s},readPackedSVarint:function(s){if(this.type!==ji.Bytes)return s.push(this.readSVarint());var i=ps(this);for(s=s||[];this.pos<i;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==ji.Bytes)return s.push(this.readBoolean());var i=ps(this);for(s=s||[];this.pos<i;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==ji.Bytes)return s.push(this.readFloat());var i=ps(this);for(s=s||[];this.pos<i;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==ji.Bytes)return s.push(this.readDouble());var i=ps(this);for(s=s||[];this.pos<i;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==ji.Bytes)return s.push(this.readFixed32());var i=ps(this);for(s=s||[];this.pos<i;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==ji.Bytes)return s.push(this.readSFixed32());var i=ps(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==ji.Bytes)return s.push(this.readFixed64());var i=ps(this);for(s=s||[];this.pos<i;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==ji.Bytes)return s.push(this.readSFixed64());var i=ps(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed64());return s},skip:function(s){var i=7&s;if(i===ji.Varint)for(;this.buf[this.pos++]>127;);else if(i===ji.Bytes)this.pos=this.readVarint()+this.pos;else if(i===ji.Fixed32)this.pos+=4;else{if(i!==ji.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(s,i){this.writeVarint(s<<3|i)},realloc:function(s){for(var i=this.length||16;i<this.pos+s;)i*=2;if(i!==this.length){var l=new Uint8Array(i);l.set(this.buf),this.buf=l,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),Al(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),Al(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),Al(this.buf,-1&s,this.pos),Al(this.buf,Math.floor(s*wm),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),Al(this.buf,-1&s,this.pos),Al(this.buf,Math.floor(s*wm),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(i,l){var d,g;if(i>=0?(d=i%4294967296|0,g=i/4294967296|0):(g=~(-i/4294967296),4294967295^(d=~(-i%4294967296))?d=d+1|0:(d=0,g=g+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(b,w,T){T.buf[T.pos++]=127&b|128,b>>>=7,T.buf[T.pos++]=127&b|128,b>>>=7,T.buf[T.pos++]=127&b|128,b>>>=7,T.buf[T.pos++]=127&b|128,T.buf[T.pos]=127&(b>>>=7)}(d,0,l),function(b,w){var T=(7&b)<<4;w.buf[w.pos++]|=T|((b>>>=3)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b)))))}(g,l)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var i=this.pos;this.pos=function(d,g,b){for(var w,T,M=0;M<g.length;M++){if((w=g.charCodeAt(M))>55295&&w<57344){if(!T){w>56319||M+1===g.length?(d[b++]=239,d[b++]=191,d[b++]=189):T=w;continue}if(w<56320){d[b++]=239,d[b++]=191,d[b++]=189,T=w;continue}w=T-55296<<10|w-56320|65536,T=null}else T&&(d[b++]=239,d[b++]=191,d[b++]=189,T=null);w<128?d[b++]=w:(w<2048?d[b++]=w>>6|192:(w<65536?d[b++]=w>>12|224:(d[b++]=w>>18|240,d[b++]=w>>12&63|128),d[b++]=w>>6&63|128),d[b++]=63&w|128)}return b}(this.buf,s,this.pos);var l=this.pos-i;l>=128&&km(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l},writeFloat:function(s){this.realloc(4),bm(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),bm(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var i=s.length;this.writeVarint(i),this.realloc(i);for(var l=0;l<i;l++)this.buf[this.pos++]=s[l]},writeRawMessage:function(s,i){this.pos++;var l=this.pos;s(i,this);var d=this.pos-l;d>=128&&km(l,d,this),this.pos=l-1,this.writeVarint(d),this.pos+=d},writeMessage:function(s,i,l){this.writeTag(s,ji.Bytes),this.writeRawMessage(i,l)},writePackedVarint:function(s,i){i.length&&this.writeMessage(s,Y1,i)},writePackedSVarint:function(s,i){i.length&&this.writeMessage(s,Q1,i)},writePackedBoolean:function(s,i){i.length&&this.writeMessage(s,iv,i)},writePackedFloat:function(s,i){i.length&&this.writeMessage(s,ev,i)},writePackedDouble:function(s,i){i.length&&this.writeMessage(s,tv,i)},writePackedFixed32:function(s,i){i.length&&this.writeMessage(s,nv,i)},writePackedSFixed32:function(s,i){i.length&&this.writeMessage(s,rv,i)},writePackedFixed64:function(s,i){i.length&&this.writeMessage(s,ov,i)},writePackedSFixed64:function(s,i){i.length&&this.writeMessage(s,sv,i)},writeBytesField:function(s,i){this.writeTag(s,ji.Bytes),this.writeBytes(i)},writeFixed32Field:function(s,i){this.writeTag(s,ji.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(s,i){this.writeTag(s,ji.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(s,i){this.writeTag(s,ji.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(s,i){this.writeTag(s,ji.Fixed64),this.writeSFixed64(i)},writeVarintField:function(s,i){this.writeTag(s,ji.Varint),this.writeVarint(i)},writeSVarintField:function(s,i){this.writeTag(s,ji.Varint),this.writeSVarint(i)},writeStringField:function(s,i){this.writeTag(s,ji.Bytes),this.writeString(i)},writeFloatField:function(s,i){this.writeTag(s,ji.Fixed32),this.writeFloat(i)},writeDoubleField:function(s,i){this.writeTag(s,ji.Fixed64),this.writeDouble(i)},writeBooleanField:function(s,i){this.writeVarintField(s,!!i)}};var df=_(ym);const ff=3;function av(s,i,l){s===1&&l.readMessage(lv,i)}function lv(s,i,l){if(s===3){const{id:d,bitmap:g,width:b,height:w,left:T,top:M,advance:A}=l.readMessage(cv,{});i.push({id:d,bitmap:new Zc({width:b+2*ff,height:w+2*ff},g),metrics:{width:b,height:w,left:T,top:M,advance:A}})}}function cv(s,i,l){s===1?i.id=l.readVarint():s===2?i.bitmap=l.readBytes():s===3?i.width=l.readVarint():s===4?i.height=l.readVarint():s===5?i.left=l.readSVarint():s===6?i.top=l.readSVarint():s===7&&(i.advance=l.readVarint())}const Tm=ff;function Em(s){let i=0,l=0;for(const w of s)i+=w.w*w.h,l=Math.max(l,w.w);s.sort((w,T)=>T.h-w.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),l),h:1/0}];let g=0,b=0;for(const w of s)for(let T=d.length-1;T>=0;T--){const M=d[T];if(!(w.w>M.w||w.h>M.h)){if(w.x=M.x,w.y=M.y,b=Math.max(b,w.y+w.h),g=Math.max(g,w.x+w.w),w.w===M.w&&w.h===M.h){const A=d.pop();T<d.length&&(d[T]=A)}else w.h===M.h?(M.x+=w.w,M.w-=w.w):w.w===M.w?(M.y+=w.h,M.h-=w.h):(d.push({x:M.x+w.w,y:M.y,w:M.w-w.w,h:w.h}),M.y+=w.h,M.h-=w.h);break}}return{w:g,h:b,fill:i/(g*b)||0}}const Fr=1;class pf{constructor(i,{pixelRatio:l,version:d,stretchX:g,stretchY:b,content:w}){this.paddedRect=i,this.pixelRatio=l,this.stretchX=g,this.stretchY=b,this.content=w,this.version=d}get tl(){return[this.paddedRect.x+Fr,this.paddedRect.y+Fr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Fr,this.paddedRect.y+this.paddedRect.h-Fr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Fr)/this.pixelRatio,(this.paddedRect.h-2*Fr)/this.pixelRatio]}}class Cm{constructor(i,l){const d={},g={};this.haveRenderCallbacks=[];const b=[];this.addImages(i,d,b),this.addImages(l,g,b);const{w,h:T}=Em(b),M=new oo({width:w||1,height:T||1});for(const A in i){const O=i[A],U=d[A].paddedRect;oo.copy(O.data,M,{x:0,y:0},{x:U.x+Fr,y:U.y+Fr},O.data)}for(const A in l){const O=l[A],U=g[A].paddedRect,H=U.x+Fr,K=U.y+Fr,Q=O.data.width,ae=O.data.height;oo.copy(O.data,M,{x:0,y:0},{x:H,y:K},O.data),oo.copy(O.data,M,{x:0,y:ae-1},{x:H,y:K-1},{width:Q,height:1}),oo.copy(O.data,M,{x:0,y:0},{x:H,y:K+ae},{width:Q,height:1}),oo.copy(O.data,M,{x:Q-1,y:0},{x:H-1,y:K},{width:1,height:ae}),oo.copy(O.data,M,{x:0,y:0},{x:H+Q,y:K},{width:1,height:ae})}this.image=M,this.iconPositions=d,this.patternPositions=g}addImages(i,l,d){for(const g in i){const b=i[g],w={x:0,y:0,w:b.data.width+2*Fr,h:b.data.height+2*Fr};d.push(w),l[g]=new pf(w,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(i,l){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const d in i.updatedImages)this.patchUpdatedImage(this.iconPositions[d],i.getImage(d),l),this.patchUpdatedImage(this.patternPositions[d],i.getImage(d),l)}patchUpdatedImage(i,l,d){if(!i||!l||i.version===l.version)return;i.version=l.version;const[g,b]=i.tl;d.update(l.data,void 0,{x:g,y:b})}}var Gs;Lt("ImagePosition",pf),Lt("ImageAtlas",Cm),f.ah=void 0,(Gs=f.ah||(f.ah={}))[Gs.none=0]="none",Gs[Gs.horizontal=1]="horizontal",Gs[Gs.vertical=2]="vertical",Gs[Gs.horizontalOnly=3]="horizontalOnly";const Yc=-17;class Qc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,l){const d=new Qc;return d.scale=i||1,d.fontStack=l,d}static forImage(i){const l=new Qc;return l.imageName=i,l}}class Pl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,l){const d=new Pl;for(let g=0;g<i.sections.length;g++){const b=i.sections[g];b.image?d.addImageSection(b):d.addTextSection(b,l)}return d}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let l="";for(let d=0;d<i.length;d++){const g=i.charCodeAt(d+1)||null,b=i.charCodeAt(d-1)||null;l+=g&&Ec(g)&&!Jc[i[d+1]]||b&&Ec(b)&&!Jc[i[d-1]]||!Jc[i[d]]?i[d]:Jc[i[d]]}return l}(this.text)}trim(){let i=0;for(let d=0;d<this.text.length&&Vh[this.text.charCodeAt(d)];d++)i++;let l=this.text.length;for(let d=this.text.length-1;d>=0&&d>=i&&Vh[this.text.charCodeAt(d)];d--)l--;this.text=this.text.substring(i,l),this.sectionIndex=this.sectionIndex.slice(i,l)}substring(i,l){const d=new Pl;return d.text=this.text.substring(i,l),d.sectionIndex=this.sectionIndex.slice(i,l),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,l)=>Math.max(i,this.sections[l].scale),0)}addTextSection(i,l){this.text+=i.text,this.sections.push(Qc.forText(i.scale,i.fontStack||l));const d=this.sections.length-1;for(let g=0;g<i.text.length;++g)this.sectionIndex.push(d)}addImageSection(i){const l=i.image?i.image.name:"";if(l.length===0)return void qe("Can't add FormattedSection with an empty image.");const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCharCode(d),this.sections.push(Qc.forImage(l)),this.sectionIndex.push(this.sections.length-1)):qe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Uh(s,i,l,d,g,b,w,T,M,A,O,U,H,K,Q,ae){const _e=Pl.fromFeature(s,g);let xe;U===f.ah.vertical&&_e.verticalizePunctuation();const{processBidirectionalText:Oe,processStyledBidirectionalText:Se}=Ho;if(Oe&&_e.sections.length===1){xe=[];const tt=Oe(_e.toString(),mf(_e,A,b,i,d,K,Q));for(const Ct of tt){const Bt=new Pl;Bt.text=Ct,Bt.sections=_e.sections;for(let Tt=0;Tt<Ct.length;Tt++)Bt.sectionIndex.push(0);xe.push(Bt)}}else if(Se){xe=[];const tt=Se(_e.text,_e.sectionIndex,mf(_e,A,b,i,d,K,Q));for(const Ct of tt){const Bt=new Pl;Bt.text=Ct[0],Bt.sectionIndex=Ct[1],Bt.sections=_e.sections,xe.push(Bt)}}else xe=function(tt,Ct){const Bt=[],Tt=tt.text;let wt=0;for(const mt of Ct)Bt.push(tt.substring(wt,mt)),wt=mt;return wt<Tt.length&&Bt.push(tt.substring(wt,Tt.length)),Bt}(_e,mf(_e,A,b,i,d,K,Q));const Le=[],Ye={positionedLines:Le,text:_e.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:U,iconsInText:!1,verticalizable:!1};return function(tt,Ct,Bt,Tt,wt,mt,zt,vt,at,Gt,Ot,mi){let Hi=0,en=Yc,Un=0,Jr=0;const Sr=vt==="right"?1:vt==="left"?0:.5;let zn=0;for(const Vn of wt){Vn.trim();const qn=Vn.getMaxScale(),fr=(qn-1)*jn,Cr={positionedGlyphs:[],lineOffset:0};tt.positionedLines[zn]=Cr;const pr=Cr.positionedGlyphs;let Or=0;if(!Vn.length()){en+=mt,++zn;continue}for(let Zn=0;Zn<Vn.length();Zn++){const bi=Vn.getSection(Zn),mr=Vn.getSectionIndex(Zn),sr=Vn.getCharCode(Zn);let Gn=0,wo=null,zo=null,Do=null,ms=jn;const xo=!(at===f.ah.horizontal||!Ot&&!fl(sr)||Ot&&(Vh[sr]||(Yn=sr,St.Arabic(Yn)||St["Arabic Supplement"](Yn)||St["Arabic Extended-A"](Yn)||St["Arabic Presentation Forms-A"](Yn)||St["Arabic Presentation Forms-B"](Yn))));if(bi.imageName){const ao=Tt[bi.imageName];if(!ao)continue;Do=bi.imageName,tt.iconsInText=tt.iconsInText||!0,zo=ao.paddedRect;const jr=ao.displaySize;bi.scale=bi.scale*jn/mi,wo={width:jr[0],height:jr[1],left:Fr,top:-Tm,advance:xo?jr[1]:jr[0]},Gn=fr+(jn-jr[1]*bi.scale),ms=wo.advance;const gs=xo?jr[0]*bi.scale-jn*qn:jr[1]*bi.scale-jn*qn;gs>0&&gs>Or&&(Or=gs)}else{const ao=Bt[bi.fontStack],jr=ao&&ao[sr];if(jr&&jr.rect)zo=jr.rect,wo=jr.metrics;else{const gs=Ct[bi.fontStack],ru=gs&&gs[sr];if(!ru)continue;wo=ru.metrics}Gn=(qn-bi.scale)*jn}xo?(tt.verticalizable=!0,pr.push({glyph:sr,imageName:Do,x:Hi,y:en+Gn,vertical:xo,scale:bi.scale,fontStack:bi.fontStack,sectionIndex:mr,metrics:wo,rect:zo}),Hi+=ms*bi.scale+Gt):(pr.push({glyph:sr,imageName:Do,x:Hi,y:en+Gn,vertical:xo,scale:bi.scale,fontStack:bi.fontStack,sectionIndex:mr,metrics:wo,rect:zo}),Hi+=wo.advance*bi.scale+Gt)}pr.length!==0&&(Un=Math.max(Hi-Gt,Un),dv(pr,0,pr.length-1,Sr,Or)),Hi=0;const Nr=mt*qn+Or;Cr.lineOffset=Math.max(Or,fr),en+=Nr,Jr=Math.max(Nr,Jr),++zn}var Yn;const or=en-Yc,{horizontalAlign:Tr,verticalAlign:Er}=gf(zt);(function(Vn,qn,fr,Cr,pr,Or,Nr,Zn,bi){const mr=(qn-fr)*pr;let sr=0;sr=Or!==Nr?-Zn*Cr-Yc:(-Cr*bi+.5)*Nr;for(const Gn of Vn)for(const wo of Gn.positionedGlyphs)wo.x+=mr,wo.y+=sr})(tt.positionedLines,Sr,Tr,Er,Un,Jr,mt,or,wt.length),tt.top+=-Er*or,tt.bottom=tt.top+or,tt.left+=-Tr*Un,tt.right=tt.left+Un}(Ye,i,l,d,xe,w,T,M,U,A,H,ae),!function(tt){for(const Ct of tt)if(Ct.positionedGlyphs.length!==0)return!1;return!0}(Le)&&Ye}const Vh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},uv={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Mm(s,i,l,d,g,b){if(i.imageName){const w=d[i.imageName];return w?w.displaySize[0]*i.scale*jn/b+g:0}{const w=l[i.fontStack],T=w&&w[s];return T?T.metrics.advance*i.scale+g:0}}function Im(s,i,l,d){const g=Math.pow(s-i,2);return d?s<i?g/2:2*g:g+Math.abs(l)*l}function hv(s,i,l){let d=0;return s===10&&(d-=1e4),l&&(d+=150),s!==40&&s!==65288||(d+=50),i!==41&&i!==65289||(d+=50),d}function Lm(s,i,l,d,g,b){let w=null,T=Im(i,l,g,b);for(const M of d){const A=Im(i-M.x,l,g,b)+M.badness;A<=T&&(w=M,T=A)}return{index:s,x:i,priorBreak:w,badness:T}}function Am(s){return s?Am(s.priorBreak).concat(s.index):[]}function mf(s,i,l,d,g,b,w){if(b!=="point")return[];if(!s)return[];const T=[],M=function(H,K,Q,ae,_e,xe){let Oe=0;for(let Se=0;Se<H.length();Se++){const Le=H.getSection(Se);Oe+=Mm(H.getCharCode(Se),Le,ae,_e,K,xe)}return Oe/Math.max(1,Math.ceil(Oe/Q))}(s,i,l,d,g,w),A=s.text.indexOf("")>=0;let O=0;for(let H=0;H<s.length();H++){const K=s.getSection(H),Q=s.getCharCode(H);if(Vh[Q]||(O+=Mm(Q,K,d,g,i,w)),H<s.length()-1){const ae=!((U=Q)<11904||!(St["Bopomofo Extended"](U)||St.Bopomofo(U)||St["CJK Compatibility Forms"](U)||St["CJK Compatibility Ideographs"](U)||St["CJK Compatibility"](U)||St["CJK Radicals Supplement"](U)||St["CJK Strokes"](U)||St["CJK Symbols and Punctuation"](U)||St["CJK Unified Ideographs Extension A"](U)||St["CJK Unified Ideographs"](U)||St["Enclosed CJK Letters and Months"](U)||St["Halfwidth and Fullwidth Forms"](U)||St.Hiragana(U)||St["Ideographic Description Characters"](U)||St["Kangxi Radicals"](U)||St["Katakana Phonetic Extensions"](U)||St.Katakana(U)||St["Vertical Forms"](U)||St["Yi Radicals"](U)||St["Yi Syllables"](U)));(uv[Q]||ae||K.imageName)&&T.push(Lm(H+1,O,M,T,hv(Q,s.getCharCode(H+1),ae&&A),!1))}}var U;return Am(Lm(s.length(),O,M,T,0,!0))}function gf(s){let i=.5,l=.5;switch(s){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:i,verticalAlign:l}}function dv(s,i,l,d,g){if(!d&&!g)return;const b=s[l],w=(s[l].x+b.metrics.advance*b.scale)*d;for(let T=i;T<=l;T++)s[T].x-=w,s[T].y+=g}function fv(s,i,l){const{horizontalAlign:d,verticalAlign:g}=gf(l),b=i[0]-s.displaySize[0]*d,w=i[1]-s.displaySize[1]*g;return{image:s,top:w,bottom:w+s.displaySize[1],left:b,right:b+s.displaySize[0]}}function Pm(s,i,l,d,g,b){const w=s.image;let T;if(w.content){const _e=w.content,xe=w.pixelRatio||1;T=[_e[0]/xe,_e[1]/xe,w.displaySize[0]-_e[2]/xe,w.displaySize[1]-_e[3]/xe]}const M=i.left*b,A=i.right*b;let O,U,H,K;l==="width"||l==="both"?(K=g[0]+M-d[3],U=g[0]+A+d[1]):(K=g[0]+(M+A-w.displaySize[0])/2,U=K+w.displaySize[0]);const Q=i.top*b,ae=i.bottom*b;return l==="height"||l==="both"?(O=g[1]+Q-d[0],H=g[1]+ae+d[2]):(O=g[1]+(Q+ae-w.displaySize[1])/2,H=O+w.displaySize[1]),{image:w,top:O,right:U,bottom:H,left:K,collisionPadding:T}}const eu=255,Jo=128,Ws=eu*Jo;function zm(s,i){const{expression:l}=i;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new Yi(s+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:g}=l;let b=0;for(;b<d.length&&d[b]<=s;)b++;b=Math.max(0,b-1);let w=b;for(;w<d.length&&d[w]<s+1;)w++;w=Math.min(d.length-1,w);const T=d[b],M=d[w];return l.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:M,interpolationType:g}:{kind:"camera",minZoom:T,maxZoom:M,minSize:l.evaluate(new Yi(T)),maxSize:l.evaluate(new Yi(M)),interpolationType:g}}}function _f(s,i,l){let d="never";const g=s.get(i);return g?d=g:s.get(l)&&(d="always"),d}const pv=Zs.VectorTileFeature.types,mv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function qh(s,i,l,d,g,b,w,T,M,A,O,U,H){const K=T?Math.min(Ws,Math.round(T[0])):0,Q=T?Math.min(Ws,Math.round(T[1])):0;s.emplaceBack(i,l,Math.round(32*d),Math.round(32*g),b,w,(K<<1)+(M?1:0),Q,16*A,16*O,256*U,256*H)}function yf(s,i,l){s.emplaceBack(i.x,i.y,l),s.emplaceBack(i.x,i.y,l),s.emplaceBack(i.x,i.y,l),s.emplaceBack(i.x,i.y,l)}function gv(s){for(const i of s.sections)if($d(i.text))return!0;return!1}class vf{constructor(i){this.layoutVertexArray=new Ge,this.indexArray=new Ke,this.programConfigurations=i,this.segments=new _t,this.dynamicLayoutVertexArray=new be,this.opacityVertexArray=new Ae,this.hasVisibleVertices=!1,this.placedSymbolArray=new h}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,l,d,g){this.isEmpty()||(d&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,H1.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,$1.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,mv,!0),this.opacityVertexBuffer.itemSize=1),(d||g)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Lt("SymbolBuffers",vf);class bf{constructor(i,l,d){this.layoutVertexArray=new i,this.layoutAttributes=l,this.indexArray=new d,this.segments=new _t,this.collisionVertexArray=new Xe}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,X1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Lt("CollisionBuffers",bf);class zl{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(w=>w.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Kd([]),this.placementViewportMatrix=Kd([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=zm(this.zoom,l["text-size"]),this.iconSizeData=zm(this.zoom,l["icon-size"]);const d=this.layers[0].layout,g=d.get("symbol-sort-key"),b=d.get("symbol-z-order");this.canOverlap=_f(d,"text-overlap","text-allow-overlap")!=="never"||_f(d,"icon-overlap","icon-allow-overlap")!=="never"||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=b!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(b==="viewport-y"||b==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,d.get("symbol-placement")==="point"&&(this.writingModes=d.get("text-writing-mode").map(w=>f.ah[w])),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.sourceID=i.sourceID}createArrays(){this.text=new vf(new sn(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new vf(new sn(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new v,this.lineVertexArray=new E,this.symbolInstances=new m,this.textAnchorOffsets=new L}calculateGlyphDependencies(i,l,d,g,b){for(let w=0;w<i.length;w++)if(l[i.charCodeAt(w)]=!0,(d||g)&&b){const T=Jc[i.charAt(w)];T&&(l[T.charCodeAt(0)]=!0)}}populate(i,l,d){const g=this.layers[0],b=g.layout,w=b.get("text-font"),T=b.get("text-field"),M=b.get("icon-image"),A=(T.value.kind!=="constant"||T.value.value instanceof Pr&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),O=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,U=b.get("symbol-sort-key");if(this.features=[],!A&&!O)return;const H=l.iconDependencies,K=l.glyphDependencies,Q=l.availableImages,ae=new Yi(this.zoom);for(const{feature:_e,id:xe,index:Oe,sourceLayerIndex:Se}of i){const Le=g._featureFilter.needGeometry,Ye=fs(_e,Le);if(!g._featureFilter.filter(ae,Ye,d))continue;let tt,Ct;if(Le||(Ye.geometry=ds(_e)),A){const Tt=g.getValueAndResolveTokens("text-field",Ye,d,Q),wt=Pr.factory(Tt),mt=this.hasRTLText=this.hasRTLText||gv(wt);(!mt||Ho.getRTLTextPluginStatus()==="unavailable"||mt&&Ho.isParsed())&&(tt=J1(wt,g,Ye))}if(O){const Tt=g.getValueAndResolveTokens("icon-image",Ye,d,Q);Ct=Tt instanceof $r?Tt:$r.fromString(Tt)}if(!tt&&!Ct)continue;const Bt=this.sortFeaturesByKey?U.evaluate(Ye,{},d):void 0;if(this.features.push({id:xe,text:tt,icon:Ct,index:Oe,sourceLayerIndex:Se,geometry:Ye.geometry,properties:_e.properties,type:pv[_e.type],sortKey:Bt}),Ct&&(H[Ct.name]=!0),tt){const Tt=w.evaluate(Ye,{},d).join(","),wt=b.get("text-rotation-alignment")!=="viewport"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(f.ah.vertical)>=0;for(const mt of tt.sections)if(mt.image)H[mt.image.name]=!0;else{const zt=Vs(tt.toString()),vt=mt.fontStack||Tt,at=K[vt]=K[vt]||{};this.calculateGlyphDependencies(mt.text,at,wt,this.allowVerticalPlacement,zt)}}}b.get("symbol-placement")==="line"&&(this.features=function(_e){const xe={},Oe={},Se=[];let Le=0;function Ye(Tt){Se.push(_e[Tt]),Le++}function tt(Tt,wt,mt){const zt=Oe[Tt];return delete Oe[Tt],Oe[wt]=zt,Se[zt].geometry[0].pop(),Se[zt].geometry[0]=Se[zt].geometry[0].concat(mt[0]),zt}function Ct(Tt,wt,mt){const zt=xe[wt];return delete xe[wt],xe[Tt]=zt,Se[zt].geometry[0].shift(),Se[zt].geometry[0]=mt[0].concat(Se[zt].geometry[0]),zt}function Bt(Tt,wt,mt){const zt=mt?wt[0][wt[0].length-1]:wt[0][0];return`${Tt}:${zt.x}:${zt.y}`}for(let Tt=0;Tt<_e.length;Tt++){const wt=_e[Tt],mt=wt.geometry,zt=wt.text?wt.text.toString():null;if(!zt){Ye(Tt);continue}const vt=Bt(zt,mt),at=Bt(zt,mt,!0);if(vt in Oe&&at in xe&&Oe[vt]!==xe[at]){const Gt=Ct(vt,at,mt),Ot=tt(vt,at,Se[Gt].geometry);delete xe[vt],delete Oe[at],Oe[Bt(zt,Se[Ot].geometry,!0)]=Ot,Se[Gt].geometry=null}else vt in Oe?tt(vt,at,mt):at in xe?Ct(vt,at,mt):(Ye(Tt),xe[vt]=Le-1,Oe[at]=Le-1)}return Se.filter(Tt=>Tt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((_e,xe)=>_e.sortKey-xe.sortKey)}update(i,l,d){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,l,this.layers,d),this.icon.programConfigurations.updatePaintArrays(i,l,this.layers,d))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,l){const d=this.lineVertexArray.length;if(i.segment!==void 0){let g=i.dist(l[i.segment+1]),b=i.dist(l[i.segment]);const w={};for(let T=i.segment+1;T<l.length;T++)w[T]={x:l[T].x,y:l[T].y,tileUnitDistanceFromAnchor:g},T<l.length-1&&(g+=l[T+1].dist(l[T]));for(let T=i.segment||0;T>=0;T--)w[T]={x:l[T].x,y:l[T].y,tileUnitDistanceFromAnchor:b},T>0&&(b+=l[T-1].dist(l[T]));for(let T=0;T<l.length;T++){const M=w[T];this.lineVertexArray.emplaceBack(M.x,M.y,M.tileUnitDistanceFromAnchor)}}return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(i,l,d,g,b,w,T,M,A,O,U,H){const K=i.indexArray,Q=i.layoutVertexArray,ae=i.segments.prepareSegment(4*l.length,Q,K,this.canOverlap?w.sortKey:void 0),_e=this.glyphOffsetArray.length,xe=ae.vertexLength,Oe=this.allowVerticalPlacement&&T===f.ah.vertical?Math.PI/2:0,Se=w.text&&w.text.sections;for(let Le=0;Le<l.length;Le++){const{tl:Ye,tr:tt,bl:Ct,br:Bt,tex:Tt,pixelOffsetTL:wt,pixelOffsetBR:mt,minFontScaleX:zt,minFontScaleY:vt,glyphOffset:at,isSDF:Gt,sectionIndex:Ot}=l[Le],mi=ae.vertexLength,Hi=at[1];qh(Q,M.x,M.y,Ye.x,Hi+Ye.y,Tt.x,Tt.y,d,Gt,wt.x,wt.y,zt,vt),qh(Q,M.x,M.y,tt.x,Hi+tt.y,Tt.x+Tt.w,Tt.y,d,Gt,mt.x,wt.y,zt,vt),qh(Q,M.x,M.y,Ct.x,Hi+Ct.y,Tt.x,Tt.y+Tt.h,d,Gt,wt.x,mt.y,zt,vt),qh(Q,M.x,M.y,Bt.x,Hi+Bt.y,Tt.x+Tt.w,Tt.y+Tt.h,d,Gt,mt.x,mt.y,zt,vt),yf(i.dynamicLayoutVertexArray,M,Oe),K.emplaceBack(mi,mi+1,mi+2),K.emplaceBack(mi+1,mi+2,mi+3),ae.vertexLength+=4,ae.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(at[0]),Le!==l.length-1&&Ot===l[Le+1].sectionIndex||i.programConfigurations.populatePaintArrays(Q.length,w,w.index,{},H,Se&&Se[Ot])}i.placedSymbolArray.emplaceBack(M.x,M.y,_e,this.glyphOffsetArray.length-_e,xe,A,O,M.segment,d?d[0]:0,d?d[1]:0,g[0],g[1],T,0,!1,0,U)}_addCollisionDebugVertex(i,l,d,g,b,w){return l.emplaceBack(0,0),i.emplaceBack(d.x,d.y,g,b,Math.round(w.x),Math.round(w.y))}addCollisionDebugVertices(i,l,d,g,b,w,T){const M=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),A=M.vertexLength,O=b.layoutVertexArray,U=b.collisionVertexArray,H=T.anchorX,K=T.anchorY;this._addCollisionDebugVertex(O,U,w,H,K,new k(i,l)),this._addCollisionDebugVertex(O,U,w,H,K,new k(d,l)),this._addCollisionDebugVertex(O,U,w,H,K,new k(d,g)),this._addCollisionDebugVertex(O,U,w,H,K,new k(i,g)),M.vertexLength+=4;const Q=b.indexArray;Q.emplaceBack(A,A+1),Q.emplaceBack(A+1,A+2),Q.emplaceBack(A+2,A+3),Q.emplaceBack(A+3,A),M.primitiveLength+=4}addDebugCollisionBoxes(i,l,d,g){for(let b=i;b<l;b++){const w=this.collisionBoxArray.get(b);this.addCollisionDebugVertices(w.x1,w.y1,w.x2,w.y2,g?this.textCollisionBox:this.iconCollisionBox,w.anchorPoint,d)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new bf(He,_m.members,nt),this.iconCollisionBox=new bf(He,_m.members,nt);for(let i=0;i<this.symbolInstances.length;i++){const l=this.symbolInstances.get(i);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(i,l,d,g,b,w,T,M,A){const O={};for(let U=l;U<d;U++){const H=i.get(U);O.textBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},O.textFeatureIndex=H.featureIndex;break}for(let U=g;U<b;U++){const H=i.get(U);O.verticalTextBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},O.verticalTextFeatureIndex=H.featureIndex;break}for(let U=w;U<T;U++){const H=i.get(U);O.iconBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},O.iconFeatureIndex=H.featureIndex;break}for(let U=M;U<A;U++){const H=i.get(U);O.verticalIconBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},O.verticalIconFeatureIndex=H.featureIndex;break}return O}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const d=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,l){const d=i.placedSymbolArray.get(l),g=d.vertexStartIndex+4*d.numGlyphs;for(let b=d.vertexStartIndex;b<g;b+=4)i.indexArray.emplaceBack(b,b+1,b+2),i.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(i),d=Math.cos(i),g=[],b=[],w=[];for(let T=0;T<this.symbolInstances.length;++T){w.push(T);const M=this.symbolInstances.get(T);g.push(0|Math.round(l*M.anchorX+d*M.anchorY)),b.push(M.featureIndex)}return w.sort((T,M)=>g[T]-g[M]||b[M]-b[T]),w}addToSortKeyRanges(i,l){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===l?d.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const d=this.symbolInstances.get(l);this.featureSortOrder.push(d.featureIndex),[d.rightJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.leftJustifiedTextSymbolIndex].forEach((g,b,w)=>{g>=0&&w.indexOf(g)===b&&this.addIndicesForPlacedSymbol(this.text,g)}),d.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,d.verticalPlacedTextSymbolIndex),d.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.placedIconSymbolIndex),d.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Dm,Rm;Lt("SymbolBucket",zl,{omit:["layers","collisionBoxArray","features","compareText"]}),zl.MAX_GLYPHS=65535,zl.addDynamicAttributes=yf;var wf={get paint(){return Rm=Rm||new xr({"icon-opacity":new $t(we.paint_symbol["icon-opacity"]),"icon-color":new $t(we.paint_symbol["icon-color"]),"icon-halo-color":new $t(we.paint_symbol["icon-halo-color"]),"icon-halo-width":new $t(we.paint_symbol["icon-halo-width"]),"icon-halo-blur":new $t(we.paint_symbol["icon-halo-blur"]),"icon-translate":new Nt(we.paint_symbol["icon-translate"]),"icon-translate-anchor":new Nt(we.paint_symbol["icon-translate-anchor"]),"text-opacity":new $t(we.paint_symbol["text-opacity"]),"text-color":new $t(we.paint_symbol["text-color"],{runtimeType:qi,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new $t(we.paint_symbol["text-halo-color"]),"text-halo-width":new $t(we.paint_symbol["text-halo-width"]),"text-halo-blur":new $t(we.paint_symbol["text-halo-blur"]),"text-translate":new Nt(we.paint_symbol["text-translate"]),"text-translate-anchor":new Nt(we.paint_symbol["text-translate-anchor"])})},get layout(){return Dm=Dm||new xr({"symbol-placement":new Nt(we.layout_symbol["symbol-placement"]),"symbol-spacing":new Nt(we.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Nt(we.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new $t(we.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Nt(we.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Nt(we.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Nt(we.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Nt(we.layout_symbol["icon-ignore-placement"]),"icon-optional":new Nt(we.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Nt(we.layout_symbol["icon-rotation-alignment"]),"icon-size":new $t(we.layout_symbol["icon-size"]),"icon-text-fit":new Nt(we.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Nt(we.layout_symbol["icon-text-fit-padding"]),"icon-image":new $t(we.layout_symbol["icon-image"]),"icon-rotate":new $t(we.layout_symbol["icon-rotate"]),"icon-padding":new $t(we.layout_symbol["icon-padding"]),"icon-keep-upright":new Nt(we.layout_symbol["icon-keep-upright"]),"icon-offset":new $t(we.layout_symbol["icon-offset"]),"icon-anchor":new $t(we.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Nt(we.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Nt(we.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Nt(we.layout_symbol["text-rotation-alignment"]),"text-field":new $t(we.layout_symbol["text-field"]),"text-font":new $t(we.layout_symbol["text-font"]),"text-size":new $t(we.layout_symbol["text-size"]),"text-max-width":new $t(we.layout_symbol["text-max-width"]),"text-line-height":new Nt(we.layout_symbol["text-line-height"]),"text-letter-spacing":new $t(we.layout_symbol["text-letter-spacing"]),"text-justify":new $t(we.layout_symbol["text-justify"]),"text-radial-offset":new $t(we.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Nt(we.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new $t(we.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new $t(we.layout_symbol["text-anchor"]),"text-max-angle":new Nt(we.layout_symbol["text-max-angle"]),"text-writing-mode":new Nt(we.layout_symbol["text-writing-mode"]),"text-rotate":new $t(we.layout_symbol["text-rotate"]),"text-padding":new Nt(we.layout_symbol["text-padding"]),"text-keep-upright":new Nt(we.layout_symbol["text-keep-upright"]),"text-transform":new $t(we.layout_symbol["text-transform"]),"text-offset":new $t(we.layout_symbol["text-offset"]),"text-allow-overlap":new Nt(we.layout_symbol["text-allow-overlap"]),"text-overlap":new Nt(we.layout_symbol["text-overlap"]),"text-ignore-placement":new Nt(we.layout_symbol["text-ignore-placement"]),"text-optional":new Nt(we.layout_symbol["text-optional"])})}};class Bm{constructor(i){if(i.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:Vi,this.defaultValue=i}evaluate(i){if(i.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(i.formattedSection))return l.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Lt("FormatSectionOverride",Bm,{omit:["defaultValue"]});class Zh extends ro{constructor(i){super(i,wf)}recalculate(i,l){if(super.recalculate(i,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const d=this.layout.get("text-writing-mode");if(d){const g=[];for(const b of d)g.indexOf(b)<0&&g.push(b);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,l,d,g){const b=this.layout.get(i).evaluate(l,{},d,g),w=this._unevaluatedLayout._values[i];return w.isDataDriven()||Zi(w.value)||!b?b:function(T,M){return M.replace(/{([^{}]+)}/g,(A,O)=>T&&O in T?String(T[O]):"")}(l.properties,b)}createBucket(i){return new zl(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of wf.paint.overridableProperties){if(!Zh.hasPaintOverride(this.layout,i))continue;const l=this.paint.get(i),d=new Bm(l),g=new Wi(d,l.property.specification);let b=null;b=l.value.kind==="constant"||l.value.kind==="source"?new il("source",g):new _c("composite",g,l.value.zoomStops),this.paint._values[i]=new no(l.property,b,l.parameters)}}_handleOverridablePaintPropertyUpdate(i,l,d){return!(!this.layout||l.isDataDriven()||d.isDataDriven())&&Zh.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,l){const d=i.get("text-field"),g=wf.paint.properties[l];let b=!1;const w=T=>{for(const M of T)if(g.overrides&&g.overrides.hasOverride(M))return void(b=!0)};if(d.value.kind==="constant"&&d.value.value instanceof Pr)w(d.value.value.sections);else if(d.value.kind==="source"){const T=A=>{b||(A instanceof Vo&&In(A.value)===cn?w(A.value.sections):A instanceof el?w(A.sections):A.eachChild(T))},M=d.value;M._styleExpression&&T(M._styleExpression.expression)}return b}}let Fm;var _v={get paint(){return Fm=Fm||new xr({"background-color":new Nt(we.paint_background["background-color"]),"background-pattern":new ka(we.paint_background["background-pattern"]),"background-opacity":new Nt(we.paint_background["background-opacity"])})}};class yv extends ro{constructor(i){super(i,_v)}}let Om;var vv={get paint(){return Om=Om||new xr({"raster-opacity":new Nt(we.paint_raster["raster-opacity"]),"raster-hue-rotate":new Nt(we.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Nt(we.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Nt(we.paint_raster["raster-brightness-max"]),"raster-saturation":new Nt(we.paint_raster["raster-saturation"]),"raster-contrast":new Nt(we.paint_raster["raster-contrast"]),"raster-resampling":new Nt(we.paint_raster["raster-resampling"]),"raster-fade-duration":new Nt(we.paint_raster["raster-fade-duration"])})}};class bv extends ro{constructor(i){super(i,vv)}}class wv extends ro{constructor(i){super(i,{}),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class xv{constructor(i){this._methodToThrottle=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const xf=63710088e-1;class Hs{constructor(i,l){if(isNaN(i)||isNaN(l))throw new Error(`Invalid LngLat object: (${i}, ${l})`);if(this.lng=+i,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Hs(oe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const l=Math.PI/180,d=this.lat*l,g=i.lat*l,b=Math.sin(d)*Math.sin(g)+Math.cos(d)*Math.cos(g)*Math.cos((i.lng-this.lng)*l);return xf*Math.acos(Math.min(b,1))}static convert(i){if(i instanceof Hs)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new Hs(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new Hs(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Nm=2*Math.PI*xf;function jm(s){return Nm*Math.cos(s*Math.PI/180)}function Um(s){return(180+s)/360}function Vm(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function qm(s,i){return s/jm(i)}function kf(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}class Gh{constructor(i,l,d=0){this.x=+i,this.y=+l,this.z=+d}static fromLngLat(i,l=0){const d=Hs.convert(i);return new Gh(Um(d.lng),Vm(d.lat),qm(l,d.lat))}toLngLat(){return new Hs(360*this.x-180,kf(this.y))}toAltitude(){return this.z*jm(kf(this.y))}meterInMercatorCoordinateUnits(){return 1/Nm*(i=kf(this.y),1/Math.cos(i*Math.PI/180));var i}}function Zm(s,i,l){var d=2*Math.PI*6378137/256/Math.pow(2,l);return[s*d-2*Math.PI*6378137/2,i*d-2*Math.PI*6378137/2]}class Sf{constructor(i,l,d){if(i<0||i>25||d<0||d>=Math.pow(2,i)||l<0||l>=Math.pow(2,i))throw new Error(`x=${l}, y=${d}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=l,this.y=d,this.key=tu(0,i,i,l,d)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,l,d){const g=(w=this.y,T=this.z,M=Zm(256*(b=this.x),256*(w=Math.pow(2,T)-w-1),T),A=Zm(256*(b+1),256*(w+1),T),M[0]+","+M[1]+","+A[0]+","+A[1]);var b,w,T,M,A;const O=function(U,H,K){let Q,ae="";for(let _e=U;_e>0;_e--)Q=1<<_e-1,ae+=(H&Q?1:0)+(K&Q?2:0);return ae}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(d==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,O).replace(/{bbox-epsg-3857}/g,g)}isChildOf(i){const l=this.z-i.z;return l>0&&i.x===this.x>>l&&i.y===this.y>>l}getTilePoint(i){const l=Math.pow(2,this.z);return new k((i.x*l-this.x)*yn,(i.y*l-this.y)*yn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Gm{constructor(i,l){this.wrap=i,this.canonical=l,this.key=tu(i,l.z,l.z,l.x,l.y)}}class so{constructor(i,l,d,g,b){if(i<d)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${d}`);this.overscaledZ=i,this.wrap=l,this.canonical=new Sf(d,+g,+b),this.key=tu(l,i,d,g,b)}clone(){return new so(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-i;return i>this.canonical.z?new so(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new so(i,this.wrap,i,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(i,l){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const d=this.canonical.z-i;return i>this.canonical.z?tu(this.wrap*+l,i,this.canonical.z,this.canonical.x,this.canonical.y):tu(this.wrap*+l,i,i,this.canonical.x>>d,this.canonical.y>>d)}isChildOf(i){if(i.wrap!==this.wrap)return!1;const l=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>l&&i.canonical.y===this.canonical.y>>l}children(i){if(this.overscaledZ>=i)return[new so(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,d=2*this.canonical.x,g=2*this.canonical.y;return[new so(l,this.wrap,l,d,g),new so(l,this.wrap,l,d+1,g),new so(l,this.wrap,l,d,g+1),new so(l,this.wrap,l,d+1,g+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new so(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new so(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Gm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new Gh(i.x-this.wrap,i.y))}}function tu(s,i,l,d,g){(s*=2)<0&&(s=-1*s-1);const b=1<<l;return(b*b*s+b*g+d).toString(36)+l.toString(36)+i.toString(36)}Lt("CanonicalTileID",Sf),Lt("OverscaledTileID",so,{omit:["posMatrix"]});class Wm{constructor(i,l,d,g=1,b=1,w=1,T=0){if(this.uid=i,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(d&&!["mapbox","terrarium","custom"].includes(d))return void qe(`"${d}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=l.height;const M=this.dim=l.height-2;switch(this.data=new Uint32Array(l.data.buffer),d){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=b,this.blueFactor=w,this.baseShift=T;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let A=0;A<M;A++)this.data[this._idx(-1,A)]=this.data[this._idx(0,A)],this.data[this._idx(M,A)]=this.data[this._idx(M-1,A)],this.data[this._idx(A,-1)]=this.data[this._idx(A,0)],this.data[this._idx(A,M)]=this.data[this._idx(A,M-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(M,-1)]=this.data[this._idx(M-1,0)],this.data[this._idx(-1,M)]=this.data[this._idx(0,M-1)],this.data[this._idx(M,M)]=this.data[this._idx(M-1,M-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let A=0;A<M;A++)for(let O=0;O<M;O++){const U=this.get(A,O);U>this.max&&(this.max=U),U<this.min&&(this.min=U)}}get(i,l){const d=new Uint8Array(this.data.buffer),g=4*this._idx(i,l);return this.unpack(d[g],d[g+1],d[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(i,l){if(i<-1||i>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(i+1)}unpack(i,l,d){return i*this.redFactor+l*this.greenFactor+d*this.blueFactor-this.baseShift}getPixels(){return new oo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,l,d){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let g=l*this.dim,b=l*this.dim+this.dim,w=d*this.dim,T=d*this.dim+this.dim;switch(l){case-1:g=b-1;break;case 1:b=g+1}switch(d){case-1:w=T-1;break;case 1:T=w+1}const M=-l*this.dim,A=-d*this.dim;for(let O=w;O<T;O++)for(let U=g;U<b;U++)this.data[this._idx(U,O)]=i.data[this._idx(U+M,O+A)]}}Lt("DEMData",Wm);class Hm{constructor(i){this._stringToNumber={},this._numberToString=[];for(let l=0;l<i.length;l++){const d=i[l];this._stringToNumber[d]=l,this._numberToString[l]=d}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class $m{constructor(i,l,d,g,b){this.type="Feature",this._vectorTileFeature=i,i._z=l,i._x=d,i._y=g,this.properties=i.properties,this.id=b}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const l in this)l!=="_geometry"&&l!=="_vectorTileFeature"&&(i[l]=this[l]);return i}}class Xm{constructor(i,l){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new ba(yn,16,0),this.grid3D=new ba(yn,16,0),this.featureIndexArray=new q,this.promoteId=l}insert(i,l,d,g,b,w){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,g,b);const M=w?this.grid3D:this.grid;for(let A=0;A<l.length;A++){const O=l[A],U=[1/0,1/0,-1/0,-1/0];for(let H=0;H<O.length;H++){const K=O[H];U[0]=Math.min(U[0],K.x),U[1]=Math.min(U[1],K.y),U[2]=Math.max(U[2],K.x),U[3]=Math.max(U[3],K.y)}U[0]<yn&&U[1]<yn&&U[2]>=0&&U[3]>=0&&M.insert(T,U[0],U[1],U[2],U[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Zs.VectorTile(new df(this.rawTileData)).layers,this.sourceLayerCoder=new Hm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,l,d,g){this.loadVTLayers();const b=i.params||{},w=yn/i.tileSize/i.scale,T=sl(b.filter),M=i.queryGeometry,A=i.queryPadding*w,O=Jm(M),U=this.grid.query(O.minX-A,O.minY-A,O.maxX+A,O.maxY+A),H=Jm(i.cameraQueryGeometry),K=this.grid3D.query(H.minX-A,H.minY-A,H.maxX+A,H.maxY+A,(_e,xe,Oe,Se)=>function(Le,Ye,tt,Ct,Bt){for(const wt of Le)if(Ye<=wt.x&&tt<=wt.y&&Ct>=wt.x&&Bt>=wt.y)return!0;const Tt=[new k(Ye,tt),new k(Ye,Bt),new k(Ct,Bt),new k(Ct,tt)];if(Le.length>2){for(const wt of Tt)if(El(Le,wt))return!0}for(let wt=0;wt<Le.length-1;wt++)if(e1(Le[wt],Le[wt+1],Tt))return!0;return!1}(i.cameraQueryGeometry,_e-A,xe-A,Oe+A,Se+A));for(const _e of K)U.push(_e);U.sort(kv);const Q={};let ae;for(let _e=0;_e<U.length;_e++){const xe=U[_e];if(xe===ae)continue;ae=xe;const Oe=this.featureIndexArray.get(xe);let Se=null;this.loadMatchingFeature(Q,Oe.bucketIndex,Oe.sourceLayerIndex,Oe.featureIndex,T,b.layers,b.availableImages,l,d,g,(Le,Ye,tt)=>(Se||(Se=ds(Le)),Ye.queryIntersectsFeature(M,Le,tt,Se,this.z,i.transform,w,i.pixelPosMatrix)))}return Q}loadMatchingFeature(i,l,d,g,b,w,T,M,A,O,U){const H=this.bucketLayerIDs[l];if(w&&!function(_e,xe){for(let Oe=0;Oe<_e.length;Oe++)if(xe.indexOf(_e[Oe])>=0)return!0;return!1}(w,H))return;const K=this.sourceLayerCoder.decode(d),Q=this.vtLayers[K].feature(g);if(b.needGeometry){const _e=fs(Q,!0);if(!b.filter(new Yi(this.tileID.overscaledZ),_e,this.tileID.canonical))return}else if(!b.filter(new Yi(this.tileID.overscaledZ),Q))return;const ae=this.getId(Q,K);for(let _e=0;_e<H.length;_e++){const xe=H[_e];if(w&&w.indexOf(xe)<0)continue;const Oe=M[xe];if(!Oe)continue;let Se={};ae&&O&&(Se=O.getState(Oe.sourceLayer||"_geojsonTileLayer",ae));const Le=$({},A[xe]);Le.paint=Km(Le.paint,Oe.paint,Q,Se,T),Le.layout=Km(Le.layout,Oe.layout,Q,Se,T);const Ye=!U||U(Q,Oe,Se);if(!Ye)continue;const tt=new $m(Q,this.z,this.x,this.y,ae);tt.layer=Le;let Ct=i[xe];Ct===void 0&&(Ct=i[xe]=[]),Ct.push({featureIndex:g,feature:tt,intersectionZ:Ye})}}lookupSymbolFeatures(i,l,d,g,b,w,T,M){const A={};this.loadVTLayers();const O=sl(b);for(const U of i)this.loadMatchingFeature(A,d,g,U,O,w,T,M,l);return A}hasLayer(i){for(const l of this.bucketLayerIDs)for(const d of l)if(i===d)return!0;return!1}getId(i,l){let d=i.id;return this.promoteId&&(d=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[l]],typeof d=="boolean"&&(d=Number(d))),d}}function Km(s,i,l,d,g){return ve(s,(b,w)=>{const T=i instanceof xa?i.get(w):null;return T&&T.evaluate?T.evaluate(l,d,g):T})}function Jm(s){let i=1/0,l=1/0,d=-1/0,g=-1/0;for(const b of s)i=Math.min(i,b.x),l=Math.min(l,b.y),d=Math.max(d,b.x),g=Math.max(g,b.y);return{minX:i,minY:l,maxX:d,maxY:g}}function kv(s,i){return i-s}function Ym(s,i,l,d,g){const b=[];for(let w=0;w<s.length;w++){const T=s[w];let M;for(let A=0;A<T.length-1;A++){let O=T[A],U=T[A+1];O.x<i&&U.x<i||(O.x<i?O=new k(i,O.y+(i-O.x)/(U.x-O.x)*(U.y-O.y))._round():U.x<i&&(U=new k(i,O.y+(i-O.x)/(U.x-O.x)*(U.y-O.y))._round()),O.y<l&&U.y<l||(O.y<l?O=new k(O.x+(l-O.y)/(U.y-O.y)*(U.x-O.x),l)._round():U.y<l&&(U=new k(O.x+(l-O.y)/(U.y-O.y)*(U.x-O.x),l)._round()),O.x>=d&&U.x>=d||(O.x>=d?O=new k(d,O.y+(d-O.x)/(U.x-O.x)*(U.y-O.y))._round():U.x>=d&&(U=new k(d,O.y+(d-O.x)/(U.x-O.x)*(U.y-O.y))._round()),O.y>=g&&U.y>=g||(O.y>=g?O=new k(O.x+(g-O.y)/(U.y-O.y)*(U.x-O.x),g)._round():U.y>=g&&(U=new k(O.x+(g-O.y)/(U.y-O.y)*(U.x-O.x),g)._round()),M&&O.equals(M[M.length-1])||(M=[O],b.push(M)),M.push(U)))))}}return b}Lt("FeatureIndex",Xm,{omit:["rawTileData","sourceLayerCoder"]});class $s extends k{constructor(i,l,d,g){super(i,l),this.angle=d,g!==void 0&&(this.segment=g)}clone(){return new $s(this.x,this.y,this.angle,this.segment)}}function Qm(s,i,l,d,g){if(i.segment===void 0||l===0)return!0;let b=i,w=i.segment+1,T=0;for(;T>-l/2;){if(w--,w<0)return!1;T-=s[w].dist(b),b=s[w]}T+=s[w].dist(s[w+1]),w++;const M=[];let A=0;for(;T<l/2;){const O=s[w],U=s[w+1];if(!U)return!1;let H=s[w-1].angleTo(O)-O.angleTo(U);for(H=Math.abs((H+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:T,angleDelta:H}),A+=H;T-M[0].distance>d;)A-=M.shift().angleDelta;if(A>g)return!1;w++,T+=O.dist(U)}return!0}function eg(s){let i=0;for(let l=0;l<s.length-1;l++)i+=s[l].dist(s[l+1]);return i}function tg(s,i,l){return s?.6*i*l:0}function ig(s,i){return Math.max(s?s.right-s.left:0,i?i.right-i.left:0)}function Sv(s,i,l,d,g,b){const w=tg(l,g,b),T=ig(l,d)*b;let M=0;const A=eg(s)/2;for(let O=0;O<s.length-1;O++){const U=s[O],H=s[O+1],K=U.dist(H);if(M+K>A){const Q=(A-M)/K,ae=hr.number(U.x,H.x,Q),_e=hr.number(U.y,H.y,Q),xe=new $s(ae,_e,H.angleTo(U),O);return xe._round(),!w||Qm(s,xe,T,w,i)?xe:void 0}M+=K}}function Tv(s,i,l,d,g,b,w,T,M){const A=tg(d,b,w),O=ig(d,g),U=O*w,H=s[0].x===0||s[0].x===M||s[0].y===0||s[0].y===M;return i-U<i/4&&(i=U+i/4),ng(s,H?i/2*T%i:(O/2+2*b)*w*T%i,i,A,l,U,H,!1,M)}function ng(s,i,l,d,g,b,w,T,M){const A=b/2,O=eg(s);let U=0,H=i-l,K=[];for(let Q=0;Q<s.length-1;Q++){const ae=s[Q],_e=s[Q+1],xe=ae.dist(_e),Oe=_e.angleTo(ae);for(;H+l<U+xe;){H+=l;const Se=(H-U)/xe,Le=hr.number(ae.x,_e.x,Se),Ye=hr.number(ae.y,_e.y,Se);if(Le>=0&&Le<M&&Ye>=0&&Ye<M&&H-A>=0&&H+A<=O){const tt=new $s(Le,Ye,Oe,Q);tt._round(),d&&!Qm(s,tt,b,d,g)||K.push(tt)}}U+=xe}return T||K.length||w||(K=ng(s,U/2,l,d,g,b,w,!0,M)),K}Lt("Anchor",$s);const Dl=Fr;function rg(s,i,l,d){const g=[],b=s.image,w=b.pixelRatio,T=b.paddedRect.w-2*Dl,M=b.paddedRect.h-2*Dl,A=s.right-s.left,O=s.bottom-s.top,U=b.stretchX||[[0,T]],H=b.stretchY||[[0,M]],K=(mt,zt)=>mt+zt[1]-zt[0],Q=U.reduce(K,0),ae=H.reduce(K,0),_e=T-Q,xe=M-ae;let Oe=0,Se=Q,Le=0,Ye=ae,tt=0,Ct=_e,Bt=0,Tt=xe;if(b.content&&d){const mt=b.content;Oe=Wh(U,0,mt[0]),Le=Wh(H,0,mt[1]),Se=Wh(U,mt[0],mt[2]),Ye=Wh(H,mt[1],mt[3]),tt=mt[0]-Oe,Bt=mt[1]-Le,Ct=mt[2]-mt[0]-Se,Tt=mt[3]-mt[1]-Ye}const wt=(mt,zt,vt,at)=>{const Gt=Hh(mt.stretch-Oe,Se,A,s.left),Ot=$h(mt.fixed-tt,Ct,mt.stretch,Q),mi=Hh(zt.stretch-Le,Ye,O,s.top),Hi=$h(zt.fixed-Bt,Tt,zt.stretch,ae),en=Hh(vt.stretch-Oe,Se,A,s.left),Un=$h(vt.fixed-tt,Ct,vt.stretch,Q),Jr=Hh(at.stretch-Le,Ye,O,s.top),Sr=$h(at.fixed-Bt,Tt,at.stretch,ae),zn=new k(Gt,mi),Yn=new k(en,mi),or=new k(en,Jr),Tr=new k(Gt,Jr),Er=new k(Ot/w,Hi/w),Vn=new k(Un/w,Sr/w),qn=i*Math.PI/180;if(qn){const pr=Math.sin(qn),Or=Math.cos(qn),Nr=[Or,-pr,pr,Or];zn._matMult(Nr),Yn._matMult(Nr),Tr._matMult(Nr),or._matMult(Nr)}const fr=mt.stretch+mt.fixed,Cr=zt.stretch+zt.fixed;return{tl:zn,tr:Yn,bl:Tr,br:or,tex:{x:b.paddedRect.x+Dl+fr,y:b.paddedRect.y+Dl+Cr,w:vt.stretch+vt.fixed-fr,h:at.stretch+at.fixed-Cr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Er,pixelOffsetBR:Vn,minFontScaleX:Ct/w/A,minFontScaleY:Tt/w/O,isSDF:l}};if(d&&(b.stretchX||b.stretchY)){const mt=og(U,_e,Q),zt=og(H,xe,ae);for(let vt=0;vt<mt.length-1;vt++){const at=mt[vt],Gt=mt[vt+1];for(let Ot=0;Ot<zt.length-1;Ot++)g.push(wt(at,zt[Ot],Gt,zt[Ot+1]))}}else g.push(wt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:M+1}));return g}function Wh(s,i,l){let d=0;for(const g of s)d+=Math.max(i,Math.min(l,g[1]))-Math.max(i,Math.min(l,g[0]));return d}function og(s,i,l){const d=[{fixed:-Dl,stretch:0}];for(const[g,b]of s){const w=d[d.length-1];d.push({fixed:g-w.stretch,stretch:w.stretch}),d.push({fixed:g-w.stretch,stretch:w.stretch+(b-g)})}return d.push({fixed:i+Dl,stretch:l}),d}function Hh(s,i,l,d){return s/i*l+d}function $h(s,i,l,d){return s-i*l/d}class Xh{constructor(i,l,d,g,b,w,T,M,A,O){if(this.boxStartIndex=i.length,A){let U=w.top,H=w.bottom;const K=w.collisionPadding;K&&(U-=K[1],H+=K[3]);let Q=H-U;Q>0&&(Q=Math.max(10,Q),this.circleDiameter=Q)}else{let U=w.top*T-M[0],H=w.bottom*T+M[2],K=w.left*T-M[3],Q=w.right*T+M[1];const ae=w.collisionPadding;if(ae&&(K-=ae[0]*T,U-=ae[1]*T,Q+=ae[2]*T,H+=ae[3]*T),O){const _e=new k(K,U),xe=new k(Q,U),Oe=new k(K,H),Se=new k(Q,H),Le=O*Math.PI/180;_e._rotate(Le),xe._rotate(Le),Oe._rotate(Le),Se._rotate(Le),K=Math.min(_e.x,xe.x,Oe.x,Se.x),Q=Math.max(_e.x,xe.x,Oe.x,Se.x),U=Math.min(_e.y,xe.y,Oe.y,Se.y),H=Math.max(_e.y,xe.y,Oe.y,Se.y)}i.emplaceBack(l.x,l.y,K,U,Q,H,d,g,b)}this.boxEndIndex=i.length}}class Ev{constructor(i=[],l=Cv){if(this.data=i,this.length=this.data.length,this.compare=l,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const i=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:l,compare:d}=this,g=l[i];for(;i>0;){const b=i-1>>1,w=l[b];if(d(g,w)>=0)break;l[i]=w,i=b}l[i]=g}_down(i){const{data:l,compare:d}=this,g=this.length>>1,b=l[i];for(;i<g;){let w=1+(i<<1),T=l[w];const M=w+1;if(M<this.length&&d(l[M],T)<0&&(w=M,T=l[M]),d(T,b)>=0)break;l[i]=T,i=w}l[i]=b}}function Cv(s,i){return s<i?-1:s>i?1:0}function Mv(s,i=1,l=!1){let d=1/0,g=1/0,b=-1/0,w=-1/0;const T=s[0];for(let K=0;K<T.length;K++){const Q=T[K];(!K||Q.x<d)&&(d=Q.x),(!K||Q.y<g)&&(g=Q.y),(!K||Q.x>b)&&(b=Q.x),(!K||Q.y>w)&&(w=Q.y)}const M=Math.min(b-d,w-g);let A=M/2;const O=new Ev([],Iv);if(M===0)return new k(d,g);for(let K=d;K<b;K+=M)for(let Q=g;Q<w;Q+=M)O.push(new Rl(K+A,Q+A,A,s));let U=function(K){let Q=0,ae=0,_e=0;const xe=K[0];for(let Oe=0,Se=xe.length,Le=Se-1;Oe<Se;Le=Oe++){const Ye=xe[Oe],tt=xe[Le],Ct=Ye.x*tt.y-tt.x*Ye.y;ae+=(Ye.x+tt.x)*Ct,_e+=(Ye.y+tt.y)*Ct,Q+=3*Ct}return new Rl(ae/Q,_e/Q,0,K)}(s),H=O.length;for(;O.length;){const K=O.pop();(K.d>U.d||!U.d)&&(U=K,l&&console.log("found best %d after %d probes",Math.round(1e4*K.d)/1e4,H)),K.max-U.d<=i||(A=K.h/2,O.push(new Rl(K.p.x-A,K.p.y-A,A,s)),O.push(new Rl(K.p.x+A,K.p.y-A,A,s)),O.push(new Rl(K.p.x-A,K.p.y+A,A,s)),O.push(new Rl(K.p.x+A,K.p.y+A,A,s)),H+=4)}return l&&(console.log(`num probes: ${H}`),console.log(`best distance: ${U.d}`)),U.p}function Iv(s,i){return i.max-s.max}function Rl(s,i,l,d){this.p=new k(s,i),this.h=l,this.d=function(g,b){let w=!1,T=1/0;for(let M=0;M<b.length;M++){const A=b[M];for(let O=0,U=A.length,H=U-1;O<U;H=O++){const K=A[O],Q=A[H];K.y>g.y!=Q.y>g.y&&g.x<(Q.x-K.x)*(g.y-K.y)/(Q.y-K.y)+K.x&&(w=!w),T=Math.min(T,Vp(g,K,Q))}}return(w?1:-1)*Math.sqrt(T)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}var rr;f.ap=void 0,(rr=f.ap||(f.ap={}))[rr.center=1]="center",rr[rr.left=2]="left",rr[rr.right=3]="right",rr[rr.top=4]="top",rr[rr.bottom=5]="bottom",rr[rr["top-left"]=6]="top-left",rr[rr["top-right"]=7]="top-right",rr[rr["bottom-left"]=8]="bottom-left",rr[rr["bottom-right"]=9]="bottom-right";const Xs=7,Tf=Number.POSITIVE_INFINITY;function sg(s,i){return i[1]!==Tf?function(l,d,g){let b=0,w=0;switch(d=Math.abs(d),g=Math.abs(g),l){case"top-right":case"top-left":case"top":w=g-Xs;break;case"bottom-right":case"bottom-left":case"bottom":w=-g+Xs}switch(l){case"top-right":case"bottom-right":case"right":b=-d;break;case"top-left":case"bottom-left":case"left":b=d}return[b,w]}(s,i[0],i[1]):function(l,d){let g=0,b=0;d<0&&(d=0);const w=d/Math.SQRT2;switch(l){case"top-right":case"top-left":b=w-Xs;break;case"bottom-right":case"bottom-left":b=-w+Xs;break;case"bottom":b=-d+Xs;break;case"top":b=d-Xs}switch(l){case"top-right":case"bottom-right":g=-w;break;case"top-left":case"bottom-left":g=w;break;case"left":g=d;break;case"right":g=-d}return[g,b]}(s,i[0])}function ag(s,i,l){var d;const g=s.layout,b=(d=g.get("text-variable-anchor-offset"))===null||d===void 0?void 0:d.evaluate(i,{},l);if(b){const T=b.values,M=[];for(let A=0;A<T.length;A+=2){const O=M[A]=T[A],U=T[A+1].map(H=>H*jn);O.startsWith("top")?U[1]-=Xs:O.startsWith("bottom")&&(U[1]+=Xs),M[A+1]=U}return new Hr(M)}const w=g.get("text-variable-anchor");if(w){let T;T=s._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(i,{},l)*jn,Tf]:g.get("text-offset").evaluate(i,{},l).map(A=>A*jn);const M=[];for(const A of w)M.push(A,sg(A,T));return new Hr(M)}return null}function Ef(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Lv(s,i,l,d,g,b,w,T,M,A,O){let U=b.textMaxSize.evaluate(i,{});U===void 0&&(U=w);const H=s.layers[0].layout,K=H.get("icon-offset").evaluate(i,{},O),Q=cg(l.horizontal),ae=w/24,_e=s.tilePixelRatio*ae,xe=s.tilePixelRatio*U/24,Oe=s.tilePixelRatio*T,Se=s.tilePixelRatio*H.get("symbol-spacing"),Le=H.get("text-padding")*s.tilePixelRatio,Ye=function(at,Gt,Ot,mi=1){const Hi=at.get("icon-padding").evaluate(Gt,{},Ot),en=Hi&&Hi.values;return[en[0]*mi,en[1]*mi,en[2]*mi,en[3]*mi]}(H,i,O,s.tilePixelRatio),tt=H.get("text-max-angle")/180*Math.PI,Ct=H.get("text-rotation-alignment")!=="viewport"&&H.get("symbol-placement")!=="point",Bt=H.get("icon-rotation-alignment")==="map"&&H.get("symbol-placement")!=="point",Tt=H.get("symbol-placement"),wt=Se/2,mt=H.get("icon-text-fit");let zt;d&&mt!=="none"&&(s.allowVerticalPlacement&&l.vertical&&(zt=Pm(d,l.vertical,mt,H.get("icon-text-fit-padding"),K,ae)),Q&&(d=Pm(d,Q,mt,H.get("icon-text-fit-padding"),K,ae)));const vt=(at,Gt)=>{Gt.x<0||Gt.x>=yn||Gt.y<0||Gt.y>=yn||function(Ot,mi,Hi,en,Un,Jr,Sr,zn,Yn,or,Tr,Er,Vn,qn,fr,Cr,pr,Or,Nr,Zn,bi,mr,sr,Gn,wo){const zo=Ot.addToLineVertexArray(mi,Hi);let Do,ms,xo,ao,jr=0,gs=0,ru=0,fg=0,Df=-1,Rf=-1;const _s={};let pg=fn("");if(Ot.allowVerticalPlacement&&en.vertical){const gr=zn.layout.get("text-rotate").evaluate(bi,{},Gn)+90;xo=new Xh(Yn,mi,or,Tr,Er,en.vertical,Vn,qn,fr,gr),Sr&&(ao=new Xh(Yn,mi,or,Tr,Er,Sr,pr,Or,fr,gr))}if(Un){const gr=zn.layout.get("icon-rotate").evaluate(bi,{}),lo=zn.layout.get("icon-text-fit")!=="none",Aa=rg(Un,gr,sr,lo),Bo=Sr?rg(Sr,gr,sr,lo):void 0;ms=new Xh(Yn,mi,or,Tr,Er,Un,pr,Or,!1,gr),jr=4*Aa.length;const Pa=Ot.iconSizeData;let Yo=null;Pa.kind==="source"?(Yo=[Jo*zn.layout.get("icon-size").evaluate(bi,{})],Yo[0]>Ws&&qe(`${Ot.layerIds[0]}: Value for "icon-size" is >= ${eu}. Reduce your "icon-size".`)):Pa.kind==="composite"&&(Yo=[Jo*mr.compositeIconSizes[0].evaluate(bi,{},Gn),Jo*mr.compositeIconSizes[1].evaluate(bi,{},Gn)],(Yo[0]>Ws||Yo[1]>Ws)&&qe(`${Ot.layerIds[0]}: Value for "icon-size" is >= ${eu}. Reduce your "icon-size".`)),Ot.addSymbols(Ot.icon,Aa,Yo,Zn,Nr,bi,f.ah.none,mi,zo.lineStartIndex,zo.lineLength,-1,Gn),Df=Ot.icon.placedSymbolArray.length-1,Bo&&(gs=4*Bo.length,Ot.addSymbols(Ot.icon,Bo,Yo,Zn,Nr,bi,f.ah.vertical,mi,zo.lineStartIndex,zo.lineLength,-1,Gn),Rf=Ot.icon.placedSymbolArray.length-1)}const mg=Object.keys(en.horizontal);for(const gr of mg){const lo=en.horizontal[gr];if(!Do){pg=fn(lo.text);const Bo=zn.layout.get("text-rotate").evaluate(bi,{},Gn);Do=new Xh(Yn,mi,or,Tr,Er,lo,Vn,qn,fr,Bo)}const Aa=lo.positionedLines.length===1;if(ru+=lg(Ot,mi,lo,Jr,zn,fr,bi,Cr,zo,en.vertical?f.ah.horizontal:f.ah.horizontalOnly,Aa?mg:[gr],_s,Df,mr,Gn),Aa)break}en.vertical&&(fg+=lg(Ot,mi,en.vertical,Jr,zn,fr,bi,Cr,zo,f.ah.vertical,["vertical"],_s,Rf,mr,Gn));const zv=Do?Do.boxStartIndex:Ot.collisionBoxArray.length,Dv=Do?Do.boxEndIndex:Ot.collisionBoxArray.length,Rv=xo?xo.boxStartIndex:Ot.collisionBoxArray.length,Bv=xo?xo.boxEndIndex:Ot.collisionBoxArray.length,Fv=ms?ms.boxStartIndex:Ot.collisionBoxArray.length,Ov=ms?ms.boxEndIndex:Ot.collisionBoxArray.length,Nv=ao?ao.boxStartIndex:Ot.collisionBoxArray.length,jv=ao?ao.boxEndIndex:Ot.collisionBoxArray.length;let Ro=-1;const Jh=(gr,lo)=>gr&&gr.circleDiameter?Math.max(gr.circleDiameter,lo):lo;Ro=Jh(Do,Ro),Ro=Jh(xo,Ro),Ro=Jh(ms,Ro),Ro=Jh(ao,Ro);const gg=Ro>-1?1:0;gg&&(Ro*=wo/jn),Ot.glyphOffsetArray.length>=zl.MAX_GLYPHS&&qe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),bi.sortKey!==void 0&&Ot.addToSortKeyRanges(Ot.symbolInstances.length,bi.sortKey);const Uv=ag(zn,bi,Gn),[Vv,qv]=function(gr,lo){const Aa=gr.length,Bo=lo==null?void 0:lo.values;if((Bo==null?void 0:Bo.length)>0)for(let Pa=0;Pa<Bo.length;Pa+=2){const Yo=Bo[Pa+1];gr.emplaceBack(f.ap[Bo[Pa]],Yo[0],Yo[1])}return[Aa,gr.length]}(Ot.textAnchorOffsets,Uv);Ot.symbolInstances.emplaceBack(mi.x,mi.y,_s.right>=0?_s.right:-1,_s.center>=0?_s.center:-1,_s.left>=0?_s.left:-1,_s.vertical||-1,Df,Rf,pg,zv,Dv,Rv,Bv,Fv,Ov,Nv,jv,or,ru,fg,jr,gs,gg,0,Vn,Ro,Vv,qv)}(s,Gt,at,l,d,g,zt,s.layers[0],s.collisionBoxArray,i.index,i.sourceLayerIndex,s.index,_e,[Le,Le,Le,Le],Ct,M,Oe,Ye,Bt,K,i,b,A,O,w)};if(Tt==="line")for(const at of Ym(i.geometry,0,0,yn,yn)){const Gt=Tv(at,Se,tt,l.vertical||Q,d,24,xe,s.overscaling,yn);for(const Ot of Gt)Q&&Av(s,Q.text,wt,Ot)||vt(at,Ot)}else if(Tt==="line-center"){for(const at of i.geometry)if(at.length>1){const Gt=Sv(at,tt,l.vertical||Q,d,24,xe);Gt&&vt(at,Gt)}}else if(i.type==="Polygon")for(const at of rf(i.geometry,0)){const Gt=Mv(at,16);vt(at[0],new $s(Gt.x,Gt.y,0))}else if(i.type==="LineString")for(const at of i.geometry)vt(at,new $s(at[0].x,at[0].y,0));else if(i.type==="Point")for(const at of i.geometry)for(const Gt of at)vt([Gt],new $s(Gt.x,Gt.y,0))}function lg(s,i,l,d,g,b,w,T,M,A,O,U,H,K,Q){const ae=function(Oe,Se,Le,Ye,tt,Ct,Bt,Tt){const wt=Ye.layout.get("text-rotate").evaluate(Ct,{})*Math.PI/180,mt=[];for(const zt of Se.positionedLines)for(const vt of zt.positionedGlyphs){if(!vt.rect)continue;const at=vt.rect||{};let Gt=Tm+1,Ot=!0,mi=1,Hi=0;const en=(tt||Tt)&&vt.vertical,Un=vt.metrics.advance*vt.scale/2;if(Tt&&Se.verticalizable&&(Hi=zt.lineOffset/2-(vt.imageName?-(jn-vt.metrics.width*vt.scale)/2:(vt.scale-1)*jn)),vt.imageName){const Zn=Bt[vt.imageName];Ot=Zn.sdf,mi=Zn.pixelRatio,Gt=Fr/mi}const Jr=tt?[vt.x+Un,vt.y]:[0,0];let Sr=tt?[0,0]:[vt.x+Un+Le[0],vt.y+Le[1]-Hi],zn=[0,0];en&&(zn=Sr,Sr=[0,0]);const Yn=vt.metrics.isDoubleResolution?2:1,or=(vt.metrics.left-Gt)*vt.scale-Un+Sr[0],Tr=(-vt.metrics.top-Gt)*vt.scale+Sr[1],Er=or+at.w/Yn*vt.scale/mi,Vn=Tr+at.h/Yn*vt.scale/mi,qn=new k(or,Tr),fr=new k(Er,Tr),Cr=new k(or,Vn),pr=new k(Er,Vn);if(en){const Zn=new k(-Un,Un-Yc),bi=-Math.PI/2,mr=jn/2-Un,sr=new k(5-Yc-mr,-(vt.imageName?mr:0)),Gn=new k(...zn);qn._rotateAround(bi,Zn)._add(sr)._add(Gn),fr._rotateAround(bi,Zn)._add(sr)._add(Gn),Cr._rotateAround(bi,Zn)._add(sr)._add(Gn),pr._rotateAround(bi,Zn)._add(sr)._add(Gn)}if(wt){const Zn=Math.sin(wt),bi=Math.cos(wt),mr=[bi,-Zn,Zn,bi];qn._matMult(mr),fr._matMult(mr),Cr._matMult(mr),pr._matMult(mr)}const Or=new k(0,0),Nr=new k(0,0);mt.push({tl:qn,tr:fr,bl:Cr,br:pr,tex:at,writingMode:Se.writingMode,glyphOffset:Jr,sectionIndex:vt.sectionIndex,isSDF:Ot,pixelOffsetTL:Or,pixelOffsetBR:Nr,minFontScaleX:0,minFontScaleY:0})}return mt}(0,l,T,g,b,w,d,s.allowVerticalPlacement),_e=s.textSizeData;let xe=null;_e.kind==="source"?(xe=[Jo*g.layout.get("text-size").evaluate(w,{})],xe[0]>Ws&&qe(`${s.layerIds[0]}: Value for "text-size" is >= ${eu}. Reduce your "text-size".`)):_e.kind==="composite"&&(xe=[Jo*K.compositeTextSizes[0].evaluate(w,{},Q),Jo*K.compositeTextSizes[1].evaluate(w,{},Q)],(xe[0]>Ws||xe[1]>Ws)&&qe(`${s.layerIds[0]}: Value for "text-size" is >= ${eu}. Reduce your "text-size".`)),s.addSymbols(s.text,ae,xe,T,b,w,A,i,M.lineStartIndex,M.lineLength,H,Q);for(const Oe of O)U[Oe]=s.text.placedSymbolArray.length-1;return 4*ae.length}function cg(s){for(const i in s)return s[i];return null}function Av(s,i,l,d){const g=s.compareText;if(i in g){const b=g[i];for(let w=b.length-1;w>=0;w--)if(d.dist(b[w])<l)return!0}else g[i]=[];return g[i].push(d),!1}const ug=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Cf{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,d]=new Uint8Array(i,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=d>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const b=ug[15&d];if(!b)throw new Error("Unrecognized array type.");const[w]=new Uint16Array(i,2,1),[T]=new Uint32Array(i,4,1);return new Cf(T,w,b,i)}constructor(i,l=64,d=Float64Array,g){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=d,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const b=ug.indexOf(this.ArrayType),w=2*i*this.ArrayType.BYTES_PER_ELEMENT,T=i*this.IndexArrayType.BYTES_PER_ELEMENT,M=(8-T%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${d}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+T+M,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+w+T+M),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+T+M,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+b]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=i)}add(i,l){const d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=i,this.coords[this._pos++]=l,d}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return Mf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,l,d,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:w,nodeSize:T}=this,M=[0,b.length-1,0],A=[];for(;M.length;){const O=M.pop()||0,U=M.pop()||0,H=M.pop()||0;if(U-H<=T){for(let _e=H;_e<=U;_e++){const xe=w[2*_e],Oe=w[2*_e+1];xe>=i&&xe<=d&&Oe>=l&&Oe<=g&&A.push(b[_e])}continue}const K=H+U>>1,Q=w[2*K],ae=w[2*K+1];Q>=i&&Q<=d&&ae>=l&&ae<=g&&A.push(b[K]),(O===0?i<=Q:l<=ae)&&(M.push(H),M.push(K-1),M.push(1-O)),(O===0?d>=Q:g>=ae)&&(M.push(K+1),M.push(U),M.push(1-O))}return A}within(i,l,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:b,nodeSize:w}=this,T=[0,g.length-1,0],M=[],A=d*d;for(;T.length;){const O=T.pop()||0,U=T.pop()||0,H=T.pop()||0;if(U-H<=w){for(let _e=H;_e<=U;_e++)dg(b[2*_e],b[2*_e+1],i,l)<=A&&M.push(g[_e]);continue}const K=H+U>>1,Q=b[2*K],ae=b[2*K+1];dg(Q,ae,i,l)<=A&&M.push(g[K]),(O===0?i-d<=Q:l-d<=ae)&&(T.push(H),T.push(K-1),T.push(1-O)),(O===0?i+d>=Q:l+d>=ae)&&(T.push(K+1),T.push(U),T.push(1-O))}return M}}function Mf(s,i,l,d,g,b){if(g-d<=l)return;const w=d+g>>1;hg(s,i,w,d,g,b),Mf(s,i,l,d,w-1,1-b),Mf(s,i,l,w+1,g,1-b)}function hg(s,i,l,d,g,b){for(;g>d;){if(g-d>600){const A=g-d+1,O=l-d+1,U=Math.log(A),H=.5*Math.exp(2*U/3),K=.5*Math.sqrt(U*H*(A-H)/A)*(O-A/2<0?-1:1);hg(s,i,l,Math.max(d,Math.floor(l-O*H/A+K)),Math.min(g,Math.floor(l+(A-O)*H/A+K)),b)}const w=i[2*l+b];let T=d,M=g;for(iu(s,i,d,l),i[2*g+b]>w&&iu(s,i,d,g);T<M;){for(iu(s,i,T,M),T++,M--;i[2*T+b]<w;)T++;for(;i[2*M+b]>w;)M--}i[2*d+b]===w?iu(s,i,d,M):(M++,iu(s,i,M,g)),M<=l&&(d=M+1),l<=M&&(g=M-1)}}function iu(s,i,l,d){If(s,l,d),If(i,2*l,2*d),If(i,2*l+1,2*d+1)}function If(s,i,l){const d=s[i];s[i]=s[l],s[l]=d}function dg(s,i,l,d){const g=s-l,b=i-d;return g*g+b*b}var Lf;f.bd=void 0,(Lf=f.bd||(f.bd={})).create="create",Lf.load="load",Lf.fullLoad="fullLoad";let Kh=null,nu=[];const Af=1e3/60,Pf="loadTime",zf="fullLoadTime",Pv={mark(s){performance.mark(s)},frame(s){const i=s;Kh!=null&&nu.push(i-Kh),Kh=i},clearMetrics(){Kh=null,nu=[],performance.clearMeasures(Pf),performance.clearMeasures(zf);for(const s in f.bd)performance.clearMarks(f.bd[s])},getPerformanceMetrics(){performance.measure(Pf,f.bd.create,f.bd.load),performance.measure(zf,f.bd.create,f.bd.fullLoad);const s=performance.getEntriesByName(Pf)[0].duration,i=performance.getEntriesByName(zf)[0].duration,l=nu.length,d=1/(nu.reduce((b,w)=>b+w,0)/l/1e3),g=nu.filter(b=>b>Af).reduce((b,w)=>b+(w-Af)/Af,0);return{loadTime:s,fullLoadTime:i,fps:d,percentDroppedFrames:g/(l+g)*100,totalFrames:l}}};f.$=_t,f.A=Cl,f.B=function(s){if(ft==null){const i=s.navigator?s.navigator.userAgent:null;ft=!!s.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return ft},f.C=class{constructor(s,i){this.target=s,this.mapId=i,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new xv(()=>this.process()),this.subscription=function(l,d,g,b){return l.addEventListener(d,g,!1),{unsubscribe:()=>{l.removeEventListener(d,g,!1)}}}(this.target,"message",l=>this.receive(l)),this.globalScope=bt(self)?s:window}registerMessageHandler(s,i){this.messageHandlers[s]=i}sendAsync(s,i){return new Promise((l,d)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[g]={resolve:l,reject:d},i&&i.signal.addEventListener("abort",()=>{delete this.resolveRejects[g];const T={id:g,type:"<cancel>",origin:location.origin,targetMapId:s.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)},{once:!0});const b=[],w=Object.assign(Object.assign({},s),{id:g,sourceMapId:this.mapId,origin:location.origin,data:js(s.data,b)});this.target.postMessage(w,{transfer:b})})}receive(s){const i=s.data,l=i.id;if(!(i.origin!=="file://"&&location.origin!=="file://"&&i.origin!==location.origin||i.targetMapId&&this.mapId!==i.targetMapId)){if(i.type==="<cancel>"){delete this.tasks[l];const d=this.abortControllers[l];return delete this.abortControllers[l],void(d&&d.abort())}if(bt(self)||i.mustQueue)return this.tasks[l]=i,this.taskQueue.push(l),void this.invoker.trigger();this.processTask(l,i)}}process(){if(this.taskQueue.length===0)return;const s=this.taskQueue.shift(),i=this.tasks[s];delete this.tasks[s],this.taskQueue.length>0&&this.invoker.trigger(),i&&this.processTask(s,i)}processTask(s,i){return a(this,void 0,void 0,function*(){if(i.type==="<response>"){const g=this.resolveRejects[s];return delete this.resolveRejects[s],g?void(i.error?g.reject(Us(i.error)):g.resolve(Us(i.data))):void 0}if(!this.messageHandlers[i.type])return void this.completeTask(s,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const l=Us(i.data),d=new AbortController;this.abortControllers[s]=d;try{const g=yield this.messageHandlers[i.type](i.sourceMapId,l,d);this.completeTask(s,null,g)}catch(g){this.completeTask(s,g)}})}completeTask(s,i,l){const d=[];delete this.abortControllers[s];const g={id:s,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:i?js(i):null,data:js(l,d)};this.target.postMessage(g,{transfer:d})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},f.D=Nt,f.E=xt,f.F=function(){var s=new Cl(16);return Cl!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},f.G=hi,f.H=function(s,i,l){var d,g,b,w,T,M,A,O,U,H,K,Q,ae=l[0],_e=l[1],xe=l[2];return i===s?(s[12]=i[0]*ae+i[4]*_e+i[8]*xe+i[12],s[13]=i[1]*ae+i[5]*_e+i[9]*xe+i[13],s[14]=i[2]*ae+i[6]*_e+i[10]*xe+i[14],s[15]=i[3]*ae+i[7]*_e+i[11]*xe+i[15]):(g=i[1],b=i[2],w=i[3],T=i[4],M=i[5],A=i[6],O=i[7],U=i[8],H=i[9],K=i[10],Q=i[11],s[0]=d=i[0],s[1]=g,s[2]=b,s[3]=w,s[4]=T,s[5]=M,s[6]=A,s[7]=O,s[8]=U,s[9]=H,s[10]=K,s[11]=Q,s[12]=d*ae+T*_e+U*xe+i[12],s[13]=g*ae+M*_e+H*xe+i[13],s[14]=b*ae+A*_e+K*xe+i[14],s[15]=w*ae+O*_e+Q*xe+i[15]),s},f.I=pf,f.J=function(s,i,l){var d=l[0],g=l[1],b=l[2];return s[0]=i[0]*d,s[1]=i[1]*d,s[2]=i[2]*d,s[3]=i[3]*d,s[4]=i[4]*g,s[5]=i[5]*g,s[6]=i[6]*g,s[7]=i[7]*g,s[8]=i[8]*b,s[9]=i[9]*b,s[10]=i[10]*b,s[11]=i[11]*b,s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},f.K=Wp,f.L=function(s,i){const l={};for(let d=0;d<i.length;d++){const g=i[d];g in s&&(l[g]=s[g])}return l},f.M=Hs,f.N=Um,f.O=Vm,f.P=k,f.Q=so,f.R=oo,f.S=B,f.T=Cc,f.U=N,f.V=ii,f.W=yn,f.X=Sn,f.Y=Gh,f.Z=class extends Lc{},f._=a,f.a=ei,f.a$=function(s,i,l){return s[0]=i[0]*l[0],s[1]=i[1]*l[1],s[2]=i[2]*l[2],s[3]=i[3]*l[3],s},f.a0=Sf,f.a1=ut,f.a2=s=>{const i=window.document.createElement("video");return i.muted=!0,new Promise(l=>{i.onloadstart=()=>{l(i)};for(const d of s){const g=window.document.createElement("source");ct(d)||(i.crossOrigin="Anonymous"),g.src=d,i.appendChild(g)}})},f.a3=function(){return Y++},f.a4=y,f.a5=zl,f.a6=sl,f.a7=fs,f.a8=Yi,f.a9=$m,f.aA=te,f.aB=function(s,i){if(!s)return[{command:"setStyle",args:[i]}];let l=[];try{if(!$e(s.version,i.version))return[{command:"setStyle",args:[i]}];$e(s.center,i.center)||l.push({command:"setCenter",args:[i.center]}),$e(s.zoom,i.zoom)||l.push({command:"setZoom",args:[i.zoom]}),$e(s.bearing,i.bearing)||l.push({command:"setBearing",args:[i.bearing]}),$e(s.pitch,i.pitch)||l.push({command:"setPitch",args:[i.pitch]}),$e(s.sprite,i.sprite)||l.push({command:"setSprite",args:[i.sprite]}),$e(s.glyphs,i.glyphs)||l.push({command:"setGlyphs",args:[i.glyphs]}),$e(s.transition,i.transition)||l.push({command:"setTransition",args:[i.transition]}),$e(s.light,i.light)||l.push({command:"setLight",args:[i.light]}),$e(s.terrain,i.terrain)||l.push({command:"setTerrain",args:[i.terrain]}),$e(s.sky,i.sky)||l.push({command:"setSky",args:[i.sky]});const d={},g=[];(function(w,T,M,A){let O;for(O in T=T||{},w=w||{})Object.prototype.hasOwnProperty.call(w,O)&&(Object.prototype.hasOwnProperty.call(T,O)||wn(O,M,A));for(O in T)Object.prototype.hasOwnProperty.call(T,O)&&(Object.prototype.hasOwnProperty.call(w,O)?$e(w[O],T[O])||(w[O].type==="geojson"&&T[O].type==="geojson"&&tr(w,T,O)?kt(M,{command:"setGeoJSONSourceData",args:[O,T[O].data]}):Cn(O,T,M,A)):bn(O,T,M))})(s.sources,i.sources,g,d);const b=[];s.layers&&s.layers.forEach(w=>{"source"in w&&d[w.source]?l.push({command:"removeLayer",args:[w.id]}):b.push(w)}),l=l.concat(g),function(w,T,M){T=T||[];const A=(w=w||[]).map(Uo),O=T.map(Uo),U=w.reduce(Ki,{}),H=T.reduce(Ki,{}),K=A.slice(),Q=Object.create(null);let ae,_e,xe,Oe,Se;for(let Le=0,Ye=0;Le<A.length;Le++)ae=A[Le],Object.prototype.hasOwnProperty.call(H,ae)?Ye++:(kt(M,{command:"removeLayer",args:[ae]}),K.splice(K.indexOf(ae,Ye),1));for(let Le=0,Ye=0;Le<O.length;Le++)ae=O[O.length-1-Le],K[K.length-1-Le]!==ae&&(Object.prototype.hasOwnProperty.call(U,ae)?(kt(M,{command:"removeLayer",args:[ae]}),K.splice(K.lastIndexOf(ae,K.length-Ye),1)):Ye++,Oe=K[K.length-Le],kt(M,{command:"addLayer",args:[H[ae],Oe]}),K.splice(K.length-Le,0,ae),Q[ae]=!0);for(let Le=0;Le<O.length;Le++)if(ae=O[Le],_e=U[ae],xe=H[ae],!Q[ae]&&!$e(_e,xe))if($e(_e.source,xe.source)&&$e(_e["source-layer"],xe["source-layer"])&&$e(_e.type,xe.type)){for(Se in ir(_e.layout,xe.layout,M,ae,null,"setLayoutProperty"),ir(_e.paint,xe.paint,M,ae,null,"setPaintProperty"),$e(_e.filter,xe.filter)||kt(M,{command:"setFilter",args:[ae,xe.filter]}),$e(_e.minzoom,xe.minzoom)&&$e(_e.maxzoom,xe.maxzoom)||kt(M,{command:"setLayerZoomRange",args:[ae,xe.minzoom,xe.maxzoom]}),_e)Object.prototype.hasOwnProperty.call(_e,Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?ir(_e[Se],xe[Se],M,ae,Se.slice(6),"setPaintProperty"):$e(_e[Se],xe[Se])||kt(M,{command:"setLayerProperty",args:[ae,Se,xe[Se]]}));for(Se in xe)Object.prototype.hasOwnProperty.call(xe,Se)&&!Object.prototype.hasOwnProperty.call(_e,Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?ir(_e[Se],xe[Se],M,ae,Se.slice(6),"setPaintProperty"):$e(_e[Se],xe[Se])||kt(M,{command:"setLayerProperty",args:[ae,Se,xe[Se]]}))}else kt(M,{command:"removeLayer",args:[ae]}),Oe=K[K.lastIndexOf(ae)+1],kt(M,{command:"addLayer",args:[xe,Oe]})}(b,i.layers,l)}catch(d){console.warn("Unable to compute style diff:",d),l=[{command:"setStyle",args:[i]}]}return l},f.aC=function(s){const i=[],l=s.id;return l===void 0&&i.push({message:`layers.${l}: missing required property "id"`}),s.render===void 0&&i.push({message:`layers.${l}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&i.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),i},f.aD=function s(i,l){if(Array.isArray(i)){if(!Array.isArray(l)||i.length!==l.length)return!1;for(let d=0;d<i.length;d++)if(!s(i[d],l[d]))return!1;return!0}if(typeof i=="object"&&i!==null&&l!==null){if(typeof l!="object"||Object.keys(i).length!==Object.keys(l).length)return!1;for(const d in i)if(!s(i[d],l[d]))return!1;return!0}return i===l},f.aE=ve,f.aF=Be,f.aG=class extends Nn{constructor(s,i){super(s,i),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},f.aH=Br,f.aI=class extends Nn{constructor(s,i){super(s,i),this.current=Ia}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let i=1;i<16;i++)if(s[i]!==this.current[i]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},f.aJ=vo,f.aK=class extends Nn{constructor(s,i){super(s,i),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},f.aL=class extends Nn{constructor(s,i){super(s,i),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},f.aM=$o,f.aN=function(s,i,l,d,g,b,w){var T=1/(i-l),M=1/(d-g),A=1/(b-w);return s[0]=-2*T,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*M,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*A,s[11]=0,s[12]=(i+l)*T,s[13]=(g+d)*M,s[14]=(w+b)*A,s[15]=1,s},f.aO=zi,f.aP=i1,f.aQ=class extends vl{},f.aR=K1,f.aS=class extends bl{},f.aT=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},f.aU=Jp,f.aV=Z,f.aW=class extends Bc{},f.aX=Ke,f.aY=function(s,i){return s[0]===i[0]&&s[1]===i[1]&&s[2]===i[2]&&s[3]===i[3]&&s[4]===i[4]&&s[5]===i[5]&&s[6]===i[6]&&s[7]===i[7]&&s[8]===i[8]&&s[9]===i[9]&&s[10]===i[10]&&s[11]===i[11]&&s[12]===i[12]&&s[13]===i[13]&&s[14]===i[14]&&s[15]===i[15]},f.aZ=function(s,i){var l=s[0],d=s[1],g=s[2],b=s[3],w=s[4],T=s[5],M=s[6],A=s[7],O=s[8],U=s[9],H=s[10],K=s[11],Q=s[12],ae=s[13],_e=s[14],xe=s[15],Oe=i[0],Se=i[1],Le=i[2],Ye=i[3],tt=i[4],Ct=i[5],Bt=i[6],Tt=i[7],wt=i[8],mt=i[9],zt=i[10],vt=i[11],at=i[12],Gt=i[13],Ot=i[14],mi=i[15];return Math.abs(l-Oe)<=kr*Math.max(1,Math.abs(l),Math.abs(Oe))&&Math.abs(d-Se)<=kr*Math.max(1,Math.abs(d),Math.abs(Se))&&Math.abs(g-Le)<=kr*Math.max(1,Math.abs(g),Math.abs(Le))&&Math.abs(b-Ye)<=kr*Math.max(1,Math.abs(b),Math.abs(Ye))&&Math.abs(w-tt)<=kr*Math.max(1,Math.abs(w),Math.abs(tt))&&Math.abs(T-Ct)<=kr*Math.max(1,Math.abs(T),Math.abs(Ct))&&Math.abs(M-Bt)<=kr*Math.max(1,Math.abs(M),Math.abs(Bt))&&Math.abs(A-Tt)<=kr*Math.max(1,Math.abs(A),Math.abs(Tt))&&Math.abs(O-wt)<=kr*Math.max(1,Math.abs(O),Math.abs(wt))&&Math.abs(U-mt)<=kr*Math.max(1,Math.abs(U),Math.abs(mt))&&Math.abs(H-zt)<=kr*Math.max(1,Math.abs(H),Math.abs(zt))&&Math.abs(K-vt)<=kr*Math.max(1,Math.abs(K),Math.abs(vt))&&Math.abs(Q-at)<=kr*Math.max(1,Math.abs(Q),Math.abs(at))&&Math.abs(ae-Gt)<=kr*Math.max(1,Math.abs(ae),Math.abs(Gt))&&Math.abs(_e-Ot)<=kr*Math.max(1,Math.abs(_e),Math.abs(Ot))&&Math.abs(xe-mi)<=kr*Math.max(1,Math.abs(xe),Math.abs(mi))},f.a_=function(s,i){return s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[4]=i[4],s[5]=i[5],s[6]=i[6],s[7]=i[7],s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},f.aa=function(s){const i={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,d,g,b)=>{const w=g||b;return i[d]=!w||w.toLowerCase(),""}),i["max-age"]){const l=parseInt(i["max-age"],10);isNaN(l)?delete i["max-age"]:i["max-age"]=l}return i},f.ab=function(s,i){const l=[];for(const d in s)d in i||l.push(d);return l},f.ac=le,f.ad=function(s,i,l){var d=Math.sin(l),g=Math.cos(l),b=i[0],w=i[1],T=i[2],M=i[3],A=i[4],O=i[5],U=i[6],H=i[7];return i!==s&&(s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[0]=b*g+A*d,s[1]=w*g+O*d,s[2]=T*g+U*d,s[3]=M*g+H*d,s[4]=A*g-b*d,s[5]=O*g-w*d,s[6]=U*g-T*d,s[7]=H*g-M*d,s},f.ae=function(s){var i=new Cl(16);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],i},f.af=Dh,f.ag=function(s,i){let l=0,d=0;if(s.kind==="constant")d=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:g,minZoom:b,maxZoom:w}=s,T=g?le(nr.interpolationFactor(g,i,b,w),0,1):0;s.kind==="camera"?d=hr.number(s.minSize,s.maxSize,T):l=T}return{uSizeT:l,uSize:d}},f.ai=function(s,{uSize:i,uSizeT:l},{lowerSize:d,upperSize:g}){return s.kind==="source"?d/Jo:s.kind==="composite"?hr.number(d/Jo,g/Jo,l):i},f.aj=yf,f.ak=function(s,i,l,d){const g=i.y-s.y,b=i.x-s.x,w=d.y-l.y,T=d.x-l.x,M=w*b-T*g;if(M===0)return null;const A=(T*(s.y-l.y)-w*(s.x-l.x))/M;return new k(s.x+A*b,s.y+A*g)},f.al=Ym,f.am=Oc,f.an=Kd,f.ao=jn,f.aq=_f,f.ar=function(s,i){var l=i[0],d=i[1],g=i[2],b=i[3],w=i[4],T=i[5],M=i[6],A=i[7],O=i[8],U=i[9],H=i[10],K=i[11],Q=i[12],ae=i[13],_e=i[14],xe=i[15],Oe=l*T-d*w,Se=l*M-g*w,Le=l*A-b*w,Ye=d*M-g*T,tt=d*A-b*T,Ct=g*A-b*M,Bt=O*ae-U*Q,Tt=O*_e-H*Q,wt=O*xe-K*Q,mt=U*_e-H*ae,zt=U*xe-K*ae,vt=H*xe-K*_e,at=Oe*vt-Se*zt+Le*mt+Ye*wt-tt*Tt+Ct*Bt;return at?(s[0]=(T*vt-M*zt+A*mt)*(at=1/at),s[1]=(g*zt-d*vt-b*mt)*at,s[2]=(ae*Ct-_e*tt+xe*Ye)*at,s[3]=(H*tt-U*Ct-K*Ye)*at,s[4]=(M*wt-w*vt-A*Tt)*at,s[5]=(l*vt-g*wt+b*Tt)*at,s[6]=(_e*Le-Q*Ct-xe*Se)*at,s[7]=(O*Ct-H*Le+K*Se)*at,s[8]=(w*zt-T*wt+A*Bt)*at,s[9]=(d*wt-l*zt-b*Bt)*at,s[10]=(Q*tt-ae*Le+xe*Oe)*at,s[11]=(U*Le-O*tt-K*Oe)*at,s[12]=(T*Tt-w*mt-M*Bt)*at,s[13]=(l*mt-d*Tt+g*Bt)*at,s[14]=(ae*Se-Q*Ye-_e*Oe)*at,s[15]=(O*Ye-U*Se+H*Oe)*at,s):null},f.as=Ef,f.at=gf,f.au=Cf,f.av=function(){const s={},i=we.$version;for(const l in we.$root){const d=we.$root[l];if(d.required){let g=null;g=l==="version"?i:d.type==="array"?[]:{},g!=null&&(s[l]=g)}}return s},f.aw=bh,f.ax=gi,f.ay=function(s){s=s.slice();const i=Object.create(null);for(let l=0;l<s.length;l++)i[s[l].id]=s[l];for(let l=0;l<s.length;l++)"ref"in s[l]&&(s[l]=Ve(s[l],i[s[l].ref]));return s},f.az=function(s){if(s.type==="custom")return new wv(s);switch(s.type){case"background":return new yv(s);case"circle":return new n1(s);case"fill":return new k1(s);case"fill-extrusion":return new O1(s);case"heatmap":return new o1(s);case"hillshade":return new a1(s);case"line":return new W1(s);case"raster":return new bv(s);case"symbol":return new Zh(s)}},f.b=ot,f.b0=function(s,i){return s[0]*i[0]+s[1]*i[1]+s[2]*i[2]+s[3]*i[3]},f.b1=oe,f.b2=Gm,f.b3=qm,f.b4=function(s,i,l,d,g){var b,w=1/Math.tan(i/2);return s[0]=w/l,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=w,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,g!=null&&g!==1/0?(s[10]=(g+d)*(b=1/(d-g)),s[14]=2*g*d*b):(s[10]=-1,s[14]=-2*d),s},f.b5=function(s,i,l){var d=Math.sin(l),g=Math.cos(l),b=i[4],w=i[5],T=i[6],M=i[7],A=i[8],O=i[9],U=i[10],H=i[11];return i!==s&&(s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[4]=b*g+A*d,s[5]=w*g+O*d,s[6]=T*g+U*d,s[7]=M*g+H*d,s[8]=A*g-b*d,s[9]=O*g-w*d,s[10]=U*g-T*d,s[11]=H*g-M*d,s},f.b6=V,f.b7=j,f.b8=function(s){return s*Math.PI/180},f.b9=function(s,i){return s[0]=i[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=i[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=i[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},f.bA=Ho,f.ba=class extends Ao{},f.bb=xf,f.bc=Pv,f.be=xi,f.bf=function(s,i){ei.REGISTERED_PROTOCOLS[s]=i},f.bg=function(s){delete ei.REGISTERED_PROTOCOLS[s]},f.bh=function(s,i){const l={};for(let g=0;g<s.length;g++){const b=i&&i[s[g].id]||Gd(s[g]);i&&(i[s[g].id]=b);let w=l[b];w||(w=l[b]=[]),w.push(s[g])}const d=[];for(const g in l)d.push(l[g]);return d},f.bi=Lt,f.bj=Hm,f.bk=Xm,f.bl=Cm,f.bm=function(s){s.bucket.createArrays(),s.bucket.tilePixelRatio=yn/(512*s.bucket.overscaling),s.bucket.compareText={},s.bucket.iconsNeedLinear=!1;const i=s.bucket.layers[0],l=i.layout,d=i._unevaluatedLayout._values,g={layoutIconSize:d["icon-size"].possiblyEvaluate(new Yi(s.bucket.zoom+1),s.canonical),layoutTextSize:d["text-size"].possiblyEvaluate(new Yi(s.bucket.zoom+1),s.canonical),textMaxSize:d["text-size"].possiblyEvaluate(new Yi(18))};if(s.bucket.textSizeData.kind==="composite"){const{minZoom:A,maxZoom:O}=s.bucket.textSizeData;g.compositeTextSizes=[d["text-size"].possiblyEvaluate(new Yi(A),s.canonical),d["text-size"].possiblyEvaluate(new Yi(O),s.canonical)]}if(s.bucket.iconSizeData.kind==="composite"){const{minZoom:A,maxZoom:O}=s.bucket.iconSizeData;g.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new Yi(A),s.canonical),d["icon-size"].possiblyEvaluate(new Yi(O),s.canonical)]}const b=l.get("text-line-height")*jn,w=l.get("text-rotation-alignment")!=="viewport"&&l.get("symbol-placement")!=="point",T=l.get("text-keep-upright"),M=l.get("text-size");for(const A of s.bucket.features){const O=l.get("text-font").evaluate(A,{},s.canonical).join(","),U=M.evaluate(A,{},s.canonical),H=g.layoutTextSize.evaluate(A,{},s.canonical),K=g.layoutIconSize.evaluate(A,{},s.canonical),Q={horizontal:{},vertical:void 0},ae=A.text;let _e,xe=[0,0];if(ae){const Le=ae.toString(),Ye=l.get("text-letter-spacing").evaluate(A,{},s.canonical)*jn,tt=wh(Le)?Ye:0,Ct=l.get("text-anchor").evaluate(A,{},s.canonical),Bt=ag(i,A,s.canonical);if(!Bt){const vt=l.get("text-radial-offset").evaluate(A,{},s.canonical);xe=vt?sg(Ct,[vt*jn,Tf]):l.get("text-offset").evaluate(A,{},s.canonical).map(at=>at*jn)}let Tt=w?"center":l.get("text-justify").evaluate(A,{},s.canonical);const wt=l.get("symbol-placement"),mt=wt==="point"?l.get("text-max-width").evaluate(A,{},s.canonical)*jn:0,zt=()=>{s.bucket.allowVerticalPlacement&&Vs(Le)&&(Q.vertical=Uh(ae,s.glyphMap,s.glyphPositions,s.imagePositions,O,mt,b,Ct,"left",tt,xe,f.ah.vertical,!0,wt,H,U))};if(!w&&Bt){const vt=new Set;if(Tt==="auto")for(let Gt=0;Gt<Bt.values.length;Gt+=2)vt.add(Ef(Bt.values[Gt]));else vt.add(Tt);let at=!1;for(const Gt of vt)if(!Q.horizontal[Gt])if(at)Q.horizontal[Gt]=Q.horizontal[0];else{const Ot=Uh(ae,s.glyphMap,s.glyphPositions,s.imagePositions,O,mt,b,"center",Gt,tt,xe,f.ah.horizontal,!1,wt,H,U);Ot&&(Q.horizontal[Gt]=Ot,at=Ot.positionedLines.length===1)}zt()}else{Tt==="auto"&&(Tt=Ef(Ct));const vt=Uh(ae,s.glyphMap,s.glyphPositions,s.imagePositions,O,mt,b,Ct,Tt,tt,xe,f.ah.horizontal,!1,wt,H,U);vt&&(Q.horizontal[Tt]=vt),zt(),Vs(Le)&&w&&T&&(Q.vertical=Uh(ae,s.glyphMap,s.glyphPositions,s.imagePositions,O,mt,b,Ct,Tt,tt,xe,f.ah.vertical,!1,wt,H,U))}}let Oe=!1;if(A.icon&&A.icon.name){const Le=s.imageMap[A.icon.name];Le&&(_e=fv(s.imagePositions[A.icon.name],l.get("icon-offset").evaluate(A,{},s.canonical),l.get("icon-anchor").evaluate(A,{},s.canonical)),Oe=!!Le.sdf,s.bucket.sdfIcons===void 0?s.bucket.sdfIcons=Oe:s.bucket.sdfIcons!==Oe&&qe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Le.pixelRatio!==s.bucket.pixelRatio||l.get("icon-rotate").constantOr(1)!==0)&&(s.bucket.iconsNeedLinear=!0))}const Se=cg(Q.horizontal)||Q.vertical;s.bucket.iconsInText=!!Se&&Se.iconsInText,(Se||_e)&&Lv(s.bucket,A,Q,_e,s.imageMap,g,H,K,xe,Oe,s.canonical)}s.showCollisionBoxes&&s.bucket.generateCollisionDebugBuffers()},f.bn=uf,f.bo=af,f.bp=cf,f.bq=Zs,f.br=df,f.bs=class{constructor(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let s=performance.getEntriesByName(this._marks.measure);return s.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),s=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),s}},f.bt=function(s,i,l,d,g){return a(this,void 0,void 0,function*(){if(N())try{return yield ii(s,i,l,d,g)}catch{}return function(b,w,T,M,A){const O=b.width,U=b.height;Ft&&Pt||(Ft=new OffscreenCanvas(O,U),Pt=Ft.getContext("2d",{willReadFrequently:!0})),Ft.width=O,Ft.height=U,Pt.drawImage(b,0,0,O,U);const H=Pt.getImageData(w,T,M,A);return Pt.clearRect(0,0,O,U),H.data}(s,i,l,d,g)})},f.bu=Wm,f.bv=_,f.bw=x,f.bx=ym,f.by=as,f.bz=function(s){return s.message===Jt},f.c=Mt,f.d=s=>a(void 0,void 0,void 0,function*(){if(s.byteLength===0)return createImageBitmap(new ImageData(1,1));const i=new Blob([new Uint8Array(s)],{type:"image/png"});try{return createImageBitmap(i)}catch(l){throw new Error(`Could not load image because of ${l.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),f.e=$,f.f=s=>new Promise((i,l)=>{const d=new Image;d.onload=()=>{i(d),URL.revokeObjectURL(d.src),d.onload=null,window.requestAnimationFrame(()=>{d.src=Zt})},d.onerror=()=>l(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(s)],{type:"image/png"});d.src=s.byteLength?URL.createObjectURL(g):Zt}),f.g=Vt,f.h=(s,i)=>Ai($(s,{type:"json"}),i),f.i=bt,f.j=rt,f.k=je,f.l=(s,i)=>Ai($(s,{type:"arrayBuffer"}),i),f.m=Ai,f.n=function(s){return new df(s).readFields(av,[])},f.o=Zc,f.p=Em,f.q=xr,f.r=Wd,f.s=ct,f.t=Ns,f.u=St,f.v=we,f.w=qe,f.x=cs,f.y=function([s,i,l]){return i+=90,i*=Math.PI/180,l*=Math.PI/180,{x:s*Math.cos(i)*Math.sin(l),y:s*Math.sin(i)*Math.sin(l),z:s*Math.cos(l)}},f.z=hr}),c("worker",["./shared"],function(f){class a{constructor(W){this.keyCache={},W&&this.replace(W)}replace(W){this._layerConfigs={},this._layers={},this.update(W,[])}update(W,X){for(const fe of W){this._layerConfigs[fe.id]=fe;const Me=this._layers[fe.id]=f.az(fe);Me._featureFilter=f.a6(Me.filter),this.keyCache[fe.id]&&delete this.keyCache[fe.id]}for(const fe of X)delete this.keyCache[fe],delete this._layerConfigs[fe],delete this._layers[fe];this.familiesBySource={};const ee=f.bh(Object.values(this._layerConfigs),this.keyCache);for(const fe of ee){const Me=fe.map(Ze=>this._layers[Ze.id]),Ie=Me[0];if(Ie.visibility==="none")continue;const Pe=Ie.source||"";let ke=this.familiesBySource[Pe];ke||(ke=this.familiesBySource[Pe]={});const G=Ie.sourceLayer||"_geojsonTileLayer";let Ue=ke[G];Ue||(Ue=ke[G]=[]),Ue.push(Me)}}}class _{constructor(W){const X={},ee=[];for(const Pe in W){const ke=W[Pe],G=X[Pe]={};for(const Ue in ke){const Ze=ke[+Ue];if(!Ze||Ze.bitmap.width===0||Ze.bitmap.height===0)continue;const We={x:0,y:0,w:Ze.bitmap.width+2,h:Ze.bitmap.height+2};ee.push(We),G[Ue]={rect:We,metrics:Ze.metrics}}}const{w:fe,h:Me}=f.p(ee),Ie=new f.o({width:fe||1,height:Me||1});for(const Pe in W){const ke=W[Pe];for(const G in ke){const Ue=ke[+G];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;const Ze=X[Pe][G].rect;f.o.copy(Ue.bitmap,Ie,{x:0,y:0},{x:Ze.x+1,y:Ze.y+1},Ue.bitmap)}}this.image=Ie,this.positions=X}}f.bi("GlyphAtlas",_);class x{constructor(W){this.tileID=new f.Q(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.uid=W.uid,this.zoom=W.zoom,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.returnDependencies=!!W.returnDependencies,this.promoteId=W.promoteId,this.inFlightDependencies=[]}parse(W,X,ee,fe){return f._(this,void 0,void 0,function*(){this.status="parsing",this.data=W,this.collisionBoxArray=new f.a4;const Me=new f.bj(Object.keys(W.layers).sort()),Ie=new f.bk(this.tileID,this.promoteId);Ie.bucketLayerIDs=[];const Pe={},ke={featureIndex:Ie,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ee},G=X.familiesBySource[this.source];for(const li in G){const un=W.layers[li];if(!un)continue;un.version===1&&f.w(`Vector tile source "${this.source}" layer "${li}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Fn=Me.encode(li),ur=[];for(let vr=0;vr<un.length;vr++){const Xn=un.feature(vr),po=Ie.getId(Xn,li);ur.push({feature:Xn,id:po,index:vr,sourceLayerIndex:Fn})}for(const vr of G[li]){const Xn=vr[0];Xn.source!==this.source&&f.w(`layer.source = ${Xn.source} does not equal this.source = ${this.source}`),Xn.minzoom&&this.zoom<Math.floor(Xn.minzoom)||Xn.maxzoom&&this.zoom>=Xn.maxzoom||Xn.visibility!=="none"&&(S(vr,this.zoom,ee),(Pe[Xn.id]=Xn.createBucket({index:Ie.bucketLayerIDs.length,layers:vr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Fn,sourceID:this.source})).populate(ur,ke,this.tileID.canonical),Ie.bucketLayerIDs.push(vr.map(po=>po.id)))}}const Ue=f.aE(ke.glyphDependencies,li=>Object.keys(li).map(Number));this.inFlightDependencies.forEach(li=>li==null?void 0:li.abort()),this.inFlightDependencies=[];let Ze=Promise.resolve({});if(Object.keys(Ue).length){const li=new AbortController;this.inFlightDependencies.push(li),Ze=fe.sendAsync({type:"GG",data:{stacks:Ue,source:this.source,tileID:this.tileID,type:"glyphs"}},li)}const We=Object.keys(ke.iconDependencies);let Je=Promise.resolve({});if(We.length){const li=new AbortController;this.inFlightDependencies.push(li),Je=fe.sendAsync({type:"GI",data:{icons:We,source:this.source,tileID:this.tileID,type:"icons"}},li)}const ht=Object.keys(ke.patternDependencies);let Rt=Promise.resolve({});if(ht.length){const li=new AbortController;this.inFlightDependencies.push(li),Rt=fe.sendAsync({type:"GI",data:{icons:ht,source:this.source,tileID:this.tileID,type:"patterns"}},li)}const[Xt,ai,vi]=yield Promise.all([Ze,Je,Rt]),Ji=new _(Xt),Mn=new f.bl(ai,vi);for(const li in Pe){const un=Pe[li];un instanceof f.a5?(S(un.layers,this.zoom,ee),f.bm({bucket:un,glyphMap:Xt,glyphPositions:Ji.positions,imageMap:ai,imagePositions:Mn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):un.hasPattern&&(un instanceof f.bn||un instanceof f.bo||un instanceof f.bp)&&(S(un.layers,this.zoom,ee),un.addFeatures(ke,this.tileID.canonical,Mn.patternPositions))}return this.status="done",{buckets:Object.values(Pe).filter(li=>!li.isEmpty()),featureIndex:Ie,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ji.image,imageAtlas:Mn,glyphMap:this.returnDependencies?Xt:null,iconMap:this.returnDependencies?ai:null,glyphPositions:this.returnDependencies?Ji.positions:null}})}}function S(ge,W,X){const ee=new f.a8(W);for(const fe of ge)fe.recalculate(ee,X)}class k{constructor(W,X,ee){this.actor=W,this.layerIndex=X,this.availableImages=ee,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(W,X){return f._(this,void 0,void 0,function*(){const ee=yield f.l(W.request,X);try{return{vectorTile:new f.bq.VectorTile(new f.br(ee.data)),rawData:ee.data,cacheControl:ee.cacheControl,expires:ee.expires}}catch(fe){const Me=new Uint8Array(ee.data);let Ie=`Unable to parse the tile at ${W.request.url}, `;throw Ie+=Me[0]===31&&Me[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${fe.messge}`,new Error(Ie)}})}loadTile(W){return f._(this,void 0,void 0,function*(){const X=W.uid,ee=!!(W&&W.request&&W.request.collectResourceTiming)&&new f.bs(W.request),fe=new x(W);this.loading[X]=fe;const Me=new AbortController;fe.abort=Me;try{const Ie=yield this.loadVectorTile(W,Me);if(delete this.loading[X],!Ie)return null;const Pe=Ie.rawData,ke={};Ie.expires&&(ke.expires=Ie.expires),Ie.cacheControl&&(ke.cacheControl=Ie.cacheControl);const G={};if(ee){const Ze=ee.finish();Ze&&(G.resourceTiming=JSON.parse(JSON.stringify(Ze)))}fe.vectorTile=Ie.vectorTile;const Ue=fe.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[X]=fe,this.fetching[X]={rawTileData:Pe,cacheControl:ke,resourceTiming:G};try{const Ze=yield Ue;return f.e({rawTileData:Pe.slice(0)},Ze,ke,G)}finally{delete this.fetching[X]}}catch(Ie){throw delete this.loading[X],fe.status="done",this.loaded[X]=fe,Ie}})}reloadTile(W){return f._(this,void 0,void 0,function*(){const X=W.uid;if(!this.loaded||!this.loaded[X])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ee=this.loaded[X];if(ee.showCollisionBoxes=W.showCollisionBoxes,ee.status==="parsing"){const fe=yield ee.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor);let Me;if(this.fetching[X]){const{rawTileData:Ie,cacheControl:Pe,resourceTiming:ke}=this.fetching[X];delete this.fetching[X],Me=f.e({rawTileData:Ie.slice(0)},fe,Pe,ke)}else Me=fe;return Me}if(ee.status==="done"&&ee.vectorTile)return ee.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(W){return f._(this,void 0,void 0,function*(){const X=this.loading,ee=W.uid;X&&X[ee]&&X[ee].abort&&(X[ee].abort.abort(),delete X[ee])})}removeTile(W){return f._(this,void 0,void 0,function*(){this.loaded&&this.loaded[W.uid]&&delete this.loaded[W.uid]})}}class I{constructor(){this.loaded={}}loadTile(W){return f._(this,void 0,void 0,function*(){const{uid:X,encoding:ee,rawImageData:fe,redFactor:Me,greenFactor:Ie,blueFactor:Pe,baseShift:ke}=W,G=fe.width+2,Ue=fe.height+2,Ze=f.b(fe)?new f.R({width:G,height:Ue},yield f.bt(fe,-1,-1,G,Ue)):fe,We=new f.bu(X,Ze,ee,Me,Ie,Pe,ke);return this.loaded=this.loaded||{},this.loaded[X]=We,We})}removeTile(W){const X=this.loaded,ee=W.uid;X&&X[ee]&&delete X[ee]}}function P(ge,W){if(ge.length!==0){D(ge[0],W);for(var X=1;X<ge.length;X++)D(ge[X],!W)}}function D(ge,W){for(var X=0,ee=0,fe=0,Me=ge.length,Ie=Me-1;fe<Me;Ie=fe++){var Pe=(ge[fe][0]-ge[Ie][0])*(ge[Ie][1]+ge[fe][1]),ke=X+Pe;ee+=Math.abs(X)>=Math.abs(Pe)?X-ke+Pe:Pe-ke+X,X=ke}X+ee>=0!=!!W&&ge.reverse()}var R=f.bv(function ge(W,X){var ee,fe=W&&W.type;if(fe==="FeatureCollection")for(ee=0;ee<W.features.length;ee++)ge(W.features[ee],X);else if(fe==="GeometryCollection")for(ee=0;ee<W.geometries.length;ee++)ge(W.geometries[ee],X);else if(fe==="Feature")ge(W.geometry,X);else if(fe==="Polygon")P(W.coordinates,X);else if(fe==="MultiPolygon")for(ee=0;ee<W.coordinates.length;ee++)P(W.coordinates[ee],X);return W});const z=f.bq.VectorTileFeature.prototype.toGeoJSON;var B={exports:{}},N=f.bw,V=f.bq.VectorTileFeature,j=le;function le(ge,W){this.options=W||{},this.features=ge,this.length=ge.length}function oe(ge,W){this.id=typeof ge.id=="number"?ge.id:void 0,this.type=ge.type,this.rawGeometry=ge.type===1?[ge.geometry]:ge.geometry,this.properties=ge.tags,this.extent=W||4096}le.prototype.feature=function(ge){return new oe(this.features[ge],this.options.extent)},oe.prototype.loadGeometry=function(){var ge=this.rawGeometry;this.geometry=[];for(var W=0;W<ge.length;W++){for(var X=ge[W],ee=[],fe=0;fe<X.length;fe++)ee.push(new N(X[fe][0],X[fe][1]));this.geometry.push(ee)}return this.geometry},oe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ge=this.geometry,W=1/0,X=-1/0,ee=1/0,fe=-1/0,Me=0;Me<ge.length;Me++)for(var Ie=ge[Me],Pe=0;Pe<Ie.length;Pe++){var ke=Ie[Pe];W=Math.min(W,ke.x),X=Math.max(X,ke.x),ee=Math.min(ee,ke.y),fe=Math.max(fe,ke.y)}return[W,ee,X,fe]},oe.prototype.toGeoJSON=V.prototype.toGeoJSON;var $=f.bx,Y=j;function ve(ge){var W=new $;return function(X,ee){for(var fe in X.layers)ee.writeMessage(3,Be,X.layers[fe])}(ge,W),W.finish()}function Be(ge,W){var X;W.writeVarintField(15,ge.version||1),W.writeStringField(1,ge.name||""),W.writeVarintField(5,ge.extent||4096);var ee={keys:[],values:[],keycache:{},valuecache:{}};for(X=0;X<ge.length;X++)ee.feature=ge.feature(X),W.writeMessage(2,te,ee);var fe=ee.keys;for(X=0;X<fe.length;X++)W.writeStringField(3,fe[X]);var Me=ee.values;for(X=0;X<Me.length;X++)W.writeMessage(4,bt,Me[X])}function te(ge,W){var X=ge.feature;X.id!==void 0&&W.writeVarintField(1,X.id),W.writeMessage(2,ne,ge),W.writeVarintField(3,X.type),W.writeMessage(4,et,X)}function ne(ge,W){var X=ge.feature,ee=ge.keys,fe=ge.values,Me=ge.keycache,Ie=ge.valuecache;for(var Pe in X.properties){var ke=X.properties[Pe],G=Me[Pe];if(ke!==null){G===void 0&&(ee.push(Pe),Me[Pe]=G=ee.length-1),W.writeVarint(G);var Ue=typeof ke;Ue!=="string"&&Ue!=="boolean"&&Ue!=="number"&&(ke=JSON.stringify(ke));var Ze=Ue+":"+ke,We=Ie[Ze];We===void 0&&(fe.push(ke),Ie[Ze]=We=fe.length-1),W.writeVarint(We)}}}function qe(ge,W){return(W<<3)+(7&ge)}function Ce(ge){return ge<<1^ge>>31}function et(ge,W){for(var X=ge.loadGeometry(),ee=ge.type,fe=0,Me=0,Ie=X.length,Pe=0;Pe<Ie;Pe++){var ke=X[Pe],G=1;ee===1&&(G=ke.length),W.writeVarint(qe(1,G));for(var Ue=ee===3?ke.length-1:ke.length,Ze=0;Ze<Ue;Ze++){Ze===1&&ee!==1&&W.writeVarint(qe(2,Ue-1));var We=ke[Ze].x-fe,Je=ke[Ze].y-Me;W.writeVarint(Ce(We)),W.writeVarint(Ce(Je)),fe+=We,Me+=Je}ee===3&&W.writeVarint(qe(7,1))}}function bt(ge,W){var X=typeof ge;X==="string"?W.writeStringField(1,ge):X==="boolean"?W.writeBooleanField(7,ge):X==="number"&&(ge%1!=0?W.writeDoubleField(3,ge):ge<0?W.writeSVarintField(6,ge):W.writeVarintField(5,ge))}B.exports=ve,B.exports.fromVectorTileJs=ve,B.exports.fromGeojsonVt=function(ge,W){W=W||{};var X={};for(var ee in ge)X[ee]=new Y(ge[ee].features,W),X[ee].name=ee,X[ee].version=W.version,X[ee].extent=W.extent;return ve({layers:X})},B.exports.GeoJSONWrapper=Y;var ft=f.bv(B.exports);const ot={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ge=>ge},Zt=Math.fround||(ii=new Float32Array(1),ge=>(ii[0]=+ge,ii[0]));var ii;const Ft=3,Pt=5,Jt=6;class Mt{constructor(W){this.options=Object.assign(Object.create(ot),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:X,minZoom:ee,maxZoom:fe}=this.options;X&&console.time("total time");const Me=`prepare ${W.length} points`;X&&console.time(Me),this.points=W;const Ie=[];for(let ke=0;ke<W.length;ke++){const G=W[ke];if(!G.geometry)continue;const[Ue,Ze]=G.geometry.coordinates,We=Zt(hi(Ue)),Je=Zt(xi(Ze));Ie.push(We,Je,1/0,ke,-1,1),this.options.reduce&&Ie.push(0)}let Pe=this.trees[fe+1]=this._createTree(Ie);X&&console.timeEnd(Me);for(let ke=fe;ke>=ee;ke--){const G=+Date.now();Pe=this.trees[ke]=this._createTree(this._cluster(Pe,ke)),X&&console.log("z%d: %d clusters in %dms",ke,Pe.numItems,+Date.now()-G)}return X&&console.timeEnd("total time"),this}getClusters(W,X){let ee=((W[0]+180)%360+360)%360-180;const fe=Math.max(-90,Math.min(90,W[1]));let Me=W[2]===180?180:((W[2]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)ee=-180,Me=180;else if(ee>Me){const Ze=this.getClusters([ee,fe,180,Ie],X),We=this.getClusters([-180,fe,Me,Ie],X);return Ze.concat(We)}const Pe=this.trees[this._limitZoom(X)],ke=Pe.range(hi(ee),xi(Ie),hi(Me),xi(fe)),G=Pe.data,Ue=[];for(const Ze of ke){const We=this.stride*Ze;Ue.push(G[We+Pt]>1?ei(G,We,this.clusterProps):this.points[G[We+Ft]])}return Ue}getChildren(W){const X=this._getOriginId(W),ee=this._getOriginZoom(W),fe="No cluster with the specified id.",Me=this.trees[ee];if(!Me)throw new Error(fe);const Ie=Me.data;if(X*this.stride>=Ie.length)throw new Error(fe);const Pe=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),ke=Me.within(Ie[X*this.stride],Ie[X*this.stride+1],Pe),G=[];for(const Ue of ke){const Ze=Ue*this.stride;Ie[Ze+4]===W&&G.push(Ie[Ze+Pt]>1?ei(Ie,Ze,this.clusterProps):this.points[Ie[Ze+Ft]])}if(G.length===0)throw new Error(fe);return G}getLeaves(W,X,ee){const fe=[];return this._appendLeaves(fe,W,X=X||10,ee=ee||0,0),fe}getTile(W,X,ee){const fe=this.trees[this._limitZoom(W)],Me=Math.pow(2,W),{extent:Ie,radius:Pe}=this.options,ke=Pe/Ie,G=(ee-ke)/Me,Ue=(ee+1+ke)/Me,Ze={features:[]};return this._addTileFeatures(fe.range((X-ke)/Me,G,(X+1+ke)/Me,Ue),fe.data,X,ee,Me,Ze),X===0&&this._addTileFeatures(fe.range(1-ke/Me,G,1,Ue),fe.data,Me,ee,Me,Ze),X===Me-1&&this._addTileFeatures(fe.range(0,G,ke/Me,Ue),fe.data,-1,ee,Me,Ze),Ze.features.length?Ze:null}getClusterExpansionZoom(W){let X=this._getOriginZoom(W)-1;for(;X<=this.options.maxZoom;){const ee=this.getChildren(W);if(X++,ee.length!==1)break;W=ee[0].properties.cluster_id}return X}_appendLeaves(W,X,ee,fe,Me){const Ie=this.getChildren(X);for(const Pe of Ie){const ke=Pe.properties;if(ke&&ke.cluster?Me+ke.point_count<=fe?Me+=ke.point_count:Me=this._appendLeaves(W,ke.cluster_id,ee,fe,Me):Me<fe?Me++:W.push(Pe),W.length===ee)break}return Me}_createTree(W){const X=new f.au(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ee=0;ee<W.length;ee+=this.stride)X.add(W[ee],W[ee+1]);return X.finish(),X.data=W,X}_addTileFeatures(W,X,ee,fe,Me,Ie){for(const Pe of W){const ke=Pe*this.stride,G=X[ke+Pt]>1;let Ue,Ze,We;if(G)Ue=Vt(X,ke,this.clusterProps),Ze=X[ke],We=X[ke+1];else{const Rt=this.points[X[ke+Ft]];Ue=Rt.properties;const[Xt,ai]=Rt.geometry.coordinates;Ze=hi(Xt),We=xi(ai)}const Je={type:1,geometry:[[Math.round(this.options.extent*(Ze*Me-ee)),Math.round(this.options.extent*(We*Me-fe))]],tags:Ue};let ht;ht=G||this.options.generateId?X[ke+Ft]:this.points[X[ke+Ft]].id,ht!==void 0&&(Je.id=ht),Ie.features.push(Je)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,X){const{radius:ee,extent:fe,reduce:Me,minPoints:Ie}=this.options,Pe=ee/(fe*Math.pow(2,X)),ke=W.data,G=[],Ue=this.stride;for(let Ze=0;Ze<ke.length;Ze+=Ue){if(ke[Ze+2]<=X)continue;ke[Ze+2]=X;const We=ke[Ze],Je=ke[Ze+1],ht=W.within(ke[Ze],ke[Ze+1],Pe),Rt=ke[Ze+Pt];let Xt=Rt;for(const ai of ht){const vi=ai*Ue;ke[vi+2]>X&&(Xt+=ke[vi+Pt])}if(Xt>Rt&&Xt>=Ie){let ai,vi=We*Rt,Ji=Je*Rt,Mn=-1;const li=((Ze/Ue|0)<<5)+(X+1)+this.points.length;for(const un of ht){const Fn=un*Ue;if(ke[Fn+2]<=X)continue;ke[Fn+2]=X;const ur=ke[Fn+Pt];vi+=ke[Fn]*ur,Ji+=ke[Fn+1]*ur,ke[Fn+4]=li,Me&&(ai||(ai=this._map(ke,Ze,!0),Mn=this.clusterProps.length,this.clusterProps.push(ai)),Me(ai,this._map(ke,Fn)))}ke[Ze+4]=li,G.push(vi/Xt,Ji/Xt,1/0,li,-1,Xt),Me&&G.push(Mn)}else{for(let ai=0;ai<Ue;ai++)G.push(ke[Ze+ai]);if(Xt>1)for(const ai of ht){const vi=ai*Ue;if(!(ke[vi+2]<=X)){ke[vi+2]=X;for(let Ji=0;Ji<Ue;Ji++)G.push(ke[vi+Ji])}}}}return G}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,X,ee){if(W[X+Pt]>1){const Ie=this.clusterProps[W[X+Jt]];return ee?Object.assign({},Ie):Ie}const fe=this.points[W[X+Ft]].properties,Me=this.options.map(fe);return ee&&Me===fe?Object.assign({},Me):Me}}function ei(ge,W,X){return{type:"Feature",id:ge[W+Ft],properties:Vt(ge,W,X),geometry:{type:"Point",coordinates:[(ee=ge[W],360*(ee-.5)),gi(ge[W+1])]}};var ee}function Vt(ge,W,X){const ee=ge[W+Pt],fe=ee>=1e4?`${Math.round(ee/1e3)}k`:ee>=1e3?Math.round(ee/100)/10+"k":ee,Me=ge[W+Jt],Ie=Me===-1?{}:Object.assign({},X[Me]);return Object.assign(Ie,{cluster:!0,cluster_id:ge[W+Ft],point_count:ee,point_count_abbreviated:fe})}function hi(ge){return ge/360+.5}function xi(ge){const W=Math.sin(ge*Math.PI/180),X=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return X<0?0:X>1?1:X}function gi(ge){const W=(180-360*ge)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function Ai(ge,W,X,ee){for(var fe,Me=ee,Ie=X-W>>1,Pe=X-W,ke=ge[W],G=ge[W+1],Ue=ge[X],Ze=ge[X+1],We=W+3;We<X;We+=3){var Je=ct(ge[We],ge[We+1],ke,G,Ue,Ze);if(Je>Me)fe=We,Me=Je;else if(Je===Me){var ht=Math.abs(We-Ie);ht<Pe&&(fe=We,Pe=ht)}}Me>ee&&(fe-W>3&&Ai(ge,W,fe,ee),ge[fe+2]=Me,X-fe>3&&Ai(ge,fe,X,ee))}function ct(ge,W,X,ee,fe,Me){var Ie=fe-X,Pe=Me-ee;if(Ie!==0||Pe!==0){var ke=((ge-X)*Ie+(W-ee)*Pe)/(Ie*Ie+Pe*Pe);ke>1?(X=fe,ee=Me):ke>0&&(X+=Ie*ke,ee+=Pe*ke)}return(Ie=ge-X)*Ie+(Pe=W-ee)*Pe}function It(ge,W,X,ee){var fe={id:ge===void 0?null:ge,type:W,geometry:X,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Me){var Ie=Me.geometry,Pe=Me.type;if(Pe==="Point"||Pe==="MultiPoint"||Pe==="LineString")Ne(Me,Ie);else if(Pe==="Polygon"||Pe==="MultiLineString")for(var ke=0;ke<Ie.length;ke++)Ne(Me,Ie[ke]);else if(Pe==="MultiPolygon")for(ke=0;ke<Ie.length;ke++)for(var G=0;G<Ie[ke].length;G++)Ne(Me,Ie[ke][G])}(fe),fe}function Ne(ge,W){for(var X=0;X<W.length;X+=3)ge.minX=Math.min(ge.minX,W[X]),ge.minY=Math.min(ge.minY,W[X+1]),ge.maxX=Math.max(ge.maxX,W[X]),ge.maxY=Math.max(ge.maxY,W[X+1])}function je(ge,W,X,ee){if(W.geometry){var fe=W.geometry.coordinates,Me=W.geometry.type,Ie=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2),Pe=[],ke=W.id;if(X.promoteId?ke=W.properties[X.promoteId]:X.generateId&&(ke=ee||0),Me==="Point")rt(fe,Pe);else if(Me==="MultiPoint")for(var G=0;G<fe.length;G++)rt(fe[G],Pe);else if(Me==="LineString")xt(fe,Pe,Ie,!1);else if(Me==="MultiLineString"){if(X.lineMetrics){for(G=0;G<fe.length;G++)xt(fe[G],Pe=[],Ie,!1),ge.push(It(ke,"LineString",Pe,W.properties));return}we(fe,Pe,Ie,!1)}else if(Me==="Polygon")we(fe,Pe,Ie,!0);else{if(Me!=="MultiPolygon"){if(Me==="GeometryCollection"){for(G=0;G<W.geometry.geometries.length;G++)je(ge,{id:ke,geometry:W.geometry.geometries[G],properties:W.properties},X,ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(G=0;G<fe.length;G++){var Ue=[];we(fe[G],Ue,Ie,!0),Pe.push(Ue)}}ge.push(It(ke,Me,Pe,W.properties))}}function rt(ge,W){W.push(di(ge[0])),W.push(Ve(ge[1])),W.push(0)}function xt(ge,W,X,ee){for(var fe,Me,Ie=0,Pe=0;Pe<ge.length;Pe++){var ke=di(ge[Pe][0]),G=Ve(ge[Pe][1]);W.push(ke),W.push(G),W.push(0),Pe>0&&(Ie+=ee?(fe*G-ke*Me)/2:Math.sqrt(Math.pow(ke-fe,2)+Math.pow(G-Me,2))),fe=ke,Me=G}var Ue=W.length-3;W[2]=1,Ai(W,0,Ue,X),W[Ue+2]=1,W.size=Math.abs(Ie),W.start=0,W.end=W.size}function we(ge,W,X,ee){for(var fe=0;fe<ge.length;fe++){var Me=[];xt(ge[fe],Me,X,ee),W.push(Me)}}function di(ge){return ge/360+.5}function Ve(ge){var W=Math.sin(ge*Math.PI/180),X=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return X<0?0:X>1?1:X}function $e(ge,W,X,ee,fe,Me,Ie,Pe){if(ee/=W,Me>=(X/=W)&&Ie<ee)return ge;if(Ie<X||Me>=ee)return null;for(var ke=[],G=0;G<ge.length;G++){var Ue=ge[G],Ze=Ue.geometry,We=Ue.type,Je=fe===0?Ue.minX:Ue.minY,ht=fe===0?Ue.maxX:Ue.maxY;if(Je>=X&&ht<ee)ke.push(Ue);else if(!(ht<X||Je>=ee)){var Rt=[];if(We==="Point"||We==="MultiPoint")kt(Ze,Rt,X,ee,fe);else if(We==="LineString")bn(Ze,Rt,X,ee,fe,!1,Pe.lineMetrics);else if(We==="MultiLineString")Cn(Ze,Rt,X,ee,fe,!1);else if(We==="Polygon")Cn(Ze,Rt,X,ee,fe,!0);else if(We==="MultiPolygon")for(var Xt=0;Xt<Ze.length;Xt++){var ai=[];Cn(Ze[Xt],ai,X,ee,fe,!0),ai.length&&Rt.push(ai)}if(Rt.length){if(Pe.lineMetrics&&We==="LineString"){for(Xt=0;Xt<Rt.length;Xt++)ke.push(It(Ue.id,We,Rt[Xt],Ue.tags));continue}We!=="LineString"&&We!=="MultiLineString"||(Rt.length===1?(We="LineString",Rt=Rt[0]):We="MultiLineString"),We!=="Point"&&We!=="MultiPoint"||(We=Rt.length===3?"Point":"MultiPoint"),ke.push(It(Ue.id,We,Rt,Ue.tags))}}}return ke.length?ke:null}function kt(ge,W,X,ee,fe){for(var Me=0;Me<ge.length;Me+=3){var Ie=ge[Me+fe];Ie>=X&&Ie<=ee&&(W.push(ge[Me]),W.push(ge[Me+1]),W.push(ge[Me+2]))}}function bn(ge,W,X,ee,fe,Me,Ie){for(var Pe,ke,G=wn(ge),Ue=fe===0?ir:Uo,Ze=ge.start,We=0;We<ge.length-3;We+=3){var Je=ge[We],ht=ge[We+1],Rt=ge[We+2],Xt=ge[We+3],ai=ge[We+4],vi=fe===0?Je:ht,Ji=fe===0?Xt:ai,Mn=!1;Ie&&(Pe=Math.sqrt(Math.pow(Je-Xt,2)+Math.pow(ht-ai,2))),vi<X?Ji>X&&(ke=Ue(G,Je,ht,Xt,ai,X),Ie&&(G.start=Ze+Pe*ke)):vi>ee?Ji<ee&&(ke=Ue(G,Je,ht,Xt,ai,ee),Ie&&(G.start=Ze+Pe*ke)):tr(G,Je,ht,Rt),Ji<X&&vi>=X&&(ke=Ue(G,Je,ht,Xt,ai,X),Mn=!0),Ji>ee&&vi<=ee&&(ke=Ue(G,Je,ht,Xt,ai,ee),Mn=!0),!Me&&Mn&&(Ie&&(G.end=Ze+Pe*ke),W.push(G),G=wn(ge)),Ie&&(Ze+=Pe)}var li=ge.length-3;Je=ge[li],ht=ge[li+1],Rt=ge[li+2],(vi=fe===0?Je:ht)>=X&&vi<=ee&&tr(G,Je,ht,Rt),li=G.length-3,Me&&li>=3&&(G[li]!==G[0]||G[li+1]!==G[1])&&tr(G,G[0],G[1],G[2]),G.length&&W.push(G)}function wn(ge){var W=[];return W.size=ge.size,W.start=ge.start,W.end=ge.end,W}function Cn(ge,W,X,ee,fe,Me){for(var Ie=0;Ie<ge.length;Ie++)bn(ge[Ie],W,X,ee,fe,Me,!1)}function tr(ge,W,X,ee){ge.push(W),ge.push(X),ge.push(ee)}function ir(ge,W,X,ee,fe,Me){var Ie=(Me-W)/(ee-W);return ge.push(Me),ge.push(X+(fe-X)*Ie),ge.push(1),Ie}function Uo(ge,W,X,ee,fe,Me){var Ie=(Me-X)/(fe-X);return ge.push(W+(ee-W)*Ie),ge.push(Me),ge.push(1),Ie}function Ki(ge,W){for(var X=[],ee=0;ee<ge.length;ee++){var fe,Me=ge[ee],Ie=Me.type;if(Ie==="Point"||Ie==="MultiPoint"||Ie==="LineString")fe=ut(Me.geometry,W);else if(Ie==="MultiLineString"||Ie==="Polygon"){fe=[];for(var Pe=0;Pe<Me.geometry.length;Pe++)fe.push(ut(Me.geometry[Pe],W))}else if(Ie==="MultiPolygon")for(fe=[],Pe=0;Pe<Me.geometry.length;Pe++){for(var ke=[],G=0;G<Me.geometry[Pe].length;G++)ke.push(ut(Me.geometry[Pe][G],W));fe.push(ke)}X.push(It(Me.id,Ie,fe,Me.tags))}return X}function ut(ge,W){var X=[];X.size=ge.size,ge.start!==void 0&&(X.start=ge.start,X.end=ge.end);for(var ee=0;ee<ge.length;ee+=3)X.push(ge[ee]+W,ge[ee+1],ge[ee+2]);return X}function $n(ge,W){if(ge.transformed)return ge;var X,ee,fe,Me=1<<ge.z,Ie=ge.x,Pe=ge.y;for(X=0;X<ge.features.length;X++){var ke=ge.features[X],G=ke.geometry,Ue=ke.type;if(ke.geometry=[],Ue===1)for(ee=0;ee<G.length;ee+=2)ke.geometry.push(xn(G[ee],G[ee+1],W,Me,Ie,Pe));else for(ee=0;ee<G.length;ee++){var Ze=[];for(fe=0;fe<G[ee].length;fe+=2)Ze.push(xn(G[ee][fe],G[ee][fe+1],W,Me,Ie,Pe));ke.geometry.push(Ze)}}return ge.transformed=!0,ge}function xn(ge,W,X,ee,fe,Me){return[Math.round(X*(ge*ee-fe)),Math.round(X*(W*ee-Me))]}function Lo(ge,W,X,ee,fe){for(var Me=W===fe.maxZoom?0:fe.tolerance/((1<<W)*fe.extent),Ie={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:X,y:ee,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Pe=0;Pe<ge.length;Pe++){Ie.numFeatures++,Vi(Ie,ge[Pe],Me,fe);var ke=ge[Pe].minX,G=ge[Pe].minY,Ue=ge[Pe].maxX,Ze=ge[Pe].maxY;ke<Ie.minX&&(Ie.minX=ke),G<Ie.minY&&(Ie.minY=G),Ue>Ie.maxX&&(Ie.maxX=Ue),Ze>Ie.maxY&&(Ie.maxY=Ze)}return Ie}function Vi(ge,W,X,ee){var fe=W.geometry,Me=W.type,Ie=[];if(Me==="Point"||Me==="MultiPoint")for(var Pe=0;Pe<fe.length;Pe+=3)Ie.push(fe[Pe]),Ie.push(fe[Pe+1]),ge.numPoints++,ge.numSimplified++;else if(Me==="LineString")gt(Ie,fe,ge,X,!1,!1);else if(Me==="MultiLineString"||Me==="Polygon")for(Pe=0;Pe<fe.length;Pe++)gt(Ie,fe[Pe],ge,X,Me==="Polygon",Pe===0);else if(Me==="MultiPolygon")for(var ke=0;ke<fe.length;ke++){var G=fe[ke];for(Pe=0;Pe<G.length;Pe++)gt(Ie,G[Pe],ge,X,!0,Pe===0)}if(Ie.length){var Ue=W.tags||null;if(Me==="LineString"&&ee.lineMetrics){for(var Ze in Ue={},W.tags)Ue[Ze]=W.tags[Ze];Ue.mapbox_clip_start=fe.start/fe.size,Ue.mapbox_clip_end=fe.end/fe.size}var We={geometry:Ie,type:Me==="Polygon"||Me==="MultiPolygon"?3:Me==="LineString"||Me==="MultiLineString"?2:1,tags:Ue};W.id!==null&&(We.id=W.id),ge.features.push(We)}}function gt(ge,W,X,ee,fe,Me){var Ie=ee*ee;if(ee>0&&W.size<(fe?Ie:ee))X.numPoints+=W.length/3;else{for(var Pe=[],ke=0;ke<W.length;ke+=3)(ee===0||W[ke+2]>Ie)&&(X.numSimplified++,Pe.push(W[ke]),Pe.push(W[ke+1])),X.numPoints++;fe&&function(G,Ue){for(var Ze=0,We=0,Je=G.length,ht=Je-2;We<Je;ht=We,We+=2)Ze+=(G[We]-G[ht])*(G[We+1]+G[ht+1]);if(Ze>0===Ue)for(We=0,Je=G.length;We<Je/2;We+=2){var Rt=G[We],Xt=G[We+1];G[We]=G[Je-2-We],G[We+1]=G[Je-1-We],G[Je-2-We]=Rt,G[Je-1-We]=Xt}}(Pe,Me),ge.push(Pe)}}function ni(ge,W){var X=(W=this.options=function(fe,Me){for(var Ie in Me)fe[Ie]=Me[Ie];return fe}(Object.create(this.options),W)).debug;if(X&&console.time("preprocess data"),W.maxZoom<0||W.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(W.promoteId&&W.generateId)throw new Error("promoteId and generateId cannot be used together.");var ee=function(fe,Me){var Ie=[];if(fe.type==="FeatureCollection")for(var Pe=0;Pe<fe.features.length;Pe++)je(Ie,fe.features[Pe],Me,Pe);else je(Ie,fe.type==="Feature"?fe:{geometry:fe},Me);return Ie}(ge,W);this.tiles={},this.tileCoords=[],X&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",W.indexMaxZoom,W.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ee=function(fe,Me){var Ie=Me.buffer/Me.extent,Pe=fe,ke=$e(fe,1,-1-Ie,Ie,0,-1,2,Me),G=$e(fe,1,1-Ie,2+Ie,0,-1,2,Me);return(ke||G)&&(Pe=$e(fe,1,-Ie,1+Ie,0,-1,2,Me)||[],ke&&(Pe=Ki(ke,1).concat(Pe)),G&&(Pe=Pe.concat(Ki(G,-1)))),Pe}(ee,W),ee.length&&this.splitTile(ee,0,0,0),X&&(ee.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Yt(ge,W,X){return 32*((1<<ge)*X+W)+ge}function qi(ge,W){return W?ge.properties[W]:ge.id}function yr(ge,W){if(ge==null)return!0;if(ge.type==="Feature")return qi(ge,W)!=null;if(ge.type==="FeatureCollection"){const X=new Set;for(const ee of ge.features){const fe=qi(ee,W);if(fe==null||X.has(fe))return!1;X.add(fe)}return!0}return!1}function ti(ge,W){const X=new Map;if(ge!=null)if(ge.type==="Feature")X.set(qi(ge,W),ge);else for(const ee of ge.features)X.set(qi(ee,W),ee);return X}ni.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ni.prototype.splitTile=function(ge,W,X,ee,fe,Me,Ie){for(var Pe=[ge,W,X,ee],ke=this.options,G=ke.debug;Pe.length;){ee=Pe.pop(),X=Pe.pop(),W=Pe.pop(),ge=Pe.pop();var Ue=1<<W,Ze=Yt(W,X,ee),We=this.tiles[Ze];if(!We&&(G>1&&console.time("creation"),We=this.tiles[Ze]=Lo(ge,W,X,ee,ke),this.tileCoords.push({z:W,x:X,y:ee}),G)){G>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",W,X,ee,We.numFeatures,We.numPoints,We.numSimplified),console.timeEnd("creation"));var Je="z"+W;this.stats[Je]=(this.stats[Je]||0)+1,this.total++}if(We.source=ge,fe){if(W===ke.maxZoom||W===fe)continue;var ht=1<<fe-W;if(X!==Math.floor(Me/ht)||ee!==Math.floor(Ie/ht))continue}else if(W===ke.indexMaxZoom||We.numPoints<=ke.indexMaxPoints)continue;if(We.source=null,ge.length!==0){G>1&&console.time("clipping");var Rt,Xt,ai,vi,Ji,Mn,li=.5*ke.buffer/ke.extent,un=.5-li,Fn=.5+li,ur=1+li;Rt=Xt=ai=vi=null,Ji=$e(ge,Ue,X-li,X+Fn,0,We.minX,We.maxX,ke),Mn=$e(ge,Ue,X+un,X+ur,0,We.minX,We.maxX,ke),ge=null,Ji&&(Rt=$e(Ji,Ue,ee-li,ee+Fn,1,We.minY,We.maxY,ke),Xt=$e(Ji,Ue,ee+un,ee+ur,1,We.minY,We.maxY,ke),Ji=null),Mn&&(ai=$e(Mn,Ue,ee-li,ee+Fn,1,We.minY,We.maxY,ke),vi=$e(Mn,Ue,ee+un,ee+ur,1,We.minY,We.maxY,ke),Mn=null),G>1&&console.timeEnd("clipping"),Pe.push(Rt||[],W+1,2*X,2*ee),Pe.push(Xt||[],W+1,2*X,2*ee+1),Pe.push(ai||[],W+1,2*X+1,2*ee),Pe.push(vi||[],W+1,2*X+1,2*ee+1)}}},ni.prototype.getTile=function(ge,W,X){var ee=this.options,fe=ee.extent,Me=ee.debug;if(ge<0||ge>24)return null;var Ie=1<<ge,Pe=Yt(ge,W=(W%Ie+Ie)%Ie,X);if(this.tiles[Pe])return $n(this.tiles[Pe],fe);Me>1&&console.log("drilling down to z%d-%d-%d",ge,W,X);for(var ke,G=ge,Ue=W,Ze=X;!ke&&G>0;)G--,Ue=Math.floor(Ue/2),Ze=Math.floor(Ze/2),ke=this.tiles[Yt(G,Ue,Ze)];return ke&&ke.source?(Me>1&&console.log("found parent tile z%d-%d-%d",G,Ue,Ze),Me>1&&console.time("drilling down"),this.splitTile(ke.source,G,Ue,Ze,ge,W,X),Me>1&&console.timeEnd("drilling down"),this.tiles[Pe]?$n(this.tiles[Pe],fe):null):null};class eo extends k{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(W,X){return f._(this,void 0,void 0,function*(){const ee=W.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const fe=this._geoJSONIndex.getTile(ee.z,ee.x,ee.y);if(!fe)return null;const Me=new class{constructor(Pe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=f.W,this.length=Pe.length,this._features=Pe}feature(Pe){return new class{constructor(ke){this._feature=ke,this.extent=f.W,this.type=ke.type,this.properties=ke.tags,"id"in ke&&!isNaN(ke.id)&&(this.id=parseInt(ke.id,10))}loadGeometry(){if(this._feature.type===1){const ke=[];for(const G of this._feature.geometry)ke.push([new f.P(G[0],G[1])]);return ke}{const ke=[];for(const G of this._feature.geometry){const Ue=[];for(const Ze of G)Ue.push(new f.P(Ze[0],Ze[1]));ke.push(Ue)}return ke}}toGeoJSON(ke,G,Ue){return z.call(this,ke,G,Ue)}}(this._features[Pe])}}(fe.features);let Ie=ft(Me);return Ie.byteOffset===0&&Ie.byteLength===Ie.buffer.byteLength||(Ie=new Uint8Array(Ie)),{vectorTile:Me,rawData:Ie.buffer}})}loadData(W){return f._(this,void 0,void 0,function*(){var X;(X=this._pendingRequest)===null||X===void 0||X.abort();const ee=!!(W&&W.request&&W.request.collectResourceTiming)&&new f.bs(W.request);this._pendingRequest=new AbortController;try{let fe=yield this.loadGeoJSON(W,this._pendingRequest);if(delete this._pendingRequest,typeof fe!="object")throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(R(fe,!0),W.filter){const Ie=f.by(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ie.result==="error")throw new Error(Ie.value.map(ke=>`${ke.key}: ${ke.message}`).join(", "));fe={type:"FeatureCollection",features:fe.features.filter(ke=>Ie.value.evaluate({zoom:0},ke))}}this._geoJSONIndex=W.cluster?new Mt(function({superclusterOptions:Ie,clusterProperties:Pe}){if(!Pe||!Ie)return Ie;const ke={},G={},Ue={accumulated:null,zoom:0},Ze={properties:null},We=Object.keys(Pe);for(const Je of We){const[ht,Rt]=Pe[Je],Xt=f.by(Rt),ai=f.by(typeof ht=="string"?[ht,["accumulated"],["get",Je]]:ht);ke[Je]=Xt.value,G[Je]=ai.value}return Ie.map=Je=>{Ze.properties=Je;const ht={};for(const Rt of We)ht[Rt]=ke[Rt].evaluate(Ue,Ze);return ht},Ie.reduce=(Je,ht)=>{Ze.properties=ht;for(const Rt of We)Ue.accumulated=Je[Rt],Je[Rt]=G[Rt].evaluate(Ue,Ze)},Ie}(W)).load(fe.features):function(Ie,Pe){return new ni(Ie,Pe)}(fe,W.geojsonVtOptions),this.loaded={};const Me={};if(ee){const Ie=ee.finish();Ie&&(Me.resourceTiming={},Me.resourceTiming[W.source]=JSON.parse(JSON.stringify(Ie)))}return Me}catch(fe){if(delete this._pendingRequest,f.bz(fe))return{abandoned:!0};throw fe}})}reloadTile(W){const X=this.loaded;return X&&X[W.uid]?super.reloadTile(W):this.loadTile(W)}loadGeoJSON(W,X){return f._(this,void 0,void 0,function*(){const{promoteId:ee}=W;if(W.request){const fe=yield f.h(W.request,X);return this._dataUpdateable=yr(fe.data,ee)?ti(fe.data,ee):void 0,fe.data}if(typeof W.data=="string")try{const fe=JSON.parse(W.data);return this._dataUpdateable=yr(fe,ee)?ti(fe,ee):void 0,fe}catch{throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`)}if(!W.dataDiff)throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${W.source}`);return function(fe,Me,Ie){var Pe,ke,G,Ue;if(Me.removeAll&&fe.clear(),Me.remove)for(const Ze of Me.remove)fe.delete(Ze);if(Me.add)for(const Ze of Me.add){const We=qi(Ze,Ie);We!=null&&fe.set(We,Ze)}if(Me.update)for(const Ze of Me.update){let We=fe.get(Ze.id);if(We==null)continue;const Je=!Ze.removeAllProperties&&(((Pe=Ze.removeProperties)===null||Pe===void 0?void 0:Pe.length)>0||((ke=Ze.addOrUpdateProperties)===null||ke===void 0?void 0:ke.length)>0);if((Ze.newGeometry||Ze.removeAllProperties||Je)&&(We=Object.assign({},We),fe.set(Ze.id,We),Je&&(We.properties=Object.assign({},We.properties))),Ze.newGeometry&&(We.geometry=Ze.newGeometry),Ze.removeAllProperties)We.properties={};else if(((G=Ze.removeProperties)===null||G===void 0?void 0:G.length)>0)for(const ht of Ze.removeProperties)Object.prototype.hasOwnProperty.call(We.properties,ht)&&delete We.properties[ht];if(((Ue=Ze.addOrUpdateProperties)===null||Ue===void 0?void 0:Ue.length)>0)for(const{key:ht,value:Rt}of Ze.addOrUpdateProperties)We.properties[ht]=Rt}}(this._dataUpdateable,W.dataDiff,ee),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(W){return f._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(W){return this._geoJSONIndex.getClusterExpansionZoom(W.clusterId)}getClusterChildren(W){return this._geoJSONIndex.getChildren(W.clusterId)}getClusterLeaves(W){return this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset)}}class cn{constructor(W){this.self=W,this.actor=new f.C(W),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(X,ee)=>{if(this.externalWorkerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.externalWorkerSourceTypes[X]=ee},this.self.addProtocol=f.bf,this.self.removeProtocol=f.bg,this.self.registerRTLTextPlugin=X=>{if(f.bA.isParsed())throw new Error("RTL text plugin already registered.");f.bA.setMethods(X)},this.actor.registerMessageHandler("LDT",(X,ee)=>this._getDEMWorkerSource(X,ee.source).loadTile(ee)),this.actor.registerMessageHandler("RDT",(X,ee)=>f._(this,void 0,void 0,function*(){this._getDEMWorkerSource(X,ee.source).removeTile(ee)})),this.actor.registerMessageHandler("GCEZ",(X,ee)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(X,ee.type,ee.source).getClusterExpansionZoom(ee)})),this.actor.registerMessageHandler("GCC",(X,ee)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(X,ee.type,ee.source).getClusterChildren(ee)})),this.actor.registerMessageHandler("GCL",(X,ee)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(X,ee.type,ee.source).getClusterLeaves(ee)})),this.actor.registerMessageHandler("LD",(X,ee)=>this._getWorkerSource(X,ee.type,ee.source).loadData(ee)),this.actor.registerMessageHandler("LT",(X,ee)=>this._getWorkerSource(X,ee.type,ee.source).loadTile(ee)),this.actor.registerMessageHandler("RT",(X,ee)=>this._getWorkerSource(X,ee.type,ee.source).reloadTile(ee)),this.actor.registerMessageHandler("AT",(X,ee)=>this._getWorkerSource(X,ee.type,ee.source).abortTile(ee)),this.actor.registerMessageHandler("RMT",(X,ee)=>this._getWorkerSource(X,ee.type,ee.source).removeTile(ee)),this.actor.registerMessageHandler("RS",(X,ee)=>f._(this,void 0,void 0,function*(){if(!this.workerSources[X]||!this.workerSources[X][ee.type]||!this.workerSources[X][ee.type][ee.source])return;const fe=this.workerSources[X][ee.type][ee.source];delete this.workerSources[X][ee.type][ee.source],fe.removeSource!==void 0&&fe.removeSource(ee)})),this.actor.registerMessageHandler("RM",X=>f._(this,void 0,void 0,function*(){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X]})),this.actor.registerMessageHandler("SR",(X,ee)=>f._(this,void 0,void 0,function*(){this.referrer=ee})),this.actor.registerMessageHandler("SRPS",(X,ee)=>this._syncRTLPluginState(X,ee)),this.actor.registerMessageHandler("IS",(X,ee)=>f._(this,void 0,void 0,function*(){this.self.importScripts(ee)})),this.actor.registerMessageHandler("SI",(X,ee)=>this._setImages(X,ee)),this.actor.registerMessageHandler("UL",(X,ee)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(X).update(ee.layers,ee.removedIds)})),this.actor.registerMessageHandler("SL",(X,ee)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(X).replace(ee)}))}_setImages(W,X){return f._(this,void 0,void 0,function*(){this.availableImages[W]=X;for(const ee in this.workerSources[W]){const fe=this.workerSources[W][ee];for(const Me in fe)fe[Me].availableImages=X}})}_syncRTLPluginState(W,X){return f._(this,void 0,void 0,function*(){if(f.bA.isParsed())return f.bA.getState();if(X.pluginStatus!=="loading")return f.bA.setState(X),X;const ee=X.pluginURL;if(this.self.importScripts(ee),f.bA.isParsed()){const fe={pluginStatus:"loaded",pluginURL:ee};return f.bA.setState(fe),fe}throw f.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ee}`)})}_getAvailableImages(W){let X=this.availableImages[W];return X||(X=[]),X}_getLayerIndex(W){let X=this.layerIndexes[W];return X||(X=this.layerIndexes[W]=new a),X}_getWorkerSource(W,X,ee){if(this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][X]||(this.workerSources[W][X]={}),!this.workerSources[W][X][ee]){const fe={sendAsync:(Me,Ie)=>(Me.targetMapId=W,this.actor.sendAsync(Me,Ie))};switch(X){case"vector":this.workerSources[W][X][ee]=new k(fe,this._getLayerIndex(W),this._getAvailableImages(W));break;case"geojson":this.workerSources[W][X][ee]=new eo(fe,this._getLayerIndex(W),this._getAvailableImages(W));break;default:this.workerSources[W][X][ee]=new this.externalWorkerSourceTypes[X](fe,this._getLayerIndex(W),this._getAvailableImages(W))}}return this.workerSources[W][X][ee]}_getDEMWorkerSource(W,X){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][X]||(this.demWorkerSources[W][X]=new I),this.demWorkerSources[W][X]}}return f.i(self)&&(self.worker=new cn(self)),cn}),c("index",["exports","./shared"],function(f,a){var _="4.1.3";let x,S;const k={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:y=>new Promise((r,h)=>{const p=requestAnimationFrame(r);y.signal.addEventListener("abort",()=>{cancelAnimationFrame(p),h(a.c())})}),getImageData(y,r=0){return this.getImageCanvasContext(y).getImageData(-r,-r,y.width+2*r,y.height+2*r)},getImageCanvasContext(y){const r=window.document.createElement("canvas"),h=r.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return r.width=y.width,r.height=y.height,h.drawImage(y,0,0,y.width,y.height),h},resolveURL:y=>(x||(x=document.createElement("a")),x.href=y,x.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(S==null&&(S=matchMedia("(prefers-reduced-motion: reduce)")),S.matches)}};class I{static testProp(r){if(!I.docStyle)return r[0];for(let h=0;h<r.length;h++)if(r[h]in I.docStyle)return r[h];return r[0]}static create(r,h,p){const m=window.document.createElement(r);return h!==void 0&&(m.className=h),p&&p.appendChild(m),m}static createNS(r,h){return window.document.createElementNS(r,h)}static disableDrag(){I.docStyle&&I.selectProp&&(I.userSelect=I.docStyle[I.selectProp],I.docStyle[I.selectProp]="none")}static enableDrag(){I.docStyle&&I.selectProp&&(I.docStyle[I.selectProp]=I.userSelect)}static setTransform(r,h){r.style[I.transformProp]=h}static addEventListener(r,h,p,m={}){r.addEventListener(h,p,"passive"in m?m:m.capture)}static removeEventListener(r,h,p,m={}){r.removeEventListener(h,p,"passive"in m?m:m.capture)}static suppressClickInternal(r){r.preventDefault(),r.stopPropagation(),window.removeEventListener("click",I.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",I.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",I.suppressClickInternal,!0)},0)}static getScale(r){const h=r.getBoundingClientRect();return{x:h.width/r.offsetWidth||1,y:h.height/r.offsetHeight||1,boundingClientRect:h}}static getPoint(r,h,p){const m=h.boundingClientRect;return new a.P((p.clientX-m.left)/h.x-r.clientLeft,(p.clientY-m.top)/h.y-r.clientTop)}static mousePos(r,h){const p=I.getScale(r);return I.getPoint(r,p,h)}static touchPos(r,h){const p=[],m=I.getScale(r);for(let v=0;v<h.length;v++)p.push(I.getPoint(r,m,h[v]));return p}static mouseButton(r){return r.button}static remove(r){r.parentNode&&r.parentNode.removeChild(r)}}I.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,I.selectProp=I.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),I.transformProp=I.testProp(["transform","WebkitTransform"]);const P={supported:!1,testSupport:function(y){!z&&R&&(B?N(y):D=y)}};let D,R,z=!1,B=!1;function N(y){const r=y.createTexture();y.bindTexture(y.TEXTURE_2D,r);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,R),y.isContextLost())return;P.supported=!0}catch{}y.deleteTexture(r),z=!0}var V;typeof document<"u"&&(R=document.createElement("img"),R.onload=function(){D&&N(D),D=null,B=!0},R.onerror=function(){z=!0,D=null},R.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let r,h,p,m;y.resetRequestQueue=()=>{r=[],h=0,p=0,m={}},y.addThrottleControl=L=>{const F=p++;return m[F]=L,F},y.removeThrottleControl=L=>{delete m[L],E()},y.getImage=(L,F,q=!0)=>new Promise((Z,J)=>{P.supported&&(L.headers||(L.headers={}),L.headers.accept="image/webp,*/*"),a.e(L,{type:"image"}),r.push({abortController:F,requestParameters:L,supportImageRefresh:q,state:"queued",onError:me=>{J(me)},onSuccess:me=>{Z(me)}}),E()});const v=L=>a._(this,void 0,void 0,function*(){L.state="running";const{requestParameters:F,supportImageRefresh:q,onError:Z,onSuccess:J,abortController:me}=L,pe=q===!1&&!a.i(self)&&!a.g(F.url)&&(!F.headers||Object.keys(F.headers).reduce((Ee,Ge)=>Ee&&Ge==="accept",!0));h++;const ye=pe?C(F,me):a.m(F,me);try{const Ee=yield ye;delete L.abortController,L.state="completed",Ee.data instanceof HTMLImageElement||a.b(Ee.data)?J(Ee):Ee.data&&J({data:yield(se=Ee.data,typeof createImageBitmap=="function"?a.d(se):a.f(se)),cacheControl:Ee.cacheControl,expires:Ee.expires})}catch(Ee){delete L.abortController,Z(Ee)}finally{h--,E()}var se}),E=()=>{const L=(()=>{for(const F of Object.keys(m))if(m[F]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let F=h;F<L&&r.length>0;F++){const q=r.shift();q.abortController.signal.aborted?F--:v(q)}},C=(L,F)=>new Promise((q,Z)=>{const J=new Image,me=L.url,pe=L.credentials;pe&&pe==="include"?J.crossOrigin="use-credentials":(pe&&pe==="same-origin"||!a.s(me))&&(J.crossOrigin="anonymous"),F.signal.addEventListener("abort",()=>{J.src="",Z(a.c())}),J.fetchPriority="high",J.onload=()=>{J.onerror=J.onload=null,q({data:J})},J.onerror=()=>{J.onerror=J.onload=null,F.signal.aborted||Z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},J.src=me})}(V||(V={})),V.resetRequestQueue();class j{constructor(r){this._transformRequestFn=r}transformRequest(r,h){return this._transformRequestFn&&this._transformRequestFn(r,h)||{url:r}}normalizeSpriteURL(r,h,p){const m=function(v){const E=v.match(le);if(!E)throw new Error(`Unable to parse URL "${v}"`);return{protocol:E[1],authority:E[2],path:E[3]||"/",params:E[4]?E[4].split("&"):[]}}(r);return m.path+=`${h}${p}`,function(v){const E=v.params.length?`?${v.params.join("&")}`:"";return`${v.protocol}://${v.authority}${v.path}${E}`}(m)}setTransformRequest(r){this._transformRequestFn=r}}const le=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function oe(y){var r=new a.A(3);return r[0]=y[0],r[1]=y[1],r[2]=y[2],r}var $,Y=function(y,r,h){return y[0]=r[0]-h[0],y[1]=r[1]-h[1],y[2]=r[2]-h[2],y};$=new a.A(3),a.A!=Float32Array&&($[0]=0,$[1]=0,$[2]=0);var ve=function(y){var r=y[0],h=y[1];return r*r+h*h};function Be(y){const r=[];if(typeof y=="string")r.push({id:"default",url:y});else if(y&&y.length>0){const h=[];for(const{id:p,url:m}of y){const v=`${p}${m}`;h.indexOf(v)===-1&&(h.push(v),r.push({id:p,url:m}))}}return r}(function(){var y=new a.A(2);a.A!=Float32Array&&(y[0]=0,y[1]=0)})();class te{constructor(r,h,p,m){this.context=r,this.format=p,this.texture=r.gl.createTexture(),this.update(h,m)}update(r,h,p){const{width:m,height:v}=r,E=!(this.size&&this.size[0]===m&&this.size[1]===v||p),{context:C}=this,{gl:L}=C;if(this.useMipmap=!!(h&&h.useMipmap),L.bindTexture(L.TEXTURE_2D,this.texture),C.pixelStoreUnpackFlipY.set(!1),C.pixelStoreUnpack.set(1),C.pixelStoreUnpackPremultiplyAlpha.set(this.format===L.RGBA&&(!h||h.premultiply!==!1)),E)this.size=[m,v],r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||a.b(r)?L.texImage2D(L.TEXTURE_2D,0,this.format,this.format,L.UNSIGNED_BYTE,r):L.texImage2D(L.TEXTURE_2D,0,this.format,m,v,0,this.format,L.UNSIGNED_BYTE,r.data);else{const{x:F,y:q}=p||{x:0,y:0};r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||a.b(r)?L.texSubImage2D(L.TEXTURE_2D,0,F,q,L.RGBA,L.UNSIGNED_BYTE,r):L.texSubImage2D(L.TEXTURE_2D,0,F,q,m,v,L.RGBA,L.UNSIGNED_BYTE,r.data)}this.useMipmap&&this.isSizePowerOfTwo()&&L.generateMipmap(L.TEXTURE_2D)}bind(r,h,p){const{context:m}=this,{gl:v}=m;v.bindTexture(v.TEXTURE_2D,this.texture),p!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=v.LINEAR),r!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,r),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,p||r),this.filter=r),h!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,h),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}function ne(y){const{userImage:r}=y;return!!(r&&r.render&&r.render())&&(y.data.replace(new Uint8Array(r.data.buffer)),!0)}class qe extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:h,promiseResolve:p}of this.requestors)p(this._getImagesForIds(h));this.requestors=[]}}getImage(r){const h=this.images[r];if(h&&!h.data&&h.spriteData){const p=h.spriteData;h.data=new a.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),h.spriteData=null}return h}addImage(r,h){if(this.images[r])throw new Error(`Image id ${r} already exist, use updateImage instead`);this._validate(r,h)&&(this.images[r]=h)}_validate(r,h){let p=!0;const m=h.data||h.spriteData;return this._validateStretch(h.stretchX,m&&m.width)||(this.fire(new a.j(new Error(`Image "${r}" has invalid "stretchX" value`))),p=!1),this._validateStretch(h.stretchY,m&&m.height)||(this.fire(new a.j(new Error(`Image "${r}" has invalid "stretchY" value`))),p=!1),this._validateContent(h.content,h)||(this.fire(new a.j(new Error(`Image "${r}" has invalid "content" value`))),p=!1),p}_validateStretch(r,h){if(!r)return!0;let p=0;for(const m of r){if(m[0]<p||m[1]<m[0]||h<m[1])return!1;p=m[1]}return!0}_validateContent(r,h){if(!r)return!0;if(r.length!==4)return!1;const p=h.spriteData,m=p&&p.width||h.data.width,v=p&&p.height||h.data.height;return!(r[0]<0||m<r[0]||r[1]<0||v<r[1]||r[2]<0||m<r[2]||r[3]<0||v<r[3]||r[2]<r[0]||r[3]<r[1])}updateImage(r,h,p=!0){const m=this.getImage(r);if(p&&(m.data.width!==h.data.width||m.data.height!==h.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=m.version+1,this.images[r]=h,this.updatedImages[r]=!0}removeImage(r){const h=this.images[r];delete this.images[r],delete this.patterns[r],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r){return new Promise((h,p)=>{let m=!0;if(!this.isLoaded())for(const v of r)this.images[v]||(m=!1);this.isLoaded()||m?h(this._getImagesForIds(r)):this.requestors.push({ids:r,promiseResolve:h})})}_getImagesForIds(r){const h={};for(const p of r){let m=this.getImage(p);m||(this.fire(new a.k("styleimagemissing",{id:p})),m=this.getImage(p)),m?h[p]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:a.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:r,height:h}=this.atlasImage;return{width:r,height:h}}getPattern(r){const h=this.patterns[r],p=this.getImage(r);if(!p)return null;if(h&&h.position.version===p.version)return h.position;if(h)h.position.version=p.version;else{const m={w:p.data.width+2,h:p.data.height+2,x:0,y:0},v=new a.I(m,p);this.patterns[r]={bin:m,position:v}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const h=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new te(r,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const v in this.patterns)r.push(this.patterns[v].bin);const{w:h,h:p}=a.p(r),m=this.atlasImage;m.resize({width:h||1,height:p||1});for(const v in this.patterns){const{bin:E}=this.patterns[v],C=E.x+1,L=E.y+1,F=this.getImage(v).data,q=F.width,Z=F.height;a.R.copy(F,m,{x:0,y:0},{x:C,y:L},{width:q,height:Z}),a.R.copy(F,m,{x:0,y:Z-1},{x:C,y:L-1},{width:q,height:1}),a.R.copy(F,m,{x:0,y:0},{x:C,y:L+Z},{width:q,height:1}),a.R.copy(F,m,{x:q-1,y:0},{x:C-1,y:L},{width:1,height:Z}),a.R.copy(F,m,{x:0,y:0},{x:C+q,y:L},{width:1,height:Z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const h of r){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const p=this.getImage(h);p||a.w(`Image with ID: "${h}" was not found`),ne(p)&&this.updateImage(h,p)}}}const Ce=1e20;function et(y,r,h,p,m,v,E,C,L){for(let F=r;F<r+p;F++)bt(y,h*v+F,v,m,E,C,L);for(let F=h;F<h+m;F++)bt(y,F*v+r,1,p,E,C,L)}function bt(y,r,h,p,m,v,E){v[0]=0,E[0]=-Ce,E[1]=Ce,m[0]=y[r];for(let C=1,L=0,F=0;C<p;C++){m[C]=y[r+C*h];const q=C*C;do{const Z=v[L];F=(m[C]-m[Z]+q-Z*Z)/(C-Z)/2}while(F<=E[L]&&--L>-1);L++,v[L]=C,E[L]=F,E[L+1]=Ce}for(let C=0,L=0;C<p;C++){for(;E[L+1]<C;)L++;const F=v[L],q=C-F;y[r+C*h]=m[F]+q*q}}class ft{constructor(r,h){this.requestManager=r,this.localIdeographFontFamily=h,this.entries={}}setURL(r){this.url=r}getGlyphs(r){return a._(this,void 0,void 0,function*(){const h=[];for(const v in r)for(const E of r[v])h.push(this._getAndCacheGlyphsPromise(v,E));const p=yield Promise.all(h),m={};for(const{stack:v,id:E,glyph:C}of p)m[v]||(m[v]={}),m[v][E]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics};return m})}_getAndCacheGlyphsPromise(r,h){return a._(this,void 0,void 0,function*(){let p=this.entries[r];p||(p=this.entries[r]={glyphs:{},requests:{},ranges:{}});let m=p.glyphs[h];if(m!==void 0)return{stack:r,id:h,glyph:m};if(m=this._tinySDF(p,r,h),m)return p.glyphs[h]=m,{stack:r,id:h,glyph:m};const v=Math.floor(h/256);if(256*v>65535)throw new Error("glyphs > 65535 not supported");if(p.ranges[v])return{stack:r,id:h,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!p.requests[v]){const C=ft.loadGlyphRange(r,v,this.url,this.requestManager);p.requests[v]=C}const E=yield p.requests[v];for(const C in E)this._doesCharSupportLocalGlyph(+C)||(p.glyphs[+C]=E[+C]);return p.ranges[v]=!0,{stack:r,id:h,glyph:E[h]||null}})}_doesCharSupportLocalGlyph(r){return!!this.localIdeographFontFamily&&(a.u["CJK Unified Ideographs"](r)||a.u["Hangul Syllables"](r)||a.u.Hiragana(r)||a.u.Katakana(r))}_tinySDF(r,h,p){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(p))return;let v=r.tinySDF;if(!v){let C="400";/bold/i.test(h)?C="900":/medium/i.test(h)?C="500":/light/i.test(h)&&(C="200"),v=r.tinySDF=new ft.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:C})}const E=v.draw(String.fromCharCode(p));return{id:p,bitmap:new a.o({width:E.width||60,height:E.height||60},E.data),metrics:{width:E.glyphWidth/2||24,height:E.glyphHeight/2||24,left:E.glyphLeft/2+.5||0,top:E.glyphTop/2-27.5||-8,advance:E.glyphAdvance/2||24,isDoubleResolution:!0}}}}ft.loadGlyphRange=function(y,r,h,p){return a._(this,void 0,void 0,function*(){const m=256*r,v=m+255,E=p.transformRequest(h.replace("{fontstack}",y).replace("{range}",`${m}-${v}`),"Glyphs"),C=yield a.l(E,new AbortController);if(!C||!C.data)throw new Error(`Could not load glyph range. range: ${r}, ${m}-${v}`);const L={};for(const F of a.n(C.data))L[F.id]=F;return L})},ft.TinySDF=class{constructor({fontSize:y=24,buffer:r=3,radius:h=8,cutoff:p=.25,fontFamily:m="sans-serif",fontWeight:v="normal",fontStyle:E="normal"}={}){this.buffer=r,this.cutoff=p,this.radius=h;const C=this.size=y+4*r,L=this._createCanvas(C),F=this.ctx=L.getContext("2d",{willReadFrequently:!0});F.font=`${E} ${v} ${y}px ${m}`,F.textBaseline="alphabetic",F.textAlign="left",F.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(y){const r=document.createElement("canvas");return r.width=r.height=y,r}draw(y){const{width:r,actualBoundingBoxAscent:h,actualBoundingBoxDescent:p,actualBoundingBoxLeft:m,actualBoundingBoxRight:v}=this.ctx.measureText(y),E=Math.ceil(h),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(v-m))),L=Math.min(this.size-this.buffer,E+Math.ceil(p)),F=C+2*this.buffer,q=L+2*this.buffer,Z=Math.max(F*q,0),J=new Uint8ClampedArray(Z),me={data:J,width:F,height:q,glyphWidth:C,glyphHeight:L,glyphTop:E,glyphLeft:0,glyphAdvance:r};if(C===0||L===0)return me;const{ctx:pe,buffer:ye,gridInner:se,gridOuter:Ee}=this;pe.clearRect(ye,ye,C,L),pe.fillText(y,ye,ye+E);const Ge=pe.getImageData(ye,ye,C,L);Ee.fill(Ce,0,Z),se.fill(0,0,Z);for(let be=0;be<L;be++)for(let Ae=0;Ae<C;Ae++){const He=Ge.data[4*(be*C+Ae)+3]/255;if(He===0)continue;const Xe=(be+ye)*F+Ae+ye;if(He===1)Ee[Xe]=0,se[Xe]=Ce;else{const Ke=.5-He;Ee[Xe]=Ke>0?Ke*Ke:0,se[Xe]=Ke<0?Ke*Ke:0}}et(Ee,0,0,F,q,F,this.f,this.v,this.z),et(se,ye,ye,C,L,F,this.f,this.v,this.z);for(let be=0;be<Z;be++){const Ae=Math.sqrt(Ee[be])-Math.sqrt(se[be]);J[be]=Math.round(255-255*(Ae/this.radius+this.cutoff))}return me}};class ot{constructor(){this.specification=a.v.light.position}possiblyEvaluate(r,h){return a.y(r.expression.evaluate(h))}interpolate(r,h,p){return{x:a.z.number(r.x,h.x,p),y:a.z.number(r.y,h.y,p),z:a.z.number(r.z,h.z,p)}}}let Zt;class ii extends a.E{constructor(r){super(),Zt=Zt||new a.q({anchor:new a.D(a.v.light.anchor),position:new ot,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(Zt),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,h={}){if(!this._validate(a.r,r,h))for(const p in r){const m=r[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,h,p){return(!p||p.validate!==!1)&&a.t(this,r.call(a.x,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}class Ft{constructor(r,h){this.width=r,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(r,h){const p=r.join(",")+String(h);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(r,h)),this.dashEntry[p]}getDashRanges(r,h,p){const m=[];let v=r.length%2==1?-r[r.length-1]*p:0,E=r[0]*p,C=!0;m.push({left:v,right:E,isDash:C,zeroLength:r[0]===0});let L=r[0];for(let F=1;F<r.length;F++){C=!C;const q=r[F];v=L*p,L+=q,E=L*p,m.push({left:v,right:E,isDash:C,zeroLength:q===0})}return m}addRoundDash(r,h,p){const m=h/2;for(let v=-p;v<=p;v++){const E=this.width*(this.nextRow+p+v);let C=0,L=r[C];for(let F=0;F<this.width;F++){F/L.right>1&&(L=r[++C]);const q=Math.abs(F-L.left),Z=Math.abs(F-L.right),J=Math.min(q,Z);let me;const pe=v/p*(m+1);if(L.isDash){const ye=m-Math.abs(pe);me=Math.sqrt(J*J+ye*ye)}else me=m-Math.sqrt(J*J+pe*pe);this.data[E+F]=Math.max(0,Math.min(255,me+128))}}}addRegularDash(r){for(let C=r.length-1;C>=0;--C){const L=r[C],F=r[C+1];L.zeroLength?r.splice(C,1):F&&F.isDash===L.isDash&&(F.left=L.left,r.splice(C,1))}const h=r[0],p=r[r.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const m=this.width*this.nextRow;let v=0,E=r[v];for(let C=0;C<this.width;C++){C/E.right>1&&(E=r[++v]);const L=Math.abs(C-E.left),F=Math.abs(C-E.right),q=Math.min(L,F);this.data[m+C]=Math.max(0,Math.min(255,(E.isDash?q:-q)+128))}}addDash(r,h){const p=h?7:0,m=2*p+1;if(this.nextRow+m>this.height)return a.w("LineAtlas out of space"),null;let v=0;for(let C=0;C<r.length;C++)v+=r[C];if(v!==0){const C=this.width/v,L=this.getDashRanges(r,this.width,C);h?this.addRoundDash(L,C,p):this.addRegularDash(L)}const E={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:v};return this.nextRow+=m,this.dirty=!0,E}bind(r){const h=r.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const Pt="maplibre_preloaded_worker_pool";class Jt{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<Jt.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Pt]}numActive(){return Object.keys(this.active).length}}const Mt=Math.floor(k.hardwareConcurrency/2);let ei,Vt;function hi(){return ei||(ei=new Jt),ei}Jt.workerCount=a.B(globalThis)?Math.max(Math.min(Mt,3),1):1;class xi{constructor(r,h){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=h;const p=this.workerPool.acquire(h);for(let m=0;m<p.length;m++){const v=new a.C(p[m],h);v.name=`Worker ${m}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(r,h){const p=[];for(const m of this.actors)p.push(m.sendAsync({type:r,data:h}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(r=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],r&&this.workerPool.release(this.id)}registerMessageHandler(r,h){for(const p of this.actors)p.registerMessageHandler(r,h)}}function gi(){return Vt||(Vt=new xi(hi(),a.G),Vt.registerMessageHandler("GR",(y,r,h)=>a.m(r,h))),Vt}function Ai(y,r){const h=a.F();return a.H(h,h,[1,1,0]),a.J(h,h,[.5*y.width,.5*y.height,1]),a.K(h,h,y.calculatePosMatrix(r.toUnwrapped()))}function ct(y,r,h,p,m,v){const E=function(Z,J,me){if(Z)for(const pe of Z){const ye=J[pe];if(ye&&ye.source===me&&ye.type==="fill-extrusion")return!0}else for(const pe in J){const ye=J[pe];if(ye.source===me&&ye.type==="fill-extrusion")return!0}return!1}(m&&m.layers,r,y.id),C=v.maxPitchScaleFactor(),L=y.tilesIn(p,C,E);L.sort(It);const F=[];for(const Z of L)F.push({wrappedTileID:Z.tileID.wrapped().key,queryResults:Z.tile.queryRenderedFeatures(r,h,y._state,Z.queryGeometry,Z.cameraQueryGeometry,Z.scale,m,v,C,Ai(y.transform,Z.tileID))});const q=function(Z){const J={},me={};for(const pe of Z){const ye=pe.queryResults,se=pe.wrappedTileID,Ee=me[se]=me[se]||{};for(const Ge in ye){const be=ye[Ge],Ae=Ee[Ge]=Ee[Ge]||{},He=J[Ge]=J[Ge]||[];for(const Xe of be)Ae[Xe.featureIndex]||(Ae[Xe.featureIndex]=!0,He.push(Xe))}}return J}(F);for(const Z in q)q[Z].forEach(J=>{const me=J.feature,pe=y.getFeatureState(me.layer["source-layer"],me.id);me.source=me.layer.source,me.layer["source-layer"]&&(me.sourceLayer=me.layer["source-layer"]),me.state=pe});return q}function It(y,r){const h=y.tileID,p=r.tileID;return h.overscaledZ-p.overscaledZ||h.canonical.y-p.canonical.y||h.wrap-p.wrap||h.canonical.x-p.canonical.x}function Ne(y,r,h){return a._(this,void 0,void 0,function*(){let p=y;if(y.url?p=(yield a.h(r.transformRequest(y.url,"Source"),h)).data:yield k.frameAsync(h),!p)return null;const m=a.L(a.e(p,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(m.vectorLayerIds=p.vector_layers.map(v=>v.id)),m})}class je{constructor(r,h){r&&(h?this.setSouthWest(r).setNorthEast(h):Array.isArray(r)&&(r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1])))}setNorthEast(r){return this._ne=r instanceof a.M?new a.M(r.lng,r.lat):a.M.convert(r),this}setSouthWest(r){return this._sw=r instanceof a.M?new a.M(r.lng,r.lat):a.M.convert(r),this}extend(r){const h=this._sw,p=this._ne;let m,v;if(r instanceof a.M)m=r,v=r;else{if(!(r instanceof je))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(je.convert(r)):this.extend(a.M.convert(r)):r&&("lng"in r||"lon"in r)&&"lat"in r?this.extend(a.M.convert(r)):this;if(m=r._sw,v=r._ne,!m||!v)return this}return h||p?(h.lng=Math.min(m.lng,h.lng),h.lat=Math.min(m.lat,h.lat),p.lng=Math.max(v.lng,p.lng),p.lat=Math.max(v.lat,p.lat)):(this._sw=new a.M(m.lng,m.lat),this._ne=new a.M(v.lng,v.lat)),this}getCenter(){return new a.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.M(this.getWest(),this.getNorth())}getSouthEast(){return new a.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:h,lat:p}=a.M.convert(r);let m=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&m}static convert(r){return r instanceof je?r:r&&new je(r)}static fromLngLat(r,h=0){const p=360*h/40075017,m=p/Math.cos(Math.PI/180*r.lat);return new je(new a.M(r.lng-m,r.lat-p),new a.M(r.lng+m,r.lat+p))}}class rt{constructor(r,h,p){this.bounds=je.convert(this.validateBounds(r)),this.minzoom=h||0,this.maxzoom=p||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const h=Math.pow(2,r.z),p=Math.floor(a.N(this.bounds.getWest())*h),m=Math.floor(a.O(this.bounds.getNorth())*h),v=Math.ceil(a.N(this.bounds.getEast())*h),E=Math.ceil(a.O(this.bounds.getSouth())*h);return r.x>=p&&r.x<v&&r.y>=m&&r.y<E}}class xt extends a.E{constructor(r,h,p,m){if(super(),this.id=r,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.L(h,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield Ne(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),r&&(a.e(this,r),r.bounds&&(this.tileBounds=new rt(r.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(r){this._tileJSONRequest=null,this.fire(new a.j(r))}})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}setSourceProperty(r){this._tileJSONRequest&&this._tileJSONRequest.abort(),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(r){return a._(this,void 0,void 0,function*(){const h=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(h,"Tile"),uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};p.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(r.actor&&r.state!=="expired"){if(r.state==="loading")return new Promise((v,E)=>{r.reloadPromise={resolve:v,reject:E}})}else r.actor=this.dispatcher.getActor(),m="LT";r.abortController=new AbortController;try{const v=yield r.actor.sendAsync({type:m,data:p},r.abortController);if(delete r.abortController,r.aborted)return;this._afterTileLoadWorkerResponse(r,v)}catch(v){if(delete r.abortController,r.aborted)return;if(v&&v.status!==404)throw v;this._afterTileLoadWorkerResponse(r,null)}})}_afterTileLoadWorkerResponse(r,h){if(h&&h.resourceTiming&&(r.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&r.setExpiryData(h),r.loadVectorData(h,this.map.painter),r.reloadPromise){const p=r.reloadPromise;r.reloadPromise=null,this.loadTile(r).then(p.resolve).catch(p.reject)}}abortTile(r){return a._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController),r.actor&&(yield r.actor.sendAsync({type:"AT",data:{uid:r.uid,type:this.type,source:this.id}}))})}unloadTile(r){return a._(this,void 0,void 0,function*(){r.unloadVectorData(),r.actor&&(yield r.actor.sendAsync({type:"RMT",data:{uid:r.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class we extends a.E{constructor(r,h,p,m){super(),this.id=r,this.dispatcher=p,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},h),a.e(this,a.L(h,["url","scheme","tileSize"]))}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield Ne(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,r&&(a.e(this,r),r.bounds&&(this.tileBounds=new rt(r.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(r){this._tileJSONRequest=null,this.fire(new a.j(r))}})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(r){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}serialize(){return a.e({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r){return a._(this,void 0,void 0,function*(){const h=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);r.abortController=new AbortController;try{const p=yield V.getImage(this.map._requestManager.transformRequest(h,"Tile"),r.abortController,this.map._refreshExpiredTiles);if(delete r.abortController,r.aborted)return void(r.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&p.cacheControl&&p.expires&&r.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const m=this.map.painter.context,v=m.gl,E=p.data;r.texture=this.map.painter.getTileTexture(E.width),r.texture?r.texture.update(E,{useMipmap:!0}):(r.texture=new te(m,E,v.RGBA,{useMipmap:!0}),r.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),m.extTextureFilterAnisotropic&&v.texParameterf(v.TEXTURE_2D,m.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,m.extTextureFilterAnisotropicMax)),r.state="loaded"}}catch(p){if(delete r.abortController,r.aborted)r.state="unloaded";else if(p)throw r.state="errored",p}})}abortTile(r){return a._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController)})}unloadTile(r){return a._(this,void 0,void 0,function*(){r.texture&&this.map.painter.saveTileTexture(r.texture)})}hasTransition(){return!1}}class di extends we{constructor(r,h,p,m){super(r,h,p,m),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(r){return a._(this,void 0,void 0,function*(){const h=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(h,"Tile");r.neighboringTiles=this._getNeighboringTiles(r.tileID),r.abortController=new AbortController;try{const m=yield V.getImage(p,r.abortController,this.map._refreshExpiredTiles);if(delete r.abortController,r.aborted)return void(r.state="unloaded");if(m&&m.data){const v=m.data;this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&r.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const E=a.b(v)&&a.S()?v:yield this.readImageNow(v),C={type:this.type,uid:r.uid,source:this.id,rawImageData:E,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!r.actor||r.state==="expired"){r.actor=this.dispatcher.getActor();const L=yield r.actor.sendAsync({type:"LDT",data:C});r.dem=L,r.needsHillshadePrepare=!0,r.needsTerrainPrepare=!0,r.state="loaded"}}}catch(m){if(delete r.abortController,r.aborted)r.state="unloaded";else if(m)throw r.state="errored",m}})}readImageNow(r){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.U()){const h=r.width+2,p=r.height+2;try{return new a.R({width:h,height:p},yield a.V(r,-1,-1,h,p))}catch{}}return k.getImageData(r,1)})}_getNeighboringTiles(r){const h=r.canonical,p=Math.pow(2,h.z),m=(h.x-1+p)%p,v=h.x===0?r.wrap-1:r.wrap,E=(h.x+1+p)%p,C=h.x+1===p?r.wrap+1:r.wrap,L={};return L[new a.Q(r.overscaledZ,v,h.z,m,h.y).key]={backfilled:!1},L[new a.Q(r.overscaledZ,C,h.z,E,h.y).key]={backfilled:!1},h.y>0&&(L[new a.Q(r.overscaledZ,v,h.z,m,h.y-1).key]={backfilled:!1},L[new a.Q(r.overscaledZ,r.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},L[new a.Q(r.overscaledZ,C,h.z,E,h.y-1).key]={backfilled:!1}),h.y+1<p&&(L[new a.Q(r.overscaledZ,v,h.z,m,h.y+1).key]={backfilled:!1},L[new a.Q(r.overscaledZ,r.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},L[new a.Q(r.overscaledZ,C,h.z,E,h.y+1).key]={backfilled:!1}),L}unloadTile(r){return a._(this,void 0,void 0,function*(){r.demTexture&&this.map.painter.saveTileTexture(r.demTexture),r.fbo&&(r.fbo.destroy(),delete r.fbo),r.dem&&delete r.dem,delete r.neighboringTiles,r.state="unloaded",r.actor&&(yield r.actor.sendAsync({type:"RDT",data:{type:this.type,uid:r.uid,source:this.id}}))})}}class Ve extends a.E{constructor(r,h,p,m){super(),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(m),this._data=h.data,this._options=a.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const v=a.W/this.tileSize;this.workerOptions=a.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*v,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*v,extent:a.W,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:a.W,radius:(h.clusterRadius||50)*v,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(r){this.map=r,this.load()}setData(r){return this._data=r,this._updateWorkerData(),this}updateData(r){return this._updateWorkerData(r),this}setClusterOptions(r){return this.workerOptions.cluster=r.cluster,r&&(r.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=r.clusterRadius),r.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=r.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(r){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:r,source:this.id}})}getClusterChildren(r){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:r,source:this.id}})}getClusterLeaves(r,h,p){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:r,limit:h,offset:p}})}_updateWorkerData(r){return a._(this,void 0,void 0,function*(){const h=a.e({type:this.type},this.workerOptions);r?h.dataDiff=r:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(k.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||p.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let m=null;p.resourceTiming&&p.resourceTiming[this.id]&&(m=p.resourceTiming[this.id].slice(0));const v={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&a.e(v,{resourceTiming:m}),this.fire(new a.k("data",Object.assign(Object.assign({},v),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},v),{sourceDataType:"content"})))}catch(p){if(this._pendingLoads--,this._removed)return void this.fire(new a.k("dataabort",{dataType:"source"}));this.fire(new a.j(p))}})}loaded(){return this._pendingLoads===0}loadTile(r){return a._(this,void 0,void 0,function*(){const h=r.actor?"RT":"LT";r.actor=this.actor;const p={type:this.type,uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};r.abortController=new AbortController;const m=yield this.actor.sendAsync({type:h,data:p},r.abortController);delete r.abortController,r.unloadVectorData(),r.aborted||r.loadVectorData(m,this.map.painter,h==="RT")})}abortTile(r){return a._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController),r.aborted=!0})}unloadTile(r){return a._(this,void 0,void 0,function*(){r.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:r.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var $e=a.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class kt extends a.E{constructor(r,h,p,m){super(),this.id=r,this.dispatcher=p,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=h}load(r){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield V.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,r&&(this.coordinates=r),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new a.j(h))}})}loaded(){return this._loaded}updateImage(r){return r.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=r.url,this.load(r.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(r){this.coordinates=r;const h=r.map(a.Y.fromLngLat);this.tileID=function(m){let v=1/0,E=1/0,C=-1/0,L=-1/0;for(const J of m)v=Math.min(v,J.x),E=Math.min(E,J.y),C=Math.max(C,J.x),L=Math.max(L,J.y);const F=Math.max(C-v,L-E),q=Math.max(0,Math.floor(-Math.log(F)/Math.LN2)),Z=Math.pow(2,q);return new a.a0(q,Math.floor((v+C)/2*Z),Math.floor((E+L)/2*Z))}(h),this.minzoom=this.maxzoom=this.tileID.z;const p=h.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new a.Z,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,a.W,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,a.W),this._boundsArray.emplaceBack(p[2].x,p[2].y,a.W,a.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,h=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,$e.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new te(r,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const v=this.tiles[m];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(r){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={}):r.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class bn extends kt{constructor(r,h,p,m){super(r,h,p,m),this.roundZoom=!0,this.type="video",this.options=h}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const r=this.options;this.urls=[];for(const h of r.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield a.a2(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new a.j(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(r){if(this.video){const h=this.video.seekable;r<h.start(0)||r>h.end(0)?this.fire(new a.j(new a.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=r}}getVideo(){return this.video}onAdd(r){this.map||(this.map=r,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const r=this.map.painter.context,h=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,$e.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new te(r,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const v=this.tiles[m];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class wn extends kt{constructor(r,h,p,m){super(r,h,p,m),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(E=>typeof E!="number"))||this.fire(new a.j(new a.a1(`sources.${r}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.a1(`sources.${r}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new a.j(new a.a1(`sources.${r}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.a1(`sources.${r}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.a1(`sources.${r}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(r){this.map=r,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let r=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,r=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,r=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,p=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,$e.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?(r||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new te(h,this.canvas,p.RGBA,{premultiply:!0});let m=!1;for(const v in this.tiles){const E=this.tiles[v];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,m=!0)}m&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const r of[this.canvas.width,this.canvas.height])if(isNaN(r)||r<=0)return!0;return!1}}const Cn={},tr=y=>{switch(y){case"geojson":return Ve;case"image":return kt;case"raster":return we;case"raster-dem":return di;case"vector":return xt;case"video":return bn;case"canvas":return wn}return Cn[y]},ir="RTLPluginLoaded";class Uo extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=gi()}_syncState(r){return this.status=r,this.dispatcher.broadcast("SRPS",{pluginStatus:r,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(r){return a._(this,arguments,void 0,function*(h,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=k.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.k(ir))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ki=null;function ut(){return Ki||(Ki=new Uo),Ki}class $n{constructor(r,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=r,this.uid=a.a3(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(r){const h=r+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(r){this.demTexture&&r.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(r,h,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(m,v){const E={};if(!v)return E;for(const C of m){const L=C.layerIds.map(F=>v.getLayer(F)).filter(Boolean);if(L.length!==0){C.layers=L,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(F=>L.filter(q=>q.id===F)[0]));for(const F of L)E[F.id]=C}}return E}(r.buckets,h.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const v=this.buckets[m];if(v instanceof a.a5){if(this.hasSymbolBuckets=!0,!p)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const v=this.buckets[m];if(v instanceof a.a5&&v.hasRTLText){this.hasRTLText=!0,ut().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const v=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(m).queryRadius(v))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage)}else this.collisionBoxArray=new a.a4}unloadVectorData(){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(r){return this.buckets[r.id]}upload(r){for(const p in this.buckets){const m=this.buckets[p];m.uploadPending()&&m.upload(r)}const h=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new te(r,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new te(r,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,h,p,m,v,E,C,L,F,q){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:v,scale:E,tileSize:this.tileSize,pixelPosMatrix:q,transform:L,params:C,queryPadding:this.queryPadding*F},r,h,p):{}}querySourceFeatures(r,h){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const m=p.loadVTLayers(),v=h&&h.sourceLayer?h.sourceLayer:"",E=m._geojsonTileLayer||m[v];if(!E)return;const C=a.a6(h&&h.filter),{z:L,x:F,y:q}=this.tileID.canonical,Z={z:L,x:F,y:q};for(let J=0;J<E.length;J++){const me=E.feature(J);if(C.needGeometry){const se=a.a7(me,!0);if(!C.filter(new a.a8(this.tileID.overscaledZ),se,this.tileID.canonical))continue}else if(!C.filter(new a.a8(this.tileID.overscaledZ),me))continue;const pe=p.getId(me,v),ye=new a.a9(me,L,F,q,pe);ye.tile=Z,r.push(ye)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const h=this.expirationTime;if(r.cacheControl){const p=a.aa(r.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const p=Date.now();let m=!1;if(this.expirationTime>p)m=!1;else if(h)if(this.expirationTime<h)m=!0;else{const v=this.expirationTime-h;v?this.expirationTime=p+Math.max(v,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!h.style.hasLayer(m))continue;const v=this.buckets[m],E=v.layers[0].sourceLayer||"_geojsonTileLayer",C=p[E],L=r[E];if(!C||!L||Object.keys(L).length===0)continue;v.update(L,C,this.imageAtlas&&this.imageAtlas.patternPositions||{});const F=h&&h.style&&h.style.getLayer(m);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<k.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=k.now()+r}setDependencies(r,h){const p={};for(const m of h)p[m]=!0;this.dependencies[r]=p}hasDependency(r,h){for(const p of r){const m=this.dependencies[p];if(m){for(const v of h)if(m[v])return!0}}return!1}}class xn{constructor(r,h){this.max=r,this.onRemove=h,this.reset()}reset(){for(const r in this.data)for(const h of this.data[r])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(r,h,p){const m=r.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const v={value:h,timeout:void 0};if(p!==void 0&&(v.timeout=setTimeout(()=>{this.remove(r,v)},p)),this.data[m].push(v),this.order.push(m),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const h=this.data[r].shift();return h.timeout&&clearTimeout(h.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),h.value}getByKey(r){const h=this.data[r];return h?h[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,h){if(!this.has(r))return this;const p=r.wrapped().key,m=h===void 0?0:this.data[p].indexOf(h),v=this.data[p][m];return this.data[p].splice(m,1),v.timeout&&clearTimeout(v.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(v.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(r){const h=[];for(const p in this.data)for(const m of this.data[p])r(m.value)||h.push(m);for(const p of h)this.remove(p.value.tileID,p)}}class Lo{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,h,p){const m=String(h);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][m]=this.stateChanges[r][m]||{},a.e(this.stateChanges[r][m],p),this.deletedStates[r]===null){this.deletedStates[r]={};for(const v in this.state[r])v!==m&&(this.deletedStates[r][v]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][m]===null){this.deletedStates[r][m]={};for(const v in this.state[r][m])p[v]||(this.deletedStates[r][m][v]=null)}else for(const v in p)this.deletedStates[r]&&this.deletedStates[r][m]&&this.deletedStates[r][m][v]===null&&delete this.deletedStates[r][m][v]}removeFeatureState(r,h,p){if(this.deletedStates[r]===null)return;const m=String(h);if(this.deletedStates[r]=this.deletedStates[r]||{},p&&h!==void 0)this.deletedStates[r][m]!==null&&(this.deletedStates[r][m]=this.deletedStates[r][m]||{},this.deletedStates[r][m][p]=null);else if(h!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][m])for(p in this.deletedStates[r][m]={},this.stateChanges[r][m])this.deletedStates[r][m][p]=null;else this.deletedStates[r][m]=null;else this.deletedStates[r]=null}getState(r,h){const p=String(h),m=a.e({},(this.state[r]||{})[p],(this.stateChanges[r]||{})[p]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const v=this.deletedStates[r][h];if(v===null)return{};for(const E in v)delete m[E]}return m}initializeTileState(r,h){r.setFeatureState(this.state,h)}coalesceChanges(r,h){const p={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const v={};for(const E in this.stateChanges[m])this.state[m][E]||(this.state[m][E]={}),a.e(this.state[m][E],this.stateChanges[m][E]),v[E]=this.state[m][E];p[m]=v}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const v={};if(this.deletedStates[m]===null)for(const E in this.state[m])v[E]={},this.state[m][E]={};else for(const E in this.deletedStates[m]){if(this.deletedStates[m][E]===null)this.state[m][E]={};else for(const C of Object.keys(this.deletedStates[m][E]))delete this.state[m][E][C];v[E]=this.state[m][E]}p[m]=p[m]||{},a.e(p[m],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const m in r)r[m].setFeatureState(p,h)}}class Vi extends a.E{constructor(r,h,p){super(),this.id=r,this.dispatcher=p,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,v,E,C)=>{const L=new(tr(v.type))(m,v,E,C);if(L.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${L.id}`);return L})(r,h,p,this),this._tiles={},this._cache=new xn(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Lo,this._didEmitContent=!1,this._updated=!1}onAdd(r){this.map=r,this._maxTileCacheSize=r?r._maxTileCacheSize:null,this._maxTileCacheZoomLevels=r?r._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(r)}onRemove(r){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(r)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const r in this._tiles){const h=this._tiles[r];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(r,h,p){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(r),this._tileLoaded(r,h,p)}catch(m){r.state="errored",m.status!==404?this._source.fire(new a.j(m,{tile:r})):this.update(this.transform,this.terrain)}})}_unloadTile(r){this._source.unloadTile&&this._source.unloadTile(r)}_abortTile(r){this._source.abortTile&&this._source.abortTile(r),this._source.fire(new a.k("dataabort",{tile:r,coord:r.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const p=this._tiles[h];p.upload(r),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(gt).map(r=>r.key)}getRenderableIds(r){const h=[];for(const p in this._tiles)this._isIdRenderable(p,r)&&h.push(this._tiles[p]);return r?h.sort((p,m)=>{const v=p.tileID,E=m.tileID,C=new a.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),L=new a.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-E.overscaledZ||L.y-C.y||L.x-C.x}).map(p=>p.tileID.key):h.map(p=>p.tileID).sort(gt).map(p=>p.key)}hasRenderableParent(r){const h=this.findLoadedParent(r,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(r,h){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(h||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(r,"reloading")}}_reloadTile(r,h){return a._(this,void 0,void 0,function*(){const p=this._tiles[r];p&&(p.state!=="loading"&&(p.state=h),yield this._loadTile(p,r,h))})}_tileLoaded(r,h,p){r.timeAdded=k.now(),p==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(h,r),this.getSource().type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),r.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:r,coord:r.tileID}))}_backfillDEM(r){const h=this.getRenderableIds();for(let m=0;m<h.length;m++){const v=h[m];if(r.neighboringTiles&&r.neighboringTiles[v]){const E=this.getTileByID(v);p(r,E),p(E,r)}}function p(m,v){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let E=v.tileID.canonical.x-m.tileID.canonical.x;const C=v.tileID.canonical.y-m.tileID.canonical.y,L=Math.pow(2,m.tileID.canonical.z),F=v.tileID.key;E===0&&C===0||Math.abs(C)>1||(Math.abs(E)>1&&(Math.abs(E+L)===1?E+=L:Math.abs(E-L)===1&&(E-=L)),v.dem&&m.dem&&(m.dem.backfillBorder(v.dem,E,C),m.neighboringTiles&&m.neighboringTiles[F]&&(m.neighboringTiles[F].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,h,p,m){for(const v in this._tiles){let E=this._tiles[v];if(m[v]||!E.hasData()||E.tileID.overscaledZ<=h||E.tileID.overscaledZ>p)continue;let C=E.tileID;for(;E&&E.tileID.overscaledZ>h+1;){const F=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[F.key],E&&E.hasData()&&(C=F)}let L=C;for(;L.overscaledZ>h;)if(L=L.scaledTo(L.overscaledZ-1),r[L.key]){m[C.key]=C;break}}}findLoadedParent(r,h){if(r.key in this._loadedParentTiles){const p=this._loadedParentTiles[r.key];return p&&p.tileID.overscaledZ>=h?p:null}for(let p=r.overscaledZ-1;p>=h;p--){const m=r.scaledTo(p),v=this._getLoadedTile(m);if(v)return v}}_getLoadedTile(r){const h=this._tiles[r.key];return h&&h.hasData()?h:this._cache.getByKey(r.wrapped().key)}updateCacheSize(r){const h=Math.ceil(r.width/this._source.tileSize)+1,p=Math.ceil(r.height/this._source.tileSize)+1,m=Math.floor(h*p*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(v)}handleWrapJump(r){const h=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,h){const p={};for(const m in this._tiles){const v=this._tiles[m];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+h),p[v.tileID.key]=v}this._tiles=p;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}update(r,h){if(!this._sourceLoaded||this._paused)return;let p;this.transform=r,this.terrain=h,this.updateCacheSize(r),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(q=>new a.Q(q.canonical.z,q.wrap,q.canonical.z,q.canonical.x,q.canonical.y)):(p=r.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(p=p.filter(q=>this._source.hasTile(q)))):p=[];const m=r.coveringZoomLevel(this._source),v=Math.max(m-Vi.maxOverzooming,this._source.minzoom),E=Math.max(m+Vi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const q={};for(const Z of p)if(Z.canonical.z>this._source.minzoom){const J=Z.scaledTo(Z.canonical.z-1);q[J.key]=J;const me=Z.scaledTo(Math.max(this._source.minzoom,Math.min(Z.canonical.z,5)));q[me.key]=me}p=p.concat(Object.values(q))}const C=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,C&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const L=this._updateRetainedTiles(p,m);if(ni(this._source.type)){const q={},Z={},J=Object.keys(L),me=k.now();for(const pe of J){const ye=L[pe],se=this._tiles[pe];if(!se||se.fadeEndTime!==0&&se.fadeEndTime<=me)continue;const Ee=this.findLoadedParent(ye,v);Ee&&(this._addTile(Ee.tileID),q[Ee.tileID.key]=Ee.tileID),Z[pe]=ye}this._retainLoadedChildren(Z,m,E,L);for(const pe in q)L[pe]||(this._coveredTiles[pe]=!0,L[pe]=q[pe]);if(h){const pe={},ye={};for(const se of p)this._tiles[se.key].hasData()?pe[se.key]=se:ye[se.key]=se;for(const se in ye){const Ee=ye[se].children(this._source.maxzoom);this._tiles[Ee[0].key]&&this._tiles[Ee[1].key]&&this._tiles[Ee[2].key]&&this._tiles[Ee[3].key]&&(pe[Ee[0].key]=L[Ee[0].key]=Ee[0],pe[Ee[1].key]=L[Ee[1].key]=Ee[1],pe[Ee[2].key]=L[Ee[2].key]=Ee[2],pe[Ee[3].key]=L[Ee[3].key]=Ee[3],delete ye[se])}for(const se in ye){const Ee=this.findLoadedParent(ye[se],this._source.minzoom);if(Ee){pe[Ee.tileID.key]=L[Ee.tileID.key]=Ee.tileID;for(const Ge in pe)pe[Ge].isChildOf(Ee.tileID)&&delete pe[Ge]}}for(const se in this._tiles)pe[se]||(this._coveredTiles[se]=!0)}}for(const q in L)this._tiles[q].clearFadeHold();const F=a.ab(this._tiles,L);for(const q of F){const Z=this._tiles[q];Z.hasSymbolBuckets&&!Z.holdingForFade()?Z.setHoldDuration(this.map._fadeDuration):Z.hasSymbolBuckets&&!Z.symbolFadeFinished()||this._removeTile(q)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(r)}_updateRetainedTiles(r,h){const p={},m={},v=Math.max(h-Vi.maxOverzooming,this._source.minzoom),E=Math.max(h+Vi.maxUnderzooming,this._source.minzoom),C={};for(const L of r){const F=this._addTile(L);p[L.key]=L,F.hasData()||h<this._source.maxzoom&&(C[L.key]=L)}this._retainLoadedChildren(C,h,E,p);for(const L of r){let F=this._tiles[L.key];if(F.hasData())continue;if(h+1>this._source.maxzoom){const Z=L.children(this._source.maxzoom)[0],J=this.getTile(Z);if(J&&J.hasData()){p[Z.key]=Z;continue}}else{const Z=L.children(this._source.maxzoom);if(p[Z[0].key]&&p[Z[1].key]&&p[Z[2].key]&&p[Z[3].key])continue}let q=F.wasRequested();for(let Z=L.overscaledZ-1;Z>=v;--Z){const J=L.scaledTo(Z);if(m[J.key])break;if(m[J.key]=!0,F=this.getTile(J),!F&&q&&(F=this._addTile(J)),F){const me=F.hasData();if((q||me)&&(p[J.key]=J),q=F.wasRequested(),me)break}}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const h=[];let p,m=this._tiles[r].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){p=this._loadedParentTiles[m.key];break}h.push(m.key);const v=m.scaledTo(m.overscaledZ-1);if(p=this._getLoadedTile(v),p)break;m=v}for(const v of h)this._loadedParentTiles[v]=p}}_addTile(r){let h=this._tiles[r.key];if(h)return h;h=this._cache.getAndRemove(r),h&&(this._setTileReloadTimer(r.key,h),h.tileID=r,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,h)));const p=h;return h||(h=new $n(r,this._source.tileSize*r.overscaleFactor()),this._loadTile(h,r.key,h.state)),h.uses++,this._tiles[r.key]=h,p||this._source.fire(new a.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(r,h){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const p=h.getExpiryTimeout();p&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},p))}_removeTile(r){const h=this._tiles[r];h&&(h.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(r){const h=r.sourceDataType;r.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&r.dataType==="source"&&h==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(r);this._cache.reset()}tilesIn(r,h,p){const m=[],v=this.transform;if(!v)return m;const E=p?v.getCameraQueryGeometry(r):r,C=r.map(pe=>v.pointCoordinate(pe,this.terrain)),L=E.map(pe=>v.pointCoordinate(pe,this.terrain)),F=this.getIds();let q=1/0,Z=1/0,J=-1/0,me=-1/0;for(const pe of L)q=Math.min(q,pe.x),Z=Math.min(Z,pe.y),J=Math.max(J,pe.x),me=Math.max(me,pe.y);for(let pe=0;pe<F.length;pe++){const ye=this._tiles[F[pe]];if(ye.holdingForFade())continue;const se=ye.tileID,Ee=Math.pow(2,v.zoom-ye.tileID.overscaledZ),Ge=h*ye.queryPadding*a.W/ye.tileSize/Ee,be=[se.getTilePoint(new a.Y(q,Z)),se.getTilePoint(new a.Y(J,me))];if(be[0].x-Ge<a.W&&be[0].y-Ge<a.W&&be[1].x+Ge>=0&&be[1].y+Ge>=0){const Ae=C.map(Xe=>se.getTilePoint(Xe)),He=L.map(Xe=>se.getTilePoint(Xe));m.push({tile:ye,tileID:se,queryGeometry:Ae,cameraQueryGeometry:He,scale:Ee})}}return m}getVisibleCoordinates(r){const h=this.getRenderableIds(r).map(p=>this._tiles[p].tileID);for(const p of h)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(ni(this._source.type)){const r=k.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=r)return!0}return!1}setFeatureState(r,h,p){this._state.updateState(r=r||"_geojsonTileLayer",h,p)}removeFeatureState(r,h,p){this._state.removeFeatureState(r=r||"_geojsonTileLayer",h,p)}getFeatureState(r,h){return this._state.getState(r=r||"_geojsonTileLayer",h)}setDependencies(r,h,p){const m=this._tiles[r];m&&m.setDependencies(h,p)}reloadTilesForDependencies(r,h){for(const p in this._tiles)this._tiles[p].hasDependency(r,h)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(r,h))}}function gt(y,r){const h=Math.abs(2*y.wrap)-+(y.wrap<0),p=Math.abs(2*r.wrap)-+(r.wrap<0);return y.overscaledZ-r.overscaledZ||p-h||r.canonical.y-y.canonical.y||r.canonical.x-y.canonical.x}function ni(y){return y==="raster"||y==="image"||y==="video"}Vi.maxOverzooming=10,Vi.maxUnderzooming=3;class Yt{constructor(r,h){this.reset(r,h)}reset(r,h){this.points=r||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=a.ac(r,0,1);let h=1,p=this._distances[h];const m=r*this.paddedLength+this.padding;for(;p<m&&h<this._distances.length;)p=this._distances[++h];const v=h-1,E=this._distances[v],C=p-E,L=C>0?(m-E)/C:0;return this.points[v].mult(1-L).add(this.points[h].mult(L))}}function qi(y,r){let h=!0;return y==="always"||y!=="never"&&r!=="never"||(h=!1),h}class yr{constructor(r,h,p){const m=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(r/p),this.yCellCount=Math.ceil(h/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)m.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=h,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,h,p,m,v){this._forEachCell(h,p,m,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(v)}insertCircle(r,h,p,m){this._forEachCell(h-m,p-m,h+m,p+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(h),this.circles.push(p),this.circles.push(m)}_insertBoxCell(r,h,p,m,v,E){this.boxCells[v].push(E)}_insertCircleCell(r,h,p,m,v,E){this.circleCells[v].push(E)}_query(r,h,p,m,v,E,C){if(p<0||r>this.width||m<0||h>this.height)return[];const L=[];if(r<=0&&h<=0&&this.width<=p&&this.height<=m){if(v)return[{key:null,x1:r,y1:h,x2:p,y2:m}];for(let F=0;F<this.boxKeys.length;F++)L.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const q=this.circles[3*F],Z=this.circles[3*F+1],J=this.circles[3*F+2];L.push({key:this.circleKeys[F],x1:q-J,y1:Z-J,x2:q+J,y2:Z+J})}}else this._forEachCell(r,h,p,m,this._queryCell,L,{hitTest:v,overlapMode:E,seenUids:{box:{},circle:{}}},C);return L}query(r,h,p,m){return this._query(r,h,p,m,!1,null)}hitTest(r,h,p,m,v,E){return this._query(r,h,p,m,!0,v,E).length>0}hitTestCircle(r,h,p,m,v){const E=r-p,C=r+p,L=h-p,F=h+p;if(C<0||E>this.width||F<0||L>this.height)return!1;const q=[];return this._forEachCell(E,L,C,F,this._queryCellCircle,q,{hitTest:!0,overlapMode:m,circle:{x:r,y:h,radius:p},seenUids:{box:{},circle:{}}},v),q.length>0}_queryCell(r,h,p,m,v,E,C,L){const{seenUids:F,hitTest:q,overlapMode:Z}=C,J=this.boxCells[v];if(J!==null){const pe=this.bboxes;for(const ye of J)if(!F.box[ye]){F.box[ye]=!0;const se=4*ye,Ee=this.boxKeys[ye];if(r<=pe[se+2]&&h<=pe[se+3]&&p>=pe[se+0]&&m>=pe[se+1]&&(!L||L(Ee))&&(!q||!qi(Z,Ee.overlapMode))&&(E.push({key:Ee,x1:pe[se],y1:pe[se+1],x2:pe[se+2],y2:pe[se+3]}),q))return!0}}const me=this.circleCells[v];if(me!==null){const pe=this.circles;for(const ye of me)if(!F.circle[ye]){F.circle[ye]=!0;const se=3*ye,Ee=this.circleKeys[ye];if(this._circleAndRectCollide(pe[se],pe[se+1],pe[se+2],r,h,p,m)&&(!L||L(Ee))&&(!q||!qi(Z,Ee.overlapMode))){const Ge=pe[se],be=pe[se+1],Ae=pe[se+2];if(E.push({key:Ee,x1:Ge-Ae,y1:be-Ae,x2:Ge+Ae,y2:be+Ae}),q)return!0}}}return!1}_queryCellCircle(r,h,p,m,v,E,C,L){const{circle:F,seenUids:q,overlapMode:Z}=C,J=this.boxCells[v];if(J!==null){const pe=this.bboxes;for(const ye of J)if(!q.box[ye]){q.box[ye]=!0;const se=4*ye,Ee=this.boxKeys[ye];if(this._circleAndRectCollide(F.x,F.y,F.radius,pe[se+0],pe[se+1],pe[se+2],pe[se+3])&&(!L||L(Ee))&&!qi(Z,Ee.overlapMode))return E.push(!0),!0}}const me=this.circleCells[v];if(me!==null){const pe=this.circles;for(const ye of me)if(!q.circle[ye]){q.circle[ye]=!0;const se=3*ye,Ee=this.circleKeys[ye];if(this._circlesCollide(pe[se],pe[se+1],pe[se+2],F.x,F.y,F.radius)&&(!L||L(Ee))&&!qi(Z,Ee.overlapMode))return E.push(!0),!0}}}_forEachCell(r,h,p,m,v,E,C,L){const F=this._convertToXCellCoord(r),q=this._convertToYCellCoord(h),Z=this._convertToXCellCoord(p),J=this._convertToYCellCoord(m);for(let me=F;me<=Z;me++)for(let pe=q;pe<=J;pe++)if(v.call(this,r,h,p,m,this.xCellCount*pe+me,E,C,L))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,h,p,m,v,E){const C=m-r,L=v-h,F=p+E;return F*F>C*C+L*L}_circleAndRectCollide(r,h,p,m,v,E,C){const L=(E-m)/2,F=Math.abs(r-(m+L));if(F>L+p)return!1;const q=(C-v)/2,Z=Math.abs(h-(v+q));if(Z>q+p)return!1;if(F<=L||Z<=q)return!0;const J=F-L,me=Z-q;return J*J+me*me<=p*p}}function ti(y,r,h,p,m){const v=a.F();return r?(a.J(v,v,[1/m,1/m,1]),h||a.ad(v,v,p.angle)):a.K(v,p.labelPlaneMatrix,y),v}function eo(y,r,h,p,m){if(r){const v=a.ae(y);return a.J(v,v,[m,m,1]),h||a.ad(v,v,-p.angle),v}return p.glCoordMatrix}function cn(y,r,h){let p;h?(p=[y.x,y.y,h(y.x,y.y),1],a.af(p,p,r)):(p=[y.x,y.y,0,1],Je(p,p,r));const m=p[3];return{point:new a.P(p[0]/m,p[1]/m),signedDistanceFromCamera:m}}function ge(y,r){return .5+y/r*.5}function W(y,r){const h=y[0]/y[3],p=y[1]/y[3];return h>=-r[0]&&h<=r[0]&&p>=-r[1]&&p<=r[1]}function X(y,r,h,p,m,v,E,C,L,F){const q=p?y.textSizeData:y.iconSizeData,Z=a.ag(q,h.transform.zoom),J=[256/h.width*2+1,256/h.height*2+1],me=p?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;me.clear();const pe=y.lineVertexArray,ye=p?y.text.placedSymbolArray:y.icon.placedSymbolArray,se=h.transform.width/h.transform.height;let Ee=!1;for(let Ge=0;Ge<ye.length;Ge++){const be=ye.get(Ge);if(be.hidden||be.writingMode===a.ah.vertical&&!Ee){We(be.numGlyphs,me);continue}let Ae;if(Ee=!1,F?(Ae=[be.anchorX,be.anchorY,F(be.anchorX,be.anchorY),1],a.af(Ae,Ae,r)):(Ae=[be.anchorX,be.anchorY,0,1],Je(Ae,Ae,r)),!W(Ae,J)){We(be.numGlyphs,me);continue}const He=ge(h.transform.cameraToCenterDistance,Ae[3]),Xe=a.ai(q,Z,be),Ke=E?Xe/He:Xe*He,nt=new a.P(be.anchorX,be.anchorY),it=cn(nt,m,F).point,pt={projections:{},offsets:{}},_t=Me(be,Ke,!1,C,r,m,v,y.glyphOffsetArray,pe,me,it,nt,pt,se,L,F);Ee=_t.useVertical,(_t.notEnoughRoom||Ee||_t.needsFlipping&&Me(be,Ke,!0,C,r,m,v,y.glyphOffsetArray,pe,me,it,nt,pt,se,L,F).notEnoughRoom)&&We(be.numGlyphs,me)}p?y.text.dynamicLayoutVertexBuffer.updateData(me):y.icon.dynamicLayoutVertexBuffer.updateData(me)}function ee(y,r,h,p,m,v,E,C,L,F,q,Z,J){const me=C.glyphStartIndex+C.numGlyphs,pe=C.lineStartIndex,ye=C.lineStartIndex+C.lineLength,se=r.getoffsetX(C.glyphStartIndex),Ee=r.getoffsetX(me-1),Ge=Ue(y*se,h,p,m,v,E,C.segment,pe,ye,L,F,q,Z,J);if(!Ge)return null;const be=Ue(y*Ee,h,p,m,v,E,C.segment,pe,ye,L,F,q,Z,J);return be?{first:Ge,last:be}:null}function fe(y,r,h,p){return y===a.ah.horizontal&&Math.abs(h.y-r.y)>Math.abs(h.x-r.x)*p?{useVertical:!0}:(y===a.ah.vertical?r.y<h.y:r.x>h.x)?{needsFlipping:!0}:null}function Me(y,r,h,p,m,v,E,C,L,F,q,Z,J,me,pe,ye){const se=r/24,Ee=y.lineOffsetX*se,Ge=y.lineOffsetY*se;let be;if(y.numGlyphs>1){const Ae=y.glyphStartIndex+y.numGlyphs,He=y.lineStartIndex,Xe=y.lineStartIndex+y.lineLength,Ke=ee(se,C,Ee,Ge,h,q,Z,y,L,v,J,pe,ye);if(!Ke)return{notEnoughRoom:!0};const nt=cn(Ke.first.point,E,ye).point,it=cn(Ke.last.point,E,ye).point;if(p&&!h){const pt=fe(y.writingMode,nt,it,me);if(pt)return pt}be=[Ke.first];for(let pt=y.glyphStartIndex+1;pt<Ae-1;pt++)be.push(Ue(se*C.getoffsetX(pt),Ee,Ge,h,q,Z,y.segment,He,Xe,L,v,J,pe,ye));be.push(Ke.last)}else{if(p&&!h){const He=cn(Z,m,ye).point,Xe=y.lineStartIndex+y.segment+1,Ke=new a.P(L.getx(Xe),L.gety(Xe)),nt=cn(Ke,m,ye),it=nt.signedDistanceFromCamera>0?nt.point:Ie(Z,Ke,He,1,m,ye),pt=fe(y.writingMode,He,it,me);if(pt)return pt}const Ae=Ue(se*C.getoffsetX(y.glyphStartIndex),Ee,Ge,h,q,Z,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,L,v,J,pe,ye);if(!Ae)return{notEnoughRoom:!0};be=[Ae]}for(const Ae of be)a.aj(F,Ae.point,Ae.angle);return{}}function Ie(y,r,h,p,m,v){const E=cn(y.add(y.sub(r)._unit()),m,v).point,C=h.sub(E);return h.add(C._mult(p/C.mag()))}function Pe(y,r){const{projectionCache:h,lineVertexArray:p,labelPlaneMatrix:m,tileAnchorPoint:v,distanceFromAnchor:E,getElevation:C,previousVertex:L,direction:F,absOffsetX:q}=r;if(h.projections[y])return h.projections[y];const Z=new a.P(p.getx(y),p.gety(y)),J=cn(Z,m,C);if(J.signedDistanceFromCamera>0)return h.projections[y]=J.point,J.point;const me=y-F;return Ie(E===0?v:new a.P(p.getx(me),p.gety(me)),Z,L,q-E+1,m,C)}function ke(y,r,h){return y._unit()._perp()._mult(r*h)}function G(y,r,h,p,m,v,E,C){const{projectionCache:L,direction:F}=C;if(L.offsets[y])return L.offsets[y];const q=h.add(r);if(y+F<p||y+F>=m)return L.offsets[y]=q,q;const Z=Pe(y+F,C),J=ke(Z.sub(h),E,F),me=h.add(J),pe=Z.add(J);return L.offsets[y]=a.ak(v,q,me,pe)||q,L.offsets[y]}function Ue(y,r,h,p,m,v,E,C,L,F,q,Z,J,me){const pe=p?y-r:y+r;let ye=pe>0?1:-1,se=0;p&&(ye*=-1,se=Math.PI),ye<0&&(se+=Math.PI);let Ee,Ge,be=ye>0?C+E:C+E+1,Ae=m,He=m,Xe=0,Ke=0;const nt=Math.abs(pe),it=[];let pt;for(;Xe+Ke<=nt;){if(be+=ye,be<C||be>=L)return null;Xe+=Ke,He=Ae,Ge=Ee;const yt={projectionCache:Z,lineVertexArray:F,labelPlaneMatrix:q,tileAnchorPoint:v,distanceFromAnchor:Xe,getElevation:me,previousVertex:He,direction:ye,absOffsetX:nt};if(Ae=Pe(be,yt),h===0)it.push(He),pt=Ae.sub(He);else{let Kt;const si=Ae.sub(He);Kt=si.mag()===0?ke(Pe(be+ye,yt).sub(Ae),h,ye):ke(si,h,ye),Ge||(Ge=He.add(Kt)),Ee=G(be,Kt,Ae,C,L,Ge,h,yt),it.push(Ge),pt=Ee.sub(Ge)}Ke=pt.mag()}const _t=pt._mult((nt-Xe)/Ke)._add(Ge||He),oi=se+Math.atan2(Ae.y-He.y,Ae.x-He.x);return it.push(_t),{point:_t,angle:J?oi:0,path:it}}const Ze=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function We(y,r){for(let h=0;h<y;h++){const p=r.length;r.resize(p+4),r.float32.set(Ze,3*p)}}function Je(y,r,h){const p=r[0],m=r[1];return y[0]=h[0]*p+h[4]*m+h[12],y[1]=h[1]*p+h[5]*m+h[13],y[3]=h[3]*p+h[7]*m+h[15],y}const ht=100;class Rt{constructor(r,h=new yr(r.width+200,r.height+200,25),p=new yr(r.width+200,r.height+200,25)){this.transform=r,this.grid=h,this.ignoredGrid=p,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+ht,this.screenBottomBoundary=r.height+ht,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(r,h,p,m,v,E){const C=this.projectAndGetPerspectiveRatio(m,r.anchorPointX,r.anchorPointY,E),L=p*C.perspectiveRatio,F=r.x1*L+C.point.x,q=r.y1*L+C.point.y,Z=r.x2*L+C.point.x,J=r.y2*L+C.point.y;return!this.isInsideGrid(F,q,Z,J)||h!=="always"&&this.grid.hitTest(F,q,Z,J,h,v)||C.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[F,q,Z,J],offscreen:this.isOffscreen(F,q,Z,J)}}placeCollisionCircles(r,h,p,m,v,E,C,L,F,q,Z,J,me,pe){const ye=[],se=new a.P(h.anchorX,h.anchorY),Ee=cn(se,E,pe),Ge=ge(this.transform.cameraToCenterDistance,Ee.signedDistanceFromCamera),be=(q?v/Ge:v*Ge)/a.ao,Ae=cn(se,C,pe).point,He=ee(be,m,h.lineOffsetX*be,h.lineOffsetY*be,!1,Ae,se,h,p,C,{projections:{},offsets:{}},!1,pe);let Xe=!1,Ke=!1,nt=!0;if(He){const it=.5*J*Ge+me,pt=new a.P(-100,-100),_t=new a.P(this.screenRightBoundary,this.screenBottomBoundary),oi=new Yt,yt=He.first,Kt=He.last;let si=[];for(let ci=yt.path.length-1;ci>=1;ci--)si.push(yt.path[ci]);for(let ci=1;ci<Kt.path.length;ci++)si.push(Kt.path[ci]);const Si=2.5*it;if(L){const ci=si.map(pi=>cn(pi,L,pe));si=ci.some(pi=>pi.signedDistanceFromCamera<=0)?[]:ci.map(pi=>pi.point)}let Qt=[];if(si.length>0){const ci=si[0].clone(),pi=si[0].clone();for(let fn=1;fn<si.length;fn++)ci.x=Math.min(ci.x,si[fn].x),ci.y=Math.min(ci.y,si[fn].y),pi.x=Math.max(pi.x,si[fn].x),pi.y=Math.max(pi.y,si[fn].y);Qt=ci.x>=pt.x&&pi.x<=_t.x&&ci.y>=pt.y&&pi.y<=_t.y?[si]:pi.x<pt.x||ci.x>_t.x||pi.y<pt.y||ci.y>_t.y?[]:a.al([si],pt.x,pt.y,_t.x,_t.y)}for(const ci of Qt){oi.reset(ci,.25*it);let pi=0;pi=oi.length<=.5*it?1:Math.ceil(oi.paddedLength/Si)+1;for(let fn=0;fn<pi;fn++){const Ri=fn/Math.max(pi-1,1),Rr=oi.lerp(Ri),On=Rr.x+ht,rn=Rr.y+ht;ye.push(On,rn,it,0);const Nn=On-it,Br=rn-it,vo=On+it,$o=rn+it;if(nt=nt&&this.isOffscreen(Nn,Br,vo,$o),Ke=Ke||this.isInsideGrid(Nn,Br,vo,$o),r!=="always"&&this.grid.hitTestCircle(On,rn,it,r,Z)&&(Xe=!0,!F))return{circles:[],offscreen:!1,collisionDetected:Xe}}}}return{circles:!F&&Xe||!Ke||Ge<this.perspectiveRatioCutoff?[]:ye,offscreen:nt,collisionDetected:Xe}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let p=1/0,m=1/0,v=-1/0,E=-1/0;for(const q of r){const Z=new a.P(q.x+ht,q.y+ht);p=Math.min(p,Z.x),m=Math.min(m,Z.y),v=Math.max(v,Z.x),E=Math.max(E,Z.y),h.push(Z)}const C=this.grid.query(p,m,v,E).concat(this.ignoredGrid.query(p,m,v,E)),L={},F={};for(const q of C){const Z=q.key;if(L[Z.bucketInstanceId]===void 0&&(L[Z.bucketInstanceId]={}),L[Z.bucketInstanceId][Z.featureIndex])continue;const J=[new a.P(q.x1,q.y1),new a.P(q.x2,q.y1),new a.P(q.x2,q.y2),new a.P(q.x1,q.y2)];a.am(h,J)&&(L[Z.bucketInstanceId][Z.featureIndex]=!0,F[Z.bucketInstanceId]===void 0&&(F[Z.bucketInstanceId]=[]),F[Z.bucketInstanceId].push(Z.featureIndex))}return F}insertCollisionBox(r,h,p,m,v,E){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:v,collisionGroupID:E,overlapMode:h},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,h,p,m,v,E){const C=p?this.ignoredGrid:this.grid,L={bucketInstanceId:m,featureIndex:v,collisionGroupID:E,overlapMode:h};for(let F=0;F<r.length;F+=4)C.insertCircle(L,r[F],r[F+1],r[F+2])}projectAndGetPerspectiveRatio(r,h,p,m){let v;return m?(v=[h,p,m(h,p),1],a.af(v,v,r)):(v=[h,p,0,1],Je(v,v,r)),{point:new a.P((v[0]/v[3]+1)/2*this.transform.width+ht,(-v[1]/v[3]+1)/2*this.transform.height+ht),perspectiveRatio:.5+this.transform.cameraToCenterDistance/v[3]*.5}}isOffscreen(r,h,p,m){return p<ht||r>=this.screenRightBoundary||m<ht||h>this.screenBottomBoundary}isInsideGrid(r,h,p,m){return p>=0&&r<this.gridRightBoundary&&m>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const r=a.an([]);return a.H(r,r,[-100,-100,0]),r}}function Xt(y,r,h){return r*(a.W/(y.tileSize*Math.pow(2,h-y.tileID.overscaledZ)))}class ai{constructor(r,h,p,m){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?h:-h))):m&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class vi{constructor(r,h,p,m,v){this.text=new ai(r?r.text:null,h,p,v),this.icon=new ai(r?r.icon:null,h,m,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ji{constructor(r,h,p){this.text=r,this.icon=h,this.skipFade=p}}class Mn{constructor(){this.invProjMatrix=a.F(),this.viewportMatrix=a.F(),this.circles=[]}}class li{constructor(r,h,p,m,v){this.bucketInstanceId=r,this.featureIndex=h,this.sourceLayerIndex=p,this.bucketIndex=m,this.tileID=v}}class un{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const h=++this.maxGroupID;this.collisionGroups[r]={ID:h,predicate:p=>p.collisionGroupID===h}}return this.collisionGroups[r]}}function Fn(y,r,h,p,m){const{horizontalAlign:v,verticalAlign:E}=a.at(y);return new a.P(-(v-.5)*r+p[0]*m,-(E-.5)*h+p[1]*m)}function ur(y,r,h,p,m,v){const{x1:E,x2:C,y1:L,y2:F,anchorPointX:q,anchorPointY:Z}=y,J=new a.P(r,h);return p&&J._rotate(m?v:-v),{x1:E+J.x,y1:L+J.y,x2:C+J.x,y2:F+J.y,anchorPointX:q,anchorPointY:Z}}class vr{constructor(r,h,p,m,v){this.transform=r.clone(),this.terrain=h,this.collisionIndex=new Rt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new un(m),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,h,p,m){const v=p.getBucket(h),E=p.latestFeatureIndex;if(!v||!E||h.id!==v.layerIds[0])return;const C=p.collisionBoxArray,L=v.layers[0].layout,F=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),q=p.tileSize/a.W,Z=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),J=L.get("text-pitch-alignment")==="map",me=L.get("text-rotation-alignment")==="map",pe=Xt(p,1,this.transform.zoom),ye=ti(Z,J,me,this.transform,pe);let se=null;if(J){const Ge=eo(Z,J,me,this.transform,pe);se=a.K([],this.transform.labelPlaneMatrix,Ge)}this.retainedQueryData[v.bucketInstanceId]=new li(v.bucketInstanceId,E,v.sourceLayerIndex,v.index,p.tileID);const Ee={bucket:v,layout:L,posMatrix:Z,textLabelPlaneMatrix:ye,labelToScreenMatrix:se,scale:F,textPixelRatio:q,holdingForFade:p.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:a.ag(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(m)for(const Ge of v.sortKeyRanges){const{sortKey:be,symbolInstanceStart:Ae,symbolInstanceEnd:He}=Ge;r.push({sortKey:be,symbolInstanceStart:Ae,symbolInstanceEnd:He,parameters:Ee})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:Ee})}attemptAnchorPlacement(r,h,p,m,v,E,C,L,F,q,Z,J,me,pe,ye,se){const Ee=a.ap[r.textAnchor],Ge=[r.textOffset0,r.textOffset1],be=Fn(Ee,p,m,Ge,v),Ae=this.collisionIndex.placeCollisionBox(ur(h,be.x,be.y,E,C,this.transform.angle),Z,L,F,q.predicate,se);if((!ye||this.collisionIndex.placeCollisionBox(ur(ye,be.x,be.y,E,C,this.transform.angle),Z,L,F,q.predicate,se).box.length!==0)&&Ae.box.length>0){let He;if(this.prevPlacement&&this.prevPlacement.variableOffsets[J.crossTileID]&&this.prevPlacement.placements[J.crossTileID]&&this.prevPlacement.placements[J.crossTileID].text&&(He=this.prevPlacement.variableOffsets[J.crossTileID].anchor),J.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[J.crossTileID]={textOffset:Ge,width:p,height:m,anchor:Ee,textBoxScale:v,prevAnchor:He},this.markUsedJustification(me,Ee,J,pe),me.allowVerticalPlacement&&(this.markUsedOrientation(me,pe,J),this.placedOrientations[J.crossTileID]=pe),{shift:be,placedGlyphBoxes:Ae}}}placeLayerBucketPart(r,h,p){const{bucket:m,layout:v,posMatrix:E,textLabelPlaneMatrix:C,labelToScreenMatrix:L,textPixelRatio:F,holdingForFade:q,collisionBoxArray:Z,partiallyEvaluatedTextSize:J,collisionGroup:me}=r.parameters,pe=v.get("text-optional"),ye=v.get("icon-optional"),se=a.aq(v,"text-overlap","text-allow-overlap"),Ee=se==="always",Ge=a.aq(v,"icon-overlap","icon-allow-overlap"),be=Ge==="always",Ae=v.get("text-rotation-alignment")==="map",He=v.get("text-pitch-alignment")==="map",Xe=v.get("icon-text-fit")!=="none",Ke=v.get("symbol-z-order")==="viewport-y",nt=Ee&&(be||!m.hasIconData()||ye),it=be&&(Ee||!m.hasTextData()||pe);!m.collisionArrays&&Z&&m.deserializeCollisionBoxes(Z);const pt=this.retainedQueryData[m.bucketInstanceId].tileID,_t=this.terrain?(yt,Kt)=>this.terrain.getElevation(pt,yt,Kt):null,oi=(yt,Kt)=>{var si,Si;if(h[yt.crossTileID])return;if(q)return void(this.placements[yt.crossTileID]=new Ji(!1,!1,!1));let Qt=!1,ci=!1,pi=!0,fn=null,Ri={box:null,offscreen:null},Rr={box:null,offscreen:null},On=null,rn=null,Nn=null,Br=0,vo=0,$o=0;Kt.textFeatureIndex?Br=Kt.textFeatureIndex:yt.useRuntimeCollisionCircles&&(Br=yt.featureIndex),Kt.verticalTextFeatureIndex&&(vo=Kt.verticalTextFeatureIndex);const Ia=Kt.textBox;if(Ia){const Ln=An=>{let sn=a.ah.horizontal;if(m.allowVerticalPlacement&&!An&&this.prevPlacement){const Kr=this.prevPlacement.placedOrientations[yt.crossTileID];Kr&&(this.placedOrientations[yt.crossTileID]=Kr,sn=Kr,this.markUsedOrientation(m,sn,yt))}return sn},on=(An,sn)=>{if(m.allowVerticalPlacement&&yt.numVerticalGlyphVertices>0&&Kt.verticalTextBox){for(const Kr of m.writingModes)if(Kr===a.ah.vertical?(Ri=sn(),Rr=Ri):Ri=An(),Ri&&Ri.box&&Ri.box.length)break}else Ri=An()},Qi=yt.textAnchorOffsetStartIndex,Xr=yt.textAnchorOffsetEndIndex;if(Xr===Qi){const An=(sn,Kr)=>{const Pn=this.collisionIndex.placeCollisionBox(sn,se,F,E,me.predicate,_t);return Pn&&Pn.box&&Pn.box.length&&(this.markUsedOrientation(m,Kr,yt),this.placedOrientations[yt.crossTileID]=Kr),Pn};on(()=>An(Ia,a.ah.horizontal),()=>{const sn=Kt.verticalTextBox;return m.allowVerticalPlacement&&yt.numVerticalGlyphVertices>0&&sn?An(sn,a.ah.vertical):{box:null,offscreen:null}}),Ln(Ri&&Ri.box&&Ri.box.length)}else{let An=a.ap[(Si=(si=this.prevPlacement)===null||si===void 0?void 0:si.variableOffsets[yt.crossTileID])===null||Si===void 0?void 0:Si.anchor];const sn=(Pn,yn,Fc)=>{const Lh=Pn.x2-Pn.x1,ds=Pn.y2-Pn.y1,fs=yt.textBoxScale,Sl=Xe&&Ge==="never"?yn:null;let Ko={box:[],offscreen:!1},Oc=se==="never"?1:2,Ah="never";An&&Oc++;for(let Nc=0;Nc<Oc;Nc++){for(let jc=Qi;jc<Xr;jc++){const Tl=m.textAnchorOffsets.get(jc);if(An&&Tl.textAnchor!==An)continue;const Uc=this.attemptAnchorPlacement(Tl,Pn,Lh,ds,fs,Ae,He,F,E,me,Ah,yt,m,Fc,Sl,_t);if(Uc&&(Ko=Uc.placedGlyphBoxes,Ko&&Ko.box&&Ko.box.length))return Qt=!0,fn=Uc.shift,Ko}An?An=null:Ah=se}return Ko};on(()=>sn(Ia,Kt.iconBox,a.ah.horizontal),()=>{const Pn=Kt.verticalTextBox;return m.allowVerticalPlacement&&!(Ri&&Ri.box&&Ri.box.length)&&yt.numVerticalGlyphVertices>0&&Pn?sn(Pn,Kt.verticalIconBox,a.ah.vertical):{box:null,offscreen:null}}),Ri&&(Qt=Ri.box,pi=Ri.offscreen);const Kr=Ln(Ri&&Ri.box);if(!Qt&&this.prevPlacement){const Pn=this.prevPlacement.variableOffsets[yt.crossTileID];Pn&&(this.variableOffsets[yt.crossTileID]=Pn,this.markUsedJustification(m,Pn.anchor,yt,Kr))}}}if(On=Ri,Qt=On&&On.box&&On.box.length>0,pi=On&&On.offscreen,yt.useRuntimeCollisionCircles){const Ln=m.text.placedSymbolArray.get(yt.centerJustifiedTextSymbolIndex),on=a.ai(m.textSizeData,J,Ln),Qi=v.get("text-padding");rn=this.collisionIndex.placeCollisionCircles(se,Ln,m.lineVertexArray,m.glyphOffsetArray,on,E,C,L,p,He,me.predicate,yt.collisionCircleDiameter,Qi,_t),rn.circles.length&&rn.collisionDetected&&!p&&a.w("Collisions detected, but collision boxes are not shown"),Qt=Ee||rn.circles.length>0&&!rn.collisionDetected,pi=pi&&rn.offscreen}if(Kt.iconFeatureIndex&&($o=Kt.iconFeatureIndex),Kt.iconBox){const Ln=on=>{const Qi=Xe&&fn?ur(on,fn.x,fn.y,Ae,He,this.transform.angle):on;return this.collisionIndex.placeCollisionBox(Qi,Ge,F,E,me.predicate,_t)};Rr&&Rr.box&&Rr.box.length&&Kt.verticalIconBox?(Nn=Ln(Kt.verticalIconBox),ci=Nn.box.length>0):(Nn=Ln(Kt.iconBox),ci=Nn.box.length>0),pi=pi&&Nn.offscreen}const Xo=pe||yt.numHorizontalGlyphVertices===0&&yt.numVerticalGlyphVertices===0,bo=ye||yt.numIconVertices===0;if(Xo||bo?bo?Xo||(ci=ci&&Qt):Qt=ci&&Qt:ci=Qt=ci&&Qt,Qt&&On&&On.box&&this.collisionIndex.insertCollisionBox(On.box,se,v.get("text-ignore-placement"),m.bucketInstanceId,Rr&&Rr.box&&vo?vo:Br,me.ID),ci&&Nn&&this.collisionIndex.insertCollisionBox(Nn.box,Ge,v.get("icon-ignore-placement"),m.bucketInstanceId,$o,me.ID),rn&&(Qt&&this.collisionIndex.insertCollisionCircles(rn.circles,se,v.get("text-ignore-placement"),m.bucketInstanceId,Br,me.ID),p)){const Ln=m.bucketInstanceId;let on=this.collisionCircleArrays[Ln];on===void 0&&(on=this.collisionCircleArrays[Ln]=new Mn);for(let Qi=0;Qi<rn.circles.length;Qi+=4)on.circles.push(rn.circles[Qi+0]),on.circles.push(rn.circles[Qi+1]),on.circles.push(rn.circles[Qi+2]),on.circles.push(rn.collisionDetected?1:0)}if(yt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[yt.crossTileID]=new Ji(Qt||nt,ci||it,pi||m.justReloaded),h[yt.crossTileID]=!0};if(Ke){if(r.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const yt=m.getSortedSymbolIndexes(this.transform.angle);for(let Kt=yt.length-1;Kt>=0;--Kt){const si=yt[Kt];oi(m.symbolInstances.get(si),m.collisionArrays[si])}}else for(let yt=r.symbolInstanceStart;yt<r.symbolInstanceEnd;yt++)oi(m.symbolInstances.get(yt),m.collisionArrays[yt]);if(p&&m.bucketInstanceId in this.collisionCircleArrays){const yt=this.collisionCircleArrays[m.bucketInstanceId];a.ar(yt.invProjMatrix,E),yt.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(r,h,p,m){let v;v=m===a.ah.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[a.as(h)];const E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const C of E)C>=0&&(r.text.placedSymbolArray.get(C).crossTileID=v>=0&&C!==v?0:p.crossTileID)}markUsedOrientation(r,h,p){const m=h===a.ah.horizontal||h===a.ah.horizontalOnly?h:0,v=h===a.ah.vertical?h:0,E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const C of E)r.text.placedSymbolArray.get(C).placedOrientation=m;p.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let p=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const m=h?h.symbolFadeChange(r):1,v=h?h.opacities:{},E=h?h.variableOffsets:{},C=h?h.placedOrientations:{};for(const L in this.placements){const F=this.placements[L],q=v[L];q?(this.opacities[L]=new vi(q,m,F.text,F.icon),p=p||F.text!==q.text.placed||F.icon!==q.icon.placed):(this.opacities[L]=new vi(null,m,F.text,F.icon,F.skipFade),p=p||F.text||F.icon)}for(const L in v){const F=v[L];if(!this.opacities[L]){const q=new vi(F,m,!1,!1);q.isHidden()||(this.opacities[L]=q,p=p||F.text.placed||F.icon.placed)}}for(const L in E)this.variableOffsets[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.variableOffsets[L]=E[L]);for(const L in C)this.placedOrientations[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.placedOrientations[L]=C[L]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:r)}updateLayerOpacities(r,h){const p={};for(const m of h){const v=m.getBucket(r);v&&m.latestFeatureIndex&&r.id===v.layerIds[0]&&this.updateBucketOpacities(v,p,m.collisionBoxArray)}}updateBucketOpacities(r,h,p){r.hasTextData()&&(r.text.opacityVertexArray.clear(),r.text.hasVisibleVertices=!1),r.hasIconData()&&(r.icon.opacityVertexArray.clear(),r.icon.hasVisibleVertices=!1),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const m=r.layers[0],v=m.layout,E=new vi(null,0,!1,!1,!0),C=v.get("text-allow-overlap"),L=v.get("icon-allow-overlap"),F=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),q=v.get("text-rotation-alignment")==="map",Z=v.get("text-pitch-alignment")==="map",J=v.get("icon-text-fit")!=="none",me=new vi(null,0,C&&(L||!r.hasIconData()||v.get("icon-optional")),L&&(C||!r.hasTextData()||v.get("text-optional")),!0);!r.collisionArrays&&p&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(p);const pe=(ye,se,Ee)=>{for(let Ge=0;Ge<se/4;Ge++)ye.opacityVertexArray.emplaceBack(Ee);ye.hasVisibleVertices=ye.hasVisibleVertices||Ee!==aa};for(let ye=0;ye<r.symbolInstances.length;ye++){const se=r.symbolInstances.get(ye),{numHorizontalGlyphVertices:Ee,numVerticalGlyphVertices:Ge,crossTileID:be}=se;let Ae=this.opacities[be];h[be]?Ae=E:Ae||(Ae=me,this.opacities[be]=Ae),h[be]=!0;const He=se.numIconVertices>0,Xe=this.placedOrientations[se.crossTileID],Ke=Xe===a.ah.vertical,nt=Xe===a.ah.horizontal||Xe===a.ah.horizontalOnly;if(Ee>0||Ge>0){const it=br(Ae.text);pe(r.text,Ee,Ke?aa:it),pe(r.text,Ge,nt?aa:it);const pt=Ae.text.isHidden();[se.rightJustifiedTextSymbolIndex,se.centerJustifiedTextSymbolIndex,se.leftJustifiedTextSymbolIndex].forEach(yt=>{yt>=0&&(r.text.placedSymbolArray.get(yt).hidden=pt||Ke?1:0)}),se.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(se.verticalPlacedTextSymbolIndex).hidden=pt||nt?1:0);const _t=this.variableOffsets[se.crossTileID];_t&&this.markUsedJustification(r,_t.anchor,se,Xe);const oi=this.placedOrientations[se.crossTileID];oi&&(this.markUsedJustification(r,"left",se,oi),this.markUsedOrientation(r,oi,se))}if(He){const it=br(Ae.icon),pt=!(J&&se.verticalPlacedIconSymbolIndex&&Ke);se.placedIconSymbolIndex>=0&&(pe(r.icon,se.numIconVertices,pt?it:aa),r.icon.placedSymbolArray.get(se.placedIconSymbolIndex).hidden=Ae.icon.isHidden()),se.verticalPlacedIconSymbolIndex>=0&&(pe(r.icon,se.numVerticalIconVertices,pt?aa:it),r.icon.placedSymbolArray.get(se.verticalPlacedIconSymbolIndex).hidden=Ae.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const it=r.collisionArrays[ye];if(it){let pt=new a.P(0,0);if(it.textBox||it.verticalTextBox){let oi=!0;if(F){const yt=this.variableOffsets[be];yt?(pt=Fn(yt.anchor,yt.width,yt.height,yt.textOffset,yt.textBoxScale),q&&pt._rotate(Z?this.transform.angle:-this.transform.angle)):oi=!1}it.textBox&&Xn(r.textCollisionBox.collisionVertexArray,Ae.text.placed,!oi||Ke,pt.x,pt.y),it.verticalTextBox&&Xn(r.textCollisionBox.collisionVertexArray,Ae.text.placed,!oi||nt,pt.x,pt.y)}const _t=!!(!nt&&it.verticalIconBox);it.iconBox&&Xn(r.iconCollisionBox.collisionVertexArray,Ae.icon.placed,_t,J?pt.x:0,J?pt.y:0),it.verticalIconBox&&Xn(r.iconCollisionBox.collisionVertexArray,Ae.icon.placed,!_t,J?pt.x:0,J?pt.y:0)}}}if(r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.text.opacityVertexArray.length!==r.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${r.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${r.text.layoutVertexArray.length}) / 4`);if(r.icon.opacityVertexArray.length!==r.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${r.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${r.icon.layoutVertexArray.length}) / 4`);if(r.bucketInstanceId in this.collisionCircleArrays){const ye=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=ye.invProjMatrix,r.placementViewportMatrix=ye.viewportMatrix,r.collisionCircleArray=ye.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,h){const p=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*p>r}setStale(){this.stale=!0}}function Xn(y,r,h,p,m){y.emplaceBack(r?1:0,h?1:0,p||0,m||0),y.emplaceBack(r?1:0,h?1:0,p||0,m||0),y.emplaceBack(r?1:0,h?1:0,p||0,m||0),y.emplaceBack(r?1:0,h?1:0,p||0,m||0)}const po=Math.pow(2,25),Hu=Math.pow(2,24),Ld=Math.pow(2,17),zi=Math.pow(2,16),oc=Math.pow(2,9),sc=Math.pow(2,8),Pr=Math.pow(2,1);function br(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const r=y.placed?1:0,h=Math.floor(127*y.opacity);return h*po+r*Hu+h*Ld+r*zi+h*oc+r*sc+h*Pr+r}const aa=0;class Hr{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&!r.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,h,p,m,v){const E=this._bucketParts;for(;this._currentTileIndex<r.length;)if(h.getBucketParts(E,m,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((C,L)=>C.sortKey-L.sortKey));this._currentPartIndex<E.length;)if(h.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,v())return!0;return!1}}class $r{constructor(r,h,p,m,v,E,C,L){this.placement=new vr(r,h,E,C,L),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(r,h,p){const m=k.now(),v=()=>!this._forceFullPlacement&&k.now()-m>2;for(;this._currentPlacementIndex>=0;){const E=h[r[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=C)&&(!E.maxzoom||E.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new Hr(E)),this._inProgressLayer.continuePlacement(p[E.source],this.placement,this._showCollisionBoxes,E,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const As=512/a.W/2;class Na{constructor(r,h,p){this.tileID=r,this.bucketInstanceId=p,this._symbolsByKey={};const m=new Map;for(let v=0;v<h.length;v++){const E=h.get(v),C=E.key,L=m.get(C);L?L.push(E):m.set(C,[E])}for(const[v,E]of m){const C={positions:E.map(L=>({x:Math.floor(L.anchorX*As),y:Math.floor(L.anchorY*As)})),crossTileIDs:E.map(L=>L.crossTileID)};if(C.positions.length>128){const L=new a.au(C.positions.length,16,Uint16Array);for(const{x:F,y:q}of C.positions)L.add(F,q);L.finish(),delete C.positions,C.index=L}this._symbolsByKey[v]=C}}getScaledCoordinates(r,h){const{x:p,y:m,z:v}=this.tileID.canonical,{x:E,y:C,z:L}=h.canonical,F=As/Math.pow(2,L-v),q=(C*a.W+r.anchorY)*F,Z=m*a.W*As;return{x:Math.floor((E*a.W+r.anchorX)*F-p*a.W*As),y:Math.floor(q-Z)}}findMatches(r,h,p){const m=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let v=0;v<r.length;v++){const E=r.get(v);if(E.crossTileID)continue;const C=this._symbolsByKey[E.key];if(!C)continue;const L=this.getScaledCoordinates(E,h);if(C.index){const F=C.index.range(L.x-m,L.y-m,L.x+m,L.y+m).sort();for(const q of F){const Z=C.crossTileIDs[q];if(!p[Z]){p[Z]=!0,E.crossTileID=Z;break}}}else if(C.positions)for(let F=0;F<C.positions.length;F++){const q=C.positions[F],Z=C.crossTileIDs[F];if(Math.abs(q.x-L.x)<=m&&Math.abs(q.y-L.y)<=m&&!p[Z]){p[Z]=!0,E.crossTileID=Z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:r})=>r)}}class In{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class la{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const h=Math.round((r-this.lng)/360);if(h!==0)for(const p in this.indexes){const m=this.indexes[p],v={};for(const E in m){const C=m[E];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+h),v[C.tileID.key]=C}this.indexes[p]=v}this.lng=r}addBucket(r,h,p){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let v=0;v<h.symbolInstances.length;v++)h.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const m=this.usedCrossTileIDs[r.overscaledZ];for(const v in this.indexes){const E=this.indexes[v];if(Number(v)>r.overscaledZ)for(const C in E){const L=E[C];L.tileID.isChildOf(r)&&L.findMatches(h.symbolInstances,r,m)}else{const C=E[r.scaledTo(Number(v)).key];C&&C.findMatches(h.symbolInstances,r,m)}}for(let v=0;v<h.symbolInstances.length;v++){const E=h.symbolInstances.get(v);E.crossTileID||(E.crossTileID=p.generate(),m[E.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Na(r,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(r,h){for(const p of h.getCrossTileIDsLists())for(const m of p)delete this.usedCrossTileIDs[r][m]}removeStaleBuckets(r){let h=!1;for(const p in this.indexes){const m=this.indexes[p];for(const v in m)r[m[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,m[v]),delete m[v],h=!0)}return h}}class Vo{constructor(){this.layerIndexes={},this.crossTileIDs=new In,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,h,p){let m=this.layerIndexes[r.id];m===void 0&&(m=this.layerIndexes[r.id]=new la);let v=!1;const E={};m.handleWrapJump(p);for(const C of h){const L=C.getBucket(r);L&&r.id===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(C.tileID,L,this.crossTileIDs)&&(v=!0),E[L.bucketInstanceId]=!0)}return m.removeStaleBuckets(E)&&(v=!0),v}pruneUnusedLayers(r){const h={};r.forEach(p=>{h[p]=!0});for(const p in this.layerIndexes)h[p]||delete this.layerIndexes[p]}}const nn=(y,r)=>a.t(y,r&&r.filter(h=>h.identifier!=="source.canvas")),ja=a.av();class zr extends a.E{constructor(r,h={}){super(),this._rtlPluginLoaded=()=>{for(const p in this.sourceCaches){const m=this.sourceCaches[p].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[p].reload()}},this.map=r,this.dispatcher=new xi(hi(),r._getMapId()),this.dispatcher.registerMessageHandler("GG",(p,m)=>this.getGlyphs(p,m)),this.dispatcher.registerMessageHandler("GI",(p,m)=>this.getImages(p,m)),this.imageManager=new qe,this.imageManager.setEventedParent(this),this.glyphManager=new ft(r._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Ft(256,512),this.crossTileSymbolIndex=new Vo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.ax()),ut().on(ir,this._rtlPluginLoaded),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const m=this.sourceCaches[p.sourceId];if(!m)return;const v=m.getSource();if(v&&v.vectorLayerIds)for(const E in this._layers){const C=this._layers[E];C.source===v.id&&this._validateLayer(C)}})}loadURL(r,h={},p){this.fire(new a.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const m=this.map._requestManager.transformRequest(r,"Style");this._loadStyleRequest=new AbortController,a.h(m,this._loadStyleRequest).then(v=>{this._loadStyleRequest=null,this._load(v.data,h,p)}).catch(v=>{this._loadStyleRequest=null,v&&this.fire(new a.j(v))})}loadJSON(r,h={},p){this.fire(new a.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,k.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(r,h,p)}).catch(()=>{})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(ja,{validate:!1})}_load(r,h,p){var m;const v=h.transformStyle?h.transformStyle(p,r):r;if(!h.validate||!nn(this,a.x(v))){this._loaded=!0,this.stylesheet=v;for(const E in v.sources)this.addSource(E,v.sources[E],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new ii(this.stylesheet.light),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const r=a.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",r),this._order=r.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of r){const p=a.az(h);p.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=p}}_loadSprite(r,h=!1,p=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(v,E,C,L){return a._(this,void 0,void 0,function*(){const F=Be(v),q=C>1?"@2x":"",Z={},J={};for(const{id:me,url:pe}of F){const ye=E.transformRequest(E.normalizeSpriteURL(pe,q,".json"),"SpriteJSON");Z[me]=a.h(ye,L);const se=E.transformRequest(E.normalizeSpriteURL(pe,q,".png"),"SpriteImage");J[me]=V.getImage(se,L)}return yield Promise.all([...Object.values(Z),...Object.values(J)]),function(me,pe){return a._(this,void 0,void 0,function*(){const ye={};for(const se in me){ye[se]={};const Ee=k.getImageCanvasContext((yield pe[se]).data),Ge=(yield me[se]).data;for(const be in Ge){const{width:Ae,height:He,x:Xe,y:Ke,sdf:nt,pixelRatio:it,stretchX:pt,stretchY:_t,content:oi}=Ge[be];ye[se][be]={data:null,pixelRatio:it,sdf:nt,stretchX:pt,stretchY:_t,content:oi,spriteData:{width:Ae,height:He,x:Xe,y:Ke,context:Ee}}}}return ye})}(Z,J)})}(r,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(v=>{if(this._spriteRequest=null,v)for(const E in v){this._spritesImagesIds[E]=[];const C=this._spritesImagesIds[E]?this._spritesImagesIds[E].filter(L=>!(L in v)):[];for(const L of C)this.imageManager.removeImage(L),this._changedImages[L]=!0;for(const L in v[E]){const F=E==="default"?L:`${E}:${L}`;this._spritesImagesIds[E].push(F),F in this.imageManager.images?this.imageManager.updateImage(F,v[E][L],!1):this.imageManager.addImage(F,v[E][L]),h&&(this._changedImages[F]=!0)}}}).catch(v=>{this._spriteRequest=null,m=v,this.fire(new a.j(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),p&&p(m)})}_unloadSprite(){for(const r of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(r),this._changedImages[r]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(r){const h=this.sourceCaches[r.source];if(!h)return;const p=r.sourceLayer;if(!p)return;const m=h.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(p)===-1)&&this.fire(new a.j(new Error(`Source layer "${p}" does not exist on source "${m.id}" as specified by style layer "${r.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this.sourceCaches)if(!this.sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(r){const h=this._serializedAllLayers();if(!r||r.length===0)return Object.values(h);const p=[];for(const m of r)h[m]&&p.push(h[m]);return p}_serializedAllLayers(){let r=this._serializedLayers;if(r)return r;r=this._serializedLayers={};const h=Object.keys(this._layers);for(const p of h){const m=this._layers[p];m.type!=="custom"&&(r[p]=m.serialize())}return r}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const r in this.sourceCaches)if(this.sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(r){if(!this._loaded)return;const h=this._changed;if(h){const m=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(m.length||v.length)&&this._updateWorkerLayers(m,v);for(const E in this._updatedSources){const C=this._updatedSources[E];if(C==="reload")this._reloadSource(E);else{if(C!=="clear")throw new Error(`Invalid action ${C}`);this._clearSource(E)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(r);this.light.updateTransitions(r),this._resetUpdates()}const p={};for(const m in this.sourceCaches){const v=this.sourceCaches[m];p[m]=v.used,v.used=!1}for(const m of this._order){const v=this._layers[m];v.recalculate(r,this._availableImages),!v.isHidden(r.zoom)&&v.source&&(this.sourceCaches[v.source].used=!0)}for(const m in p){const v=this.sourceCaches[m];!!p[m]!=!!v.used&&v.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(r),this.z=r.zoom,h&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(r,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(r),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(r,h={}){var p;this._checkLoaded();const m=this.serialize();if(r=h.transformStyle?h.transformStyle(m,r):r,((p=h.validate)===null||p===void 0||p)&&nn(this,a.x(r)))return!1;(r=a.aA(r)).layers=a.ay(r.layers);const v=a.aB(m,r),E=this._getOperationsToPerform(v);if(E.unimplemented.length>0)throw new Error(`Unimplemented: ${E.unimplemented.join(", ")}.`);if(E.operations.length===0)return!1;for(const C of E.operations)C();return this.stylesheet=r,this._serializedLayers=null,!0}_getOperationsToPerform(r){const h=[],p=[];for(const m of r)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":h.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":h.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,m.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setTransition":h.push(()=>{});break;default:p.push(m.command)}return{operations:h,unimplemented:p}}addImage(r,h){if(this.getImage(r))return this.fire(new a.j(new Error(`An image named "${r}" already exists.`)));this.imageManager.addImage(r,h),this._afterImageUpdated(r)}updateImage(r,h){this.imageManager.updateImage(r,h)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){if(!this.getImage(r))return this.fire(new a.j(new Error(`An image named "${r}" does not exist.`)));this.imageManager.removeImage(r),this._afterImageUpdated(r)}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(r,h,p={}){if(this._checkLoaded(),this.sourceCaches[r]!==void 0)throw new Error(`Source "${r}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(a.x.source,`sources.${r}`,h,null,p))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const m=this.sourceCaches[r]=new Vi(r,h,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:r})),m.onAdd(this.map),this._changed=!0}removeSource(r){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===r)return this.fire(new a.j(new Error(`Source "${r}" cannot be removed while layer "${p}" is using it.`)));const h=this.sourceCaches[r];delete this.sourceCaches[r],delete this._updatedSources[r],h.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:r})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(r,h){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error(`There is no source with this ID=${r}`);const p=this.sourceCaches[r].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(h),this._changed=!0}getSource(r){return this.sourceCaches[r]&&this.sourceCaches[r].getSource()}addLayer(r,h,p={}){this._checkLoaded();const m=r.id;if(this.getLayer(m))return void this.fire(new a.j(new Error(`Layer "${m}" already exists on this map.`)));let v;if(r.type==="custom"){if(nn(this,a.aC(r)))return;v=a.az(r)}else{if("source"in r&&typeof r.source=="object"&&(this.addSource(m,r.source),r=a.aA(r),r=a.e(r,{source:m})),this._validate(a.x.layer,`layers.${m}`,r,{arrayIndex:-1},p))return;v=a.az(r),this._validateLayer(v),v.setEventedParent(this,{layer:{id:m}})}const E=h?this._order.indexOf(h):this._order.length;if(h&&E===-1)this.fire(new a.j(new Error(`Cannot add layer "${m}" before non-existing layer "${h}".`)));else{if(this._order.splice(E,0,m),this._layerOrderChanged=!0,this._layers[m]=v,this._removedLayers[m]&&v.source&&v.type!=="custom"){const C=this._removedLayers[m];delete this._removedLayers[m],C.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.sourceCaches[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(r,h){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new a.j(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===h)return;const p=this._order.indexOf(r);this._order.splice(p,1);const m=h?this._order.indexOf(h):this._order.length;h&&m===-1?this.fire(new a.j(new Error(`Cannot move layer "${r}" before non-existing layer "${h}".`))):(this._order.splice(m,0,r),this._layerOrderChanged=!0)}removeLayer(r){this._checkLoaded();const h=this._layers[r];if(!h)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${r}".`)));h.setEventedParent(null);const p=this._order.indexOf(r);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=h,delete this._layers[r],this._serializedLayers&&delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],h.onRemove&&h.onRemove(this.map)}getLayer(r){return this._layers[r]}getLayersOrder(){return[...this._order]}hasLayer(r){return r in this._layers}setLayerZoomRange(r,h,p){this._checkLoaded();const m=this.getLayer(r);m?m.minzoom===h&&m.maxzoom===p||(h!=null&&(m.minzoom=h),p!=null&&(m.maxzoom=p),this._updateLayer(m)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${r}".`)))}setFilter(r,h,p={}){this._checkLoaded();const m=this.getLayer(r);if(m){if(!a.aD(m.filter,h))return h==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(a.x.filter,`layers.${m.id}.filter`,h,null,p)||(m.filter=a.aA(h),this._updateLayer(m)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${r}".`)))}getFilter(r){return a.aA(this.getLayer(r).filter)}setLayoutProperty(r,h,p,m={}){this._checkLoaded();const v=this.getLayer(r);v?a.aD(v.getLayoutProperty(h),p)||(v.setLayoutProperty(h,p,m),this._updateLayer(v)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${r}".`)))}getLayoutProperty(r,h){const p=this.getLayer(r);if(p)return p.getLayoutProperty(h);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${r}".`)))}setPaintProperty(r,h,p,m={}){this._checkLoaded();const v=this.getLayer(r);v?a.aD(v.getPaintProperty(h),p)||(v.setPaintProperty(h,p,m)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[r]=!0,this._serializedLayers=null):this.fire(new a.j(new Error(`Cannot style non-existing layer "${r}".`)))}getPaintProperty(r,h){return this.getLayer(r).getPaintProperty(h)}setFeatureState(r,h){this._checkLoaded();const p=r.source,m=r.sourceLayer,v=this.sourceCaches[p];if(v===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const E=v.getSource().type;E==="geojson"&&m?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||m?(r.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),v.setFeatureState(m,r.id,h)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(r,h){this._checkLoaded();const p=r.source,m=this.sourceCaches[p];if(m===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const v=m.getSource().type,E=v==="vector"?r.sourceLayer:void 0;v!=="vector"||E?h&&typeof r.id!="string"&&typeof r.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(E,r.id,h):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(r){this._checkLoaded();const h=r.source,p=r.sourceLayer,m=this.sourceCaches[h];if(m!==void 0)return m.getSource().type!=="vector"||p?(r.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(p,r.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const r=a.aE(this.sourceCaches,v=>v.serialize()),h=this._serializeByIds(this._order),p=this.map.getTerrain()||void 0,m=this.stylesheet;return a.aF({version:m.version,name:m.name,metadata:m.metadata,light:m.light,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:r,layers:h,terrain:p},v=>v!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0,r.source&&!this._updatedSources[r.source]&&this.sourceCaches[r.source].getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",this.sourceCaches[r.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(r){const h=E=>this._layers[E].type==="fill-extrusion",p={},m=[];for(let E=this._order.length-1;E>=0;E--){const C=this._order[E];if(h(C)){p[C]=E;for(const L of r){const F=L[C];if(F)for(const q of F)m.push(q)}}}m.sort((E,C)=>C.intersectionZ-E.intersectionZ);const v=[];for(let E=this._order.length-1;E>=0;E--){const C=this._order[E];if(h(C))for(let L=m.length-1;L>=0;L--){const F=m[L].feature;if(p[F.layer.id]<E)break;v.push(F),m.pop()}else for(const L of r){const F=L[C];if(F)for(const q of F)v.push(q.feature)}}return v}queryRenderedFeatures(r,h,p){h&&h.filter&&this._validate(a.x.filter,"queryRenderedFeatures.filter",h.filter,null,h);const m={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const C of h.layers){const L=this._layers[C];if(!L)return this.fire(new a.j(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];m[L.source]=!0}}const v=[];h.availableImages=this._availableImages;const E=this._serializedAllLayers();for(const C in this.sourceCaches)h.layers&&!m[C]||v.push(ct(this.sourceCaches[C],this._layers,E,r,h,p));return this.placement&&v.push(function(C,L,F,q,Z,J,me){const pe={},ye=J.queryRenderedSymbols(q),se=[];for(const Ee of Object.keys(ye).map(Number))se.push(me[Ee]);se.sort(It);for(const Ee of se){const Ge=Ee.featureIndex.lookupSymbolFeatures(ye[Ee.bucketInstanceId],L,Ee.bucketIndex,Ee.sourceLayerIndex,Z.filter,Z.layers,Z.availableImages,C);for(const be in Ge){const Ae=pe[be]=pe[be]||[],He=Ge[be];He.sort((Xe,Ke)=>{const nt=Ee.featureSortOrder;if(nt){const it=nt.indexOf(Xe.featureIndex);return nt.indexOf(Ke.featureIndex)-it}return Ke.featureIndex-Xe.featureIndex});for(const Xe of He)Ae.push(Xe)}}for(const Ee in pe)pe[Ee].forEach(Ge=>{const be=Ge.feature,Ae=F[C[Ee].source].getFeatureState(be.layer["source-layer"],be.id);be.source=be.layer.source,be.layer["source-layer"]&&(be.sourceLayer=be.layer["source-layer"]),be.state=Ae});return pe}(this._layers,E,this.sourceCaches,r,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(r,h){h&&h.filter&&this._validate(a.x.filter,"querySourceFeatures.filter",h.filter,null,h);const p=this.sourceCaches[r];return p?function(m,v){const E=m.getRenderableIds().map(F=>m.getTileByID(F)),C=[],L={};for(let F=0;F<E.length;F++){const q=E[F],Z=q.tileID.canonical.key;L[Z]||(L[Z]=!0,q.querySourceFeatures(C,v))}return C}(p,h):[]}getLight(){return this.light.getLight()}setLight(r,h={}){this._checkLoaded();const p=this.light.getLight();let m=!1;for(const E in r)if(!a.aD(r[E],p[E])){m=!0;break}if(!m)return;const v={now:k.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,h),this.light.updateTransitions(v)}_validate(r,h,p,m,v={}){return(!v||v.validate!==!1)&&nn(this,r.call(a.x,a.e({key:h,style:this.serialize(),value:p,styleSpec:a.v},m)))}_remove(r=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ut().off(ir,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const p=this.sourceCaches[h];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),r&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(r)}_clearSource(r){this.sourceCaches[r].clearTiles()}_reloadSource(r){this.sourceCaches[r].resume(),this.sourceCaches[r].reload()}_updateSources(r){for(const h in this.sourceCaches)this.sourceCaches[h].update(r,this.map.terrain)}_generateCollisionBoxes(){for(const r in this.sourceCaches)this._reloadSource(r)}_updatePlacement(r,h,p,m,v=!1){let E=!1,C=!1;const L={};for(const F of this._order){const q=this._layers[F];if(q.type!=="symbol")continue;if(!L[q.source]){const J=this.sourceCaches[q.source];L[q.source]=J.getRenderableIds(!0).map(me=>J.getTileByID(me)).sort((me,pe)=>pe.tileID.overscaledZ-me.tileID.overscaledZ||(me.tileID.isLessThan(pe.tileID)?-1:1))}const Z=this.crossTileSymbolIndex.addLayer(q,L[q.source],r.center.lng);E=E||Z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(k.now(),r.zoom))&&(this.pauseablePlacement=new $r(r,this.map.terrain,this._order,v,h,p,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,L),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(k.now()),C=!0),E&&this.pauseablePlacement.placement.setStale()),C||E)for(const F of this._order){const q=this._layers[F];q.type==="symbol"&&this.placement.updateLayerOpacities(q,L[q.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(k.now())}_releaseSymbolFadeTiles(){for(const r in this.sourceCaches)this.sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,h){return a._(this,void 0,void 0,function*(){const p=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,h.icons),p})}getGlyphs(r,h){return a._(this,void 0,void 0,function*(){const p=yield this.glyphManager.getGlyphs(h.stacks),m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,[""]),p})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(r,h={}){this._checkLoaded(),r&&this._validate(a.x.glyphs,"glyphs",r,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=r,this.glyphManager.entries={},this.glyphManager.setURL(r))}addSprite(r,h,p={},m){this._checkLoaded();const v=[{id:r,url:h}],E=[...Be(this.stylesheet.sprite),...v];this._validate(a.x.sprite,"sprite",E,null,p)||(this.stylesheet.sprite=E,this._loadSprite(v,!0,m))}removeSprite(r){this._checkLoaded();const h=Be(this.stylesheet.sprite);if(h.find(p=>p.id===r)){if(this._spritesImagesIds[r])for(const p of this._spritesImagesIds[r])this.imageManager.removeImage(p),this._changedImages[p]=!0;h.splice(h.findIndex(p=>p.id===r),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[r],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${r}" doesn't exists on this map.`)))}getSprite(){return Be(this.stylesheet.sprite)}setSprite(r,h={},p){this._checkLoaded(),r&&this._validate(a.x.sprite,"sprite",r,null,h)||(this.stylesheet.sprite=r,r?this._loadSprite(r,!0,p):(this._unloadSprite(),p&&p(null)))}}var Ua=a.X([{name:"a_pos",type:"Int16",components:2}]),mo="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const ca={prelude:Di(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Di(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Di(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Di(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Di("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Di(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Di(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Di("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Di("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Di("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Di(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Di(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Di(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Di(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Di(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Di(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Di(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Di(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Di(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Di(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Di(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Di(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Di(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Di(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Di(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Di(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Di("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",mo),terrainDepth:Di("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",mo),terrainCoords:Di("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",mo)};function Di(y,r){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=r.match(/attribute ([\w]+) ([\w]+)/g),m=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=r.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=v?v.concat(m):m,C={};return{fragmentSource:y=y.replace(h,(L,F,q,Z,J)=>(C[J]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${J}
varying ${q} ${Z} ${J};
#else
uniform ${q} ${Z} u_${J};
#endif
`:`
#ifdef HAS_UNIFORM_u_${J}
    ${q} ${Z} ${J} = u_${J};
#endif
`)),vertexSource:r=r.replace(h,(L,F,q,Z,J)=>{const me=Z==="float"?"vec2":"vec4",pe=J.match(/color/)?"color":me;return C[J]?F==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
attribute ${q} ${me} a_${J};
varying ${q} ${Z} ${J};
#else
uniform ${q} ${Z} u_${J};
#endif
`:pe==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = a_${J};
#else
    ${q} ${Z} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = unpack_mix_${pe}(a_${J}, u_${J}_t);
#else
    ${q} ${Z} ${J} = u_${J};
#endif
`:F==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
attribute ${q} ${me} a_${J};
#else
uniform ${q} ${Z} u_${J};
#endif
`:pe==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${q} ${Z} ${J} = a_${J};
#else
    ${q} ${Z} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    ${q} ${Z} ${J} = unpack_mix_${pe}(a_${J}, u_${J}_t);
#else
    ${q} ${Z} ${J} = u_${J};
#endif
`}),staticAttributes:p,staticUniforms:E}}class Va{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,h,p,m,v,E,C,L,F){this.context=r;let q=this.boundPaintVertexBuffers.length!==m.length;for(let Z=0;!q&&Z<m.length;Z++)this.boundPaintVertexBuffers[Z]!==m[Z]&&(q=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==p||q||this.boundIndexBuffer!==v||this.boundVertexOffset!==E||this.boundDynamicVertexBuffer!==C||this.boundDynamicVertexBuffer2!==L||this.boundDynamicVertexBuffer3!==F?this.freshBind(h,p,m,v,E,C,L,F):(r.bindVertexArray.set(this.vao),C&&C.bind(),v&&v.dynamicDraw&&v.bind(),L&&L.bind(),F&&F.bind())}freshBind(r,h,p,m,v,E,C,L){const F=r.numAttributes,q=this.context,Z=q.gl;this.vao&&this.destroy(),this.vao=q.createVertexArray(),q.bindVertexArray.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=m,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=C,this.boundDynamicVertexBuffer3=L,h.enableAttributes(Z,r);for(const J of p)J.enableAttributes(Z,r);E&&E.enableAttributes(Z,r),C&&C.enableAttributes(Z,r),L&&L.enableAttributes(Z,r),h.bind(),h.setVertexAttribPointers(Z,r,v);for(const J of p)J.bind(),J.setVertexAttribPointers(Z,r,v);E&&(E.bind(),E.setVertexAttribPointers(Z,r,v)),m&&m.bind(),C&&(C.bind(),C.setVertexAttribPointers(Z,r,v)),L&&(L.bind(),L.setVertexAttribPointers(Z,r,v)),q.currentNumAttributes=F}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Ps(y){const r=[];for(let h=0;h<y.length;h++){if(y[h]===null)continue;const p=y[h].split(" ");r.push(p.pop())}return r}class qo{constructor(r,h,p,m,v,E){const C=r.gl;this.program=C.createProgram();const L=Ps(h.staticAttributes),F=p?p.getBinderAttributes():[],q=L.concat(F),Z=ca.prelude.staticUniforms?Ps(ca.prelude.staticUniforms):[],J=h.staticUniforms?Ps(h.staticUniforms):[],me=p?p.getBinderUniforms():[],pe=Z.concat(J).concat(me),ye=[];for(const Xe of pe)ye.indexOf(Xe)<0&&ye.push(Xe);const se=p?p.defines():[];v&&se.push("#define OVERDRAW_INSPECTOR;"),E&&se.push("#define TERRAIN3D;");const Ee=se.concat(ca.prelude.fragmentSource,h.fragmentSource).join(`
`),Ge=se.concat(ca.prelude.vertexSource,h.vertexSource).join(`
`),be=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(be,Ee),C.compileShader(be),!C.getShaderParameter(be,C.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${C.getShaderInfoLog(be)}`);C.attachShader(this.program,be);const Ae=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(Ae,Ge),C.compileShader(Ae),!C.getShaderParameter(Ae,C.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${C.getShaderInfoLog(Ae)}`);C.attachShader(this.program,Ae),this.attributes={};const He={};this.numAttributes=q.length;for(let Xe=0;Xe<this.numAttributes;Xe++)q[Xe]&&(C.bindAttribLocation(this.program,Xe,q[Xe]),this.attributes[q[Xe]]=Xe);if(C.linkProgram(this.program),!C.getProgramParameter(this.program,C.LINK_STATUS))throw new Error(`Program failed to link: ${C.getProgramInfoLog(this.program)}`);C.deleteShader(Ae),C.deleteShader(be);for(let Xe=0;Xe<ye.length;Xe++){const Ke=ye[Xe];if(Ke&&!He[Ke]){const nt=C.getUniformLocation(this.program,Ke);nt&&(He[Ke]=nt)}}this.fixedUniforms=m(r,He),this.terrainUniforms=((Xe,Ke)=>({u_depth:new a.aG(Xe,Ke.u_depth),u_terrain:new a.aG(Xe,Ke.u_terrain),u_terrain_dim:new a.aH(Xe,Ke.u_terrain_dim),u_terrain_matrix:new a.aI(Xe,Ke.u_terrain_matrix),u_terrain_unpack:new a.aJ(Xe,Ke.u_terrain_unpack),u_terrain_exaggeration:new a.aH(Xe,Ke.u_terrain_exaggeration)}))(r,He),this.binderUniforms=p?p.getUniforms(r,He):[]}draw(r,h,p,m,v,E,C,L,F,q,Z,J,me,pe,ye,se,Ee,Ge){const be=r.gl;if(this.failedToCreate)return;if(r.program.set(this.program),r.setDepthMode(p),r.setStencilMode(m),r.setColorMode(v),r.setCullFace(E),L){r.activeTexture.set(be.TEXTURE2),be.bindTexture(be.TEXTURE_2D,L.depthTexture),r.activeTexture.set(be.TEXTURE3),be.bindTexture(be.TEXTURE_2D,L.texture);for(const He in this.terrainUniforms)this.terrainUniforms[He].set(L[He])}for(const He in this.fixedUniforms)this.fixedUniforms[He].set(C[He]);ye&&ye.setUniforms(r,this.binderUniforms,me,{zoom:pe});let Ae=0;switch(h){case be.LINES:Ae=2;break;case be.TRIANGLES:Ae=3;break;case be.LINE_STRIP:Ae=1}for(const He of J.get()){const Xe=He.vaos||(He.vaos={});(Xe[F]||(Xe[F]=new Va)).bind(r,this,q,ye?ye.getPaintVertexBuffers():[],Z,He.vertexOffset,se,Ee,Ge),be.drawElements(h,He.primitiveLength*Ae,be.UNSIGNED_SHORT,He.primitiveOffset*Ae*2)}}}function qa(y,r,h){const p=1/Xt(h,1,r.transform.tileZoom),m=Math.pow(2,h.tileID.overscaledZ),v=h.tileSize*Math.pow(2,r.transform.tileZoom)/m,E=v*(h.tileID.canonical.x+h.tileID.wrap*m),C=v*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[p,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[E>>16,C>>16],u_pixel_coord_lower:[65535&E,65535&C]}}const ua=(y,r,h,p)=>{const m=r.style.light,v=m.properties.get("position"),E=[v.x,v.y,v.z],C=function(){var F=new a.A(9);return a.A!=Float32Array&&(F[1]=0,F[2]=0,F[3]=0,F[5]=0,F[6]=0,F[7]=0),F[0]=1,F[4]=1,F[8]=1,F}();m.properties.get("anchor")==="viewport"&&function(F,q){var Z=Math.sin(q),J=Math.cos(q);F[0]=J,F[1]=Z,F[2]=0,F[3]=-Z,F[4]=J,F[5]=0,F[6]=0,F[7]=0,F[8]=1}(C,-r.transform.angle),function(F,q,Z){var J=q[0],me=q[1],pe=q[2];F[0]=J*Z[0]+me*Z[3]+pe*Z[6],F[1]=J*Z[1]+me*Z[4]+pe*Z[7],F[2]=J*Z[2]+me*Z[5]+pe*Z[8]}(E,E,C);const L=m.properties.get("color");return{u_matrix:y,u_lightpos:E,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[L.r,L.g,L.b],u_vertical_gradient:+h,u_opacity:p}},Ad=(y,r,h,p,m,v,E)=>a.e(ua(y,r,h,p),qa(v,r,E),{u_height_factor:-Math.pow(2,m.overscaledZ)/E.tileSize/8}),$u=y=>({u_matrix:y}),Za=(y,r,h,p)=>a.e($u(y),qa(h,r,p)),Pd=(y,r)=>({u_matrix:y,u_world:r}),Xu=(y,r,h,p,m)=>a.e(Za(y,r,h,p),{u_world:m}),zd=(y,r,h,p)=>{const m=y.transform;let v,E;if(p.paint.get("circle-pitch-alignment")==="map"){const C=Xt(h,1,m.zoom);v=!0,E=[C,C]}else v=!1,E=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(r.posMatrix,h,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+v,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:E}},Ku=(y,r,h)=>{const p=Xt(h,1,r.zoom),m=Math.pow(2,r.zoom-h.tileID.overscaledZ),v=h.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:r.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[r.pixelsToGLUnits[0]/(p*m),r.pixelsToGLUnits[1]/(p*m)],u_overscale_factor:v}},Ju=(y,r,h=1)=>({u_matrix:y,u_color:r,u_overlay:0,u_overlay_scale:h}),Ga=y=>({u_matrix:y}),Yu=(y,r,h,p)=>({u_matrix:y,u_extrude_scale:Xt(r,1,h),u_intensity:p});function Qu(y,r){const h=Math.pow(2,r.canonical.z),p=r.canonical.y;return[new a.Y(0,p/h).toLngLat().lat,new a.Y(0,(p+1)/h).toLngLat().lat]}const Wa=(y,r,h,p)=>{const m=y.transform;return{u_matrix:ha(y,r,h,p),u_ratio:1/Xt(r,1,m.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},eh=(y,r,h,p,m)=>a.e(Wa(y,r,h,m),{u_image:0,u_image_height:p}),rs=(y,r,h,p,m)=>{const v=y.transform,E=Dr(r,v);return{u_matrix:ha(y,r,h,m),u_texsize:r.imageAtlasTexture.size,u_ratio:1/Xt(r,1,v.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[E,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},Ha=(y,r,h,p,m,v)=>{const E=y.lineAtlas,C=Dr(r,y.transform),L=h.layout.get("line-cap")==="round",F=E.getDash(p.from,L),q=E.getDash(p.to,L),Z=F.width*m.fromScale,J=q.width*m.toScale;return a.e(Wa(y,r,h,v),{u_patternscale_a:[C/Z,-F.height/2],u_patternscale_b:[C/J,-q.height/2],u_sdfgamma:E.width/(256*Math.min(Z,J)*y.pixelRatio)/2,u_image:0,u_tex_y_a:F.y,u_tex_y_b:q.y,u_mix:m.t})};function Dr(y,r){return 1/Xt(y,1,r.tileZoom)}function ha(y,r,h,p){return y.translatePosMatrix(p?p.posMatrix:r.tileID.posMatrix,r,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const $a=(y,r,h,p,m)=>{return{u_matrix:y,u_tl_parent:r,u_scale_parent:h,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(E=m.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(v=m.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:da(m.paint.get("raster-hue-rotate"))};var v,E};function da(y){y*=Math.PI/180;const r=Math.sin(y),h=Math.cos(y);return[(2*h+1)/3,(-Math.sqrt(3)*r-h+1)/3,(Math.sqrt(3)*r-h+1)/3]}const fa=(y,r,h,p,m,v,E,C,L,F)=>{const q=m.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:q.cameraToCenterDistance,u_pitch:q.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:q.width/q.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:E,u_coord_matrix:C,u_is_text:+L,u_pitch_with_map:+p,u_texsize:F,u_texture:0}},pa=(y,r,h,p,m,v,E,C,L,F,q)=>{const Z=m.transform;return a.e(fa(y,r,h,p,m,v,E,C,L,F),{u_gamma_scale:p?Math.cos(Z._pitch)*Z.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:+q})},ma=(y,r,h,p,m,v,E,C,L,F)=>a.e(pa(y,r,h,p,m,v,E,C,!0,L,!0),{u_texsize_icon:F,u_texture_icon:1}),Dd=(y,r,h)=>({u_matrix:y,u_opacity:r,u_color:h}),Rd=(y,r,h,p,m,v)=>a.e(function(E,C,L,F){const q=L.imageManager.getPattern(E.from.toString()),Z=L.imageManager.getPattern(E.to.toString()),{width:J,height:me}=L.imageManager.getPixelSize(),pe=Math.pow(2,F.tileID.overscaledZ),ye=F.tileSize*Math.pow(2,L.transform.tileZoom)/pe,se=ye*(F.tileID.canonical.x+F.tileID.wrap*pe),Ee=ye*F.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:q.tl,u_pattern_br_a:q.br,u_pattern_tl_b:Z.tl,u_pattern_br_b:Z.br,u_texsize:[J,me],u_mix:C.t,u_pattern_size_a:q.displaySize,u_pattern_size_b:Z.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/Xt(F,1,L.transform.tileZoom),u_pixel_coord_upper:[se>>16,Ee>>16],u_pixel_coord_lower:[65535&se,65535&Ee]}}(p,v,h,m),{u_matrix:y,u_opacity:r}),th={fillExtrusion:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_lightpos:new a.aK(y,r.u_lightpos),u_lightintensity:new a.aH(y,r.u_lightintensity),u_lightcolor:new a.aK(y,r.u_lightcolor),u_vertical_gradient:new a.aH(y,r.u_vertical_gradient),u_opacity:new a.aH(y,r.u_opacity)}),fillExtrusionPattern:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_lightpos:new a.aK(y,r.u_lightpos),u_lightintensity:new a.aH(y,r.u_lightintensity),u_lightcolor:new a.aK(y,r.u_lightcolor),u_vertical_gradient:new a.aH(y,r.u_vertical_gradient),u_height_factor:new a.aH(y,r.u_height_factor),u_image:new a.aG(y,r.u_image),u_texsize:new a.aL(y,r.u_texsize),u_pixel_coord_upper:new a.aL(y,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,r.u_pixel_coord_lower),u_scale:new a.aK(y,r.u_scale),u_fade:new a.aH(y,r.u_fade),u_opacity:new a.aH(y,r.u_opacity)}),fill:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix)}),fillPattern:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_image:new a.aG(y,r.u_image),u_texsize:new a.aL(y,r.u_texsize),u_pixel_coord_upper:new a.aL(y,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,r.u_pixel_coord_lower),u_scale:new a.aK(y,r.u_scale),u_fade:new a.aH(y,r.u_fade)}),fillOutline:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_world:new a.aL(y,r.u_world)}),fillOutlinePattern:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_world:new a.aL(y,r.u_world),u_image:new a.aG(y,r.u_image),u_texsize:new a.aL(y,r.u_texsize),u_pixel_coord_upper:new a.aL(y,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,r.u_pixel_coord_lower),u_scale:new a.aK(y,r.u_scale),u_fade:new a.aH(y,r.u_fade)}),circle:(y,r)=>({u_camera_to_center_distance:new a.aH(y,r.u_camera_to_center_distance),u_scale_with_map:new a.aG(y,r.u_scale_with_map),u_pitch_with_map:new a.aG(y,r.u_pitch_with_map),u_extrude_scale:new a.aL(y,r.u_extrude_scale),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_matrix:new a.aI(y,r.u_matrix)}),collisionBox:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_camera_to_center_distance:new a.aH(y,r.u_camera_to_center_distance),u_pixels_to_tile_units:new a.aH(y,r.u_pixels_to_tile_units),u_extrude_scale:new a.aL(y,r.u_extrude_scale),u_overscale_factor:new a.aH(y,r.u_overscale_factor)}),collisionCircle:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_inv_matrix:new a.aI(y,r.u_inv_matrix),u_camera_to_center_distance:new a.aH(y,r.u_camera_to_center_distance),u_viewport_size:new a.aL(y,r.u_viewport_size)}),debug:(y,r)=>({u_color:new a.aM(y,r.u_color),u_matrix:new a.aI(y,r.u_matrix),u_overlay:new a.aG(y,r.u_overlay),u_overlay_scale:new a.aH(y,r.u_overlay_scale)}),clippingMask:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix)}),heatmap:(y,r)=>({u_extrude_scale:new a.aH(y,r.u_extrude_scale),u_intensity:new a.aH(y,r.u_intensity),u_matrix:new a.aI(y,r.u_matrix)}),heatmapTexture:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_world:new a.aL(y,r.u_world),u_image:new a.aG(y,r.u_image),u_color_ramp:new a.aG(y,r.u_color_ramp),u_opacity:new a.aH(y,r.u_opacity)}),hillshade:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_image:new a.aG(y,r.u_image),u_latrange:new a.aL(y,r.u_latrange),u_light:new a.aL(y,r.u_light),u_shadow:new a.aM(y,r.u_shadow),u_highlight:new a.aM(y,r.u_highlight),u_accent:new a.aM(y,r.u_accent)}),hillshadePrepare:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_image:new a.aG(y,r.u_image),u_dimension:new a.aL(y,r.u_dimension),u_zoom:new a.aH(y,r.u_zoom),u_unpack:new a.aJ(y,r.u_unpack)}),line:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_ratio:new a.aH(y,r.u_ratio),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_units_to_pixels:new a.aL(y,r.u_units_to_pixels)}),lineGradient:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_ratio:new a.aH(y,r.u_ratio),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_units_to_pixels:new a.aL(y,r.u_units_to_pixels),u_image:new a.aG(y,r.u_image),u_image_height:new a.aH(y,r.u_image_height)}),linePattern:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_texsize:new a.aL(y,r.u_texsize),u_ratio:new a.aH(y,r.u_ratio),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_image:new a.aG(y,r.u_image),u_units_to_pixels:new a.aL(y,r.u_units_to_pixels),u_scale:new a.aK(y,r.u_scale),u_fade:new a.aH(y,r.u_fade)}),lineSDF:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_ratio:new a.aH(y,r.u_ratio),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_units_to_pixels:new a.aL(y,r.u_units_to_pixels),u_patternscale_a:new a.aL(y,r.u_patternscale_a),u_patternscale_b:new a.aL(y,r.u_patternscale_b),u_sdfgamma:new a.aH(y,r.u_sdfgamma),u_image:new a.aG(y,r.u_image),u_tex_y_a:new a.aH(y,r.u_tex_y_a),u_tex_y_b:new a.aH(y,r.u_tex_y_b),u_mix:new a.aH(y,r.u_mix)}),raster:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_tl_parent:new a.aL(y,r.u_tl_parent),u_scale_parent:new a.aH(y,r.u_scale_parent),u_buffer_scale:new a.aH(y,r.u_buffer_scale),u_fade_t:new a.aH(y,r.u_fade_t),u_opacity:new a.aH(y,r.u_opacity),u_image0:new a.aG(y,r.u_image0),u_image1:new a.aG(y,r.u_image1),u_brightness_low:new a.aH(y,r.u_brightness_low),u_brightness_high:new a.aH(y,r.u_brightness_high),u_saturation_factor:new a.aH(y,r.u_saturation_factor),u_contrast_factor:new a.aH(y,r.u_contrast_factor),u_spin_weights:new a.aK(y,r.u_spin_weights)}),symbolIcon:(y,r)=>({u_is_size_zoom_constant:new a.aG(y,r.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(y,r.u_is_size_feature_constant),u_size_t:new a.aH(y,r.u_size_t),u_size:new a.aH(y,r.u_size),u_camera_to_center_distance:new a.aH(y,r.u_camera_to_center_distance),u_pitch:new a.aH(y,r.u_pitch),u_rotate_symbol:new a.aG(y,r.u_rotate_symbol),u_aspect_ratio:new a.aH(y,r.u_aspect_ratio),u_fade_change:new a.aH(y,r.u_fade_change),u_matrix:new a.aI(y,r.u_matrix),u_label_plane_matrix:new a.aI(y,r.u_label_plane_matrix),u_coord_matrix:new a.aI(y,r.u_coord_matrix),u_is_text:new a.aG(y,r.u_is_text),u_pitch_with_map:new a.aG(y,r.u_pitch_with_map),u_texsize:new a.aL(y,r.u_texsize),u_texture:new a.aG(y,r.u_texture)}),symbolSDF:(y,r)=>({u_is_size_zoom_constant:new a.aG(y,r.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(y,r.u_is_size_feature_constant),u_size_t:new a.aH(y,r.u_size_t),u_size:new a.aH(y,r.u_size),u_camera_to_center_distance:new a.aH(y,r.u_camera_to_center_distance),u_pitch:new a.aH(y,r.u_pitch),u_rotate_symbol:new a.aG(y,r.u_rotate_symbol),u_aspect_ratio:new a.aH(y,r.u_aspect_ratio),u_fade_change:new a.aH(y,r.u_fade_change),u_matrix:new a.aI(y,r.u_matrix),u_label_plane_matrix:new a.aI(y,r.u_label_plane_matrix),u_coord_matrix:new a.aI(y,r.u_coord_matrix),u_is_text:new a.aG(y,r.u_is_text),u_pitch_with_map:new a.aG(y,r.u_pitch_with_map),u_texsize:new a.aL(y,r.u_texsize),u_texture:new a.aG(y,r.u_texture),u_gamma_scale:new a.aH(y,r.u_gamma_scale),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_is_halo:new a.aG(y,r.u_is_halo)}),symbolTextAndIcon:(y,r)=>({u_is_size_zoom_constant:new a.aG(y,r.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(y,r.u_is_size_feature_constant),u_size_t:new a.aH(y,r.u_size_t),u_size:new a.aH(y,r.u_size),u_camera_to_center_distance:new a.aH(y,r.u_camera_to_center_distance),u_pitch:new a.aH(y,r.u_pitch),u_rotate_symbol:new a.aG(y,r.u_rotate_symbol),u_aspect_ratio:new a.aH(y,r.u_aspect_ratio),u_fade_change:new a.aH(y,r.u_fade_change),u_matrix:new a.aI(y,r.u_matrix),u_label_plane_matrix:new a.aI(y,r.u_label_plane_matrix),u_coord_matrix:new a.aI(y,r.u_coord_matrix),u_is_text:new a.aG(y,r.u_is_text),u_pitch_with_map:new a.aG(y,r.u_pitch_with_map),u_texsize:new a.aL(y,r.u_texsize),u_texsize_icon:new a.aL(y,r.u_texsize_icon),u_texture:new a.aG(y,r.u_texture),u_texture_icon:new a.aG(y,r.u_texture_icon),u_gamma_scale:new a.aH(y,r.u_gamma_scale),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_is_halo:new a.aG(y,r.u_is_halo)}),background:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_opacity:new a.aH(y,r.u_opacity),u_color:new a.aM(y,r.u_color)}),backgroundPattern:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_opacity:new a.aH(y,r.u_opacity),u_image:new a.aG(y,r.u_image),u_pattern_tl_a:new a.aL(y,r.u_pattern_tl_a),u_pattern_br_a:new a.aL(y,r.u_pattern_br_a),u_pattern_tl_b:new a.aL(y,r.u_pattern_tl_b),u_pattern_br_b:new a.aL(y,r.u_pattern_br_b),u_texsize:new a.aL(y,r.u_texsize),u_mix:new a.aH(y,r.u_mix),u_pattern_size_a:new a.aL(y,r.u_pattern_size_a),u_pattern_size_b:new a.aL(y,r.u_pattern_size_b),u_scale_a:new a.aH(y,r.u_scale_a),u_scale_b:new a.aH(y,r.u_scale_b),u_pixel_coord_upper:new a.aL(y,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,r.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aH(y,r.u_tile_units_to_pixels)}),terrain:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_texture:new a.aG(y,r.u_texture),u_ele_delta:new a.aH(y,r.u_ele_delta)}),terrainDepth:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_ele_delta:new a.aH(y,r.u_ele_delta)}),terrainCoords:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_texture:new a.aG(y,r.u_texture),u_terrain_coords_id:new a.aH(y,r.u_terrain_coords_id),u_ele_delta:new a.aH(y,r.u_ele_delta)})};class Bd{constructor(r,h,p){this.context=r;const m=r.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const os={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Xa{constructor(r,h,p,m){this.length=h.length,this.attributes=p,this.itemSize=h.bytesPerElement,this.dynamicDraw=m,this.context=r;const v=r.gl;this.buffer=v.createBuffer(),r.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){if(r.length!==this.length)throw new Error(`Length of new data is ${r.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,h){for(let p=0;p<this.attributes.length;p++){const m=h.attributes[this.attributes[p].name];m!==void 0&&r.enableVertexAttribArray(m)}}setVertexAttribPointers(r,h,p){for(let m=0;m<this.attributes.length;m++){const v=this.attributes[m],E=h.attributes[v.name];E!==void 0&&r.vertexAttribPointer(E,v.components,r[os[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const hr=new WeakMap;function nr(y){var r;if(hr.has(y))return hr.get(y);{const h=(r=y.getParameter(y.VERSION))===null||r===void 0?void 0:r.startsWith("WebGL 2.0");return hr.set(y,h),h}}class Mi{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ka extends Mi{getDefault(){return a.aO.transparent}set(r){const h=this.current;(r.r!==h.r||r.g!==h.g||r.b!==h.b||r.a!==h.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Ja extends Mi{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class ac extends Mi{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class lc extends Mi{getDefault(){return[!0,!0,!0,!0]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||r[3]!==h[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Ya extends Mi{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class cc extends Mi{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class uc extends Mi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const h=this.current;(r.func!==h.func||r.ref!==h.ref||r.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Qa extends Mi{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class ih extends Mi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=r,this.dirty=!1}}class nh extends Mi{getDefault(){return[0,1]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class zs extends Mi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=r,this.dirty=!1}}class Fd extends Mi{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Od extends Mi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.BLEND):h.disable(h.BLEND),this.current=r,this.dirty=!1}}class Nd extends Mi{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class jd extends Mi{getDefault(){return a.aO.transparent}set(r){const h=this.current;(r.r!==h.r||r.g!==h.g||r.b!==h.b||r.a!==h.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Ud extends Mi{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class Vd extends Mi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=r,this.dirty=!1}}class hc extends Mi{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class el extends Mi{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class dc extends Mi{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class fc extends Mi{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Ds extends Mi{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||r[3]!==h[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class rh extends Mi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class oh extends Mi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class pc extends Mi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class ss extends Mi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class sh extends Mi{getDefault(){return null}set(r){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Rs extends Mi{getDefault(){return null}set(r){var h;if(r===this.current&&!this.dirty)return;const p=this.gl;nr(p)?p.bindVertexArray(r):(h=p.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(r),this.current=r,this.dirty=!1}}class Bs extends Mi{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class ah extends Mi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class mc extends Mi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Ei extends Mi{constructor(r,h){super(r),this.context=r,this.parent=h}getDefault(){return null}}class tl extends Ei{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class qd extends Ei{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class lh extends Ei{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class ga{constructor(r,h,p,m,v){this.context=r,this.width=h,this.height=p;const E=r.gl,C=this.framebuffer=E.createFramebuffer();if(this.colorAttachment=new tl(r,C),m)this.depthAttachment=v?new lh(r,C):new qd(r,C);else if(v)throw new Error("Stencil cannot be set without depth");if(E.checkFramebufferStatus(E.FRAMEBUFFER)!==E.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const r=this.context.gl,h=this.colorAttachment.get();if(h&&r.deleteTexture(h),this.depthAttachment){const p=this.depthAttachment.get();p&&r.deleteRenderbuffer(p)}r.deleteFramebuffer(this.framebuffer)}}class kn{constructor(r,h,p){this.blendFunction=r,this.blendColor=h,this.mask=p}}kn.Replace=[1,0],kn.disabled=new kn(kn.Replace,a.aO.transparent,[!1,!1,!1,!1]),kn.unblended=new kn(kn.Replace,a.aO.transparent,[!0,!0,!0,!0]),kn.alphaBlended=new kn([1,771],a.aO.transparent,[!0,!0,!0,!0]);class Zd{constructor(r){var h,p;if(this.gl=r,this.clearColor=new Ka(this),this.clearDepth=new Ja(this),this.clearStencil=new ac(this),this.colorMask=new lc(this),this.depthMask=new Ya(this),this.stencilMask=new cc(this),this.stencilFunc=new uc(this),this.stencilOp=new Qa(this),this.stencilTest=new ih(this),this.depthRange=new nh(this),this.depthTest=new zs(this),this.depthFunc=new Fd(this),this.blend=new Od(this),this.blendFunc=new Nd(this),this.blendColor=new jd(this),this.blendEquation=new Ud(this),this.cullFace=new Vd(this),this.cullFaceSide=new hc(this),this.frontFace=new el(this),this.program=new dc(this),this.activeTexture=new fc(this),this.viewport=new Ds(this),this.bindFramebuffer=new rh(this),this.bindRenderbuffer=new oh(this),this.bindTexture=new pc(this),this.bindVertexBuffer=new ss(this),this.bindElementBuffer=new sh(this),this.bindVertexArray=new Rs(this),this.pixelStoreUnpack=new Bs(this),this.pixelStoreUnpackPremultiplyAlpha=new ah(this),this.pixelStoreUnpackFlipY=new mc(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),nr(r)){this.HALF_FLOAT=r.HALF_FLOAT;const m=r.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=r.RGBA16F)!==null&&h!==void 0?h:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(p=r.RGB16F)!==null&&p!==void 0?p:m==null?void 0:m.RGB16F_EXT,r.getExtension("EXT_color_buffer_float")}else{r.getExtension("EXT_color_buffer_half_float"),r.getExtension("OES_texture_half_float_linear");const m=r.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,h){return new Bd(this,r,h)}createVertexBuffer(r,h,p){return new Xa(this,r,h,p)}createRenderbuffer(r,h,p){const m=this.gl,v=m.createRenderbuffer();return this.bindRenderbuffer.set(v),m.renderbufferStorage(m.RENDERBUFFER,r,h,p),this.bindRenderbuffer.set(null),v}createFramebuffer(r,h,p,m){return new ga(this,r,h,p,m)}clear({color:r,depth:h,stencil:p}){const m=this.gl;let v=0;r&&(v|=m.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(v|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),p!==void 0&&(v|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),m.clear(v)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){a.aD(r.blendFunction,kn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}createVertexArray(){var r;return nr(this.gl)?this.gl.createVertexArray():(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.createVertexArrayOES()}deleteVertexArray(r){var h;return nr(this.gl)?this.gl.deleteVertexArray(r):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(r)}unbindVAO(){this.bindVertexArray.set(null)}}class ki{constructor(r,h,p){this.func=r,this.mask=h,this.range=p}}ki.ReadOnly=!1,ki.ReadWrite=!0,ki.disabled=new ki(519,ki.ReadOnly,[0,1]);const gc=7680;class Wi{constructor(r,h,p,m,v,E){this.test=r,this.ref=h,this.mask=p,this.fail=m,this.depthFail=v,this.pass=E}}Wi.disabled=new Wi({func:519,mask:0},0,0,gc,gc,gc);class Zi{constructor(r,h,p){this.enable=r,this.mode=h,this.frontFace=p}}let as;function il(y,r,h,p,m,v,E){const C=y.context,L=C.gl,F=y.useProgram("collisionBox"),q=[];let Z=0,J=0;for(let be=0;be<p.length;be++){const Ae=p[be],He=r.getTile(Ae),Xe=He.getBucket(h);if(!Xe)continue;let Ke=Ae.posMatrix;m[0]===0&&m[1]===0||(Ke=y.translatePosMatrix(Ae.posMatrix,He,m,v));const nt=E?Xe.textCollisionBox:Xe.iconCollisionBox,it=Xe.collisionCircleArray;if(it.length>0){const pt=a.F(),_t=Ke;a.aP(pt,Xe.placementInvProjMatrix,y.transform.glCoordMatrix),a.aP(pt,pt,Xe.placementViewportMatrix),q.push({circleArray:it,circleOffset:J,transform:_t,invTransform:pt,coord:Ae}),Z+=it.length/4,J=Z}nt&&F.draw(C,L.LINES,ki.disabled,Wi.disabled,y.colorModeForRenderPass(),Zi.disabled,Ku(Ke,y.transform,He),y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ae),h.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,null,y.transform.zoom,null,null,nt.collisionVertexBuffer)}if(!E||!q.length)return;const me=y.useProgram("collisionCircle"),pe=new a.aQ;pe.resize(4*Z),pe._trim();let ye=0;for(const be of q)for(let Ae=0;Ae<be.circleArray.length/4;Ae++){const He=4*Ae,Xe=be.circleArray[He+0],Ke=be.circleArray[He+1],nt=be.circleArray[He+2],it=be.circleArray[He+3];pe.emplace(ye++,Xe,Ke,nt,it,0),pe.emplace(ye++,Xe,Ke,nt,it,1),pe.emplace(ye++,Xe,Ke,nt,it,2),pe.emplace(ye++,Xe,Ke,nt,it,3)}(!as||as.length<2*Z)&&(as=function(be){const Ae=2*be,He=new a.aS;He.resize(Ae),He._trim();for(let Xe=0;Xe<Ae;Xe++){const Ke=6*Xe;He.uint16[Ke+0]=4*Xe+0,He.uint16[Ke+1]=4*Xe+1,He.uint16[Ke+2]=4*Xe+2,He.uint16[Ke+3]=4*Xe+2,He.uint16[Ke+4]=4*Xe+3,He.uint16[Ke+5]=4*Xe+0}return He}(Z));const se=C.createIndexBuffer(as,!0),Ee=C.createVertexBuffer(pe,a.aR.members,!0);for(const be of q){const Ae={u_matrix:be.transform,u_inv_matrix:be.invTransform,u_camera_to_center_distance:(Ge=y.transform).cameraToCenterDistance,u_viewport_size:[Ge.width,Ge.height]};me.draw(C,L.TRIANGLES,ki.disabled,Wi.disabled,y.colorModeForRenderPass(),Zi.disabled,Ae,y.style.map.terrain&&y.style.map.terrain.getTerrainData(be.coord),h.id,Ee,se,a.$.simpleSegment(0,2*be.circleOffset,be.circleArray.length,be.circleArray.length/2),null,y.transform.zoom,null,null,null)}var Ge;Ee.destroy(),se.destroy()}Zi.disabled=new Zi(!1,1029,2305),Zi.backCCW=new Zi(!0,1029,2305);const _c=a.an(new Float32Array(16));function ch(y,r,h,p,m,v){const{horizontalAlign:E,verticalAlign:C}=a.at(y);return new a.P((-(E-.5)*r/m+p[0])*v,(-(C-.5)*h/m+p[1])*v)}function nl(y,r,h,p,m,v,E,C,L,F,q){const Z=y.text.placedSymbolArray,J=y.text.dynamicLayoutVertexArray,me=y.icon.dynamicLayoutVertexArray,pe={};J.clear();for(let ye=0;ye<Z.length;ye++){const se=Z.get(ye),Ee=se.hidden||!se.crossTileID||y.allowVerticalPlacement&&!se.placedOrientation?null:p[se.crossTileID];if(Ee){const Ge=new a.P(se.anchorX,se.anchorY),be=cn(Ge,h?E:v,q),Ae=ge(m.cameraToCenterDistance,be.signedDistanceFromCamera);let He=a.ai(y.textSizeData,L,se)*Ae/a.ao;h&&(He*=y.tilePixelRatio/C);const{width:Xe,height:Ke,anchor:nt,textOffset:it,textBoxScale:pt}=Ee,_t=ch(nt,Xe,Ke,it,pt,He),oi=h?cn(Ge.add(_t),v,q).point:be.point.add(r?_t.rotate(-m.angle):_t),yt=y.allowVerticalPlacement&&se.placedOrientation===a.ah.vertical?Math.PI/2:0;for(let Kt=0;Kt<se.numGlyphs;Kt++)a.aj(J,oi,yt);F&&se.associatedIconIndex>=0&&(pe[se.associatedIconIndex]={shiftedAnchor:oi,angle:yt})}else We(se.numGlyphs,J)}if(F){me.clear();const ye=y.icon.placedSymbolArray;for(let se=0;se<ye.length;se++){const Ee=ye.get(se);if(Ee.hidden)We(Ee.numGlyphs,me);else{const Ge=pe[se];if(Ge)for(let be=0;be<Ee.numGlyphs;be++)a.aj(me,Ge.shiftedAnchor,Ge.angle);else We(Ee.numGlyphs,me)}}y.icon.dynamicLayoutVertexBuffer.updateData(me)}y.text.dynamicLayoutVertexBuffer.updateData(J)}function rl(y,r,h){return h.iconsInText&&r?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function ol(y,r,h,p,m,v,E,C,L,F,q,Z){const J=y.context,me=J.gl,pe=y.transform,ye=C==="map",se=L==="map",Ee=C!=="viewport"&&h.layout.get("symbol-placement")!=="point",Ge=ye&&!se&&!Ee,be=!h.layout.get("symbol-sort-key").isConstant();let Ae=!1;const He=y.depthModeForSublayer(0,ki.ReadOnly),Xe=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ke=[];for(const nt of p){const it=r.getTile(nt),pt=it.getBucket(h);if(!pt)continue;const _t=m?pt.text:pt.icon;if(!_t||!_t.segments.get().length||!_t.hasVisibleVertices)continue;const oi=_t.programConfigurations.get(h.id),yt=m||pt.sdfIcons,Kt=m?pt.textSizeData:pt.iconSizeData,si=se||pe.pitch!==0,Si=y.useProgram(rl(yt,m,pt),oi),Qt=a.ag(Kt,pe.zoom),ci=y.style.map.terrain&&y.style.map.terrain.getTerrainData(nt);let pi,fn,Ri,Rr,On=[0,0],rn=null;if(m)fn=it.glyphAtlasTexture,Ri=me.LINEAR,pi=it.glyphAtlasTexture.size,pt.iconsInText&&(On=it.imageAtlasTexture.size,rn=it.imageAtlasTexture,Rr=si||y.options.rotating||y.options.zooming||Kt.kind==="composite"||Kt.kind==="camera"?me.LINEAR:me.NEAREST);else{const An=h.layout.get("icon-size").constantOr(0)!==1||pt.iconsNeedLinear;fn=it.imageAtlasTexture,Ri=yt||y.options.rotating||y.options.zooming||An||si?me.LINEAR:me.NEAREST,pi=it.imageAtlasTexture.size}const Nn=Xt(it,1,y.transform.zoom),Br=ti(nt.posMatrix,se,ye,y.transform,Nn),vo=eo(nt.posMatrix,se,ye,y.transform,Nn),$o=Xe&&pt.hasTextData(),Ia=h.layout.get("icon-text-fit")!=="none"&&$o&&pt.hasIconData();if(Ee){const An=y.style.map.terrain?(Kr,Pn)=>y.style.map.terrain.getElevation(nt,Kr,Pn):null,sn=h.layout.get("text-rotation-alignment")==="map";X(pt,nt.posMatrix,y,m,Br,vo,se,F,sn,An)}const Xo=y.translatePosMatrix(nt.posMatrix,it,v,E),bo=Ee||m&&Xe||Ia?_c:Br,Ln=y.translatePosMatrix(vo,it,v,E,!0),on=yt&&h.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Qi;Qi=yt?pt.iconsInText?ma(Kt.kind,Qt,Ge,se,y,Xo,bo,Ln,pi,On):pa(Kt.kind,Qt,Ge,se,y,Xo,bo,Ln,m,pi,!0):fa(Kt.kind,Qt,Ge,se,y,Xo,bo,Ln,m,pi);const Xr={program:Si,buffers:_t,uniformValues:Qi,atlasTexture:fn,atlasTextureIcon:rn,atlasInterpolation:Ri,atlasInterpolationIcon:Rr,isSDF:yt,hasHalo:on};if(be&&pt.canOverlap){Ae=!0;const An=_t.segments.get();for(const sn of An)Ke.push({segments:new a.$([sn]),sortKey:sn.sortKey,state:Xr,terrainData:ci})}else Ke.push({segments:_t.segments,sortKey:0,state:Xr,terrainData:ci})}Ae&&Ke.sort((nt,it)=>nt.sortKey-it.sortKey);for(const nt of Ke){const it=nt.state;if(J.activeTexture.set(me.TEXTURE0),it.atlasTexture.bind(it.atlasInterpolation,me.CLAMP_TO_EDGE),it.atlasTextureIcon&&(J.activeTexture.set(me.TEXTURE1),it.atlasTextureIcon&&it.atlasTextureIcon.bind(it.atlasInterpolationIcon,me.CLAMP_TO_EDGE)),it.isSDF){const pt=it.uniformValues;it.hasHalo&&(pt.u_is_halo=1,uh(it.buffers,nt.segments,h,y,it.program,He,q,Z,pt,nt.terrainData)),pt.u_is_halo=0}uh(it.buffers,nt.segments,h,y,it.program,He,q,Z,it.uniformValues,nt.terrainData)}}function uh(y,r,h,p,m,v,E,C,L,F){const q=p.context;m.draw(q,q.gl.TRIANGLES,v,E,C,Zi.disabled,L,F,h.id,y.layoutVertexBuffer,y.indexBuffer,r,h.paint,p.transform.zoom,y.programConfigurations.get(h.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function sl(y,r,h,p,m){if(!h||!p||!p.imageAtlas)return;const v=p.imageAtlas.patternPositions;let E=v[h.to.toString()],C=v[h.from.toString()];if(!E&&C&&(E=C),!C&&E&&(C=E),!E||!C){const L=m.getPaintProperty(r);E=v[L],C=v[L]}E&&C&&y.setConstantPatternPositions(E,C)}function hh(y,r,h,p,m,v,E){const C=y.context.gl,L="fill-pattern",F=h.paint.get(L),q=F&&F.constantOr(1),Z=h.getCrossfadeParameters();let J,me,pe,ye,se;E?(me=q&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",J=C.LINES):(me=q?"fillPattern":"fill",J=C.TRIANGLES);const Ee=F.constantOr(null);for(const Ge of p){const be=r.getTile(Ge);if(q&&!be.patternsLoaded())continue;const Ae=be.getBucket(h);if(!Ae)continue;const He=Ae.programConfigurations.get(h.id),Xe=y.useProgram(me,He),Ke=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ge);q&&(y.context.activeTexture.set(C.TEXTURE0),be.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),He.updatePaintBuffers(Z)),sl(He,L,Ee,be,h);const nt=Ke?Ge:null,it=y.translatePosMatrix(nt?nt.posMatrix:Ge.posMatrix,be,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(E){ye=Ae.indexBuffer2,se=Ae.segments2;const pt=[C.drawingBufferWidth,C.drawingBufferHeight];pe=me==="fillOutlinePattern"&&q?Xu(it,y,Z,be,pt):Pd(it,pt)}else ye=Ae.indexBuffer,se=Ae.segments,pe=q?Za(it,y,Z,be):$u(it);Xe.draw(y.context,J,m,y.stencilModeForClipping(Ge),v,Zi.disabled,pe,Ke,h.id,Ae.layoutVertexBuffer,ye,se,h.paint,y.transform.zoom,He)}}function al(y,r,h,p,m,v,E){const C=y.context,L=C.gl,F="fill-extrusion-pattern",q=h.paint.get(F),Z=q.constantOr(1),J=h.getCrossfadeParameters(),me=h.paint.get("fill-extrusion-opacity"),pe=q.constantOr(null);for(const ye of p){const se=r.getTile(ye),Ee=se.getBucket(h);if(!Ee)continue;const Ge=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ye),be=Ee.programConfigurations.get(h.id),Ae=y.useProgram(Z?"fillExtrusionPattern":"fillExtrusion",be);Z&&(y.context.activeTexture.set(L.TEXTURE0),se.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),be.updatePaintBuffers(J)),sl(be,F,pe,se,h);const He=y.translatePosMatrix(ye.posMatrix,se,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Xe=h.paint.get("fill-extrusion-vertical-gradient"),Ke=Z?Ad(He,y,Xe,me,ye,J,se):ua(He,y,Xe,me);Ae.draw(C,C.gl.TRIANGLES,m,v,E,Zi.backCCW,Ke,Ge,h.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,h.paint,y.transform.zoom,be,y.style.map.terrain&&Ee.centroidVertexBuffer)}}function ll(y,r,h,p,m,v,E){const C=y.context,L=C.gl,F=h.fbo;if(!F)return;const q=y.useProgram("hillshade"),Z=y.style.map.terrain&&y.style.map.terrain.getTerrainData(r);C.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,F.colorAttachment.get()),q.draw(C,L.TRIANGLES,m,v,E,Zi.disabled,((J,me,pe,ye)=>{const se=pe.paint.get("hillshade-shadow-color"),Ee=pe.paint.get("hillshade-highlight-color"),Ge=pe.paint.get("hillshade-accent-color");let be=pe.paint.get("hillshade-illumination-direction")*(Math.PI/180);pe.paint.get("hillshade-illumination-anchor")==="viewport"&&(be-=J.transform.angle);const Ae=!J.options.moving;return{u_matrix:ye?ye.posMatrix:J.transform.calculatePosMatrix(me.tileID.toUnwrapped(),Ae),u_image:0,u_latrange:Qu(0,me.tileID),u_light:[pe.paint.get("hillshade-exaggeration"),be],u_shadow:se,u_highlight:Ee,u_accent:Ge}})(y,h,p,Z?r:null),Z,p.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function yc(y,r,h,p,m,v){const E=y.context,C=E.gl,L=r.dem;if(L&&L.data){const F=L.dim,q=L.stride,Z=L.getPixels();if(E.activeTexture.set(C.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||y.getTileTexture(q),r.demTexture){const me=r.demTexture;me.update(Z,{premultiply:!1}),me.bind(C.NEAREST,C.CLAMP_TO_EDGE)}else r.demTexture=new te(E,Z,C.RGBA,{premultiply:!1}),r.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);E.activeTexture.set(C.TEXTURE0);let J=r.fbo;if(!J){const me=new te(E,{width:F,height:F,data:null},C.RGBA);me.bind(C.LINEAR,C.CLAMP_TO_EDGE),J=r.fbo=E.createFramebuffer(F,F,!0,!1),J.colorAttachment.set(me.texture)}E.bindFramebuffer.set(J.framebuffer),E.viewport.set([0,0,F,F]),y.useProgram("hillshadePrepare").draw(E,C.TRIANGLES,p,m,v,Zi.disabled,((me,pe)=>{const ye=pe.stride,se=a.F();return a.aN(se,0,a.W,-a.W,0,0,1),a.H(se,se,[0,-a.W,0]),{u_matrix:se,u_image:1,u_dimension:[ye,ye],u_zoom:me.overscaledZ,u_unpack:pe.getUnpackVector()}})(r.tileID,L),null,h.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),r.needsHillshadePrepare=!1}}function dh(y,r,h,p,m,v){const E=p.paint.get("raster-fade-duration");if(!v&&E>0){const C=k.now(),L=(C-y.timeAdded)/E,F=r?(C-r.timeAdded)/E:-1,q=h.getSource(),Z=m.coveringZoomLevel({tileSize:q.tileSize,roundZoom:q.roundZoom}),J=!r||Math.abs(r.tileID.overscaledZ-Z)>Math.abs(y.tileID.overscaledZ-Z),me=J&&y.refreshedUponExpiration?1:a.ac(J?L:1-F,0,1);return y.refreshedUponExpiration&&L>=1&&(y.refreshedUponExpiration=!1),r?{opacity:1,mix:1-me}:{opacity:me,mix:0}}return{opacity:1,mix:0}}const fh=new a.aO(1,0,0,1),cl=new a.aO(0,1,0,1),vc=new a.aO(0,0,1,1),Gd=new a.aO(1,0,1,1),ph=new a.aO(0,1,1,1);function hn(y,r,h,p){dr(y,0,r+h/2,y.transform.width,h,p)}function Zo(y,r,h,p){dr(y,r-h/2,0,h,y.transform.height,p)}function dr(y,r,h,p,m,v){const E=y.context,C=E.gl;C.enable(C.SCISSOR_TEST),C.scissor(r*y.pixelRatio,h*y.pixelRatio,p*y.pixelRatio,m*y.pixelRatio),E.clear({color:v}),C.disable(C.SCISSOR_TEST)}function bc(y,r,h){const p=y.context,m=p.gl,v=h.posMatrix,E=y.useProgram("debug"),C=ki.disabled,L=Wi.disabled,F=y.colorModeForRenderPass(),q="$debug",Z=y.style.map.terrain&&y.style.map.terrain.getTerrainData(h);p.activeTexture.set(m.TEXTURE0);const J=r.getTileByID(h.key).latestRawTileData,me=Math.floor((J&&J.byteLength||0)/1024),pe=r.getTile(h).tileSize,ye=512/Math.min(pe,512)*(h.overscaledZ/y.transform.zoom)*.5;let se=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(se+=` => ${h.overscaledZ}`),function(Ee,Ge){Ee.initDebugOverlayCanvas();const be=Ee.debugOverlayCanvas,Ae=Ee.context.gl,He=Ee.debugOverlayCanvas.getContext("2d");He.clearRect(0,0,be.width,be.height),He.shadowColor="white",He.shadowBlur=2,He.lineWidth=1.5,He.strokeStyle="white",He.textBaseline="top",He.font="bold 36px Open Sans, sans-serif",He.fillText(Ge,5,5),He.strokeText(Ge,5,5),Ee.debugOverlayTexture.update(be),Ee.debugOverlayTexture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE)}(y,`${se} ${me}kB`),E.draw(p,m.TRIANGLES,C,L,kn.alphaBlended,Zi.disabled,Ju(v,a.aO.transparent,ye),null,q,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),E.draw(p,m.LINE_STRIP,C,L,F,Zi.disabled,Ju(v,a.aO.red),Z,q,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function ul(y,r,h){const p=y.context,m=p.gl,v=y.colorModeForRenderPass(),E=new ki(m.LEQUAL,ki.ReadWrite,y.depthRangeFor3D),C=y.useProgram("terrain"),L=r.getTerrainMesh();p.bindFramebuffer.set(null),p.viewport.set([0,0,y.width,y.height]);for(const F of h){const q=y.renderToTexture.getTexture(F),Z=r.getTerrainData(F.tileID);p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,q.texture);const J={u_matrix:y.transform.calculatePosMatrix(F.tileID.toUnwrapped()),u_texture:0,u_ele_delta:r.getMeshFrameDelta(y.transform.zoom)};C.draw(p,m.TRIANGLES,E,Wi.disabled,v,Zi.backCCW,J,Z,"terrain",L.vertexBuffer,L.indexBuffer,L.segments)}}class mh{constructor(r,h){this.context=new Zd(r),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Vi.maxUnderzooming+Vi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Vo}resize(r,h,p){if(this.width=Math.floor(r*p),this.height=Math.floor(h*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const r=this.context,h=new a.aV;h.emplaceBack(0,0),h.emplaceBack(a.W,0),h.emplaceBack(0,a.W),h.emplaceBack(a.W,a.W),this.tileExtentBuffer=r.createVertexBuffer(h,Ua.members),this.tileExtentSegments=a.$.simpleSegment(0,0,4,2);const p=new a.aV;p.emplaceBack(0,0),p.emplaceBack(a.W,0),p.emplaceBack(0,a.W),p.emplaceBack(a.W,a.W),this.debugBuffer=r.createVertexBuffer(p,Ua.members),this.debugSegments=a.$.simpleSegment(0,0,4,5);const m=new a.Z;m.emplaceBack(0,0,0,0),m.emplaceBack(a.W,0,a.W,0),m.emplaceBack(0,a.W,0,a.W),m.emplaceBack(a.W,a.W,a.W,a.W),this.rasterBoundsBuffer=r.createVertexBuffer(m,$e.members),this.rasterBoundsSegments=a.$.simpleSegment(0,0,4,2);const v=new a.aV;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(v,Ua.members),this.viewportSegments=a.$.simpleSegment(0,0,4,2);const E=new a.aW;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=r.createIndexBuffer(E);const C=new a.aX;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(C);const L=this.context.gl;this.stencilClearMode=new Wi({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)}clearStencil(){const r=this.context,h=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=a.F();a.aN(p,0,this.width,this.height,0,0,1),a.J(p,p,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(r,h.TRIANGLES,ki.disabled,this.stencilClearMode,kn.disabled,Zi.disabled,Ga(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(r,h){if(this.currentStencilSource===r.source||!r.isTileClipped()||!h||!h.length)return;this.currentStencilSource=r.source;const p=this.context,m=p.gl;this.nextStencilID+h.length>256&&this.clearStencil(),p.setColorMode(kn.disabled),p.setDepthMode(ki.disabled);const v=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of h){const C=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,L=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E);v.draw(p,m.TRIANGLES,ki.disabled,new Wi({func:m.ALWAYS,mask:0},C,255,m.KEEP,m.KEEP,m.REPLACE),kn.disabled,Zi.disabled,Ga(E.posMatrix),L,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,h=this.context.gl;return new Wi({func:h.NOTEQUAL,mask:255},r,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(r){const h=this.context.gl;return new Wi({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(r){const h=this.context.gl,p=r.sort((E,C)=>C.overscaledZ-E.overscaledZ),m=p[p.length-1].overscaledZ,v=p[0].overscaledZ-m+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const E={};for(let C=0;C<v;C++)E[C+m]=new Wi({func:h.GEQUAL,mask:255},C+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=v,[E,p]}return[{[m]:Wi.disabled},p]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new kn([r.CONSTANT_COLOR,r.ONE],new a.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?kn.unblended:kn.alphaBlended}depthModeForSublayer(r,h,p){if(!this.opaquePassEnabledForLayer())return ki.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new ki(p||this.context.gl.LEQUAL,h,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,h){this.style=r,this.options=h,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(k.now()),this.imageManager.beginFrame();const p=this.style._order,m=this.style.sourceCaches,v={},E={},C={};for(const L in m){const F=m[L];F.used&&F.prepare(this.context),v[L]=F.getVisibleCoordinates(),E[L]=v[L].slice().reverse(),C[L]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let L=0;L<p.length;L++)if(this.style._layers[p[L]].is3D()){this.opaquePassCutoff=L;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const L of p){const F=this.style._layers[L];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const q=E[F.source];(F.type==="custom"||q.length)&&this.renderLayer(this,m[F.source],F,q)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?a.aO.black:a.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(r._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const L=this.style._layers[p[this.currentLayer]],F=m[L.source],q=v[L.source];this._renderTileClippingMasks(L,q),this.renderLayer(this,F,L,q)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const L=this.style._layers[p[this.currentLayer]],F=m[L.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(L))continue;const q=(L.type==="symbol"?C:E)[L.source];this._renderTileClippingMasks(L,v[L.source]),this.renderLayer(this,F,L,q)}if(this.options.showTileBoundaries){const L=function(F,q){let Z=null;const J=Object.values(F._layers).flatMap(se=>se.source&&!se.isHidden(q)?[F.sourceCaches[se.source]]:[]),me=J.filter(se=>se.getSource().type==="vector"),pe=J.filter(se=>se.getSource().type!=="vector"),ye=se=>{(!Z||Z.getSource().maxzoom<se.getSource().maxzoom)&&(Z=se)};return me.forEach(se=>ye(se)),Z||pe.forEach(se=>ye(se)),Z}(this.style,this.transform.zoom);L&&function(F,q,Z){for(let J=0;J<Z.length;J++)bc(F,q,Z[J])}(this,L,L.getVisibleCoordinates())}this.options.showPadding&&function(L){const F=L.transform.padding;hn(L,L.transform.height-(F.top||0),3,fh),hn(L,F.bottom||0,3,cl),Zo(L,F.left||0,3,vc),Zo(L,L.transform.width-(F.right||0),3,Gd);const q=L.transform.centerPoint;(function(Z,J,me,pe){dr(Z,J-1,me-10,2,20,pe),dr(Z,J-10,me-1,20,2,pe)})(L,q.x,L.transform.height-q.y,ph)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(r){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,p=this.transform.projMatrix;let m=this.terrainFacilitator.dirty;m||(m=r?!a.aY(h,p):!a.aZ(h,p)),m||(m=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),m&&(a.a_(h,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(v,E){const C=v.context,L=C.gl,F=kn.unblended,q=new ki(L.LEQUAL,ki.ReadWrite,[0,1]),Z=E.getTerrainMesh(),J=E.sourceCache.getRenderableTiles(),me=v.useProgram("terrainDepth");C.bindFramebuffer.set(E.getFramebuffer("depth").framebuffer),C.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),C.clear({color:a.aO.transparent,depth:1});for(const pe of J){const ye=E.getTerrainData(pe.tileID),se={u_matrix:v.transform.calculatePosMatrix(pe.tileID.toUnwrapped()),u_ele_delta:E.getMeshFrameDelta(v.transform.zoom)};me.draw(C,L.TRIANGLES,q,Wi.disabled,F,Zi.backCCW,se,ye,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments)}C.bindFramebuffer.set(null),C.viewport.set([0,0,v.width,v.height])}(this,this.style.map.terrain),function(v,E){const C=v.context,L=C.gl,F=kn.unblended,q=new ki(L.LEQUAL,ki.ReadWrite,[0,1]),Z=E.getTerrainMesh(),J=E.getCoordsTexture(),me=E.sourceCache.getRenderableTiles(),pe=v.useProgram("terrainCoords");C.bindFramebuffer.set(E.getFramebuffer("coords").framebuffer),C.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),C.clear({color:a.aO.transparent,depth:1}),E.coordsIndex=[];for(const ye of me){const se=E.getTerrainData(ye.tileID);C.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,J.texture);const Ee={u_matrix:v.transform.calculatePosMatrix(ye.tileID.toUnwrapped()),u_terrain_coords_id:(255-E.coordsIndex.length)/255,u_texture:0,u_ele_delta:E.getMeshFrameDelta(v.transform.zoom)};pe.draw(C,L.TRIANGLES,q,Wi.disabled,F,Zi.backCCW,Ee,se,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments),E.coordsIndex.push(ye.tileID.key)}C.bindFramebuffer.set(null),C.viewport.set([0,0,v.width,v.height])}(this,this.style.map.terrain))}renderLayer(r,h,p,m){if(!p.isHidden(this.transform.zoom)&&(p.type==="background"||p.type==="custom"||(m||[]).length))switch(this.id=p.id,p.type){case"symbol":(function(v,E,C,L,F){if(v.renderPass!=="translucent")return;const q=Wi.disabled,Z=v.colorModeForRenderPass();(C._unevaluatedLayout.hasValue("text-variable-anchor")||C._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(J,me,pe,ye,se,Ee,Ge){const be=me.transform,Ae=se==="map",He=Ee==="map";for(const Xe of J){const Ke=ye.getTile(Xe),nt=Ke.getBucket(pe);if(!nt||!nt.text||!nt.text.segments.get().length)continue;const it=a.ag(nt.textSizeData,be.zoom),pt=Xt(Ke,1,me.transform.zoom),_t=ti(Xe.posMatrix,He,Ae,me.transform,pt),oi=pe.layout.get("icon-text-fit")!=="none"&&nt.hasIconData();if(it){const yt=Math.pow(2,be.zoom-Ke.tileID.overscaledZ);nl(nt,Ae,He,Ge,be,_t,Xe.posMatrix,yt,it,oi,me.style.map.terrain?(Kt,si)=>me.style.map.terrain.getElevation(Xe,Kt,si):null)}}}(L,v,C,E,C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),F),C.paint.get("icon-opacity").constantOr(1)!==0&&ol(v,E,C,L,!1,C.paint.get("icon-translate"),C.paint.get("icon-translate-anchor"),C.layout.get("icon-rotation-alignment"),C.layout.get("icon-pitch-alignment"),C.layout.get("icon-keep-upright"),q,Z),C.paint.get("text-opacity").constantOr(1)!==0&&ol(v,E,C,L,!0,C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.layout.get("text-keep-upright"),q,Z),E.map.showCollisionBoxes&&(il(v,E,C,L,C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),!0),il(v,E,C,L,C.paint.get("icon-translate"),C.paint.get("icon-translate-anchor"),!1))})(r,h,p,m,this.style.placement.variableOffsets);break;case"circle":(function(v,E,C,L){if(v.renderPass!=="translucent")return;const F=C.paint.get("circle-opacity"),q=C.paint.get("circle-stroke-width"),Z=C.paint.get("circle-stroke-opacity"),J=!C.layout.get("circle-sort-key").isConstant();if(F.constantOr(1)===0&&(q.constantOr(1)===0||Z.constantOr(1)===0))return;const me=v.context,pe=me.gl,ye=v.depthModeForSublayer(0,ki.ReadOnly),se=Wi.disabled,Ee=v.colorModeForRenderPass(),Ge=[];for(let be=0;be<L.length;be++){const Ae=L[be],He=E.getTile(Ae),Xe=He.getBucket(C);if(!Xe)continue;const Ke=Xe.programConfigurations.get(C.id),nt=v.useProgram("circle",Ke),it=Xe.layoutVertexBuffer,pt=Xe.indexBuffer,_t=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ae),oi={programConfiguration:Ke,program:nt,layoutVertexBuffer:it,indexBuffer:pt,uniformValues:zd(v,Ae,He,C),terrainData:_t};if(J){const yt=Xe.segments.get();for(const Kt of yt)Ge.push({segments:new a.$([Kt]),sortKey:Kt.sortKey,state:oi})}else Ge.push({segments:Xe.segments,sortKey:0,state:oi})}J&&Ge.sort((be,Ae)=>be.sortKey-Ae.sortKey);for(const be of Ge){const{programConfiguration:Ae,program:He,layoutVertexBuffer:Xe,indexBuffer:Ke,uniformValues:nt,terrainData:it}=be.state;He.draw(me,pe.TRIANGLES,ye,se,Ee,Zi.disabled,nt,it,C.id,Xe,Ke,be.segments,C.paint,v.transform.zoom,Ae)}})(r,h,p,m);break;case"heatmap":(function(v,E,C,L){if(C.paint.get("heatmap-opacity")!==0)if(v.renderPass==="offscreen"){const F=v.context,q=F.gl,Z=Wi.disabled,J=new kn([q.ONE,q.ONE],a.aO.transparent,[!0,!0,!0,!0]);(function(me,pe,ye){const se=me.gl;me.activeTexture.set(se.TEXTURE1),me.viewport.set([0,0,pe.width/4,pe.height/4]);let Ee=ye.heatmapFbo;if(Ee)se.bindTexture(se.TEXTURE_2D,Ee.colorAttachment.get()),me.bindFramebuffer.set(Ee.framebuffer);else{const Ge=se.createTexture();se.bindTexture(se.TEXTURE_2D,Ge),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_WRAP_S,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_WRAP_T,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_MIN_FILTER,se.LINEAR),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_MAG_FILTER,se.LINEAR),Ee=ye.heatmapFbo=me.createFramebuffer(pe.width/4,pe.height/4,!1,!1),function(be,Ae,He,Xe){var Ke,nt;const it=be.gl,pt=(Ke=be.HALF_FLOAT)!==null&&Ke!==void 0?Ke:it.UNSIGNED_BYTE,_t=(nt=be.RGBA16F)!==null&&nt!==void 0?nt:it.RGBA;it.texImage2D(it.TEXTURE_2D,0,_t,Ae.width/4,Ae.height/4,0,it.RGBA,pt,null),Xe.colorAttachment.set(He)}(me,pe,Ge,Ee)}})(F,v,C),F.clear({color:a.aO.transparent});for(let me=0;me<L.length;me++){const pe=L[me];if(E.hasRenderableParent(pe))continue;const ye=E.getTile(pe),se=ye.getBucket(C);if(!se)continue;const Ee=se.programConfigurations.get(C.id),Ge=v.useProgram("heatmap",Ee),{zoom:be}=v.transform;Ge.draw(F,q.TRIANGLES,ki.disabled,Z,J,Zi.disabled,Yu(pe.posMatrix,ye,be,C.paint.get("heatmap-intensity")),null,C.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,C.paint,v.transform.zoom,Ee)}F.viewport.set([0,0,v.width,v.height])}else v.renderPass==="translucent"&&(v.context.setColorMode(v.colorModeForRenderPass()),function(F,q){const Z=F.context,J=Z.gl,me=q.heatmapFbo;if(!me)return;Z.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_2D,me.colorAttachment.get()),Z.activeTexture.set(J.TEXTURE1);let pe=q.colorRampTexture;pe||(pe=q.colorRampTexture=new te(Z,q.colorRamp,J.RGBA)),pe.bind(J.LINEAR,J.CLAMP_TO_EDGE),F.useProgram("heatmapTexture").draw(Z,J.TRIANGLES,ki.disabled,Wi.disabled,F.colorModeForRenderPass(),Zi.disabled,((ye,se,Ee,Ge)=>{const be=a.F();a.aN(be,0,ye.width,ye.height,0,0,1);const Ae=ye.context.gl;return{u_matrix:be,u_world:[Ae.drawingBufferWidth,Ae.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:se.paint.get("heatmap-opacity")}})(F,q),null,q.id,F.viewportBuffer,F.quadTriangleIndexBuffer,F.viewportSegments,q.paint,F.transform.zoom)}(v,C))})(r,h,p,m);break;case"line":(function(v,E,C,L){if(v.renderPass!=="translucent")return;const F=C.paint.get("line-opacity"),q=C.paint.get("line-width");if(F.constantOr(1)===0||q.constantOr(1)===0)return;const Z=v.depthModeForSublayer(0,ki.ReadOnly),J=v.colorModeForRenderPass(),me=C.paint.get("line-dasharray"),pe=C.paint.get("line-pattern"),ye=pe.constantOr(1),se=C.paint.get("line-gradient"),Ee=C.getCrossfadeParameters(),Ge=ye?"linePattern":me?"lineSDF":se?"lineGradient":"line",be=v.context,Ae=be.gl;let He=!0;for(const Xe of L){const Ke=E.getTile(Xe);if(ye&&!Ke.patternsLoaded())continue;const nt=Ke.getBucket(C);if(!nt)continue;const it=nt.programConfigurations.get(C.id),pt=v.context.program.get(),_t=v.useProgram(Ge,it),oi=He||_t.program!==pt,yt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Xe),Kt=pe.constantOr(null);if(Kt&&Ke.imageAtlas){const Qt=Ke.imageAtlas,ci=Qt.patternPositions[Kt.to.toString()],pi=Qt.patternPositions[Kt.from.toString()];ci&&pi&&it.setConstantPatternPositions(ci,pi)}const si=yt?Xe:null,Si=ye?rs(v,Ke,C,Ee,si):me?Ha(v,Ke,C,me,Ee,si):se?eh(v,Ke,C,nt.lineClipsArray.length,si):Wa(v,Ke,C,si);if(ye)be.activeTexture.set(Ae.TEXTURE0),Ke.imageAtlasTexture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),it.updatePaintBuffers(Ee);else if(me&&(oi||v.lineAtlas.dirty))be.activeTexture.set(Ae.TEXTURE0),v.lineAtlas.bind(be);else if(se){const Qt=nt.gradients[C.id];let ci=Qt.texture;if(C.gradientVersion!==Qt.version){let pi=256;if(C.stepInterpolant){const fn=E.getSource().maxzoom,Ri=Xe.canonical.z===fn?Math.ceil(1<<v.transform.maxZoom-Xe.canonical.z):1;pi=a.ac(a.aT(nt.maxLineLength/a.W*1024*Ri),256,be.maxTextureSize)}Qt.gradient=a.aU({expression:C.gradientExpression(),evaluationKey:"lineProgress",resolution:pi,image:Qt.gradient||void 0,clips:nt.lineClipsArray}),Qt.texture?Qt.texture.update(Qt.gradient):Qt.texture=new te(be,Qt.gradient,Ae.RGBA),Qt.version=C.gradientVersion,ci=Qt.texture}be.activeTexture.set(Ae.TEXTURE0),ci.bind(C.stepInterpolant?Ae.NEAREST:Ae.LINEAR,Ae.CLAMP_TO_EDGE)}_t.draw(be,Ae.TRIANGLES,Z,v.stencilModeForClipping(Xe),J,Zi.disabled,Si,yt,C.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,C.paint,v.transform.zoom,it,nt.layoutVertexBuffer2),He=!1}})(r,h,p,m);break;case"fill":(function(v,E,C,L){const F=C.paint.get("fill-color"),q=C.paint.get("fill-opacity");if(q.constantOr(1)===0)return;const Z=v.colorModeForRenderPass(),J=C.paint.get("fill-pattern"),me=v.opaquePassEnabledForLayer()&&!J.constantOr(1)&&F.constantOr(a.aO.transparent).a===1&&q.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===me){const pe=v.depthModeForSublayer(1,v.renderPass==="opaque"?ki.ReadWrite:ki.ReadOnly);hh(v,E,C,L,pe,Z,!1)}if(v.renderPass==="translucent"&&C.paint.get("fill-antialias")){const pe=v.depthModeForSublayer(C.getPaintProperty("fill-outline-color")?2:0,ki.ReadOnly);hh(v,E,C,L,pe,Z,!0)}})(r,h,p,m);break;case"fill-extrusion":(function(v,E,C,L){const F=C.paint.get("fill-extrusion-opacity");if(F!==0&&v.renderPass==="translucent"){const q=new ki(v.context.gl.LEQUAL,ki.ReadWrite,v.depthRangeFor3D);if(F!==1||C.paint.get("fill-extrusion-pattern").constantOr(1))al(v,E,C,L,q,Wi.disabled,kn.disabled),al(v,E,C,L,q,v.stencilModeFor3D(),v.colorModeForRenderPass());else{const Z=v.colorModeForRenderPass();al(v,E,C,L,q,Wi.disabled,Z)}}})(r,h,p,m);break;case"hillshade":(function(v,E,C,L){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const F=v.context,q=v.depthModeForSublayer(0,ki.ReadOnly),Z=v.colorModeForRenderPass(),[J,me]=v.renderPass==="translucent"?v.stencilConfigForOverlap(L):[{},L];for(const pe of me){const ye=E.getTile(pe);ye.needsHillshadePrepare!==void 0&&ye.needsHillshadePrepare&&v.renderPass==="offscreen"?yc(v,ye,C,q,Wi.disabled,Z):v.renderPass==="translucent"&&ll(v,pe,ye,C,q,J[pe.overscaledZ],Z)}F.viewport.set([0,0,v.width,v.height])})(r,h,p,m);break;case"raster":(function(v,E,C,L){if(v.renderPass!=="translucent"||C.paint.get("raster-opacity")===0||!L.length)return;const F=v.context,q=F.gl,Z=E.getSource(),J=v.useProgram("raster"),me=v.colorModeForRenderPass(),[pe,ye]=Z instanceof kt?[{},L]:v.stencilConfigForOverlap(L),se=ye[ye.length-1].overscaledZ,Ee=!v.options.moving;for(const Ge of ye){const be=v.depthModeForSublayer(Ge.overscaledZ-se,C.paint.get("raster-opacity")===1?ki.ReadWrite:ki.ReadOnly,q.LESS),Ae=E.getTile(Ge);Ae.registerFadeDuration(C.paint.get("raster-fade-duration"));const He=E.findLoadedParent(Ge,0),Xe=dh(Ae,He,E,C,v.transform,v.style.map.terrain);let Ke,nt;const it=C.paint.get("raster-resampling")==="nearest"?q.NEAREST:q.LINEAR;F.activeTexture.set(q.TEXTURE0),Ae.texture.bind(it,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST),F.activeTexture.set(q.TEXTURE1),He?(He.texture.bind(it,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST),Ke=Math.pow(2,He.tileID.overscaledZ-Ae.tileID.overscaledZ),nt=[Ae.tileID.canonical.x*Ke%1,Ae.tileID.canonical.y*Ke%1]):Ae.texture.bind(it,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST);const pt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ge),_t=pt?Ge:null,oi=_t?_t.posMatrix:v.transform.calculatePosMatrix(Ge.toUnwrapped(),Ee),yt=$a(oi,nt||[0,0],Ke||1,Xe,C);Z instanceof kt?J.draw(F,q.TRIANGLES,be,Wi.disabled,me,Zi.disabled,yt,pt,C.id,Z.boundsBuffer,v.quadTriangleIndexBuffer,Z.boundsSegments):J.draw(F,q.TRIANGLES,be,pe[Ge.overscaledZ],me,Zi.disabled,yt,pt,C.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}})(r,h,p,m);break;case"background":(function(v,E,C,L){const F=C.paint.get("background-color"),q=C.paint.get("background-opacity");if(q===0)return;const Z=v.context,J=Z.gl,me=v.transform,pe=me.tileSize,ye=C.paint.get("background-pattern");if(v.isPatternMissing(ye))return;const se=!ye&&F.a===1&&q===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==se)return;const Ee=Wi.disabled,Ge=v.depthModeForSublayer(0,se==="opaque"?ki.ReadWrite:ki.ReadOnly),be=v.colorModeForRenderPass(),Ae=v.useProgram(ye?"backgroundPattern":"background"),He=L||me.coveringTiles({tileSize:pe,terrain:v.style.map.terrain});ye&&(Z.activeTexture.set(J.TEXTURE0),v.imageManager.bind(v.context));const Xe=C.getCrossfadeParameters();for(const Ke of He){const nt=L?Ke.posMatrix:v.transform.calculatePosMatrix(Ke.toUnwrapped()),it=ye?Rd(nt,q,v,ye,{tileID:Ke,tileSize:pe},Xe):Dd(nt,q,F),pt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ke);Ae.draw(Z,J.TRIANGLES,Ge,Ee,be,Zi.disabled,it,pt,C.id,v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}})(r,0,p,m);break;case"custom":(function(v,E,C){const L=v.context,F=C.implementation;if(v.renderPass==="offscreen"){const q=F.prerender;q&&(v.setCustomLayerDefaults(),L.setColorMode(v.colorModeForRenderPass()),q.call(F,L.gl,v.transform.customLayerMatrix()),L.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),L.setColorMode(v.colorModeForRenderPass()),L.setStencilMode(Wi.disabled);const q=F.renderingMode==="3d"?new ki(v.context.gl.LEQUAL,ki.ReadWrite,v.depthRangeFor3D):v.depthModeForSublayer(0,ki.ReadOnly);L.setDepthMode(q),F.render(L.gl,v.transform.customLayerMatrix()),L.setDirty(),v.setBaseState(),L.bindFramebuffer.set(null)}})(r,0,p)}}translatePosMatrix(r,h,p,m,v){if(!p[0]&&!p[1])return r;const E=v?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(E){const F=Math.sin(E),q=Math.cos(E);p=[p[0]*q-p[1]*F,p[0]*F+p[1]*q]}const C=[v?p[0]:Xt(h,p[0],this.transform.zoom),v?p[1]:Xt(h,p[1],this.transform.zoom),0],L=new Float32Array(16);return a.H(L,r,C),L}saveTileTexture(r){const h=this._tileTextures[r.size[0]];h?h.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const h=this._tileTextures[r];return h&&h.length>0?h.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const h=this.imageManager.getPattern(r.from.toString()),p=this.imageManager.getPattern(r.to.toString());return!h||!p}useProgram(r,h){this.cache=this.cache||{};const p=r+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new qo(this.context,ca[r],h,th[r],this._showOverdrawInspector,this.style.map.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new te(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:r,drawingBufferHeight:h}=this.context.gl;return this.width!==r||this.height!==h}}class Go{constructor(r,h){this.points=r,this.planes=h}static fromInvProjectionMatrix(r,h,p){const m=Math.pow(2,p),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const L=1/(C=a.af([],C,r))[3]/h*m;return a.a$(C,C,[L,L,1/C[3],L])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const L=function(J,me){var pe=me[0],ye=me[1],se=me[2],Ee=pe*pe+ye*ye+se*se;return Ee>0&&(Ee=1/Math.sqrt(Ee)),J[0]=me[0]*Ee,J[1]=me[1]*Ee,J[2]=me[2]*Ee,J}([],function(J,me,pe){var ye=me[0],se=me[1],Ee=me[2],Ge=pe[0],be=pe[1],Ae=pe[2];return J[0]=se*Ae-Ee*be,J[1]=Ee*Ge-ye*Ae,J[2]=ye*be-se*Ge,J}([],Y([],v[C[0]],v[C[1]]),Y([],v[C[2]],v[C[1]]))),F=-((q=L)[0]*(Z=v[C[1]])[0]+q[1]*Z[1]+q[2]*Z[2]);var q,Z;return L.concat(F)});return new Go(v,E)}}class Wo{constructor(r,h){this.min=r,this.max=h,this.center=function(p,m,v){return p[0]=.5*m[0],p[1]=.5*m[1],p[2]=.5*m[2],p}([],function(p,m,v){return p[0]=m[0]+v[0],p[1]=m[1]+v[1],p[2]=m[2]+v[2],p}([],this.min,this.max))}quadrant(r){const h=[r%2==0,r<2],p=oe(this.min),m=oe(this.max);for(let v=0;v<h.length;v++)p[v]=h[v]?this.min[v]:this.center[v],m[v]=h[v]?this.center[v]:this.max[v];return m[2]=this.max[2],new Wo(p,m)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}intersects(r){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let m=0;m<r.planes.length;m++){const v=r.planes[m];let E=0;for(let C=0;C<h.length;C++)a.b0(v,h[C])>=0&&E++;if(E===0)return 0;E!==h.length&&(p=!1)}if(p)return 2;for(let m=0;m<3;m++){let v=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let C=0;C<r.points.length;C++){const L=r.points[C][m]-this.min[m];v=Math.min(v,L),E=Math.max(E,L)}if(E<0||v>this.max[m]-this.min[m])return 0}return 1}}class Fs{constructor(r=0,h=0,p=0,m=0){if(isNaN(r)||r<0||isNaN(h)||h<0||isNaN(p)||p<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=h,this.left=p,this.right=m}interpolate(r,h,p){return h.top!=null&&r.top!=null&&(this.top=a.z.number(r.top,h.top,p)),h.bottom!=null&&r.bottom!=null&&(this.bottom=a.z.number(r.bottom,h.bottom,p)),h.left!=null&&r.left!=null&&(this.left=a.z.number(r.left,h.left,p)),h.right!=null&&r.right!=null&&(this.right=a.z.number(r.right,h.right,p)),this}getCenter(r,h){const p=a.ac((this.left+r-this.right)/2,0,r),m=a.ac((this.top+h-this.bottom)/2,0,h);return new a.P(p,m)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Fs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const wc=85.051129;class hl{constructor(r,h,p,m,v){this.tileSize=512,this._renderWorldCopies=v===void 0||!!v,this._minZoom=r||0,this._maxZoom=h||22,this._minPitch=p??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Fs,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const r=new hl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return r.apply(this),r}apply(r){this.tileSize=r.tileSize,this.latRange=r.latRange,this.width=r.width,this.height=r.height,this._center=r._center,this._elevation=r._elevation,this.minElevationForCurrentTile=r.minElevationForCurrentTile,this.zoom=r.zoom,this.angle=r.angle,this._fov=r._fov,this._pitch=r._pitch,this._unmodified=r._unmodified,this._edgeInsets=r._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(r){const h=-a.b1(r,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var p=new a.A(4);return a.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}(),function(p,m,v){var E=m[0],C=m[1],L=m[2],F=m[3],q=Math.sin(v),Z=Math.cos(v);p[0]=E*Z+L*q,p[1]=C*Z+F*q,p[2]=E*-q+L*Z,p[3]=C*-q+F*Z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const h=a.ac(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(r){const h=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(r){r!==this._elevation&&(this._elevation=r,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,h,p){this._unmodified=!1,this._edgeInsets.interpolate(r,h,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const h=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(r){const h=[new a.b2(0,r)];if(this._renderWorldCopies){const p=this.pointCoordinate(new a.P(0,0)),m=this.pointCoordinate(new a.P(this.width,0)),v=this.pointCoordinate(new a.P(this.width,this.height)),E=this.pointCoordinate(new a.P(0,this.height)),C=Math.floor(Math.min(p.x,m.x,v.x,E.x)),L=Math.floor(Math.max(p.x,m.x,v.x,E.x)),F=1;for(let q=C-F;q<=L+F;q++)q!==0&&h.push(new a.b2(q,r))}return h}coveringTiles(r){var h,p;let m=this.coveringZoomLevel(r);const v=m;if(r.minzoom!==void 0&&m<r.minzoom)return[];r.maxzoom!==void 0&&m>r.maxzoom&&(m=r.maxzoom);const E=this.pointCoordinate(this.getCameraPoint()),C=a.Y.fromLngLat(this.center),L=Math.pow(2,m),F=[L*E.x,L*E.y,0],q=[L*C.x,L*C.y,0],Z=Go.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m);let J=r.minzoom||0;!r.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(J=m);const me=r.terrain?2/Math.min(this.tileSize,r.tileSize)*this.tileSize:3,pe=be=>({aabb:new Wo([be*L,0,0],[(be+1)*L,L,0]),zoom:0,x:0,y:0,wrap:be,fullyVisible:!1}),ye=[],se=[],Ee=m,Ge=r.reparseOverscaled?v:m;if(this._renderWorldCopies)for(let be=1;be<=3;be++)ye.push(pe(-be)),ye.push(pe(be));for(ye.push(pe(0));ye.length>0;){const be=ye.pop(),Ae=be.x,He=be.y;let Xe=be.fullyVisible;if(!Xe){const _t=be.aabb.intersects(Z);if(_t===0)continue;Xe=_t===2}const Ke=r.terrain?F:q,nt=be.aabb.distanceX(Ke),it=be.aabb.distanceY(Ke),pt=Math.max(Math.abs(nt),Math.abs(it));if(be.zoom===Ee||pt>me+(1<<Ee-be.zoom)-2&&be.zoom>=J){const _t=Ee-be.zoom,oi=F[0]-.5-(Ae<<_t),yt=F[1]-.5-(He<<_t);se.push({tileID:new a.Q(be.zoom===Ee?Ge:be.zoom,be.wrap,be.zoom,Ae,He),distanceSq:ve([q[0]-.5-Ae,q[1]-.5-He]),tileDistanceToCamera:Math.sqrt(oi*oi+yt*yt)})}else for(let _t=0;_t<4;_t++){const oi=(Ae<<1)+_t%2,yt=(He<<1)+(_t>>1),Kt=be.zoom+1;let si=be.aabb.quadrant(_t);if(r.terrain){const Si=new a.Q(Kt,be.wrap,Kt,oi,yt),Qt=r.terrain.getMinMaxElevation(Si),ci=(h=Qt.minElevation)!==null&&h!==void 0?h:this.elevation,pi=(p=Qt.maxElevation)!==null&&p!==void 0?p:this.elevation;si=new Wo([si.min[0],si.min[1],ci],[si.max[0],si.max[1],pi])}ye.push({aabb:si,zoom:Kt,x:oi,y:yt,wrap:be.wrap,fullyVisible:Xe})}}return se.sort((be,Ae)=>be.distanceSq-Ae.distanceSq).map(be=>be.tileID)}resize(r,h){this.width=r,this.height=h,this.pixelsToGLUnits=[2/r,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const h=a.ac(r.lat,-85.051129,wc);return new a.P(a.N(r.lng)*this.worldSize,a.O(h)*this.worldSize)}unproject(r){return new a.Y(r.x/this.worldSize,r.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(r){const h=this.elevation,p=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,m=this.pointLocation(this.centerPoint,r),v=r.getElevationForLngLatZoom(m,this.tileZoom);if(!(this.elevation-v))return;const E=p+h-v,C=Math.cos(this._pitch)*this.cameraToCenterDistance/E/a.b3(1,m.lat),L=this.scaleZoom(C/this.tileSize);this._elevation=v,this._center=m,this.zoom=L}setLocationAtPoint(r,h){const p=this.pointCoordinate(h),m=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(r),E=new a.Y(v.x-(p.x-m.x),v.y-(p.y-m.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(r,h){return h?this.coordinatePoint(this.locationCoordinate(r),h.getElevationForLngLatZoom(r,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(r))}pointLocation(r,h){return this.coordinateLocation(this.pointCoordinate(r,h))}locationCoordinate(r){return a.Y.fromLngLat(r)}coordinateLocation(r){return r&&r.toLngLat()}pointCoordinate(r,h){if(h){const J=h.pointCoordinate(r);if(J!=null)return J}const p=[r.x,r.y,0,1],m=[r.x,r.y,1,1];a.af(p,p,this.pixelMatrixInverse),a.af(m,m,this.pixelMatrixInverse);const v=p[3],E=m[3],C=p[1]/v,L=m[1]/E,F=p[2]/v,q=m[2]/E,Z=F===q?0:(0-F)/(q-F);return new a.Y(a.z.number(p[0]/v,m[0]/E,Z)/this.worldSize,a.z.number(C,L,Z)/this.worldSize)}coordinatePoint(r,h=0,p=this.pixelMatrix){const m=[r.x*this.worldSize,r.y*this.worldSize,h,1];return a.af(m,m,p),new a.P(m[0]/m[3],m[1]/m[3])}getBounds(){const r=Math.max(0,this.height/2-this.getHorizon());return new je().extend(this.pointLocation(new a.P(0,r))).extend(this.pointLocation(new a.P(this.width,r))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new je([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(r){r?(this.lngRange=[r.getWest(),r.getEast()],this.latRange=[r.getSouth(),r.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,wc])}calculatePosMatrix(r,h=!1){const p=r.key,m=h?this._alignedPosMatrixCache:this._posMatrixCache;if(m[p])return m[p];const v=r.canonical,E=this.worldSize/this.zoomScale(v.z),C=v.x+Math.pow(2,v.z)*r.wrap,L=a.an(new Float64Array(16));return a.H(L,L,[C*E,v.y*E,0]),a.J(L,L,[E/a.W,E/a.W,1]),a.K(L,h?this.alignedProjMatrix:this.projMatrix,L),m[p]=new Float32Array(L),m[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(r,h){h=a.ac(+h,this.minZoom,this.maxZoom);const p={center:new a.M(r.lng,r.lat),zoom:h};let m=this.lngRange;if(!this._renderWorldCopies&&m===null){const be=179.9999999999;m=[-be,be]}const v=this.tileSize*this.zoomScale(p.zoom);let E=0,C=v,L=0,F=v,q=0,Z=0;const{x:J,y:me}=this.size;if(this.latRange){const be=this.latRange;E=a.O(be[1])*v,C=a.O(be[0])*v,C-E<me&&(q=me/(C-E))}m&&(L=a.b1(a.N(m[0])*v,0,v),F=a.b1(a.N(m[1])*v,0,v),F<L&&(F+=v),F-L<J&&(Z=J/(F-L)));const{x:pe,y:ye}=this.project.call({worldSize:v},r);let se,Ee;const Ge=Math.max(Z||0,q||0);if(Ge){const be=new a.P(Z?(F+L)/2:pe,q?(C+E)/2:ye);return p.center=this.unproject.call({worldSize:v},be).wrap(),p.zoom+=this.scaleZoom(Ge),p}if(this.latRange){const be=me/2;ye-be<E&&(Ee=E+be),ye+be>C&&(Ee=C-be)}if(m){const be=(L+F)/2;let Ae=pe;this._renderWorldCopies&&(Ae=a.b1(pe,be-v/2,be+v/2));const He=J/2;Ae-He<L&&(se=L+He),Ae+He>F&&(se=F-He)}if(se!==void 0||Ee!==void 0){const be=new a.P(se??pe,Ee??ye);p.center=this.unproject.call({worldSize:v},be).wrap()}return p}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this._unmodified,{center:h,zoom:p}=this.getConstrained(this.center,this.zoom);this.center=h,this.zoom=p,this._unmodified=r,this._constraining=!1}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,h=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b3(1,this.center.lat)*this.worldSize;let m=a.an(new Float64Array(16));a.J(m,m,[this.width/2,-this.height/2,1]),a.H(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=a.an(new Float64Array(16)),a.J(m,m,[1,-1,1]),a.H(m,m,[-1,-1,0]),a.J(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const v=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),E=Math.min(this.elevation,this.minElevationForCurrentTile),C=v-E*this._pixelPerMeter/Math.cos(this._pitch),L=E<0?C:v,F=Math.PI/2+this._pitch,q=this._fov*(.5+r.y/this.height),Z=Math.sin(q)*L/Math.sin(a.ac(Math.PI-F-q,.01,Math.PI-.01)),J=this.getHorizon(),me=2*Math.atan(J/this.cameraToCenterDistance)*(.5+r.y/(2*J)),pe=Math.sin(me)*L/Math.sin(a.ac(Math.PI-F-me,.01,Math.PI-.01)),ye=Math.min(Z,pe),se=1.01*(Math.cos(Math.PI/2-this._pitch)*ye+L),Ee=this.height/50;m=new Float64Array(16),a.b4(m,this._fov,this.width/this.height,Ee,se),m[8]=2*-r.x/this.width,m[9]=2*r.y/this.height,a.J(m,m,[1,-1,1]),a.H(m,m,[0,0,-this.cameraToCenterDistance]),a.b5(m,m,this._pitch),a.ad(m,m,this.angle),a.H(m,m,[-h,-p,0]),this.mercatorMatrix=a.J([],m,[this.worldSize,this.worldSize,this.worldSize]),a.J(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.K(new Float64Array(16),this.labelPlaneMatrix,m),a.H(m,m,[0,0,-this.elevation]),this.projMatrix=m,this.invProjMatrix=a.ar([],m),this.pixelMatrix3D=a.K(new Float64Array(16),this.labelPlaneMatrix,m);const Ge=this.width%2/2,be=this.height%2/2,Ae=Math.cos(this.angle),He=Math.sin(this.angle),Xe=h-Math.round(h)+Ae*Ge+He*be,Ke=p-Math.round(p)+Ae*be+He*Ge,nt=new Float64Array(m);if(a.H(nt,nt,[Xe>.5?Xe-1:Xe,Ke>.5?Ke-1:Ke,0]),this.alignedProjMatrix=nt,m=a.ar(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const r=this.pointCoordinate(new a.P(0,0)),h=[r.x*this.worldSize,r.y*this.worldSize,0,1];return a.af(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,r))}getCameraQueryGeometry(r){const h=this.getCameraPoint();if(r.length===1)return[r[0],h];{let p=h.x,m=h.y,v=h.x,E=h.y;for(const C of r)p=Math.min(p,C.x),m=Math.min(m,C.y),v=Math.max(v,C.x),E=Math.max(E,C.y);return[new a.P(p,m),new a.P(v,m),new a.P(v,E),new a.P(p,E),new a.P(p,m)]}}lngLatToCameraDepth(r,h){const p=this.locationCoordinate(r),m=[p.x*this.worldSize,p.y*this.worldSize,h,1];return a.af(m,m,this.projMatrix),m[2]/m[3]}}function xc(y,r){let h,p=!1,m=null,v=null;const E=()=>{m=null,p&&(y.apply(v,h),m=setTimeout(E,r),p=!1)};return(...C)=>(p=!0,v=this,h=C,m||E(),m)}class kc{constructor(r){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let p;return h.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(p=m)}),(p&&p[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:p,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,h)}catch{}},this._updateHash=xc(this._updateHashUnthrottled,300),this._hashName=r&&encodeURIComponent(r)}addTo(r){return this._map=r,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(r){const h=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,m=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,m),E=Math.round(h.lng*v)/v,C=Math.round(h.lat*v)/v,L=this._map.getBearing(),F=this._map.getPitch();let q="";if(q+=r?`/${E}/${C}/${p}`:`${p}/${C}/${E}`,(L||F)&&(q+="/"+Math.round(10*L)/10),F&&(q+=`/${Math.round(F)}`),this._hashName){const Z=this._hashName;let J=!1;const me=window.location.hash.slice(1).split("&").map(pe=>{const ye=pe.split("=")[0];return ye===Z?(J=!0,`${ye}=${q}`):pe}).filter(pe=>pe);return J||me.push(`${Z}=${q}`),`#${me.join("&")}`}return`#${q}`}}const _a={linearity:.3,easing:a.b6(0,0,.3,1)},ls=a.e({deceleration:2500,maxSpeed:1400},_a),gh=a.e({deceleration:20,maxSpeed:1400},_a),_h=a.e({deceleration:1e3,maxSpeed:360},_a),yh=a.e({deceleration:1e3,maxSpeed:90},_a);class vh{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:k.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,h=k.now();for(;r.length>0&&h-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)h.zoom+=v.zoomDelta||0,h.bearing+=v.bearingDelta||0,h.pitch+=v.pitchDelta||0,v.panDelta&&h.pan._add(v.panDelta),v.around&&(h.around=v.around),v.pinchAround&&(h.pinchAround=v.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(h.pan.mag()){const v=va(h.pan.mag(),p,a.e({},ls,r||{}));m.offset=h.pan.mult(v.amount/h.pan.mag()),m.center=this._map.transform.center,ya(m,v)}if(h.zoom){const v=va(h.zoom,p,gh);m.zoom=this._map.transform.zoom+v.amount,ya(m,v)}if(h.bearing){const v=va(h.bearing,p,_h);m.bearing=this._map.transform.bearing+a.ac(v.amount,-179,179),ya(m,v)}if(h.pitch){const v=va(h.pitch,p,yh);m.pitch=this._map.transform.pitch+v.amount,ya(m,v)}if(m.zoom||m.bearing){const v=h.pinchAround===void 0?h.around:h.pinchAround;m.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),a.e(m,{noMoveStart:!0})}}function ya(y,r){(!y.duration||y.duration<r.duration)&&(y.duration=r.duration,y.easing=r.easing)}function va(y,r,h){const{maxSpeed:p,linearity:m,deceleration:v}=h,E=a.ac(y*m/(r/1e3),-p,p),C=Math.abs(E)/(v*m);return{easing:h.easing,duration:1e3*C,amount:E*(C/2)}}class wr extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,h,p,m={}){const v=I.mousePos(h.getCanvas(),p),E=h.unproject(v);super(r,a.e({point:v,lngLat:E,originalEvent:p},m)),this._defaultPrevented=!1,this.target=h}}class go extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,h,p){const m=r==="touchend"?p.changedTouches:p.touches,v=I.touchPos(h.getCanvasContainer(),m),E=v.map(L=>h.unproject(L)),C=v.reduce((L,F,q,Z)=>L.add(F.div(Z.length)),new a.P(0,0));super(r,{points:v,point:C,lngLats:E,lngLat:h.unproject(C),originalEvent:p}),this._defaultPrevented=!1}}class Sc extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,h,p){super(r,{originalEvent:p}),this._defaultPrevented=!1}}class to{constructor(r,h){this._map=r,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(r){return this._firePreventable(new Sc(r.type,this._map,r))}mousedown(r,h){return this._mousedownPos=h,this._firePreventable(new wr(r.type,this._map,r))}mouseup(r){this._map.fire(new wr(r.type,this._map,r))}click(r,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new wr(r.type,this._map,r))}dblclick(r){return this._firePreventable(new wr(r.type,this._map,r))}mouseover(r){this._map.fire(new wr(r.type,this._map,r))}mouseout(r){this._map.fire(new wr(r.type,this._map,r))}touchstart(r){return this._firePreventable(new go(r.type,this._map,r))}touchmove(r){this._map.fire(new go(r.type,this._map,r))}touchend(r){this._map.fire(new go(r.type,this._map,r))}touchcancel(r){this._map.fire(new go(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _o{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(r){this._map.fire(new wr(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new wr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._ignoreContextMenu||this._map.fire(new wr(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Os{constructor(r){this._map=r}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(r){return this.transform.pointLocation(a.P.convert(r),this._map.terrain)}}class io{constructor(r,h){this._map=r,this._tr=new Os(r),this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,h){this.isEnabled()&&r.shiftKey&&r.button===0&&(I.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(r,h){if(!this._active)return;const p=h;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=p,this._box||(this._box=I.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",r));const v=Math.min(m.x,p.x),E=Math.max(m.x,p.x),C=Math.min(m.y,p.y),L=Math.max(m.y,p.y);I.setTransform(this._box,`translate(${v}px,${C}px)`),this._box.style.width=E-v+"px",this._box.style.height=L-C+"px"}mouseupWindow(r,h){if(!this._active||r.button!==0)return;const p=this._startPos,m=h;if(this.reset(),I.suppressClick(),p.x!==m.x||p.y!==m.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:r})),{cameraAnimation:v=>v.fitScreenCoordinates(p,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(I.remove(this._box),this._box=null),I.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(r,h){return this._map.fire(new a.k(r,{originalEvent:h}))}}function cs(y,r){if(y.length!==r.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${r.length}`);const h={};for(let p=0;p<y.length;p++)h[y[p].identifier]=r[p];return h}class Wd{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(r,h,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=r.timeStamp),p.length===this.numTouches&&(this.centroid=function(m){const v=new a.P(0,0);for(const E of m)v._add(E);return v.div(m.length)}(h),this.touches=cs(p,h)))}touchmove(r,h,p){if(this.aborted||!this.centroid)return;const m=cs(p,h);for(const v in this.touches){const E=m[v];(!E||E.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(r,h,p){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Tc{constructor(r){this.singleTap=new Wd(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(r,h,p){this.singleTap.touchstart(r,h,p)}touchmove(r,h,p){this.singleTap.touchmove(r,h,p)}touchend(r,h,p){const m=this.singleTap.touchend(r,h,p);if(m){const v=r.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(m)<30;if(v&&E||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Hd{constructor(r){this._tr=new Os(r),this._zoomIn=new Tc({numTouches:1,numTaps:2}),this._zoomOut=new Tc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,h,p){this._zoomIn.touchstart(r,h,p),this._zoomOut.touchstart(r,h,p)}touchmove(r,h,p){this._zoomIn.touchmove(r,h,p),this._zoomOut.touchmove(r,h,p)}touchend(r,h,p){const m=this._zoomIn.touchend(r,h,p),v=this._zoomOut.touchend(r,h,p),E=this._tr;return m?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:E.zoom+1,around:E.unproject(m)},{originalEvent:r})}):v?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:E.zoom-1,around:E.unproject(v)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ns{constructor(r){this._enabled=!!r.enable,this._moveStateManager=r.moveStateManager,this._clickTolerance=r.clickTolerance||1,this._moveFunction=r.move,this._activateOnStart=!!r.activateOnStart,r.assignEvents(this),this.reset()}reset(r){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(r)}_move(...r){const h=this._moveFunction(...r);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(r,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(r)&&(this._moveStateManager.startMove(r),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(r,h){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(r.preventDefault(),!this._moveStateManager.isValidMoveEvent(r))return void this.reset(r);const m=h.length?h[0]:h;return!this._moved&&m.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(p,m))}dragEnd(r){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(r)&&(this._moved&&I.suppressClick(),this.reset(r))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ba={0:1,2:2};class yo{constructor(r){this._correctEvent=r.checkCorrectEvent}startMove(r){const h=I.mouseButton(r);this._eventButton=h}endMove(r){delete this._eventButton}isValidStartEvent(r){return this._correctEvent(r)}isValidMoveEvent(r){return!function(h,p){const m=ba[p];return h.buttons===void 0||(h.buttons&m)!==m}(r,this._eventButton)}isValidEndEvent(r){return I.mouseButton(r)===this._eventButton}}class Lt{constructor(){this._firstTouch=void 0}_isOneFingerTouch(r){return r.targetTouches.length===1}_isSameTouchEvent(r){return r.targetTouches[0].identifier===this._firstTouch}startMove(r){this._firstTouch=r.targetTouches[0].identifier}endMove(r){delete this._firstTouch}isValidStartEvent(r){return this._isOneFingerTouch(r)}isValidMoveEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}isValidEndEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}}const dl=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=function(r){r.preventDefault()}},js=({enable:y,clickTolerance:r,bearingDegreesPerPixelMoved:h=.8})=>{const p=new yo({checkCorrectEvent:m=>I.mouseButton(m)===0&&m.ctrlKey||I.mouseButton(m)===2});return new Ns({clickTolerance:r,move:(m,v)=>({bearingDelta:(v.x-m.x)*h}),moveStateManager:p,enable:y,assignEvents:dl})},Us=({enable:y,clickTolerance:r,pitchDegreesPerPixelMoved:h=-.5})=>{const p=new yo({checkCorrectEvent:m=>I.mouseButton(m)===0&&m.ctrlKey||I.mouseButton(m)===2});return new Ns({clickTolerance:r,move:(m,v)=>({pitchDelta:(v.y-m.y)*h}),moveStateManager:p,enable:y,assignEvents:dl})};class bh{constructor(r,h){this._clickTolerance=r.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(r,h,p){return this._calculateTransform(r,h,p)}touchmove(r,h,p){if(this._active&&!(p.length<this.minTouchs()))return r.preventDefault(),this._calculateTransform(r,h,p)}touchend(r,h,p){this._calculateTransform(r,h,p),this._active&&p.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,h,p){p.length>0&&(this._active=!0);const m=cs(p,h),v=new a.P(0,0),E=new a.P(0,0);let C=0;for(const F in m){const q=m[F],Z=this._touches[F];Z&&(v._add(q),E._add(q.sub(Z)),C++,m[F]=q)}if(this._touches=m,C<this.minTouchs()||!E.mag())return;const L=E.div(C);return this._sum._add(L),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(C),panDelta:L}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class St{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(r,h,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([h[0],h[1]]))}touchmove(r,h,p){if(!this._firstTwoTouches)return;r.preventDefault();const[m,v]=this._firstTwoTouches,E=Vs(p,h,m),C=Vs(p,h,v);if(!E||!C)return;const L=this._aroundCenter?null:E.add(C).div(2);return this._move([E,C],L,r)}touchend(r,h,p){if(!this._firstTwoTouches)return;const[m,v]=this._firstTwoTouches,E=Vs(p,h,m),C=Vs(p,h,v);E&&C||(this._active&&I.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Vs(y,r,h){for(let p=0;p<y.length;p++)if(y[p].identifier===h)return r[p]}function wh(y,r){return Math.log(y/r)/Math.LN2}class xh extends St{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,h){const p=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(wh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:wh(this._distance,p),pinchAround:h}}}function fl(y,r){return 180*y.angleWith(r)/Math.PI}class Ec extends St{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,h,p){const m=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:fl(this._vector,m),pinchAround:h}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const h=25/(Math.PI*this._minDiameter)*360,p=fl(r,this._startVector);return Math.abs(p)<h}}function pl(y){return Math.abs(y.y)>Math.abs(y.x)}class kh extends St{constructor(r){super(),this._currentTouchCount=0,this._map=r}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(r,h,p){super.touchstart(r,h,p),this._currentTouchCount=p.length}_start(r){this._lastPoints=r,pl(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,h,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=r[0].sub(this._lastPoints[0]),v=r[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,v,p.timeStamp),this._valid?(this._lastPoints=r,this._active=!0,{pitchDelta:(m.y+v.y)/2*-.5}):void 0}gestureBeginsVertically(r,h,p){if(this._valid!==void 0)return this._valid;const m=r.mag()>=2,v=h.mag()>=2;if(!m&&!v)return;if(!m||!v)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=r.y>0==h.y>0;return pl(r)&&pl(h)&&E}}const $d={panStep:100,bearingStep:15,pitchStep:10};class Ho{constructor(r){this._tr=new Os(r);const h=$d;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let h=0,p=0,m=0,v=0,E=0;switch(r.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:r.shiftKey?p=-1:(r.preventDefault(),v=-1);break;case 39:r.shiftKey?p=1:(r.preventDefault(),v=1);break;case 38:r.shiftKey?m=1:(r.preventDefault(),E=-1);break;case 40:r.shiftKey?m=-1:(r.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,m=0),{cameraAnimation:C=>{const L=this._tr;C.easeTo({duration:300,easeId:"keyboardHandler",easing:Yi,zoom:h?Math.round(L.zoom)+h*(r.shiftKey?2:1):L.zoom,bearing:L.bearing+p*this._bearingStep,pitch:L.pitch+m*this._pitchStep,offset:[-v*this._panStep,-E*this._panStep],center:L.center},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Yi(y){return y*(2-y)}const wa=4.000244140625;class ml{constructor(r,h){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=r,this._tr=new Os(r),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(r){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!r[this._map.cooperativeGestures._bypassKey])return;let h=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const p=k.now(),m=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,h!==0&&h%wa==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(m*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),r.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=r,this._delta-=h,this._active||this._start(r)),r.preventDefault()}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=I.mousePos(this._map.getCanvas(),r),p=this._tr;this._around=h.y>p.transform.height/2-p.transform.getHorizon()?a.M.convert(this._aroundCenter?p.center:p.unproject(h)):a.M.convert(p.center),this._aroundPoint=p.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._tr.transform;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>wa?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&L!==0&&(L=1/L);const F=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):r.scale;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(F*L))),this._type==="wheel"&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:r.zoom,p=this._startZoom,m=this._easing;let v,E=!1;if(this._type==="wheel"&&p&&m){const C=Math.min((k.now()-this._lastWheelEventTime)/200,1),L=m(C);v=a.z.number(p,h,L),C<1?this._frameId||(this._frameId=!0):E=!0}else v=h,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:v-r.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let h=a.b7;if(this._prevEase){const p=this._prevEase,m=(k.now()-p.start)/p.duration,v=p.easing(m+.01)-p.easing(m),E=.27/Math.sqrt(v*v+1e-4)*.01,C=Math.sqrt(.0729-E*E);h=a.b6(E,C,.25,1)}return this._prevEase={start:k.now(),duration:r,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Cc{constructor(r,h){this._clickZoom=r,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Sh{constructor(r){this._tr=new Os(r),this.reset()}reset(){this._active=!1}dblclick(r,h){return r.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(r.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Th{constructor(){this._tap=new Tc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(r,h,p){if(!this._swipePoint)if(this._tapTime){const m=h[0],v=r.timeStamp-this._tapTime<500,E=this._tapPoint.dist(m)<30;v&&E?p.length>0&&(this._swipePoint=m,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(r,h,p)}touchmove(r,h,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const m=h[0],v=m.y-this._swipePoint.y;return this._swipePoint=m,r.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(r,h,p)}touchend(r,h,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const m=this._tap.touchend(r,h,p);m&&(this._tapTime=r.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Eh{constructor(r,h,p){this._el=r,this._mousePan=h,this._touchPan=p}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class no{constructor(r,h,p){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=h,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class xa{constructor(r,h,p,m){this._el=r,this._touchZoom=h,this._touchRotate=p,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Nt{constructor(r,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=r,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const r=this._map.getCanvasContainer();r.classList.add("maplibregl-cooperative-gestures"),this._container=I.create("div","maplibregl-cooperative-gesture-screen",r);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=h,this._container.appendChild(m);const v=document.createElement("div");v.className="maplibregl-mobile-message",v.textContent=p,this._container.appendChild(v),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(I.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(r){this._onCooperativeGesture(r.touches.length===1)}wheel(r){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!r[this._bypassKey])}_onCooperativeGesture(r){this._enabled&&r&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const $t=y=>y.zoom||y.drag||y.pitch||y.rotate;class gl extends a.k{}function ka(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class Mc{constructor(r,h){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,v)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const E=m.type==="renderFrame"?void 0:m,C={needsRenderFrame:!1},L={},F={},q=m.touches,Z=q?this._getMapTouches(q):void 0,J=Z?I.touchPos(this._map.getCanvas(),Z):I.mousePos(this._map.getCanvas(),m);for(const{handlerName:ye,handler:se,allowed:Ee}of this._handlers){if(!se.isEnabled())continue;let Ge;this._blockedByActive(F,Ee,ye)?se.reset():se[v||m.type]&&(Ge=se[v||m.type](m,J,Z),this.mergeHandlerResult(C,L,Ge,ye,E),Ge&&Ge.needsRenderFrame&&this._triggerRenderFrame()),(Ge||se.isActive())&&(F[ye]=se)}const me={};for(const ye in this._previousActiveHandlers)F[ye]||(me[ye]=E);this._previousActiveHandlers=F,(Object.keys(me).length||ka(C))&&(this._changes.push([C,L,me]),this._triggerRenderFrame()),(Object.keys(F).length||ka(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:pe}=C;pe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],pe(this._map))},this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new vh(r),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,v,E]of this._listeners)I.addEventListener(m,v,m===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[r,h,p]of this._listeners)I.removeEventListener(r,h,r===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(r){const h=this._map,p=h.getCanvasContainer();this._add("mapEvent",new to(h,r));const m=h.boxZoom=new io(h,r);this._add("boxZoom",m),r.interactive&&r.boxZoom&&m.enable();const v=h.cooperativeGestures=new Nt(h,r.cooperativeGestures);this._add("cooperativeGestures",v),r.cooperativeGestures&&v.enable();const E=new Hd(h),C=new Sh(h);h.doubleClickZoom=new Cc(C,E),this._add("tapZoom",E),this._add("clickZoom",C),r.interactive&&r.doubleClickZoom&&h.doubleClickZoom.enable();const L=new Th;this._add("tapDragZoom",L);const F=h.touchPitch=new kh(h);this._add("touchPitch",F),r.interactive&&r.touchPitch&&h.touchPitch.enable(r.touchPitch);const q=js(r),Z=Us(r);h.dragRotate=new no(r,q,Z),this._add("mouseRotate",q,["mousePitch"]),this._add("mousePitch",Z,["mouseRotate"]),r.interactive&&r.dragRotate&&h.dragRotate.enable();const J=(({enable:Ge,clickTolerance:be})=>{const Ae=new yo({checkCorrectEvent:He=>I.mouseButton(He)===0&&!He.ctrlKey});return new Ns({clickTolerance:be,move:(He,Xe)=>({around:Xe,panDelta:Xe.sub(He)}),activateOnStart:!0,moveStateManager:Ae,enable:Ge,assignEvents:dl})})(r),me=new bh(r,h);h.dragPan=new Eh(p,J,me),this._add("mousePan",J),this._add("touchPan",me,["touchZoom","touchRotate"]),r.interactive&&r.dragPan&&h.dragPan.enable(r.dragPan);const pe=new Ec,ye=new xh;h.touchZoomRotate=new xa(p,ye,pe,L),this._add("touchRotate",pe,["touchPan","touchZoom"]),this._add("touchZoom",ye,["touchPan","touchRotate"]),r.interactive&&r.touchZoomRotate&&h.touchZoomRotate.enable(r.touchZoomRotate);const se=h.scrollZoom=new ml(h,()=>this._triggerRenderFrame());this._add("scrollZoom",se,["mousePan"]),r.interactive&&r.scrollZoom&&h.scrollZoom.enable(r.scrollZoom);const Ee=h.keyboard=new Ho(h);this._add("keyboard",Ee),r.interactive&&r.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new _o(h))}_add(r,h,p){this._handlers.push({handlerName:r,handler:h,allowed:p}),this._handlersById[r]=h}stop(r){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!$t(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,h,p){for(const m in r)if(m!==p&&(!h||h.indexOf(m)<0))return!0;return!1}_getMapTouches(r){const h=[];for(const p of r)this._el.contains(p.target)&&h.push(p);return h}mergeHandlerResult(r,h,p,m,v){if(!p)return;a.e(r,p);const E={handlerName:m,originalEvent:p.originalEvent||v};p.zoomDelta!==void 0&&(h.zoom=E),p.panDelta!==void 0&&(h.drag=E),p.pitchDelta!==void 0&&(h.pitch=E),p.bearingDelta!==void 0&&(h.rotate=E)}_applyChanges(){const r={},h={},p={};for(const[m,v,E]of this._changes)m.panDelta&&(r.panDelta=(r.panDelta||new a.P(0,0))._add(m.panDelta)),m.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(r.around=m.around),m.pinchAround!==void 0&&(r.pinchAround=m.pinchAround),m.noInertia&&(r.noInertia=m.noInertia),a.e(h,v),a.e(p,E);this._updateMapTransform(r,h,p),this._changes=[]}_updateMapTransform(r,h,p){const m=this._map,v=m._getTransformForUpdate(),E=m.terrain;if(!(ka(r)||E&&this._terrainMovement))return this._fireEvents(h,p,!0);let{panDelta:C,zoomDelta:L,bearingDelta:F,pitchDelta:q,around:Z,pinchAround:J}=r;J!==void 0&&(Z=J),m._stop(!0),Z=Z||m.transform.centerPoint;const me=v.pointLocation(C?Z.sub(C):Z);F&&(v.bearing+=F),q&&(v.pitch+=q),L&&(v.zoom+=L),E?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?v.center=v.pointLocation(v.centerPoint.sub(C)):v.setLocationAtPoint(me,Z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,v.setLocationAtPoint(me,Z),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,v.recalculateZoom(m.terrain)})):v.setLocationAtPoint(me,Z),m._applyUpdatedTransform(v),this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(h,p,!0)}_fireEvents(r,h,p){const m=$t(this._eventsInProgress),v=$t(r),E={};for(const q in r){const{originalEvent:Z}=r[q];this._eventsInProgress[q]||(E[`${q}start`]=Z),this._eventsInProgress[q]=r[q]}!m&&v&&this._fireEvent("movestart",v.originalEvent);for(const q in E)this._fireEvent(q,E[q]);v&&this._fireEvent("move",v.originalEvent);for(const q in r){const{originalEvent:Z}=r[q];this._fireEvent(q,Z)}const C={};let L;for(const q in this._eventsInProgress){const{handlerName:Z,originalEvent:J}=this._eventsInProgress[q];this._handlersById[Z].isActive()||(delete this._eventsInProgress[q],L=h[Z]||J,C[`${q}end`]=L)}for(const q in C)this._fireEvent(q,C[q]);const F=$t(this._eventsInProgress);if(p&&(m||v)&&!F){this._updatingCamera=!0;const q=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Z=J=>J!==0&&-this._bearingSnap<J&&J<this._bearingSnap;!q||!q.essential&&k.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:L})),Z(this._map.getBearing())&&this._map.resetNorth()):(Z(q.bearing||this._map.getBearing())&&(q.bearing=0),q.freezeElevation=!0,this._map.easeTo(q,{originalEvent:L})),this._updatingCamera=!1}}_fireEvent(r,h){this._map.fire(new a.k(r,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{delete this._frameId,this.handleEvent(new gl("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class xr extends a.E{constructor(r,h){super(),this._renderFrameCallback=()=>{const p=Math.min((k.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.M(this.transform.center.lng,this.transform.center.lat)}setCenter(r,h){return this.jumpTo({center:r},h)}panBy(r,h,p){return r=a.P.convert(r).mult(-1),this.panTo(this.transform.center,a.e({offset:r},h),p)}panTo(r,h,p){return this.easeTo(a.e({center:r},h),p)}getZoom(){return this.transform.zoom}setZoom(r,h){return this.jumpTo({zoom:r},h),this}zoomTo(r,h,p){return this.easeTo(a.e({zoom:r},h),p)}zoomIn(r,h){return this.zoomTo(this.getZoom()+1,r,h),this}zoomOut(r,h){return this.zoomTo(this.getZoom()-1,r,h),this}getBearing(){return this.transform.bearing}setBearing(r,h){return this.jumpTo({bearing:r},h),this}getPadding(){return this.transform.padding}setPadding(r,h){return this.jumpTo({padding:r},h),this}rotateTo(r,h,p){return this.easeTo(a.e({bearing:r},h),p)}resetNorth(r,h){return this.rotateTo(0,a.e({duration:1e3},r),h),this}resetNorthPitch(r,h){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},r),h),this}snapToNorth(r,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,h):this}getPitch(){return this.transform.pitch}setPitch(r,h){return this.jumpTo({pitch:r},h),this}cameraForBounds(r,h){r=je.convert(r);const p=h&&h.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),p,h)}_cameraForBoxAndBearing(r,h,p,m){const v={top:0,bottom:0,right:0,left:0};if(typeof(m=a.e({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const _t=m.padding;m.padding={top:_t,bottom:_t,right:_t,left:_t}}m.padding=a.e(v,m.padding);const E=this.transform,C=E.padding,L=new je(r,h),F=E.project(L.getNorthWest()),q=E.project(L.getNorthEast()),Z=E.project(L.getSouthEast()),J=E.project(L.getSouthWest()),me=a.b8(-p),pe=F.rotate(me),ye=q.rotate(me),se=Z.rotate(me),Ee=J.rotate(me),Ge=new a.P(Math.max(pe.x,ye.x,Ee.x,se.x),Math.max(pe.y,ye.y,Ee.y,se.y)),be=new a.P(Math.min(pe.x,ye.x,Ee.x,se.x),Math.min(pe.y,ye.y,Ee.y,se.y)),Ae=Ge.sub(be),He=(E.width-(C.left+C.right+m.padding.left+m.padding.right))/Ae.x,Xe=(E.height-(C.top+C.bottom+m.padding.top+m.padding.bottom))/Ae.y;if(Xe<0||He<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Ke=Math.min(E.scaleZoom(E.scale*Math.min(He,Xe)),m.maxZoom),nt=a.P.convert(m.offset),it=new a.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(a.b8(p)),pt=nt.add(it).mult(E.scale/E.zoomScale(Ke));return{center:E.unproject(F.add(Z).div(2).sub(pt)),zoom:Ke,bearing:p}}fitBounds(r,h,p){return this._fitInternal(this.cameraForBounds(r,h),h,p)}fitScreenCoordinates(r,h,p,m,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(r)),this.transform.pointLocation(a.P.convert(h)),p,m),m,v)}_fitInternal(r,h,p){return r?(delete(h=a.e(r,h)).padding,h.linear?this.easeTo(h,p):this.flyTo(h,p)):this}jumpTo(r,h){this.stop();const p=this._getTransformForUpdate();let m=!1,v=!1,E=!1;return"zoom"in r&&p.zoom!==+r.zoom&&(m=!0,p.zoom=+r.zoom),r.center!==void 0&&(p.center=a.M.convert(r.center)),"bearing"in r&&p.bearing!==+r.bearing&&(v=!0,p.bearing=+r.bearing),"pitch"in r&&p.pitch!==+r.pitch&&(E=!0,p.pitch=+r.pitch),r.padding==null||p.isPaddingEqual(r.padding)||(p.padding=r.padding),this._applyUpdatedTransform(p),this.fire(new a.k("movestart",h)).fire(new a.k("move",h)),m&&this.fire(new a.k("zoomstart",h)).fire(new a.k("zoom",h)).fire(new a.k("zoomend",h)),v&&this.fire(new a.k("rotatestart",h)).fire(new a.k("rotate",h)).fire(new a.k("rotateend",h)),E&&this.fire(new a.k("pitchstart",h)).fire(new a.k("pitch",h)).fire(new a.k("pitchend",h)),this.fire(new a.k("moveend",h))}calculateCameraOptionsFromTo(r,h,p,m=0){const v=a.Y.fromLngLat(r,h),E=a.Y.fromLngLat(p,m),C=E.x-v.x,L=E.y-v.y,F=E.z-v.z,q=Math.hypot(C,L,F);if(q===0)throw new Error("Can't calculate camera options with same From and To");const Z=Math.hypot(C,L),J=this.transform.scaleZoom(this.transform.cameraToCenterDistance/q/this.transform.tileSize),me=180*Math.atan2(C,-L)/Math.PI;let pe=180*Math.acos(Z/q)/Math.PI;return pe=F<0?90-pe:90+pe,{center:E.toLngLat(),zoom:J,pitch:pe,bearing:me}}easeTo(r,h){var p;this._stop(!1,r.easeId),((r=a.e({offset:[0,0],duration:500,easing:a.b7},r)).animate===!1||!r.essential&&k.prefersReducedMotion)&&(r.duration=0);const m=this._getTransformForUpdate(),v=this.getZoom(),E=this.getBearing(),C=this.getPitch(),L=this.getPadding(),F="bearing"in r?this._normalizeBearing(r.bearing,E):E,q="pitch"in r?+r.pitch:C,Z="padding"in r?r.padding:m.padding,J=a.P.convert(r.offset);let me=m.centerPoint.add(J);const pe=m.pointLocation(me),{center:ye,zoom:se}=m.getConstrained(a.M.convert(r.center||pe),(p=r.zoom)!==null&&p!==void 0?p:v);this._normalizeCenter(ye);const Ee=m.project(pe),Ge=m.project(ye).sub(Ee),be=m.zoomScale(se-v);let Ae,He;r.around&&(Ae=a.M.convert(r.around),He=m.locationPoint(Ae));const Xe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||se!==v,this._rotating=this._rotating||E!==F,this._pitching=this._pitching||q!==C,this._padding=!m.isPaddingEqual(Z),this._easeId=r.easeId,this._prepareEase(h,r.noMoveStart,Xe),this.terrain&&this._prepareElevation(ye),this._ease(Ke=>{if(this._zooming&&(m.zoom=a.z.number(v,se,Ke)),this._rotating&&(m.bearing=a.z.number(E,F,Ke)),this._pitching&&(m.pitch=a.z.number(C,q,Ke)),this._padding&&(m.interpolatePadding(L,Z,Ke),me=m.centerPoint.add(J)),this.terrain&&!r.freezeElevation&&this._updateElevation(Ke),Ae)m.setLocationAtPoint(Ae,He);else{const nt=m.zoomScale(m.zoom-v),it=se>v?Math.min(2,be):Math.max(.5,be),pt=Math.pow(it,1-Ke),_t=m.unproject(Ee.add(Ge.mult(Ke*pt)).mult(nt));m.setLocationAtPoint(m.renderWorldCopies?_t.wrap():_t,me)}this._applyUpdatedTransform(m),this._fireMoveEvents(h)},Ke=>{this.terrain&&this._finalizeElevation(),this._afterEase(h,Ke)},r),this}_prepareEase(r,h,p={}){this._moving=!0,h||p.moving||this.fire(new a.k("movestart",r)),this._zooming&&!p.zooming&&this.fire(new a.k("zoomstart",r)),this._rotating&&!p.rotating&&this.fire(new a.k("rotatestart",r)),this._pitching&&!p.pitching&&this.fire(new a.k("pitchstart",r))}_prepareElevation(r){this._elevationCenter=r,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(r){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(r<1&&h!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=r*(p-(h-(p*r+this._elevationStart))/(1-r)),this._elevationTarget=h}this.transform.elevation=a.z.number(this._elevationStart,this._elevationTarget,r)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(r){if(!this.transformCameraUpdate)return;const h=r.clone(),{center:p,zoom:m,pitch:v,bearing:E,elevation:C}=this.transformCameraUpdate(h);p&&(h.center=p),m!==void 0&&(h.zoom=m),v!==void 0&&(h.pitch=v),E!==void 0&&(h.bearing=E),C!==void 0&&(h.elevation=C),this.transform.apply(h)}_fireMoveEvents(r){this.fire(new a.k("move",r)),this._zooming&&this.fire(new a.k("zoom",r)),this._rotating&&this.fire(new a.k("rotate",r)),this._pitching&&this.fire(new a.k("pitch",r))}_afterEase(r,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const p=this._zooming,m=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new a.k("zoomend",r)),m&&this.fire(new a.k("rotateend",r)),v&&this.fire(new a.k("pitchend",r)),this.fire(new a.k("moveend",r))}flyTo(r,h){var p;if(!r.essential&&k.prefersReducedMotion){const Si=a.L(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Si,h)}this.stop(),r=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.b7},r);const m=this._getTransformForUpdate(),v=this.getZoom(),E=this.getBearing(),C=this.getPitch(),L=this.getPadding(),F="bearing"in r?this._normalizeBearing(r.bearing,E):E,q="pitch"in r?+r.pitch:C,Z="padding"in r?r.padding:m.padding,J=a.P.convert(r.offset);let me=m.centerPoint.add(J);const pe=m.pointLocation(me),{center:ye,zoom:se}=m.getConstrained(a.M.convert(r.center||pe),(p=r.zoom)!==null&&p!==void 0?p:v);this._normalizeCenter(ye);const Ee=m.zoomScale(se-v),Ge=m.project(pe),be=m.project(ye).sub(Ge);let Ae=r.curve;const He=Math.max(m.width,m.height),Xe=He/Ee,Ke=be.mag();if("minZoom"in r){const Si=a.ac(Math.min(r.minZoom,v,se),m.minZoom,m.maxZoom),Qt=He/m.zoomScale(Si-v);Ae=Math.sqrt(Qt/Ke*2)}const nt=Ae*Ae;function it(Si){const Qt=(Xe*Xe-He*He+(Si?-1:1)*nt*nt*Ke*Ke)/(2*(Si?Xe:He)*nt*Ke);return Math.log(Math.sqrt(Qt*Qt+1)-Qt)}function pt(Si){return(Math.exp(Si)-Math.exp(-Si))/2}function _t(Si){return(Math.exp(Si)+Math.exp(-Si))/2}const oi=it(!1);let yt=function(Si){return _t(oi)/_t(oi+Ae*Si)},Kt=function(Si){return He*((_t(oi)*(pt(Qt=oi+Ae*Si)/_t(Qt))-pt(oi))/nt)/Ke;var Qt},si=(it(!0)-oi)/Ae;if(Math.abs(Ke)<1e-6||!isFinite(si)){if(Math.abs(He-Xe)<1e-6)return this.easeTo(r,h);const Si=Xe<He?-1:1;si=Math.abs(Math.log(Xe/He))/Ae,Kt=function(){return 0},yt=function(Qt){return Math.exp(Si*Ae*Qt)}}return r.duration="duration"in r?+r.duration:1e3*si/("screenSpeed"in r?+r.screenSpeed/Ae:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0),this._zooming=!0,this._rotating=E!==F,this._pitching=q!==C,this._padding=!m.isPaddingEqual(Z),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(ye),this._ease(Si=>{const Qt=Si*si,ci=1/yt(Qt);m.zoom=Si===1?se:v+m.scaleZoom(ci),this._rotating&&(m.bearing=a.z.number(E,F,Si)),this._pitching&&(m.pitch=a.z.number(C,q,Si)),this._padding&&(m.interpolatePadding(L,Z,Si),me=m.centerPoint.add(J)),this.terrain&&!r.freezeElevation&&this._updateElevation(Si);const pi=Si===1?ye:m.unproject(Ge.add(be.mult(Kt(Qt))).mult(ci));m.setLocationAtPoint(m.renderWorldCopies?pi.wrap():pi,me),this._applyUpdatedTransform(m),this._fireMoveEvents(h)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(h)},r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,h)}if(!r){const p=this.handlers;p&&p.stop(!1)}return this}_ease(r,h,p){p.animate===!1||p.duration===0?(r(1),h()):(this._easeStart=k.now(),this._easeOptions=p,this._onEaseFrame=r,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(r,h){r=a.b1(r,-180,180);const p=Math.abs(r-h);return Math.abs(r-360-h)<p&&(r-=360),Math.abs(r+360-h)<p&&(r+=360),r}_normalizeCenter(r){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const p=r.lng-h.center.lng;r.lng+=p>180?-360:p<-180?360:0}queryTerrainElevation(r){return this.terrain?this.terrain.getElevationForLngLatZoom(a.M.convert(r),this.transform.tileZoom)-this.transform.elevation:null}}const Ic={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ro{constructor(r=Ic){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=r}getDefaultPosition(){return"bottom-right"}onAdd(r){return this._map=r,this._compact=this.options.compact,this._container=I.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=I.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=I.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){I.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(r,h){const p=this._map._getUIString(`AttributionControl.${h}`);r.title=p,r.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let r=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=r.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&r.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const h=this._map.style.sourceCaches;for(const m in h){const v=h[m];if(v.used||v.usedForTerrain){const E=v.getSource();E.attribution&&r.indexOf(E.attribution)<0&&r.push(E.attribution)}}r=r.filter(m=>String(m).trim()),r.sort((m,v)=>m.length-v.length),r=r.filter((m,v)=>{for(let E=v+1;E<r.length;E++)if(r[E].indexOf(m)>=0)return!1;return!0});const p=r.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,r.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ch{constructor(r={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const p=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=r}getDefaultPosition(){return"bottom-left"}onAdd(r){this._map=r,this._compact=this.options&&this.options.compact,this._container=I.create("div","maplibregl-ctrl");const h=I.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){I.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Sa{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const h=++this._id;return this._queue.push({callback:r,id:h,cancelled:!1}),h}remove(r){const h=this._currentlyRunning,p=h?this._queue.concat(h):this._queue;for(const m of p)if(m.id===r)return void(m.cancelled=!0)}run(r=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const p of h)if(!p.cancelled&&(p.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var dn=a.X([{name:"a_pos3d",type:"Int16",components:3}]);class Sn extends a.E{constructor(r){super(),this.sourceCache=r,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,r.usedForTerrain=!0,r.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(r,h){this.sourceCache.update(r,h),this._renderableTilesKeys=[];const p={};for(const m of r.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))p[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),a.aN(m.posMatrix,0,a.W,0,a.W,0,1),this._tiles[m.key]=new $n(m,this.tileSize));for(const m in this._tiles)p[m]||delete this._tiles[m]}freeRtt(r){for(const h in this._tiles){const p=this._tiles[h];(!r||p.tileID.equals(r)||p.tileID.isChildOf(r)||r.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(r=>this.getTileByID(r))}getTileByID(r){return this._tiles[r]}getTerrainCoords(r){const h={};for(const p of this._renderableTilesKeys){const m=this._tiles[p].tileID;if(m.canonical.equals(r.canonical)){const v=r.clone();v.posMatrix=new Float64Array(16),a.aN(v.posMatrix,0,a.W,0,a.W,0,1),h[p]=v}else if(m.canonical.isChildOf(r.canonical)){const v=r.clone();v.posMatrix=new Float64Array(16);const E=m.canonical.z-r.canonical.z,C=m.canonical.x-(m.canonical.x>>E<<E),L=m.canonical.y-(m.canonical.y>>E<<E),F=a.W>>E;a.aN(v.posMatrix,0,F,0,F,0,1),a.H(v.posMatrix,v.posMatrix,[-C*F,-L*F,0]),h[p]=v}else if(r.canonical.isChildOf(m.canonical)){const v=r.clone();v.posMatrix=new Float64Array(16);const E=r.canonical.z-m.canonical.z,C=r.canonical.x-(r.canonical.x>>E<<E),L=r.canonical.y-(r.canonical.y>>E<<E),F=a.W>>E;a.aN(v.posMatrix,0,a.W,0,a.W,0,1),a.H(v.posMatrix,v.posMatrix,[C*F,L*F,0]),a.J(v.posMatrix,v.posMatrix,[1/2**E,1/2**E,0]),h[p]=v}}return h}getSourceTile(r,h){const p=this.sourceCache._source;let m=r.overscaledZ-this.deltaZoom;if(m>p.maxzoom&&(m=p.maxzoom),m<p.minzoom)return null;this._sourceTileCache[r.key]||(this._sourceTileCache[r.key]=r.scaledTo(m).key);let v=this.sourceCache.getTileByID(this._sourceTileCache[r.key]);if((!v||!v.dem)&&h)for(;m>=p.minzoom&&(!v||!v.dem);)v=this.sourceCache.getTileByID(r.scaledTo(m--).key);return v}tilesAfterTime(r=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=r)}}class Mh{constructor(r,h,p){this.painter=r,this.sourceCache=new Sn(h),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(r,h,p,m=a.W){var v;if(!(h>=0&&h<m&&p>=0&&p<m))return 0;const E=this.getTerrainData(r),C=(v=E.tile)===null||v===void 0?void 0:v.dem;if(!C)return 0;const L=function(pe,ye,se){var Ee=ye[0],Ge=ye[1];return pe[0]=se[0]*Ee+se[4]*Ge+se[12],pe[1]=se[1]*Ee+se[5]*Ge+se[13],pe}([],[h/m*a.W,p/m*a.W],E.u_terrain_matrix),F=[L[0]*C.dim,L[1]*C.dim],q=Math.floor(F[0]),Z=Math.floor(F[1]),J=F[0]-q,me=F[1]-Z;return C.get(q,Z)*(1-J)*(1-me)+C.get(q+1,Z)*J*(1-me)+C.get(q,Z+1)*(1-J)*me+C.get(q+1,Z+1)*J*me}getElevationForLngLatZoom(r,h){const{tileID:p,mercatorX:m,mercatorY:v}=this._getOverscaledTileIDFromLngLatZoom(r,h);return this.getElevation(p,m%a.W,v%a.W,a.W)}getElevation(r,h,p,m=a.W){return this.getDEMElevation(r,h,p,m)*this.exaggeration}getTerrainData(r){if(!this._emptyDemTexture){const m=this.painter.context,v=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new te(m,v,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new te(m,new a.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.an([])}const h=this.sourceCache.getSourceTile(r,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const m=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new te(m,h.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),h.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const p=h&&h+h.tileID.key+r.key;if(p&&!this._demMatrixCache[p]){const m=this.sourceCache.sourceCache._source.maxzoom;let v=r.canonical.z-h.tileID.canonical.z;r.overscaledZ>r.canonical.z&&(r.canonical.z>=m?v=r.canonical.z-m:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const E=r.canonical.x-(r.canonical.x>>v<<v),C=r.canonical.y-(r.canonical.y>>v<<v),L=a.b9(new Float64Array(16),[1/(a.W<<v),1/(a.W<<v),0]);a.H(L,L,[E*a.W,C*a.W,0]),this._demMatrixCache[r.key]={matrix:L,coord:r}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[r.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(r){const h=this.painter,p=h.width/devicePixelRatio,m=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new te(h.context,{width:p,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new te(h.context,{width:p,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(p,m,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,p,m))),this._fbo.colorAttachment.set(r==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const r=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,E=0;v<this._coordsTextureSize;v++)for(let C=0;C<this._coordsTextureSize;C++,E+=4)h[E+0]=255&C,h[E+1]=255&v,h[E+2]=C>>8<<4|v>>8,h[E+3]=0;const p=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),m=new te(r,p,r.gl.RGBA,{premultiply:!1});return m.bind(r.gl.NEAREST,r.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(r){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),p=this.painter.context,m=p.gl,v=Math.round(r.x*this.painter.pixelRatio/devicePixelRatio),E=Math.round(r.y*this.painter.pixelRatio/devicePixelRatio),C=Math.round(this.painter.height/devicePixelRatio);p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(v,C-E-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null);const L=h[0]+(h[2]>>4<<8),F=h[1]+((15&h[2])<<8),q=this.coordsIndex[255-h[3]],Z=q&&this.sourceCache.getTileByID(q);if(!Z)return null;const J=this._coordsTextureSize,me=(1<<Z.tileID.canonical.z)*J;return new a.Y((Z.tileID.canonical.x*J+L)/me+Z.tileID.wrap,(Z.tileID.canonical.y*J+F)/me,this.getElevation(Z.tileID,L,F,J))}depthAtPoint(r){const h=new Uint8Array(4),p=this.painter.context,m=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(r.x,this.painter.height/devicePixelRatio-r.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const r=this.painter.context,h=new a.ba,p=new a.aX,m=this.meshSize,v=a.W/m,E=m*m;for(let Z=0;Z<=m;Z++)for(let J=0;J<=m;J++)h.emplaceBack(J*v,Z*v,0);for(let Z=0;Z<E;Z+=m+1)for(let J=0;J<m;J++)p.emplaceBack(J+Z,m+J+Z+1,m+J+Z+2),p.emplaceBack(J+Z,m+J+Z+2,J+Z+1);const C=h.length,L=C+2*(m+1);for(const Z of[0,1])for(let J=0;J<=m;J++)for(const me of[0,1])h.emplaceBack(J*v,Z*a.W,me);for(let Z=0;Z<2*m;Z+=2)p.emplaceBack(L+Z,L+Z+1,L+Z+3),p.emplaceBack(L+Z,L+Z+3,L+Z+2),p.emplaceBack(C+Z,C+Z+3,C+Z+1),p.emplaceBack(C+Z,C+Z+2,C+Z+3);const F=h.length,q=F+2*(m+1);for(const Z of[0,1])for(let J=0;J<=m;J++)for(const me of[0,1])h.emplaceBack(Z*a.W,J*v,me);for(let Z=0;Z<2*m;Z+=2)p.emplaceBack(F+Z,F+Z+1,F+Z+3),p.emplaceBack(F+Z,F+Z+3,F+Z+2),p.emplaceBack(q+Z,q+Z+3,q+Z+1),p.emplaceBack(q+Z,q+Z+2,q+Z+3);return this._mesh={indexBuffer:r.createIndexBuffer(p),vertexBuffer:r.createVertexBuffer(h,dn.members),segments:a.$.simpleSegment(0,0,h.length,p.length)},this._mesh}getMeshFrameDelta(r){return 2*Math.PI*a.bb/Math.pow(2,r)/5}getMinTileElevationForLngLatZoom(r,h){var p;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(r,h);return(p=this.getMinMaxElevation(m).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(r){const h=this.getTerrainData(r).tile,p={minElevation:null,maxElevation:null};return h&&h.dem&&(p.minElevation=h.dem.min*this.exaggeration,p.maxElevation=h.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(r,h){const p=a.Y.fromLngLat(r.wrap()),m=(1<<h)*a.W,v=p.x*m,E=p.y*m,C=Math.floor(v/a.W),L=Math.floor(E/a.W);return{tileID:new a.Q(h,0,h,C,L),mercatorX:v,mercatorY:E}}}class Ta{constructor(r,h,p){this._context=r,this._size=h,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const r of this._objects)r.texture.destroy(),r.fbo.destroy()}_createObject(r){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new te(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(p.texture),{id:r,fbo:h,texture:p,stamp:-1,inUse:!1}}getObjectForId(r){return this._objects[r]}useObject(r){r.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>r.id!==h),this._recentlyUsed.push(r.id)}stampObject(r){r.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const r=this._createObject(this._objects.length);return this._objects.push(r),r}freeObject(r){r.inUse=!1}freeAllObjects(){for(const r of this._objects)this.freeObject(r)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(r=>!r.inUse)===!1}}const Ao={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Lc{constructor(r,h){this.painter=r,this.terrain=h,this.pool=new Ta(r.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(r){return this.pool.getObjectForId(r.rtt[this._stacks.length-1].id).texture}prepareForRender(r,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=r._order.filter(p=>!r._layers[p].isHidden(h)),this._coordsDescendingInv={};for(const p in r.sourceCaches){this._coordsDescendingInv[p]={};const m=r.sourceCaches[p].getVisibleCoordinates();for(const v of m){const E=this.terrain.sourceCache.getTerrainCoords(v);for(const C in E)this._coordsDescendingInv[p][C]||(this._coordsDescendingInv[p][C]=[]),this._coordsDescendingInv[p][C].push(E[C])}}this._coordsDescendingInvStr={};for(const p of r._order){const m=r._layers[p],v=m.source;if(Ao[m.type]&&!this._coordsDescendingInvStr[v]){this._coordsDescendingInvStr[v]={};for(const E in this._coordsDescendingInv[v])this._coordsDescendingInvStr[v][E]=this._coordsDescendingInv[v][E].map(C=>C.key).sort().join()}}for(const p of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const v=this._coordsDescendingInvStr[m][p.tileID.key];v&&v!==p.rttCoords[m]&&(p.rtt=[])}}renderLayer(r){if(r.isHidden(this.painter.transform.zoom))return!1;const h=r.type,p=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===r.id;if(Ao[h]&&(this._prevType&&Ao[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(r.id),!m))return!0;if(Ao[this._prevType]||Ao[h]&&m){this._prevType=h;const v=this._stacks.length-1,E=this._stacks[v]||[];for(const C of this._renderableTiles){if(this.pool.isFull()&&(ul(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(C),C.rtt[v]){const F=this.pool.getObjectForId(C.rtt[v].id);if(F.stamp===C.rtt[v].stamp){this.pool.useObject(F);continue}}const L=this.pool.getOrCreateFreeObject();this.pool.useObject(L),this.pool.stampObject(L),C.rtt[v]={id:L.id,stamp:L.stamp},p.context.bindFramebuffer.set(L.fbo.framebuffer),p.context.clear({color:a.aO.transparent,stencil:0}),p.currentStencilSource=void 0;for(let F=0;F<E.length;F++){const q=p.style._layers[E[F]],Z=q.source?this._coordsDescendingInv[q.source][C.tileID.key]:[C.tileID];p.context.viewport.set([0,0,L.fbo.width,L.fbo.height]),p._renderTileClippingMasks(q,Z),p.renderLayer(p,p.style.sourceCaches[q.source],q,Z),q.source&&(C.rttCoords[q.source]=this._coordsDescendingInvStr[q.source][C.tileID.key])}}return ul(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ao[h]}return!1}}const Ac={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Pc=_,Ea={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Ic,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},_l=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},zc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Dc{constructor(r,h,p=!1){this.mousedown=E=>{this.startMouse(a.e({},E,{ctrlKey:!0,preventDefault:()=>E.preventDefault()}),I.mousePos(this.element,E)),I.addEventListener(window,"mousemove",this.mousemove),I.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=E=>{this.moveMouse(E,I.mousePos(this.element,E))},this.mouseup=E=>{this.mouseRotate.dragEnd(E),this.mousePitch&&this.mousePitch.dragEnd(E),this.offTemp()},this.touchstart=E=>{E.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=I.touchPos(this.element,E.targetTouches)[0],this.startTouch(E,this._startPos),I.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),I.addEventListener(window,"touchend",this.touchend))},this.touchmove=E=>{E.targetTouches.length!==1?this.reset():(this._lastPos=I.touchPos(this.element,E.targetTouches)[0],this.moveTouch(E,this._lastPos))},this.touchend=E=>{E.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=r.dragRotate._mouseRotate.getClickTolerance(),v=r.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=js({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:E,clickTolerance:C,bearingDegreesPerPixelMoved:L=.8})=>{const F=new Lt;return new Ns({clickTolerance:C,move:(q,Z)=>({bearingDelta:(Z.x-q.x)*L}),moveStateManager:F,enable:E,assignEvents:_l})})({clickTolerance:m,enable:!0}),this.map=r,p&&(this.mousePitch=Us({clickTolerance:v,enable:!0}),this.touchPitch=(({enable:E,clickTolerance:C,pitchDegreesPerPixelMoved:L=-.5})=>{const F=new Lt;return new Ns({clickTolerance:C,move:(q,Z)=>({pitchDelta:(Z.y-q.y)*L}),moveStateManager:F,enable:E,assignEvents:_l})})({clickTolerance:v,enable:!0})),I.addEventListener(h,"mousedown",this.mousedown),I.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),I.addEventListener(h,"touchcancel",this.reset)}startMouse(r,h){this.mouseRotate.dragStart(r,h),this.mousePitch&&this.mousePitch.dragStart(r,h),I.disableDrag()}startTouch(r,h){this.touchRotate.dragStart(r,h),this.touchPitch&&this.touchPitch.dragStart(r,h),I.disableDrag()}moveMouse(r,h){const p=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(r,h)||{};if(m&&p.setBearing(p.getBearing()+m),this.mousePitch){const{pitchDelta:v}=this.mousePitch.dragMove(r,h)||{};v&&p.setPitch(p.getPitch()+v)}}moveTouch(r,h){const p=this.map,{bearingDelta:m}=this.touchRotate.dragMove(r,h)||{};if(m&&p.setBearing(p.getBearing()+m),this.touchPitch){const{pitchDelta:v}=this.touchPitch.dragMove(r,h)||{};v&&p.setPitch(p.getPitch()+v)}}off(){const r=this.element;I.removeEventListener(r,"mousedown",this.mousedown),I.removeEventListener(r,"touchstart",this.touchstart,{passive:!1}),I.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),I.removeEventListener(window,"touchend",this.touchend),I.removeEventListener(r,"touchcancel",this.reset),this.offTemp()}offTemp(){I.enableDrag(),I.removeEventListener(window,"mousemove",this.mousemove),I.removeEventListener(window,"mouseup",this.mouseup),I.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),I.removeEventListener(window,"touchend",this.touchend)}}let Po;function yl(y,r,h){const p=new a.M(y.lng,y.lat);if(y=new a.M(y.lng,y.lat),r){const m=new a.M(y.lng-360,y.lat),v=new a.M(y.lng+360,y.lat),E=h.locationPoint(y).distSqr(r);h.locationPoint(m).distSqr(r)<E?y=m:h.locationPoint(v).distSqr(r)<E&&(y=v)}for(;Math.abs(y.lng-h.center.lng)>180;){const m=h.locationPoint(y);if(m.x>=0&&m.y>=0&&m.x<=h.width&&m.y<=h.height)break;y.lng>h.center.lng?y.lng-=360:y.lng+=360}return y.lng!==p.lng&&h.locationPoint(y).y>h.height/2-h.getHorizon()?y:p}const Ca={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function vl(y,r,h){const p=y.classList;for(const m in Ca)p.remove(`maplibregl-${h}-anchor-${m}`);p.add(`maplibregl-${h}-anchor-${r}`)}class Ma extends a.E{constructor(r){if(super(),this._onKeyPress=h=>{const p=h.code,m=h.charCode||h.keyCode;p!=="Space"&&p!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=h=>{const p=h.originalEvent.target,m=this._element;this._popup&&(p===m||m.contains(p))&&this.togglePopup()},this._update=h=>{var p;if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?yl(this._lngLat,this._flatPos,this._map.transform):(p=this._lngLat)===null||p===void 0?void 0:p.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let v="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?v=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(v=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E=`rotateX(${this._map.getPitch()}deg)`),h&&h.type!=="moveend"||(this._pos=this._pos.round()),I.setTransform(this._element,`${Ca[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${E} ${v}`),k.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment!=="auto"?r.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(r==null?void 0:r.opacity,r==null?void 0:r.opacityWhenCovered),r&&r.element)this._element=r.element,this._offset=a.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=I.create("div"),this._element.setAttribute("aria-label","Map marker");const h=I.createNS("http://www.w3.org/2000/svg","svg"),p=41,m=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${p}px`),h.setAttributeNS(null,"width",`${m}px`),h.setAttributeNS(null,"viewBox",`0 0 ${m} ${p}`);const v=I.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"stroke","none"),v.setAttributeNS(null,"stroke-width","1"),v.setAttributeNS(null,"fill","none"),v.setAttributeNS(null,"fill-rule","evenodd");const E=I.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");const C=I.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"transform","translate(3.0, 29.0)"),C.setAttributeNS(null,"fill","#000000");const L=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ee of L){const Ge=I.createNS("http://www.w3.org/2000/svg","ellipse");Ge.setAttributeNS(null,"opacity","0.04"),Ge.setAttributeNS(null,"cx","10.5"),Ge.setAttributeNS(null,"cy","5.80029008"),Ge.setAttributeNS(null,"rx",Ee.rx),Ge.setAttributeNS(null,"ry",Ee.ry),C.appendChild(Ge)}const F=I.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill",this._color);const q=I.createNS("http://www.w3.org/2000/svg","path");q.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),F.appendChild(q);const Z=I.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"fill","#000000");const J=I.createNS("http://www.w3.org/2000/svg","path");J.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Z.appendChild(J);const me=I.createNS("http://www.w3.org/2000/svg","g");me.setAttributeNS(null,"transform","translate(6.0, 7.0)"),me.setAttributeNS(null,"fill","#FFFFFF");const pe=I.createNS("http://www.w3.org/2000/svg","g");pe.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ye=I.createNS("http://www.w3.org/2000/svg","circle");ye.setAttributeNS(null,"fill","#000000"),ye.setAttributeNS(null,"opacity","0.25"),ye.setAttributeNS(null,"cx","5.5"),ye.setAttributeNS(null,"cy","5.5"),ye.setAttributeNS(null,"r","5.4999962");const se=I.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#FFFFFF"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962"),pe.appendChild(ye),pe.appendChild(se),E.appendChild(C),E.appendChild(F),E.appendChild(Z),E.appendChild(me),E.appendChild(pe),h.appendChild(E),h.setAttributeNS(null,"height",p*this._scale+"px"),h.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(h),this._offset=a.P.convert(r&&r.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),vl(this._element,this._anchor,"marker"),r&&r.className)for(const h of r.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(r){return this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._update),r.on("moveend",this._update),r.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),I.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=a.M.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const m=Math.abs(13.5)/Math.SQRT2;r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const r=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:r?(r.isOpen()?r.remove():(r.setLngLat(this._lngLat),r.addTo(this._map)),this):this}_updateOpacity(r=!1){var h,p;if(!(!((h=this._map)===null||h===void 0)&&h.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(r)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const m=this._map,v=m.terrain.depthAtPoint(this._pos),E=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,E)-v<.006)return void(this._element.style.opacity=this._opacity);const C=-this._offset.y/m.transform._pixelPerMeter,L=Math.sin(m.getPitch()*Math.PI/180)*C,F=m.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),q=m.transform.lngLatToCameraDepth(this._lngLat,E+L)-F>.006;!((p=this._popup)===null||p===void 0)&&p.isOpen()&&q&&this._popup.remove(),this._element.style.opacity=q?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(r){return this._offset=a.P.convert(r),this._update(),this}addClassName(r){this._element.classList.add(r)}removeClassName(r){this._element.classList.remove(r)}toggleClassName(r){return this._element.classList.toggle(r)}setDraggable(r){return this._draggable=!!r,this._map&&(r?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r&&r!=="auto"?r:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(r,h){return r===void 0&&h===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),r!==void 0&&(this._opacity=r),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const bl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let qs=0,us=!1;const wl={maxWidth:100,unit:"metric"};function xl(y,r,h){const p=h&&h.maxWidth||100,m=y._container.clientHeight/2,v=y.unproject([0,m]),E=y.unproject([p,m]),C=v.distanceTo(E);if(h&&h.unit==="imperial"){const L=3.2808*C;L>5280?hs(r,p,L/5280,y._getUIString("ScaleControl.Miles")):hs(r,p,L,y._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?hs(r,p,C/1852,y._getUIString("ScaleControl.NauticalMiles")):C>=1e3?hs(r,p,C/1e3,y._getUIString("ScaleControl.Kilometers")):hs(r,p,C,y._getUIString("ScaleControl.Meters"))}function hs(y,r,h,p){const m=function(v){const E=Math.pow(10,`${Math.floor(v)}`.length-1);let C=v/E;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(L){const F=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*F)/F}(C),E*C}(h);y.style.width=r*(m/h)+"px",y.innerHTML=`${m}&nbsp;${p}`}const Rc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Bc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function kl(y){if(y){if(typeof y=="number"){const r=Math.round(Math.abs(y)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,y),"top-left":new a.P(r,r),"top-right":new a.P(-r,r),bottom:new a.P(0,-y),"bottom-left":new a.P(r,-r),"bottom-right":new a.P(-r,-r),left:new a.P(y,0),right:new a.P(-y,0)}}if(y instanceof a.P||Array.isArray(y)){const r=a.P.convert(y);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:a.P.convert(y.center||[0,0]),top:a.P.convert(y.top||[0,0]),"top-left":a.P.convert(y["top-left"]||[0,0]),"top-right":a.P.convert(y["top-right"]||[0,0]),bottom:a.P.convert(y.bottom||[0,0]),"bottom-left":a.P.convert(y["bottom-left"]||[0,0]),"bottom-right":a.P.convert(y["bottom-right"]||[0,0]),left:a.P.convert(y.left||[0,0]),right:a.P.convert(y.right||[0,0])}}return kl(new a.P(0,0))}const Ih=_;f.AJAXError=a.be,f.Evented=a.E,f.LngLat=a.M,f.MercatorCoordinate=a.Y,f.Point=a.P,f.addProtocol=a.bf,f.config=a.a,f.removeProtocol=a.bg,f.AttributionControl=ro,f.BoxZoomHandler=io,f.CanvasSource=wn,f.CooperativeGesturesHandler=Nt,f.DoubleClickZoomHandler=Cc,f.DragPanHandler=Eh,f.DragRotateHandler=no,f.EdgeInsets=Fs,f.FullscreenControl=class extends a.E{constructor(y={}){super(),this._onFullscreenChange=()=>{var r;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((r=h==null?void 0:h.shadowRoot)===null||r===void 0)&&r.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=I.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){I.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=I.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);I.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},f.GeoJSONSource=Ve,f.GeolocateControl=class extends a.E{constructor(y){super(),this._onSuccess=r=>{if(this._map){if(this._isOutOfMapMaxBounds(r))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",r)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=r,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(r),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(r),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",r)),this._finish()}},this._updateCamera=r=>{const h=new a.M(r.coords.longitude,r.coords.latitude),p=r.coords.accuracy,m=this._map.getBearing(),v=a.e({bearing:m},this.options.fitBoundsOptions),E=je.fromLngLat(h,p);this._map.fitBounds(E,v,{geolocateSource:!0})},this._updateMarker=r=>{if(r){const h=new a.M(r.coords.longitude,r.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=r.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=r=>{if(this._map){if(this.options.trackUserLocation)if(r.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(r.code===3&&us)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",r)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=r=>{if(this._map){if(this._container.addEventListener("contextmenu",h=>h.preventDefault()),this._geolocateButton=I.create("button","maplibregl-ctrl-geolocate",this._container),I.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",r===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=I.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ma({element:this._dotElement}),this._circleElement=I.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ma({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")))})}},this.options=a.e({},bl,y)}onAdd(y){return this._map=y,this._container=I.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return a._(this,arguments,void 0,function*(r=!1){if(Po!==void 0&&!r)return Po;if(window.navigator.permissions===void 0)return Po=!!window.navigator.geolocation,Po;try{Po=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Po=!!window.navigator.geolocation}return Po})}().then(r=>this._setupUI(r)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),I.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,qs=0,us=!1}_isOutOfMapMaxBounds(y){const r=this._map.getMaxBounds(),h=y.coords;return r&&(h.longitude<r.getWest()||h.longitude>r.getEast()||h.latitude<r.getSouth()||h.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),r=y.getSouthEast(),h=y.getNorthEast(),p=r.distanceTo(h),m=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":qs--,us=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),qs++,qs>1?(y={maximumAge:6e5,timeout:0},us=!0):(y=this.options.positionOptions,us=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},f.Hash=kc,f.ImageSource=kt,f.KeyboardHandler=Ho,f.LngLatBounds=je,f.LogoControl=Ch,f.Map=class extends xr{constructor(y){if(a.bc.mark(a.bd.create),(y=a.e({},Ea,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new hl(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),{bearingSnap:y.bearingSnap}),this._contextLost=r=>{r.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.k("webglcontextlost",{originalEvent:r}))},this._contextRestored=r=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:r}))},this._onMapScroll=r=>{if(r.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new Sa,this._controls=[],this._mapId=a.a3(),this._locale=a.e({},Ac,y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this._imageQueueHandle=V.addThrottleControl(()=>this.isMoving()),this._requestManager=new j(y.transformRequest),typeof y.container=="string"){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let r=!1;const h=xc(p=>{this._trackResize&&!this._removed&&this.resize(p)._update()},50);this._resizeObserver=new ResizeObserver(p=>{r?h(p):r=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Mc(this,y),this._hash=y.hash&&new kc(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,a.e({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new ro(typeof y.attributionControl=="boolean"?void 0:y.attributionControl)),y.maplibreLogo&&this.addControl(new Ch,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new a.k(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new a.k(`${r.dataType}dataloading`,r))}),this.on("dataabort",r=>{this.fire(new a.k("sourcedataabort",r))})}_getMapId(){return this._mapId}addControl(y,r){if(r===void 0&&(r=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=y.onAdd(this);this._controls.push(y);const p=this._controlPositions[r];return r.indexOf("bottom")!==-1?p.insertBefore(h,p.firstChild):p.appendChild(h),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(y);return r>-1&&this._controls.splice(r,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,r,h,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,r,h,p)}resize(y){var r;const h=this._containerDimensions(),p=h[0],m=h[1],v=this._getClampedPixelRatio(p,m);if(this._resizeCanvas(p,m,v),this.painter.resize(p,m,v),this.painter.overLimit()){const C=this.painter.context.gl;this._maxCanvasSize=[C.drawingBufferWidth,C.drawingBufferHeight];const L=this._getClampedPixelRatio(p,m);this._resizeCanvas(p,m,L),this.painter.resize(p,m,L)}this.transform.resize(p,m),(r=this._requestedCameraState)===null||r===void 0||r.resize(p,m);const E=!this._moving;return E&&(this.stop(),this.fire(new a.k("movestart",y)).fire(new a.k("move",y))),this.fire(new a.k("resize",y)),E&&this.fire(new a.k("moveend",y)),this}_getClampedPixelRatio(y,r){const{0:h,1:p}=this._maxCanvasSize,m=this.getPixelRatio(),v=y*m,E=r*m;return Math.min(v>h?h/v:1,E>p?p/E:1)*m}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(je.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}project(y){return this.transform.locationPoint(a.M.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(a.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,r,h){if(y==="mouseenter"||y==="mouseover"){let p=!1;return{layer:r,listener:h,delegates:{mousemove:v=>{const E=this.getLayer(r)?this.queryRenderedFeatures(v.point,{layers:[r]}):[];E.length?p||(p=!0,h.call(this,new wr(y,this,v.originalEvent,{features:E}))):p=!1},mouseout:()=>{p=!1}}}}if(y==="mouseleave"||y==="mouseout"){let p=!1;return{layer:r,listener:h,delegates:{mousemove:E=>{(this.getLayer(r)?this.queryRenderedFeatures(E.point,{layers:[r]}):[]).length?p=!0:p&&(p=!1,h.call(this,new wr(y,this,E.originalEvent)))},mouseout:E=>{p&&(p=!1,h.call(this,new wr(y,this,E.originalEvent)))}}}}{const p=m=>{const v=this.getLayer(r)?this.queryRenderedFeatures(m.point,{layers:[r]}):[];v.length&&(m.features=v,h.call(this,m),delete m.features)};return{layer:r,listener:h,delegates:{[y]:p}}}}on(y,r,h){if(h===void 0)return super.on(y,r);const p=this._createDelegatedListener(y,r,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(p);for(const m in p.delegates)this.on(m,p.delegates[m]);return this}once(y,r,h){if(h===void 0)return super.once(y,r);const p=this._createDelegatedListener(y,r,h);for(const m in p.delegates)this.once(m,p.delegates[m]);return this}off(y,r,h){return h===void 0?super.off(y,r):(this._delegatedListeners&&this._delegatedListeners[y]&&(p=>{const m=this._delegatedListeners[y];for(let v=0;v<m.length;v++){const E=m[v];if(E.layer===r&&E.listener===h){for(const C in E.delegates)this.off(C,E.delegates[C]);return m.splice(v,1),this}}})(),this)}queryRenderedFeatures(y,r){if(!this.style)return[];let h;const p=y instanceof a.P||Array.isArray(y),m=p?y:[[0,0],[this.transform.width,this.transform.height]];if(r=r||(p?{}:y)||{},m instanceof a.P||typeof m[0]=="number")h=[a.P.convert(m)];else{const v=a.P.convert(m[0]),E=a.P.convert(m[1]);h=[v,new a.P(E.x,v.y),E,new a.P(v.x,E.y),v]}return this.style.queryRenderedFeatures(h,r,this.transform)}querySourceFeatures(y,r){return this.style.querySourceFeatures(y,r)}setStyle(y,r){return(r=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(y,r))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const r=this._locale[y];if(r==null)throw new Error(`Missing UI string '${y}'`);return r}_updateStyle(y,r){if(r.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,r));const h=this.style&&r.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new zr(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,r,h):this.style.loadJSON(y,r,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new zr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,r){if(typeof y=="string"){const h=this._requestManager.transformRequest(y,"Style");a.h(h,new AbortController).then(p=>{this._updateDiff(p.data,r)}).catch(p=>{p&&this.fire(new a.j(p))})}else typeof y=="object"&&this._updateDiff(y,r)}_updateDiff(y,r){try{this.style.setState(y,r)&&this._update(!0)}catch(h){a.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(y,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(y,r){return this._lazyInitEmptyStyle(),this.style.addSource(y,r),this._update(!0)}isSourceLoaded(y){const r=this.style&&this.style.sourceCaches[y];if(r!==void 0)return r.loaded();this.fire(new a.j(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const r=this.style.sourceCaches[y.source];if(!r)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&r.reload();for(const h in this.style._layers){const p=this.style._layers[h];p.type==="hillshade"&&p.source===y.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Mh(this.painter,r,y),this.painter.renderToTexture=new Lc(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==y.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:y})),this}getTerrain(){var y,r;return(r=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&r!==void 0?r:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const r in y){const h=y[r]._tiles;for(const p in h){const m=h[p];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,r,h={}){const{pixelRatio:p=1,sdf:m=!1,stretchX:v,stretchY:E,content:C}=h;if(this._lazyInitEmptyStyle(),!(r instanceof HTMLImageElement||a.b(r))){if(r.width===void 0||r.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:L,height:F,data:q}=r,Z=r;return this.style.addImage(y,{data:new a.R({width:L,height:F},new Uint8Array(q)),pixelRatio:p,stretchX:v,stretchY:E,content:C,sdf:m,version:0,userImage:Z}),Z.onAdd&&Z.onAdd(this,y),this}}{const{width:L,height:F,data:q}=k.getImageData(r);this.style.addImage(y,{data:new a.R({width:L,height:F},q),pixelRatio:p,stretchX:v,stretchY:E,content:C,sdf:m,version:0})}}updateImage(y,r){const h=this.style.getImage(y);if(!h)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=r instanceof HTMLImageElement||a.b(r)?k.getImageData(r):r,{width:m,height:v,data:E}=p;if(m===void 0||v===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==h.data.width||v!==h.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const C=!(r instanceof HTMLImageElement||a.b(r));return h.data.replace(E,C),this.style.updateImage(y,h),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return V.getImage(this._requestManager.transformRequest(y,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,r){return this._lazyInitEmptyStyle(),this.style.addLayer(y,r),this._update(!0)}moveLayer(y,r){return this.style.moveLayer(y,r),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,r,h){return this.style.setLayerZoomRange(y,r,h),this._update(!0)}setFilter(y,r,h={}){return this.style.setFilter(y,r,h),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,r,h,p={}){return this.style.setPaintProperty(y,r,h,p),this._update(!0)}getPaintProperty(y,r){return this.style.getPaintProperty(y,r)}setLayoutProperty(y,r,h,p={}){return this.style.setLayoutProperty(y,r,h,p),this._update(!0)}getLayoutProperty(y,r){return this.style.getLayoutProperty(y,r)}setGlyphs(y,r={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,r),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,r,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,r,h,p=>{p||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,r={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,r,h=>{h||this._update(!0)}),this}setLight(y,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,r),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(y,r){return this.style.setFeatureState(y,r),this._update()}removeFeatureState(y,r){return this.style.removeFeatureState(y,r),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,r=0;return this._container&&(y=this._container.clientWidth||400,r=this._container.clientHeight||300),[y,r]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const r=this._canvasContainer=I.create("div","maplibregl-canvas-container",y);this._interactive&&r.classList.add("maplibregl-interactive"),this._canvas=I.create("canvas","maplibregl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),p=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],p);const m=this._controlContainer=I.create("div","maplibregl-control-container",y),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(E=>{v[E]=I.create("div",`maplibregl-ctrl-${E} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,r,h){this._canvas.width=Math.floor(h*y),this._canvas.height=Math.floor(h*r),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${r}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let r=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{r={requestedAttributes:y},p&&(r.statusMessage=p.statusMessage,r.type=p.type)},{once:!0});const h=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!h){const p="Failed to initialize WebGL";throw r?(r.message=p,new Error(JSON.stringify(r))):new Error(p)}this.painter=new mh(h,this.transform),P.testSupport(h)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const r=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,v=k.now();this.style.zoomHistory.update(m,v);const E=new a.a8(m,{now:v,fadeDuration:r,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),C=E.crossFadingFactor();C===1&&C===this._crossFadingFactor||(h=!0,this._crossFadingFactor=C),this.style.update(E)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,r,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:r,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bc.mark(a.bd.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,a.bc.mark(a.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),V.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),I.remove(this._canvasContainer),I.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),a.bc.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,k.frameAsync(this._frameRequest).then(y=>{a.bc.frame(y),this._frameRequest=null,this._render(y)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return Pc}getCameraTargetElevation(){return this.transform.elevation}},f.MapMouseEvent=wr,f.MapTouchEvent=go,f.MapWheelEvent=Sc,f.Marker=Ma,f.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const r=this._map.getZoom(),h=r===this._map.getMaxZoom(),p=r===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=r},this._setButtonTitle=(r,h)=>{const p=this._map._getUIString(`NavigationControl.${h}`);r.title=p,r.setAttribute("aria-label",p)},this.options=a.e({},zc,y),this._container=I.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",r=>this._map.zoomIn({},{originalEvent:r})),I.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",r=>this._map.zoomOut({},{originalEvent:r})),I.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",r=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:r}):this._map.resetNorth({},{originalEvent:r})}),this._compassIcon=I.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Dc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){I.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,r){const h=I.create("button",y,this._container);return h.type="button",h.addEventListener("click",r),h}},f.Popup=class extends a.E{constructor(y){super(),this.remove=()=>(this._content&&I.remove(this._content),this._container&&(I.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.k("close"))),this),this._onMouseUp=r=>{this._update(r.point)},this._onMouseMove=r=>{this._update(r.point)},this._onDrag=r=>{this._update(r.point)},this._update=r=>{var h;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=I.create("div","maplibregl-popup",this._map.getContainer()),this._tip=I.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const C of this.options.className.split(" "))this._container.classList.add(C);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?yl(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._trackPointer&&!r)return;const p=this._flatPos=this._pos=this._trackPointer&&r?r:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&r?r:this._map.transform.locationPoint(this._lngLat));let m=this.options.anchor;const v=kl(this.options.offset);if(!m){const C=this._container.offsetWidth,L=this._container.offsetHeight;let F;F=p.y+v.bottom.y<L?["top"]:p.y>this._map.transform.height-L?["bottom"]:[],p.x<C/2?F.push("left"):p.x>this._map.transform.width-C/2&&F.push("right"),m=F.length===0?"bottom":F.join("-")}let E=p.add(v[m]);this.options.subpixelPositioning||(E=E.round()),I.setTransform(this._container,`${Ca[m]} translate(${E.x}px,${E.y}px)`),vl(this._container,m,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(Rc),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=a.M.convert(y),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const r=document.createDocumentFragment(),h=document.createElement("body");let p;for(h.innerHTML=y;p=h.firstChild,p;)r.appendChild(p);return this.setDOMContent(r)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=I.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){this._container&&this._container.classList.add(y)}removeClassName(y){this._container&&this._container.classList.remove(y)}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}setSubpixelPositioning(y){this.options.subpixelPositioning=y}_createCloseButton(){this.options.closeButton&&(this._closeButton=I.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Bc);y&&y.focus()}},f.RasterDEMTileSource=di,f.RasterTileSource=we,f.ScaleControl=class{constructor(y){this._onMove=()=>{xl(this._map,this._container,this.options)},this.setUnit=r=>{this.options.unit=r,xl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},wl),y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=I.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){I.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},f.ScrollZoomHandler=ml,f.Style=zr,f.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=I.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=I.create("button","maplibregl-ctrl-terrain",this._container),I.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){I.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},f.TwoFingersTouchPitchHandler=kh,f.TwoFingersTouchRotateHandler=Ec,f.TwoFingersTouchZoomHandler=xh,f.TwoFingersTouchZoomRotateHandler=xa,f.VectorTileSource=xt,f.VideoSource=bn,f.addSourceType=(y,r)=>a._(void 0,void 0,void 0,function*(){if(tr(y))throw new Error(`A source type called "${y}" already exists.`);((h,p)=>{Cn[h]=p})(y,r)}),f.clearPrewarmedResources=function(){const y=ei;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(Pt),ei=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},f.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},f.getRTLTextPluginStatus=function(){return ut().getRTLTextPluginStatus()},f.getVersion=function(){return Ih},f.getWorkerCount=function(){return Jt.workerCount},f.getWorkerUrl=function(){return a.a.WORKER_URL},f.importScriptInWorkers=function(y){return gi().broadcast("IS",y)},f.prewarm=function(){hi().acquire(Pt)},f.setMaxParallelImageRequests=function(y){a.a.MAX_PARALLEL_IMAGE_REQUESTS=y},f.setRTLTextPlugin=function(y,r){return ut().setRTLTextPlugin(y,r)},f.setWorkerCount=function(y){Jt.workerCount=y},f.setWorkerUrl=function(y){a.a.WORKER_URL=y}});var u=t;return u})})(Xy);var Ts=Xy.exports;const Qr=$y(Ts),db=Wv({__proto__:null,default:Qr},[Ts]);let jt;const Jy=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Jy.decode();let du=null;function wu(){return(du===null||du.byteLength===0)&&(du=new Uint8Array(jt.memory.buffer)),du}function So(o,e){return o=o>>>0,Jy.decode(wu().subarray(o,o+e))}const bs=new Array(128).fill(void 0);bs.push(void 0,null,!0,!1);let xu=bs.length;function Rn(o){xu===bs.length&&bs.push(bs.length+1);const e=xu;return xu=bs[e],bs[e]=o,e}function Ti(o){return bs[o]}function fb(o){o<132||(bs[o]=xu,xu=o)}function ql(o){const e=Ti(o);return fb(o),e}function Of(o){return o==null}let fu=null;function pb(){return(fu===null||fu.byteLength===0)&&(fu=new Float64Array(jt.memory.buffer)),fu}let pu=null;function Ii(){return(pu===null||pu.byteLength===0)&&(pu=new Int32Array(jt.memory.buffer)),pu}let Js=0;const rd=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},mb=typeof rd.encodeInto=="function"?function(o,e){return rd.encodeInto(o,e)}:function(o,e){const t=rd.encode(o);return e.set(t),{read:o.length,written:t.length}};function Qh(o,e,t){if(t===void 0){const a=rd.encode(o),_=e(a.length,1)>>>0;return wu().subarray(_,_+a.length).set(a),Js=a.length,_}let n=o.length,c=e(n,1)>>>0;const u=wu();let f=0;for(;f<n;f++){const a=o.charCodeAt(f);if(a>127)break;u[c+f]=a}if(f!==n){f!==0&&(o=o.slice(f)),c=t(c,n,n=f+o.length*3,1)>>>0;const a=wu().subarray(c+f,c+n),_=mb(o,a);f+=_.written}return Js=f,c}function Jf(o){const e=typeof o;if(e=="number"||e=="boolean"||o==null)return`${o}`;if(e=="string")return`"${o}"`;if(e=="symbol"){const c=o.description;return c==null?"Symbol":`Symbol(${c})`}if(e=="function"){const c=o.name;return typeof c=="string"&&c.length>0?`Function(${c})`:"Function"}if(Array.isArray(o)){const c=o.length;let u="[";c>0&&(u+=Jf(o[0]));for(let f=1;f<c;f++)u+=", "+Jf(o[f]);return u+="]",u}const t=/\[object ([^\]]+)\]/.exec(toString.call(o));let n;if(t.length>1)n=t[1];else return toString.call(o);if(n=="Object")try{return"Object("+JSON.stringify(o)+")"}catch{return"Object"}return o instanceof Error?`${o.name}: ${o.message}
${o.stack}`:n}function gb(o,e){const t=e(o.length*1,1)>>>0;return wu().set(o,t/1),Js=o.length,t}function Nf(o,e){try{return o.apply(this,e)}catch(t){jt.__wbindgen_exn_store(Rn(t))}}class md{static __wrap(e){e=e>>>0;const t=Object.create(md.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();jt.__wbg_jsroutesnapper_free(e)}constructor(e){try{const u=jt.__wbindgen_add_to_stack_pointer(-16),f=gb(e,jt.__wbindgen_malloc),a=Js;jt.jsroutesnapper_new(u,f,a);var t=Ii()[u/4+0],n=Ii()[u/4+1],c=Ii()[u/4+2];if(c)throw ql(n);return md.__wrap(t)}finally{jt.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){jt.jsroutesnapper_setRouteConfig(this.__wbg_ptr,Rn(e))}setAreaMode(){jt.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const u=jt.__wbindgen_add_to_stack_pointer(-16);jt.jsroutesnapper_getConfig(u,this.__wbg_ptr);var n=Ii()[u/4+0],c=Ii()[u/4+1];return e=n,t=c,So(n,c)}finally{jt.__wbindgen_add_to_stack_pointer(16),jt.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const n=jt.__wbindgen_add_to_stack_pointer(-16);jt.jsroutesnapper_toFinalFeature(n,this.__wbg_ptr);var e=Ii()[n/4+0],t=Ii()[n/4+1];let c;return e!==0&&(c=So(e,t).slice(),jt.__wbindgen_free(e,t*1)),c}finally{jt.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const u=jt.__wbindgen_add_to_stack_pointer(-16);jt.jsroutesnapper_renderGeojson(u,this.__wbg_ptr);var n=Ii()[u/4+0],c=Ii()[u/4+1];return e=n,t=c,So(n,c)}finally{jt.__wbindgen_add_to_stack_pointer(16),jt.__wbindgen_free(e,t,1)}}toggleSnapMode(){jt.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,n){return jt.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,n)!==0}onClick(){jt.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return jt.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return jt.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){jt.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const c=jt.__wbindgen_add_to_stack_pointer(-16);jt.jsroutesnapper_editExisting(c,this.__wbg_ptr,Rn(e));var t=Ii()[c/4+0],n=Ii()[c/4+1];if(n)throw ql(t)}finally{jt.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const u=jt.__wbindgen_add_to_stack_pointer(-16);jt.jsroutesnapper_debugRenderGraph(u,this.__wbg_ptr);var n=Ii()[u/4+0],c=Ii()[u/4+1];return e=n,t=c,So(n,c)}finally{jt.__wbindgen_add_to_stack_pointer(16),jt.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const u=jt.__wbindgen_add_to_stack_pointer(-16);jt.jsroutesnapper_debugSnappableNodes(u,this.__wbg_ptr);var n=Ii()[u/4+0],c=Ii()[u/4+1];return e=n,t=c,So(n,c)}finally{jt.__wbindgen_add_to_stack_pointer(16),jt.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,n;try{const S=jt.__wbindgen_add_to_stack_pointer(-16);jt.jsroutesnapper_routeNameForWaypoints(S,this.__wbg_ptr,Rn(e));var c=Ii()[S/4+0],u=Ii()[S/4+1],f=Ii()[S/4+2],a=Ii()[S/4+3],_=c,x=u;if(a)throw _=0,x=0,ql(f);return t=_,n=x,So(_,x)}finally{jt.__wbindgen_add_to_stack_pointer(16),jt.__wbindgen_free(t,n,1)}}addSnappedWaypoint(e,t){jt.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){jt.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,n;try{const S=jt.__wbindgen_add_to_stack_pointer(-16);jt.jsroutesnapper_calculateRoute(S,this.__wbg_ptr,Rn(e));var c=Ii()[S/4+0],u=Ii()[S/4+1],f=Ii()[S/4+2],a=Ii()[S/4+3],_=c,x=u;if(a)throw _=0,x=0,ql(f);return t=_,n=x,So(_,x)}finally{jt.__wbindgen_add_to_stack_pointer(16),jt.__wbindgen_free(t,n,1)}}getExtraNodes(e,t){let n,c;try{const k=jt.__wbindgen_add_to_stack_pointer(-16);jt.jsroutesnapper_getExtraNodes(k,this.__wbg_ptr,Rn(e),Rn(t));var u=Ii()[k/4+0],f=Ii()[k/4+1],a=Ii()[k/4+2],_=Ii()[k/4+3],x=u,S=f;if(_)throw x=0,S=0,ql(a);return n=x,c=S,So(x,S)}finally{jt.__wbindgen_add_to_stack_pointer(16),jt.__wbindgen_free(n,c,1)}}}async function _b(o,e){if(typeof Response=="function"&&o instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(o,e)}catch(n){if(o.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await o.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(o,e);return t instanceof WebAssembly.Instance?{instance:t,module:o}:t}}function yb(){const o={};return o.wbg={},o.wbg.__wbindgen_string_new=function(e,t){const n=So(e,t);return Rn(n)},o.wbg.__wbindgen_object_drop_ref=function(e){ql(e)},o.wbg.__wbindgen_error_new=function(e,t){const n=new Error(So(e,t));return Rn(n)},o.wbg.__wbindgen_number_get=function(e,t){const n=Ti(t),c=typeof n=="number"?n:void 0;pb()[e/8+1]=Of(c)?0:c,Ii()[e/4+0]=!Of(c)},o.wbg.__wbindgen_is_object=function(e){const t=Ti(e);return typeof t=="object"&&t!==null},o.wbg.__wbindgen_is_undefined=function(e){return Ti(e)===void 0},o.wbg.__wbindgen_in=function(e,t){return Ti(e)in Ti(t)},o.wbg.__wbindgen_boolean_get=function(e){const t=Ti(e);return typeof t=="boolean"?t?1:0:2},o.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Ti(e)==Ti(t)},o.wbg.__wbindgen_string_get=function(e,t){const n=Ti(t),c=typeof n=="string"?n:void 0;var u=Of(c)?0:Qh(c,jt.__wbindgen_malloc,jt.__wbindgen_realloc),f=Js;Ii()[e/4+1]=f,Ii()[e/4+0]=u},o.wbg.__wbg_String_4370c5505c674d30=function(e,t){const n=String(Ti(t)),c=Qh(n,jt.__wbindgen_malloc,jt.__wbindgen_realloc),u=Js;Ii()[e/4+1]=u,Ii()[e/4+0]=c},o.wbg.__wbindgen_object_clone_ref=function(e){const t=Ti(e);return Rn(t)},o.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const n=Ti(e)[Ti(t)];return Rn(n)},o.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Rn(e)},o.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Ti(t).stack,c=Qh(n,jt.__wbindgen_malloc,jt.__wbindgen_realloc),u=Js;Ii()[e/4+1]=u,Ii()[e/4+0]=c},o.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,c;try{n=e,c=t,console.error(So(e,t))}finally{jt.__wbindgen_free(n,c,1)}},o.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Ti(e))},o.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Ti(e))},o.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Ti(e))},o.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Ti(e))},o.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Ti(e))},o.wbg.__wbg_get_44be0491f933a435=function(e,t){const n=Ti(e)[t>>>0];return Rn(n)},o.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Ti(e).length},o.wbg.__wbindgen_is_function=function(e){return typeof Ti(e)=="function"},o.wbg.__wbg_next_526fc47e980da008=function(e){const t=Ti(e).next;return Rn(t)},o.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Nf(function(e){const t=Ti(e).next();return Rn(t)},arguments)},o.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Ti(e).done},o.wbg.__wbg_value_1695675138684bd5=function(e){const t=Ti(e).value;return Rn(t)},o.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return Rn(Symbol.iterator)},o.wbg.__wbg_get_97b561fb56f034b5=function(){return Nf(function(e,t){const n=Reflect.get(Ti(e),Ti(t));return Rn(n)},arguments)},o.wbg.__wbg_call_cb65541d95d71282=function(){return Nf(function(e,t){const n=Ti(e).call(Ti(t));return Rn(n)},arguments)},o.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Ti(e))},o.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=Ti(e)instanceof ArrayBuffer}catch{t=!1}return t},o.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=Ti(e).buffer;return Rn(t)},o.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(Ti(e));return Rn(t)},o.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){Ti(e).set(Ti(t),n>>>0)},o.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Ti(e).length},o.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=Ti(e)instanceof Uint8Array}catch{t=!1}return t},o.wbg.__wbindgen_debug_string=function(e,t){const n=Jf(Ti(t)),c=Qh(n,jt.__wbindgen_malloc,jt.__wbindgen_realloc),u=Js;Ii()[e/4+1]=u,Ii()[e/4+0]=c},o.wbg.__wbindgen_throw=function(e,t){throw new Error(So(e,t))},o.wbg.__wbindgen_memory=function(){const e=jt.memory;return Rn(e)},o}function vb(o,e){return jt=o.exports,Yy.__wbindgen_wasm_module=e,fu=null,pu=null,du=null,jt}async function Yy(o){if(jt!==void 0)return jt;typeof o>"u"&&(o="/ltn/assets/route_snapper_bg.wasm");const e=yb();(typeof o=="string"||typeof Request=="function"&&o instanceof Request||typeof URL=="function"&&o instanceof URL)&&(o=fetch(o));const{instance:t,module:n}=await _b(await o,e);return vb(t,n)}var Ir=63710088e-1,Tp={centimeters:Ir*100,centimetres:Ir*100,degrees:Ir/111325,feet:Ir*3.28084,inches:Ir*39.37,kilometers:Ir/1e3,kilometres:Ir/1e3,meters:Ir,metres:Ir,miles:Ir/1609.344,millimeters:Ir*1e3,millimetres:Ir*1e3,nauticalmiles:Ir/1852,radians:1,yards:Ir*1.0936},bb={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Ir,yards:1.0936133},Yf={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Io(o,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=o,n}function wb(o,e,t){switch(o){case"Point":return Yr(e).geometry;case"LineString":return Eo(e).geometry;case"Polygon":return Ep(e).geometry;case"MultiPoint":return e0(e).geometry;case"MultiLineString":return Qy(e).geometry;case"MultiPolygon":return t0(e).geometry;default:throw new Error(o+" is invalid")}}function Yr(o,e,t){if(t===void 0&&(t={}),!o)throw new Error("coordinates is required");if(!Array.isArray(o))throw new Error("coordinates must be an Array");if(o.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!gd(o[0])||!gd(o[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:o};return Io(n,e,t)}function xb(o,e,t){return t===void 0&&(t={}),Ba(o.map(function(n){return Yr(n,e)}),t)}function Ep(o,e,t){t===void 0&&(t={});for(var n=0,c=o;n<c.length;n++){var u=c[n];if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var f=0;f<u[u.length-1].length;f++)if(u[u.length-1][f]!==u[0][f])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:o};return Io(a,e,t)}function kb(o,e,t){return t===void 0&&(t={}),Ba(o.map(function(n){return Ep(n,e)}),t)}function Eo(o,e,t){if(t===void 0&&(t={}),o.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:o};return Io(n,e,t)}function Sb(o,e,t){return t===void 0&&(t={}),Ba(o.map(function(n){return Eo(n,e)}),t)}function Ba(o,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=o,t}function Qy(o,e,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:o};return Io(n,e,t)}function e0(o,e,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:o};return Io(n,e,t)}function t0(o,e,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:o};return Io(n,e,t)}function Tb(o,e,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:o};return Io(n,e,t)}function Eb(o,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(o*t)/t}function Cp(o,e){e===void 0&&(e="kilometers");var t=Tp[e];if(!t)throw new Error(e+" units is invalid");return o*t}function Ed(o,e){e===void 0&&(e="kilometers");var t=Tp[e];if(!t)throw new Error(e+" units is invalid");return o/t}function Cb(o,e){return Eu(Ed(o,e))}function Mb(o){var e=o%360;return e<0&&(e+=360),e}function Eu(o){var e=o%(2*Math.PI);return e*180/Math.PI}function Co(o){var e=o%360;return e*Math.PI/180}function Ib(o,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(o>=0))throw new Error("length must be a positive number");return Cp(Ed(o,e),t)}function Lb(o,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(o>=0))throw new Error("area must be a positive number");var n=Yf[e];if(!n)throw new Error("invalid original units");var c=Yf[t];if(!c)throw new Error("invalid final units");return o/n*c}function gd(o){return!isNaN(o)&&o!==null&&!Array.isArray(o)}function Mp(o){return!!o&&o.constructor===Object}function Ab(o){if(!o)throw new Error("bbox is required");if(!Array.isArray(o))throw new Error("bbox must be an Array");if(o.length!==4&&o.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");o.forEach(function(e){if(!gd(e))throw new Error("bbox must only contain numbers")})}function Pb(o){if(!o)throw new Error("id is required");if(["string","number"].indexOf(typeof o)===-1)throw new Error("id must be a number or a string")}const zb=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:Yf,bearingToAzimuth:Mb,convertArea:Lb,convertLength:Ib,degreesToRadians:Co,earthRadius:Ir,factors:Tp,feature:Io,featureCollection:Ba,geometry:wb,geometryCollection:Tb,isNumber:gd,isObject:Mp,lengthToDegrees:Cb,lengthToRadians:Ed,lineString:Eo,lineStrings:Sb,multiLineString:Qy,multiPoint:e0,multiPolygon:t0,point:Yr,points:xb,polygon:Ep,polygons:kb,radiansToDegrees:Eu,radiansToLength:Cp,round:Eb,unitsFactors:bb,validateBBox:Ab,validateId:Pb},Symbol.toStringTag,{value:"Module"}));function Cu(o){if(!o)throw new Error("coord is required");if(!Array.isArray(o)){if(o.type==="Feature"&&o.geometry!==null&&o.geometry.type==="Point")return o.geometry.coordinates;if(o.type==="Point")return o.coordinates}if(Array.isArray(o)&&o.length>=2&&!Array.isArray(o[0])&&!Array.isArray(o[1]))return o;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ql(o){if(Array.isArray(o))return o;if(o.type==="Feature"){if(o.geometry!==null)return o.geometry.coordinates}else if(o.coordinates)return o.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function ou(o,e,t){t===void 0&&(t={});var n=Cu(o),c=Cu(e),u=Co(c[1]-n[1]),f=Co(c[0]-n[0]),a=Co(n[1]),_=Co(c[1]),x=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(f/2),2)*Math.cos(a)*Math.cos(_);return Cp(2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x)),t.units)}function ju(o,e,t){if(o!==null)for(var n,c,u,f,a,_,x,S=0,k=0,I,P=o.type,D=P==="FeatureCollection",R=P==="Feature",z=D?o.features.length:1,B=0;B<z;B++){x=D?o.features[B].geometry:R?o.geometry:o,I=x?x.type==="GeometryCollection":!1,a=I?x.geometries.length:1;for(var N=0;N<a;N++){var V=0,j=0;if(f=I?x.geometries[N]:x,f!==null){_=f.coordinates;var le=f.type;switch(S=t&&(le==="Polygon"||le==="MultiPolygon")?1:0,le){case null:break;case"Point":if(e(_,k,B,V,j)===!1)return!1;k++,V++;break;case"LineString":case"MultiPoint":for(n=0;n<_.length;n++){if(e(_[n],k,B,V,j)===!1)return!1;k++,le==="MultiPoint"&&V++}le==="LineString"&&V++;break;case"Polygon":case"MultiLineString":for(n=0;n<_.length;n++){for(c=0;c<_[n].length-S;c++){if(e(_[n][c],k,B,V,j)===!1)return!1;k++}le==="MultiLineString"&&V++,le==="Polygon"&&j++}le==="Polygon"&&V++;break;case"MultiPolygon":for(n=0;n<_.length;n++){for(j=0,c=0;c<_[n].length;c++){for(u=0;u<_[n][c].length-S;u++){if(e(_[n][c][u],k,B,V,j)===!1)return!1;k++}j++}V++}break;case"GeometryCollection":for(n=0;n<f.geometries.length;n++)if(ju(f.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Db(o,e,t,n){var c=t;return ju(o,function(u,f,a,_,x){f===0&&t===void 0?c=u:c=e(c,u,f,a,_,x)},n),c}function i0(o,e){var t;switch(o.type){case"FeatureCollection":for(t=0;t<o.features.length&&e(o.features[t].properties,t)!==!1;t++);break;case"Feature":e(o.properties,0);break}}function Rb(o,e,t){var n=t;return i0(o,function(c,u){u===0&&t===void 0?n=c:n=e(n,c,u)}),n}function _d(o,e){if(o.type==="Feature")e(o,0);else if(o.type==="FeatureCollection")for(var t=0;t<o.features.length&&e(o.features[t],t)!==!1;t++);}function Bb(o,e,t){var n=t;return _d(o,function(c,u){u===0&&t===void 0?n=c:n=e(n,c,u)}),n}function Fb(o){var e=[];return ju(o,function(t){e.push(t)}),e}function Ip(o,e){var t,n,c,u,f,a,_,x,S,k,I=0,P=o.type==="FeatureCollection",D=o.type==="Feature",R=P?o.features.length:1;for(t=0;t<R;t++){for(a=P?o.features[t].geometry:D?o.geometry:o,x=P?o.features[t].properties:D?o.properties:{},S=P?o.features[t].bbox:D?o.bbox:void 0,k=P?o.features[t].id:D?o.id:void 0,_=a?a.type==="GeometryCollection":!1,f=_?a.geometries.length:1,c=0;c<f;c++){if(u=_?a.geometries[c]:a,u===null){if(e(null,I,x,S,k)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(u,I,x,S,k)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<u.geometries.length;n++)if(e(u.geometries[n],I,x,S,k)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}I++}}function Ob(o,e,t){var n=t;return Ip(o,function(c,u,f,a,_){u===0&&t===void 0?n=c:n=e(n,c,u,f,a,_)}),n}function ic(o,e){Ip(o,function(t,n,c,u,f){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(Io(t,c,{bbox:u,id:f}),n,0)===!1?!1:void 0}var _;switch(a){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var x=0;x<t.coordinates.length;x++){var S=t.coordinates[x],k={type:_,coordinates:S};if(e(Io(k,c),n,x)===!1)return!1}})}function Nb(o,e,t){var n=t;return ic(o,function(c,u,f){u===0&&f===0&&t===void 0?n=c:n=e(n,c,u,f)}),n}function n0(o,e){ic(o,function(t,n,c){var u=0;if(t.geometry){var f=t.geometry.type;if(!(f==="Point"||f==="MultiPoint")){var a,_=0,x=0,S=0;if(ju(t,function(k,I,P,D,R){if(a===void 0||n>_||D>x||R>S){a=k,_=n,x=D,S=R,u=0;return}var z=Eo([a,k],t.properties);if(e(z,n,c,R,u)===!1)return!1;u++,a=k})===!1)return!1}}})}function jb(o,e,t){var n=t,c=!1;return n0(o,function(u,f,a,_,x){c===!1&&t===void 0?n=u:n=e(n,u,f,a,_,x),c=!0}),n}function r0(o,e){if(!o)throw new Error("geojson is required");ic(o,function(t,n,c){if(t.geometry!==null){var u=t.geometry.type,f=t.geometry.coordinates;switch(u){case"LineString":if(e(t,n,c,0,0)===!1)return!1;break;case"Polygon":for(var a=0;a<f.length;a++)if(e(Eo(f[a],t.properties),n,c,a)===!1)return!1;break}}})}function Ub(o,e,t){var n=t;return r0(o,function(c,u,f,a){u===0&&t===void 0?n=c:n=e(n,c,u,f,a)}),n}function Vb(o,e){if(e=e||{},!Mp(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,c=e.geometryIndex||0,u=e.segmentIndex||0,f=e.properties,a;switch(o.type){case"FeatureCollection":t<0&&(t=o.features.length+t),f=f||o.features[t].properties,a=o.features[t].geometry;break;case"Feature":f=f||o.properties,a=o.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=o;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var _=a.coordinates;switch(a.type){case"Point":case"MultiPoint":return null;case"LineString":return u<0&&(u=_.length+u-1),Eo([_[u],_[u+1]],f,e);case"Polygon":return c<0&&(c=_.length+c),u<0&&(u=_[c].length+u-1),Eo([_[c][u],_[c][u+1]],f,e);case"MultiLineString":return n<0&&(n=_.length+n),u<0&&(u=_[n].length+u-1),Eo([_[n][u],_[n][u+1]],f,e);case"MultiPolygon":return n<0&&(n=_.length+n),c<0&&(c=_[n].length+c),u<0&&(u=_[n][c].length-u-1),Eo([_[n][c][u],_[n][c][u+1]],f,e)}throw new Error("geojson is invalid")}function qb(o,e){if(e=e||{},!Mp(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,c=e.geometryIndex||0,u=e.coordIndex||0,f=e.properties,a;switch(o.type){case"FeatureCollection":t<0&&(t=o.features.length+t),f=f||o.features[t].properties,a=o.features[t].geometry;break;case"Feature":f=f||o.properties,a=o.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=o;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var _=a.coordinates;switch(a.type){case"Point":return Yr(_,f,e);case"MultiPoint":return n<0&&(n=_.length+n),Yr(_[n],f,e);case"LineString":return u<0&&(u=_.length+u),Yr(_[u],f,e);case"Polygon":return c<0&&(c=_.length+c),u<0&&(u=_[c].length+u),Yr(_[c][u],f,e);case"MultiLineString":return n<0&&(n=_.length+n),u<0&&(u=_[n].length+u),Yr(_[n][u],f,e);case"MultiPolygon":return n<0&&(n=_.length+n),c<0&&(c=_[n].length+c),u<0&&(u=_[n][c].length-u),Yr(_[n][c][u],f,e)}throw new Error("geojson is invalid")}const Zb=Object.freeze(Object.defineProperty({__proto__:null,coordAll:Fb,coordEach:ju,coordReduce:Db,featureEach:_d,featureReduce:Bb,findPoint:qb,findSegment:Vb,flattenEach:ic,flattenReduce:Nb,geomEach:Ip,geomReduce:Ob,lineEach:r0,lineReduce:Ub,propEach:i0,propReduce:Rb,segmentEach:n0,segmentReduce:jb},Symbol.toStringTag,{value:"Module"}));function o0(o,e,t){if(t===void 0&&(t={}),t.final===!0)return Gb(o,e);var n=Cu(o),c=Cu(e),u=Co(n[0]),f=Co(c[0]),a=Co(n[1]),_=Co(c[1]),x=Math.sin(f-u)*Math.cos(_),S=Math.cos(a)*Math.sin(_)-Math.sin(a)*Math.cos(_)*Math.cos(f-u);return Eu(Math.atan2(x,S))}function Gb(o,e){var t=o0(e,o);return t=(t+180)%360,t}function xg(o,e,t,n){n===void 0&&(n={});var c=Cu(o),u=Co(c[0]),f=Co(c[1]),a=Co(t),_=Ed(e,n.units),x=Math.asin(Math.sin(f)*Math.cos(_)+Math.cos(f)*Math.sin(_)*Math.cos(a)),S=u+Math.atan2(Math.sin(a)*Math.sin(_)*Math.cos(f),Math.cos(_)-Math.sin(f)*Math.sin(x)),k=Eu(S),I=Eu(x);return Yr([k,I],n.properties)}function kg(o){if(!o)throw new Error("geojson is required");var e=[];return ic(o,function(t){Wb(t,e)}),Ba(e)}function Wb(o,e){var t=[],n=o.geometry;if(n!==null){switch(n.type){case"Polygon":t=Ql(n);break;case"LineString":t=[Ql(n)]}t.forEach(function(c){var u=Hb(c,o.properties);u.forEach(function(f){f.id=e.length,e.push(f)})})}}function Hb(o,e){var t=[];return o.reduce(function(n,c){var u=Eo([n,c],e);return u.bbox=$b(n,c),t.push(u),c}),t}function $b(o,e){var t=o[0],n=o[1],c=e[0],u=e[1],f=t<c?t:c,a=n<u?n:u,_=t>c?t:c,x=n>u?n:u;return[f,a,_,x]}var Lp={exports:{}},s0={exports:{}};(function(o,e){(function(t,n){o.exports=n()})(Hy,function(){function t(N,V,j,le,oe){(function $(Y,ve,Be,te,ne){for(;te>Be;){if(te-Be>600){var qe=te-Be+1,Ce=ve-Be+1,et=Math.log(qe),bt=.5*Math.exp(2*et/3),ft=.5*Math.sqrt(et*bt*(qe-bt)/qe)*(Ce-qe/2<0?-1:1),ot=Math.max(Be,Math.floor(ve-Ce*bt/qe+ft)),Zt=Math.min(te,Math.floor(ve+(qe-Ce)*bt/qe+ft));$(Y,ve,ot,Zt,ne)}var ii=Y[ve],Ft=Be,Pt=te;for(n(Y,Be,ve),ne(Y[te],ii)>0&&n(Y,Be,te);Ft<Pt;){for(n(Y,Ft,Pt),Ft++,Pt--;ne(Y[Ft],ii)<0;)Ft++;for(;ne(Y[Pt],ii)>0;)Pt--}ne(Y[Be],ii)===0?n(Y,Be,Pt):n(Y,++Pt,te),Pt<=ve&&(Be=Pt+1),ve<=Pt&&(te=Pt-1)}})(N,V,j||0,le||N.length-1,oe||c)}function n(N,V,j){var le=N[V];N[V]=N[j],N[j]=le}function c(N,V){return N<V?-1:N>V?1:0}var u=function(N){N===void 0&&(N=9),this._maxEntries=Math.max(4,N),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function f(N,V,j){if(!j)return V.indexOf(N);for(var le=0;le<V.length;le++)if(j(N,V[le]))return le;return-1}function a(N,V){_(N,0,N.children.length,V,N)}function _(N,V,j,le,oe){oe||(oe=z(null)),oe.minX=1/0,oe.minY=1/0,oe.maxX=-1/0,oe.maxY=-1/0;for(var $=V;$<j;$++){var Y=N.children[$];x(oe,N.leaf?le(Y):Y)}return oe}function x(N,V){return N.minX=Math.min(N.minX,V.minX),N.minY=Math.min(N.minY,V.minY),N.maxX=Math.max(N.maxX,V.maxX),N.maxY=Math.max(N.maxY,V.maxY),N}function S(N,V){return N.minX-V.minX}function k(N,V){return N.minY-V.minY}function I(N){return(N.maxX-N.minX)*(N.maxY-N.minY)}function P(N){return N.maxX-N.minX+(N.maxY-N.minY)}function D(N,V){return N.minX<=V.minX&&N.minY<=V.minY&&V.maxX<=N.maxX&&V.maxY<=N.maxY}function R(N,V){return V.minX<=N.maxX&&V.minY<=N.maxY&&V.maxX>=N.minX&&V.maxY>=N.minY}function z(N){return{children:N,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function B(N,V,j,le,oe){for(var $=[V,j];$.length;)if(!((j=$.pop())-(V=$.pop())<=le)){var Y=V+Math.ceil((j-V)/le/2)*le;t(N,Y,V,j,oe),$.push(V,Y,Y,j)}}return u.prototype.all=function(){return this._all(this.data,[])},u.prototype.search=function(N){var V=this.data,j=[];if(!R(N,V))return j;for(var le=this.toBBox,oe=[];V;){for(var $=0;$<V.children.length;$++){var Y=V.children[$],ve=V.leaf?le(Y):Y;R(N,ve)&&(V.leaf?j.push(Y):D(N,ve)?this._all(Y,j):oe.push(Y))}V=oe.pop()}return j},u.prototype.collides=function(N){var V=this.data;if(!R(N,V))return!1;for(var j=[];V;){for(var le=0;le<V.children.length;le++){var oe=V.children[le],$=V.leaf?this.toBBox(oe):oe;if(R(N,$)){if(V.leaf||D(N,$))return!0;j.push(oe)}}V=j.pop()}return!1},u.prototype.load=function(N){if(!N||!N.length)return this;if(N.length<this._minEntries){for(var V=0;V<N.length;V++)this.insert(N[V]);return this}var j=this._build(N.slice(),0,N.length-1,0);if(this.data.children.length)if(this.data.height===j.height)this._splitRoot(this.data,j);else{if(this.data.height<j.height){var le=this.data;this.data=j,j=le}this._insert(j,this.data.height-j.height-1,!0)}else this.data=j;return this},u.prototype.insert=function(N){return N&&this._insert(N,this.data.height-1),this},u.prototype.clear=function(){return this.data=z([]),this},u.prototype.remove=function(N,V){if(!N)return this;for(var j,le,oe,$=this.data,Y=this.toBBox(N),ve=[],Be=[];$||ve.length;){if($||($=ve.pop(),le=ve[ve.length-1],j=Be.pop(),oe=!0),$.leaf){var te=f(N,$.children,V);if(te!==-1)return $.children.splice(te,1),ve.push($),this._condense(ve),this}oe||$.leaf||!D($,Y)?le?(j++,$=le.children[j],oe=!1):$=null:(ve.push($),Be.push(j),j=0,le=$,$=$.children[0])}return this},u.prototype.toBBox=function(N){return N},u.prototype.compareMinX=function(N,V){return N.minX-V.minX},u.prototype.compareMinY=function(N,V){return N.minY-V.minY},u.prototype.toJSON=function(){return this.data},u.prototype.fromJSON=function(N){return this.data=N,this},u.prototype._all=function(N,V){for(var j=[];N;)N.leaf?V.push.apply(V,N.children):j.push.apply(j,N.children),N=j.pop();return V},u.prototype._build=function(N,V,j,le){var oe,$=j-V+1,Y=this._maxEntries;if($<=Y)return a(oe=z(N.slice(V,j+1)),this.toBBox),oe;le||(le=Math.ceil(Math.log($)/Math.log(Y)),Y=Math.ceil($/Math.pow(Y,le-1))),(oe=z([])).leaf=!1,oe.height=le;var ve=Math.ceil($/Y),Be=ve*Math.ceil(Math.sqrt(Y));B(N,V,j,Be,this.compareMinX);for(var te=V;te<=j;te+=Be){var ne=Math.min(te+Be-1,j);B(N,te,ne,ve,this.compareMinY);for(var qe=te;qe<=ne;qe+=ve){var Ce=Math.min(qe+ve-1,ne);oe.children.push(this._build(N,qe,Ce,le-1))}}return a(oe,this.toBBox),oe},u.prototype._chooseSubtree=function(N,V,j,le){for(;le.push(V),!V.leaf&&le.length-1!==j;){for(var oe=1/0,$=1/0,Y=void 0,ve=0;ve<V.children.length;ve++){var Be=V.children[ve],te=I(Be),ne=(qe=N,Ce=Be,(Math.max(Ce.maxX,qe.maxX)-Math.min(Ce.minX,qe.minX))*(Math.max(Ce.maxY,qe.maxY)-Math.min(Ce.minY,qe.minY))-te);ne<$?($=ne,oe=te<oe?te:oe,Y=Be):ne===$&&te<oe&&(oe=te,Y=Be)}V=Y||V.children[0]}var qe,Ce;return V},u.prototype._insert=function(N,V,j){var le=j?N:this.toBBox(N),oe=[],$=this._chooseSubtree(le,this.data,V,oe);for($.children.push(N),x($,le);V>=0&&oe[V].children.length>this._maxEntries;)this._split(oe,V),V--;this._adjustParentBBoxes(le,oe,V)},u.prototype._split=function(N,V){var j=N[V],le=j.children.length,oe=this._minEntries;this._chooseSplitAxis(j,oe,le);var $=this._chooseSplitIndex(j,oe,le),Y=z(j.children.splice($,j.children.length-$));Y.height=j.height,Y.leaf=j.leaf,a(j,this.toBBox),a(Y,this.toBBox),V?N[V-1].children.push(Y):this._splitRoot(j,Y)},u.prototype._splitRoot=function(N,V){this.data=z([N,V]),this.data.height=N.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},u.prototype._chooseSplitIndex=function(N,V,j){for(var le,oe,$,Y,ve,Be,te,ne=1/0,qe=1/0,Ce=V;Ce<=j-V;Ce++){var et=_(N,0,Ce,this.toBBox),bt=_(N,Ce,j,this.toBBox),ft=(oe=et,$=bt,Y=void 0,ve=void 0,Be=void 0,te=void 0,Y=Math.max(oe.minX,$.minX),ve=Math.max(oe.minY,$.minY),Be=Math.min(oe.maxX,$.maxX),te=Math.min(oe.maxY,$.maxY),Math.max(0,Be-Y)*Math.max(0,te-ve)),ot=I(et)+I(bt);ft<ne?(ne=ft,le=Ce,qe=ot<qe?ot:qe):ft===ne&&ot<qe&&(qe=ot,le=Ce)}return le||j-V},u.prototype._chooseSplitAxis=function(N,V,j){var le=N.leaf?this.compareMinX:S,oe=N.leaf?this.compareMinY:k;this._allDistMargin(N,V,j,le)<this._allDistMargin(N,V,j,oe)&&N.children.sort(le)},u.prototype._allDistMargin=function(N,V,j,le){N.children.sort(le);for(var oe=this.toBBox,$=_(N,0,V,oe),Y=_(N,j-V,j,oe),ve=P($)+P(Y),Be=V;Be<j-V;Be++){var te=N.children[Be];x($,N.leaf?oe(te):te),ve+=P($)}for(var ne=j-V-1;ne>=V;ne--){var qe=N.children[ne];x(Y,N.leaf?oe(qe):qe),ve+=P(Y)}return ve},u.prototype._adjustParentBBoxes=function(N,V,j){for(var le=j;le>=0;le--)x(V[le],N)},u.prototype._condense=function(N){for(var V=N.length-1,j=void 0;V>=0;V--)N[V].children.length===0?V>0?(j=N[V-1].children).splice(j.indexOf(N[V]),1):this.clear():a(N[V],this.toBBox)},u})})(s0);var Xb=s0.exports;const Kb=Sp(zb),Jb=Sp(Zb);function a0(o,e,t){if(o!==null)for(var n,c,u,f,a,_,x,S=0,k=0,I,P=o.type,D=P==="FeatureCollection",R=P==="Feature",z=D?o.features.length:1,B=0;B<z;B++){x=D?o.features[B].geometry:R?o.geometry:o,I=x?x.type==="GeometryCollection":!1,a=I?x.geometries.length:1;for(var N=0;N<a;N++){var V=0,j=0;if(f=I?x.geometries[N]:x,f!==null){_=f.coordinates;var le=f.type;switch(S=t&&(le==="Polygon"||le==="MultiPolygon")?1:0,le){case null:break;case"Point":if(e(_,k,B,V,j)===!1)return!1;k++,V++;break;case"LineString":case"MultiPoint":for(n=0;n<_.length;n++){if(e(_[n],k,B,V,j)===!1)return!1;k++,le==="MultiPoint"&&V++}le==="LineString"&&V++;break;case"Polygon":case"MultiLineString":for(n=0;n<_.length;n++){for(c=0;c<_[n].length-S;c++){if(e(_[n][c],k,B,V,j)===!1)return!1;k++}le==="MultiLineString"&&V++,le==="Polygon"&&j++}le==="Polygon"&&V++;break;case"MultiPolygon":for(n=0;n<_.length;n++){for(j=0,c=0;c<_[n].length;c++){for(u=0;u<_[n][c].length-S;u++){if(e(_[n][c][u],k,B,V,j)===!1)return!1;k++}j++}V++}break;case"GeometryCollection":for(n=0;n<f.geometries.length;n++)if(a0(f.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function l0(o,e={}){if(o.bbox!=null&&e.recompute!==!0)return o.bbox;const t=[1/0,1/0,-1/0,-1/0];return a0(o,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var Yb=l0;const Qb=Object.freeze(Object.defineProperty({__proto__:null,bbox:l0,default:Yb},Symbol.toStringTag,{value:"Module"})),ew=Sp(Qb);var Qo=Xb,c0=Kb,u0=Jb,Fl=ew.default,tw=u0.featureEach;u0.coordEach;c0.polygon;var Sg=c0.featureCollection;function h0(o){var e=new Qo(o);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Fl(t),Qo.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(c){if(c.type!=="Feature")throw new Error("invalid features");c.bbox=c.bbox?c.bbox:Fl(c),n.push(c)}):tw(t,function(c){if(c.type!=="Feature")throw new Error("invalid features");c.bbox=c.bbox?c.bbox:Fl(c),n.push(c)}),Qo.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Fl(t),Qo.prototype.remove.call(this,t,n)},e.clear=function(){return Qo.prototype.clear.call(this)},e.search=function(t){var n=Qo.prototype.search.call(this,this.toBBox(t));return Sg(n)},e.collides=function(t){return Qo.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Qo.prototype.all.call(this);return Sg(t)},e.toJSON=function(){return Qo.prototype.toJSON.call(this)},e.fromJSON=function(t){return Qo.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=Fl(t);else if(t.type==="FeatureCollection")n=Fl(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Lp.exports=h0;Lp.exports.default=h0;var iw=Lp.exports;const nw=$y(iw);function rw(o,e){var t={},n=[];if(o.type==="LineString"&&(o=Io(o)),e.type==="LineString"&&(e=Io(e)),o.type==="Feature"&&e.type==="Feature"&&o.geometry!==null&&e.geometry!==null&&o.geometry.type==="LineString"&&e.geometry.type==="LineString"&&o.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var c=Tg(o,e);return c&&n.push(c),Ba(n)}var u=nw();return u.load(kg(e)),_d(kg(o),function(f){_d(u.search(f),function(a){var _=Tg(f,a);if(_){var x=Ql(_).join(",");t[x]||(t[x]=!0,n.push(_))}})}),Ba(n)}function Tg(o,e){var t=Ql(o),n=Ql(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var c=t[0][0],u=t[0][1],f=t[1][0],a=t[1][1],_=n[0][0],x=n[0][1],S=n[1][0],k=n[1][1],I=(k-x)*(f-c)-(S-_)*(a-u),P=(S-_)*(u-x)-(k-x)*(c-_),D=(f-c)*(u-x)-(a-u)*(c-_);if(I===0)return null;var R=P/I,z=D/I;if(R>=0&&R<=1&&z>=0&&z<=1){var B=c+R*(f-c),N=u+R*(a-u);return Yr([B,N])}return null}function ow(o,e,t){t===void 0&&(t={});var n=Yr([1/0,1/0],{dist:1/0}),c=0;return ic(o,function(u){for(var f=Ql(u),a=0;a<f.length-1;a++){var _=Yr(f[a]);_.properties.dist=ou(e,_,t);var x=Yr(f[a+1]);x.properties.dist=ou(e,x,t);var S=ou(_,x,t),k=Math.max(_.properties.dist,x.properties.dist),I=o0(_,x),P=xg(e,k,I+90,t),D=xg(e,k,I-90,t),R=rw(Eo([P.geometry.coordinates,D.geometry.coordinates]),Eo([_.geometry.coordinates,x.geometry.coordinates])),z=null;R.features.length>0&&(z=R.features[0],z.properties.dist=ou(e,z,t),z.properties.location=c+ou(_,z,t)),_.properties.dist<n.properties.dist&&(n=_,n.properties.index=a,n.properties.location=c),x.properties.dist<n.properties.dist&&(n=x,n.properties.index=a+1,n.properties.location=c+S),z&&z.properties.dist<n.properties.dist&&(n=z,n.properties.index=a),c+=S}}),n}const sw=30;class aw{constructor(e,t,n,c,u){this.onMouseMove=f=>{if(!this.active)return;const a=[f.point.x-sw,f.point.y],_=this.map.unproject(f.point).distanceTo(this.map.unproject(a));this.inner.onMouseMove(f.lngLat.lng,f.lngLat.lat,_)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=f=>{this.active&&(f.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=f=>{if(!this.active)return;let a=f.target.tagName;a=="INPUT"||a=="TEXTAREA"||f.key=="Escape"&&(f.stopPropagation(),this.cancel())},this.onKeyPress=f=>{if(!this.active)return;let a=f.target.tagName;a=="INPUT"||a=="TEXTAREA"||(f.key=="Enter"?(f.stopPropagation(),this.finish()):f.key=="s"||f.key=="S"?(f.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):f.key=="z"&&f.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new md(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=n,this.snapMode=c,this.undoLength=u,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}const Ol=[];function jf(o,e){return{subscribe:wi(o,e).subscribe}}function wi(o,e=Dt){let t;const n=new Set;function c(a){if(Ut(o,a)&&(o=a,t)){const _=!Ol.length;for(const x of n)x[1](),Ol.push(x,o);if(_){for(let x=0;x<Ol.length;x+=2)Ol[x][0](Ol[x+1]);Ol.length=0}}}function u(a){c(a(o))}function f(a,_=Dt){const x=[a,_];return n.add(x),n.size===1&&(t=e(c,u)||Dt),a(o),()=>{n.delete(x),n.size===0&&t&&(t(),t=null)}}return{set:c,update:u,subscribe:f}}const Qf="MZEJTanw3WpxRvt7qDfo";let es=wi(null),Mu=wi(!1),Es=wi(""),yd=wi(!0),Jn=wi(null),Iu=wi(new Ts.LngLat(0,0)),Lu=wi(new Ts.LngLat(0,0)),od=wi(new Ts.LngLat(0,0)),Eg=wi(1),vs=wi(1),ri=wi({mode:"title",firstLoad:!0}),ep=wi("streets-v2"),tp=wi("walk_cycle_only"),Cg=wi(!1),Au=wi(!1),ip=wi("shortcuts"),np=wi(!1);function ec(){let o=Lr(Es);o||window.alert("Autosave failed; no projectName set?!"),window.localStorage.setItem(o,JSON.stringify(Lr(Jn).toSavefile()))}function Mg(o){let e,t;return e=new Sd({props:{$$slots:{default:[lw,({dialog:n})=>({3:n}),({dialog:n})=>n?8:0]},$$scope:{ctx:o}}}),e.$on("close",o[2]),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c&24&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function lw(o){let e,t,n,c,u,f,a,_,x,S,k,I,P,D;function R(){return o[1](o[3])}return{c(){e=ue("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",t=Fe(),n=ue("p"),n.innerHTML=`This is an <b>experimental</b>
      version of the
      <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>
      . Most parts of it do not work yet, and you should probably use the other version
      of the tool instead.`,c=Fe(),u=ue("p"),u.textContent="To use this tool, you need to:",f=Fe(),a=ue("ol"),a.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, fix the basemap data on existing modal filters, turn
        restrictions, one-ways, etc</li> <li>Create one or more proposals with new modal filters, and explore their
        effects</li>`,_=Fe(),x=ue("p"),x.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
      and relies heavily on
      <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
      data.`,S=Fe(),k=ue("center"),I=ue("button"),I.textContent="Start!"},m(z,B){de(z,e,B),de(z,t,B),de(z,n,B),de(z,c,B),de(z,u,B),de(z,f,B),de(z,a,B),de(z,_,B),de(z,x,B),de(z,S,B),de(z,k,B),ie(k,I),P||(D=Et(I,"click",R),P=!0)},p(z,B){o=z},d(z){z&&(he(e),he(t),he(n),he(c),he(u),he(f),he(a),he(_),he(x),he(S),he(k)),P=!1,D()}}}function cw(o){let e,t,n=o[0]&&Mg(o);return{c(){n&&n.c(),e=Bn()},m(c,u){n&&n.m(c,u),de(c,e,u),t=!0},p(c,[u]){c[0]?n?(n.p(c,u),u&1&&re(n,1)):(n=Mg(c),n.c(),re(n,1),n.m(e.parentNode,e)):n&&(_i(),ce(n,1,1,()=>{n=null}),yi())},i(c){t||(re(n),t=!0)},o(c){ce(n),t=!1},d(c){c&&he(e),n&&n.d(c)}}}function uw(o,e,t){let n;return dt(o,yd,f=>t(0,n=f)),[n,f=>tn(f).close(),()=>At(yd,n=!1,n)]}class hw extends Ht{constructor(e){super(),Wt(this,e,uw,cw,Ut,{})}}let lt;const ws=new Array(128).fill(void 0);ws.push(void 0,null,!0,!1);function fi(o){return ws[o]}let qr=0,mu=null;function Hl(){return(mu===null||mu.byteLength===0)&&(mu=new Uint8Array(lt.memory.buffer)),mu}const sd=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},dw=typeof sd.encodeInto=="function"?function(o,e){return sd.encodeInto(o,e)}:function(o,e){const t=sd.encode(o);return e.set(t),{read:o.length,written:t.length}};function Fo(o,e,t){if(t===void 0){const a=sd.encode(o),_=e(a.length,1)>>>0;return Hl().subarray(_,_+a.length).set(a),qr=a.length,_}let n=o.length,c=e(n,1)>>>0;const u=Hl();let f=0;for(;f<n;f++){const a=o.charCodeAt(f);if(a>127)break;u[c+f]=a}if(f!==n){f!==0&&(o=o.slice(f)),c=t(c,n,n=f+o.length*3,1)>>>0;const a=Hl().subarray(c+f,c+n),_=dw(o,a);f+=_.written}return qr=f,c}function Zl(o){return o==null}let gu=null;function qt(){return(gu===null||gu.byteLength===0)&&(gu=new Int32Array(lt.memory.buffer)),gu}let ku=ws.length;function fw(o){o<132||(ws[o]=ku,ku=o)}function _r(o){const e=fi(o);return fw(o),e}const d0=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&d0.decode();function Vr(o,e){return o=o>>>0,d0.decode(Hl().subarray(o,o+e))}function Gi(o){ku===ws.length&&ws.push(ws.length+1);const e=ku;return ku=ws[e],ws[e]=o,e}let _u=null;function f0(){return(_u===null||_u.byteLength===0)&&(_u=new Float64Array(lt.memory.buffer)),_u}let yu=null;function pw(){return(yu===null||yu.byteLength===0)&&(yu=new BigInt64Array(lt.memory.buffer)),yu}function rp(o){const e=typeof o;if(e=="number"||e=="boolean"||o==null)return`${o}`;if(e=="string")return`"${o}"`;if(e=="symbol"){const c=o.description;return c==null?"Symbol":`Symbol(${c})`}if(e=="function"){const c=o.name;return typeof c=="string"&&c.length>0?`Function(${c})`:"Function"}if(Array.isArray(o)){const c=o.length;let u="[";c>0&&(u+=rp(o[0]));for(let f=1;f<c;f++)u+=", "+rp(o[f]);return u+="]",u}const t=/\[object ([^\]]+)\]/.exec(toString.call(o));let n;if(t.length>1)n=t[1];else return toString.call(o);if(n=="Object")try{return"Object("+JSON.stringify(o)+")"}catch{return"Object"}return o instanceof Error?`${o.name}: ${o.message}
${o.stack}`:n}function mw(o,e){const t=e(o.length*1,1)>>>0;return Hl().set(o,t/1),qr=o.length,t}function gw(o,e){return o=o>>>0,f0().subarray(o/8,o/8+e)}function _w(o,e){return o=o>>>0,Hl().subarray(o/1,o/1+e)}function za(o,e){try{return o.apply(this,e)}catch(t){lt.__wbindgen_exn_store(Gi(t))}}class yw{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();lt.__wbg_ltn_free(e)}constructor(e,t,n){try{const x=lt.__wbindgen_add_to_stack_pointer(-16),S=mw(e,lt.__wbindgen_malloc),k=qr;var c=Zl(n)?0:Fo(n,lt.__wbindgen_malloc,lt.__wbindgen_realloc),u=qr;lt.ltn_new(x,S,k,Gi(t),c,u);var f=qt()[x/4+0],a=qt()[x/4+1],_=qt()[x/4+2];if(_)throw _r(a);return this.__wbg_ptr=f>>>0,this}finally{lt.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let e,t;try{const x=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_getInvertedBoundary(x,this.__wbg_ptr);var n=qt()[x/4+0],c=qt()[x/4+1],u=qt()[x/4+2],f=qt()[x/4+3],a=n,_=c;if(f)throw a=0,_=0,_r(u);return e=a,t=_,Vr(a,_)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(e,t,1)}}getBounds(){try{const c=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_getBounds(c,this.__wbg_ptr);var e=qt()[c/4+0],t=qt()[c/4+1],n=gw(e,t).slice();return lt.__wbindgen_free(e,t*8,8),n}finally{lt.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const c=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_toRouteSnapper(c,this.__wbg_ptr);var e=qt()[c/4+0],t=qt()[c/4+1],n=_w(e,t).slice();return lt.__wbindgen_free(e,t*1,1),n}finally{lt.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let e,t;try{const x=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_toRouteSnapperGj(x,this.__wbg_ptr);var n=qt()[x/4+0],c=qt()[x/4+1],u=qt()[x/4+2],f=qt()[x/4+3],a=n,_=c;if(f)throw a=0,_=0,_r(u);return e=a,t=_,Vr(a,_)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(e,t,1)}}renderModalFilters(){let e,t;try{const x=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_renderModalFilters(x,this.__wbg_ptr);var n=qt()[x/4+0],c=qt()[x/4+1],u=qt()[x/4+2],f=qt()[x/4+3],a=n,_=c;if(f)throw a=0,_=0,_r(u);return e=a,t=_,Vr(a,_)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(e,t,1)}}renderNeighbourhood(){let e,t;try{const x=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_renderNeighbourhood(x,this.__wbg_ptr);var n=qt()[x/4+0],c=qt()[x/4+1],u=qt()[x/4+2],f=qt()[x/4+3],a=n,_=c;if(f)throw a=0,_=0,_r(u);return e=a,t=_,Vr(a,_)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(e,t,1)}}renderAutoBoundaries(){let e,t;try{const x=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_renderAutoBoundaries(x,this.__wbg_ptr);var n=qt()[x/4+0],c=qt()[x/4+1],u=qt()[x/4+2],f=qt()[x/4+3],a=n,_=c;if(f)throw a=0,_=0,_r(u);return e=a,t=_,Vr(a,_)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(e,t,1)}}setNeighbourhoodBoundary(e,t){try{const u=lt.__wbindgen_add_to_stack_pointer(-16),f=Fo(e,lt.__wbindgen_malloc,lt.__wbindgen_realloc),a=qr;lt.ltn_setNeighbourhoodBoundary(u,this.__wbg_ptr,f,a,Gi(t));var n=qt()[u/4+0],c=qt()[u/4+1];if(c)throw _r(n)}finally{lt.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(e){const t=Fo(e,lt.__wbindgen_malloc,lt.__wbindgen_realloc),n=qr;lt.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,t,n)}renameNeighbourhoodBoundary(e,t){const n=Fo(e,lt.__wbindgen_malloc,lt.__wbindgen_realloc),c=qr,u=Fo(t,lt.__wbindgen_malloc,lt.__wbindgen_realloc),f=qr;lt.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,n,c,u,f)}setCurrentNeighbourhood(e,t){try{const u=lt.__wbindgen_add_to_stack_pointer(-16),f=Fo(e,lt.__wbindgen_malloc,lt.__wbindgen_realloc),a=qr;lt.ltn_setCurrentNeighbourhood(u,this.__wbg_ptr,f,a,t);var n=qt()[u/4+0],c=qt()[u/4+1];if(c)throw _r(n)}finally{lt.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(e,t){try{const u=lt.__wbindgen_add_to_stack_pointer(-16),f=Fo(t,lt.__wbindgen_malloc,lt.__wbindgen_realloc),a=qr;lt.ltn_addModalFilter(u,this.__wbg_ptr,Gi(e),f,a);var n=qt()[u/4+0],c=qt()[u/4+1];if(c)throw _r(n)}finally{lt.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(e,t){try{const u=lt.__wbindgen_add_to_stack_pointer(-16),f=Fo(t,lt.__wbindgen_malloc,lt.__wbindgen_realloc),a=qr;lt.ltn_addManyModalFilters(u,this.__wbg_ptr,Gi(e),f,a);var n=qt()[u/4+0],c=qt()[u/4+1];if(c)throw _r(n)}finally{lt.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(e){lt.ltn_deleteModalFilter(this.__wbg_ptr,e)}toggleDirection(e){lt.ltn_toggleDirection(this.__wbg_ptr,e)}undo(){lt.ltn_undo(this.__wbg_ptr)}redo(){lt.ltn_redo(this.__wbg_ptr)}getShortcutsCrossingRoad(e){let t,n;try{const S=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_getShortcutsCrossingRoad(S,this.__wbg_ptr,e);var c=qt()[S/4+0],u=qt()[S/4+1],f=qt()[S/4+2],a=qt()[S/4+3],_=c,x=u;if(a)throw _=0,x=0,_r(f);return t=_,n=x,Vr(_,x)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(t,n,1)}}getAllShortcuts(){let e,t;try{const x=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_getAllShortcuts(x,this.__wbg_ptr);var n=qt()[x/4+0],c=qt()[x/4+1],u=qt()[x/4+2],f=qt()[x/4+3],a=n,_=c;if(f)throw a=0,_=0,_r(u);return e=a,t=_,Vr(a,_)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const x=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_toSavefile(x,this.__wbg_ptr);var n=qt()[x/4+0],c=qt()[x/4+1],u=qt()[x/4+2],f=qt()[x/4+3],a=n,_=c;if(f)throw a=0,_=0,_r(u);return e=a,t=_,Vr(a,_)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(e,t,1)}}loadSavefile(e){try{const c=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_loadSavefile(c,this.__wbg_ptr,Gi(e));var t=qt()[c/4+0],n=qt()[c/4+1];if(n)throw _r(t)}finally{lt.__wbindgen_add_to_stack_pointer(16)}}compareRoute(e,t,n,c,u){let f,a;try{const D=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_compareRoute(D,this.__wbg_ptr,e,t,n,c,u);var _=qt()[D/4+0],x=qt()[D/4+1],S=qt()[D/4+2],k=qt()[D/4+3],I=_,P=x;if(k)throw I=0,P=0,_r(S);return f=I,a=P,Vr(I,P)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(f,a,1)}}impactToOneDestination(e,t){let n,c;try{const k=lt.__wbindgen_add_to_stack_pointer(-16);lt.ltn_impactToOneDestination(k,this.__wbg_ptr,e,t);var u=qt()[k/4+0],f=qt()[k/4+1],a=qt()[k/4+2],_=qt()[k/4+3],x=u,S=f;if(_)throw x=0,S=0,_r(a);return n=x,c=S,Vr(x,S)}finally{lt.__wbindgen_add_to_stack_pointer(16),lt.__wbindgen_free(n,c,1)}}}async function vw(o,e){if(typeof Response=="function"&&o instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(o,e)}catch(n){if(o.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await o.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(o,e);return t instanceof WebAssembly.Instance?{instance:t,module:o}:t}}function bw(){const o={};return o.wbg={},o.wbg.__wbindgen_string_get=function(e,t){const n=fi(t),c=typeof n=="string"?n:void 0;var u=Zl(c)?0:Fo(c,lt.__wbindgen_malloc,lt.__wbindgen_realloc),f=qr;qt()[e/4+1]=f,qt()[e/4+0]=u},o.wbg.__wbindgen_object_drop_ref=function(e){_r(e)},o.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Vr(e,t));return Gi(n)},o.wbg.__wbindgen_string_new=function(e,t){const n=Vr(e,t);return Gi(n)},o.wbg.__wbindgen_boolean_get=function(e){const t=fi(e);return typeof t=="boolean"?t?1:0:2},o.wbg.__wbindgen_is_bigint=function(e){return typeof fi(e)=="bigint"},o.wbg.__wbindgen_number_get=function(e,t){const n=fi(t),c=typeof n=="number"?n:void 0;f0()[e/8+1]=Zl(c)?0:c,qt()[e/4+0]=!Zl(c)},o.wbg.__wbindgen_is_object=function(e){const t=fi(e);return typeof t=="object"&&t!==null},o.wbg.__wbindgen_in=function(e,t){return fi(e)in fi(t)},o.wbg.__wbindgen_bigint_from_i64=function(e){return Gi(e)},o.wbg.__wbindgen_jsval_eq=function(e,t){return fi(e)===fi(t)},o.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return Gi(t)},o.wbg.__wbindgen_is_undefined=function(e){return fi(e)===void 0},o.wbg.__wbindgen_jsval_loose_eq=function(e,t){return fi(e)==fi(t)},o.wbg.__wbindgen_object_clone_ref=function(e){const t=fi(e);return Gi(t)},o.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,t){const n=fi(e)[fi(t)];return Gi(n)},o.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(fi(e))},o.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(fi(e))},o.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(fi(e))},o.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(fi(e))},o.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(fi(e))},o.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Gi(e)},o.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=fi(t).stack,c=Fo(n,lt.__wbindgen_malloc,lt.__wbindgen_realloc),u=qr;qt()[e/4+1]=u,qt()[e/4+0]=c},o.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,c;try{n=e,c=t,console.error(Vr(e,t))}finally{lt.__wbindgen_free(n,c,1)}},o.wbg.__wbg_performance_3f3012faa4463882=function(e){const t=fi(e).performance;return Gi(t)},o.wbg.__wbg_now_2fd65358804c9485=function(e){return fi(e).now()},o.wbg.__wbg_get_f01601b5a68d10e3=function(e,t){const n=fi(e)[t>>>0];return Gi(n)},o.wbg.__wbg_length_1009b1af0c481d7b=function(e){return fi(e).length},o.wbg.__wbindgen_is_function=function(e){return typeof fi(e)=="function"},o.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,t){const n=new Function(Vr(e,t));return Gi(n)},o.wbg.__wbg_next_9b877f231f476d01=function(e){const t=fi(e).next;return Gi(t)},o.wbg.__wbg_next_6529ee0cca8d57ed=function(){return za(function(e){const t=fi(e).next();return Gi(t)},arguments)},o.wbg.__wbg_done_5fe336b092d60cf2=function(e){return fi(e).done},o.wbg.__wbg_value_0c248a78fdc8e19f=function(e){const t=fi(e).value;return Gi(t)},o.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return Gi(Symbol.iterator)},o.wbg.__wbg_get_7b48513de5dc5ea4=function(){return za(function(e,t){const n=Reflect.get(fi(e),fi(t));return Gi(n)},arguments)},o.wbg.__wbg_call_90c26b09837aba1c=function(){return za(function(e,t){const n=fi(e).call(fi(t));return Gi(n)},arguments)},o.wbg.__wbg_self_f0e34d89f33b99fd=function(){return za(function(){const e=self.self;return Gi(e)},arguments)},o.wbg.__wbg_window_d3b084224f4774d7=function(){return za(function(){const e=window.window;return Gi(e)},arguments)},o.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return za(function(){const e=globalThis.globalThis;return Gi(e)},arguments)},o.wbg.__wbg_global_35dfdd59a4da3e74=function(){return za(function(){const e=global.global;return Gi(e)},arguments)},o.wbg.__wbg_isArray_74fb723e24f76012=function(e){return Array.isArray(fi(e))},o.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let t;try{t=fi(e)instanceof ArrayBuffer}catch{t=!1}return t},o.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(e){return Number.isSafeInteger(fi(e))},o.wbg.__wbg_entries_9e2e2aa45aa5094a=function(e){const t=Object.entries(fi(e));return Gi(t)},o.wbg.__wbg_buffer_a448f833075b71ba=function(e){const t=fi(e).buffer;return Gi(t)},o.wbg.__wbg_new_8f67e318f15d7254=function(e){const t=new Uint8Array(fi(e));return Gi(t)},o.wbg.__wbg_set_2357bf09366ee480=function(e,t,n){fi(e).set(fi(t),n>>>0)},o.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return fi(e).length},o.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let t;try{t=fi(e)instanceof Uint8Array}catch{t=!1}return t},o.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=fi(t),c=typeof n=="bigint"?n:void 0;pw()[e/8+1]=Zl(c)?BigInt(0):c,qt()[e/4+0]=!Zl(c)},o.wbg.__wbindgen_debug_string=function(e,t){const n=rp(fi(t)),c=Fo(n,lt.__wbindgen_malloc,lt.__wbindgen_realloc),u=qr;qt()[e/4+1]=u,qt()[e/4+0]=c},o.wbg.__wbindgen_throw=function(e,t){throw new Error(Vr(e,t))},o.wbg.__wbindgen_memory=function(){const e=lt.memory;return Gi(e)},o}function ww(o,e){return lt=o.exports,p0.__wbindgen_wasm_module=e,yu=null,_u=null,gu=null,mu=null,lt}async function p0(o){if(lt!==void 0)return lt;typeof o>"u"&&(o="/ltn/assets/backend_bg.wasm");const e=bw();(typeof o=="string"||typeof Request=="function"&&o instanceof Request||typeof URL=="function"&&o instanceof URL)&&(o=fetch(o));const{instance:t,module:n}=await vw(await o,e);return ww(t,n)}let xw=Date.now();function nc(o){return`${o}-${xw++}`}const Ap=Symbol.for("svelte-maplibre");function rc(){return kp(Ap)}function kw(o){let e=new WeakMap;return t=>{var f;let n=e.get(t.originalEvent);if(n!==void 0)return n;let u=(f=t.target.queryRenderedFeatures(t.point).find(a=>{var _;return(_=o.get(a.layer.id))==null?void 0:_.interactive}))==null?void 0:f.layer.id;return e.set(t.originalEvent,u),u}}function Sw(){let o=new Map;return xp(Ap,{map:wi(null),source:jf(null),layer:jf(null),popupTarget:jf(null),cluster:wi(),loadedImages:wi(new Set),minzoom:wi(0),maxzoom:wi(24),layerEvent:wi(null),layerInfo:o,eventTopMost:kw(o),markerClickManager:new Mw})}function Ig(o){return{subscribe:o.subscribe}}function Pp({key:o,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let c=rc(),u=wi(null),f=Ig(u),a={...c,[o]:Ig(u)};if(e&&(a.popupTarget=f),n){let _=wi(null);a.layerEvent=_,c.layerEvent=_}return t&&(a.cluster=wi()),xp(Ap,a),{...c,self:u}}function Tw(){return Pp({key:"source",setCluster:!0})}function Ew(o=!0){return Pp({key:"layer",setPopupTarget:o,setMouseEvent:o})}function Cw(){return Pp({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}class Mw{constructor(){Dn(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}function Lg(o){let e;return t=>{if(t)for(let n in t){let c=e==null?void 0:e[n],u=t[n];c!==u&&o(n,u,c)}else if(e)for(let n in e)o(n,void 0,e[n]);e=t}}function Iw(o,...e){let t=[o];for(let n of e)if(n)Array.isArray(n)&&n[0]===o?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function Lw(o){return o===!0?["has","point_count"]:o===!1?["!",["has","point_count"]]:void 0}function Fa(o,e){return["case",["boolean",["feature-state","hover"],!1],e,o]}var Oa=Aw;function Aw(o){var e,t,n;if(o){if(Array.isArray(o)){for(e=[],t=o.length,n=0;n<t;n++){var c=o[n];c!=null&&e.push(c)}return e}if(typeof o=="object"){e={};var u=Object.keys(o);for(t=u.length,n=0;n<t;n++){var f=u[n],a=o[f];a!=null&&(e[f]=a)}return e}}}function Ag(o){let e=o[0],t,n,c=Pg(o);return{c(){c.c(),t=Bn()},m(u,f){c.m(u,f),de(u,t,f),n=!0},p(u,f){f[0]&1&&Ut(e,e=u[0])?(_i(),ce(c,1,1,Dt),yi(),c=Pg(u),c.c(),re(c,1),c.m(t.parentNode,t)):c.p(u,f)},i(u){n||(re(c),n=!0)},o(u){ce(c),n=!1},d(u){u&&he(t),c.d(u)}}}function Pg(o){let e;const t=o[36].default,n=Bi(t,o,o[35],null);return{c(){n&&n.c()},m(c,u){n&&n.m(c,u),e=!0},p(c,u){n&&n.p&&(!e||u[1]&16)&&Oi(n,t,c,c[35],e?Fi(t,c[35],u,null):Ni(c[35]),null)},i(c){e||(re(n,c),e=!0)},o(c){ce(n,c),e=!1},d(c){n&&n.d(c)}}}function Pw(o){let e,t,n=o[0]&&Ag(o);return{c(){n&&n.c(),e=Bn()},m(c,u){n&&n.m(c,u),de(c,e,u),t=!0},p(c,u){c[0]?n?(n.p(c,u),u[0]&1&&re(n,1)):(n=Ag(c),n.c(),re(n,1),n.m(e.parentNode,e)):n&&(_i(),ce(n,1,1,()=>{n=null}),yi())},i(c){t||(re(n),t=!0)},o(c){ce(n),t=!1},d(c){c&&he(e),n&&n.d(c)}}}function zw(o,e,t){let n,c,u,f,a,_,x,S,k,I,P,D,{$$slots:R={},$$scope:z}=e,{id:B=nc("layer")}=e,{source:N=void 0}=e,{sourceLayer:V=void 0}=e,{beforeId:j=void 0}=e,{beforeLayerType:le=void 0}=e,{type:oe}=e,{paint:$=void 0}=e,{layout:Y=void 0}=e,{filter:ve=void 0}=e,{applyToClusters:Be=void 0}=e,{minzoom:te=void 0}=e,{maxzoom:ne=void 0}=e,{manageHoverState:qe=!1}=e,{hovered:Ce=null}=e,{interactive:et=!0}=e,{hoverCursor:bt=void 0}=e,{eventsIfTopMost:ft=!1}=e;const ot=ts(),{map:Zt,source:ii,self:Ft,minzoom:Pt,maxzoom:Jt,eventTopMost:Mt,layerInfo:ei}=Ew();dt(o,Zt,Ne=>t(31,k=Ne)),dt(o,ii,Ne=>t(32,I=Ne)),dt(o,Ft,Ne=>t(0,S=Ne)),dt(o,Pt,Ne=>t(34,D=Ne)),dt(o,Jt,Ne=>t(33,P=Ne)),er(()=>{S&&k&&(ei.delete(S),k==null||k.removeLayer(S))});let Vt;function hi(Ne){var we,di;if(!et||!S||!k||ft&&Mt(Ne)!==S)return;let je=Ne.features??[],rt=(di=(we=je[0])==null?void 0:we.properties)==null?void 0:di.cluster_id,xt={event:Ne,map:k,clusterId:rt,layer:S,source:a,features:je};ot(Ne.type,xt)}function xi(Ne){var we,di;if(!et||!S||!k||ft&&Mt(Ne)!==S)return;bt&&(k.getCanvas().style.cursor=bt);let je=Ne.features??[];t(6,Ce=je[0]??null);let rt=(di=(we=je[0])==null?void 0:we.properties)==null?void 0:di.cluster_id;ot("mouseenter",{event:Ne,map:k,clusterId:rt,layer:S,source:a,features:je})}function gi(Ne){var we,di,Ve;if(!et||!k)return;if(ft&&Mt(Ne)!==S){t(6,Ce=null),qe&&Vt!==void 0&&(k==null||k.setFeatureState({source:a,sourceLayer:V,id:Vt},{hover:!1}),Vt=void 0);return}k.getCanvas().style.cursor=bt;let je=Ne.features??[],rt=(di=(we=je[0])==null?void 0:we.properties)==null?void 0:di.cluster_id,xt=(Ve=je[0])==null?void 0:Ve.id;xt!==Vt&&(qe&&(Vt!==void 0&&(k==null||k.setFeatureState({source:a,id:Vt,sourceLayer:V},{hover:!1})),k==null||k.setFeatureState({source:a,id:xt,sourceLayer:V},{hover:!0})),Vt=xt,t(6,Ce=je[0]??null)),ot("mousemove",{event:Ne,map:k,clusterId:rt,layer:S,source:a,features:je})}function Ai(Ne){if(!(!et||!S||!k)){if(bt&&(k.getCanvas().style.cursor=""),t(6,Ce=null),qe&&Vt!==void 0){const je={source:a,id:Vt,sourceLayer:V};k==null||k.setFeatureState(je,{hover:!1}),Vt=void 0}ot("mouseleave",{map:k,layer:S,source:a})}}let ct=!0;function It(Ne){k&&(k.off("click",Ne,hi),k.off("dblclick",Ne,hi),k.off("contextmenu",Ne,hi),k.off("mouseenter",Ne,xi),k.off("mousemove",Ne,gi),k.off("mouseleave",Ne,Ai))}return er(()=>{k&&S&&It(S)}),o.$$set=Ne=>{"id"in Ne&&t(7,B=Ne.id),"source"in Ne&&t(8,N=Ne.source),"sourceLayer"in Ne&&t(9,V=Ne.sourceLayer),"beforeId"in Ne&&t(10,j=Ne.beforeId),"beforeLayerType"in Ne&&t(11,le=Ne.beforeLayerType),"type"in Ne&&t(12,oe=Ne.type),"paint"in Ne&&t(13,$=Ne.paint),"layout"in Ne&&t(14,Y=Ne.layout),"filter"in Ne&&t(15,ve=Ne.filter),"applyToClusters"in Ne&&t(16,Be=Ne.applyToClusters),"minzoom"in Ne&&t(17,te=Ne.minzoom),"maxzoom"in Ne&&t(18,ne=Ne.maxzoom),"manageHoverState"in Ne&&t(19,qe=Ne.manageHoverState),"hovered"in Ne&&t(6,Ce=Ne.hovered),"interactive"in Ne&&t(20,et=Ne.interactive),"hoverCursor"in Ne&&t(21,bt=Ne.hoverCursor),"eventsIfTopMost"in Ne&&t(22,ft=Ne.eventsIfTopMost),"$$scope"in Ne&&t(35,z=Ne.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&65536&&t(30,n=Lw(Be)),o.$$.dirty[0]&1073774592&&t(24,c=Iw("all",n,ve)),o.$$.dirty[0]&131072|o.$$.dirty[1]&8&&t(26,u=te??D),o.$$.dirty[0]&262144|o.$$.dirty[1]&4&&t(25,f=ne??P),o.$$.dirty[0]&256|o.$$.dirty[1]&2&&t(29,a=N||I),o.$$.dirty[0]&654343809|o.$$.dirty[1]&1&&k&&S!==B&&a){S&&(It(S),ei.delete(S));let Ne=j;if(!j&&le){let je=k.getStyle().layers,rt=typeof le=="function"?le:we=>we.type===le,xt=je==null?void 0:je.find(rt);xt&&(Ne=xt.id)}At(Ft,S=B,S),k.addLayer(Oa({id:S,type:oe,source:a,"source-layer":V,filter:c,paint:$,layout:Y,minzoom:u,maxzoom:f}),Ne),t(23,ct=!0),k.on("click",S,hi),k.on("dblclick",S,hi),k.on("contextmenu",S,hi),k.on("mouseenter",S,xi),k.on("mousemove",S,gi),k.on("mouseleave",S,Ai)}o.$$.dirty[0]&1048577&&S&&ei.set(S,{interactive:et}),o.$$.dirty[0]&1|o.$$.dirty[1]&1&&t(28,_=S?Lg((Ne,je)=>{k!=null&&k.style._loaded?k.setPaintProperty(S,Ne,je):k==null||k.once("styledata",()=>k==null?void 0:k.setPaintProperty(S,Ne,je))}):void 0),o.$$.dirty[0]&1|o.$$.dirty[1]&1&&t(27,x=S?Lg((Ne,je)=>{k!=null&&k.style._loaded?k.setLayoutProperty(S,Ne,je):k==null||k.once("styledata",()=>k==null?void 0:k.setLayoutProperty(S,Ne,je))}):void 0),o.$$.dirty[0]&268443648&&(_==null||_($)),o.$$.dirty[0]&134234112&&(x==null||x(Y)),o.$$.dirty[0]&100663297|o.$$.dirty[1]&1&&S&&(k==null||k.setLayerZoomRange(S,u,f)),o.$$.dirty[0]&25165825|o.$$.dirty[1]&1&&S&&(ct?t(23,ct=!1):k==null||k.setFilter(S,c))},[S,Zt,ii,Ft,Pt,Jt,Ce,B,N,V,j,le,oe,$,Y,ve,Be,te,ne,qe,et,bt,ft,ct,c,f,u,x,_,a,n,k,I,P,D,z,R]}let Cd=class extends Ht{constructor(e){super(),Wt(this,e,zw,Pw,Ut,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function Dw(o){let e;const t=o[16].default,n=Bi(t,o,o[24],null);return{c(){n&&n.c()},m(c,u){n&&n.m(c,u),e=!0},p(c,u){n&&n.p&&(!e||u&16777216)&&Oi(n,t,c,c[24],e?Fi(t,c[24],u,null):Ni(c[24]),null)},i(c){e||(re(n,c),e=!0)},o(c){ce(n,c),e=!1},d(c){n&&n.d(c)}}}function Rw(o){let e,t,n;function c(f){o[17](f)}let u={id:o[1],type:"circle",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],applyToClusters:o[9],minzoom:o[10],maxzoom:o[11],hoverCursor:o[12],manageHoverState:o[13],eventsIfTopMost:o[14],interactive:o[15],$$slots:{default:[Dw]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Cd({props:u}),Xi.push(()=>Wr(e,"hovered",c)),e.$on("click",o[18]),e.$on("dblclick",o[19]),e.$on("contextmenu",o[20]),e.$on("mouseenter",o[21]),e.$on("mousemove",o[22]),e.$on("mouseleave",o[23]),{c(){Re(e.$$.fragment)},m(f,a){ze(e,f,a),n=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.applyToClusters=f[9]),a&1024&&(_.minzoom=f[10]),a&2048&&(_.maxzoom=f[11]),a&4096&&(_.hoverCursor=f[12]),a&8192&&(_.manageHoverState=f[13]),a&16384&&(_.eventsIfTopMost=f[14]),a&32768&&(_.interactive=f[15]),a&16777216&&(_.$$scope={dirty:a,ctx:f}),!t&&a&1&&(t=!0,_.hovered=f[0],Gr(()=>t=!1)),e.$set(_)},i(f){n||(re(e.$$.fragment,f),n=!0)},o(f){ce(e.$$.fragment,f),n=!1},d(f){De(e,f)}}}function Bw(o,e,t){let{$$slots:n={},$$scope:c}=e,{id:u=nc("circle")}=e,{source:f=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:S}=e,{layout:k=void 0}=e,{filter:I=void 0}=e,{applyToClusters:P=void 0}=e,{minzoom:D=void 0}=e,{maxzoom:R=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:B=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:V=!1}=e,{interactive:j=!0}=e;function le(ne){N=ne,t(0,N)}function oe(ne){ui.call(this,o,ne)}function $(ne){ui.call(this,o,ne)}function Y(ne){ui.call(this,o,ne)}function ve(ne){ui.call(this,o,ne)}function Be(ne){ui.call(this,o,ne)}function te(ne){ui.call(this,o,ne)}return o.$$set=ne=>{"id"in ne&&t(1,u=ne.id),"source"in ne&&t(2,f=ne.source),"sourceLayer"in ne&&t(3,a=ne.sourceLayer),"beforeId"in ne&&t(4,_=ne.beforeId),"beforeLayerType"in ne&&t(5,x=ne.beforeLayerType),"paint"in ne&&t(6,S=ne.paint),"layout"in ne&&t(7,k=ne.layout),"filter"in ne&&t(8,I=ne.filter),"applyToClusters"in ne&&t(9,P=ne.applyToClusters),"minzoom"in ne&&t(10,D=ne.minzoom),"maxzoom"in ne&&t(11,R=ne.maxzoom),"hoverCursor"in ne&&t(12,z=ne.hoverCursor),"manageHoverState"in ne&&t(13,B=ne.manageHoverState),"hovered"in ne&&t(0,N=ne.hovered),"eventsIfTopMost"in ne&&t(14,V=ne.eventsIfTopMost),"interactive"in ne&&t(15,j=ne.interactive),"$$scope"in ne&&t(24,c=ne.$$scope)},[N,u,f,a,_,x,S,k,I,P,D,R,z,B,V,j,n,le,oe,$,Y,ve,Be,te,c]}let zp=class extends Ht{constructor(e){super(),Wt(this,e,Bw,Rw,Ut,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function Fw(o){let e;const t=o[15].default,n=Bi(t,o,o[23],null);return{c(){n&&n.c()},m(c,u){n&&n.m(c,u),e=!0},p(c,u){n&&n.p&&(!e||u&8388608)&&Oi(n,t,c,c[23],e?Fi(t,c[23],u,null):Ni(c[23]),null)},i(c){e||(re(n,c),e=!0)},o(c){ce(n,c),e=!1},d(c){n&&n.d(c)}}}function Ow(o){let e,t,n;function c(f){o[16](f)}let u={id:o[1],type:"fill",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],minzoom:o[9],maxzoom:o[10],hoverCursor:o[11],manageHoverState:o[12],eventsIfTopMost:o[13],interactive:o[14],$$slots:{default:[Fw]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Cd({props:u}),Xi.push(()=>Wr(e,"hovered",c)),e.$on("click",o[17]),e.$on("dblclick",o[18]),e.$on("contextmenu",o[19]),e.$on("mouseenter",o[20]),e.$on("mousemove",o[21]),e.$on("mouseleave",o[22]),{c(){Re(e.$$.fragment)},m(f,a){ze(e,f,a),n=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.minzoom=f[9]),a&1024&&(_.maxzoom=f[10]),a&2048&&(_.hoverCursor=f[11]),a&4096&&(_.manageHoverState=f[12]),a&8192&&(_.eventsIfTopMost=f[13]),a&16384&&(_.interactive=f[14]),a&8388608&&(_.$$scope={dirty:a,ctx:f}),!t&&a&1&&(t=!0,_.hovered=f[0],Gr(()=>t=!1)),e.$set(_)},i(f){n||(re(e.$$.fragment,f),n=!0)},o(f){ce(e.$$.fragment,f),n=!1},d(f){De(e,f)}}}function Nw(o,e,t){let{$$slots:n={},$$scope:c}=e,{id:u=nc("fill")}=e,{source:f=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:S}=e,{layout:k=void 0}=e,{filter:I=void 0}=e,{minzoom:P=void 0}=e,{maxzoom:D=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:z=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:N=!1}=e,{interactive:V=!0}=e;function j(te){B=te,t(0,B)}function le(te){ui.call(this,o,te)}function oe(te){ui.call(this,o,te)}function $(te){ui.call(this,o,te)}function Y(te){ui.call(this,o,te)}function ve(te){ui.call(this,o,te)}function Be(te){ui.call(this,o,te)}return o.$$set=te=>{"id"in te&&t(1,u=te.id),"source"in te&&t(2,f=te.source),"sourceLayer"in te&&t(3,a=te.sourceLayer),"beforeId"in te&&t(4,_=te.beforeId),"beforeLayerType"in te&&t(5,x=te.beforeLayerType),"paint"in te&&t(6,S=te.paint),"layout"in te&&t(7,k=te.layout),"filter"in te&&t(8,I=te.filter),"minzoom"in te&&t(9,P=te.minzoom),"maxzoom"in te&&t(10,D=te.maxzoom),"hoverCursor"in te&&t(11,R=te.hoverCursor),"manageHoverState"in te&&t(12,z=te.manageHoverState),"hovered"in te&&t(0,B=te.hovered),"eventsIfTopMost"in te&&t(13,N=te.eventsIfTopMost),"interactive"in te&&t(14,V=te.interactive),"$$scope"in te&&t(23,c=te.$$scope)},[B,u,f,a,_,x,S,k,I,P,D,R,z,N,V,n,j,le,oe,$,Y,ve,Be,c]}let Cs=class extends Ht{constructor(e){super(),Wt(this,e,Nw,Ow,Ut,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function jw(o,e,t){let n;const{map:c}=rc();dt(o,c,_=>t(4,n=_));let{position:u="top-left"}=e,{container:f=void 0}=e,a=null;return er(()=>{n!=null&&n.loaded()&&a&&n.removeControl(a)}),o.$$set=_=>{"position"in _&&t(1,u=_.position),"container"in _&&t(2,f=_.container)},o.$$.update=()=>{if(o.$$.dirty&30&&n&&!a){let _;typeof f=="string"?_=document.querySelector(f)??void 0:_=f,t(3,a=new Qr.FullscreenControl({container:_})),n.addControl(a,u)}},[c,u,f,a,n]}class Uw extends Ht{constructor(e){super(),Wt(this,e,jw,null,Ut,{position:1,container:2})}}function Vw(o,e,t,n,c){let u=!1;o.getSource(e)&&(u=!0,o.removeSource(e));const f=()=>{n(e)&&(o.addSource(e,t),c())};if(u){const a=()=>{e&&(o.getSource(e)?setTimeout(a,1):f())};a()}else f()}function qw(o,e,t){Zy().then(()=>{let n=Lr(o);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function zg(o){let e=o[0],t,n,c=Dg(o);return{c(){c.c(),t=Bn()},m(u,f){c.m(u,f),de(u,t,f),n=!0},p(u,f){f&1&&Ut(e,e=u[0])?(_i(),ce(c,1,1,Dt),yi(),c=Dg(u),c.c(),re(c,1),c.m(t.parentNode,t)):c.p(u,f)},i(u){n||(re(c),n=!0)},o(u){ce(c),n=!1},d(u){u&&he(t),c.d(u)}}}function Dg(o){let e;const t=o[19].default,n=Bi(t,o,o[18],null);return{c(){n&&n.c()},m(c,u){n&&n.m(c,u),e=!0},p(c,u){n&&n.p&&(!e||u&262144)&&Oi(n,t,c,c[18],e?Fi(t,c[18],u,null):Ni(c[18]),null)},i(c){e||(re(n,c),e=!0)},o(c){ce(n,c),e=!1},d(c){n&&n.d(c)}}}function Zw(o){let e,t,n=o[0]&&zg(o);return{c(){n&&n.c(),e=Bn()},m(c,u){n&&n.m(c,u),de(c,e,u),t=!0},p(c,[u]){c[0]?n?(n.p(c,u),u&1&&re(n,1)):(n=zg(c),n.c(),re(n,1),n.m(e.parentNode,e)):n&&(_i(),ce(n,1,1,()=>{n=null}),yi())},i(c){t||(re(n),t=!0)},o(c){ce(n),t=!1},d(c){c&&he(e),n&&n.d(c)}}}function Gw(o,e,t){let n,c,u,{$$slots:f={},$$scope:a}=e,{id:_=nc("geojson")}=e,{data:x}=e,{generateId:S=!1}=e,{promoteId:k=void 0}=e,{filter:I=void 0}=e,{lineMetrics:P=void 0}=e,{cluster:D=void 0}=e,{maxzoom:R=void 0}=e,{attribution:z=void 0}=e,{buffer:B=void 0}=e,{tolerance:N=void 0}=e;const{map:V,cluster:j,self:le}=Tw();dt(o,V,Y=>t(17,c=Y)),dt(o,j,Y=>t(20,u=Y)),dt(o,le,Y=>t(0,n=Y));let oe,$=!0;return er(()=>{n&&oe&&c&&(qw(V,n,oe),At(le,n=null,n),t(15,oe=void 0))}),o.$$set=Y=>{"id"in Y&&t(4,_=Y.id),"data"in Y&&t(5,x=Y.data),"generateId"in Y&&t(6,S=Y.generateId),"promoteId"in Y&&t(7,k=Y.promoteId),"filter"in Y&&t(8,I=Y.filter),"lineMetrics"in Y&&t(9,P=Y.lineMetrics),"cluster"in Y&&t(10,D=Y.cluster),"maxzoom"in Y&&t(11,R=Y.maxzoom),"attribution"in Y&&t(12,z=Y.attribution),"buffer"in Y&&t(13,B=Y.buffer),"tolerance"in Y&&t(14,N=Y.tolerance),"$$scope"in Y&&t(18,a=Y.$$scope)},o.$$.update=()=>{o.$$.dirty&1024&&At(j,u=D,u),o.$$.dirty&196593&&c&&n!==_&&(At(le,n=_,n),Vw(c,n,Oa({type:"geojson",data:x,filter:I,lineMetrics:P,generateId:S,promoteId:k,cluster:!!D,clusterMinPoints:D==null?void 0:D.minPoints,clusterMaxZoom:D==null?void 0:D.maxZoom,clusterRadius:D==null?void 0:D.radius,clusterProperties:D==null?void 0:D.properties,maxzoom:R,attribution:z,buffer:B,tolerance:N}),Y=>c&&Y===n,()=>{n&&(t(15,oe=c==null?void 0:c.getSource(n)),t(16,$=!0))})),o.$$.dirty&131088&&(c==null||c.on("style.load",()=>{t(15,oe=c==null?void 0:c.getSource(_))})),o.$$.dirty&98336&&oe&&($?t(16,$=!1):oe.setData(x)),o.$$.dirty&33792&&(oe==null||oe.setClusterOptions(Oa({cluster:!!D,clusterMaxZoom:D==null?void 0:D.maxZoom,clusterRadius:D==null?void 0:D.radius})))},[n,V,j,le,_,x,S,k,I,P,D,R,z,B,N,oe,$,c,a,f]}let cr=class extends Ht{constructor(e){super(),Wt(this,e,Gw,Zw,Ut,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}};function Ww(o,e,t){let n;const{map:c}=rc();dt(o,c,I=>t(8,n=I));let{position:u="top-left"}=e,{positionOptions:f=void 0}=e,{fitBoundsOptions:a=void 0}=e,{trackUserLocation:_=!1}=e,{showAccuracyCircle:x=!0}=e,{showUserLocation:S=!0}=e,{control:k=null}=e;return er(()=>{n!=null&&n.loaded()&&k&&n.removeControl(k)}),o.$$set=I=>{"position"in I&&t(2,u=I.position),"positionOptions"in I&&t(3,f=I.positionOptions),"fitBoundsOptions"in I&&t(4,a=I.fitBoundsOptions),"trackUserLocation"in I&&t(5,_=I.trackUserLocation),"showAccuracyCircle"in I&&t(6,x=I.showAccuracyCircle),"showUserLocation"in I&&t(7,S=I.showUserLocation),"control"in I&&t(1,k=I.control)},o.$$.update=()=>{o.$$.dirty&510&&n&&!k&&(t(1,k=new Qr.GeolocateControl({positionOptions:f,fitBoundsOptions:a,trackUserLocation:_,showAccuracyCircle:x,showUserLocation:S})),n.addControl(k,u))},[c,k,u,f,a,_,x,S,n]}class Hw extends Ht{constructor(e){super(),Wt(this,e,Ww,null,Ut,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function $w(o){let e;const t=o[15].default,n=Bi(t,o,o[23],null);return{c(){n&&n.c()},m(c,u){n&&n.m(c,u),e=!0},p(c,u){n&&n.p&&(!e||u&8388608)&&Oi(n,t,c,c[23],e?Fi(t,c[23],u,null):Ni(c[23]),null)},i(c){e||(re(n,c),e=!0)},o(c){ce(n,c),e=!1},d(c){n&&n.d(c)}}}function Xw(o){let e,t,n;function c(f){o[16](f)}let u={id:o[1],type:"line",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],minzoom:o[9],maxzoom:o[10],hoverCursor:o[11],manageHoverState:o[12],eventsIfTopMost:o[13],interactive:o[14],$$slots:{default:[$w]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Cd({props:u}),Xi.push(()=>Wr(e,"hovered",c)),e.$on("click",o[17]),e.$on("dblclick",o[18]),e.$on("contextmenu",o[19]),e.$on("mouseenter",o[20]),e.$on("mousemove",o[21]),e.$on("mouseleave",o[22]),{c(){Re(e.$$.fragment)},m(f,a){ze(e,f,a),n=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.minzoom=f[9]),a&1024&&(_.maxzoom=f[10]),a&2048&&(_.hoverCursor=f[11]),a&4096&&(_.manageHoverState=f[12]),a&8192&&(_.eventsIfTopMost=f[13]),a&16384&&(_.interactive=f[14]),a&8388608&&(_.$$scope={dirty:a,ctx:f}),!t&&a&1&&(t=!0,_.hovered=f[0],Gr(()=>t=!1)),e.$set(_)},i(f){n||(re(e.$$.fragment,f),n=!0)},o(f){ce(e.$$.fragment,f),n=!1},d(f){De(e,f)}}}function Kw(o,e,t){let{$$slots:n={},$$scope:c}=e,{id:u=nc("line")}=e,{source:f=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:S}=e,{layout:k=void 0}=e,{filter:I=void 0}=e,{minzoom:P=void 0}=e,{maxzoom:D=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:z=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:N=!1}=e,{interactive:V=!0}=e;function j(te){B=te,t(0,B)}function le(te){ui.call(this,o,te)}function oe(te){ui.call(this,o,te)}function $(te){ui.call(this,o,te)}function Y(te){ui.call(this,o,te)}function ve(te){ui.call(this,o,te)}function Be(te){ui.call(this,o,te)}return o.$$set=te=>{"id"in te&&t(1,u=te.id),"source"in te&&t(2,f=te.source),"sourceLayer"in te&&t(3,a=te.sourceLayer),"beforeId"in te&&t(4,_=te.beforeId),"beforeLayerType"in te&&t(5,x=te.beforeLayerType),"paint"in te&&t(6,S=te.paint),"layout"in te&&t(7,k=te.layout),"filter"in te&&t(8,I=te.filter),"minzoom"in te&&t(9,P=te.minzoom),"maxzoom"in te&&t(10,D=te.maxzoom),"hoverCursor"in te&&t(11,R=te.hoverCursor),"manageHoverState"in te&&t(12,z=te.manageHoverState),"hovered"in te&&t(0,B=te.hovered),"eventsIfTopMost"in te&&t(13,N=te.eventsIfTopMost),"interactive"in te&&t(14,V=te.interactive),"$$scope"in te&&t(23,c=te.$$scope)},[B,u,f,a,_,x,S,k,I,P,D,R,z,N,V,n,j,le,oe,$,Y,ve,Be,c]}let fo=class extends Ht{constructor(e){super(),Wt(this,e,Kw,Xw,Ut,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function Jw(o,e,t){let n;const c=ts();let{layer:u=void 0}=e;const{map:f}=rc();dt(o,f,S=>t(2,n=S));function a(S){c(S.type,{...S,map:f})}const _=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],x=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return er(()=>{if(n)if(u)for(const S of _)n.off(S,u,a);else for(const S of x)n.off(S,a)}),o.$$set=S=>{"layer"in S&&t(1,u=S.layer)},o.$$.update=()=>{if(o.$$.dirty&6&&n)if(u)for(const S of _)n.on(S,u,a);else for(const S of x)n.on(S,a)},[f,u,n]}class m0 extends Ht{constructor(e){super(),Wt(this,e,Jw,null,Ut,{layer:1})}}function Yw(o){let e=o.getCenter(),t=Math.round(o.getZoom()*100)/100,n=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),c=Math.pow(10,n),u=Math.round(e.lat*c)/c,f=Math.round(e.lng*c)/c,a=`${t}/${u}/${f}`,_=o.getBearing(),x=o.getPitch();return(_||x)&&(a+=`/${Math.round(_*10)/10}`),x&&(a+=`/${Math.round(x)}`),`#${a}`}function Qw(o){return o.replace("#","").split("/").map(parseFloat)}var Nl=Dp;function Dp(o,e){return o===e||o!==o&&e!==e?!0:typeof o!=typeof e||{}.toString.call(o)!={}.toString.call(e)||o!==Object(o)||!o?!1:Array.isArray(o)?Rg(o,e):{}.toString.call(o)=="[object Set]"?Rg(Array.from(o),Array.from(e)):{}.toString.call(o)=="[object Object]"?tx(o,e):ex(o,e)}function ex(o,e){return o.toString()===e.toString()}function Rg(o,e){var t=o.length;if(t!=e.length)return!1;for(var n=0;n<t;n++)if(!Dp(o[n],e[n]))return!1;return!0}function tx(o,e){var t=Object.keys(o),n=t.length;if(n!=Object.keys(e).length)return!1;for(var c=0;c<n;c++){var u=t[c];if(!(e.hasOwnProperty(u)&&Dp(o[u],e[u])))return!1}return!0}function ix(o,e,t){let n;const{map:c}=rc();dt(o,c,S=>t(6,n=S));let{position:u="top-left"}=e,{showCompass:f=!0}=e,{showZoom:a=!0}=e,{visualizePitch:_=!1}=e,x=null;return er(()=>{n!=null&&n.loaded()&&x&&n.removeControl(x)}),o.$$set=S=>{"position"in S&&t(1,u=S.position),"showCompass"in S&&t(2,f=S.showCompass),"showZoom"in S&&t(3,a=S.showZoom),"visualizePitch"in S&&t(4,_=S.visualizePitch)},o.$$.update=()=>{o.$$.dirty&126&&n&&!x&&(t(5,x=new Qr.NavigationControl({showCompass:f,showZoom:a,visualizePitch:_})),n.addControl(x,u))},[c,u,f,a,_,x,n]}class g0 extends Ht{constructor(e){super(),Wt(this,e,ix,null,Ut,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function nx(o,e,t){let n;const{map:c}=rc();dt(o,c,x=>t(5,n=x));let{position:u="bottom-left"}=e,{maxWidth:f=void 0}=e,{unit:a="metric"}=e,_=null;return er(()=>{n!=null&&n.loaded()&&_&&n.removeControl(_)}),o.$$set=x=>{"position"in x&&t(1,u=x.position),"maxWidth"in x&&t(2,f=x.maxWidth),"unit"in x&&t(3,a=x.unit)},o.$$.update=()=>{o.$$.dirty&62&&n&&!_&&(t(4,_=new Qr.ScaleControl({maxWidth:f,unit:a})),n.addControl(_,u))},[c,u,f,a,_,n]}class _0 extends Ht{constructor(e){super(),Wt(this,e,nx,null,Ut,{position:1,maxWidth:2,unit:3})}}const{window:rx}=xd,ox=o=>({map:o[0]&16,loadedImages:o[0]&32,allImagesLoaded:o[0]&64}),Bg=o=>({map:o[4],loadedImages:o[5],allImagesLoaded:o[6]});function Fg(o){let e,t,n=o[3]&&Og(o);const c=o[46].default,u=Bi(c,o,o[45],Bg);return{c(){n&&n.c(),e=Fe(),u&&u.c()},m(f,a){n&&n.m(f,a),de(f,e,a),u&&u.m(f,a),t=!0},p(f,a){f[3]?n?(n.p(f,a),a[0]&8&&re(n,1)):(n=Og(f),n.c(),re(n,1),n.m(e.parentNode,e)):n&&(_i(),ce(n,1,1,()=>{n=null}),yi()),u&&u.p&&(!t||a[0]&112|a[1]&16384)&&Oi(u,c,f,f[45],t?Fi(c,f[45],a,ox):Ni(f[45]),Bg)},i(f){t||(re(n),re(u,f),t=!0)},o(f){ce(n),ce(u,f),t=!1},d(f){f&&he(e),n&&n.d(f),u&&u.d(f)}}}function Og(o){let e,t,n,c,u,f,a,_;return e=new g0({props:{position:o[7]}}),n=new Hw({props:{position:o[7],fitBoundsOptions:{maxZoom:12}}}),u=new Uw({props:{position:o[7]}}),a=new _0({props:{position:o[7]}}),{c(){Re(e.$$.fragment),t=Fe(),Re(n.$$.fragment),c=Fe(),Re(u.$$.fragment),f=Fe(),Re(a.$$.fragment)},m(x,S){ze(e,x,S),de(x,t,S),ze(n,x,S),de(x,c,S),ze(u,x,S),de(x,f,S),ze(a,x,S),_=!0},p(x,S){const k={};S[0]&128&&(k.position=x[7]),e.$set(k);const I={};S[0]&128&&(I.position=x[7]),n.$set(I);const P={};S[0]&128&&(P.position=x[7]),u.$set(P);const D={};S[0]&128&&(D.position=x[7]),a.$set(D)},i(x){_||(re(e.$$.fragment,x),re(n.$$.fragment,x),re(u.$$.fragment,x),re(a.$$.fragment,x),_=!0)},o(x){ce(e.$$.fragment,x),ce(n.$$.fragment,x),ce(u.$$.fragment,x),ce(a.$$.fragment,x),_=!1},d(x){x&&(he(t),he(c),he(f)),De(e,x),De(n,x),De(u,x),De(a,x)}}}function sx(o){let e,t,n,c,u,f=o[4]&&o[0]&&Fg(o);return{c(){e=ue("div"),f&&f.c(),Te(e,"class",t=fd(o[2])+" svelte-p00lfq"),Te(e,"data-testid","map-container"),lr(e,"expand-map",!o[2])},m(a,_){de(a,e,_),f&&f.m(e,null),o[47](e),n=!0,c||(u=[Et(rx,"hashchange",o[11]),$f(o[10].call(null,e))],c=!0)},p(a,_){a[4]&&a[0]?f?(f.p(a,_),_[0]&17&&re(f,1)):(f=Fg(a),f.c(),re(f,1),f.m(e,null)):f&&(_i(),ce(f,1,1,()=>{f=null}),yi()),(!n||_[0]&4&&t!==(t=fd(a[2])+" svelte-p00lfq"))&&Te(e,"class",t),(!n||_[0]&4)&&lr(e,"expand-map",!a[2])},i(a){n||(re(f),n=!0)},o(a){ce(f),n=!1},d(a){a&&he(e),f&&f.d(),o[47](null),c=!1,ln(u)}}}function ax(o,e,t){let n,c,u,f,{$$slots:a={},$$scope:_}=e,{map:x=null}=e,{mapContainer:S=void 0}=e,{class:k=void 0}=e,{style:I}=e,{diffStyleUpdates:P=!1}=e,{center:D=void 0}=e,{zoom:R=void 0}=e,{pitch:z=0}=e,{bearing:B=0}=e,{bounds:N=void 0}=e,{hash:V=!1}=e,{updateHash:j=Ve=>{window.history.replaceState(window.history.state,"",Ve)}}=e,{loaded:le=!1}=e,{minZoom:oe=0}=e,{maxZoom:$=22}=e,{minPitch:Y=0}=e,{maxPitch:ve=60}=e,{renderWorldCopies:Be=void 0}=e,{dragPan:te=void 0}=e,{dragRotate:ne=void 0}=e,{pitchWithRotate:qe=void 0}=e,{antialias:Ce=void 0}=e,{zoomOnDoubleClick:et=!0}=e,{locale:bt=void 0}=e,{interactive:ft=!0}=e,{attributionControl:ot=!0}=e,{cooperativeGestures:Zt=!1}=e,{preserveDrawingBuffer:ii=!1}=e,{maxBounds:Ft=void 0}=e,{images:Pt=[]}=e,{standardControls:Jt=!1}=e,{filterLayers:Mt=void 0}=e,{transformRequest:ei=void 0}=e;const Vt=ts(),{map:hi,loadedImages:xi}=Sw();dt(o,hi,Ve=>t(4,u=Ve)),dt(o,xi,Ve=>t(5,f=Ve));let gi=new Set;async function Ai(Ve,$e=!1){if(u&&!(!u.loaded()&&!$e))if("url"in Ve){gi.add(Ve.id);try{let kt=await u.loadImage(Ve.url);u==null||u.addImage(Ve.id,kt.data,Ve.options),f.add(Ve.id),xi.set(f)}catch(kt){Vt("error",kt)}finally{gi.delete(Ve.id)}}else u.addImage(Ve.id,Ve.data,Ve.options),f.add(Ve.id),xi.set(f)}let ct,It,Ne,je;function rt(Ve){return we(),At(hi,u=new Qr.Map(Oa({container:Ve,style:I,locale:bt,center:D,zoom:R,pitch:z,bearing:B,minZoom:oe,maxZoom:$,minPitch:Y,maxPitch:ve,renderWorldCopies:Be,dragPan:te,dragRotate:ne,pitchWithRotate:qe,antialias:Ce,interactive:ft,preserveDrawingBuffer:ii,maxBounds:Ft,bounds:N,attributionControl:ot,transformRequest:ei,cooperativeGestures:Zt})),u),u.on("load",$e=>{$e.target.getContainer().setAttribute("data-testid","map"),$e.target.getCanvas().setAttribute("data-testid","map-canvas"),t(0,le=!0),Vt("load",u)}),u.on("error",$e=>Vt("error",{...$e,map:u})),u.on("movestart",$e=>Vt("movestart",{...$e,map:u})),u.on("moveend",$e=>{if(t(12,D=$e.target.getCenter()),t(13,R=$e.target.getZoom()),t(14,z=$e.target.getPitch()),t(15,B=$e.target.getBearing()),t(16,N=$e.target.getBounds()),Vt("moveend",{...$e,map:u}),V){let kt=new URL(window.location.href.replace(/(#.+)?$/,Yw(u)));j(kt)}}),u.on("click",$e=>Vt("click",{...$e,map:u})),u.on("dblclick",$e=>Vt("dblclick",{...$e,map:u})),u.on("contextmenu",$e=>Vt("contextmenu",{...$e,map:u})),u.on("zoomstart",$e=>Vt("zoomstart",{...$e,map:u})),u.on("zoom",$e=>{Vt("zoom",{...$e,map:u})}),u.on("zoomend",$e=>{Vt("zoomend",{...$e,map:u})}),u.on("style.load",()=>{if(u){const $e=u.getStyle();if(t(42,ct=$e.layers.map(kt=>kt.id)),t(43,It=Object.keys($e.sources)),je)for(const[kt,bn]of Object.entries(je))u.addSource(kt,bn);if(Ne)for(const kt of Ne)u.addLayer(kt);for(const kt of Pt)Ai(kt,!0)}}),u.on("styledata",$e=>{if(u&&Mt){const kt=u.getStyle().layers;if(kt)for(let bn of kt)Mt(bn)||u.setLayoutProperty(bn.id,"visibility","none")}Vt("styledata",{...$e,map:u})}),{destroy(){t(0,le=!1),u==null||u.remove(),At(hi,u=null,u)}}}let xt=I;function we(){if(V){let Ve=Qw(window.location.hash);Ve.length>=3&&(t(13,R=Ve[0]),t(12,D=[Ve[2],Ve[1]])),Ve.length==5&&(t(15,B=Ve[3]),t(14,z=Ve[4]))}}function di(Ve){Xi[Ve?"unshift":"push"](()=>{S=Ve,t(1,S)})}return o.$$set=Ve=>{"map"in Ve&&t(17,x=Ve.map),"mapContainer"in Ve&&t(1,S=Ve.mapContainer),"class"in Ve&&t(2,k=Ve.class),"style"in Ve&&t(18,I=Ve.style),"diffStyleUpdates"in Ve&&t(19,P=Ve.diffStyleUpdates),"center"in Ve&&t(12,D=Ve.center),"zoom"in Ve&&t(13,R=Ve.zoom),"pitch"in Ve&&t(14,z=Ve.pitch),"bearing"in Ve&&t(15,B=Ve.bearing),"bounds"in Ve&&t(16,N=Ve.bounds),"hash"in Ve&&t(20,V=Ve.hash),"updateHash"in Ve&&t(21,j=Ve.updateHash),"loaded"in Ve&&t(0,le=Ve.loaded),"minZoom"in Ve&&t(22,oe=Ve.minZoom),"maxZoom"in Ve&&t(23,$=Ve.maxZoom),"minPitch"in Ve&&t(24,Y=Ve.minPitch),"maxPitch"in Ve&&t(25,ve=Ve.maxPitch),"renderWorldCopies"in Ve&&t(26,Be=Ve.renderWorldCopies),"dragPan"in Ve&&t(27,te=Ve.dragPan),"dragRotate"in Ve&&t(28,ne=Ve.dragRotate),"pitchWithRotate"in Ve&&t(29,qe=Ve.pitchWithRotate),"antialias"in Ve&&t(30,Ce=Ve.antialias),"zoomOnDoubleClick"in Ve&&t(31,et=Ve.zoomOnDoubleClick),"locale"in Ve&&t(32,bt=Ve.locale),"interactive"in Ve&&t(33,ft=Ve.interactive),"attributionControl"in Ve&&t(34,ot=Ve.attributionControl),"cooperativeGestures"in Ve&&t(35,Zt=Ve.cooperativeGestures),"preserveDrawingBuffer"in Ve&&t(36,ii=Ve.preserveDrawingBuffer),"maxBounds"in Ve&&t(37,Ft=Ve.maxBounds),"images"in Ve&&t(38,Pt=Ve.images),"standardControls"in Ve&&t(3,Jt=Ve.standardControls),"filterLayers"in Ve&&t(39,Mt=Ve.filterLayers),"transformRequest"in Ve&&t(40,ei=Ve.transformRequest),"$$scope"in Ve&&t(45,_=Ve.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&8&&t(7,n=typeof Jt=="boolean"?void 0:Jt),o.$$.dirty[0]&16&&t(17,x=u),o.$$.dirty[0]&786448|o.$$.dirty[1]&14336&&u&&!Nl(I,xt)){const Ve=u.getStyle();if(ct&&(Ne=Ve.layers.filter($e=>!ct.includes($e.id))),It){const $e=Object.keys(Ve.sources).filter(kt=>!It.includes(kt));je={};for(const kt of $e)je[kt]=Ve.sources[kt]}t(44,xt=I),u.setStyle(I,{diff:P}),At(xi,f=new Set,f),t(41,gi=new Set)}if(o.$$.dirty[0]&49|o.$$.dirty[1]&1152&&le&&u!=null&&u.loaded())for(let Ve of Pt)!f.has(Ve.id)&&!gi.has(Ve.id)&&!u.hasImage(Ve.id)&&Ai(Ve);if(o.$$.dirty[0]&32|o.$$.dirty[1]&128&&t(6,c=Pt.every(Ve=>f.has(Ve.id))),o.$$.dirty[0]&61456&&u){let Ve={};D!=null&&!Nl(D,u==null?void 0:u.getCenter())&&(Ve.center=D),R!=null&&!Nl(R,u==null?void 0:u.getZoom())&&(Ve.zoom=R),B!=null&&!Nl(B,u==null?void 0:u.getBearing())&&(Ve.bearing=B),z!=null&&!Nl(z,u==null?void 0:u.getPitch())&&(Ve.pitch=z),Object.keys(Ve).length&&u.easeTo(Ve)}o.$$.dirty[0]&65552&&N&&!Nl(N,u==null?void 0:u.getBounds())&&(u==null||u.fitBounds(N)),o.$$.dirty[0]&16|o.$$.dirty[1]&1&&(et?u==null||u.doubleClickZoom.enable():u==null||u.doubleClickZoom.disable())},[le,S,k,Jt,u,f,c,n,hi,xi,rt,we,D,R,z,B,N,x,I,P,V,j,oe,$,Y,ve,Be,te,ne,qe,Ce,et,bt,ft,ot,Zt,ii,Ft,Pt,Mt,ei,gi,ct,It,xt,_,a,di]}class lx extends Ht{constructor(e){super(),Wt(this,e,ax,sx,Ut,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const cx=o=>({marker:o&8}),Ng=o=>({marker:o[3]});function ux(o){let e,t,n,c,u,f,a;const _=o[19].default,x=Bi(_,o,o[18],Ng);return{c(){e=ue("div"),x&&x.c(),Te(e,"tabindex",t=o[1]?0:void 0),Te(e,"role",n=o[1]?"button":void 0),mn(e,"z-index",o[2])},m(S,k){de(S,e,k),x&&x.m(e,null),u=!0,f||(a=[$f(o[7].call(null,e)),$f(c=hx.call(null,e,o[0])),Et(e,"click",Bf(o[20])),Et(e,"dblclick",Bf(o[21])),Et(e,"contextmenu",Bf(vp(o[22]))),Et(e,"mouseenter",o[23]),Et(e,"mouseleave",o[24]),Et(e,"mousemove",o[25]),Et(e,"keydown",o[8])],f=!0)},p(S,[k]){x&&x.p&&(!u||k&262152)&&Oi(x,_,S,S[18],u?Fi(_,S[18],k,cx):Ni(S[18]),Ng),(!u||k&2&&t!==(t=S[1]?0:void 0))&&Te(e,"tabindex",t),(!u||k&2&&n!==(n=S[1]?"button":void 0))&&Te(e,"role",n),c&&Kl(c.update)&&k&1&&c.update.call(null,S[0]),k&4&&mn(e,"z-index",S[2])},i(S){u||(re(x,S),u=!0)},o(S){ce(x,S),u=!1},d(S){S&&he(e),x&&x.d(S),f=!1,ln(a)}}}function hx(o,e){const t=o.className;function n(c){c?o.className=`${t} ${c}`:o.className=t}return n(e),{update:n}}function dx(o,e,t){let n,c,u,{$$slots:f={},$$scope:a}=e,{marker:_=void 0}=e,{lngLat:x}=e,{class:S=void 0}=e,{interactive:k=!0}=e,{asButton:I=!1}=e,{draggable:P=!1}=e,{feature:D=null}=e,{offset:R=void 0}=e,{zIndex:z=void 0}=e,{rotation:B=0}=e,{opacity:N=1}=e;const V=ts(),{map:j,layerEvent:le,self:oe,markerClickManager:$}=Cw();dt(o,j,ot=>t(27,u=ot)),dt(o,le,ot=>t(26,n=ot)),dt(o,oe,ot=>t(3,c=ot));function Y(ot){At(oe,c=new Qr.Marker({element:ot,rotation:B,draggable:P,offset:R,opacity:N.toString()}).setLngLat(x).addTo(u),c),t(11,_=c);const Zt=()=>te("dragstart"),ii=()=>{ve(),te("drag")},Ft=()=>{ve(),te("dragend")};return P&&(c.on("dragstart",Zt),c.on("drag",ii),c.on("dragend",Ft)),{destroy(){P&&(c==null||c.off("dragstart",Zt),c==null||c.off("drag",ii),c==null||c.off("dragend",Ft)),t(11,_=void 0),c==null||c.remove()}}}function ve(){let ot=c==null?void 0:c.getLngLat();ot&&(Array.isArray(x)?t(10,x=[ot.lng,ot.lat]):x&&"lon"in x?t(10,x={lon:ot.lng,lat:ot.lat}):t(10,x=ot))}function Be(ot){ot.key===" "&&(ot.preventDefault(),ot.stopPropagation(),te("click"))}function te(ot){if(!k)return;let Zt=c==null?void 0:c.getLngLat();if(!Zt)return;const ii=[Zt.lng,Zt.lat];let Ft={map:u,marker:c,lngLat:ii,features:[{type:"Feature",properties:(D==null?void 0:D.properties)??{},geometry:{type:"Point",coordinates:ii}}]};(ot==="click"||ot==="contextmenu")&&$.handleClick(Ft),At(le,n={...Ft,layerType:"marker",type:ot},n),V(ot,Ft)}const ne=()=>te("click"),qe=()=>te("dblclick"),Ce=()=>{te("contextmenu")},et=()=>{te("mouseenter")},bt=()=>{te("mouseleave")},ft=()=>te("mousemove");return o.$$set=ot=>{"marker"in ot&&t(11,_=ot.marker),"lngLat"in ot&&t(10,x=ot.lngLat),"class"in ot&&t(0,S=ot.class),"interactive"in ot&&t(12,k=ot.interactive),"asButton"in ot&&t(1,I=ot.asButton),"draggable"in ot&&t(13,P=ot.draggable),"feature"in ot&&t(14,D=ot.feature),"offset"in ot&&t(15,R=ot.offset),"zIndex"in ot&&t(2,z=ot.zIndex),"rotation"in ot&&t(16,B=ot.rotation),"opacity"in ot&&t(17,N=ot.opacity),"$$scope"in ot&&t(18,a=ot.$$scope)},o.$$.update=()=>{o.$$.dirty&1032&&(c==null||c.setLngLat(x)),o.$$.dirty&32776&&(c==null||c.setOffset(R??[0,0])),o.$$.dirty&65544&&(c==null||c.setRotation(B)),o.$$.dirty&131080&&(c==null||c.setOpacity(N.toString()))},[S,I,z,c,j,le,oe,Y,Be,te,x,_,k,P,D,R,B,N,a,f,ne,qe,Ce,et,bt,ft]}class Md extends Ht{constructor(e){super(),Wt(this,e,dx,ux,Ut,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}var Uu=Uint8Array,y0=Uint16Array,fx=Int32Array,px=new Uu([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),mx=new Uu([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),v0=function(o,e){for(var t=new y0(31),n=0;n<31;++n)t[n]=e+=1<<o[n-1];for(var c=new fx(t[30]),n=1;n<30;++n)for(var u=t[n];u<t[n+1];++u)c[u]=u-t[n]<<5|n;return{b:t,r:c}},b0=v0(px,2),gx=b0.b,_x=b0.r;gx[28]=258,_x[258]=28;v0(mx,0);var yx=new y0(32768);for(Ui=0;Ui<32768;++Ui)ys=(Ui&43690)>>1|(Ui&21845)<<1,ys=(ys&52428)>>2|(ys&13107)<<2,ys=(ys&61680)>>4|(ys&3855)<<4,yx[Ui]=((ys&65280)>>8|(ys&255)<<8)>>1;var ys,Ui,Id=new Uu(288);for(Ui=0;Ui<144;++Ui)Id[Ui]=8;var Ui;for(Ui=144;Ui<256;++Ui)Id[Ui]=9;var Ui;for(Ui=256;Ui<280;++Ui)Id[Ui]=7;var Ui;for(Ui=280;Ui<288;++Ui)Id[Ui]=8;var Ui,vx=new Uu(32);for(Ui=0;Ui<32;++Ui)vx[Ui]=5;var Ui,bx=new Uu(0),wx=typeof TextDecoder<"u"&&new TextDecoder,xx=0;try{wx.decode(bx,{stream:!0}),xx=1}catch{}function kx(o){let e;const t=o[16].default,n=Bi(t,o,o[24],null);return{c(){n&&n.c()},m(c,u){n&&n.m(c,u),e=!0},p(c,u){n&&n.p&&(!e||u&16777216)&&Oi(n,t,c,c[24],e?Fi(t,c[24],u,null):Ni(c[24]),null)},i(c){e||(re(n,c),e=!0)},o(c){ce(n,c),e=!1},d(c){n&&n.d(c)}}}function Sx(o){let e,t,n;function c(f){o[17](f)}let u={id:o[1],type:"symbol",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],applyToClusters:o[9],minzoom:o[10],maxzoom:o[11],hoverCursor:o[12],manageHoverState:o[13],eventsIfTopMost:o[14],interactive:o[15],$$slots:{default:[kx]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Cd({props:u}),Xi.push(()=>Wr(e,"hovered",c)),e.$on("click",o[18]),e.$on("dblclick",o[19]),e.$on("contextmenu",o[20]),e.$on("mouseenter",o[21]),e.$on("mousemove",o[22]),e.$on("mouseleave",o[23]),{c(){Re(e.$$.fragment)},m(f,a){ze(e,f,a),n=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.applyToClusters=f[9]),a&1024&&(_.minzoom=f[10]),a&2048&&(_.maxzoom=f[11]),a&4096&&(_.hoverCursor=f[12]),a&8192&&(_.manageHoverState=f[13]),a&16384&&(_.eventsIfTopMost=f[14]),a&32768&&(_.interactive=f[15]),a&16777216&&(_.$$scope={dirty:a,ctx:f}),!t&&a&1&&(t=!0,_.hovered=f[0],Gr(()=>t=!1)),e.$set(_)},i(f){n||(re(e.$$.fragment,f),n=!0)},o(f){ce(e.$$.fragment,f),n=!1},d(f){De(e,f)}}}function Tx(o,e,t){let{$$slots:n={},$$scope:c}=e,{id:u=nc("symbol")}=e,{source:f=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:S=void 0}=e,{layout:k=void 0}=e,{filter:I=void 0}=e,{applyToClusters:P=void 0}=e,{minzoom:D=void 0}=e,{maxzoom:R=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:B=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:V=!1}=e,{interactive:j=!0}=e;function le(ne){N=ne,t(0,N)}function oe(ne){ui.call(this,o,ne)}function $(ne){ui.call(this,o,ne)}function Y(ne){ui.call(this,o,ne)}function ve(ne){ui.call(this,o,ne)}function Be(ne){ui.call(this,o,ne)}function te(ne){ui.call(this,o,ne)}return o.$$set=ne=>{"id"in ne&&t(1,u=ne.id),"source"in ne&&t(2,f=ne.source),"sourceLayer"in ne&&t(3,a=ne.sourceLayer),"beforeId"in ne&&t(4,_=ne.beforeId),"beforeLayerType"in ne&&t(5,x=ne.beforeLayerType),"paint"in ne&&t(6,S=ne.paint),"layout"in ne&&t(7,k=ne.layout),"filter"in ne&&t(8,I=ne.filter),"applyToClusters"in ne&&t(9,P=ne.applyToClusters),"minzoom"in ne&&t(10,D=ne.minzoom),"maxzoom"in ne&&t(11,R=ne.maxzoom),"hoverCursor"in ne&&t(12,z=ne.hoverCursor),"manageHoverState"in ne&&t(13,B=ne.manageHoverState),"hovered"in ne&&t(0,N=ne.hovered),"eventsIfTopMost"in ne&&t(14,V=ne.eventsIfTopMost),"interactive"in ne&&t(15,j=ne.interactive),"$$scope"in ne&&t(24,c=ne.$$scope)},[N,u,f,a,_,x,S,k,I,P,D,R,z,B,V,j,n,le,oe,$,Y,ve,Be,te,c]}class w0 extends Ht{constructor(e){super(),Wt(this,e,Tx,Sx,Ut,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var Ex=Object.defineProperty,x0=o=>{throw TypeError(o)},Cx=(o,e,t)=>e in o?Ex(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,uo=(o,e,t)=>Cx(o,typeof e!="symbol"?e+"":e,t),k0=(o,e,t)=>e.has(o)||x0("Cannot "+t),Qn=(o,e,t)=>(k0(o,e,"read from private field"),t?t.call(o):e.get(o)),jg=(o,e,t)=>e.has(o)?x0("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(o):e.set(o,t),Ug=(o,e,t,n)=>(k0(o,e,"write to private field"),n?n.call(o,t):e.set(o,t),t);function gn(){}function Mx(o,e){for(const t in e)o[t]=e[t];return o}function S0(o){return o()}function Vg(){return Object.create(null)}function Ls(o){o.forEach(S0)}function T0(o){return typeof o=="function"}function na(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}let ed;function Ar(o,e){return o===e?!0:(ed||(ed=document.createElement("a")),ed.href=e,o===ed.href)}function Ix(o){return Object.keys(o).length===0}function Lx(o,e,t,n){if(o){const c=E0(o,e,t,n);return o[0](c)}}function E0(o,e,t,n){return o[1]&&n?Mx(t.ctx.slice(),o[1](n(e))):t.ctx}function Ax(o,e,t,n){if(o[2]&&n){const c=o[2](n(t));if(e.dirty===void 0)return c;if(typeof c=="object"){const u=[],f=Math.max(e.dirty.length,c.length);for(let a=0;a<f;a+=1)u[a]=e.dirty[a]|c[a];return u}return e.dirty|c}return e.dirty}function Px(o,e,t,n,c,u){if(c){const f=E0(e,t,n,u);o.p(f,c)}}function zx(o){if(o.ctx.length>32){const e=[],t=o.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function qg(o){return o??""}function Li(o,e){o.appendChild(e)}function vn(o,e,t){o.insertBefore(e,t||null)}function _n(o){o.parentNode&&o.parentNode.removeChild(o)}function $i(o){return document.createElement(o)}function jo(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function ea(o){return document.createTextNode(o)}function ho(){return ea(" ")}function Dx(){return ea("")}function Zr(o,e,t,n){return o.addEventListener(e,t,n),()=>o.removeEventListener(e,t,n)}function Rx(o){return function(e){return e.preventDefault(),o.call(this,e)}}function st(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}function Bx(o){return Array.from(o.childNodes)}function Pu(o,e){e=""+e,o.data!==e&&(o.data=e)}function Zg(o,e){o.value=e??""}function Mo(o,e,t){o.classList.toggle(e,!!t)}function Fx(o,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:n})}let zu;function Su(o){zu=o}function C0(){if(!zu)throw new Error("Function called outside component initialization");return zu}function Ox(o){C0().$$.on_destroy.push(o)}function Nx(){const o=C0();return(e,t,{cancelable:n=!1}={})=>{const c=o.$$.callbacks[e];if(c){const u=Fx(e,t,{cancelable:n});return c.slice().forEach(f=>{f.call(o,u)}),!u.defaultPrevented}return!0}}function Gg(o,e){const t=o.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const Gl=[],op=[];let $l=[];const Wg=[],jx=Promise.resolve();let sp=!1;function Ux(){sp||(sp=!0,jx.then(M0))}function ap(o){$l.push(o)}const Uf=new Set;let jl=0;function M0(){if(jl!==0)return;const o=zu;do{try{for(;jl<Gl.length;){const e=Gl[jl];jl++,Su(e),Vx(e.$$)}}catch(e){throw Gl.length=0,jl=0,e}for(Su(null),Gl.length=0,jl=0;op.length;)op.pop()();for(let e=0;e<$l.length;e+=1){const t=$l[e];Uf.has(t)||(Uf.add(t),t())}$l.length=0}while(Gl.length);for(;Wg.length;)Wg.pop()();sp=!1,Uf.clear(),Su(o)}function Vx(o){if(o.fragment!==null){o.update(),Ls(o.before_update);const e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(ap)}}function qx(o){const e=[],t=[];$l.forEach(n=>o.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),$l=e}const ad=new Set;let Ra;function ld(){Ra={r:0,c:[],p:Ra}}function cd(){Ra.r||Ls(Ra.c),Ra=Ra.p}function Wn(o,e){o&&o.i&&(ad.delete(o),o.i(e))}function ar(o,e,t,n){if(o&&o.o){if(ad.has(o))return;ad.add(o),Ra.c.push(()=>{ad.delete(o),n&&(t&&o.d(1),n())}),o.o(e)}else n&&n()}function Hg(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function Zx(o,e){ar(o,1,1,()=>{e.delete(o.key)})}function Gx(o,e,t,n,c,u,f,a,_,x,S,k){let I=o.length,P=u.length,D=I;const R={};for(;D--;)R[o[D].key]=D;const z=[],B=new Map,N=new Map,V=[];for(D=P;D--;){const $=k(c,u,D),Y=t($);let ve=f.get(Y);ve?V.push(()=>ve.p($,e)):(ve=x(Y,$),ve.c()),B.set(Y,z[D]=ve),Y in R&&N.set(Y,Math.abs(D-R[Y]))}const j=new Set,le=new Set;function oe($){Wn($,1),$.m(a,S),f.set($.key,$),S=$.first,P--}for(;I&&P;){const $=z[P-1],Y=o[I-1],ve=$.key,Be=Y.key;$===Y?(S=$.first,I--,P--):B.has(Be)?!f.has(ve)||j.has(ve)?oe($):le.has(Be)?I--:N.get(ve)>N.get(Be)?(le.add(ve),oe($)):(j.add(Be),I--):(_(Y,f),I--)}for(;I--;){const $=o[I];B.has($.key)||_($,f)}for(;P;)oe(z[P-1]);return Ls(V),z}function ta(o){o&&o.c()}function Ms(o,e,t){const{fragment:n,after_update:c}=o.$$;n&&n.m(e,t),ap(()=>{const u=o.$$.on_mount.map(S0).filter(T0);o.$$.on_destroy?o.$$.on_destroy.push(...u):Ls(u),o.$$.on_mount=[]}),c.forEach(ap)}function Is(o,e){const t=o.$$;t.fragment!==null&&(qx(t.after_update),Ls(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Wx(o,e){o.$$.dirty[0]===-1&&(Gl.push(o),Ux(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function ra(o,e,t,n,c,u,f=null,a=[-1]){const _=zu;Su(o);const x=o.$$={fragment:null,ctx:[],props:u,update:gn,not_equal:c,bound:Vg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(_?_.$$.context:[])),callbacks:Vg(),dirty:a,skip_bound:!1,root:e.target||_.$$.root};f&&f(x.root);let S=!1;if(x.ctx=t?t(o,e.props||{},(k,I,...P)=>{const D=P.length?P[0]:I;return x.ctx&&c(x.ctx[k],x.ctx[k]=D)&&(!x.skip_bound&&x.bound[k]&&x.bound[k](D),S&&Wx(o,k)),I}):[],x.update(),S=!0,Ls(x.before_update),x.fragment=n?n(x.ctx):!1,e.target){if(e.hydrate){const k=Bx(e.target);x.fragment&&x.fragment.l(k),k.forEach(_n)}else x.fragment&&x.fragment.c();e.intro&&Wn(o.$$.fragment),Ms(o,e.target,e.anchor),M0()}Su(_)}class oa{constructor(){uo(this,"$$"),uo(this,"$$set")}$destroy(){Is(this,1),this.$destroy=gn}$on(e,t){if(!T0(t))return gn;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const c=n.indexOf(t);c!==-1&&n.splice(c,1)}}$set(e){this.$$set&&!Ix(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Hx="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Hx);function $x(o){let e,t;return{c(){e=jo("svg"),t=jo("path"),st(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),st(e,"viewBox","0 0 14 14"),st(e,"width","13"),st(e,"height","13"),st(e,"class","svelte-en2qvf")},m(n,c){vn(n,e,c),Li(e,t)},p:gn,i:gn,o:gn,d(n){n&&_n(e)}}}class I0 extends oa{constructor(e){super(),ra(this,e,null,$x,na,{})}}function Xx(o){let e,t;return{c(){e=jo("svg"),t=jo("path"),st(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),st(e,"viewBox","0 0 30 30"),st(e,"fill","none"),st(e,"xmlns","http://www.w3.org/2000/svg"),st(e,"class","svelte-d2loi5")},m(n,c){vn(n,e,c),Li(e,t)},p:gn,i:gn,o:gn,d(n){n&&_n(e)}}}class L0 extends oa{constructor(e){super(),ra(this,e,null,Xx,na,{})}}function Kx(o){let e,t;return{c(){e=$i("img"),Ar(e.src,t=o[3]+"area.svg")||st(e,"src",t),st(e,"alt",o[6]),st(e,"class","svelte-ltkwvy")},m(n,c){vn(n,e,c)},p(n,c){c&8&&!Ar(e.src,t=n[3]+"area.svg")&&st(e,"src",t),c&64&&st(e,"alt",n[6])},d(n){n&&_n(e)}}}function Jx(o){let e,t;return{c(){e=$i("img"),Ar(e.src,t=o[3]+"reverse.svg")||st(e,"src",t),st(e,"alt",o[6]),st(e,"class","svelte-ltkwvy")},m(n,c){vn(n,e,c)},p(n,c){c&8&&!Ar(e.src,t=n[3]+"reverse.svg")&&st(e,"src",t),c&64&&st(e,"alt",n[6])},d(n){n&&_n(e)}}}function Yx(o){let e,t;return{c(){e=$i("img"),Ar(e.src,t=o[3]+"poi.svg")||st(e,"src",t),st(e,"alt",o[6]),st(e,"class","svelte-ltkwvy")},m(n,c){vn(n,e,c)},p(n,c){c&8&&!Ar(e.src,t=n[3]+"poi.svg")&&st(e,"src",t),c&64&&st(e,"alt",n[6])},d(n){n&&_n(e)}}}function Qx(o){let e,t;return{c(){e=$i("img"),Ar(e.src,t=o[3]+"postal_code.svg")||st(e,"src",t),st(e,"alt",o[6]),st(e,"class","svelte-ltkwvy")},m(n,c){vn(n,e,c)},p(n,c){c&8&&!Ar(e.src,t=n[3]+"postal_code.svg")&&st(e,"src",t),c&64&&st(e,"alt",n[6])},d(n){n&&_n(e)}}}function e2(o){let e,t;return{c(){e=$i("img"),Ar(e.src,t=o[3]+"street.svg")||st(e,"src",t),st(e,"alt",o[6]),st(e,"class","svelte-ltkwvy")},m(n,c){vn(n,e,c)},p(n,c){c&8&&!Ar(e.src,t=n[3]+"street.svg")&&st(e,"src",t),c&64&&st(e,"alt",n[6])},d(n){n&&_n(e)}}}function t2(o){let e,t;return{c(){e=$i("img"),Ar(e.src,t=o[3]+"road.svg")||st(e,"src",t),st(e,"alt",o[6]),st(e,"class","svelte-ltkwvy")},m(n,c){vn(n,e,c)},p(n,c){c&8&&!Ar(e.src,t=n[3]+"road.svg")&&st(e,"src",t),c&64&&st(e,"alt",n[6])},d(n){n&&_n(e)}}}function i2(o){let e,t;return{c(){e=$i("img"),Ar(e.src,t=o[3]+"housenumber.svg")||st(e,"src",t),st(e,"alt",o[6]),st(e,"class","svelte-ltkwvy")},m(n,c){vn(n,e,c)},p(n,c){c&8&&!Ar(e.src,t=n[3]+"housenumber.svg")&&st(e,"src",t),c&64&&st(e,"alt",n[6])},d(n){n&&_n(e)}}}function n2(o){let e,t,n,c;return{c(){e=$i("img"),Ar(e.src,t=o[5])||st(e,"src",t),st(e,"alt",o[4]),st(e,"class","svelte-ltkwvy")},m(u,f){vn(u,e,f),n||(c=Zr(e,"error",o[14]),n=!0)},p(u,f){f&32&&!Ar(e.src,t=u[5])&&st(e,"src",t),f&16&&st(e,"alt",u[4])},d(u){u&&_n(e),n=!1,c()}}}function $g(o){let e,t;return{c(){e=$i("span"),t=ea(o[6]),st(e,"class","secondary svelte-ltkwvy")},m(n,c){vn(n,e,c),Li(e,t)},p(n,c){c&64&&Pu(t,n[6])},d(n){n&&_n(e)}}}function r2(o){let e,t,n,c,u,f,a,_,x,S=(o[7]?o[0].place_name:o[0].place_name.replace(/,.*/,""))+"",k,I,P=o[2]==="always"||o[2]!=="never"&&!o[0].address&&!o[0].id.startsWith("road.")&&!o[0].id.startsWith("address.")&&!o[0].id.startsWith("postal_code.")&&(!o[0].id.startsWith("poi.")||!o[5])&&!o[7],D,R,z=(o[7]?"":o[0].place_name.replace(/[^,]*,?\s*/,""))+"",B,N,V;function j(Y,ve){return ve&1&&(t=null),ve&1&&(n=null),ve&1&&(c=null),ve&1&&(u=null),Y[5]?n2:Y[0].address?i2:(t==null&&(t=!!Y[0].id.startsWith("road.")),t?t2:(n==null&&(n=!!Y[0].id.startsWith("address.")),n?e2:(c==null&&(c=!!Y[0].id.startsWith("postal_code.")),c?Qx:(u==null&&(u=!!Y[0].id.startsWith("poi.")),u?Yx:Y[7]?Jx:Kx))))}let le=j(o,-1),oe=le(o),$=P&&$g(o);return{c(){e=$i("li"),oe.c(),f=ho(),a=$i("span"),_=$i("span"),x=$i("span"),k=ea(S),I=ho(),$&&$.c(),D=ho(),R=$i("span"),B=ea(z),st(x,"class","primary svelte-ltkwvy"),st(_,"class","svelte-ltkwvy"),st(R,"class","line2 svelte-ltkwvy"),st(a,"class","texts svelte-ltkwvy"),st(e,"tabindex","0"),st(e,"data-selected",o[1]),st(e,"class","svelte-ltkwvy"),Mo(e,"selected",o[1])},m(Y,ve){vn(Y,e,ve),oe.m(e,null),Li(e,f),Li(e,a),Li(a,_),Li(_,x),Li(x,k),Li(_,I),$&&$.m(_,null),Li(a,D),Li(a,R),Li(R,B),N||(V=[Zr(e,"mouseenter",o[12]),Zr(e,"focus",o[13])],N=!0)},p(Y,[ve]){le===(le=j(Y,ve))&&oe?oe.p(Y,ve):(oe.d(1),oe=le(Y),oe&&(oe.c(),oe.m(e,f))),ve&1&&S!==(S=(Y[7]?Y[0].place_name:Y[0].place_name.replace(/,.*/,""))+"")&&Pu(k,S),ve&37&&(P=Y[2]==="always"||Y[2]!=="never"&&!Y[0].address&&!Y[0].id.startsWith("road.")&&!Y[0].id.startsWith("address.")&&!Y[0].id.startsWith("postal_code.")&&(!Y[0].id.startsWith("poi.")||!Y[5])&&!Y[7]),P?$?$.p(Y,ve):($=$g(Y),$.c(),$.m(_,null)):$&&($.d(1),$=null),ve&1&&z!==(z=(Y[7]?"":Y[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Pu(B,z),ve&2&&st(e,"data-selected",Y[1]),ve&2&&Mo(e,"selected",Y[1])},i:gn,o:gn,d(Y){Y&&_n(e),oe.d(),$&&$.d(),N=!1,Ls(V)}}}function o2(o,e,t){var n;let c,u,{feature:f}=e,{selected:a=!1}=e,{showPlaceType:_}=e,{missingIconsCache:x}=e,{iconsBaseUrl:S}=e;const k=(n=f.properties)==null?void 0:n.categories;let I,P,D=0,R=f.place_type[0]==="reverse";function z(){P&&x.add(P),t(10,D++,D)}function B(j){Gg.call(this,o,j)}function N(j){Gg.call(this,o,j)}const V=()=>z();return o.$$set=j=>{"feature"in j&&t(0,f=j.feature),"selected"in j&&t(1,a=j.selected),"showPlaceType"in j&&t(2,_=j.showPlaceType),"missingIconsCache"in j&&t(9,x=j.missingIconsCache),"iconsBaseUrl"in j&&t(3,S=j.iconsBaseUrl)},o.$$.update=()=>{var j,le,oe,$;if(o.$$.dirty&3640)do t(11,c--,c),t(4,I=k==null?void 0:k[c]),t(5,P=I?S+I.replace(/ /g,"_")+".svg":void 0);while(c>-1&&(!P||x.has(P)));o.$$.dirty&1&&t(6,u=((le=(j=f.properties)==null?void 0:j.categories)==null?void 0:le.join(", "))??(($=(oe=f.properties)==null?void 0:oe.place_type_name)==null?void 0:$[0])??f.place_type[0])},t(11,c=(k==null?void 0:k.length)??0),[f,a,_,S,I,P,u,R,z,x,D,c,B,N,V]}class s2 extends oa{constructor(e){super(),ra(this,e,o2,r2,na,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function a2(o){let e;return{c(){e=$i("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',st(e,"class","svelte-7cmwmc")},m(t,n){vn(t,e,n)},p:gn,i:gn,o:gn,d(t){t&&_n(e)}}}class l2 extends oa{constructor(e){super(),ra(this,e,null,a2,na,{})}}function c2(o){let e,t,n;return{c(){e=jo("svg"),t=jo("path"),st(t,"stroke-width","4"),st(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),st(t,"class","svelte-gzo3ar"),st(e,"width",n=o[0]==="list"?20:void 0),st(e,"viewBox","0 0 70 85"),st(e,"fill","none"),st(e,"class","svelte-gzo3ar"),Mo(e,"in-map",o[0]!=="list"),Mo(e,"list-icon",o[0]==="list")},m(c,u){vn(c,e,u),Li(e,t)},p(c,[u]){u&1&&n!==(n=c[0]==="list"?20:void 0)&&st(e,"width",n),u&1&&Mo(e,"in-map",c[0]!=="list"),u&1&&Mo(e,"list-icon",c[0]==="list")},i:gn,o:gn,d(c){c&&_n(e)}}}function u2(o,e,t){let{displayIn:n}=e;return o.$$set=c=>{"displayIn"in c&&t(0,n=c.displayIn)},[n]}class h2 extends oa{constructor(e){super(),ra(this,e,u2,c2,na,{displayIn:0})}}function d2(o){let e,t;return{c(){e=jo("svg"),t=jo("path"),st(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),st(e,"viewBox","0 0 60.006 21.412"),st(e,"width","14"),st(e,"height","20"),st(e,"class","svelte-en2qvf")},m(n,c){vn(n,e,c),Li(e,t)},p:gn,i:gn,o:gn,d(n){n&&_n(e)}}}class f2 extends oa{constructor(e){super(),ra(this,e,null,d2,na,{})}}function p2(o){let e,t,n;return{c(){e=jo("svg"),t=jo("circle"),n=jo("path"),st(t,"cx","4.789"),st(t,"cy","4.787"),st(t,"r","3.85"),st(t,"class","svelte-1aq105l"),st(n,"d","M12.063 12.063 7.635 7.635"),st(n,"class","svelte-1aq105l"),st(e,"xmlns","http://www.w3.org/2000/svg"),st(e,"width","13"),st(e,"height","13"),st(e,"viewBox","0 0 13 13"),st(e,"class","svelte-1aq105l")},m(c,u){vn(c,e,u),Li(e,t),Li(e,n)},p:gn,i:gn,o:gn,d(c){c&&_n(e)}}}class m2 extends oa{constructor(e){super(),ra(this,e,null,p2,na,{})}}function g2(o,e,t){const n=e[1],c=e[0],u=n-c;return o===n&&t?o:((o-c)%u+u)%u+c}function vd(o){const e=[...o];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let su;async function _2(o,e,t){const n=o==null?void 0:o.getCenterAndZoom();for(const c of e??[])if(!(n&&(c.minZoom!=null&&c.minZoom>n[0]||c.maxZoom!=null&&c.maxZoom<n[0]))){if(c.type==="fixed")return c.coordinates.join(",");e:if(c.type==="client-geolocation"){if(su&&c.cachedLocationExpiry&&su.time+c.cachedLocationExpiry>Date.now()){if(!su.coords)break e;return su.coords}let u;try{return u=await new Promise((f,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(_=>{f([_.coords.longitude,_.coords.latitude].map(x=>x.toFixed(6)).join(","))},_=>{a(_)},c)}),u}catch{}finally{c.cachedLocationExpiry&&(su={time:Date.now(),coords:u})}if(t.signal.aborted)return}if(c.type==="server-geolocation")return"ip";if(n&&c.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const y2=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,Xg=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,Kg=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,Jg=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,Yg=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,Qg=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function v2(o){if(!["DMS","DM","DD"].includes(o))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(P=>Number(P.trim())),t=Number(e[0]),n=Number(e[1]),c=Math.abs(t),u=Math.abs(n),f=t>0?"N":"S",a=n>0?"E":"W";let _;o=="DD"&&(_=`${c} ${f}, ${u} ${a}`);const x=Math.floor(c),S=Math.floor(u),k=(c-x)*60,I=(u-S)*60;if(o=="DM"){let P=e_(k,3).toFixed(3).padStart(6,"0"),D=e_(I,3).toFixed(3).padStart(6,"0");P.endsWith(".000")&&D.endsWith(".000")&&(P=P.replace(/\.000$/,""),D=D.replace(/\.000$/,"")),_=`${x} ${P}' ${f}, ${S} ${D}' ${a}`}if(o=="DMS"){const P=Math.floor(k),D=Math.floor(I);let R=((k-P)*60).toFixed(1).padStart(4,"0"),z=((I-D)*60).toFixed(1).padStart(4,"0");const B=P.toString().padStart(2,"0"),N=D.toString().padStart(2,"0");R.endsWith(".0")&&z.endsWith(".0")&&(R=R.replace(/\.0$/,""),z=z.replace(/\.0$/,"")),_=`${x} ${B}' ${R}" ${f}, ${S} ${N}' ${z}" ${a}`}return _}else throw new Error("no decimal coordinates to convert")}function e_(o,e){const t=Math.pow(10,e);return Math.round((o+Number.EPSILON)*t)/t}function Rp(o,e){e||(e=5),o=o.replace(/\s+/g," ").trim();let t=null,n=null,c="",u="",f=null,a=[],_=!1;if(y2.test(o))throw new Error("invalid coordinate value");if(Xg.test(o))if(a=Xg.exec(o),_=au(a),_)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),n=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(n*=-1),f="DM";else throw new Error("invalid coordinate format");else if(Kg.test(o))if(a=Kg.exec(o),_=au(a),_){if(t=a[2],n=a[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),f="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");a[1]?(c=a[1],u=a[5]):a[4]&&(c=a[4],u=a[8])}else throw new Error("invalid decimal coordinate format");else if(Jg.test(o))if(a=Jg.exec(o),_=au(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,f="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,f="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[9])),a[11]&&(n+=a[11]/60),a[13]&&(n+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(n=-1*n),a[1]?(c=a[1],u=a[8]):a[7]&&(c=a[7],u=a[14]);else throw new Error("invalid DMS coordinates format");else if(Yg.test(o))if(a=Yg.exec(o),_=au(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,f="DM"),a[6]&&(t+=a[6]/3600,f="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12]/60),a[14]&&(n+=a[14]/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(c=a[1],u=a[9]):a[8]&&(c=a[8],u=a[16]);else throw new Error("invalid DMS coordinates format");else if(Qg.test(o)){if(a=Qg.exec(o),_=au(a),a.filter(x=>x).length<=5)throw new Error("invalid coordinates format");if(_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,f="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,f="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12].replace(",",".")/60),a[14]&&(n+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(c=a[1],u=a[9]):a[8]&&(c=a[8],u=a[16]);else throw new Error("invalid coordinates format")}if(_){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(c&&!u||!c&&u)throw new Error("invalid coordinates value");if(c&&c==u)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let x=/S|SOUTH/i;x.test(c)&&t>0&&(t=-1*t),x=/W|WEST/i,x.test(u)&&n>0&&(n=-1*n);const S=a[0].trim();let k,I;const P=/[,/;\u0020]/g,D=S.match(P);if(D==null){const B=Math.floor(o.length/2);k=S.substring(0,B).trim(),I=S.substring(B).trim()}else{let B;D.length%2==1?B=Math.floor(D.length/2):B=D.length/2-1;let N=0;if(B==0)N=S.indexOf(D[0]),k=S.substring(0,N).trim(),I=S.substring(N+1).trim();else{let V=0,j=0;for(;V<=B;)N=S.indexOf(D[V],j),j=N+1,V++;k=S.substring(0,N).trim(),I=S.substring(N+1).trim()}}const R=k.split(".");if(R.length==2&&R[1]==0&&R[1].length!=2)throw new Error("invalid coordinates format");const z=I.split(".");if(z.length==2&&z[1]==0&&z[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(k)||/^\d+$/.test(I))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:S,verbatimLatitude:k,verbatimLongitude:I,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:f,closeEnough:b2,toCoordinateFormat:v2})}else throw new Error("coordinates pattern match failed")}function au(o){if(!isNaN(o[0]))return!1;const e=[...o];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,c=e.length/2;for(let u=0;u<c;u++){const f=e[u],a=e[u+c],_=t.test(f)&&t.test(a),x=n.test(f)&&n.test(a),S=f==a;if(!(f==null&&a==null)){if(f==null||a==null)return!1;if(_||x||S)continue;return!1}}return!0}function t_(o,e){const t=Math.abs(o-e);return Number(t.toFixed(6))<=1e-5}function b2(o){if(!o)throw new Error("coords must be provided");if(o.includes(",")){const e=o.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return t_(this.decimalLatitude,Number(e[0]))&&t_(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const w2=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Rp.to=w2;const x2=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],k2={decimalLatitude:40.123,decimalLongitude:-74.123},S2=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],T2=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function E2(){const o=[];return x2.forEach(e=>{e.decimalLatitude?o.push(e):o.push({...e,...k2})}),[...o,...S2,...T2]}const C2=E2();Rp.formats=C2.map(o=>o.verbatimCoordinates);const M2=Rp;function i_(o,e,t){const n=o.slice();return n[84]=e[t],n[86]=t,n}function n_(o){let e,t;return e=new l2({}),{c(){ta(e.$$.fragment)},m(n,c){Ms(e,n,c),t=!0},i(n){t||(Wn(e.$$.fragment,n),t=!0)},o(n){ar(e.$$.fragment,n),t=!1},d(n){Is(e,n)}}}function r_(o){let e,t,n,c,u;return t=new f2({}),{c(){e=$i("button"),ta(t.$$.fragment),st(e,"type","button"),st(e,"title",o[9]),st(e,"class","svelte-bz0zu3"),Mo(e,"active",o[0])},m(f,a){vn(f,e,a),Ms(t,e,null),n=!0,c||(u=Zr(e,"click",o[69]),c=!0)},p(f,a){(!n||a[0]&512)&&st(e,"title",f[9]),(!n||a[0]&1)&&Mo(e,"active",f[0])},i(f){n||(Wn(t.$$.fragment,f),n=!0)},o(f){ar(t.$$.fragment,f),n=!1},d(f){f&&_n(e),Is(t),c=!1,u()}}}function I2(o){let e,t=[],n=new Map,c,u,f,a=Hg(o[14]);const _=x=>x[84].id+(x[84].address?","+x[84].address:"");for(let x=0;x<a.length;x+=1){let S=i_(o,a,x),k=_(S);n.set(k,t[x]=o_(k,S))}return{c(){e=$i("ul");for(let x=0;x<t.length;x+=1)t[x].c();st(e,"class","options svelte-bz0zu3")},m(x,S){vn(x,e,S);for(let k=0;k<t.length;k+=1)t[k]&&t[k].m(e,null);c=!0,u||(f=[Zr(e,"mouseleave",o[73]),Zr(e,"blur",o[74])],u=!0)},p(x,S){S[0]&17880064&&(a=Hg(x[14]),ld(),t=Gx(t,S,_,1,x,a,n,e,Zx,o_,null,i_),cd())},i(x){if(!c){for(let S=0;S<a.length;S+=1)Wn(t[S]);c=!0}},o(x){for(let S=0;S<t.length;S+=1)ar(t[S]);c=!1},d(x){x&&_n(e);for(let S=0;S<t.length;S+=1)t[S].d();u=!1,Ls(f)}}}function L2(o){let e,t,n,c,u,f;return t=new L0({}),{c(){e=$i("div"),ta(t.$$.fragment),n=ho(),c=$i("div"),u=ea(o[7]),st(c,"class","svelte-bz0zu3"),st(e,"class","no-results svelte-bz0zu3")},m(a,_){vn(a,e,_),Ms(t,e,null),Li(e,n),Li(e,c),Li(c,u),f=!0},p(a,_){(!f||_[0]&128)&&Pu(u,a[7])},i(a){f||(Wn(t.$$.fragment,a),f=!0)},o(a){ar(t.$$.fragment,a),f=!1},d(a){a&&_n(e),Is(t)}}}function A2(o){let e="",t;return{c(){t=ea(e)},m(n,c){vn(n,t,c)},p:gn,i:gn,o:gn,d(n){n&&_n(t)}}}function P2(o){let e,t,n,c,u,f,a,_,x,S,k;return t=new L0({}),_=new I0({}),{c(){e=$i("div"),ta(t.$$.fragment),n=ho(),c=$i("div"),u=ea(o[6]),f=ho(),a=$i("button"),ta(_.$$.fragment),st(c,"class","svelte-bz0zu3"),st(a,"class","svelte-bz0zu3"),st(e,"class","error svelte-bz0zu3")},m(I,P){vn(I,e,P),Ms(t,e,null),Li(e,n),Li(e,c),Li(c,u),Li(e,f),Li(e,a),Ms(_,a,null),x=!0,S||(k=Zr(a,"click",o[70]),S=!0)},p(I,P){(!x||P[0]&64)&&Pu(u,I[6])},i(I){x||(Wn(t.$$.fragment,I),Wn(_.$$.fragment,I),x=!0)},o(I){ar(t.$$.fragment,I),ar(_.$$.fragment,I),x=!1},d(I){I&&_n(e),Is(t),Is(_),S=!1,k()}}}function o_(o,e){let t,n,c;function u(){return e[71](e[86])}function f(){return e[72](e[84])}return n=new s2({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",u),n.$on("focus",f),{key:o,first:null,c(){t=Dx(),ta(n.$$.fragment),this.first=t},m(a,_){vn(a,t,_),Ms(n,a,_),c=!0},p(a,_){e=a;const x={};_[0]&16384&&(x.feature=e[84]),_[0]&1024&&(x.showPlaceType=e[10]),_[0]&49152&&(x.selected=e[15]===e[86]),_[0]&4096&&(x.iconsBaseUrl=e[12]),n.$set(x)},i(a){c||(Wn(n.$$.fragment,a),c=!0)},o(a){ar(n.$$.fragment,a),c=!1},d(a){a&&_n(t),Is(n,a)}}}function z2(o){let e,t,n,c,u,f,a,_,x,S,k,I,P,D,R,z,B,N,V,j,le,oe=!1;u=new m2({}),k=new I0({});let $=o[19]&&n_(),Y=o[5]==="button"&&r_(o);const ve=o[61].default,Be=Lx(ve,o,o[60],null),te=[P2,A2,L2,I2],ne=[];function qe(Ce,et){var bt,ft;return Ce[18]?0:Ce[16]?((bt=Ce[14])==null?void 0:bt.length)===0?2:Ce[16]&&(ft=Ce[14])!=null&&ft.length?3:-1:1}return~(z=qe(o))&&(B=ne[z]=te[z](o)),{c(){e=ho(),t=$i("form"),n=$i("div"),c=$i("button"),ta(u.$$.fragment),f=ho(),a=$i("input"),_=ho(),x=$i("div"),S=$i("button"),ta(k.$$.fragment),I=ho(),$&&$.c(),P=ho(),Y&&Y.c(),D=ho(),Be&&Be.c(),R=ho(),B&&B.c(),st(c,"class","search-button svelte-bz0zu3"),st(c,"type","button"),st(a,"placeholder",o[8]),st(a,"aria-label",o[8]),st(a,"class","svelte-bz0zu3"),st(S,"type","button"),st(S,"title",o[3]),st(S,"class","svelte-bz0zu3"),st(x,"class","clear-button-container svelte-bz0zu3"),Mo(x,"displayable",o[1]!==""),st(n,"class","input-group svelte-bz0zu3"),st(t,"tabindex","0"),st(t,"class",N=qg(o[2])+" svelte-bz0zu3"),Mo(t,"can-collapse",o[4]&&o[1]==="")},m(Ce,et){vn(Ce,e,et),vn(Ce,t,et),Li(t,n),Li(n,c),Ms(u,c,null),Li(n,f),Li(n,a),o[63](a),Zg(a,o[1]),Li(n,_),Li(n,x),Li(x,S),Ms(k,S,null),Li(x,I),$&&$.m(x,null),Li(n,P),Y&&Y.m(n,null),Li(n,D),Be&&Be.m(n,null),Li(t,R),~z&&ne[z].m(t,null),V=!0,j||(le=[Zr(c,"click",o[62]),Zr(a,"input",o[64]),Zr(a,"focus",o[65]),Zr(a,"blur",o[66]),Zr(a,"keydown",o[22]),Zr(a,"input",o[67]),Zr(S,"click",o[68]),Zr(t,"submit",Rx(o[21]))],j=!0)},p(Ce,et){(!V||et[0]&256)&&st(a,"placeholder",Ce[8]),(!V||et[0]&256)&&st(a,"aria-label",Ce[8]),et[0]&2&&a.value!==Ce[1]&&Zg(a,Ce[1]),(!V||et[0]&8)&&st(S,"title",Ce[3]),Ce[19]?$?et[0]&524288&&Wn($,1):($=n_(),$.c(),Wn($,1),$.m(x,null)):$&&(ld(),ar($,1,1,()=>{$=null}),cd()),(!V||et[0]&2)&&Mo(x,"displayable",Ce[1]!==""),Ce[5]==="button"?Y?(Y.p(Ce,et),et[0]&32&&Wn(Y,1)):(Y=r_(Ce),Y.c(),Wn(Y,1),Y.m(n,D)):Y&&(ld(),ar(Y,1,1,()=>{Y=null}),cd()),Be&&Be.p&&(!V||et[1]&536870912)&&Px(Be,ve,Ce,Ce[60],V?Ax(ve,Ce[60],et,null):zx(Ce[60]),null);let bt=z;z=qe(Ce),z===bt?~z&&ne[z].p(Ce,et):(B&&(ld(),ar(ne[bt],1,1,()=>{ne[bt]=null}),cd()),~z?(B=ne[z],B?B.p(Ce,et):(B=ne[z]=te[z](Ce),B.c()),Wn(B,1),B.m(t,null)):B=null),(!V||et[0]&4&&N!==(N=qg(Ce[2])+" svelte-bz0zu3"))&&st(t,"class",N),(!V||et[0]&22)&&Mo(t,"can-collapse",Ce[4]&&Ce[1]==="")},i(Ce){V||(Wn(oe),Wn(u.$$.fragment,Ce),Wn(k.$$.fragment,Ce),Wn($),Wn(Y),Wn(Be,Ce),Wn(B),V=!0)},o(Ce){ar(oe),ar(u.$$.fragment,Ce),ar(k.$$.fragment,Ce),ar($),ar(Y),ar(Be,Ce),ar(B),V=!1},d(Ce){Ce&&(_n(e),_n(t)),Is(u),o[63](null),Is(k),$&&$.d(),Y&&Y.d(),Be&&Be.d(Ce),~z&&ne[z].d(),j=!1,Ls(le)}}}function D2(o,e,t){let n,c,{$$slots:u={},$$scope:f}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:_=void 0}=e,{apiKey:x}=e,{bbox:S=void 0}=e,{clearButtonTitle:k="clear"}=e,{clearOnBlur:I=!1}=e,{collapsed:P=!1}=e,{country:D=void 0}=e,{debounceSearch:R=200}=e,{enableReverse:z="never"}=e,{errorMessage:B="Something went wrong"}=e,{filter:N=()=>!0}=e,{flyTo:V=!0}=e,{fuzzyMatch:j=!0}=e,{language:le=void 0}=e,{limit:oe=void 0}=e,{mapController:$=void 0}=e,{minLength:Y=2}=e,{noResultsMessage:ve="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Be="Search"}=e,{proximity:te=[{type:"server-geolocation"}]}=e,{reverseActive:ne=z==="always"}=e,{reverseButtonTitle:qe="toggle reverse geocoding"}=e,{searchValue:Ce=""}=e,{pickedResultStyle:et="full-geometry"}=e,{showPlaceType:bt="if-needed"}=e,{showResultsWhileTyping:ft=!0}=e,{selectFirst:ot=!0}=e,{flyToSelected:Zt=!1}=e,{markerOnSelected:ii=!0}=e,{types:Ft=void 0}=e,{exhaustiveReverseGeocoding:Pt=!1}=e,{excludeTypes:Jt=!1}=e,{zoom:Mt=a}=e,{apiUrl:ei="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Vt={}}=e,{iconsBaseUrl:hi="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:xi=()=>{}}=e;function gi(){Ve.focus()}function Ai(){Ve.blur()}function ct(G,Ue=!0,Ze=!1){t(1,Ce=G),Ue?(t(15,$e=-1),ut()):(Yt(!Ze,Ze),setTimeout(()=>{Ve.focus(),Ve.select()}))}function It(){t(14,rt=void 0),t(56,we=void 0),t(15,$e=-1)}function Ne(){t(55,xt=[]),t(56,we=void 0)}let je=!1,rt,xt,we,di="",Ve,$e=-1,kt,bn=[],wn,Cn,tr,ir;const Uo=new Set,Ki=Nx();Ox(()=>{$&&($.setEventHandler(void 0),$.indicateReverse(!1),$.setSelectedMarker(-1),$.setFeatures(void 0,void 0,!1))});function ut(G){if(Cn&&(clearTimeout(Cn),Cn=void 0),$e>-1&&rt)t(56,we=rt[$e]),t(1,Ce=we.place_type[0]==="reverse"?we.place_name:we.place_name.replace(/,.*/,"")),t(18,kt=void 0),t(55,xt=void 0),t(15,$e=-1);else if(Ce){const Ue=G||!$n(Ce);xn(Ce,{exact:!0}).then(()=>{t(55,xt=rt),t(56,we=void 0),Ue&&Lo()}).catch(Ze=>t(18,kt=Ze))}}function $n(G){try{return M2(G,6)}catch{return!1}}async function xn(G,{byId:Ue=!1,exact:Ze=!1}={}){t(18,kt=void 0),wn==null||wn.abort();const We=new AbortController;t(19,wn=We);try{const Je=$n(G),ht=new URLSearchParams;if(le!==void 0&&ht.set("language",Array.isArray(le)?le.join(","):le??""),Ft&&ht.set("types",Ft.join(",")),Jt&&ht.set("excludeTypes",String(Jt)),S&&ht.set("bbox",S.map(vi=>vi.toFixed(6)).join(",")),D&&ht.set("country",Array.isArray(D)?D.join(","):D),!Ue&&!Je){const vi=await _2($,te,We);vi&&ht.set("proximity",vi),(Ze||!ft)&&ht.set("autocomplete","false"),ht.set("fuzzyMatch",String(j))}oe!==void 0&&(Pt||!Je||(Ft==null?void 0:Ft.length)===1)&&ht.set("limit",String(oe)),ht.set("key",x),xi(ht);const Rt=ei+"/"+encodeURIComponent(Je?Je.decimalLongitude+","+Je.decimalLatitude:G)+".json?"+ht.toString();if(Rt===di){Ue?(t(14,rt=void 0),t(56,we=bn[0])):t(14,rt=bn);return}di=Rt;const Xt=await fetch(Rt,{signal:We.signal,...Vt});if(!Xt.ok)throw new Error(await Xt.text());const ai=await Xt.json();Ki("response",{url:Rt,featureCollection:ai}),Ue?(t(14,rt=void 0),t(56,we=ai.features[0]),bn=[we]):(t(14,rt=ai.features.filter(N)),Je&&rt.unshift({type:"Feature",properties:{},id:"reverse_"+Je.decimalLongitude+"_"+Je.decimalLatitude,text:Je.decimalLatitude+", "+Je.decimalLongitude,place_name:Je.decimalLatitude+", "+Je.decimalLongitude,place_type:["reverse"],center:[Je.decimalLongitude,Je.decimalLatitude],bbox:[Je.decimalLongitude,Je.decimalLatitude,Je.decimalLongitude,Je.decimalLatitude],geometry:{type:"Point",coordinates:[Je.decimalLongitude,Je.decimalLatitude]}}),bn=rt,Je&&Ve.focus())}catch(Je){if(Je&&typeof Je=="object"&&"name"in Je&&Je.name==="AbortError")return;throw Je}finally{We===wn&&t(19,wn=void 0)}}function Lo(){var G;if(!(xt!=null&&xt.length)||!V)return;const Ue=[180,90,-180,-90],Ze=!xt.some(Je=>!Je.matching_text);let We;for(const Je of xt){const ht=Vi(Je);if(We=We===void 0?ht:ht===void 0?We:Math.max(We,ht),Ze||!Je.matching_text)for(const Rt of[0,1,2,3])Ue[Rt]=Math[Rt<2?"min":"max"](Ue[Rt],((G=Je.bbox)==null?void 0:G[Rt])??Je.center[Rt%2])}$&&xt.length>0&&(we&&Ue[0]===Ue[2]&&Ue[1]===Ue[3]?$.flyTo(we.center,Vi(we)):$.fitBounds(vd(Ue),50,We))}function Vi(G){var Ue;if(!G.bbox||G.bbox[0]!==G.bbox[2]&&G.bbox[1]!==G.bbox[3])return;const Ze=G.id.replace(/\..*/,"");return(Array.isArray((Ue=G.properties)==null?void 0:Ue.categories)?G.properties.categories.reduce((We,Je)=>{const ht=Mt[Ze+"."+Je];return We===void 0?ht:ht===void 0?We:Math.max(We,ht)},void 0):void 0)??Mt[Ze]}function gt(G){t(0,ne=z==="always"),t(14,rt=void 0),t(56,we=void 0),t(15,$e=-1),ct(G[1].toFixed(6)+", "+g2(G[0],[-180,180],!0).toFixed(6),!1,!0)}function ni(G){if(!rt)return;let Ue=G.key==="ArrowDown"?1:G.key==="ArrowUp"?-1:0;Ue&&($e===(ot?0:-1)&&Ue===-1&&t(15,$e=rt.length),t(15,$e+=Ue),$e>=rt.length&&t(15,$e=-1),$e<0&&ot&&t(15,$e=0),G.preventDefault())}function Yt(G=!0,Ue=!1){if(t(18,kt=void 0),ft||Ue){if(Cn&&clearTimeout(Cn),Ce.length<Y)return;const Ze=Ce;Cn=window.setTimeout(()=>{xn(Ze).catch(We=>t(18,kt=We))},G?R:0)}else t(14,rt=void 0),t(18,kt=void 0)}function qi(G){t(56,we=G),t(1,Ce=G.place_name),t(15,$e=-1)}const yr=()=>Ve.focus();function ti(G){op[G?"unshift":"push"](()=>{Ve=G,t(17,Ve)})}function eo(){Ce=this.value,t(1,Ce),t(13,je),t(28,I)}const cn=()=>t(13,je=!0),ge=()=>t(13,je=!1),W=()=>Yt(),X=()=>{t(1,Ce=""),Ve.focus()},ee=()=>t(0,ne=!ne),fe=()=>t(18,kt=void 0),Me=G=>t(15,$e=G),Ie=G=>qi(G),Pe=()=>{ot||t(15,$e=-1)},ke=()=>{};return o.$$set=G=>{"class"in G&&t(2,_=G.class),"apiKey"in G&&t(26,x=G.apiKey),"bbox"in G&&t(27,S=G.bbox),"clearButtonTitle"in G&&t(3,k=G.clearButtonTitle),"clearOnBlur"in G&&t(28,I=G.clearOnBlur),"collapsed"in G&&t(4,P=G.collapsed),"country"in G&&t(29,D=G.country),"debounceSearch"in G&&t(30,R=G.debounceSearch),"enableReverse"in G&&t(5,z=G.enableReverse),"errorMessage"in G&&t(6,B=G.errorMessage),"filter"in G&&t(31,N=G.filter),"flyTo"in G&&t(32,V=G.flyTo),"fuzzyMatch"in G&&t(33,j=G.fuzzyMatch),"language"in G&&t(34,le=G.language),"limit"in G&&t(35,oe=G.limit),"mapController"in G&&t(36,$=G.mapController),"minLength"in G&&t(37,Y=G.minLength),"noResultsMessage"in G&&t(7,ve=G.noResultsMessage),"placeholder"in G&&t(8,Be=G.placeholder),"proximity"in G&&t(38,te=G.proximity),"reverseActive"in G&&t(0,ne=G.reverseActive),"reverseButtonTitle"in G&&t(9,qe=G.reverseButtonTitle),"searchValue"in G&&t(1,Ce=G.searchValue),"pickedResultStyle"in G&&t(39,et=G.pickedResultStyle),"showPlaceType"in G&&t(10,bt=G.showPlaceType),"showResultsWhileTyping"in G&&t(40,ft=G.showResultsWhileTyping),"selectFirst"in G&&t(11,ot=G.selectFirst),"flyToSelected"in G&&t(41,Zt=G.flyToSelected),"markerOnSelected"in G&&t(42,ii=G.markerOnSelected),"types"in G&&t(43,Ft=G.types),"exhaustiveReverseGeocoding"in G&&t(44,Pt=G.exhaustiveReverseGeocoding),"excludeTypes"in G&&t(45,Jt=G.excludeTypes),"zoom"in G&&t(46,Mt=G.zoom),"apiUrl"in G&&t(47,ei=G.apiUrl),"fetchParameters"in G&&t(48,Vt=G.fetchParameters),"iconsBaseUrl"in G&&t(12,hi=G.iconsBaseUrl),"adjustUrlQuery"in G&&t(49,xi=G.adjustUrlQuery),"$$scope"in G&&t(60,f=G.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&32&&t(0,ne=z==="always"),o.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,tr=je),I&&!je&&t(1,Ce="")}),o.$$.dirty[0]&16386|o.$$.dirty[1]&64&&Ce.length<Y&&(t(56,we=void 0),t(14,rt=void 0),t(18,kt=void 0),t(55,xt=rt)),o.$$.dirty[1]&33554688&&et!=="marker-only"&&we&&!we.address&&we.geometry.type==="Point"&&we.place_type[0]!=="reverse"&&xn(we.id,{byId:!0}).catch(G=>t(18,kt=G)),o.$$.dirty[1]&100663330&&($&&we&&we.id!==ir&&V&&(!we.bbox||we.bbox[0]===we.bbox[2]&&we.bbox[1]===we.bbox[3]?$.flyTo(we.center,Vi(we)):$.fitBounds(vd(we.bbox),50,Vi(we)),t(14,rt=void 0),t(55,xt=void 0),t(15,$e=-1)),t(57,ir=we==null?void 0:we.id)),o.$$.dirty[0]&18432&&ot&&rt!=null&&rt.length&&t(15,$e=0),o.$$.dirty[0]&2&&t(15,$e=-1),o.$$.dirty[0]&16384|o.$$.dirty[1]&16777216&&xt!==rt&&t(55,xt=void 0),o.$$.dirty[0]&81921|o.$$.dirty[1]&16777248&&$&&$.setEventHandler(G=>{switch(G.type){case"mapClick":ne&&gt(G.coordinates);break;case"markerClick":{const Ue=rt==null?void 0:rt.find(Ze=>Ze.id===G.id);Ue&&qi(Ue)}break;case"markerMouseEnter":xt&&t(15,$e=tr?(rt==null?void 0:rt.findIndex(Ue=>Ue.id===G.id))??-1:-1);break;case"markerMouseLeave":xt&&t(15,$e=-1);break}}),o.$$.dirty[0]&49152&&t(58,c=rt==null?void 0:rt[$e]),o.$$.dirty[1]&134218786&&$&&c&&V&&Zt&&$.flyTo(c.center,Vi(c)),o.$$.dirty[1]&256&&t(59,n=et==="full-geometry-including-polygon-center-marker"),o.$$.dirty[1]&268437536&&(ii||$==null||$.setFeatures(void 0,void 0,n)),o.$$.dirty[1]&419432480&&$&&ii&&!xt&&($.setFeatures(c?[c]:void 0,void 0,n),$.setSelectedMarker(c?0:-1)),o.$$.dirty[1]&318767136&&$&&$.setFeatures(xt,we,n),o.$$.dirty[0]&32768|o.$$.dirty[1]&16777248&&xt&&$&&$.setSelectedMarker($e),o.$$.dirty[0]&2|o.$$.dirty[1]&32&&$){const G=$n(Ce);$.setReverseMarker(G?[G.decimalLongitude,G.decimalLatitude]:void 0)}o.$$.dirty[1]&134217728&&Ki("select",{feature:c}),o.$$.dirty[1]&33554432&&Ki("pick",{feature:we}),o.$$.dirty[0]&81920&&Ki("optionsvisibilitychange",{optionsVisible:tr&&!!rt}),o.$$.dirty[0]&16384&&Ki("featureslisted",{features:rt}),o.$$.dirty[1]&16777216&&Ki("featuresmarked",{features:xt}),o.$$.dirty[0]&1&&Ki("reversetoggle",{reverse:ne}),o.$$.dirty[0]&2&&Ki("querychange",{query:Ce}),o.$$.dirty[0]&1|o.$$.dirty[1]&32&&$&&$.indicateReverse(ne)},[ne,Ce,_,k,P,z,B,ve,Be,qe,bt,ot,hi,je,rt,$e,tr,Ve,kt,wn,Uo,ut,ni,Yt,qi,a,x,S,I,D,R,N,V,j,le,oe,$,Y,te,et,ft,Zt,ii,Ft,Pt,Jt,Mt,ei,Vt,xi,gi,Ai,ct,It,Ne,xt,we,ir,c,n,f,u,yr,ti,eo,cn,ge,W,X,ee,fe,Me,Ie,Pe,ke]}let R2=class extends oa{constructor(o){super(),ra(this,o,D2,z2,na,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}};function Du(o,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=o,n}function Bp(o,e,t={}){for(const n of o){if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(n[n.length-1].length!==n[0].length)throw new Error("First and last Position are not equivalent.");for(let c=0;c<n[n.length-1].length;c++)if(n[n.length-1][c]!==n[0][c])throw new Error("First and last Position are not equivalent.")}return Du({type:"Polygon",coordinates:o},e,t)}function Ru(o,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=o,t}function A0(o,e,t={}){return Du({type:"MultiPolygon",coordinates:o},e,t)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function B2(o,e){var t={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},n,c,u,f;return f={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function a(x){return function(S){return _([x,S])}}function _(x){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,c&&(u=x[0]&2?c.return:x[0]?c.throw||((u=c.return)&&u.call(c),0):c.next)&&!(u=u.call(c,x[1])).done)return u;switch(c=0,u&&(x=[x[0]&2,u.value]),x[0]){case 0:case 1:u=x;break;case 4:return t.label++,{value:x[1],done:!1};case 5:t.label++,c=x[1],x=[0];continue;case 7:x=t.ops.pop(),t.trys.pop();continue;default:if(u=t.trys,!(u=u.length>0&&u[u.length-1])&&(x[0]===6||x[0]===2)){t=0;continue}if(x[0]===3&&(!u||x[1]>u[0]&&x[1]<u[3])){t.label=x[1];break}if(x[0]===6&&t.label<u[1]){t.label=u[1],u=x;break}if(u&&t.label<u[2]){t.label=u[2],t.ops.push(x);break}u[2]&&t.ops.pop(),t.trys.pop();continue}x=e.call(o,t)}catch(S){x=[6,S],c=0}finally{n=u=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}var ia=function(){function o(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return o}();function F2(o,e){return o>e?1:o<e?-1:0}function Ks(o,e,t){for(var n=new ia(null,null),c=n,u=n;;){var f=t(o,e.key);if(f<0){if(e.left===null)break;if(t(o,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}u.left=e,u=e,e=e.left}else if(f>0){if(e.right===null)break;if(t(o,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}c.right=e,c=e,e=e.right}else break}return c.right=e.left,u.left=e.right,e.left=n.right,e.right=n.left,e}function Vf(o,e,t,n){var c=new ia(o,e);if(t===null)return c.left=c.right=null,c;t=Ks(o,t,n);var u=n(o,t.key);return u<0?(c.left=t.left,c.right=t,t.left=null):u>=0&&(c.right=t.right,c.left=t,t.right=null),c}function s_(o,e,t){var n=null,c=null;if(e){e=Ks(o,e,t);var u=t(e.key,o);u===0?(n=e.left,c=e.right):u<0?(c=e.right,e.right=null,n=e):(n=e.left,e.left=null,c=e)}return{left:n,right:c}}function O2(o,e,t){return e===null?o:(o===null||(e=Ks(o.key,e,t),e.left=o),e)}function lp(o,e,t,n,c){if(o){n(""+e+(t?" ":" ")+c(o)+`
`);var u=e+(t?"    ":"   ");o.left&&lp(o.left,u,!1,n,c),o.right&&lp(o.right,u,!0,n,c)}}var Fp=function(){function o(e){e===void 0&&(e=F2),this._root=null,this._size=0,this._comparator=e}return o.prototype.insert=function(e,t){return this._size++,this._root=Vf(e,t,this._root,this._comparator)},o.prototype.add=function(e,t){var n=new ia(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var c=this._comparator,u=Ks(e,this._root,c),f=c(e,u.key);return f===0?this._root=u:(f<0?(n.left=u.left,n.right=u,u.left=null):f>0&&(n.right=u.right,n.left=u,u.right=null),this._size++,this._root=n),this._root},o.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},o.prototype._remove=function(e,t,n){var c;if(t===null)return null;t=Ks(e,t,n);var u=n(e,t.key);return u===0?(t.left===null?c=t.right:(c=Ks(e,t.left,n),c.right=t.right),this._size--,c):t},o.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Ks(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},o.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var c=n(e,t.key);if(c===0)return t;c<0?t=t.left:t=t.right}return null},o.prototype.find=function(e){return this._root&&(this._root=Ks(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},o.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var c=n(e,t.key);if(c===0)return!0;c<0?t=t.left:t=t.right}return!1},o.prototype.forEach=function(e,t){for(var n=this._root,c=[],u=!1;!u;)n!==null?(c.push(n),n=n.left):c.length!==0?(n=c.pop(),e.call(t,n),n=n.right):u=!0;return this},o.prototype.range=function(e,t,n,c){for(var u=[],f=this._comparator,a=this._root,_;u.length!==0||a;)if(a)u.push(a),a=a.left;else{if(a=u.pop(),_=f(a.key,t),_>0)break;if(f(a.key,e)>=0&&n.call(c,a))return this;a=a.right}return this},o.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},o.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},o.prototype.min=function(){return this._root?this.minNode(this._root).key:null},o.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},o.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},o.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},o.prototype.at=function(e){for(var t=this._root,n=!1,c=0,u=[];!n;)if(t)u.push(t),t=t.left;else if(u.length>0){if(t=u.pop(),c===e)return t;c++,t=t.right}else n=!0;return null},o.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var c=this._comparator;t;){var u=c(e.key,t.key);if(u===0)break;u<0?(n=t,t=t.left):t=t.right}return n},o.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var c=this._comparator;t;){var u=c(e.key,t.key);if(u===0)break;u<0?t=t.left:(n=t,t=t.right)}return n},o.prototype.clear=function(){return this._root=null,this._size=0,this},o.prototype.toList=function(){return j2(this._root)},o.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var c=e.length,u=this._comparator;if(n&&hp(e,t,0,c-1,u),this._root===null)this._root=cp(e,t,0,c),this._size=c;else{var f=U2(this.toList(),N2(e,t),u);c=this._size+c,this._root=up({head:f},0,c)}return this},o.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(o.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),o.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return lp(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},o.prototype.update=function(e,t,n){var c=this._comparator,u=s_(e,this._root,c),f=u.left,a=u.right;c(e,t)<0?a=Vf(t,n,a,c):f=Vf(t,n,f,c),this._root=O2(f,a,c)},o.prototype.split=function(e){return s_(e,this._root,this._comparator)},o.prototype[Symbol.iterator]=function(){var e,t,n;return B2(this,function(c){switch(c.label){case 0:e=this._root,t=[],n=!1,c.label=1;case 1:return n?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return c.sent(),e=e.right,[3,5];case 4:n=!0,c.label=5;case 5:return[3,1];case 6:return[2]}})},o}();function cp(o,e,t,n){var c=n-t;if(c>0){var u=t+Math.floor(c/2),f=o[u],a=e[u],_=new ia(f,a);return _.left=cp(o,e,t,u),_.right=cp(o,e,u+1,n),_}return null}function N2(o,e){for(var t=new ia(null,null),n=t,c=0;c<o.length;c++)n=n.next=new ia(o[c],e[c]);return n.next=null,t.next}function j2(o){for(var e=o,t=[],n=!1,c=new ia(null,null),u=c;!n;)e?(t.push(e),e=e.left):t.length>0?(e=u=u.next=t.pop(),e=e.right):n=!0;return u.next=null,c.next}function up(o,e,t){var n=t-e;if(n>0){var c=e+Math.floor(n/2),u=up(o,e,c),f=o.head;return f.left=u,o.head=o.head.next,f.right=up(o,c+1,t),f}return null}function U2(o,e,t){for(var n=new ia(null,null),c=n,u=o,f=e;u!==null&&f!==null;)t(u.key,f.key)<0?(c.next=u,u=u.next):(c.next=f,f=f.next),c=c.next;return u!==null?c.next=u:f!==null&&(c.next=f),n.next}function hp(o,e,t,n,c){if(!(t>=n)){for(var u=o[t+n>>1],f=t-1,a=n+1;;){do f++;while(c(o[f],u)<0);do a--;while(c(o[a],u)>0);if(f>=a)break;var _=o[f];o[f]=o[a],o[a]=_,_=e[f],e[f]=e[a],e[a]=_}hp(o,e,t,a,c),hp(o,e,a+1,n,c)}}const ks=11102230246251565e-32,Mr=134217729,V2=(3+8*ks)*ks;function qf(o,e,t,n,c){let u,f,a,_,x=e[0],S=n[0],k=0,I=0;S>x==S>-x?(u=x,x=e[++k]):(u=S,S=n[++I]);let P=0;if(k<o&&I<t)for(S>x==S>-x?(f=x+u,a=u-(f-x),x=e[++k]):(f=S+u,a=u-(f-S),S=n[++I]),u=f,a!==0&&(c[P++]=a);k<o&&I<t;)S>x==S>-x?(f=u+x,_=f-u,a=u-(f-_)+(x-_),x=e[++k]):(f=u+S,_=f-u,a=u-(f-_)+(S-_),S=n[++I]),u=f,a!==0&&(c[P++]=a);for(;k<o;)f=u+x,_=f-u,a=u-(f-_)+(x-_),x=e[++k],u=f,a!==0&&(c[P++]=a);for(;I<t;)f=u+S,_=f-u,a=u-(f-_)+(S-_),S=n[++I],u=f,a!==0&&(c[P++]=a);return(u!==0||P===0)&&(c[P++]=u),P}function q2(o,e){let t=e[0];for(let n=1;n<o;n++)t+=e[n];return t}function Vu(o){return new Float64Array(o)}const Z2=(3+16*ks)*ks,G2=(2+12*ks)*ks,W2=(9+64*ks)*ks*ks,Ul=Vu(4),a_=Vu(8),l_=Vu(12),c_=Vu(16),Ur=Vu(4);function H2(o,e,t,n,c,u,f){let a,_,x,S,k,I,P,D,R,z,B,N,V,j,le,oe,$,Y;const ve=o-c,Be=t-c,te=e-u,ne=n-u;j=ve*ne,I=Mr*ve,P=I-(I-ve),D=ve-P,I=Mr*ne,R=I-(I-ne),z=ne-R,le=D*z-(j-P*R-D*R-P*z),oe=te*Be,I=Mr*te,P=I-(I-te),D=te-P,I=Mr*Be,R=I-(I-Be),z=Be-R,$=D*z-(oe-P*R-D*R-P*z),B=le-$,k=le-B,Ul[0]=le-(B+k)+(k-$),N=j+B,k=N-j,V=j-(N-k)+(B-k),B=V-oe,k=V-B,Ul[1]=V-(B+k)+(k-oe),Y=N+B,k=Y-N,Ul[2]=N-(Y-k)+(B-k),Ul[3]=Y;let qe=q2(4,Ul),Ce=G2*f;if(qe>=Ce||-qe>=Ce||(k=o-ve,a=o-(ve+k)+(k-c),k=t-Be,x=t-(Be+k)+(k-c),k=e-te,_=e-(te+k)+(k-u),k=n-ne,S=n-(ne+k)+(k-u),a===0&&_===0&&x===0&&S===0)||(Ce=W2*f+V2*Math.abs(qe),qe+=ve*S+ne*a-(te*x+Be*_),qe>=Ce||-qe>=Ce))return qe;j=a*ne,I=Mr*a,P=I-(I-a),D=a-P,I=Mr*ne,R=I-(I-ne),z=ne-R,le=D*z-(j-P*R-D*R-P*z),oe=_*Be,I=Mr*_,P=I-(I-_),D=_-P,I=Mr*Be,R=I-(I-Be),z=Be-R,$=D*z-(oe-P*R-D*R-P*z),B=le-$,k=le-B,Ur[0]=le-(B+k)+(k-$),N=j+B,k=N-j,V=j-(N-k)+(B-k),B=V-oe,k=V-B,Ur[1]=V-(B+k)+(k-oe),Y=N+B,k=Y-N,Ur[2]=N-(Y-k)+(B-k),Ur[3]=Y;const et=qf(4,Ul,4,Ur,a_);j=ve*S,I=Mr*ve,P=I-(I-ve),D=ve-P,I=Mr*S,R=I-(I-S),z=S-R,le=D*z-(j-P*R-D*R-P*z),oe=te*x,I=Mr*te,P=I-(I-te),D=te-P,I=Mr*x,R=I-(I-x),z=x-R,$=D*z-(oe-P*R-D*R-P*z),B=le-$,k=le-B,Ur[0]=le-(B+k)+(k-$),N=j+B,k=N-j,V=j-(N-k)+(B-k),B=V-oe,k=V-B,Ur[1]=V-(B+k)+(k-oe),Y=N+B,k=Y-N,Ur[2]=N-(Y-k)+(B-k),Ur[3]=Y;const bt=qf(et,a_,4,Ur,l_);j=a*S,I=Mr*a,P=I-(I-a),D=a-P,I=Mr*S,R=I-(I-S),z=S-R,le=D*z-(j-P*R-D*R-P*z),oe=_*x,I=Mr*_,P=I-(I-_),D=_-P,I=Mr*x,R=I-(I-x),z=x-R,$=D*z-(oe-P*R-D*R-P*z),B=le-$,k=le-B,Ur[0]=le-(B+k)+(k-$),N=j+B,k=N-j,V=j-(N-k)+(B-k),B=V-oe,k=V-B,Ur[1]=V-(B+k)+(k-oe),Y=N+B,k=Y-N,Ur[2]=N-(Y-k)+(B-k),Ur[3]=Y;const ft=qf(bt,l_,4,Ur,c_);return c_[ft-1]}function $2(o,e,t,n,c,u){const f=(e-u)*(t-c),a=(o-c)*(n-u),_=f-a,x=Math.abs(f+a);return Math.abs(_)>=Z2*x?_:-H2(o,e,t,n,c,u,x)}const lu=(o,e)=>o.ll.x<=e.x&&e.x<=o.ur.x&&o.ll.y<=e.y&&e.y<=o.ur.y,dp=(o,e)=>{if(e.ur.x<o.ll.x||o.ur.x<e.ll.x||e.ur.y<o.ll.y||o.ur.y<e.ll.y)return null;const t=o.ll.x<e.ll.x?e.ll.x:o.ll.x,n=o.ur.x<e.ur.x?o.ur.x:e.ur.x,c=o.ll.y<e.ll.y?e.ll.y:o.ll.y,u=o.ur.y<e.ur.y?o.ur.y:e.ur.y;return{ll:{x:t,y:c},ur:{x:n,y:u}}};let Ys=Number.EPSILON;Ys===void 0&&(Ys=Math.pow(2,-52));const X2=Ys*Ys,u_=(o,e)=>{if(-Ys<o&&o<Ys&&-Ys<e&&e<Ys)return 0;const t=o-e;return t*t<X2*o*e?0:o<e?-1:1};class K2{constructor(){this.reset()}reset(){this.xRounder=new h_,this.yRounder=new h_}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class h_{constructor(){this.tree=new Fp,this.round(0)}round(e){const t=this.tree.add(e),n=this.tree.prev(t);if(n!==null&&u_(t.key,n.key)===0)return this.tree.remove(e),n.key;const c=this.tree.next(t);return c!==null&&u_(t.key,c.key)===0?(this.tree.remove(e),c.key):e}}const Bu=new K2,ud=(o,e)=>o.x*e.y-o.y*e.x,P0=(o,e)=>o.x*e.x+o.y*e.y,d_=(o,e,t)=>{const n=$2(o.x,o.y,e.x,e.y,t.x,t.y);return n>0?-1:n<0?1:0},bd=o=>Math.sqrt(P0(o,o)),J2=(o,e,t)=>{const n={x:e.x-o.x,y:e.y-o.y},c={x:t.x-o.x,y:t.y-o.y};return ud(c,n)/bd(c)/bd(n)},Y2=(o,e,t)=>{const n={x:e.x-o.x,y:e.y-o.y},c={x:t.x-o.x,y:t.y-o.y};return P0(c,n)/bd(c)/bd(n)},f_=(o,e,t)=>e.y===0?null:{x:o.x+e.x/e.y*(t-o.y),y:t},p_=(o,e,t)=>e.x===0?null:{x:t,y:o.y+e.y/e.x*(t-o.x)},Q2=(o,e,t,n)=>{if(e.x===0)return p_(t,n,o.x);if(n.x===0)return p_(o,e,t.x);if(e.y===0)return f_(t,n,o.y);if(n.y===0)return f_(o,e,t.y);const c=ud(e,n);if(c==0)return null;const u={x:t.x-o.x,y:t.y-o.y},f=ud(u,e)/c,a=ud(u,n)/c,_=o.x+a*e.x,x=t.x+f*n.x,S=o.y+a*e.y,k=t.y+f*n.y,I=(_+x)/2,P=(S+k)/2;return{x:I,y:P}};class To{static compare(e,t){const n=To.comparePoints(e.point,t.point);return n!==0?n:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Qs.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let n=0,c=t.length;n<c;n++){const u=t[n];this.point.events.push(u),u.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const n=this.point.events[t];if(n.segment.consumedBy===void 0)for(let c=t+1;c<e;c++){const u=this.point.events[c];u.consumedBy===void 0&&n.otherSE.point.events===u.otherSE.point.events&&n.segment.consume(u.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,n=this.point.events.length;t<n;t++){const c=this.point.events[t];c!==this&&!c.segment.ringOut&&c.segment.isInResult()&&e.push(c)}return e}getLeftmostComparator(e){const t=new Map,n=c=>{const u=c.otherSE;t.set(c,{sine:J2(this.point,e.point,u.point),cosine:Y2(this.point,e.point,u.point)})};return(c,u)=>{t.has(c)||n(c),t.has(u)||n(u);const{sine:f,cosine:a}=t.get(c),{sine:_,cosine:x}=t.get(u);return f>=0&&_>=0?a<x?1:a>x?-1:0:f<0&&_<0?a<x?-1:a>x?1:0:_<f?-1:_>f?1:0}}}let ek=0;class Qs{static compare(e,t){const n=e.leftSE.point.x,c=t.leftSE.point.x,u=e.rightSE.point.x,f=t.rightSE.point.x;if(f<n)return 1;if(u<c)return-1;const a=e.leftSE.point.y,_=t.leftSE.point.y,x=e.rightSE.point.y,S=t.rightSE.point.y;if(n<c){if(_<a&&_<x)return 1;if(_>a&&_>x)return-1;const k=e.comparePoint(t.leftSE.point);if(k<0)return 1;if(k>0)return-1;const I=t.comparePoint(e.rightSE.point);return I!==0?I:-1}if(n>c){if(a<_&&a<S)return-1;if(a>_&&a>S)return 1;const k=t.comparePoint(e.leftSE.point);if(k!==0)return k;const I=e.comparePoint(t.rightSE.point);return I<0?1:I>0?-1:1}if(a<_)return-1;if(a>_)return 1;if(u<f){const k=t.comparePoint(e.rightSE.point);if(k!==0)return k}if(u>f){const k=e.comparePoint(t.rightSE.point);if(k<0)return 1;if(k>0)return-1}if(u!==f){const k=x-a,I=u-n,P=S-_,D=f-c;if(k>I&&P<D)return 1;if(k<I&&P>D)return-1}return u>f?1:u<f||x<S?-1:x>S?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,n,c){this.id=++ek,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=c}static fromRing(e,t,n){let c,u,f;const a=To.comparePoints(e,t);if(a<0)c=e,u=t,f=1;else if(a>0)c=t,u=e,f=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const _=new To(c,!0),x=new To(u,!1);return new Qs(_,x,[n],[f])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,n=this.rightSE.point,c=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;const u=(e.y-t.y)/c.y,f=t.x+u*c.x;if(e.x===f)return 0;const a=(e.x-t.x)/c.x,_=t.y+a*c.y;return e.y===_?0:e.y<_?-1:1}getIntersection(e){const t=this.bbox(),n=e.bbox(),c=dp(t,n);if(c===null)return null;const u=this.leftSE.point,f=this.rightSE.point,a=e.leftSE.point,_=e.rightSE.point,x=lu(t,a)&&this.comparePoint(a)===0,S=lu(n,u)&&e.comparePoint(u)===0,k=lu(t,_)&&this.comparePoint(_)===0,I=lu(n,f)&&e.comparePoint(f)===0;if(S&&x)return I&&!k?f:!I&&k?_:null;if(S)return k&&u.x===_.x&&u.y===_.y?null:u;if(x)return I&&f.x===a.x&&f.y===a.y?null:a;if(I&&k)return null;if(I)return f;if(k)return _;const P=Q2(u,this.vector(),a,e.vector());return P===null||!lu(c,P)?null:Bu.round(P.x,P.y)}split(e){const t=[],n=e.events!==void 0,c=new To(e,!0),u=new To(e,!1),f=this.rightSE;this.replaceRightSE(u),t.push(u),t.push(c);const a=new Qs(c,f,this.rings.slice(),this.windings.slice());return To.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),To.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(c.checkForConsuming(),u.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}consume(e){let t=this,n=e;for(;t.consumedBy;)t=t.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const c=Qs.compare(t,n);if(c!==0){if(c>0){const u=t;t=n,n=u}if(t.prev===n){const u=t;t=n,n=u}for(let u=0,f=n.rings.length;u<f;u++){const a=n.rings[u],_=n.windings[u],x=t.rings.indexOf(a);x===-1?(t.rings.push(a),t.windings.push(_)):t.windings[x]+=_}n.rings=null,n.windings=null,n.consumedBy=t,n.leftSE.consumedBy=t.leftSE,n.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,n=this._afterState.windings,c=this._afterState.multiPolys;for(let a=0,_=this.rings.length;a<_;a++){const x=this.rings[a],S=this.windings[a],k=t.indexOf(x);k===-1?(t.push(x),n.push(S)):n[k]+=S}const u=[],f=[];for(let a=0,_=t.length;a<_;a++){if(n[a]===0)continue;const x=t[a],S=x.poly;if(f.indexOf(S)===-1)if(x.isExterior)u.push(S);else{f.indexOf(S)===-1&&f.push(S);const k=u.indexOf(x.poly);k!==-1&&u.splice(k,1)}}for(let a=0,_=u.length;a<_;a++){const x=u[a].multiPoly;c.indexOf(x)===-1&&c.push(x)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(Oo.type){case"union":{const n=e.length===0,c=t.length===0;this._isInResult=n!==c;break}case"intersection":{let n,c;e.length<t.length?(n=e.length,c=t.length):(n=t.length,c=e.length),this._isInResult=c===Oo.numMultiPolys&&n<c;break}case"xor":{const n=Math.abs(e.length-t.length);this._isInResult=n%2===1;break}case"difference":{const n=c=>c.length===1&&c[0].isSubject;this._isInResult=n(e)!==n(t);break}default:throw new Error(`Unrecognized operation type found ${Oo.type}`)}return this._isInResult}}class m_{constructor(e,t,n){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const c=Bu.round(e[0][0],e[0][1]);this.bbox={ll:{x:c.x,y:c.y},ur:{x:c.x,y:c.y}};let u=c;for(let f=1,a=e.length;f<a;f++){if(typeof e[f][0]!="number"||typeof e[f][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let _=Bu.round(e[f][0],e[f][1]);_.x===u.x&&_.y===u.y||(this.segments.push(Qs.fromRing(u,_,this)),_.x<this.bbox.ll.x&&(this.bbox.ll.x=_.x),_.y<this.bbox.ll.y&&(this.bbox.ll.y=_.y),_.x>this.bbox.ur.x&&(this.bbox.ur.x=_.x),_.y>this.bbox.ur.y&&(this.bbox.ur.y=_.y),u=_)}(c.x!==u.x||c.y!==u.y)&&this.segments.push(Qs.fromRing(u,c,this))}getSweepEvents(){const e=[];for(let t=0,n=this.segments.length;t<n;t++){const c=this.segments[t];e.push(c.leftSE),e.push(c.rightSE)}return e}}class tk{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new m_(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,c=e.length;n<c;n++){const u=new m_(e[n],this,!1);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.interiorRings.push(u)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,n=this.interiorRings.length;t<n;t++){const c=this.interiorRings[t].getSweepEvents();for(let u=0,f=c.length;u<f;u++)e.push(c[u])}return e}}class g_{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let n=0,c=e.length;n<c;n++){const u=new tk(e[n],this);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.polys.push(u)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const c=this.polys[t].getSweepEvents();for(let u=0,f=c.length;u<f;u++)e.push(c[u])}return e}}class wd{static factory(e){const t=[];for(let n=0,c=e.length;n<c;n++){const u=e[n];if(!u.isInResult()||u.ringOut)continue;let f=null,a=u.leftSE,_=u.rightSE;const x=[a],S=a.point,k=[];for(;f=a,a=_,x.push(a),a.point!==S;)for(;;){const I=a.getAvailableLinkedEvents();if(I.length===0){const R=x[0].point,z=x[x.length-1].point;throw new Error(`Unable to complete output ring starting at [${R.x}, ${R.y}]. Last matching segment found ends at [${z.x}, ${z.y}].`)}if(I.length===1){_=I[0].otherSE;break}let P=null;for(let R=0,z=k.length;R<z;R++)if(k[R].point===a.point){P=R;break}if(P!==null){const R=k.splice(P)[0],z=x.splice(R.index);z.unshift(z[0].otherSE),t.push(new wd(z.reverse()));continue}k.push({index:x.length,point:a.point});const D=a.getLeftmostComparator(f);_=I.sort(D)[0].otherSE;break}t.push(new wd(x))}return t}constructor(e){this.events=e;for(let t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let x=1,S=this.events.length-1;x<S;x++){const k=this.events[x].point,I=this.events[x+1].point;d_(k,e,I)!==0&&(t.push(k),e=k)}if(t.length===1)return null;const n=t[0],c=t[1];d_(n,e,c)===0&&t.shift(),t.push(t[0]);const u=this.isExteriorRing()?1:-1,f=this.isExteriorRing()?0:t.length-1,a=this.isExteriorRing()?t.length:-1,_=[];for(let x=f;x!=a;x+=u)_.push([t[x].x,t[x].y]);return _}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let c=1,u=this.events.length;c<u;c++){const f=this.events[c];To.compare(e,f)>0&&(e=f)}let t=e.segment.prevInResult(),n=t?t.prevInResult():null;for(;;){if(!t)return null;if(!n)return t.ringOut;if(n.ringOut!==t.ringOut)return n.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=n.prevInResult(),n=t?t.prevInResult():null}}}class __{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,n=this.interiorRings.length;t<n;t++){const c=this.interiorRings[t].getGeom();c!==null&&e.push(c)}return e}}class ik{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const c=this.polys[t].getGeom();c!==null&&e.push(c)}return e}_composePolys(e){const t=[];for(let n=0,c=e.length;n<c;n++){const u=e[n];if(!u.poly)if(u.isExteriorRing())t.push(new __(u));else{const f=u.enclosingRing();f.poly||t.push(new __(f)),f.poly.addInterior(u)}}return t}}class nk{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Qs.compare;this.queue=e,this.tree=new Fp(t),this.segments=[]}process(e){const t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;const c=e.isLeft?this.tree.add(t):this.tree.find(t);if(!c)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let u=c,f=c,a,_;for(;a===void 0;)u=this.tree.prev(u),u===null?a=null:u.key.consumedBy===void 0&&(a=u.key);for(;_===void 0;)f=this.tree.next(f),f===null?_=null:f.key.consumedBy===void 0&&(_=f.key);if(e.isLeft){let x=null;if(a){const k=a.getIntersection(t);if(k!==null&&(t.isAnEndpoint(k)||(x=k),!a.isAnEndpoint(k))){const I=this._splitSafely(a,k);for(let P=0,D=I.length;P<D;P++)n.push(I[P])}}let S=null;if(_){const k=_.getIntersection(t);if(k!==null&&(t.isAnEndpoint(k)||(S=k),!_.isAnEndpoint(k))){const I=this._splitSafely(_,k);for(let P=0,D=I.length;P<D;P++)n.push(I[P])}}if(x!==null||S!==null){let k=null;x===null?k=S:S===null?k=x:k=To.comparePoints(x,S)<=0?x:S,this.queue.remove(t.rightSE),n.push(t.rightSE);const I=t.split(k);for(let P=0,D=I.length;P<D;P++)n.push(I[P])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&_){const x=a.getIntersection(_);if(x!==null){if(!a.isAnEndpoint(x)){const S=this._splitSafely(a,x);for(let k=0,I=S.length;k<I;k++)n.push(S[k])}if(!_.isAnEndpoint(x)){const S=this._splitSafely(_,x);for(let k=0,I=S.length;k<I;k++)n.push(S[k])}}}this.tree.remove(t)}return n}_splitSafely(e,t){this.tree.remove(e);const n=e.rightSE;this.queue.remove(n);const c=e.split(t);return c.push(n),e.consumedBy===void 0&&this.tree.add(e),c}}const y_=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,rk=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class ok{run(e,t,n){Oo.type=e,Bu.reset();const c=[new g_(t,!0)];for(let S=0,k=n.length;S<k;S++)c.push(new g_(n[S],!1));if(Oo.numMultiPolys=c.length,Oo.type==="difference"){const S=c[0];let k=1;for(;k<c.length;)dp(c[k].bbox,S.bbox)!==null?k++:c.splice(k,1)}if(Oo.type==="intersection")for(let S=0,k=c.length;S<k;S++){const I=c[S];for(let P=S+1,D=c.length;P<D;P++)if(dp(I.bbox,c[P].bbox)===null)return[]}const u=new Fp(To.compare);for(let S=0,k=c.length;S<k;S++){const I=c[S].getSweepEvents();for(let P=0,D=I.length;P<D;P++)if(u.insert(I[P]),u.size>y_)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const f=new nk(u);let a=u.size,_=u.pop();for(;_;){const S=_.key;if(u.size===a){const I=S.segment;throw new Error(`Unable to pop() ${S.isLeft?"left":"right"} SweepEvent [${S.point.x}, ${S.point.y}] from segment #${I.id} [${I.leftSE.point.x}, ${I.leftSE.point.y}] -> [${I.rightSE.point.x}, ${I.rightSE.point.y}] from queue.`)}if(u.size>y_)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(f.segments.length>rk)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const k=f.process(S);for(let I=0,P=k.length;I<P;I++){const D=k[I];D.consumedBy===void 0&&u.insert(D)}a=u.size,_=u.pop()}Bu.reset();const x=wd.factory(f.segments);return new ik(x).getGeom()}}const Oo=new ok,sk=function(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Oo.run("union",o,t)},ak=function(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Oo.run("intersection",o,t)},lk=function(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Oo.run("xor",o,t)},ck=function(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Oo.run("difference",o,t)};var z0={union:sk,intersection:ak,xor:lk,difference:ck};function D0(o,e,t){if(o!==null)for(var n,c,u,f,a,_,x,S=0,k=0,I,P=o.type,D=P==="FeatureCollection",R=P==="Feature",z=D?o.features.length:1,B=0;B<z;B++){x=D?o.features[B].geometry:R?o.geometry:o,I=x?x.type==="GeometryCollection":!1,a=I?x.geometries.length:1;for(var N=0;N<a;N++){var V=0,j=0;if(f=I?x.geometries[N]:x,f!==null){_=f.coordinates;var le=f.type;switch(S=0,le){case null:break;case"Point":if(e(_,k,B,V,j)===!1)return!1;k++,V++;break;case"LineString":case"MultiPoint":for(n=0;n<_.length;n++){if(e(_[n],k,B,V,j)===!1)return!1;k++,le==="MultiPoint"&&V++}le==="LineString"&&V++;break;case"Polygon":case"MultiLineString":for(n=0;n<_.length;n++){for(c=0;c<_[n].length-S;c++){if(e(_[n][c],k,B,V,j)===!1)return!1;k++}le==="MultiLineString"&&V++,le==="Polygon"&&j++}le==="Polygon"&&V++;break;case"MultiPolygon":for(n=0;n<_.length;n++){for(j=0,c=0;c<_[n].length;c++){for(u=0;u<_[n][c].length-S;u++){if(e(_[n][c][u],k,B,V,j)===!1)return!1;k++}j++}V++}break;case"GeometryCollection":for(n=0;n<f.geometries.length;n++)if(D0(f.geometries[n],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Op(o,e){var t,n,c,u,f,a,_,x,S,k,I=0,P=o.type==="FeatureCollection",D=o.type==="Feature",R=P?o.features.length:1;for(t=0;t<R;t++){for(a=P?o.features[t].geometry:D?o.geometry:o,x=P?o.features[t].properties:D?o.properties:{},S=P?o.features[t].bbox:D?o.bbox:void 0,k=P?o.features[t].id:D?o.id:void 0,_=a?a.type==="GeometryCollection":!1,f=_?a.geometries.length:1,c=0;c<f;c++){if(u=_?a.geometries[c]:a,u===null){if(e(null,I,x,S,k)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(u,I,x,S,k)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<u.geometries.length;n++)if(e(u.geometries[n],I,x,S,k)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}I++}}function uk(o,e){Op(o,function(t,n,c,u,f){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(Du(t,c,{bbox:u,id:f}),n,0)===!1?!1:void 0}var _;switch(a){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var x=0;x<t.coordinates.length;x++){var S=t.coordinates[x],k={type:_,coordinates:S};if(e(Du(k,c),n,x)===!1)return!1}})}function hk(o,e={}){const t=[];if(Op(o,c=>{t.push(c.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const n=z0.union(t[0],...t.slice(1));return n.length===0?null:n.length===1?Bp(n[0],e.properties):A0(n,e.properties)}var R0=hk;function dk(o,e={}){if(o.bbox!=null&&e.recompute!==!0)return o.bbox;const t=[1/0,1/0,-1/0,-1/0];return D0(o,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var v_=dk;function fk(o){const e=[];if(Op(o,c=>{e.push(c.coordinates)}),e.length<2)throw new Error("Must have at least two features");const t=o.features[0].properties||{},n=z0.difference(e[0],...e.slice(1));return n.length===0?null:n.length===1?Bp(n[0],t):A0(n,t)}var pk=fk;function mk(o){if(!o)throw new Error("geojson is required");var e=[];return uk(o,function(t){e.push(t)}),Ru(e)}var gk=mk;function b_(o,e){const t=pk(Ru([Bp([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),o]));if(!t)return;t.properties={isMask:!0};const n=vd(v_(o)),c=(n[2]-n[0])/360/1e3,u=n[0]<-180,f=n[2]>180,a=gk(o);if(a.features.length>1&&(u||f))for(const _ of a.features){const x=vd(v_(_));if(f&&x[0]<-180+c)for(const S of _.geometry.coordinates)for(const k of S)k[0]+=360-c;if(u&&x[2]>180-c)for(const S of _.geometry.coordinates)for(const k of S)k[0]-=360-c}e(Ru([a.features.length<2?o:R0(a)??o,t]))}const w_={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},td="mtlr-gc-full-geom",x_="mtlr-gc-full-geom-fill",k_="mtlr-gc-full-geom-line";function B0(o,e,t=!0,n=!0,c={},u={},f=w_){let a;const _=[];let x,S,k;function I(){if(!o.loaded){o.once("load",I);return}const z=f?f===!0?w_:f:void 0;if(!(z!=null&&z.fill)&&!(z!=null&&z.line))return;const B=o.getSource(td);if(B)B.setData(k??Ru([]));else if(k)o.addSource(td,{type:"geojson",data:k});else return;!o.getLayer(x_)&&z!=null&&z.fill&&o.addLayer({...z==null?void 0:z.fill,id:x_,type:"fill",source:td}),!o.getLayer(k_)&&z!=null&&z.line&&o.addLayer({...z==null?void 0:z.line,id:k_,type:"line",source:td})}function P(z){k=z,I()}o.on("styledata",()=>{setTimeout(()=>{k&&I()})});const D=z=>{a==null||a({type:"mapClick",coordinates:[z.lngLat.lng,z.lngLat.lat]})};function R(z=!1){if(!e)throw new Error;const B=document.createElement("div");return z&&B.classList.add("marker-interactive"),new h2({props:{displayIn:"maplibre"},target:B}),new e.Marker({element:B,offset:[1,-13]})}return{setEventHandler(z){z?(a=z,o.on("click",D)):(a=void 0,o.off("click",D))},flyTo(z,B){o.flyTo({center:z,...B?{zoom:B}:{},...c})},fitBounds(z,B,N){o.fitBounds([[z[0],z[1]],[z[2],z[3]]],{padding:B,...N?{maxZoom:N}:{},...u})},indicateReverse(z){o.getCanvasContainer().style.cursor=z?"crosshair":""},setReverseMarker(z){!e||!t||(S?z?S.setLngLat(z):(S.remove(),S=void 0):z&&(t instanceof Function?S=t(o)??void 0:(S=(typeof t=="object"?new e.Marker(t):R()).setLngLat(z).addTo(o),S.getElement().classList.add("marker-reverse"))))},setFeatures(z,B,N){for(const V of _)V.remove();if(_.length=0,P(void 0),!!e){if(B){let V=!1;if(B.geometry.type==="GeometryCollection"){const j=B.geometry.geometries.filter(le=>le.type==="Polygon"||le.type==="MultiPolygon");e:if(j.length>0){const le=R0(Ru(j.map(oe=>Du(oe))));if(!le)break e;b_({...B,geometry:le.geometry},P),V=!0}else{const le=B.geometry.geometries.filter(oe=>oe.type==="LineString"||oe.type==="MultiLineString");le.length>0&&(P({...B,geometry:{type:"GeometryCollection",geometries:le}}),V=!0)}}if(!V){if(B.geometry.type==="Polygon"||B.geometry.type==="MultiPolygon")b_(B,P);else if(B.geometry.type==="LineString"||B.geometry.type==="MultiLineString"){P(B);return}}if(!N&&B.geometry.type!=="Point")return;if(t instanceof Function){const j=t(o,B);j&&_.push(j)}else t&&_.push(typeof t=="object"?new e.Marker(t):R().setLngLat(B.center).addTo(o))}if(n)for(const V of z??[]){if(V===B)continue;let j;if(n instanceof Function){if(j=n(o,V),!j)continue}else j=(typeof n=="object"?new e.Marker(n):R(!0)).setLngLat(V.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(V.place_type[0]==="reverse"?V.place_name:V.place_name.replace(/,.*/,""))).addTo(o);const le=j.getElement();le.addEventListener("click",oe=>{oe.stopPropagation(),a==null||a({type:"markerClick",id:V.id})}),le.addEventListener("mouseenter",()=>{a==null||a({type:"markerMouseEnter",id:V.id}),j.togglePopup()}),le.addEventListener("mouseleave",()=>{a==null||a({type:"markerMouseLeave",id:V.id}),j.togglePopup()}),_.push(j)}}},setSelectedMarker(z){x&&x.getElement().classList.toggle("marker-selected",!1),x=z>-1?_[z]:void 0,x==null||x.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const z=o.getCenter();return[o.getZoom(),z.lng,z.lat]}}}function _k(o,e,t){var n,c;class u{constructor(z,B){uo(this,"type"),uo(this,"target"),this.type=B,this.target=z}}class f extends u{constructor(z,B){super(z,"select"),uo(this,"feature"),Object.assign(this,B)}}class a extends u{constructor(z,B){super(z,"featureslisted"),uo(this,"features"),this.features=B}}class _ extends u{constructor(z,B){super(z,"featuresmarked"),uo(this,"features"),this.features=B}}class x extends u{constructor(z,B){super(z,"optionsvisibilitychange"),uo(this,"optionsVisible"),this.optionsVisible=B}}class S extends u{constructor(z,B){super(z,"pick"),uo(this,"feature"),this.feature=B}}class k extends u{constructor(z,B){super(z,"querychange"),uo(this,"query"),this.query=B}}class I extends u{constructor(z,B,N){super(z,"response"),uo(this,"url"),uo(this,"featureCollection"),this.url=B,this.featureCollection=N}}class P extends u{constructor(z,B){super(z,"reversetoggle"),uo(this,"reverse"),this.reverse=B}}class D extends o{constructor(z={}){super(),jg(this,n),jg(this,c),Ug(this,c,z)}onAddInt(z){const B=document.createElement("div");B.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:N,showResultMarkers:V,flyTo:j,fullGeometryStyle:le,...oe}=Qn(this,c),$=typeof j=="boolean"?{}:j,Y={mapController:B0(z,e,N,V,$,$,le),flyTo:j===void 0?!0:!!j,apiKey:"",...t==null?void 0:t(z,B),...oe};if(!Y.apiKey)throw new Error("no apiKey provided");return Ug(this,n,new R2({target:B,props:Y})),Qn(this,n).$on("select",ve=>{this.fire(new f(this,ve.detail))}),Qn(this,n).$on("pick",ve=>{this.fire(new S(this,ve.detail.feature))}),Qn(this,n).$on("featureslisted",ve=>{this.fire(new a(this,ve.detail.features))}),Qn(this,n).$on("featuresmarked",ve=>{this.fire(new _(this,ve.detail.features))}),Qn(this,n).$on("response",ve=>{this.fire(new I(this,ve.detail.url,ve.detail.featureCollection))}),Qn(this,n).$on("optionsvisibilitychange",ve=>{this.fire(new x(this,ve.detail.optionsVisible))}),Qn(this,n).$on("reversetoggle",ve=>{this.fire(new P(this,ve.detail.reverse))}),Qn(this,n).$on("querychange",ve=>{this.fire(new k(this,ve.detail.query))}),B}on(z,B){return super.on(z,B)}once(z,B){return super.once(z,B)}off(z,B){return super.off(z,B)}listens(z){return super.listens(z)}setOptions(z){var B;Object.assign(Qn(this,c),z);const{marker:N,showResultMarkers:V,flyTo:j,fullGeometryStyle:le,...oe}=Qn(this,c);(B=Qn(this,n))==null||B.$set(oe)}setQuery(z,B=!0){var N;(N=Qn(this,n))==null||N.setQuery(z,B)}clearMap(){var z;(z=Qn(this,n))==null||z.clearMap()}clearList(){var z;(z=Qn(this,n))==null||z.clearList()}setReverseMode(z){var B;(B=Qn(this,n))==null||B.$set({reverseActive:z})}focus(){var z;(z=Qn(this,n))==null||z.focus()}blur(){var z;(z=Qn(this,n))==null||z.blur()}onRemove(){var z;(z=Qn(this,n))==null||z.$destroy()}}return n=new WeakMap,c=new WeakMap,{MapLibreBasedGeocodingControl:D,events:{SelectEvent:f,FeaturesListedEvent:a,FeaturesMarkedEvent:_,OptionsVisibilityChangeEvent:x,PickEvent:S,QueryChangeEvent:k,ResponseEvent:I,ReverseToggleEvent:P}}}const{MapLibreBasedGeocodingControl:uC,events:sa}=_k(Ts.Evented,db);sa.SelectEvent;sa.FeaturesListedEvent;sa.FeaturesMarkedEvent;sa.OptionsVisibilityChangeEvent;sa.PickEvent;sa.QueryChangeEvent;sa.ResponseEvent;sa.ReverseToggleEvent;function yk(o){let e,t;return{c(){e=xs("svg"),t=xs("path"),Te(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Te(e,"viewBox","0 0 14 14"),Te(e,"width","13"),Te(e,"height","13"),Te(e,"class","svelte-en2qvf")},m(n,c){de(n,e,c),ie(e,t)},p:Dt,i:Dt,o:Dt,d(n){n&&he(e)}}}class F0 extends Ht{constructor(e){super(),Wt(this,e,null,yk,Ut,{})}}function vk(o){let e,t;return{c(){e=xs("svg"),t=xs("path"),Te(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Te(e,"viewBox","0 0 30 30"),Te(e,"fill","none"),Te(e,"xmlns","http://www.w3.org/2000/svg"),Te(e,"class","svelte-d2loi5")},m(n,c){de(n,e,c),ie(e,t)},p:Dt,i:Dt,o:Dt,d(n){n&&he(e)}}}class O0 extends Ht{constructor(e){super(),Wt(this,e,null,vk,Ut,{})}}function bk(o){let e,t;return{c(){e=ue("img"),En(e.src,t=o[3]+"area.svg")||Te(e,"src",t),Te(e,"alt",o[6]),Te(e,"class","svelte-ltkwvy")},m(n,c){de(n,e,c)},p(n,c){c&8&&!En(e.src,t=n[3]+"area.svg")&&Te(e,"src",t),c&64&&Te(e,"alt",n[6])},d(n){n&&he(e)}}}function wk(o){let e,t;return{c(){e=ue("img"),En(e.src,t=o[3]+"reverse.svg")||Te(e,"src",t),Te(e,"alt",o[6]),Te(e,"class","svelte-ltkwvy")},m(n,c){de(n,e,c)},p(n,c){c&8&&!En(e.src,t=n[3]+"reverse.svg")&&Te(e,"src",t),c&64&&Te(e,"alt",n[6])},d(n){n&&he(e)}}}function xk(o){let e,t;return{c(){e=ue("img"),En(e.src,t=o[3]+"poi.svg")||Te(e,"src",t),Te(e,"alt",o[6]),Te(e,"class","svelte-ltkwvy")},m(n,c){de(n,e,c)},p(n,c){c&8&&!En(e.src,t=n[3]+"poi.svg")&&Te(e,"src",t),c&64&&Te(e,"alt",n[6])},d(n){n&&he(e)}}}function kk(o){let e,t;return{c(){e=ue("img"),En(e.src,t=o[3]+"postal_code.svg")||Te(e,"src",t),Te(e,"alt",o[6]),Te(e,"class","svelte-ltkwvy")},m(n,c){de(n,e,c)},p(n,c){c&8&&!En(e.src,t=n[3]+"postal_code.svg")&&Te(e,"src",t),c&64&&Te(e,"alt",n[6])},d(n){n&&he(e)}}}function Sk(o){let e,t;return{c(){e=ue("img"),En(e.src,t=o[3]+"street.svg")||Te(e,"src",t),Te(e,"alt",o[6]),Te(e,"class","svelte-ltkwvy")},m(n,c){de(n,e,c)},p(n,c){c&8&&!En(e.src,t=n[3]+"street.svg")&&Te(e,"src",t),c&64&&Te(e,"alt",n[6])},d(n){n&&he(e)}}}function Tk(o){let e,t;return{c(){e=ue("img"),En(e.src,t=o[3]+"road.svg")||Te(e,"src",t),Te(e,"alt",o[6]),Te(e,"class","svelte-ltkwvy")},m(n,c){de(n,e,c)},p(n,c){c&8&&!En(e.src,t=n[3]+"road.svg")&&Te(e,"src",t),c&64&&Te(e,"alt",n[6])},d(n){n&&he(e)}}}function Ek(o){let e,t;return{c(){e=ue("img"),En(e.src,t=o[3]+"housenumber.svg")||Te(e,"src",t),Te(e,"alt",o[6]),Te(e,"class","svelte-ltkwvy")},m(n,c){de(n,e,c)},p(n,c){c&8&&!En(e.src,t=n[3]+"housenumber.svg")&&Te(e,"src",t),c&64&&Te(e,"alt",n[6])},d(n){n&&he(e)}}}function Ck(o){let e,t,n,c;return{c(){e=ue("img"),En(e.src,t=o[5])||Te(e,"src",t),Te(e,"alt",o[4]),Te(e,"class","svelte-ltkwvy")},m(u,f){de(u,e,f),n||(c=Et(e,"error",o[14]),n=!0)},p(u,f){f&32&&!En(e.src,t=u[5])&&Te(e,"src",t),f&16&&Te(e,"alt",u[4])},d(u){u&&he(e),n=!1,c()}}}function S_(o){let e,t;return{c(){e=ue("span"),t=Qe(o[6]),Te(e,"class","secondary svelte-ltkwvy")},m(n,c){de(n,e,c),ie(e,t)},p(n,c){c&64&&Ci(t,n[6])},d(n){n&&he(e)}}}function Mk(o){let e,t,n,c,u,f,a,_,x,S=(o[7]?o[0].place_name:o[0].place_name.replace(/,.*/,""))+"",k,I,P=o[2]==="always"||o[2]!=="never"&&!o[0].address&&!o[0].id.startsWith("road.")&&!o[0].id.startsWith("address.")&&!o[0].id.startsWith("postal_code.")&&(!o[0].id.startsWith("poi.")||!o[5])&&!o[7],D,R,z=(o[7]?"":o[0].place_name.replace(/[^,]*,?\s*/,""))+"",B,N,V;function j(Y,ve){return ve&1&&(t=null),ve&1&&(n=null),ve&1&&(c=null),ve&1&&(u=null),Y[5]?Ck:Y[0].address?Ek:(t==null&&(t=!!Y[0].id.startsWith("road.")),t?Tk:(n==null&&(n=!!Y[0].id.startsWith("address.")),n?Sk:(c==null&&(c=!!Y[0].id.startsWith("postal_code.")),c?kk:(u==null&&(u=!!Y[0].id.startsWith("poi.")),u?xk:Y[7]?wk:bk))))}let le=j(o,-1),oe=le(o),$=P&&S_(o);return{c(){e=ue("li"),oe.c(),f=Fe(),a=ue("span"),_=ue("span"),x=ue("span"),k=Qe(S),I=Fe(),$&&$.c(),D=Fe(),R=ue("span"),B=Qe(z),Te(x,"class","primary svelte-ltkwvy"),Te(_,"class","svelte-ltkwvy"),Te(R,"class","line2 svelte-ltkwvy"),Te(a,"class","texts svelte-ltkwvy"),Te(e,"tabindex","0"),Te(e,"data-selected",o[1]),Te(e,"class","svelte-ltkwvy"),lr(e,"selected",o[1])},m(Y,ve){de(Y,e,ve),oe.m(e,null),ie(e,f),ie(e,a),ie(a,_),ie(_,x),ie(x,k),ie(_,I),$&&$.m(_,null),ie(a,D),ie(a,R),ie(R,B),N||(V=[Et(e,"mouseenter",o[12]),Et(e,"focus",o[13])],N=!0)},p(Y,[ve]){le===(le=j(Y,ve))&&oe?oe.p(Y,ve):(oe.d(1),oe=le(Y),oe&&(oe.c(),oe.m(e,f))),ve&1&&S!==(S=(Y[7]?Y[0].place_name:Y[0].place_name.replace(/,.*/,""))+"")&&Ci(k,S),ve&37&&(P=Y[2]==="always"||Y[2]!=="never"&&!Y[0].address&&!Y[0].id.startsWith("road.")&&!Y[0].id.startsWith("address.")&&!Y[0].id.startsWith("postal_code.")&&(!Y[0].id.startsWith("poi.")||!Y[5])&&!Y[7]),P?$?$.p(Y,ve):($=S_(Y),$.c(),$.m(_,null)):$&&($.d(1),$=null),ve&1&&z!==(z=(Y[7]?"":Y[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Ci(B,z),ve&2&&Te(e,"data-selected",Y[1]),ve&2&&lr(e,"selected",Y[1])},i:Dt,o:Dt,d(Y){Y&&he(e),oe.d(),$&&$.d(),N=!1,ln(V)}}}function Ik(o,e,t){var V;let n,c,{feature:u}=e,{selected:f=!1}=e,{showPlaceType:a}=e,{missingIconsCache:_}=e,{iconsBaseUrl:x}=e;const S=(V=u.properties)==null?void 0:V.categories;let k,I,P=0,D=u.place_type[0]==="reverse";function R(){I&&_.add(I),t(10,P++,P)}function z(j){ui.call(this,o,j)}function B(j){ui.call(this,o,j)}const N=()=>R();return o.$$set=j=>{"feature"in j&&t(0,u=j.feature),"selected"in j&&t(1,f=j.selected),"showPlaceType"in j&&t(2,a=j.showPlaceType),"missingIconsCache"in j&&t(9,_=j.missingIconsCache),"iconsBaseUrl"in j&&t(3,x=j.iconsBaseUrl)},o.$$.update=()=>{var j,le,oe,$;if(o.$$.dirty&3640)do t(11,n--,n),t(4,k=S==null?void 0:S[n]),t(5,I=k?x+k.replace(/ /g,"_")+".svg":void 0);while(n>-1&&(!I||_.has(I)));o.$$.dirty&1&&t(6,c=((le=(j=u.properties)==null?void 0:j.categories)==null?void 0:le.join(", "))??(($=(oe=u.properties)==null?void 0:oe.place_type_name)==null?void 0:$[0])??u.place_type[0])},t(11,n=(S==null?void 0:S.length)??0),[u,f,a,x,k,I,c,D,R,_,P,n,z,B,N]}class Lk extends Ht{constructor(e){super(),Wt(this,e,Ik,Mk,Ut,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function Ak(o){let e;return{c(){e=ue("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Te(e,"class","svelte-7cmwmc")},m(t,n){de(t,e,n)},p:Dt,i:Dt,o:Dt,d(t){t&&he(e)}}}class Pk extends Ht{constructor(e){super(),Wt(this,e,null,Ak,Ut,{})}}function zk(o){let e,t;return{c(){e=xs("svg"),t=xs("path"),Te(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Te(e,"viewBox","0 0 60.006 21.412"),Te(e,"width","14"),Te(e,"height","20"),Te(e,"class","svelte-en2qvf")},m(n,c){de(n,e,c),ie(e,t)},p:Dt,i:Dt,o:Dt,d(n){n&&he(e)}}}class Dk extends Ht{constructor(e){super(),Wt(this,e,null,zk,Ut,{})}}function Rk(o){let e,t,n;return{c(){e=xs("svg"),t=xs("circle"),n=xs("path"),Te(t,"cx","4.789"),Te(t,"cy","4.787"),Te(t,"r","3.85"),Te(t,"class","svelte-1aq105l"),Te(n,"d","M12.063 12.063 7.635 7.635"),Te(n,"class","svelte-1aq105l"),Te(e,"xmlns","http://www.w3.org/2000/svg"),Te(e,"width","13"),Te(e,"height","13"),Te(e,"viewBox","0 0 13 13"),Te(e,"class","svelte-1aq105l")},m(c,u){de(c,e,u),ie(e,t),ie(e,n)},p:Dt,i:Dt,o:Dt,d(c){c&&he(e)}}}class Bk extends Ht{constructor(e){super(),Wt(this,e,null,Rk,Ut,{})}}function Fk(o,e,t){const n=e[1],c=e[0],u=n-c;return o===n&&t?o:((o-c)%u+u)%u+c}function T_(o){const e=[...o];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let cu;async function Ok(o,e,t){const n=o==null?void 0:o.getCenterAndZoom();for(const c of e??[])if(!(n&&(c.minZoom!=null&&c.minZoom>n[0]||c.maxZoom!=null&&c.maxZoom<n[0]))){if(c.type==="fixed")return c.coordinates.join(",");e:if(c.type==="client-geolocation"){if(cu&&c.cachedLocationExpiry&&cu.time+c.cachedLocationExpiry>Date.now()){if(!cu.coords)break e;return cu.coords}let u;try{return u=await new Promise((f,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(_=>{f([_.coords.longitude,_.coords.latitude].map(x=>x.toFixed(6)).join(","))},_=>{a(_)},c)}),u}catch{}finally{c.cachedLocationExpiry&&(cu={time:Date.now(),coords:u})}if(t.signal.aborted)return}if(c.type==="server-geolocation")return"ip";if(n&&c.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const Nk=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,E_=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,C_=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,M_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,I_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,L_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function jk(o){if(!["DMS","DM","DD"].includes(o))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(P=>Number(P.trim())),t=Number(e[0]),n=Number(e[1]),c=Math.abs(t),u=Math.abs(n),f=t>0?"N":"S",a=n>0?"E":"W";let _;o=="DD"&&(_=`${c} ${f}, ${u} ${a}`);const x=Math.floor(c),S=Math.floor(u),k=(c-x)*60,I=(u-S)*60;if(o=="DM"){let P=A_(k,3).toFixed(3).padStart(6,"0"),D=A_(I,3).toFixed(3).padStart(6,"0");P.endsWith(".000")&&D.endsWith(".000")&&(P=P.replace(/\.000$/,""),D=D.replace(/\.000$/,"")),_=`${x} ${P}' ${f}, ${S} ${D}' ${a}`}if(o=="DMS"){const P=Math.floor(k),D=Math.floor(I);let R=((k-P)*60).toFixed(1).padStart(4,"0"),z=((I-D)*60).toFixed(1).padStart(4,"0");const B=P.toString().padStart(2,"0"),N=D.toString().padStart(2,"0");R.endsWith(".0")&&z.endsWith(".0")&&(R=R.replace(/\.0$/,""),z=z.replace(/\.0$/,"")),_=`${x} ${B}' ${R}" ${f}, ${S} ${N}' ${z}" ${a}`}return _}else throw new Error("no decimal coordinates to convert")}function A_(o,e){const t=Math.pow(10,e);return Math.round((o+Number.EPSILON)*t)/t}function Np(o,e){e||(e=5),o=o.replace(/\s+/g," ").trim();let t=null,n=null,c="",u="",f=null,a=[],_=!1;if(Nk.test(o))throw new Error("invalid coordinate value");if(E_.test(o))if(a=E_.exec(o),_=uu(a),_)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),n=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(n*=-1),f="DM";else throw new Error("invalid coordinate format");else if(C_.test(o))if(a=C_.exec(o),_=uu(a),_){if(t=a[2],n=a[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),f="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");a[1]?(c=a[1],u=a[5]):a[4]&&(c=a[4],u=a[8])}else throw new Error("invalid decimal coordinate format");else if(M_.test(o))if(a=M_.exec(o),_=uu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,f="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,f="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[9])),a[11]&&(n+=a[11]/60),a[13]&&(n+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(n=-1*n),a[1]?(c=a[1],u=a[8]):a[7]&&(c=a[7],u=a[14]);else throw new Error("invalid DMS coordinates format");else if(I_.test(o))if(a=I_.exec(o),_=uu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,f="DM"),a[6]&&(t+=a[6]/3600,f="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12]/60),a[14]&&(n+=a[14]/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(c=a[1],u=a[9]):a[8]&&(c=a[8],u=a[16]);else throw new Error("invalid DMS coordinates format");else if(L_.test(o)){if(a=L_.exec(o),_=uu(a),a.filter(x=>x).length<=5)throw new Error("invalid coordinates format");if(_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,f="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,f="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12].replace(",",".")/60),a[14]&&(n+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(c=a[1],u=a[9]):a[8]&&(c=a[8],u=a[16]);else throw new Error("invalid coordinates format")}if(_){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(c&&!u||!c&&u)throw new Error("invalid coordinates value");if(c&&c==u)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let x=/S|SOUTH/i;x.test(c)&&t>0&&(t=-1*t),x=/W|WEST/i,x.test(u)&&n>0&&(n=-1*n);const S=a[0].trim();let k,I;const P=/[,/;\u0020]/g,D=S.match(P);if(D==null){const B=Math.floor(o.length/2);k=S.substring(0,B).trim(),I=S.substring(B).trim()}else{let B;D.length%2==1?B=Math.floor(D.length/2):B=D.length/2-1;let N=0;if(B==0)N=S.indexOf(D[0]),k=S.substring(0,N).trim(),I=S.substring(N+1).trim();else{let V=0,j=0;for(;V<=B;)N=S.indexOf(D[V],j),j=N+1,V++;k=S.substring(0,N).trim(),I=S.substring(N+1).trim()}}const R=k.split(".");if(R.length==2&&R[1]==0&&R[1].length!=2)throw new Error("invalid coordinates format");const z=I.split(".");if(z.length==2&&z[1]==0&&z[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(k)||/^\d+$/.test(I))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:S,verbatimLatitude:k,verbatimLongitude:I,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:f,closeEnough:Uk,toCoordinateFormat:jk})}else throw new Error("coordinates pattern match failed")}function uu(o){if(!isNaN(o[0]))return!1;const e=[...o];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,c=e.length/2;for(let u=0;u<c;u++){const f=e[u],a=e[u+c],_=t.test(f)&&t.test(a),x=n.test(f)&&n.test(a),S=f==a;if(!(f==null&&a==null)){if(f==null||a==null)return!1;if(_||x||S)continue;return!1}}return!0}function P_(o,e){const t=Math.abs(o-e);return Number(t.toFixed(6))<=1e-5}function Uk(o){if(!o)throw new Error("coords must be provided");if(o.includes(",")){const e=o.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return P_(this.decimalLatitude,Number(e[0]))&&P_(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const Vk=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Np.to=Vk;const qk=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],Zk={decimalLatitude:40.123,decimalLongitude:-74.123},Gk=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],Wk=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function Hk(){const o=[];return qk.forEach(e=>{e.decimalLatitude?o.push(e):o.push({...e,...Zk})}),[...o,...Gk,...Wk]}const $k=Hk();Np.formats=$k.map(o=>o.verbatimCoordinates);const Xk=Np;function z_(o,e,t){const n=o.slice();return n[84]=e[t],n[86]=t,n}function D_(o){let e,t;return e=new Pk({}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function R_(o){let e,t,n,c,u;return t=new Dk({}),{c(){e=ue("button"),Re(t.$$.fragment),Te(e,"type","button"),Te(e,"title",o[9]),Te(e,"class","svelte-bz0zu3"),lr(e,"active",o[0])},m(f,a){de(f,e,a),ze(t,e,null),n=!0,c||(u=Et(e,"click",o[69]),c=!0)},p(f,a){(!n||a[0]&512)&&Te(e,"title",f[9]),(!n||a[0]&1)&&lr(e,"active",f[0])},i(f){n||(re(t.$$.fragment,f),n=!0)},o(f){ce(t.$$.fragment,f),n=!1},d(f){f&&he(e),De(t),c=!1,u()}}}function Kk(o){let e,t=[],n=new Map,c,u,f,a=Kn(o[14]);const _=x=>x[84].id+(x[84].address?","+x[84].address:"");for(let x=0;x<a.length;x+=1){let S=z_(o,a,x),k=_(S);n.set(k,t[x]=B_(k,S))}return{c(){e=ue("ul");for(let x=0;x<t.length;x+=1)t[x].c();Te(e,"class","options svelte-bz0zu3")},m(x,S){de(x,e,S);for(let k=0;k<t.length;k+=1)t[k]&&t[k].m(e,null);c=!0,u||(f=[Et(e,"mouseleave",o[73]),Et(e,"blur",o[74])],u=!0)},p(x,S){S[0]&17880064&&(a=Kn(x[14]),_i(),t=eb(t,S,_,1,x,a,n,e,Qv,B_,null,z_),yi())},i(x){if(!c){for(let S=0;S<a.length;S+=1)re(t[S]);c=!0}},o(x){for(let S=0;S<t.length;S+=1)ce(t[S]);c=!1},d(x){x&&he(e);for(let S=0;S<t.length;S+=1)t[S].d();u=!1,ln(f)}}}function Jk(o){let e,t,n,c,u,f;return t=new O0({}),{c(){e=ue("div"),Re(t.$$.fragment),n=Fe(),c=ue("div"),u=Qe(o[7]),Te(c,"class","svelte-bz0zu3"),Te(e,"class","no-results svelte-bz0zu3")},m(a,_){de(a,e,_),ze(t,e,null),ie(e,n),ie(e,c),ie(c,u),f=!0},p(a,_){(!f||_[0]&128)&&Ci(u,a[7])},i(a){f||(re(t.$$.fragment,a),f=!0)},o(a){ce(t.$$.fragment,a),f=!1},d(a){a&&he(e),De(t)}}}function Yk(o){let e="",t;return{c(){t=Qe(e)},m(n,c){de(n,t,c)},p:Dt,i:Dt,o:Dt,d(n){n&&he(t)}}}function Qk(o){let e,t,n,c,u,f,a,_,x,S,k;return t=new O0({}),_=new F0({}),{c(){e=ue("div"),Re(t.$$.fragment),n=Fe(),c=ue("div"),u=Qe(o[6]),f=Fe(),a=ue("button"),Re(_.$$.fragment),Te(c,"class","svelte-bz0zu3"),Te(a,"class","svelte-bz0zu3"),Te(e,"class","error svelte-bz0zu3")},m(I,P){de(I,e,P),ze(t,e,null),ie(e,n),ie(e,c),ie(c,u),ie(e,f),ie(e,a),ze(_,a,null),x=!0,S||(k=Et(a,"click",o[70]),S=!0)},p(I,P){(!x||P[0]&64)&&Ci(u,I[6])},i(I){x||(re(t.$$.fragment,I),re(_.$$.fragment,I),x=!0)},o(I){ce(t.$$.fragment,I),ce(_.$$.fragment,I),x=!1},d(I){I&&he(e),De(t),De(_),S=!1,k()}}}function B_(o,e){let t,n,c;function u(){return e[71](e[86])}function f(){return e[72](e[84])}return n=new Lk({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",u),n.$on("focus",f),{key:o,first:null,c(){t=Bn(),Re(n.$$.fragment),this.first=t},m(a,_){de(a,t,_),ze(n,a,_),c=!0},p(a,_){e=a;const x={};_[0]&16384&&(x.feature=e[84]),_[0]&1024&&(x.showPlaceType=e[10]),_[0]&49152&&(x.selected=e[15]===e[86]),_[0]&4096&&(x.iconsBaseUrl=e[12]),n.$set(x)},i(a){c||(re(n.$$.fragment,a),c=!0)},o(a){ce(n.$$.fragment,a),c=!1},d(a){a&&he(t),De(n,a)}}}function eS(o){let e,t,n,c,u,f,a,_,x,S,k,I,P,D,R,z,B,N,V,j,le,oe=!1;u=new Bk({}),k=new F0({});let $=o[19]&&D_(),Y=o[5]==="button"&&R_(o);const ve=o[61].default,Be=Bi(ve,o,o[60],null),te=[Qk,Yk,Jk,Kk],ne=[];function qe(Ce,et){var bt,ft;return Ce[18]?0:Ce[16]?((bt=Ce[14])==null?void 0:bt.length)===0?2:Ce[16]&&((ft=Ce[14])!=null&&ft.length)?3:-1:1}return~(z=qe(o))&&(B=ne[z]=te[z](o)),{c(){e=Fe(),t=ue("form"),n=ue("div"),c=ue("button"),Re(u.$$.fragment),f=Fe(),a=ue("input"),_=Fe(),x=ue("div"),S=ue("button"),Re(k.$$.fragment),I=Fe(),$&&$.c(),P=Fe(),Y&&Y.c(),D=Fe(),Be&&Be.c(),R=Fe(),B&&B.c(),Te(c,"class","search-button svelte-bz0zu3"),Te(c,"type","button"),Te(a,"placeholder",o[8]),Te(a,"aria-label",o[8]),Te(a,"class","svelte-bz0zu3"),Te(S,"type","button"),Te(S,"title",o[3]),Te(S,"class","svelte-bz0zu3"),Te(x,"class","clear-button-container svelte-bz0zu3"),lr(x,"displayable",o[1]!==""),Te(n,"class","input-group svelte-bz0zu3"),Te(t,"tabindex","0"),Te(t,"class",N=fd(o[2])+" svelte-bz0zu3"),lr(t,"can-collapse",o[4]&&o[1]==="")},m(Ce,et){de(Ce,e,et),de(Ce,t,et),ie(t,n),ie(n,c),ze(u,c,null),ie(n,f),ie(n,a),o[63](a),Hn(a,o[1]),ie(n,_),ie(n,x),ie(x,S),ze(k,S,null),ie(x,I),$&&$.m(x,null),ie(n,P),Y&&Y.m(n,null),ie(n,D),Be&&Be.m(n,null),ie(t,R),~z&&ne[z].m(t,null),V=!0,j||(le=[Et(c,"click",o[62]),Et(a,"input",o[64]),Et(a,"focus",o[65]),Et(a,"blur",o[66]),Et(a,"keydown",o[22]),Et(a,"input",o[67]),Et(S,"click",o[68]),Et(t,"submit",vp(o[21]))],j=!0)},p(Ce,et){(!V||et[0]&256)&&Te(a,"placeholder",Ce[8]),(!V||et[0]&256)&&Te(a,"aria-label",Ce[8]),et[0]&2&&a.value!==Ce[1]&&Hn(a,Ce[1]),(!V||et[0]&8)&&Te(S,"title",Ce[3]),Ce[19]?$?et[0]&524288&&re($,1):($=D_(),$.c(),re($,1),$.m(x,null)):$&&(_i(),ce($,1,1,()=>{$=null}),yi()),(!V||et[0]&2)&&lr(x,"displayable",Ce[1]!==""),Ce[5]==="button"?Y?(Y.p(Ce,et),et[0]&32&&re(Y,1)):(Y=R_(Ce),Y.c(),re(Y,1),Y.m(n,D)):Y&&(_i(),ce(Y,1,1,()=>{Y=null}),yi()),Be&&Be.p&&(!V||et[1]&536870912)&&Oi(Be,ve,Ce,Ce[60],V?Fi(ve,Ce[60],et,null):Ni(Ce[60]),null);let bt=z;z=qe(Ce),z===bt?~z&&ne[z].p(Ce,et):(B&&(_i(),ce(ne[bt],1,1,()=>{ne[bt]=null}),yi()),~z?(B=ne[z],B?B.p(Ce,et):(B=ne[z]=te[z](Ce),B.c()),re(B,1),B.m(t,null)):B=null),(!V||et[0]&4&&N!==(N=fd(Ce[2])+" svelte-bz0zu3"))&&Te(t,"class",N),(!V||et[0]&22)&&lr(t,"can-collapse",Ce[4]&&Ce[1]==="")},i(Ce){V||(re(oe),re(u.$$.fragment,Ce),re(k.$$.fragment,Ce),re($),re(Y),re(Be,Ce),re(B),V=!0)},o(Ce){ce(oe),ce(u.$$.fragment,Ce),ce(k.$$.fragment,Ce),ce($),ce(Y),ce(Be,Ce),ce(B),V=!1},d(Ce){Ce&&(he(e),he(t)),De(u),o[63](null),De(k),$&&$.d(),Y&&Y.d(),Be&&Be.d(Ce),~z&&ne[z].d(),j=!1,ln(le)}}}function tS(o,e,t){let n,c,{$$slots:u={},$$scope:f}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:_=void 0}=e,{apiKey:x}=e,{bbox:S=void 0}=e,{clearButtonTitle:k="clear"}=e,{clearOnBlur:I=!1}=e,{collapsed:P=!1}=e,{country:D=void 0}=e,{debounceSearch:R=200}=e,{enableReverse:z="never"}=e,{errorMessage:B="Something went wrong"}=e,{filter:N=()=>!0}=e,{flyTo:V=!0}=e,{fuzzyMatch:j=!0}=e,{language:le=void 0}=e,{limit:oe=void 0}=e,{mapController:$=void 0}=e,{minLength:Y=2}=e,{noResultsMessage:ve="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Be="Search"}=e,{proximity:te=[{type:"server-geolocation"}]}=e,{reverseActive:ne=z==="always"}=e,{reverseButtonTitle:qe="toggle reverse geocoding"}=e,{searchValue:Ce=""}=e,{pickedResultStyle:et="full-geometry"}=e,{showPlaceType:bt="if-needed"}=e,{showResultsWhileTyping:ft=!0}=e,{selectFirst:ot=!0}=e,{flyToSelected:Zt=!1}=e,{markerOnSelected:ii=!0}=e,{types:Ft=void 0}=e,{exhaustiveReverseGeocoding:Pt=!1}=e,{excludeTypes:Jt=!1}=e,{zoom:Mt=a}=e,{apiUrl:ei="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Vt={}}=e,{iconsBaseUrl:hi="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:xi=()=>{}}=e;function gi(){Ve.focus()}function Ai(){Ve.blur()}function ct(G,Ue=!0,Ze=!1){t(1,Ce=G),Ue?(t(15,$e=-1),ut()):(Yt(!Ze,Ze),setTimeout(()=>{Ve.focus(),Ve.select()}))}function It(){t(14,rt=void 0),t(56,we=void 0),t(15,$e=-1)}function Ne(){t(55,xt=[]),t(56,we=void 0)}let je=!1,rt,xt,we,di="",Ve,$e=-1,kt,bn=[],wn,Cn,tr,ir;const Uo=new Set,Ki=ts();er(()=>{$&&($.setEventHandler(void 0),$.indicateReverse(!1),$.setSelectedMarker(-1),$.setFeatures(void 0,void 0,!1))});function ut(G){if(Cn&&(clearTimeout(Cn),Cn=void 0),$e>-1&&rt)t(56,we=rt[$e]),t(1,Ce=we.place_type[0]==="reverse"?we.place_name:we.place_name.replace(/,.*/,"")),t(18,kt=void 0),t(55,xt=void 0),t(15,$e=-1);else if(Ce){const Ue=G||!$n(Ce);xn(Ce,{exact:!0}).then(()=>{t(55,xt=rt),t(56,we=void 0),Ue&&Lo()}).catch(Ze=>t(18,kt=Ze))}}function $n(G){try{return Xk(G,6)}catch{return!1}}async function xn(G,{byId:Ue=!1,exact:Ze=!1}={}){t(18,kt=void 0),wn==null||wn.abort();const We=new AbortController;t(19,wn=We);try{const Je=$n(G),ht=new URLSearchParams;if(le!==void 0&&ht.set("language",Array.isArray(le)?le.join(","):le??""),Ft&&ht.set("types",Ft.join(",")),Jt&&ht.set("excludeTypes",String(Jt)),S&&ht.set("bbox",S.map(vi=>vi.toFixed(6)).join(",")),D&&ht.set("country",Array.isArray(D)?D.join(","):D),!Ue&&!Je){const vi=await Ok($,te,We);vi&&ht.set("proximity",vi),(Ze||!ft)&&ht.set("autocomplete","false"),ht.set("fuzzyMatch",String(j))}oe!==void 0&&(Pt||!Je||(Ft==null?void 0:Ft.length)===1)&&ht.set("limit",String(oe)),ht.set("key",x),xi(ht);const Rt=ei+"/"+encodeURIComponent(Je?Je.decimalLongitude+","+Je.decimalLatitude:G)+".json?"+ht.toString();if(Rt===di){Ue?(t(14,rt=void 0),t(56,we=bn[0])):t(14,rt=bn);return}di=Rt;const Xt=await fetch(Rt,{signal:We.signal,...Vt});if(!Xt.ok)throw new Error(await Xt.text());const ai=await Xt.json();Ki("response",{url:Rt,featureCollection:ai}),Ue?(t(14,rt=void 0),t(56,we=ai.features[0]),bn=[we]):(t(14,rt=ai.features.filter(N)),Je&&rt.unshift({type:"Feature",properties:{},id:"reverse_"+Je.decimalLongitude+"_"+Je.decimalLatitude,text:Je.decimalLatitude+", "+Je.decimalLongitude,place_name:Je.decimalLatitude+", "+Je.decimalLongitude,place_type:["reverse"],center:[Je.decimalLongitude,Je.decimalLatitude],bbox:[Je.decimalLongitude,Je.decimalLatitude,Je.decimalLongitude,Je.decimalLatitude],geometry:{type:"Point",coordinates:[Je.decimalLongitude,Je.decimalLatitude]}}),bn=rt,Je&&Ve.focus())}catch(Je){if(Je&&typeof Je=="object"&&"name"in Je&&Je.name==="AbortError")return;throw Je}finally{We===wn&&t(19,wn=void 0)}}function Lo(){var We;if(!(xt!=null&&xt.length)||!V)return;const G=[180,90,-180,-90],Ue=!xt.some(Je=>!Je.matching_text);let Ze;for(const Je of xt){const ht=Vi(Je);if(Ze=Ze===void 0?ht:ht===void 0?Ze:Math.max(Ze,ht),Ue||!Je.matching_text)for(const Rt of[0,1,2,3])G[Rt]=Math[Rt<2?"min":"max"](G[Rt],((We=Je.bbox)==null?void 0:We[Rt])??Je.center[Rt%2])}$&&xt.length>0&&(we&&G[0]===G[2]&&G[1]===G[3]?$.flyTo(we.center,Vi(we)):$.fitBounds(T_(G),50,Ze))}function Vi(G){var Ze;if(!G.bbox||G.bbox[0]!==G.bbox[2]&&G.bbox[1]!==G.bbox[3])return;const Ue=G.id.replace(/\..*/,"");return(Array.isArray((Ze=G.properties)==null?void 0:Ze.categories)?G.properties.categories.reduce((We,Je)=>{const ht=Mt[Ue+"."+Je];return We===void 0?ht:ht===void 0?We:Math.max(We,ht)},void 0):void 0)??Mt[Ue]}function gt(G){t(0,ne=z==="always"),t(14,rt=void 0),t(56,we=void 0),t(15,$e=-1),ct(G[1].toFixed(6)+", "+Fk(G[0],[-180,180],!0).toFixed(6),!1,!0)}function ni(G){if(!rt)return;let Ue=G.key==="ArrowDown"?1:G.key==="ArrowUp"?-1:0;Ue&&($e===(ot?0:-1)&&Ue===-1&&t(15,$e=rt.length),t(15,$e+=Ue),$e>=rt.length&&t(15,$e=-1),$e<0&&ot&&t(15,$e=0),G.preventDefault())}function Yt(G=!0,Ue=!1){if(t(18,kt=void 0),ft||Ue){if(Cn&&clearTimeout(Cn),Ce.length<Y)return;const Ze=Ce;Cn=window.setTimeout(()=>{xn(Ze).catch(We=>t(18,kt=We))},G?R:0)}else t(14,rt=void 0),t(18,kt=void 0)}function qi(G){t(56,we=G),t(1,Ce=G.place_name),t(15,$e=-1)}const yr=()=>Ve.focus();function ti(G){Xi[G?"unshift":"push"](()=>{Ve=G,t(17,Ve)})}function eo(){Ce=this.value,t(1,Ce),t(13,je),t(28,I)}const cn=()=>t(13,je=!0),ge=()=>t(13,je=!1),W=()=>Yt(),X=()=>{t(1,Ce=""),Ve.focus()},ee=()=>t(0,ne=!ne),fe=()=>t(18,kt=void 0),Me=G=>t(15,$e=G),Ie=G=>qi(G),Pe=()=>{ot||t(15,$e=-1)},ke=()=>{};return o.$$set=G=>{"class"in G&&t(2,_=G.class),"apiKey"in G&&t(26,x=G.apiKey),"bbox"in G&&t(27,S=G.bbox),"clearButtonTitle"in G&&t(3,k=G.clearButtonTitle),"clearOnBlur"in G&&t(28,I=G.clearOnBlur),"collapsed"in G&&t(4,P=G.collapsed),"country"in G&&t(29,D=G.country),"debounceSearch"in G&&t(30,R=G.debounceSearch),"enableReverse"in G&&t(5,z=G.enableReverse),"errorMessage"in G&&t(6,B=G.errorMessage),"filter"in G&&t(31,N=G.filter),"flyTo"in G&&t(32,V=G.flyTo),"fuzzyMatch"in G&&t(33,j=G.fuzzyMatch),"language"in G&&t(34,le=G.language),"limit"in G&&t(35,oe=G.limit),"mapController"in G&&t(36,$=G.mapController),"minLength"in G&&t(37,Y=G.minLength),"noResultsMessage"in G&&t(7,ve=G.noResultsMessage),"placeholder"in G&&t(8,Be=G.placeholder),"proximity"in G&&t(38,te=G.proximity),"reverseActive"in G&&t(0,ne=G.reverseActive),"reverseButtonTitle"in G&&t(9,qe=G.reverseButtonTitle),"searchValue"in G&&t(1,Ce=G.searchValue),"pickedResultStyle"in G&&t(39,et=G.pickedResultStyle),"showPlaceType"in G&&t(10,bt=G.showPlaceType),"showResultsWhileTyping"in G&&t(40,ft=G.showResultsWhileTyping),"selectFirst"in G&&t(11,ot=G.selectFirst),"flyToSelected"in G&&t(41,Zt=G.flyToSelected),"markerOnSelected"in G&&t(42,ii=G.markerOnSelected),"types"in G&&t(43,Ft=G.types),"exhaustiveReverseGeocoding"in G&&t(44,Pt=G.exhaustiveReverseGeocoding),"excludeTypes"in G&&t(45,Jt=G.excludeTypes),"zoom"in G&&t(46,Mt=G.zoom),"apiUrl"in G&&t(47,ei=G.apiUrl),"fetchParameters"in G&&t(48,Vt=G.fetchParameters),"iconsBaseUrl"in G&&t(12,hi=G.iconsBaseUrl),"adjustUrlQuery"in G&&t(49,xi=G.adjustUrlQuery),"$$scope"in G&&t(60,f=G.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&32&&t(0,ne=z==="always"),o.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,tr=je),I&&!je&&t(1,Ce="")}),o.$$.dirty[0]&16386|o.$$.dirty[1]&64&&Ce.length<Y&&(t(56,we=void 0),t(14,rt=void 0),t(18,kt=void 0),t(55,xt=rt)),o.$$.dirty[1]&33554688&&et!=="marker-only"&&we&&!we.address&&we.geometry.type==="Point"&&we.place_type[0]!=="reverse"&&xn(we.id,{byId:!0}).catch(G=>t(18,kt=G)),o.$$.dirty[1]&100663330&&($&&we&&we.id!==ir&&V&&(!we.bbox||we.bbox[0]===we.bbox[2]&&we.bbox[1]===we.bbox[3]?$.flyTo(we.center,Vi(we)):$.fitBounds(T_(we.bbox),50,Vi(we)),t(14,rt=void 0),t(55,xt=void 0),t(15,$e=-1)),t(57,ir=we==null?void 0:we.id)),o.$$.dirty[0]&18432&&ot&&rt!=null&&rt.length&&t(15,$e=0),o.$$.dirty[0]&2&&t(15,$e=-1),o.$$.dirty[0]&16384|o.$$.dirty[1]&16777216&&xt!==rt&&t(55,xt=void 0),o.$$.dirty[0]&81921|o.$$.dirty[1]&16777248&&$&&$.setEventHandler(G=>{switch(G.type){case"mapClick":ne&&gt(G.coordinates);break;case"markerClick":{const Ue=rt==null?void 0:rt.find(Ze=>Ze.id===G.id);Ue&&qi(Ue)}break;case"markerMouseEnter":xt&&t(15,$e=tr?(rt==null?void 0:rt.findIndex(Ue=>Ue.id===G.id))??-1:-1);break;case"markerMouseLeave":xt&&t(15,$e=-1);break}}),o.$$.dirty[0]&49152&&t(58,c=rt==null?void 0:rt[$e]),o.$$.dirty[1]&134218786&&$&&c&&V&&Zt&&$.flyTo(c.center,Vi(c)),o.$$.dirty[1]&256&&t(59,n=et==="full-geometry-including-polygon-center-marker"),o.$$.dirty[1]&268437536&&(ii||$==null||$.setFeatures(void 0,void 0,n)),o.$$.dirty[1]&419432480&&$&&ii&&!xt&&($.setFeatures(c?[c]:void 0,void 0,n),$.setSelectedMarker(c?0:-1)),o.$$.dirty[1]&318767136&&$&&$.setFeatures(xt,we,n),o.$$.dirty[0]&32768|o.$$.dirty[1]&16777248&&xt&&$&&$.setSelectedMarker($e),o.$$.dirty[0]&2|o.$$.dirty[1]&32&&$){const G=$n(Ce);$.setReverseMarker(G?[G.decimalLongitude,G.decimalLatitude]:void 0)}o.$$.dirty[1]&134217728&&Ki("select",{feature:c}),o.$$.dirty[1]&33554432&&Ki("pick",{feature:we}),o.$$.dirty[0]&81920&&Ki("optionsvisibilitychange",{optionsVisible:tr&&!!rt}),o.$$.dirty[0]&16384&&Ki("featureslisted",{features:rt}),o.$$.dirty[1]&16777216&&Ki("featuresmarked",{features:xt}),o.$$.dirty[0]&1&&Ki("reversetoggle",{reverse:ne}),o.$$.dirty[0]&2&&Ki("querychange",{query:Ce}),o.$$.dirty[0]&1|o.$$.dirty[1]&32&&$&&$.indicateReverse(ne)},[ne,Ce,_,k,P,z,B,ve,Be,qe,bt,ot,hi,je,rt,$e,tr,Ve,kt,wn,Uo,ut,ni,Yt,qi,a,x,S,I,D,R,N,V,j,le,oe,$,Y,te,et,ft,Zt,ii,Ft,Pt,Jt,Mt,ei,Vt,xi,gi,Ai,ct,It,Ne,xt,we,ir,c,n,f,u,yr,ti,eo,cn,ge,W,X,ee,fe,Me,Ie,Pe,ke]}class iS extends Ht{constructor(e){super(),Wt(this,e,tS,eS,Ut,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function F_(o){let e,t,n;return t=new iS({props:{mapController:o[2],apiKey:o[0],country:o[1],types:o[3],proximity:[{type:"map-center"}]}}),{c(){e=ue("div"),Re(t.$$.fragment),Te(e,"class","svelte-ixhnie")},m(c,u){de(c,e,u),ze(t,e,null),n=!0},p(c,u){const f={};u&4&&(f.mapController=c[2]),u&1&&(f.apiKey=c[0]),u&2&&(f.country=c[1]),t.$set(f)},i(c){n||(re(t.$$.fragment,c),n=!0)},o(c){ce(t.$$.fragment,c),n=!1},d(c){c&&he(e),De(t)}}}function nS(o){let e,t,n=o[2]&&F_(o);return{c(){n&&n.c(),e=Bn()},m(c,u){n&&n.m(c,u),de(c,e,u),t=!0},p(c,[u]){c[2]?n?(n.p(c,u),u&4&&re(n,1)):(n=F_(c),n.c(),re(n,1),n.m(e.parentNode,e)):n&&(_i(),ce(n,1,1,()=>{n=null}),yi())},i(c){t||(re(n),t=!0)},o(c){ce(n),t=!1},d(c){c&&he(e),n&&n.d(c)}}}function rS(o,e,t){let n,{apiKey:c}=e,{map:u}=e,{country:f}=e,a=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function _(x){return x?B0(x,Qr,!0,!0,{duration:1e3},{duration:1e3}):null}return o.$$set=x=>{"apiKey"in x&&t(0,c=x.apiKey),"map"in x&&t(4,u=x.map),"country"in x&&t(1,f=x.country)},o.$$.update=()=>{o.$$.dirty&16&&t(2,n=_(u))},[c,f,n,a,u]}class oS extends Ht{constructor(e){super(),Wt(this,e,rS,nS,Ut,{apiKey:0,map:4,country:1})}}const sS=Symbol.for("svelte-maplibre");function aS(){return kp(sS)}function lS(o){return"layerType"in o&&o.layerType==="deckgl"}const cS=o=>({features:o[0]&16,data:o[0]&16,map:o[0]&4,close:o[0]&1}),O_=o=>{var e;return{features:o[4],data:(e=o[4])==null?void 0:e[0],map:o[2],close:o[31]}};function N_(o){let e,t,n=(o[4]||o[3]instanceof Qr.Marker)&&j_(o);return{c(){e=ue("div"),n&&n.c()},m(c,u){de(c,e,u),n&&n.m(e,null),o[32](e),t=!0},p(c,u){c[4]||c[3]instanceof Qr.Marker?n?(n.p(c,u),u[0]&24&&re(n,1)):(n=j_(c),n.c(),re(n,1),n.m(e,null)):n&&(_i(),ce(n,1,1,()=>{n=null}),yi())},i(c){t||(re(n),t=!0)},o(c){ce(n),t=!1},d(c){c&&he(e),n&&n.d(),o[32](null)}}}function j_(o){let e;const t=o[30].default,n=Bi(t,o,o[29],O_);return{c(){n&&n.c()},m(c,u){n&&n.m(c,u),e=!0},p(c,u){n&&n.p&&(!e||u[0]&536870933)&&Oi(n,t,c,c[29],e?Fi(t,c[29],u,cS):Ni(c[29]),O_)},i(c){e||(re(n,c),e=!0)},o(c){ce(n,c),e=!1},d(c){n&&n.d(c)}}}function uS(o){let e,t,n=o[9].default&&N_(o);return{c(){n&&n.c(),e=Bn()},m(c,u){n&&n.m(c,u),de(c,e,u),t=!0},p(c,u){c[9].default?n?(n.p(c,u),u[0]&512&&re(n,1)):(n=N_(c),n.c(),re(n,1),n.m(e.parentNode,e)):n&&(_i(),ce(n,1,1,()=>{n=null}),yi())},i(c){t||(re(n),t=!0)},o(c){ce(n),t=!1},d(c){c&&he(e),n&&n.d(c)}}}function hS(o,e,t){let n,c,u,f,a,_,{$$slots:x={},$$scope:S}=e;const k=$v(x);let{closeButton:I=void 0}=e,{closeOnClickOutside:P=!0}=e,{closeOnClickInside:D=!1}=e,{closeOnMove:R=!1}=e,{openOn:z="click"}=e,{openIfTopMost:B=!0}=e,{focusAfterOpen:N=!0}=e,{anchor:V=void 0}=e,{offset:j=void 0}=e,{popupClass:le=void 0}=e,{maxWidth:oe=void 0}=e,{lngLat:$=void 0}=e,{html:Y=void 0}=e,{open:ve=!1}=e;const Be=ts(),{map:te,popupTarget:ne,layerEvent:qe,layer:Ce,eventTopMost:et}=aS();dt(o,te,je=>t(2,u=je)),dt(o,ne,je=>t(3,a=je)),dt(o,qe,je=>t(28,f=je)),dt(o,Ce,je=>t(35,_=je));const bt=["click","dblclick","contextmenu"];let ft,ot=!1,Zt;function ii(){if(!ft)return;let je=ft.getElement();!je||je===Zt||(Zt=je,z==="hover"&&(Zt.style.pointerEvents="none"),Zt.addEventListener("mouseenter",()=>{t(24,ot=!0)},{passive:!0}),Zt.addEventListener("mouseleave",()=>{t(24,ot=!1)},{passive:!0}),Zt.addEventListener("click",()=>{D&&t(0,ve=!1)},{passive:!0}))}kd(()=>{if(u)return u.on("click",Ai),u.on("contextmenu",Ai),typeof a=="string"&&(u.on("click",a,Mt),u.on("dblclick",a,Mt),u.on("contextmenu",a,Mt),u.on("mousemove",a,gi),u.on("mouseleave",a,xi),u.on("touchstart",a,Vt),u.on("touchend",a,hi)),()=>{u!=null&&u.loaded()&&(ft==null||ft.remove(),u.off("click",Ai),u.off("contextmenu",Ai),a instanceof Qr.Marker?a.getPopup()===ft&&a.setPopup(void 0):typeof a=="string"&&(u.off("click",a,Mt),u.off("dblclick",a,Mt),u.off("contextmenu",a,Mt),u.off("mousemove",a,gi),u.off("mouseleave",a,xi),u.off("touchstart",a,Vt),u.off("touchend",a,hi)))}});function Ft(je){return B?!("marker"in je)&&!lS(je)&&et(je)!==_:!1}let Pt=null,Jt="normal";function Mt(je){je.type===z&&(Ft(je)||("layerType"in je?je.layerType==="deckgl"?(t(10,$=je.coordinate),t(4,Pt=je.object?[je.object]:null)):(t(10,$=je.lngLat),t(4,Pt=je.features??[])):(t(10,$=je.lngLat),t(4,Pt=je.features??[])),setTimeout(()=>t(0,ve=!0))))}let ei=null;function Vt(je){ei=je.point}function hi(je){if(!ei||z!=="hover")return;let rt=ei.dist(je.point);ei=null,rt<3&&(t(10,$=je.lngLat),t(4,Pt=je.features??[]),ft.isOpen()?t(25,Jt="justOpened"):(t(25,Jt="opening"),t(0,ve=!0)))}function xi(je){z!=="hover"||ei||Jt!=="normal"||(t(0,ve=!1),t(4,Pt=null))}function gi(je){if(!(z!=="hover"||ei||Jt!=="normal")){if(Ft(je)){t(0,ve=!1),t(4,Pt=null);return}t(0,ve=!0),t(4,Pt=je.features??[]),t(10,$=je.lngLat)}}function Ai(je){if(Jt==="justOpened"){t(25,Jt="normal");return}if(!P)return;let rt=[Zt,a instanceof Qr.Marker?a==null?void 0:a.getElement():null];ve&&ft.isOpen()&&!rt.some(xt=>xt==null?void 0:xt.contains(je.originalEvent.target))&&(je.type==="contextmenu"&&z==="contextmenu"||je.type!=="contextmenu")&&t(0,ve=!1)}er(()=>{u&&(ft!=null&&ft.isOpen())&&ft.remove()});let ct;const It=()=>t(0,ve=!1);function Ne(je){Xi[je?"unshift":"push"](()=>{ct=je,t(1,ct)})}return o.$$set=je=>{"closeButton"in je&&t(11,I=je.closeButton),"closeOnClickOutside"in je&&t(12,P=je.closeOnClickOutside),"closeOnClickInside"in je&&t(13,D=je.closeOnClickInside),"closeOnMove"in je&&t(14,R=je.closeOnMove),"openOn"in je&&t(15,z=je.openOn),"openIfTopMost"in je&&t(16,B=je.openIfTopMost),"focusAfterOpen"in je&&t(17,N=je.focusAfterOpen),"anchor"in je&&t(18,V=je.anchor),"offset"in je&&t(19,j=je.offset),"popupClass"in je&&t(20,le=je.popupClass),"maxWidth"in je&&t(21,oe=je.maxWidth),"lngLat"in je&&t(10,$=je.lngLat),"html"in je&&t(22,Y=je.html),"open"in je&&t(0,ve=je.open),"$$scope"in je&&t(29,S=je.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&14336&&t(27,n=I??(!P&&!D)),o.$$.dirty[0]&146685952&&(ft||(t(23,ft=new Qr.Popup({closeButton:n,closeOnClick:!1,closeOnMove:R,focusAfterOpen:N,maxWidth:oe,className:le,anchor:V,offset:j})),Zt=ft.getElement(),ft.on("open",()=>{t(0,ve=!0),ii(),Be("open",ft)}),ft.on("close",()=>{t(0,ve=!1),Be("close",ft)}),ft.on("hover",()=>{Be("hover",ft)}))),o.$$.dirty[0]&8421384&&ft&&a instanceof Qr.Marker&&(z==="click"?a.setPopup(ft):a.getPopup()===ft&&a.setPopup(void 0)),o.$$.dirty[0]&268468224&&bt.includes(z)&&(f==null?void 0:f.type)===z&&(Mt(f),At(qe,f=null,f)),o.$$.dirty[0]&268468224&&t(26,c=z==="hover"&&((f==null?void 0:f.type)==="mousemove"||(f==null?void 0:f.type)==="mouseenter")),o.$$.dirty[0]&352354304&&z==="hover"&&qe&&(c&&f&&(f.layerType==="deckgl"?(t(10,$=f.coordinate),t(4,Pt=f.object?[f.object]:null)):(t(10,$=f.lngLat),t(4,Pt=f.features??[]))),t(0,ve=(c||ot)??!1)),o.$$.dirty[0]&12582914&&(ct?ft.setDOMContent(ct):Y&&ft.setHTML(Y)),o.$$.dirty[0]&8389632&&$&&ft.setLngLat($),o.$$.dirty[0]&41943045&&u){let je=ft.isOpen();ve&&!je?(ft.addTo(u),Jt==="opening"&&t(25,Jt="justOpened")):!ve&&je&&ft.remove()}},[ve,ct,u,a,Pt,te,ne,qe,Ce,k,$,I,P,D,R,z,B,N,V,j,le,oe,Y,ft,ot,Jt,c,n,f,S,x,It,Ne]}class dS extends Ht{constructor(e){super(),Wt(this,e,hS,uS,Ut,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}const fS=o=>({props:o&8}),U_=o=>({props:gS(o[3])});function pS(o){let e;const t=o[1].default,n=Bi(t,o,o[2],U_);return{c(){n&&n.c()},m(c,u){n&&n.m(c,u),e=!0},p(c,u){n&&n.p&&(!e||u&12)&&Oi(n,t,c,c[2],e?Fi(t,c[2],u,fS):Ni(c[2]),U_)},i(c){e||(re(n,c),e=!0)},o(c){ce(n,c),e=!1},d(c){n&&n.d(c)}}}function mS(o){let e,t;return e=new dS({props:{openOn:o[0],$$slots:{default:[pS,({features:n})=>({3:n}),({features:n})=>n?8:0]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,[c]){const u={};c&1&&(u.openOn=n[0]),c&12&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function gS(o){return o?o[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function _S(o,e,t){let{$$slots:n={},$$scope:c}=e,{openOn:u="hover"}=e;return o.$$set=f=>{"openOn"in f&&t(0,u=f.openOn),"$$scope"in f&&t(2,c=f.$$scope)},[u,n,c]}class is extends Ht{constructor(e){super(),Wt(this,e,_S,mS,Ut,{openOn:0})}}const yS=["==",["geometry-type"],"Polygon"],vS=["==",["geometry-type"],"LineString"];function N0(o,e,t){let n=["match",o];for(let[c,u]of Object.entries(e))n.push(c),n.push(u);return n.push(t),n}function Xl(){return{type:"FeatureCollection",features:[]}}const bS=o=>({}),V_=o=>({}),wS=o=>({}),q_=o=>({}),xS=o=>({}),Z_=o=>({});function kS(o){let e,t,n,c,u,f;const a=o[1].top,_=Bi(a,o,o[0],Z_),x=o[1].left,S=Bi(x,o,o[0],q_),k=o[1].main,I=Bi(k,o,o[0],V_);return{c(){e=ue("div"),_&&_.c(),t=Fe(),n=ue("div"),S&&S.c(),c=Fe(),u=ue("div"),I&&I.c(),Te(e,"class","top svelte-mpick2"),Te(n,"class","left svelte-mpick2"),Te(u,"class","main svelte-mpick2")},m(P,D){de(P,e,D),_&&_.m(e,null),de(P,t,D),de(P,n,D),S&&S.m(n,null),de(P,c,D),de(P,u,D),I&&I.m(u,null),f=!0},p(P,[D]){_&&_.p&&(!f||D&1)&&Oi(_,a,P,P[0],f?Fi(a,P[0],D,xS):Ni(P[0]),Z_),S&&S.p&&(!f||D&1)&&Oi(S,x,P,P[0],f?Fi(x,P[0],D,wS):Ni(P[0]),q_),I&&I.p&&(!f||D&1)&&Oi(I,k,P,P[0],f?Fi(k,P[0],D,bS):Ni(P[0]),V_)},i(P){f||(re(_,P),re(S,P),re(I,P),f=!0)},o(P){ce(_,P),ce(S,P),ce(I,P),f=!1},d(P){P&&(he(e),he(t),he(n),he(c),he(u)),_&&_.d(P),S&&S.d(P),I&&I.d(P)}}}function SS(o,e,t){let{$$slots:n={},$$scope:c}=e;return o.$$set=u=>{"$$scope"in u&&t(0,c=u.$$scope)},[c,n]}class TS extends Ht{constructor(e){super(),Wt(this,e,SS,kS,Ut,{})}}const ES=o=>({}),G_=o=>({}),CS=o=>({}),W_=o=>({}),MS=o=>({}),H_=o=>({});function IS(o){let e,t,n,c,u,f;const a=o[4].top,_=Bi(a,o,o[3],H_),x=o[4].sidebar,S=Bi(x,o,o[3],W_),k=o[4].map,I=Bi(k,o,o[3],G_);return{c(){e=ue("div"),_&&_.c(),t=Fe(),n=ue("div"),S&&S.c(),c=Fe(),u=ue("div"),I&&I.c()},m(P,D){de(P,e,D),_&&_.m(e,null),o[5](e),de(P,t,D),de(P,n,D),S&&S.m(n,null),o[6](n),de(P,c,D),de(P,u,D),I&&I.m(u,null),o[7](u),f=!0},p(P,[D]){_&&_.p&&(!f||D&8)&&Oi(_,a,P,P[3],f?Fi(a,P[3],D,MS):Ni(P[3]),H_),S&&S.p&&(!f||D&8)&&Oi(S,x,P,P[3],f?Fi(x,P[3],D,CS):Ni(P[3]),W_),I&&I.p&&(!f||D&8)&&Oi(I,k,P,P[3],f?Fi(k,P[3],D,ES):Ni(P[3]),G_)},i(P){f||(re(_,P),re(S,P),re(I,P),f=!0)},o(P){ce(_,P),ce(S,P),ce(I,P),f=!1},d(P){P&&(he(e),he(t),he(n),he(c),he(u)),_&&_.d(P),o[5](null),S&&S.d(P),o[6](null),I&&I.d(P),o[7](null)}}}function LS(o,e,t){let n,c,u;dt(o,fp,k=>t(0,n=k)),dt(o,pp,k=>t(1,c=k)),dt(o,mp,k=>t(2,u=k));let{$$slots:f={},$$scope:a}=e;function _(k){Xi[k?"unshift":"push"](()=>{n=k,fp.set(n)})}function x(k){Xi[k?"unshift":"push"](()=>{c=k,pp.set(c)})}function S(k){Xi[k?"unshift":"push"](()=>{u=k,mp.set(u)})}return o.$$set=k=>{"$$scope"in k&&t(3,a=k.$$scope)},[n,c,u,a,f,_,x,S]}class ns extends Ht{constructor(e){super(),Wt(this,e,LS,IS,Ut,{})}}let fp=wi(null),pp=wi(null),mp=wi(null);function AS(o){let e,t,n,c,u,f,a,_,x;return{c(){e=ue("label"),t=Qe(`Basemap:
  `),n=ue("select"),c=ue("option"),c.textContent="MapTiler Dataviz",u=ue("option"),u.textContent="MapTiler Streets",f=ue("option"),f.textContent="MapTiler Satellite",a=ue("option"),a.textContent="OS Open Zoomstack",c.__value="dataviz",Hn(c,c.__value),u.__value="streets-v2",Hn(u,u.__value),f.__value="hybrid",Hn(f,f.__value),a.__value="uk-openzoomstack-light",Hn(a,a.__value),o[0]===void 0&&Yl(()=>o[1].call(n))},m(S,k){de(S,e,k),ie(e,t),ie(e,n),ie(n,c),ie(n,u),ie(n,f),ie(n,a),Jl(n,o[0],!0),_||(x=Et(n,"change",o[1]),_=!0)},p(S,[k]){k&1&&Jl(n,S[0])},i:Dt,o:Dt,d(S){S&&he(e),_=!1,x()}}}function PS(o,e,t){let n;dt(o,ep,u=>t(0,n=u));function c(){n=wp(this),ep.set(n)}return[n,c]}class zS extends Ht{constructor(e){super(),Wt(this,e,PS,AS,Ut,{})}}let hd=wi(!0);function DS(o){let e,t;return e=new Cs({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:o[0]?"none":"visible"}}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c&1&&(u.layout={visibility:n[0]?"none":"visible"}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function RS(o){let e,t;return e=new cr({props:{data:o[1],$$slots:{default:[DS]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,[c]){const u={};c&5&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function BS(o,e,t){let n;return dt(o,hd,u=>t(0,n=u)),[n,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class FS extends Ht{constructor(e){super(),Wt(this,e,BS,RS,Ut,{})}}function OS(o){let e,t;return e=new Md({props:{lngLat:o[0],$$slots:{default:[jS]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c&1&&(u.lngLat=n[0]),c&16&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function NS(o){let e,t,n;function c(f){o[3](f)}let u={draggable:!0,$$slots:{default:[US]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.lngLat=o[0]),e=new Md({props:u}),Xi.push(()=>Wr(e,"lngLat",c)),{c(){Re(e.$$.fragment)},m(f,a){ze(e,f,a),n=!0},p(f,a){const _={};a&16&&(_.$$scope={dirty:a,ctx:f}),!t&&a&1&&(t=!0,_.lngLat=f[0],Gr(()=>t=!1)),e.$set(_)},i(f){n||(re(e.$$.fragment,f),n=!0)},o(f){ce(e.$$.fragment,f),n=!1},d(f){De(e,f)}}}function jS(o){let e,t;const n=o[2].default,c=Bi(n,o,o[4],null);return{c(){e=ue("span"),c&&c.c(),Te(e,"class","dot svelte-1gcxp27")},m(u,f){de(u,e,f),c&&c.m(e,null),t=!0},p(u,f){c&&c.p&&(!t||f&16)&&Oi(c,n,u,u[4],t?Fi(n,u[4],f,null):Ni(u[4]),null)},i(u){t||(re(c,u),t=!0)},o(u){ce(c,u),t=!1},d(u){u&&he(e),c&&c.d(u)}}}function US(o){let e,t;const n=o[2].default,c=Bi(n,o,o[4],null);return{c(){e=ue("span"),c&&c.c(),Te(e,"class","dot svelte-1gcxp27")},m(u,f){de(u,e,f),c&&c.m(e,null),t=!0},p(u,f){c&&c.p&&(!t||f&16)&&Oi(c,n,u,u[4],t?Fi(n,u[4],f,null):Ni(u[4]),null)},i(u){t||(re(c,u),t=!0)},o(u){ce(c,u),t=!1},d(u){u&&he(e),c&&c.d(u)}}}function VS(o){let e,t,n,c;const u=[NS,OS],f=[];function a(_,x){return _[1]?0:1}return e=a(o),t=f[e]=u[e](o),{c(){t.c(),n=Bn()},m(_,x){f[e].m(_,x),de(_,n,x),c=!0},p(_,[x]){let S=e;e=a(_),e===S?f[e].p(_,x):(_i(),ce(f[S],1,1,()=>{f[S]=null}),yi(),t=f[e],t?t.p(_,x):(t=f[e]=u[e](_),t.c()),re(t,1),t.m(n.parentNode,n))},i(_){c||(re(t),c=!0)},o(_){ce(t),c=!1},d(_){_&&he(n),f[e].d(_)}}}function qS(o,e,t){let{$$slots:n={},$$scope:c}=e,{lngLat:u}=e,{draggable:f=!1}=e;function a(_){u=_,t(0,u)}return o.$$set=_=>{"lngLat"in _&&t(0,u=_.lngLat),"draggable"in _&&t(1,f=_.draggable),"$$scope"in _&&t(4,c=_.$$scope)},[u,f,n,a,c]}class Fu extends Ht{constructor(e){super(),Wt(this,e,qS,VS,Ut,{lngLat:0,draggable:1})}}const ZS="/ltn/assets/help-d011708a.svg";function $_(o){let e,t;return e=new Sd({props:{$$slots:{default:[GS]},$$scope:{ctx:o}}}),e.$on("close",o[3]),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c&16&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function GS(o){let e,t,n;const c=o[1].default,u=Bi(c,o,o[4],null);return{c(){e=ue("h2"),e.textContent="Help",t=Fe(),u&&u.c()},m(f,a){de(f,e,a),de(f,t,a),u&&u.m(f,a),n=!0},p(f,a){u&&u.p&&(!n||a&16)&&Oi(u,c,f,f[4],n?Fi(c,f[4],a,null):Ni(f[4]),null)},i(f){n||(re(u,f),n=!0)},o(f){ce(u,f),n=!1},d(f){f&&(he(e),he(t)),u&&u.d(f)}}}function WS(o){let e,t,n,c,u,f,a=o[0]&&$_(o);return{c(){e=ue("button"),e.innerHTML=`<img src="${ZS}" title="Help" alt="Help"/>`,t=Fe(),a&&a.c(),n=Bn(),Te(e,"class","svelte-gb6dzm")},m(_,x){de(_,e,x),de(_,t,x),a&&a.m(_,x),de(_,n,x),c=!0,u||(f=Et(e,"click",o[2]),u=!0)},p(_,[x]){_[0]?a?(a.p(_,x),x&1&&re(a,1)):(a=$_(_),a.c(),re(a,1),a.m(n.parentNode,n)):a&&(_i(),ce(a,1,1,()=>{a=null}),yi())},i(_){c||(re(a),c=!0)},o(_){ce(a),c=!1},d(_){_&&(he(e),he(t),he(n)),a&&a.d(_),u=!1,f()}}}function HS(o,e,t){let{$$slots:n={},$$scope:c}=e,u=!1;const f=()=>t(0,u=!0),a=()=>t(0,u=!1);return o.$$set=_=>{"$$scope"in _&&t(4,c=_.$$scope)},[u,n,f,a,c]}class jp extends Ht{constructor(e){super(),Wt(this,e,HS,WS,Ut,{})}}function $S(o){let e,t,n,c;const u=o[1].default,f=Bi(u,o,o[0],null);return{c(){e=ue("a"),f&&f.c(),Te(e,"href","#")},m(a,_){de(a,e,_),f&&f.m(e,null),t=!0,n||(c=Et(e,"click",vp(o[2])),n=!0)},p(a,[_]){f&&f.p&&(!t||_&1)&&Oi(f,u,a,a[0],t?Fi(u,a[0],_,null):Ni(a[0]),null)},i(a){t||(re(f,a),t=!0)},o(a){ce(f,a),t=!1},d(a){a&&he(e),f&&f.d(a),n=!1,c()}}}function XS(o,e,t){let{$$slots:n={},$$scope:c}=e;function u(f){ui.call(this,o,f)}return o.$$set=f=>{"$$scope"in f&&t(0,c=f.$$scope)},[c,n,u]}class Pi extends Ht{constructor(e){super(),Wt(this,e,XS,$S,Ut,{})}}function KS(o,e){let t=new Set(o.getStyle().layers.filter(n=>n.type=="line").map(n=>n.id));return e=="dataviz"?["Road network","Path"].filter(n=>t.has(n)):e=="hybrid"?["Path","Road","Tunnel"].filter(n=>t.has(n)):e=="streets-v2"?o.getStyle().layers.filter(n=>n["source-layer"]=="transportation"&&n.type=="line").map(n=>n.id):e=="uk-openzoomstack-light"?o.getStyle().layers.filter(n=>n["source-layer"]=="roads"&&n.type=="line").map(n=>n.id):[]}const{window:JS}=xd;function YS(o){let e,t,n,c,u,f,a,_,x,S,k,I,P,D,R;return P=Uy(o[8][0]),{c(){e=ue("button"),e.textContent="Stop StreetView",t=Fe(),n=ue("fieldset"),c=ue("legend"),c.textContent="Source:",u=Fe(),f=ue("label"),a=ue("input"),_=Qe(`
      Google Street View`),x=Fe(),S=ue("label"),k=ue("input"),I=Qe(`
      Bing Streetside`),Te(e,"class","secondary"),Te(a,"type","radio"),a.__value="google",Hn(a,a.__value),Te(k,"type","radio"),k.__value="bing",Hn(k,k.__value),P.p(a,k)},m(z,B){de(z,e,B),de(z,t,B),de(z,n,B),ie(n,c),ie(n,u),ie(n,f),ie(f,a),a.checked=a.__value===o[0],ie(f,_),ie(n,x),ie(n,S),ie(S,k),k.checked=k.__value===o[0],ie(S,I),D||(R=[Et(e,"click",o[3]),Et(a,"change",o[7]),Et(k,"change",o[9])],D=!0)},p(z,B){B&1&&(a.checked=a.__value===z[0]),B&1&&(k.checked=k.__value===z[0])},d(z){z&&(he(e),he(t),he(n)),P.r(),D=!1,ln(R)}}}function QS(o){let e,t,n;return{c(){e=ue("button"),e.textContent="StreetView",Te(e,"class","secondary")},m(c,u){de(c,e,u),t||(n=Et(e,"click",o[2]),t=!0)},p:Dt,d(c){c&&he(e),t=!1,n()}}}function e4(o){let e,t,n;function c(a,_){return a[1]?QS:YS}let u=c(o),f=u(o);return{c(){f.c(),e=Bn()},m(a,_){f.m(a,_),de(a,e,_),t||(n=Et(JS,"keydown",o[4]),t=!0)},p(a,[_]){u===(u=c(a))&&f?f.p(a,_):(f.d(1),f=u(a),f&&(f.c(),f.m(e.parentNode,e)))},i:Dt,o:Dt,d(a){a&&he(e),f.d(a),t=!1,n()}}}function t4(o,e,t){let n;dt(o,hd,R=>t(1,n=R));let{map:c}=e,{maptilerBasemap:u}=e,f="google",a=[];function _(){At(hd,n=!1,n),c.on("click",S),c.getCanvas().style.cursor="crosshair";for(let R of KS(c,u))a.push([R,c.getPaintProperty(R,"line-color")]),c.setPaintProperty(R,"line-color","cyan")}function x(){At(hd,n=!0,n),c.off("click",S),c.getCanvas().style.cursor="inherit";for(let[R,z]of a)c.setPaintProperty(R,"line-color",z);a=[]}er(x);function S(R){let z=R.lngLat.lng,B=R.lngLat.lat;f=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${B},${z}&cbp=11,0,0,0,0`,"_blank"):f=="bing"&&window.open(`https://www.bing.com/maps?cp=${B}~${z}&style=x`,"_blank")}function k(R){!n&&R.key=="Escape"&&(R.stopPropagation(),x())}const I=[[]];function P(){f=this.__value,t(0,f)}function D(){f=this.__value,t(0,f)}return o.$$set=R=>{"map"in R&&t(5,c=R.map),"maptilerBasemap"in R&&t(6,u=R.maptilerBasemap)},[f,n,_,x,k,c,u,P,I,D]}class i4 extends Ht{constructor(e){super(),Wt(this,e,t4,e4,Ut,{map:5,maptilerBasemap:6})}}function pn(o,e=!0){return{id:o,beforeId:n4(o),eventsIfTopMost:e}}function n4(o){let e=Lr(es);if(!e){console.warn(`getBeforeId(${o}) called before map is ready. Z-ordering may be incorrect.`);return}let t,n=!1;for(let c=X_.length-1;c>=0;c--){let u=X_[c];if(u==o){n=!0;break}e.getLayer(u)&&(t=u)}if(!n)throw new Error(`Layer ID ${o} not defined in layerZorder`);return t}let Zf=o=>o,Gf=o=>o;const X_=[Zf(Gf("Background")),"neighbourhood-boundaries",Zf("Ferry line"),"debug-borders","debug-crosses","debug-filters","cells","interior-roads-outlines","interior-roads","compare-route","shortcuts","shortcuts-focus",Gf("Building"),"draw-area-lines","draw-area-preview","one-ways",Gf("Road labels"),Zf("road_label"),"animate-shortcuts","modal-filters","boundary","neighbourhood-boundary","border-arrows","border-arrow-outlines","auto-boundaries-areas","auto-boundaries-severances","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];function r4(o){return["interpolate",["linear"],["zoom"],5,.5+o,10,1+o,12,1.5+o,14,4+o,16,7+o,20,24+o]}function o4(o){let e;return{c(){e=Qe("Back")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function s4(o){let e,t,n,c;return e=new Pi({props:{$$slots:{default:[o4]},$$scope:{ctx:o}}}),e.$on("click",o[2]),{c(){Re(e.$$.fragment)},m(u,f){ze(e,u,f),t=!0,n||(c=Et(window,"keydown",o[1]),n=!0)},p(u,[f]){const a={};f&8&&(a.$$scope={dirty:f,ctx:u}),e.$set(a)},i(u){t||(re(e.$$.fragment,u),t=!0)},o(u){ce(e.$$.fragment,u),t=!1},d(u){De(e,u),n=!1,c()}}}function a4(o){let e=ts();function t(c){c.key=="Escape"&&(c.stopPropagation(),e("click"))}return[e,t,()=>e("click")]}class qu extends Ht{constructor(e){super(),Wt(this,e,a4,s4,Ut,{})}}function gp(o,e,t){let n=new Set(o.toSavefile().features.filter(c=>c.properties.kind=="boundary").map(c=>c.properties.name));for(;;){let c=window.prompt(e,t);if(!c)return null;if(n.has(c))window.alert(`There is already a neighbourhood called ${c}; please pick another name`);else return c}}function l4(o){let e;return{c(){e=Qe("Choose project")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function c4(o){let e;return{c(){e=Qe("Pick neighbourhood")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function u4(o){let e,t,n,c,u,f,a,_,x,S,k;return u=new Pi({props:{$$slots:{default:[l4]},$$scope:{ctx:o}}}),u.$on("click",o[10]),_=new Pi({props:{$$slots:{default:[c4]},$$scope:{ctx:o}}}),_.$on("click",o[11]),{c(){e=ue("div"),t=ue("nav"),n=ue("ul"),c=ue("li"),Re(u.$$.fragment),f=Fe(),a=ue("li"),Re(_.$$.fragment),x=Fe(),S=ue("li"),S.textContent="Use an auto-generated boundary",Te(t,"aria-label","breadcrumb"),Te(e,"slot","top")},m(I,P){de(I,e,P),ie(e,t),ie(t,n),ie(n,c),ze(u,c,null),ie(n,f),ie(n,a),ze(_,a,null),ie(n,x),ie(n,S),k=!0},p(I,P){const D={};P&32768&&(D.$$scope={dirty:P,ctx:I}),u.$set(D);const R={};P&32768&&(R.$$scope={dirty:P,ctx:I}),_.$set(R)},i(I){k||(re(u.$$.fragment,I),re(_.$$.fragment,I),k=!0)},o(I){ce(u.$$.fragment,I),ce(_.$$.fragment,I),k=!1},d(I){I&&he(e),De(u),De(_)}}}function h4(o){let e,t,n,c,u,f,a,_,x,S,k,I,P,D,R,z,B;return t=new qu({}),t.$on("click",o[7]),{c(){e=ue("div"),Re(t.$$.fragment),n=Fe(),c=ue("p"),c.textContent=`Click an area to use it as a neighbourhood. These are generated by finding
      roads, railways, and water that form severances. There are many bugs; this
      is experimental. The colors are arbitrary, just to distinguish better.`,u=Fe(),f=ue("button"),f.textContent="Export to GeoJSON",a=Fe(),_=ue("label"),x=Qe(`Minimum area (km)
      `),S=ue("input"),k=Fe(),I=ue("label"),P=ue("input"),D=Qe(`
      Remove areas not touching a big road`),Te(f,"class","secondary"),Te(S,"type","number"),Te(S,"min","0"),Te(S,"max","1"),Te(S,"step","0.01"),Te(P,"type","checkbox"),Te(e,"slot","sidebar")},m(N,V){de(N,e,V),ze(t,e,null),ie(e,n),ie(e,c),ie(e,u),ie(e,f),ie(e,a),ie(e,_),ie(_,x),ie(_,S),Hn(S,o[0]),ie(e,k),ie(e,I),ie(I,P),P.checked=o[1],ie(I,D),R=!0,z||(B=[Et(f,"click",o[5]),Et(S,"input",o[8]),Et(P,"change",o[9])],z=!0)},p(N,V){V&1&&bp(S.value)!==N[0]&&Hn(S,N[0]),V&2&&(P.checked=N[1])},i(N){R||(re(t.$$.fragment,N),R=!0)},o(N){ce(t.$$.fragment,N),R=!1},d(N){N&&he(e),De(t),z=!1,ln(B)}}}function d4(o){let e,t,n=o[14].area_km2.toFixed(1)+"",c,u,f,a,_,x=o[14].touches_big_road+"",S,k,I=o[14].touches_railway+"",P,D,R=o[14].touches_waterway+"",z;return{c(){e=ue("p"),t=Qe("Area: "),c=Qe(n),u=Qe(" km"),f=Fe(),a=ue("p"),_=Qe("Borders roads = "),S=Qe(x),k=Qe(", railway = "),P=Qe(I),D=Qe(`,
            water = `),z=Qe(R)},m(B,N){de(B,e,N),ie(e,t),ie(e,c),ie(e,u),de(B,f,N),de(B,a,N),ie(a,_),ie(a,S),ie(a,k),ie(a,P),ie(a,D),ie(a,z)},p(B,N){N&16384&&n!==(n=B[14].area_km2.toFixed(1)+"")&&Ci(c,n),N&16384&&x!==(x=B[14].touches_big_road+"")&&Ci(S,x),N&16384&&I!==(I=B[14].touches_railway+"")&&Ci(P,I),N&16384&&R!==(R=B[14].touches_waterway+"")&&Ci(z,R)},d(B){B&&(he(e),he(f),he(a))}}}function f4(o){let e,t;return e=new is({props:{openOn:"hover",$$slots:{default:[d4,({props:n})=>({14:n}),({props:n})=>n?16384:0]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c&49152&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function p4(o){let e,t,n,c;const u=[pn("auto-boundaries-areas"),{filter:o[6](o[0],o[1])},{manageHoverState:!0},{paint:{"fill-color":["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"],"fill-opacity":Fa(.3,.7)}},{hoverCursor:"pointer"}];let f={$$slots:{default:[f4]},$$scope:{ctx:o}};for(let x=0;x<u.length;x+=1)f=an(f,u[x]);e=new Cs({props:f}),e.$on("click",o[4]);const a=[pn("auto-boundaries-severances"),{filter:vS},{manageHoverState:!0},{paint:{"line-color":Fa("black","red"),"line-width":3}}];let _={};for(let x=0;x<a.length;x+=1)_=an(_,a[x]);return n=new fo({props:_}),{c(){Re(e.$$.fragment),t=Fe(),Re(n.$$.fragment)},m(x,S){ze(e,x,S),de(x,t,S),ze(n,x,S),c=!0},p(x,S){const k=S&67?bu(u,[u[0],{filter:x[6](x[0],x[1])},u[2],u[3],u[4]]):{};S&32768&&(k.$$scope={dirty:S,ctx:x}),e.$set(k);const I={};n.$set(I)},i(x){c||(re(e.$$.fragment,x),re(n.$$.fragment,x),c=!0)},o(x){ce(e.$$.fragment,x),ce(n.$$.fragment,x),c=!1},d(x){x&&he(t),De(e,x),De(n,x)}}}function m4(o){let e,t,n;return t=new cr({props:{data:o[3],generateId:!0,$$slots:{default:[p4]},$$scope:{ctx:o}}}),{c(){e=ue("div"),Re(t.$$.fragment),Te(e,"slot","map")},m(c,u){de(c,e,u),ze(t,e,null),n=!0},p(c,u){const f={};u&32771&&(f.$$scope={dirty:u,ctx:c}),t.$set(f)},i(c){n||(re(t.$$.fragment,c),n=!0)},o(c){ce(t.$$.fragment,c),n=!1},d(c){c&&he(e),De(t)}}}function g4(o){let e,t;return e=new ns({props:{$$slots:{map:[m4],sidebar:[h4],top:[u4]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,[c]){const u={};c&32775&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function _4(o,e,t){let n,c,u;dt(o,ri,B=>t(2,n=B)),dt(o,Au,B=>t(12,c=B)),dt(o,Jn,B=>t(13,u=B));let f=u.renderAutoBoundaries(),a=0,_=!0;function x(B){let N=gp(u,"What do you want to name the neighbourhood?","");if(N)try{let V={type:"Feature",properties:{},geometry:f.features[B.detail.features[0].id].geometry};u.setNeighbourhoodBoundary(N,V),ec(),u.setCurrentNeighbourhood(N,c),At(ri,n={mode:"neighbourhood"},n)}catch(V){console.log(V),window.alert("Known georust bug hit, sorry. You may need to just refresh the page now.")}}function S(){pd("auto_boundaries.geojson",JSON.stringify(f,null,"  "))}function k(B,N){let V=["all",yS,[">=",["get","area_km2"],B]];return N&&V.push(["get","touches_big_road"]),V}const I=()=>At(ri,n={mode:"network"},n);function P(){a=bp(this.value),t(0,a)}function D(){_=this.checked,t(1,_)}return[a,_,n,f,x,S,k,I,P,D,()=>At(ri,n={mode:"title",firstLoad:!1},n),()=>At(ri,n={mode:"network"},n)]}class y4 extends Ht{constructor(e){super(),Wt(this,e,_4,g4,Ut,{})}}function v4(o){let e,t;const n=[pn("one-ways"),{filter:["all",["==",["get","kind"],"interior_road"],["!=",["get","direction"],"both"]]},{layout:{"icon-image":"oneway-arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","direction"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","direction_edited"],1,.5]}}];let c={};for(let u=0;u<n.length;u+=1)c=an(c,n[u]);return e=new w0({props:c}),{c(){Re(e.$$.fragment)},m(u,f){ze(e,u,f),t=!0},p(u,[f]){const a={};e.$set(a)},i(u){t||(re(e.$$.fragment,u),t=!0)},o(u){ce(e.$$.fragment,u),t=!1},d(u){De(e,u)}}}class b4 extends Ht{constructor(e){super(),Wt(this,e,null,v4,Ut,{})}}const w4=o=>({}),K_=o=>({}),x4=o=>({}),J_=o=>({});function k4(o){let e,t;const n=[pn("neighbourhood-boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let c={};for(let u=0;u<n.length;u+=1)c=an(c,n[u]);return e=new Cs({props:c}),{c(){Re(e.$$.fragment)},m(u,f){ze(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(re(e.$$.fragment,u),t=!0)},o(u){ce(e.$$.fragment,u),t=!1},d(u){De(e,u)}}}function Y_(o){let e;const t=o[7]["line-popup"],n=Bi(t,o,o[9],J_);return{c(){n&&n.c()},m(c,u){n&&n.m(c,u),e=!0},p(c,u){n&&n.p&&(!e||u&512)&&Oi(n,t,c,c[9],e?Fi(t,c[9],u,x4):Ni(c[9]),J_)},i(c){e||(re(n,c),e=!0)},o(c){ce(n,c),e=!1},d(c){n&&n.d(c)}}}function S4(o){let e,t,n=o[1]&&Y_(o);return{c(){n&&n.c(),e=Bn()},m(c,u){n&&n.m(c,u),de(c,e,u),t=!0},p(c,u){c[1]?n?(n.p(c,u),u&2&&re(n,1)):(n=Y_(c),n.c(),re(n,1),n.m(e.parentNode,e)):n&&(_i(),ce(n,1,1,()=>{n=null}),yi())},i(c){t||(re(n),t=!0)},o(c){ce(n),t=!1},d(c){c&&he(e),n&&n.d(c)}}}function T4(o){let e,t,n,c,u,f,a,_,x,S,k,I,P,D,R;e=new cr({props:{data:Q_(o[0]),$$slots:{default:[k4]},$$scope:{ctx:o}}});const z=[pn("cells"),{filter:["==",["get","kind"],"cell"]},{layout:{visibility:o[3]=="cells"?"none":"visible"}},{paint:{"fill-color":["get","color"],"fill-opacity":.8}}];let B={};for(let ne=0;ne<z.length;ne+=1)B=an(B,z[ne]);n=new Cs({props:B});const N=[pn("border-arrows"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"fill-color":["get","color"]}}];let V={};for(let ne=0;ne<N.length;ne+=1)V=an(V,N[ne]);u=new Cs({props:V});const j=[pn("border-arrow-outlines"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"line-color":"black","line-width":2}}];let le={};for(let ne=0;ne<j.length;ne+=1)le=an(le,j[ne]);a=new fo({props:le});const oe=[pn("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":o[6](o[4],o[0].maxShortcuts,0),"line-color":"black"}}];let $={};for(let ne=0;ne<oe.length;ne+=1)$=an($,oe[ne]);x=new fo({props:$});const Y=[pn("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":o[6](o[4],o[0].maxShortcuts,0),"line-color":o[5](o[3],o[0].maxShortcuts),"line-opacity":Fa(1,.5)}},{manageHoverState:o[1]},{hoverCursor:o[1]?"pointer":void 0}];let ve={$$slots:{default:[S4]},$$scope:{ctx:o}};for(let ne=0;ne<Y.length;ne+=1)ve=an(ve,Y[ne]);k=new fo({props:ve}),k.$on("click",o[8]),P=new b4({});const Be=o[7]["more-layers"],te=Bi(Be,o,o[9],K_);return{c(){Re(e.$$.fragment),t=Fe(),Re(n.$$.fragment),c=Fe(),Re(u.$$.fragment),f=Fe(),Re(a.$$.fragment),_=Fe(),Re(x.$$.fragment),S=Fe(),Re(k.$$.fragment),I=Fe(),Re(P.$$.fragment),D=Fe(),te&&te.c()},m(ne,qe){ze(e,ne,qe),de(ne,t,qe),ze(n,ne,qe),de(ne,c,qe),ze(u,ne,qe),de(ne,f,qe),ze(a,ne,qe),de(ne,_,qe),ze(x,ne,qe),de(ne,S,qe),ze(k,ne,qe),de(ne,I,qe),ze(P,ne,qe),de(ne,D,qe),te&&te.m(ne,qe),R=!0},p(ne,qe){const Ce={};qe&1&&(Ce.data=Q_(ne[0])),qe&512&&(Ce.$$scope={dirty:qe,ctx:ne}),e.$set(Ce);const et=qe&8?bu(z,[z[0],z[1],{layout:{visibility:ne[3]=="cells"?"none":"visible"}},z[3]]):{};n.$set(et);const bt={};u.$set(bt);const ft={};a.$set(ft);const ot=qe&81?bu(oe,[oe[0],oe[1],{paint:{"line-width":ne[6](ne[4],ne[0].maxShortcuts,0),"line-color":"black"}}]):{};x.$set(ot);const Zt=qe&123?bu(Y,[Y[0],Y[1],qe&121&&{paint:{"line-width":ne[6](ne[4],ne[0].maxShortcuts,0),"line-color":ne[5](ne[3],ne[0].maxShortcuts),"line-opacity":Fa(1,.5)}},qe&2&&{manageHoverState:ne[1]},qe&2&&{hoverCursor:ne[1]?"pointer":void 0}]):{};qe&514&&(Zt.$$scope={dirty:qe,ctx:ne}),k.$set(Zt),te&&te.p&&(!R||qe&512)&&Oi(te,Be,ne,ne[9],R?Fi(Be,ne[9],qe,w4):Ni(ne[9]),K_)},i(ne){R||(re(e.$$.fragment,ne),re(n.$$.fragment,ne),re(u.$$.fragment,ne),re(a.$$.fragment,ne),re(x.$$.fragment,ne),re(k.$$.fragment,ne),re(P.$$.fragment,ne),re(te,ne),R=!0)},o(ne){ce(e.$$.fragment,ne),ce(n.$$.fragment,ne),ce(u.$$.fragment,ne),ce(a.$$.fragment,ne),ce(x.$$.fragment,ne),ce(k.$$.fragment,ne),ce(P.$$.fragment,ne),ce(te,ne),R=!1},d(ne){ne&&(he(t),he(c),he(f),he(_),he(S),he(I),he(D)),De(e,ne),De(n,ne),De(u,ne),De(a,ne),De(x,ne),De(k,ne),De(P,ne),te&&te.d(ne)}}}function E4(o){let e,t;return e=new cr({props:{data:o[0],generateId:!0,$$slots:{default:[T4]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,[c]){const u={};c&1&&(u.data=n[0]),c&543&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function Q_(o){let e=o.features.find(t=>t.properties.kind=="boundary");return{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]],e.geometry.coordinates[0]]}}}function C4(o,e,t){let n,c;dt(o,ip,P=>t(3,n=P)),dt(o,np,P=>t(4,c=P));let{$$slots:u={},$$scope:f}=e,{gj:a}=e,{interactive:_=!0}=e,{onClickLine:x=(P,D)=>{}}=e;function S(P,D){return P=="cells"?["get","color"]:D<=2?Fa("white","blue"):Fa(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",D,"#A32015"],"blue")}function k(P,D,R){return!P||D<=2?r4(R):["interpolate",["linear"],["get","shortcuts"],0,5+R,D,25+R]}const I=P=>_&&x(P.detail.features[0],P.detail.event.lngLat);return o.$$set=P=>{"gj"in P&&t(0,a=P.gj),"interactive"in P&&t(1,_=P.interactive),"onClickLine"in P&&t(2,x=P.onClickLine),"$$scope"in P&&t(9,f=P.$$scope)},[a,_,x,n,c,S,k,u,I,f]}class Zu extends Ht{constructor(e){super(),Wt(this,e,C4,E4,Ut,{gj:0,interactive:1,onClickLine:2})}}function M4(o){let e;return{c(){e=Qe("Choose project")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function I4(o){let e;return{c(){e=Qe("Pick neighbourhood")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function L4(o){let e;return{c(){e=Qe("Editing")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function A4(o){let e,t,n,c,u,f,a,_,x,S,k,I,P,D;return u=new Pi({props:{$$slots:{default:[M4]},$$scope:{ctx:o}}}),u.$on("click",o[4]),_=new Pi({props:{$$slots:{default:[I4]},$$scope:{ctx:o}}}),_.$on("click",o[5]),k=new Pi({props:{$$slots:{default:[L4]},$$scope:{ctx:o}}}),k.$on("click",o[6]),{c(){e=ue("div"),t=ue("nav"),n=ue("ul"),c=ue("li"),Re(u.$$.fragment),f=Fe(),a=ue("li"),Re(_.$$.fragment),x=Fe(),S=ue("li"),Re(k.$$.fragment),I=Fe(),P=ue("li"),P.textContent="Debug mode",Te(t,"aria-label","breadcrumb"),Te(e,"slot","top")},m(R,z){de(R,e,z),ie(e,t),ie(t,n),ie(n,c),ze(u,c,null),ie(n,f),ie(n,a),ze(_,a,null),ie(n,x),ie(n,S),ze(k,S,null),ie(n,I),ie(n,P),D=!0},p(R,z){const B={};z&256&&(B.$$scope={dirty:z,ctx:R}),u.$set(B);const N={};z&256&&(N.$$scope={dirty:z,ctx:R}),_.$set(N);const V={};z&256&&(V.$$scope={dirty:z,ctx:R}),k.$set(V)},i(R){D||(re(u.$$.fragment,R),re(_.$$.fragment,R),re(k.$$.fragment,R),D=!0)},o(R){ce(u.$$.fragment,R),ce(_.$$.fragment,R),ce(k.$$.fragment,R),D=!1},d(R){R&&he(e),De(u),De(_),De(k)}}}function P4(o){let e,t,n;return t=new qu({}),t.$on("click",o[3]),{c(){e=ue("div"),Re(t.$$.fragment),Te(e,"slot","sidebar")},m(c,u){de(c,e,u),ze(t,e,null),n=!0},p:Dt,i(c){n||(re(t.$$.fragment,c),n=!0)},o(c){ce(t.$$.fragment,c),n=!1},d(c){c&&he(e),De(t)}}}function z4(o){let e,t;return e=new Td({props:{properties:o[7]}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c&128&&(u.properties=n[7]),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function D4(o){let e,t,n;return t=new is({props:{openOn:"hover",$$slots:{default:[z4,({props:c})=>({7:c}),({props:c})=>c?128:0]},$$scope:{ctx:o}}}),{c(){e=ue("div"),Re(t.$$.fragment),Te(e,"slot","line-popup")},m(c,u){de(c,e,u),ze(t,e,null),n=!0},p(c,u){const f={};u&384&&(f.$$scope={dirty:u,ctx:c}),t.$set(f)},i(c){n||(re(t.$$.fragment,c),n=!0)},o(c){ce(t.$$.fragment,c),n=!1},d(c){c&&he(e),De(t)}}}function R4(o){let e,t;return e=new Td({props:{properties:o[7]}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c&128&&(u.properties=n[7]),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function B4(o){let e,t;return e=new is({props:{openOn:"hover",$$slots:{default:[R4,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c&384&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function F4(o){let e,t;return e=new Td({props:{properties:o[7]}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c&128&&(u.properties=n[7]),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function O4(o){let e,t;return e=new is({props:{openOn:"hover",$$slots:{default:[F4,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c&384&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function N4(o){let e,t,n,c;const u=[pn("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let f={$$slots:{default:[B4]},$$scope:{ctx:o}};for(let x=0;x<u.length;x+=1)f=an(f,u[x]);e=new zp({props:f});const a=[pn("debug-crosses"),{filter:["==",["get","kind"],"crosses"]},{paint:{"line-width":5,"line-color":"blue"}}];let _={$$slots:{default:[O4]},$$scope:{ctx:o}};for(let x=0;x<a.length;x+=1)_=an(_,a[x]);return n=new fo({props:_}),{c(){Re(e.$$.fragment),t=Fe(),Re(n.$$.fragment)},m(x,S){ze(e,x,S),de(x,t,S),ze(n,x,S),c=!0},p(x,S){const k={};S&256&&(k.$$scope={dirty:S,ctx:x}),e.$set(k);const I={};S&256&&(I.$$scope={dirty:S,ctx:x}),n.$set(I)},i(x){c||(re(e.$$.fragment,x),re(n.$$.fragment,x),c=!0)},o(x){ce(e.$$.fragment,x),ce(n.$$.fragment,x),c=!1},d(x){x&&he(t),De(e,x),De(n,x)}}}function j4(o){let e,t;return e=new Td({props:{properties:o[7]}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c&128&&(u.properties=n[7]),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function U4(o){let e,t;return e=new is({props:{openOn:"hover",$$slots:{default:[j4,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c&384&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function V4(o){let e,t;const n=[pn("debug-filters"),{paint:{"circle-radius":15,"circle-color":"black"}}];let c={$$slots:{default:[U4]},$$scope:{ctx:o}};for(let u=0;u<n.length;u+=1)c=an(c,n[u]);return e=new zp({props:c}),{c(){Re(e.$$.fragment)},m(u,f){ze(e,u,f),t=!0},p(u,f){const a={};f&256&&(a.$$scope={dirty:f,ctx:u}),e.$set(a)},i(u){t||(re(e.$$.fragment,u),t=!0)},o(u){ce(e.$$.fragment,u),t=!1},d(u){De(e,u)}}}function q4(o){let e,t,n,c,u;return t=new Zu({props:{gj:tn(o[0]).renderNeighbourhood(),interactive:!0,onClickLine:o[2],$$slots:{"more-layers":[N4],"line-popup":[D4]},$$scope:{ctx:o}}}),c=new cr({props:{data:tn(o[0]).renderModalFilters(),generateId:!0,$$slots:{default:[V4]},$$scope:{ctx:o}}}),{c(){e=ue("div"),Re(t.$$.fragment),n=Fe(),Re(c.$$.fragment),Te(e,"slot","map")},m(f,a){de(f,e,a),ze(t,e,null),ie(e,n),ze(c,e,null),u=!0},p(f,a){const _={};a&1&&(_.gj=tn(f[0]).renderNeighbourhood()),a&256&&(_.$$scope={dirty:a,ctx:f}),t.$set(_);const x={};a&1&&(x.data=tn(f[0]).renderModalFilters()),a&256&&(x.$$scope={dirty:a,ctx:f}),c.$set(x)},i(f){u||(re(t.$$.fragment,f),re(c.$$.fragment,f),u=!0)},o(f){ce(t.$$.fragment,f),ce(c.$$.fragment,f),u=!1},d(f){f&&he(e),De(t),De(c)}}}function Z4(o){let e,t;return e=new ns({props:{$$slots:{map:[q4],sidebar:[P4],top:[A4]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,[c]){const u={};c&259&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function G4(o,e,t){let n,c;return dt(o,Jn,S=>t(0,n=S)),dt(o,ri,S=>t(1,c=S)),[n,c,(S,k)=>window.open(tn(S.properties).way,"_blank"),()=>At(ri,c={mode:"neighbourhood"},c),()=>At(ri,c={mode:"title",firstLoad:!1},c),()=>At(ri,c={mode:"network"},c),()=>At(ri,c={mode:"neighbourhood"},c)]}class W4 extends Ht{constructor(e){super(),Wt(this,e,G4,Z4,Ut,{})}}var co=63710088e-1,j0={centimeters:co*100,centimetres:co*100,degrees:360/(2*Math.PI),feet:co*3.28084,inches:co*39.37,kilometers:co/1e3,kilometres:co/1e3,meters:co,metres:co,miles:co/1609.344,millimeters:co*1e3,millimetres:co*1e3,nauticalmiles:co/1852,radians:1,yards:co*1.0936};function H4(o,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=o,n}function _p(o,e,t={}){if(!o)throw new Error("coordinates is required");if(!Array.isArray(o))throw new Error("coordinates must be an Array");if(o.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ey(o[0])||!ey(o[1]))throw new Error("coordinates must contain numbers");return H4({type:"Point",coordinates:o},e,t)}function $4(o,e="kilometers"){const t=j0[e];if(!t)throw new Error(e+" units is invalid");return o*t}function X4(o,e="kilometers"){const t=j0[e];if(!t)throw new Error(e+" units is invalid");return o/t}function yp(o){return o%(2*Math.PI)*180/Math.PI}function No(o){return o%360*Math.PI/180}function ey(o){return!isNaN(o)&&o!==null&&!Array.isArray(o)}function Ou(o){if(!o)throw new Error("coord is required");if(!Array.isArray(o)){if(o.type==="Feature"&&o.geometry!==null&&o.geometry.type==="Point")return[...o.geometry.coordinates];if(o.type==="Point")return[...o.coordinates]}if(Array.isArray(o)&&o.length>=2&&!Array.isArray(o[0])&&!Array.isArray(o[1]))return[...o];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function K4(o){return o.type==="Feature"?o.geometry:o}function U0(o,e,t={}){if(t.final===!0)return J4(o,e);const n=Ou(o),c=Ou(e),u=No(n[0]),f=No(c[0]),a=No(n[1]),_=No(c[1]),x=Math.sin(f-u)*Math.cos(_),S=Math.cos(a)*Math.sin(_)-Math.sin(a)*Math.cos(_)*Math.cos(f-u);return yp(Math.atan2(x,S))}function J4(o,e){let t=U0(e,o);return t=(t+180)%360,t}function Y4(o,e,t,n={}){const c=Ou(o),u=No(c[0]),f=No(c[1]),a=No(t),_=X4(e,n.units),x=Math.asin(Math.sin(f)*Math.cos(_)+Math.cos(f)*Math.sin(_)*Math.cos(a)),S=u+Math.atan2(Math.sin(a)*Math.sin(_)*Math.cos(f),Math.cos(_)-Math.sin(f)*Math.sin(x)),k=yp(S),I=yp(x);return _p([k,I],n.properties)}function Q4(o,e,t={}){var n=Ou(o),c=Ou(e),u=No(c[1]-n[1]),f=No(c[0]-n[0]),a=No(n[1]),_=No(c[1]),x=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(f/2),2)*Math.cos(a)*Math.cos(_);return $4(2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x)),t.units)}function e3(o,e,t={}){const c=K4(o).coordinates;let u=0;for(let f=0;f<c.length&&!(e>=u&&f===c.length-1);f++)if(u>=e){const a=e-u;if(a){const _=U0(c[f],c[f-1])-180;return Y4(c[f],a,_,t)}else return _p(c[f])}else u+=Q4(c[f],c[f+1],t);return _p(c[c.length-1])}var t3=e3;function i3(o){let e,t;const n=[pn("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let c={};for(let u=0;u<n.length;u+=1)c=an(c,n[u]);return e=new zp({props:c}),{c(){Re(e.$$.fragment)},m(u,f){ze(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(re(e.$$.fragment,u),t=!0)},o(u){ce(e.$$.fragment,u),t=!1},d(u){De(e,u)}}}function n3(o){let e,t;return e=new cr({props:{data:o[0],$$slots:{default:[i3]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,[c]){const u={};c&1&&(u.data=n[0]),c&1024&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}let r3=50,o3=100,s3=.01;function a3(o,e,t){let{paths:n}=e,c=_(),u=x(),f=k(),a=setInterval(I,o3);er(()=>clearInterval(a));function _(){return n.features.map(P=>1/P.properties.directness).reduce((P,D)=>P+D,0)}function x(){return n.features.length==0?[]:Array.from({length:r3},S)}function S(){let P=Math.random()*c,D=0;for(let[R,z]of n.features.entries())if(D+=1/z.properties.directness,P<D)return{idx:R,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${c}`)}function k(){return{type:"FeatureCollection",features:u.map(({idx:P,distance:D})=>t3(n.features[P],D,{units:"kilometers"}))}}function I(){for(let[P,D]of u.entries())D.distance+=s3,D.distance>=n.features[D.idx].properties.length_meters/1e3&&(u[P]=S());t(0,f=k())}return o.$$set=P=>{"paths"in P&&t(1,n=P.paths)},o.$$.update=()=>{o.$$.dirty&2&&n&&(c=_(),u=x())},[f,n]}class l3 extends Ht{constructor(e){super(),Wt(this,e,a3,n3,Ut,{paths:1})}}function c3(o){let e;const t=o[3].default,n=Bi(t,o,o[5],null);return{c(){n&&n.c()},m(c,u){n&&n.m(c,u),e=!0},p(c,u){n&&n.p&&(!e||u&32)&&Oi(n,t,c,c[5],e?Fi(t,c[5],u,null):Ni(c[5]),null)},i(c){e||(re(n,c),e=!0)},o(c){ce(n,c),e=!1},d(c){n&&n.d(c)}}}function u3(o){let e,t;const n=[pn("modal-filters"),{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let c={$$slots:{default:[c3]},$$scope:{ctx:o}};for(let u=0;u<n.length;u+=1)c=an(c,n[u]);return e=new w0({props:c}),e.$on("click",o[4]),{c(){Re(e.$$.fragment)},m(u,f){ze(e,u,f),t=!0},p(u,f){const a={};f&32&&(a.$$scope={dirty:f,ctx:u}),e.$set(a)},i(u){t||(re(e.$$.fragment,u),t=!0)},o(u){ce(e.$$.fragment,u),t=!1},d(u){De(e,u)}}}function h3(o){let e,t;return e=new cr({props:{data:o[0],generateId:!0,$$slots:{default:[u3]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,[c]){const u={};c&1&&(u.data=n[0]),c&32&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function d3(o,e,t){let n,c,u;dt(o,Jn,x=>t(1,c=x)),dt(o,vs,x=>t(2,u=x));let{$$slots:f={},$$scope:a}=e;function _(x){ui.call(this,o,x)}return o.$$set=x=>{"$$scope"in x&&t(5,a=x.$$scope)},o.$$.update=()=>{o.$$.dirty&6&&t(0,n=u>0?c.renderModalFilters():Xl())},[n,c,u,f,_,a]}class Gu extends Ht{constructor(e){super(),Wt(this,e,d3,h3,Ut,{})}}function ty(o,e,t){const n=o.slice();return n[7]=e[t][0],n[8]=e[t][1],n[9]=e[t][2],n}function iy(o){let e,t,n,c,u,f,a=o[8]+"",_,x,S,k,I;function P(){return o[3](o[7])}return{c(){e=ue("button"),t=ue("img"),c=Fe(),u=ue("br"),f=Fe(),_=Qe(a),x=Fe(),En(t.src,n=`/ltn//filters/${o[7]}_icon.gif`)||Te(t,"src",n),Te(t,"width","80"),Te(t,"alt",o[8]),Te(e,"class","outline"),mn(e,"width","100%"),e.disabled=S=o[0]==o[7]},m(D,R){de(D,e,R),ie(e,t),ie(e,c),ie(e,u),ie(e,f),ie(e,_),ie(e,x),k||(I=Et(e,"click",P),k=!0)},p(D,R){o=D,R&1&&S!==(S=o[0]==o[7])&&(e.disabled=S)},d(D){D&&he(e),k=!1,I()}}}function f3(o){let e,t,n,c,u,f,a,_,x,S,k,I,P=o[1][2]+"",D,R,z,B,N,V,j=Kn(o[2]),le=[];for(let $=0;$<j.length;$+=1)le[$]=iy(ty(o,j,$));function oe(){return o[4](o[6])}return{c(){e=ue("h3"),e.textContent="Choose a modal filter to place on streets",t=Fe(),n=ue("table"),c=ue("tr"),u=ue("td");for(let $=0;$<le.length;$+=1)le[$].c();f=Fe(),a=ue("td"),_=ue("img"),k=Fe(),I=ue("p"),D=Qe(P),R=Fe(),z=ue("center"),B=ue("button"),B.textContent="Confirm",En(_.src,x=`/ltn//filters/${o[0]}.gif`)||Te(_,"src",x),Te(_,"height","300"),Te(_,"alt",S=o[1][1])},m($,Y){de($,e,Y),de($,t,Y),de($,n,Y),ie(n,c),ie(c,u);for(let ve=0;ve<le.length;ve+=1)le[ve]&&le[ve].m(u,null);ie(c,f),ie(c,a),ie(a,_),ie(a,k),ie(a,I),ie(I,D),de($,R,Y),de($,z,Y),ie(z,B),N||(V=Et(B,"click",oe),N=!0)},p($,Y){if(o=$,Y&5){j=Kn(o[2]);let ve;for(ve=0;ve<j.length;ve+=1){const Be=ty(o,j,ve);le[ve]?le[ve].p(Be,Y):(le[ve]=iy(Be),le[ve].c(),le[ve].m(u,null))}for(;ve<le.length;ve+=1)le[ve].d(1);le.length=j.length}Y&1&&!En(_.src,x=`/ltn//filters/${o[0]}.gif`)&&Te(_,"src",x),Y&2&&S!==(S=o[1][1])&&Te(_,"alt",S),Y&2&&P!==(P=o[1][2]+"")&&Ci(D,P)},d($){$&&(he(e),he(t),he(n),he(R),he(z)),Ss(le,$),N=!1,V()}}}function p3(o){let e,t;return e=new Sd({props:{$$slots:{default:[f3,({dialog:n})=>({6:n}),({dialog:n})=>n?64:0]},$$scope:{ctx:o}}}),e.$on("close",o[5]),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,[c]){const u={};c&4163&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function m3(o,e,t){let n,c;dt(o,tp,x=>t(0,c=x));let u=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]];const f=x=>At(tp,c=x,c),a=x=>tn(x).close();function _(x){ui.call(this,o,x)}return o.$$.update=()=>{o.$$.dirty&1&&t(1,n=u.find(x=>x[0]==c))},[c,n,u,f,a,_]}class g3 extends Ht{constructor(e){super(),Wt(this,e,m3,p3,Ut,{})}}function ny(o){let e,t;return e=new cr({props:{data:o[0],$$slots:{default:[_3]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c&1&&(u.data=n[0]),c&64&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function _3(o){let e,t;const n=[pn("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let c={};for(let u=0;u<n.length;u+=1)c=an(c,n[u]);return e=new fo({props:c}),{c(){Re(e.$$.fragment)},m(u,f){ze(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(re(e.$$.fragment,u),t=!0)},o(u){ce(e.$$.fragment,u),t=!1},d(u){De(e,u)}}}function y3(o){let e,t,n=o[0]&&ny(o);return{c(){n&&n.c(),e=Bn()},m(c,u){n&&n.m(c,u),de(c,e,u),t=!0},p(c,[u]){c[0]?n?(n.p(c,u),u&1&&re(n,1)):(n=ny(c),n.c(),re(n,1),n.m(e.parentNode,e)):n&&(_i(),ce(n,1,1,()=>{n=null}),yi())},i(c){t||(re(n),t=!0)},o(c){ce(n),t=!1},d(c){c&&he(e),n&&n.d(c)}}}function v3(o,e,t){let{map:n}=e,c=null;const u=ts();n.on("dragstart",f),n.on("mousemove",a),n.on("mouseup",_),er(()=>{n.dragPan.enable(),n.off("dragstart",f),n.off("mousemove",a),n.off("mouseup",_)});function f(){n.dragPan.disable(),t(0,c={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function a(x){c&&(c.geometry.coordinates.push(x.lngLat.toArray()),t(0,c))}function _(){c&&(u("done",c),t(0,c=null))}return o.$$set=x=>{"map"in x&&t(1,n=x.map)},[c,n]}class b3 extends Ht{constructor(e){super(),Wt(this,e,v3,y3,Ut,{map:1})}}function w3(o){let e;return{c(){e=Qe("Choose project")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function x3(o){let e;return{c(){e=Qe("Pick neighbourhood")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function k3(o){let e;return{c(){e=ue("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(t,n){de(t,e,n)},p:Dt,d(t){t&&he(e)}}}function S3(o){let e;return{c(){e=Qe("View shortcuts")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function T3(o){let e;return{c(){e=Qe("Route")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function E3(o){let e;return{c(){e=Qe("Impact routing to one destination")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function C3(o){let e;return{c(){e=Qe("Change this boundary")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function M3(o){let e;return{c(){e=Qe("Debug")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function I3(o){let e,t,n,c,u,f,a,_,x,S,k,I,P,D,R,z,B,N,V,j,le,oe,$,Y,ve,Be,te,ne,qe,Ce;return u=new Pi({props:{$$slots:{default:[w3]},$$scope:{ctx:o}}}),u.$on("click",o[28]),_=new Pi({props:{$$slots:{default:[x3]},$$scope:{ctx:o}}}),_.$on("click",o[29]),I=new jp({props:{$$slots:{default:[k3]},$$scope:{ctx:o}}}),B=new Pi({props:{$$slots:{default:[S3]},$$scope:{ctx:o}}}),B.$on("click",o[30]),j=new Pi({props:{$$slots:{default:[T3]},$$scope:{ctx:o}}}),j.$on("click",o[31]),$=new Pi({props:{$$slots:{default:[E3]},$$scope:{ctx:o}}}),$.$on("click",o[32]),Be=new Pi({props:{$$slots:{default:[C3]},$$scope:{ctx:o}}}),Be.$on("click",o[33]),qe=new Pi({props:{$$slots:{default:[M3]},$$scope:{ctx:o}}}),qe.$on("click",o[34]),{c(){e=ue("div"),t=ue("nav"),n=ue("ul"),c=ue("li"),Re(u.$$.fragment),f=Fe(),a=ue("li"),Re(_.$$.fragment),x=Fe(),S=ue("li"),k=Qe(`Editing
          `),Re(I.$$.fragment),P=Fe(),D=ue("nav"),R=ue("ul"),z=ue("li"),Re(B.$$.fragment),N=Fe(),V=ue("li"),Re(j.$$.fragment),le=Fe(),oe=ue("li"),Re($.$$.fragment),Y=Fe(),ve=ue("li"),Re(Be.$$.fragment),te=Fe(),ne=ue("li"),Re(qe.$$.fragment),Te(t,"aria-label","breadcrumb"),Te(e,"slot","top"),mn(e,"display","flex"),mn(e,"justify-content","space-between")},m(et,bt){de(et,e,bt),ie(e,t),ie(t,n),ie(n,c),ze(u,c,null),ie(n,f),ie(n,a),ze(_,a,null),ie(n,x),ie(n,S),ie(S,k),ze(I,S,null),ie(e,P),ie(e,D),ie(D,R),ie(R,z),ze(B,z,null),ie(R,N),ie(R,V),ze(j,V,null),ie(R,le),ie(R,oe),ze($,oe,null),ie(R,Y),ie(R,ve),ze(Be,ve,null),ie(R,te),ie(R,ne),ze(qe,ne,null),Ce=!0},p(et,bt){const ft={};bt[1]&128&&(ft.$$scope={dirty:bt,ctx:et}),u.$set(ft);const ot={};bt[1]&128&&(ot.$$scope={dirty:bt,ctx:et}),_.$set(ot);const Zt={};bt[1]&128&&(Zt.$$scope={dirty:bt,ctx:et}),I.$set(Zt);const ii={};bt[1]&128&&(ii.$$scope={dirty:bt,ctx:et}),B.$set(ii);const Ft={};bt[1]&128&&(Ft.$$scope={dirty:bt,ctx:et}),j.$set(Ft);const Pt={};bt[1]&128&&(Pt.$$scope={dirty:bt,ctx:et}),$.$set(Pt);const Jt={};bt[1]&128&&(Jt.$$scope={dirty:bt,ctx:et}),Be.$set(Jt);const Mt={};bt[1]&128&&(Mt.$$scope={dirty:bt,ctx:et}),qe.$set(Mt)},i(et){Ce||(re(u.$$.fragment,et),re(_.$$.fragment,et),re(I.$$.fragment,et),re(B.$$.fragment,et),re(j.$$.fragment,et),re($.$$.fragment,et),re(Be.$$.fragment,et),re(qe.$$.fragment,et),Ce=!0)},o(et){ce(u.$$.fragment,et),ce(_.$$.fragment,et),ce(I.$$.fragment,et),ce(B.$$.fragment,et),ce(j.$$.fragment,et),ce($.$$.fragment,et),ce(Be.$$.fragment,et),ce(qe.$$.fragment,et),Ce=!1},d(et){et&&he(e),De(u),De(_),De(I),De(B),De(j),De($),De(Be),De(qe)}}}function ry(o){let e;return{c(){e=ue("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function L3(o){let e,t,n;return{c(){e=Qe("Undo ("),t=Qe(o[4]),n=Qe(")")},m(c,u){de(c,e,u),de(c,t,u),de(c,n,u)},p(c,u){u[0]&16&&Ci(t,c[4])},d(c){c&&(he(e),he(t),he(n))}}}function A3(o){let e;return{c(){e=Qe("Undo")},m(t,n){de(t,e,n)},p:Dt,d(t){t&&he(e)}}}function P3(o){let e,t,n;return{c(){e=Qe("Redo ("),t=Qe(o[5]),n=Qe(")")},m(c,u){de(c,e,u),de(c,t,u),de(c,n,u)},p(c,u){u[0]&32&&Ci(t,c[5])},d(c){c&&(he(e),he(t),he(n))}}}function z3(o){let e;return{c(){e=Qe("Redo")},m(t,n){de(t,e,n)},p:Dt,d(t){t&&he(e)}}}function oy(o){let e,t;return e=new g3({}),e.$on("close",o[27]),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p:Dt,i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function D3(o){let e,t,n,c,u=tn(o[6]).properties.name+"",f,a,_=o[1].area_km2.toFixed(1)+"",x,S,k,I,P,D,R,z,B,N,V,j,le,oe,$,Y,ve,Be,te,ne,qe,Ce,et,bt,ft,ot,Zt,ii,Ft,Pt,Jt,Mt,ei,Vt,hi,xi,gi,Ai,ct,It=o[8]>0&&ry();function Ne($e,kt){return $e[4]==0?A3:L3}let je=Ne(o),rt=je(o);function xt($e,kt){return $e[5]==0?z3:P3}let we=xt(o),di=we(o),Ve=o[3]&&oy(o);return{c(){e=ue("div"),t=ue("p"),n=Qe("Editing neighbourhood "),c=ue("u"),f=Qe(u),a=Qe(`
      , with an area of `),x=Qe(_),S=Qe(" km"),k=Fe(),It&&It.c(),I=Fe(),P=ue("div"),D=ue("button"),R=ue("img"),B=Qe(`
        Add a modal filter`),V=Fe(),j=ue("button"),le=Qe("Add many modal filters along line"),$=Fe(),Y=ue("button"),ve=Qe("Reverse directions"),te=Fe(),ne=ue("button"),ne.textContent="Change modal filter type",qe=Fe(),Ce=ue("label"),et=ue("input"),bt=Qe(`
      Animate shortcuts`),ft=Fe(),ot=ue("label"),Zt=ue("input"),ii=Qe(`
      Include perimeter roads`),Ft=Fe(),Pt=ue("div"),Jt=ue("button"),rt.c(),ei=Fe(),Vt=ue("button"),di.c(),xi=Fe(),Ve&&Ve.c(),En(R.src,z=`/ltn//filters/${o[9]}_icon.gif`)||Te(R,"src",z),Te(R,"width","30"),Te(R,"alt","Add a modal filter"),D.disabled=N=o[0]=="filter",Te(D,"data-tooltip","hotkey 1"),j.disabled=oe=o[0]=="freehand-filters",Te(j,"data-tooltip","hotkey 2"),Y.disabled=Be=o[0]=="oneway",Te(Y,"data-tooltip","hotkey 3"),mn(P,"display","flex"),mn(P,"justify-content","space-between"),Te(et,"type","checkbox"),Te(Zt,"type","checkbox"),Jt.disabled=Mt=o[4]==0,Te(Jt,"data-tooltip","Ctrl+Z"),Vt.disabled=hi=o[5]==0,Te(Vt,"data-tooltip","Ctrl+Y"),mn(Pt,"display","flex"),mn(Pt,"justify-content","space-between"),Te(e,"slot","sidebar")},m($e,kt){de($e,e,kt),ie(e,t),ie(t,n),ie(t,c),ie(c,f),ie(t,a),ie(t,x),ie(t,S),ie(e,k),It&&It.m(e,null),ie(e,I),ie(e,P),ie(P,D),ie(D,R),ie(D,B),ie(P,V),ie(P,j),ie(j,le),ie(P,$),ie(P,Y),ie(Y,ve),ie(e,te),ie(e,ne),ie(e,qe),ie(e,Ce),ie(Ce,et),et.checked=o[11],ie(Ce,bt),ie(e,ft),ie(e,ot),ie(ot,Zt),Zt.checked=o[10],ie(ot,ii),ie(e,Ft),ie(e,Pt),ie(Pt,Jt),rt.m(Jt,null),ie(Pt,ei),ie(Pt,Vt),di.m(Vt,null),ie(e,xi),Ve&&Ve.m(e,null),gi=!0,Ai||(ct=[Et(D,"click",o[21]),Et(j,"click",o[22]),Et(Y,"click",o[23]),Et(ne,"click",o[24]),Et(et,"change",o[25]),Et(Zt,"change",o[26]),Et(Zt,"change",o[13]),Et(Jt,"click",o[17]),Et(Vt,"click",o[18])],Ai=!0)},p($e,kt){(!gi||kt[0]&64)&&u!==(u=tn($e[6]).properties.name+"")&&Ci(f,u),(!gi||kt[0]&2)&&_!==(_=$e[1].area_km2.toFixed(1)+"")&&Ci(x,_),$e[8]>0?It||(It=ry(),It.c(),It.m(e,I)):It&&(It.d(1),It=null),(!gi||kt[0]&512&&!En(R.src,z=`/ltn//filters/${$e[9]}_icon.gif`))&&Te(R,"src",z),(!gi||kt[0]&1&&N!==(N=$e[0]=="filter"))&&(D.disabled=N),(!gi||kt[0]&1&&oe!==(oe=$e[0]=="freehand-filters"))&&(j.disabled=oe),(!gi||kt[0]&1&&Be!==(Be=$e[0]=="oneway"))&&(Y.disabled=Be),kt[0]&2048&&(et.checked=$e[11]),kt[0]&1024&&(Zt.checked=$e[10]),je===(je=Ne($e))&&rt?rt.p($e,kt):(rt.d(1),rt=je($e),rt&&(rt.c(),rt.m(Jt,null))),(!gi||kt[0]&16&&Mt!==(Mt=$e[4]==0))&&(Jt.disabled=Mt),we===(we=xt($e))&&di?di.p($e,kt):(di.d(1),di=we($e),di&&(di.c(),di.m(Vt,null))),(!gi||kt[0]&32&&hi!==(hi=$e[5]==0))&&(Vt.disabled=hi),$e[3]?Ve?(Ve.p($e,kt),kt[0]&8&&re(Ve,1)):(Ve=oy($e),Ve.c(),re(Ve,1),Ve.m(e,null)):Ve&&(_i(),ce(Ve,1,1,()=>{Ve=null}),yi())},i($e){gi||(re(Ve),gi=!0)},o($e){ce(Ve),gi=!1},d($e){$e&&he(e),It&&It.d(),rt.d(),di.d(),Ve&&Ve.d(),Ai=!1,ln(ct)}}}function sy(o){let e,t=Math.round(o[37].speed_mph)+"",n,c;return{c(){e=Qe("("),n=Qe(t),c=Qe(" mph)")},m(u,f){de(u,e,f),de(u,n,f),de(u,c,f)},p(u,f){f[1]&64&&t!==(t=Math.round(u[37].speed_mph)+"")&&Ci(n,t)},d(u){u&&(he(e),he(n),he(c))}}}function R3(o){let e;return{c(){e=ue("p"),e.textContent="Click to change direction"},m(t,n){de(t,e,n)},p:Dt,d(t){t&&he(e)}}}function B3(o){let e,t,n,c;return{c(){e=ue("div"),t=ue("img"),c=Qe(`
              Click to add modal filter`),En(t.src,n=`/ltn//filters/${o[9]}_icon.gif`)||Te(t,"src",n),Te(t,"width","20"),Te(t,"alt","Add modal filter")},m(u,f){de(u,e,f),ie(e,t),ie(e,c)},p(u,f){f[0]&512&&!En(t.src,n=`/ltn//filters/${u[9]}_icon.gif`)&&Te(t,"src",n)},d(u){u&&he(e)}}}function F3(o){let e,t=o[37].shortcuts+"",n,c,u=(o[37].name??"unnamed road")+"",f,a,_,x,S=o[37].speed_mph&&sy(o);function k(D,R){return D[0]=="filter"?B3:R3}let I=k(o),P=I(o);return{c(){e=ue("p"),n=Qe(t),c=Qe(" shortcuts through "),f=Qe(u),a=Fe(),S&&S.c(),_=Fe(),P.c(),x=Bn()},m(D,R){de(D,e,R),ie(e,n),ie(e,c),ie(e,f),ie(e,a),S&&S.m(e,null),de(D,_,R),P.m(D,R),de(D,x,R)},p(D,R){R[1]&64&&t!==(t=D[37].shortcuts+"")&&Ci(n,t),R[1]&64&&u!==(u=(D[37].name??"unnamed road")+"")&&Ci(f,u),D[37].speed_mph?S?S.p(D,R):(S=sy(D),S.c(),S.m(e,null)):S&&(S.d(1),S=null),I===(I=k(D))&&P?P.p(D,R):(P.d(1),P=I(D),P&&(P.c(),P.m(x.parentNode,x)))},d(D){D&&(he(e),he(_),he(x)),S&&S.d(),P.d(D)}}}function O3(o){let e,t,n;return t=new is({props:{openOn:"hover",$$slots:{default:[F3,({props:c})=>({37:c}),({props:c})=>[0,c?64:0]]},$$scope:{ctx:o}}}),{c(){e=ue("div"),Re(t.$$.fragment),Te(e,"slot","line-popup")},m(c,u){de(c,e,u),ze(t,e,null),n=!0},p(c,u){const f={};u[0]&513|u[1]&192&&(f.$$scope={dirty:u,ctx:c}),t.$set(f)},i(c){n||(re(t.$$.fragment,c),n=!0)},o(c){ce(t.$$.fragment,c),n=!1},d(c){c&&he(e),De(t)}}}function ay(o){let e,t;return e=new l3({props:{paths:o[7]}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c[0]&128&&(u.paths=n[7]),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function N3(o){let e;return{c(){e=Qe("Click to delete")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function j3(o){let e,t;return e=new is({props:{openOn:"hover",$$slots:{default:[N3]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c[1]&128&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function ly(o){let e,t;return e=new b3({props:{map:tn(o[2])}}),e.$on("done",o[19]),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c[0]&4&&(u.map=tn(n[2])),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function U3(o){let e,t,n,c,u,f,a;t=new Zu({props:{gj:o[1],interactive:o[0]=="filter"||o[0]=="oneway",onClickLine:o[14],$$slots:{"line-popup":[O3]},$$scope:{ctx:o}}});let _=o[11]&&ay(o);u=new Gu({props:{$$slots:{default:[j3]},$$scope:{ctx:o}}}),u.$on("click",o[15]);let x=o[0]=="freehand-filters"&&ly(o);return{c(){e=ue("div"),Re(t.$$.fragment),n=Fe(),_&&_.c(),c=Fe(),Re(u.$$.fragment),f=Fe(),x&&x.c(),Te(e,"slot","map")},m(S,k){de(S,e,k),ze(t,e,null),ie(e,n),_&&_.m(e,null),ie(e,c),ze(u,e,null),ie(e,f),x&&x.m(e,null),a=!0},p(S,k){const I={};k[0]&2&&(I.gj=S[1]),k[0]&1&&(I.interactive=S[0]=="filter"||S[0]=="oneway"),k[0]&513|k[1]&128&&(I.$$scope={dirty:k,ctx:S}),t.$set(I),S[11]?_?(_.p(S,k),k[0]&2048&&re(_,1)):(_=ay(S),_.c(),re(_,1),_.m(e,c)):_&&(_i(),ce(_,1,1,()=>{_=null}),yi());const P={};k[1]&128&&(P.$$scope={dirty:k,ctx:S}),u.$set(P),S[0]=="freehand-filters"?x?(x.p(S,k),k[0]&1&&re(x,1)):(x=ly(S),x.c(),re(x,1),x.m(e,null)):x&&(_i(),ce(x,1,1,()=>{x=null}),yi())},i(S){a||(re(t.$$.fragment,S),re(_),re(u.$$.fragment,S),re(x),a=!0)},o(S){ce(t.$$.fragment,S),ce(_),ce(u.$$.fragment,S),ce(x),a=!1},d(S){S&&he(e),De(t),_&&_.d(),De(u),x&&x.d()}}}function V3(o){let e,t,n,c;return e=new ns({props:{$$slots:{map:[U3],sidebar:[D3],top:[I3]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(u,f){ze(e,u,f),t=!0,n||(c=Et(window,"keydown",o[16]),n=!0)},p(u,f){const a={};f[0]&8191|f[1]&128&&(a.$$scope={dirty:f,ctx:u}),e.$set(a)},i(u){t||(re(e.$$.fragment,u),t=!0)},o(u){ce(e.$$.fragment,u),t=!1},d(u){De(e,u),n=!1,c()}}}function q3(o,e,t){let n,c,u,f,a,_,x,S;dt(o,vs,Mt=>t(20,c=Mt)),dt(o,tp,Mt=>t(9,u=Mt)),dt(o,Jn,Mt=>t(35,f=Mt)),dt(o,Au,Mt=>t(10,a=Mt)),dt(o,es,Mt=>t(2,_=Mt)),dt(o,Cg,Mt=>t(11,x=Mt)),dt(o,ri,Mt=>t(12,S=Mt));let k="filter",I=!1,P=0,D=0,R,z,B=f.getAllShortcuts();er(()=>{_.doubleClickZoom.enable()});function N(Mt){t(1,z=f.renderNeighbourhood()),t(6,R=z.features.find(ei=>ei.properties.kind=="boundary")),t(4,P=z.undo_length),t(5,D=z.redo_length),t(7,B=f.getAllShortcuts()),ec()}function V(){f.setCurrentNeighbourhood(R.properties.name,a),At(vs,c++,c)}function j(Mt,ei){k=="filter"?(f.addModalFilter(ei,u),At(vs,c++,c)):k=="oneway"&&(f.toggleDirection(Mt.properties.road),At(vs,c++,c))}function le(Mt){let ei=Mt.detail.features[0];f.deleteModalFilter(ei.properties.road),At(vs,c++,c)}function oe(Mt){Mt.target.tagName!="INPUT"&&(Mt.ctrlKey&&Mt.key=="z"&&$(),Mt.ctrlKey&&Mt.key=="y"&&Y(),Mt.key=="1"&&t(0,k="filter"),Mt.key=="2"&&t(0,k="freehand-filters"),Mt.key=="3"&&t(0,k="oneway"))}function $(){f.undo(),At(vs,c++,c)}function Y(){f.redo(),At(vs,c++,c)}function ve(Mt){let ei=Mt.detail;ei&&(f.addManyModalFilters(ei,u),At(vs,c++,c)),t(0,k="filter")}const Be=()=>t(0,k="filter"),te=()=>t(0,k="freehand-filters"),ne=()=>t(0,k="oneway"),qe=()=>t(3,I=!0);function Ce(){x=this.checked,Cg.set(x)}function et(){a=this.checked,Au.set(a)}const bt=()=>t(3,I=!1),ft=()=>At(ri,S={mode:"title",firstLoad:!1},S),ot=()=>At(ri,S={mode:"network"},S),Zt=()=>At(ri,S={mode:"view-shortcuts"},S),ii=()=>At(ri,S={mode:"route",prevMode:"neighbourhood"},S),Ft=()=>At(ri,S={mode:"impact-one-destination"},S),Pt=()=>At(ri,S={mode:"set-boundary",name:tn(R).properties.name,existing:R},S),Jt=()=>At(ri,S={mode:"debug"},S);return o.$$.update=()=>{o.$$.dirty[0]&5&&(k=="oneway"?_.doubleClickZoom.disable():_.doubleClickZoom.enable()),o.$$.dirty[0]&1048576&&N(),o.$$.dirty[0]&2&&t(8,n=z.features.filter(Mt=>Mt.properties.kind=="cell"&&Mt.properties.cell_color=="disconnected").length)},[k,z,_,I,P,D,R,B,n,u,a,x,S,V,j,le,oe,$,Y,ve,c,Be,te,ne,qe,Ce,et,bt,ft,ot,Zt,ii,Ft,Pt,Jt]}class Z3 extends Ht{constructor(e){super(),Wt(this,e,q3,V3,Ut,{},null,[-1,-1])}}function G3(o){let e;return{c(){e=Qe("Choose project")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function W3(o){let e;return{c(){e=Qe("Pick neighbourhood")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function H3(o){let e;return{c(){e=Qe("Editing")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function $3(o){let e,t,n,c,u,f,a,_,x,S,k,I,P,D;return u=new Pi({props:{$$slots:{default:[G3]},$$scope:{ctx:o}}}),u.$on("click",o[12]),_=new Pi({props:{$$slots:{default:[W3]},$$scope:{ctx:o}}}),_.$on("click",o[13]),k=new Pi({props:{$$slots:{default:[H3]},$$scope:{ctx:o}}}),k.$on("click",o[6]),{c(){e=ue("div"),t=ue("nav"),n=ue("ul"),c=ue("li"),Re(u.$$.fragment),f=Fe(),a=ue("li"),Re(_.$$.fragment),x=Fe(),S=ue("li"),Re(k.$$.fragment),I=Fe(),P=ue("li"),P.textContent="Impact routing to one destination",Te(t,"aria-label","breadcrumb"),Te(e,"slot","top")},m(R,z){de(R,e,z),ie(e,t),ie(t,n),ie(n,c),ze(u,c,null),ie(n,f),ie(n,a),ze(_,a,null),ie(n,x),ie(n,S),ze(k,S,null),ie(n,I),ie(n,P),D=!0},p(R,z){const B={};z&262144&&(B.$$scope={dirty:z,ctx:R}),u.$set(B);const N={};z&262144&&(N.$$scope={dirty:z,ctx:R}),_.$set(N);const V={};z&262144&&(V.$$scope={dirty:z,ctx:R}),k.$set(V)},i(R){D||(re(u.$$.fragment,R),re(_.$$.fragment,R),re(k.$$.fragment,R),D=!0)},o(R){ce(u.$$.fragment,R),ce(_.$$.fragment,R),ce(k.$$.fragment,R),D=!1},d(R){R&&he(e),De(u),De(_),De(k)}}}function X3(o){let e,t,n,c,u,f,a,_,x,S=o[4].highest_ratio.toFixed(1)+"",k,I;return t=new qu({}),t.$on("click",o[6]),{c(){e=ue("div"),Re(t.$$.fragment),n=Fe(),c=ue("p"),c.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin aroun to change that destination.`,u=Fe(),f=ue("p"),f.textContent="TODO: It's just distance right now, not time",a=Fe(),_=ue("p"),x=Qe("Highest ratio is "),k=Qe(S),Te(e,"slot","sidebar")},m(P,D){de(P,e,D),ze(t,e,null),ie(e,n),ie(e,c),ie(e,u),ie(e,f),ie(e,a),ie(e,_),ie(_,x),ie(_,k),I=!0},p(P,D){(!I||D&16)&&S!==(S=P[4].highest_ratio.toFixed(1)+"")&&Ci(k,S)},i(P){I||(re(t.$$.fragment,P),I=!0)},o(P){ce(t.$$.fragment,P),I=!1},d(P){P&&he(e),De(t)}}}function K3(o){let e,t;const n=[pn("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let c={};for(let u=0;u<n.length;u+=1)c=an(c,n[u]);return e=new Cs({props:c}),{c(){Re(e.$$.fragment)},m(u,f){ze(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(re(e.$$.fragment,u),t=!0)},o(u){ce(e.$$.fragment,u),t=!1},d(u){De(e,u)}}}function J3(o){let e,t=(o[17].distance_after/o[17].distance_before).toFixed(1)+"",n;return{c(){e=Qe("Ratio "),n=Qe(t)},m(c,u){de(c,e,u),de(c,n,u)},p(c,u){u&131072&&t!==(t=(c[17].distance_after/c[17].distance_before).toFixed(1)+"")&&Ci(n,t)},d(c){c&&(he(e),he(n))}}}function Y3(o){let e,t;return e=new is({props:{openOn:"hover",$$slots:{default:[J3,({props:n})=>({17:n}),({props:n})=>n?131072:0]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c&393216&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function Q3(o){let e,t,n;const c=[pn("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","distance_after"],["get","distance_before"]],1,"white",o[4].highest_ratio,"red"],"line-width":5}},{manageHoverState:!0}];function u(a){o[9](a)}let f={$$slots:{default:[Y3]},$$scope:{ctx:o}};for(let a=0;a<c.length;a+=1)f=an(f,c[a]);return o[0]!==void 0&&(f.hovered=o[0]),e=new fo({props:f}),Xi.push(()=>Wr(e,"hovered",u)),e.$on("click",o[10]),{c(){Re(e.$$.fragment)},m(a,_){ze(e,a,_),n=!0},p(a,_){const x=_&16?bu(c,[c[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","distance_after"],["get","distance_before"]],1,"white",a[4].highest_ratio,"red"],"line-width":5}},c[2]]):{};_&262144&&(x.$$scope={dirty:_,ctx:a}),!t&&_&1&&(t=!0,x.hovered=a[0],Gr(()=>t=!1)),e.$set(x)},i(a){n||(re(e.$$.fragment,a),n=!0)},o(a){ce(e.$$.fragment,a),n=!1},d(a){De(e,a)}}}function eT(o){let e,t;const n=[pn("compare-route"),{paint:{"line-width":10,"line-color":N0(["get","kind"],{before:"red",after:"blue"},"red")}}];let c={};for(let u=0;u<n.length;u+=1)c=an(c,n[u]);return e=new fo({props:c}),{c(){Re(e.$$.fragment)},m(u,f){ze(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(re(e.$$.fragment,u),t=!0)},o(u){ce(e.$$.fragment,u),t=!1},d(u){De(e,u)}}}function tT(o){let e;return{c(){e=Qe("X")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function iT(o){let e,t,n,c,u,f,a,_,x,S,k,I;t=new cr({props:{data:tn(o[2]).renderNeighbourhood(),$$slots:{default:[K3]},$$scope:{ctx:o}}}),c=new cr({props:{data:o[4],generateId:!0,$$slots:{default:[Q3]},$$scope:{ctx:o}}}),f=new cr({props:{data:o[3],$$slots:{default:[eT]},$$scope:{ctx:o}}}),_=new Gu({});function P(R){o[11](R)}let D={draggable:!0,$$slots:{default:[tT]},$$scope:{ctx:o}};return o[1]!==void 0&&(D.lngLat=o[1]),S=new Fu({props:D}),Xi.push(()=>Wr(S,"lngLat",P)),{c(){e=ue("div"),Re(t.$$.fragment),n=Fe(),Re(c.$$.fragment),u=Fe(),Re(f.$$.fragment),a=Fe(),Re(_.$$.fragment),x=Fe(),Re(S.$$.fragment),Te(e,"slot","map")},m(R,z){de(R,e,z),ze(t,e,null),ie(e,n),ze(c,e,null),ie(e,u),ze(f,e,null),ie(e,a),ze(_,e,null),ie(e,x),ze(S,e,null),I=!0},p(R,z){const B={};z&4&&(B.data=tn(R[2]).renderNeighbourhood()),z&262144&&(B.$$scope={dirty:z,ctx:R}),t.$set(B);const N={};z&16&&(N.data=R[4]),z&262161&&(N.$$scope={dirty:z,ctx:R}),c.$set(N);const V={};z&8&&(V.data=R[3]),z&262144&&(V.$$scope={dirty:z,ctx:R}),f.$set(V);const j={};z&262144&&(j.$$scope={dirty:z,ctx:R}),!k&&z&2&&(k=!0,j.lngLat=R[1],Gr(()=>k=!1)),S.$set(j)},i(R){I||(re(t.$$.fragment,R),re(c.$$.fragment,R),re(f.$$.fragment,R),re(_.$$.fragment,R),re(S.$$.fragment,R),I=!0)},o(R){ce(t.$$.fragment,R),ce(c.$$.fragment,R),ce(f.$$.fragment,R),ce(_.$$.fragment,R),ce(S.$$.fragment,R),I=!1},d(R){R&&he(e),De(t),De(c),De(f),De(_),De(S)}}}function nT(o){let e,t,n,c;return e=new m0({}),e.$on("contextmenu",o[8]),n=new ns({props:{$$slots:{map:[iT],sidebar:[X3],top:[$3]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment),t=Fe(),Re(n.$$.fragment)},m(u,f){ze(e,u,f),de(u,t,f),ze(n,u,f),c=!0},p(u,[f]){const a={};f&262207&&(a.$$scope={dirty:f,ctx:u}),n.$set(a)},i(u){c||(re(e.$$.fragment,u),re(n.$$.fragment,u),c=!0)},o(u){ce(e.$$.fragment,u),ce(n.$$.fragment,u),c=!1},d(u){u&&he(t),De(e,u),De(n,u)}}}function rT(o,e,t){let n,c,u,f,a,_,x;dt(o,od,j=>t(1,u=j)),dt(o,ri,j=>t(5,f=j)),dt(o,Lu,j=>t(14,a=j)),dt(o,Iu,j=>t(15,_=j)),dt(o,Jn,j=>t(2,x=j));function S(){At(ri,f={mode:"neighbourhood"},f)}let k=null;function I(j){return j?x.compareRoute(new Ts.LngLat(j.properties.pt1_x,j.properties.pt1_y),u,1):Xl()}function P(j){At(Iu,_=new Ts.LngLat(j.properties.pt1_x,j.properties.pt1_y),_),At(Lu,a=u,a),At(ri,f={mode:"route",prevMode:"impact-one-destination"},f)}function D(j){At(od,u=j.detail.lngLat,u)}function R(j){k=j,t(0,k)}const z=j=>P(j.detail.features[0]);function B(j){u=j,od.set(u)}const N=()=>At(ri,f={mode:"title",firstLoad:!1},f),V=()=>At(ri,f={mode:"network"},f);return o.$$.update=()=>{o.$$.dirty&6&&t(4,n=x.impactToOneDestination(u)),o.$$.dirty&1&&t(3,c=I(k))},[k,u,x,c,n,f,S,P,D,R,z,B,N,V]}class oT extends Ht{constructor(e){super(),Wt(this,e,rT,nT,Ut,{})}}const V0="/ltn/assets/delete-ec75e756.svg",q0="/ltn/assets/edit-f3f51206.svg";function cy(o,e,t){const n=o.slice();return n[20]=e[t],n}function sT(o){let e;return{c(){e=Qe("Choose project")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function aT(o){let e;return{c(){e=ue("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(t,n){de(t,e,n)},p:Dt,d(t){t&&he(e)}}}function lT(o){let e;return{c(){e=Qe("Route")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function cT(o){let e,t,n,c,u,f,a,_,x,S,k,I,P,D,R;return u=new Pi({props:{$$slots:{default:[sT]},$$scope:{ctx:o}}}),u.$on("click",o[16]),x=new jp({props:{$$slots:{default:[aT]},$$scope:{ctx:o}}}),D=new Pi({props:{$$slots:{default:[lT]},$$scope:{ctx:o}}}),D.$on("click",o[17]),{c(){e=ue("div"),t=ue("nav"),n=ue("ul"),c=ue("li"),Re(u.$$.fragment),f=Fe(),a=ue("li"),_=Qe(`Pick neighbourhood
          `),Re(x.$$.fragment),S=Fe(),k=ue("nav"),I=ue("ul"),P=ue("li"),Re(D.$$.fragment),Te(t,"aria-label","breadcrumb"),Te(e,"slot","top"),mn(e,"display","flex"),mn(e,"justify-content","space-between")},m(z,B){de(z,e,B),ie(e,t),ie(t,n),ie(n,c),ze(u,c,null),ie(n,f),ie(n,a),ie(a,_),ze(x,a,null),ie(e,S),ie(e,k),ie(k,I),ie(I,P),ze(D,P,null),R=!0},p(z,B){const N={};B&8388608&&(N.$$scope={dirty:B,ctx:z}),u.$set(N);const V={};B&8388608&&(V.$$scope={dirty:B,ctx:z}),x.$set(V);const j={};B&8388608&&(j.$$scope={dirty:B,ctx:z}),D.$set(j)},i(z){R||(re(u.$$.fragment,z),re(x.$$.fragment,z),re(D.$$.fragment,z),R=!0)},o(z){ce(u.$$.fragment,z),ce(x.$$.fragment,z),ce(D.$$.fragment,z),R=!1},d(z){z&&he(e),De(u),De(x),De(D)}}}function uT(o){let e;return{c(){e=Qe("Draw a new boundary")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function hT(o){let e;return{c(){e=Qe("Use an auto-generated boundary")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function dT(o){let e=o[20]+"",t;return{c(){t=Qe(e)},m(n,c){de(n,t,c)},p(n,c){c&2&&e!==(e=n[20]+"")&&Ci(t,e)},d(n){n&&he(t)}}}function uy(o){let e,t,n,c,u,f,a,_,x,S,k;function I(){return o[13](o[20])}n=new Pi({props:{$$slots:{default:[dT]},$$scope:{ctx:o}}}),n.$on("click",I);function P(){return o[14](o[20])}function D(){return o[15](o[20])}return{c(){e=ue("li"),t=ue("span"),Re(n.$$.fragment),c=Fe(),u=ue("button"),u.innerHTML=`<img src="${q0}" alt="Rename neighbourhood"/>`,f=Fe(),a=ue("button"),a.innerHTML=`<img src="${V0}" alt="Delete neighbourhood"/>`,_=Fe(),Te(u,"class","secondary"),Te(a,"class","secondary"),mn(t,"display","flex"),mn(t,"justify-content","space-between")},m(R,z){de(R,e,z),ie(e,t),ze(n,t,null),ie(t,c),ie(t,u),ie(t,f),ie(t,a),ie(e,_),x=!0,S||(k=[Et(u,"click",P),Et(a,"click",D)],S=!0)},p(R,z){o=R;const B={};z&8388610&&(B.$$scope={dirty:z,ctx:o}),n.$set(B)},i(R){x||(re(n.$$.fragment,R),x=!0)},o(R){ce(n.$$.fragment,R),x=!1},d(R){R&&he(e),De(n),S=!1,ln(k)}}}function fT(o){let e,t,n,c,u,f,a,_,x,S,k,I,P,D,R,z,B,N,V,j,le;n=new Pi({props:{$$slots:{default:[uT]},$$scope:{ctx:o}}}),n.$on("click",o[7]),f=new Pi({props:{$$slots:{default:[hT]},$$scope:{ctx:o}}}),f.$on("click",o[12]);let oe=Kn(o[1]),$=[];for(let ve=0;ve<oe.length;ve+=1)$[ve]=uy(cy(o,oe,ve));const Y=ve=>ce($[ve],1,1,()=>{$[ve]=null});return{c(){e=ue("div"),t=ue("div"),Re(n.$$.fragment),c=Fe(),u=ue("div"),Re(f.$$.fragment),a=Fe(),_=ue("ul");for(let ve=0;ve<$.length;ve+=1)$[ve].c();x=Fe(),S=ue("hr"),k=Fe(),I=ue("p"),P=Qe("Current project: "),D=Qe(o[2]),R=Fe(),z=ue("button"),z.textContent="Export project to GeoJSON",B=Fe(),N=ue("button"),N.textContent="Debug route-snapper",Te(N,"class","secondary"),Te(e,"slot","sidebar")},m(ve,Be){de(ve,e,Be),ie(e,t),ze(n,t,null),ie(e,c),ie(e,u),ze(f,u,null),ie(e,a),ie(e,_);for(let te=0;te<$.length;te+=1)$[te]&&$[te].m(_,null);ie(e,x),ie(e,S),ie(e,k),ie(e,I),ie(I,P),ie(I,D),ie(e,R),ie(e,z),ie(e,B),ie(e,N),V=!0,j||(le=[Et(z,"click",o[8]),Et(N,"click",o[9])],j=!0)},p(ve,Be){const te={};Be&8388608&&(te.$$scope={dirty:Be,ctx:ve}),n.$set(te);const ne={};if(Be&8388608&&(ne.$$scope={dirty:Be,ctx:ve}),f.$set(ne),Be&114){oe=Kn(ve[1]);let qe;for(qe=0;qe<oe.length;qe+=1){const Ce=cy(ve,oe,qe);$[qe]?($[qe].p(Ce,Be),re($[qe],1)):($[qe]=uy(Ce),$[qe].c(),re($[qe],1),$[qe].m(_,null))}for(_i(),qe=oe.length;qe<$.length;qe+=1)Y(qe);yi()}(!V||Be&4)&&Ci(D,ve[2])},i(ve){if(!V){re(n.$$.fragment,ve),re(f.$$.fragment,ve);for(let Be=0;Be<oe.length;Be+=1)re($[Be]);V=!0}},o(ve){ce(n.$$.fragment,ve),ce(f.$$.fragment,ve),$=$.filter(Boolean);for(let Be=0;Be<$.length;Be+=1)ce($[Be]);V=!1},d(ve){ve&&he(e),De(n),De(f),Ss($,ve),j=!1,ln(le)}}}function pT(o){let e,t=o[19].name+"",n;return{c(){e=ue("p"),n=Qe(t)},m(c,u){de(c,e,u),ie(e,n)},p(c,u){u&524288&&t!==(t=c[19].name+"")&&Ci(n,t)},d(c){c&&he(e)}}}function mT(o){let e,t;return e=new is({props:{openOn:"hover",$$slots:{default:[pT,({props:n})=>({19:n}),({props:n})=>n?524288:0]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c&8912896&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function gT(o){let e,t;const n=[pn("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":Fa(.3,.5)}},{manageHoverState:!0},{hoverCursor:"pointer"}];let c={$$slots:{default:[mT]},$$scope:{ctx:o}};for(let u=0;u<n.length;u+=1)c=an(c,n[u]);return e=new Cs({props:c}),e.$on("click",o[11]),{c(){Re(e.$$.fragment)},m(u,f){ze(e,u,f),t=!0},p(u,f){const a={};f&8388608&&(a.$$scope={dirty:f,ctx:u}),e.$set(a)},i(u){t||(re(e.$$.fragment,u),t=!0)},o(u){ce(e.$$.fragment,u),t=!1},d(u){De(e,u)}}}function _T(o){let e,t,n,c,u;return t=new cr({props:{data:o[0],generateId:!0,$$slots:{default:[gT]},$$scope:{ctx:o}}}),c=new Gu({}),{c(){e=ue("div"),Re(t.$$.fragment),n=Fe(),Re(c.$$.fragment),Te(e,"slot","map")},m(f,a){de(f,e,a),ze(t,e,null),ie(e,n),ze(c,e,null),u=!0},p(f,a){const _={};a&1&&(_.data=f[0]),a&8388608&&(_.$$scope={dirty:a,ctx:f}),t.$set(_)},i(f){u||(re(t.$$.fragment,f),re(c.$$.fragment,f),u=!0)},o(f){ce(t.$$.fragment,f),ce(c.$$.fragment,f),u=!1},d(f){f&&he(e),De(t),De(c)}}}function yT(o){let e,t;return e=new ns({props:{$$slots:{map:[_T],sidebar:[fT],top:[cT]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,[c]){const u={};c&8388623&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function vT(o,e,t){let n,c,u,f,a,_;dt(o,Jn,oe=>t(10,u=oe)),dt(o,Es,oe=>t(2,f=oe)),dt(o,ri,oe=>t(3,a=oe)),dt(o,Au,oe=>t(18,_=oe));function x(oe){u.setCurrentNeighbourhood(oe,_),At(ri,a={mode:"neighbourhood"},a)}function S(oe){window.confirm(`Really delete neighbourhood ${oe}? You can't undo this.`)&&(u.deleteNeighbourhoodBoundary(oe),ec(),t(0,n=u.toSavefile()))}function k(oe){let $=gp(u,`Rename neighbourhood ${oe} to what?`,oe);$&&(u.renameNeighbourhoodBoundary(oe,$),ec(),t(0,n=u.toSavefile()))}function I(){let oe=gp(u,"What do you want to name the neighbourhood?","");oe&&At(ri,a={mode:"set-boundary",name:oe,existing:null},a)}function P(){pd(f+".geojson",JSON.stringify(u.toSavefile()))}function D(){pd("debug_route_snapper.geojson",u.toRouteSnapperGj())}const R=oe=>x(tn(oe.detail.features[0].properties).name),z=()=>At(ri,a={mode:"auto-boundaries"},a),B=oe=>x(oe),N=oe=>k(oe),V=oe=>S(oe),j=()=>At(ri,a={mode:"title",firstLoad:!1},a),le=()=>At(ri,a={mode:"route",prevMode:"network"},a);return o.$$.update=()=>{o.$$.dirty&1024&&t(0,n=u.toSavefile()),o.$$.dirty&1&&t(1,c=n.features.filter(oe=>oe.properties.kind=="boundary").map(oe=>oe.properties.name))},[n,c,f,a,x,S,k,I,P,D,u,R,z,B,N,V,j,le]}class bT extends Ht{constructor(e){super(),Wt(this,e,vT,yT,Ut,{})}}function wT(o){let e;return{c(){e=Qe("Choose project")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function xT(o){let e;return{c(){e=Qe("Pick neighbourhood")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function hy(o){let e,t,n;return t=new Pi({props:{$$slots:{default:[kT]},$$scope:{ctx:o}}}),t.$on("click",o[13]),{c(){e=ue("li"),Re(t.$$.fragment)},m(c,u){de(c,e,u),ze(t,e,null),n=!0},p(c,u){const f={};u&16384&&(f.$$scope={dirty:u,ctx:c}),t.$set(f)},i(c){n||(re(t.$$.fragment,c),n=!0)},o(c){ce(t.$$.fragment,c),n=!1},d(c){c&&he(e),De(t)}}}function kT(o){let e;return{c(){e=Qe("Editing")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function ST(o){let e,t,n,c,u,f,a,_,x,S,k,I;u=new Pi({props:{$$slots:{default:[wT]},$$scope:{ctx:o}}}),u.$on("click",o[11]),_=new Pi({props:{$$slots:{default:[xT]},$$scope:{ctx:o}}}),_.$on("click",o[12]);let P=o[0]=="neighbourhood"&&hy(o);return{c(){e=ue("div"),t=ue("nav"),n=ue("ul"),c=ue("li"),Re(u.$$.fragment),f=Fe(),a=ue("li"),Re(_.$$.fragment),x=Fe(),P&&P.c(),S=Fe(),k=ue("li"),k.textContent="Routing",Te(t,"aria-label","breadcrumb"),Te(e,"slot","top")},m(D,R){de(D,e,R),ie(e,t),ie(t,n),ie(n,c),ze(u,c,null),ie(n,f),ie(n,a),ze(_,a,null),ie(n,x),P&&P.m(n,null),ie(n,S),ie(n,k),I=!0},p(D,R){const z={};R&16384&&(z.$$scope={dirty:R,ctx:D}),u.$set(z);const B={};R&16384&&(B.$$scope={dirty:R,ctx:D}),_.$set(B),D[0]=="neighbourhood"?P?(P.p(D,R),R&1&&re(P,1)):(P=hy(D),P.c(),re(P,1),P.m(n,S)):P&&(_i(),ce(P,1,1,()=>{P=null}),yi())},i(D){I||(re(u.$$.fragment,D),re(_.$$.fragment,D),re(P),I=!0)},o(D){ce(u.$$.fragment,D),ce(_.$$.fragment,D),ce(P),I=!1},d(D){D&&he(e),De(u),De(_),P&&P.d()}}}function TT(o){let e,t,n,c,u,f,a,_,x,S,k,I,P,D,R,z,B;return t=new qu({}),t.$on("click",o[7]),{c(){e=ue("div"),Re(t.$$.fragment),n=Fe(),c=ue("p"),c.textContent="Drag markers for a route",u=Fe(),f=ue("p"),f.innerHTML=`<span style="color: red">Route before</span>
      ,
      <span style="color: blue">route after</span>`,a=Fe(),_=ue("label"),x=Qe("Slow-down factor for main roads: "),S=Qe(o[1]),k=Fe(),I=ue("input"),P=Fe(),D=ue("i"),D.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,Te(I,"type","range"),Te(I,"min","1.0"),Te(I,"max","5.0"),Te(I,"step","0.1"),Te(e,"slot","sidebar")},m(N,V){de(N,e,V),ze(t,e,null),ie(e,n),ie(e,c),ie(e,u),ie(e,f),ie(e,a),ie(e,_),ie(_,x),ie(_,S),ie(_,k),ie(_,I),Hn(I,o[1]),ie(e,P),ie(e,D),R=!0,z||(B=[Et(I,"change",o[10]),Et(I,"input",o[10])],z=!0)},p(N,V){(!R||V&2)&&Ci(S,N[1]),V&2&&Hn(I,N[1])},i(N){R||(re(t.$$.fragment,N),R=!0)},o(N){ce(t.$$.fragment,N),R=!1},d(N){N&&he(e),De(t),z=!1,ln(B)}}}function dy(o){let e,t;return e=new Zu({props:{gj:tn(o[4]).renderNeighbourhood(),interactive:!1}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c&16&&(u.gj=tn(n[4]).renderNeighbourhood()),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function ET(o){let e,t;const n=[pn("compare-route"),{paint:{"line-width":10,"line-color":N0(["get","kind"],{before:"red",after:"blue"},"red")}}];let c={};for(let u=0;u<n.length;u+=1)c=an(c,n[u]);return e=new fo({props:c}),{c(){Re(e.$$.fragment)},m(u,f){ze(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(re(e.$$.fragment,u),t=!0)},o(u){ce(e.$$.fragment,u),t=!1},d(u){De(e,u)}}}function CT(o){let e;return{c(){e=Qe("A")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function MT(o){let e;return{c(){e=Qe("B")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function IT(o){let e,t,n,c,u,f,a,_,x,S,k,I,P=o[0]=="neighbourhood"&&dy(o);n=new Gu({}),u=new cr({props:{data:o[5],$$slots:{default:[ET]},$$scope:{ctx:o}}});function D(N){o[8](N)}let R={draggable:!0,$$slots:{default:[CT]},$$scope:{ctx:o}};o[3]!==void 0&&(R.lngLat=o[3]),a=new Fu({props:R}),Xi.push(()=>Wr(a,"lngLat",D));function z(N){o[9](N)}let B={draggable:!0,$$slots:{default:[MT]},$$scope:{ctx:o}};return o[2]!==void 0&&(B.lngLat=o[2]),S=new Fu({props:B}),Xi.push(()=>Wr(S,"lngLat",z)),{c(){e=ue("div"),P&&P.c(),t=Fe(),Re(n.$$.fragment),c=Fe(),Re(u.$$.fragment),f=Fe(),Re(a.$$.fragment),x=Fe(),Re(S.$$.fragment),Te(e,"slot","map")},m(N,V){de(N,e,V),P&&P.m(e,null),ie(e,t),ze(n,e,null),ie(e,c),ze(u,e,null),ie(e,f),ze(a,e,null),ie(e,x),ze(S,e,null),I=!0},p(N,V){N[0]=="neighbourhood"?P?(P.p(N,V),V&1&&re(P,1)):(P=dy(N),P.c(),re(P,1),P.m(e,t)):P&&(_i(),ce(P,1,1,()=>{P=null}),yi());const j={};V&32&&(j.data=N[5]),V&16384&&(j.$$scope={dirty:V,ctx:N}),u.$set(j);const le={};V&16384&&(le.$$scope={dirty:V,ctx:N}),!_&&V&8&&(_=!0,le.lngLat=N[3],Gr(()=>_=!1)),a.$set(le);const oe={};V&16384&&(oe.$$scope={dirty:V,ctx:N}),!k&&V&4&&(k=!0,oe.lngLat=N[2],Gr(()=>k=!1)),S.$set(oe)},i(N){I||(re(P),re(n.$$.fragment,N),re(u.$$.fragment,N),re(a.$$.fragment,N),re(S.$$.fragment,N),I=!0)},o(N){ce(P),ce(n.$$.fragment,N),ce(u.$$.fragment,N),ce(a.$$.fragment,N),ce(S.$$.fragment,N),I=!1},d(N){N&&he(e),P&&P.d(),De(n),De(u),De(a),De(S)}}}function LT(o){let e,t;return e=new ns({props:{$$slots:{map:[IT],sidebar:[TT],top:[ST]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,[c]){const u={};c&16511&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function AT(o,e,t){let n,c,u,f,a,_;dt(o,ri,B=>t(6,c=B)),dt(o,Eg,B=>t(1,u=B)),dt(o,Lu,B=>t(2,f=B)),dt(o,Iu,B=>t(3,a=B)),dt(o,Jn,B=>t(4,_=B));let{prevMode:x}=e;function S(){At(ri,c={mode:x},c)}function k(B){a=B,Iu.set(a)}function I(B){f=B,Lu.set(f)}function P(){u=bp(this.value),Eg.set(u)}const D=()=>At(ri,c={mode:"title",firstLoad:!1},c),R=()=>At(ri,c={mode:"network"},c),z=()=>At(ri,c={mode:"neighbourhood"},c);return o.$$set=B=>{"prevMode"in B&&t(0,x=B.prevMode)},o.$$.update=()=>{o.$$.dirty&30&&t(5,n=_.compareRoute(a,f,u))},[x,u,f,a,_,n,c,S,k,I,P,D,R,z]}class PT extends Ht{constructor(e){super(),Wt(this,e,AT,LT,Ut,{prevMode:0})}}let tc=wi(null);const ko=wi([]);function Z0(o){if(o.length<3)return JSON.parse(Lr(tc).inner.calculateRoute(o));let e=JSON.parse(JSON.stringify(o));e.push(e[0]);let t=JSON.parse(Lr(tc).inner.calculateRoute(e));return t.properties.waypoints.pop(),t.geometry.type="Polygon",t.geometry.coordinates=[t.geometry.coordinates],t}const{window:zT}=xd,DT=o=>({}),fy=o=>({}),RT=o=>({}),py=o=>({});function my(o,e,t){const n=o.slice();return n[44]=e[t],n[45]=e,n[46]=t,n}function gy(o,e,t){const n=o.slice();return n[47]=e[t],n[48]=e,n[49]=t,n}function BT(o){let e,t;const n=o[24]["extra-top"],c=Bi(n,o,o[38],fy);return{c(){e=ue("div"),c&&c.c(),Te(e,"slot","top")},m(u,f){de(u,e,f),c&&c.m(e,null),t=!0},p(u,f){c&&c.p&&(!t||f[1]&128)&&Oi(c,n,u,u[38],t?Fi(n,u[38],f,DT):Ni(u[38]),fy)},i(u){t||(re(c,u),t=!0)},o(u){ce(c,u),t=!1},d(u){u&&he(e),c&&c.d(u)}}}function FT(o){let e,t,n,c,u;return{c(){e=ue("ul"),e.innerHTML=`<li><b>Click</b>
            the map to add new points, until there are at least 3 points</li> <li><b>Click and drag</b>
            any point to move it</li> <li><b>Click</b>
            a waypoint to toggle snapping</li> <li><b>Right click</b>
            a waypoint to delete it</li>`,t=Fe(),n=ue("p"),n.textContent="Keyboard shortcuts:",c=Fe(),u=ue("ul"),u.innerHTML=`<li><b>s</b>
            to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
            to undo your last change</li> <li><b>Enter</b>
            or
            <b>Escape</b>
            to finish</li> <li>From the main mode, <b>3</b>
            to draw a new area</li>`},m(f,a){de(f,e,a),de(f,t,a),de(f,n,a),de(f,c,a),de(f,u,a)},p:Dt,d(f){f&&(he(e),he(t),he(n),he(c),he(u))}}}function OT(o){let e,t=o[8].length+"",n,c;return{c(){e=Qe("Undo ("),n=Qe(t),c=Qe(")")},m(u,f){de(u,e,f),de(u,n,f),de(u,c,f)},p(u,f){f[0]&256&&t!==(t=u[8].length+"")&&Ci(n,t)},d(u){u&&(he(e),he(n),he(c))}}}function NT(o){let e;return{c(){e=Qe("Undo")},m(t,n){de(t,e,n)},p:Dt,d(t){t&&he(e)}}}function jT(o){let e;return{c(){e=ue("p"),e.textContent="Drag to adjust. Click to toggle snapped. Right click to delete."},m(t,n){de(t,e,n)},p:Dt,d(t){t&&he(e)}}}function UT(o){let e,t,n,c,u,f,a,_,x,S,k,I,P;return k=Uy(o[36][0]),{c(){e=ue("fieldset"),t=ue("label"),n=ue("input"),c=Qe(`
          Snap to roads`),u=Fe(),f=ue("label"),a=ue("input"),_=Qe(`
          Draw anywhere`),x=Fe(),S=ue("p"),S.textContent="Click to add at least 3 points",Te(n,"type","radio"),n.__value="snap",Hn(n,n.__value),Te(a,"type","radio"),a.__value="free",Hn(a,a.__value),k.p(n,a)},m(D,R){de(D,e,R),ie(e,t),ie(t,n),n.checked=n.__value===o[7],ie(t,c),ie(e,u),ie(e,f),ie(f,a),a.checked=a.__value===o[7],ie(f,_),de(D,x,R),de(D,S,R),I||(P=[Et(n,"change",o[35]),Et(a,"change",o[37])],I=!0)},p(D,R){R[0]&128&&(n.checked=n.__value===D[7]),R[0]&128&&(a.checked=a.__value===D[7])},d(D){D&&(he(e),he(x),he(S)),k.r(),I=!1,ln(P)}}}function VT(o){let e,t,n,c,u,f,a,_,x,S,k,I,P,D,R,z,B;const N=o[24]["extra-sidebar"],V=Bi(N,o,o[38],py);S=new jp({props:{$$slots:{default:[FT]},$$scope:{ctx:o}}});function j(Be,te){return Be[8].length==0?NT:OT}let le=j(o),oe=le(o);function $(Be,te){return Be[5].length<3?UT:jT}let Y=$(o),ve=Y(o);return{c(){e=ue("div"),V&&V.c(),t=Fe(),n=ue("div"),c=ue("button"),u=Qe("Finish"),a=Fe(),_=ue("button"),_.textContent="Cancel",x=Fe(),Re(S.$$.fragment),k=Fe(),I=ue("button"),oe.c(),D=Fe(),ve.c(),c.disabled=f=o[5].length<3,Te(_,"class","secondary"),mn(n,"display","flex"),Te(I,"class","secondary"),I.disabled=P=o[8].length==0,Te(e,"slot","sidebar")},m(Be,te){de(Be,e,te),V&&V.m(e,null),ie(e,t),ie(e,n),ie(n,c),ie(c,u),ie(n,a),ie(n,_),ie(n,x),ze(S,n,null),ie(e,k),ie(e,I),oe.m(I,null),ie(e,D),ve.m(e,null),R=!0,z||(B=[Et(c,"click",function(){Kl(o[0])&&o[0].apply(this,arguments)}),Et(_,"click",function(){Kl(o[1])&&o[1].apply(this,arguments)}),Et(I,"click",o[11])],z=!0)},p(Be,te){o=Be,V&&V.p&&(!R||te[1]&128)&&Oi(V,N,o,o[38],R?Fi(N,o[38],te,RT):Ni(o[38]),py),(!R||te[0]&32&&f!==(f=o[5].length<3))&&(c.disabled=f);const ne={};te[1]&128&&(ne.$$scope={dirty:te,ctx:o}),S.$set(ne),le===(le=j(o))&&oe?oe.p(o,te):(oe.d(1),oe=le(o),oe&&(oe.c(),oe.m(I,null))),(!R||te[0]&256&&P!==(P=o[8].length==0))&&(I.disabled=P),Y===(Y=$(o))&&ve?ve.p(o,te):(ve.d(1),ve=Y(o),ve&&(ve.c(),ve.m(e,null)))},i(Be){R||(re(V,Be),re(S.$$.fragment,Be),R=!0)},o(Be){ce(V,Be),ce(S.$$.fragment,Be),R=!1},d(Be){Be&&he(e),V&&V.d(Be),De(S),oe.d(),ve.d(),z=!1,ln(B)}}}function qT(o){let e;return{c(){e=ue("span"),Te(e,"class","dot svelte-1cj4rwq"),lr(e,"snapped-node",o[47].snapped),lr(e,"free-node",!o[47].snapped),lr(e,"hide",o[4])},m(t,n){de(t,e,n)},p(t,n){n[0]&512&&lr(e,"snapped-node",t[47].snapped),n[0]&512&&lr(e,"free-node",!t[47].snapped),n[0]&16&&lr(e,"hide",t[4])},d(t){t&&he(e)}}}function _y(o){let e,t,n;function c(x){o[25](x,o[47])}function u(){return o[26](o[47])}function f(){return o[27](o[47])}function a(){return o[28](o[47])}let _={draggable:!0,zIndex:0,$$slots:{default:[qT]},$$scope:{ctx:o}};return o[47].point!==void 0&&(_.lngLat=o[47].point),e=new Md({props:_}),Xi.push(()=>Wr(e,"lngLat",c)),e.$on("dragstart",u),e.$on("drag",f),e.$on("dragend",o[19]),e.$on("click",a),{c(){Re(e.$$.fragment)},m(x,S){ze(e,x,S),n=!0},p(x,S){o=x;const k={};S[0]&528|S[1]&128&&(k.$$scope={dirty:S,ctx:o}),!t&&S[0]&512&&(t=!0,k.lngLat=o[47].point,Gr(()=>t=!1)),e.$set(k)},i(x){n||(re(e.$$.fragment,x),n=!0)},o(x){ce(e.$$.fragment,x),n=!1},d(x){De(e,x)}}}function ZT(o){let e;return{c(){e=ue("span"),e.textContent=`${o[46]+1}`,Te(e,"class","dot svelte-1cj4rwq"),lr(e,"snapped",o[44].snapped)},m(t,n){de(t,e,n)},p(t,n){n[0]&32&&lr(e,"snapped",t[44].snapped)},d(t){t&&he(e)}}}function yy(o){let e,t,n;function c(_){o[29](_,o[44])}function u(){return o[30](o[46])}function f(){return o[31](o[46])}let a={draggable:!0,zIndex:1,$$slots:{default:[ZT]},$$scope:{ctx:o}};return o[44].point!==void 0&&(a.lngLat=o[44].point),e=new Md({props:a}),Xi.push(()=>Wr(e,"lngLat",c)),e.$on("click",u),e.$on("contextmenu",f),e.$on("mouseenter",o[32]),e.$on("mouseleave",o[33]),e.$on("dragstart",o[21]),e.$on("dragend",o[34]),{c(){Re(e.$$.fragment)},m(_,x){ze(e,_,x),n=!0},p(_,x){o=_;const S={};x[0]&32|x[1]&128&&(S.$$scope={dirty:x,ctx:o}),!t&&x[0]&32&&(t=!0,S.lngLat=o[44].point,Gr(()=>t=!1)),e.$set(S)},i(_){n||(re(e.$$.fragment,_),n=!0)},o(_){ce(e.$$.fragment,_),n=!1},d(_){De(e,_)}}}function GT(o){let e,t,n,c;const u=[pn("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let f={};for(let x=0;x<u.length;x+=1)f=an(f,u[x]);e=new fo({props:f});const a=[pn("draw-area-preview"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let _={};for(let x=0;x<a.length;x+=1)_=an(_,a[x]);return n=new Cs({props:_}),{c(){Re(e.$$.fragment),t=Fe(),Re(n.$$.fragment)},m(x,S){ze(e,x,S),de(x,t,S),ze(n,x,S),c=!0},p(x,S){const k={};e.$set(k);const I={};n.$set(I)},i(x){c||(re(e.$$.fragment,x),re(n.$$.fragment,x),c=!0)},o(x){ce(e.$$.fragment,x),ce(n.$$.fragment,x),c=!1},d(x){x&&he(t),De(e,x),De(n,x)}}}function WT(o){let e,t;return e=new fo({props:{paint:{"line-color":"black","line-width":3}}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p:Dt,i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function HT(o){let e,t,n,c,u,f,a,_,x;t=new m0({}),t.$on("click",o[12]),t.$on("mousemove",o[13]);let S=Kn(o[9]),k=[];for(let z=0;z<S.length;z+=1)k[z]=_y(gy(o,S,z));const I=z=>ce(k[z],1,1,()=>{k[z]=null});let P=Kn(o[5]),D=[];for(let z=0;z<P.length;z+=1)D[z]=yy(my(o,P,z));const R=z=>ce(D[z],1,1,()=>{D[z]=null});return f=new cr({props:{data:o[16](o[6],o[5]),generateId:!0,$$slots:{default:[GT]},$$scope:{ctx:o}}}),_=new cr({props:{data:o[10],$$slots:{default:[WT]},$$scope:{ctx:o}}}),{c(){e=ue("div"),Re(t.$$.fragment),n=Fe();for(let z=0;z<k.length;z+=1)k[z].c();c=Fe();for(let z=0;z<D.length;z+=1)D[z].c();u=Fe(),Re(f.$$.fragment),a=Fe(),Re(_.$$.fragment),Te(e,"slot","map")},m(z,B){de(z,e,B),ze(t,e,null),ie(e,n);for(let N=0;N<k.length;N+=1)k[N]&&k[N].m(e,null);ie(e,c);for(let N=0;N<D.length;N+=1)D[N]&&D[N].m(e,null);ie(e,u),ze(f,e,null),ie(e,a),ze(_,e,null),x=!0},p(z,B){if(B[0]&918032){S=Kn(z[9]);let j;for(j=0;j<S.length;j+=1){const le=gy(z,S,j);k[j]?(k[j].p(le,B),re(k[j],1)):(k[j]=_y(le),k[j].c(),re(k[j],1),k[j].m(e,c))}for(_i(),j=S.length;j<k.length;j+=1)I(j);yi()}if(B[0]&2146348){P=Kn(z[5]);let j;for(j=0;j<P.length;j+=1){const le=my(z,P,j);D[j]?(D[j].p(le,B),re(D[j],1)):(D[j]=yy(le),D[j].c(),re(D[j],1),D[j].m(e,u))}for(_i(),j=P.length;j<D.length;j+=1)R(j);yi()}const N={};B[0]&96&&(N.data=z[16](z[6],z[5])),B[1]&128&&(N.$$scope={dirty:B,ctx:z}),f.$set(N);const V={};B[0]&1024&&(V.data=z[10]),B[1]&128&&(V.$$scope={dirty:B,ctx:z}),_.$set(V)},i(z){if(!x){re(t.$$.fragment,z);for(let B=0;B<S.length;B+=1)re(k[B]);for(let B=0;B<P.length;B+=1)re(D[B]);re(f.$$.fragment,z),re(_.$$.fragment,z),x=!0}},o(z){ce(t.$$.fragment,z),k=k.filter(Boolean);for(let B=0;B<k.length;B+=1)ce(k[B]);D=D.filter(Boolean);for(let B=0;B<D.length;B+=1)ce(D[B]);ce(f.$$.fragment,z),ce(_.$$.fragment,z),x=!1},d(z){z&&he(e),De(t),Ss(k,z),Ss(D,z),De(f),De(_)}}}function $T(o){let e,t,n,c;return e=new ns({props:{$$slots:{map:[HT],sidebar:[VT],top:[BT]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(u,f){ze(e,u,f),t=!0,n||(c=Et(zT,"keydown",o[20]),n=!0)},p(u,f){const a={};f[0]&2047|f[1]&128&&(a.$$scope={dirty:f,ctx:u}),e.$set(a)},i(u){t||(re(e.$$.fragment,u),t=!0)},o(u){ce(e.$$.fragment,u),t=!1},d(u){De(e,u),n=!1,c()}}}function XT(o,e,t){let n,c,u;dt(o,ko,ct=>t(5,c=ct)),dt(o,tc,ct=>t(6,u=ct));let{$$slots:f={},$$scope:a}=e,{map:_}=e,{finish:x}=e,{cancel:S}=e;er(()=>{At(ko,c=[],c),u==null||u.stop(),_.getCanvas().style.cursor="inherit"});let k="snap",I=[],P=[],D=null,R=!1,z=!1,B=!1;function N(ct){let It=ct.length==0?"crosshair":"inherit";_.getCanvas().style.cursor=It}function V(){let ct=I.pop();t(8,I),ct&&At(ko,c=ct,c)}function j(){I.length==100&&I.shift(),t(8,I=[...I,JSON.parse(JSON.stringify(c))])}function le(){t(7,k=k=="snap"?"free":"snap"),D&&t(23,D.snapped=k=="snap",D)}function oe(ct){c.length>=3||(j(),ko.update(It=>(It.push({point:ct.detail.lngLat.toArray(),snapped:k=="snap"}),It)))}function $(ct){t(23,D={point:ct.detail.lngLat.toArray(),snapped:k=="snap"})}function Y(ct){j(),ko.update(It=>(It[ct].snapped=!It[ct].snapped,It))}function ve(ct){j(),ko.update(It=>(It.splice(ct,1),It)),t(2,R=!1)}function Be(ct,It){try{if(ct)return Z0(It)}catch{}return Xl()}function te(ct,It,Ne,je){if(je||It.length>=3)return Xl();try{if(ct&&It.length>0&&Ne)return JSON.parse(ct.inner.calculateRoute([It[It.length-1],Ne]))}catch{}return Xl()}function ne(ct,It,Ne){if(Ne)return;if(!ct||It.length<3){t(9,P=[]);return}let je=[],rt=1,xt=JSON.parse(JSON.stringify(It));xt.push(xt[0]);for(let we=0;we<xt.length-1;we++){let di=JSON.parse(ct.inner.getExtraNodes(xt[we],xt[we+1]));for(let[Ve,$e,kt]of di)je.push({point:[Ve,$e],snapped:kt,insertIdx:rt});rt++}t(9,P=je)}function qe(ct){j(),ko.update(It=>(It.splice(ct.insertIdx,0,{point:ct.point,snapped:ct.snapped}),It)),t(4,B=!0)}function Ce(ct){ko.update(It=>(It[ct.insertIdx].point=ct.point,It))}function et(){t(4,B=!1)}function bt(ct){let It=ct.target.tagName,Ne=It=="INPUT"||It=="TEXTAREA";ct.key=="Enter"&&!Ne||ct.key=="Escape"?(ct.stopPropagation(),c.length>=3?x():window.alert("You can't save this area unless it has at least three points. Press 'Cancel' to discard these changes.")):ct.key=="s"&&!Ne?le():ct.key=="z"&&ct.ctrlKey&&(ct.stopPropagation(),V())}function ft(){j(),t(3,z=!0)}const ot=[[]];function Zt(ct,It){o.$$.not_equal(It.point,ct)&&(It.point=ct,t(9,P))}const ii=ct=>qe(ct),Ft=ct=>Ce(ct),Pt=ct=>{qe(ct),t(4,B=!1)};function Jt(ct,It){o.$$.not_equal(It.point,ct)&&(It.point=ct,ko.set(c))}const Mt=ct=>Y(ct),ei=ct=>ve(ct),Vt=()=>t(2,R=!0),hi=()=>t(2,R=!1),xi=()=>t(3,z=!1);function gi(){k=this.__value,t(7,k)}function Ai(){k=this.__value,t(7,k)}return o.$$set=ct=>{"map"in ct&&t(22,_=ct.map),"finish"in ct&&t(0,x=ct.finish),"cancel"in ct&&t(1,S=ct.cancel),"$$scope"in ct&&t(38,a=ct.$$scope)},o.$$.update=()=>{o.$$.dirty[0]&112&&ne(u,c,B),o.$$.dirty[0]&8388716&&t(10,n=te(u,c,D,R||z)),o.$$.dirty[0]&32&&N(c)},[x,S,R,z,B,c,u,k,I,P,n,V,oe,$,Y,ve,Be,qe,Ce,et,bt,ft,_,D,f,Zt,ii,Ft,Pt,Jt,Mt,ei,Vt,hi,xi,gi,ot,Ai,a]}class KT extends Ht{constructor(e){super(),Wt(this,e,XT,$T,Ut,{map:22,finish:0,cancel:1},null,[-1,-1])}}function JT(o){let e;return{c(){e=Qe("Choose project")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function YT(o){let e;return{c(){e=Qe("Pick neighbourhood")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function QT(o){let e;return{c(){e=ue("li"),e.textContent="Creating new neighbourhood boundary"},m(t,n){de(t,e,n)},p:Dt,i:Dt,o:Dt,d(t){t&&he(e)}}}function e5(o){let e,t,n,c,u;return t=new Pi({props:{$$slots:{default:[t5]},$$scope:{ctx:o}}}),t.$on("click",o[8]),{c(){e=ue("li"),Re(t.$$.fragment),n=Fe(),c=ue("li"),c.textContent="Changing neighbourhood boundary"},m(f,a){de(f,e,a),ze(t,e,null),de(f,n,a),de(f,c,a),u=!0},p(f,a){const _={};a&4096&&(_.$$scope={dirty:a,ctx:f}),t.$set(_)},i(f){u||(re(t.$$.fragment,f),u=!0)},o(f){ce(t.$$.fragment,f),u=!1},d(f){f&&(he(e),he(n),he(c)),De(t)}}}function t5(o){let e;return{c(){e=Qe("Editing")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function i5(o){let e,t,n,c,u,f,a,_,x,S,k,I;u=new Pi({props:{$$slots:{default:[JT]},$$scope:{ctx:o}}}),u.$on("click",o[6]),_=new Pi({props:{$$slots:{default:[YT]},$$scope:{ctx:o}}}),_.$on("click",o[7]);const P=[e5,QT],D=[];function R(z,B){return z[1]?0:1}return S=R(o),k=D[S]=P[S](o),{c(){e=ue("div"),t=ue("nav"),n=ue("ul"),c=ue("li"),Re(u.$$.fragment),f=Fe(),a=ue("li"),Re(_.$$.fragment),x=Fe(),k.c(),Te(t,"aria-label","breadcrumb"),Te(e,"slot","extra-top")},m(z,B){de(z,e,B),ie(e,t),ie(t,n),ie(n,c),ze(u,c,null),ie(n,f),ie(n,a),ze(_,a,null),ie(n,x),D[S].m(n,null),I=!0},p(z,B){const N={};B&4096&&(N.$$scope={dirty:B,ctx:z}),u.$set(N);const V={};B&4096&&(V.$$scope={dirty:B,ctx:z}),_.$set(V);let j=S;S=R(z),S===j?D[S].p(z,B):(_i(),ce(D[j],1,1,()=>{D[j]=null}),yi(),k=D[S],k?k.p(z,B):(k=D[S]=P[S](z),k.c()),re(k,1),k.m(n,null))},i(z){I||(re(u.$$.fragment,z),re(_.$$.fragment,z),re(k),I=!0)},o(z){ce(u.$$.fragment,z),ce(_.$$.fragment,z),ce(k),I=!1},d(z){z&&he(e),De(u),De(_),D[S].d()}}}function n5(o){let e,t,n,c;return{c(){e=ue("div"),t=ue("h1"),n=Qe("Draw your neighbourhood boundary for "),c=Qe(o[0]),Te(e,"slot","extra-sidebar")},m(u,f){de(u,e,f),ie(e,t),ie(t,n),ie(t,c)},p(u,f){f&1&&Ci(c,u[0])},d(u){u&&he(e)}}}function r5(o){let e,t;return e=new KT({props:{map:tn(o[3]),finish:o[4],cancel:o[5],$$slots:{"extra-sidebar":[n5],"extra-top":[i5]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,[c]){const u={};c&8&&(u.map=tn(n[3])),c&4103&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function o5(o,e,t){let n,c,u,f,a;dt(o,ri,R=>t(2,n=R)),dt(o,Au,R=>t(9,c=R)),dt(o,Jn,R=>t(10,u=R)),dt(o,ko,R=>t(11,f=R)),dt(o,es,R=>t(3,a=R));let{name:_}=e,{existing:x}=e;x&&(x.properties.waypoints?At(ko,f=x.properties.waypoints.map(R=>({point:[R.lon,R.lat],snapped:R.snapped})),f):At(ko,f=x.geometry.coordinates[0].slice(1).map(R=>({point:R,snapped:!1})),f));function S(){if(f.length>=3)try{let R=Z0(f);u.setNeighbourhoodBoundary(_,R),ec(),u.setCurrentNeighbourhood(_,c),At(ri,n={mode:"neighbourhood"},n)}catch{window.alert("Known georust bug hit, sorry. You may need to just refresh the page now."),k()}}function k(){x?At(ri,n={mode:"neighbourhood"},n):At(ri,n={mode:"network"},n)}const I=()=>At(ri,n={mode:"title",firstLoad:!1},n),P=()=>At(ri,n={mode:"network"},n),D=()=>At(ri,n={mode:"neighbourhood"},n);return o.$$set=R=>{"name"in R&&t(0,_=R.name),"existing"in R&&t(1,x=R.existing)},[_,x,n,a,S,k,I,P,D]}class s5 extends Ht{constructor(e){super(),Wt(this,e,o5,r5,Ut,{name:0,existing:1})}}const a5="/ltn/assets/settings-342fb430.svg";function vy(o){let e,t;return e=new Sd({props:{$$slots:{default:[l5]},$$scope:{ctx:o}}}),e.$on("close",o[7]),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c&263&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function l5(o){let e,t,n,c,u,f,a,_,x,S,k,I,P,D,R,z,B,N,V;return n=new zS({}),{c(){e=ue("h1"),e.textContent="Settings",t=Fe(),Re(n.$$.fragment),c=Fe(),u=ue("label"),f=Qe(`Style for roads in a neighbourhood:
      `),a=ue("select"),_=ue("option"),_.textContent="Show worst shortcuts",x=ue("option"),x.textContent="Show the cell",S=Fe(),k=ue("label"),I=ue("input"),P=Qe(`
      Road thickness depends on shortcuts`),D=Fe(),R=ue("center"),z=ue("button"),z.textContent="Confirm",_.__value="shortcuts",Hn(_,_.__value),x.__value="cells",Hn(x,x.__value),o[1]===void 0&&Yl(()=>o[4].call(a)),Te(I,"type","checkbox")},m(j,le){de(j,e,le),de(j,t,le),ze(n,j,le),de(j,c,le),de(j,u,le),ie(u,f),ie(u,a),ie(a,_),ie(a,x),Jl(a,o[1],!0),de(j,S,le),de(j,k,le),ie(k,I),I.checked=o[2],ie(k,P),de(j,D,le),de(j,R,le),ie(R,z),B=!0,N||(V=[Et(a,"change",o[4]),Et(I,"change",o[5]),Et(z,"click",o[6])],N=!0)},p(j,le){le&2&&Jl(a,j[1]),le&4&&(I.checked=j[2])},i(j){B||(re(n.$$.fragment,j),B=!0)},o(j){ce(n.$$.fragment,j),B=!1},d(j){j&&(he(e),he(t),he(c),he(u),he(S),he(k),he(D),he(R)),De(n,j),N=!1,ln(V)}}}function c5(o){let e,t,n,c,u,f,a=o[0]&&vy(o);return{c(){e=ue("button"),e.innerHTML=`<img src="${a5}" alt="Settings"/>`,t=Fe(),a&&a.c(),n=Bn(),Te(e,"class","outline")},m(_,x){de(_,e,x),de(_,t,x),a&&a.m(_,x),de(_,n,x),c=!0,u||(f=Et(e,"click",o[3]),u=!0)},p(_,[x]){_[0]?a?(a.p(_,x),x&1&&re(a,1)):(a=vy(_),a.c(),re(a,1),a.m(n.parentNode,n)):a&&(_i(),ce(a,1,1,()=>{a=null}),yi())},i(_){c||(re(a),c=!0)},o(_){ce(a),c=!1},d(_){_&&(he(e),he(t),he(n)),a&&a.d(_),u=!1,f()}}}function u5(o,e,t){let n,c;dt(o,ip,k=>t(1,n=k)),dt(o,np,k=>t(2,c=k));let u=!1;const f=()=>t(0,u=!0);function a(){n=wp(this),ip.set(n)}function _(){c=this.checked,np.set(c)}return[u,n,c,f,a,_,()=>t(0,u=!1),()=>t(0,u=!1)]}class h5 extends Ht{constructor(e){super(),Wt(this,e,u5,c5,Ut,{})}}const d5=["==",["geometry-type"],"Polygon"],f5=["==",["geometry-type"],"LineString"],p5=["==",["geometry-type"],"Point"];function G0(){return{type:"FeatureCollection",features:[]}}function Wf(o){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:W0(o)}}}function W0(o){return[Math.round(o[0]*1e7)/1e7,Math.round(o[1]*1e7)/1e7]}const H0=wi(G0()),$0=wi(0),m5=100;class g5{constructor(e){Dn(this,"map");Dn(this,"active");Dn(this,"eventListenersSuccess");Dn(this,"eventListenersUpdated");Dn(this,"eventListenersFailure");Dn(this,"points");Dn(this,"cursor");Dn(this,"hover");Dn(this,"dragFrom");Dn(this,"previousStates");Dn(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let c of this.points)c[0]-=t,c[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});Dn(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(by(this.points).forEach((n,c)=>{t.push([c+1,ow(n,this.cursor).properties.dist])}),t.sort((n,c)=>n[1]-c[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});Dn(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=Wf(e.lngLat.toArray()),this.onClick(e),this.finish())});Dn(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});Dn(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});Dn(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});Dn(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=G0();this.points.forEach((c,u)=>{let f=Wf(c);f.properties.hover=this.hover==u,f.properties.idx=u,e.features.push(f)}),e.features=e.features.concat(by(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),H0.set(e);let n="crosshair";this.hover!=null&&(n=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=n,$0.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Wf(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(W0),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>m5&&this.previousStates.shift()}}function by(o){let e=[];for(let t=0;t<o.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[o[t],o[t+1]]},properties:{}});return o.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[o[o.length-1],o[0]]},properties:{}}),e}function _5(o){let e,t,n;return{c(){e=Qe("Undo ("),t=Qe(o[1]),n=Qe(")")},m(c,u){de(c,e,u),de(c,t,u),de(c,n,u)},p(c,u){u&2&&Ci(t,c[1])},d(c){c&&(he(e),he(t),he(n))}}}function y5(o){let e;return{c(){e=Qe("Undo")},m(t,n){de(t,e,n)},p:Dt,d(t){t&&he(e)}}}function v5(o){let e,t,n,c,u,f,a,_,x,S,k;function I(R,z){return R[1]==0?y5:_5}let P=I(o),D=P(o);return{c(){e=ue("div"),t=ue("button"),t.textContent="Finish",n=Fe(),c=ue("button"),c.textContent="Cancel",u=Fe(),f=ue("button"),D.c(),_=Fe(),x=ue("ul"),x.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,f.disabled=a=o[1]==0,mn(e,"display","flex"),mn(e,"justify-content","space-between")},m(R,z){de(R,e,z),ie(e,t),ie(e,n),ie(e,c),ie(e,u),ie(e,f),D.m(f,null),de(R,_,z),de(R,x,z),S||(k=[Et(t,"click",o[2]),Et(c,"click",o[3]),Et(f,"click",o[4])],S=!0)},p(R,[z]){P===(P=I(R))&&D?D.p(R,z):(D.d(1),D=P(R),D&&(D.c(),D.m(f,null))),z&2&&a!==(a=R[1]==0)&&(f.disabled=a)},i:Dt,o:Dt,d(R){R&&(he(e),he(_),he(x)),D.d(),S=!1,ln(k)}}}function b5(o,e,t){let n;dt(o,$0,_=>t(1,n=_));let{polygonTool:c}=e;const u=()=>c.finish(),f=()=>c.cancel(),a=()=>c.undo();return o.$$set=_=>{"polygonTool"in _&&t(0,c=_.polygonTool)},[c,n,u,f,a]}class w5 extends Ht{constructor(e){super(),Wt(this,e,b5,v5,Ut,{polygonTool:0})}}let x5=Date.now();function Wu(o){return`${o}-${x5++}`}const X0=Symbol.for("svelte-maplibre");function k5(){return kp(X0)}function wy(o){return{subscribe:o.subscribe}}function K0({key:o,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let c=k5(),u=wi(null),f=wy(u),a={...c,[o]:wy(u)};if(e&&(a.popupTarget=f),n){let _=wi(null);a.layerEvent=_,c.layerEvent=_}return t&&(a.cluster=wi()),xp(X0,a),{...c,self:u}}function S5(){return K0({key:"source",setCluster:!0})}function T5(o=!0){return K0({key:"layer",setPopupTarget:o,setMouseEvent:o})}function xy(o){let e;return t=>{if(t)for(let n in t){let c=e==null?void 0:e[n],u=t[n];c!==u&&o(n,u,c)}else if(e)for(let n in e)o(n,void 0,e[n]);e=t}}function E5(o,...e){let t=[o];for(let n of e)if(n)Array.isArray(n)&&n[0]===o?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function C5(o){return o===!0?["has","point_count"]:o===!1?["!",["has","point_count"]]:void 0}function ky(o){let e=o[0],t,n,c=Sy(o);return{c(){c.c(),t=Bn()},m(u,f){c.m(u,f),de(u,t,f),n=!0},p(u,f){f[0]&1&&Ut(e,e=u[0])?(_i(),ce(c,1,1,Dt),yi(),c=Sy(u),c.c(),re(c,1),c.m(t.parentNode,t)):c.p(u,f)},i(u){n||(re(c),n=!0)},o(u){ce(c),n=!1},d(u){u&&he(t),c.d(u)}}}function Sy(o){let e;const t=o[36].default,n=Bi(t,o,o[35],null);return{c(){n&&n.c()},m(c,u){n&&n.m(c,u),e=!0},p(c,u){n&&n.p&&(!e||u[1]&16)&&Oi(n,t,c,c[35],e?Fi(t,c[35],u,null):Ni(c[35]),null)},i(c){e||(re(n,c),e=!0)},o(c){ce(n,c),e=!1},d(c){n&&n.d(c)}}}function M5(o){let e,t,n=o[0]&&ky(o);return{c(){n&&n.c(),e=Bn()},m(c,u){n&&n.m(c,u),de(c,e,u),t=!0},p(c,u){c[0]?n?(n.p(c,u),u[0]&1&&re(n,1)):(n=ky(c),n.c(),re(n,1),n.m(e.parentNode,e)):n&&(_i(),ce(n,1,1,()=>{n=null}),yi())},i(c){t||(re(n),t=!0)},o(c){ce(n),t=!1},d(c){c&&he(e),n&&n.d(c)}}}function I5(o,e,t){let n,c,u,f,a,_,x,S,k,I,P,D,{$$slots:R={},$$scope:z}=e,{id:B=Wu("layer")}=e,{source:N=void 0}=e,{sourceLayer:V=void 0}=e,{beforeId:j=void 0}=e,{beforeLayerType:le=void 0}=e,{type:oe}=e,{paint:$=void 0}=e,{layout:Y=void 0}=e,{filter:ve=void 0}=e,{applyToClusters:Be=void 0}=e,{minzoom:te=void 0}=e,{maxzoom:ne=void 0}=e,{manageHoverState:qe=!1}=e,{hovered:Ce=null}=e,{interactive:et=!0}=e,{hoverCursor:bt=void 0}=e,{eventsIfTopMost:ft=!1}=e;const ot=ts(),{map:Zt,source:ii,self:Ft,minzoom:Pt,maxzoom:Jt,eventTopMost:Mt,layerInfo:ei}=T5();dt(o,Zt,Ne=>t(31,k=Ne)),dt(o,ii,Ne=>t(32,I=Ne)),dt(o,Ft,Ne=>t(0,S=Ne)),dt(o,Pt,Ne=>t(34,D=Ne)),dt(o,Jt,Ne=>t(33,P=Ne)),er(()=>{S&&k&&(ei.delete(S),k==null||k.removeLayer(S))});let Vt;function hi(Ne){var we,di;if(!et||!S||!k||ft&&Mt(Ne)!==S)return;let je=Ne.features??[],rt=(di=(we=je[0])==null?void 0:we.properties)==null?void 0:di.cluster_id,xt={event:Ne,map:k,clusterId:rt,layer:S,source:a,features:je};ot(Ne.type,xt)}function xi(Ne){var we,di;if(!et||!S||!k||ft&&Mt(Ne)!==S)return;bt&&(k.getCanvas().style.cursor=bt);let je=Ne.features??[];t(6,Ce=je[0]??null);let rt=(di=(we=je[0])==null?void 0:we.properties)==null?void 0:di.cluster_id;ot("mouseenter",{event:Ne,map:k,clusterId:rt,layer:S,source:a,features:je})}function gi(Ne){var we,di,Ve;if(!et||!k)return;if(ft&&Mt(Ne)!==S){t(6,Ce=null),qe&&Vt!==void 0&&(k==null||k.setFeatureState({source:a,sourceLayer:V,id:Vt},{hover:!1}),Vt=void 0);return}k.getCanvas().style.cursor=bt;let je=Ne.features??[],rt=(di=(we=je[0])==null?void 0:we.properties)==null?void 0:di.cluster_id,xt=(Ve=je[0])==null?void 0:Ve.id;xt!==Vt&&(qe&&(Vt!==void 0&&(k==null||k.setFeatureState({source:a,id:Vt,sourceLayer:V},{hover:!1})),k==null||k.setFeatureState({source:a,id:xt,sourceLayer:V},{hover:!0})),Vt=xt,t(6,Ce=je[0]??null)),ot("mousemove",{event:Ne,map:k,clusterId:rt,layer:S,source:a,features:je})}function Ai(Ne){if(!(!et||!S||!k)){if(bt&&(k.getCanvas().style.cursor=""),t(6,Ce=null),qe&&Vt!==void 0){const je={source:a,id:Vt,sourceLayer:V};k==null||k.setFeatureState(je,{hover:!1}),Vt=void 0}ot("mouseleave",{map:k,layer:S,source:a})}}let ct=!0;function It(Ne){k&&(k.off("click",Ne,hi),k.off("dblclick",Ne,hi),k.off("contextmenu",Ne,hi),k.off("mouseenter",Ne,xi),k.off("mousemove",Ne,gi),k.off("mouseleave",Ne,Ai))}return er(()=>{k&&S&&It(S)}),o.$$set=Ne=>{"id"in Ne&&t(7,B=Ne.id),"source"in Ne&&t(8,N=Ne.source),"sourceLayer"in Ne&&t(9,V=Ne.sourceLayer),"beforeId"in Ne&&t(10,j=Ne.beforeId),"beforeLayerType"in Ne&&t(11,le=Ne.beforeLayerType),"type"in Ne&&t(12,oe=Ne.type),"paint"in Ne&&t(13,$=Ne.paint),"layout"in Ne&&t(14,Y=Ne.layout),"filter"in Ne&&t(15,ve=Ne.filter),"applyToClusters"in Ne&&t(16,Be=Ne.applyToClusters),"minzoom"in Ne&&t(17,te=Ne.minzoom),"maxzoom"in Ne&&t(18,ne=Ne.maxzoom),"manageHoverState"in Ne&&t(19,qe=Ne.manageHoverState),"hovered"in Ne&&t(6,Ce=Ne.hovered),"interactive"in Ne&&t(20,et=Ne.interactive),"hoverCursor"in Ne&&t(21,bt=Ne.hoverCursor),"eventsIfTopMost"in Ne&&t(22,ft=Ne.eventsIfTopMost),"$$scope"in Ne&&t(35,z=Ne.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&65536&&t(30,n=C5(Be)),o.$$.dirty[0]&1073774592&&t(24,c=E5("all",n,ve)),o.$$.dirty[0]&131072|o.$$.dirty[1]&8&&t(26,u=te??D),o.$$.dirty[0]&262144|o.$$.dirty[1]&4&&t(25,f=ne??P),o.$$.dirty[0]&256|o.$$.dirty[1]&2&&t(29,a=N||I),o.$$.dirty[0]&654343809|o.$$.dirty[1]&1&&k&&S!==B&&a){S&&(It(S),ei.delete(S));let Ne=j;if(!j&&le){let je=k.getStyle().layers,rt=typeof le=="function"?le:we=>we.type===le,xt=je==null?void 0:je.find(rt);xt&&(Ne=xt.id)}At(Ft,S=B,S),k.addLayer(Oa({id:S,type:oe,source:a,"source-layer":V,filter:c,paint:$,layout:Y,minzoom:u,maxzoom:f}),Ne),t(23,ct=!0),k.on("click",S,hi),k.on("dblclick",S,hi),k.on("contextmenu",S,hi),k.on("mouseenter",S,xi),k.on("mousemove",S,gi),k.on("mouseleave",S,Ai)}o.$$.dirty[0]&1048577&&S&&ei.set(S,{interactive:et}),o.$$.dirty[0]&1|o.$$.dirty[1]&1&&t(28,_=S?xy((Ne,je)=>k==null?void 0:k.setPaintProperty(S,Ne,je)):void 0),o.$$.dirty[0]&1|o.$$.dirty[1]&1&&t(27,x=S?xy((Ne,je)=>k==null?void 0:k.setLayoutProperty(S,Ne,je)):void 0),o.$$.dirty[0]&268443648&&(_==null||_($)),o.$$.dirty[0]&134234112&&(x==null||x(Y)),o.$$.dirty[0]&100663297|o.$$.dirty[1]&1&&S&&(k==null||k.setLayerZoomRange(S,u,f)),o.$$.dirty[0]&25165825|o.$$.dirty[1]&1&&S&&(ct?t(23,ct=!1):k==null||k.setFilter(S,c))},[S,Zt,ii,Ft,Pt,Jt,Ce,B,N,V,j,le,oe,$,Y,ve,Be,te,ne,qe,et,bt,ft,ct,c,f,u,x,_,a,n,k,I,P,D,z,R]}class Up extends Ht{constructor(e){super(),Wt(this,e,I5,M5,Ut,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function L5(o){let e;const t=o[16].default,n=Bi(t,o,o[24],null);return{c(){n&&n.c()},m(c,u){n&&n.m(c,u),e=!0},p(c,u){n&&n.p&&(!e||u&16777216)&&Oi(n,t,c,c[24],e?Fi(t,c[24],u,null):Ni(c[24]),null)},i(c){e||(re(n,c),e=!0)},o(c){ce(n,c),e=!1},d(c){n&&n.d(c)}}}function A5(o){let e,t,n;function c(f){o[17](f)}let u={id:o[1],type:"circle",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],applyToClusters:o[9],minzoom:o[10],maxzoom:o[11],hoverCursor:o[12],manageHoverState:o[13],eventsIfTopMost:o[14],interactive:o[15],$$slots:{default:[L5]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Up({props:u}),Xi.push(()=>Wr(e,"hovered",c)),e.$on("click",o[18]),e.$on("dblclick",o[19]),e.$on("contextmenu",o[20]),e.$on("mouseenter",o[21]),e.$on("mousemove",o[22]),e.$on("mouseleave",o[23]),{c(){Re(e.$$.fragment)},m(f,a){ze(e,f,a),n=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.applyToClusters=f[9]),a&1024&&(_.minzoom=f[10]),a&2048&&(_.maxzoom=f[11]),a&4096&&(_.hoverCursor=f[12]),a&8192&&(_.manageHoverState=f[13]),a&16384&&(_.eventsIfTopMost=f[14]),a&32768&&(_.interactive=f[15]),a&16777216&&(_.$$scope={dirty:a,ctx:f}),!t&&a&1&&(t=!0,_.hovered=f[0],Gr(()=>t=!1)),e.$set(_)},i(f){n||(re(e.$$.fragment,f),n=!0)},o(f){ce(e.$$.fragment,f),n=!1},d(f){De(e,f)}}}function P5(o,e,t){let{$$slots:n={},$$scope:c}=e,{id:u=Wu("circle")}=e,{source:f=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:S}=e,{layout:k=void 0}=e,{filter:I=void 0}=e,{applyToClusters:P=void 0}=e,{minzoom:D=void 0}=e,{maxzoom:R=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:B=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:V=!1}=e,{interactive:j=!0}=e;function le(ne){N=ne,t(0,N)}function oe(ne){ui.call(this,o,ne)}function $(ne){ui.call(this,o,ne)}function Y(ne){ui.call(this,o,ne)}function ve(ne){ui.call(this,o,ne)}function Be(ne){ui.call(this,o,ne)}function te(ne){ui.call(this,o,ne)}return o.$$set=ne=>{"id"in ne&&t(1,u=ne.id),"source"in ne&&t(2,f=ne.source),"sourceLayer"in ne&&t(3,a=ne.sourceLayer),"beforeId"in ne&&t(4,_=ne.beforeId),"beforeLayerType"in ne&&t(5,x=ne.beforeLayerType),"paint"in ne&&t(6,S=ne.paint),"layout"in ne&&t(7,k=ne.layout),"filter"in ne&&t(8,I=ne.filter),"applyToClusters"in ne&&t(9,P=ne.applyToClusters),"minzoom"in ne&&t(10,D=ne.minzoom),"maxzoom"in ne&&t(11,R=ne.maxzoom),"hoverCursor"in ne&&t(12,z=ne.hoverCursor),"manageHoverState"in ne&&t(13,B=ne.manageHoverState),"hovered"in ne&&t(0,N=ne.hovered),"eventsIfTopMost"in ne&&t(14,V=ne.eventsIfTopMost),"interactive"in ne&&t(15,j=ne.interactive),"$$scope"in ne&&t(24,c=ne.$$scope)},[N,u,f,a,_,x,S,k,I,P,D,R,z,B,V,j,n,le,oe,$,Y,ve,Be,te,c]}class z5 extends Ht{constructor(e){super(),Wt(this,e,P5,A5,Ut,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function D5(o){let e;const t=o[15].default,n=Bi(t,o,o[23],null);return{c(){n&&n.c()},m(c,u){n&&n.m(c,u),e=!0},p(c,u){n&&n.p&&(!e||u&8388608)&&Oi(n,t,c,c[23],e?Fi(t,c[23],u,null):Ni(c[23]),null)},i(c){e||(re(n,c),e=!0)},o(c){ce(n,c),e=!1},d(c){n&&n.d(c)}}}function R5(o){let e,t,n;function c(f){o[16](f)}let u={id:o[1],type:"fill",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],minzoom:o[9],maxzoom:o[10],hoverCursor:o[11],manageHoverState:o[12],eventsIfTopMost:o[13],interactive:o[14],$$slots:{default:[D5]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Up({props:u}),Xi.push(()=>Wr(e,"hovered",c)),e.$on("click",o[17]),e.$on("dblclick",o[18]),e.$on("contextmenu",o[19]),e.$on("mouseenter",o[20]),e.$on("mousemove",o[21]),e.$on("mouseleave",o[22]),{c(){Re(e.$$.fragment)},m(f,a){ze(e,f,a),n=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.minzoom=f[9]),a&1024&&(_.maxzoom=f[10]),a&2048&&(_.hoverCursor=f[11]),a&4096&&(_.manageHoverState=f[12]),a&8192&&(_.eventsIfTopMost=f[13]),a&16384&&(_.interactive=f[14]),a&8388608&&(_.$$scope={dirty:a,ctx:f}),!t&&a&1&&(t=!0,_.hovered=f[0],Gr(()=>t=!1)),e.$set(_)},i(f){n||(re(e.$$.fragment,f),n=!0)},o(f){ce(e.$$.fragment,f),n=!1},d(f){De(e,f)}}}function B5(o,e,t){let{$$slots:n={},$$scope:c}=e,{id:u=Wu("fill")}=e,{source:f=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:S}=e,{layout:k=void 0}=e,{filter:I=void 0}=e,{minzoom:P=void 0}=e,{maxzoom:D=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:z=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:N=!1}=e,{interactive:V=!0}=e;function j(te){B=te,t(0,B)}function le(te){ui.call(this,o,te)}function oe(te){ui.call(this,o,te)}function $(te){ui.call(this,o,te)}function Y(te){ui.call(this,o,te)}function ve(te){ui.call(this,o,te)}function Be(te){ui.call(this,o,te)}return o.$$set=te=>{"id"in te&&t(1,u=te.id),"source"in te&&t(2,f=te.source),"sourceLayer"in te&&t(3,a=te.sourceLayer),"beforeId"in te&&t(4,_=te.beforeId),"beforeLayerType"in te&&t(5,x=te.beforeLayerType),"paint"in te&&t(6,S=te.paint),"layout"in te&&t(7,k=te.layout),"filter"in te&&t(8,I=te.filter),"minzoom"in te&&t(9,P=te.minzoom),"maxzoom"in te&&t(10,D=te.maxzoom),"hoverCursor"in te&&t(11,R=te.hoverCursor),"manageHoverState"in te&&t(12,z=te.manageHoverState),"hovered"in te&&t(0,B=te.hovered),"eventsIfTopMost"in te&&t(13,N=te.eventsIfTopMost),"interactive"in te&&t(14,V=te.interactive),"$$scope"in te&&t(23,c=te.$$scope)},[B,u,f,a,_,x,S,k,I,P,D,R,z,N,V,n,j,le,oe,$,Y,ve,Be,c]}class F5 extends Ht{constructor(e){super(),Wt(this,e,B5,R5,Ut,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function O5(o,e,t,n,c){let u=!1;o.getSource(e)&&(u=!0,o.removeSource(e));const f=()=>{n(e)&&(o.addSource(e,t),c())};if(u){const a=()=>{e&&(o.getSource(e)?setTimeout(a,1):f())};a()}else f()}function N5(o,e,t){Zy().then(()=>{let n=Lr(o);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function Ty(o){let e=o[0],t,n,c=Ey(o);return{c(){c.c(),t=Bn()},m(u,f){c.m(u,f),de(u,t,f),n=!0},p(u,f){f&1&&Ut(e,e=u[0])?(_i(),ce(c,1,1,Dt),yi(),c=Ey(u),c.c(),re(c,1),c.m(t.parentNode,t)):c.p(u,f)},i(u){n||(re(c),n=!0)},o(u){ce(c),n=!1},d(u){u&&he(t),c.d(u)}}}function Ey(o){let e;const t=o[15].default,n=Bi(t,o,o[14],null);return{c(){n&&n.c()},m(c,u){n&&n.m(c,u),e=!0},p(c,u){n&&n.p&&(!e||u&16384)&&Oi(n,t,c,c[14],e?Fi(t,c[14],u,null):Ni(c[14]),null)},i(c){e||(re(n,c),e=!0)},o(c){ce(n,c),e=!1},d(c){n&&n.d(c)}}}function j5(o){let e,t,n=o[0]&&Ty(o);return{c(){n&&n.c(),e=Bn()},m(c,u){n&&n.m(c,u),de(c,e,u),t=!0},p(c,[u]){c[0]?n?(n.p(c,u),u&1&&re(n,1)):(n=Ty(c),n.c(),re(n,1),n.m(e.parentNode,e)):n&&(_i(),ce(n,1,1,()=>{n=null}),yi())},i(c){t||(re(n),t=!0)},o(c){ce(n),t=!1},d(c){c&&he(e),n&&n.d(c)}}}function U5(o,e,t){let n,c,u,{$$slots:f={},$$scope:a}=e,{id:_=Wu("geojson")}=e,{data:x}=e,{generateId:S=!1}=e,{promoteId:k=void 0}=e,{filter:I=void 0}=e,{lineMetrics:P=void 0}=e,{cluster:D=void 0}=e;const{map:R,cluster:z,self:B}=S5();dt(o,R,j=>t(13,c=j)),dt(o,z,j=>t(16,u=j)),dt(o,B,j=>t(0,n=j));let N,V=!0;return er(()=>{n&&N&&c&&(N5(R,n,N),At(B,n=null,n),t(11,N=void 0))}),o.$$set=j=>{"id"in j&&t(4,_=j.id),"data"in j&&t(5,x=j.data),"generateId"in j&&t(6,S=j.generateId),"promoteId"in j&&t(7,k=j.promoteId),"filter"in j&&t(8,I=j.filter),"lineMetrics"in j&&t(9,P=j.lineMetrics),"cluster"in j&&t(10,D=j.cluster),"$$scope"in j&&t(14,a=j.$$scope)},o.$$.update=()=>{o.$$.dirty&1024&&At(z,u=D,u),o.$$.dirty&12273&&c&&n!==_&&(At(B,n=_,n),O5(c,n,Oa({type:"geojson",data:x,filter:I,lineMetrics:P,generateId:S,promoteId:k,cluster:!!D,clusterMinPoints:D==null?void 0:D.minPoints,clusterMaxZoom:D==null?void 0:D.maxZoom,clusterRadius:D==null?void 0:D.radius,clusterProperties:D==null?void 0:D.properties}),j=>c&&j===n,()=>{n&&(t(11,N=c==null?void 0:c.getSource(n)),t(12,V=!0))})),o.$$.dirty&8208&&(c==null||c.on("style.load",()=>{t(11,N=c==null?void 0:c.getSource(_))})),o.$$.dirty&6176&&N&&(V?t(12,V=!1):N.setData(x)),o.$$.dirty&3072&&(N==null||N.setClusterOptions(Oa({cluster:!!D,clusterMaxZoom:D==null?void 0:D.maxZoom,clusterRadius:D==null?void 0:D.radius})))},[n,R,z,B,_,x,S,k,I,P,D,N,V,c,a,f]}class V5 extends Ht{constructor(e){super(),Wt(this,e,U5,j5,Ut,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function q5(o){let e;const t=o[15].default,n=Bi(t,o,o[23],null);return{c(){n&&n.c()},m(c,u){n&&n.m(c,u),e=!0},p(c,u){n&&n.p&&(!e||u&8388608)&&Oi(n,t,c,c[23],e?Fi(t,c[23],u,null):Ni(c[23]),null)},i(c){e||(re(n,c),e=!0)},o(c){ce(n,c),e=!1},d(c){n&&n.d(c)}}}function Z5(o){let e,t,n;function c(f){o[16](f)}let u={id:o[1],type:"line",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],minzoom:o[9],maxzoom:o[10],hoverCursor:o[11],manageHoverState:o[12],eventsIfTopMost:o[13],interactive:o[14],$$slots:{default:[q5]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Up({props:u}),Xi.push(()=>Wr(e,"hovered",c)),e.$on("click",o[17]),e.$on("dblclick",o[18]),e.$on("contextmenu",o[19]),e.$on("mouseenter",o[20]),e.$on("mousemove",o[21]),e.$on("mouseleave",o[22]),{c(){Re(e.$$.fragment)},m(f,a){ze(e,f,a),n=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.minzoom=f[9]),a&1024&&(_.maxzoom=f[10]),a&2048&&(_.hoverCursor=f[11]),a&4096&&(_.manageHoverState=f[12]),a&8192&&(_.eventsIfTopMost=f[13]),a&16384&&(_.interactive=f[14]),a&8388608&&(_.$$scope={dirty:a,ctx:f}),!t&&a&1&&(t=!0,_.hovered=f[0],Gr(()=>t=!1)),e.$set(_)},i(f){n||(re(e.$$.fragment,f),n=!0)},o(f){ce(e.$$.fragment,f),n=!1},d(f){De(e,f)}}}function G5(o,e,t){let{$$slots:n={},$$scope:c}=e,{id:u=Wu("line")}=e,{source:f=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:S}=e,{layout:k=void 0}=e,{filter:I=void 0}=e,{minzoom:P=void 0}=e,{maxzoom:D=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:z=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:N=!1}=e,{interactive:V=!0}=e;function j(te){B=te,t(0,B)}function le(te){ui.call(this,o,te)}function oe(te){ui.call(this,o,te)}function $(te){ui.call(this,o,te)}function Y(te){ui.call(this,o,te)}function ve(te){ui.call(this,o,te)}function Be(te){ui.call(this,o,te)}return o.$$set=te=>{"id"in te&&t(1,u=te.id),"source"in te&&t(2,f=te.source),"sourceLayer"in te&&t(3,a=te.sourceLayer),"beforeId"in te&&t(4,_=te.beforeId),"beforeLayerType"in te&&t(5,x=te.beforeLayerType),"paint"in te&&t(6,S=te.paint),"layout"in te&&t(7,k=te.layout),"filter"in te&&t(8,I=te.filter),"minzoom"in te&&t(9,P=te.minzoom),"maxzoom"in te&&t(10,D=te.maxzoom),"hoverCursor"in te&&t(11,R=te.hoverCursor),"manageHoverState"in te&&t(12,z=te.manageHoverState),"hovered"in te&&t(0,B=te.hovered),"eventsIfTopMost"in te&&t(13,N=te.eventsIfTopMost),"interactive"in te&&t(14,V=te.interactive),"$$scope"in te&&t(23,c=te.$$scope)},[B,u,f,a,_,x,S,k,I,P,D,R,z,N,V,n,j,le,oe,$,Y,ve,Be,c]}class W5 extends Ht{constructor(e){super(),Wt(this,e,G5,Z5,Ut,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function H5(o){let e,t,n,c,u,f;return e=new F5({props:{id:"edit-polygon-fill",filter:d5,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),n=new W5({props:{id:"edit-polygon-lines",filter:f5,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),u=new z5({props:{id:"edit-polygon-vertices",filter:p5,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){Re(e.$$.fragment),t=Fe(),Re(n.$$.fragment),c=Fe(),Re(u.$$.fragment)},m(a,_){ze(e,a,_),de(a,t,_),ze(n,a,_),de(a,c,_),ze(u,a,_),f=!0},p:Dt,i(a){f||(re(e.$$.fragment,a),re(n.$$.fragment,a),re(u.$$.fragment,a),f=!0)},o(a){ce(e.$$.fragment,a),ce(n.$$.fragment,a),ce(u.$$.fragment,a),f=!1},d(a){a&&(he(t),he(c)),De(e,a),De(n,a),De(u,a)}}}function $5(o){let e,t;return e=new V5({props:{data:o[0],$$slots:{default:[H5]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,[c]){const u={};c&1&&(u.data=n[0]),c&2&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function X5(o,e,t){let n;return dt(o,H0,c=>t(0,n=c)),[n]}class K5 extends Ht{constructor(e){super(),Wt(this,e,X5,$5,Ut,{})}}function J5(o){let e,t,n,c,u,f,a;return{c(){e=ue("button"),e.textContent="Import current view",t=Fe(),n=ue("i"),n.textContent="or...",c=Fe(),u=ue("button"),u.textContent="Draw an area to import on the map",Te(e,"type","button"),Te(u,"type","button")},m(_,x){de(_,e,x),de(_,t,x),de(_,n,x),de(_,c,x),de(_,u,x),f||(a=[Et(e,"click",o[2]),Et(u,"click",o[3])],f=!0)},p:Dt,i:Dt,o:Dt,d(_){_&&(he(e),he(t),he(n),he(c),he(u)),f=!1,ln(a)}}}function Y5(o){let e,t;return e=new w5({props:{polygonTool:o[0]}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c&1&&(u.polygonTool=n[0]),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function Q5(o){let e,t,n,c,u,f,a,_,x;const S=[Y5,J5],k=[];function I(P,D){return P[0]?0:1}return e=I(o),t=k[e]=S[e](o),{c(){t.c(),n=Fe(),c=ue("label"),u=ue("input"),f=Qe(`Save a copy of the osm.xml
  after importing`),Te(u,"type","checkbox")},m(P,D){k[e].m(P,D),de(P,n,D),de(P,c,D),ie(c,u),u.checked=o[1],ie(c,f),a=!0,_||(x=Et(u,"change",o[5]),_=!0)},p(P,[D]){let R=e;e=I(P),e===R?k[e].p(P,D):(_i(),ce(k[R],1,1,()=>{k[R]=null}),yi(),t=k[e],t?t.p(P,D):(t=k[e]=S[e](P),t.c()),re(t,1),t.m(n.parentNode,n)),D&2&&(u.checked=P[1])},i(P){a||(re(t),a=!0)},o(P){ce(t),a=!1},d(P){P&&(he(n),he(c)),k[e].d(P),_=!1,x()}}}function hu(o){return[o.lng,o.lat]}function eE(o,e,t){let{map:n}=e;const c=ts();let u=null,f=!1;async function a(I){try{c("loading","Loading from Overpass");let D=await(await fetch(J0(I))).text();f&&pd("osm.xml",D),c("gotXml",{xml:D,boundary:I})}catch(P){c("error",P.toString())}}function _(){let I=n.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[hu(I.getSouthWest()),hu(I.getNorthWest()),hu(I.getNorthEast()),hu(I.getSouthEast()),hu(I.getSouthWest())]],type:"Polygon"}}}async function x(){if(n){if(n.getZoom()<13){c("error","Zoom in more to import");return}await a(_())}}function S(){n&&(t(0,u=new g5(n)),u.startNew(),u.addEventListenerSuccess(async I=>{t(0,u=null),await a(I)}),u.addEventListenerFailure(()=>{t(0,u=null)}))}function k(){f=this.checked,t(1,f)}return o.$$set=I=>{"map"in I&&t(4,n=I.map)},[u,f,x,S,n,k]}class tE extends Ht{constructor(e){super(),Wt(this,e,eE,Q5,Ut,{map:4})}}function J0(o){let e='poly:"';for(let[n,c]of o.geometry.coordinates[0])e+=`${c} ${n} `;return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}class Y0{constructor(e,t,n){Dn(this,"inner");this.inner=new yw(e,t,n)}getInvertedBoundary(){return JSON.parse(this.inner.getInvertedBoundary())}getBounds(){return Array.from(this.inner.getBounds())}toRouteSnapper(){return this.inner.toRouteSnapper()}toRouteSnapperGj(){return this.inner.toRouteSnapperGj()}renderModalFilters(){return JSON.parse(this.inner.renderModalFilters())}renderNeighbourhood(){let e=iE(JSON.parse(this.inner.renderNeighbourhood()));return e.maxShortcuts=Math.max(...e.features.map(t=>t.properties.kind=="interior_road"?t.properties.shortcuts:0))??0,e}renderAutoBoundaries(){return JSON.parse(this.inner.renderAutoBoundaries())}setNeighbourhoodBoundary(e,t){this.inner.setNeighbourhoodBoundary(e,t)}deleteNeighbourhoodBoundary(e){this.inner.deleteNeighbourhoodBoundary(e)}renameNeighbourhoodBoundary(e,t){this.inner.renameNeighbourhoodBoundary(e,t)}setCurrentNeighbourhood(e,t){this.inner.setCurrentNeighbourhood(e,t)}addModalFilter(e,t){this.inner.addModalFilter(e,t)}addManyModalFilters(e,t){this.inner.addManyModalFilters(e,t)}deleteModalFilter(e){this.inner.deleteModalFilter(e)}toggleDirection(e){this.inner.toggleDirection(e)}undo(){this.inner.undo()}redo(){this.inner.redo()}getShortcutsCrossingRoad(e){return JSON.parse(this.inner.getShortcutsCrossingRoad(e))}getAllShortcuts(){return JSON.parse(this.inner.getAllShortcuts())}toSavefile(){return JSON.parse(this.inner.toSavefile())}loadSavefile(e){this.inner.loadSavefile(e)}compareRoute(e,t,n){return JSON.parse(this.inner.compareRoute(e.lng,e.lat,t.lng,t.lat,n))}impactToOneDestination(e){return JSON.parse(this.inner.impactToOneDestination(e.lng,e.lat))}}function iE(o){let e=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];for(let t of o.features)t.properties.kind!="cell"&&t.properties.kind!="border_arrow"&&t.properties.kind!="interior_road"||(t.properties.cell_color=="disconnected"?t.properties.color="red":t.properties.color=e[t.properties.cell_color%e.length]);return o}async function dd(o){Es.set(o);try{let e=JSON.parse(window.localStorage.getItem(o));console.time("get OSM input");let[t,n]=await nE(e);console.timeEnd("get OSM input"),console.time("load"),Jn.set(new Y0(new Uint8Array(t),n,e.study_area_name||void 0)),Lr(Jn).loadSavefile(e),console.timeEnd("load"),Q0()}catch(e){window.alert(`Couldn't open project: ${e}`),Es.set("")}}async function nE(o){if(o.study_area_name){let e=Lr(Mu)?`/osm/${o.study_area_name}.pbf`:`https://assets.od2net.org/severance_pbfs/${o.study_area_name}.pbf`;console.log(`Grabbing ${e}`);let n=await(await fetch(e)).arrayBuffer(),c=Lr(Mu)?`/boundaries/${o.study_area_name}.geojson`:`https://assets.od2net.org/boundaries/${o.study_area_name}.geojson`,f=await(await fetch(c)).json();return[n,f]}else{console.log("Grabbing from Overpass");let e=o.features.find(c=>c.properties.kind=="study_area_boundary");return[await(await fetch(J0(e))).arrayBuffer(),e]}}function Q0(){ri.set({mode:"network"}),tc.set(new aw(Lr(es),Lr(Jn).toRouteSnapper(),wi(Xl()),wi(!0),wi(0))),Lr(es).fitBounds(Lr(Jn).getBounds(),{animate:!1}),Iu.set(Hf()),Lu.set(Hf()),od.set(Hf());let o=new URL(window.location.href);o.searchParams.set("project",Lr(Es)),window.history.replaceState(null,"",o.toString())}function Hf(){let o=Lr(Jn).getBounds(),e=o[0]+Math.random()*(o[2]-o[0]),t=o[1]+Math.random()*(o[3]-o[1]);return new Ts.LngLat(e,t)}function Cy(o,e,t){const n=o.slice();return n[17]=e[t][0],n[18]=e[t][1],n}function My(o,e,t){const n=o.slice();return n[21]=e[t][0],n[22]=e[t][1],n}function rE(o){let e;return{c(){e=Qe("Choose project")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function oE(o){let e,t,n,c,u,f,a,_;return u=new Pi({props:{$$slots:{default:[rE]},$$scope:{ctx:o}}}),u.$on("click",o[13]),{c(){e=ue("div"),t=ue("nav"),n=ue("ul"),c=ue("li"),Re(u.$$.fragment),f=Fe(),a=ue("li"),a.textContent="New project",Te(t,"aria-label","breadcrumb"),Te(e,"slot","top")},m(x,S){de(x,e,S),ie(e,t),ie(t,n),ie(n,c),ze(u,c,null),ie(n,f),ie(n,a),_=!0},p(x,S){const k={};S&33554432&&(k.$$scope={dirty:S,ctx:x}),u.$set(k)},i(x){_||(re(u.$$.fragment,x),_=!0)},o(x){ce(u.$$.fragment,x),_=!1},d(x){x&&he(e),De(u)}}}function Iy(o){let e,t,n,c,u,f,a,_,x,S,k,I,P,D;e=new Wy({props:{loading:o[4]}});let R=Kn(o[3]),z=[];for(let B=0;B<R.length;B+=1)z[B]=Ay(Cy(o,R,B));return k=new tE({props:{map:o[5]}}),k.$on("gotXml",o[7]),k.$on("loading",o[11]),k.$on("error",o[12]),{c(){Re(e.$$.fragment),t=Fe(),n=ue("label"),c=Qe(`Load a built-in area:
        `),u=ue("select"),f=ue("option");for(let B=0;B<z.length;B+=1)z[B].c();a=Fe(),_=ue("i"),_.textContent="or...",x=Fe(),S=ue("div"),Re(k.$$.fragment),f.__value="",Hn(f,f.__value),o[2]===void 0&&Yl(()=>o[9].call(u))},m(B,N){ze(e,B,N),de(B,t,N),de(B,n,N),ie(n,c),ie(n,u),ie(u,f);for(let V=0;V<z.length;V+=1)z[V]&&z[V].m(u,null);Jl(u,o[2],!0),de(B,a,N),de(B,_,N),de(B,x,N),de(B,S,N),ze(k,S,null),I=!0,P||(D=[Et(u,"change",o[9]),Et(u,"change",o[10])],P=!0)},p(B,N){const V={};if(N&16&&(V.loading=B[4]),e.$set(V),N&8){R=Kn(B[3]);let le;for(le=0;le<R.length;le+=1){const oe=Cy(B,R,le);z[le]?z[le].p(oe,N):(z[le]=Ay(oe),z[le].c(),z[le].m(u,null))}for(;le<z.length;le+=1)z[le].d(1);z.length=R.length}N&12&&Jl(u,B[2]);const j={};N&32&&(j.map=B[5]),k.$set(j)},i(B){I||(re(e.$$.fragment,B),re(k.$$.fragment,B),I=!0)},o(B){ce(e.$$.fragment,B),ce(k.$$.fragment,B),I=!1},d(B){B&&(he(t),he(n),he(a),he(_),he(x),he(S)),De(e,B),Ss(z,B),De(k),P=!1,ln(D)}}}function Ly(o){let e,t=o[22]+"",n,c;return{c(){e=ue("option"),n=Qe(t),e.__value=c=o[21],Hn(e,e.__value)},m(u,f){de(u,e,f),ie(e,n)},p(u,f){f&8&&t!==(t=u[22]+"")&&Ci(n,t),f&8&&c!==(c=u[21])&&(e.__value=c,Hn(e,e.__value))},d(u){u&&he(e)}}}function Ay(o){let e,t,n=Kn(o[18]),c=[];for(let u=0;u<n.length;u+=1)c[u]=Ly(My(o,n,u));return{c(){e=ue("optgroup");for(let u=0;u<c.length;u+=1)c[u].c();Te(e,"label",t=o[17])},m(u,f){de(u,e,f);for(let a=0;a<c.length;a+=1)c[a]&&c[a].m(e,null)},p(u,f){if(f&8){n=Kn(u[18]);let a;for(a=0;a<n.length;a+=1){const _=My(u,n,a);c[a]?c[a].p(_,f):(c[a]=Ly(_),c[a].c(),c[a].m(e,null))}for(;a<c.length;a+=1)c[a].d(1);c.length=n.length}f&8&&t!==(t=u[17])&&Te(e,"label",t)},d(u){u&&he(e),Ss(c,u)}}}function sE(o){let e,t,n,c,u,f,a,_,x,S=o[1]&&Iy(o);return{c(){e=ue("div"),t=ue("div"),n=ue("label"),c=Qe(`Project name:
        `),u=ue("input"),f=Fe(),S&&S.c(),Te(u,"type","text"),Te(e,"slot","sidebar")},m(k,I){de(k,e,I),ie(e,t),ie(t,n),ie(n,c),ie(n,u),Hn(u,o[1]),ie(e,f),S&&S.m(e,null),a=!0,_||(x=Et(u,"input",o[8]),_=!0)},p(k,I){I&2&&u.value!==k[1]&&Hn(u,k[1]),k[1]?S?(S.p(k,I),I&2&&re(S,1)):(S=Iy(k),S.c(),re(S,1),S.m(e,null)):S&&(_i(),ce(S,1,1,()=>{S=null}),yi())},i(k){a||(re(S),a=!0)},o(k){ce(S),a=!1},d(k){k&&he(e),S&&S.d(),_=!1,x()}}}function aE(o){let e,t,n;return t=new K5({}),{c(){e=ue("div"),Re(t.$$.fragment),Te(e,"slot","map")},m(c,u){de(c,e,u),ze(t,e,null),n=!0},p:Dt,i(c){n||(re(t.$$.fragment,c),n=!0)},o(c){ce(t.$$.fragment,c),n=!1},d(c){c&&he(e),De(t)}}}function lE(o){let e,t;return e=new ns({props:{$$slots:{map:[aE],sidebar:[sE],top:[oE]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,[c]){const u={};c&33554558&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function cE(o,e,t){let n,c,u,f,a;dt(o,Es,j=>t(14,n=j)),dt(o,Jn,j=>t(15,c=j)),dt(o,Mu,j=>t(16,u=j)),dt(o,es,j=>t(5,f=j)),dt(o,ri,j=>t(6,a=j));let _="",x="",S=[],k="";kd(async()=>{let j=await fetch(u?"/osm/areas.json":"https://assets.od2net.org/severance_pbfs/areas.json");t(3,S=await j.json())});function I(j){t(4,k="Loading OSM");try{At(Jn,c=new Y0(new TextEncoder().encode(j.detail.xml),j.detail.boundary,void 0),c),At(Es,n=`ltn_${_}`,n),Q0(),ec()}catch(le){window.alert(`Couldn't import from Overpass: ${le}`)}t(4,k="")}async function P(){if(x=="")return;let j=`ltn_${_}`;window.localStorage.setItem(j,JSON.stringify({type:"FeatureCollection",features:[],study_area_name:x})),t(4,k=`Loading pre-clipped OSM area ${x}`),await dd(j),t(4,k="")}function D(){_=this.value,t(1,_)}function R(){x=wp(this),t(2,x),t(3,S)}return[P,_,x,S,k,f,a,I,D,R,()=>P(),j=>t(4,k=j.detail),j=>window.alert(j.detail),()=>At(ri,a={mode:"title",firstLoad:!1},a)]}class uE extends Ht{constructor(e){super(),Wt(this,e,cE,lE,Ut,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}function Py(o,e,t){const n=o.slice();return n[19]=e[t][0],n[20]=e[t][1],n}function zy(o,e,t){const n=o.slice();return n[23]=e[t],n}function hE(o){let e;return{c(){e=ue("div"),e.innerHTML='<nav aria-label="breadcrumb"><ul><li>Choose project</li></ul></nav>',Te(e,"slot","top")},m(t,n){de(t,e,n)},p:Dt,d(t){t&&he(e)}}}function dE(o){let e;return{c(){e=ue("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(t,n){de(t,e,n)},p:Dt,i:Dt,o:Dt,d(t){t&&he(e)}}}function fE(o){let e,t,n,c,u,f,a,_,x,S,k,I,P;t=new Pi({props:{$$slots:{default:[pE]},$$scope:{ctx:o}}}),t.$on("click",o[11]);let D=Kn(o[2].entries()),R=[];for(let B=0;B<D.length;B+=1)R[B]=Ry(Py(o,D,B));const z=B=>ce(R[B],1,1,()=>{R[B]=null});return{c(){e=ue("div"),Re(t.$$.fragment),n=Fe(),c=ue("p"),c.textContent="Load a saved project:",u=Fe(),f=ue("ul");for(let B=0;B<R.length;B+=1)R[B].c();a=Fe(),_=ue("label"),x=Qe(`Load a project from a file
        `),S=ue("input"),Te(S,"type","file")},m(B,N){de(B,e,N),ze(t,e,null),de(B,n,N),de(B,c,N),de(B,u,N),de(B,f,N);for(let V=0;V<R.length;V+=1)R[V]&&R[V].m(f,null);de(B,a,N),de(B,_,N),ie(_,x),ie(_,S),o[15](S),k=!0,I||(P=Et(S,"change",o[6]),I=!0)},p(B,N){const V={};if(N&67108864&&(V.$$scope={dirty:N,ctx:B}),t.$set(V),N&900){D=Kn(B[2].entries());let j;for(j=0;j<D.length;j+=1){const le=Py(B,D,j);R[j]?(R[j].p(le,N),re(R[j],1)):(R[j]=Ry(le),R[j].c(),re(R[j],1),R[j].m(f,null))}for(_i(),j=D.length;j<R.length;j+=1)z(j);yi()}},i(B){if(!k){re(t.$$.fragment,B);for(let N=0;N<D.length;N+=1)re(R[N]);k=!0}},o(B){ce(t.$$.fragment,B),R=R.filter(Boolean);for(let N=0;N<R.length;N+=1)ce(R[N]);k=!1},d(B){B&&(he(e),he(n),he(c),he(u),he(f),he(a),he(_)),De(t),Ss(R,B),o[15](null),I=!1,P()}}}function pE(o){let e;return{c(){e=Qe("New project")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function mE(o){let e=o[23].slice(4)+"",t;return{c(){t=Qe(e)},m(n,c){de(n,t,c)},p(n,c){c&4&&e!==(e=n[23].slice(4)+"")&&Ci(t,e)},d(n){n&&he(t)}}}function Dy(o){let e,t,n,c,u,f,a,_,x,S,k;function I(){return o[12](o[23])}n=new Pi({props:{$$slots:{default:[mE]},$$scope:{ctx:o}}}),n.$on("click",I);function P(){return o[13](o[23])}function D(){return o[14](o[23])}return{c(){e=ue("li"),t=ue("span"),Re(n.$$.fragment),c=Fe(),u=ue("button"),u.innerHTML=`<img src="${q0}" alt="Rename project"/>`,f=Fe(),a=ue("button"),a.innerHTML=`<img src="${V0}" alt="Delete project"/>`,_=Fe(),Te(u,"class","secondary"),Te(a,"class","secondary"),mn(t,"display","flex"),mn(t,"justify-content","space-between")},m(R,z){de(R,e,z),ie(e,t),ze(n,t,null),ie(t,c),ie(t,u),ie(t,f),ie(t,a),ie(e,_),x=!0,S||(k=[Et(u,"click",P),Et(a,"click",D)],S=!0)},p(R,z){o=R;const B={};z&67108868&&(B.$$scope={dirty:z,ctx:o}),n.$set(B)},i(R){x||(re(n.$$.fragment,R),x=!0)},o(R){ce(n.$$.fragment,R),x=!1},d(R){R&&he(e),De(n),S=!1,ln(k)}}}function Ry(o){let e,t=(o[19]??"custom area")+"",n,c,u,f,a=Kn(o[20]),_=[];for(let S=0;S<a.length;S+=1)_[S]=Dy(zy(o,a,S));const x=S=>ce(_[S],1,1,()=>{_[S]=null});return{c(){e=ue("u"),n=Qe(t),c=Fe();for(let S=0;S<_.length;S+=1)_[S].c();u=Bn()},m(S,k){de(S,e,k),ie(e,n),de(S,c,k);for(let I=0;I<_.length;I+=1)_[I]&&_[I].m(S,k);de(S,u,k),f=!0},p(S,k){if((!f||k&4)&&t!==(t=(S[19]??"custom area")+"")&&Ci(n,t),k&900){a=Kn(S[20]);let I;for(I=0;I<a.length;I+=1){const P=zy(S,a,I);_[I]?(_[I].p(P,k),re(_[I],1)):(_[I]=Dy(P),_[I].c(),re(_[I],1),_[I].m(u.parentNode,u))}for(_i(),I=a.length;I<_.length;I+=1)x(I);yi()}},i(S){if(!f){for(let k=0;k<a.length;k+=1)re(_[k]);f=!0}},o(S){_=_.filter(Boolean);for(let k=0;k<_.length;k+=1)ce(_[k]);f=!1},d(S){S&&(he(e),he(c),he(u)),Ss(_,S)}}}function gE(o){let e,t,n,c;const u=[fE,dE],f=[];function a(_,x){return _[4]&&_[0]?0:1}return t=a(o),n=f[t]=u[t](o),{c(){e=ue("div"),n.c(),Te(e,"slot","sidebar")},m(_,x){de(_,e,x),f[t].m(e,null),c=!0},p(_,x){let S=t;t=a(_),t===S?f[t].p(_,x):(_i(),ce(f[S],1,1,()=>{f[S]=null}),yi(),n=f[t],n?n.p(_,x):(n=f[t]=u[t](_),n.c()),re(n,1),n.m(e,null))},i(_){c||(re(n),c=!0)},o(_){ce(n),c=!1},d(_){_&&he(e),f[t].d()}}}function _E(o){let e,t,n,c;return e=new Wy({props:{loading:o[1]}}),n=new ns({props:{$$slots:{sidebar:[gE],top:[hE]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment),t=Fe(),Re(n.$$.fragment)},m(u,f){ze(e,u,f),de(u,t,f),ze(n,u,f),c=!0},p(u,[f]){const a={};f&2&&(a.loading=u[1]),e.$set(a);const _={};f&67108925&&(_.$$scope={dirty:f,ctx:u}),n.$set(_)},i(u){c||(re(e.$$.fragment,u),re(n.$$.fragment,u),c=!0)},o(u){ce(e.$$.fragment,u),ce(n.$$.fragment,u),c=!1},d(u){u&&he(t),De(e,u),De(n,u)}}}function id(){let o=new Map;for(let e=0;e<window.localStorage.length;e++){let t=window.localStorage.key(e);if(t.startsWith("ltn_")){let n="";try{n=JSON.parse(window.localStorage.getItem(t)).study_area_name}catch{}o.has(n)||o.set(n,[]),o.get(n).push(t)}}return o}function yE(o,e,t){let n,c,u,f,a;dt(o,Es,oe=>t(16,n=oe)),dt(o,tc,oe=>t(17,c=oe)),dt(o,Jn,oe=>t(18,u=oe)),dt(o,es,oe=>t(4,f=oe)),dt(o,ri,oe=>t(5,a=oe));let{wasmReady:_}=e,{firstLoad:x}=e,S="";if(At(Jn,u=null,u),At(tc,c=null,c),At(Es,n="",n),x){let $=new URLSearchParams(window.location.search).get("project");$&&dd($)}else{let oe=new URL(window.location.href);oe.searchParams.delete("project"),window.history.replaceState(null,"",oe.toString())}let k=id(),I;async function P(oe){let $="ltn_"+I.files[0].name;t(1,S=`Loading from file ${$}`),window.localStorage.setItem($,await I.files[0].text()),t(2,k=id()),await dd($),t(1,S="")}function D(oe){window.confirm(`Really delete project ${oe}? You can't undo this.`)&&(window.localStorage.removeItem(oe),t(2,k=id()))}function R(oe){let $=window.prompt(`Rename project ${oe} to what?`,oe);if($){$.startsWith("ltn_")||($=`ltn_${$}`);let Y=window.localStorage.getItem(oe);window.localStorage.setItem($,Y),window.localStorage.removeItem(oe),t(2,k=id())}}async function z(oe){t(1,S=`Loading project ${oe}`),await dd(oe),t(1,S="")}const B=()=>At(ri,a={mode:"new-project"},a),N=oe=>z(oe),V=oe=>R(oe),j=oe=>D(oe);function le(oe){Xi[oe?"unshift":"push"](()=>{I=oe,t(3,I)})}return o.$$set=oe=>{"wasmReady"in oe&&t(0,_=oe.wasmReady),"firstLoad"in oe&&t(10,x=oe.firstLoad)},[_,S,k,I,f,a,P,D,R,z,x,B,N,V,j,le]}class vE extends Ht{constructor(e){super(),Wt(this,e,yE,_E,Ut,{wasmReady:0,firstLoad:10})}}const{window:bE}=xd;function wE(o){let e;return{c(){e=Qe("Choose project")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function xE(o){let e;return{c(){e=Qe("Pick neighbourhood")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function kE(o){let e;return{c(){e=Qe("Editing")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function SE(o){let e,t,n,c,u,f,a,_,x,S,k,I,P,D;return u=new Pi({props:{$$slots:{default:[wE]},$$scope:{ctx:o}}}),u.$on("click",o[9]),_=new Pi({props:{$$slots:{default:[xE]},$$scope:{ctx:o}}}),_.$on("click",o[10]),k=new Pi({props:{$$slots:{default:[kE]},$$scope:{ctx:o}}}),k.$on("click",o[5]),{c(){e=ue("div"),t=ue("nav"),n=ue("ul"),c=ue("li"),Re(u.$$.fragment),f=Fe(),a=ue("li"),Re(_.$$.fragment),x=Fe(),S=ue("li"),Re(k.$$.fragment),I=Fe(),P=ue("li"),P.textContent="Viewing shortcuts",Te(t,"aria-label","breadcrumb"),Te(e,"slot","top")},m(R,z){de(R,e,z),ie(e,t),ie(t,n),ie(n,c),ze(u,c,null),ie(n,f),ie(n,a),ze(_,a,null),ie(n,x),ie(n,S),ze(k,S,null),ie(n,I),ie(n,P),D=!0},p(R,z){const B={};z&8192&&(B.$$scope={dirty:z,ctx:R}),u.$set(B);const N={};z&8192&&(N.$$scope={dirty:z,ctx:R}),_.$set(N);const V={};z&8192&&(V.$$scope={dirty:z,ctx:R}),k.$set(V)},i(R){D||(re(u.$$.fragment,R),re(_.$$.fragment,R),re(k.$$.fragment,R),D=!0)},o(R){ce(u.$$.fragment,R),ce(_.$$.fragment,R),ce(k.$$.fragment,R),D=!1},d(R){R&&he(e),De(u),De(_),De(k)}}}function TE(o){let e,t,n,c,u,f,a,_,x,S=o[0].shortcutIndex+1+"",k,I,P=o[0].gj.features.length+"",D,R,z,B,N,V,j,le,oe,$=tn(o[0].gj.features[o[0].shortcutIndex].properties).directness.toFixed(1)+"",Y,ve,Be,te,ne;return{c(){e=ue("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending outside the
        neighbourhood, but cutting through it. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,t=Fe(),n=ue("button"),n.textContent="Pick a different road",c=Fe(),u=ue("div"),f=ue("button"),a=Qe("Previous"),x=Fe(),k=Qe(S),I=Qe(" / "),D=Qe(P),R=Fe(),z=ue("button"),B=Qe("Next"),V=Fe(),j=ue("p"),le=Qe("This shortcut is "),oe=ue("b"),Y=Qe($),ve=Qe("x"),Be=Qe(`
        the length of the shortest route using all roads, not just this neighbourhood`),f.disabled=_=o[0].shortcutIndex==0,Te(f,"data-tooltip","Left"),z.disabled=N=o[0].shortcutIndex==o[0].gj.features.length-1,Te(z,"data-tooltip","Right"),mn(u,"display","flex"),mn(u,"justify-content","space-between")},m(qe,Ce){de(qe,e,Ce),de(qe,t,Ce),de(qe,n,Ce),de(qe,c,Ce),de(qe,u,Ce),ie(u,f),ie(f,a),ie(u,x),ie(u,k),ie(u,I),ie(u,D),ie(u,R),ie(u,z),ie(z,B),de(qe,V,Ce),de(qe,j,Ce),ie(j,le),ie(j,oe),ie(oe,Y),ie(oe,ve),ie(j,Be),te||(ne=[Et(n,"click",o[8]),Et(f,"click",o[6]),Et(z,"click",o[7])],te=!0)},p(qe,Ce){Ce&1&&_!==(_=qe[0].shortcutIndex==0)&&(f.disabled=_),Ce&1&&S!==(S=qe[0].shortcutIndex+1+"")&&Ci(k,S),Ce&1&&P!==(P=qe[0].gj.features.length+"")&&Ci(D,P),Ce&1&&N!==(N=qe[0].shortcutIndex==qe[0].gj.features.length-1)&&(z.disabled=N),Ce&1&&$!==($=tn(qe[0].gj.features[qe[0].shortcutIndex].properties).directness.toFixed(1)+"")&&Ci(Y,$)},d(qe){qe&&(he(e),he(t),he(n),he(c),he(u),he(V),he(j)),te=!1,ln(ne)}}}function EE(o){let e;return{c(){e=ue("p"),e.textContent="Click a road to see shortcuts"},m(t,n){de(t,e,n)},p:Dt,d(t){t&&he(e)}}}function CE(o){let e,t,n,c;t=new qu({}),t.$on("click",o[5]);function u(_,x){if(_[0].state=="neutral")return EE;if(_[0].state=="chose-road")return TE}let f=u(o),a=f&&f(o);return{c(){e=ue("div"),Re(t.$$.fragment),n=Fe(),a&&a.c(),Te(e,"slot","sidebar")},m(_,x){de(_,e,x),ze(t,e,null),ie(e,n),a&&a.m(e,null),c=!0},p(_,x){f===(f=u(_))&&a?a.p(_,x):(a&&a.d(1),a=f&&f(_),a&&(a.c(),a.m(e,null)))},i(_){c||(re(t.$$.fragment,_),c=!0)},o(_){ce(t.$$.fragment,_),c=!1},d(_){_&&he(e),De(t),a&&a.d()}}}function ME(o){let e,t,n,c,u,f,a,_,x,S;return e=new Zu({props:{gj:tn(o[2]).renderNeighbourhood(),interactive:!1}}),n=new cr({props:{data:o[0].gj.features[o[0].shortcutIndex],$$slots:{default:[LE]},$$scope:{ctx:o}}}),u=new cr({props:{data:o[0].roadGj,$$slots:{default:[AE]},$$scope:{ctx:o}}}),a=new Fu({props:{lngLat:o[0].gj.features[o[0].shortcutIndex].geometry.coordinates[0],$$slots:{default:[PE]},$$scope:{ctx:o}}}),x=new Fu({props:{lngLat:o[0].gj.features[o[0].shortcutIndex].geometry.coordinates[o[0].gj.features[o[0].shortcutIndex].geometry.coordinates.length-1],$$slots:{default:[zE]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment),t=Fe(),Re(n.$$.fragment),c=Fe(),Re(u.$$.fragment),f=Fe(),Re(a.$$.fragment),_=Fe(),Re(x.$$.fragment)},m(k,I){ze(e,k,I),de(k,t,I),ze(n,k,I),de(k,c,I),ze(u,k,I),de(k,f,I),ze(a,k,I),de(k,_,I),ze(x,k,I),S=!0},p(k,I){const P={};I&4&&(P.gj=tn(k[2]).renderNeighbourhood()),e.$set(P);const D={};I&1&&(D.data=k[0].gj.features[k[0].shortcutIndex]),I&8192&&(D.$$scope={dirty:I,ctx:k}),n.$set(D);const R={};I&1&&(R.data=k[0].roadGj),I&8192&&(R.$$scope={dirty:I,ctx:k}),u.$set(R);const z={};I&1&&(z.lngLat=k[0].gj.features[k[0].shortcutIndex].geometry.coordinates[0]),I&8192&&(z.$$scope={dirty:I,ctx:k}),a.$set(z);const B={};I&1&&(B.lngLat=k[0].gj.features[k[0].shortcutIndex].geometry.coordinates[k[0].gj.features[k[0].shortcutIndex].geometry.coordinates.length-1]),I&8192&&(B.$$scope={dirty:I,ctx:k}),x.$set(B)},i(k){S||(re(e.$$.fragment,k),re(n.$$.fragment,k),re(u.$$.fragment,k),re(a.$$.fragment,k),re(x.$$.fragment,k),S=!0)},o(k){ce(e.$$.fragment,k),ce(n.$$.fragment,k),ce(u.$$.fragment,k),ce(a.$$.fragment,k),ce(x.$$.fragment,k),S=!1},d(k){k&&(he(t),he(c),he(f),he(_)),De(e,k),De(n,k),De(u,k),De(a,k),De(x,k)}}}function IE(o){let e,t;return e=new Zu({props:{gj:tn(o[2]).renderNeighbourhood(),onClickLine:o[3],$$slots:{"line-popup":[RE]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c&4&&(u.gj=tn(n[2]).renderNeighbourhood()),c&8192&&(u.$$scope={dirty:c,ctx:n}),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function LE(o){let e,t;const n=[pn("shortcuts"),{paint:{"line-width":10,"line-color":"cyan"}}];let c={};for(let u=0;u<n.length;u+=1)c=an(c,n[u]);return e=new fo({props:c}),{c(){Re(e.$$.fragment)},m(u,f){ze(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(re(e.$$.fragment,u),t=!0)},o(u){ce(e.$$.fragment,u),t=!1},d(u){De(e,u)}}}function AE(o){let e,t;const n=[pn("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let c={};for(let u=0;u<n.length;u+=1)c=an(c,n[u]);return e=new fo({props:c}),{c(){Re(e.$$.fragment)},m(u,f){ze(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(re(e.$$.fragment,u),t=!0)},o(u){ce(e.$$.fragment,u),t=!1},d(u){De(e,u)}}}function PE(o){let e;return{c(){e=Qe("A")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function zE(o){let e;return{c(){e=Qe("B")},m(t,n){de(t,e,n)},d(t){t&&he(e)}}}function DE(o){let e,t=o[12].shortcuts+"",n,c,u=(o[12].name??"unnamed road")+"",f;return{c(){e=ue("p"),n=Qe(t),c=Qe(" shortcuts through "),f=Qe(u)},m(a,_){de(a,e,_),ie(e,n),ie(e,c),ie(e,f)},p(a,_){_&4096&&t!==(t=a[12].shortcuts+"")&&Ci(n,t),_&4096&&u!==(u=(a[12].name??"unnamed road")+"")&&Ci(f,u)},d(a){a&&he(e)}}}function RE(o){let e,t,n;return t=new is({props:{openOn:"hover",$$slots:{default:[DE,({props:c})=>({12:c}),({props:c})=>c?4096:0]},$$scope:{ctx:o}}}),{c(){e=ue("div"),Re(t.$$.fragment),Te(e,"slot","line-popup")},m(c,u){de(c,e,u),ze(t,e,null),n=!0},p(c,u){const f={};u&12288&&(f.$$scope={dirty:u,ctx:c}),t.$set(f)},i(c){n||(re(t.$$.fragment,c),n=!0)},o(c){ce(t.$$.fragment,c),n=!1},d(c){c&&he(e),De(t)}}}function BE(o){let e,t,n,c,u,f;const a=[IE,ME],_=[];function x(S,k){return S[0].state=="neutral"?0:S[0].state=="chose-road"?1:-1}return~(t=x(o))&&(n=_[t]=a[t](o)),u=new Gu({}),{c(){e=ue("div"),n&&n.c(),c=Fe(),Re(u.$$.fragment),Te(e,"slot","map")},m(S,k){de(S,e,k),~t&&_[t].m(e,null),ie(e,c),ze(u,e,null),f=!0},p(S,k){let I=t;t=x(S),t===I?~t&&_[t].p(S,k):(n&&(_i(),ce(_[I],1,1,()=>{_[I]=null}),yi()),~t?(n=_[t],n?n.p(S,k):(n=_[t]=a[t](S),n.c()),re(n,1),n.m(e,c)):n=null)},i(S){f||(re(n),re(u.$$.fragment,S),f=!0)},o(S){ce(n),ce(u.$$.fragment,S),f=!1},d(S){S&&he(e),~t&&_[t].d(),De(u)}}}function FE(o){let e,t,n,c;return e=new ns({props:{$$slots:{map:[BE],sidebar:[CE],top:[SE]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment)},m(u,f){ze(e,u,f),t=!0,n||(c=Et(bE,"keydown",o[4]),n=!0)},p(u,[f]){const a={};f&8199&&(a.$$scope={dirty:f,ctx:u}),e.$set(a)},i(u){t||(re(e.$$.fragment,u),t=!0)},o(u){ce(e.$$.fragment,u),t=!1},d(u){De(e,u),n=!1,c()}}}function OE(o,e,t){let n,c,u;dt(o,ri,R=>t(1,n=R)),dt(o,es,R=>t(11,c=R)),dt(o,Jn,R=>t(2,u=R));let f={state:"neutral"};function a(R,z){let B=u.getShortcutsCrossingRoad(R.properties.id);if(B.features.length==0){window.alert("No shortcuts here");return}t(0,f={state:"chose-road",roadGj:R,gj:B,shortcutIndex:0})}kd(()=>{c==null||c.keyboard.disable()}),er(()=>{c==null||c.keyboard.enable()});function _(R){f.state=="chose-road"&&(R.key=="ArrowLeft"&&f.shortcutIndex>0&&(R.stopPropagation(),t(0,f.shortcutIndex--,f)),R.key=="ArrowRight"&&(R.stopPropagation(),f.shortcutIndex!=f.gj.features.length-1&&t(0,f.shortcutIndex++,f)))}function x(){At(ri,n={mode:"neighbourhood"},n)}function S(){f.state=="chose-road"&&t(0,f.shortcutIndex--,f)}function k(){f.state=="chose-road"&&t(0,f.shortcutIndex++,f)}return[f,n,u,a,_,x,S,k,()=>t(0,f={state:"neutral"}),()=>At(ri,n={mode:"title",firstLoad:!1},n),()=>At(ri,n={mode:"network"},n)]}class NE extends Ht{constructor(e){super(),Wt(this,e,OE,FE,Ut,{})}}function jE(o){let e,t,n,c,u,f,a,_,x;return c=new h5({}),{c(){e=ue("div"),t=ue("button"),t.innerHTML=`<img src="${rb}" style="height: 6vh;" alt="A/B Street logo"/>`,n=Fe(),Re(c.$$.fragment),u=Fe(),f=ue("span"),Te(t,"class","outline"),mn(f,"width","100%"),Te(e,"slot","top"),mn(e,"display","flex")},m(S,k){de(S,e,k),ie(e,t),ie(e,n),ze(c,e,null),ie(e,u),ie(e,f),o[19](f),a=!0,_||(x=Et(t,"click",o[18]),_=!0)},p:Dt,i(S){a||(re(c.$$.fragment,S),a=!0)},o(S){ce(c.$$.fragment,S),a=!1},d(S){S&&he(e),De(c),o[19](null),_=!1,x()}}}function By(o){let e,t,n,c,u,f;return n=new i4({props:{map:tn(o[6]),maptilerBasemap:o[7]}}),{c(){e=ue("button"),e.textContent="Zoom to fit study area",t=Fe(),Re(n.$$.fragment),Te(e,"class","secondary")},m(a,_){de(a,e,_),de(a,t,_),ze(n,a,_),c=!0,u||(f=Et(e,"click",o[10]),u=!0)},p(a,_){const x={};_&64&&(x.map=tn(a[6])),_&128&&(x.maptilerBasemap=a[7]),n.$set(x)},i(a){c||(re(n.$$.fragment,a),c=!0)},o(a){ce(n.$$.fragment,a),c=!1},d(a){a&&(he(e),he(t)),De(n,a),u=!1,f()}}}function UE(o){let e,t,n,c,u,f,a=o[5]&&By(o);return{c(){e=ue("div"),t=ue("div"),n=Fe(),c=ue("hr"),u=Fe(),a&&a.c(),Te(e,"slot","left")},m(_,x){de(_,e,x),ie(e,t),o[17](t),ie(e,n),ie(e,c),ie(e,u),a&&a.m(e,null),f=!0},p(_,x){_[5]?a?(a.p(_,x),x&32&&re(a,1)):(a=By(_),a.c(),re(a,1),a.m(e,null)):a&&(_i(),ce(a,1,1,()=>{a=null}),yi())},i(_){f||(re(a),f=!0)},o(_){ce(a),f=!1},d(_){_&&he(e),o[17](null),a&&a.d()}}}function VE(o){let e,t;return e=new uE({}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p:Dt,i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function qE(o){let e,t;return e=new vE({props:{wasmReady:o[4],firstLoad:o[8].firstLoad}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c&16&&(u.wasmReady=n[4]),c&256&&(u.firstLoad=n[8].firstLoad),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function Fy(o){let e,t,n,c,u,f;e=new cr({props:{data:o[5].getInvertedBoundary(),$$slots:{default:[ZE]},$$scope:{ctx:o}}});const a=[YE,JE,KE,XE,$E,HE,WE,GE],_=[];function x(S,k){return S[8].mode=="network"?0:S[8].mode=="set-boundary"?1:S[8].mode=="auto-boundaries"?2:S[8].mode=="neighbourhood"?3:S[8].mode=="view-shortcuts"?4:S[8].mode=="impact-one-destination"?5:S[8].mode=="route"?6:S[8].mode=="debug"?7:-1}return~(n=x(o))&&(c=_[n]=a[n](o)),{c(){Re(e.$$.fragment),t=Fe(),c&&c.c(),u=Bn()},m(S,k){ze(e,S,k),de(S,t,k),~n&&_[n].m(S,k),de(S,u,k),f=!0},p(S,k){const I={};k&32&&(I.data=S[5].getInvertedBoundary()),k&2097152&&(I.$$scope={dirty:k,ctx:S}),e.$set(I);let P=n;n=x(S),n===P?~n&&_[n].p(S,k):(c&&(_i(),ce(_[P],1,1,()=>{_[P]=null}),yi()),~n?(c=_[n],c?c.p(S,k):(c=_[n]=a[n](S),c.c()),re(c,1),c.m(u.parentNode,u)):c=null)},i(S){f||(re(e.$$.fragment,S),re(c),f=!0)},o(S){ce(e.$$.fragment,S),ce(c),f=!1},d(S){S&&(he(t),he(u)),De(e,S),~n&&_[n].d(S)}}}function ZE(o){let e,t;const n=[pn("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let c={};for(let u=0;u<n.length;u+=1)c=an(c,n[u]);return e=new Cs({props:c}),{c(){Re(e.$$.fragment)},m(u,f){ze(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(re(e.$$.fragment,u),t=!0)},o(u){ce(e.$$.fragment,u),t=!1},d(u){De(e,u)}}}function GE(o){let e,t;return e=new W4({}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p:Dt,i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function WE(o){let e,t;return e=new PT({props:{prevMode:o[8].prevMode}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c&256&&(u.prevMode=n[8].prevMode),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function HE(o){let e,t;return e=new oT({}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p:Dt,i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function $E(o){let e,t;return e=new NE({}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p:Dt,i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function XE(o){let e,t;return e=new Z3({}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p:Dt,i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function KE(o){let e,t;return e=new y4({}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p:Dt,i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function JE(o){let e,t;return e=new s5({props:{name:o[8].name,existing:o[8].existing}}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p(n,c){const u={};c&256&&(u.name=n[8].name),c&256&&(u.existing=n[8].existing),e.$set(u)},i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function YE(o){let e,t;return e=new bT({}),{c(){Re(e.$$.fragment)},m(n,c){ze(e,n,c),t=!0},p:Dt,i(n){t||(re(e.$$.fragment,n),t=!0)},o(n){ce(e.$$.fragment,n),t=!1},d(n){De(e,n)}}}function QE(o){let e,t,n,c,u,f,a,_,x,S,k,I,P,D;e=new g0({}),n=new _0({}),u=new oS({props:{map:o[0],apiKey:Qf}});const R=[qE,VE],z=[];function B(V,j){return V[8].mode=="title"?0:V[8].mode=="new-project"?1:-1}~(x=B(o))&&(S=z[x]=R[x](o));let N=o[5]&&Fy(o);return P=new FS({}),{c(){Re(e.$$.fragment),t=Fe(),Re(n.$$.fragment),c=Fe(),Re(u.$$.fragment),f=Fe(),a=ue("div"),_=Fe(),S&&S.c(),k=Fe(),N&&N.c(),I=Fe(),Re(P.$$.fragment)},m(V,j){ze(e,V,j),de(V,t,j),ze(n,V,j),de(V,c,j),ze(u,V,j),de(V,f,j),de(V,a,j),o[14](a),de(V,_,j),~x&&z[x].m(V,j),de(V,k,j),N&&N.m(V,j),de(V,I,j),ze(P,V,j),D=!0},p(V,j){const le={};j&1&&(le.map=V[0]),u.$set(le);let oe=x;x=B(V),x===oe?~x&&z[x].p(V,j):(S&&(_i(),ce(z[oe],1,1,()=>{z[oe]=null}),yi()),~x?(S=z[x],S?S.p(V,j):(S=z[x]=R[x](V),S.c()),re(S,1),S.m(k.parentNode,k)):S=null),V[5]?N?(N.p(V,j),j&32&&re(N,1)):(N=Fy(V),N.c(),re(N,1),N.m(I.parentNode,I)):N&&(_i(),ce(N,1,1,()=>{N=null}),yi())},i(V){D||(re(e.$$.fragment,V),re(n.$$.fragment,V),re(u.$$.fragment,V),re(S),re(N),re(P.$$.fragment,V),D=!0)},o(V){ce(e.$$.fragment,V),ce(n.$$.fragment,V),ce(u.$$.fragment,V),ce(S),ce(N),ce(P.$$.fragment,V),D=!1},d(V){V&&(he(t),he(c),he(f),he(a),he(_),he(k),he(I)),De(e,V),De(n,V),De(u,V),o[14](null),~x&&z[x].d(V),N&&N.d(V),De(P,V)}}}function eC(o){let e,t,n,c;function u(a){o[15](a)}let f={style:`https://api.maptiler.com/maps/${o[7]}/style.json?key=${Qf}`,hash:!0,images:[{id:"walk_cycle_only",url:"/ltn//filters/walk_cycle_only_icon.gif"},{id:"no_entry",url:"/ltn//filters/no_entry_icon.gif"},{id:"bus_gate",url:"/ltn//filters/bus_gate_icon.gif"},{id:"school_street",url:"/ltn//filters/school_street_icon.gif"},{id:"oneway-arrow",url:nb}],$$slots:{default:[QE]},$$scope:{ctx:o}};return o[0]!==void 0&&(f.map=o[0]),t=new lx({props:f}),Xi.push(()=>Wr(t,"map",u)),t.$on("error",o[16]),{c(){e=ue("div"),Re(t.$$.fragment),Te(e,"slot","main"),mn(e,"position","relative"),mn(e,"width","100%"),mn(e,"height","100%")},m(a,_){de(a,e,_),ze(t,e,null),c=!0},p(a,_){const x={};_&128&&(x.style=`https://api.maptiler.com/maps/${a[7]}/style.json?key=${Qf}`),_&2097465&&(x.$$scope={dirty:_,ctx:a}),!n&&_&1&&(n=!0,x.map=a[0],Gr(()=>n=!1)),t.$set(x)},i(a){c||(re(t.$$.fragment,a),c=!0)},o(a){ce(t.$$.fragment,a),c=!1},d(a){a&&he(e),De(t)}}}function tC(o){let e,t,n,c;return e=new hw({}),n=new TS({props:{$$slots:{main:[eC],left:[UE],top:[jE]},$$scope:{ctx:o}}}),{c(){Re(e.$$.fragment),t=Fe(),Re(n.$$.fragment)},m(u,f){ze(e,u,f),de(u,t,f),ze(n,u,f),c=!0},p(u,[f]){const a={};f&2098175&&(a.$$scope={dirty:f,ctx:u}),n.$set(a)},i(u){c||(re(e.$$.fragment,u),re(n.$$.fragment,u),c=!0)},o(u){ce(e.$$.fragment,u),ce(n.$$.fragment,u),c=!1},d(u){u&&he(t),De(e,u),De(n,u)}}}function iC(o,e,t){let n,c,u,f,a,_,x,S,k;dt(o,mp,Y=>t(11,n=Y)),dt(o,pp,Y=>t(12,c=Y)),dt(o,fp,Y=>t(13,u=Y)),dt(o,Jn,Y=>t(5,f=Y)),dt(o,es,Y=>t(6,a=Y)),dt(o,Mu,Y=>t(20,_=Y)),dt(o,ep,Y=>t(7,x=Y)),dt(o,ri,Y=>t(8,S=Y)),dt(o,yd,Y=>t(9,k=Y));let I=!1;kd(async()=>{await p0(),await Yy(),t(4,I=!0);try{(await fetch("/osm/areas.json")).ok&&(At(Mu,_=!0,_),console.log("Using local cache, not od2net.org"))}catch{}});let P=null;function D(){a.fitBounds(f.getBounds(),{animate:!1})}let R,z,B;function N(Y){Xi[Y?"unshift":"push"](()=>{B=Y,t(3,B),t(11,n)})}function V(Y){P=Y,t(0,P)}const j=Y=>{console.log(Y.detail.error)};function le(Y){Xi[Y?"unshift":"push"](()=>{z=Y,t(2,z),t(12,c)})}const oe=()=>At(yd,k=!0,k);function $(Y){Xi[Y?"unshift":"push"](()=>{R=Y,t(1,R),t(13,u)})}return o.$$.update=()=>{o.$$.dirty&1&&P&&es.set(P),o.$$.dirty&8194&&R&&u&&(t(1,R.innerHTML="",R),R.appendChild(u)),o.$$.dirty&4100&&z&&c&&(t(2,z.innerHTML="",z),z.appendChild(c)),o.$$.dirty&2056&&B&&n&&(t(3,B.innerHTML="",B),B.appendChild(n))},[P,R,z,B,I,f,a,x,S,k,D,n,c,u,N,V,j,le,oe,$]}class nC extends Ht{constructor(e){super(),Wt(this,e,iC,tC,Ut,{})}}new nC({target:document.getElementById("app")});
