var j_=Object.defineProperty;var q_=(f,a,h)=>a in f?j_(f,a,{enumerable:!0,configurable:!0,writable:!0,value:h}):f[a]=h;var Yr=(f,a,h)=>(q_(f,typeof a!="symbol"?a+"":a,h),h);(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))d(y);new MutationObserver(y=>{for(const S of y)if(S.type==="childList")for(const k of S.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&d(k)}).observe(document,{childList:!0,subtree:!0});function h(y){const S={};return y.integrity&&(S.integrity=y.integrity),y.referrerPolicy&&(S.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?S.credentials="include":y.crossOrigin==="anonymous"?S.credentials="omit":S.credentials="same-origin",S}function d(y){if(y.ep)return;y.ep=!0;const S=h(y);fetch(y.href,S)}})();function vi(){}function Z_(f,a){for(const h in a)f[h]=a[h];return f}function vf(f){return f()}function Pp(){return Object.create(null)}function os(f){f.forEach(vf)}function Du(f){return typeof f=="function"}function Vi(f,a){return f!=f?a==a:f!==a||f&&typeof f=="object"||typeof f=="function"}let Su;function zh(f,a){return f===a?!0:(Su||(Su=document.createElement("a")),Su.href=a,f===Su.href)}function G_(f){return Object.keys(f).length===0}function bf(f,...a){if(f==null){for(const d of a)d(void 0);return vi}const h=f.subscribe(...a);return h.unsubscribe?()=>h.unsubscribe():h}function W_(f){let a;return bf(f,h=>a=h)(),a}function ni(f,a,h){f.$$.on_destroy.push(bf(a,h))}function fo(f,a,h,d){if(f){const y=xf(f,a,h,d);return f[0](y)}}function xf(f,a,h,d){return f[1]&&d?Z_(h.ctx.slice(),f[1](d(a))):h.ctx}function mo(f,a,h,d){if(f[2]&&d){const y=f[2](d(h));if(a.dirty===void 0)return y;if(typeof y=="object"){const S=[],k=Math.max(a.dirty.length,y.length);for(let s=0;s<k;s+=1)S[s]=a.dirty[s]|y[s];return S}return a.dirty|y}return a.dirty}function _o(f,a,h,d,y,S){if(y){const k=xf(a,h,d,S);f.p(k,y)}}function go(f){if(f.ctx.length>32){const a=[],h=f.ctx.length/32;for(let d=0;d<h;d++)a[d]=-1;return a}return-1}function H_(f){const a={};for(const h in f)a[h]=!0;return a}function Lp(f){return f??""}function fn(f,a,h){return f.set(h),a}function Dh(f){return f&&Du(f.destroy)?f.destroy:vi}const wf=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Ee(f,a){f.appendChild(a)}function Ye(f,a,h){f.insertBefore(a,h||null)}function Xe(f){f.parentNode&&f.parentNode.removeChild(f)}function Sf(f,a){for(let h=0;h<f.length;h+=1)f[h]&&f[h].d(a)}function Ae(f){return document.createElement(f)}function Gi(f){return document.createTextNode(f)}function Tt(){return Gi(" ")}function ss(){return Gi("")}function fi(f,a,h,d){return f.addEventListener(a,h,d),()=>f.removeEventListener(a,h,d)}function yi(f,a,h){h==null?f.removeAttribute(a):f.getAttribute(a)!==h&&f.setAttribute(a,h)}function X_(f){return Array.from(f.childNodes)}function Rs(f,a){a=""+a,f.data!==a&&(f.data=a)}function ns(f,a){f.value=a??""}function Ul(f,a,h,d){h==null?f.style.removeProperty(a):f.style.setProperty(a,h,d?"important":"")}function zp(f,a,h){for(let d=0;d<f.options.length;d+=1){const y=f.options[d];if(y.__value===a){y.selected=!0;return}}(!h||a!==void 0)&&(f.selectedIndex=-1)}function K_(f){const a=f.querySelector(":checked");return a&&a.__value}function Dp(f,a,h){f.classList.toggle(a,!!h)}function J_(f,a,{bubbles:h=!1,cancelable:d=!1}={}){return new CustomEvent(f,{detail:a,bubbles:h,cancelable:d})}let qc;function Bc(f){qc=f}function Zc(){if(!qc)throw new Error("Function called outside component initialization");return qc}function Gc(f){Zc().$$.on_mount.push(f)}function xs(f){Zc().$$.on_destroy.push(f)}function Wc(){const f=Zc();return(a,h,{cancelable:d=!1}={})=>{const y=f.$$.callbacks[a];if(y){const S=J_(a,h,{cancelable:d});return y.slice().forEach(k=>{k.call(f,S)}),!S.defaultPrevented}return!0}}function Tf(f,a){return Zc().$$.context.set(f,a),a}function Y_(f){return Zc().$$.context.get(f)}function sr(f,a){const h=f.$$.callbacks[a.type];h&&h.slice().forEach(d=>d.call(this,a))}const Nl=[],Or=[];let jl=[];const Fh=[],If=Promise.resolve();let Rh=!1;function Cf(){Rh||(Rh=!0,If.then(Ef))}function Q_(){return Cf(),If}function Au(f){jl.push(f)}function pl(f){Fh.push(f)}const kh=new Set;let Ol=0;function Ef(){if(Ol!==0)return;const f=qc;do{try{for(;Ol<Nl.length;){const a=Nl[Ol];Ol++,Bc(a),$_(a.$$)}}catch(a){throw Nl.length=0,Ol=0,a}for(Bc(null),Nl.length=0,Ol=0;Or.length;)Or.pop()();for(let a=0;a<jl.length;a+=1){const h=jl[a];kh.has(h)||(kh.add(h),h())}jl.length=0}while(Nl.length);for(;Fh.length;)Fh.pop()();Rh=!1,kh.clear(),Bc(f)}function $_(f){if(f.fragment!==null){f.update(),os(f.before_update);const a=f.dirty;f.dirty=[-1],f.fragment&&f.fragment.p(f.ctx,a),f.after_update.forEach(Au)}}function eg(f){const a=[],h=[];jl.forEach(d=>f.indexOf(d)===-1?a.push(d):h.push(d)),h.forEach(d=>d()),jl=a}const Cu=new Set;let dl;function lr(){dl={r:0,c:[],p:dl}}function cr(){dl.r||os(dl.c),dl=dl.p}function ze(f,a){f&&f.i&&(Cu.delete(f),f.i(a))}function Ve(f,a,h,d){if(f&&f.o){if(Cu.has(f))return;Cu.add(f),dl.c.push(()=>{Cu.delete(f),d&&(h&&f.d(1),d())}),f.o(a)}else d&&d()}function Pu(f){return(f==null?void 0:f.length)!==void 0?f:Array.from(f)}function fl(f,a,h){const d=f.$$.props[a];d!==void 0&&(f.$$.bound[d]=h,h(f.$$.ctx[d]))}function Vt(f){f&&f.c()}function Ot(f,a,h){const{fragment:d,after_update:y}=f.$$;d&&d.m(a,h),Au(()=>{const S=f.$$.on_mount.map(vf).filter(Du);f.$$.on_destroy?f.$$.on_destroy.push(...S):os(S),f.$$.on_mount=[]}),y.forEach(Au)}function Bt(f,a){const h=f.$$;h.fragment!==null&&(eg(h.after_update),os(h.on_destroy),h.fragment&&h.fragment.d(a),h.on_destroy=h.fragment=null,h.ctx=[])}function tg(f,a){f.$$.dirty[0]===-1&&(Nl.push(f),Cf(),f.$$.dirty.fill(0)),f.$$.dirty[a/31|0]|=1<<a%31}function Wi(f,a,h,d,y,S,k=null,s=[-1]){const F=qc;Bc(f);const M=f.$$={fragment:null,ctx:[],props:S,update:vi,not_equal:y,bound:Pp(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(a.context||(F?F.$$.context:[])),callbacks:Pp(),dirty:s,skip_bound:!1,root:a.target||F.$$.root};k&&k(M.root);let q=!1;if(M.ctx=h?h(f,a.props||{},(ie,he,...xe)=>{const ye=xe.length?xe[0]:he;return M.ctx&&y(M.ctx[ie],M.ctx[ie]=ye)&&(!M.skip_bound&&M.bound[ie]&&M.bound[ie](ye),q&&tg(f,ie)),he}):[],M.update(),q=!0,os(M.before_update),M.fragment=d?d(M.ctx):!1,a.target){if(a.hydrate){const ie=X_(a.target);M.fragment&&M.fragment.l(ie),ie.forEach(Xe)}else M.fragment&&M.fragment.c();a.intro&&ze(f.$$.fragment),Ot(f,a.target,a.anchor),Ef()}Bc(F)}class Hi{constructor(){Yr(this,"$$");Yr(this,"$$set")}$destroy(){Bt(this,1),this.$destroy=vi}$on(a,h){if(!Du(h))return vi;const d=this.$$.callbacks[a]||(this.$$.callbacks[a]=[]);return d.push(h),()=>{const y=d.indexOf(h);y!==-1&&d.splice(y,1)}}$set(a){this.$$set&&!G_(a)&&(this.$$.skip_bound=!0,this.$$set(a),this.$$.skip_bound=!1)}}const ig="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ig);let pt;const ca=new Array(128).fill(void 0);ca.push(void 0,null,!0,!1);function ci(f){return ca[f]}let Nc=ca.length;function ng(f){f<132||(ca[f]=Nc,Nc=f)}function po(f){const a=ci(f);return ng(f),a}let da=0,Ac=null;function ql(){return(Ac===null||Ac.byteLength===0)&&(Ac=new Uint8Array(pt.memory.buffer)),Ac}const Eu=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},rg=typeof Eu.encodeInto=="function"?function(f,a){return Eu.encodeInto(f,a)}:function(f,a){const h=Eu.encode(f);return a.set(h),{read:f.length,written:h.length}};function Vc(f,a,h){if(h===void 0){const s=Eu.encode(f),F=a(s.length,1)>>>0;return ql().subarray(F,F+s.length).set(s),da=s.length,F}let d=f.length,y=a(d,1)>>>0;const S=ql();let k=0;for(;k<d;k++){const s=f.charCodeAt(k);if(s>127)break;S[y+k]=s}if(k!==d){k!==0&&(f=f.slice(k)),y=h(y,d,d=k+f.length*3,1)>>>0;const s=ql().subarray(y+k,y+d),F=rg(f,s);k+=F.written}return da=k,y}function kc(f){return f==null}let Pc=null;function Rt(){return(Pc===null||Pc.byteLength===0)&&(Pc=new Int32Array(pt.memory.buffer)),Pc}const kf=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&kf.decode();function Qr(f,a){return f=f>>>0,kf.decode(ql().subarray(f,f+a))}function Vn(f){Nc===ca.length&&ca.push(ca.length+1);const a=Nc;return Nc=ca[a],ca[a]=f,a}let Lc=null;function Mf(){return(Lc===null||Lc.byteLength===0)&&(Lc=new Float64Array(pt.memory.buffer)),Lc}let zc=null;function og(){return(zc===null||zc.byteLength===0)&&(zc=new BigInt64Array(pt.memory.buffer)),zc}function Oh(f){const a=typeof f;if(a=="number"||a=="boolean"||f==null)return`${f}`;if(a=="string")return`"${f}"`;if(a=="symbol"){const y=f.description;return y==null?"Symbol":`Symbol(${y})`}if(a=="function"){const y=f.name;return typeof y=="string"&&y.length>0?`Function(${y})`:"Function"}if(Array.isArray(f)){const y=f.length;let S="[";y>0&&(S+=Oh(f[0]));for(let k=1;k<y;k++)S+=", "+Oh(f[k]);return S+="]",S}const h=/\[object ([^\]]+)\]/.exec(toString.call(f));let d;if(h.length>1)d=h[1];else return toString.call(f);if(d=="Object")try{return"Object("+JSON.stringify(f)+")"}catch{return"Object"}return f instanceof Error?`${f.name}: ${f.message}
${f.stack}`:d}function sg(f,a){const h=a(f.length*1,1)>>>0;return ql().set(f,h/1),da=f.length,h}function ag(f,a){return f=f>>>0,Mf().subarray(f/8,f/8+a)}function lg(f,a){return f=f>>>0,ql().subarray(f/1,f/1+a)}function Mh(f,a){try{return f.apply(this,a)}catch(h){pt.__wbindgen_exn_store(Vn(h))}}class cg{__destroy_into_raw(){const a=this.__wbg_ptr;return this.__wbg_ptr=0,a}free(){const a=this.__destroy_into_raw();pt.__wbg_ltn_free(a)}constructor(a){try{const S=pt.__wbindgen_add_to_stack_pointer(-16),k=sg(a,pt.__wbindgen_malloc),s=da;pt.ltn_new(S,k,s);var h=Rt()[S/4+0],d=Rt()[S/4+1],y=Rt()[S/4+2];if(y)throw po(d);return this.__wbg_ptr=h>>>0,this}finally{pt.__wbindgen_add_to_stack_pointer(16)}}render(){let a,h;try{const M=pt.__wbindgen_add_to_stack_pointer(-16);pt.ltn_render(M,this.__wbg_ptr);var d=Rt()[M/4+0],y=Rt()[M/4+1],S=Rt()[M/4+2],k=Rt()[M/4+3],s=d,F=y;if(k)throw s=0,F=0,po(S);return a=s,h=F,Qr(s,F)}finally{pt.__wbindgen_add_to_stack_pointer(16),pt.__wbindgen_free(a,h,1)}}getInvertedBoundary(){let a,h;try{const M=pt.__wbindgen_add_to_stack_pointer(-16);pt.ltn_getInvertedBoundary(M,this.__wbg_ptr);var d=Rt()[M/4+0],y=Rt()[M/4+1],S=Rt()[M/4+2],k=Rt()[M/4+3],s=d,F=y;if(k)throw s=0,F=0,po(S);return a=s,h=F,Qr(s,F)}finally{pt.__wbindgen_add_to_stack_pointer(16),pt.__wbindgen_free(a,h,1)}}getBounds(){try{const y=pt.__wbindgen_add_to_stack_pointer(-16);pt.ltn_getBounds(y,this.__wbg_ptr);var a=Rt()[y/4+0],h=Rt()[y/4+1],d=ag(a,h).slice();return pt.__wbindgen_free(a,h*8,8),d}finally{pt.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const y=pt.__wbindgen_add_to_stack_pointer(-16);pt.ltn_toRouteSnapper(y,this.__wbg_ptr);var a=Rt()[y/4+0],h=Rt()[y/4+1],d=lg(a,h).slice();return pt.__wbindgen_free(a,h*1,1),d}finally{pt.__wbindgen_add_to_stack_pointer(16)}}setNeighbourhood(a){let h,d;try{const q=pt.__wbindgen_add_to_stack_pointer(-16);pt.ltn_setNeighbourhood(q,this.__wbg_ptr,Vn(a));var y=Rt()[q/4+0],S=Rt()[q/4+1],k=Rt()[q/4+2],s=Rt()[q/4+3],F=y,M=S;if(s)throw F=0,M=0,po(k);return h=F,d=M,Qr(F,M)}finally{pt.__wbindgen_add_to_stack_pointer(16),pt.__wbindgen_free(h,d,1)}}renderNeighbourhood(){let a,h;try{const M=pt.__wbindgen_add_to_stack_pointer(-16);pt.ltn_renderNeighbourhood(M,this.__wbg_ptr);var d=Rt()[M/4+0],y=Rt()[M/4+1],S=Rt()[M/4+2],k=Rt()[M/4+3],s=d,F=y;if(k)throw s=0,F=0,po(S);return a=s,h=F,Qr(s,F)}finally{pt.__wbindgen_add_to_stack_pointer(16),pt.__wbindgen_free(a,h,1)}}unsetNeighbourhood(){pt.ltn_unsetNeighbourhood(this.__wbg_ptr)}addModalFilter(a,h){let d,y;try{const ie=pt.__wbindgen_add_to_stack_pointer(-16),he=Vc(h,pt.__wbindgen_malloc,pt.__wbindgen_realloc),xe=da;pt.ltn_addModalFilter(ie,this.__wbg_ptr,Vn(a),he,xe);var S=Rt()[ie/4+0],k=Rt()[ie/4+1],s=Rt()[ie/4+2],F=Rt()[ie/4+3],M=S,q=k;if(F)throw M=0,q=0,po(s);return d=M,y=q,Qr(M,q)}finally{pt.__wbindgen_add_to_stack_pointer(16),pt.__wbindgen_free(d,y,1)}}addManyModalFilters(a,h){let d,y;try{const ie=pt.__wbindgen_add_to_stack_pointer(-16),he=Vc(h,pt.__wbindgen_malloc,pt.__wbindgen_realloc),xe=da;pt.ltn_addManyModalFilters(ie,this.__wbg_ptr,Vn(a),he,xe);var S=Rt()[ie/4+0],k=Rt()[ie/4+1],s=Rt()[ie/4+2],F=Rt()[ie/4+3],M=S,q=k;if(F)throw M=0,q=0,po(s);return d=M,y=q,Qr(M,q)}finally{pt.__wbindgen_add_to_stack_pointer(16),pt.__wbindgen_free(d,y,1)}}deleteModalFilter(a){let h,d;try{const q=pt.__wbindgen_add_to_stack_pointer(-16);pt.ltn_deleteModalFilter(q,this.__wbg_ptr,a);var y=Rt()[q/4+0],S=Rt()[q/4+1],k=Rt()[q/4+2],s=Rt()[q/4+3],F=y,M=S;if(s)throw F=0,M=0,po(k);return h=F,d=M,Qr(F,M)}finally{pt.__wbindgen_add_to_stack_pointer(16),pt.__wbindgen_free(h,d,1)}}undo(){let a,h;try{const M=pt.__wbindgen_add_to_stack_pointer(-16);pt.ltn_undo(M,this.__wbg_ptr);var d=Rt()[M/4+0],y=Rt()[M/4+1],S=Rt()[M/4+2],k=Rt()[M/4+3],s=d,F=y;if(k)throw s=0,F=0,po(S);return a=s,h=F,Qr(s,F)}finally{pt.__wbindgen_add_to_stack_pointer(16),pt.__wbindgen_free(a,h,1)}}redo(){let a,h;try{const M=pt.__wbindgen_add_to_stack_pointer(-16);pt.ltn_redo(M,this.__wbg_ptr);var d=Rt()[M/4+0],y=Rt()[M/4+1],S=Rt()[M/4+2],k=Rt()[M/4+3],s=d,F=y;if(k)throw s=0,F=0,po(S);return a=s,h=F,Qr(s,F)}finally{pt.__wbindgen_add_to_stack_pointer(16),pt.__wbindgen_free(a,h,1)}}getShortcutsCrossingRoad(a){let h,d;try{const q=pt.__wbindgen_add_to_stack_pointer(-16);pt.ltn_getShortcutsCrossingRoad(q,this.__wbg_ptr,a);var y=Rt()[q/4+0],S=Rt()[q/4+1],k=Rt()[q/4+2],s=Rt()[q/4+3],F=y,M=S;if(s)throw F=0,M=0,po(k);return h=F,d=M,Qr(F,M)}finally{pt.__wbindgen_add_to_stack_pointer(16),pt.__wbindgen_free(h,d,1)}}toSavefile(){let a,h;try{const M=pt.__wbindgen_add_to_stack_pointer(-16);pt.ltn_toSavefile(M,this.__wbg_ptr);var d=Rt()[M/4+0],y=Rt()[M/4+1],S=Rt()[M/4+2],k=Rt()[M/4+3],s=d,F=y;if(k)throw s=0,F=0,po(S);return a=s,h=F,Qr(s,F)}finally{pt.__wbindgen_add_to_stack_pointer(16),pt.__wbindgen_free(a,h,1)}}loadSavefile(a){try{const S=pt.__wbindgen_add_to_stack_pointer(-16);pt.ltn_loadSavefile(S,this.__wbg_ptr,Vn(a));var h=Rt()[S/4+0],d=Rt()[S/4+1],y=Rt()[S/4+2];if(y)throw po(d);return h!==0}finally{pt.__wbindgen_add_to_stack_pointer(16)}}compareRoute(a,h,d,y){let S,k;try{const xe=pt.__wbindgen_add_to_stack_pointer(-16);pt.ltn_compareRoute(xe,this.__wbg_ptr,a,h,d,y);var s=Rt()[xe/4+0],F=Rt()[xe/4+1],M=Rt()[xe/4+2],q=Rt()[xe/4+3],ie=s,he=F;if(q)throw ie=0,he=0,po(M);return S=ie,k=he,Qr(ie,he)}finally{pt.__wbindgen_add_to_stack_pointer(16),pt.__wbindgen_free(S,k,1)}}}async function ug(f,a){if(typeof Response=="function"&&f instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(f,a)}catch(d){if(f.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",d);else throw d}const h=await f.arrayBuffer();return await WebAssembly.instantiate(h,a)}else{const h=await WebAssembly.instantiate(f,a);return h instanceof WebAssembly.Instance?{instance:h,module:f}:h}}function hg(){const f={};return f.wbg={},f.wbg.__wbindgen_object_drop_ref=function(a){po(a)},f.wbg.__wbindgen_string_get=function(a,h){const d=ci(h),y=typeof d=="string"?d:void 0;var S=kc(y)?0:Vc(y,pt.__wbindgen_malloc,pt.__wbindgen_realloc),k=da;Rt()[a/4+1]=k,Rt()[a/4+0]=S},f.wbg.__wbindgen_error_new=function(a,h){const d=new Error(Qr(a,h));return Vn(d)},f.wbg.__wbindgen_boolean_get=function(a){const h=ci(a);return typeof h=="boolean"?h?1:0:2},f.wbg.__wbindgen_is_bigint=function(a){return typeof ci(a)=="bigint"},f.wbg.__wbindgen_bigint_from_i64=function(a){return Vn(a)},f.wbg.__wbindgen_jsval_eq=function(a,h){return ci(a)===ci(h)},f.wbg.__wbindgen_bigint_from_u64=function(a){const h=BigInt.asUintN(64,a);return Vn(h)},f.wbg.__wbindgen_number_get=function(a,h){const d=ci(h),y=typeof d=="number"?d:void 0;Mf()[a/8+1]=kc(y)?0:y,Rt()[a/4+0]=!kc(y)},f.wbg.__wbindgen_is_object=function(a){const h=ci(a);return typeof h=="object"&&h!==null},f.wbg.__wbindgen_in=function(a,h){return ci(a)in ci(h)},f.wbg.__wbindgen_string_new=function(a,h){const d=Qr(a,h);return Vn(d)},f.wbg.__wbindgen_is_undefined=function(a){return ci(a)===void 0},f.wbg.__wbindgen_object_clone_ref=function(a){const h=ci(a);return Vn(h)},f.wbg.__wbindgen_jsval_loose_eq=function(a,h){return ci(a)==ci(h)},f.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(a,h){const d=ci(a)[ci(h)];return Vn(d)},f.wbg.__wbg_debug_34c9290896ec9856=function(a){console.debug(ci(a))},f.wbg.__wbg_error_e60eff06f24ab7a4=function(a){console.error(ci(a))},f.wbg.__wbg_info_d7d58472d0bab115=function(a){console.info(ci(a))},f.wbg.__wbg_log_a4530b4fe289336f=function(a){console.log(ci(a))},f.wbg.__wbg_warn_f260f49434e45e62=function(a){console.warn(ci(a))},f.wbg.__wbg_get_f01601b5a68d10e3=function(a,h){const d=ci(a)[h>>>0];return Vn(d)},f.wbg.__wbg_length_1009b1af0c481d7b=function(a){return ci(a).length},f.wbg.__wbindgen_is_function=function(a){return typeof ci(a)=="function"},f.wbg.__wbg_next_9b877f231f476d01=function(a){const h=ci(a).next;return Vn(h)},f.wbg.__wbg_next_6529ee0cca8d57ed=function(){return Mh(function(a){const h=ci(a).next();return Vn(h)},arguments)},f.wbg.__wbg_done_5fe336b092d60cf2=function(a){return ci(a).done},f.wbg.__wbg_value_0c248a78fdc8e19f=function(a){const h=ci(a).value;return Vn(h)},f.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return Vn(Symbol.iterator)},f.wbg.__wbg_get_7b48513de5dc5ea4=function(){return Mh(function(a,h){const d=Reflect.get(ci(a),ci(h));return Vn(d)},arguments)},f.wbg.__wbg_call_90c26b09837aba1c=function(){return Mh(function(a,h){const d=ci(a).call(ci(h));return Vn(d)},arguments)},f.wbg.__wbg_isArray_74fb723e24f76012=function(a){return Array.isArray(ci(a))},f.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(a){let h;try{h=ci(a)instanceof ArrayBuffer}catch{h=!1}return h},f.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(a){return Number.isSafeInteger(ci(a))},f.wbg.__wbg_entries_9e2e2aa45aa5094a=function(a){const h=Object.entries(ci(a));return Vn(h)},f.wbg.__wbg_buffer_a448f833075b71ba=function(a){const h=ci(a).buffer;return Vn(h)},f.wbg.__wbg_new_8f67e318f15d7254=function(a){const h=new Uint8Array(ci(a));return Vn(h)},f.wbg.__wbg_set_2357bf09366ee480=function(a,h,d){ci(a).set(ci(h),d>>>0)},f.wbg.__wbg_length_1d25fa9e4ac21ce7=function(a){return ci(a).length},f.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(a){let h;try{h=ci(a)instanceof Uint8Array}catch{h=!1}return h},f.wbg.__wbg_new_abda76e883ba8a5f=function(){const a=new Error;return Vn(a)},f.wbg.__wbg_stack_658279fe44541cf6=function(a,h){const d=ci(h).stack,y=Vc(d,pt.__wbindgen_malloc,pt.__wbindgen_realloc),S=da;Rt()[a/4+1]=S,Rt()[a/4+0]=y},f.wbg.__wbg_error_f851667af71bcfc6=function(a,h){let d,y;try{d=a,y=h,console.error(Qr(a,h))}finally{pt.__wbindgen_free(d,y,1)}},f.wbg.__wbindgen_bigint_get_as_i64=function(a,h){const d=ci(h),y=typeof d=="bigint"?d:void 0;og()[a/8+1]=kc(y)?BigInt(0):y,Rt()[a/4+0]=!kc(y)},f.wbg.__wbindgen_debug_string=function(a,h){const d=Oh(ci(h)),y=Vc(d,pt.__wbindgen_malloc,pt.__wbindgen_realloc),S=da;Rt()[a/4+1]=S,Rt()[a/4+0]=y},f.wbg.__wbindgen_throw=function(a,h){throw new Error(Qr(a,h))},f.wbg.__wbindgen_memory=function(){const a=pt.memory;return Vn(a)},f}function dg(f,a){return pt=f.exports,jh.__wbindgen_wasm_module=a,zc=null,Lc=null,Pc=null,Ac=null,pt}async function jh(f){if(pt!==void 0)return pt;typeof f>"u"&&(f="/ltn/assets/backend_bg.wasm");const a=hg();(typeof f=="string"||typeof Request=="function"&&f instanceof Request||typeof URL=="function"&&f instanceof URL)&&(f=fetch(f));const{instance:h,module:d}=await ug(await f,a);return dg(h,d)}let Qt;const Af=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Af.decode();let Dc=null;function Uc(){return(Dc===null||Dc.byteLength===0)&&(Dc=new Uint8Array(Qt.memory.buffer)),Dc}function ua(f,a){return f=f>>>0,Af.decode(Uc().subarray(f,f+a))}const ha=new Array(128).fill(void 0);ha.push(void 0,null,!0,!1);let jc=ha.length;function mr(f){jc===ha.length&&ha.push(ha.length+1);const a=jc;return jc=ha[a],ha[a]=f,a}function Ci(f){return ha[f]}function pg(f){f<132||(ha[f]=jc,jc=f)}function ku(f){const a=Ci(f);return pg(f),a}function Ah(f){return f==null}let Fc=null;function fg(){return(Fc===null||Fc.byteLength===0)&&(Fc=new Float64Array(Qt.memory.buffer)),Fc}let Rc=null;function wn(){return(Rc===null||Rc.byteLength===0)&&(Rc=new Int32Array(Qt.memory.buffer)),Rc}let Ha=0;const Mu=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},mg=typeof Mu.encodeInto=="function"?function(f,a){return Mu.encodeInto(f,a)}:function(f,a){const h=Mu.encode(f);return a.set(h),{read:f.length,written:h.length}};function Tu(f,a,h){if(h===void 0){const s=Mu.encode(f),F=a(s.length,1)>>>0;return Uc().subarray(F,F+s.length).set(s),Ha=s.length,F}let d=f.length,y=a(d,1)>>>0;const S=Uc();let k=0;for(;k<d;k++){const s=f.charCodeAt(k);if(s>127)break;S[y+k]=s}if(k!==d){k!==0&&(f=f.slice(k)),y=h(y,d,d=k+f.length*3,1)>>>0;const s=Uc().subarray(y+k,y+d),F=mg(f,s);k+=F.written}return Ha=k,y}function Bh(f){const a=typeof f;if(a=="number"||a=="boolean"||f==null)return`${f}`;if(a=="string")return`"${f}"`;if(a=="symbol"){const y=f.description;return y==null?"Symbol":`Symbol(${y})`}if(a=="function"){const y=f.name;return typeof y=="string"&&y.length>0?`Function(${y})`:"Function"}if(Array.isArray(f)){const y=f.length;let S="[";y>0&&(S+=Bh(f[0]));for(let k=1;k<y;k++)S+=", "+Bh(f[k]);return S+="]",S}const h=/\[object ([^\]]+)\]/.exec(toString.call(f));let d;if(h.length>1)d=h[1];else return toString.call(f);if(d=="Object")try{return"Object("+JSON.stringify(f)+")"}catch{return"Object"}return f instanceof Error?`${f.name}: ${f.message}
${f.stack}`:d}function _g(f,a){const h=a(f.length*1,1)>>>0;return Uc().set(f,h/1),Ha=f.length,h}function Ph(f,a){try{return f.apply(this,a)}catch(h){Qt.__wbindgen_exn_store(mr(h))}}class Lu{static __wrap(a){a=a>>>0;const h=Object.create(Lu.prototype);return h.__wbg_ptr=a,h}__destroy_into_raw(){const a=this.__wbg_ptr;return this.__wbg_ptr=0,a}free(){const a=this.__destroy_into_raw();Qt.__wbg_jsroutesnapper_free(a)}constructor(a){try{const S=Qt.__wbindgen_add_to_stack_pointer(-16),k=_g(a,Qt.__wbindgen_malloc),s=Ha;Qt.jsroutesnapper_new(S,k,s);var h=wn()[S/4+0],d=wn()[S/4+1],y=wn()[S/4+2];if(y)throw ku(d);return Lu.__wrap(h)}finally{Qt.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(a){Qt.jsroutesnapper_setRouteConfig(this.__wbg_ptr,mr(a))}setAreaMode(){Qt.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let a,h;try{const S=Qt.__wbindgen_add_to_stack_pointer(-16);Qt.jsroutesnapper_getConfig(S,this.__wbg_ptr);var d=wn()[S/4+0],y=wn()[S/4+1];return a=d,h=y,ua(d,y)}finally{Qt.__wbindgen_add_to_stack_pointer(16),Qt.__wbindgen_free(a,h,1)}}toFinalFeature(){try{const d=Qt.__wbindgen_add_to_stack_pointer(-16);Qt.jsroutesnapper_toFinalFeature(d,this.__wbg_ptr);var a=wn()[d/4+0],h=wn()[d/4+1];let y;return a!==0&&(y=ua(a,h).slice(),Qt.__wbindgen_free(a,h*1)),y}finally{Qt.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let a,h;try{const S=Qt.__wbindgen_add_to_stack_pointer(-16);Qt.jsroutesnapper_renderGeojson(S,this.__wbg_ptr);var d=wn()[S/4+0],y=wn()[S/4+1];return a=d,h=y,ua(d,y)}finally{Qt.__wbindgen_add_to_stack_pointer(16),Qt.__wbindgen_free(a,h,1)}}toggleSnapMode(){Qt.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(a,h,d){return Qt.jsroutesnapper_onMouseMove(this.__wbg_ptr,a,h,d)!==0}onClick(){Qt.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return Qt.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return Qt.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){Qt.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(a){try{const y=Qt.__wbindgen_add_to_stack_pointer(-16);Qt.jsroutesnapper_editExisting(y,this.__wbg_ptr,mr(a));var h=wn()[y/4+0],d=wn()[y/4+1];if(d)throw ku(h)}finally{Qt.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let a,h;try{const S=Qt.__wbindgen_add_to_stack_pointer(-16);Qt.jsroutesnapper_debugRenderGraph(S,this.__wbg_ptr);var d=wn()[S/4+0],y=wn()[S/4+1];return a=d,h=y,ua(d,y)}finally{Qt.__wbindgen_add_to_stack_pointer(16),Qt.__wbindgen_free(a,h,1)}}routeNameForWaypoints(a){let h,d;try{const q=Qt.__wbindgen_add_to_stack_pointer(-16);Qt.jsroutesnapper_routeNameForWaypoints(q,this.__wbg_ptr,mr(a));var y=wn()[q/4+0],S=wn()[q/4+1],k=wn()[q/4+2],s=wn()[q/4+3],F=y,M=S;if(s)throw F=0,M=0,ku(k);return h=F,d=M,ua(F,M)}finally{Qt.__wbindgen_add_to_stack_pointer(16),Qt.__wbindgen_free(h,d,1)}}addSnappedWaypoint(a,h){Qt.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,a,h)}undo(){Qt.jsroutesnapper_undo(this.__wbg_ptr)}}async function gg(f,a){if(typeof Response=="function"&&f instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(f,a)}catch(d){if(f.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",d);else throw d}const h=await f.arrayBuffer();return await WebAssembly.instantiate(h,a)}else{const h=await WebAssembly.instantiate(f,a);return h instanceof WebAssembly.Instance?{instance:h,module:f}:h}}function yg(){const f={};return f.wbg={},f.wbg.__wbindgen_string_new=function(a,h){const d=ua(a,h);return mr(d)},f.wbg.__wbindgen_object_drop_ref=function(a){ku(a)},f.wbg.__wbindgen_error_new=function(a,h){const d=new Error(ua(a,h));return mr(d)},f.wbg.__wbindgen_is_object=function(a){const h=Ci(a);return typeof h=="object"&&h!==null},f.wbg.__wbindgen_is_undefined=function(a){return Ci(a)===void 0},f.wbg.__wbindgen_in=function(a,h){return Ci(a)in Ci(h)},f.wbg.__wbindgen_number_get=function(a,h){const d=Ci(h),y=typeof d=="number"?d:void 0;fg()[a/8+1]=Ah(y)?0:y,wn()[a/4+0]=!Ah(y)},f.wbg.__wbindgen_boolean_get=function(a){const h=Ci(a);return typeof h=="boolean"?h?1:0:2},f.wbg.__wbindgen_object_clone_ref=function(a){const h=Ci(a);return mr(h)},f.wbg.__wbindgen_jsval_loose_eq=function(a,h){return Ci(a)==Ci(h)},f.wbg.__wbindgen_string_get=function(a,h){const d=Ci(h),y=typeof d=="string"?d:void 0;var S=Ah(y)?0:Tu(y,Qt.__wbindgen_malloc,Qt.__wbindgen_realloc),k=Ha;wn()[a/4+1]=k,wn()[a/4+0]=S},f.wbg.__wbg_String_4370c5505c674d30=function(a,h){const d=String(Ci(h)),y=Tu(d,Qt.__wbindgen_malloc,Qt.__wbindgen_realloc),S=Ha;wn()[a/4+1]=S,wn()[a/4+0]=y},f.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(a,h){const d=Ci(a)[Ci(h)];return mr(d)},f.wbg.__wbg_new_abda76e883ba8a5f=function(){const a=new Error;return mr(a)},f.wbg.__wbg_stack_658279fe44541cf6=function(a,h){const d=Ci(h).stack,y=Tu(d,Qt.__wbindgen_malloc,Qt.__wbindgen_realloc),S=Ha;wn()[a/4+1]=S,wn()[a/4+0]=y},f.wbg.__wbg_error_f851667af71bcfc6=function(a,h){let d,y;try{d=a,y=h,console.error(ua(a,h))}finally{Qt.__wbindgen_free(d,y,1)}},f.wbg.__wbg_debug_9a6b3243fbbebb61=function(a){console.debug(Ci(a))},f.wbg.__wbg_error_788ae33f81d3b84b=function(a){console.error(Ci(a))},f.wbg.__wbg_info_2e30e8204b29d91d=function(a){console.info(Ci(a))},f.wbg.__wbg_log_1d3ae0273d8f4f8a=function(a){console.log(Ci(a))},f.wbg.__wbg_warn_d60e832f9882c1b2=function(a){console.warn(Ci(a))},f.wbg.__wbg_get_44be0491f933a435=function(a,h){const d=Ci(a)[h>>>0];return mr(d)},f.wbg.__wbg_length_fff51ee6522a1a18=function(a){return Ci(a).length},f.wbg.__wbindgen_is_function=function(a){return typeof Ci(a)=="function"},f.wbg.__wbg_next_526fc47e980da008=function(a){const h=Ci(a).next;return mr(h)},f.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Ph(function(a){const h=Ci(a).next();return mr(h)},arguments)},f.wbg.__wbg_done_5c1f01fb660d73b5=function(a){return Ci(a).done},f.wbg.__wbg_value_1695675138684bd5=function(a){const h=Ci(a).value;return mr(h)},f.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return mr(Symbol.iterator)},f.wbg.__wbg_get_97b561fb56f034b5=function(){return Ph(function(a,h){const d=Reflect.get(Ci(a),Ci(h));return mr(d)},arguments)},f.wbg.__wbg_call_cb65541d95d71282=function(){return Ph(function(a,h){const d=Ci(a).call(Ci(h));return mr(d)},arguments)},f.wbg.__wbg_isArray_4c24b343cb13cfb1=function(a){return Array.isArray(Ci(a))},f.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(a){let h;try{h=Ci(a)instanceof ArrayBuffer}catch{h=!1}return h},f.wbg.__wbg_buffer_085ec1f694018c4f=function(a){const h=Ci(a).buffer;return mr(h)},f.wbg.__wbg_new_8125e318e6245eed=function(a){const h=new Uint8Array(Ci(a));return mr(h)},f.wbg.__wbg_set_5cf90238115182c3=function(a,h,d){Ci(a).set(Ci(h),d>>>0)},f.wbg.__wbg_length_72e2208bbc0efc61=function(a){return Ci(a).length},f.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(a){let h;try{h=Ci(a)instanceof Uint8Array}catch{h=!1}return h},f.wbg.__wbindgen_debug_string=function(a,h){const d=Bh(Ci(h)),y=Tu(d,Qt.__wbindgen_malloc,Qt.__wbindgen_realloc),S=Ha;wn()[a/4+1]=S,wn()[a/4+0]=y},f.wbg.__wbindgen_throw=function(a,h){throw new Error(ua(a,h))},f.wbg.__wbindgen_memory=function(){const a=Qt.memory;return mr(a)},f}function vg(f,a){return Qt=f.exports,qh.__wbindgen_wasm_module=a,Fc=null,Rc=null,Dc=null,Qt}async function qh(f){if(Qt!==void 0)return Qt;typeof f>"u"&&(f="/ltn/assets/route_snapper_bg.wasm");const a=yg();(typeof f=="string"||typeof Request=="function"&&f instanceof Request||typeof URL=="function"&&f instanceof URL)&&(f=fetch(f));const{instance:h,module:d}=await gg(await f,a);return vg(h,d)}const Bl=[];function Lh(f,a){return{subscribe:ar(f,a).subscribe}}function ar(f,a=vi){let h;const d=new Set;function y(s){if(Vi(f,s)&&(f=s,h)){const F=!Bl.length;for(const M of d)M[1](),Bl.push(M,f);if(F){for(let M=0;M<Bl.length;M+=2)Bl[M][0](Bl[M+1]);Bl.length=0}}}function S(s){y(s(f))}function k(s,F=vi){const M=[s,F];return d.add(M),d.size===1&&(h=a(y,S)||vi),s(f),()=>{d.delete(M),d.size===0&&h&&(h(),h=null)}}return{set:y,update:S,subscribe:k}}let bg=Date.now();function Hc(f){return`${f}-${bg++}`}const Zh=Symbol.for("svelte-maplibre");function Gl(){return Y_(Zh)}function xg(f){let a=new WeakMap;return h=>{var k;let d=a.get(h.originalEvent);if(d!==void 0)return d;let S=(k=h.target.queryRenderedFeatures(h.point).find(s=>{var F;return(F=f.get(s.layer.id))==null?void 0:F.interactive}))==null?void 0:k.layer.id;return a.set(h.originalEvent,S),S}}function wg(){let f=new Map;return Tf(Zh,{map:ar(null),source:Lh(null),layer:Lh(null),popupTarget:Lh(null),cluster:ar(),loadedImages:ar(new Set),minzoom:ar(0),maxzoom:ar(24),layerEvent:ar(null),layerInfo:f,eventTopMost:xg(f)})}function Fp(f){return{subscribe:f.subscribe}}function Gh({key:f,setPopupTarget:a=!1,setCluster:h=!1,setMouseEvent:d=!1}){let y=Gl(),S=ar(null),k=Fp(S),s={...y,[f]:Fp(S)};if(a&&(s.popupTarget=k),d){let F=ar(null);s.layerEvent=F,y.layerEvent=F}return h&&(s.cluster=ar()),Tf(Zh,s),{...y,self:S}}function Sg(){return Gh({key:"source",setCluster:!0})}function Tg(f=!0){return Gh({key:"layer",setPopupTarget:f,setMouseEvent:f})}function Ig(){return Gh({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}function Cg(f){return"layerType"in f&&f.layerType==="deckgl"}var Vl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Pf(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var Lf={exports:{}};(function(f,a){(function(h,d){f.exports=d()})(Vl,function(){var h,d,y;function S(s,F){if(!h)h=F;else if(!d)d=F;else{var M="var sharedChunk = {}; ("+h+")(sharedChunk); ("+d+")(sharedChunk);",q={};h(q),y=F(q),typeof window<"u"&&(y.workerUrl=window.URL.createObjectURL(new Blob([M],{type:"text/javascript"})))}}S(["exports"],function(s){function F(i,e,n,o){return new(n||(n=Promise))(function(c,m){function g(C){try{T(o.next(C))}catch(P){m(P)}}function b(C){try{T(o.throw(C))}catch(P){m(P)}}function T(C){var P;C.done?c(C.value):(P=C.value,P instanceof n?P:new n(function(D){D(P)})).then(g,b)}T((o=o.apply(i,e||[])).next())})}function M(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var q=ie;function ie(i,e){this.x=i,this.y=e}ie.prototype={clone:function(){return new ie(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),n=Math.sin(i),o=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=o,this},_rotateAround:function(i,e){var n=Math.cos(i),o=Math.sin(i),c=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-o*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ie.convert=function(i){return i instanceof ie?i:Array.isArray(i)?new ie(i[0],i[1]):i};var he=M(q),xe=ye;function ye(i,e,n,o){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=n,this.p2y=o}ye.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var n=i,o=0;o<8;o++){var c=this.sampleCurveX(n)-i;if(Math.abs(c)<e)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=c/m}var g=0,b=1;for(n=i,o=0;o<20&&(c=this.sampleCurveX(n),!(Math.abs(c-i)<e));o++)i>c?g=n:b=n,n=.5*(b-g)+g;return n},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var ge=M(xe);let fe,Te;function Pe(){return fe==null&&(fe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),fe}function Ke(){if(Te==null&&(Te=!1,Pe())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<5*5;o++){const c=4*o;e.fillStyle=`rgb(${c},${c+1},${c+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}const n=e.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&n[o]!==o){Te=!0;break}}}return Te||!1}function je(i,e,n,o){const c=new ge(i,e,n,o);return function(m){return c.solve(m)}}const St=je(.25,.1,.25,1);function vt(i,e,n){return Math.min(n,Math.max(e,i))}function yt(i,e,n){const o=n-e,c=((i-e)%o+o)%o+e;return c===e?n:c}function zt(i,...e){for(const n of e)for(const o in n)i[o]=n[o];return i}let wt=1;function Nt(i,e,n){const o={};for(const c in i)o[c]=e.call(n||this,i[c],c,i);return o}function De(i,e,n){const o={};for(const c in i)e.call(n||this,i[c],c,i)&&(o[c]=i[c]);return o}function Je(i){return Array.isArray(i)?i.map(Je):typeof i=="object"&&i?Nt(i,Je):i}const $t={};function $e(i){$t[i]||(typeof console<"u"&&console.warn(i),$t[i]=!0)}function Kt(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function Pt(i){let e=0;for(let n,o,c=0,m=i.length,g=m-1;c<m;g=c++)n=i[c],o=i[g],e+=(o.x-n.x)*(n.y+o.y);return e}function Lt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let ui=null;function Ln(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const zn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Pi(i,e,n,o,c){return F(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const m=new VideoFrame(i,{timestamp:0});try{const g=m==null?void 0:m.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);const b=g.startsWith("BGR"),T=new Uint8ClampedArray(o*c*4);if(yield m.copyTo(T,function(C,P,D,O,U){const j=4*Math.max(-P,0),W=(Math.max(0,D)-D)*O*4+j,ee=4*O,re=Math.max(0,P),pe=Math.max(0,D);return{rect:{x:re,y:pe,width:Math.min(C.width,P+O)-re,height:Math.min(C.height,D+U)-pe},layout:[{offset:W,stride:ee}]}}(i,e,n,o,c)),b)for(let C=0;C<T.length;C+=4){const P=T[C];T[C]=T[C+2],T[C+2]=P}return T}finally{m.close()}})}let Mi,Ut,bi,Li;const qe={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){return this.getImageCanvasContext(i).getImageData(-e,-e,i.width+2*e,i.height+2*e)},getImageCanvasContext(i){const e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=i.width,e.height=i.height,n.drawImage(i,0,0,i.width,i.height),n},resolveURL:i=>(bi||(bi=document.createElement("a")),bi.href=i,bi.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Li==null&&(Li=matchMedia("(prefers-reduced-motion: reduce)")),Li.matches)}},Gt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class it extends Error{constructor(e,n,o,c){super(`AJAXError: ${n} (${e}): ${o}`),this.status=e,this.statusText=n,this.url=o,this.body=c}}const si=Lt()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,gt=i=>Gt.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))];function Xi(i,e){const n=new AbortController,o=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,cache:i.cache,referrer:si(),signal:n.signal});let c=!1,m=!1;return i.type==="json"&&o.headers.set("Accept","application/json"),m||fetch(o).then(g=>g.ok?(b=>{(i.type==="arrayBuffer"||i.type==="image"?b.arrayBuffer():i.type==="json"?b.json():b.text()).then(T=>{m||(c=!0,e(null,T,b.headers.get("Cache-Control"),b.headers.get("Expires")))}).catch(T=>{m||e(new Error(T.message))})})(g):g.blob().then(b=>e(new it(g.status,g.statusText,i.url,b)))).catch(g=>{g.code!==20&&e(new Error(g.message))}),{cancel:()=>{m=!0,c||n.abort()}}}const Qi=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(Lt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!Lt())return(gt(i.url)||Xi)(i,e)}if(!(/^file:/.test(n=i.url)||/^file:/.test(si())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Xi(i,e);if(Lt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var n;return function(o,c){const m=new XMLHttpRequest;m.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(m.responseType="arraybuffer");for(const g in o.headers)m.setRequestHeader(g,o.headers[g]);return o.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=o.credentials==="include",m.onerror=()=>{c(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let g=m.response;if(o.type==="json")try{g=JSON.parse(m.response)}catch(b){return c(b)}c(null,g,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else{const g=new Blob([m.response],{type:m.getResponseHeader("Content-Type")});c(new it(m.status,m.statusText,o.url,g))}},m.send(o.body),{cancel:()=>m.abort()}}(i,e)},Ze=function(i,e){return Qi(zt(i,{type:"arrayBuffer"}),e)};function Ui(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function bn(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function xi(i,e,n){if(n&&n[i]){const o=n[i].indexOf(e);o!==-1&&n[i].splice(o,1)}}class _r{constructor(e,n={}){zt(this,n),this.type=e}}class Dn extends _r{constructor(e,n={}){super("error",zt({error:e},n))}}class yo{on(e,n){return this._listeners=this._listeners||{},bn(e,n,this._listeners),this}off(e,n){return xi(e,n,this._listeners),xi(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},bn(e,n,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,n){typeof e=="string"&&(e=new _r(e,n||{}));const o=e.type;if(this.listens(o)){e.target=this;const c=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const b of c)b.call(this,e);const m=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const b of m)xi(o,b,this._oneTimeListeners),b.call(this,e);const g=this._eventedParent;g&&(zt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof Dn&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var ke={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const tn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function zi(i,e){const n={};for(const o in i)o!=="ref"&&(n[o]=i[o]);return tn.forEach(o=>{o in e&&(n[o]=e[o])}),n}function jt(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let n=0;n<i.length;n++)if(!jt(i[n],e[n]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const n in i)if(!jt(i[n],e[n]))return!1;return!0}return i===e}const ei={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function $r(i,e,n){n.push({command:ei.addSource,args:[i,e[i]]})}function Br(i,e,n){e.push({command:ei.removeSource,args:[i]}),n[i]=!0}function eo(i,e,n,o){Br(i,n,o),$r(i,e,n)}function as(i,e,n){let o;for(o in i[n])if(Object.prototype.hasOwnProperty.call(i[n],o)&&o!=="data"&&!jt(i[n][o],e[n][o]))return!1;for(o in e[n])if(Object.prototype.hasOwnProperty.call(e[n],o)&&o!=="data"&&!jt(i[n][o],e[n][o]))return!1;return!0}function No(i,e,n,o,c,m){let g;for(g in e=e||{},i=i||{})Object.prototype.hasOwnProperty.call(i,g)&&(jt(i[g],e[g])||n.push({command:m,args:[o,g,e[g],c]}));for(g in e)Object.prototype.hasOwnProperty.call(e,g)&&!Object.prototype.hasOwnProperty.call(i,g)&&(jt(i[g],e[g])||n.push({command:m,args:[o,g,e[g],c]}))}function Nr(i){return i.id}function vo(i,e){return i[e.id]=e,i}class tt{constructor(e,n,o,c){this.message=(e?`${e}: `:"")+o,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function Er(i,...e){for(const n of e)for(const o in n)i[o]=n[o];return i}class mn extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class ls{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[o,c]of n)this.bindings[o]=c}concat(e){return new ls(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const gr={kind:"null"},rt={kind:"number"},oi={kind:"string"},Jt={kind:"boolean"},ir={kind:"color"},kr={kind:"object"},Wt={kind:"value"},Vr={kind:"collator"},K={kind:"formatted"},R={kind:"padding"},B={kind:"resolvedImage"},Z={kind:"variableAnchorOffsetCollection"};function Y(i,e){return{kind:"array",itemType:i,N:e}}function $(i){if(i.kind==="array"){const e=$(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const me=[gr,rt,oi,Jt,ir,K,kr,Y(Wt),R,B,Z];function ae(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ae(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const n of me)if(!ae(n,e))return null}}return`Expected ${$(i)} but found ${$(e)} instead.`}function ne(i,e){return e.some(n=>n.kind===i.kind)}function ce(i,e){return e.some(n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i)}function Le(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const Fe=.96422,Re=.82521,Et=4/29,Yt=6/29,bt=3*Yt*Yt,Dt=Yt*Yt*Yt,ti=Math.PI/180,Ai=180/Math.PI;function ai(i){return(i%=360)<0&&(i+=360),i}function Ii([i,e,n,o]){let c,m;const g=nr((.2225045*(i=wi(i))+.7168786*(e=wi(e))+.0606169*(n=wi(n)))/1);i===e&&e===n?c=m=g:(c=nr((.4360747*i+.3850649*e+.1430804*n)/Fe),m=nr((.0139322*i+.0971045*e+.7141733*n)/Re));const b=116*g-16;return[b<0?0:b,500*(c-g),200*(g-m),o]}function wi(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function nr(i){return i>Dt?Math.pow(i,1/3):i/bt+Et}function ji([i,e,n,o]){let c=(i+16)/116,m=isNaN(e)?c:c+e/500,g=isNaN(n)?c:c-n/200;return c=1*Fn(c),m=Fe*Fn(m),g=Re*Fn(g),[Cn(3.1338561*m-1.6168667*c-.4906146*g),Cn(-.9787684*m+1.9161415*c+.033454*g),Cn(.0719453*m-.2289914*c+1.4052427*g),o]}function Cn(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function Fn(i){return i>Yt?i*i*i:bt*(i-Et)}function Ur(i){return parseInt(i.padEnd(2,i),16)/255}function Os(i,e){return Vo(e?i/100:i,0,1)}function Vo(i,e,n){return Math.min(Math.max(e,i),n)}function Uo(i){return!i.some(Number.isNaN)}const Rn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Di{constructor(e,n,o,c=1,m=!0){this.r=e,this.g=n,this.b=o,this.a=c,m||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[e,n,o,c]))}static parse(e){if(e instanceof Di)return e;if(typeof e!="string")return;const n=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=Rn[o];if(c){const[g,b,T]=c;return[g/255,b/255,T/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const g=o.length<6?1:2;let b=1;return[Ur(o.slice(b,b+=g)),Ur(o.slice(b,b+=g)),Ur(o.slice(b,b+=g)),Ur(o.slice(b,b+g)||"ff")]}if(o.startsWith("rgb")){const g=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[b,T,C,P,D,O,U,j,W,ee,re,pe]=g,oe=[P||" ",U||" ",ee].join("");if(oe==="  "||oe==="  /"||oe===",,"||oe===",,,"){const ve=[C,O,W].join(""),Se=ve==="%%%"?100:ve===""?255:0;if(Se){const Be=[Vo(+T/Se,0,1),Vo(+D/Se,0,1),Vo(+j/Se,0,1),re?Os(+re,pe):1];if(Uo(Be))return Be}}return}}const m=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[g,b,T,C,P,D,O,U,j]=m,W=[T||" ",P||" ",O].join("");if(W==="  "||W==="  /"||W===",,"||W===",,,"){const ee=[+b,Vo(+C,0,100),Vo(+D,0,100),U?Os(+U,j):1];if(Uo(ee))return function([re,pe,oe,ve]){function Se(Be){const _t=(Be+re/30)%12,Ct=pe*Math.min(oe,1-oe);return oe-Ct*Math.max(-1,Math.min(_t-3,9-_t,1))}return re=ai(re),pe/=100,oe/=100,[Se(0),Se(8),Se(4),ve]}(ee)}}}(e);return n?new Di(...n,!1):void 0}get rgb(){const{r:e,g:n,b:o,a:c}=this,m=c||1/0;return this.overwriteGetter("rgb",[e/m,n/m,o/m,c])}get hcl(){return this.overwriteGetter("hcl",function(e){const[n,o,c,m]=Ii(e),g=Math.sqrt(o*o+c*c);return[Math.round(1e4*g)?ai(Math.atan2(c,o)*Ai):NaN,g,n,m]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ii(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,o,c]=this.rgb;return`rgba(${[e,n,o].map(m=>Math.round(255*m)).join(",")},${c})`}}Di.black=new Di(0,0,0,1),Di.white=new Di(1,1,1,1),Di.transparent=new Di(0,0,0,0),Di.red=new Di(1,0,0,1);class pa{constructor(e,n,o){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class to{constructor(e,n,o,c,m){this.text=e,this.image=n,this.scale=o,this.fontStack=c,this.textColor=m}}class nn{constructor(e){this.sections=e}static fromString(e){return new nn([new to(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof nn?e:nn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class rr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof rr)return e;if(typeof e=="number")return new rr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new rr(e)}}toString(){return JSON.stringify(this.values)}}const cs=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Un{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Un)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let n=0;n<e.length;n+=2){const o=e[n],c=e[n+1];if(typeof o!="string"||!cs.has(o)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new Un(e)}}toString(){return JSON.stringify(this.values)}}class jn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new jn({name:e,available:!1}):null}}function fa(i,e,n,o){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,e,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,e,n,o]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ws(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Di||i instanceof pa||i instanceof nn||i instanceof rr||i instanceof Un||i instanceof jn)return!0;if(Array.isArray(i)){for(const e of i)if(!ws(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!ws(i[e]))return!1;return!0}return!1}function on(i){if(i===null)return gr;if(typeof i=="string")return oi;if(typeof i=="boolean")return Jt;if(typeof i=="number")return rt;if(i instanceof Di)return ir;if(i instanceof pa)return Vr;if(i instanceof nn)return K;if(i instanceof rr)return R;if(i instanceof Un)return Z;if(i instanceof jn)return B;if(Array.isArray(i)){const e=i.length;let n;for(const o of i){const c=on(o);if(n){if(n===c)continue;n=Wt;break}n=c}return Y(n||Wt,e)}return kr}function Ei(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Di||i instanceof nn||i instanceof rr||i instanceof Un||i instanceof jn?i.toString():JSON.stringify(i)}class Mo{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ws(e[1]))return n.error("invalid value");const o=e[1];let c=on(o);const m=n.expectedType;return c.kind!=="array"||c.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(c=m),new Mo(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class sn{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Bs={string:oi,number:rt,boolean:Jt,object:kr};class jr{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o,c=1;const m=e[0];if(m==="array"){let b,T;if(e.length>2){const C=e[1];if(typeof C!="string"||!(C in Bs)||C==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);b=Bs[C],c++}else b=Wt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);T=e[2],c++}o=Y(b,T)}else{if(!Bs[m])throw new Error(`Types doesn't contain name = ${m}`);o=Bs[m]}const g=[];for(;c<e.length;c++){const b=n.parse(e[c],c,Wt);if(!b)return null;g.push(b)}return new jr(o,g)}evaluate(e){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(e);if(!ae(this.type,on(o)))return o;if(n===this.args.length-1)throw new sn(`Expected value to be of type ${$(this.type)}, but found ${$(on(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ka={"to-boolean":Jt,"to-color":ir,"to-number":rt,"to-string":oi};class jo{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[0];if(!Ka[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return n.error("Expected one argument.");const c=Ka[o],m=[];for(let g=1;g<e.length;g++){const b=n.parse(e[g],g,Wt);if(!b)return null;m.push(b)}return new jo(c,m)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,o;for(const c of this.args){if(n=c.evaluate(e),o=null,n instanceof Di)return n;if(typeof n=="string"){const m=e.parseColor(n);if(m)return m}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:fa(n[0],n[1],n[2],n[3]),!o))return new Di(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new sn(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(e);const c=rr.parse(n);if(c)return c}throw new sn(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(e);const c=Un.parse(n);if(c)return c}throw new sn(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(e),n===null)return 0;const c=Number(n);if(!isNaN(c))return c}throw new sn(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return nn.fromString(Ei(this.args[0].evaluate(e)));case"resolvedImage":return jn.fromString(Ei(this.args[0].evaluate(e)));default:return Ei(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ns=["Unknown","Point","LineString","Polygon"];class v{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ns[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=Di.parse(e)),n}}class E{constructor(e,n,o=[],c,m=new ls,g=[]){this.registry=e,this.path=o,this.key=o.map(b=>`[${b}]`).join(""),this.scope=m,this.errors=g,this.expectedType=c,this._isConstant=n}parse(e,n,o,c,m={}){return n?this.concat(n,o,c)._parse(e,m):this._parse(e,m)}_parse(e,n){function o(c,m,g){return g==="assert"?new jr(m,[c]):g==="coerce"?new jo(m,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[c];if(m){let g=m.parse(e,this);if(!g)return null;if(this.expectedType){const b=this.expectedType,T=g.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||T.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string")if(b.kind!=="padding"||T.kind!=="value"&&T.kind!=="number"&&T.kind!=="array")if(b.kind!=="variableAnchorOffsetCollection"||T.kind!=="value"&&T.kind!=="array"){if(this.checkSubtype(b,T))return null}else g=o(g,b,n.typeAnnotation||"coerce");else g=o(g,b,n.typeAnnotation||"coerce");else g=o(g,b,n.typeAnnotation||"coerce");else g=o(g,b,n.typeAnnotation||"assert")}if(!(g instanceof Mo)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const b=new v;try{g=new Mo(g.type,g.evaluate(b))}catch(T){return this.error(T.message),null}}return g}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,o){const c=typeof e=="number"?this.path.concat(e):this.path,m=o?this.scope.concat(o):this.scope;return new E(this.registry,this._isConstant,c,n||null,m,this.errors)}error(e,...n){const o=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new mn(o,e))}checkSubtype(e,n){const o=ae(e,n);return o&&this.error(o),o}}class V{constructor(e,n,o){this.type=Vr,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const c=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Jt);if(!c)return null;const m=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Jt);if(!m)return null;let g=null;return o.locale&&(g=n.parse(o.locale,1,oi),!g)?null:new V(c,m,g)}evaluate(e){return new pa(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const Q=8192;function se(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function le(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function be(i,e){const n=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(n*c*Q),Math.round(o*c*Q)]}function Ge(i,e,n){const o=i[0]-e[0],c=i[1]-e[1],m=i[0]-n[0],g=i[1]-n[1];return o*g-m*c==0&&o*m<=0&&c*g<=0}function Qe(i,e){let n=!1;for(let g=0,b=e.length;g<b;g++){const T=e[g];for(let C=0,P=T.length;C<P-1;C++){if(Ge(i,T[C],T[C+1]))return!1;(c=T[C])[1]>(o=i)[1]!=(m=T[C+1])[1]>o[1]&&o[0]<(m[0]-c[0])*(o[1]-c[1])/(m[1]-c[1])+c[0]&&(n=!n)}}var o,c,m;return n}function dt(i,e){for(let n=0;n<e.length;n++)if(Qe(i,e[n]))return!0;return!1}function ft(i,e,n,o){const c=o[0]-n[0],m=o[1]-n[1],g=(i[0]-n[0])*m-c*(i[1]-n[1]),b=(e[0]-n[0])*m-c*(e[1]-n[1]);return g>0&&b<0||g<0&&b>0}function at(i,e,n){for(const C of n)for(let P=0;P<C.length-1;++P)if((b=[(g=C[P+1])[0]-(m=C[P])[0],g[1]-m[1]])[0]*(T=[(c=e)[0]-(o=i)[0],c[1]-o[1]])[1]-b[1]*T[0]!=0&&ft(o,c,m,g)&&ft(m,g,o,c))return!0;var o,c,m,g,b,T;return!1}function ii(i,e){for(let n=0;n<i.length;++n)if(!Qe(i[n],e))return!1;for(let n=0;n<i.length-1;++n)if(at(i[n],i[n+1],e))return!1;return!0}function an(i,e){for(let n=0;n<e.length;n++)if(ii(i,e[n]))return!0;return!1}function ri(i,e,n){const o=[];for(let c=0;c<i.length;c++){const m=[];for(let g=0;g<i[c].length;g++){const b=be(i[c][g],n);se(e,b),m.push(b)}o.push(m)}return o}function Sn(i,e,n){const o=[];for(let c=0;c<i.length;c++){const m=ri(i[c],e,n);o.push(m)}return o}function Ne(i,e,n,o){if(i[0]<n[0]||i[0]>n[2]){const c=.5*o;let m=i[0]-n[0]>c?-o:n[0]-i[0]>c?o:0;m===0&&(m=i[0]-n[2]>c?-o:n[2]-i[0]>c?o:0),i[0]+=m}se(e,i)}function kt(i,e,n,o){const c=Math.pow(2,o.z)*Q,m=[o.x*Q,o.y*Q],g=[];for(const b of i)for(const T of b){const C=[T.x+m[0],T.y+m[1]];Ne(C,e,n,c),g.push(C)}return g}function Fi(i,e,n,o){const c=Math.pow(2,o.z)*Q,m=[o.x*Q,o.y*Q],g=[];for(const T of i){const C=[];for(const P of T){const D=[P.x+m[0],P.y+m[1]];se(e,D),C.push(D)}g.push(C)}if(e[2]-e[0]<=c/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const T of g)for(const C of T)Ne(C,e,n,c)}var b;return g}class ln{constructor(e,n){this.type=Jt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ws(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let c=0;c<o.features.length;++c){const m=o.features[c].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new ln(o,o.features[c].geometry)}else if(o.type==="Feature"){const c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new ln(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new ln(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,o){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const b=ri(o.coordinates,m,g),T=kt(n.geometry(),c,m,g);if(!le(c,m))return!1;for(const C of T)if(!Qe(C,b))return!1}if(o.type==="MultiPolygon"){const b=Sn(o.coordinates,m,g),T=kt(n.geometry(),c,m,g);if(!le(c,m))return!1;for(const C of T)if(!dt(C,b))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,o){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const b=ri(o.coordinates,m,g),T=Fi(n.geometry(),c,m,g);if(!le(c,m))return!1;for(const C of T)if(!ii(C,b))return!1}if(o.type==="MultiPolygon"){const b=Sn(o.coordinates,m,g),T=Fi(n.geometry(),c,m,g);if(!le(c,m))return!1;for(const C of T)if(!an(C,b))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class _n{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=e[1];return n.scope.has(o)?new _n(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class yr{constructor(e,n,o,c){this.name=e,this.type=n,this._evaluate=o,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const o=e[0],c=yr.definitions[o];if(!c)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(c)?c[0]:c.type,g=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,b=g.filter(([C])=>!Array.isArray(C)||C.length===e.length-1);let T=null;for(const[C,P]of b){T=new E(n.registry,ma,n.path,null,n.scope);const D=[];let O=!1;for(let U=1;U<e.length;U++){const j=e[U],W=Array.isArray(C)?C[U-1]:C.type,ee=T.parse(j,1+D.length,W);if(!ee){O=!0;break}D.push(ee)}if(!O)if(Array.isArray(C)&&C.length!==D.length)T.error(`Expected ${C.length} arguments, but found ${D.length} instead.`);else{for(let U=0;U<D.length;U++){const j=Array.isArray(C)?C[U]:C.type,W=D[U];T.concat(U+1).checkSubtype(j,W.type)}if(T.errors.length===0)return new yr(o,m,P,D)}}if(b.length===1)n.errors.push(...T.errors);else{const C=(b.length?b:g).map(([D])=>{return O=D,Array.isArray(O)?`(${O.map($).join(", ")})`:`(${$(O.type)}...)`;var O}).join(" | "),P=[];for(let D=1;D<e.length;D++){const O=n.parse(e[D],1+P.length);if(!O)return null;P.push($(O.type))}n.error(`Expected arguments of type ${C}, but found (${P.join(", ")}) instead.`)}return null}static register(e,n){yr.definitions=n;for(const o in n)e[o]=yr}}function ma(i){if(i instanceof _n)return ma(i.boundExpression);if(i instanceof yr&&i.name==="error"||i instanceof V||i instanceof ln)return!1;const e=i instanceof jo||i instanceof jr;let n=!0;return i.eachChild(o=>{n=e?n&&ma(o):n&&o instanceof Mo}),!!n&&qi(i)&&_a(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function qi(i){if(i instanceof yr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof ln)return!1;let e=!0;return i.eachChild(n=>{e&&!qi(n)&&(e=!1)}),e}function Ss(i){if(i instanceof yr&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(n=>{e&&!Ss(n)&&(e=!1)}),e}function _a(i,e){if(i instanceof yr&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(o=>{n&&!_a(o,e)&&(n=!1)}),n}function vr(i,e){const n=i.length-1;let o,c,m=0,g=n,b=0;for(;m<=g;)if(b=Math.floor((m+g)/2),o=i[b],c=i[b+1],o<=e){if(b===n||e<c)return b;m=b+1}else{if(!(o>e))throw new sn("Input is not a number.");g=b-1}return 0}class Ao{constructor(e,n,o){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[c,m]of o)this.labels.push(c),this.outputs.push(m)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(e[1],1,rt);if(!o)return null;const c=[];let m=null;n.expectedType&&n.expectedType.kind!=="value"&&(m=n.expectedType);for(let g=1;g<e.length;g+=2){const b=g===1?-1/0:e[g],T=e[g+1],C=g,P=g+1;if(typeof b!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(c.length&&c[c.length-1][0]>=b)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const D=n.parse(T,P,m);if(!D)return null;m=m||D.type,c.push([b,D])}return new Ao(m,o,c)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return o[0].evaluate(e);const m=n.length;return c>=n[m-1]?o[m-1].evaluate(e):o[vr(n,c)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function di(i,e,n){return i+n*(e-i)}function Vs(i,e,n){return i.map((o,c)=>di(o,e[c],n))}const ur={number:di,color:function(i,e,n,o="rgb"){switch(o){case"rgb":{const[c,m,g,b]=Vs(i.rgb,e.rgb,n);return new Di(c,m,g,b,!1)}case"hcl":{const[c,m,g,b]=i.hcl,[T,C,P,D]=e.hcl;let O,U;if(isNaN(c)||isNaN(T))isNaN(c)?isNaN(T)?O=NaN:(O=T,g!==1&&g!==0||(U=C)):(O=c,P!==1&&P!==0||(U=m));else{let pe=T-c;T>c&&pe>180?pe-=360:T<c&&c-T>180&&(pe+=360),O=c+n*pe}const[j,W,ee,re]=function([pe,oe,ve,Se]){return pe=isNaN(pe)?0:pe*ti,ji([ve,Math.cos(pe)*oe,Math.sin(pe)*oe,Se])}([O,U??di(m,C,n),di(g,P,n),di(b,D,n)]);return new Di(j,W,ee,re,!1)}case"lab":{const[c,m,g,b]=ji(Vs(i.lab,e.lab,n));return new Di(c,m,g,b,!1)}}},array:Vs,padding:function(i,e,n){return new rr(Vs(i.values,e.values,n))},variableAnchorOffsetCollection:function(i,e,n){const o=i.values,c=e.values;if(o.length!==c.length)throw new sn(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);const m=[];for(let g=0;g<o.length;g+=2){if(o[g]!==c[g])throw new sn(`Cannot interpolate values containing mismatched anchors. from[${g}]: ${o[g]}, to[${g}]: ${c[g]}`);m.push(o[g]);const[b,T]=o[g+1],[C,P]=c[g+1];m.push([di(b,C,n),di(T,P,n)])}return new Un(m)}};class br{constructor(e,n,o,c,m){this.type=e,this.operator=n,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(const[g,b]of m)this.labels.push(g),this.outputs.push(b)}static interpolationFactor(e,n,o,c){let m=0;if(e.name==="exponential")m=ga(n,e.base,o,c);else if(e.name==="linear")m=ga(n,1,o,c);else if(e.name==="cubic-bezier"){const g=e.controlPoints;m=new ge(g[0],g[1],g[2],g[3]).solve(ga(n,1,o,c))}return m}static parse(e,n){let[o,c,m,...g]=e;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const C=c[1];if(typeof C!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:C}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const C=c.slice(1);if(C.length!==4||C.some(P=>typeof P!="number"||P<0||P>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:C}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(m=n.parse(m,2,rt),!m)return null;const b=[];let T=null;o==="interpolate-hcl"||o==="interpolate-lab"?T=ir:n.expectedType&&n.expectedType.kind!=="value"&&(T=n.expectedType);for(let C=0;C<g.length;C+=2){const P=g[C],D=g[C+1],O=C+3,U=C+4;if(typeof P!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(b.length&&b[b.length-1][0]>=P)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);const j=n.parse(D,U,T);if(!j)return null;T=T||j.type,b.push([P,j])}return Le(T,rt)||Le(T,ir)||Le(T,R)||Le(T,Z)||Le(T,Y(rt))?new br(T,o,c,m,b):n.error(`Type ${$(T)} is not interpolatable.`)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return o[0].evaluate(e);const m=n.length;if(c>=n[m-1])return o[m-1].evaluate(e);const g=vr(n,c),b=br.interpolationFactor(this.interpolation,c,n[g],n[g+1]),T=o[g].evaluate(e),C=o[g+1].evaluate(e);switch(this.operator){case"interpolate":return ur[this.type.kind](T,C,b);case"interpolate-hcl":return ur.color(T,C,b,"hcl");case"interpolate-lab":return ur.color(T,C,b,"lab")}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function ga(i,e,n,o){const c=o-n,m=i-n;return c===0?0:e===1?m/c:(Math.pow(e,m)-1)/(Math.pow(e,c)-1)}class ya{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let o=null;const c=n.expectedType;c&&c.kind!=="value"&&(o=c);const m=[];for(const b of e.slice(1)){const T=n.parse(b,1+m.length,o,void 0,{typeAnnotation:"omit"});if(!T)return null;o=o||T.type,m.push(T)}if(!o)throw new Error("No output type");const g=c&&m.some(b=>ae(c,b.type));return new ya(g?Wt:o,m)}evaluate(e){let n,o=null,c=0;for(const m of this.args)if(c++,o=m.evaluate(e),o&&o instanceof jn&&!o.available&&(n||(n=o.name),o=null,c===this.args.length&&(o=n)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class va{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let m=1;m<e.length-1;m+=2){const g=e[m];if(typeof g!="string")return n.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return n.error("Variable names must contain only alphanumeric characters or '_'.",m);const b=n.parse(e[m+1],m+1);if(!b)return null;o.push([g,b])}const c=n.parse(e[e.length-1],e.length-1,n.expectedType,o);return c?new va(o,c):null}outputDefined(){return this.result.outputDefined()}}class Ja{constructor(e,n,o){this.type=e,this.index=n,this.input=o}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,rt),c=n.parse(e[2],2,Y(n.expectedType||Wt));return o&&c?new Ja(c.type.itemType,o,c):null}evaluate(e){const n=this.index.evaluate(e),o=this.input.evaluate(e);if(n<0)throw new sn(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new sn(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new sn(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class ba{constructor(e,n){this.type=Jt,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Wt),c=n.parse(e[2],2,Wt);return o&&c?ne(o.type,[Jt,oi,rt,gr,Wt])?new ba(o,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${$(o.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!ce(n,["boolean","string","number","null"]))throw new sn(`Expected first argument to be of type boolean, string, number or null, but found ${$(on(n))} instead.`);if(!ce(o,["string","array"]))throw new sn(`Expected second argument to be of type array or string, but found ${$(on(o))} instead.`);return o.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Us{constructor(e,n,o){this.type=rt,this.needle=e,this.haystack=n,this.fromIndex=o}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Wt),c=n.parse(e[2],2,Wt);if(!o||!c)return null;if(!ne(o.type,[Jt,oi,rt,gr,Wt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${$(o.type)} instead`);if(e.length===4){const m=n.parse(e[3],3,rt);return m?new Us(o,c,m):null}return new Us(o,c)}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!ce(n,["boolean","string","number","null"]))throw new sn(`Expected first argument to be of type boolean, string, number or null, but found ${$(on(n))} instead.`);if(!ce(o,["string","array"]))throw new sn(`Expected second argument to be of type array or string, but found ${$(on(o))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return o.indexOf(n,c)}return o.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class xa{constructor(e,n,o,c,m,g){this.inputType=e,this.type=n,this.input=o,this.cases=c,this.outputs=m,this.otherwise=g}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let o,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const m={},g=[];for(let C=2;C<e.length-1;C+=2){let P=e[C];const D=e[C+1];Array.isArray(P)||(P=[P]);const O=n.concat(C);if(P.length===0)return O.error("Expected at least one branch label.");for(const j of P){if(typeof j!="number"&&typeof j!="string")return O.error("Branch labels must be numbers or strings.");if(typeof j=="number"&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return O.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof j=="number"&&Math.floor(j)!==j)return O.error("Numeric branch labels must be integer values.");if(o){if(O.checkSubtype(o,on(j)))return null}else o=on(j);if(m[String(j)]!==void 0)return O.error("Branch labels must be unique.");m[String(j)]=g.length}const U=n.parse(D,C,c);if(!U)return null;c=c||U.type,g.push(U)}const b=n.parse(e[1],1,Wt);if(!b)return null;const T=n.parse(e[e.length-1],e.length-1,c);return T?b.type.kind!=="value"&&n.concat(1).checkSubtype(o,b.type)?null:new xa(o,c,b,m,g,T):null}evaluate(e){const n=this.input.evaluate(e);return(on(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Ya{constructor(e,n,o){this.type=e,this.branches=n,this.otherwise=o}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const c=[];for(let g=1;g<e.length-1;g+=2){const b=n.parse(e[g],g,Jt);if(!b)return null;const T=n.parse(e[g+1],g+1,o);if(!T)return null;c.push([b,T]),o=o||T.type}const m=n.parse(e[e.length-1],e.length-1,o);if(!m)return null;if(!o)throw new Error("Can't infer output type");return new Ya(o,c,m)}evaluate(e){for(const[n,o]of this.branches)if(n.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,o]of this.branches)e(n),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class wa{constructor(e,n,o,c){this.type=e,this.input=n,this.beginIndex=o,this.endIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Wt),c=n.parse(e[2],2,rt);if(!o||!c)return null;if(!ne(o.type,[Y(Wt),oi,Wt]))return n.error(`Expected first argument to be of type array or string, but found ${$(o.type)} instead`);if(e.length===4){const m=n.parse(e[3],3,rt);return m?new wa(o.type,o,c,m):null}return new wa(o.type,o,c)}evaluate(e){const n=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!ce(n,["string","array"]))throw new sn(`Expected first argument to be of type array or string, but found ${$(on(n))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return n.slice(o,c)}return n.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function js(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Sa(i,e,n,o){return o.compare(e,n)===0}function us(i,e,n){const o=i!=="=="&&i!=="!=";return class zf{constructor(m,g,b){this.type=Jt,this.lhs=m,this.rhs=g,this.collator=b,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");const b=m[0];let T=g.parse(m[1],1,Wt);if(!T)return null;if(!js(b,T.type))return g.concat(1).error(`"${b}" comparisons are not supported for type '${$(T.type)}'.`);let C=g.parse(m[2],2,Wt);if(!C)return null;if(!js(b,C.type))return g.concat(2).error(`"${b}" comparisons are not supported for type '${$(C.type)}'.`);if(T.type.kind!==C.type.kind&&T.type.kind!=="value"&&C.type.kind!=="value")return g.error(`Cannot compare types '${$(T.type)}' and '${$(C.type)}'.`);o&&(T.type.kind==="value"&&C.type.kind!=="value"?T=new jr(C.type,[T]):T.type.kind!=="value"&&C.type.kind==="value"&&(C=new jr(T.type,[C])));let P=null;if(m.length===4){if(T.type.kind!=="string"&&C.type.kind!=="string"&&T.type.kind!=="value"&&C.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(P=g.parse(m[3],3,Vr),!P)return null}return new zf(T,C,P)}evaluate(m){const g=this.lhs.evaluate(m),b=this.rhs.evaluate(m);if(o&&this.hasUntypedArgument){const T=on(g),C=on(b);if(T.kind!==C.kind||T.kind!=="string"&&T.kind!=="number")throw new sn(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${T.kind}, ${C.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const T=on(g),C=on(b);if(T.kind!=="string"||C.kind!=="string")return e(m,g,b)}return this.collator?n(m,g,b,this.collator.evaluate(m)):e(m,g,b)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const bo=us("==",function(i,e,n){return e===n},Sa),gl=us("!=",function(i,e,n){return e!==n},function(i,e,n,o){return!Sa(0,e,n,o)}),yl=us("<",function(i,e,n){return e<n},function(i,e,n,o){return o.compare(e,n)<0}),Hl=us(">",function(i,e,n){return e>n},function(i,e,n,o){return o.compare(e,n)>0}),vl=us("<=",function(i,e,n){return e<=n},function(i,e,n,o){return o.compare(e,n)<=0}),Ta=us(">=",function(i,e,n){return e>=n},function(i,e,n,o){return o.compare(e,n)>=0});class Ia{constructor(e,n,o,c,m){this.type=oi,this.number=e,this.locale=n,this.currency=o,this.minFractionDigits=c,this.maxFractionDigits=m}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const o=n.parse(e[1],1,rt);if(!o)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let m=null;if(c.locale&&(m=n.parse(c.locale,1,oi),!m))return null;let g=null;if(c.currency&&(g=n.parse(c.currency,1,oi),!g))return null;let b=null;if(c["min-fraction-digits"]&&(b=n.parse(c["min-fraction-digits"],1,rt),!b))return null;let T=null;return c["max-fraction-digits"]&&(T=n.parse(c["max-fraction-digits"],1,rt),!T)?null:new Ia(o,m,g,b,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class qs{constructor(e){this.type=K,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const c=[];let m=!1;for(let g=1;g<=e.length-1;++g){const b=e[g];if(m&&typeof b=="object"&&!Array.isArray(b)){m=!1;let T=null;if(b["font-scale"]&&(T=n.parse(b["font-scale"],1,rt),!T))return null;let C=null;if(b["text-font"]&&(C=n.parse(b["text-font"],1,Y(oi)),!C))return null;let P=null;if(b["text-color"]&&(P=n.parse(b["text-color"],1,ir),!P))return null;const D=c[c.length-1];D.scale=T,D.font=C,D.textColor=P}else{const T=n.parse(e[g],1,Wt);if(!T)return null;const C=T.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,c.push({content:T,scale:null,font:null,textColor:null})}}return new qs(c)}evaluate(e){return new nn(this.sections.map(n=>{const o=n.content.evaluate(e);return on(o)===B?new to("",o,null,null,null):new to(Ei(o),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}}class Qa{constructor(e){this.type=B,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const o=n.parse(e[1],1,oi);return o?new Qa(o):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),o=jn.fromString(n);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(n)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class Po{constructor(e){this.type=rt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=n.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${$(o.type)} instead.`):new Po(o):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new sn(`Expected value to be of type string or array, but found ${$(on(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const hs={"==":bo,"!=":gl,">":Hl,"<":yl,">=":Ta,"<=":vl,array:jr,at:Ja,boolean:jr,case:Ya,coalesce:ya,collator:V,format:qs,image:Qa,in:ba,"index-of":Us,interpolate:br,"interpolate-hcl":br,"interpolate-lab":br,length:Po,let:va,literal:Mo,match:xa,number:jr,"number-format":Ia,object:jr,slice:wa,step:Ao,string:jr,"to-boolean":jo,"to-color":jo,"to-number":jo,"to-string":jo,var:_n,within:ln};function bl(i,[e,n,o,c]){e=e.evaluate(i),n=n.evaluate(i),o=o.evaluate(i);const m=c?c.evaluate(i):1,g=fa(e,n,o,m);if(g)throw new sn(g);return new Di(e/255,n/255,o/255,m,!1)}function xl(i,e){return i in e}function Zs(i,e){const n=e[i];return n===void 0?null:n}function io(i){return{type:i}}function Ca(i){return{result:"success",value:i}}function xo(i){return{result:"error",value:i}}function qo(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Ts(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function $a(i){return!!i.expression&&i.expression.interpolated}function ki(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function cn(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Xl(i){return i}function mi(i,e){const n=e.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",c=o||!(o||i.property!==void 0),m=i.type||($a(e)?"exponential":"interval");if(n||e.type==="padding"){const P=n?Di.parse:rr.parse;(i=Er({},i)).stops&&(i.stops=i.stops.map(D=>[D[0],P(D[1])])),i.default=P(i.default?i.default:e.default)}if(i.colorSpace&&(g=i.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var g;let b,T,C;if(m==="exponential")b=Mr;else if(m==="interval")b=Ri;else if(m==="categorical"){b=$i,T=Object.create(null);for(const P of i.stops)T[P[0]]=P[1];C=typeof i.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);b=Go}if(o){const P={},D=[];for(let j=0;j<i.stops.length;j++){const W=i.stops[j],ee=W[0].zoom;P[ee]===void 0&&(P[ee]={zoom:ee,type:i.type,property:i.property,default:i.default,stops:[]},D.push(ee)),P[ee].stops.push([W[0].value,W[1]])}const O=[];for(const j of D)O.push([P[j].zoom,mi(P[j],e)]);const U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:br.interpolationFactor.bind(void 0,U),zoomStops:O.map(j=>j[0]),evaluate:({zoom:j},W)=>Mr({stops:O,base:i.base},e,j).evaluate(j,W)}}if(c){const P=m==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:br.interpolationFactor.bind(void 0,P),zoomStops:i.stops.map(D=>D[0]),evaluate:({zoom:D})=>b(i,e,D,T,C)}}return{kind:"source",evaluate(P,D){const O=D&&D.properties?D.properties[i.property]:void 0;return O===void 0?Zo(i.default,e.default):b(i,e,O,T,C)}}}function Zo(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function $i(i,e,n,o,c){return Zo(typeof n===c?o[n]:void 0,i.default,e.default)}function Ri(i,e,n){if(ki(n)!=="number")return Zo(i.default,e.default);const o=i.stops.length;if(o===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[o-1][0])return i.stops[o-1][1];const c=vr(i.stops.map(m=>m[0]),n);return i.stops[c][1]}function Mr(i,e,n){const o=i.base!==void 0?i.base:1;if(ki(n)!=="number")return Zo(i.default,e.default);const c=i.stops.length;if(c===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[c-1][0])return i.stops[c-1][1];const m=vr(i.stops.map(P=>P[0]),n),g=function(P,D,O,U){const j=U-O,W=P-O;return j===0?0:D===1?W/j:(Math.pow(D,W)-1)/(Math.pow(D,j)-1)}(n,o,i.stops[m][0],i.stops[m+1][0]),b=i.stops[m][1],T=i.stops[m+1][1],C=ur[e.type]||Xl;return typeof b.evaluate=="function"?{evaluate(...P){const D=b.evaluate.apply(void 0,P),O=T.evaluate.apply(void 0,P);if(D!==void 0&&O!==void 0)return C(D,O,g,i.colorSpace)}}:C(b,T,g,i.colorSpace)}function Go(i,e,n){switch(e.type){case"color":n=Di.parse(n);break;case"formatted":n=nn.fromString(n.toString());break;case"resolvedImage":n=jn.fromString(n.toString());break;case"padding":n=rr.parse(n);break;default:ki(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0)}return Zo(n,i.default,e.default)}yr.register(hs,{error:[{kind:"error"},[oi],(i,[e])=>{throw new sn(e.evaluate(i))}],typeof:[oi,[Wt],(i,[e])=>$(on(e.evaluate(i)))],"to-rgba":[Y(rt,4),[ir],(i,[e])=>{const[n,o,c,m]=e.evaluate(i).rgb;return[255*n,255*o,255*c,m]}],rgb:[ir,[rt,rt,rt],bl],rgba:[ir,[rt,rt,rt,rt],bl],has:{type:Jt,overloads:[[[oi],(i,[e])=>xl(e.evaluate(i),i.properties())],[[oi,kr],(i,[e,n])=>xl(e.evaluate(i),n.evaluate(i))]]},get:{type:Wt,overloads:[[[oi],(i,[e])=>Zs(e.evaluate(i),i.properties())],[[oi,kr],(i,[e,n])=>Zs(e.evaluate(i),n.evaluate(i))]]},"feature-state":[Wt,[oi],(i,[e])=>Zs(e.evaluate(i),i.featureState||{})],properties:[kr,[],i=>i.properties()],"geometry-type":[oi,[],i=>i.geometryType()],id:[Wt,[],i=>i.id()],zoom:[rt,[],i=>i.globals.zoom],"heatmap-density":[rt,[],i=>i.globals.heatmapDensity||0],"line-progress":[rt,[],i=>i.globals.lineProgress||0],accumulated:[Wt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[rt,io(rt),(i,e)=>{let n=0;for(const o of e)n+=o.evaluate(i);return n}],"*":[rt,io(rt),(i,e)=>{let n=1;for(const o of e)n*=o.evaluate(i);return n}],"-":{type:rt,overloads:[[[rt,rt],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[rt],(i,[e])=>-e.evaluate(i)]]},"/":[rt,[rt,rt],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[rt,[rt,rt],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[rt,[],()=>Math.LN2],pi:[rt,[],()=>Math.PI],e:[rt,[],()=>Math.E],"^":[rt,[rt,rt],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[rt,[rt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[rt,[rt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[rt,[rt],(i,[e])=>Math.log(e.evaluate(i))],log2:[rt,[rt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[rt,[rt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[rt,[rt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[rt,[rt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[rt,[rt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[rt,[rt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[rt,[rt],(i,[e])=>Math.atan(e.evaluate(i))],min:[rt,io(rt),(i,e)=>Math.min(...e.map(n=>n.evaluate(i)))],max:[rt,io(rt),(i,e)=>Math.max(...e.map(n=>n.evaluate(i)))],abs:[rt,[rt],(i,[e])=>Math.abs(e.evaluate(i))],round:[rt,[rt],(i,[e])=>{const n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[rt,[rt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[rt,[rt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[Jt,[oi,Wt],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[Jt,[Wt],(i,[e])=>i.id()===e.value],"filter-type-==":[Jt,[oi],(i,[e])=>i.geometryType()===e.value],"filter-<":[Jt,[oi,Wt],(i,[e,n])=>{const o=i.properties()[e.value],c=n.value;return typeof o==typeof c&&o<c}],"filter-id-<":[Jt,[Wt],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n<o}],"filter->":[Jt,[oi,Wt],(i,[e,n])=>{const o=i.properties()[e.value],c=n.value;return typeof o==typeof c&&o>c}],"filter-id->":[Jt,[Wt],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n>o}],"filter-<=":[Jt,[oi,Wt],(i,[e,n])=>{const o=i.properties()[e.value],c=n.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[Jt,[Wt],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n<=o}],"filter->=":[Jt,[oi,Wt],(i,[e,n])=>{const o=i.properties()[e.value],c=n.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[Jt,[Wt],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n>=o}],"filter-has":[Jt,[Wt],(i,[e])=>e.value in i.properties()],"filter-has-id":[Jt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Jt,[Y(oi)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[Jt,[Y(Wt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[Jt,[oi,Y(Wt)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[Jt,[oi,Y(Wt)],(i,[e,n])=>function(o,c,m,g){for(;m<=g;){const b=m+g>>1;if(c[b]===o)return!0;c[b]>o?g=b-1:m=b+1}return!1}(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Jt,overloads:[[[Jt,Jt],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[io(Jt),(i,e)=>{for(const n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:Jt,overloads:[[[Jt,Jt],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[io(Jt),(i,e)=>{for(const n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[Jt,[Jt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[Jt,[oi],(i,[e])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[oi,[oi],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[oi,[oi],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[oi,io(Wt),(i,e)=>e.map(n=>Ei(n.evaluate(i))).join("")],"resolved-locale":[oi,[Vr],(i,[e])=>e.evaluate(i).resolvedLocale()]});class Is{constructor(e,n){var o;this.expression=e,this._warningHistory={},this._evaluator=new v,this._defaultValue=n?(o=n).type==="color"&&cn(o.default)?new Di(0,0,0,0):o.type==="color"?Di.parse(o.default)||null:o.type==="padding"?rr.parse(o.default)||null:o.type==="variableAnchorOffsetCollection"?Un.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,o,c,m,g){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(e,n,o,c,m,g){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new sn(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function no(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in hs}function Ea(i,e){const n=new E(hs,ma,[],e?function(c){const m={color:ir,string:oi,number:rt,enum:oi,boolean:Jt,formatted:K,padding:R,resolvedImage:B,variableAnchorOffsetCollection:Z};return c.type==="array"?Y(m[c.value]||Wt,c.length):m[c.type]}(e):void 0),o=n.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?Ca(new Is(o,e)):xo(n.errors)}class Cs{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!Ss(n.expression)}evaluateWithoutErrorHandling(e,n,o,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,c,m,g)}evaluate(e,n,o,c,m,g){return this._styleExpression.evaluate(e,n,o,c,m,g)}}class Wo{constructor(e,n,o,c){this.kind=e,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Ss(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,n,o,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,c,m,g)}evaluate(e,n,o,c,m,g){return this._styleExpression.evaluate(e,n,o,c,m,g)}interpolationFactor(e,n,o){return this.interpolationType?br.interpolationFactor(this.interpolationType,e,n,o):0}}function ka(i,e){const n=Ea(i,e);if(n.result==="error")return n;const o=n.value.expression,c=qi(o);if(!c&&!qo(e))return xo([new mn("","data expressions not supported")]);const m=_a(o,["zoom"]);if(!m&&!Ts(e))return xo([new mn("","zoom expressions not supported")]);const g=Gs(o);return g||m?g instanceof mn?xo([g]):g instanceof br&&!$a(e)?xo([new mn("",'"interpolate" expressions cannot be used with this property')]):Ca(g?new Wo(c?"camera":"composite",n.value,g.labels,g instanceof br?g.interpolation:void 0):new Cs(c?"constant":"source",n.value)):xo([new mn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Es{constructor(e,n){this._parameters=e,this._specification=n,Er(this,mi(this._parameters,this._specification))}static deserialize(e){return new Es(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Gs(i){let e=null;if(i instanceof va)e=Gs(i.result);else if(i instanceof ya){for(const n of i.args)if(e=Gs(n),e)break}else(i instanceof Ao||i instanceof br)&&i.input instanceof yr&&i.input.name==="zoom"&&(e=i);return e instanceof mn||i.eachChild(n=>{const o=Gs(n);o instanceof mn?e=o:!e&&o?e=new mn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new mn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Ws(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Ws(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const wl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ma(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Ws(i)||(i=Pa(i));const e=Ea(i,wl);if(e.result==="error")throw new Error(e.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,o,c)=>e.value.evaluate(n,o,{},c),needGeometry:ds(i)}}function Aa(i,e){return i<e?-1:i>e?1:0}function ds(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(ds(i[e]))return!0;return!1}function Pa(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?wo(i[1],i[2],"=="):e==="!="?ks(wo(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?wo(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(Pa))):e==="all"?["all"].concat(i.slice(1).map(Pa)):e==="none"?["all"].concat(i.slice(1).map(Pa).map(ks)):e==="in"?Sl(i[1],i.slice(2)):e==="!in"?ks(Sl(i[1],i.slice(2))):e==="has"?Ho(i[1]):e==="!has"?ks(Ho(i[1])):e!=="within"||i;var n}function wo(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function Sl(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Aa)]]:["filter-in-small",i,["literal",e]]}}function Ho(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function ks(i){return["!",i]}function La(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let c="[";for(const m of i)c+=`${La(m)},`;return`${c}]`}const n=Object.keys(i).sort();let o="{";for(let c=0;c<n.length;c++)o+=`${JSON.stringify(n[c])}:${La(i[n[c]])},`;return`${o}}`}function ps(i){let e="";for(const n of tn)e+=`/${La(i[n])}`;return e}function za(i){const e=i.value;return e?[new tt(i.key,e,"constants have been deprecated as of v8")]:[]}function un(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Xo(i){if(Array.isArray(i))return i.map(Xo);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const n in i)e[n]=Xo(i[n]);return e}return un(i)}function hr(i){const e=i.key,n=i.value,o=i.valueSpec||{},c=i.objectElementValidators||{},m=i.style,g=i.styleSpec,b=i.validateSpec;let T=[];const C=ki(n);if(C!=="object")return[new tt(e,n,`object expected, ${C} found`)];for(const P in n){const D=P.split(".")[0],O=o[D]||o["*"];let U;if(c[D])U=c[D];else if(o[D])U=b;else if(c["*"])U=c["*"];else{if(!o["*"]){T.push(new tt(e,n[P],`unknown property "${P}"`));continue}U=b}T=T.concat(U({key:(e&&`${e}.`)+P,value:n[P],valueSpec:O,style:m,styleSpec:g,object:n,objectKey:P,validateSpec:b},n))}for(const P in o)c[P]||o[P].required&&o[P].default===void 0&&n[P]===void 0&&T.push(new tt(e,n,`missing required property "${P}"`));return T}function So(i){const e=i.value,n=i.valueSpec,o=i.style,c=i.styleSpec,m=i.key,g=i.arrayElementValidator||i.validateSpec;if(ki(e)!=="array")return[new tt(m,e,`array expected, ${ki(e)} found`)];if(n.length&&e.length!==n.length)return[new tt(m,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new tt(m,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let b={type:n.value,values:n.values};c.$version<7&&(b.function=n.function),ki(n.value)==="object"&&(b=n.value);let T=[];for(let C=0;C<e.length;C++)T=T.concat(g({array:e,arrayIndex:C,value:e[C],valueSpec:b,validateSpec:i.validateSpec,style:o,styleSpec:c,key:`${m}[${C}]`}));return T}function Ms(i){const e=i.key,n=i.value,o=i.valueSpec;let c=ki(n);return c==="number"&&n!=n&&(c="NaN"),c!=="number"?[new tt(e,n,`number expected, ${c} found`)]:"minimum"in o&&n<o.minimum?[new tt(e,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new tt(e,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function Da(i){const e=i.valueSpec,n=un(i.value.type);let o,c,m,g={};const b=n!=="categorical"&&i.value.property===void 0,T=!b,C=ki(i.value.stops)==="array"&&ki(i.value.stops[0])==="array"&&ki(i.value.stops[0][0])==="object",P=hr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(U){if(n==="identity")return[new tt(U.key,U.value,'identity function may not have a "stops" property')];let j=[];const W=U.value;return j=j.concat(So({key:U.key,value:W,valueSpec:U.valueSpec,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:D})),ki(W)==="array"&&W.length===0&&j.push(new tt(U.key,W,"array must have at least one stop")),j},default:function(U){return U.validateSpec({key:U.key,value:U.value,valueSpec:e,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec})}}});return n==="identity"&&b&&P.push(new tt(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||P.push(new tt(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!$a(i.valueSpec)&&P.push(new tt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(T&&!qo(i.valueSpec)?P.push(new tt(i.key,i.value,"property functions not supported")):b&&!Ts(i.valueSpec)&&P.push(new tt(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!C||i.value.property!==void 0||P.push(new tt(i.key,i.value,'"property" property is required')),P;function D(U){let j=[];const W=U.value,ee=U.key;if(ki(W)!=="array")return[new tt(ee,W,`array expected, ${ki(W)} found`)];if(W.length!==2)return[new tt(ee,W,`array length 2 expected, length ${W.length} found`)];if(C){if(ki(W[0])!=="object")return[new tt(ee,W,`object expected, ${ki(W[0])} found`)];if(W[0].zoom===void 0)return[new tt(ee,W,"object stop key must have zoom")];if(W[0].value===void 0)return[new tt(ee,W,"object stop key must have value")];if(m&&m>un(W[0].zoom))return[new tt(ee,W[0].zoom,"stop zoom values must appear in ascending order")];un(W[0].zoom)!==m&&(m=un(W[0].zoom),c=void 0,g={}),j=j.concat(hr({key:`${ee}[0]`,value:W[0],valueSpec:{zoom:{}},validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:Ms,value:O}}))}else j=j.concat(O({key:`${ee}[0]`,value:W[0],valueSpec:{},validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec},W));return no(Xo(W[1]))?j.concat([new tt(`${ee}[1]`,W[1],"expressions are not allowed in function stops.")]):j.concat(U.validateSpec({key:`${ee}[1]`,value:W[1],valueSpec:e,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec}))}function O(U,j){const W=ki(U.value),ee=un(U.value),re=U.value!==null?U.value:j;if(o){if(W!==o)return[new tt(U.key,re,`${W} stop domain type must match previous stop domain type ${o}`)]}else o=W;if(W!=="number"&&W!=="string"&&W!=="boolean")return[new tt(U.key,re,"stop domain value must be a number, string, or boolean")];if(W!=="number"&&n!=="categorical"){let pe=`number expected, ${W} found`;return qo(e)&&n===void 0&&(pe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new tt(U.key,re,pe)]}return n!=="categorical"||W!=="number"||isFinite(ee)&&Math.floor(ee)===ee?n!=="categorical"&&W==="number"&&c!==void 0&&ee<c?[new tt(U.key,re,"stop domain values must appear in ascending order")]:(c=ee,n==="categorical"&&ee in g?[new tt(U.key,re,"stop domain values must be unique")]:(g[ee]=!0,[])):[new tt(U.key,re,`integer expected, found ${ee}`)]}}function _e(i){const e=(i.expressionContext==="property"?ka:Ea)(Xo(i.value),i.valueSpec);if(e.result==="error")return e.value.map(o=>new tt(`${i.key}${o.key}`,i.value,o.message));const n=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new tt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Ss(n))return[new tt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Ss(n))return[new tt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!_a(n,["zoom","feature-state"]))return[new tt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!qi(n))return[new tt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Me(i){const e=i.key,n=i.value,o=i.valueSpec,c=[];return Array.isArray(o.values)?o.values.indexOf(un(n))===-1&&c.push(new tt(e,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(un(n))===-1&&c.push(new tt(e,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),c}function lt(i){return Ws(Xo(i.value))?_e(Er({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Zt(i)}function Zt(i){const e=i.value,n=i.key;if(ki(e)!=="array")return[new tt(n,e,`array expected, ${ki(e)} found`)];const o=i.styleSpec;let c,m=[];if(e.length<1)return[new tt(n,e,"filter array must have at least 1 element")];switch(m=m.concat(Me({key:`${n}[0]`,value:e[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),un(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&un(e[1])==="$type"&&m.push(new tt(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&m.push(new tt(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=ki(e[1]),c!=="string"&&m.push(new tt(`${n}[1]`,e[1],`string expected, ${c} found`)));for(let g=2;g<e.length;g++)c=ki(e[g]),un(e[1])==="$type"?m=m.concat(Me({key:`${n}[${g}]`,value:e[g],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&m.push(new tt(`${n}[${g}]`,e[g],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)m=m.concat(Zt({key:`${n}[${g}]`,value:e[g],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":c=ki(e[1]),e.length!==2?m.push(new tt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&m.push(new tt(`${n}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=ki(e[1]),e.length!==2?m.push(new tt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&m.push(new tt(`${n}[1]`,e[1],`object expected, ${c} found`))}return m}function en(i,e){const n=i.key,o=i.validateSpec,c=i.style,m=i.styleSpec,g=i.value,b=i.objectKey,T=m[`${e}_${i.layerType}`];if(!T)return[];const C=b.match(/^(.*)-transition$/);if(e==="paint"&&C&&T[C[1]]&&T[C[1]].transition)return o({key:n,value:g,valueSpec:m.transition,style:c,styleSpec:m});const P=i.valueSpec||T[b];if(!P)return[new tt(n,g,`unknown property "${b}"`)];let D;if(ki(g)==="string"&&qo(P)&&!P.tokens&&(D=/^{([^}]+)}$/.exec(g)))return[new tt(n,g,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(D[1])} }\`.`)];const O=[];return i.layerType==="symbol"&&(b==="text-field"&&c&&!c.glyphs&&O.push(new tt(n,g,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&cn(Xo(g))&&un(g.type)==="identity"&&O.push(new tt(n,g,'"text-font" does not support identity functions'))),O.concat(o({key:i.key,value:g,valueSpec:P,style:c,styleSpec:m,expressionContext:"property",propertyType:e,propertyKey:b}))}function Si(i){return en(i,"paint")}function gn(i){return en(i,"layout")}function Tn(i){let e=[];const n=i.value,o=i.key,c=i.style,m=i.styleSpec;n.type||n.ref||e.push(new tt(o,n,'either "type" or "ref" is required'));let g=un(n.type);const b=un(n.ref);if(n.id){const T=un(n.id);for(let C=0;C<i.arrayIndex;C++){const P=c.layers[C];un(P.id)===T&&e.push(new tt(o,n.id,`duplicate layer id "${n.id}", previously used at line ${P.id.__line__}`))}}if("ref"in n){let T;["type","source","source-layer","filter","layout"].forEach(C=>{C in n&&e.push(new tt(o,n[C],`"${C}" is prohibited for ref layers`))}),c.layers.forEach(C=>{un(C.id)===b&&(T=C)}),T?T.ref?e.push(new tt(o,n.ref,"ref cannot reference another ref layer")):g=un(T.type):e.push(new tt(o,n.ref,`ref layer "${b}" not found`))}else if(g!=="background")if(n.source){const T=c.sources&&c.sources[n.source],C=T&&un(T.type);T?C==="vector"&&g==="raster"?e.push(new tt(o,n.source,`layer "${n.id}" requires a raster source`)):C!=="raster-dem"&&g==="hillshade"?e.push(new tt(o,n.source,`layer "${n.id}" requires a raster-dem source`)):C==="raster"&&g!=="raster"?e.push(new tt(o,n.source,`layer "${n.id}" requires a vector source`)):C!=="vector"||n["source-layer"]?C==="raster-dem"&&g!=="hillshade"?e.push(new tt(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!n.paint||!n.paint["line-gradient"]||C==="geojson"&&T.lineMetrics||e.push(new tt(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new tt(o,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new tt(o,n.source,`source "${n.source}" not found`))}else e.push(new tt(o,n,'missing required property "source"'));return e=e.concat(hr({key:o,value:n,valueSpec:m.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${o}.type`,value:n.type,valueSpec:m.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:n,objectKey:"type"}),filter:lt,layout:T=>hr({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":C=>gn(Er({layerType:g},C))}}),paint:T=>hr({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":C=>Si(Er({layerType:g},C))}})}})),e}function En(i){const e=i.value,n=i.key,o=ki(e);return o!=="string"?[new tt(n,e,`string expected, ${o} found`)]:[]}const yn={promoteId:function({key:i,value:e}){if(ki(e)==="string")return En({key:i,value:e});{const n=[];for(const o in e)n.push(...En({key:`${i}.${o}`,value:e[o]}));return n}}};function Oi(i){const e=i.value,n=i.key,o=i.styleSpec,c=i.style,m=i.validateSpec;if(!e.type)return[new tt(n,e,'"type" is required')];const g=un(e.type);let b;switch(g){case"vector":case"raster":return b=hr({key:n,value:e,valueSpec:o[`source_${g.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:yn,validateSpec:m}),b;case"raster-dem":return b=function(T){var C;const P=(C=T.sourceName)!==null&&C!==void 0?C:"",D=T.value,O=T.styleSpec,U=O.source_raster_dem,j=T.style;let W=[];const ee=ki(D);if(D===void 0)return W;if(ee!=="object")return W.push(new tt("source_raster_dem",D,`object expected, ${ee} found`)),W;const re=un(D.encoding)==="custom",pe=["redFactor","greenFactor","blueFactor","baseShift"],oe=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const ve in D)!re&&pe.includes(ve)?W.push(new tt(ve,D[ve],`In "${P}": "${ve}" is only valid when "encoding" is set to "custom". ${oe} encoding found`)):U[ve]?W=W.concat(T.validateSpec({key:ve,value:D[ve],valueSpec:U[ve],validateSpec:T.validateSpec,style:j,styleSpec:O})):W.push(new tt(ve,D[ve],`unknown property "${ve}"`));return W}({sourceName:n,value:e,style:i.style,styleSpec:o,validateSpec:m}),b;case"geojson":if(b=hr({key:n,value:e,valueSpec:o.source_geojson,style:c,styleSpec:o,validateSpec:m,objectElementValidators:yn}),e.cluster)for(const T in e.clusterProperties){const[C,P]=e.clusterProperties[T],D=typeof C=="string"?[C,["accumulated"],["get",T]]:C;b.push(..._e({key:`${n}.${T}.map`,value:P,validateSpec:m,expressionContext:"cluster-map"})),b.push(..._e({key:`${n}.${T}.reduce`,value:D,validateSpec:m,expressionContext:"cluster-reduce"}))}return b;case"video":return hr({key:n,value:e,valueSpec:o.source_video,style:c,validateSpec:m,styleSpec:o});case"image":return hr({key:n,value:e,valueSpec:o.source_image,style:c,validateSpec:m,styleSpec:o});case"canvas":return[new tt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Me({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,validateSpec:m,styleSpec:o})}}function xr(i){const e=i.value,n=i.styleSpec,o=n.light,c=i.style;let m=[];const g=ki(e);if(e===void 0)return m;if(g!=="object")return m=m.concat([new tt("light",e,`object expected, ${g} found`)]),m;for(const b in e){const T=b.match(/^(.*)-transition$/);m=m.concat(T&&o[T[1]]&&o[T[1]].transition?i.validateSpec({key:b,value:e[b],valueSpec:n.transition,validateSpec:i.validateSpec,style:c,styleSpec:n}):o[b]?i.validateSpec({key:b,value:e[b],valueSpec:o[b],validateSpec:i.validateSpec,style:c,styleSpec:n}):[new tt(b,e[b],`unknown property "${b}"`)])}return m}function To(i){const e=i.value,n=i.styleSpec,o=n.terrain,c=i.style;let m=[];const g=ki(e);if(e===void 0)return m;if(g!=="object")return m=m.concat([new tt("terrain",e,`object expected, ${g} found`)]),m;for(const b in e)m=m.concat(o[b]?i.validateSpec({key:b,value:e[b],valueSpec:o[b],validateSpec:i.validateSpec,style:c,styleSpec:n}):[new tt(b,e[b],`unknown property "${b}"`)]);return m}function or(i){let e=[];const n=i.value,o=i.key;if(Array.isArray(n)){const c=[],m=[];for(const g in n)n[g].id&&c.includes(n[g].id)&&e.push(new tt(o,n,`all the sprites' ids must be unique, but ${n[g].id} is duplicated`)),c.push(n[g].id),n[g].url&&m.includes(n[g].url)&&e.push(new tt(o,n,`all the sprites' URLs must be unique, but ${n[g].url} is duplicated`)),m.push(n[g].url),e=e.concat(hr({key:`${o}[${g}]`,value:n[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return En({key:o,value:n})}const Io={"*":()=>[],array:So,boolean:function(i){const e=i.value,n=i.key,o=ki(e);return o!=="boolean"?[new tt(n,e,`boolean expected, ${o} found`)]:[]},number:Ms,color:function(i){const e=i.key,n=i.value,o=ki(n);return o!=="string"?[new tt(e,n,`color expected, ${o} found`)]:Di.parse(String(n))?[]:[new tt(e,n,`color expected, "${n}" found`)]},constants:za,enum:Me,filter:lt,function:Da,layer:Tn,object:hr,source:Oi,light:xr,terrain:To,string:En,formatted:function(i){return En(i).length===0?[]:_e(i)},resolvedImage:function(i){return En(i).length===0?[]:_e(i)},padding:function(i){const e=i.key,n=i.value;if(ki(n)==="array"){if(n.length<1||n.length>4)return[new tt(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let c=[];for(let m=0;m<n.length;m++)c=c.concat(i.validateSpec({key:`${e}[${m}]`,value:n[m],validateSpec:i.validateSpec,valueSpec:o}));return c}return Ms({key:e,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const e=i.key,n=i.value,o=ki(n),c=i.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new tt(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let m=[];for(let g=0;g<n.length;g+=2)m=m.concat(Me({key:`${e}[${g}]`,value:n[g],valueSpec:c.layout_symbol["text-anchor"]})),m=m.concat(So({key:`${e}[${g+1}]`,value:n[g+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:c}));return m},sprite:or};function wr(i){const e=i.value,n=i.valueSpec,o=i.styleSpec;return i.validateSpec=wr,n.expression&&cn(un(e))?Da(i):n.expression&&no(Xo(e))?_e(i):n.type&&Io[n.type]?Io[n.type](i):hr(Er({},i,{valueSpec:n.type?o[n.type]:n}))}function Hs(i){const e=i.value,n=i.key,o=En(i);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new tt(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new tt(n,e,'"glyphs" url must include a "{range}" token'))),o}function Gn(i,e=ke){let n=[];return n=n.concat(wr({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:wr,objectElementValidators:{glyphs:Hs,"*":()=>[]}})),i.constants&&(n=n.concat(za({key:"constants",value:i.constants,style:i,styleSpec:e,validateSpec:wr}))),Xs(n)}function Ar(i){return function(e){return i({...e,validateSpec:wr})}}function Xs(i){return[].concat(i).sort((e,n)=>e.line-n.line)}function Lo(i){return function(...e){return Xs(i.apply(this,e))}}Gn.source=Lo(Ar(Oi)),Gn.sprite=Lo(Ar(or)),Gn.glyphs=Lo(Ar(Hs)),Gn.light=Lo(Ar(xr)),Gn.terrain=Lo(Ar(To)),Gn.layer=Lo(Ar(Tn)),Gn.filter=Lo(Ar(lt)),Gn.paintProperty=Lo(Ar(Si)),Gn.layoutProperty=Lo(Ar(gn));const zo=Gn,Ki=zo.light,Bi=zo.paintProperty,Ks=zo.layoutProperty;function ro(i,e){let n=!1;if(e&&e.length)for(const o of e)i.fire(new Dn(new Error(o.message))),n=!0;return n}class Ko{constructor(e,n,o){const c=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const g=new Int32Array(this.arrayBuffer);e=g[0],this.d=(n=g[1])+2*(o=g[2]);for(let T=0;T<this.d*this.d;T++){const C=g[3+T],P=g[3+T+1];c.push(C===P?null:g.subarray(C,P))}const b=g[3+c.length+1];this.keys=g.subarray(g[3+c.length],b),this.bboxes=g.subarray(b),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let g=0;g<this.d*this.d;g++)c.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=e,this.padding=o,this.scale=n/e,this.uid=0;const m=o/n*e;this.min=-m,this.max=e+m}insert(e,n,o,c,m){this._forEachCell(n,o,c,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,n,o,c,m,g){this.cells[m].push(g)}query(e,n,o,c,m){const g=this.min,b=this.max;if(e<=g&&n<=g&&b<=o&&b<=c&&!m)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(e,n,o,c,this._queryCell,T,{},m),T}}_queryCell(e,n,o,c,m,g,b,T){const C=this.cells[m];if(C!==null){const P=this.keys,D=this.bboxes;for(let O=0;O<C.length;O++){const U=C[O];if(b[U]===void 0){const j=4*U;(T?T(D[j+0],D[j+1],D[j+2],D[j+3]):e<=D[j+2]&&n<=D[j+3]&&o>=D[j+0]&&c>=D[j+1])?(b[U]=!0,g.push(P[U])):b[U]=!1}}}}_forEachCell(e,n,o,c,m,g,b,T){const C=this._convertToCellCoord(e),P=this._convertToCellCoord(n),D=this._convertToCellCoord(o),O=this._convertToCellCoord(c);for(let U=C;U<=D;U++)for(let j=P;j<=O;j++){const W=this.d*j+U;if((!T||T(this._convertFromCellCoord(U),this._convertFromCellCoord(j),this._convertFromCellCoord(U+1),this._convertFromCellCoord(j+1)))&&m.call(this,e,n,o,c,W,g,b,T))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,n=3+this.cells.length+1+1;let o=0;for(let g=0;g<this.cells.length;g++)o+=this.cells[g].length;const c=new Int32Array(n+o+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let m=n;for(let g=0;g<e.length;g++){const b=e[g];c[3+g]=m,c.set(b,m),m+=b.length}return c[3+e.length]=m,c.set(this.keys,m),m+=this.keys.length,c[3+e.length+1]=m,c.set(this.bboxes,m),m+=this.bboxes.length,c.buffer}static serialize(e,n){const o=e.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(e){return new Ko(e.buffer)}}const kn={};function ht(i,e,n={}){if(kn[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),kn[i]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}ht("Object",Object),ht("TransferableGridIndex",Ko),ht("Color",Di),ht("Error",Error),ht("AJAXError",it),ht("ResolvedImage",jn),ht("StylePropertyFunction",Es),ht("StyleExpression",Is,{omit:["_evaluator"]}),ht("ZoomDependentExpression",Wo),ht("ZoomConstantExpression",Cs),ht("CompoundExpression",yr,{omit:["_evaluate"]});for(const i in hs)hs[i]._classRegistryKey||ht(`Expression_${i}`,hs[i]);function oo(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function qr(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(oo(i)||Ln(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const n=i;return e&&e.push(n.buffer),n}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const n=[];for(const o of i)n.push(qr(o,e));return n}if(typeof i=="object"){const n=i.constructor,o=n._classRegistryKey;if(!o)throw new Error("can't serialize object of unregistered class");if(!kn[o])throw new Error(`${o} is not registered.`);const c=n.serialize?n.serialize(i,e):{};if(n.serialize){if(e&&c===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in i){if(!i.hasOwnProperty(m)||kn[o].omit.indexOf(m)>=0)continue;const g=i[m];c[m]=kn[o].shallow.indexOf(m)>=0?g:qr(g,e)}i instanceof Error&&(c.message=i.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(c.$name=o),c}throw new Error("can't serialize object of type "+typeof i)}function Do(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||oo(i)||Ln(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Do);if(typeof i=="object"){const e=i.$name||"Object";if(!kn[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=kn[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(i);const o=Object.create(n.prototype);for(const c of Object.keys(i)){if(c==="$name")continue;const m=i[c];o[c]=kn[e].shallow.indexOf(c)>=0?m:Do(m)}return o}throw new Error("can't deserialize object of type "+typeof i)}class fs{constructor(){this.first=!0}update(e,n){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const ot={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Fa(i){for(const e of i)if(Ps(e.charCodeAt(0)))return!0;return!1}function As(i){for(const e of i)if(!el(e.charCodeAt(0)))return!1;return!0}function el(i){return!(ot.Arabic(i)||ot["Arabic Supplement"](i)||ot["Arabic Extended-A"](i)||ot["Arabic Presentation Forms-A"](i)||ot["Arabic Presentation Forms-B"](i))}function Ps(i){return!(i!==746&&i!==747&&(i<4352||!(ot["Bopomofo Extended"](i)||ot.Bopomofo(i)||ot["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||ot["CJK Compatibility Ideographs"](i)||ot["CJK Compatibility"](i)||ot["CJK Radicals Supplement"](i)||ot["CJK Strokes"](i)||!(!ot["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||ot["CJK Unified Ideographs Extension A"](i)||ot["CJK Unified Ideographs"](i)||ot["Enclosed CJK Letters and Months"](i)||ot["Hangul Compatibility Jamo"](i)||ot["Hangul Jamo Extended-A"](i)||ot["Hangul Jamo Extended-B"](i)||ot["Hangul Jamo"](i)||ot["Hangul Syllables"](i)||ot.Hiragana(i)||ot["Ideographic Description Characters"](i)||ot.Kanbun(i)||ot["Kangxi Radicals"](i)||ot["Katakana Phonetic Extensions"](i)||ot.Katakana(i)&&i!==12540||!(!ot["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!ot["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||ot["Unified Canadian Aboriginal Syllabics"](i)||ot["Unified Canadian Aboriginal Syllabics Extended"](i)||ot["Vertical Forms"](i)||ot["Yijing Hexagram Symbols"](i)||ot["Yi Syllables"](i)||ot["Yi Radicals"](i))))}function Js(i){return!(Ps(i)||function(e){return!!(ot["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ot["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ot["Letterlike Symbols"](e)||ot["Number Forms"](e)||ot["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ot["Control Pictures"](e)&&e!==9251||ot["Optical Character Recognition"](e)||ot["Enclosed Alphanumerics"](e)||ot["Geometric Shapes"](e)||ot["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ot["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ot["CJK Symbols and Punctuation"](e)||ot.Katakana(e)||ot["Private Use Area"](e)||ot["CJK Compatibility Forms"](e)||ot["Small Form Variants"](e)||ot["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function tl(i){return i>=1424&&i<=2303||ot["Arabic Presentation Forms-A"](i)||ot["Arabic Presentation Forms-B"](i)}function Ys(i,e){return!(!e&&tl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||ot.Khmer(i))}function Ra(i){for(const e of i)if(tl(e.charCodeAt(0)))return!0;return!1}const Kl="deferred",Jl="loading",Yl="loaded";let Ql=null,Zr="unavailable",Ls=null;const il=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Zr="error"),Ql&&Ql(i)};function $l(){nl.fire(new _r("pluginStateChange",{pluginStatus:Zr,pluginURL:Ls}))}const nl=new yo,ec=function(){return Zr},Kc=function(){if(Zr!==Kl||!Ls)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Zr=Jl,$l(),Ls&&Ze({url:Ls},i=>{i?il(i):(Zr=Yl,$l())})},so={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Zr===Yl||so.applyArabicShaping!=null,isLoading:()=>Zr===Jl,setState(i){if(!Lt())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Zr=i.pluginStatus,Ls=i.pluginURL},isParsed(){if(!Lt())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return so.applyArabicShaping!=null&&so.processBidirectionalText!=null&&so.processStyledBidirectionalText!=null},getPluginURL(){if(!Lt())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Ls}};class hn{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new fs,this.transition={})}isSupportedScript(e){return function(n,o){for(const c of n)if(!Ys(c.charCodeAt(0),o))return!1;return!0}(e,so.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class Tl{constructor(e,n){this.property=e,this.value=n,this.expression=function(o,c){if(cn(o))return new Es(o,c);if(no(o)){const m=ka(o,c);if(m.result==="error")throw new Error(m.value.map(g=>`${g.key}: ${g.message}`).join(", "));return m.value}{let m=o;return c.type==="color"&&typeof o=="string"?m=Di.parse(o):c.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(o)&&(m=Un.parse(o)):m=rr.parse(o),{kind:"constant",evaluate:()=>m}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,o){return this.property.possiblyEvaluate(this,e,n,o)}}class tc{constructor(e){this.property=e,this.value=new Tl(e,void 0)}transitioned(e,n){return new Yc(this.property,this.value,n,zt({},e.transition,this.transition),e.now)}untransitioned(){return new Yc(this.property,this.value,null,{},0)}}class Jc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Je(this._values[e].value.value)}setValue(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new tc(this._values[e].property)),this._values[e].value=new Tl(this._values[e].property,n===null?void 0:Je(n))}getTransition(e){return Je(this._values[e].transition)}setTransition(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new tc(this._values[e].property)),this._values[e].transition=Je(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o);const c=this.getTransition(n);c!==void 0&&(e[`${n}-transition`]=c)}return e}transitioned(e,n){const o=new Qc(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(e,n._values[c]);return o}untransitioned(){const e=new Qc(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Yc{constructor(e,n,o,c,m){this.property=e,this.value=n,this.begin=m+c.delay||0,this.end=this.begin+c.duration||0,e.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(e,n,o){const c=e.now||0,m=this.value.possiblyEvaluate(e,n,o),g=this.prior;if(g){if(c>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(c<this.begin)return g.possiblyEvaluate(e,n,o);{const b=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,n,o),m,function(T){if(T<=0)return 0;if(T>=1)return 1;const C=T*T,P=C*T;return 4*(T<.5?P:3*(T-C)+P-.75)}(b))}}return m}}class Qc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,o){const c=new Il(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(e,n,o);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ou{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Je(this._values[e].value)}setValue(e,n){this._values[e]=new Tl(this._values[e].property,n===null?void 0:Je(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o)}return e}possiblyEvaluate(e,n,o){const c=new Il(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(e,n,o);return c}}class Pr{constructor(e,n,o){this.property=e,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,o,c){return this.property.evaluate(this.value,this.parameters,e,n,o,c)}}class Il{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ft{constructor(e){this.specification=e}possiblyEvaluate(e,n){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(n)}interpolate(e,n,o){const c=ur[this.specification.type];return c?c(e,n,o):e}}class Ht{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,o,c){return new Pr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},o,c)}:e.expression,n)}interpolate(e,n,o){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Pr(this,{kind:"constant",value:void 0},e.parameters);const c=ur[this.specification.type];if(c){const m=c(e.value.value,n.value.value,o);return new Pr(this,{kind:"constant",value:m},e.parameters)}return e}evaluate(e,n,o,c,m,g){return e.kind==="constant"?e.value:e.evaluate(n,o,c,m,g)}}class rl extends Ht{possiblyEvaluate(e,n,o,c){if(e.value===void 0)return new Pr(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const m=e.expression.evaluate(n,null,{},o,c),g=e.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,b=this._calculate(g,g,g,n);return new Pr(this,{kind:"constant",value:b},n)}if(e.expression.kind==="camera"){const m=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new Pr(this,{kind:"constant",value:m},n)}return new Pr(this,e.expression,n)}evaluate(e,n,o,c,m,g){if(e.kind==="source"){const b=e.evaluate(n,o,c,m,g);return this._calculate(b,b,b,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},o,c),e.evaluate({zoom:Math.floor(n.zoom)},o,c),e.evaluate({zoom:Math.floor(n.zoom)+1},o,c),n):e.value}_calculate(e,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:o,to:n}}interpolate(e){return e}}class ic{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const m=e.expression.evaluate(n,null,{},o,c);return this._calculate(m,m,m,n)}return this._calculate(e.expression.evaluate(new hn(Math.floor(n.zoom-1),n)),e.expression.evaluate(new hn(Math.floor(n.zoom),n)),e.expression.evaluate(new hn(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:o,to:n}}interpolate(e){return e}}class nc{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,c){return!!e.expression.evaluate(n,null,{},o,c)}interpolate(){return!1}}class On{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const o=e[n];o.specification.overridable&&this.overridableProperties.push(n);const c=this.defaultPropertyValues[n]=new Tl(o,void 0),m=this.defaultTransitionablePropertyValues[n]=new tc(o);this.defaultTransitioningPropertyValues[n]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=c.possiblyEvaluate({})}}}ht("DataDrivenProperty",Ht),ht("DataConstantProperty",Ft),ht("CrossFadedDataDrivenProperty",rl),ht("CrossFadedProperty",ic),ht("ColorRampProperty",nc);const rc="-transition";class Co extends yo{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new Ou(n.layout)),n.paint)){this._transitionablePaint=new Jc(n.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Il(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,o={}){n!=null&&this._validate(Ks,`layers.${this.id}.layout.${e}`,e,n,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return e.endsWith(rc)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,o={}){if(n!=null&&this._validate(Bi,`layers.${this.id}.paint.${e}`,e,n,o))return!1;if(e.endsWith(rc))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const c=this._transitionablePaint._values[e],m=c.property.specification["property-type"]==="cross-faded-data-driven",g=c.value.isDataDriven(),b=c.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const T=this._transitionablePaint._values[e].value;return T.isDataDriven()||g||m||this._handleOverridablePaintPropertyUpdate(e,b,T)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,n,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),De(e,(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(e,n,o,c,m={}){return(!m||m.validate!==!1)&&ro(this,e.call(zo,{key:n,layerType:this.type,objectKey:o,value:c,styleSpec:ke,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Pr&&qo(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const $c={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Qs{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class In{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function xn(i,e=1){let n=0,o=0;return{members:i.map(c=>{const m=$c[c.type].BYTES_PER_ELEMENT,g=n=Oa(n,Math.max(e,m)),b=c.components||1;return o=Math.max(o,m),n+=m*b,{name:c.name,type:c.type,components:b,offset:g}}),size:Oa(n,Math.max(o,e)),alignment:e}}function Oa(i,e){return Math.ceil(i/e)*e}class ol extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.int16[c+0]=n,this.int16[c+1]=o,e}}ol.prototype.bytesPerElement=4,ht("StructArrayLayout2i4",ol);class sl extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const m=3*e;return this.int16[m+0]=n,this.int16[m+1]=o,this.int16[m+2]=c,e}}sl.prototype.bytesPerElement=6,ht("StructArrayLayout3i6",sl);class $s extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,o,c)}emplace(e,n,o,c,m){const g=4*e;return this.int16[g+0]=n,this.int16[g+1]=o,this.int16[g+2]=c,this.int16[g+3]=m,e}}$s.prototype.bytesPerElement=8,ht("StructArrayLayout4i8",$s);class oc extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,o,c,m,g)}emplace(e,n,o,c,m,g,b){const T=6*e;return this.int16[T+0]=n,this.int16[T+1]=o,this.int16[T+2]=c,this.int16[T+3]=m,this.int16[T+4]=g,this.int16[T+5]=b,e}}oc.prototype.bytesPerElement=12,ht("StructArrayLayout2i4i12",oc);class sc extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,o,c,m,g)}emplace(e,n,o,c,m,g,b){const T=4*e,C=8*e;return this.int16[T+0]=n,this.int16[T+1]=o,this.uint8[C+4]=c,this.uint8[C+5]=m,this.uint8[C+6]=g,this.uint8[C+7]=b,e}}sc.prototype.bytesPerElement=8,ht("StructArrayLayout2i4ub8",sc);class Ba extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.float32[c+0]=n,this.float32[c+1]=o,e}}Ba.prototype.bytesPerElement=8,ht("StructArrayLayout2f8",Ba);class ac extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m,g,b,T,C,P){const D=this.length;return this.resize(D+1),this.emplace(D,e,n,o,c,m,g,b,T,C,P)}emplace(e,n,o,c,m,g,b,T,C,P,D){const O=10*e;return this.uint16[O+0]=n,this.uint16[O+1]=o,this.uint16[O+2]=c,this.uint16[O+3]=m,this.uint16[O+4]=g,this.uint16[O+5]=b,this.uint16[O+6]=T,this.uint16[O+7]=C,this.uint16[O+8]=P,this.uint16[O+9]=D,e}}ac.prototype.bytesPerElement=20,ht("StructArrayLayout10ui20",ac);class lc extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m,g,b,T,C,P,D,O){const U=this.length;return this.resize(U+1),this.emplace(U,e,n,o,c,m,g,b,T,C,P,D,O)}emplace(e,n,o,c,m,g,b,T,C,P,D,O,U){const j=12*e;return this.int16[j+0]=n,this.int16[j+1]=o,this.int16[j+2]=c,this.int16[j+3]=m,this.uint16[j+4]=g,this.uint16[j+5]=b,this.uint16[j+6]=T,this.uint16[j+7]=C,this.int16[j+8]=P,this.int16[j+9]=D,this.int16[j+10]=O,this.int16[j+11]=U,e}}lc.prototype.bytesPerElement=24,ht("StructArrayLayout4i4ui4i24",lc);class Ni extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const m=3*e;return this.float32[m+0]=n,this.float32[m+1]=o,this.float32[m+2]=c,e}}Ni.prototype.bytesPerElement=12,ht("StructArrayLayout3f12",Ni);class p extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}p.prototype.bytesPerElement=4,ht("StructArrayLayout1ul4",p);class t extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m,g,b,T,C){const P=this.length;return this.resize(P+1),this.emplace(P,e,n,o,c,m,g,b,T,C)}emplace(e,n,o,c,m,g,b,T,C,P){const D=10*e,O=5*e;return this.int16[D+0]=n,this.int16[D+1]=o,this.int16[D+2]=c,this.int16[D+3]=m,this.int16[D+4]=g,this.int16[D+5]=b,this.uint32[O+3]=T,this.uint16[D+8]=C,this.uint16[D+9]=P,e}}t.prototype.bytesPerElement=20,ht("StructArrayLayout6i1ul2ui20",t);class r extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,o,c,m,g)}emplace(e,n,o,c,m,g,b){const T=6*e;return this.int16[T+0]=n,this.int16[T+1]=o,this.int16[T+2]=c,this.int16[T+3]=m,this.int16[T+4]=g,this.int16[T+5]=b,e}}r.prototype.bytesPerElement=12,ht("StructArrayLayout2i2i2i12",r);class l extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,o,c,m)}emplace(e,n,o,c,m,g){const b=4*e,T=8*e;return this.float32[b+0]=n,this.float32[b+1]=o,this.float32[b+2]=c,this.int16[T+6]=m,this.int16[T+7]=g,e}}l.prototype.bytesPerElement=16,ht("StructArrayLayout2f1f2i16",l);class u extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,o,c)}emplace(e,n,o,c,m){const g=12*e,b=3*e;return this.uint8[g+0]=n,this.uint8[g+1]=o,this.float32[b+1]=c,this.float32[b+2]=m,e}}u.prototype.bytesPerElement=12,ht("StructArrayLayout2ub2f12",u);class _ extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const m=3*e;return this.uint16[m+0]=n,this.uint16[m+1]=o,this.uint16[m+2]=c,e}}_.prototype.bytesPerElement=6,ht("StructArrayLayout3ui6",_);class x extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m,g,b,T,C,P,D,O,U,j,W,ee,re){const pe=this.length;return this.resize(pe+1),this.emplace(pe,e,n,o,c,m,g,b,T,C,P,D,O,U,j,W,ee,re)}emplace(e,n,o,c,m,g,b,T,C,P,D,O,U,j,W,ee,re,pe){const oe=24*e,ve=12*e,Se=48*e;return this.int16[oe+0]=n,this.int16[oe+1]=o,this.uint16[oe+2]=c,this.uint16[oe+3]=m,this.uint32[ve+2]=g,this.uint32[ve+3]=b,this.uint32[ve+4]=T,this.uint16[oe+10]=C,this.uint16[oe+11]=P,this.uint16[oe+12]=D,this.float32[ve+7]=O,this.float32[ve+8]=U,this.uint8[Se+36]=j,this.uint8[Se+37]=W,this.uint8[Se+38]=ee,this.uint32[ve+10]=re,this.int16[oe+22]=pe,e}}x.prototype.bytesPerElement=48,ht("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",x);class w extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,m,g,b,T,C,P,D,O,U,j,W,ee,re,pe,oe,ve,Se,Be,_t,Ct,mt,ut,nt,xt){const st=this.length;return this.resize(st+1),this.emplace(st,e,n,o,c,m,g,b,T,C,P,D,O,U,j,W,ee,re,pe,oe,ve,Se,Be,_t,Ct,mt,ut,nt,xt)}emplace(e,n,o,c,m,g,b,T,C,P,D,O,U,j,W,ee,re,pe,oe,ve,Se,Be,_t,Ct,mt,ut,nt,xt,st){const He=32*e,qt=16*e;return this.int16[He+0]=n,this.int16[He+1]=o,this.int16[He+2]=c,this.int16[He+3]=m,this.int16[He+4]=g,this.int16[He+5]=b,this.int16[He+6]=T,this.int16[He+7]=C,this.uint16[He+8]=P,this.uint16[He+9]=D,this.uint16[He+10]=O,this.uint16[He+11]=U,this.uint16[He+12]=j,this.uint16[He+13]=W,this.uint16[He+14]=ee,this.uint16[He+15]=re,this.uint16[He+16]=pe,this.uint16[He+17]=oe,this.uint16[He+18]=ve,this.uint16[He+19]=Se,this.uint16[He+20]=Be,this.uint16[He+21]=_t,this.uint16[He+22]=Ct,this.uint32[qt+12]=mt,this.float32[qt+13]=ut,this.float32[qt+14]=nt,this.uint16[He+30]=xt,this.uint16[He+31]=st,e}}w.prototype.bytesPerElement=64,ht("StructArrayLayout8i15ui1ul2f2ui64",w);class I extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}I.prototype.bytesPerElement=4,ht("StructArrayLayout1f4",I);class A extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const m=3*e;return this.uint16[6*e+0]=n,this.float32[m+1]=o,this.float32[m+2]=c,e}}A.prototype.bytesPerElement=12,ht("StructArrayLayout1ui2f12",A);class L extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const m=4*e;return this.uint32[2*e+0]=n,this.uint16[m+2]=o,this.uint16[m+3]=c,e}}L.prototype.bytesPerElement=8,ht("StructArrayLayout1ul2ui8",L);class z extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.uint16[c+0]=n,this.uint16[c+1]=o,e}}z.prototype.bytesPerElement=4,ht("StructArrayLayout2ui4",z);class N extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}N.prototype.bytesPerElement=2,ht("StructArrayLayout1ui2",N);class X extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,o,c)}emplace(e,n,o,c,m){const g=4*e;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=c,this.float32[g+3]=m,e}}X.prototype.bytesPerElement=16,ht("StructArrayLayout4f16",X);class H extends Qs{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new he(this.anchorPointX,this.anchorPointY)}}H.prototype.size=20;class J extends t{get(e){return new H(this,e)}}ht("CollisionBoxArray",J);class G extends Qs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}G.prototype.size=48;class ue extends x{get(e){return new G(this,e)}}ht("PlacedSymbolArray",ue);class we extends Qs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}we.prototype.size=64;class te extends w{get(e){return new we(this,e)}}ht("SymbolInstanceArray",te);class de extends I{getoffsetX(e){return this.float32[1*e+0]}}ht("GlyphOffsetArray",de);class Ie extends sl{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}ht("SymbolLineVertexArray",Ie);class Ce extends Qs{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Ce.prototype.size=12;class Oe extends A{get(e){return new Ce(this,e)}}ht("TextAnchorOffsetArray",Oe);class We extends Qs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}We.prototype.size=8;class Ue extends L{get(e){return new We(this,e)}}ht("FeatureIndexArray",Ue);class et extends ol{}class It extends ol{}class _i extends ol{}class ct extends oc{}class Xt extends sc{}class Mt extends Ba{}class Zi extends ac{}class pi extends lc{}class li extends Ni{}class gi extends p{}class Mn extends r{}class rn extends u{}class dr extends _{}class Wn extends z{}const Bn=xn([{name:"a_pos",components:2,type:"Int16"}],4),{members:ao}=Bn;class dn{constructor(e=[]){this.segments=e}prepareSegment(e,n,o,c){let m=this.segments[this.segments.length-1];return e>dn.MAX_VERTEX_ARRAY_LENGTH&&$e(`Max vertices per segment is ${dn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>dn.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==c)&&(m={vertexOffset:n.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},c!==void 0&&(m.sortKey=c),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,o,c){return new dn([{vertexOffset:e,primitiveOffset:n,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}function Jo(i,e){return 256*(i=vt(Math.floor(i),0,255))+vt(Math.floor(e),0,255)}dn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ht("SegmentVector",dn);const Yo=xn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var zs={exports:{}},ea={exports:{}};ea.exports=function(i,e){var n,o,c,m,g,b,T,C;for(o=i.length-(n=3&i.length),c=e,g=3432918353,b=461845907,C=0;C<o;)T=255&i.charCodeAt(C)|(255&i.charCodeAt(++C))<<8|(255&i.charCodeAt(++C))<<16|(255&i.charCodeAt(++C))<<24,++C,c=27492+(65535&(m=5*(65535&(c=(c^=T=(65535&(T=(T=(65535&T)*g+(((T>>>16)*g&65535)<<16)&4294967295)<<15|T>>>17))*b+(((T>>>16)*b&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(T=0,n){case 3:T^=(255&i.charCodeAt(C+2))<<16;case 2:T^=(255&i.charCodeAt(C+1))<<8;case 1:c^=T=(65535&(T=(T=(65535&(T^=255&i.charCodeAt(C)))*g+(((T>>>16)*g&65535)<<16)&4294967295)<<15|T>>>17))*b+(((T>>>16)*b&65535)<<16)&4294967295}return c^=i.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var Na=ea.exports,Sr={exports:{}};Sr.exports=function(i,e){for(var n,o=i.length,c=e^o,m=0;o>=4;)n=1540483477*(65535&(n=255&i.charCodeAt(m)|(255&i.charCodeAt(++m))<<8|(255&i.charCodeAt(++m))<<16|(255&i.charCodeAt(++m))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),o-=4,++m;switch(o){case 3:c^=(255&i.charCodeAt(m+2))<<16;case 2:c^=(255&i.charCodeAt(m+1))<<8;case 1:c=1540483477*(65535&(c^=255&i.charCodeAt(m)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var pr=Na,Lr=Sr.exports;zs.exports=pr,zs.exports.murmur3=pr,zs.exports.murmur2=Lr;var ta=M(zs.exports);class An{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,o,c){this.ids.push(Hn(e)),this.positions.push(n,o,c)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=Hn(e);let o=0,c=this.ids.length-1;for(;o<c;){const g=o+c>>1;this.ids[g]>=n?c=g:o=g+1}const m=[];for(;this.ids[o]===n;)m.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return m}static serialize(e,n){const o=new Float64Array(e.ids),c=new Uint32Array(e.positions);return Gr(o,c,0,o.length-1),n&&n.push(o.buffer,c.buffer),{ids:o,positions:c}}static deserialize(e){const n=new An;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function Hn(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:ta(String(i))}function Gr(i,e,n,o){for(;n<o;){const c=i[n+o>>1];let m=n-1,g=o+1;for(;;){do m++;while(i[m]<c);do g--;while(i[g]>c);if(m>=g)break;Pn(i,m,g),Pn(e,3*m,3*g),Pn(e,3*m+1,3*g+1),Pn(e,3*m+2,3*g+2)}g-n<o-g?(Gr(i,e,n,g),n=g+1):(Gr(i,e,g+1,o),o=g)}}function Pn(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}ht("FeaturePositionMap",An);class ia{constructor(e,n){this.gl=e.gl,this.location=n}}class Cl extends ia{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class eu extends ia{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class tu extends ia{constructor(e,n){super(e,n),this.current=Di.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Bu=new Float32Array(16);function cc(i){return[Jo(255*i.r,255*i.g),Jo(255*i.b,255*i.a)]}class Qo{constructor(e,n,o){this.value=e,this.uniformNames=n.map(c=>`u_${c}`),this.type=o}setUniform(e,n,o){e.set(o.constantOr(this.value))}getBinding(e,n,o){return this.type==="color"?new tu(e,n):new Cl(e,n)}}class na{constructor(e,n){this.uniformNames=n.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=e.tlbr}setUniform(e,n,o,c){const m=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&e.set(m)}getBinding(e,n,o){return o.substr(0,9)==="u_pattern"?new eu(e,n):new Cl(e,n)}}class $o{constructor(e,n,o,c){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(m=>({name:`a_${m}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,o,c,m){const g=this.paintVertexArray.length,b=this.expression.evaluate(new hn(0),n,{},c,[],m);this.paintVertexArray.resize(e),this._setPaintValue(g,e,b)}updatePaintArray(e,n,o,c){const m=this.expression.evaluate({zoom:0},o,c);this._setPaintValue(e,n,m)}_setPaintValue(e,n,o){if(this.type==="color"){const c=cc(o);for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,c[0],c[1])}else{for(let c=e;c<n;c++)this.paintVertexArray.emplace(c,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Eo{constructor(e,n,o,c,m,g){this.expression=e,this.uniformNames=n.map(b=>`u_${b}_t`),this.type=o,this.useIntegerZoom=c,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=n.map(b=>({name:`a_${b}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,n,o,c,m){const g=this.expression.evaluate(new hn(this.zoom),n,{},c,[],m),b=this.expression.evaluate(new hn(this.zoom+1),n,{},c,[],m),T=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(T,e,g,b)}updatePaintArray(e,n,o,c){const m=this.expression.evaluate({zoom:this.zoom},o,c),g=this.expression.evaluate({zoom:this.zoom+1},o,c);this._setPaintValue(e,n,m,g)}_setPaintValue(e,n,o,c){if(this.type==="color"){const m=cc(o),g=cc(c);for(let b=e;b<n;b++)this.paintVertexArray.emplace(b,m[0],m[1],g[0],g[1])}else{for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,c=vt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,n,o){return new Cl(e,n)}}class es{constructor(e,n,o,c,m,g){this.expression=e,this.type=n,this.useIntegerZoom=o,this.zoom=c,this.layerId=g,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(e,n,o){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(e,n,o,c,m){this._setPaintValues(e,n,o.patterns&&o.patterns[this.layerId],m)}_setPaintValues(e,n,o,c){if(!c||!o)return;const{min:m,mid:g,max:b}=o,T=c[m],C=c[g],P=c[b];if(T&&C&&P)for(let D=e;D<n;D++)this.zoomInPaintVertexArray.emplace(D,C.tl[0],C.tl[1],C.br[0],C.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],C.pixelRatio,T.pixelRatio),this.zoomOutPaintVertexArray.emplace(D,C.tl[0],C.tl[1],C.br[0],C.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],C.pixelRatio,P.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Yo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Yo.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class uc{constructor(e,n,o){this.binders={},this._buffers=[];const c=[];for(const m in e.paint._values){if(!o(m))continue;const g=e.paint.get(m);if(!(g instanceof Pr&&qo(g.property.specification)))continue;const b=Xf(m,e.type),T=g.value,C=g.property.specification.type,P=g.property.useIntegerZoom,D=g.property.specification["property-type"],O=D==="cross-faded"||D==="cross-faded-data-driven";if(T.kind==="constant")this.binders[m]=O?new na(T.value,b):new Qo(T.value,b,C),c.push(`/u_${m}`);else if(T.kind==="source"||O){const U=Yh(m,C,"source");this.binders[m]=O?new es(T,C,P,n,U,e.id):new $o(T,b,C,U),c.push(`/a_${m}`)}else{const U=Yh(m,C,"composite");this.binders[m]=new Eo(T,b,C,P,n,U),c.push(`/z_${m}`)}}this.cacheKey=c.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof $o||n instanceof Eo?n.maxValue:0}populatePaintArrays(e,n,o,c,m){for(const g in this.binders){const b=this.binders[g];(b instanceof $o||b instanceof Eo||b instanceof es)&&b.populatePaintArray(e,n,o,c,m)}}setConstantPatternPositions(e,n){for(const o in this.binders){const c=this.binders[o];c instanceof na&&c.setConstantPatternPositions(e,n)}}updatePaintArrays(e,n,o,c,m){let g=!1;for(const b in e){const T=n.getPositions(b);for(const C of T){const P=o.feature(C.index);for(const D in this.binders){const O=this.binders[D];if((O instanceof $o||O instanceof Eo||O instanceof es)&&O.expression.isStateDependent===!0){const U=c.paint.get(D);O.expression=U.value,O.updatePaintArray(C.start,C.end,P,e[b],m),g=!0}}}}return g}defines(){const e=[];for(const n in this.binders){const o=this.binders[n];(o instanceof Qo||o instanceof na)&&e.push(...o.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof $o||o instanceof Eo)for(let c=0;c<o.paintVertexAttributes.length;c++)e.push(o.paintVertexAttributes[c].name);else if(o instanceof es)for(let c=0;c<Yo.members.length;c++)e.push(Yo.members[c].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Qo||o instanceof na||o instanceof Eo)for(const c of o.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const o=[];for(const c in this.binders){const m=this.binders[c];if(m instanceof Qo||m instanceof na||m instanceof Eo){for(const g of m.uniformNames)if(n[g]){const b=m.getBinding(e,n[g],g);o.push({name:g,property:c,binding:b})}}}return o}setUniforms(e,n,o,c){for(const{name:m,property:g,binding:b}of n)this.binders[g].setUniform(b,c,o.get(g),m)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(e&&o instanceof es){const c=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(o instanceof $o||o instanceof Eo)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const n in this.binders){const o=this.binders[n];(o instanceof $o||o instanceof Eo||o instanceof es)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof $o||n instanceof Eo||n instanceof es)&&n.destroy()}}}class ms{constructor(e,n,o=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new uc(c,n,o);this.needsUpload=!1,this._featureMap=new An,this._bufferOffset=0}populatePaintArrays(e,n,o,c,m,g){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,n,c,m,g);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,o,c){for(const m of o)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,n,m,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Xf(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Yh(i,e,n){const o={color:{source:Ba,composite:X},number:{source:I,composite:Ba}},c=function(m){return{"line-pattern":{source:Zi,composite:Zi},"fill-pattern":{source:Zi,composite:Zi},"fill-extrusion-pattern":{source:Zi,composite:Zi}}[m]}(i);return c&&c[n]||o[e][n]}ht("ConstantBinder",Qo),ht("CrossFadedConstantBinder",na),ht("SourceExpressionBinder",$o),ht("CrossFadedCompositeBinder",es),ht("CompositeExpressionBinder",Eo),ht("ProgramConfiguration",uc,{omit:["_buffers"]}),ht("ProgramConfigurationSet",ms);const qn=8192,Nu=Math.pow(2,14)-1,Qh=-Nu-1;function al(i){const e=qn/i.extent,n=i.loadGeometry();for(let o=0;o<n.length;o++){const c=n[o];for(let m=0;m<c.length;m++){const g=c[m],b=Math.round(g.x*e),T=Math.round(g.y*e);g.x=vt(b,Qh,Nu),g.y=vt(T,Qh,Nu),(b<g.x||b>g.x+1||T<g.y||T>g.y+1)&&$e("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function ll(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?al(i):[]}}function iu(i,e,n,o,c){i.emplaceBack(2*e+(o+1)/2,2*n+(c+1)/2)}class Vu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new It,this.indexArray=new dr,this.segments=new dn,this.programConfigurations=new ms(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){const c=this.layers[0],m=[];let g=null,b=!1;c.type==="circle"&&(g=c.layout.get("circle-sort-key"),b=!g.isConstant());for(const{feature:T,id:C,index:P,sourceLayerIndex:D}of e){const O=this.layers[0]._featureFilter.needGeometry,U=ll(T,O);if(!this.layers[0]._featureFilter.filter(new hn(this.zoom),U,o))continue;const j=b?g.evaluate(U,{},o):void 0,W={id:C,properties:T.properties,type:T.type,sourceLayerIndex:D,index:P,geometry:O?U.geometry:al(T),patterns:{},sortKey:j};m.push(W)}b&&m.sort((T,C)=>T.sortKey-C.sortKey);for(const T of m){const{geometry:C,index:P,sourceLayerIndex:D}=T,O=e[P].feature;this.addFeature(T,C,P,o),n.featureIndex.insert(O,C,P,D,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ao),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,o,c){for(const m of n)for(const g of m){const b=g.x,T=g.y;if(b<0||b>=qn||T<0||T>=qn)continue;const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=C.vertexLength;iu(this.layoutVertexArray,b,T,-1,-1),iu(this.layoutVertexArray,b,T,1,-1),iu(this.layoutVertexArray,b,T,1,1),iu(this.layoutVertexArray,b,T,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+3,P+2),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},c)}}function $h(i,e){for(let n=0;n<i.length;n++)if(El(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(El(i,e[n]))return!0;return!!Uu(i,e)}function Kf(i,e,n){return!!El(i,e)||!!ju(e,i,n)}function ed(i,e){if(i.length===1)return id(e,i[0]);for(let n=0;n<e.length;n++){const o=e[n];for(let c=0;c<o.length;c++)if(El(i,o[c]))return!0}for(let n=0;n<i.length;n++)if(id(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(Uu(i,e[n]))return!0;return!1}function Jf(i,e,n){if(i.length>1){if(Uu(i,e))return!0;for(let o=0;o<e.length;o++)if(ju(e[o],i,n))return!0}for(let o=0;o<i.length;o++)if(ju(i[o],e,n))return!0;return!1}function Uu(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){const o=i[n],c=i[n+1];for(let m=0;m<e.length-1;m++)if(Yf(o,c,e[m],e[m+1]))return!0}return!1}function Yf(i,e,n,o){return Kt(i,n,o)!==Kt(e,n,o)&&Kt(i,e,n)!==Kt(i,e,o)}function ju(i,e,n){const o=n*n;if(e.length===1)return i.distSqr(e[0])<o;for(let c=1;c<e.length;c++)if(td(i,e[c-1],e[c])<o)return!0;return!1}function td(i,e,n){const o=e.distSqr(n);if(o===0)return i.distSqr(e);const c=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/o;return i.distSqr(c<0?e:c>1?n:n.sub(e)._mult(c)._add(e))}function id(i,e){let n,o,c,m=!1;for(let g=0;g<i.length;g++){n=i[g];for(let b=0,T=n.length-1;b<n.length;T=b++)o=n[b],c=n[T],o.y>e.y!=c.y>e.y&&e.x<(c.x-o.x)*(e.y-o.y)/(c.y-o.y)+o.x&&(m=!m)}return m}function El(i,e){let n=!1;for(let o=0,c=i.length-1;o<i.length;c=o++){const m=i[o],g=i[c];m.y>e.y!=g.y>e.y&&e.x<(g.x-m.x)*(e.y-m.y)/(g.y-m.y)+m.x&&(n=!n)}return n}function Qf(i,e,n){const o=n[0],c=n[2];if(i.x<o.x&&e.x<o.x||i.x>c.x&&e.x>c.x||i.y<o.y&&e.y<o.y||i.y>c.y&&e.y>c.y)return!1;const m=Kt(i,e,n[0]);return m!==Kt(i,e,n[1])||m!==Kt(i,e,n[2])||m!==Kt(i,e,n[3])}function hc(i,e,n){const o=e.paint.get(i).value;return o.kind==="constant"?o.value:n.programConfigurations.get(e.id).getMaxValue(i)}function nu(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function ru(i,e,n,o,c){if(!e[0]&&!e[1])return i;const m=he.convert(e)._mult(c);n==="viewport"&&m._rotate(-o);const g=[];for(let b=0;b<i.length;b++)g.push(i[b].sub(m));return g}let nd,rd;ht("CircleBucket",Vu,{omit:["layers"]});var $f={get paint(){return rd=rd||new On({"circle-radius":new Ht(ke.paint_circle["circle-radius"]),"circle-color":new Ht(ke.paint_circle["circle-color"]),"circle-blur":new Ht(ke.paint_circle["circle-blur"]),"circle-opacity":new Ht(ke.paint_circle["circle-opacity"]),"circle-translate":new Ft(ke.paint_circle["circle-translate"]),"circle-translate-anchor":new Ft(ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ft(ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ft(ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ht(ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ht(ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ht(ke.paint_circle["circle-stroke-opacity"])})},get layout(){return nd=nd||new On({"circle-sort-key":new Ht(ke.layout_circle["circle-sort-key"])})}},Wr=1e-6,kl=typeof Float32Array<"u"?Float32Array:Array;function qu(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function od(i,e,n){var o=e[0],c=e[1],m=e[2],g=e[3],b=e[4],T=e[5],C=e[6],P=e[7],D=e[8],O=e[9],U=e[10],j=e[11],W=e[12],ee=e[13],re=e[14],pe=e[15],oe=n[0],ve=n[1],Se=n[2],Be=n[3];return i[0]=oe*o+ve*b+Se*D+Be*W,i[1]=oe*c+ve*T+Se*O+Be*ee,i[2]=oe*m+ve*C+Se*U+Be*re,i[3]=oe*g+ve*P+Se*j+Be*pe,i[4]=(oe=n[4])*o+(ve=n[5])*b+(Se=n[6])*D+(Be=n[7])*W,i[5]=oe*c+ve*T+Se*O+Be*ee,i[6]=oe*m+ve*C+Se*U+Be*re,i[7]=oe*g+ve*P+Se*j+Be*pe,i[8]=(oe=n[8])*o+(ve=n[9])*b+(Se=n[10])*D+(Be=n[11])*W,i[9]=oe*c+ve*T+Se*O+Be*ee,i[10]=oe*m+ve*C+Se*U+Be*re,i[11]=oe*g+ve*P+Se*j+Be*pe,i[12]=(oe=n[12])*o+(ve=n[13])*b+(Se=n[14])*D+(Be=n[15])*W,i[13]=oe*c+ve*T+Se*O+Be*ee,i[14]=oe*m+ve*C+Se*U+Be*re,i[15]=oe*g+ve*P+Se*j+Be*pe,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var dc,em=od;function ou(i,e,n){var o=e[0],c=e[1],m=e[2],g=e[3];return i[0]=n[0]*o+n[4]*c+n[8]*m+n[12]*g,i[1]=n[1]*o+n[5]*c+n[9]*m+n[13]*g,i[2]=n[2]*o+n[6]*c+n[10]*m+n[14]*g,i[3]=n[3]*o+n[7]*c+n[11]*m+n[15]*g,i}dc=new kl(4),kl!=Float32Array&&(dc[0]=0,dc[1]=0,dc[2]=0,dc[3]=0);class tm extends Co{constructor(e){super(e,$f)}createBucket(e){return new Vu(e)}queryRadius(e){const n=e;return hc("circle-radius",this,n)+hc("circle-stroke-width",this,n)+nu(this.paint.get("circle-translate"))}queryIntersectsFeature(e,n,o,c,m,g,b,T){const C=ru(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,b),P=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),D=this.paint.get("circle-pitch-alignment")==="map",O=D?C:function(j,W){return j.map(ee=>sd(ee,W))}(C,T),U=D?P*b:P;for(const j of c)for(const W of j){const ee=D?W:sd(W,T);let re=U;const pe=ou([],[W.x,W.y,0,1],T);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?re*=pe[3]/g.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(re*=g.cameraToCenterDistance/pe[3]),Kf(O,ee,re))return!0}return!1}}function sd(i,e){const n=ou([],[i.x,i.y,0,1],e);return new he(n[0]/n[3],n[1]/n[3])}class ad extends Vu{}let ld;ht("HeatmapBucket",ad,{omit:["layers"]});var im={get paint(){return ld=ld||new On({"heatmap-radius":new Ht(ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ht(ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ft(ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new nc(ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ft(ke.paint_heatmap["heatmap-opacity"])})}};function Zu(i,{width:e,height:n},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*n*o)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${e*n*o}`)}else c=new Uint8Array(e*n*o);return i.width=e,i.height=n,i.data=c,i}function cd(i,{width:e,height:n},o){if(e===i.width&&n===i.height)return;const c=Zu({},{width:e,height:n},o);Gu(i,c,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,n)},o),i.width=e,i.height=n,i.data=c.data}function Gu(i,e,n,o,c,m){if(c.width===0||c.height===0)return e;if(c.width>i.width||c.height>i.height||n.x>i.width-c.width||n.y>i.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||o.x>e.width-c.width||o.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const g=i.data,b=e.data;if(g===b)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<c.height;T++){const C=((n.y+T)*i.width+n.x)*m,P=((o.y+T)*e.width+o.x)*m;for(let D=0;D<c.width*m;D++)b[P+D]=g[C+D]}return e}class pc{constructor(e,n){Zu(this,e,1,n)}resize(e){cd(this,e,1)}clone(){return new pc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,c,m){Gu(e,n,o,c,m,1)}}class Fo{constructor(e,n){Zu(this,e,4,n)}resize(e){cd(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Fo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,c,m){Gu(e,n,o,c,m,4)}}function ud(i){const e={},n=i.resolution||256,o=i.clips?i.clips.length:1,c=i.image||new Fo({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const m=(g,b,T)=>{e[i.evaluationKey]=T;const C=i.expression.evaluate(e);c.data[g+b+0]=Math.floor(255*C.r/C.a),c.data[g+b+1]=Math.floor(255*C.g/C.a),c.data[g+b+2]=Math.floor(255*C.b/C.a),c.data[g+b+3]=Math.floor(255*C.a)};if(i.clips)for(let g=0,b=0;g<o;++g,b+=4*n)for(let T=0,C=0;T<n;T++,C+=4){const P=T/(n-1),{start:D,end:O}=i.clips[g];m(b,C,D*(1-P)+O*P)}else for(let g=0,b=0;g<n;g++,b+=4)m(0,b,g/(n-1));return c}ht("AlphaImage",pc),ht("RGBAImage",Fo);class nm extends Co{createBucket(e){return new ad(e)}constructor(e){super(e,im),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ud({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let hd;var rm={get paint(){return hd=hd||new On({"hillshade-illumination-direction":new Ft(ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ft(ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ft(ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ft(ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ft(ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ft(ke.paint_hillshade["hillshade-accent-color"])})}};class om extends Co{constructor(e){super(e,rm)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const sm=xn([{name:"a_pos",components:2,type:"Int16"}],4),{members:am}=sm;var Wu={exports:{}};function su(i,e,n){n=n||2;var o,c,m,g,b,T,C,P=e&&e.length,D=P?e[0]*n:i.length,O=dd(i,0,D,n,!0),U=[];if(!O||O.next===O.prev)return U;if(P&&(O=function(W,ee,re,pe){var oe,ve,Se,Be=[];for(oe=0,ve=ee.length;oe<ve;oe++)(Se=dd(W,ee[oe]*pe,oe<ve-1?ee[oe+1]*pe:W.length,pe,!1))===Se.next&&(Se.steiner=!0),Be.push(mm(Se));for(Be.sort(dm),oe=0;oe<Be.length;oe++)re=pm(Be[oe],re);return re}(i,e,O,n)),i.length>80*n){o=m=i[0],c=g=i[1];for(var j=n;j<D;j+=n)(b=i[j])<o&&(o=b),(T=i[j+1])<c&&(c=T),b>m&&(m=b),T>g&&(g=T);C=(C=Math.max(m-o,g-c))!==0?32767/C:0}return fc(O,U,n,o,c,C,0),U}function dd(i,e,n,o,c){var m,g;if(c===Ku(i,e,n,o)>0)for(m=e;m<n;m+=o)g=md(m,i[m],i[m+1],g);else for(m=n-o;m>=e;m-=o)g=md(m,i[m],i[m+1],g);return g&&au(g,g.next)&&(_c(g),g=g.next),g}function cl(i,e){if(!i)return i;e||(e=i);var n,o=i;do if(n=!1,o.steiner||!au(o,o.next)&&Nn(o.prev,o,o.next)!==0)o=o.next;else{if(_c(o),(o=e=o.prev)===o.next)break;n=!0}while(n||o!==e);return e}function fc(i,e,n,o,c,m,g){if(i){!g&&m&&function(P,D,O,U){var j=P;do j.z===0&&(j.z=Hu(j.x,j.y,D,O,U)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next;while(j!==P);j.prevZ.nextZ=null,j.prevZ=null,function(W){var ee,re,pe,oe,ve,Se,Be,_t,Ct=1;do{for(re=W,W=null,ve=null,Se=0;re;){for(Se++,pe=re,Be=0,ee=0;ee<Ct&&(Be++,pe=pe.nextZ);ee++);for(_t=Ct;Be>0||_t>0&&pe;)Be!==0&&(_t===0||!pe||re.z<=pe.z)?(oe=re,re=re.nextZ,Be--):(oe=pe,pe=pe.nextZ,_t--),ve?ve.nextZ=oe:W=oe,oe.prevZ=ve,ve=oe;re=pe}ve.nextZ=null,Ct*=2}while(Se>1)}(j)}(i,o,c,m);for(var b,T,C=i;i.prev!==i.next;)if(b=i.prev,T=i.next,m?cm(i,o,c,m):lm(i))e.push(b.i/n|0),e.push(i.i/n|0),e.push(T.i/n|0),_c(i),i=T.next,C=T.next;else if((i=T)===C){g?g===1?fc(i=um(cl(i),e,n),e,n,o,c,m,2):g===2&&hm(i,e,n,o,c,m):fc(cl(i),e,n,o,c,m,1);break}}}function lm(i){var e=i.prev,n=i,o=i.next;if(Nn(e,n,o)>=0)return!1;for(var c=e.x,m=n.x,g=o.x,b=e.y,T=n.y,C=o.y,P=c<m?c<g?c:g:m<g?m:g,D=b<T?b<C?b:C:T<C?T:C,O=c>m?c>g?c:g:m>g?m:g,U=b>T?b>C?b:C:T>C?T:C,j=o.next;j!==e;){if(j.x>=P&&j.x<=O&&j.y>=D&&j.y<=U&&Ml(c,b,m,T,g,C,j.x,j.y)&&Nn(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function cm(i,e,n,o){var c=i.prev,m=i,g=i.next;if(Nn(c,m,g)>=0)return!1;for(var b=c.x,T=m.x,C=g.x,P=c.y,D=m.y,O=g.y,U=b<T?b<C?b:C:T<C?T:C,j=P<D?P<O?P:O:D<O?D:O,W=b>T?b>C?b:C:T>C?T:C,ee=P>D?P>O?P:O:D>O?D:O,re=Hu(U,j,e,n,o),pe=Hu(W,ee,e,n,o),oe=i.prevZ,ve=i.nextZ;oe&&oe.z>=re&&ve&&ve.z<=pe;){if(oe.x>=U&&oe.x<=W&&oe.y>=j&&oe.y<=ee&&oe!==c&&oe!==g&&Ml(b,P,T,D,C,O,oe.x,oe.y)&&Nn(oe.prev,oe,oe.next)>=0||(oe=oe.prevZ,ve.x>=U&&ve.x<=W&&ve.y>=j&&ve.y<=ee&&ve!==c&&ve!==g&&Ml(b,P,T,D,C,O,ve.x,ve.y)&&Nn(ve.prev,ve,ve.next)>=0))return!1;ve=ve.nextZ}for(;oe&&oe.z>=re;){if(oe.x>=U&&oe.x<=W&&oe.y>=j&&oe.y<=ee&&oe!==c&&oe!==g&&Ml(b,P,T,D,C,O,oe.x,oe.y)&&Nn(oe.prev,oe,oe.next)>=0)return!1;oe=oe.prevZ}for(;ve&&ve.z<=pe;){if(ve.x>=U&&ve.x<=W&&ve.y>=j&&ve.y<=ee&&ve!==c&&ve!==g&&Ml(b,P,T,D,C,O,ve.x,ve.y)&&Nn(ve.prev,ve,ve.next)>=0)return!1;ve=ve.nextZ}return!0}function um(i,e,n){var o=i;do{var c=o.prev,m=o.next.next;!au(c,m)&&pd(c,o,o.next,m)&&mc(c,m)&&mc(m,c)&&(e.push(c.i/n|0),e.push(o.i/n|0),e.push(m.i/n|0),_c(o),_c(o.next),o=i=m),o=o.next}while(o!==i);return cl(o)}function hm(i,e,n,o,c,m){var g=i;do{for(var b=g.next.next;b!==g.prev;){if(g.i!==b.i&&_m(g,b)){var T=fd(g,b);return g=cl(g,g.next),T=cl(T,T.next),fc(g,e,n,o,c,m,0),void fc(T,e,n,o,c,m,0)}b=b.next}g=g.next}while(g!==i)}function dm(i,e){return i.x-e.x}function pm(i,e){var n=function(c,m){var g,b=m,T=c.x,C=c.y,P=-1/0;do{if(C<=b.y&&C>=b.next.y&&b.next.y!==b.y){var D=b.x+(C-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(D<=T&&D>P&&(P=D,g=b.x<b.next.x?b:b.next,D===T))return g}b=b.next}while(b!==m);if(!g)return null;var O,U=g,j=g.x,W=g.y,ee=1/0;b=g;do T>=b.x&&b.x>=j&&T!==b.x&&Ml(C<W?T:P,C,j,W,C<W?P:T,C,b.x,b.y)&&(O=Math.abs(C-b.y)/(T-b.x),mc(b,c)&&(O<ee||O===ee&&(b.x>g.x||b.x===g.x&&fm(g,b)))&&(g=b,ee=O)),b=b.next;while(b!==U);return g}(i,e);if(!n)return e;var o=fd(n,i);return cl(o,o.next),cl(n,n.next)}function fm(i,e){return Nn(i.prev,i,e.prev)<0&&Nn(e.next,i,i.next)<0}function Hu(i,e,n,o,c){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*c|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function mm(i){var e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function Ml(i,e,n,o,c,m,g,b){return(c-g)*(e-b)>=(i-g)*(m-b)&&(i-g)*(o-b)>=(n-g)*(e-b)&&(n-g)*(m-b)>=(c-g)*(o-b)}function _m(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(n,o){var c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==o.i&&c.next.i!==o.i&&pd(c,c.next,n,o))return!0;c=c.next}while(c!==n);return!1}(i,e)&&(mc(i,e)&&mc(e,i)&&function(n,o){var c=n,m=!1,g=(n.x+o.x)/2,b=(n.y+o.y)/2;do c.y>b!=c.next.y>b&&c.next.y!==c.y&&g<(c.next.x-c.x)*(b-c.y)/(c.next.y-c.y)+c.x&&(m=!m),c=c.next;while(c!==n);return m}(i,e)&&(Nn(i.prev,i,e.prev)||Nn(i,e.prev,e))||au(i,e)&&Nn(i.prev,i,i.next)>0&&Nn(e.prev,e,e.next)>0)}function Nn(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function au(i,e){return i.x===e.x&&i.y===e.y}function pd(i,e,n,o){var c=cu(Nn(i,e,n)),m=cu(Nn(i,e,o)),g=cu(Nn(n,o,i)),b=cu(Nn(n,o,e));return c!==m&&g!==b||!(c!==0||!lu(i,n,e))||!(m!==0||!lu(i,o,e))||!(g!==0||!lu(n,i,o))||!(b!==0||!lu(n,e,o))}function lu(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function cu(i){return i>0?1:i<0?-1:0}function mc(i,e){return Nn(i.prev,i,i.next)<0?Nn(i,e,i.next)>=0&&Nn(i,i.prev,e)>=0:Nn(i,e,i.prev)<0||Nn(i,i.next,e)<0}function fd(i,e){var n=new Xu(i.i,i.x,i.y),o=new Xu(e.i,e.x,e.y),c=i.next,m=e.prev;return i.next=e,e.prev=i,n.next=c,c.prev=n,o.next=n,n.prev=o,m.next=o,o.prev=m,o}function md(i,e,n,o){var c=new Xu(i,e,n);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function _c(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Xu(i,e,n){this.i=i,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ku(i,e,n,o){for(var c=0,m=e,g=n-o;m<n;m+=o)c+=(i[g]-i[m])*(i[m+1]+i[g+1]),g=m;return c}Wu.exports=su,Wu.exports.default=su,su.deviation=function(i,e,n,o){var c=e&&e.length,m=Math.abs(Ku(i,0,c?e[0]*n:i.length,n));if(c)for(var g=0,b=e.length;g<b;g++)m-=Math.abs(Ku(i,e[g]*n,g<b-1?e[g+1]*n:i.length,n));var T=0;for(g=0;g<o.length;g+=3){var C=o[g]*n,P=o[g+1]*n,D=o[g+2]*n;T+=Math.abs((i[C]-i[D])*(i[P+1]-i[C+1])-(i[C]-i[P])*(i[D+1]-i[C+1]))}return m===0&&T===0?0:Math.abs((T-m)/m)},su.flatten=function(i){for(var e=i[0][0].length,n={vertices:[],holes:[],dimensions:e},o=0,c=0;c<i.length;c++){for(var m=0;m<i[c].length;m++)for(var g=0;g<e;g++)n.vertices.push(i[c][m][g]);c>0&&n.holes.push(o+=i[c-1].length)}return n};var _d=M(Wu.exports);function gm(i,e,n,o,c){gd(i,e,n||0,o||i.length-1,c||ym)}function gd(i,e,n,o,c){for(;o>n;){if(o-n>600){var m=o-n+1,g=e-n+1,b=Math.log(m),T=.5*Math.exp(2*b/3),C=.5*Math.sqrt(b*T*(m-T)/m)*(g-m/2<0?-1:1);gd(i,e,Math.max(n,Math.floor(e-g*T/m+C)),Math.min(o,Math.floor(e+(m-g)*T/m+C)),c)}var P=i[e],D=n,O=o;for(gc(i,n,e),c(i[o],P)>0&&gc(i,n,o);D<O;){for(gc(i,D,O),D++,O--;c(i[D],P)<0;)D++;for(;c(i[O],P)>0;)O--}c(i[n],P)===0?gc(i,n,O):gc(i,++O,o),O<=e&&(n=O+1),e<=O&&(o=O-1)}}function gc(i,e,n){var o=i[e];i[e]=i[n],i[n]=o}function ym(i,e){return i<e?-1:i>e?1:0}function Ju(i,e){const n=i.length;if(n<=1)return[i];const o=[];let c,m;for(let g=0;g<n;g++){const b=Pt(i[g]);b!==0&&(i[g].area=Math.abs(b),m===void 0&&(m=b<0),m===b<0?(c&&o.push(c),c=[i[g]]):c.push(i[g]))}if(c&&o.push(c),e>1)for(let g=0;g<o.length;g++)o[g].length<=e||(gm(o[g],e,1,o[g].length-1,vm),o[g]=o[g].slice(0,e));return o}function vm(i,e){return e.area-i.area}function Yu(i,e,n){const o=n.patternDependencies;let c=!1;for(const m of e){const g=m.paint.get(`${i}-pattern`);g.isConstant()||(c=!0);const b=g.constantOr(null);b&&(c=!0,o[b.to]=!0,o[b.from]=!0)}return c}function Qu(i,e,n,o,c){const m=c.patternDependencies;for(const g of e){const b=g.paint.get(`${i}-pattern`).value;if(b.kind!=="constant"){let T=b.evaluate({zoom:o-1},n,{},c.availableImages),C=b.evaluate({zoom:o},n,{},c.availableImages),P=b.evaluate({zoom:o+1},n,{},c.availableImages);T=T&&T.name?T.name:T,C=C&&C.name?C.name:C,P=P&&P.name?P.name:P,m[T]=!0,m[C]=!0,m[P]=!0,n.patterns[g.id]={min:T,mid:C,max:P}}}return n}class $u{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new _i,this.indexArray=new dr,this.indexArray2=new Wn,this.programConfigurations=new ms(e.layers,e.zoom),this.segments=new dn,this.segments2=new dn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){this.hasPattern=Yu("fill",this.layers,n);const c=this.layers[0].layout.get("fill-sort-key"),m=!c.isConstant(),g=[];for(const{feature:b,id:T,index:C,sourceLayerIndex:P}of e){const D=this.layers[0]._featureFilter.needGeometry,O=ll(b,D);if(!this.layers[0]._featureFilter.filter(new hn(this.zoom),O,o))continue;const U=m?c.evaluate(O,{},o,n.availableImages):void 0,j={id:T,properties:b.properties,type:b.type,sourceLayerIndex:P,index:C,geometry:D?O.geometry:al(b),patterns:{},sortKey:U};g.push(j)}m&&g.sort((b,T)=>b.sortKey-T.sortKey);for(const b of g){const{geometry:T,index:C,sourceLayerIndex:P}=b;if(this.hasPattern){const D=Qu("fill",this.layers,b,this.zoom,n);this.patternFeatures.push(D)}else this.addFeature(b,T,C,o,{});n.featureIndex.insert(e[C].feature,T,C,P,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}addFeatures(e,n,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,am),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,o,c,m){for(const g of Ju(n,500)){let b=0;for(const U of g)b+=U.length;const T=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),C=T.vertexLength,P=[],D=[];for(const U of g){if(U.length===0)continue;U!==g[0]&&D.push(P.length/2);const j=this.segments2.prepareSegment(U.length,this.layoutVertexArray,this.indexArray2),W=j.vertexLength;this.layoutVertexArray.emplaceBack(U[0].x,U[0].y),this.indexArray2.emplaceBack(W+U.length-1,W),P.push(U[0].x),P.push(U[0].y);for(let ee=1;ee<U.length;ee++)this.layoutVertexArray.emplaceBack(U[ee].x,U[ee].y),this.indexArray2.emplaceBack(W+ee-1,W+ee),P.push(U[ee].x),P.push(U[ee].y);j.vertexLength+=U.length,j.primitiveLength+=U.length}const O=_d(P,D);for(let U=0;U<O.length;U+=3)this.indexArray.emplaceBack(C+O[U],C+O[U+1],C+O[U+2]);T.vertexLength+=b,T.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,m,c)}}let yd,vd;ht("FillBucket",$u,{omit:["layers","patternFeatures"]});var bm={get paint(){return vd=vd||new On({"fill-antialias":new Ft(ke.paint_fill["fill-antialias"]),"fill-opacity":new Ht(ke.paint_fill["fill-opacity"]),"fill-color":new Ht(ke.paint_fill["fill-color"]),"fill-outline-color":new Ht(ke.paint_fill["fill-outline-color"]),"fill-translate":new Ft(ke.paint_fill["fill-translate"]),"fill-translate-anchor":new Ft(ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new rl(ke.paint_fill["fill-pattern"])})},get layout(){return yd=yd||new On({"fill-sort-key":new Ht(ke.layout_fill["fill-sort-key"])})}};class xm extends Co{constructor(e){super(e,bm)}recalculate(e,n){super.recalculate(e,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new $u(e)}queryRadius(){return nu(this.paint.get("fill-translate"))}queryIntersectsFeature(e,n,o,c,m,g,b){return ed(ru(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,b),c)}isTileClipped(){return!0}}const wm=xn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Sm=xn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Tm}=wm;var Va={},Im=q,bd=Al;function Al(i,e,n,o,c){this.properties={},this.extent=n,this.type=0,this._pbf=i,this._geometry=-1,this._keys=o,this._values=c,i.readFields(Cm,this,e)}function Cm(i,e,n){i==1?e.id=n.readVarint():i==2?function(o,c){for(var m=o.readVarint()+o.pos;o.pos<m;){var g=c._keys[o.readVarint()],b=c._values[o.readVarint()];c.properties[g]=b}}(n,e):i==3?e.type=n.readVarint():i==4&&(e._geometry=n.pos)}function Em(i){for(var e,n,o=0,c=0,m=i.length,g=m-1;c<m;g=c++)o+=((n=i[g]).x-(e=i[c]).x)*(e.y+n.y);return o}Al.types=["Unknown","Point","LineString","Polygon"],Al.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,n=i.readVarint()+i.pos,o=1,c=0,m=0,g=0,b=[];i.pos<n;){if(c<=0){var T=i.readVarint();o=7&T,c=T>>3}if(c--,o===1||o===2)m+=i.readSVarint(),g+=i.readSVarint(),o===1&&(e&&b.push(e),e=[]),e.push(new Im(m,g));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&b.push(e),b},Al.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,n=1,o=0,c=0,m=0,g=1/0,b=-1/0,T=1/0,C=-1/0;i.pos<e;){if(o<=0){var P=i.readVarint();n=7&P,o=P>>3}if(o--,n===1||n===2)(c+=i.readSVarint())<g&&(g=c),c>b&&(b=c),(m+=i.readSVarint())<T&&(T=m),m>C&&(C=m);else if(n!==7)throw new Error("unknown command "+n)}return[g,T,b,C]},Al.prototype.toGeoJSON=function(i,e,n){var o,c,m=this.extent*Math.pow(2,n),g=this.extent*i,b=this.extent*e,T=this.loadGeometry(),C=Al.types[this.type];function P(U){for(var j=0;j<U.length;j++){var W=U[j];U[j]=[360*(W.x+g)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(W.y+b)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var D=[];for(o=0;o<T.length;o++)D[o]=T[o][0];P(T=D);break;case 2:for(o=0;o<T.length;o++)P(T[o]);break;case 3:for(T=function(U){var j=U.length;if(j<=1)return[U];for(var W,ee,re=[],pe=0;pe<j;pe++){var oe=Em(U[pe]);oe!==0&&(ee===void 0&&(ee=oe<0),ee===oe<0?(W&&re.push(W),W=[U[pe]]):W.push(U[pe]))}return W&&re.push(W),re}(T),o=0;o<T.length;o++)for(c=0;c<T[o].length;c++)P(T[o][c])}T.length===1?T=T[0]:C="Multi"+C;var O={type:"Feature",geometry:{type:C,coordinates:T},properties:this.properties};return"id"in this&&(O.id=this.id),O};var km=bd,xd=wd;function wd(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Mm,this,e),this.length=this._features.length}function Mm(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push(function(o){for(var c=null,m=o.readVarint()+o.pos;o.pos<m;){var g=o.readVarint()>>3;c=g===1?o.readString():g===2?o.readFloat():g===3?o.readDouble():g===4?o.readVarint64():g===5?o.readVarint():g===6?o.readSVarint():g===7?o.readBoolean():null}return c}(n))}wd.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new km(this._pbf,e,this.extent,this._keys,this._values)};var Am=xd;function Pm(i,e,n){if(i===3){var o=new Am(n,n.readVarint()+n.pos);o.length&&(e[o.name]=o)}}Va.VectorTile=function(i,e){this.layers=i.readFields(Pm,{},e)},Va.VectorTileFeature=bd,Va.VectorTileLayer=xd;const Lm=Va.VectorTileFeature.types,eh=Math.pow(2,13);function yc(i,e,n,o,c,m,g,b){i.emplaceBack(e,n,2*Math.floor(o*eh)+g,c*eh*2,m*eh*2,Math.round(b))}class th{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ct,this.centroidVertexArray=new et,this.indexArray=new dr,this.programConfigurations=new ms(e.layers,e.zoom),this.segments=new dn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){this.features=[],this.hasPattern=Yu("fill-extrusion",this.layers,n);for(const{feature:c,id:m,index:g,sourceLayerIndex:b}of e){const T=this.layers[0]._featureFilter.needGeometry,C=ll(c,T);if(!this.layers[0]._featureFilter.filter(new hn(this.zoom),C,o))continue;const P={id:m,sourceLayerIndex:b,index:g,geometry:T?C.geometry:al(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(Qu("fill-extrusion",this.layers,P,this.zoom,n)):this.addFeature(P,P.geometry,g,o,{}),n.featureIndex.insert(c,P.geometry,g,b,this.index,!0)}}addFeatures(e,n,o){for(const c of this.features){const{geometry:m}=c;this.addFeature(c,m,c.index,n,o)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Tm),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Sm.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,n,o,c,m){const g={x:0,y:0,vertexCount:0};for(const b of Ju(n,500)){let T=0;for(const j of b)T+=j.length;let C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const j of b){if(j.length===0||Dm(j))continue;let W=0;for(let ee=0;ee<j.length;ee++){const re=j[ee];if(ee>=1){const pe=j[ee-1];if(!zm(re,pe)){C.vertexLength+4>dn.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const oe=re.sub(pe)._perp()._unit(),ve=pe.dist(re);W+ve>32768&&(W=0),yc(this.layoutVertexArray,re.x,re.y,oe.x,oe.y,0,0,W),yc(this.layoutVertexArray,re.x,re.y,oe.x,oe.y,0,1,W),g.x+=2*re.x,g.y+=2*re.y,g.vertexCount+=2,W+=ve,yc(this.layoutVertexArray,pe.x,pe.y,oe.x,oe.y,0,0,W),yc(this.layoutVertexArray,pe.x,pe.y,oe.x,oe.y,0,1,W),g.x+=2*pe.x,g.y+=2*pe.y,g.vertexCount+=2;const Se=C.vertexLength;this.indexArray.emplaceBack(Se,Se+2,Se+1),this.indexArray.emplaceBack(Se+1,Se+2,Se+3),C.vertexLength+=4,C.primitiveLength+=2}}}}if(C.vertexLength+T>dn.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray)),Lm[e.type]!=="Polygon")continue;const P=[],D=[],O=C.vertexLength;for(const j of b)if(j.length!==0){j!==b[0]&&D.push(P.length/2);for(let W=0;W<j.length;W++){const ee=j[W];yc(this.layoutVertexArray,ee.x,ee.y,0,0,1,1,0),g.x+=ee.x,g.y+=ee.y,g.vertexCount+=1,P.push(ee.x),P.push(ee.y)}}const U=_d(P,D);for(let j=0;j<U.length;j+=3)this.indexArray.emplaceBack(O+U[j],O+U[j+2],O+U[j+1]);C.primitiveLength+=U.length/3,C.vertexLength+=T}for(let b=0;b<g.vertexCount;b++)this.centroidVertexArray.emplaceBack(Math.floor(g.x/g.vertexCount),Math.floor(g.y/g.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,m,c)}}function zm(i,e){return i.x===e.x&&(i.x<0||i.x>qn)||i.y===e.y&&(i.y<0||i.y>qn)}function Dm(i){return i.every(e=>e.x<0)||i.every(e=>e.x>qn)||i.every(e=>e.y<0)||i.every(e=>e.y>qn)}let Sd;ht("FillExtrusionBucket",th,{omit:["layers","features"]});var Fm={get paint(){return Sd=Sd||new On({"fill-extrusion-opacity":new Ft(ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ht(ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ft(ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ft(ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new rl(ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ht(ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ht(ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ft(ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Rm extends Co{constructor(e){super(e,Fm)}createBucket(e){return new th(e)}queryRadius(){return nu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,n,o,c,m,g,b,T){const C=ru(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,b),P=this.paint.get("fill-extrusion-height").evaluate(n,o),D=this.paint.get("fill-extrusion-base").evaluate(n,o),O=function(j,W,ee,re){const pe=[];for(const oe of j){const ve=[oe.x,oe.y,0,1];ou(ve,ve,W),pe.push(new he(ve[0]/ve[3],ve[1]/ve[3]))}return pe}(C,T),U=function(j,W,ee,re){const pe=[],oe=[],ve=re[8]*W,Se=re[9]*W,Be=re[10]*W,_t=re[11]*W,Ct=re[8]*ee,mt=re[9]*ee,ut=re[10]*ee,nt=re[11]*ee;for(const xt of j){const st=[],He=[];for(const qt of xt){const At=qt.x,hi=qt.y,pn=re[0]*At+re[4]*hi+re[12],vn=re[1]*At+re[5]*hi+re[13],Kn=re[2]*At+re[6]*hi+re[14],ko=re[3]*At+re[7]*hi+re[15],Hr=Kn+Be,Zn=ko+_t,fr=pn+Ct,Ir=vn+mt,Xr=Kn+ut,Kr=ko+nt,Jn=new he((pn+ve)/Zn,(vn+Se)/Zn);Jn.z=Hr/Zn,st.push(Jn);const Yn=new he(fr/Kr,Ir/Kr);Yn.z=Xr/Kr,He.push(Yn)}pe.push(st),oe.push(He)}return[pe,oe]}(c,D,P,T);return function(j,W,ee){let re=1/0;ed(ee,W)&&(re=Td(ee,W[0]));for(let pe=0;pe<W.length;pe++){const oe=W[pe],ve=j[pe];for(let Se=0;Se<oe.length-1;Se++){const Be=oe[Se],_t=[Be,oe[Se+1],ve[Se+1],ve[Se],Be];$h(ee,_t)&&(re=Math.min(re,Td(ee,_t)))}}return re!==1/0&&re}(U[0],U[1],O)}}function vc(i,e){return i.x*e.x+i.y*e.y}function Td(i,e){if(i.length===1){let n=0;const o=e[n++];let c;for(;!c||o.equals(c);)if(c=e[n++],!c)return 1/0;for(;n<e.length;n++){const m=e[n],g=i[0],b=c.sub(o),T=m.sub(o),C=g.sub(o),P=vc(b,b),D=vc(b,T),O=vc(T,T),U=vc(C,b),j=vc(C,T),W=P*O-D*D,ee=(O*U-D*j)/W,re=(P*j-D*U)/W,pe=o.z*(1-ee-re)+c.z*ee+m.z*re;if(isFinite(pe))return pe}return 1/0}{let n=1/0;for(const o of e)n=Math.min(n,o.z);return n}}const Om=xn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Bm}=Om,Nm=xn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Vm}=Nm,Um=Va.VectorTileFeature.types,jm=Math.cos(Math.PI/180*37.5),Id=Math.pow(2,14)/.5;class ih{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Xt,this.layoutVertexArray2=new Mt,this.indexArray=new dr,this.programConfigurations=new ms(e.layers,e.zoom),this.segments=new dn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){this.hasPattern=Yu("line",this.layers,n);const c=this.layers[0].layout.get("line-sort-key"),m=!c.isConstant(),g=[];for(const{feature:b,id:T,index:C,sourceLayerIndex:P}of e){const D=this.layers[0]._featureFilter.needGeometry,O=ll(b,D);if(!this.layers[0]._featureFilter.filter(new hn(this.zoom),O,o))continue;const U=m?c.evaluate(O,{},o):void 0,j={id:T,properties:b.properties,type:b.type,sourceLayerIndex:P,index:C,geometry:D?O.geometry:al(b),patterns:{},sortKey:U};g.push(j)}m&&g.sort((b,T)=>b.sortKey-T.sortKey);for(const b of g){const{geometry:T,index:C,sourceLayerIndex:P}=b;if(this.hasPattern){const D=Qu("line",this.layers,b,this.zoom,n);this.patternFeatures.push(D)}else this.addFeature(b,T,C,o,{});n.featureIndex.insert(e[C].feature,T,C,P,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}addFeatures(e,n,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Vm)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Bm),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,o,c,m){const g=this.layers[0].layout,b=g.get("line-join").evaluate(e,{}),T=g.get("line-cap"),C=g.get("line-miter-limit"),P=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const D of n)this.addLine(D,e,b,T,C,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,m,c)}addLine(e,n,o,c,m,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let re=0;re<e.length-1;re++)this.totalDistance+=e[re].dist(e[re+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b=Um[n.type]==="Polygon";let T=e.length;for(;T>=2&&e[T-1].equals(e[T-2]);)T--;let C=0;for(;C<T-1&&e[C].equals(e[C+1]);)C++;if(T<(b?3:2))return;o==="bevel"&&(m=1.05);const P=this.overscaling<=16?15*qn/(512*this.overscaling):0,D=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let O,U,j,W,ee;this.e1=this.e2=-1,b&&(O=e[T-2],ee=e[C].sub(O)._unit()._perp());for(let re=C;re<T;re++){if(j=re===T-1?b?e[C+1]:void 0:e[re+1],j&&e[re].equals(j))continue;ee&&(W=ee),O&&(U=O),O=e[re],ee=j?j.sub(O)._unit()._perp():W,W=W||ee;let pe=W.add(ee);pe.x===0&&pe.y===0||pe._unit();const oe=W.x*ee.x+W.y*ee.y,ve=pe.x*ee.x+pe.y*ee.y,Se=ve!==0?1/ve:1/0,Be=2*Math.sqrt(2-2*ve),_t=ve<jm&&U&&j,Ct=W.x*ee.y-W.y*ee.x>0;if(_t&&re>C){const nt=O.dist(U);if(nt>2*P){const xt=O.sub(O.sub(U)._mult(P/nt)._round());this.updateDistance(U,xt),this.addCurrentVertex(xt,W,0,0,D),U=xt}}const mt=U&&j;let ut=mt?o:b?"butt":c;if(mt&&ut==="round"&&(Se<g?ut="miter":Se<=2&&(ut="fakeround")),ut==="miter"&&Se>m&&(ut="bevel"),ut==="bevel"&&(Se>2&&(ut="flipbevel"),Se<m&&(ut="miter")),U&&this.updateDistance(U,O),ut==="miter")pe._mult(Se),this.addCurrentVertex(O,pe,0,0,D);else if(ut==="flipbevel"){if(Se>100)pe=ee.mult(-1);else{const nt=Se*W.add(ee).mag()/W.sub(ee).mag();pe._perp()._mult(nt*(Ct?-1:1))}this.addCurrentVertex(O,pe,0,0,D),this.addCurrentVertex(O,pe.mult(-1),0,0,D)}else if(ut==="bevel"||ut==="fakeround"){const nt=-Math.sqrt(Se*Se-1),xt=Ct?nt:0,st=Ct?0:nt;if(U&&this.addCurrentVertex(O,W,xt,st,D),ut==="fakeround"){const He=Math.round(180*Be/Math.PI/20);for(let qt=1;qt<He;qt++){let At=qt/He;if(At!==.5){const pn=At-.5;At+=At*pn*(At-1)*((1.0904+oe*(oe*(3.55645-1.43519*oe)-3.2452))*pn*pn+(.848013+oe*(.215638*oe-1.06021)))}const hi=ee.sub(W)._mult(At)._add(W)._unit()._mult(Ct?-1:1);this.addHalfVertex(O,hi.x,hi.y,!1,Ct,0,D)}}j&&this.addCurrentVertex(O,ee,-xt,-st,D)}else if(ut==="butt")this.addCurrentVertex(O,pe,0,0,D);else if(ut==="square"){const nt=U?1:-1;this.addCurrentVertex(O,pe,nt,nt,D)}else ut==="round"&&(U&&(this.addCurrentVertex(O,W,0,0,D),this.addCurrentVertex(O,W,1,1,D,!0)),j&&(this.addCurrentVertex(O,ee,-1,-1,D,!0),this.addCurrentVertex(O,ee,0,0,D)));if(_t&&re<T-1){const nt=O.dist(j);if(nt>2*P){const xt=O.add(j.sub(O)._mult(P/nt)._round());this.updateDistance(O,xt),this.addCurrentVertex(xt,ee,0,0,D),O=xt}}}}addCurrentVertex(e,n,o,c,m,g=!1){const b=n.y*c-n.x,T=-n.y-n.x*c;this.addHalfVertex(e,n.x+n.y*o,n.y-n.x*o,g,!1,o,m),this.addHalfVertex(e,b,T,g,!0,-c,m),this.distance>Id/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,n,o,c,m,g))}addHalfVertex({x:e,y:n},o,c,m,g,b,T){const C=.5*(this.lineClips?this.scaledDistance*(Id-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(n<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(b===0?0:b<0?-1:1)|(63&C)<<2,C>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const P=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),T.primitiveLength++),g?this.e2=P:this.e1=P}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}let Cd,Ed;ht("LineBucket",ih,{omit:["layers","patternFeatures"]});var kd={get paint(){return Ed=Ed||new On({"line-opacity":new Ht(ke.paint_line["line-opacity"]),"line-color":new Ht(ke.paint_line["line-color"]),"line-translate":new Ft(ke.paint_line["line-translate"]),"line-translate-anchor":new Ft(ke.paint_line["line-translate-anchor"]),"line-width":new Ht(ke.paint_line["line-width"]),"line-gap-width":new Ht(ke.paint_line["line-gap-width"]),"line-offset":new Ht(ke.paint_line["line-offset"]),"line-blur":new Ht(ke.paint_line["line-blur"]),"line-dasharray":new ic(ke.paint_line["line-dasharray"]),"line-pattern":new rl(ke.paint_line["line-pattern"]),"line-gradient":new nc(ke.paint_line["line-gradient"])})},get layout(){return Cd=Cd||new On({"line-cap":new Ft(ke.layout_line["line-cap"]),"line-join":new Ht(ke.layout_line["line-join"]),"line-miter-limit":new Ft(ke.layout_line["line-miter-limit"]),"line-round-limit":new Ft(ke.layout_line["line-round-limit"]),"line-sort-key":new Ht(ke.layout_line["line-sort-key"])})}};class qm extends Ht{possiblyEvaluate(e,n){return n=new hn(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,o,c){return n=zt({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,o,c)}}let uu;class Zm extends Co{constructor(e){super(e,kd),this.gradientVersion=0,uu||(uu=new qm(kd.paint.properties["line-width"].specification),uu.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof Ao,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,n){super.recalculate(e,n),this.paint._values["line-floorwidth"]=uu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new ih(e)}queryRadius(e){const n=e,o=Md(hc("line-width",this,n),hc("line-gap-width",this,n)),c=hc("line-offset",this,n);return o/2+Math.abs(c)+nu(this.paint.get("line-translate"))}queryIntersectsFeature(e,n,o,c,m,g,b){const T=ru(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,b),C=b/2*Md(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),P=this.paint.get("line-offset").evaluate(n,o);return P&&(c=function(D,O){const U=[];for(let j=0;j<D.length;j++){const W=D[j],ee=[];for(let re=0;re<W.length;re++){const pe=W[re-1],oe=W[re],ve=W[re+1],Se=re===0?new he(0,0):oe.sub(pe)._unit()._perp(),Be=re===W.length-1?new he(0,0):ve.sub(oe)._unit()._perp(),_t=Se._add(Be)._unit(),Ct=_t.x*Be.x+_t.y*Be.y;Ct!==0&&_t._mult(1/Ct),ee.push(_t._mult(O)._add(oe))}U.push(ee)}return U}(c,P*b)),function(D,O,U){for(let j=0;j<O.length;j++){const W=O[j];if(D.length>=3){for(let ee=0;ee<W.length;ee++)if(El(D,W[ee]))return!0}if(Jf(D,W,U))return!0}return!1}(T,c,C)}isTileClipped(){return!0}}function Md(i,e){return e>0?e+2*i:i}const Gm=xn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Wm=xn([{name:"a_projected_pos",components:3,type:"Float32"}],4);xn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Hm=xn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);xn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ad=xn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Xm=xn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Km(i,e,n){return i.sections.forEach(o=>{o.text=function(c,m,g){const b=m.layout.get("text-transform").evaluate(g,{});return b==="uppercase"?c=c.toLocaleUpperCase():b==="lowercase"&&(c=c.toLocaleLowerCase()),so.applyArabicShaping&&(c=so.applyArabicShaping(c)),c}(o.text,e,n)}),i}xn([{name:"triangle",components:3,type:"Uint16"}]),xn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),xn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),xn([{type:"Float32",name:"offsetX"}]),xn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),xn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const bc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Xn=24,Pd=Ji,Ld=function(i,e,n,o,c){var m,g,b=8*c-o-1,T=(1<<b)-1,C=T>>1,P=-7,D=n?c-1:0,O=n?-1:1,U=i[e+D];for(D+=O,m=U&(1<<-P)-1,U>>=-P,P+=b;P>0;m=256*m+i[e+D],D+=O,P-=8);for(g=m&(1<<-P)-1,m>>=-P,P+=o;P>0;g=256*g+i[e+D],D+=O,P-=8);if(m===0)m=1-C;else{if(m===T)return g?NaN:1/0*(U?-1:1);g+=Math.pow(2,o),m-=C}return(U?-1:1)*g*Math.pow(2,m-o)},zd=function(i,e,n,o,c,m){var g,b,T,C=8*m-c-1,P=(1<<C)-1,D=P>>1,O=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,U=o?0:m-1,j=o?1:-1,W=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(b=isNaN(e)?1:0,g=P):(g=Math.floor(Math.log(e)/Math.LN2),e*(T=Math.pow(2,-g))<1&&(g--,T*=2),(e+=g+D>=1?O/T:O*Math.pow(2,1-D))*T>=2&&(g++,T/=2),g+D>=P?(b=0,g=P):g+D>=1?(b=(e*T-1)*Math.pow(2,c),g+=D):(b=e*Math.pow(2,D-1)*Math.pow(2,c),g=0));c>=8;i[n+U]=255&b,U+=j,b/=256,c-=8);for(g=g<<c|b,C+=c;C>0;i[n+U]=255&g,U+=j,g/=256,C-=8);i[n+U-j]|=128*W};function Ji(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Ji.Varint=0,Ji.Fixed64=1,Ji.Bytes=2,Ji.Fixed32=5;var nh=4294967296,Dd=1/nh,Fd=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ra(i){return i.type===Ji.Bytes?i.readVarint()+i.pos:i.pos+1}function Pl(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Rd(i,e,n){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(o);for(var c=n.pos-1;c>=i;c--)n.buf[c+o]=n.buf[c]}function Jm(i,e){for(var n=0;n<i.length;n++)e.writeVarint(i[n])}function Ym(i,e){for(var n=0;n<i.length;n++)e.writeSVarint(i[n])}function Qm(i,e){for(var n=0;n<i.length;n++)e.writeFloat(i[n])}function $m(i,e){for(var n=0;n<i.length;n++)e.writeDouble(i[n])}function e_(i,e){for(var n=0;n<i.length;n++)e.writeBoolean(i[n])}function t_(i,e){for(var n=0;n<i.length;n++)e.writeFixed32(i[n])}function i_(i,e){for(var n=0;n<i.length;n++)e.writeSFixed32(i[n])}function n_(i,e){for(var n=0;n<i.length;n++)e.writeFixed64(i[n])}function r_(i,e){for(var n=0;n<i.length;n++)e.writeSFixed64(i[n])}function hu(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Ll(i,e,n){i[n]=e,i[n+1]=e>>>8,i[n+2]=e>>>16,i[n+3]=e>>>24}function Od(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}Ji.prototype={destroy:function(){this.buf=null},readFields:function(i,e,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),c=o>>3,m=this.pos;this.type=7&o,i(c,e,this),this.pos===m&&this.skip(o)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=hu(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Od(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=hu(this.buf,this.pos)+hu(this.buf,this.pos+4)*nh;return this.pos+=8,i},readSFixed64:function(){var i=hu(this.buf,this.pos)+Od(this.buf,this.pos+4)*nh;return this.pos+=8,i},readFloat:function(){var i=Ld(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Ld(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,n,o=this.buf;return e=127&(n=o[this.pos++]),n<128?e:(e|=(127&(n=o[this.pos++]))<<7,n<128?e:(e|=(127&(n=o[this.pos++]))<<14,n<128?e:(e|=(127&(n=o[this.pos++]))<<21,n<128?e:function(c,m,g){var b,T,C=g.buf;if(b=(112&(T=C[g.pos++]))>>4,T<128||(b|=(127&(T=C[g.pos++]))<<3,T<128)||(b|=(127&(T=C[g.pos++]))<<10,T<128)||(b|=(127&(T=C[g.pos++]))<<17,T<128)||(b|=(127&(T=C[g.pos++]))<<24,T<128)||(b|=(1&(T=C[g.pos++]))<<31,T<128))return Pl(c,b,m);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=o[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Fd?function(n,o,c){return Fd.decode(n.subarray(o,c))}(this.buf,e,i):function(n,o,c){for(var m="",g=o;g<c;){var b,T,C,P=n[g],D=null,O=P>239?4:P>223?3:P>191?2:1;if(g+O>c)break;O===1?P<128&&(D=P):O===2?(192&(b=n[g+1]))==128&&(D=(31&P)<<6|63&b)<=127&&(D=null):O===3?(T=n[g+2],(192&(b=n[g+1]))==128&&(192&T)==128&&((D=(15&P)<<12|(63&b)<<6|63&T)<=2047||D>=55296&&D<=57343)&&(D=null)):O===4&&(T=n[g+2],C=n[g+3],(192&(b=n[g+1]))==128&&(192&T)==128&&(192&C)==128&&((D=(15&P)<<18|(63&b)<<12|(63&T)<<6|63&C)<=65535||D>=1114112)&&(D=null)),D===null?(D=65533,O=1):D>65535&&(D-=65536,m+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),m+=String.fromCharCode(D),g+=O}return m}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Ji.Bytes)return i.push(this.readVarint(e));var n=ra(this);for(i=i||[];this.pos<n;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Ji.Bytes)return i.push(this.readSVarint());var e=ra(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Ji.Bytes)return i.push(this.readBoolean());var e=ra(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Ji.Bytes)return i.push(this.readFloat());var e=ra(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Ji.Bytes)return i.push(this.readDouble());var e=ra(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Ji.Bytes)return i.push(this.readFixed32());var e=ra(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Ji.Bytes)return i.push(this.readSFixed32());var e=ra(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Ji.Bytes)return i.push(this.readFixed64());var e=ra(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Ji.Bytes)return i.push(this.readSFixed64());var e=ra(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Ji.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ji.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ji.Fixed32)this.pos+=4;else{if(e!==Ji.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Ll(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Ll(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Ll(this.buf,-1&i,this.pos),Ll(this.buf,Math.floor(i*Dd),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Ll(this.buf,-1&i,this.pos),Ll(this.buf,Math.floor(i*Dd),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,n){var o,c;if(e>=0?(o=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(m,g,b){b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,b.buf[b.pos]=127&(m>>>=7)}(o,0,n),function(m,g){var b=(7&m)<<4;g.buf[g.pos++]|=b|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))}(c,n)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(o,c,m){for(var g,b,T=0;T<c.length;T++){if((g=c.charCodeAt(T))>55295&&g<57344){if(!b){g>56319||T+1===c.length?(o[m++]=239,o[m++]=191,o[m++]=189):b=g;continue}if(g<56320){o[m++]=239,o[m++]=191,o[m++]=189,b=g;continue}g=b-55296<<10|g-56320|65536,b=null}else b&&(o[m++]=239,o[m++]=191,o[m++]=189,b=null);g<128?o[m++]=g:(g<2048?o[m++]=g>>6|192:(g<65536?o[m++]=g>>12|224:(o[m++]=g>>18|240,o[m++]=g>>12&63|128),o[m++]=g>>6&63|128),o[m++]=63&g|128)}return m}(this.buf,i,this.pos);var n=this.pos-e;n>=128&&Rd(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(i){this.realloc(4),zd(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),zd(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=i[n]},writeRawMessage:function(i,e){this.pos++;var n=this.pos;i(e,this);var o=this.pos-n;o>=128&&Rd(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(i,e,n){this.writeTag(i,Ji.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Jm,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Ym,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,e_,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Qm,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,$m,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,t_,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,i_,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,n_,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,r_,e)},writeBytesField:function(i,e){this.writeTag(i,Ji.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Ji.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Ji.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Ji.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Ji.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Ji.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Ji.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Ji.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Ji.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Ji.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var rh=M(Pd);const oh=3;function o_(i,e,n){i===1&&n.readMessage(s_,e)}function s_(i,e,n){if(i===3){const{id:o,bitmap:c,width:m,height:g,left:b,top:T,advance:C}=n.readMessage(a_,{});e.push({id:o,bitmap:new pc({width:m+2*oh,height:g+2*oh},c),metrics:{width:m,height:g,left:b,top:T,advance:C}})}}function a_(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}const Bd=oh;function Nd(i){let e=0,n=0;for(const g of i)e+=g.w*g.h,n=Math.max(n,g.w);i.sort((g,b)=>b.h-g.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let c=0,m=0;for(const g of i)for(let b=o.length-1;b>=0;b--){const T=o[b];if(!(g.w>T.w||g.h>T.h)){if(g.x=T.x,g.y=T.y,m=Math.max(m,g.y+g.h),c=Math.max(c,g.x+g.w),g.w===T.w&&g.h===T.h){const C=o.pop();b<o.length&&(o[b]=C)}else g.h===T.h?(T.x+=g.w,T.w-=g.w):g.w===T.w?(T.y+=g.h,T.h-=g.h):(o.push({x:T.x+g.w,y:T.y,w:T.w-g.w,h:g.h}),T.y+=g.h,T.h-=g.h);break}}return{w:c,h:m,fill:e/(c*m)||0}}const lo=1;class sh{constructor(e,{pixelRatio:n,version:o,stretchX:c,stretchY:m,content:g}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=c,this.stretchY=m,this.content=g,this.version=o}get tl(){return[this.paddedRect.x+lo,this.paddedRect.y+lo]}get br(){return[this.paddedRect.x+this.paddedRect.w-lo,this.paddedRect.y+this.paddedRect.h-lo]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*lo)/this.pixelRatio,(this.paddedRect.h-2*lo)/this.pixelRatio]}}class Vd{constructor(e,n){const o={},c={};this.haveRenderCallbacks=[];const m=[];this.addImages(e,o,m),this.addImages(n,c,m);const{w:g,h:b}=Nd(m),T=new Fo({width:g||1,height:b||1});for(const C in e){const P=e[C],D=o[C].paddedRect;Fo.copy(P.data,T,{x:0,y:0},{x:D.x+lo,y:D.y+lo},P.data)}for(const C in n){const P=n[C],D=c[C].paddedRect,O=D.x+lo,U=D.y+lo,j=P.data.width,W=P.data.height;Fo.copy(P.data,T,{x:0,y:0},{x:O,y:U},P.data),Fo.copy(P.data,T,{x:0,y:W-1},{x:O,y:U-1},{width:j,height:1}),Fo.copy(P.data,T,{x:0,y:0},{x:O,y:U+W},{width:j,height:1}),Fo.copy(P.data,T,{x:j-1,y:0},{x:O-1,y:U},{width:1,height:W}),Fo.copy(P.data,T,{x:0,y:0},{x:O+j,y:U},{width:1,height:W})}this.image=T,this.iconPositions=o,this.patternPositions=c}addImages(e,n,o){for(const c in e){const m=e[c],g={x:0,y:0,w:m.data.width+2*lo,h:m.data.height+2*lo};o.push(g),n[c]=new sh(g,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),n)}patchUpdatedImage(e,n,o){if(!e||!n||e.version===n.version)return;e.version=n.version;const[c,m]=e.tl;o.update(n.data,void 0,{x:c,y:m})}}var Ua;ht("ImagePosition",sh),ht("ImageAtlas",Vd),s.ai=void 0,(Ua=s.ai||(s.ai={}))[Ua.none=0]="none",Ua[Ua.horizontal=1]="horizontal",Ua[Ua.vertical=2]="vertical",Ua[Ua.horizontalOnly=3]="horizontalOnly";const xc=-17;class wc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const o=new wc;return o.scale=e||1,o.fontStack=n,o}static forImage(e){const n=new wc;return n.imageName=e,n}}class zl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const o=new zl;for(let c=0;c<e.sections.length;c++){const m=e.sections[c];m.image?o.addImageSection(m):o.addTextSection(m,n)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let n="";for(let o=0;o<e.length;o++){const c=e.charCodeAt(o+1)||null,m=e.charCodeAt(o-1)||null;n+=c&&Js(c)&&!bc[e[o+1]]||m&&Js(m)&&!bc[e[o-1]]||!bc[e[o]]?e[o]:bc[e[o]]}return n}(this.text)}trim(){let e=0;for(let o=0;o<this.text.length&&pu[this.text.charCodeAt(o)];o++)e++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&pu[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const o=new zl;return o.text=this.text.substring(e,n),o.sectionIndex=this.sectionIndex.slice(e,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(wc.forText(e.scale,e.fontStack||n));const o=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(o)}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void $e("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(wc.forImage(n)),this.sectionIndex.push(this.sections.length-1)):$e("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function du(i,e,n,o,c,m,g,b,T,C,P,D,O,U,j,W){const ee=zl.fromFeature(i,c);let re;D===s.ai.vertical&&ee.verticalizePunctuation();const{processBidirectionalText:pe,processStyledBidirectionalText:oe}=so;if(pe&&ee.sections.length===1){re=[];const Be=pe(ee.toString(),ah(ee,C,m,e,o,U,j));for(const _t of Be){const Ct=new zl;Ct.text=_t,Ct.sections=ee.sections;for(let mt=0;mt<_t.length;mt++)Ct.sectionIndex.push(0);re.push(Ct)}}else if(oe){re=[];const Be=oe(ee.text,ee.sectionIndex,ah(ee,C,m,e,o,U,j));for(const _t of Be){const Ct=new zl;Ct.text=_t[0],Ct.sectionIndex=_t[1],Ct.sections=ee.sections,re.push(Ct)}}else re=function(Be,_t){const Ct=[],mt=Be.text;let ut=0;for(const nt of _t)Ct.push(Be.substring(ut,nt)),ut=nt;return ut<mt.length&&Ct.push(Be.substring(ut,mt.length)),Ct}(ee,ah(ee,C,m,e,o,U,j));const ve=[],Se={positionedLines:ve,text:ee.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:D,iconsInText:!1,verticalizable:!1};return function(Be,_t,Ct,mt,ut,nt,xt,st,He,qt,At,hi){let pn=0,vn=xc,Kn=0,ko=0;const Hr=st==="right"?1:st==="left"?0:.5;let Zn=0;for(const Jn of ut){Jn.trim();const Yn=Jn.getMaxScale(),zr=(Yn-1)*Xn,Jr={positionedGlyphs:[],lineOffset:0};Be.positionedLines[Zn]=Jr;const Dr=Jr.positionedGlyphs;let co=0;if(!Jn.length()){vn+=nt,++Zn;continue}for(let Qn=0;Qn<Jn.length();Qn++){const Ti=Jn.getSection(Qn),Fr=Jn.getSectionIndex(Qn),Cr=Jn.getCharCode(Qn);let $n=0,ts=null,_s=null,gs=null,oa=Xn;const is=!(He===s.ai.horizontal||!At&&!Ps(Cr)||At&&(pu[Cr]||(fr=Cr,ot.Arabic(fr)||ot["Arabic Supplement"](fr)||ot["Arabic Extended-A"](fr)||ot["Arabic Presentation Forms-A"](fr)||ot["Arabic Presentation Forms-B"](fr))));if(Ti.imageName){const Oo=mt[Ti.imageName];if(!Oo)continue;gs=Ti.imageName,Be.iconsInText=Be.iconsInText||!0,_s=Oo.paddedRect;const ho=Oo.displaySize;Ti.scale=Ti.scale*Xn/hi,ts={width:ho[0],height:ho[1],left:lo,top:-Bd,advance:is?ho[1]:ho[0]},$n=zr+(Xn-ho[1]*Ti.scale),oa=ts.advance;const sa=is?ho[0]*Ti.scale-Xn*Yn:ho[1]*Ti.scale-Xn*Yn;sa>0&&sa>co&&(co=sa)}else{const Oo=Ct[Ti.fontStack],ho=Oo&&Oo[Cr];if(ho&&ho.rect)_s=ho.rect,ts=ho.metrics;else{const sa=_t[Ti.fontStack],Ec=sa&&sa[Cr];if(!Ec)continue;ts=Ec.metrics}$n=(Yn-Ti.scale)*Xn}is?(Be.verticalizable=!0,Dr.push({glyph:Cr,imageName:gs,x:pn,y:vn+$n,vertical:is,scale:Ti.scale,fontStack:Ti.fontStack,sectionIndex:Fr,metrics:ts,rect:_s}),pn+=oa*Ti.scale+qt):(Dr.push({glyph:Cr,imageName:gs,x:pn,y:vn+$n,vertical:is,scale:Ti.scale,fontStack:Ti.fontStack,sectionIndex:Fr,metrics:ts,rect:_s}),pn+=ts.advance*Ti.scale+qt)}Dr.length!==0&&(Kn=Math.max(pn-qt,Kn),u_(Dr,0,Dr.length-1,Hr,co)),pn=0;const uo=nt*Yn+co;Jr.lineOffset=Math.max(co,zr),vn+=uo,ko=Math.max(uo,ko),++Zn}var fr;const Ir=vn-xc,{horizontalAlign:Xr,verticalAlign:Kr}=lh(xt);(function(Jn,Yn,zr,Jr,Dr,co,uo,Qn,Ti){const Fr=(Yn-zr)*Dr;let Cr=0;Cr=co!==uo?-Qn*Jr-xc:(-Jr*Ti+.5)*uo;for(const $n of Jn)for(const ts of $n.positionedGlyphs)ts.x+=Fr,ts.y+=Cr})(Be.positionedLines,Hr,Xr,Kr,Kn,ko,nt,Ir,ut.length),Be.top+=-Kr*Ir,Be.bottom=Be.top+Ir,Be.left+=-Xr*Kn,Be.right=Be.left+Kn}(Se,e,n,o,re,g,b,T,D,C,O,W),!function(Be){for(const _t of Be)if(_t.positionedGlyphs.length!==0)return!1;return!0}(ve)&&Se}const pu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},l_={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ud(i,e,n,o,c,m){if(e.imageName){const g=o[e.imageName];return g?g.displaySize[0]*e.scale*Xn/m+c:0}{const g=n[e.fontStack],b=g&&g[i];return b?b.metrics.advance*e.scale+c:0}}function jd(i,e,n,o){const c=Math.pow(i-e,2);return o?i<e?c/2:2*c:c+Math.abs(n)*n}function c_(i,e,n){let o=0;return i===10&&(o-=1e4),n&&(o+=150),i!==40&&i!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function qd(i,e,n,o,c,m){let g=null,b=jd(e,n,c,m);for(const T of o){const C=jd(e-T.x,n,c,m)+T.badness;C<=b&&(g=T,b=C)}return{index:i,x:e,priorBreak:g,badness:b}}function Zd(i){return i?Zd(i.priorBreak).concat(i.index):[]}function ah(i,e,n,o,c,m,g){if(m!=="point")return[];if(!i)return[];const b=[],T=function(O,U,j,W,ee,re){let pe=0;for(let oe=0;oe<O.length();oe++){const ve=O.getSection(oe);pe+=Ud(O.getCharCode(oe),ve,W,ee,U,re)}return pe/Math.max(1,Math.ceil(pe/j))}(i,e,n,o,c,g),C=i.text.indexOf("")>=0;let P=0;for(let O=0;O<i.length();O++){const U=i.getSection(O),j=i.getCharCode(O);if(pu[j]||(P+=Ud(j,U,o,c,e,g)),O<i.length()-1){const W=!((D=j)<11904||!(ot["Bopomofo Extended"](D)||ot.Bopomofo(D)||ot["CJK Compatibility Forms"](D)||ot["CJK Compatibility Ideographs"](D)||ot["CJK Compatibility"](D)||ot["CJK Radicals Supplement"](D)||ot["CJK Strokes"](D)||ot["CJK Symbols and Punctuation"](D)||ot["CJK Unified Ideographs Extension A"](D)||ot["CJK Unified Ideographs"](D)||ot["Enclosed CJK Letters and Months"](D)||ot["Halfwidth and Fullwidth Forms"](D)||ot.Hiragana(D)||ot["Ideographic Description Characters"](D)||ot["Kangxi Radicals"](D)||ot["Katakana Phonetic Extensions"](D)||ot.Katakana(D)||ot["Vertical Forms"](D)||ot["Yi Radicals"](D)||ot["Yi Syllables"](D)));(l_[j]||W||U.imageName)&&b.push(qd(O+1,P,T,b,c_(j,i.getCharCode(O+1),W&&C),!1))}}var D;return Zd(qd(i.length(),P,T,b,0,!0))}function lh(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function u_(i,e,n,o,c){if(!o&&!c)return;const m=i[n],g=(i[n].x+m.metrics.advance*m.scale)*o;for(let b=e;b<=n;b++)i[b].x-=g,i[b].y+=c}function h_(i,e,n){const{horizontalAlign:o,verticalAlign:c}=lh(n),m=e[0]-i.displaySize[0]*o,g=e[1]-i.displaySize[1]*c;return{image:i,top:g,bottom:g+i.displaySize[1],left:m,right:m+i.displaySize[0]}}function Gd(i,e,n,o,c,m){const g=i.image;let b;if(g.content){const ee=g.content,re=g.pixelRatio||1;b=[ee[0]/re,ee[1]/re,g.displaySize[0]-ee[2]/re,g.displaySize[1]-ee[3]/re]}const T=e.left*m,C=e.right*m;let P,D,O,U;n==="width"||n==="both"?(U=c[0]+T-o[3],D=c[0]+C+o[1]):(U=c[0]+(T+C-g.displaySize[0])/2,D=U+g.displaySize[0]);const j=e.top*m,W=e.bottom*m;return n==="height"||n==="both"?(P=c[1]+j-o[0],O=c[1]+W+o[2]):(P=c[1]+(j+W-g.displaySize[1])/2,O=P+g.displaySize[1]),{image:g,top:P,right:D,bottom:O,left:U,collisionPadding:b}}const Sc=255,Ds=128,ja=Sc*Ds;function Wd(i,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new hn(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:c}=n;let m=0;for(;m<o.length&&o[m]<=i;)m++;m=Math.max(0,m-1);let g=m;for(;g<o.length&&o[g]<i+1;)g++;g=Math.min(o.length-1,g);const b=o[m],T=o[g];return n.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:T,interpolationType:c}:{kind:"camera",minZoom:b,maxZoom:T,minSize:n.evaluate(new hn(b)),maxSize:n.evaluate(new hn(T)),interpolationType:c}}}function ch(i,e,n){let o="never";const c=i.get(e);return c?o=c:i.get(n)&&(o="always"),o}const d_=Va.VectorTileFeature.types,p_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function fu(i,e,n,o,c,m,g,b,T,C,P,D,O){const U=b?Math.min(ja,Math.round(b[0])):0,j=b?Math.min(ja,Math.round(b[1])):0;i.emplaceBack(e,n,Math.round(32*o),Math.round(32*c),m,g,(U<<1)+(T?1:0),j,16*C,16*P,256*D,256*O)}function uh(i,e,n){i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n)}function f_(i){for(const e of i.sections)if(Ra(e.text))return!0;return!1}class hh{constructor(e){this.layoutVertexArray=new pi,this.indexArray=new dr,this.programConfigurations=e,this.segments=new dn,this.dynamicLayoutVertexArray=new li,this.opacityVertexArray=new gi,this.hasVisibleVertices=!1,this.placedSymbolArray=new ue}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,o,c){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Gm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Wm.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,p_,!0),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ht("SymbolBuffers",hh);class dh{constructor(e,n,o){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new o,this.segments=new dn,this.collisionVertexArray=new rn}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Hm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ht("CollisionBuffers",dh);class Dl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=qu([]),this.placementViewportMatrix=qu([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Wd(this.zoom,n["text-size"]),this.iconSizeData=Wd(this.zoom,n["icon-size"]);const o=this.layers[0].layout,c=o.get("symbol-sort-key"),m=o.get("symbol-z-order");this.canOverlap=ch(o,"text-overlap","text-allow-overlap")!=="never"||ch(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(g=>s.ai[g])),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID}createArrays(){this.text=new hh(new ms(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new hh(new ms(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new de,this.lineVertexArray=new Ie,this.symbolInstances=new te,this.textAnchorOffsets=new Oe}calculateGlyphDependencies(e,n,o,c,m){for(let g=0;g<e.length;g++)if(n[e.charCodeAt(g)]=!0,(o||c)&&m){const b=bc[e.charAt(g)];b&&(n[b.charCodeAt(0)]=!0)}}populate(e,n,o){const c=this.layers[0],m=c.layout,g=m.get("text-font"),b=m.get("text-field"),T=m.get("icon-image"),C=(b.value.kind!=="constant"||b.value.value instanceof nn&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),P=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,D=m.get("symbol-sort-key");if(this.features=[],!C&&!P)return;const O=n.iconDependencies,U=n.glyphDependencies,j=n.availableImages,W=new hn(this.zoom);for(const{feature:ee,id:re,index:pe,sourceLayerIndex:oe}of e){const ve=c._featureFilter.needGeometry,Se=ll(ee,ve);if(!c._featureFilter.filter(W,Se,o))continue;let Be,_t;if(ve||(Se.geometry=al(ee)),C){const mt=c.getValueAndResolveTokens("text-field",Se,o,j),ut=nn.factory(mt);f_(ut)&&(this.hasRTLText=!0),(!this.hasRTLText||ec()==="unavailable"||this.hasRTLText&&so.isParsed())&&(Be=Km(ut,c,Se))}if(P){const mt=c.getValueAndResolveTokens("icon-image",Se,o,j);_t=mt instanceof jn?mt:jn.fromString(mt)}if(!Be&&!_t)continue;const Ct=this.sortFeaturesByKey?D.evaluate(Se,{},o):void 0;if(this.features.push({id:re,text:Be,icon:_t,index:pe,sourceLayerIndex:oe,geometry:Se.geometry,properties:ee.properties,type:d_[ee.type],sortKey:Ct}),_t&&(O[_t.name]=!0),Be){const mt=g.evaluate(Se,{},o).join(","),ut=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(s.ai.vertical)>=0;for(const nt of Be.sections)if(nt.image)O[nt.image.name]=!0;else{const xt=Fa(Be.toString()),st=nt.fontStack||mt,He=U[st]=U[st]||{};this.calculateGlyphDependencies(nt.text,He,ut,this.allowVerticalPlacement,xt)}}}m.get("symbol-placement")==="line"&&(this.features=function(ee){const re={},pe={},oe=[];let ve=0;function Se(mt){oe.push(ee[mt]),ve++}function Be(mt,ut,nt){const xt=pe[mt];return delete pe[mt],pe[ut]=xt,oe[xt].geometry[0].pop(),oe[xt].geometry[0]=oe[xt].geometry[0].concat(nt[0]),xt}function _t(mt,ut,nt){const xt=re[ut];return delete re[ut],re[mt]=xt,oe[xt].geometry[0].shift(),oe[xt].geometry[0]=nt[0].concat(oe[xt].geometry[0]),xt}function Ct(mt,ut,nt){const xt=nt?ut[0][ut[0].length-1]:ut[0][0];return`${mt}:${xt.x}:${xt.y}`}for(let mt=0;mt<ee.length;mt++){const ut=ee[mt],nt=ut.geometry,xt=ut.text?ut.text.toString():null;if(!xt){Se(mt);continue}const st=Ct(xt,nt),He=Ct(xt,nt,!0);if(st in pe&&He in re&&pe[st]!==re[He]){const qt=_t(st,He,nt),At=Be(st,He,oe[qt].geometry);delete re[st],delete pe[He],pe[Ct(xt,oe[At].geometry,!0)]=At,oe[qt].geometry=null}else st in pe?Be(st,He,nt):He in re?_t(st,He,nt):(Se(mt),re[st]=ve-1,pe[He]=ve-1)}return oe.filter(mt=>mt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ee,re)=>ee.sortKey-re.sortKey)}update(e,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,o),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const o=this.lineVertexArray.length;if(e.segment!==void 0){let c=e.dist(n[e.segment+1]),m=e.dist(n[e.segment]);const g={};for(let b=e.segment+1;b<n.length;b++)g[b]={x:n[b].x,y:n[b].y,tileUnitDistanceFromAnchor:c},b<n.length-1&&(c+=n[b+1].dist(n[b]));for(let b=e.segment||0;b>=0;b--)g[b]={x:n[b].x,y:n[b].y,tileUnitDistanceFromAnchor:m},b>0&&(m+=n[b-1].dist(n[b]));for(let b=0;b<n.length;b++){const T=g[b];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,n,o,c,m,g,b,T,C,P,D,O){const U=e.indexArray,j=e.layoutVertexArray,W=e.segments.prepareSegment(4*n.length,j,U,this.canOverlap?g.sortKey:void 0),ee=this.glyphOffsetArray.length,re=W.vertexLength,pe=this.allowVerticalPlacement&&b===s.ai.vertical?Math.PI/2:0,oe=g.text&&g.text.sections;for(let ve=0;ve<n.length;ve++){const{tl:Se,tr:Be,bl:_t,br:Ct,tex:mt,pixelOffsetTL:ut,pixelOffsetBR:nt,minFontScaleX:xt,minFontScaleY:st,glyphOffset:He,isSDF:qt,sectionIndex:At}=n[ve],hi=W.vertexLength,pn=He[1];fu(j,T.x,T.y,Se.x,pn+Se.y,mt.x,mt.y,o,qt,ut.x,ut.y,xt,st),fu(j,T.x,T.y,Be.x,pn+Be.y,mt.x+mt.w,mt.y,o,qt,nt.x,ut.y,xt,st),fu(j,T.x,T.y,_t.x,pn+_t.y,mt.x,mt.y+mt.h,o,qt,ut.x,nt.y,xt,st),fu(j,T.x,T.y,Ct.x,pn+Ct.y,mt.x+mt.w,mt.y+mt.h,o,qt,nt.x,nt.y,xt,st),uh(e.dynamicLayoutVertexArray,T,pe),U.emplaceBack(hi,hi+1,hi+2),U.emplaceBack(hi+1,hi+2,hi+3),W.vertexLength+=4,W.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(He[0]),ve!==n.length-1&&At===n[ve+1].sectionIndex||e.programConfigurations.populatePaintArrays(j.length,g,g.index,{},O,oe&&oe[At])}e.placedSymbolArray.emplaceBack(T.x,T.y,ee,this.glyphOffsetArray.length-ee,re,C,P,T.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],b,0,!1,0,D)}_addCollisionDebugVertex(e,n,o,c,m,g){return n.emplaceBack(0,0),e.emplaceBack(o.x,o.y,c,m,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(e,n,o,c,m,g,b){const T=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),C=T.vertexLength,P=m.layoutVertexArray,D=m.collisionVertexArray,O=b.anchorX,U=b.anchorY;this._addCollisionDebugVertex(P,D,g,O,U,new he(e,n)),this._addCollisionDebugVertex(P,D,g,O,U,new he(o,n)),this._addCollisionDebugVertex(P,D,g,O,U,new he(o,c)),this._addCollisionDebugVertex(P,D,g,O,U,new he(e,c)),T.vertexLength+=4;const j=m.indexArray;j.emplaceBack(C,C+1),j.emplaceBack(C+1,C+2),j.emplaceBack(C+2,C+3),j.emplaceBack(C+3,C),T.primitiveLength+=4}addDebugCollisionBoxes(e,n,o,c){for(let m=e;m<n;m++){const g=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,c?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new dh(Mn,Ad.members,Wn),this.iconCollisionBox=new dh(Mn,Ad.members,Wn);for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(e,n,o,c,m,g,b,T,C){const P={};for(let D=n;D<o;D++){const O=e.get(D);P.textBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},P.textFeatureIndex=O.featureIndex;break}for(let D=c;D<m;D++){const O=e.get(D);P.verticalTextBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},P.verticalTextFeatureIndex=O.featureIndex;break}for(let D=g;D<b;D++){const O=e.get(D);P.iconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},P.iconFeatureIndex=O.featureIndex;break}for(let D=T;D<C;D++){const O=e.get(D);P.verticalIconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},P.verticalIconFeatureIndex=O.featureIndex;break}return P}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const o=e.placedSymbolArray.get(n),c=o.vertexStartIndex+4*o.numGlyphs;for(let m=o.vertexStartIndex;m<c;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),o=Math.cos(e),c=[],m=[],g=[];for(let b=0;b<this.symbolInstances.length;++b){g.push(b);const T=this.symbolInstances.get(b);c.push(0|Math.round(n*T.anchorX+o*T.anchorY)),m.push(T.featureIndex)}return g.sort((b,T)=>c[b]-c[T]||m[T]-m[b]),g}addToSortKeyRanges(e,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((c,m,g)=>{c>=0&&g.indexOf(c)===m&&this.addIndicesForPlacedSymbol(this.text,c)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Hd,Xd;ht("SymbolBucket",Dl,{omit:["layers","collisionBoxArray","features","compareText"]}),Dl.MAX_GLYPHS=65535,Dl.addDynamicAttributes=uh;var ph={get paint(){return Xd=Xd||new On({"icon-opacity":new Ht(ke.paint_symbol["icon-opacity"]),"icon-color":new Ht(ke.paint_symbol["icon-color"]),"icon-halo-color":new Ht(ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ht(ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ht(ke.paint_symbol["icon-halo-blur"]),"icon-translate":new Ft(ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ft(ke.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ht(ke.paint_symbol["text-opacity"]),"text-color":new Ht(ke.paint_symbol["text-color"],{runtimeType:ir,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Ht(ke.paint_symbol["text-halo-color"]),"text-halo-width":new Ht(ke.paint_symbol["text-halo-width"]),"text-halo-blur":new Ht(ke.paint_symbol["text-halo-blur"]),"text-translate":new Ft(ke.paint_symbol["text-translate"]),"text-translate-anchor":new Ft(ke.paint_symbol["text-translate-anchor"])})},get layout(){return Hd=Hd||new On({"symbol-placement":new Ft(ke.layout_symbol["symbol-placement"]),"symbol-spacing":new Ft(ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ft(ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ht(ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ft(ke.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ft(ke.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ft(ke.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ft(ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ft(ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ft(ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ht(ke.layout_symbol["icon-size"]),"icon-text-fit":new Ft(ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ft(ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ht(ke.layout_symbol["icon-image"]),"icon-rotate":new Ht(ke.layout_symbol["icon-rotate"]),"icon-padding":new Ht(ke.layout_symbol["icon-padding"]),"icon-keep-upright":new Ft(ke.layout_symbol["icon-keep-upright"]),"icon-offset":new Ht(ke.layout_symbol["icon-offset"]),"icon-anchor":new Ht(ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ft(ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ft(ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ft(ke.layout_symbol["text-rotation-alignment"]),"text-field":new Ht(ke.layout_symbol["text-field"]),"text-font":new Ht(ke.layout_symbol["text-font"]),"text-size":new Ht(ke.layout_symbol["text-size"]),"text-max-width":new Ht(ke.layout_symbol["text-max-width"]),"text-line-height":new Ft(ke.layout_symbol["text-line-height"]),"text-letter-spacing":new Ht(ke.layout_symbol["text-letter-spacing"]),"text-justify":new Ht(ke.layout_symbol["text-justify"]),"text-radial-offset":new Ht(ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ft(ke.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ht(ke.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ht(ke.layout_symbol["text-anchor"]),"text-max-angle":new Ft(ke.layout_symbol["text-max-angle"]),"text-writing-mode":new Ft(ke.layout_symbol["text-writing-mode"]),"text-rotate":new Ht(ke.layout_symbol["text-rotate"]),"text-padding":new Ft(ke.layout_symbol["text-padding"]),"text-keep-upright":new Ft(ke.layout_symbol["text-keep-upright"]),"text-transform":new Ht(ke.layout_symbol["text-transform"]),"text-offset":new Ht(ke.layout_symbol["text-offset"]),"text-allow-overlap":new Ft(ke.layout_symbol["text-allow-overlap"]),"text-overlap":new Ft(ke.layout_symbol["text-overlap"]),"text-ignore-placement":new Ft(ke.layout_symbol["text-ignore-placement"]),"text-optional":new Ft(ke.layout_symbol["text-optional"])})}};class Kd{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:gr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ht("FormatSectionOverride",Kd,{omit:["defaultValue"]});class mu extends Co{constructor(e){super(e,ph)}recalculate(e,n){if(super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const c=[];for(const m of o)c.indexOf(m)<0&&c.push(m);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,n,o,c){const m=this.layout.get(e).evaluate(n,{},o,c),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||no(g.value)||!m?m:function(b,T){return T.replace(/{([^{}]+)}/g,(C,P)=>b&&P in b?String(b[P]):"")}(n.properties,m)}createBucket(e){return new Dl(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of ph.paint.overridableProperties){if(!mu.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),o=new Kd(n),c=new Is(o,n.property.specification);let m=null;m=n.value.kind==="constant"||n.value.kind==="source"?new Cs("source",c):new Wo("composite",c,n.value.zoomStops),this.paint._values[e]=new Pr(n.property,m,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&mu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const o=e.get("text-field"),c=ph.paint.properties[n];let m=!1;const g=b=>{for(const T of b)if(c.overrides&&c.overrides.hasOverride(T))return void(m=!0)};if(o.value.kind==="constant"&&o.value.value instanceof nn)g(o.value.value.sections);else if(o.value.kind==="source"){const b=C=>{m||(C instanceof Mo&&on(C.value)===K?g(C.value.sections):C instanceof qs?g(C.sections):C.eachChild(b))},T=o.value;T._styleExpression&&b(T._styleExpression.expression)}return m}}let Jd;var m_={get paint(){return Jd=Jd||new On({"background-color":new Ft(ke.paint_background["background-color"]),"background-pattern":new ic(ke.paint_background["background-pattern"]),"background-opacity":new Ft(ke.paint_background["background-opacity"])})}};class __ extends Co{constructor(e){super(e,m_)}}let Yd;var g_={get paint(){return Yd=Yd||new On({"raster-opacity":new Ft(ke.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ft(ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ft(ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ft(ke.paint_raster["raster-brightness-max"]),"raster-saturation":new Ft(ke.paint_raster["raster-saturation"]),"raster-contrast":new Ft(ke.paint_raster["raster-contrast"]),"raster-resampling":new Ft(ke.paint_raster["raster-resampling"]),"raster-fade-duration":new Ft(ke.paint_raster["raster-fade-duration"])})}};class y_ extends Co{constructor(e){super(e,g_)}}class v_ extends Co{constructor(e){super(e,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class b_{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const fh=63710088e-1;class qa{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new qa(yt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,o=this.lat*n,c=e.lat*n,m=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((e.lng-this.lng)*n);return fh*Math.acos(Math.min(m,1))}static convert(e){if(e instanceof qa)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new qa(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new qa(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Qd=2*Math.PI*fh;function $d(i){return Qd*Math.cos(i*Math.PI/180)}function ep(i){return(180+i)/360}function tp(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function ip(i,e){return i/$d(e)}function np(i){return 360*i-180}function mh(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class _u{constructor(e,n,o=0){this.x=+e,this.y=+n,this.z=+o}static fromLngLat(e,n=0){const o=qa.convert(e);return new _u(ep(o.lng),tp(o.lat),ip(n,o.lat))}toLngLat(){return new qa(np(this.x),mh(this.y))}toAltitude(){return this.z*$d(mh(this.y))}meterInMercatorCoordinateUnits(){return 1/Qd*(e=mh(this.y),1/Math.cos(e*Math.PI/180));var e}}function rp(i,e,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[i*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class _h{constructor(e,n,o){if(e<0||e>25||o<0||o>=Math.pow(2,e)||n<0||n>=Math.pow(2,e))throw new Error(`x=${n}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=n,this.y=o,this.key=Tc(0,e,e,n,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n,o){const c=(g=this.y,b=this.z,T=rp(256*(m=this.x),256*(g=Math.pow(2,b)-g-1),b),C=rp(256*(m+1),256*(g+1),b),T[0]+","+T[1]+","+C[0]+","+C[1]);var m,g,b,T,C;const P=function(D,O,U){let j,W="";for(let ee=D;ee>0;ee--)j=1<<ee-1,W+=(O&j?1:0)+(U&j?2:0);return W}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,P).replace(/{bbox-epsg-3857}/g,c)}isChildOf(e){const n=this.z-e.z;return n>0&&e.x===this.x>>n&&e.y===this.y>>n}getTilePoint(e){const n=Math.pow(2,this.z);return new he((e.x*n-this.x)*qn,(e.y*n-this.y)*qn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class op{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Tc(e,n.z,n.z,n.x,n.y)}}class Ro{constructor(e,n,o,c,m){if(e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=n,this.canonical=new _h(o,+c,+m),this.key=Tc(n,e,o,c,m)}clone(){return new Ro(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?new Ro(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ro(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?Tc(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y):Tc(this.wrap*+n,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Ro(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new Ro(n,this.wrap,n,o,c),new Ro(n,this.wrap,n,o+1,c),new Ro(n,this.wrap,n,o,c+1),new Ro(n,this.wrap,n,o+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Ro(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Ro(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new op(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new _u(e.x-this.wrap,e.y))}}function Tc(i,e,n,o,c){(i*=2)<0&&(i=-1*i-1);const m=1<<n;return(m*m*i+m*c+o).toString(36)+n.toString(36)+e.toString(36)}ht("CanonicalTileID",_h),ht("OverscaledTileID",Ro,{omit:["posMatrix"]});class sp{constructor(e,n,o,c=1,m=1,g=1,b=0){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void $e(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const T=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=m,this.blueFactor=g,this.baseShift=b;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let C=0;C<T;C++)this.data[this._idx(-1,C)]=this.data[this._idx(0,C)],this.data[this._idx(T,C)]=this.data[this._idx(T-1,C)],this.data[this._idx(C,-1)]=this.data[this._idx(C,0)],this.data[this._idx(C,T)]=this.data[this._idx(C,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let C=0;C<T;C++)for(let P=0;P<T;P++){const D=this.get(C,P);D>this.max&&(this.max=D),D<this.min&&(this.min=D)}}get(e,n){const o=new Uint8Array(this.data.buffer),c=4*this._idx(e,n);return this.unpack(o[c],o[c+1],o[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}unpack(e,n,o){return e*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}getPixels(){return new Fo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,m=n*this.dim+this.dim,g=o*this.dim,b=o*this.dim+this.dim;switch(n){case-1:c=m-1;break;case 1:m=c+1}switch(o){case-1:g=b-1;break;case 1:b=g+1}const T=-n*this.dim,C=-o*this.dim;for(let P=g;P<b;P++)for(let D=c;D<m;D++)this.data[this._idx(D,P)]=e.data[this._idx(D+T,P+C)]}}ht("DEMData",sp);class ap{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const o=e[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class lp{constructor(e,n,o,c,m){this.type="Feature",this._vectorTileFeature=e,e._z=n,e._x=o,e._y=c,this.properties=e.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(e[n]=this[n]);return e}}class cp{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ko(qn,16,0),this.grid3D=new Ko(qn,16,0),this.featureIndexArray=new Ue,this.promoteId=n}insert(e,n,o,c,m,g){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,m);const T=g?this.grid3D:this.grid;for(let C=0;C<n.length;C++){const P=n[C],D=[1/0,1/0,-1/0,-1/0];for(let O=0;O<P.length;O++){const U=P[O];D[0]=Math.min(D[0],U.x),D[1]=Math.min(D[1],U.y),D[2]=Math.max(D[2],U.x),D[3]=Math.max(D[3],U.y)}D[0]<qn&&D[1]<qn&&D[2]>=0&&D[3]>=0&&T.insert(b,D[0],D[1],D[2],D[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Va.VectorTile(new rh(this.rawTileData)).layers,this.sourceLayerCoder=new ap(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,n,o,c){this.loadVTLayers();const m=e.params||{},g=qn/e.tileSize/e.scale,b=Ma(m.filter),T=e.queryGeometry,C=e.queryPadding*g,P=hp(T),D=this.grid.query(P.minX-C,P.minY-C,P.maxX+C,P.maxY+C),O=hp(e.cameraQueryGeometry),U=this.grid3D.query(O.minX-C,O.minY-C,O.maxX+C,O.maxY+C,(ee,re,pe,oe)=>function(ve,Se,Be,_t,Ct){for(const ut of ve)if(Se<=ut.x&&Be<=ut.y&&_t>=ut.x&&Ct>=ut.y)return!0;const mt=[new he(Se,Be),new he(Se,Ct),new he(_t,Ct),new he(_t,Be)];if(ve.length>2){for(const ut of mt)if(El(ve,ut))return!0}for(let ut=0;ut<ve.length-1;ut++)if(Qf(ve[ut],ve[ut+1],mt))return!0;return!1}(e.cameraQueryGeometry,ee-C,re-C,pe+C,oe+C));for(const ee of U)D.push(ee);D.sort(x_);const j={};let W;for(let ee=0;ee<D.length;ee++){const re=D[ee];if(re===W)continue;W=re;const pe=this.featureIndexArray.get(re);let oe=null;this.loadMatchingFeature(j,pe.bucketIndex,pe.sourceLayerIndex,pe.featureIndex,b,m.layers,m.availableImages,n,o,c,(ve,Se,Be)=>(oe||(oe=al(ve)),Se.queryIntersectsFeature(T,ve,Be,oe,this.z,e.transform,g,e.pixelPosMatrix)))}return j}loadMatchingFeature(e,n,o,c,m,g,b,T,C,P,D){const O=this.bucketLayerIDs[n];if(g&&!function(ee,re){for(let pe=0;pe<ee.length;pe++)if(re.indexOf(ee[pe])>=0)return!0;return!1}(g,O))return;const U=this.sourceLayerCoder.decode(o),j=this.vtLayers[U].feature(c);if(m.needGeometry){const ee=ll(j,!0);if(!m.filter(new hn(this.tileID.overscaledZ),ee,this.tileID.canonical))return}else if(!m.filter(new hn(this.tileID.overscaledZ),j))return;const W=this.getId(j,U);for(let ee=0;ee<O.length;ee++){const re=O[ee];if(g&&g.indexOf(re)<0)continue;const pe=T[re];if(!pe)continue;let oe={};W&&P&&(oe=P.getState(pe.sourceLayer||"_geojsonTileLayer",W));const ve=zt({},C[re]);ve.paint=up(ve.paint,pe.paint,j,oe,b),ve.layout=up(ve.layout,pe.layout,j,oe,b);const Se=!D||D(j,pe,oe);if(!Se)continue;const Be=new lp(j,this.z,this.x,this.y,W);Be.layer=ve;let _t=e[re];_t===void 0&&(_t=e[re]=[]),_t.push({featureIndex:c,feature:Be,intersectionZ:Se})}}lookupSymbolFeatures(e,n,o,c,m,g,b,T){const C={};this.loadVTLayers();const P=Ma(m);for(const D of e)this.loadMatchingFeature(C,o,c,D,P,g,b,T,n);return C}hasLayer(e){for(const n of this.bucketLayerIDs)for(const o of n)if(e===o)return!0;return!1}getId(e,n){let o=e.id;return this.promoteId&&(o=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof o=="boolean"&&(o=Number(o))),o}}function up(i,e,n,o,c){return Nt(i,(m,g)=>{const b=e instanceof Il?e.get(g):null;return b&&b.evaluate?b.evaluate(n,o,c):b})}function hp(i){let e=1/0,n=1/0,o=-1/0,c=-1/0;for(const m of i)e=Math.min(e,m.x),n=Math.min(n,m.y),o=Math.max(o,m.x),c=Math.max(c,m.y);return{minX:e,minY:n,maxX:o,maxY:c}}function x_(i,e){return e-i}function dp(i,e,n,o,c){const m=[];for(let g=0;g<i.length;g++){const b=i[g];let T;for(let C=0;C<b.length-1;C++){let P=b[C],D=b[C+1];P.x<e&&D.x<e||(P.x<e?P=new he(e,P.y+(e-P.x)/(D.x-P.x)*(D.y-P.y))._round():D.x<e&&(D=new he(e,P.y+(e-P.x)/(D.x-P.x)*(D.y-P.y))._round()),P.y<n&&D.y<n||(P.y<n?P=new he(P.x+(n-P.y)/(D.y-P.y)*(D.x-P.x),n)._round():D.y<n&&(D=new he(P.x+(n-P.y)/(D.y-P.y)*(D.x-P.x),n)._round()),P.x>=o&&D.x>=o||(P.x>=o?P=new he(o,P.y+(o-P.x)/(D.x-P.x)*(D.y-P.y))._round():D.x>=o&&(D=new he(o,P.y+(o-P.x)/(D.x-P.x)*(D.y-P.y))._round()),P.y>=c&&D.y>=c||(P.y>=c?P=new he(P.x+(c-P.y)/(D.y-P.y)*(D.x-P.x),c)._round():D.y>=c&&(D=new he(P.x+(c-P.y)/(D.y-P.y)*(D.x-P.x),c)._round()),T&&P.equals(T[T.length-1])||(T=[P],m.push(T)),T.push(D)))))}}return m}ht("FeatureIndex",cp,{omit:["rawTileData","sourceLayerCoder"]});class Za extends he{constructor(e,n,o,c){super(e,n),this.angle=o,c!==void 0&&(this.segment=c)}clone(){return new Za(this.x,this.y,this.angle,this.segment)}}function pp(i,e,n,o,c){if(e.segment===void 0||n===0)return!0;let m=e,g=e.segment+1,b=0;for(;b>-n/2;){if(g--,g<0)return!1;b-=i[g].dist(m),m=i[g]}b+=i[g].dist(i[g+1]),g++;const T=[];let C=0;for(;b<n/2;){const P=i[g],D=i[g+1];if(!D)return!1;let O=i[g-1].angleTo(P)-P.angleTo(D);for(O=Math.abs((O+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:b,angleDelta:O}),C+=O;b-T[0].distance>o;)C-=T.shift().angleDelta;if(C>c)return!1;g++,b+=P.dist(D)}return!0}function fp(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function mp(i,e,n){return i?.6*e*n:0}function _p(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function w_(i,e,n,o,c,m){const g=mp(n,c,m),b=_p(n,o)*m;let T=0;const C=fp(i)/2;for(let P=0;P<i.length-1;P++){const D=i[P],O=i[P+1],U=D.dist(O);if(T+U>C){const j=(C-T)/U,W=ur.number(D.x,O.x,j),ee=ur.number(D.y,O.y,j),re=new Za(W,ee,O.angleTo(D),P);return re._round(),!g||pp(i,re,b,g,e)?re:void 0}T+=U}}function S_(i,e,n,o,c,m,g,b,T){const C=mp(o,m,g),P=_p(o,c),D=P*g,O=i[0].x===0||i[0].x===T||i[0].y===0||i[0].y===T;return e-D<e/4&&(e=D+e/4),gp(i,O?e/2*b%e:(P/2+2*m)*g*b%e,e,C,n,D,O,!1,T)}function gp(i,e,n,o,c,m,g,b,T){const C=m/2,P=fp(i);let D=0,O=e-n,U=[];for(let j=0;j<i.length-1;j++){const W=i[j],ee=i[j+1],re=W.dist(ee),pe=ee.angleTo(W);for(;O+n<D+re;){O+=n;const oe=(O-D)/re,ve=ur.number(W.x,ee.x,oe),Se=ur.number(W.y,ee.y,oe);if(ve>=0&&ve<T&&Se>=0&&Se<T&&O-C>=0&&O+C<=P){const Be=new Za(ve,Se,pe,j);Be._round(),o&&!pp(i,Be,m,o,c)||U.push(Be)}}D+=re}return b||U.length||g||(U=gp(i,D/2,n,o,c,m,g,!0,T)),U}ht("Anchor",Za);const Fl=lo;function yp(i,e,n,o){const c=[],m=i.image,g=m.pixelRatio,b=m.paddedRect.w-2*Fl,T=m.paddedRect.h-2*Fl,C=i.right-i.left,P=i.bottom-i.top,D=m.stretchX||[[0,b]],O=m.stretchY||[[0,T]],U=(nt,xt)=>nt+xt[1]-xt[0],j=D.reduce(U,0),W=O.reduce(U,0),ee=b-j,re=T-W;let pe=0,oe=j,ve=0,Se=W,Be=0,_t=ee,Ct=0,mt=re;if(m.content&&o){const nt=m.content;pe=gu(D,0,nt[0]),ve=gu(O,0,nt[1]),oe=gu(D,nt[0],nt[2]),Se=gu(O,nt[1],nt[3]),Be=nt[0]-pe,Ct=nt[1]-ve,_t=nt[2]-nt[0]-oe,mt=nt[3]-nt[1]-Se}const ut=(nt,xt,st,He)=>{const qt=yu(nt.stretch-pe,oe,C,i.left),At=vu(nt.fixed-Be,_t,nt.stretch,j),hi=yu(xt.stretch-ve,Se,P,i.top),pn=vu(xt.fixed-Ct,mt,xt.stretch,W),vn=yu(st.stretch-pe,oe,C,i.left),Kn=vu(st.fixed-Be,_t,st.stretch,j),ko=yu(He.stretch-ve,Se,P,i.top),Hr=vu(He.fixed-Ct,mt,He.stretch,W),Zn=new he(qt,hi),fr=new he(vn,hi),Ir=new he(vn,ko),Xr=new he(qt,ko),Kr=new he(At/g,pn/g),Jn=new he(Kn/g,Hr/g),Yn=e*Math.PI/180;if(Yn){const Dr=Math.sin(Yn),co=Math.cos(Yn),uo=[co,-Dr,Dr,co];Zn._matMult(uo),fr._matMult(uo),Xr._matMult(uo),Ir._matMult(uo)}const zr=nt.stretch+nt.fixed,Jr=xt.stretch+xt.fixed;return{tl:Zn,tr:fr,bl:Xr,br:Ir,tex:{x:m.paddedRect.x+Fl+zr,y:m.paddedRect.y+Fl+Jr,w:st.stretch+st.fixed-zr,h:He.stretch+He.fixed-Jr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Kr,pixelOffsetBR:Jn,minFontScaleX:_t/g/C,minFontScaleY:mt/g/P,isSDF:n}};if(o&&(m.stretchX||m.stretchY)){const nt=vp(D,ee,j),xt=vp(O,re,W);for(let st=0;st<nt.length-1;st++){const He=nt[st],qt=nt[st+1];for(let At=0;At<xt.length-1;At++)c.push(ut(He,xt[At],qt,xt[At+1]))}}else c.push(ut({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:T+1}));return c}function gu(i,e,n){let o=0;for(const c of i)o+=Math.max(e,Math.min(n,c[1]))-Math.max(e,Math.min(n,c[0]));return o}function vp(i,e,n){const o=[{fixed:-Fl,stretch:0}];for(const[c,m]of i){const g=o[o.length-1];o.push({fixed:c-g.stretch,stretch:g.stretch}),o.push({fixed:c-g.stretch,stretch:g.stretch+(m-c)})}return o.push({fixed:e+Fl,stretch:n}),o}function yu(i,e,n,o){return i/e*n+o}function vu(i,e,n,o){return i-e*n/o}class bu{constructor(e,n,o,c,m,g,b,T,C,P){if(this.boxStartIndex=e.length,C){let D=g.top,O=g.bottom;const U=g.collisionPadding;U&&(D-=U[1],O+=U[3]);let j=O-D;j>0&&(j=Math.max(10,j),this.circleDiameter=j)}else{let D=g.top*b-T[0],O=g.bottom*b+T[2],U=g.left*b-T[3],j=g.right*b+T[1];const W=g.collisionPadding;if(W&&(U-=W[0]*b,D-=W[1]*b,j+=W[2]*b,O+=W[3]*b),P){const ee=new he(U,D),re=new he(j,D),pe=new he(U,O),oe=new he(j,O),ve=P*Math.PI/180;ee._rotate(ve),re._rotate(ve),pe._rotate(ve),oe._rotate(ve),U=Math.min(ee.x,re.x,pe.x,oe.x),j=Math.max(ee.x,re.x,pe.x,oe.x),D=Math.min(ee.y,re.y,pe.y,oe.y),O=Math.max(ee.y,re.y,pe.y,oe.y)}e.emplaceBack(n.x,n.y,U,D,j,O,o,c,m)}this.boxEndIndex=e.length}}class T_{constructor(e=[],n=I_){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:o}=this,c=n[e];for(;e>0;){const m=e-1>>1,g=n[m];if(o(c,g)>=0)break;n[e]=g,e=m}n[e]=c}_down(e){const{data:n,compare:o}=this,c=this.length>>1,m=n[e];for(;e<c;){let g=1+(e<<1),b=n[g];const T=g+1;if(T<this.length&&o(n[T],b)<0&&(g=T,b=n[T]),o(b,m)>=0)break;n[e]=b,e=g}n[e]=m}}function I_(i,e){return i<e?-1:i>e?1:0}function C_(i,e=1,n=!1){let o=1/0,c=1/0,m=-1/0,g=-1/0;const b=i[0];for(let U=0;U<b.length;U++){const j=b[U];(!U||j.x<o)&&(o=j.x),(!U||j.y<c)&&(c=j.y),(!U||j.x>m)&&(m=j.x),(!U||j.y>g)&&(g=j.y)}const T=Math.min(m-o,g-c);let C=T/2;const P=new T_([],E_);if(T===0)return new he(o,c);for(let U=o;U<m;U+=T)for(let j=c;j<g;j+=T)P.push(new Rl(U+C,j+C,C,i));let D=function(U){let j=0,W=0,ee=0;const re=U[0];for(let pe=0,oe=re.length,ve=oe-1;pe<oe;ve=pe++){const Se=re[pe],Be=re[ve],_t=Se.x*Be.y-Be.x*Se.y;W+=(Se.x+Be.x)*_t,ee+=(Se.y+Be.y)*_t,j+=3*_t}return new Rl(W/j,ee/j,0,U)}(i),O=P.length;for(;P.length;){const U=P.pop();(U.d>D.d||!D.d)&&(D=U,n&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,O)),U.max-D.d<=e||(C=U.h/2,P.push(new Rl(U.p.x-C,U.p.y-C,C,i)),P.push(new Rl(U.p.x+C,U.p.y-C,C,i)),P.push(new Rl(U.p.x-C,U.p.y+C,C,i)),P.push(new Rl(U.p.x+C,U.p.y+C,C,i)),O+=4)}return n&&(console.log(`num probes: ${O}`),console.log(`best distance: ${D.d}`)),D.p}function E_(i,e){return e.max-i.max}function Rl(i,e,n,o){this.p=new he(i,e),this.h=n,this.d=function(c,m){let g=!1,b=1/0;for(let T=0;T<m.length;T++){const C=m[T];for(let P=0,D=C.length,O=D-1;P<D;O=P++){const U=C[P],j=C[O];U.y>c.y!=j.y>c.y&&c.x<(j.x-U.x)*(c.y-U.y)/(j.y-U.y)+U.x&&(g=!g),b=Math.min(b,td(c,U,j))}}return(g?1:-1)*Math.sqrt(b)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var Tr;s.aq=void 0,(Tr=s.aq||(s.aq={}))[Tr.center=1]="center",Tr[Tr.left=2]="left",Tr[Tr.right=3]="right",Tr[Tr.top=4]="top",Tr[Tr.bottom=5]="bottom",Tr[Tr["top-left"]=6]="top-left",Tr[Tr["top-right"]=7]="top-right",Tr[Tr["bottom-left"]=8]="bottom-left",Tr[Tr["bottom-right"]=9]="bottom-right";const Ga=7,gh=Number.POSITIVE_INFINITY;function bp(i,e){return e[1]!==gh?function(n,o,c){let m=0,g=0;switch(o=Math.abs(o),c=Math.abs(c),n){case"top-right":case"top-left":case"top":g=c-Ga;break;case"bottom-right":case"bottom-left":case"bottom":g=-c+Ga}switch(n){case"top-right":case"bottom-right":case"right":m=-o;break;case"top-left":case"bottom-left":case"left":m=o}return[m,g]}(i,e[0],e[1]):function(n,o){let c=0,m=0;o<0&&(o=0);const g=o/Math.SQRT2;switch(n){case"top-right":case"top-left":m=g-Ga;break;case"bottom-right":case"bottom-left":m=-g+Ga;break;case"bottom":m=-o+Ga;break;case"top":m=o-Ga}switch(n){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=o;break;case"right":c=-o}return[c,m]}(i,e[0])}function xp(i,e,n){var o;const c=i.layout,m=(o=c.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},n);if(m){const b=m.values,T=[];for(let C=0;C<b.length;C+=2){const P=T[C]=b[C],D=b[C+1].map(O=>O*Xn);P.startsWith("top")?D[1]-=Ga:P.startsWith("bottom")&&(D[1]+=Ga),T[C+1]=D}return new Un(T)}const g=c.get("text-variable-anchor");if(g){let b;b=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(e,{},n)*Xn,gh]:c.get("text-offset").evaluate(e,{},n).map(C=>C*Xn);const T=[];for(const C of g)T.push(C,bp(C,b));return new Un(T)}return null}function yh(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function k_(i,e,n,o,c,m,g,b,T,C,P){let D=m.textMaxSize.evaluate(e,{});D===void 0&&(D=g);const O=i.layers[0].layout,U=O.get("icon-offset").evaluate(e,{},P),j=Sp(n.horizontal),W=g/24,ee=i.tilePixelRatio*W,re=i.tilePixelRatio*D/24,pe=i.tilePixelRatio*b,oe=i.tilePixelRatio*O.get("symbol-spacing"),ve=O.get("text-padding")*i.tilePixelRatio,Se=function(He,qt,At,hi=1){const pn=He.get("icon-padding").evaluate(qt,{},At),vn=pn&&pn.values;return[vn[0]*hi,vn[1]*hi,vn[2]*hi,vn[3]*hi]}(O,e,P,i.tilePixelRatio),Be=O.get("text-max-angle")/180*Math.PI,_t=O.get("text-rotation-alignment")!=="viewport"&&O.get("symbol-placement")!=="point",Ct=O.get("icon-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",mt=O.get("symbol-placement"),ut=oe/2,nt=O.get("icon-text-fit");let xt;o&&nt!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(xt=Gd(o,n.vertical,nt,O.get("icon-text-fit-padding"),U,W)),j&&(o=Gd(o,j,nt,O.get("icon-text-fit-padding"),U,W)));const st=(He,qt)=>{qt.x<0||qt.x>=qn||qt.y<0||qt.y>=qn||function(At,hi,pn,vn,Kn,ko,Hr,Zn,fr,Ir,Xr,Kr,Jn,Yn,zr,Jr,Dr,co,uo,Qn,Ti,Fr,Cr,$n,ts){const _s=At.addToLineVertexArray(hi,pn);let gs,oa,is,Oo,ho=0,sa=0,Ec=0,Ep=0,Ch=-1,Eh=-1;const aa={};let kp=ta("");if(At.allowVerticalPlacement&&vn.vertical){const Rr=Zn.layout.get("text-rotate").evaluate(Ti,{},$n)+90;is=new bu(fr,hi,Ir,Xr,Kr,vn.vertical,Jn,Yn,zr,Rr),Hr&&(Oo=new bu(fr,hi,Ir,Xr,Kr,Hr,Dr,co,zr,Rr))}if(Kn){const Rr=Zn.layout.get("icon-rotate").evaluate(Ti,{}),Bo=Zn.layout.get("icon-text-fit")!=="none",ul=yp(Kn,Rr,Cr,Bo),vs=Hr?yp(Hr,Rr,Cr,Bo):void 0;oa=new bu(fr,hi,Ir,Xr,Kr,Kn,Dr,co,!1,Rr),ho=4*ul.length;const hl=At.iconSizeData;let Fs=null;hl.kind==="source"?(Fs=[Ds*Zn.layout.get("icon-size").evaluate(Ti,{})],Fs[0]>ja&&$e(`${At.layerIds[0]}: Value for "icon-size" is >= ${Sc}. Reduce your "icon-size".`)):hl.kind==="composite"&&(Fs=[Ds*Fr.compositeIconSizes[0].evaluate(Ti,{},$n),Ds*Fr.compositeIconSizes[1].evaluate(Ti,{},$n)],(Fs[0]>ja||Fs[1]>ja)&&$e(`${At.layerIds[0]}: Value for "icon-size" is >= ${Sc}. Reduce your "icon-size".`)),At.addSymbols(At.icon,ul,Fs,Qn,uo,Ti,s.ai.none,hi,_s.lineStartIndex,_s.lineLength,-1,$n),Ch=At.icon.placedSymbolArray.length-1,vs&&(sa=4*vs.length,At.addSymbols(At.icon,vs,Fs,Qn,uo,Ti,s.ai.vertical,hi,_s.lineStartIndex,_s.lineLength,-1,$n),Eh=At.icon.placedSymbolArray.length-1)}const Mp=Object.keys(vn.horizontal);for(const Rr of Mp){const Bo=vn.horizontal[Rr];if(!gs){kp=ta(Bo.text);const vs=Zn.layout.get("text-rotate").evaluate(Ti,{},$n);gs=new bu(fr,hi,Ir,Xr,Kr,Bo,Jn,Yn,zr,vs)}const ul=Bo.positionedLines.length===1;if(Ec+=wp(At,hi,Bo,ko,Zn,zr,Ti,Jr,_s,vn.vertical?s.ai.horizontal:s.ai.horizontalOnly,ul?Mp:[Rr],aa,Ch,Fr,$n),ul)break}vn.vertical&&(Ep+=wp(At,hi,vn.vertical,ko,Zn,zr,Ti,Jr,_s,s.ai.vertical,["vertical"],aa,Eh,Fr,$n));const P_=gs?gs.boxStartIndex:At.collisionBoxArray.length,L_=gs?gs.boxEndIndex:At.collisionBoxArray.length,z_=is?is.boxStartIndex:At.collisionBoxArray.length,D_=is?is.boxEndIndex:At.collisionBoxArray.length,F_=oa?oa.boxStartIndex:At.collisionBoxArray.length,R_=oa?oa.boxEndIndex:At.collisionBoxArray.length,O_=Oo?Oo.boxStartIndex:At.collisionBoxArray.length,B_=Oo?Oo.boxEndIndex:At.collisionBoxArray.length;let ys=-1;const wu=(Rr,Bo)=>Rr&&Rr.circleDiameter?Math.max(Rr.circleDiameter,Bo):Bo;ys=wu(gs,ys),ys=wu(is,ys),ys=wu(oa,ys),ys=wu(Oo,ys);const Ap=ys>-1?1:0;Ap&&(ys*=ts/Xn),At.glyphOffsetArray.length>=Dl.MAX_GLYPHS&&$e("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ti.sortKey!==void 0&&At.addToSortKeyRanges(At.symbolInstances.length,Ti.sortKey);const N_=xp(Zn,Ti,$n),[V_,U_]=function(Rr,Bo){const ul=Rr.length,vs=Bo==null?void 0:Bo.values;if((vs==null?void 0:vs.length)>0)for(let hl=0;hl<vs.length;hl+=2){const Fs=vs[hl+1];Rr.emplaceBack(s.aq[vs[hl]],Fs[0],Fs[1])}return[ul,Rr.length]}(At.textAnchorOffsets,N_);At.symbolInstances.emplaceBack(hi.x,hi.y,aa.right>=0?aa.right:-1,aa.center>=0?aa.center:-1,aa.left>=0?aa.left:-1,aa.vertical||-1,Ch,Eh,kp,P_,L_,z_,D_,F_,R_,O_,B_,Ir,Ec,Ep,ho,sa,Ap,0,Jn,ys,V_,U_)}(i,qt,He,n,o,c,xt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,ee,[ve,ve,ve,ve],_t,T,pe,Se,Ct,U,e,m,C,P,g)};if(mt==="line")for(const He of dp(e.geometry,0,0,qn,qn)){const qt=S_(He,oe,Be,n.vertical||j,o,24,re,i.overscaling,qn);for(const At of qt)j&&M_(i,j.text,ut,At)||st(He,At)}else if(mt==="line-center"){for(const He of e.geometry)if(He.length>1){const qt=w_(He,Be,n.vertical||j,o,24,re);qt&&st(He,qt)}}else if(e.type==="Polygon")for(const He of Ju(e.geometry,0)){const qt=C_(He,16);st(He[0],new Za(qt.x,qt.y,0))}else if(e.type==="LineString")for(const He of e.geometry)st(He,new Za(He[0].x,He[0].y,0));else if(e.type==="Point")for(const He of e.geometry)for(const qt of He)st([qt],new Za(qt.x,qt.y,0))}function wp(i,e,n,o,c,m,g,b,T,C,P,D,O,U,j){const W=function(pe,oe,ve,Se,Be,_t,Ct,mt){const ut=Se.layout.get("text-rotate").evaluate(_t,{})*Math.PI/180,nt=[];for(const xt of oe.positionedLines)for(const st of xt.positionedGlyphs){if(!st.rect)continue;const He=st.rect||{};let qt=Bd+1,At=!0,hi=1,pn=0;const vn=(Be||mt)&&st.vertical,Kn=st.metrics.advance*st.scale/2;if(mt&&oe.verticalizable&&(pn=xt.lineOffset/2-(st.imageName?-(Xn-st.metrics.width*st.scale)/2:(st.scale-1)*Xn)),st.imageName){const Qn=Ct[st.imageName];At=Qn.sdf,hi=Qn.pixelRatio,qt=lo/hi}const ko=Be?[st.x+Kn,st.y]:[0,0];let Hr=Be?[0,0]:[st.x+Kn+ve[0],st.y+ve[1]-pn],Zn=[0,0];vn&&(Zn=Hr,Hr=[0,0]);const fr=st.metrics.isDoubleResolution?2:1,Ir=(st.metrics.left-qt)*st.scale-Kn+Hr[0],Xr=(-st.metrics.top-qt)*st.scale+Hr[1],Kr=Ir+He.w/fr*st.scale/hi,Jn=Xr+He.h/fr*st.scale/hi,Yn=new he(Ir,Xr),zr=new he(Kr,Xr),Jr=new he(Ir,Jn),Dr=new he(Kr,Jn);if(vn){const Qn=new he(-Kn,Kn-xc),Ti=-Math.PI/2,Fr=Xn/2-Kn,Cr=new he(5-xc-Fr,-(st.imageName?Fr:0)),$n=new he(...Zn);Yn._rotateAround(Ti,Qn)._add(Cr)._add($n),zr._rotateAround(Ti,Qn)._add(Cr)._add($n),Jr._rotateAround(Ti,Qn)._add(Cr)._add($n),Dr._rotateAround(Ti,Qn)._add(Cr)._add($n)}if(ut){const Qn=Math.sin(ut),Ti=Math.cos(ut),Fr=[Ti,-Qn,Qn,Ti];Yn._matMult(Fr),zr._matMult(Fr),Jr._matMult(Fr),Dr._matMult(Fr)}const co=new he(0,0),uo=new he(0,0);nt.push({tl:Yn,tr:zr,bl:Jr,br:Dr,tex:He,writingMode:oe.writingMode,glyphOffset:ko,sectionIndex:st.sectionIndex,isSDF:At,pixelOffsetTL:co,pixelOffsetBR:uo,minFontScaleX:0,minFontScaleY:0})}return nt}(0,n,b,c,m,g,o,i.allowVerticalPlacement),ee=i.textSizeData;let re=null;ee.kind==="source"?(re=[Ds*c.layout.get("text-size").evaluate(g,{})],re[0]>ja&&$e(`${i.layerIds[0]}: Value for "text-size" is >= ${Sc}. Reduce your "text-size".`)):ee.kind==="composite"&&(re=[Ds*U.compositeTextSizes[0].evaluate(g,{},j),Ds*U.compositeTextSizes[1].evaluate(g,{},j)],(re[0]>ja||re[1]>ja)&&$e(`${i.layerIds[0]}: Value for "text-size" is >= ${Sc}. Reduce your "text-size".`)),i.addSymbols(i.text,W,re,b,m,g,C,e,T.lineStartIndex,T.lineLength,O,j);for(const pe of P)D[pe]=i.text.placedSymbolArray.length-1;return 4*W.length}function Sp(i){for(const e in i)return i[e];return null}function M_(i,e,n,o){const c=i.compareText;if(e in c){const m=c[e];for(let g=m.length-1;g>=0;g--)if(o.dist(m[g])<n)return!0}else c[e]=[];return c[e].push(o),!1}const Tp=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class vh{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=o>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const m=Tp[15&o];if(!m)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[b]=new Uint32Array(e,4,1);return new vh(b,g,m,e)}constructor(e,n=64,o=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const m=Tp.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,b=e*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-b%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${o}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+T,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+b+T),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+T,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=n,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return bh(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:g,nodeSize:b}=this,T=[0,m.length-1,0],C=[];for(;T.length;){const P=T.pop()||0,D=T.pop()||0,O=T.pop()||0;if(D-O<=b){for(let ee=O;ee<=D;ee++){const re=g[2*ee],pe=g[2*ee+1];re>=e&&re<=o&&pe>=n&&pe<=c&&C.push(m[ee])}continue}const U=O+D>>1,j=g[2*U],W=g[2*U+1];j>=e&&j<=o&&W>=n&&W<=c&&C.push(m[U]),(P===0?e<=j:n<=W)&&(T.push(O),T.push(U-1),T.push(1-P)),(P===0?o>=j:c>=W)&&(T.push(U+1),T.push(D),T.push(1-P))}return C}within(e,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:m,nodeSize:g}=this,b=[0,c.length-1,0],T=[],C=o*o;for(;b.length;){const P=b.pop()||0,D=b.pop()||0,O=b.pop()||0;if(D-O<=g){for(let ee=O;ee<=D;ee++)Cp(m[2*ee],m[2*ee+1],e,n)<=C&&T.push(c[ee]);continue}const U=O+D>>1,j=m[2*U],W=m[2*U+1];Cp(j,W,e,n)<=C&&T.push(c[U]),(P===0?e-o<=j:n-o<=W)&&(b.push(O),b.push(U-1),b.push(1-P)),(P===0?e+o>=j:n+o>=W)&&(b.push(U+1),b.push(D),b.push(1-P))}return T}}function bh(i,e,n,o,c,m){if(c-o<=n)return;const g=o+c>>1;Ip(i,e,g,o,c,m),bh(i,e,n,o,g-1,1-m),bh(i,e,n,g+1,c,1-m)}function Ip(i,e,n,o,c,m){for(;c>o;){if(c-o>600){const C=c-o+1,P=n-o+1,D=Math.log(C),O=.5*Math.exp(2*D/3),U=.5*Math.sqrt(D*O*(C-O)/C)*(P-C/2<0?-1:1);Ip(i,e,n,Math.max(o,Math.floor(n-P*O/C+U)),Math.min(c,Math.floor(n+(C-P)*O/C+U)),m)}const g=e[2*n+m];let b=o,T=c;for(Ic(i,e,o,n),e[2*c+m]>g&&Ic(i,e,o,c);b<T;){for(Ic(i,e,b,T),b++,T--;e[2*b+m]<g;)b++;for(;e[2*T+m]>g;)T--}e[2*o+m]===g?Ic(i,e,o,T):(T++,Ic(i,e,T,c)),T<=n&&(o=T+1),n<=T&&(c=T-1)}}function Ic(i,e,n,o){xh(i,n,o),xh(e,2*n,2*o),xh(e,2*n+1,2*o+1)}function xh(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}function Cp(i,e,n,o){const c=i-n,m=e-o;return c*c+m*m}var wh;s.bh=void 0,(wh=s.bh||(s.bh={})).create="create",wh.load="load",wh.fullLoad="fullLoad";let xu=null,Cc=[];const Sh=1e3/60,Th="loadTime",Ih="fullLoadTime",A_={mark(i){performance.mark(i)},frame(i){const e=i;xu!=null&&Cc.push(e-xu),xu=e},clearMetrics(){xu=null,Cc=[],performance.clearMeasures(Th),performance.clearMeasures(Ih);for(const i in s.bh)performance.clearMarks(s.bh[i])},getPerformanceMetrics(){performance.measure(Th,s.bh.create,s.bh.load),performance.measure(Ih,s.bh.create,s.bh.fullLoad);const i=performance.getEntriesByName(Th)[0].duration,e=performance.getEntriesByName(Ih)[0].duration,n=Cc.length,o=1/(Cc.reduce((m,g)=>m+g,0)/n/1e3),c=Cc.filter(m=>m>Sh).reduce((m,g)=>m+(g-Sh)/Sh,0);return{loadTime:i,fullLoadTime:e,fps:o,percentDroppedFrames:c/(n+c)*100,totalFrames:n}}};s.$=function(i,e,n){var o,c,m,g,b,T,C,P,D,O,U,j,W=n[0],ee=n[1],re=n[2];return e===i?(i[12]=e[0]*W+e[4]*ee+e[8]*re+e[12],i[13]=e[1]*W+e[5]*ee+e[9]*re+e[13],i[14]=e[2]*W+e[6]*ee+e[10]*re+e[14],i[15]=e[3]*W+e[7]*ee+e[11]*re+e[15]):(c=e[1],m=e[2],g=e[3],b=e[4],T=e[5],C=e[6],P=e[7],D=e[8],O=e[9],U=e[10],j=e[11],i[0]=o=e[0],i[1]=c,i[2]=m,i[3]=g,i[4]=b,i[5]=T,i[6]=C,i[7]=P,i[8]=D,i[9]=O,i[10]=U,i[11]=j,i[12]=o*W+b*ee+D*re+e[12],i[13]=c*W+T*ee+O*re+e[13],i[14]=m*W+C*ee+U*re+e[14],i[15]=g*W+P*ee+j*re+e[15]),i},s.A=kl,s.B=ur,s.C=class{constructor(i,e,n){this.receive=o=>{const c=o.data,m=c.id;if(m&&(!c.targetMapId||this.mapId===c.targetMapId))if(c.type==="<cancel>"){delete this.tasks[m];const g=this.cancelCallbacks[m];delete this.cancelCallbacks[m],g&&g()}else Lt()||c.mustQueue?(this.tasks[m]=c,this.taskQueue.push(m),this.invoker.trigger()):this.processTask(m,c)},this.process=()=>{if(!this.taskQueue.length)return;const o=this.taskQueue.shift(),c=this.tasks[o];delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),c&&this.processTask(o,c)},this.target=i,this.parent=e,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new b_(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Lt()?i:window}send(i,e,n,o,c=!1){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[m]=n);const g=[],b={id:m,type:i,hasCallback:!!n,targetMapId:o,mustQueue:c,sourceMapId:this.mapId,data:qr(e,g)};return this.target.postMessage(b,{transfer:g}),{cancel:()=>{n&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}processTask(i,e){if(e.type==="<response>"){const n=this.callbacks[i];delete this.callbacks[i],n&&(e.error?n(Do(e.error)):n(null,Do(e.data)))}else{let n=!1;const o=[],c=e.hasCallback?(b,T)=>{n=!0,delete this.cancelCallbacks[i];const C={id:i,type:"<response>",sourceMapId:this.mapId,error:b?qr(b):null,data:qr(T,o)};this.target.postMessage(C,{transfer:o})}:b=>{n=!0};let m=null;const g=Do(e.data);if(this.parent[e.type])m=this.parent[e.type](e.sourceMapId,g,c);else if("getWorkerSource"in this.parent){const b=e.type.split(".");m=this.parent.getWorkerSource(e.sourceMapId,b[0],g.source)[b[1]](g,c)}else c(new Error(`Could not find function ${e.type}`));!n&&m&&m.cancel&&(this.cancelCallbacks[i]=m.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.D=Ft,s.E=yo,s.F=function(i,e){const n={};for(let o=0;o<e.length;o++){const c=e[o];c in i&&(n[c]=i[c])}return n},s.G=ep,s.H=tp,s.I=sh,s.J=Pe,s.K=Ke,s.L=qa,s.M=Pi,s.N=qn,s.O=Ro,s.P=he,s.Q=xn,s.R=Fo,s.S=dn,s.T=Jc,s.U=_u,s.V=class extends $s{},s.W=_h,s.X=function(i,e){const n=window.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let o=0;o<i.length;o++){const c=window.document.createElement("source");Ui(i[o])||(n.crossOrigin="Anonymous"),c.src=i[o],n.appendChild(c)}return{cancel:()=>{}}},s.Y=tt,s.Z=function(){var i=new kl(16);return kl!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},s._=F,s.a=Ln,s.a$=class extends N{},s.a0=function(i,e,n){var o=n[0],c=n[1],m=n[2];return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*c,i[5]=e[5]*c,i[6]=e[6]*c,i[7]=e[7]*c,i[8]=e[8]*m,i[9]=e[9]*m,i[10]=e[10]*m,i[11]=e[11]*m,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},s.a1=od,s.a2=function(){return wt++},s.a3=J,s.a4=Dl,s.a5=function(){so.isLoading()||so.isLoaded()||ec()!=="deferred"||Kc()},s.a6=Ma,s.a7=ll,s.a8=hn,s.a9=lp,s.aA=il,s.aB=function(i){i=i.slice();const e=Object.create(null);for(let n=0;n<i.length;n++)e[i[n].id]=i[n];for(let n=0;n<i.length;n++)"ref"in i[n]&&(i[n]=zi(i[n],e[i[n].ref]));return i},s.aC=function(i){if(i.type==="custom")return new v_(i);switch(i.type){case"background":return new __(i);case"circle":return new tm(i);case"fill":return new xm(i);case"fill-extrusion":return new Rm(i);case"heatmap":return new nm(i);case"hillshade":return new om(i);case"line":return new Zm(i);case"raster":return new y_(i);case"symbol":return new mu(i)}},s.aD=Je,s.aE=function(i,e){if(!i)return[{command:ei.setStyle,args:[e]}];let n=[];try{if(!jt(i.version,e.version))return[{command:ei.setStyle,args:[e]}];jt(i.center,e.center)||n.push({command:ei.setCenter,args:[e.center]}),jt(i.zoom,e.zoom)||n.push({command:ei.setZoom,args:[e.zoom]}),jt(i.bearing,e.bearing)||n.push({command:ei.setBearing,args:[e.bearing]}),jt(i.pitch,e.pitch)||n.push({command:ei.setPitch,args:[e.pitch]}),jt(i.sprite,e.sprite)||n.push({command:ei.setSprite,args:[e.sprite]}),jt(i.glyphs,e.glyphs)||n.push({command:ei.setGlyphs,args:[e.glyphs]}),jt(i.transition,e.transition)||n.push({command:ei.setTransition,args:[e.transition]}),jt(i.light,e.light)||n.push({command:ei.setLight,args:[e.light]});const o={},c=[];(function(g,b,T,C){let P;for(P in b=b||{},g=g||{})Object.prototype.hasOwnProperty.call(g,P)&&(Object.prototype.hasOwnProperty.call(b,P)||Br(P,T,C));for(P in b)Object.prototype.hasOwnProperty.call(b,P)&&(Object.prototype.hasOwnProperty.call(g,P)?jt(g[P],b[P])||(g[P].type==="geojson"&&b[P].type==="geojson"&&as(g,b,P)?T.push({command:ei.setGeoJSONSourceData,args:[P,b[P].data]}):eo(P,b,T,C)):$r(P,b,T))})(i.sources,e.sources,c,o);const m=[];i.layers&&i.layers.forEach(g=>{o[g.source]?n.push({command:ei.removeLayer,args:[g.id]}):m.push(g)}),n=n.concat(c),function(g,b,T){b=b||[];const C=(g=g||[]).map(Nr),P=b.map(Nr),D=g.reduce(vo,{}),O=b.reduce(vo,{}),U=C.slice(),j=Object.create(null);let W,ee,re,pe,oe,ve,Se;for(W=0,ee=0;W<C.length;W++)re=C[W],Object.prototype.hasOwnProperty.call(O,re)?ee++:(T.push({command:ei.removeLayer,args:[re]}),U.splice(U.indexOf(re,ee),1));for(W=0,ee=0;W<P.length;W++)re=P[P.length-1-W],U[U.length-1-W]!==re&&(Object.prototype.hasOwnProperty.call(D,re)?(T.push({command:ei.removeLayer,args:[re]}),U.splice(U.lastIndexOf(re,U.length-ee),1)):ee++,ve=U[U.length-W],T.push({command:ei.addLayer,args:[O[re],ve]}),U.splice(U.length-W,0,re),j[re]=!0);for(W=0;W<P.length;W++)if(re=P[W],pe=D[re],oe=O[re],!j[re]&&!jt(pe,oe))if(jt(pe.source,oe.source)&&jt(pe["source-layer"],oe["source-layer"])&&jt(pe.type,oe.type)){for(Se in No(pe.layout,oe.layout,T,re,null,ei.setLayoutProperty),No(pe.paint,oe.paint,T,re,null,ei.setPaintProperty),jt(pe.filter,oe.filter)||T.push({command:ei.setFilter,args:[re,oe.filter]}),jt(pe.minzoom,oe.minzoom)&&jt(pe.maxzoom,oe.maxzoom)||T.push({command:ei.setLayerZoomRange,args:[re,oe.minzoom,oe.maxzoom]}),pe)Object.prototype.hasOwnProperty.call(pe,Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?No(pe[Se],oe[Se],T,re,Se.slice(6),ei.setPaintProperty):jt(pe[Se],oe[Se])||T.push({command:ei.setLayerProperty,args:[re,Se,oe[Se]]}));for(Se in oe)Object.prototype.hasOwnProperty.call(oe,Se)&&!Object.prototype.hasOwnProperty.call(pe,Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?No(pe[Se],oe[Se],T,re,Se.slice(6),ei.setPaintProperty):jt(pe[Se],oe[Se])||T.push({command:ei.setLayerProperty,args:[re,Se,oe[Se]]}))}else T.push({command:ei.removeLayer,args:[re]}),ve=U[U.lastIndexOf(re)+1],T.push({command:ei.addLayer,args:[oe,ve]})}(m,e.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:ei.setStyle,args:[e]}]}return n},s.aF=function(i){const e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},s.aG=function i(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let o=0;o<e.length;o++)if(!i(e[o],n[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&n!==null){if(typeof n!="object"||Object.keys(e).length!==Object.keys(n).length)return!1;for(const o in e)if(!i(e[o],n[o]))return!1;return!0}return e===n},s.aH=Nt,s.aI=De,s.aJ=nl,s.aK=function(i){return i({pluginStatus:Zr,pluginURL:Ls}),nl.on("pluginStateChange",i),i},s.aL=class extends ia{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},s.aM=Cl,s.aN=class extends ia{constructor(i,e){super(i,e),this.current=Bu}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},s.aO=eu,s.aP=class extends ia{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},s.aQ=class extends ia{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},s.aR=tu,s.aS=function(i,e,n,o,c,m,g){var b=1/(e-n),T=1/(o-c),C=1/(m-g);return i[0]=-2*b,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*T,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*C,i[11]=0,i[12]=(e+n)*b,i[13]=(c+o)*T,i[14]=(g+m)*C,i[15]=1,i},s.aT=Di,s.aU=em,s.aV=class extends l{},s.aW=Xm,s.aX=class extends _{},s.aY=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},s.aZ=ud,s.a_=et,s.aa=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,c,m)=>{const g=c||m;return e[o]=!g||g.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e},s.ab=function(i,e){const n=[];for(const o in i)o in e||n.push(o);return n},s.ac=function(i){if(ui==null){const e=i.navigator?i.navigator.userAgent:null;ui=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return ui},s.ad=vt,s.ae=function(i,e,n){var o=Math.sin(n),c=Math.cos(n),m=e[0],g=e[1],b=e[2],T=e[3],C=e[4],P=e[5],D=e[6],O=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=m*c+C*o,i[1]=g*c+P*o,i[2]=b*c+D*o,i[3]=T*c+O*o,i[4]=C*c-m*o,i[5]=P*c-g*o,i[6]=D*c-b*o,i[7]=O*c-T*o,i},s.af=function(i){var e=new kl(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},s.ag=ou,s.ah=function(i,e){let n=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:c,minZoom:m,maxZoom:g}=i,b=c?vt(br.interpolationFactor(c,e,m,g),0,1):0;i.kind==="camera"?o=ur.number(i.minSize,i.maxSize,b):n=b}return{uSizeT:n,uSize:o}},s.aj=function(i,{uSize:e,uSizeT:n},{lowerSize:o,upperSize:c}){return i.kind==="source"?o/Ds:i.kind==="composite"?ur.number(o/Ds,c/Ds,n):e},s.ak=uh,s.al=function(i,e,n,o){const c=e.y-i.y,m=e.x-i.x,g=o.y-n.y,b=o.x-n.x,T=g*m-b*c;if(T===0)return null;const C=(b*(i.y-n.y)-g*(i.x-n.x))/T;return new he(i.x+C*m,i.y+C*c)},s.am=dp,s.an=$h,s.ao=qu,s.ap=Xn,s.ar=ch,s.as=function(i,e){var n=e[0],o=e[1],c=e[2],m=e[3],g=e[4],b=e[5],T=e[6],C=e[7],P=e[8],D=e[9],O=e[10],U=e[11],j=e[12],W=e[13],ee=e[14],re=e[15],pe=n*b-o*g,oe=n*T-c*g,ve=n*C-m*g,Se=o*T-c*b,Be=o*C-m*b,_t=c*C-m*T,Ct=P*W-D*j,mt=P*ee-O*j,ut=P*re-U*j,nt=D*ee-O*W,xt=D*re-U*W,st=O*re-U*ee,He=pe*st-oe*xt+ve*nt+Se*ut-Be*mt+_t*Ct;return He?(i[0]=(b*st-T*xt+C*nt)*(He=1/He),i[1]=(c*xt-o*st-m*nt)*He,i[2]=(W*_t-ee*Be+re*Se)*He,i[3]=(O*Be-D*_t-U*Se)*He,i[4]=(T*ut-g*st-C*mt)*He,i[5]=(n*st-c*ut+m*mt)*He,i[6]=(ee*ve-j*_t-re*oe)*He,i[7]=(P*_t-O*ve+U*oe)*He,i[8]=(g*xt-b*ut+C*Ct)*He,i[9]=(o*ut-n*xt-m*Ct)*He,i[10]=(j*Be-W*ve+re*pe)*He,i[11]=(D*ve-P*Be-U*pe)*He,i[12]=(b*mt-g*nt-T*Ct)*He,i[13]=(n*nt-o*mt+c*Ct)*He,i[14]=(W*oe-j*Se-ee*pe)*He,i[15]=(P*Se-D*oe+O*pe)*He,i):null},s.at=yh,s.au=lh,s.av=vh,s.aw=function(){const i={},e=ke.$version;for(const n in ke.$root){const o=ke.$root[n];if(o.required){let c=null;c=n==="version"?e:o.type==="array"?[]:{},c!=null&&(i[n]=c)}}return i},s.ax=ei,s.ay=fs,s.az=si,s.b=function(i,e){const n=new Blob([new Uint8Array(i)],{type:"image/png"});createImageBitmap(n).then(o=>{e(null,o)}).catch(o=>{e(new Error(`Could not load image because of ${o.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},s.b0=dr,s.b1=function(i,e){var n=i[0],o=i[1],c=i[2],m=i[3],g=i[4],b=i[5],T=i[6],C=i[7],P=i[8],D=i[9],O=i[10],U=i[11],j=i[12],W=i[13],ee=i[14],re=i[15],pe=e[0],oe=e[1],ve=e[2],Se=e[3],Be=e[4],_t=e[5],Ct=e[6],mt=e[7],ut=e[8],nt=e[9],xt=e[10],st=e[11],He=e[12],qt=e[13],At=e[14],hi=e[15];return Math.abs(n-pe)<=Wr*Math.max(1,Math.abs(n),Math.abs(pe))&&Math.abs(o-oe)<=Wr*Math.max(1,Math.abs(o),Math.abs(oe))&&Math.abs(c-ve)<=Wr*Math.max(1,Math.abs(c),Math.abs(ve))&&Math.abs(m-Se)<=Wr*Math.max(1,Math.abs(m),Math.abs(Se))&&Math.abs(g-Be)<=Wr*Math.max(1,Math.abs(g),Math.abs(Be))&&Math.abs(b-_t)<=Wr*Math.max(1,Math.abs(b),Math.abs(_t))&&Math.abs(T-Ct)<=Wr*Math.max(1,Math.abs(T),Math.abs(Ct))&&Math.abs(C-mt)<=Wr*Math.max(1,Math.abs(C),Math.abs(mt))&&Math.abs(P-ut)<=Wr*Math.max(1,Math.abs(P),Math.abs(ut))&&Math.abs(D-nt)<=Wr*Math.max(1,Math.abs(D),Math.abs(nt))&&Math.abs(O-xt)<=Wr*Math.max(1,Math.abs(O),Math.abs(xt))&&Math.abs(U-st)<=Wr*Math.max(1,Math.abs(U),Math.abs(st))&&Math.abs(j-He)<=Wr*Math.max(1,Math.abs(j),Math.abs(He))&&Math.abs(W-qt)<=Wr*Math.max(1,Math.abs(W),Math.abs(qt))&&Math.abs(ee-At)<=Wr*Math.max(1,Math.abs(ee),Math.abs(At))&&Math.abs(re-hi)<=Wr*Math.max(1,Math.abs(re),Math.abs(hi))},s.b2=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},s.b3=function(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i[3]=e[3]*n[3],i},s.b4=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},s.b5=yt,s.b6=op,s.b7=ip,s.b8=function(i,e,n,o,c){var m,g=1/Math.tan(e/2);return i[0]=g/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,c!=null&&c!==1/0?(i[10]=(c+o)*(m=1/(o-c)),i[14]=2*c*o*m):(i[10]=-1,i[14]=-2*o),i},s.b9=function(i,e,n){var o=Math.sin(n),c=Math.cos(n),m=e[4],g=e[5],b=e[6],T=e[7],C=e[8],P=e[9],D=e[10],O=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=m*c+C*o,i[5]=g*c+P*o,i[6]=b*c+D*o,i[7]=T*c+O*o,i[8]=C*c-m*o,i[9]=P*c-g*o,i[10]=D*c-b*o,i[11]=O*c-T*o,i},s.bA=q,s.bB=Pd,s.bC=Ea,s.bD=so,s.ba=je,s.bb=St,s.bc=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},s.bd=class extends sl{},s.be=fh,s.bf=np,s.bg=A_,s.bi=it,s.bj=function(i,e,n=!1){if(Zr===Kl||Zr===Jl||Zr===Yl)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ls=qe.resolveURL(i),Zr=Kl,Ql=e,$l(),n||Kc()},s.bk=ec,s.bl=function(i,e){const n={};for(let c=0;c<i.length;c++){const m=e&&e[i[c].id]||ps(i[c]);e&&(e[i[c].id]=m);let g=n[m];g||(g=n[m]=[]),g.push(i[c])}const o=[];for(const c in n)o.push(n[c]);return o},s.bm=ht,s.bn=ap,s.bo=cp,s.bp=Vd,s.bq=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=qn/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],n=e.layout,o=e._unevaluatedLayout._values,c={layoutIconSize:o["icon-size"].possiblyEvaluate(new hn(i.bucket.zoom+1),i.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new hn(i.bucket.zoom+1),i.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new hn(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:C,maxZoom:P}=i.bucket.textSizeData;c.compositeTextSizes=[o["text-size"].possiblyEvaluate(new hn(C),i.canonical),o["text-size"].possiblyEvaluate(new hn(P),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:C,maxZoom:P}=i.bucket.iconSizeData;c.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new hn(C),i.canonical),o["icon-size"].possiblyEvaluate(new hn(P),i.canonical)]}const m=n.get("text-line-height")*Xn,g=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",b=n.get("text-keep-upright"),T=n.get("text-size");for(const C of i.bucket.features){const P=n.get("text-font").evaluate(C,{},i.canonical).join(","),D=T.evaluate(C,{},i.canonical),O=c.layoutTextSize.evaluate(C,{},i.canonical),U=c.layoutIconSize.evaluate(C,{},i.canonical),j={horizontal:{},vertical:void 0},W=C.text;let ee,re=[0,0];if(W){const ve=W.toString(),Se=n.get("text-letter-spacing").evaluate(C,{},i.canonical)*Xn,Be=As(ve)?Se:0,_t=n.get("text-anchor").evaluate(C,{},i.canonical),Ct=xp(e,C,i.canonical);if(!Ct){const st=n.get("text-radial-offset").evaluate(C,{},i.canonical);re=st?bp(_t,[st*Xn,gh]):n.get("text-offset").evaluate(C,{},i.canonical).map(He=>He*Xn)}let mt=g?"center":n.get("text-justify").evaluate(C,{},i.canonical);const ut=n.get("symbol-placement"),nt=ut==="point"?n.get("text-max-width").evaluate(C,{},i.canonical)*Xn:0,xt=()=>{i.bucket.allowVerticalPlacement&&Fa(ve)&&(j.vertical=du(W,i.glyphMap,i.glyphPositions,i.imagePositions,P,nt,m,_t,"left",Be,re,s.ai.vertical,!0,ut,O,D))};if(!g&&Ct){const st=new Set;if(mt==="auto")for(let qt=0;qt<Ct.values.length;qt+=2)st.add(yh(Ct.values[qt]));else st.add(mt);let He=!1;for(const qt of st)if(!j.horizontal[qt])if(He)j.horizontal[qt]=j.horizontal[0];else{const At=du(W,i.glyphMap,i.glyphPositions,i.imagePositions,P,nt,m,"center",qt,Be,re,s.ai.horizontal,!1,ut,O,D);At&&(j.horizontal[qt]=At,He=At.positionedLines.length===1)}xt()}else{mt==="auto"&&(mt=yh(_t));const st=du(W,i.glyphMap,i.glyphPositions,i.imagePositions,P,nt,m,_t,mt,Be,re,s.ai.horizontal,!1,ut,O,D);st&&(j.horizontal[mt]=st),xt(),Fa(ve)&&g&&b&&(j.vertical=du(W,i.glyphMap,i.glyphPositions,i.imagePositions,P,nt,m,_t,mt,Be,re,s.ai.vertical,!1,ut,O,D))}}let pe=!1;if(C.icon&&C.icon.name){const ve=i.imageMap[C.icon.name];ve&&(ee=h_(i.imagePositions[C.icon.name],n.get("icon-offset").evaluate(C,{},i.canonical),n.get("icon-anchor").evaluate(C,{},i.canonical)),pe=!!ve.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=pe:i.bucket.sdfIcons!==pe&&$e("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ve.pixelRatio!==i.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const oe=Sp(j.horizontal)||j.vertical;i.bucket.iconsInText=!!oe&&oe.iconsInText,(oe||ee)&&k_(i.bucket,C,j,ee,i.imageMap,c,O,U,re,pe,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},s.br=ih,s.bs=$u,s.bt=th,s.bu=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},s.bv=rh,s.bw=Va,s.bx=function(i,e,n,o,c){return F(this,void 0,void 0,function*(){if(Ke())try{return yield Pi(i,e,n,o,c)}catch{}return function(m,g,b,T,C){const P=m.width,D=m.height;Mi&&Ut||(Mi=new OffscreenCanvas(P,D),Ut=Mi.getContext("2d",{willReadFrequently:!0})),Mi.width=P,Mi.height=D,Ut.drawImage(m,0,0,P,D);const O=Ut.getImageData(g,b,T,C);return Ut.clearRect(0,0,P,D),O.data}(i,e,n,o,c)})},s.by=sp,s.bz=M,s.c=Gt,s.d=function(i,e){const n=new Image;n.onload=()=>{e(null,n),URL.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame(()=>{n.src=zn})},n.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const o=new Blob([new Uint8Array(i)],{type:"image/png"});n.src=i.byteLength?URL.createObjectURL(o):zn},s.e=zt,s.f=function(i,e){return Qi(zt(i,{type:"json"}),e)},s.g=gt,s.h=qe,s.i=Lt,s.j=Dn,s.k=_r,s.l=Ze,s.m=Qi,s.n=function(i){return new rh(i).readFields(o_,[])},s.o=function(i,e,n){if(!i.length)return n(null,[]);let o=i.length;const c=new Array(i.length);let m=null;i.forEach((g,b)=>{e(g,(T,C)=>{T&&(m=T),c[b]=C,--o==0&&n(m,c)})})},s.p=Nd,s.q=pc,s.r=On,s.s=Ui,s.t=Ki,s.u=ot,s.v=ke,s.w=$e,s.x=ro,s.y=zo,s.z=function([i,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(n),y:i*Math.sin(e)*Math.sin(n),z:i*Math.cos(n)}}}),S(["./shared"],function(s){class F{constructor(R){this.keyCache={},R&&this.replace(R)}replace(R){this._layerConfigs={},this._layers={},this.update(R,[])}update(R,B){for(const Y of R){this._layerConfigs[Y.id]=Y;const $=this._layers[Y.id]=s.aC(Y);$._featureFilter=s.a6($.filter),this.keyCache[Y.id]&&delete this.keyCache[Y.id]}for(const Y of B)delete this.keyCache[Y],delete this._layerConfigs[Y],delete this._layers[Y];this.familiesBySource={};const Z=s.bl(Object.values(this._layerConfigs),this.keyCache);for(const Y of Z){const $=Y.map(Fe=>this._layers[Fe.id]),me=$[0];if(me.visibility==="none")continue;const ae=me.source||"";let ne=this.familiesBySource[ae];ne||(ne=this.familiesBySource[ae]={});const ce=me.sourceLayer||"_geojsonTileLayer";let Le=ne[ce];Le||(Le=ne[ce]=[]),Le.push($)}}}class M{constructor(R){const B={},Z=[];for(const ae in R){const ne=R[ae],ce=B[ae]={};for(const Le in ne){const Fe=ne[+Le];if(!Fe||Fe.bitmap.width===0||Fe.bitmap.height===0)continue;const Re={x:0,y:0,w:Fe.bitmap.width+2,h:Fe.bitmap.height+2};Z.push(Re),ce[Le]={rect:Re,metrics:Fe.metrics}}}const{w:Y,h:$}=s.p(Z),me=new s.q({width:Y||1,height:$||1});for(const ae in R){const ne=R[ae];for(const ce in ne){const Le=ne[+ce];if(!Le||Le.bitmap.width===0||Le.bitmap.height===0)continue;const Fe=B[ae][ce].rect;s.q.copy(Le.bitmap,me,{x:0,y:0},{x:Fe.x+1,y:Fe.y+1},Le.bitmap)}}this.image=me,this.positions=B}}s.bm("GlyphAtlas",M);class q{constructor(R){this.tileID=new s.O(R.tileID.overscaledZ,R.tileID.wrap,R.tileID.canonical.z,R.tileID.canonical.x,R.tileID.canonical.y),this.uid=R.uid,this.zoom=R.zoom,this.pixelRatio=R.pixelRatio,this.tileSize=R.tileSize,this.source=R.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=R.showCollisionBoxes,this.collectResourceTiming=!!R.collectResourceTiming,this.returnDependencies=!!R.returnDependencies,this.promoteId=R.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(R,B,Z,Y,$){this.status="parsing",this.data=R,this.collisionBoxArray=new s.a3;const me=new s.bn(Object.keys(R.layers).sort()),ae=new s.bo(this.tileID,this.promoteId);ae.bucketLayerIDs=[];const ne={},ce={featureIndex:ae,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Z},Le=B.familiesBySource[this.source];for(const Ii in Le){const wi=R.layers[Ii];if(!wi)continue;wi.version===1&&s.w(`Vector tile source "${this.source}" layer "${Ii}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const nr=me.encode(Ii),ji=[];for(let Cn=0;Cn<wi.length;Cn++){const Fn=wi.feature(Cn),Ur=ae.getId(Fn,Ii);ji.push({feature:Fn,id:Ur,index:Cn,sourceLayerIndex:nr})}for(const Cn of Le[Ii]){const Fn=Cn[0];Fn.source!==this.source&&s.w(`layer.source = ${Fn.source} does not equal this.source = ${this.source}`),Fn.minzoom&&this.zoom<Math.floor(Fn.minzoom)||Fn.maxzoom&&this.zoom>=Fn.maxzoom||Fn.visibility!=="none"&&(ie(Cn,this.zoom,Z),(ne[Fn.id]=Fn.createBucket({index:ae.bucketLayerIDs.length,layers:Cn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:nr,sourceID:this.source})).populate(ji,ce,this.tileID.canonical),ae.bucketLayerIDs.push(Cn.map(Ur=>Ur.id)))}}let Fe,Re,Et,Yt;const bt=s.aH(ce.glyphDependencies,Ii=>Object.keys(Ii).map(Number));this.inFlightDependencies.forEach(Ii=>Ii==null?void 0:Ii.cancel()),this.inFlightDependencies=[];const Dt=++this.dependencySentinel;Object.keys(bt).length?this.inFlightDependencies.push(Y.send("getGlyphs",{uid:this.uid,stacks:bt,source:this.source,tileID:this.tileID,type:"glyphs"},(Ii,wi)=>{Dt===this.dependencySentinel&&(Fe||(Fe=Ii,Re=wi,ai.call(this)))})):Re={};const ti=Object.keys(ce.iconDependencies);ti.length?this.inFlightDependencies.push(Y.send("getImages",{icons:ti,source:this.source,tileID:this.tileID,type:"icons"},(Ii,wi)=>{Dt===this.dependencySentinel&&(Fe||(Fe=Ii,Et=wi,ai.call(this)))})):Et={};const Ai=Object.keys(ce.patternDependencies);function ai(){if(Fe)return $(Fe);if(Re&&Et&&Yt){const Ii=new M(Re),wi=new s.bp(Et,Yt);for(const nr in ne){const ji=ne[nr];ji instanceof s.a4?(ie(ji.layers,this.zoom,Z),s.bq({bucket:ji,glyphMap:Re,glyphPositions:Ii.positions,imageMap:Et,imagePositions:wi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ji.hasPattern&&(ji instanceof s.br||ji instanceof s.bs||ji instanceof s.bt)&&(ie(ji.layers,this.zoom,Z),ji.addFeatures(ce,this.tileID.canonical,wi.patternPositions))}this.status="done",$(null,{buckets:Object.values(ne).filter(nr=>!nr.isEmpty()),featureIndex:ae,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ii.image,imageAtlas:wi,glyphMap:this.returnDependencies?Re:null,iconMap:this.returnDependencies?Et:null,glyphPositions:this.returnDependencies?Ii.positions:null})}}Ai.length?this.inFlightDependencies.push(Y.send("getImages",{icons:Ai,source:this.source,tileID:this.tileID,type:"patterns"},(Ii,wi)=>{Dt===this.dependencySentinel&&(Fe||(Fe=Ii,Yt=wi,ai.call(this)))})):Yt={},ai.call(this)}}function ie(K,R,B){const Z=new s.a8(R);for(const Y of K)Y.recalculate(Z,B)}function he(K,R){const B=s.l(K.request,(Z,Y,$,me)=>{if(Z)R(Z);else if(Y)try{const ae=new s.bw.VectorTile(new s.bv(Y));R(null,{vectorTile:ae,rawData:Y,cacheControl:$,expires:me})}catch(ae){const ne=new Uint8Array(Y);let ce=`Unable to parse the tile at ${K.request.url}, `;ce+=ne[0]===31&&ne[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ae.messge}`,R(new Error(ce))}});return()=>{B.cancel(),R()}}class xe{constructor(R,B,Z,Y){this.actor=R,this.layerIndex=B,this.availableImages=Z,this.loadVectorData=Y||he,this.fetching={},this.loading={},this.loaded={}}loadTile(R,B){const Z=R.uid;this.loading||(this.loading={});const Y=!!(R&&R.request&&R.request.collectResourceTiming)&&new s.bu(R.request),$=this.loading[Z]=new q(R);$.abort=this.loadVectorData(R,(me,ae)=>{if(delete this.loading[Z],me||!ae)return $.status="done",this.loaded[Z]=$,B(me);const ne=ae.rawData,ce={};ae.expires&&(ce.expires=ae.expires),ae.cacheControl&&(ce.cacheControl=ae.cacheControl);const Le={};if(Y){const Fe=Y.finish();Fe&&(Le.resourceTiming=JSON.parse(JSON.stringify(Fe)))}$.vectorTile=ae.vectorTile,$.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor,(Fe,Re)=>{if(delete this.fetching[Z],Fe||!Re)return B(Fe);B(null,s.e({rawTileData:ne.slice(0)},Re,ce,Le))}),this.loaded=this.loaded||{},this.loaded[Z]=$,this.fetching[Z]={rawTileData:ne,cacheControl:ce,resourceTiming:Le}})}reloadTile(R,B){const Z=this.loaded,Y=R.uid;if(Z&&Z[Y]){const $=Z[Y];$.showCollisionBoxes=R.showCollisionBoxes,$.status==="parsing"?$.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor,(me,ae)=>{if(me||!ae)return B(me,ae);let ne;if(this.fetching[Y]){const{rawTileData:ce,cacheControl:Le,resourceTiming:Fe}=this.fetching[Y];delete this.fetching[Y],ne=s.e({rawTileData:ce.slice(0)},ae,Le,Fe)}else ne=ae;B(null,ne)}):$.status==="done"&&($.vectorTile?$.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor,B):B())}}abortTile(R,B){const Z=this.loading,Y=R.uid;Z&&Z[Y]&&Z[Y].abort&&(Z[Y].abort(),delete Z[Y]),B()}removeTile(R,B){const Z=this.loaded,Y=R.uid;Z&&Z[Y]&&delete Z[Y],B()}}class ye{constructor(){this.loaded={}}loadTile(R,B){return s._(this,void 0,void 0,function*(){const{uid:Z,encoding:Y,rawImageData:$,redFactor:me,greenFactor:ae,blueFactor:ne,baseShift:ce}=R,Le=$.width+2,Fe=$.height+2,Re=s.a($)?new s.R({width:Le,height:Fe},yield s.bx($,-1,-1,Le,Fe)):$,Et=new s.by(Z,Re,Y,me,ae,ne,ce);this.loaded=this.loaded||{},this.loaded[Z]=Et,B(null,Et)})}removeTile(R){const B=this.loaded,Z=R.uid;B&&B[Z]&&delete B[Z]}}function ge(K,R){if(K.length!==0){fe(K[0],R);for(var B=1;B<K.length;B++)fe(K[B],!R)}}function fe(K,R){for(var B=0,Z=0,Y=0,$=K.length,me=$-1;Y<$;me=Y++){var ae=(K[Y][0]-K[me][0])*(K[me][1]+K[Y][1]),ne=B+ae;Z+=Math.abs(B)>=Math.abs(ae)?B-ne+ae:ae-ne+B,B=ne}B+Z>=0!=!!R&&K.reverse()}var Te=s.bz(function K(R,B){var Z,Y=R&&R.type;if(Y==="FeatureCollection")for(Z=0;Z<R.features.length;Z++)K(R.features[Z],B);else if(Y==="GeometryCollection")for(Z=0;Z<R.geometries.length;Z++)K(R.geometries[Z],B);else if(Y==="Feature")K(R.geometry,B);else if(Y==="Polygon")ge(R.coordinates,B);else if(Y==="MultiPolygon")for(Z=0;Z<R.coordinates.length;Z++)ge(R.coordinates[Z],B);return R});const Pe=s.bw.VectorTileFeature.prototype.toGeoJSON;var Ke={exports:{}},je=s.bA,St=s.bw.VectorTileFeature,vt=yt;function yt(K,R){this.options=R||{},this.features=K,this.length=K.length}function zt(K,R){this.id=typeof K.id=="number"?K.id:void 0,this.type=K.type,this.rawGeometry=K.type===1?[K.geometry]:K.geometry,this.properties=K.tags,this.extent=R||4096}yt.prototype.feature=function(K){return new zt(this.features[K],this.options.extent)},zt.prototype.loadGeometry=function(){var K=this.rawGeometry;this.geometry=[];for(var R=0;R<K.length;R++){for(var B=K[R],Z=[],Y=0;Y<B.length;Y++)Z.push(new je(B[Y][0],B[Y][1]));this.geometry.push(Z)}return this.geometry},zt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var K=this.geometry,R=1/0,B=-1/0,Z=1/0,Y=-1/0,$=0;$<K.length;$++)for(var me=K[$],ae=0;ae<me.length;ae++){var ne=me[ae];R=Math.min(R,ne.x),B=Math.max(B,ne.x),Z=Math.min(Z,ne.y),Y=Math.max(Y,ne.y)}return[R,Z,B,Y]},zt.prototype.toGeoJSON=St.prototype.toGeoJSON;var wt=s.bB,Nt=vt;function De(K){var R=new wt;return function(B,Z){for(var Y in B.layers)Z.writeMessage(3,Je,B.layers[Y])}(K,R),R.finish()}function Je(K,R){var B;R.writeVarintField(15,K.version||1),R.writeStringField(1,K.name||""),R.writeVarintField(5,K.extent||4096);var Z={keys:[],values:[],keycache:{},valuecache:{}};for(B=0;B<K.length;B++)Z.feature=K.feature(B),R.writeMessage(2,$t,Z);var Y=Z.keys;for(B=0;B<Y.length;B++)R.writeStringField(3,Y[B]);var $=Z.values;for(B=0;B<$.length;B++)R.writeMessage(4,ui,$[B])}function $t(K,R){var B=K.feature;B.id!==void 0&&R.writeVarintField(1,B.id),R.writeMessage(2,$e,K),R.writeVarintField(3,B.type),R.writeMessage(4,Lt,B)}function $e(K,R){var B=K.feature,Z=K.keys,Y=K.values,$=K.keycache,me=K.valuecache;for(var ae in B.properties){var ne=B.properties[ae],ce=$[ae];if(ne!==null){ce===void 0&&(Z.push(ae),$[ae]=ce=Z.length-1),R.writeVarint(ce);var Le=typeof ne;Le!=="string"&&Le!=="boolean"&&Le!=="number"&&(ne=JSON.stringify(ne));var Fe=Le+":"+ne,Re=me[Fe];Re===void 0&&(Y.push(ne),me[Fe]=Re=Y.length-1),R.writeVarint(Re)}}}function Kt(K,R){return(R<<3)+(7&K)}function Pt(K){return K<<1^K>>31}function Lt(K,R){for(var B=K.loadGeometry(),Z=K.type,Y=0,$=0,me=B.length,ae=0;ae<me;ae++){var ne=B[ae],ce=1;Z===1&&(ce=ne.length),R.writeVarint(Kt(1,ce));for(var Le=Z===3?ne.length-1:ne.length,Fe=0;Fe<Le;Fe++){Fe===1&&Z!==1&&R.writeVarint(Kt(2,Le-1));var Re=ne[Fe].x-Y,Et=ne[Fe].y-$;R.writeVarint(Pt(Re)),R.writeVarint(Pt(Et)),Y+=Re,$+=Et}Z===3&&R.writeVarint(Kt(7,1))}}function ui(K,R){var B=typeof K;B==="string"?R.writeStringField(1,K):B==="boolean"?R.writeBooleanField(7,K):B==="number"&&(K%1!=0?R.writeDoubleField(3,K):K<0?R.writeSVarintField(6,K):R.writeVarintField(5,K))}Ke.exports=De,Ke.exports.fromVectorTileJs=De,Ke.exports.fromGeojsonVt=function(K,R){R=R||{};var B={};for(var Z in K)B[Z]=new Nt(K[Z].features,R),B[Z].name=Z,B[Z].version=R.version,B[Z].extent=R.extent;return De({layers:B})},Ke.exports.GeoJSONWrapper=Nt;var Ln=s.bz(Ke.exports);const zn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:K=>K},Pi=Math.fround||(Mi=new Float32Array(1),K=>(Mi[0]=+K,Mi[0]));var Mi;const Ut=3,bi=5,Li=6;class qe{constructor(R){this.options=Object.assign(Object.create(zn),R),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(R){const{log:B,minZoom:Z,maxZoom:Y}=this.options;B&&console.time("total time");const $=`prepare ${R.length} points`;B&&console.time($),this.points=R;const me=[];for(let ne=0;ne<R.length;ne++){const ce=R[ne];if(!ce.geometry)continue;const[Le,Fe]=ce.geometry.coordinates,Re=Pi(si(Le)),Et=Pi(gt(Fe));me.push(Re,Et,1/0,ne,-1,1),this.options.reduce&&me.push(0)}let ae=this.trees[Y+1]=this._createTree(me);B&&console.timeEnd($);for(let ne=Y;ne>=Z;ne--){const ce=+Date.now();ae=this.trees[ne]=this._createTree(this._cluster(ae,ne)),B&&console.log("z%d: %d clusters in %dms",ne,ae.numItems,+Date.now()-ce)}return B&&console.timeEnd("total time"),this}getClusters(R,B){let Z=((R[0]+180)%360+360)%360-180;const Y=Math.max(-90,Math.min(90,R[1]));let $=R[2]===180?180:((R[2]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,R[3]));if(R[2]-R[0]>=360)Z=-180,$=180;else if(Z>$){const Fe=this.getClusters([Z,Y,180,me],B),Re=this.getClusters([-180,Y,$,me],B);return Fe.concat(Re)}const ae=this.trees[this._limitZoom(B)],ne=ae.range(si(Z),gt(me),si($),gt(Y)),ce=ae.data,Le=[];for(const Fe of ne){const Re=this.stride*Fe;Le.push(ce[Re+bi]>1?Gt(ce,Re,this.clusterProps):this.points[ce[Re+Ut]])}return Le}getChildren(R){const B=this._getOriginId(R),Z=this._getOriginZoom(R),Y="No cluster with the specified id.",$=this.trees[Z];if(!$)throw new Error(Y);const me=$.data;if(B*this.stride>=me.length)throw new Error(Y);const ae=this.options.radius/(this.options.extent*Math.pow(2,Z-1)),ne=$.within(me[B*this.stride],me[B*this.stride+1],ae),ce=[];for(const Le of ne){const Fe=Le*this.stride;me[Fe+4]===R&&ce.push(me[Fe+bi]>1?Gt(me,Fe,this.clusterProps):this.points[me[Fe+Ut]])}if(ce.length===0)throw new Error(Y);return ce}getLeaves(R,B,Z){const Y=[];return this._appendLeaves(Y,R,B=B||10,Z=Z||0,0),Y}getTile(R,B,Z){const Y=this.trees[this._limitZoom(R)],$=Math.pow(2,R),{extent:me,radius:ae}=this.options,ne=ae/me,ce=(Z-ne)/$,Le=(Z+1+ne)/$,Fe={features:[]};return this._addTileFeatures(Y.range((B-ne)/$,ce,(B+1+ne)/$,Le),Y.data,B,Z,$,Fe),B===0&&this._addTileFeatures(Y.range(1-ne/$,ce,1,Le),Y.data,$,Z,$,Fe),B===$-1&&this._addTileFeatures(Y.range(0,ce,ne/$,Le),Y.data,-1,Z,$,Fe),Fe.features.length?Fe:null}getClusterExpansionZoom(R){let B=this._getOriginZoom(R)-1;for(;B<=this.options.maxZoom;){const Z=this.getChildren(R);if(B++,Z.length!==1)break;R=Z[0].properties.cluster_id}return B}_appendLeaves(R,B,Z,Y,$){const me=this.getChildren(B);for(const ae of me){const ne=ae.properties;if(ne&&ne.cluster?$+ne.point_count<=Y?$+=ne.point_count:$=this._appendLeaves(R,ne.cluster_id,Z,Y,$):$<Y?$++:R.push(ae),R.length===Z)break}return $}_createTree(R){const B=new s.av(R.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Z=0;Z<R.length;Z+=this.stride)B.add(R[Z],R[Z+1]);return B.finish(),B.data=R,B}_addTileFeatures(R,B,Z,Y,$,me){for(const ae of R){const ne=ae*this.stride,ce=B[ne+bi]>1;let Le,Fe,Re;if(ce)Le=it(B,ne,this.clusterProps),Fe=B[ne],Re=B[ne+1];else{const bt=this.points[B[ne+Ut]];Le=bt.properties;const[Dt,ti]=bt.geometry.coordinates;Fe=si(Dt),Re=gt(ti)}const Et={type:1,geometry:[[Math.round(this.options.extent*(Fe*$-Z)),Math.round(this.options.extent*(Re*$-Y))]],tags:Le};let Yt;Yt=ce||this.options.generateId?B[ne+Ut]:this.points[B[ne+Ut]].id,Yt!==void 0&&(Et.id=Yt),me.features.push(Et)}}_limitZoom(R){return Math.max(this.options.minZoom,Math.min(Math.floor(+R),this.options.maxZoom+1))}_cluster(R,B){const{radius:Z,extent:Y,reduce:$,minPoints:me}=this.options,ae=Z/(Y*Math.pow(2,B)),ne=R.data,ce=[],Le=this.stride;for(let Fe=0;Fe<ne.length;Fe+=Le){if(ne[Fe+2]<=B)continue;ne[Fe+2]=B;const Re=ne[Fe],Et=ne[Fe+1],Yt=R.within(ne[Fe],ne[Fe+1],ae),bt=ne[Fe+bi];let Dt=bt;for(const ti of Yt){const Ai=ti*Le;ne[Ai+2]>B&&(Dt+=ne[Ai+bi])}if(Dt>bt&&Dt>=me){let ti,Ai=Re*bt,ai=Et*bt,Ii=-1;const wi=((Fe/Le|0)<<5)+(B+1)+this.points.length;for(const nr of Yt){const ji=nr*Le;if(ne[ji+2]<=B)continue;ne[ji+2]=B;const Cn=ne[ji+bi];Ai+=ne[ji]*Cn,ai+=ne[ji+1]*Cn,ne[ji+4]=wi,$&&(ti||(ti=this._map(ne,Fe,!0),Ii=this.clusterProps.length,this.clusterProps.push(ti)),$(ti,this._map(ne,ji)))}ne[Fe+4]=wi,ce.push(Ai/Dt,ai/Dt,1/0,wi,-1,Dt),$&&ce.push(Ii)}else{for(let ti=0;ti<Le;ti++)ce.push(ne[Fe+ti]);if(Dt>1)for(const ti of Yt){const Ai=ti*Le;if(!(ne[Ai+2]<=B)){ne[Ai+2]=B;for(let ai=0;ai<Le;ai++)ce.push(ne[Ai+ai])}}}}return ce}_getOriginId(R){return R-this.points.length>>5}_getOriginZoom(R){return(R-this.points.length)%32}_map(R,B,Z){if(R[B+bi]>1){const me=this.clusterProps[R[B+Li]];return Z?Object.assign({},me):me}const Y=this.points[R[B+Ut]].properties,$=this.options.map(Y);return Z&&$===Y?Object.assign({},$):$}}function Gt(K,R,B){return{type:"Feature",id:K[R+Ut],properties:it(K,R,B),geometry:{type:"Point",coordinates:[(Z=K[R],360*(Z-.5)),Xi(K[R+1])]}};var Z}function it(K,R,B){const Z=K[R+bi],Y=Z>=1e4?`${Math.round(Z/1e3)}k`:Z>=1e3?Math.round(Z/100)/10+"k":Z,$=K[R+Li],me=$===-1?{}:Object.assign({},B[$]);return Object.assign(me,{cluster:!0,cluster_id:K[R+Ut],point_count:Z,point_count_abbreviated:Y})}function si(K){return K/360+.5}function gt(K){const R=Math.sin(K*Math.PI/180),B=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return B<0?0:B>1?1:B}function Xi(K){const R=(180-360*K)*Math.PI/180;return 360*Math.atan(Math.exp(R))/Math.PI-90}function Qi(K,R,B,Z){for(var Y,$=Z,me=B-R>>1,ae=B-R,ne=K[R],ce=K[R+1],Le=K[B],Fe=K[B+1],Re=R+3;Re<B;Re+=3){var Et=Ze(K[Re],K[Re+1],ne,ce,Le,Fe);if(Et>$)Y=Re,$=Et;else if(Et===$){var Yt=Math.abs(Re-me);Yt<ae&&(Y=Re,ae=Yt)}}$>Z&&(Y-R>3&&Qi(K,R,Y,Z),K[Y+2]=$,B-Y>3&&Qi(K,Y,B,Z))}function Ze(K,R,B,Z,Y,$){var me=Y-B,ae=$-Z;if(me!==0||ae!==0){var ne=((K-B)*me+(R-Z)*ae)/(me*me+ae*ae);ne>1?(B=Y,Z=$):ne>0&&(B+=me*ne,Z+=ae*ne)}return(me=K-B)*me+(ae=R-Z)*ae}function Ui(K,R,B,Z){var Y={id:K===void 0?null:K,type:R,geometry:B,tags:Z,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function($){var me=$.geometry,ae=$.type;if(ae==="Point"||ae==="MultiPoint"||ae==="LineString")bn($,me);else if(ae==="Polygon"||ae==="MultiLineString")for(var ne=0;ne<me.length;ne++)bn($,me[ne]);else if(ae==="MultiPolygon")for(ne=0;ne<me.length;ne++)for(var ce=0;ce<me[ne].length;ce++)bn($,me[ne][ce])}(Y),Y}function bn(K,R){for(var B=0;B<R.length;B+=3)K.minX=Math.min(K.minX,R[B]),K.minY=Math.min(K.minY,R[B+1]),K.maxX=Math.max(K.maxX,R[B]),K.maxY=Math.max(K.maxY,R[B+1])}function xi(K,R,B,Z){if(R.geometry){var Y=R.geometry.coordinates,$=R.geometry.type,me=Math.pow(B.tolerance/((1<<B.maxZoom)*B.extent),2),ae=[],ne=R.id;if(B.promoteId?ne=R.properties[B.promoteId]:B.generateId&&(ne=Z||0),$==="Point")_r(Y,ae);else if($==="MultiPoint")for(var ce=0;ce<Y.length;ce++)_r(Y[ce],ae);else if($==="LineString")Dn(Y,ae,me,!1);else if($==="MultiLineString"){if(B.lineMetrics){for(ce=0;ce<Y.length;ce++)Dn(Y[ce],ae=[],me,!1),K.push(Ui(ne,"LineString",ae,R.properties));return}yo(Y,ae,me,!1)}else if($==="Polygon")yo(Y,ae,me,!0);else{if($!=="MultiPolygon"){if($==="GeometryCollection"){for(ce=0;ce<R.geometry.geometries.length;ce++)xi(K,{id:ne,geometry:R.geometry.geometries[ce],properties:R.properties},B,Z);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ce=0;ce<Y.length;ce++){var Le=[];yo(Y[ce],Le,me,!0),ae.push(Le)}}K.push(Ui(ne,$,ae,R.properties))}}function _r(K,R){R.push(ke(K[0])),R.push(tn(K[1])),R.push(0)}function Dn(K,R,B,Z){for(var Y,$,me=0,ae=0;ae<K.length;ae++){var ne=ke(K[ae][0]),ce=tn(K[ae][1]);R.push(ne),R.push(ce),R.push(0),ae>0&&(me+=Z?(Y*ce-ne*$)/2:Math.sqrt(Math.pow(ne-Y,2)+Math.pow(ce-$,2))),Y=ne,$=ce}var Le=R.length-3;R[2]=1,Qi(R,0,Le,B),R[Le+2]=1,R.size=Math.abs(me),R.start=0,R.end=R.size}function yo(K,R,B,Z){for(var Y=0;Y<K.length;Y++){var $=[];Dn(K[Y],$,B,Z),R.push($)}}function ke(K){return K/360+.5}function tn(K){var R=Math.sin(K*Math.PI/180),B=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return B<0?0:B>1?1:B}function zi(K,R,B,Z,Y,$,me,ae){if(Z/=R,$>=(B/=R)&&me<Z)return K;if(me<B||$>=Z)return null;for(var ne=[],ce=0;ce<K.length;ce++){var Le=K[ce],Fe=Le.geometry,Re=Le.type,Et=Y===0?Le.minX:Le.minY,Yt=Y===0?Le.maxX:Le.maxY;if(Et>=B&&Yt<Z)ne.push(Le);else if(!(Yt<B||Et>=Z)){var bt=[];if(Re==="Point"||Re==="MultiPoint")jt(Fe,bt,B,Z,Y);else if(Re==="LineString")ei(Fe,bt,B,Z,Y,!1,ae.lineMetrics);else if(Re==="MultiLineString")Br(Fe,bt,B,Z,Y,!1);else if(Re==="Polygon")Br(Fe,bt,B,Z,Y,!0);else if(Re==="MultiPolygon")for(var Dt=0;Dt<Fe.length;Dt++){var ti=[];Br(Fe[Dt],ti,B,Z,Y,!0),ti.length&&bt.push(ti)}if(bt.length){if(ae.lineMetrics&&Re==="LineString"){for(Dt=0;Dt<bt.length;Dt++)ne.push(Ui(Le.id,Re,bt[Dt],Le.tags));continue}Re!=="LineString"&&Re!=="MultiLineString"||(bt.length===1?(Re="LineString",bt=bt[0]):Re="MultiLineString"),Re!=="Point"&&Re!=="MultiPoint"||(Re=bt.length===3?"Point":"MultiPoint"),ne.push(Ui(Le.id,Re,bt,Le.tags))}}}return ne.length?ne:null}function jt(K,R,B,Z,Y){for(var $=0;$<K.length;$+=3){var me=K[$+Y];me>=B&&me<=Z&&(R.push(K[$]),R.push(K[$+1]),R.push(K[$+2]))}}function ei(K,R,B,Z,Y,$,me){for(var ae,ne,ce=$r(K),Le=Y===0?as:No,Fe=K.start,Re=0;Re<K.length-3;Re+=3){var Et=K[Re],Yt=K[Re+1],bt=K[Re+2],Dt=K[Re+3],ti=K[Re+4],Ai=Y===0?Et:Yt,ai=Y===0?Dt:ti,Ii=!1;me&&(ae=Math.sqrt(Math.pow(Et-Dt,2)+Math.pow(Yt-ti,2))),Ai<B?ai>B&&(ne=Le(ce,Et,Yt,Dt,ti,B),me&&(ce.start=Fe+ae*ne)):Ai>Z?ai<Z&&(ne=Le(ce,Et,Yt,Dt,ti,Z),me&&(ce.start=Fe+ae*ne)):eo(ce,Et,Yt,bt),ai<B&&Ai>=B&&(ne=Le(ce,Et,Yt,Dt,ti,B),Ii=!0),ai>Z&&Ai<=Z&&(ne=Le(ce,Et,Yt,Dt,ti,Z),Ii=!0),!$&&Ii&&(me&&(ce.end=Fe+ae*ne),R.push(ce),ce=$r(K)),me&&(Fe+=ae)}var wi=K.length-3;Et=K[wi],Yt=K[wi+1],bt=K[wi+2],(Ai=Y===0?Et:Yt)>=B&&Ai<=Z&&eo(ce,Et,Yt,bt),wi=ce.length-3,$&&wi>=3&&(ce[wi]!==ce[0]||ce[wi+1]!==ce[1])&&eo(ce,ce[0],ce[1],ce[2]),ce.length&&R.push(ce)}function $r(K){var R=[];return R.size=K.size,R.start=K.start,R.end=K.end,R}function Br(K,R,B,Z,Y,$){for(var me=0;me<K.length;me++)ei(K[me],R,B,Z,Y,$,!1)}function eo(K,R,B,Z){K.push(R),K.push(B),K.push(Z)}function as(K,R,B,Z,Y,$){var me=($-R)/(Z-R);return K.push($),K.push(B+(Y-B)*me),K.push(1),me}function No(K,R,B,Z,Y,$){var me=($-B)/(Y-B);return K.push(R+(Z-R)*me),K.push($),K.push(1),me}function Nr(K,R){for(var B=[],Z=0;Z<K.length;Z++){var Y,$=K[Z],me=$.type;if(me==="Point"||me==="MultiPoint"||me==="LineString")Y=vo($.geometry,R);else if(me==="MultiLineString"||me==="Polygon"){Y=[];for(var ae=0;ae<$.geometry.length;ae++)Y.push(vo($.geometry[ae],R))}else if(me==="MultiPolygon")for(Y=[],ae=0;ae<$.geometry.length;ae++){for(var ne=[],ce=0;ce<$.geometry[ae].length;ce++)ne.push(vo($.geometry[ae][ce],R));Y.push(ne)}B.push(Ui($.id,me,Y,$.tags))}return B}function vo(K,R){var B=[];B.size=K.size,K.start!==void 0&&(B.start=K.start,B.end=K.end);for(var Z=0;Z<K.length;Z+=3)B.push(K[Z]+R,K[Z+1],K[Z+2]);return B}function tt(K,R){if(K.transformed)return K;var B,Z,Y,$=1<<K.z,me=K.x,ae=K.y;for(B=0;B<K.features.length;B++){var ne=K.features[B],ce=ne.geometry,Le=ne.type;if(ne.geometry=[],Le===1)for(Z=0;Z<ce.length;Z+=2)ne.geometry.push(Er(ce[Z],ce[Z+1],R,$,me,ae));else for(Z=0;Z<ce.length;Z++){var Fe=[];for(Y=0;Y<ce[Z].length;Y+=2)Fe.push(Er(ce[Z][Y],ce[Z][Y+1],R,$,me,ae));ne.geometry.push(Fe)}}return K.transformed=!0,K}function Er(K,R,B,Z,Y,$){return[Math.round(B*(K*Z-Y)),Math.round(B*(R*Z-$))]}function mn(K,R,B,Z,Y){for(var $=R===Y.maxZoom?0:Y.tolerance/((1<<R)*Y.extent),me={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:B,y:Z,z:R,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ae=0;ae<K.length;ae++){me.numFeatures++,ls(me,K[ae],$,Y);var ne=K[ae].minX,ce=K[ae].minY,Le=K[ae].maxX,Fe=K[ae].maxY;ne<me.minX&&(me.minX=ne),ce<me.minY&&(me.minY=ce),Le>me.maxX&&(me.maxX=Le),Fe>me.maxY&&(me.maxY=Fe)}return me}function ls(K,R,B,Z){var Y=R.geometry,$=R.type,me=[];if($==="Point"||$==="MultiPoint")for(var ae=0;ae<Y.length;ae+=3)me.push(Y[ae]),me.push(Y[ae+1]),K.numPoints++,K.numSimplified++;else if($==="LineString")gr(me,Y,K,B,!1,!1);else if($==="MultiLineString"||$==="Polygon")for(ae=0;ae<Y.length;ae++)gr(me,Y[ae],K,B,$==="Polygon",ae===0);else if($==="MultiPolygon")for(var ne=0;ne<Y.length;ne++){var ce=Y[ne];for(ae=0;ae<ce.length;ae++)gr(me,ce[ae],K,B,!0,ae===0)}if(me.length){var Le=R.tags||null;if($==="LineString"&&Z.lineMetrics){for(var Fe in Le={},R.tags)Le[Fe]=R.tags[Fe];Le.mapbox_clip_start=Y.start/Y.size,Le.mapbox_clip_end=Y.end/Y.size}var Re={geometry:me,type:$==="Polygon"||$==="MultiPolygon"?3:$==="LineString"||$==="MultiLineString"?2:1,tags:Le};R.id!==null&&(Re.id=R.id),K.features.push(Re)}}function gr(K,R,B,Z,Y,$){var me=Z*Z;if(Z>0&&R.size<(Y?me:Z))B.numPoints+=R.length/3;else{for(var ae=[],ne=0;ne<R.length;ne+=3)(Z===0||R[ne+2]>me)&&(B.numSimplified++,ae.push(R[ne]),ae.push(R[ne+1])),B.numPoints++;Y&&function(ce,Le){for(var Fe=0,Re=0,Et=ce.length,Yt=Et-2;Re<Et;Yt=Re,Re+=2)Fe+=(ce[Re]-ce[Yt])*(ce[Re+1]+ce[Yt+1]);if(Fe>0===Le)for(Re=0,Et=ce.length;Re<Et/2;Re+=2){var bt=ce[Re],Dt=ce[Re+1];ce[Re]=ce[Et-2-Re],ce[Re+1]=ce[Et-1-Re],ce[Et-2-Re]=bt,ce[Et-1-Re]=Dt}}(ae,$),K.push(ae)}}function rt(K,R){var B=(R=this.options=function(Y,$){for(var me in $)Y[me]=$[me];return Y}(Object.create(this.options),R)).debug;if(B&&console.time("preprocess data"),R.maxZoom<0||R.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(R.promoteId&&R.generateId)throw new Error("promoteId and generateId cannot be used together.");var Z=function(Y,$){var me=[];if(Y.type==="FeatureCollection")for(var ae=0;ae<Y.features.length;ae++)xi(me,Y.features[ae],$,ae);else xi(me,Y.type==="Feature"?Y:{geometry:Y},$);return me}(K,R);this.tiles={},this.tileCoords=[],B&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",R.indexMaxZoom,R.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Z=function(Y,$){var me=$.buffer/$.extent,ae=Y,ne=zi(Y,1,-1-me,me,0,-1,2,$),ce=zi(Y,1,1-me,2+me,0,-1,2,$);return(ne||ce)&&(ae=zi(Y,1,-me,1+me,0,-1,2,$)||[],ne&&(ae=Nr(ne,1).concat(ae)),ce&&(ae=ae.concat(Nr(ce,-1)))),ae}(Z,R),Z.length&&this.splitTile(Z,0,0,0),B&&(Z.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function oi(K,R,B){return 32*((1<<K)*B+R)+K}function Jt(K,R){return R?K.properties[R]:K.id}function ir(K,R){if(K==null)return!0;if(K.type==="Feature")return Jt(K,R)!=null;if(K.type==="FeatureCollection"){const B=new Set;for(const Z of K.features){const Y=Jt(Z,R);if(Y==null||B.has(Y))return!1;B.add(Y)}return!0}return!1}function kr(K,R){const B=new Map;if(K!=null)if(K.type==="Feature")B.set(Jt(K,R),K);else for(const Z of K.features)B.set(Jt(Z,R),Z);return B}rt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},rt.prototype.splitTile=function(K,R,B,Z,Y,$,me){for(var ae=[K,R,B,Z],ne=this.options,ce=ne.debug;ae.length;){Z=ae.pop(),B=ae.pop(),R=ae.pop(),K=ae.pop();var Le=1<<R,Fe=oi(R,B,Z),Re=this.tiles[Fe];if(!Re&&(ce>1&&console.time("creation"),Re=this.tiles[Fe]=mn(K,R,B,Z,ne),this.tileCoords.push({z:R,x:B,y:Z}),ce)){ce>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",R,B,Z,Re.numFeatures,Re.numPoints,Re.numSimplified),console.timeEnd("creation"));var Et="z"+R;this.stats[Et]=(this.stats[Et]||0)+1,this.total++}if(Re.source=K,Y){if(R===ne.maxZoom||R===Y)continue;var Yt=1<<Y-R;if(B!==Math.floor($/Yt)||Z!==Math.floor(me/Yt))continue}else if(R===ne.indexMaxZoom||Re.numPoints<=ne.indexMaxPoints)continue;if(Re.source=null,K.length!==0){ce>1&&console.time("clipping");var bt,Dt,ti,Ai,ai,Ii,wi=.5*ne.buffer/ne.extent,nr=.5-wi,ji=.5+wi,Cn=1+wi;bt=Dt=ti=Ai=null,ai=zi(K,Le,B-wi,B+ji,0,Re.minX,Re.maxX,ne),Ii=zi(K,Le,B+nr,B+Cn,0,Re.minX,Re.maxX,ne),K=null,ai&&(bt=zi(ai,Le,Z-wi,Z+ji,1,Re.minY,Re.maxY,ne),Dt=zi(ai,Le,Z+nr,Z+Cn,1,Re.minY,Re.maxY,ne),ai=null),Ii&&(ti=zi(Ii,Le,Z-wi,Z+ji,1,Re.minY,Re.maxY,ne),Ai=zi(Ii,Le,Z+nr,Z+Cn,1,Re.minY,Re.maxY,ne),Ii=null),ce>1&&console.timeEnd("clipping"),ae.push(bt||[],R+1,2*B,2*Z),ae.push(Dt||[],R+1,2*B,2*Z+1),ae.push(ti||[],R+1,2*B+1,2*Z),ae.push(Ai||[],R+1,2*B+1,2*Z+1)}}},rt.prototype.getTile=function(K,R,B){var Z=this.options,Y=Z.extent,$=Z.debug;if(K<0||K>24)return null;var me=1<<K,ae=oi(K,R=(R%me+me)%me,B);if(this.tiles[ae])return tt(this.tiles[ae],Y);$>1&&console.log("drilling down to z%d-%d-%d",K,R,B);for(var ne,ce=K,Le=R,Fe=B;!ne&&ce>0;)ce--,Le=Math.floor(Le/2),Fe=Math.floor(Fe/2),ne=this.tiles[oi(ce,Le,Fe)];return ne&&ne.source?($>1&&console.log("found parent tile z%d-%d-%d",ce,Le,Fe),$>1&&console.time("drilling down"),this.splitTile(ne.source,ce,Le,Fe,K,R,B),$>1&&console.timeEnd("drilling down"),this.tiles[ae]?tt(this.tiles[ae],Y):null):null};class Wt extends xe{constructor(R,B,Z,Y){super(R,B,Z),this._dataUpdateable=new Map,this.loadGeoJSON=($,me)=>{const{promoteId:ae}=$;if($.request)return s.f($.request,(ne,ce,Le,Fe)=>{this._dataUpdateable=ir(ce,ae)?kr(ce,ae):void 0,me(ne,ce,Le,Fe)});if(typeof $.data=="string")try{const ne=JSON.parse($.data);this._dataUpdateable=ir(ne,ae)?kr(ne,ae):void 0,me(null,ne)}catch{me(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`))}else $.dataDiff?this._dataUpdateable?(function(ne,ce,Le){var Fe,Re,Et,Yt;if(ce.removeAll&&ne.clear(),ce.remove)for(const bt of ce.remove)ne.delete(bt);if(ce.add)for(const bt of ce.add){const Dt=Jt(bt,Le);Dt!=null&&ne.set(Dt,bt)}if(ce.update)for(const bt of ce.update){let Dt=ne.get(bt.id);if(Dt==null)continue;const ti=!bt.removeAllProperties&&(((Fe=bt.removeProperties)===null||Fe===void 0?void 0:Fe.length)>0||((Re=bt.addOrUpdateProperties)===null||Re===void 0?void 0:Re.length)>0);if((bt.newGeometry||bt.removeAllProperties||ti)&&(Dt=Object.assign({},Dt),ne.set(bt.id,Dt),ti&&(Dt.properties=Object.assign({},Dt.properties))),bt.newGeometry&&(Dt.geometry=bt.newGeometry),bt.removeAllProperties)Dt.properties={};else if(((Et=bt.removeProperties)===null||Et===void 0?void 0:Et.length)>0)for(const Ai of bt.removeProperties)Object.prototype.hasOwnProperty.call(Dt.properties,Ai)&&delete Dt.properties[Ai];if(((Yt=bt.addOrUpdateProperties)===null||Yt===void 0?void 0:Yt.length)>0)for(const{key:Ai,value:ai}of bt.addOrUpdateProperties)Dt.properties[Ai]=ai}}(this._dataUpdateable,$.dataDiff,ae),me(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):me(new Error(`Cannot update existing geojson data in ${$.source}`)):me(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,Y&&(this.loadGeoJSON=Y)}loadGeoJSONTile(R,B){const Z=R.tileID.canonical;if(!this._geoJSONIndex)return B(null,null);const Y=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!Y)return B(null,null);const $=new class{constructor(ae){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.N,this.length=ae.length,this._features=ae}feature(ae){return new class{constructor(ne){this._feature=ne,this.extent=s.N,this.type=ne.type,this.properties=ne.tags,"id"in ne&&!isNaN(ne.id)&&(this.id=parseInt(ne.id,10))}loadGeometry(){if(this._feature.type===1){const ne=[];for(const ce of this._feature.geometry)ne.push([new s.P(ce[0],ce[1])]);return ne}{const ne=[];for(const ce of this._feature.geometry){const Le=[];for(const Fe of ce)Le.push(new s.P(Fe[0],Fe[1]));ne.push(Le)}return ne}}toGeoJSON(ne,ce,Le){return Pe.call(this,ne,ce,Le)}}(this._features[ae])}}(Y.features);let me=Ln($);me.byteOffset===0&&me.byteLength===me.buffer.byteLength||(me=new Uint8Array(me)),B(null,{vectorTile:$,rawData:me.buffer})}loadData(R,B){var Z;(Z=this._pendingRequest)===null||Z===void 0||Z.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const Y=!!(R&&R.request&&R.request.collectResourceTiming)&&new s.bu(R.request);this._pendingCallback=B,this._pendingRequest=this.loadGeoJSON(R,($,me)=>{if(delete this._pendingCallback,delete this._pendingRequest,$||!me)return B($);if(typeof me!="object")return B(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));{Te(me,!0);try{if(R.filter){const ne=s.bC(R.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ne.result==="error")throw new Error(ne.value.map(Le=>`${Le.key}: ${Le.message}`).join(", "));me={type:"FeatureCollection",features:me.features.filter(Le=>ne.value.evaluate({zoom:0},Le))}}this._geoJSONIndex=R.cluster?new qe(function({superclusterOptions:ne,clusterProperties:ce}){if(!ce||!ne)return ne;const Le={},Fe={},Re={accumulated:null,zoom:0},Et={properties:null},Yt=Object.keys(ce);for(const bt of Yt){const[Dt,ti]=ce[bt],Ai=s.bC(ti),ai=s.bC(typeof Dt=="string"?[Dt,["accumulated"],["get",bt]]:Dt);Le[bt]=Ai.value,Fe[bt]=ai.value}return ne.map=bt=>{Et.properties=bt;const Dt={};for(const ti of Yt)Dt[ti]=Le[ti].evaluate(Re,Et);return Dt},ne.reduce=(bt,Dt)=>{Et.properties=Dt;for(const ti of Yt)Re.accumulated=bt[ti],bt[ti]=Fe[ti].evaluate(Re,Et)},ne}(R)).load(me.features):function(ne,ce){return new rt(ne,ce)}(me,R.geojsonVtOptions)}catch(ne){return B(ne)}this.loaded={};const ae={};if(Y){const ne=Y.finish();ne&&(ae.resourceTiming={},ae.resourceTiming[R.source]=JSON.parse(JSON.stringify(ne)))}B(null,ae)}})}reloadTile(R,B){const Z=this.loaded;return Z&&Z[R.uid]?super.reloadTile(R,B):this.loadTile(R,B)}removeSource(R,B){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),B()}getClusterExpansionZoom(R,B){try{B(null,this._geoJSONIndex.getClusterExpansionZoom(R.clusterId))}catch(Z){B(Z)}}getClusterChildren(R,B){try{B(null,this._geoJSONIndex.getChildren(R.clusterId))}catch(Z){B(Z)}}getClusterLeaves(R,B){try{B(null,this._geoJSONIndex.getLeaves(R.clusterId,R.limit,R.offset))}catch(Z){B(Z)}}}class Vr{constructor(R){this.self=R,this.actor=new s.C(R,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:xe,geojson:Wt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(B,Z)=>{if(this.workerSourceTypes[B])throw new Error(`Worker source with name "${B}" already registered.`);this.workerSourceTypes[B]=Z},this.self.registerRTLTextPlugin=B=>{if(s.bD.isParsed())throw new Error("RTL text plugin already registered.");s.bD.applyArabicShaping=B.applyArabicShaping,s.bD.processBidirectionalText=B.processBidirectionalText,s.bD.processStyledBidirectionalText=B.processStyledBidirectionalText}}setReferrer(R,B){this.referrer=B}setImages(R,B,Z){this.availableImages[R]=B;for(const Y in this.workerSources[R]){const $=this.workerSources[R][Y];for(const me in $)$[me].availableImages=B}Z()}setLayers(R,B,Z){this.getLayerIndex(R).replace(B),Z()}updateLayers(R,B,Z){this.getLayerIndex(R).update(B.layers,B.removedIds),Z()}loadTile(R,B,Z){this.getWorkerSource(R,B.type,B.source).loadTile(B,Z)}loadDEMTile(R,B,Z){this.getDEMWorkerSource(R,B.source).loadTile(B,Z)}reloadTile(R,B,Z){this.getWorkerSource(R,B.type,B.source).reloadTile(B,Z)}abortTile(R,B,Z){this.getWorkerSource(R,B.type,B.source).abortTile(B,Z)}removeTile(R,B,Z){this.getWorkerSource(R,B.type,B.source).removeTile(B,Z)}removeDEMTile(R,B){this.getDEMWorkerSource(R,B.source).removeTile(B)}removeSource(R,B,Z){if(!this.workerSources[R]||!this.workerSources[R][B.type]||!this.workerSources[R][B.type][B.source])return;const Y=this.workerSources[R][B.type][B.source];delete this.workerSources[R][B.type][B.source],Y.removeSource!==void 0?Y.removeSource(B,Z):Z()}loadWorkerSource(R,B,Z){try{this.self.importScripts(B.url),Z()}catch(Y){Z(Y.toString())}}syncRTLPluginState(R,B,Z){try{s.bD.setState(B);const Y=s.bD.getPluginURL();if(s.bD.isLoaded()&&!s.bD.isParsed()&&Y!=null){this.self.importScripts(Y);const $=s.bD.isParsed();Z($?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Y}`),$)}}catch(Y){Z(Y.toString())}}getAvailableImages(R){let B=this.availableImages[R];return B||(B=[]),B}getLayerIndex(R){let B=this.layerIndexes[R];return B||(B=this.layerIndexes[R]=new F),B}getWorkerSource(R,B,Z){return this.workerSources[R]||(this.workerSources[R]={}),this.workerSources[R][B]||(this.workerSources[R][B]={}),this.workerSources[R][B][Z]||(this.workerSources[R][B][Z]=new this.workerSourceTypes[B]({send:(Y,$,me)=>{this.actor.send(Y,$,me,R)}},this.getLayerIndex(R),this.getAvailableImages(R))),this.workerSources[R][B][Z]}getDEMWorkerSource(R,B){return this.demWorkerSources[R]||(this.demWorkerSources[R]={}),this.demWorkerSources[R][B]||(this.demWorkerSources[R][B]=new ye),this.demWorkerSources[R][B]}}return s.i()&&(self.worker=new Vr(self)),Vr}),S(["./shared"],function(s){var F="3.6.2";class M{static testProp(t){if(!M.docStyle)return t[0];for(let r=0;r<t.length;r++)if(t[r]in M.docStyle)return t[r];return t[0]}static create(t,r,l){const u=window.document.createElement(t);return r!==void 0&&(u.className=r),l&&l.appendChild(u),u}static createNS(t,r){return window.document.createElementNS(t,r)}static disableDrag(){M.docStyle&&M.selectProp&&(M.userSelect=M.docStyle[M.selectProp],M.docStyle[M.selectProp]="none")}static enableDrag(){M.docStyle&&M.selectProp&&(M.docStyle[M.selectProp]=M.userSelect)}static setTransform(t,r){t.style[M.transformProp]=r}static addEventListener(t,r,l,u={}){t.addEventListener(r,l,"passive"in u?u:u.capture)}static removeEventListener(t,r,l,u={}){t.removeEventListener(r,l,"passive"in u?u:u.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",M.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",M.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",M.suppressClickInternal,!0)},0)}static mousePos(t,r){const l=t.getBoundingClientRect();return new s.P(r.clientX-l.left-t.clientLeft,r.clientY-l.top-t.clientTop)}static touchPos(t,r){const l=t.getBoundingClientRect(),u=[];for(let _=0;_<r.length;_++)u.push(new s.P(r[_].clientX-l.left-t.clientLeft,r[_].clientY-l.top-t.clientTop));return u}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}M.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,M.selectProp=M.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),M.transformProp=M.testProp(["transform","WebkitTransform"]);const q={supported:!1,testSupport:function(p){!xe&&he&&(ye?ge(p):ie=p)}};let ie,he,xe=!1,ye=!1;function ge(p){const t=p.createTexture();p.bindTexture(p.TEXTURE_2D,t);try{if(p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,he),p.isContextLost())return;q.supported=!0}catch{}p.deleteTexture(t),xe=!0}var fe,Te;typeof document<"u"&&(he=document.createElement("img"),he.onload=function(){ie&&ge(ie),ie=null,ye=!0},he.onerror=function(){xe=!0,ie=null},he.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(p){let t,r,l,u;p.resetRequestQueue=()=>{t=[],r=0,l=0,u={}},p.addThrottleControl=A=>{const L=l++;return u[L]=A,L},p.removeThrottleControl=A=>{delete u[A],w()},p.getImage=(A,L,z=!0)=>{q.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*");const N={requestParameters:A,supportImageRefresh:z,callback:L,cancelled:!1,completed:!1,cancel:()=>{N.completed||N.cancelled||(N.cancelled=!0,N.innerRequest&&(N.innerRequest.cancel(),r--),w())}};return t.push(N),w(),N};const _=A=>{const{requestParameters:L,supportImageRefresh:z,callback:N}=A;return s.e(L,{type:"image"}),(z!==!1||s.i()||s.g(L.url)||L.headers&&!Object.keys(L.headers).reduce((X,H)=>X&&H==="accept",!0)?s.m:I)(L,(X,H,J,G)=>{x(A,N,X,H,J,G)})},x=(A,L,z,N,X,H)=>{z?L(z):N instanceof HTMLImageElement||s.a(N)?L(null,N):N&&((J,G)=>{typeof createImageBitmap=="function"?s.b(J,G):s.d(J,G)})(N,(J,G)=>{J!=null?L(J):G!=null&&L(null,G,{cacheControl:X,expires:H})}),A.cancelled||(A.completed=!0,r--,w())},w=()=>{const A=(()=>{const L=Object.keys(u);let z=!1;if(L.length>0){for(const N of L)if(z=u[N](),z)break}return z})()?s.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let L=r;L<A&&t.length>0;L++){const z=t.shift();if(z.cancelled){L--;continue}const N=_(z);r++,z.innerRequest=N}},I=(A,L)=>{const z=new Image,N=A.url;let X=!1;const H=A.credentials;return H&&H==="include"?z.crossOrigin="use-credentials":(H&&H==="same-origin"||!s.s(N))&&(z.crossOrigin="anonymous"),z.fetchPriority="high",z.onload=()=>{L(null,z),z.onerror=z.onload=null},z.onerror=()=>{X||L(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),z.onerror=z.onload=null},z.src=N,{cancel:()=>{X=!0,z.src=""}}}}(fe||(fe={})),fe.resetRequestQueue(),function(p){p.Glyphs="Glyphs",p.Image="Image",p.Source="Source",p.SpriteImage="SpriteImage",p.SpriteJSON="SpriteJSON",p.Style="Style",p.Tile="Tile",p.Unknown="Unknown"}(Te||(Te={}));class Pe{constructor(t){this._transformRequestFn=t}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}normalizeSpriteURL(t,r,l){const u=function(_){const x=_.match(Ke);if(!x)throw new Error(`Unable to parse URL "${_}"`);return{protocol:x[1],authority:x[2],path:x[3]||"/",params:x[4]?x[4].split("&"):[]}}(t);return u.path+=`${r}${l}`,function(_){const x=_.params.length?`?${_.params.join("&")}`:"";return`${_.protocol}://${_.authority}${_.path}${x}`}(u)}setTransformRequest(t){this._transformRequestFn=t}}const Ke=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function je(p){var t=new s.A(3);return t[0]=p[0],t[1]=p[1],t[2]=p[2],t}var St,vt=function(p,t,r){return p[0]=t[0]-r[0],p[1]=t[1]-r[1],p[2]=t[2]-r[2],p};St=new s.A(3),s.A!=Float32Array&&(St[0]=0,St[1]=0,St[2]=0);var yt=function(p){var t=p[0],r=p[1];return t*t+r*r};function zt(p){const t=[];if(typeof p=="string")t.push({id:"default",url:p});else if(p&&p.length>0){const r=[];for(const{id:l,url:u}of p){const _=`${l}${u}`;r.indexOf(_)===-1&&(r.push(_),t.push({id:l,url:u}))}}return t}function wt(p,t,r,l,u){if(l)return void p(l);if(u!==Object.values(t).length||u!==Object.values(r).length)return;const _={};for(const x in t){_[x]={};const w=s.h.getImageCanvasContext(r[x]),I=t[x];for(const A in I){const{width:L,height:z,x:N,y:X,sdf:H,pixelRatio:J,stretchX:G,stretchY:ue,content:we}=I[A];_[x][A]={data:null,pixelRatio:J,sdf:H,stretchX:G,stretchY:ue,content:we,spriteData:{width:L,height:z,x:N,y:X,context:w}}}}p(null,_)}(function(){var p=new s.A(2);s.A!=Float32Array&&(p[0]=0,p[1]=0)})();class Nt{constructor(t,r,l,u){this.context=t,this.format=l,this.texture=t.gl.createTexture(),this.update(r,u)}update(t,r,l){const{width:u,height:_}=t,x=!(this.size&&this.size[0]===u&&this.size[1]===_||l),{context:w}=this,{gl:I}=w;if(this.useMipmap=!!(r&&r.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!r||r.premultiply!==!1)),x)this.size=[u,_],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||s.a(t)?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,t):I.texImage2D(I.TEXTURE_2D,0,this.format,u,_,0,this.format,I.UNSIGNED_BYTE,t.data);else{const{x:A,y:L}=l||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||s.a(t)?I.texSubImage2D(I.TEXTURE_2D,0,A,L,I.RGBA,I.UNSIGNED_BYTE,t):I.texSubImage2D(I.TEXTURE_2D,0,A,L,u,_,I.RGBA,I.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)}bind(t,r,l){const{context:u}=this,{gl:_}=u;_.bindTexture(_.TEXTURE_2D,this.texture),l!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=_.LINEAR),t!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,t),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,l||t),this.filter=t),r!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,r),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function De(p){const{userImage:t}=p;return!!(t&&t.render&&t.render())&&(p.data.replace(new Uint8Array(t.data.buffer)),!0)}class Je extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:r,callback:l}of this.requestors)this._notify(r,l);this.requestors=[]}}getImage(t){const r=this.images[t];if(r&&!r.data&&r.spriteData){const l=r.spriteData;r.data=new s.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),r.spriteData=null}return r}addImage(t,r){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,r)&&(this.images[t]=r)}_validate(t,r){let l=!0;const u=r.data||r.spriteData;return this._validateStretch(r.stretchX,u&&u.width)||(this.fire(new s.j(new Error(`Image "${t}" has invalid "stretchX" value`))),l=!1),this._validateStretch(r.stretchY,u&&u.height)||(this.fire(new s.j(new Error(`Image "${t}" has invalid "stretchY" value`))),l=!1),this._validateContent(r.content,r)||(this.fire(new s.j(new Error(`Image "${t}" has invalid "content" value`))),l=!1),l}_validateStretch(t,r){if(!t)return!0;let l=0;for(const u of t){if(u[0]<l||u[1]<u[0]||r<u[1])return!1;l=u[1]}return!0}_validateContent(t,r){if(!t)return!0;if(t.length!==4)return!1;const l=r.spriteData,u=l&&l.width||r.data.width,_=l&&l.height||r.data.height;return!(t[0]<0||u<t[0]||t[1]<0||_<t[1]||t[2]<0||u<t[2]||t[3]<0||_<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,r,l=!0){const u=this.getImage(t);if(l&&(u.data.width!==r.data.width||u.data.height!==r.data.height))throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=u.version+1,this.images[t]=r,this.updatedImages[t]=!0}removeImage(t){const r=this.images[t];delete this.images[t],delete this.patterns[t],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,r){let l=!0;if(!this.isLoaded())for(const u of t)this.images[u]||(l=!1);this.isLoaded()||l?this._notify(t,r):this.requestors.push({ids:t,callback:r})}_notify(t,r){const l={};for(const u of t){let _=this.getImage(u);_||(this.fire(new s.k("styleimagemissing",{id:u})),_=this.getImage(u)),_?l[u]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,hasRenderCallback:!!(_.userImage&&_.userImage.render)}:s.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}r(null,l)}getPixelSize(){const{width:t,height:r}=this.atlasImage;return{width:t,height:r}}getPattern(t){const r=this.patterns[t],l=this.getImage(t);if(!l)return null;if(r&&r.position.version===l.version)return r.position;if(r)r.position.version=l.version;else{const u={w:l.data.width+2,h:l.data.height+2,x:0,y:0},_=new s.I(u,l);this.patterns[t]={bin:u,position:_}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const r=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Nt(t,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const _ in this.patterns)t.push(this.patterns[_].bin);const{w:r,h:l}=s.p(t),u=this.atlasImage;u.resize({width:r||1,height:l||1});for(const _ in this.patterns){const{bin:x}=this.patterns[_],w=x.x+1,I=x.y+1,A=this.getImage(_).data,L=A.width,z=A.height;s.R.copy(A,u,{x:0,y:0},{x:w,y:I},{width:L,height:z}),s.R.copy(A,u,{x:0,y:z-1},{x:w,y:I-1},{width:L,height:1}),s.R.copy(A,u,{x:0,y:0},{x:w,y:I+z},{width:L,height:1}),s.R.copy(A,u,{x:L-1,y:0},{x:w-1,y:I},{width:1,height:z}),s.R.copy(A,u,{x:0,y:0},{x:w+L,y:I},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const r of t){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const l=this.getImage(r);l||s.w(`Image with ID: "${r}" was not found`),De(l)&&this.updateImage(r,l)}}}const $t=1e20;function $e(p,t,r,l,u,_,x,w,I){for(let A=t;A<t+l;A++)Kt(p,r*_+A,_,u,x,w,I);for(let A=r;A<r+u;A++)Kt(p,A*_+t,1,l,x,w,I)}function Kt(p,t,r,l,u,_,x){_[0]=0,x[0]=-$t,x[1]=$t,u[0]=p[t];for(let w=1,I=0,A=0;w<l;w++){u[w]=p[t+w*r];const L=w*w;do{const z=_[I];A=(u[w]-u[z]+L-z*z)/(w-z)/2}while(A<=x[I]&&--I>-1);I++,_[I]=w,x[I]=A,x[I+1]=$t}for(let w=0,I=0;w<l;w++){for(;x[I+1]<w;)I++;const A=_[I],L=w-A;p[t+w*r]=u[A]+L*L}}class Pt{constructor(t,r){this.requestManager=t,this.localIdeographFontFamily=r,this.entries={}}setURL(t){this.url=t}getGlyphs(t,r){const l=[];for(const u in t)for(const _ of t[u])l.push({stack:u,id:_});s.o(l,({stack:u,id:_},x)=>{let w=this.entries[u];w||(w=this.entries[u]={glyphs:{},requests:{},ranges:{}});let I=w.glyphs[_];if(I!==void 0)return void x(null,{stack:u,id:_,glyph:I});if(I=this._tinySDF(w,u,_),I)return w.glyphs[_]=I,void x(null,{stack:u,id:_,glyph:I});const A=Math.floor(_/256);if(256*A>65535)return void x(new Error("glyphs > 65535 not supported"));if(w.ranges[A])return void x(null,{stack:u,id:_,glyph:I});if(!this.url)return void x(new Error("glyphsUrl is not set"));let L=w.requests[A];L||(L=w.requests[A]=[],Pt.loadGlyphRange(u,A,this.url,this.requestManager,(z,N)=>{if(N){for(const X in N)this._doesCharSupportLocalGlyph(+X)||(w.glyphs[+X]=N[+X]);w.ranges[A]=!0}for(const X of L)X(z,N);delete w.requests[A]})),L.push((z,N)=>{z?x(z):N&&x(null,{stack:u,id:_,glyph:N[_]||null})})},(u,_)=>{if(u)r(u);else if(_){const x={};for(const{stack:w,id:I,glyph:A}of _)(x[w]||(x[w]={}))[I]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics};r(null,x)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(s.u["CJK Unified Ideographs"](t)||s.u["Hangul Syllables"](t)||s.u.Hiragana(t)||s.u.Katakana(t))}_tinySDF(t,r,l){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let _=t.tinySDF;if(!_){let w="400";/bold/i.test(r)?w="900":/medium/i.test(r)?w="500":/light/i.test(r)&&(w="200"),_=t.tinySDF=new Pt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:w})}const x=_.draw(String.fromCharCode(l));return{id:l,bitmap:new s.q({width:x.width||60,height:x.height||60},x.data),metrics:{width:x.glyphWidth/2||24,height:x.glyphHeight/2||24,left:x.glyphLeft/2+.5||0,top:x.glyphTop/2-27.5||-8,advance:x.glyphAdvance/2||24,isDoubleResolution:!0}}}}Pt.loadGlyphRange=function(p,t,r,l,u){const _=256*t,x=_+255,w=l.transformRequest(r.replace("{fontstack}",p).replace("{range}",`${_}-${x}`),Te.Glyphs);s.l(w,(I,A)=>{if(I)u(I);else if(A){const L={};for(const z of s.n(A))L[z.id]=z;u(null,L)}})},Pt.TinySDF=class{constructor({fontSize:p=24,buffer:t=3,radius:r=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:_="normal",fontStyle:x="normal"}={}){this.buffer=t,this.cutoff=l,this.radius=r;const w=this.size=p+4*t,I=this._createCanvas(w),A=this.ctx=I.getContext("2d",{willReadFrequently:!0});A.font=`${x} ${_} ${p}px ${u}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(p){const t=document.createElement("canvas");return t.width=t.height=p,t}draw(p){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:_}=this.ctx.measureText(p),x=Math.ceil(r),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-u))),I=Math.min(this.size-this.buffer,x+Math.ceil(l)),A=w+2*this.buffer,L=I+2*this.buffer,z=Math.max(A*L,0),N=new Uint8ClampedArray(z),X={data:N,width:A,height:L,glyphWidth:w,glyphHeight:I,glyphTop:x,glyphLeft:0,glyphAdvance:t};if(w===0||I===0)return X;const{ctx:H,buffer:J,gridInner:G,gridOuter:ue}=this;H.clearRect(J,J,w,I),H.fillText(p,J,J+x);const we=H.getImageData(J,J,w,I);ue.fill($t,0,z),G.fill(0,0,z);for(let te=0;te<I;te++)for(let de=0;de<w;de++){const Ie=we.data[4*(te*w+de)+3]/255;if(Ie===0)continue;const Ce=(te+J)*A+de+J;if(Ie===1)ue[Ce]=0,G[Ce]=$t;else{const Oe=.5-Ie;ue[Ce]=Oe>0?Oe*Oe:0,G[Ce]=Oe<0?Oe*Oe:0}}$e(ue,0,0,A,L,A,this.f,this.v,this.z),$e(G,J,J,w,I,A,this.f,this.v,this.z);for(let te=0;te<z;te++){const de=Math.sqrt(ue[te])-Math.sqrt(G[te]);N[te]=Math.round(255-255*(de/this.radius+this.cutoff))}return X}};class Lt{constructor(){this.specification=s.v.light.position}possiblyEvaluate(t,r){return s.z(t.expression.evaluate(r))}interpolate(t,r,l){return{x:s.B.number(t.x,r.x,l),y:s.B.number(t.y,r.y,l),z:s.B.number(t.z,r.z,l)}}}let ui;class Ln extends s.E{constructor(t){super(),ui=ui||new s.r({anchor:new s.D(s.v.light.anchor),position:new Lt,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(ui),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r={}){if(!this._validate(s.t,t,r))for(const l in t){const u=t[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,l){return(!l||l.validate!==!1)&&s.x(this,t.call(s.y,s.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:s.v})))}}class zn{constructor(t,r){this.width=t,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,r){const l=t.join(",")+String(r);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(t,r)),this.dashEntry[l]}getDashRanges(t,r,l){const u=[];let _=t.length%2==1?-t[t.length-1]*l:0,x=t[0]*l,w=!0;u.push({left:_,right:x,isDash:w,zeroLength:t[0]===0});let I=t[0];for(let A=1;A<t.length;A++){w=!w;const L=t[A];_=I*l,I+=L,x=I*l,u.push({left:_,right:x,isDash:w,zeroLength:L===0})}return u}addRoundDash(t,r,l){const u=r/2;for(let _=-l;_<=l;_++){const x=this.width*(this.nextRow+l+_);let w=0,I=t[w];for(let A=0;A<this.width;A++){A/I.right>1&&(I=t[++w]);const L=Math.abs(A-I.left),z=Math.abs(A-I.right),N=Math.min(L,z);let X;const H=_/l*(u+1);if(I.isDash){const J=u-Math.abs(H);X=Math.sqrt(N*N+J*J)}else X=u-Math.sqrt(N*N+H*H);this.data[x+A]=Math.max(0,Math.min(255,X+128))}}}addRegularDash(t){for(let w=t.length-1;w>=0;--w){const I=t[w],A=t[w+1];I.zeroLength?t.splice(w,1):A&&A.isDash===I.isDash&&(A.left=I.left,t.splice(w,1))}const r=t[0],l=t[t.length-1];r.isDash===l.isDash&&(r.left=l.left-this.width,l.right=r.right+this.width);const u=this.width*this.nextRow;let _=0,x=t[_];for(let w=0;w<this.width;w++){w/x.right>1&&(x=t[++_]);const I=Math.abs(w-x.left),A=Math.abs(w-x.right),L=Math.min(I,A);this.data[u+w]=Math.max(0,Math.min(255,(x.isDash?L:-L)+128))}}addDash(t,r){const l=r?7:0,u=2*l+1;if(this.nextRow+u>this.height)return s.w("LineAtlas out of space"),null;let _=0;for(let w=0;w<t.length;w++)_+=t[w];if(_!==0){const w=this.width/_,I=this.getDashRanges(t,this.width,w);r?this.addRoundDash(I,w,l):this.addRegularDash(I)}const x={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:_};return this.nextRow+=u,this.dirty=!0,x}bind(t){const r=t.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}class Pi{constructor(t,r,l){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=l;const u=this.workerPool.acquire(l);for(let _=0;_<u.length;_++){const x=new s.C(u[_],r,l);x.name=`Worker ${_}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,r,l){s.o(this.actors,(u,_)=>{u.send(t,r,_)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(r=>{r.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}}function Mi(p,t,r){const l=function(u,_){if(u)return r(u);if(_){const x=s.F(s.e(_,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);_.vector_layers&&(x.vectorLayers=_.vector_layers,x.vectorLayerIds=x.vectorLayers.map(w=>w.id)),r(null,x)}};return p.url?s.f(t.transformRequest(p.url,Te.Source),l):s.h.frame(()=>l(null,p))}class Ut{constructor(t,r){t&&(r?this.setSouthWest(t).setNorthEast(r):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof s.L?new s.L(t.lng,t.lat):s.L.convert(t),this}setSouthWest(t){return this._sw=t instanceof s.L?new s.L(t.lng,t.lat):s.L.convert(t),this}extend(t){const r=this._sw,l=this._ne;let u,_;if(t instanceof s.L)u=t,_=t;else{if(!(t instanceof Ut))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Ut.convert(t)):this.extend(s.L.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(s.L.convert(t)):this;if(u=t._sw,_=t._ne,!u||!_)return this}return r||l?(r.lng=Math.min(u.lng,r.lng),r.lat=Math.min(u.lat,r.lat),l.lng=Math.max(_.lng,l.lng),l.lat=Math.max(_.lat,l.lat)):(this._sw=new s.L(u.lng,u.lat),this._ne=new s.L(_.lng,_.lat)),this}getCenter(){return new s.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.L(this.getWest(),this.getNorth())}getSouthEast(){return new s.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:r,lat:l}=s.L.convert(t);let u=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(t){return t instanceof Ut?t:t&&new Ut(t)}static fromLngLat(t,r=0){const l=360*r/40075017,u=l/Math.cos(Math.PI/180*t.lat);return new Ut(new s.L(t.lng-u,t.lat-l),new s.L(t.lng+u,t.lat+l))}}class bi{constructor(t,r,l){this.bounds=Ut.convert(this.validateBounds(t)),this.minzoom=r||0,this.maxzoom=l||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const r=Math.pow(2,t.z),l=Math.floor(s.G(this.bounds.getWest())*r),u=Math.floor(s.H(this.bounds.getNorth())*r),_=Math.ceil(s.G(this.bounds.getEast())*r),x=Math.ceil(s.H(this.bounds.getSouth())*r);return t.x>=l&&t.x<_&&t.y>=u&&t.y<x}}class Li extends s.E{constructor(t,r,l,u){if(super(),this.load=()=>{this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Mi(this._options,this.map._requestManager,(_,x)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),_?this.fire(new s.j(_)):x&&(s.e(this,x),x.bounds&&(this.tileBounds=new bi(x.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>s.e({},this._options),this.id=t,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.F(r,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(t,r){const l=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(l,Te.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function _(x,w){return delete t.request,t.aborted?r(null):x&&x.status!==404?r(x):(w&&w.resourceTiming&&(t.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&w&&t.setExpiryData(w),t.loadVectorData(w,this.map.painter),r(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}u.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=r:t.request=t.actor.send("reloadTile",u,_.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",u,_.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class qe extends s.E{constructor(t,r,l,u){super(),this.id=t,this.dispatcher=l,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},r),s.e(this,s.F(r,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Mi(this._options,this.map._requestManager,(t,r)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new s.j(t)):r&&(s.e(this,r),r.bounds&&(this.tileBounds=new bi(r.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}serialize(){return s.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,r){const l=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=fe.getImage(this.map._requestManager.transformRequest(l,Te.Tile),(u,_,x)=>{if(delete t.request,t.aborted)t.state="unloaded",r(null);else if(u)t.state="errored",r(u);else if(_){this.map._refreshExpiredTiles&&x&&t.setExpiryData(x);const w=this.map.painter.context,I=w.gl;t.texture=this.map.painter.getTileTexture(_.width),t.texture?t.texture.update(_,{useMipmap:!0}):(t.texture=new Nt(w,_,I.RGBA,{useMipmap:!0}),t.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),w.extTextureFilterAnisotropic&&I.texParameterf(I.TEXTURE_2D,w.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,w.extTextureFilterAnisotropicMax)),t.state="loaded",r(null)}},this.map._refreshExpiredTiles)}abortTile(t,r){t.request&&(t.request.cancel(),delete t.request),r()}unloadTile(t,r){t.texture&&this.map.painter.saveTileTexture(t.texture),r()}hasTransition(){return!1}}class Gt extends qe{constructor(t,r,l,u){super(t,r,l,u),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(t,r){const l=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(l,Te.Tile);function _(x,w){x&&(t.state="errored",r(x)),w&&(t.dem=w,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",r(null))}t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.request=fe.getImage(u,(x,w,I)=>s._(this,void 0,void 0,function*(){if(delete t.request,t.aborted)t.state="unloaded",r(null);else if(x)t.state="errored",r(x);else if(w){this.map._refreshExpiredTiles&&t.setExpiryData(I);const A=s.a(w)&&s.J()?w:yield function(z){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.K()){const N=z.width+2,X=z.height+2;try{return new s.R({width:N,height:X},yield s.M(z,-1,-1,N,X))}catch{}}return s.h.getImageData(z,1)})}(w),L={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:A,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",L,_))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(t){const r=t.canonical,l=Math.pow(2,r.z),u=(r.x-1+l)%l,_=r.x===0?t.wrap-1:t.wrap,x=(r.x+1+l)%l,w=r.x+1===l?t.wrap+1:t.wrap,I={};return I[new s.O(t.overscaledZ,_,r.z,u,r.y).key]={backfilled:!1},I[new s.O(t.overscaledZ,w,r.z,x,r.y).key]={backfilled:!1},r.y>0&&(I[new s.O(t.overscaledZ,_,r.z,u,r.y-1).key]={backfilled:!1},I[new s.O(t.overscaledZ,t.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},I[new s.O(t.overscaledZ,w,r.z,x,r.y-1).key]={backfilled:!1}),r.y+1<l&&(I[new s.O(t.overscaledZ,_,r.z,u,r.y+1).key]={backfilled:!1},I[new s.O(t.overscaledZ,t.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},I[new s.O(t.overscaledZ,w,r.z,x,r.y+1).key]={backfilled:!1}),I}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class it extends s.E{constructor(t,r,l,u){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>s.e({},this._options,{type:this.type,data:this._data}),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(u),this._data=r.data,this._options=s.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const _=s.N/this.tileSize;this.workerOptions=s.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*_,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*_,extent:s.N,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:s.N,radius:(r.clusterRadius||50)*_,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},r),this}getClusterChildren(t,r){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},r),this}getClusterLeaves(t,r,l,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:r,offset:l},u),this}_updateWorkerData(t){const r=s.e({},this.workerOptions);t?r.dataDiff=t:typeof this._data=="string"?(r.request=this.map._requestManager.transformRequest(s.h.resolveURL(this._data),Te.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,r,(l,u)=>{if(this._pendingLoads--,this._removed||u&&u.abandoned)return void this.fire(new s.k("dataabort",{dataType:"source"}));let _=null;if(u&&u.resourceTiming&&u.resourceTiming[this.id]&&(_=u.resourceTiming[this.id].slice(0)),l)return void this.fire(new s.j(l));const x={dataType:"source"};this._collectResourceTiming&&_&&_.length>0&&s.e(x,{resourceTiming:_}),this.fire(new s.k("data",Object.assign(Object.assign({},x),{sourceDataType:"metadata"}))),this.fire(new s.k("data",Object.assign(Object.assign({},x),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(t,r){const l=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const u={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(l,u,(_,x)=>(delete t.request,t.unloadVectorData(),t.aborted?r(null):_?r(_):(t.loadVectorData(x,this.map.painter,l==="reloadTile"),r(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var si=s.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class gt extends s.E{constructor(t,r,l,u){super(),this.load=(_,x)=>{this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=fe.getImage(this.map._requestManager.transformRequest(this.url,Te.Image),(w,I)=>{this._request=null,this._loaded=!0,w?this.fire(new s.j(w)):I&&(this.image=I,_&&(this.coordinates=_),x&&x(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const _=this.map.painter.context,x=_.gl;this.boundsBuffer||(this.boundsBuffer=_.createVertexBuffer(this._boundsArray,si.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Nt(_,this.image,x.RGBA),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE));let w=!1;for(const I in this.tiles){const A=this.tiles[I];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,w=!0)}w&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=t,this.dispatcher=l,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=r}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(t){this.coordinates=t;const r=t.map(s.U.fromLngLat);this.tileID=function(u){let _=1/0,x=1/0,w=-1/0,I=-1/0;for(const N of u)_=Math.min(_,N.x),x=Math.min(x,N.y),w=Math.max(w,N.x),I=Math.max(I,N.y);const A=Math.max(w-_,I-x),L=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),z=Math.pow(2,L);return new s.W(L,Math.floor((_+w)/2*z),Math.floor((x+I)/2*z))}(r),this.minzoom=this.maxzoom=this.tileID.z;const l=r.map(u=>this.tileID.getTilePoint(u)._round());return this._boundsArray=new s.V,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,s.N,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,s.N),this._boundsArray.emplaceBack(l[2].x,l[2].y,s.N,s.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(t,r){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},r(null)):(t.state="errored",r(null))}hasTransition(){return!1}}class Xi extends gt{constructor(t,r,l,u){super(t,r,l,u),this.load=()=>{this._loaded=!1;const _=this.options;this.urls=[];for(const x of _.urls)this.urls.push(this.map._requestManager.transformRequest(x,Te.Source).url);s.X(this.urls,(x,w)=>{this._loaded=!0,x?this.fire(new s.j(x)):w&&(this.video=w,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const _=this.map.painter.context,x=_.gl;this.boundsBuffer||(this.boundsBuffer=_.createVertexBuffer(this._boundsArray,si.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.texSubImage2D(x.TEXTURE_2D,0,0,0,x.RGBA,x.UNSIGNED_BYTE,this.video)):(this.texture=new Nt(_,this.video,x.RGBA),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE));let w=!1;for(const I in this.tiles){const A=this.tiles[I];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,w=!0)}w&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=r}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const r=this.video.seekable;t<r.start(0)||t>r.end(0)?this.fire(new s.j(new s.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class Qi extends gt{constructor(t,r,l,u){super(t,r,l,u),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let _=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,_=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,_=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const x=this.map.painter.context,w=x.gl;this.boundsBuffer||(this.boundsBuffer=x.createVertexBuffer(this._boundsArray,si.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture?(_||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Nt(x,this.canvas,w.RGBA,{premultiply:!0});let I=!1;for(const A in this.tiles){const L=this.tiles[A];L.state!=="loaded"&&(L.state="loaded",L.texture=this.texture,I=!0)}I&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(x=>typeof x!="number"))||this.fire(new s.j(new s.Y(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.j(new s.Y(`sources.${t}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new s.j(new s.Y(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new s.j(new s.Y(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.j(new s.Y(`sources.${t}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Ze={},Ui=p=>{switch(p){case"geojson":return it;case"image":return gt;case"raster":return qe;case"raster-dem":return Gt;case"vector":return Li;case"video":return Xi;case"canvas":return Qi}return Ze[p]};function bn(p,t){const r=s.Z();return s.$(r,r,[1,1,0]),s.a0(r,r,[.5*p.width,.5*p.height,1]),s.a1(r,r,p.calculatePosMatrix(t.toUnwrapped()))}function xi(p,t,r,l,u,_){const x=function(z,N,X){if(z)for(const H of z){const J=N[H];if(J&&J.source===X&&J.type==="fill-extrusion")return!0}else for(const H in N){const J=N[H];if(J.source===X&&J.type==="fill-extrusion")return!0}return!1}(u&&u.layers,t,p.id),w=_.maxPitchScaleFactor(),I=p.tilesIn(l,w,x);I.sort(_r);const A=[];for(const z of I)A.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(t,r,p._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,u,_,w,bn(p.transform,z.tileID))});const L=function(z){const N={},X={};for(const H of z){const J=H.queryResults,G=H.wrappedTileID,ue=X[G]=X[G]||{};for(const we in J){const te=J[we],de=ue[we]=ue[we]||{},Ie=N[we]=N[we]||[];for(const Ce of te)de[Ce.featureIndex]||(de[Ce.featureIndex]=!0,Ie.push(Ce))}}return N}(A);for(const z in L)L[z].forEach(N=>{const X=N.feature,H=p.getFeatureState(X.layer["source-layer"],X.id);X.source=X.layer.source,X.layer["source-layer"]&&(X.sourceLayer=X.layer["source-layer"]),X.state=H});return L}function _r(p,t){const r=p.tileID,l=t.tileID;return r.overscaledZ-l.overscaledZ||r.canonical.y-l.canonical.y||r.wrap-l.wrap||r.canonical.x-l.canonical.x}class Dn{constructor(t,r){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=s.a2(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const r=t+this.timeAdded;r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,r,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(u,_){const x={};if(!_)return x;for(const w of u){const I=w.layerIds.map(A=>_.getLayer(A)).filter(Boolean);if(I.length!==0){w.layers=I,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(A=>I.filter(L=>L.id===A)[0]));for(const A of I)x[A.id]=w}}return x}(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const _=this.buckets[u];if(_ instanceof s.a4){if(this.hasSymbolBuckets=!0,!l)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const _=this.buckets[u];if(_ instanceof s.a4&&_.hasRTLText){this.hasRTLText=!0,s.a5();break}}this.queryPadding=0;for(const u in this.buckets){const _=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(u).queryRadius(_))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new s.a3}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const u=this.buckets[l];u.uploadPending()&&u.upload(t)}const r=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Nt(t,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Nt(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,r,l,u,_,x,w,I,A,L){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:_,scale:x,tileSize:this.tileSize,pixelPosMatrix:L,transform:I,params:w,queryPadding:this.queryPadding*A},t,r,l):{}}querySourceFeatures(t,r){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const u=l.loadVTLayers(),_=r&&r.sourceLayer?r.sourceLayer:"",x=u._geojsonTileLayer||u[_];if(!x)return;const w=s.a6(r&&r.filter),{z:I,x:A,y:L}=this.tileID.canonical,z={z:I,x:A,y:L};for(let N=0;N<x.length;N++){const X=x.feature(N);if(w.needGeometry){const G=s.a7(X,!0);if(!w.filter(new s.a8(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!w.filter(new s.a8(this.tileID.overscaledZ),X))continue;const H=l.getId(X,_),J=new s.a9(X,I,A,L,H);J.tile=z,t.push(J)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const l=s.aa(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let u=!1;if(this.expirationTime>l)u=!1;else if(r)if(this.expirationTime<r)u=!0;else{const _=this.expirationTime-r;_?this.expirationTime=l+Math.max(_,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!r.style.hasLayer(u))continue;const _=this.buckets[u],x=_.layers[0].sourceLayer||"_geojsonTileLayer",w=l[x],I=t[x];if(!w||!I||Object.keys(I).length===0)continue;_.update(I,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const A=r&&r.style&&r.style.getLayer(u);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=s.h.now()+t}setDependencies(t,r){const l={};for(const u of r)l[u]=!0;this.dependencies[t]=l}hasDependency(t,r){for(const l of t){const u=this.dependencies[l];if(u){for(const _ of r)if(u[_])return!0}}return!1}}class yo{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(const t in this.data)for(const r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,l){const u=t.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const _={value:r,timeout:void 0};if(l!==void 0&&(_.timeout=setTimeout(()=>{this.remove(t,_)},l)),this.data[u].push(_),this.order.push(u),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){const r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;const l=t.wrapped().key,u=r===void 0?0:this.data[l].indexOf(r),_=this.data[l][u];return this.data[l].splice(u,1),_.timeout&&clearTimeout(_.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(_.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){const r=[];for(const l in this.data)for(const u of this.data[l])t(u.value)||r.push(u);for(const l of r)this.remove(l.value.tileID,l)}}class ke{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,l){const u=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][u]=this.stateChanges[t][u]||{},s.e(this.stateChanges[t][u],l),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==u&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][u]===null){this.deletedStates[t][u]={};for(const _ in this.state[t][u])l[_]||(this.deletedStates[t][u][_]=null)}else for(const _ in l)this.deletedStates[t]&&this.deletedStates[t][u]&&this.deletedStates[t][u][_]===null&&delete this.deletedStates[t][u][_]}removeFeatureState(t,r,l){if(this.deletedStates[t]===null)return;const u=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&r!==void 0)this.deletedStates[t][u]!==null&&(this.deletedStates[t][u]=this.deletedStates[t][u]||{},this.deletedStates[t][u][l]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][u])for(l in this.deletedStates[t][u]={},this.stateChanges[t][u])this.deletedStates[t][u][l]=null;else this.deletedStates[t][u]=null;else this.deletedStates[t]=null}getState(t,r){const l=String(r),u=s.e({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const _=this.deletedStates[t][r];if(_===null)return{};for(const x in _)delete u[x]}return u}initializeTileState(t,r){t.setFeatureState(this.state,r)}coalesceChanges(t,r){const l={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const _={};for(const x in this.stateChanges[u])this.state[u][x]||(this.state[u][x]={}),s.e(this.state[u][x],this.stateChanges[u][x]),_[x]=this.state[u][x];l[u]=_}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const _={};if(this.deletedStates[u]===null)for(const x in this.state[u])_[x]={},this.state[u][x]={};else for(const x in this.deletedStates[u]){if(this.deletedStates[u][x]===null)this.state[u][x]={};else for(const w of Object.keys(this.deletedStates[u][x]))delete this.state[u][x][w];_[x]=this.state[u][x]}l[u]=l[u]||{},s.e(l[u],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const u in t)t[u].setFeatureState(l,r)}}class tn extends s.E{constructor(t,r,l){super(),this.id=t,this.dispatcher=l,this.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((u,_,x,w)=>{const I=new(Ui(_.type))(u,_,x,w);if(I.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${I.id}`);return I})(t,r,l,this),this._tiles={},this._cache=new yo(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ke,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const r=this._tiles[t];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,r){return this._source.loadTile(t,r)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new s.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const l=this._tiles[r];l.upload(t),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(zi).map(t=>t.key)}getRenderableIds(t){const r=[];for(const l in this._tiles)this._isIdRenderable(l,t)&&r.push(this._tiles[l]);return t?r.sort((l,u)=>{const _=l.tileID,x=u.tileID,w=new s.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),I=new s.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-x.overscaledZ||I.y-w.y||I.x-w.x}).map(l=>l.tileID.key):r.map(l=>l.tileID).sort(zi).map(l=>l.key)}hasRenderableParent(t){const r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,r){const l=this._tiles[t];l&&(l.state!=="loading"&&(l.state=r),this._loadTile(l,this._tileLoaded.bind(this,l,t,r)))}_tileLoaded(t,r,l,u){if(u)return t.state="errored",void(u.status!==404?this._source.fire(new s.j(u,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=s.h.now(),l==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new s.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const r=this.getRenderableIds();for(let u=0;u<r.length;u++){const _=r[u];if(t.neighboringTiles&&t.neighboringTiles[_]){const x=this.getTileByID(_);l(t,x),l(x,t)}}function l(u,_){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let x=_.tileID.canonical.x-u.tileID.canonical.x;const w=_.tileID.canonical.y-u.tileID.canonical.y,I=Math.pow(2,u.tileID.canonical.z),A=_.tileID.key;x===0&&w===0||Math.abs(w)>1||(Math.abs(x)>1&&(Math.abs(x+I)===1?x+=I:Math.abs(x-I)===1&&(x-=I)),_.dem&&u.dem&&(u.dem.backfillBorder(_.dem,x,w),u.neighboringTiles&&u.neighboringTiles[A]&&(u.neighboringTiles[A].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,l,u){for(const _ in this._tiles){let x=this._tiles[_];if(u[_]||!x.hasData()||x.tileID.overscaledZ<=r||x.tileID.overscaledZ>l)continue;let w=x.tileID;for(;x&&x.tileID.overscaledZ>r+1;){const A=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[A.key],x&&x.hasData()&&(w=A)}let I=w;for(;I.overscaledZ>r;)if(I=I.scaledTo(I.overscaledZ-1),t[I.key]){u[w.key]=w;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){const l=this._loadedParentTiles[t.key];return l&&l.tileID.overscaledZ>=r?l:null}for(let l=t.overscaledZ-1;l>=r;l--){const u=t.scaledTo(l),_=this._getLoadedTile(u);if(_)return _}}_getLoadedTile(t){const r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const r=Math.ceil(t.width/this._source.tileSize)+1,l=Math.ceil(t.height/this._source.tileSize)+1,u=Math.floor(r*l*(this._maxTileCacheZoomLevels===null?s.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(_)}handleWrapJump(t){const r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,r){const l={};for(const u in this._tiles){const _=this._tiles[u];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+r),l[_.tileID.key]=_}this._tiles=l;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}update(t,r){if(this.transform=t,this.terrain=r,!this._sourceLoaded||this._paused)return;let l;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(L=>new s.O(L.canonical.z,L.wrap,L.canonical.z,L.canonical.x,L.canonical.y)):(l=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r}),this._source.hasTile&&(l=l.filter(L=>this._source.hasTile(L)))):l=[];const u=t.coveringZoomLevel(this._source),_=Math.max(u-tn.maxOverzooming,this._source.minzoom),x=Math.max(u+tn.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const L={};for(const z of l)if(z.canonical.z>this._source.minzoom){const N=z.scaledTo(z.canonical.z-1);L[N.key]=N;const X=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));L[X.key]=X}l=l.concat(Object.values(L))}const w=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new s.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const I=this._updateRetainedTiles(l,u);if(jt(this._source.type)){const L={},z={},N=Object.keys(I),X=s.h.now();for(const H of N){const J=I[H],G=this._tiles[H];if(!G||G.fadeEndTime!==0&&G.fadeEndTime<=X)continue;const ue=this.findLoadedParent(J,_);ue&&(this._addTile(ue.tileID),L[ue.tileID.key]=ue.tileID),z[H]=J}this._retainLoadedChildren(z,u,x,I);for(const H in L)I[H]||(this._coveredTiles[H]=!0,I[H]=L[H]);if(r){const H={},J={};for(const G of l)this._tiles[G.key].hasData()?H[G.key]=G:J[G.key]=G;for(const G in J){const ue=J[G].children(this._source.maxzoom);this._tiles[ue[0].key]&&this._tiles[ue[1].key]&&this._tiles[ue[2].key]&&this._tiles[ue[3].key]&&(H[ue[0].key]=I[ue[0].key]=ue[0],H[ue[1].key]=I[ue[1].key]=ue[1],H[ue[2].key]=I[ue[2].key]=ue[2],H[ue[3].key]=I[ue[3].key]=ue[3],delete J[G])}for(const G in J){const ue=this.findLoadedParent(J[G],this._source.minzoom);if(ue){H[ue.tileID.key]=I[ue.tileID.key]=ue.tileID;for(const we in H)H[we].isChildOf(ue.tileID)&&delete H[we]}}for(const G in this._tiles)H[G]||(this._coveredTiles[G]=!0)}}for(const L in I)this._tiles[L].clearFadeHold();const A=s.ab(this._tiles,I);for(const L of A){const z=this._tiles[L];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(L)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,r){const l={},u={},_=Math.max(r-tn.maxOverzooming,this._source.minzoom),x=Math.max(r+tn.maxUnderzooming,this._source.minzoom),w={};for(const I of t){const A=this._addTile(I);l[I.key]=I,A.hasData()||r<this._source.maxzoom&&(w[I.key]=I)}this._retainLoadedChildren(w,r,x,l);for(const I of t){let A=this._tiles[I.key];if(A.hasData())continue;if(r+1>this._source.maxzoom){const z=I.children(this._source.maxzoom)[0],N=this.getTile(z);if(N&&N.hasData()){l[z.key]=z;continue}}else{const z=I.children(this._source.maxzoom);if(l[z[0].key]&&l[z[1].key]&&l[z[2].key]&&l[z[3].key])continue}let L=A.wasRequested();for(let z=I.overscaledZ-1;z>=_;--z){const N=I.scaledTo(z);if(u[N.key])break;if(u[N.key]=!0,A=this.getTile(N),!A&&L&&(A=this._addTile(N)),A){const X=A.hasData();if((L||X)&&(l[N.key]=N),L=A.wasRequested(),X)break}}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const r=[];let l,u=this._tiles[t].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}r.push(u.key);const _=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(_),l)break;u=_}for(const _ of r)this._loadedParentTiles[_]=l}}_addTile(t){let r=this._tiles[t.key];if(r)return r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const l=r;return r||(r=new Dn(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))),r.uses++,this._tiles[t.key]=r,l||this._source.fire(new s.k("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const l=r.getExpiryTimeout();l&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},l))}_removeTile(t){const r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,r,l){const u=[],_=this.transform;if(!_)return u;const x=l?_.getCameraQueryGeometry(t):t,w=t.map(H=>_.pointCoordinate(H,this.terrain)),I=x.map(H=>_.pointCoordinate(H,this.terrain)),A=this.getIds();let L=1/0,z=1/0,N=-1/0,X=-1/0;for(const H of I)L=Math.min(L,H.x),z=Math.min(z,H.y),N=Math.max(N,H.x),X=Math.max(X,H.y);for(let H=0;H<A.length;H++){const J=this._tiles[A[H]];if(J.holdingForFade())continue;const G=J.tileID,ue=Math.pow(2,_.zoom-J.tileID.overscaledZ),we=r*J.queryPadding*s.N/J.tileSize/ue,te=[G.getTilePoint(new s.U(L,z)),G.getTilePoint(new s.U(N,X))];if(te[0].x-we<s.N&&te[0].y-we<s.N&&te[1].x+we>=0&&te[1].y+we>=0){const de=w.map(Ce=>G.getTilePoint(Ce)),Ie=I.map(Ce=>G.getTilePoint(Ce));u.push({tile:J,tileID:G,queryGeometry:de,cameraQueryGeometry:Ie,scale:ue})}}return u}getVisibleCoordinates(t){const r=this.getRenderableIds(t).map(l=>this._tiles[l].tileID);for(const l of r)l.posMatrix=this.transform.calculatePosMatrix(l.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(jt(this._source.type)){const t=s.h.now();for(const r in this._tiles)if(this._tiles[r].fadeEndTime>=t)return!0}return!1}setFeatureState(t,r,l){this._state.updateState(t=t||"_geojsonTileLayer",r,l)}removeFeatureState(t,r,l){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,l)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,l){const u=this._tiles[t];u&&u.setDependencies(r,l)}reloadTilesForDependencies(t,r){for(const l in this._tiles)this._tiles[l].hasDependency(t,r)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(t,r))}}function zi(p,t){const r=Math.abs(2*p.wrap)-+(p.wrap<0),l=Math.abs(2*t.wrap)-+(t.wrap<0);return p.overscaledZ-t.overscaledZ||l-r||t.canonical.y-p.canonical.y||t.canonical.x-p.canonical.x}function jt(p){return p==="raster"||p==="image"||p==="video"}tn.maxOverzooming=10,tn.maxUnderzooming=3;const ei="mapboxgl_preloaded_worker_pool";class $r{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<$r.workerCount;)this.workers.push(new Worker(s.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ei]}numActive(){return Object.keys(this.active).length}}const Br=Math.floor(s.h.hardwareConcurrency/2);let eo;function as(){return eo||(eo=new $r),eo}$r.workerCount=s.ac(globalThis)?Math.max(Math.min(Br,3),1):1;class No{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.ad(t,0,1);let r=1,l=this._distances[r];const u=t*this.paddedLength+this.padding;for(;l<u&&r<this._distances.length;)l=this._distances[++r];const _=r-1,x=this._distances[_],w=l-x,I=w>0?(u-x)/w:0;return this.points[_].mult(1-I).add(this.points[r].mult(I))}}function Nr(p,t){let r=!0;return p==="always"||p!=="never"&&t!=="never"||(r=!1),r}class vo{constructor(t,r,l){const u=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/l),this.yCellCount=Math.ceil(r/l);for(let x=0;x<this.xCellCount*this.yCellCount;x++)u.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,l,u,_){this._forEachCell(r,l,u,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(_)}insertCircle(t,r,l,u){this._forEachCell(r-u,l-u,r+u,l+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(l),this.circles.push(u)}_insertBoxCell(t,r,l,u,_,x){this.boxCells[_].push(x)}_insertCircleCell(t,r,l,u,_,x){this.circleCells[_].push(x)}_query(t,r,l,u,_,x,w){if(l<0||t>this.width||u<0||r>this.height)return[];const I=[];if(t<=0&&r<=0&&this.width<=l&&this.height<=u){if(_)return[{key:null,x1:t,y1:r,x2:l,y2:u}];for(let A=0;A<this.boxKeys.length;A++)I.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const L=this.circles[3*A],z=this.circles[3*A+1],N=this.circles[3*A+2];I.push({key:this.circleKeys[A],x1:L-N,y1:z-N,x2:L+N,y2:z+N})}}else this._forEachCell(t,r,l,u,this._queryCell,I,{hitTest:_,overlapMode:x,seenUids:{box:{},circle:{}}},w);return I}query(t,r,l,u){return this._query(t,r,l,u,!1,null)}hitTest(t,r,l,u,_,x){return this._query(t,r,l,u,!0,_,x).length>0}hitTestCircle(t,r,l,u,_){const x=t-l,w=t+l,I=r-l,A=r+l;if(w<0||x>this.width||A<0||I>this.height)return!1;const L=[];return this._forEachCell(x,I,w,A,this._queryCellCircle,L,{hitTest:!0,overlapMode:u,circle:{x:t,y:r,radius:l},seenUids:{box:{},circle:{}}},_),L.length>0}_queryCell(t,r,l,u,_,x,w,I){const{seenUids:A,hitTest:L,overlapMode:z}=w,N=this.boxCells[_];if(N!==null){const H=this.bboxes;for(const J of N)if(!A.box[J]){A.box[J]=!0;const G=4*J,ue=this.boxKeys[J];if(t<=H[G+2]&&r<=H[G+3]&&l>=H[G+0]&&u>=H[G+1]&&(!I||I(ue))&&(!L||!Nr(z,ue.overlapMode))&&(x.push({key:ue,x1:H[G],y1:H[G+1],x2:H[G+2],y2:H[G+3]}),L))return!0}}const X=this.circleCells[_];if(X!==null){const H=this.circles;for(const J of X)if(!A.circle[J]){A.circle[J]=!0;const G=3*J,ue=this.circleKeys[J];if(this._circleAndRectCollide(H[G],H[G+1],H[G+2],t,r,l,u)&&(!I||I(ue))&&(!L||!Nr(z,ue.overlapMode))){const we=H[G],te=H[G+1],de=H[G+2];if(x.push({key:ue,x1:we-de,y1:te-de,x2:we+de,y2:te+de}),L)return!0}}}return!1}_queryCellCircle(t,r,l,u,_,x,w,I){const{circle:A,seenUids:L,overlapMode:z}=w,N=this.boxCells[_];if(N!==null){const H=this.bboxes;for(const J of N)if(!L.box[J]){L.box[J]=!0;const G=4*J,ue=this.boxKeys[J];if(this._circleAndRectCollide(A.x,A.y,A.radius,H[G+0],H[G+1],H[G+2],H[G+3])&&(!I||I(ue))&&!Nr(z,ue.overlapMode))return x.push(!0),!0}}const X=this.circleCells[_];if(X!==null){const H=this.circles;for(const J of X)if(!L.circle[J]){L.circle[J]=!0;const G=3*J,ue=this.circleKeys[J];if(this._circlesCollide(H[G],H[G+1],H[G+2],A.x,A.y,A.radius)&&(!I||I(ue))&&!Nr(z,ue.overlapMode))return x.push(!0),!0}}}_forEachCell(t,r,l,u,_,x,w,I){const A=this._convertToXCellCoord(t),L=this._convertToYCellCoord(r),z=this._convertToXCellCoord(l),N=this._convertToYCellCoord(u);for(let X=A;X<=z;X++)for(let H=L;H<=N;H++)if(_.call(this,t,r,l,u,this.xCellCount*H+X,x,w,I))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,l,u,_,x){const w=u-t,I=_-r,A=l+x;return A*A>w*w+I*I}_circleAndRectCollide(t,r,l,u,_,x,w){const I=(x-u)/2,A=Math.abs(t-(u+I));if(A>I+l)return!1;const L=(w-_)/2,z=Math.abs(r-(_+L));if(z>L+l)return!1;if(A<=I||z<=L)return!0;const N=A-I,X=z-L;return N*N+X*X<=l*l}}function tt(p,t,r,l,u){const _=s.Z();return t?(s.a0(_,_,[1/u,1/u,1]),r||s.ae(_,_,l.angle)):s.a1(_,l.labelPlaneMatrix,p),_}function Er(p,t,r,l,u){if(t){const _=s.af(p);return s.a0(_,_,[u,u,1]),r||s.ae(_,_,-l.angle),_}return l.glCoordMatrix}function mn(p,t,r){let l;r?(l=[p.x,p.y,r(p.x,p.y),1],s.ag(l,l,t)):(l=[p.x,p.y,0,1],Y(l,l,t));const u=l[3];return{point:new s.P(l[0]/u,l[1]/u),signedDistanceFromCamera:u}}function ls(p,t){return .5+p/t*.5}function gr(p,t){const r=p[0]/p[3],l=p[1]/p[3];return r>=-t[0]&&r<=t[0]&&l>=-t[1]&&l<=t[1]}function rt(p,t,r,l,u,_,x,w,I,A){const L=l?p.textSizeData:p.iconSizeData,z=s.ah(L,r.transform.zoom),N=[256/r.width*2+1,256/r.height*2+1],X=l?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;X.clear();const H=p.lineVertexArray,J=l?p.text.placedSymbolArray:p.icon.placedSymbolArray,G=r.transform.width/r.transform.height;let ue=!1;for(let we=0;we<J.length;we++){const te=J.get(we);if(te.hidden||te.writingMode===s.ai.vertical&&!ue){Z(te.numGlyphs,X);continue}let de;if(ue=!1,A?(de=[te.anchorX,te.anchorY,A(te.anchorX,te.anchorY),1],s.ag(de,de,t)):(de=[te.anchorX,te.anchorY,0,1],Y(de,de,t)),!gr(de,N)){Z(te.numGlyphs,X);continue}const Ie=ls(r.transform.cameraToCenterDistance,de[3]),Ce=s.aj(L,z,te),Oe=x?Ce/Ie:Ce*Ie,We=new s.P(te.anchorX,te.anchorY),Ue=mn(We,u,A).point,et={projections:{},offsets:{}},It=ir(te,Oe,!1,w,t,u,_,p.glyphOffsetArray,H,X,Ue,We,et,G,I,A);ue=It.useVertical,(It.notEnoughRoom||ue||It.needsFlipping&&ir(te,Oe,!0,w,t,u,_,p.glyphOffsetArray,H,X,Ue,We,et,G,I,A).notEnoughRoom)&&Z(te.numGlyphs,X)}l?p.text.dynamicLayoutVertexBuffer.updateData(X):p.icon.dynamicLayoutVertexBuffer.updateData(X)}function oi(p,t,r,l,u,_,x,w,I,A,L,z,N){const X=w.glyphStartIndex+w.numGlyphs,H=w.lineStartIndex,J=w.lineStartIndex+w.lineLength,G=t.getoffsetX(w.glyphStartIndex),ue=t.getoffsetX(X-1),we=R(p*G,r,l,u,_,x,w.segment,H,J,I,A,L,z,N);if(!we)return null;const te=R(p*ue,r,l,u,_,x,w.segment,H,J,I,A,L,z,N);return te?{first:we,last:te}:null}function Jt(p,t,r,l){return p===s.ai.horizontal&&Math.abs(r.y-t.y)>Math.abs(r.x-t.x)*l?{useVertical:!0}:(p===s.ai.vertical?t.y<r.y:t.x>r.x)?{needsFlipping:!0}:null}function ir(p,t,r,l,u,_,x,w,I,A,L,z,N,X,H,J){const G=t/24,ue=p.lineOffsetX*G,we=p.lineOffsetY*G;let te;if(p.numGlyphs>1){const de=p.glyphStartIndex+p.numGlyphs,Ie=p.lineStartIndex,Ce=p.lineStartIndex+p.lineLength,Oe=oi(G,w,ue,we,r,L,z,p,I,_,N,H,J);if(!Oe)return{notEnoughRoom:!0};const We=mn(Oe.first.point,x,J).point,Ue=mn(Oe.last.point,x,J).point;if(l&&!r){const et=Jt(p.writingMode,We,Ue,X);if(et)return et}te=[Oe.first];for(let et=p.glyphStartIndex+1;et<de-1;et++)te.push(R(G*w.getoffsetX(et),ue,we,r,L,z,p.segment,Ie,Ce,I,_,N,H,J));te.push(Oe.last)}else{if(l&&!r){const Ie=mn(z,u,J).point,Ce=p.lineStartIndex+p.segment+1,Oe=new s.P(I.getx(Ce),I.gety(Ce)),We=mn(Oe,u,J),Ue=We.signedDistanceFromCamera>0?We.point:kr(z,Oe,Ie,1,u,J),et=Jt(p.writingMode,Ie,Ue,X);if(et)return et}const de=R(G*w.getoffsetX(p.glyphStartIndex),ue,we,r,L,z,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,I,_,N,H,J);if(!de)return{notEnoughRoom:!0};te=[de]}for(const de of te)s.ak(A,de.point,de.angle);return{}}function kr(p,t,r,l,u,_){const x=mn(p.add(p.sub(t)._unit()),u,_).point,w=r.sub(x);return r.add(w._mult(l/w.mag()))}function Wt(p,t){const{projectionCache:r,lineVertexArray:l,labelPlaneMatrix:u,tileAnchorPoint:_,distanceFromAnchor:x,getElevation:w,previousVertex:I,direction:A,absOffsetX:L}=t;if(r.projections[p])return r.projections[p];const z=new s.P(l.getx(p),l.gety(p)),N=mn(z,u,w);if(N.signedDistanceFromCamera>0)return r.projections[p]=N.point,N.point;const X=p-A;return kr(x===0?_:new s.P(l.getx(X),l.gety(X)),z,I,L-x+1,u,w)}function Vr(p,t,r){return p._unit()._perp()._mult(t*r)}function K(p,t,r,l,u,_,x,w){const{projectionCache:I,direction:A}=w;if(I.offsets[p])return I.offsets[p];const L=r.add(t);if(p+A<l||p+A>=u)return I.offsets[p]=L,L;const z=Wt(p+A,w),N=Vr(z.sub(r),x,A),X=r.add(N),H=z.add(N);return I.offsets[p]=s.al(_,L,X,H)||L,I.offsets[p]}function R(p,t,r,l,u,_,x,w,I,A,L,z,N,X){const H=l?p-t:p+t;let J=H>0?1:-1,G=0;l&&(J*=-1,G=Math.PI),J<0&&(G+=Math.PI);let ue,we,te=J>0?w+x:w+x+1,de=u,Ie=u,Ce=0,Oe=0;const We=Math.abs(H),Ue=[];let et;for(;Ce+Oe<=We;){if(te+=J,te<w||te>=I)return null;Ce+=Oe,Ie=de,we=ue;const ct={projectionCache:z,lineVertexArray:A,labelPlaneMatrix:L,tileAnchorPoint:_,distanceFromAnchor:Ce,getElevation:X,previousVertex:Ie,direction:J,absOffsetX:We};if(de=Wt(te,ct),r===0)Ue.push(Ie),et=de.sub(Ie);else{let Xt;const Mt=de.sub(Ie);Xt=Mt.mag()===0?Vr(Wt(te+J,ct).sub(de),r,J):Vr(Mt,r,J),we||(we=Ie.add(Xt)),ue=K(te,Xt,de,w,I,we,r,ct),Ue.push(we),et=ue.sub(we)}Oe=et.mag()}const It=et._mult((We-Ce)/Oe)._add(we||Ie),_i=G+Math.atan2(de.y-Ie.y,de.x-Ie.x);return Ue.push(It),{point:It,angle:N?_i:0,path:Ue}}const B=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Z(p,t){for(let r=0;r<p;r++){const l=t.length;t.resize(l+4),t.float32.set(B,3*l)}}function Y(p,t,r){const l=t[0],u=t[1];return p[0]=r[0]*l+r[4]*u+r[12],p[1]=r[1]*l+r[5]*u+r[13],p[3]=r[3]*l+r[7]*u+r[15],p}const $=100;class me{constructor(t,r=new vo(t.width+200,t.height+200,25),l=new vo(t.width+200,t.height+200,25)){this.transform=t,this.grid=r,this.ignoredGrid=l,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+$,this.screenBottomBoundary=t.height+$,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,r,l,u,_,x){const w=this.projectAndGetPerspectiveRatio(u,t.anchorPointX,t.anchorPointY,x),I=l*w.perspectiveRatio,A=t.x1*I+w.point.x,L=t.y1*I+w.point.y,z=t.x2*I+w.point.x,N=t.y2*I+w.point.y;return!this.isInsideGrid(A,L,z,N)||r!=="always"&&this.grid.hitTest(A,L,z,N,r,_)||w.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[A,L,z,N],offscreen:this.isOffscreen(A,L,z,N)}}placeCollisionCircles(t,r,l,u,_,x,w,I,A,L,z,N,X,H){const J=[],G=new s.P(r.anchorX,r.anchorY),ue=mn(G,x,H),we=ls(this.transform.cameraToCenterDistance,ue.signedDistanceFromCamera),te=(L?_/we:_*we)/s.ap,de=mn(G,w,H).point,Ie=oi(te,u,r.lineOffsetX*te,r.lineOffsetY*te,!1,de,G,r,l,w,{projections:{},offsets:{}},!1,H);let Ce=!1,Oe=!1,We=!0;if(Ie){const Ue=.5*N*we+X,et=new s.P(-100,-100),It=new s.P(this.screenRightBoundary,this.screenBottomBoundary),_i=new No,ct=Ie.first,Xt=Ie.last;let Mt=[];for(let li=ct.path.length-1;li>=1;li--)Mt.push(ct.path[li]);for(let li=1;li<Xt.path.length;li++)Mt.push(Xt.path[li]);const Zi=2.5*Ue;if(I){const li=Mt.map(gi=>mn(gi,I,H));Mt=li.some(gi=>gi.signedDistanceFromCamera<=0)?[]:li.map(gi=>gi.point)}let pi=[];if(Mt.length>0){const li=Mt[0].clone(),gi=Mt[0].clone();for(let Mn=1;Mn<Mt.length;Mn++)li.x=Math.min(li.x,Mt[Mn].x),li.y=Math.min(li.y,Mt[Mn].y),gi.x=Math.max(gi.x,Mt[Mn].x),gi.y=Math.max(gi.y,Mt[Mn].y);pi=li.x>=et.x&&gi.x<=It.x&&li.y>=et.y&&gi.y<=It.y?[Mt]:gi.x<et.x||li.x>It.x||gi.y<et.y||li.y>It.y?[]:s.am([Mt],et.x,et.y,It.x,It.y)}for(const li of pi){_i.reset(li,.25*Ue);let gi=0;gi=_i.length<=.5*Ue?1:Math.ceil(_i.paddedLength/Zi)+1;for(let Mn=0;Mn<gi;Mn++){const rn=Mn/Math.max(gi-1,1),dr=_i.lerp(rn),Wn=dr.x+$,Bn=dr.y+$;J.push(Wn,Bn,Ue,0);const ao=Wn-Ue,dn=Bn-Ue,Jo=Wn+Ue,Yo=Bn+Ue;if(We=We&&this.isOffscreen(ao,dn,Jo,Yo),Oe=Oe||this.isInsideGrid(ao,dn,Jo,Yo),t!=="always"&&this.grid.hitTestCircle(Wn,Bn,Ue,t,z)&&(Ce=!0,!A))return{circles:[],offscreen:!1,collisionDetected:Ce}}}}return{circles:!A&&Ce||!Oe||we<this.perspectiveRatioCutoff?[]:J,offscreen:We,collisionDetected:Ce}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[];let l=1/0,u=1/0,_=-1/0,x=-1/0;for(const L of t){const z=new s.P(L.x+$,L.y+$);l=Math.min(l,z.x),u=Math.min(u,z.y),_=Math.max(_,z.x),x=Math.max(x,z.y),r.push(z)}const w=this.grid.query(l,u,_,x).concat(this.ignoredGrid.query(l,u,_,x)),I={},A={};for(const L of w){const z=L.key;if(I[z.bucketInstanceId]===void 0&&(I[z.bucketInstanceId]={}),I[z.bucketInstanceId][z.featureIndex])continue;const N=[new s.P(L.x1,L.y1),new s.P(L.x2,L.y1),new s.P(L.x2,L.y2),new s.P(L.x1,L.y2)];s.an(r,N)&&(I[z.bucketInstanceId][z.featureIndex]=!0,A[z.bucketInstanceId]===void 0&&(A[z.bucketInstanceId]=[]),A[z.bucketInstanceId].push(z.featureIndex))}return A}insertCollisionBox(t,r,l,u,_,x){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:_,collisionGroupID:x,overlapMode:r},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,l,u,_,x){const w=l?this.ignoredGrid:this.grid,I={bucketInstanceId:u,featureIndex:_,collisionGroupID:x,overlapMode:r};for(let A=0;A<t.length;A+=4)w.insertCircle(I,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,r,l,u){let _;return u?(_=[r,l,u(r,l),1],s.ag(_,_,t)):(_=[r,l,0,1],Y(_,_,t)),{point:new s.P((_[0]/_[3]+1)/2*this.transform.width+$,(-_[1]/_[3]+1)/2*this.transform.height+$),perspectiveRatio:.5+this.transform.cameraToCenterDistance/_[3]*.5}}isOffscreen(t,r,l,u){return l<$||t>=this.screenRightBoundary||u<$||r>this.screenBottomBoundary}isInsideGrid(t,r,l,u){return l>=0&&t<this.gridRightBoundary&&u>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=s.ao([]);return s.$(t,t,[-100,-100,0]),t}}function ae(p,t,r){return t*(s.N/(p.tileSize*Math.pow(2,r-p.tileID.overscaledZ)))}class ne{constructor(t,r,l,u){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):u&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class ce{constructor(t,r,l,u,_){this.text=new ne(t?t.text:null,r,l,_),this.icon=new ne(t?t.icon:null,r,u,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Le{constructor(t,r,l){this.text=t,this.icon=r,this.skipFade=l}}class Fe{constructor(){this.invProjMatrix=s.Z(),this.viewportMatrix=s.Z(),this.circles=[]}}class Re{constructor(t,r,l,u,_){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=l,this.bucketIndex=u,this.tileID=_}}class Et{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:l=>l.collisionGroupID===r}}return this.collisionGroups[t]}}function Yt(p,t,r,l,u){const{horizontalAlign:_,verticalAlign:x}=s.au(p);return new s.P(-(_-.5)*t+l[0]*u,-(x-.5)*r+l[1]*u)}function bt(p,t,r,l,u,_){const{x1:x,x2:w,y1:I,y2:A,anchorPointX:L,anchorPointY:z}=p,N=new s.P(t,r);return l&&N._rotate(u?_:-_),{x1:x+N.x,y1:I+N.y,x2:w+N.x,y2:A+N.y,anchorPointX:L,anchorPointY:z}}class Dt{constructor(t,r,l,u,_){this.transform=t.clone(),this.terrain=r,this.collisionIndex=new me(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Et(u),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,r,l,u){const _=l.getBucket(r),x=l.latestFeatureIndex;if(!_||!x||r.id!==_.layerIds[0])return;const w=l.collisionBoxArray,I=_.layers[0].layout,A=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),L=l.tileSize/s.N,z=this.transform.calculatePosMatrix(l.tileID.toUnwrapped()),N=I.get("text-pitch-alignment")==="map",X=I.get("text-rotation-alignment")==="map",H=ae(l,1,this.transform.zoom),J=tt(z,N,X,this.transform,H);let G=null;if(N){const we=Er(z,N,X,this.transform,H);G=s.a1([],this.transform.labelPlaneMatrix,we)}this.retainedQueryData[_.bucketInstanceId]=new Re(_.bucketInstanceId,x,_.sourceLayerIndex,_.index,l.tileID);const ue={bucket:_,layout:I,posMatrix:z,textLabelPlaneMatrix:J,labelToScreenMatrix:G,scale:A,textPixelRatio:L,holdingForFade:l.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:s.ah(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(u)for(const we of _.sortKeyRanges){const{sortKey:te,symbolInstanceStart:de,symbolInstanceEnd:Ie}=we;t.push({sortKey:te,symbolInstanceStart:de,symbolInstanceEnd:Ie,parameters:ue})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:ue})}attemptAnchorPlacement(t,r,l,u,_,x,w,I,A,L,z,N,X,H,J,G){const ue=s.aq[t.textAnchor],we=[t.textOffset0,t.textOffset1],te=Yt(ue,l,u,we,_),de=this.collisionIndex.placeCollisionBox(bt(r,te.x,te.y,x,w,this.transform.angle),z,I,A,L.predicate,G);if((!J||this.collisionIndex.placeCollisionBox(bt(J,te.x,te.y,x,w,this.transform.angle),z,I,A,L.predicate,G).box.length!==0)&&de.box.length>0){let Ie;if(this.prevPlacement&&this.prevPlacement.variableOffsets[N.crossTileID]&&this.prevPlacement.placements[N.crossTileID]&&this.prevPlacement.placements[N.crossTileID].text&&(Ie=this.prevPlacement.variableOffsets[N.crossTileID].anchor),N.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[N.crossTileID]={textOffset:we,width:l,height:u,anchor:ue,textBoxScale:_,prevAnchor:Ie},this.markUsedJustification(X,ue,N,H),X.allowVerticalPlacement&&(this.markUsedOrientation(X,H,N),this.placedOrientations[N.crossTileID]=H),{shift:te,placedGlyphBoxes:de}}}placeLayerBucketPart(t,r,l){const{bucket:u,layout:_,posMatrix:x,textLabelPlaneMatrix:w,labelToScreenMatrix:I,textPixelRatio:A,holdingForFade:L,collisionBoxArray:z,partiallyEvaluatedTextSize:N,collisionGroup:X}=t.parameters,H=_.get("text-optional"),J=_.get("icon-optional"),G=s.ar(_,"text-overlap","text-allow-overlap"),ue=G==="always",we=s.ar(_,"icon-overlap","icon-allow-overlap"),te=we==="always",de=_.get("text-rotation-alignment")==="map",Ie=_.get("text-pitch-alignment")==="map",Ce=_.get("icon-text-fit")!=="none",Oe=_.get("symbol-z-order")==="viewport-y",We=ue&&(te||!u.hasIconData()||J),Ue=te&&(ue||!u.hasTextData()||H);!u.collisionArrays&&z&&u.deserializeCollisionBoxes(z);const et=this.retainedQueryData[u.bucketInstanceId].tileID,It=this.terrain?(ct,Xt)=>this.terrain.getElevation(et,ct,Xt):null,_i=(ct,Xt)=>{var Mt,Zi;if(r[ct.crossTileID])return;if(L)return void(this.placements[ct.crossTileID]=new Le(!1,!1,!1));let pi=!1,li=!1,gi=!0,Mn=null,rn={box:null,offscreen:null},dr={box:null,offscreen:null},Wn=null,Bn=null,ao=null,dn=0,Jo=0,Yo=0;Xt.textFeatureIndex?dn=Xt.textFeatureIndex:ct.useRuntimeCollisionCircles&&(dn=ct.featureIndex),Xt.verticalTextFeatureIndex&&(Jo=Xt.verticalTextFeatureIndex);const zs=Xt.textBox;if(zs){const Sr=An=>{let Hn=s.ai.horizontal;if(u.allowVerticalPlacement&&!An&&this.prevPlacement){const Gr=this.prevPlacement.placedOrientations[ct.crossTileID];Gr&&(this.placedOrientations[ct.crossTileID]=Gr,Hn=Gr,this.markUsedOrientation(u,Hn,ct))}return Hn},pr=(An,Hn)=>{if(u.allowVerticalPlacement&&ct.numVerticalGlyphVertices>0&&Xt.verticalTextBox){for(const Gr of u.writingModes)if(Gr===s.ai.vertical?(rn=Hn(),dr=rn):rn=An(),rn&&rn.box&&rn.box.length)break}else rn=An()},Lr=ct.textAnchorOffsetStartIndex,ta=ct.textAnchorOffsetEndIndex;if(ta===Lr){const An=(Hn,Gr)=>{const Pn=this.collisionIndex.placeCollisionBox(Hn,G,A,x,X.predicate,It);return Pn&&Pn.box&&Pn.box.length&&(this.markUsedOrientation(u,Gr,ct),this.placedOrientations[ct.crossTileID]=Gr),Pn};pr(()=>An(zs,s.ai.horizontal),()=>{const Hn=Xt.verticalTextBox;return u.allowVerticalPlacement&&ct.numVerticalGlyphVertices>0&&Hn?An(Hn,s.ai.vertical):{box:null,offscreen:null}}),Sr(rn&&rn.box&&rn.box.length)}else{let An=s.aq[(Zi=(Mt=this.prevPlacement)===null||Mt===void 0?void 0:Mt.variableOffsets[ct.crossTileID])===null||Zi===void 0?void 0:Zi.anchor];const Hn=(Pn,ia,Cl)=>{const eu=Pn.x2-Pn.x1,tu=Pn.y2-Pn.y1,Bu=ct.textBoxScale,cc=Ce&&we==="never"?ia:null;let Qo={box:[],offscreen:!1},na=G==="never"?1:2,$o="never";An&&na++;for(let Eo=0;Eo<na;Eo++){for(let es=Lr;es<ta;es++){const uc=u.textAnchorOffsets.get(es);if(An&&uc.textAnchor!==An)continue;const ms=this.attemptAnchorPlacement(uc,Pn,eu,tu,Bu,de,Ie,A,x,X,$o,ct,u,Cl,cc,It);if(ms&&(Qo=ms.placedGlyphBoxes,Qo&&Qo.box&&Qo.box.length))return pi=!0,Mn=ms.shift,Qo}An?An=null:$o=G}return Qo};pr(()=>Hn(zs,Xt.iconBox,s.ai.horizontal),()=>{const Pn=Xt.verticalTextBox;return u.allowVerticalPlacement&&!(rn&&rn.box&&rn.box.length)&&ct.numVerticalGlyphVertices>0&&Pn?Hn(Pn,Xt.verticalIconBox,s.ai.vertical):{box:null,offscreen:null}}),rn&&(pi=rn.box,gi=rn.offscreen);const Gr=Sr(rn&&rn.box);if(!pi&&this.prevPlacement){const Pn=this.prevPlacement.variableOffsets[ct.crossTileID];Pn&&(this.variableOffsets[ct.crossTileID]=Pn,this.markUsedJustification(u,Pn.anchor,ct,Gr))}}}if(Wn=rn,pi=Wn&&Wn.box&&Wn.box.length>0,gi=Wn&&Wn.offscreen,ct.useRuntimeCollisionCircles){const Sr=u.text.placedSymbolArray.get(ct.centerJustifiedTextSymbolIndex),pr=s.aj(u.textSizeData,N,Sr),Lr=_.get("text-padding");Bn=this.collisionIndex.placeCollisionCircles(G,Sr,u.lineVertexArray,u.glyphOffsetArray,pr,x,w,I,l,Ie,X.predicate,ct.collisionCircleDiameter,Lr,It),Bn.circles.length&&Bn.collisionDetected&&!l&&s.w("Collisions detected, but collision boxes are not shown"),pi=ue||Bn.circles.length>0&&!Bn.collisionDetected,gi=gi&&Bn.offscreen}if(Xt.iconFeatureIndex&&(Yo=Xt.iconFeatureIndex),Xt.iconBox){const Sr=pr=>{const Lr=Ce&&Mn?bt(pr,Mn.x,Mn.y,de,Ie,this.transform.angle):pr;return this.collisionIndex.placeCollisionBox(Lr,we,A,x,X.predicate,It)};dr&&dr.box&&dr.box.length&&Xt.verticalIconBox?(ao=Sr(Xt.verticalIconBox),li=ao.box.length>0):(ao=Sr(Xt.iconBox),li=ao.box.length>0),gi=gi&&ao.offscreen}const ea=H||ct.numHorizontalGlyphVertices===0&&ct.numVerticalGlyphVertices===0,Na=J||ct.numIconVertices===0;if(ea||Na?Na?ea||(li=li&&pi):pi=li&&pi:li=pi=li&&pi,pi&&Wn&&Wn.box&&this.collisionIndex.insertCollisionBox(Wn.box,G,_.get("text-ignore-placement"),u.bucketInstanceId,dr&&dr.box&&Jo?Jo:dn,X.ID),li&&ao&&this.collisionIndex.insertCollisionBox(ao.box,we,_.get("icon-ignore-placement"),u.bucketInstanceId,Yo,X.ID),Bn&&(pi&&this.collisionIndex.insertCollisionCircles(Bn.circles,G,_.get("text-ignore-placement"),u.bucketInstanceId,dn,X.ID),l)){const Sr=u.bucketInstanceId;let pr=this.collisionCircleArrays[Sr];pr===void 0&&(pr=this.collisionCircleArrays[Sr]=new Fe);for(let Lr=0;Lr<Bn.circles.length;Lr+=4)pr.circles.push(Bn.circles[Lr+0]),pr.circles.push(Bn.circles[Lr+1]),pr.circles.push(Bn.circles[Lr+2]),pr.circles.push(Bn.collisionDetected?1:0)}if(ct.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ct.crossTileID]=new Le(pi||We,li||Ue,gi||u.justReloaded),r[ct.crossTileID]=!0};if(Oe){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ct=u.getSortedSymbolIndexes(this.transform.angle);for(let Xt=ct.length-1;Xt>=0;--Xt){const Mt=ct[Xt];_i(u.symbolInstances.get(Mt),u.collisionArrays[Mt])}}else for(let ct=t.symbolInstanceStart;ct<t.symbolInstanceEnd;ct++)_i(u.symbolInstances.get(ct),u.collisionArrays[ct]);if(l&&u.bucketInstanceId in this.collisionCircleArrays){const ct=this.collisionCircleArrays[u.bucketInstanceId];s.as(ct.invProjMatrix,x),ct.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}markUsedJustification(t,r,l,u){let _;_=u===s.ai.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[s.at(r)];const x=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const w of x)w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=_>=0&&w!==_?0:l.crossTileID)}markUsedOrientation(t,r,l){const u=r===s.ai.horizontal||r===s.ai.horizontalOnly?r:0,_=r===s.ai.vertical?r:0,x=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const w of x)t.text.placedSymbolArray.get(w).placedOrientation=u;l.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let l=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const u=r?r.symbolFadeChange(t):1,_=r?r.opacities:{},x=r?r.variableOffsets:{},w=r?r.placedOrientations:{};for(const I in this.placements){const A=this.placements[I],L=_[I];L?(this.opacities[I]=new ce(L,u,A.text,A.icon),l=l||A.text!==L.text.placed||A.icon!==L.icon.placed):(this.opacities[I]=new ce(null,u,A.text,A.icon,A.skipFade),l=l||A.text||A.icon)}for(const I in _){const A=_[I];if(!this.opacities[I]){const L=new ce(A,u,!1,!1);L.isHidden()||(this.opacities[I]=L,l=l||A.text.placed||A.icon.placed)}}for(const I in x)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=x[I]);for(const I in w)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=w[I]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r){const l={};for(const u of r){const _=u.getBucket(t);_&&u.latestFeatureIndex&&t.id===_.layerIds[0]&&this.updateBucketOpacities(_,l,u.collisionBoxArray)}}updateBucketOpacities(t,r,l){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const u=t.layers[0],_=u.layout,x=new ce(null,0,!1,!1,!0),w=_.get("text-allow-overlap"),I=_.get("icon-allow-overlap"),A=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),L=_.get("text-rotation-alignment")==="map",z=_.get("text-pitch-alignment")==="map",N=_.get("icon-text-fit")!=="none",X=new ce(null,0,w&&(I||!t.hasIconData()||_.get("icon-optional")),I&&(w||!t.hasTextData()||_.get("text-optional")),!0);!t.collisionArrays&&l&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(l);const H=(J,G,ue)=>{for(let we=0;we<G/4;we++)J.opacityVertexArray.emplaceBack(ue);J.hasVisibleVertices=J.hasVisibleVertices||ue!==Ur};for(let J=0;J<t.symbolInstances.length;J++){const G=t.symbolInstances.get(J),{numHorizontalGlyphVertices:ue,numVerticalGlyphVertices:we,crossTileID:te}=G;let de=this.opacities[te];r[te]?de=x:de||(de=X,this.opacities[te]=de),r[te]=!0;const Ie=G.numIconVertices>0,Ce=this.placedOrientations[G.crossTileID],Oe=Ce===s.ai.vertical,We=Ce===s.ai.horizontal||Ce===s.ai.horizontalOnly;if(ue>0||we>0){const Ue=Fn(de.text);H(t.text,ue,Oe?Ur:Ue),H(t.text,we,We?Ur:Ue);const et=de.text.isHidden();[G.rightJustifiedTextSymbolIndex,G.centerJustifiedTextSymbolIndex,G.leftJustifiedTextSymbolIndex].forEach(ct=>{ct>=0&&(t.text.placedSymbolArray.get(ct).hidden=et||Oe?1:0)}),G.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(G.verticalPlacedTextSymbolIndex).hidden=et||We?1:0);const It=this.variableOffsets[G.crossTileID];It&&this.markUsedJustification(t,It.anchor,G,Ce);const _i=this.placedOrientations[G.crossTileID];_i&&(this.markUsedJustification(t,"left",G,_i),this.markUsedOrientation(t,_i,G))}if(Ie){const Ue=Fn(de.icon),et=!(N&&G.verticalPlacedIconSymbolIndex&&Oe);G.placedIconSymbolIndex>=0&&(H(t.icon,G.numIconVertices,et?Ue:Ur),t.icon.placedSymbolArray.get(G.placedIconSymbolIndex).hidden=de.icon.isHidden()),G.verticalPlacedIconSymbolIndex>=0&&(H(t.icon,G.numVerticalIconVertices,et?Ur:Ue),t.icon.placedSymbolArray.get(G.verticalPlacedIconSymbolIndex).hidden=de.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ue=t.collisionArrays[J];if(Ue){let et=new s.P(0,0);if(Ue.textBox||Ue.verticalTextBox){let _i=!0;if(A){const ct=this.variableOffsets[te];ct?(et=Yt(ct.anchor,ct.width,ct.height,ct.textOffset,ct.textBoxScale),L&&et._rotate(z?this.transform.angle:-this.transform.angle)):_i=!1}Ue.textBox&&ti(t.textCollisionBox.collisionVertexArray,de.text.placed,!_i||Oe,et.x,et.y),Ue.verticalTextBox&&ti(t.textCollisionBox.collisionVertexArray,de.text.placed,!_i||We,et.x,et.y)}const It=!!(!We&&Ue.verticalIconBox);Ue.iconBox&&ti(t.iconCollisionBox.collisionVertexArray,de.icon.placed,It,N?et.x:0,N?et.y:0),Ue.verticalIconBox&&ti(t.iconCollisionBox.collisionVertexArray,de.icon.placed,!It,N?et.x:0,N?et.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const J=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=J.invProjMatrix,t.placementViewportMatrix=J.viewportMatrix,t.collisionCircleArray=J.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const l=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*l>t}setStale(){this.stale=!0}}function ti(p,t,r,l,u){p.emplaceBack(t?1:0,r?1:0,l||0,u||0),p.emplaceBack(t?1:0,r?1:0,l||0,u||0),p.emplaceBack(t?1:0,r?1:0,l||0,u||0),p.emplaceBack(t?1:0,r?1:0,l||0,u||0)}const Ai=Math.pow(2,25),ai=Math.pow(2,24),Ii=Math.pow(2,17),wi=Math.pow(2,16),nr=Math.pow(2,9),ji=Math.pow(2,8),Cn=Math.pow(2,1);function Fn(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const t=p.placed?1:0,r=Math.floor(127*p.opacity);return r*Ai+t*ai+r*Ii+t*wi+r*nr+t*ji+r*Cn+t}const Ur=0;class Os{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,r,l,u,_){const x=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(x,u,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((w,I)=>w.sortKey-I.sortKey));this._currentPartIndex<x.length;)if(r.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,_())return!0;return!1}}class Vo{constructor(t,r,l,u,_,x,w,I){this.placement=new Dt(t,r,x,w,I),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(t,r,l){const u=s.h.now(),_=()=>!this._forceFullPlacement&&s.h.now()-u>2;for(;this._currentPlacementIndex>=0;){const x=r[t[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=w)&&(!x.maxzoom||x.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new Os(x)),this._inProgressLayer.continuePlacement(l[x.source],this.placement,this._showCollisionBoxes,x,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Uo=512/s.N/2;class Rn{constructor(t,r,l){this.tileID=t,this.bucketInstanceId=l,this._symbolsByKey={};const u=new Map;for(let _=0;_<r.length;_++){const x=r.get(_),w=x.key,I=u.get(w);I?I.push(x):u.set(w,[x])}for(const[_,x]of u){const w={positions:x.map(I=>({x:Math.floor(I.anchorX*Uo),y:Math.floor(I.anchorY*Uo)})),crossTileIDs:x.map(I=>I.crossTileID)};if(w.positions.length>128){const I=new s.av(w.positions.length,16,Uint16Array);for(const{x:A,y:L}of w.positions)I.add(A,L);I.finish(),delete w.positions,w.index=I}this._symbolsByKey[_]=w}}getScaledCoordinates(t,r){const{x:l,y:u,z:_}=this.tileID.canonical,{x,y:w,z:I}=r.canonical,A=Uo/Math.pow(2,I-_),L=(w*s.N+t.anchorY)*A,z=u*s.N*Uo;return{x:Math.floor((x*s.N+t.anchorX)*A-l*s.N*Uo),y:Math.floor(L-z)}}findMatches(t,r,l){const u=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let _=0;_<t.length;_++){const x=t.get(_);if(x.crossTileID)continue;const w=this._symbolsByKey[x.key];if(!w)continue;const I=this.getScaledCoordinates(x,r);if(w.index){const A=w.index.range(I.x-u,I.y-u,I.x+u,I.y+u).sort();for(const L of A){const z=w.crossTileIDs[L];if(!l[z]){l[z]=!0,x.crossTileID=z;break}}}else if(w.positions)for(let A=0;A<w.positions.length;A++){const L=w.positions[A],z=w.crossTileIDs[A];if(Math.abs(L.x-I.x)<=u&&Math.abs(L.y-I.y)<=u&&!l[z]){l[z]=!0,x.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class Di{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class pa{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(r!==0)for(const l in this.indexes){const u=this.indexes[l],_={};for(const x in u){const w=u[x];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+r),_[w.tileID.key]=w}this.indexes[l]=_}this.lng=t}addBucket(t,r,l){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<r.symbolInstances.length;_++)r.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const u=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const x=this.indexes[_];if(Number(_)>t.overscaledZ)for(const w in x){const I=x[w];I.tileID.isChildOf(t)&&I.findMatches(r.symbolInstances,t,u)}else{const w=x[t.scaledTo(Number(_)).key];w&&w.findMatches(r.symbolInstances,t,u)}}for(let _=0;_<r.symbolInstances.length;_++){const x=r.symbolInstances.get(_);x.crossTileID||(x.crossTileID=l.generate(),u[x.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Rn(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const l of r.getCrossTileIDsLists())for(const u of l)delete this.usedCrossTileIDs[t][u]}removeStaleBuckets(t){let r=!1;for(const l in this.indexes){const u=this.indexes[l];for(const _ in u)t[u[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,u[_]),delete u[_],r=!0)}return r}}class to{constructor(){this.layerIndexes={},this.crossTileIDs=new Di,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,l){let u=this.layerIndexes[t.id];u===void 0&&(u=this.layerIndexes[t.id]=new pa);let _=!1;const x={};u.handleWrapJump(l);for(const w of r){const I=w.getBucket(t);I&&t.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(w.tileID,I,this.crossTileIDs)&&(_=!0),x[I.bucketInstanceId]=!0)}return u.removeStaleBuckets(x)&&(_=!0),_}pruneUnusedLayers(t){const r={};t.forEach(l=>{r[l]=!0});for(const l in this.layerIndexes)r[l]||delete this.layerIndexes[l]}}const nn=(p,t)=>s.x(p,t&&t.filter(r=>r.identifier!=="source.canvas")),rr=s.F(s.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),cs=s.F(s.ax,["setCenter","setZoom","setBearing","setPitch"]),Un=s.aw();class jn extends s.E{constructor(t,r={}){super(),this.map=t,this.dispatcher=new Pi(as(),this,t._getMapId()),this.imageManager=new Je,this.imageManager.setEventedParent(this),this.glyphManager=new Pt(t._requestManager,r.localIdeographFontFamily),this.lineAtlas=new zn(256,512),this.crossTileSymbolIndex=new to,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.az());const l=this;this._rtlTextPluginCallback=jn.registerForPluginStateChange(u=>{l.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:u.pluginStatus,pluginURL:u.pluginURL},(_,x)=>{if(s.aA(_),x&&x.every(w=>w))for(const w in l.sourceCaches){const I=l.sourceCaches[w].getSource().type;I!=="vector"&&I!=="geojson"||l.sourceCaches[w].reload()}})}),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const _=this.sourceCaches[u.sourceId];if(!_)return;const x=_.getSource();if(x&&x.vectorLayerIds)for(const w in this._layers){const I=this._layers[w];I.source===x.id&&this._validateLayer(I)}})}loadURL(t,r={},l){this.fire(new s.k("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const u=this.map._requestManager.transformRequest(t,Te.Style);this._request=s.f(u,(_,x)=>{this._request=null,_?this.fire(new s.j(_)):x&&this._load(x,r,l)})}loadJSON(t,r={},l){this.fire(new s.k("dataloading",{dataType:"style"})),this._request=s.h.frame(()=>{this._request=null,r.validate=r.validate!==!1,this._load(t,r,l)})}loadEmpty(){this.fire(new s.k("dataloading",{dataType:"style"})),this._load(Un,{validate:!1})}_load(t,r,l){var u;const _=r.transformStyle?r.transformStyle(l,t):t;if(!r.validate||!nn(this,s.y(_))){this._loaded=!0,this.stylesheet=_;for(const x in _.sources)this.addSource(x,_.sources[x],{validate:!1});_.sprite?this._loadSprite(_.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(_.glyphs),this._createLayers(),this.light=new Ln(this.stylesheet.light),this.map.setTerrain((u=this.stylesheet.terrain)!==null&&u!==void 0?u:null),this.fire(new s.k("data",{dataType:"style"})),this.fire(new s.k("style.load"))}}_createLayers(){const t=s.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(r=>r.id),this._layers={},this._serializedLayers=null;for(const r of t){const l=s.aC(r);l.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=l}}_loadSprite(t,r=!1,l=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(u,_,x,w){const I=zt(u),A=I.length,L=x>1?"@2x":"",z={},N={},X={};for(const{id:H,url:J}of I){const G=_.transformRequest(_.normalizeSpriteURL(J,L,".json"),Te.SpriteJSON),ue=`${H}_${G.url}`;z[ue]=s.f(G,(de,Ie)=>{delete z[ue],N[H]=Ie,wt(w,N,X,de,A)});const we=_.transformRequest(_.normalizeSpriteURL(J,L,".png"),Te.SpriteImage),te=`${H}_${we.url}`;z[te]=fe.getImage(we,(de,Ie)=>{delete z[te],X[H]=Ie,wt(w,N,X,de,A)})}return{cancel(){for(const H of Object.values(z))H.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),(u,_)=>{if(this._spriteRequest=null,u)this.fire(new s.j(u));else if(_)for(const x in _){this._spritesImagesIds[x]=[];const w=this._spritesImagesIds[x]?this._spritesImagesIds[x].filter(I=>!(I in _)):[];for(const I of w)this.imageManager.removeImage(I),this._changedImages[I]=!0;for(const I in _[x]){const A=x==="default"?I:`${x}:${I}`;this._spritesImagesIds[x].push(A),A in this.imageManager.images?this.imageManager.updateImage(A,_[x][I],!1):this.imageManager.addImage(A,_[x][I]),r&&(this._changedImages[A]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"})),l&&l(u)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}_validateLayer(t){const r=this.sourceCaches[t.source];if(!r)return;const l=t.sourceLayer;if(!l)return;const u=r.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(l)===-1)&&this.fire(new s.j(new Error(`Source layer "${l}" does not exist on source "${u.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const r=this._serializedAllLayers();if(!t||t.length===0)return Object.values(r);const l=[];for(const u of t)r[u]&&l.push(r[u]);return l}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const r=Object.keys(this._layers);for(const l of r){const u=this._layers[l];u.type!=="custom"&&(t[l]=u.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const r=this._changed;if(this._changed){const u=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(u.length||_.length)&&this._updateWorkerLayers(u,_);for(const x in this._updatedSources){const w=this._updatedSources[x];if(w==="reload")this._reloadSource(x);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(x)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const l={};for(const u in this.sourceCaches){const _=this.sourceCaches[u];l[u]=_.used,_.used=!1}for(const u of this._order){const _=this._layers[u];_.recalculate(t,this._availableImages),!_.isHidden(t.zoom)&&_.source&&(this.sourceCaches[_.source].used=!0)}for(const u in l){const _=this.sourceCaches[u];l[u]!==_.used&&_.fire(new s.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(t),this.z=t.zoom,r&&this.fire(new s.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,r){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,r={}){this._checkLoaded();const l=this.serialize();if(t=r.transformStyle?r.transformStyle(l,t):t,nn(this,s.y(t)))return!1;(t=s.aD(t)).layers=s.aB(t.layers);const u=s.aE(l,t).filter(x=>!(x.command in cs));if(u.length===0)return!1;const _=u.filter(x=>!(x.command in rr));if(_.length>0)throw new Error(`Unimplemented: ${_.map(x=>x.command).join(", ")}.`);for(const x of u)x.command!=="setTransition"&&this[x.command].apply(this,x.args);return this.stylesheet=t,this._serializedLayers=null,!0}addImage(t,r){if(this.getImage(t))return this.fire(new s.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,r),this._afterImageUpdated(t)}updateImage(t,r){this.imageManager.updateImage(t,r)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new s.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,r,l={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(s.y.source,`sources.${t}`,r,null,l))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const u=this.sourceCaches[t]=new tn(t,r,this.dispatcher);u.style=this,u.setEventedParent(this,()=>({isSourceLoaded:u.loaded(),source:u.serialize(),sourceId:t})),u.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===t)return this.fire(new s.j(new Error(`Source "${t}" cannot be removed while layer "${l}" is using it.`)));const r=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],r.fire(new s.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,r){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const l=this.sourceCaches[t].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(r),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,r,l={}){this._checkLoaded();const u=t.id;if(this.getLayer(u))return void this.fire(new s.j(new Error(`Layer "${u}" already exists on this map.`)));let _;if(t.type==="custom"){if(nn(this,s.aF(t)))return;_=s.aC(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(u,t.source),t=s.aD(t),t=s.e(t,{source:u})),this._validate(s.y.layer,`layers.${u}`,t,{arrayIndex:-1},l))return;_=s.aC(t),this._validateLayer(_),_.setEventedParent(this,{layer:{id:u}})}const x=r?this._order.indexOf(r):this._order.length;if(r&&x===-1)this.fire(new s.j(new Error(`Cannot add layer "${u}" before non-existing layer "${r}".`)));else{if(this._order.splice(x,0,u),this._layerOrderChanged=!0,this._layers[u]=_,this._removedLayers[u]&&_.source&&_.type!=="custom"){const w=this._removedLayers[u];delete this._removedLayers[u],w.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.sourceCaches[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(t,r){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new s.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===r)return;const l=this._order.indexOf(t);this._order.splice(l,1);const u=r?this._order.indexOf(r):this._order.length;r&&u===-1?this.fire(new s.j(new Error(`Cannot move layer "${t}" before non-existing layer "${r}".`))):(this._order.splice(u,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const r=this._layers[t];if(!r)return void this.fire(new s.j(new Error(`Cannot remove non-existing layer "${t}".`)));r.setEventedParent(null);const l=this._order.indexOf(t);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=r,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],r.onRemove&&r.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,r,l){this._checkLoaded();const u=this.getLayer(t);u?u.minzoom===r&&u.maxzoom===l||(r!=null&&(u.minzoom=r),l!=null&&(u.maxzoom=l),this._updateLayer(u)):this.fire(new s.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,r,l={}){this._checkLoaded();const u=this.getLayer(t);if(u){if(!s.aG(u.filter,r))return r==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(s.y.filter,`layers.${u.id}.filter`,r,null,l)||(u.filter=s.aD(r),this._updateLayer(u)))}else this.fire(new s.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return s.aD(this.getLayer(t).filter)}setLayoutProperty(t,r,l,u={}){this._checkLoaded();const _=this.getLayer(t);_?s.aG(_.getLayoutProperty(r),l)||(_.setLayoutProperty(r,l,u),this._updateLayer(_)):this.fire(new s.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,r){const l=this.getLayer(t);if(l)return l.getLayoutProperty(r);this.fire(new s.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,r,l,u={}){this._checkLoaded();const _=this.getLayer(t);_?s.aG(_.getPaintProperty(r),l)||(_.setPaintProperty(r,l,u)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new s.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,r){return this.getLayer(t).getPaintProperty(r)}setFeatureState(t,r){this._checkLoaded();const l=t.source,u=t.sourceLayer,_=this.sourceCaches[l];if(_===void 0)return void this.fire(new s.j(new Error(`The source '${l}' does not exist in the map's style.`)));const x=_.getSource().type;x==="geojson"&&u?this.fire(new s.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||u?(t.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),_.setFeatureState(u,t.id,r)):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,r){this._checkLoaded();const l=t.source,u=this.sourceCaches[l];if(u===void 0)return void this.fire(new s.j(new Error(`The source '${l}' does not exist in the map's style.`)));const _=u.getSource().type,x=_==="vector"?t.sourceLayer:void 0;_!=="vector"||x?r&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new s.j(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(x,t.id,r):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const r=t.source,l=t.sourceLayer,u=this.sourceCaches[r];if(u!==void 0)return u.getSource().type!=="vector"||l?(t.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),u.getFeatureState(l,t.id)):void this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.j(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=s.aH(this.sourceCaches,_=>_.serialize()),r=this._serializeByIds(this._order),l=this.map.getTerrain()||void 0,u=this.stylesheet;return s.aI({version:u.version,name:u.name,metadata:u.metadata,light:u.light,center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,sprite:u.sprite,glyphs:u.glyphs,transition:u.transition,sources:t,layers:r,terrain:l},_=>_!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const r=x=>this._layers[x].type==="fill-extrusion",l={},u=[];for(let x=this._order.length-1;x>=0;x--){const w=this._order[x];if(r(w)){l[w]=x;for(const I of t){const A=I[w];if(A)for(const L of A)u.push(L)}}}u.sort((x,w)=>w.intersectionZ-x.intersectionZ);const _=[];for(let x=this._order.length-1;x>=0;x--){const w=this._order[x];if(r(w))for(let I=u.length-1;I>=0;I--){const A=u[I].feature;if(l[A.layer.id]<x)break;_.push(A),u.pop()}else for(const I of t){const A=I[w];if(A)for(const L of A)_.push(L.feature)}}return _}queryRenderedFeatures(t,r,l){r&&r.filter&&this._validate(s.y.filter,"queryRenderedFeatures.filter",r.filter,null,r);const u={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new s.j(new Error("parameters.layers must be an Array."))),[];for(const w of r.layers){const I=this._layers[w];if(!I)return this.fire(new s.j(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];u[I.source]=!0}}const _=[];r.availableImages=this._availableImages;const x=this._serializedAllLayers();for(const w in this.sourceCaches)r.layers&&!u[w]||_.push(xi(this.sourceCaches[w],this._layers,x,t,r,l));return this.placement&&_.push(function(w,I,A,L,z,N,X){const H={},J=N.queryRenderedSymbols(L),G=[];for(const ue of Object.keys(J).map(Number))G.push(X[ue]);G.sort(_r);for(const ue of G){const we=ue.featureIndex.lookupSymbolFeatures(J[ue.bucketInstanceId],I,ue.bucketIndex,ue.sourceLayerIndex,z.filter,z.layers,z.availableImages,w);for(const te in we){const de=H[te]=H[te]||[],Ie=we[te];Ie.sort((Ce,Oe)=>{const We=ue.featureSortOrder;if(We){const Ue=We.indexOf(Ce.featureIndex);return We.indexOf(Oe.featureIndex)-Ue}return Oe.featureIndex-Ce.featureIndex});for(const Ce of Ie)de.push(Ce)}}for(const ue in H)H[ue].forEach(we=>{const te=we.feature,de=A[w[ue].source].getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=de});return H}(this._layers,x,this.sourceCaches,t,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(t,r){r&&r.filter&&this._validate(s.y.filter,"querySourceFeatures.filter",r.filter,null,r);const l=this.sourceCaches[t];return l?function(u,_){const x=u.getRenderableIds().map(A=>u.getTileByID(A)),w=[],I={};for(let A=0;A<x.length;A++){const L=x[A],z=L.tileID.canonical.key;I[z]||(I[z]=!0,L.querySourceFeatures(w,_))}return w}(l,r):[]}addSourceType(t,r,l){return Ui(t)?l(new Error(`A source type called "${t}" already exists.`)):(((u,_)=>{Ze[u]=_})(t,r),r.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:r.workerSourceURL},l):l(null,null))}getLight(){return this.light.getLight()}setLight(t,r={}){this._checkLoaded();const l=this.light.getLight();let u=!1;for(const x in t)if(!s.aG(t[x],l[x])){u=!0;break}if(!u)return;const _={now:s.h.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,r),this.light.updateTransitions(_)}_validate(t,r,l,u,_={}){return(!_||_.validate!==!1)&&nn(this,t.call(s.y,s.e({key:r,style:this.serialize(),value:l,styleSpec:s.v},u)))}_remove(t=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.sourceCaches){const l=this.sourceCaches[r];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const r in this.sourceCaches)this.sourceCaches[r].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,r,l,u,_=!1){let x=!1,w=!1;const I={};for(const A of this._order){const L=this._layers[A];if(L.type!=="symbol")continue;if(!I[L.source]){const N=this.sourceCaches[L.source];I[L.source]=N.getRenderableIds(!0).map(X=>N.getTileByID(X)).sort((X,H)=>H.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan(H.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(L,I[L.source],t.center.lng);x=x||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.h.now(),t.zoom))&&(this.pauseablePlacement=new Vo(t,this.map.terrain,this._order,_,r,l,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.h.now()),w=!0),x&&this.pauseablePlacement.placement.setStale()),w||x)for(const A of this._order){const L=this._layers[A];L.type==="symbol"&&this.placement.updateLayerOpacities(L,I[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.h.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,r,l){this.imageManager.getImages(r.icons,l),this._updateTilesForChangedImages();const u=this.sourceCaches[r.source];u&&u.setDependencies(r.tileID.key,r.type,r.icons)}getGlyphs(t,r,l){this.glyphManager.getGlyphs(r.stacks,l);const u=this.sourceCaches[r.source];u&&u.setDependencies(r.tileID.key,r.type,[""])}getResource(t,r,l){return s.m(r,l)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,r={}){this._checkLoaded(),t&&this._validate(s.y.glyphs,"glyphs",t,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,r,l={},u){this._checkLoaded();const _=[{id:t,url:r}],x=[...zt(this.stylesheet.sprite),..._];this._validate(s.y.sprite,"sprite",x,null,l)||(this.stylesheet.sprite=x,this._loadSprite(_,!0,u))}removeSprite(t){this._checkLoaded();const r=zt(this.stylesheet.sprite);if(r.find(l=>l.id===t)){if(this._spritesImagesIds[t])for(const l of this._spritesImagesIds[t])this.imageManager.removeImage(l),this._changedImages[l]=!0;r.splice(r.findIndex(l=>l.id===t),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}else this.fire(new s.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return zt(this.stylesheet.sprite)}setSprite(t,r={},l){this._checkLoaded(),t&&this._validate(s.y.sprite,"sprite",t,null,r)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,l):(this._unloadSprite(),l&&l(null)))}}jn.registerForPluginStateChange=s.aK;var fa=s.Q([{name:"a_pos",type:"Int16",components:2}]),ws="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const on={prelude:Ei(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ei(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ei(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ei(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ei("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ei(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ei(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ei("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ei("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ei("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ei(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ei(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ei(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ei(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ei(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ei(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ei(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ei(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ei(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ei(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ei(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ei(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ei(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ei(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ei(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ei(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ei("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",ws),terrainDepth:Ei("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",ws),terrainCoords:Ei("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",ws)};function Ei(p,t){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=t.match(/attribute ([\w]+) ([\w]+)/g),u=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=_?_.concat(u):u,w={};return{fragmentSource:p=p.replace(r,(I,A,L,z,N)=>(w[N]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${N}
varying ${L} ${z} ${N};
#else
uniform ${L} ${z} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${L} ${z} ${N} = u_${N};
#endif
`)),vertexSource:t=t.replace(r,(I,A,L,z,N)=>{const X=z==="float"?"vec2":"vec4",H=N.match(/color/)?"color":X;return w[N]?A==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${L} ${X} a_${N};
varying ${L} ${z} ${N};
#else
uniform ${L} ${z} u_${N};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${L} ${z} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${H}(a_${N}, u_${N}_t);
#else
    ${L} ${z} ${N} = u_${N};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${L} ${X} a_${N};
#else
uniform ${L} ${z} u_${N};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${L} ${z} ${N} = a_${N};
#else
    ${L} ${z} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${L} ${z} ${N} = unpack_mix_${H}(a_${N}, u_${N}_t);
#else
    ${L} ${z} ${N} = u_${N};
#endif
`}),staticAttributes:l,staticUniforms:x}}class Mo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,r,l,u,_,x,w,I,A){this.context=t;let L=this.boundPaintVertexBuffers.length!==u.length;for(let z=0;!L&&z<u.length;z++)this.boundPaintVertexBuffers[z]!==u[z]&&(L=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==l||L||this.boundIndexBuffer!==_||this.boundVertexOffset!==x||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==I||this.boundDynamicVertexBuffer3!==A?this.freshBind(r,l,u,_,x,w,I,A):(t.bindVertexArray.set(this.vao),w&&w.bind(),_&&_.dynamicDraw&&_.bind(),I&&I.bind(),A&&A.bind())}freshBind(t,r,l,u,_,x,w,I){const A=t.numAttributes,L=this.context,z=L.gl;this.vao&&this.destroy(),this.vao=L.createVertexArray(),L.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=u,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=I,r.enableAttributes(z,t);for(const N of l)N.enableAttributes(z,t);x&&x.enableAttributes(z,t),w&&w.enableAttributes(z,t),I&&I.enableAttributes(z,t),r.bind(),r.setVertexAttribPointers(z,t,_);for(const N of l)N.bind(),N.setVertexAttribPointers(z,t,_);x&&(x.bind(),x.setVertexAttribPointers(z,t,_)),u&&u.bind(),w&&(w.bind(),w.setVertexAttribPointers(z,t,_)),I&&(I.bind(),I.setVertexAttribPointers(z,t,_)),L.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function sn(p){const t=[];for(let r=0;r<p.length;r++){if(p[r]===null)continue;const l=p[r].split(" ");t.push(l.pop())}return t}class Bs{constructor(t,r,l,u,_,x){const w=t.gl;this.program=w.createProgram();const I=sn(r.staticAttributes),A=l?l.getBinderAttributes():[],L=I.concat(A),z=on.prelude.staticUniforms?sn(on.prelude.staticUniforms):[],N=r.staticUniforms?sn(r.staticUniforms):[],X=l?l.getBinderUniforms():[],H=z.concat(N).concat(X),J=[];for(const Ce of H)J.indexOf(Ce)<0&&J.push(Ce);const G=l?l.defines():[];_&&G.push("#define OVERDRAW_INSPECTOR;"),x&&G.push("#define TERRAIN3D;");const ue=G.concat(on.prelude.fragmentSource,r.fragmentSource).join(`
`),we=G.concat(on.prelude.vertexSource,r.vertexSource).join(`
`),te=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(te,ue),w.compileShader(te),!w.getShaderParameter(te,w.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${w.getShaderInfoLog(te)}`);w.attachShader(this.program,te);const de=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(de,we),w.compileShader(de),!w.getShaderParameter(de,w.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${w.getShaderInfoLog(de)}`);w.attachShader(this.program,de),this.attributes={};const Ie={};this.numAttributes=L.length;for(let Ce=0;Ce<this.numAttributes;Ce++)L[Ce]&&(w.bindAttribLocation(this.program,Ce,L[Ce]),this.attributes[L[Ce]]=Ce);if(w.linkProgram(this.program),!w.getProgramParameter(this.program,w.LINK_STATUS))throw new Error(`Program failed to link: ${w.getProgramInfoLog(this.program)}`);w.deleteShader(de),w.deleteShader(te);for(let Ce=0;Ce<J.length;Ce++){const Oe=J[Ce];if(Oe&&!Ie[Oe]){const We=w.getUniformLocation(this.program,Oe);We&&(Ie[Oe]=We)}}this.fixedUniforms=u(t,Ie),this.terrainUniforms=((Ce,Oe)=>({u_depth:new s.aL(Ce,Oe.u_depth),u_terrain:new s.aL(Ce,Oe.u_terrain),u_terrain_dim:new s.aM(Ce,Oe.u_terrain_dim),u_terrain_matrix:new s.aN(Ce,Oe.u_terrain_matrix),u_terrain_unpack:new s.aO(Ce,Oe.u_terrain_unpack),u_terrain_exaggeration:new s.aM(Ce,Oe.u_terrain_exaggeration)}))(t,Ie),this.binderUniforms=l?l.getUniforms(t,Ie):[]}draw(t,r,l,u,_,x,w,I,A,L,z,N,X,H,J,G,ue,we){const te=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(l),t.setStencilMode(u),t.setColorMode(_),t.setCullFace(x),I){t.activeTexture.set(te.TEXTURE2),te.bindTexture(te.TEXTURE_2D,I.depthTexture),t.activeTexture.set(te.TEXTURE3),te.bindTexture(te.TEXTURE_2D,I.texture);for(const Ie in this.terrainUniforms)this.terrainUniforms[Ie].set(I[Ie])}for(const Ie in this.fixedUniforms)this.fixedUniforms[Ie].set(w[Ie]);J&&J.setUniforms(t,this.binderUniforms,X,{zoom:H});let de=0;switch(r){case te.LINES:de=2;break;case te.TRIANGLES:de=3;break;case te.LINE_STRIP:de=1}for(const Ie of N.get()){const Ce=Ie.vaos||(Ie.vaos={});(Ce[A]||(Ce[A]=new Mo)).bind(t,this,L,J?J.getPaintVertexBuffers():[],z,Ie.vertexOffset,G,ue,we),te.drawElements(r,Ie.primitiveLength*de,te.UNSIGNED_SHORT,Ie.primitiveOffset*de*2)}}}function jr(p,t,r){const l=1/ae(r,1,t.transform.tileZoom),u=Math.pow(2,r.tileID.overscaledZ),_=r.tileSize*Math.pow(2,t.transform.tileZoom)/u,x=_*(r.tileID.canonical.x+r.tileID.wrap*u),w=_*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[l,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w]}}const Ka=(p,t,r,l)=>{const u=t.style.light,_=u.properties.get("position"),x=[_.x,_.y,_.z],w=function(){var A=new s.A(9);return s.A!=Float32Array&&(A[1]=0,A[2]=0,A[3]=0,A[5]=0,A[6]=0,A[7]=0),A[0]=1,A[4]=1,A[8]=1,A}();u.properties.get("anchor")==="viewport"&&function(A,L){var z=Math.sin(L),N=Math.cos(L);A[0]=N,A[1]=z,A[2]=0,A[3]=-z,A[4]=N,A[5]=0,A[6]=0,A[7]=0,A[8]=1}(w,-t.transform.angle),function(A,L,z){var N=L[0],X=L[1],H=L[2];A[0]=N*z[0]+X*z[3]+H*z[6],A[1]=N*z[1]+X*z[4]+H*z[7],A[2]=N*z[2]+X*z[5]+H*z[8]}(x,x,w);const I=u.properties.get("color");return{u_matrix:p,u_lightpos:x,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[I.r,I.g,I.b],u_vertical_gradient:+r,u_opacity:l}},jo=(p,t,r,l,u,_,x)=>s.e(Ka(p,t,r,l),jr(_,t,x),{u_height_factor:-Math.pow(2,u.overscaledZ)/x.tileSize/8}),Ns=p=>({u_matrix:p}),v=(p,t,r,l)=>s.e(Ns(p),jr(r,t,l)),E=(p,t)=>({u_matrix:p,u_world:t}),V=(p,t,r,l,u)=>s.e(v(p,t,r,l),{u_world:u}),Q=(p,t,r,l)=>{const u=p.transform;let _,x;if(l.paint.get("circle-pitch-alignment")==="map"){const w=ae(r,1,u.zoom);_=!0,x=[w,w]}else _=!1,x=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_matrix:p.translatePosMatrix(t.posMatrix,r,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_pitch_with_map:+_,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:x}},se=(p,t,r)=>{const l=ae(r,1,t.zoom),u=Math.pow(2,t.zoom-r.tileID.overscaledZ),_=r.tileID.overscaleFactor();return{u_matrix:p,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:l,u_extrude_scale:[t.pixelsToGLUnits[0]/(l*u),t.pixelsToGLUnits[1]/(l*u)],u_overscale_factor:_}},le=(p,t,r=1)=>({u_matrix:p,u_color:t,u_overlay:0,u_overlay_scale:r}),be=p=>({u_matrix:p}),Ge=(p,t,r,l)=>({u_matrix:p,u_extrude_scale:ae(t,1,r),u_intensity:l});function Qe(p,t){const r=Math.pow(2,t.canonical.z),l=t.canonical.y;return[new s.U(0,l/r).toLngLat().lat,new s.U(0,(l+1)/r).toLngLat().lat]}const dt=(p,t,r,l)=>{const u=p.transform;return{u_matrix:ri(p,t,r,l),u_ratio:1/ae(t,1,u.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},ft=(p,t,r,l,u)=>s.e(dt(p,t,r,u),{u_image:0,u_image_height:l}),at=(p,t,r,l,u)=>{const _=p.transform,x=an(t,_);return{u_matrix:ri(p,t,r,u),u_texsize:t.imageAtlasTexture.size,u_ratio:1/ae(t,1,_.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[x,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},ii=(p,t,r,l,u,_)=>{const x=p.lineAtlas,w=an(t,p.transform),I=r.layout.get("line-cap")==="round",A=x.getDash(l.from,I),L=x.getDash(l.to,I),z=A.width*u.fromScale,N=L.width*u.toScale;return s.e(dt(p,t,r,_),{u_patternscale_a:[w/z,-A.height/2],u_patternscale_b:[w/N,-L.height/2],u_sdfgamma:x.width/(256*Math.min(z,N)*p.pixelRatio)/2,u_image:0,u_tex_y_a:A.y,u_tex_y_b:L.y,u_mix:u.t})};function an(p,t){return 1/ae(p,1,t.tileZoom)}function ri(p,t,r,l){return p.translatePosMatrix(l?l.posMatrix:t.tileID.posMatrix,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const Sn=(p,t,r,l,u)=>{return{u_matrix:p,u_tl_parent:t,u_scale_parent:r,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(x=u.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(_=u.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:Ne(u.paint.get("raster-hue-rotate"))};var _,x};function Ne(p){p*=Math.PI/180;const t=Math.sin(p),r=Math.cos(p);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const kt=(p,t,r,l,u,_,x,w,I,A)=>{const L=u.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:L.cameraToCenterDistance,u_pitch:L.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:L.width/L.height,u_fade_change:u.options.fadeDuration?u.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:x,u_coord_matrix:w,u_is_text:+I,u_pitch_with_map:+l,u_texsize:A,u_texture:0}},Fi=(p,t,r,l,u,_,x,w,I,A,L)=>{const z=u.transform;return s.e(kt(p,t,r,l,u,_,x,w,I,A),{u_gamma_scale:l?Math.cos(z._pitch)*z.cameraToCenterDistance:1,u_device_pixel_ratio:u.pixelRatio,u_is_halo:+L})},ln=(p,t,r,l,u,_,x,w,I,A)=>s.e(Fi(p,t,r,l,u,_,x,w,!0,I,!0),{u_texsize_icon:A,u_texture_icon:1}),_n=(p,t,r)=>({u_matrix:p,u_opacity:t,u_color:r}),yr=(p,t,r,l,u,_)=>s.e(function(x,w,I,A){const L=I.imageManager.getPattern(x.from.toString()),z=I.imageManager.getPattern(x.to.toString()),{width:N,height:X}=I.imageManager.getPixelSize(),H=Math.pow(2,A.tileID.overscaledZ),J=A.tileSize*Math.pow(2,I.transform.tileZoom)/H,G=J*(A.tileID.canonical.x+A.tileID.wrap*H),ue=J*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:L.tl,u_pattern_br_a:L.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[N,X],u_mix:w.t,u_pattern_size_a:L.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/ae(A,1,I.transform.tileZoom),u_pixel_coord_upper:[G>>16,ue>>16],u_pixel_coord_lower:[65535&G,65535&ue]}}(l,_,r,u),{u_matrix:p,u_opacity:t}),ma={fillExtrusion:(p,t)=>({u_matrix:new s.aN(p,t.u_matrix),u_lightpos:new s.aP(p,t.u_lightpos),u_lightintensity:new s.aM(p,t.u_lightintensity),u_lightcolor:new s.aP(p,t.u_lightcolor),u_vertical_gradient:new s.aM(p,t.u_vertical_gradient),u_opacity:new s.aM(p,t.u_opacity)}),fillExtrusionPattern:(p,t)=>({u_matrix:new s.aN(p,t.u_matrix),u_lightpos:new s.aP(p,t.u_lightpos),u_lightintensity:new s.aM(p,t.u_lightintensity),u_lightcolor:new s.aP(p,t.u_lightcolor),u_vertical_gradient:new s.aM(p,t.u_vertical_gradient),u_height_factor:new s.aM(p,t.u_height_factor),u_image:new s.aL(p,t.u_image),u_texsize:new s.aQ(p,t.u_texsize),u_pixel_coord_upper:new s.aQ(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(p,t.u_pixel_coord_lower),u_scale:new s.aP(p,t.u_scale),u_fade:new s.aM(p,t.u_fade),u_opacity:new s.aM(p,t.u_opacity)}),fill:(p,t)=>({u_matrix:new s.aN(p,t.u_matrix)}),fillPattern:(p,t)=>({u_matrix:new s.aN(p,t.u_matrix),u_image:new s.aL(p,t.u_image),u_texsize:new s.aQ(p,t.u_texsize),u_pixel_coord_upper:new s.aQ(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(p,t.u_pixel_coord_lower),u_scale:new s.aP(p,t.u_scale),u_fade:new s.aM(p,t.u_fade)}),fillOutline:(p,t)=>({u_matrix:new s.aN(p,t.u_matrix),u_world:new s.aQ(p,t.u_world)}),fillOutlinePattern:(p,t)=>({u_matrix:new s.aN(p,t.u_matrix),u_world:new s.aQ(p,t.u_world),u_image:new s.aL(p,t.u_image),u_texsize:new s.aQ(p,t.u_texsize),u_pixel_coord_upper:new s.aQ(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(p,t.u_pixel_coord_lower),u_scale:new s.aP(p,t.u_scale),u_fade:new s.aM(p,t.u_fade)}),circle:(p,t)=>({u_camera_to_center_distance:new s.aM(p,t.u_camera_to_center_distance),u_scale_with_map:new s.aL(p,t.u_scale_with_map),u_pitch_with_map:new s.aL(p,t.u_pitch_with_map),u_extrude_scale:new s.aQ(p,t.u_extrude_scale),u_device_pixel_ratio:new s.aM(p,t.u_device_pixel_ratio),u_matrix:new s.aN(p,t.u_matrix)}),collisionBox:(p,t)=>({u_matrix:new s.aN(p,t.u_matrix),u_camera_to_center_distance:new s.aM(p,t.u_camera_to_center_distance),u_pixels_to_tile_units:new s.aM(p,t.u_pixels_to_tile_units),u_extrude_scale:new s.aQ(p,t.u_extrude_scale),u_overscale_factor:new s.aM(p,t.u_overscale_factor)}),collisionCircle:(p,t)=>({u_matrix:new s.aN(p,t.u_matrix),u_inv_matrix:new s.aN(p,t.u_inv_matrix),u_camera_to_center_distance:new s.aM(p,t.u_camera_to_center_distance),u_viewport_size:new s.aQ(p,t.u_viewport_size)}),debug:(p,t)=>({u_color:new s.aR(p,t.u_color),u_matrix:new s.aN(p,t.u_matrix),u_overlay:new s.aL(p,t.u_overlay),u_overlay_scale:new s.aM(p,t.u_overlay_scale)}),clippingMask:(p,t)=>({u_matrix:new s.aN(p,t.u_matrix)}),heatmap:(p,t)=>({u_extrude_scale:new s.aM(p,t.u_extrude_scale),u_intensity:new s.aM(p,t.u_intensity),u_matrix:new s.aN(p,t.u_matrix)}),heatmapTexture:(p,t)=>({u_matrix:new s.aN(p,t.u_matrix),u_world:new s.aQ(p,t.u_world),u_image:new s.aL(p,t.u_image),u_color_ramp:new s.aL(p,t.u_color_ramp),u_opacity:new s.aM(p,t.u_opacity)}),hillshade:(p,t)=>({u_matrix:new s.aN(p,t.u_matrix),u_image:new s.aL(p,t.u_image),u_latrange:new s.aQ(p,t.u_latrange),u_light:new s.aQ(p,t.u_light),u_shadow:new s.aR(p,t.u_shadow),u_highlight:new s.aR(p,t.u_highlight),u_accent:new s.aR(p,t.u_accent)}),hillshadePrepare:(p,t)=>({u_matrix:new s.aN(p,t.u_matrix),u_image:new s.aL(p,t.u_image),u_dimension:new s.aQ(p,t.u_dimension),u_zoom:new s.aM(p,t.u_zoom),u_unpack:new s.aO(p,t.u_unpack)}),line:(p,t)=>({u_matrix:new s.aN(p,t.u_matrix),u_ratio:new s.aM(p,t.u_ratio),u_device_pixel_ratio:new s.aM(p,t.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(p,t.u_units_to_pixels)}),lineGradient:(p,t)=>({u_matrix:new s.aN(p,t.u_matrix),u_ratio:new s.aM(p,t.u_ratio),u_device_pixel_ratio:new s.aM(p,t.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(p,t.u_units_to_pixels),u_image:new s.aL(p,t.u_image),u_image_height:new s.aM(p,t.u_image_height)}),linePattern:(p,t)=>({u_matrix:new s.aN(p,t.u_matrix),u_texsize:new s.aQ(p,t.u_texsize),u_ratio:new s.aM(p,t.u_ratio),u_device_pixel_ratio:new s.aM(p,t.u_device_pixel_ratio),u_image:new s.aL(p,t.u_image),u_units_to_pixels:new s.aQ(p,t.u_units_to_pixels),u_scale:new s.aP(p,t.u_scale),u_fade:new s.aM(p,t.u_fade)}),lineSDF:(p,t)=>({u_matrix:new s.aN(p,t.u_matrix),u_ratio:new s.aM(p,t.u_ratio),u_device_pixel_ratio:new s.aM(p,t.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(p,t.u_units_to_pixels),u_patternscale_a:new s.aQ(p,t.u_patternscale_a),u_patternscale_b:new s.aQ(p,t.u_patternscale_b),u_sdfgamma:new s.aM(p,t.u_sdfgamma),u_image:new s.aL(p,t.u_image),u_tex_y_a:new s.aM(p,t.u_tex_y_a),u_tex_y_b:new s.aM(p,t.u_tex_y_b),u_mix:new s.aM(p,t.u_mix)}),raster:(p,t)=>({u_matrix:new s.aN(p,t.u_matrix),u_tl_parent:new s.aQ(p,t.u_tl_parent),u_scale_parent:new s.aM(p,t.u_scale_parent),u_buffer_scale:new s.aM(p,t.u_buffer_scale),u_fade_t:new s.aM(p,t.u_fade_t),u_opacity:new s.aM(p,t.u_opacity),u_image0:new s.aL(p,t.u_image0),u_image1:new s.aL(p,t.u_image1),u_brightness_low:new s.aM(p,t.u_brightness_low),u_brightness_high:new s.aM(p,t.u_brightness_high),u_saturation_factor:new s.aM(p,t.u_saturation_factor),u_contrast_factor:new s.aM(p,t.u_contrast_factor),u_spin_weights:new s.aP(p,t.u_spin_weights)}),symbolIcon:(p,t)=>({u_is_size_zoom_constant:new s.aL(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(p,t.u_is_size_feature_constant),u_size_t:new s.aM(p,t.u_size_t),u_size:new s.aM(p,t.u_size),u_camera_to_center_distance:new s.aM(p,t.u_camera_to_center_distance),u_pitch:new s.aM(p,t.u_pitch),u_rotate_symbol:new s.aL(p,t.u_rotate_symbol),u_aspect_ratio:new s.aM(p,t.u_aspect_ratio),u_fade_change:new s.aM(p,t.u_fade_change),u_matrix:new s.aN(p,t.u_matrix),u_label_plane_matrix:new s.aN(p,t.u_label_plane_matrix),u_coord_matrix:new s.aN(p,t.u_coord_matrix),u_is_text:new s.aL(p,t.u_is_text),u_pitch_with_map:new s.aL(p,t.u_pitch_with_map),u_texsize:new s.aQ(p,t.u_texsize),u_texture:new s.aL(p,t.u_texture)}),symbolSDF:(p,t)=>({u_is_size_zoom_constant:new s.aL(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(p,t.u_is_size_feature_constant),u_size_t:new s.aM(p,t.u_size_t),u_size:new s.aM(p,t.u_size),u_camera_to_center_distance:new s.aM(p,t.u_camera_to_center_distance),u_pitch:new s.aM(p,t.u_pitch),u_rotate_symbol:new s.aL(p,t.u_rotate_symbol),u_aspect_ratio:new s.aM(p,t.u_aspect_ratio),u_fade_change:new s.aM(p,t.u_fade_change),u_matrix:new s.aN(p,t.u_matrix),u_label_plane_matrix:new s.aN(p,t.u_label_plane_matrix),u_coord_matrix:new s.aN(p,t.u_coord_matrix),u_is_text:new s.aL(p,t.u_is_text),u_pitch_with_map:new s.aL(p,t.u_pitch_with_map),u_texsize:new s.aQ(p,t.u_texsize),u_texture:new s.aL(p,t.u_texture),u_gamma_scale:new s.aM(p,t.u_gamma_scale),u_device_pixel_ratio:new s.aM(p,t.u_device_pixel_ratio),u_is_halo:new s.aL(p,t.u_is_halo)}),symbolTextAndIcon:(p,t)=>({u_is_size_zoom_constant:new s.aL(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(p,t.u_is_size_feature_constant),u_size_t:new s.aM(p,t.u_size_t),u_size:new s.aM(p,t.u_size),u_camera_to_center_distance:new s.aM(p,t.u_camera_to_center_distance),u_pitch:new s.aM(p,t.u_pitch),u_rotate_symbol:new s.aL(p,t.u_rotate_symbol),u_aspect_ratio:new s.aM(p,t.u_aspect_ratio),u_fade_change:new s.aM(p,t.u_fade_change),u_matrix:new s.aN(p,t.u_matrix),u_label_plane_matrix:new s.aN(p,t.u_label_plane_matrix),u_coord_matrix:new s.aN(p,t.u_coord_matrix),u_is_text:new s.aL(p,t.u_is_text),u_pitch_with_map:new s.aL(p,t.u_pitch_with_map),u_texsize:new s.aQ(p,t.u_texsize),u_texsize_icon:new s.aQ(p,t.u_texsize_icon),u_texture:new s.aL(p,t.u_texture),u_texture_icon:new s.aL(p,t.u_texture_icon),u_gamma_scale:new s.aM(p,t.u_gamma_scale),u_device_pixel_ratio:new s.aM(p,t.u_device_pixel_ratio),u_is_halo:new s.aL(p,t.u_is_halo)}),background:(p,t)=>({u_matrix:new s.aN(p,t.u_matrix),u_opacity:new s.aM(p,t.u_opacity),u_color:new s.aR(p,t.u_color)}),backgroundPattern:(p,t)=>({u_matrix:new s.aN(p,t.u_matrix),u_opacity:new s.aM(p,t.u_opacity),u_image:new s.aL(p,t.u_image),u_pattern_tl_a:new s.aQ(p,t.u_pattern_tl_a),u_pattern_br_a:new s.aQ(p,t.u_pattern_br_a),u_pattern_tl_b:new s.aQ(p,t.u_pattern_tl_b),u_pattern_br_b:new s.aQ(p,t.u_pattern_br_b),u_texsize:new s.aQ(p,t.u_texsize),u_mix:new s.aM(p,t.u_mix),u_pattern_size_a:new s.aQ(p,t.u_pattern_size_a),u_pattern_size_b:new s.aQ(p,t.u_pattern_size_b),u_scale_a:new s.aM(p,t.u_scale_a),u_scale_b:new s.aM(p,t.u_scale_b),u_pixel_coord_upper:new s.aQ(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(p,t.u_pixel_coord_lower),u_tile_units_to_pixels:new s.aM(p,t.u_tile_units_to_pixels)}),terrain:(p,t)=>({u_matrix:new s.aN(p,t.u_matrix),u_texture:new s.aL(p,t.u_texture),u_ele_delta:new s.aM(p,t.u_ele_delta)}),terrainDepth:(p,t)=>({u_matrix:new s.aN(p,t.u_matrix),u_ele_delta:new s.aM(p,t.u_ele_delta)}),terrainCoords:(p,t)=>({u_matrix:new s.aN(p,t.u_matrix),u_texture:new s.aL(p,t.u_texture),u_terrain_coords_id:new s.aM(p,t.u_terrain_coords_id),u_ele_delta:new s.aM(p,t.u_ele_delta)})};class qi{constructor(t,r,l){this.context=t;const u=t.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ss={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class _a{constructor(t,r,l,u){this.length=r.length,this.attributes=l,this.itemSize=r.bytesPerElement,this.dynamicDraw=u,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),t.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let l=0;l<this.attributes.length;l++){const u=r.attributes[this.attributes[l].name];u!==void 0&&t.enableVertexAttribArray(u)}}setVertexAttribPointers(t,r,l){for(let u=0;u<this.attributes.length;u++){const _=this.attributes[u],x=r.attributes[_.name];x!==void 0&&t.vertexAttribPointer(x,_.components,t[Ss[_.type]],!1,this.itemSize,_.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const vr=new WeakMap;function Ao(p){var t;if(vr.has(p))return vr.get(p);{const r=(t=p.getParameter(p.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return vr.set(p,r),r}}class di{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Vs extends di{getDefault(){return s.aT.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ur extends di{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class br extends di{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class ga extends di{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ya extends di{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class va extends di{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ja extends di{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ba extends di{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Us extends di{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class xa extends di{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ya extends di{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class wa extends di{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class js extends di{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class Sa extends di{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class us extends di{getDefault(){return s.aT.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class bo extends di{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class gl extends di{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class yl extends di{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Hl extends di{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class vl extends di{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Ta extends di{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Ia extends di{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class qs extends di{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Qa extends di{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Po extends di{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class hs extends di{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class bl extends di{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class xl extends di{getDefault(){return null}set(t){var r;if(t===this.current&&!this.dirty)return;const l=this.gl;Ao(l)?l.bindVertexArray(t):(r=l.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Zs extends di{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class io extends di{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ca extends di{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class xo extends di{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class qo extends xo{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ts extends xo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class $a extends xo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ki{constructor(t,r,l,u,_){this.context=t,this.width=r,this.height=l;const x=t.gl,w=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new qo(t,w),u)this.depthAttachment=_?new $a(t,w):new Ts(t,w);else if(_)throw new Error("Stencil cannot be setted without depth");if(x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,r=this.colorAttachment.get();if(r&&t.deleteTexture(r),this.depthAttachment){const l=this.depthAttachment.get();l&&t.deleteRenderbuffer(l)}t.deleteFramebuffer(this.framebuffer)}}class cn{constructor(t,r,l){this.blendFunction=t,this.blendColor=r,this.mask=l}}cn.Replace=[1,0],cn.disabled=new cn(cn.Replace,s.aT.transparent,[!1,!1,!1,!1]),cn.unblended=new cn(cn.Replace,s.aT.transparent,[!0,!0,!0,!0]),cn.alphaBlended=new cn([1,771],s.aT.transparent,[!0,!0,!0,!0]);class Xl{constructor(t){var r,l;if(this.gl=t,this.clearColor=new Vs(this),this.clearDepth=new ur(this),this.clearStencil=new br(this),this.colorMask=new ga(this),this.depthMask=new ya(this),this.stencilMask=new va(this),this.stencilFunc=new Ja(this),this.stencilOp=new ba(this),this.stencilTest=new Us(this),this.depthRange=new xa(this),this.depthTest=new Ya(this),this.depthFunc=new wa(this),this.blend=new js(this),this.blendFunc=new Sa(this),this.blendColor=new us(this),this.blendEquation=new bo(this),this.cullFace=new gl(this),this.cullFaceSide=new yl(this),this.frontFace=new Hl(this),this.program=new vl(this),this.activeTexture=new Ta(this),this.viewport=new Ia(this),this.bindFramebuffer=new qs(this),this.bindRenderbuffer=new Qa(this),this.bindTexture=new Po(this),this.bindVertexBuffer=new hs(this),this.bindElementBuffer=new bl(this),this.bindVertexArray=new xl(this),this.pixelStoreUnpack=new Zs(this),this.pixelStoreUnpackPremultiplyAlpha=new io(this),this.pixelStoreUnpackFlipY=new Ca(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Ao(t)){this.HALF_FLOAT=t.HALF_FLOAT;const u=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=t.RGBA16F)!==null&&r!==void 0?r:u==null?void 0:u.RGBA16F_EXT,this.RGB16F=(l=t.RGB16F)!==null&&l!==void 0?l:u==null?void 0:u.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const u=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=u==null?void 0:u.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r){return new qi(this,t,r)}createVertexBuffer(t,r,l){return new _a(this,t,r,l)}createRenderbuffer(t,r,l){const u=this.gl,_=u.createRenderbuffer();return this.bindRenderbuffer.set(_),u.renderbufferStorage(u.RENDERBUFFER,t,r,l),this.bindRenderbuffer.set(null),_}createFramebuffer(t,r,l,u){return new ki(this,t,r,l,u)}clear({color:t,depth:r,stencil:l}){const u=this.gl;let _=0;t&&(_|=u.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(_|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),l!==void 0&&(_|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),u.clear(_)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){s.aG(t.blendFunction,cn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Ao(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var r;return Ao(this.gl)?this.gl.deleteVertexArray(t):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class mi{constructor(t,r,l){this.func=t,this.mask=r,this.range=l}}mi.ReadOnly=!1,mi.ReadWrite=!0,mi.disabled=new mi(519,mi.ReadOnly,[0,1]);const Zo=7680;class $i{constructor(t,r,l,u,_,x){this.test=t,this.ref=r,this.mask=l,this.fail=u,this.depthFail=_,this.pass=x}}$i.disabled=new $i({func:519,mask:0},0,0,Zo,Zo,Zo);class Ri{constructor(t,r,l){this.enable=t,this.mode=r,this.frontFace=l}}let Mr;function Go(p,t,r,l,u,_,x){const w=p.context,I=w.gl,A=p.useProgram("collisionBox"),L=[];let z=0,N=0;for(let te=0;te<l.length;te++){const de=l[te],Ie=t.getTile(de),Ce=Ie.getBucket(r);if(!Ce)continue;let Oe=de.posMatrix;u[0]===0&&u[1]===0||(Oe=p.translatePosMatrix(de.posMatrix,Ie,u,_));const We=x?Ce.textCollisionBox:Ce.iconCollisionBox,Ue=Ce.collisionCircleArray;if(Ue.length>0){const et=s.Z(),It=Oe;s.aU(et,Ce.placementInvProjMatrix,p.transform.glCoordMatrix),s.aU(et,et,Ce.placementViewportMatrix),L.push({circleArray:Ue,circleOffset:N,transform:It,invTransform:et,coord:de}),z+=Ue.length/4,N=z}We&&A.draw(w,I.LINES,mi.disabled,$i.disabled,p.colorModeForRenderPass(),Ri.disabled,se(Oe,p.transform,Ie),p.style.map.terrain&&p.style.map.terrain.getTerrainData(de),r.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,null,p.transform.zoom,null,null,We.collisionVertexBuffer)}if(!x||!L.length)return;const X=p.useProgram("collisionCircle"),H=new s.aV;H.resize(4*z),H._trim();let J=0;for(const te of L)for(let de=0;de<te.circleArray.length/4;de++){const Ie=4*de,Ce=te.circleArray[Ie+0],Oe=te.circleArray[Ie+1],We=te.circleArray[Ie+2],Ue=te.circleArray[Ie+3];H.emplace(J++,Ce,Oe,We,Ue,0),H.emplace(J++,Ce,Oe,We,Ue,1),H.emplace(J++,Ce,Oe,We,Ue,2),H.emplace(J++,Ce,Oe,We,Ue,3)}(!Mr||Mr.length<2*z)&&(Mr=function(te){const de=2*te,Ie=new s.aX;Ie.resize(de),Ie._trim();for(let Ce=0;Ce<de;Ce++){const Oe=6*Ce;Ie.uint16[Oe+0]=4*Ce+0,Ie.uint16[Oe+1]=4*Ce+1,Ie.uint16[Oe+2]=4*Ce+2,Ie.uint16[Oe+3]=4*Ce+2,Ie.uint16[Oe+4]=4*Ce+3,Ie.uint16[Oe+5]=4*Ce+0}return Ie}(z));const G=w.createIndexBuffer(Mr,!0),ue=w.createVertexBuffer(H,s.aW.members,!0);for(const te of L){const de={u_matrix:te.transform,u_inv_matrix:te.invTransform,u_camera_to_center_distance:(we=p.transform).cameraToCenterDistance,u_viewport_size:[we.width,we.height]};X.draw(w,I.TRIANGLES,mi.disabled,$i.disabled,p.colorModeForRenderPass(),Ri.disabled,de,p.style.map.terrain&&p.style.map.terrain.getTerrainData(te.coord),r.id,ue,G,s.S.simpleSegment(0,2*te.circleOffset,te.circleArray.length,te.circleArray.length/2),null,p.transform.zoom,null,null,null)}var we;ue.destroy(),G.destroy()}Ri.disabled=new Ri(!1,1029,2305),Ri.backCCW=new Ri(!0,1029,2305);const Is=s.ao(new Float32Array(16));function no(p,t,r,l,u,_){const{horizontalAlign:x,verticalAlign:w}=s.au(p);return new s.P((-(x-.5)*t/u+l[0])*_,(-(w-.5)*r/u+l[1])*_)}function Ea(p,t,r,l,u,_,x,w,I,A,L){const z=p.text.placedSymbolArray,N=p.text.dynamicLayoutVertexArray,X=p.icon.dynamicLayoutVertexArray,H={};N.clear();for(let J=0;J<z.length;J++){const G=z.get(J),ue=G.hidden||!G.crossTileID||p.allowVerticalPlacement&&!G.placedOrientation?null:l[G.crossTileID];if(ue){const we=new s.P(G.anchorX,G.anchorY),te=mn(we,r?x:_,L),de=ls(u.cameraToCenterDistance,te.signedDistanceFromCamera);let Ie=s.aj(p.textSizeData,I,G)*de/s.ap;r&&(Ie*=p.tilePixelRatio/w);const{width:Ce,height:Oe,anchor:We,textOffset:Ue,textBoxScale:et}=ue,It=no(We,Ce,Oe,Ue,et,Ie),_i=r?mn(we.add(It),_,L).point:te.point.add(t?It.rotate(-u.angle):It),ct=p.allowVerticalPlacement&&G.placedOrientation===s.ai.vertical?Math.PI/2:0;for(let Xt=0;Xt<G.numGlyphs;Xt++)s.ak(N,_i,ct);A&&G.associatedIconIndex>=0&&(H[G.associatedIconIndex]={shiftedAnchor:_i,angle:ct})}else Z(G.numGlyphs,N)}if(A){X.clear();const J=p.icon.placedSymbolArray;for(let G=0;G<J.length;G++){const ue=J.get(G);if(ue.hidden)Z(ue.numGlyphs,X);else{const we=H[G];if(we)for(let te=0;te<ue.numGlyphs;te++)s.ak(X,we.shiftedAnchor,we.angle);else Z(ue.numGlyphs,X)}}p.icon.dynamicLayoutVertexBuffer.updateData(X)}p.text.dynamicLayoutVertexBuffer.updateData(N)}function Cs(p,t,r){return r.iconsInText&&t?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function Wo(p,t,r,l,u,_,x,w,I,A,L,z){const N=p.context,X=N.gl,H=p.transform,J=w==="map",G=I==="map",ue=w!=="viewport"&&r.layout.get("symbol-placement")!=="point",we=J&&!G&&!ue,te=!r.layout.get("symbol-sort-key").isConstant();let de=!1;const Ie=p.depthModeForSublayer(0,mi.ReadOnly),Ce=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Oe=[];for(const We of l){const Ue=t.getTile(We),et=Ue.getBucket(r);if(!et)continue;const It=u?et.text:et.icon;if(!It||!It.segments.get().length||!It.hasVisibleVertices)continue;const _i=It.programConfigurations.get(r.id),ct=u||et.sdfIcons,Xt=u?et.textSizeData:et.iconSizeData,Mt=G||H.pitch!==0,Zi=p.useProgram(Cs(ct,u,et),_i),pi=s.ah(Xt,H.zoom),li=p.style.map.terrain&&p.style.map.terrain.getTerrainData(We);let gi,Mn,rn,dr,Wn=[0,0],Bn=null;if(u)Mn=Ue.glyphAtlasTexture,rn=X.LINEAR,gi=Ue.glyphAtlasTexture.size,et.iconsInText&&(Wn=Ue.imageAtlasTexture.size,Bn=Ue.imageAtlasTexture,dr=Mt||p.options.rotating||p.options.zooming||Xt.kind==="composite"||Xt.kind==="camera"?X.LINEAR:X.NEAREST);else{const An=r.layout.get("icon-size").constantOr(0)!==1||et.iconsNeedLinear;Mn=Ue.imageAtlasTexture,rn=ct||p.options.rotating||p.options.zooming||An||Mt?X.LINEAR:X.NEAREST,gi=Ue.imageAtlasTexture.size}const ao=ae(Ue,1,p.transform.zoom),dn=tt(We.posMatrix,G,J,p.transform,ao),Jo=Er(We.posMatrix,G,J,p.transform,ao),Yo=Ce&&et.hasTextData(),zs=r.layout.get("icon-text-fit")!=="none"&&Yo&&et.hasIconData();if(ue){const An=p.style.map.terrain?(Gr,Pn)=>p.style.map.terrain.getElevation(We,Gr,Pn):null,Hn=r.layout.get("text-rotation-alignment")==="map";rt(et,We.posMatrix,p,u,dn,Jo,G,A,Hn,An)}const ea=p.translatePosMatrix(We.posMatrix,Ue,_,x),Na=ue||u&&Ce||zs?Is:dn,Sr=p.translatePosMatrix(Jo,Ue,_,x,!0),pr=ct&&r.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Lr;Lr=ct?et.iconsInText?ln(Xt.kind,pi,we,G,p,ea,Na,Sr,gi,Wn):Fi(Xt.kind,pi,we,G,p,ea,Na,Sr,u,gi,!0):kt(Xt.kind,pi,we,G,p,ea,Na,Sr,u,gi);const ta={program:Zi,buffers:It,uniformValues:Lr,atlasTexture:Mn,atlasTextureIcon:Bn,atlasInterpolation:rn,atlasInterpolationIcon:dr,isSDF:ct,hasHalo:pr};if(te&&et.canOverlap){de=!0;const An=It.segments.get();for(const Hn of An)Oe.push({segments:new s.S([Hn]),sortKey:Hn.sortKey,state:ta,terrainData:li})}else Oe.push({segments:It.segments,sortKey:0,state:ta,terrainData:li})}de&&Oe.sort((We,Ue)=>We.sortKey-Ue.sortKey);for(const We of Oe){const Ue=We.state;if(N.activeTexture.set(X.TEXTURE0),Ue.atlasTexture.bind(Ue.atlasInterpolation,X.CLAMP_TO_EDGE),Ue.atlasTextureIcon&&(N.activeTexture.set(X.TEXTURE1),Ue.atlasTextureIcon&&Ue.atlasTextureIcon.bind(Ue.atlasInterpolationIcon,X.CLAMP_TO_EDGE)),Ue.isSDF){const et=Ue.uniformValues;Ue.hasHalo&&(et.u_is_halo=1,ka(Ue.buffers,We.segments,r,p,Ue.program,Ie,L,z,et,We.terrainData)),et.u_is_halo=0}ka(Ue.buffers,We.segments,r,p,Ue.program,Ie,L,z,Ue.uniformValues,We.terrainData)}}function ka(p,t,r,l,u,_,x,w,I,A){const L=l.context;u.draw(L,L.gl.TRIANGLES,_,x,w,Ri.disabled,I,A,r.id,p.layoutVertexBuffer,p.indexBuffer,t,r.paint,l.transform.zoom,p.programConfigurations.get(r.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function Es(p,t,r,l,u){if(!r||!l||!l.imageAtlas)return;const _=l.imageAtlas.patternPositions;let x=_[r.to.toString()],w=_[r.from.toString()];if(!x&&w&&(x=w),!w&&x&&(w=x),!x||!w){const I=u.getPaintProperty(t);x=_[I],w=_[I]}x&&w&&p.setConstantPatternPositions(x,w)}function Gs(p,t,r,l,u,_,x){const w=p.context.gl,I="fill-pattern",A=r.paint.get(I),L=A&&A.constantOr(1),z=r.getCrossfadeParameters();let N,X,H,J,G;x?(X=L&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=w.LINES):(X=L?"fillPattern":"fill",N=w.TRIANGLES);const ue=A.constantOr(null);for(const we of l){const te=t.getTile(we);if(L&&!te.patternsLoaded())continue;const de=te.getBucket(r);if(!de)continue;const Ie=de.programConfigurations.get(r.id),Ce=p.useProgram(X,Ie),Oe=p.style.map.terrain&&p.style.map.terrain.getTerrainData(we);L&&(p.context.activeTexture.set(w.TEXTURE0),te.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),Ie.updatePaintBuffers(z)),Es(Ie,I,ue,te,r);const We=Oe?we:null,Ue=p.translatePosMatrix(We?We.posMatrix:we.posMatrix,te,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(x){J=de.indexBuffer2,G=de.segments2;const et=[w.drawingBufferWidth,w.drawingBufferHeight];H=X==="fillOutlinePattern"&&L?V(Ue,p,z,te,et):E(Ue,et)}else J=de.indexBuffer,G=de.segments,H=L?v(Ue,p,z,te):Ns(Ue);Ce.draw(p.context,N,u,p.stencilModeForClipping(we),_,Ri.disabled,H,Oe,r.id,de.layoutVertexBuffer,J,G,r.paint,p.transform.zoom,Ie)}}function Ws(p,t,r,l,u,_,x){const w=p.context,I=w.gl,A="fill-extrusion-pattern",L=r.paint.get(A),z=L.constantOr(1),N=r.getCrossfadeParameters(),X=r.paint.get("fill-extrusion-opacity"),H=L.constantOr(null);for(const J of l){const G=t.getTile(J),ue=G.getBucket(r);if(!ue)continue;const we=p.style.map.terrain&&p.style.map.terrain.getTerrainData(J),te=ue.programConfigurations.get(r.id),de=p.useProgram(z?"fillExtrusionPattern":"fillExtrusion",te);z&&(p.context.activeTexture.set(I.TEXTURE0),G.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),te.updatePaintBuffers(N)),Es(te,A,H,G,r);const Ie=p.translatePosMatrix(J.posMatrix,G,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Ce=r.paint.get("fill-extrusion-vertical-gradient"),Oe=z?jo(Ie,p,Ce,X,J,N,G):Ka(Ie,p,Ce,X);de.draw(w,w.gl.TRIANGLES,u,_,x,Ri.backCCW,Oe,we,r.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,r.paint,p.transform.zoom,te,p.style.map.terrain&&ue.centroidVertexBuffer)}}function wl(p,t,r,l,u,_,x){const w=p.context,I=w.gl,A=r.fbo;if(!A)return;const L=p.useProgram("hillshade"),z=p.style.map.terrain&&p.style.map.terrain.getTerrainData(t);w.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,A.colorAttachment.get()),L.draw(w,I.TRIANGLES,u,_,x,Ri.disabled,((N,X,H,J)=>{const G=H.paint.get("hillshade-shadow-color"),ue=H.paint.get("hillshade-highlight-color"),we=H.paint.get("hillshade-accent-color");let te=H.paint.get("hillshade-illumination-direction")*(Math.PI/180);H.paint.get("hillshade-illumination-anchor")==="viewport"&&(te-=N.transform.angle);const de=!N.options.moving;return{u_matrix:J?J.posMatrix:N.transform.calculatePosMatrix(X.tileID.toUnwrapped(),de),u_image:0,u_latrange:Qe(0,X.tileID),u_light:[H.paint.get("hillshade-exaggeration"),te],u_shadow:G,u_highlight:ue,u_accent:we}})(p,r,l,z?t:null),z,l.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}function Ma(p,t,r,l,u,_){const x=p.context,w=x.gl,I=t.dem;if(I&&I.data){const A=I.dim,L=I.stride,z=I.getPixels();if(x.activeTexture.set(w.TEXTURE1),x.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||p.getTileTexture(L),t.demTexture){const X=t.demTexture;X.update(z,{premultiply:!1}),X.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else t.demTexture=new Nt(x,z,w.RGBA,{premultiply:!1}),t.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);x.activeTexture.set(w.TEXTURE0);let N=t.fbo;if(!N){const X=new Nt(x,{width:A,height:A,data:null},w.RGBA);X.bind(w.LINEAR,w.CLAMP_TO_EDGE),N=t.fbo=x.createFramebuffer(A,A,!0,!1),N.colorAttachment.set(X.texture)}x.bindFramebuffer.set(N.framebuffer),x.viewport.set([0,0,A,A]),p.useProgram("hillshadePrepare").draw(x,w.TRIANGLES,l,u,_,Ri.disabled,((X,H)=>{const J=H.stride,G=s.Z();return s.aS(G,0,s.N,-s.N,0,0,1),s.$(G,G,[0,-s.N,0]),{u_matrix:G,u_image:1,u_dimension:[J,J],u_zoom:X.overscaledZ,u_unpack:H.getUnpackVector()}})(t.tileID,I),null,r.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function Aa(p,t,r,l,u,_){const x=l.paint.get("raster-fade-duration");if(!_&&x>0){const w=s.h.now(),I=(w-p.timeAdded)/x,A=t?(w-t.timeAdded)/x:-1,L=r.getSource(),z=u.coveringZoomLevel({tileSize:L.tileSize,roundZoom:L.roundZoom}),N=!t||Math.abs(t.tileID.overscaledZ-z)>Math.abs(p.tileID.overscaledZ-z),X=N&&p.refreshedUponExpiration?1:s.ad(N?I:1-A,0,1);return p.refreshedUponExpiration&&I>=1&&(p.refreshedUponExpiration=!1),t?{opacity:1,mix:1-X}:{opacity:X,mix:0}}return{opacity:1,mix:0}}const ds=new s.aT(1,0,0,1),Pa=new s.aT(0,1,0,1),wo=new s.aT(0,0,1,1),Sl=new s.aT(1,0,1,1),Ho=new s.aT(0,1,1,1);function ks(p,t,r,l){ps(p,0,t+r/2,p.transform.width,r,l)}function La(p,t,r,l){ps(p,t-r/2,0,r,p.transform.height,l)}function ps(p,t,r,l,u,_){const x=p.context,w=x.gl;w.enable(w.SCISSOR_TEST),w.scissor(t*p.pixelRatio,r*p.pixelRatio,l*p.pixelRatio,u*p.pixelRatio),x.clear({color:_}),w.disable(w.SCISSOR_TEST)}function za(p,t,r){const l=p.context,u=l.gl,_=r.posMatrix,x=p.useProgram("debug"),w=mi.disabled,I=$i.disabled,A=p.colorModeForRenderPass(),L="$debug",z=p.style.map.terrain&&p.style.map.terrain.getTerrainData(r);l.activeTexture.set(u.TEXTURE0);const N=t.getTileByID(r.key).latestRawTileData,X=Math.floor((N&&N.byteLength||0)/1024),H=t.getTile(r).tileSize,J=512/Math.min(H,512)*(r.overscaledZ/p.transform.zoom)*.5;let G=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(G+=` => ${r.overscaledZ}`),function(ue,we){ue.initDebugOverlayCanvas();const te=ue.debugOverlayCanvas,de=ue.context.gl,Ie=ue.debugOverlayCanvas.getContext("2d");Ie.clearRect(0,0,te.width,te.height),Ie.shadowColor="white",Ie.shadowBlur=2,Ie.lineWidth=1.5,Ie.strokeStyle="white",Ie.textBaseline="top",Ie.font="bold 36px Open Sans, sans-serif",Ie.fillText(we,5,5),Ie.strokeText(we,5,5),ue.debugOverlayTexture.update(te),ue.debugOverlayTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE)}(p,`${G} ${X}kB`),x.draw(l,u.TRIANGLES,w,I,cn.alphaBlended,Ri.disabled,le(_,s.aT.transparent,J),null,L,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments),x.draw(l,u.LINE_STRIP,w,I,A,Ri.disabled,le(_,s.aT.red),z,L,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments)}function un(p,t,r){const l=p.context,u=l.gl,_=p.colorModeForRenderPass(),x=new mi(u.LEQUAL,mi.ReadWrite,p.depthRangeFor3D),w=p.useProgram("terrain"),I=t.getTerrainMesh();l.bindFramebuffer.set(null),l.viewport.set([0,0,p.width,p.height]);for(const A of r){const L=p.renderToTexture.getTexture(A),z=t.getTerrainData(A.tileID);l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,L.texture);const N={u_matrix:p.transform.calculatePosMatrix(A.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(p.transform.zoom)};w.draw(l,u.TRIANGLES,x,$i.disabled,_,Ri.backCCW,N,z,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}}class Xo{constructor(t,r){this.context=new Xl(t),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.Z(),renderTime:0},this.setup(),this.numSublayers=tn.maxUnderzooming+tn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new to}resize(t,r,l){if(this.width=Math.floor(t*l),this.height=Math.floor(r*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const t=this.context,r=new s.a_;r.emplaceBack(0,0),r.emplaceBack(s.N,0),r.emplaceBack(0,s.N),r.emplaceBack(s.N,s.N),this.tileExtentBuffer=t.createVertexBuffer(r,fa.members),this.tileExtentSegments=s.S.simpleSegment(0,0,4,2);const l=new s.a_;l.emplaceBack(0,0),l.emplaceBack(s.N,0),l.emplaceBack(0,s.N),l.emplaceBack(s.N,s.N),this.debugBuffer=t.createVertexBuffer(l,fa.members),this.debugSegments=s.S.simpleSegment(0,0,4,5);const u=new s.V;u.emplaceBack(0,0,0,0),u.emplaceBack(s.N,0,s.N,0),u.emplaceBack(0,s.N,0,s.N),u.emplaceBack(s.N,s.N,s.N,s.N),this.rasterBoundsBuffer=t.createVertexBuffer(u,si.members),this.rasterBoundsSegments=s.S.simpleSegment(0,0,4,2);const _=new s.a_;_.emplaceBack(0,0),_.emplaceBack(1,0),_.emplaceBack(0,1),_.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(_,fa.members),this.viewportSegments=s.S.simpleSegment(0,0,4,2);const x=new s.a$;x.emplaceBack(0),x.emplaceBack(1),x.emplaceBack(3),x.emplaceBack(2),x.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(x);const w=new s.b0;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(w);const I=this.context.gl;this.stencilClearMode=new $i({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO)}clearStencil(){const t=this.context,r=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=s.Z();s.aS(l,0,this.width,this.height,0,0,1),s.a0(l,l,[r.drawingBufferWidth,r.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,r.TRIANGLES,mi.disabled,this.stencilClearMode,cn.disabled,Ri.disabled,be(l),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,r){if(this.currentStencilSource===t.source||!t.isTileClipped()||!r||!r.length)return;this.currentStencilSource=t.source;const l=this.context,u=l.gl;this.nextStencilID+r.length>256&&this.clearStencil(),l.setColorMode(cn.disabled),l.setDepthMode(mi.disabled);const _=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const x of r){const w=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,I=this.style.map.terrain&&this.style.map.terrain.getTerrainData(x);_.draw(l,u.TRIANGLES,mi.disabled,new $i({func:u.ALWAYS,mask:0},w,255,u.KEEP,u.KEEP,u.REPLACE),cn.disabled,Ri.disabled,be(x.posMatrix),I,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new $i({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){const r=this.context.gl;return new $i({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(t){const r=this.context.gl,l=t.sort((x,w)=>w.overscaledZ-x.overscaledZ),u=l[l.length-1].overscaledZ,_=l[0].overscaledZ-u+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const x={};for(let w=0;w<_;w++)x[w+u]=new $i({func:r.GEQUAL,mask:255},w+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=_,[x,l]}return[{[u]:$i.disabled},l]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new cn([t.CONSTANT_COLOR,t.ONE],new s.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?cn.unblended:cn.alphaBlended}depthModeForSublayer(t,r,l){if(!this.opaquePassEnabledForLayer())return mi.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new mi(l||this.context.gl.LEQUAL,r,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,r){this.style=t,this.options=r,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(s.h.now()),this.imageManager.beginFrame();const l=this.style._order,u=this.style.sourceCaches,_={},x={},w={};for(const I in u){const A=u[I];A.used&&A.prepare(this.context),_[I]=A.getVisibleCoordinates(),x[I]=_[I].slice().reverse(),w[I]=A.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<l.length;I++)if(this.style._layers[l[I]].is3D()){this.opaquePassCutoff=I;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const I=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!s.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||I.length)&&(s.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(A,L){const z=A.context,N=z.gl,X=cn.unblended,H=new mi(N.LEQUAL,mi.ReadWrite,[0,1]),J=L.getTerrainMesh(),G=L.sourceCache.getRenderableTiles(),ue=A.useProgram("terrainDepth");z.bindFramebuffer.set(L.getFramebuffer("depth").framebuffer),z.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),z.clear({color:s.aT.transparent,depth:1});for(const we of G){const te=L.getTerrainData(we.tileID),de={u_matrix:A.transform.calculatePosMatrix(we.tileID.toUnwrapped()),u_ele_delta:L.getMeshFrameDelta(A.transform.zoom)};ue.draw(z,N.TRIANGLES,H,$i.disabled,X,Ri.backCCW,de,te,"terrain",J.vertexBuffer,J.indexBuffer,J.segments)}z.bindFramebuffer.set(null),z.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain),function(A,L){const z=A.context,N=z.gl,X=cn.unblended,H=new mi(N.LEQUAL,mi.ReadWrite,[0,1]),J=L.getTerrainMesh(),G=L.getCoordsTexture(),ue=L.sourceCache.getRenderableTiles(),we=A.useProgram("terrainCoords");z.bindFramebuffer.set(L.getFramebuffer("coords").framebuffer),z.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),z.clear({color:s.aT.transparent,depth:1}),L.coordsIndex=[];for(const te of ue){const de=L.getTerrainData(te.tileID);z.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,G.texture);const Ie={u_matrix:A.transform.calculatePosMatrix(te.tileID.toUnwrapped()),u_terrain_coords_id:(255-L.coordsIndex.length)/255,u_texture:0,u_ele_delta:L.getMeshFrameDelta(A.transform.zoom)};we.draw(z,N.TRIANGLES,H,$i.disabled,X,Ri.backCCW,Ie,de,"terrain",J.vertexBuffer,J.indexBuffer,J.segments),L.coordsIndex.push(te.tileID.key)}z.bindFramebuffer.set(null),z.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const I of l){const A=this.style._layers[I];if(!A.hasOffscreenPass()||A.isHidden(this.transform.zoom))continue;const L=x[A.source];(A.type==="custom"||L.length)&&this.renderLayer(this,u[A.source],A,L)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?s.aT.black:s.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[l[this.currentLayer]],A=u[I.source],L=_[I.source];this._renderTileClippingMasks(I,L),this.renderLayer(this,A,I,L)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const I=this.style._layers[l[this.currentLayer]],A=u[I.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(I))continue;const L=(I.type==="symbol"?w:x)[I.source];this._renderTileClippingMasks(I,_[I.source]),this.renderLayer(this,A,I,L)}if(this.options.showTileBoundaries){const I=function(A,L){let z=null;const N=Object.values(A._layers).flatMap(G=>G.source&&!G.isHidden(L)?[A.sourceCaches[G.source]]:[]),X=N.filter(G=>G.getSource().type==="vector"),H=N.filter(G=>G.getSource().type!=="vector"),J=G=>{(!z||z.getSource().maxzoom<G.getSource().maxzoom)&&(z=G)};return X.forEach(G=>J(G)),z||H.forEach(G=>J(G)),z}(this.style,this.transform.zoom);I&&function(A,L,z){for(let N=0;N<z.length;N++)za(A,L,z[N])}(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const A=I.transform.padding;ks(I,I.transform.height-(A.top||0),3,ds),ks(I,A.bottom||0,3,Pa),La(I,A.left||0,3,wo),La(I,I.transform.width-(A.right||0),3,Sl);const L=I.transform.centerPoint;(function(z,N,X,H){ps(z,N-1,X-10,2,20,H),ps(z,N-10,X-1,20,2,H)})(I,L.x,I.transform.height-L.y,Ho)}(this),this.context.setDefault()}renderLayer(t,r,l,u){if(!l.isHidden(this.transform.zoom)&&(l.type==="background"||l.type==="custom"||(u||[]).length))switch(this.id=l.id,l.type){case"symbol":(function(_,x,w,I,A){if(_.renderPass!=="translucent")return;const L=$i.disabled,z=_.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(N,X,H,J,G,ue,we){const te=X.transform,de=G==="map",Ie=ue==="map";for(const Ce of N){const Oe=J.getTile(Ce),We=Oe.getBucket(H);if(!We||!We.text||!We.text.segments.get().length)continue;const Ue=s.ah(We.textSizeData,te.zoom),et=ae(Oe,1,X.transform.zoom),It=tt(Ce.posMatrix,Ie,de,X.transform,et),_i=H.layout.get("icon-text-fit")!=="none"&&We.hasIconData();if(Ue){const ct=Math.pow(2,te.zoom-Oe.tileID.overscaledZ);Ea(We,de,Ie,we,te,It,Ce.posMatrix,ct,Ue,_i,X.style.map.terrain?(Xt,Mt)=>X.style.map.terrain.getElevation(Ce,Xt,Mt):null)}}}(I,_,w,x,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),A),w.paint.get("icon-opacity").constantOr(1)!==0&&Wo(_,x,w,I,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),L,z),w.paint.get("text-opacity").constantOr(1)!==0&&Wo(_,x,w,I,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),L,z),x.map.showCollisionBoxes&&(Go(_,x,w,I,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),!0),Go(_,x,w,I,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),!1))})(t,r,l,u,this.style.placement.variableOffsets);break;case"circle":(function(_,x,w,I){if(_.renderPass!=="translucent")return;const A=w.paint.get("circle-opacity"),L=w.paint.get("circle-stroke-width"),z=w.paint.get("circle-stroke-opacity"),N=!w.layout.get("circle-sort-key").isConstant();if(A.constantOr(1)===0&&(L.constantOr(1)===0||z.constantOr(1)===0))return;const X=_.context,H=X.gl,J=_.depthModeForSublayer(0,mi.ReadOnly),G=$i.disabled,ue=_.colorModeForRenderPass(),we=[];for(let te=0;te<I.length;te++){const de=I[te],Ie=x.getTile(de),Ce=Ie.getBucket(w);if(!Ce)continue;const Oe=Ce.programConfigurations.get(w.id),We=_.useProgram("circle",Oe),Ue=Ce.layoutVertexBuffer,et=Ce.indexBuffer,It=_.style.map.terrain&&_.style.map.terrain.getTerrainData(de),_i={programConfiguration:Oe,program:We,layoutVertexBuffer:Ue,indexBuffer:et,uniformValues:Q(_,de,Ie,w),terrainData:It};if(N){const ct=Ce.segments.get();for(const Xt of ct)we.push({segments:new s.S([Xt]),sortKey:Xt.sortKey,state:_i})}else we.push({segments:Ce.segments,sortKey:0,state:_i})}N&&we.sort((te,de)=>te.sortKey-de.sortKey);for(const te of we){const{programConfiguration:de,program:Ie,layoutVertexBuffer:Ce,indexBuffer:Oe,uniformValues:We,terrainData:Ue}=te.state;Ie.draw(X,H.TRIANGLES,J,G,ue,Ri.disabled,We,Ue,w.id,Ce,Oe,te.segments,w.paint,_.transform.zoom,de)}})(t,r,l,u);break;case"heatmap":(function(_,x,w,I){if(w.paint.get("heatmap-opacity")!==0)if(_.renderPass==="offscreen"){const A=_.context,L=A.gl,z=$i.disabled,N=new cn([L.ONE,L.ONE],s.aT.transparent,[!0,!0,!0,!0]);(function(X,H,J){const G=X.gl;X.activeTexture.set(G.TEXTURE1),X.viewport.set([0,0,H.width/4,H.height/4]);let ue=J.heatmapFbo;if(ue)G.bindTexture(G.TEXTURE_2D,ue.colorAttachment.get()),X.bindFramebuffer.set(ue.framebuffer);else{const we=G.createTexture();G.bindTexture(G.TEXTURE_2D,we),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),ue=J.heatmapFbo=X.createFramebuffer(H.width/4,H.height/4,!1,!1),function(te,de,Ie,Ce){var Oe,We;const Ue=te.gl,et=(Oe=te.HALF_FLOAT)!==null&&Oe!==void 0?Oe:Ue.UNSIGNED_BYTE,It=(We=te.RGBA16F)!==null&&We!==void 0?We:Ue.RGBA;Ue.texImage2D(Ue.TEXTURE_2D,0,It,de.width/4,de.height/4,0,Ue.RGBA,et,null),Ce.colorAttachment.set(Ie)}(X,H,we,ue)}})(A,_,w),A.clear({color:s.aT.transparent});for(let X=0;X<I.length;X++){const H=I[X];if(x.hasRenderableParent(H))continue;const J=x.getTile(H),G=J.getBucket(w);if(!G)continue;const ue=G.programConfigurations.get(w.id),we=_.useProgram("heatmap",ue),{zoom:te}=_.transform;we.draw(A,L.TRIANGLES,mi.disabled,z,N,Ri.disabled,Ge(H.posMatrix,J,te,w.paint.get("heatmap-intensity")),null,w.id,G.layoutVertexBuffer,G.indexBuffer,G.segments,w.paint,_.transform.zoom,ue)}A.viewport.set([0,0,_.width,_.height])}else _.renderPass==="translucent"&&(_.context.setColorMode(_.colorModeForRenderPass()),function(A,L){const z=A.context,N=z.gl,X=L.heatmapFbo;if(!X)return;z.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,X.colorAttachment.get()),z.activeTexture.set(N.TEXTURE1);let H=L.colorRampTexture;H||(H=L.colorRampTexture=new Nt(z,L.colorRamp,N.RGBA)),H.bind(N.LINEAR,N.CLAMP_TO_EDGE),A.useProgram("heatmapTexture").draw(z,N.TRIANGLES,mi.disabled,$i.disabled,A.colorModeForRenderPass(),Ri.disabled,((J,G,ue,we)=>{const te=s.Z();s.aS(te,0,J.width,J.height,0,0,1);const de=J.context.gl;return{u_matrix:te,u_world:[de.drawingBufferWidth,de.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:G.paint.get("heatmap-opacity")}})(A,L),null,L.id,A.viewportBuffer,A.quadTriangleIndexBuffer,A.viewportSegments,L.paint,A.transform.zoom)}(_,w))})(t,r,l,u);break;case"line":(function(_,x,w,I){if(_.renderPass!=="translucent")return;const A=w.paint.get("line-opacity"),L=w.paint.get("line-width");if(A.constantOr(1)===0||L.constantOr(1)===0)return;const z=_.depthModeForSublayer(0,mi.ReadOnly),N=_.colorModeForRenderPass(),X=w.paint.get("line-dasharray"),H=w.paint.get("line-pattern"),J=H.constantOr(1),G=w.paint.get("line-gradient"),ue=w.getCrossfadeParameters(),we=J?"linePattern":X?"lineSDF":G?"lineGradient":"line",te=_.context,de=te.gl;let Ie=!0;for(const Ce of I){const Oe=x.getTile(Ce);if(J&&!Oe.patternsLoaded())continue;const We=Oe.getBucket(w);if(!We)continue;const Ue=We.programConfigurations.get(w.id),et=_.context.program.get(),It=_.useProgram(we,Ue),_i=Ie||It.program!==et,ct=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Ce),Xt=H.constantOr(null);if(Xt&&Oe.imageAtlas){const pi=Oe.imageAtlas,li=pi.patternPositions[Xt.to.toString()],gi=pi.patternPositions[Xt.from.toString()];li&&gi&&Ue.setConstantPatternPositions(li,gi)}const Mt=ct?Ce:null,Zi=J?at(_,Oe,w,ue,Mt):X?ii(_,Oe,w,X,ue,Mt):G?ft(_,Oe,w,We.lineClipsArray.length,Mt):dt(_,Oe,w,Mt);if(J)te.activeTexture.set(de.TEXTURE0),Oe.imageAtlasTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE),Ue.updatePaintBuffers(ue);else if(X&&(_i||_.lineAtlas.dirty))te.activeTexture.set(de.TEXTURE0),_.lineAtlas.bind(te);else if(G){const pi=We.gradients[w.id];let li=pi.texture;if(w.gradientVersion!==pi.version){let gi=256;if(w.stepInterpolant){const Mn=x.getSource().maxzoom,rn=Ce.canonical.z===Mn?Math.ceil(1<<_.transform.maxZoom-Ce.canonical.z):1;gi=s.ad(s.aY(We.maxLineLength/s.N*1024*rn),256,te.maxTextureSize)}pi.gradient=s.aZ({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:gi,image:pi.gradient||void 0,clips:We.lineClipsArray}),pi.texture?pi.texture.update(pi.gradient):pi.texture=new Nt(te,pi.gradient,de.RGBA),pi.version=w.gradientVersion,li=pi.texture}te.activeTexture.set(de.TEXTURE0),li.bind(w.stepInterpolant?de.NEAREST:de.LINEAR,de.CLAMP_TO_EDGE)}It.draw(te,de.TRIANGLES,z,_.stencilModeForClipping(Ce),N,Ri.disabled,Zi,ct,w.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,w.paint,_.transform.zoom,Ue,We.layoutVertexBuffer2),Ie=!1}})(t,r,l,u);break;case"fill":(function(_,x,w,I){const A=w.paint.get("fill-color"),L=w.paint.get("fill-opacity");if(L.constantOr(1)===0)return;const z=_.colorModeForRenderPass(),N=w.paint.get("fill-pattern"),X=_.opaquePassEnabledForLayer()&&!N.constantOr(1)&&A.constantOr(s.aT.transparent).a===1&&L.constantOr(0)===1?"opaque":"translucent";if(_.renderPass===X){const H=_.depthModeForSublayer(1,_.renderPass==="opaque"?mi.ReadWrite:mi.ReadOnly);Gs(_,x,w,I,H,z,!1)}if(_.renderPass==="translucent"&&w.paint.get("fill-antialias")){const H=_.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,mi.ReadOnly);Gs(_,x,w,I,H,z,!0)}})(t,r,l,u);break;case"fill-extrusion":(function(_,x,w,I){const A=w.paint.get("fill-extrusion-opacity");if(A!==0&&_.renderPass==="translucent"){const L=new mi(_.context.gl.LEQUAL,mi.ReadWrite,_.depthRangeFor3D);if(A!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))Ws(_,x,w,I,L,$i.disabled,cn.disabled),Ws(_,x,w,I,L,_.stencilModeFor3D(),_.colorModeForRenderPass());else{const z=_.colorModeForRenderPass();Ws(_,x,w,I,L,$i.disabled,z)}}})(t,r,l,u);break;case"hillshade":(function(_,x,w,I){if(_.renderPass!=="offscreen"&&_.renderPass!=="translucent")return;const A=_.context,L=_.depthModeForSublayer(0,mi.ReadOnly),z=_.colorModeForRenderPass(),[N,X]=_.renderPass==="translucent"?_.stencilConfigForOverlap(I):[{},I];for(const H of X){const J=x.getTile(H);J.needsHillshadePrepare!==void 0&&J.needsHillshadePrepare&&_.renderPass==="offscreen"?Ma(_,J,w,L,$i.disabled,z):_.renderPass==="translucent"&&wl(_,H,J,w,L,N[H.overscaledZ],z)}A.viewport.set([0,0,_.width,_.height])})(t,r,l,u);break;case"raster":(function(_,x,w,I){if(_.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!I.length)return;const A=_.context,L=A.gl,z=x.getSource(),N=_.useProgram("raster"),X=_.colorModeForRenderPass(),[H,J]=z instanceof gt?[{},I]:_.stencilConfigForOverlap(I),G=J[J.length-1].overscaledZ,ue=!_.options.moving;for(const we of J){const te=_.depthModeForSublayer(we.overscaledZ-G,w.paint.get("raster-opacity")===1?mi.ReadWrite:mi.ReadOnly,L.LESS),de=x.getTile(we);de.registerFadeDuration(w.paint.get("raster-fade-duration"));const Ie=x.findLoadedParent(we,0),Ce=Aa(de,Ie,x,w,_.transform,_.style.map.terrain);let Oe,We;const Ue=w.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;A.activeTexture.set(L.TEXTURE0),de.texture.bind(Ue,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),A.activeTexture.set(L.TEXTURE1),Ie?(Ie.texture.bind(Ue,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),Oe=Math.pow(2,Ie.tileID.overscaledZ-de.tileID.overscaledZ),We=[de.tileID.canonical.x*Oe%1,de.tileID.canonical.y*Oe%1]):de.texture.bind(Ue,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);const et=_.style.map.terrain&&_.style.map.terrain.getTerrainData(we),It=et?we:null,_i=It?It.posMatrix:_.transform.calculatePosMatrix(we.toUnwrapped(),ue),ct=Sn(_i,We||[0,0],Oe||1,Ce,w);z instanceof gt?N.draw(A,L.TRIANGLES,te,$i.disabled,X,Ri.disabled,ct,et,w.id,z.boundsBuffer,_.quadTriangleIndexBuffer,z.boundsSegments):N.draw(A,L.TRIANGLES,te,H[we.overscaledZ],X,Ri.disabled,ct,et,w.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}})(t,r,l,u);break;case"background":(function(_,x,w,I){const A=w.paint.get("background-color"),L=w.paint.get("background-opacity");if(L===0)return;const z=_.context,N=z.gl,X=_.transform,H=X.tileSize,J=w.paint.get("background-pattern");if(_.isPatternMissing(J))return;const G=!J&&A.a===1&&L===1&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==G)return;const ue=$i.disabled,we=_.depthModeForSublayer(0,G==="opaque"?mi.ReadWrite:mi.ReadOnly),te=_.colorModeForRenderPass(),de=_.useProgram(J?"backgroundPattern":"background"),Ie=I||X.coveringTiles({tileSize:H,terrain:_.style.map.terrain});J&&(z.activeTexture.set(N.TEXTURE0),_.imageManager.bind(_.context));const Ce=w.getCrossfadeParameters();for(const Oe of Ie){const We=I?Oe.posMatrix:_.transform.calculatePosMatrix(Oe.toUnwrapped()),Ue=J?yr(We,L,_,J,{tileID:Oe,tileSize:H},Ce):_n(We,L,A),et=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Oe);de.draw(z,N.TRIANGLES,we,ue,te,Ri.disabled,Ue,et,w.id,_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}})(t,0,l,u);break;case"custom":(function(_,x,w){const I=_.context,A=w.implementation;if(_.renderPass==="offscreen"){const L=A.prerender;L&&(_.setCustomLayerDefaults(),I.setColorMode(_.colorModeForRenderPass()),L.call(A,I.gl,_.transform.customLayerMatrix()),I.setDirty(),_.setBaseState())}else if(_.renderPass==="translucent"){_.setCustomLayerDefaults(),I.setColorMode(_.colorModeForRenderPass()),I.setStencilMode($i.disabled);const L=A.renderingMode==="3d"?new mi(_.context.gl.LEQUAL,mi.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,mi.ReadOnly);I.setDepthMode(L),A.render(I.gl,_.transform.customLayerMatrix()),I.setDirty(),_.setBaseState(),I.bindFramebuffer.set(null)}})(t,0,l)}}translatePosMatrix(t,r,l,u,_){if(!l[0]&&!l[1])return t;const x=_?u==="map"?this.transform.angle:0:u==="viewport"?-this.transform.angle:0;if(x){const A=Math.sin(x),L=Math.cos(x);l=[l[0]*L-l[1]*A,l[0]*A+l[1]*L]}const w=[_?l[0]:ae(r,l[0],this.transform.zoom),_?l[1]:ae(r,l[1],this.transform.zoom),0],I=new Float32Array(16);return s.$(I,t,w),I}saveTileTexture(t){const r=this._tileTextures[t.size[0]];r?r.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const r=this.imageManager.getPattern(t.from.toString()),l=this.imageManager.getPattern(t.to.toString());return!r||!l}useProgram(t,r){this.cache=this.cache||{};const l=t+(r?r.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[l]||(this.cache[l]=new Bs(this.context,on[t],r,ma[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Nt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:r}=this.context.gl;return this.width!==t||this.height!==r}}class hr{constructor(t,r){this.points=t,this.planes=r}static fromInvProjectionMatrix(t,r,l){const u=Math.pow(2,l),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const I=1/(w=s.ag([],w,t))[3]/r*u;return s.b3(w,w,[I,I,1/w[3],I])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const I=function(N,X){var H=X[0],J=X[1],G=X[2],ue=H*H+J*J+G*G;return ue>0&&(ue=1/Math.sqrt(ue)),N[0]=X[0]*ue,N[1]=X[1]*ue,N[2]=X[2]*ue,N}([],function(N,X,H){var J=X[0],G=X[1],ue=X[2],we=H[0],te=H[1],de=H[2];return N[0]=G*de-ue*te,N[1]=ue*we-J*de,N[2]=J*te-G*we,N}([],vt([],_[w[0]],_[w[1]]),vt([],_[w[2]],_[w[1]]))),A=-((L=I)[0]*(z=_[w[1]])[0]+L[1]*z[1]+L[2]*z[2]);var L,z;return I.concat(A)});return new hr(_,x)}}class So{constructor(t,r){this.min=t,this.max=r,this.center=function(l,u,_){return l[0]=.5*u[0],l[1]=.5*u[1],l[2]=.5*u[2],l}([],function(l,u,_){return l[0]=u[0]+_[0],l[1]=u[1]+_[1],l[2]=u[2]+_[2],l}([],this.min,this.max))}quadrant(t){const r=[t%2==0,t<2],l=je(this.min),u=je(this.max);for(let _=0;_<r.length;_++)l[_]=r[_]?this.min[_]:this.center[_],u[_]=r[_]?this.center[_]:this.max[_];return u[2]=this.max[2],new So(l,u)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const r=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let l=!0;for(let u=0;u<t.planes.length;u++){const _=t.planes[u];let x=0;for(let w=0;w<r.length;w++)s.b4(_,r[w])>=0&&x++;if(x===0)return 0;x!==r.length&&(l=!1)}if(l)return 2;for(let u=0;u<3;u++){let _=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let w=0;w<t.points.length;w++){const I=t.points[w][u]-this.min[u];_=Math.min(_,I),x=Math.max(x,I)}if(x<0||_>this.max[u]-this.min[u])return 0}return 1}}class Ms{constructor(t=0,r=0,l=0,u=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(l)||l<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=l,this.right=u}interpolate(t,r,l){return r.top!=null&&t.top!=null&&(this.top=s.B.number(t.top,r.top,l)),r.bottom!=null&&t.bottom!=null&&(this.bottom=s.B.number(t.bottom,r.bottom,l)),r.left!=null&&t.left!=null&&(this.left=s.B.number(t.left,r.left,l)),r.right!=null&&t.right!=null&&(this.right=s.B.number(t.right,r.right,l)),this}getCenter(t,r){const l=s.ad((this.left+t-this.right)/2,0,t),u=s.ad((this.top+r-this.bottom)/2,0,r);return new s.P(l,u)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Ms(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Da{constructor(t,r,l,u,_){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=_===void 0||!!_,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=l??0,this._maxPitch=u??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ms,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const t=new Da(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this._minEleveationForCurrentTile=t._minEleveationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const r=-s.b5(t,-180,180)*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=function(){var l=new s.A(4);return s.A!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l}(),function(l,u,_){var x=u[0],w=u[1],I=u[2],A=u[3],L=Math.sin(_),z=Math.cos(_);l[0]=x*z+I*L,l[1]=w*z+A*L,l[2]=x*-L+I*z,l[3]=w*-L+A*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const r=s.ad(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const r=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this.tileZoom=Math.max(0,Math.floor(r)),this.scale=this.zoomScale(r),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,l){this._unmodified=!1,this._edgeInsets.interpolate(t,r,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const r=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,r)}getVisibleUnwrappedCoordinates(t){const r=[new s.b6(0,t)];if(this._renderWorldCopies){const l=this.pointCoordinate(new s.P(0,0)),u=this.pointCoordinate(new s.P(this.width,0)),_=this.pointCoordinate(new s.P(this.width,this.height)),x=this.pointCoordinate(new s.P(0,this.height)),w=Math.floor(Math.min(l.x,u.x,_.x,x.x)),I=Math.floor(Math.max(l.x,u.x,_.x,x.x)),A=1;for(let L=w-A;L<=I+A;L++)L!==0&&r.push(new s.b6(L,t))}return r}coveringTiles(t){var r,l;let u=this.coveringZoomLevel(t);const _=u;if(t.minzoom!==void 0&&u<t.minzoom)return[];t.maxzoom!==void 0&&u>t.maxzoom&&(u=t.maxzoom);const x=this.pointCoordinate(this.getCameraPoint()),w=s.U.fromLngLat(this.center),I=Math.pow(2,u),A=[I*x.x,I*x.y,0],L=[I*w.x,I*w.y,0],z=hr.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u);let N=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(N=u);const X=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,H=te=>({aabb:new So([te*I,0,0],[(te+1)*I,I,0]),zoom:0,x:0,y:0,wrap:te,fullyVisible:!1}),J=[],G=[],ue=u,we=t.reparseOverscaled?_:u;if(this._renderWorldCopies)for(let te=1;te<=3;te++)J.push(H(-te)),J.push(H(te));for(J.push(H(0));J.length>0;){const te=J.pop(),de=te.x,Ie=te.y;let Ce=te.fullyVisible;if(!Ce){const It=te.aabb.intersects(z);if(It===0)continue;Ce=It===2}const Oe=t.terrain?A:L,We=te.aabb.distanceX(Oe),Ue=te.aabb.distanceY(Oe),et=Math.max(Math.abs(We),Math.abs(Ue));if(te.zoom===ue||et>X+(1<<ue-te.zoom)-2&&te.zoom>=N){const It=ue-te.zoom,_i=A[0]-.5-(de<<It),ct=A[1]-.5-(Ie<<It);G.push({tileID:new s.O(te.zoom===ue?we:te.zoom,te.wrap,te.zoom,de,Ie),distanceSq:yt([L[0]-.5-de,L[1]-.5-Ie]),tileDistanceToCamera:Math.sqrt(_i*_i+ct*ct)})}else for(let It=0;It<4;It++){const _i=(de<<1)+It%2,ct=(Ie<<1)+(It>>1),Xt=te.zoom+1;let Mt=te.aabb.quadrant(It);if(t.terrain){const Zi=new s.O(Xt,te.wrap,Xt,_i,ct),pi=t.terrain.getMinMaxElevation(Zi),li=(r=pi.minElevation)!==null&&r!==void 0?r:this.elevation,gi=(l=pi.maxElevation)!==null&&l!==void 0?l:this.elevation;Mt=new So([Mt.min[0],Mt.min[1],li],[Mt.max[0],Mt.max[1],gi])}J.push({aabb:Mt,zoom:Xt,x:_i,y:ct,wrap:te.wrap,fullyVisible:Ce})}}return G.sort((te,de)=>te.distanceSq-de.distanceSq).map(te=>te.tileID)}resize(t,r){this.width=t,this.height=r,this.pixelsToGLUnits=[2/t,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const r=s.ad(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.P(s.G(t.lng)*this.worldSize,s.H(r)*this.worldSize)}unproject(t){return new s.U(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const r=this.pointLocation(this.centerPoint,t),l=t.getElevationForLngLatZoom(r,this.tileZoom);if(!(this.elevation-l))return;const u=this.getCameraPosition(),_=s.U.fromLngLat(u.lngLat,u.altitude),x=s.U.fromLngLat(r,l),w=_.x-x.x,I=_.y-x.y,A=_.z-x.z,L=Math.sqrt(w*w+I*I+A*A),z=this.scaleZoom(this.cameraToCenterDistance/L/this.tileSize);this._elevation=l,this._center=r,this.zoom=z}setLocationAtPoint(t,r){const l=this.pointCoordinate(r),u=this.pointCoordinate(this.centerPoint),_=this.locationCoordinate(t),x=new s.U(_.x-(l.x-u.x),_.y-(l.y-u.y));this.center=this.coordinateLocation(x),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,r){return r?this.coordinatePoint(this.locationCoordinate(t),r.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,r){return this.coordinateLocation(this.pointCoordinate(t,r))}locationCoordinate(t){return s.U.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,r){if(r){const N=r.pointCoordinate(t);if(N!=null)return N}const l=[t.x,t.y,0,1],u=[t.x,t.y,1,1];s.ag(l,l,this.pixelMatrixInverse),s.ag(u,u,this.pixelMatrixInverse);const _=l[3],x=u[3],w=l[1]/_,I=u[1]/x,A=l[2]/_,L=u[2]/x,z=A===L?0:(0-A)/(L-A);return new s.U(s.B.number(l[0]/_,u[0]/x,z)/this.worldSize,s.B.number(w,I,z)/this.worldSize)}coordinatePoint(t,r=0,l=this.pixelMatrix){const u=[t.x*this.worldSize,t.y*this.worldSize,r,1];return s.ag(u,u,l),new s.P(u[0]/u[3],u[1]/u[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Ut().extend(this.pointLocation(new s.P(0,t))).extend(this.pointLocation(new s.P(this.width,t))).extend(this.pointLocation(new s.P(this.width,this.height))).extend(this.pointLocation(new s.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ut([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,r=!1){const l=t.key,u=r?this._alignedPosMatrixCache:this._posMatrixCache;if(u[l])return u[l];const _=t.canonical,x=this.worldSize/this.zoomScale(_.z),w=_.x+Math.pow(2,_.z)*t.wrap,I=s.ao(new Float64Array(16));return s.$(I,I,[w*x,_.y*x,0]),s.a0(I,I,[x/s.N,x/s.N,1]),s.a1(I,r?this.alignedProjMatrix:this.projMatrix,I),u[l]=new Float32Array(I),u[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,r,l,u,_=-90,x=90,w=-180,I=180;const A=this.size,L=this._unmodified;if(this.latRange){const X=this.latRange;_=s.H(X[1])*this.worldSize,x=s.H(X[0])*this.worldSize,t=x-_<A.y?A.y/(x-_):0}if(this.lngRange){const X=this.lngRange;w=s.b5(s.G(X[0])*this.worldSize,0,this.worldSize),I=s.b5(s.G(X[1])*this.worldSize,0,this.worldSize),I<w&&(I+=this.worldSize),r=I-w<A.x?A.x/(I-w):0}const z=this.point,N=Math.max(r||0,t||0);if(N)return this.center=this.unproject(new s.P(r?(I+w)/2:z.x,t?(x+_)/2:z.y)),this.zoom+=this.scaleZoom(N),this._unmodified=L,void(this._constraining=!1);if(this.latRange){const X=z.y,H=A.y/2;X-H<_&&(u=_+H),X+H>x&&(u=x-H)}if(this.lngRange){const X=(w+I)/2,H=s.b5(z.x,X-this.worldSize/2,X+this.worldSize/2),J=A.x/2;H-J<w&&(l=w+J),H+J>I&&(l=I-J)}l===void 0&&u===void 0||(this.center=this.unproject(new s.P(l!==void 0?l:z.x,u!==void 0?u:z.y)).wrap()),this._unmodified=L,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,r=this.point.x,l=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.b7(1,this.center.lat)*this.worldSize;let u=s.ao(new Float64Array(16));s.a0(u,u,[this.width/2,-this.height/2,1]),s.$(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=s.ao(new Float64Array(16)),s.a0(u,u,[1,-1,1]),s.$(u,u,[-1,-1,0]),s.a0(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u;const _=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),x=Math.min(this.elevation,this._minEleveationForCurrentTile),w=_-x*this._pixelPerMeter/Math.cos(this._pitch),I=x<0?w:_,A=Math.PI/2+this._pitch,L=this._fov*(.5+t.y/this.height),z=Math.sin(L)*I/Math.sin(s.ad(Math.PI-A-L,.01,Math.PI-.01)),N=this.getHorizon(),X=2*Math.atan(N/this.cameraToCenterDistance)*(.5+t.y/(2*N)),H=Math.sin(X)*I/Math.sin(s.ad(Math.PI-A-X,.01,Math.PI-.01)),J=Math.min(z,H),G=1.01*(Math.cos(Math.PI/2-this._pitch)*J+I),ue=this.height/50;u=new Float64Array(16),s.b8(u,this._fov,this.width/this.height,ue,G),u[8]=2*-t.x/this.width,u[9]=2*t.y/this.height,s.a0(u,u,[1,-1,1]),s.$(u,u,[0,0,-this.cameraToCenterDistance]),s.b9(u,u,this._pitch),s.ae(u,u,this.angle),s.$(u,u,[-r,-l,0]),this.mercatorMatrix=s.a0([],u,[this.worldSize,this.worldSize,this.worldSize]),s.a0(u,u,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.a1(new Float64Array(16),this.labelPlaneMatrix,u),s.$(u,u,[0,0,-this.elevation]),this.projMatrix=u,this.invProjMatrix=s.as([],u),this.pixelMatrix3D=s.a1(new Float64Array(16),this.labelPlaneMatrix,u);const we=this.width%2/2,te=this.height%2/2,de=Math.cos(this.angle),Ie=Math.sin(this.angle),Ce=r-Math.round(r)+de*we+Ie*te,Oe=l-Math.round(l)+de*te+Ie*we,We=new Float64Array(u);if(s.$(We,We,[Ce>.5?Ce-1:Ce,Oe>.5?Oe-1:Oe,0]),this.alignedProjMatrix=We,u=s.as(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new s.P(0,0)),r=[t.x*this.worldSize,t.y*this.worldSize,0,1];return s.ag(r,r,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,t))}getCameraQueryGeometry(t){const r=this.getCameraPoint();if(t.length===1)return[t[0],r];{let l=r.x,u=r.y,_=r.x,x=r.y;for(const w of t)l=Math.min(l,w.x),u=Math.min(u,w.y),_=Math.max(_,w.x),x=Math.max(x,w.y);return[new s.P(l,u),new s.P(_,u),new s.P(_,x),new s.P(l,x),new s.P(l,u)]}}}function _e(p,t){let r,l=!1,u=null,_=null;const x=()=>{u=null,l&&(p.apply(_,r),u=setTimeout(x,t),l=!1)};return(...w)=>(l=!0,_=this,r=w,u||x(),u)}class Me{constructor(t){this._getCurrentHash=()=>{const r=window.location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(l=u)}),(l&&l[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{const r=this._getCurrentHash();if(r.length>=3&&!r.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:l,pitch:+(r[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const r=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,r)}catch{}},this._updateHash=_e(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const r=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,u=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,u),x=Math.round(r.lng*_)/_,w=Math.round(r.lat*_)/_,I=this._map.getBearing(),A=this._map.getPitch();let L="";if(L+=t?`/${x}/${w}/${l}`:`${l}/${w}/${x}`,(I||A)&&(L+="/"+Math.round(10*I)/10),A&&(L+=`/${Math.round(A)}`),this._hashName){const z=this._hashName;let N=!1;const X=window.location.hash.slice(1).split("&").map(H=>{const J=H.split("=")[0];return J===z?(N=!0,`${J}=${L}`):H}).filter(H=>H);return N||X.push(`${z}=${L}`),`#${X.join("&")}`}return`#${L}`}}const lt={linearity:.3,easing:s.ba(0,0,.3,1)},Zt=s.e({deceleration:2500,maxSpeed:1400},lt),en=s.e({deceleration:20,maxSpeed:1400},lt),Si=s.e({deceleration:1e3,maxSpeed:360},lt),gn=s.e({deceleration:1e3,maxSpeed:90},lt);class Tn{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.h.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=s.h.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)r.zoom+=_.zoomDelta||0,r.bearing+=_.bearingDelta||0,r.pitch+=_.pitchDelta||0,_.panDelta&&r.pan._add(_.panDelta),_.around&&(r.around=_.around),_.pinchAround&&(r.pinchAround=_.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(r.pan.mag()){const _=yn(r.pan.mag(),l,s.e({},Zt,t||{}));u.offset=r.pan.mult(_.amount/r.pan.mag()),u.center=this._map.transform.center,En(u,_)}if(r.zoom){const _=yn(r.zoom,l,en);u.zoom=this._map.transform.zoom+_.amount,En(u,_)}if(r.bearing){const _=yn(r.bearing,l,Si);u.bearing=this._map.transform.bearing+s.ad(_.amount,-179,179),En(u,_)}if(r.pitch){const _=yn(r.pitch,l,gn);u.pitch=this._map.transform.pitch+_.amount,En(u,_)}if(u.zoom||u.bearing){const _=r.pinchAround===void 0?r.around:r.pinchAround;u.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),s.e(u,{noMoveStart:!0})}}function En(p,t){(!p.duration||p.duration<t.duration)&&(p.duration=t.duration,p.easing=t.easing)}function yn(p,t,r){const{maxSpeed:l,linearity:u,deceleration:_}=r,x=s.ad(p*u/(t/1e3),-l,l),w=Math.abs(x)/(_*u);return{easing:r.easing,duration:1e3*w,amount:x*(w/2)}}class Oi extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,l,u={}){const _=M.mousePos(r.getCanvasContainer(),l),x=r.unproject(_);super(t,s.e({point:_,lngLat:x,originalEvent:l},u)),this._defaultPrevented=!1,this.target=r}}class xr extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,l){const u=t==="touchend"?l.changedTouches:l.touches,_=M.touchPos(r.getCanvasContainer(),u),x=_.map(I=>r.unproject(I)),w=_.reduce((I,A,L,z)=>I.add(A.div(z.length)),new s.P(0,0));super(t,{points:_,point:w,lngLats:x,lngLat:r.unproject(w),originalEvent:l}),this._defaultPrevented=!1}}class To extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,l){super(t,{originalEvent:l}),this._defaultPrevented=!1}}class or{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new To(t.type,this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new Oi(t.type,this._map,t))}mouseup(t){this._map.fire(new Oi(t.type,this._map,t))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new Oi(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Oi(t.type,this._map,t))}mouseover(t){this._map.fire(new Oi(t.type,this._map,t))}mouseout(t){this._map.fire(new Oi(t.type,this._map,t))}touchstart(t){return this._firePreventable(new xr(t.type,this._map,t))}touchmove(t){this._map.fire(new xr(t.type,this._map,t))}touchend(t){this._map.fire(new xr(t.type,this._map,t))}touchcancel(t){this._map.fire(new xr(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Io{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Oi(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Oi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Oi(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wr{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(s.P.convert(t),this._map.terrain)}}class Hs{constructor(t,r){this._map=t,this._tr=new wr(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&t.button===0&&(M.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const l=r;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=l,this._box||(this._box=M.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const _=Math.min(u.x,l.x),x=Math.max(u.x,l.x),w=Math.min(u.y,l.y),I=Math.max(u.y,l.y);M.setTransform(this._box,`translate(${_}px,${w}px)`),this._box.style.width=x-_+"px",this._box.style.height=I-w+"px"}mouseupWindow(t,r){if(!this._active||t.button!==0)return;const l=this._startPos,u=r;if(this.reset(),M.suppressClick(),l.x!==u.x||l.y!==u.y)return this._map.fire(new s.k("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(l,u,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(M.remove(this._box),this._box=null),M.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new s.k(t,{originalEvent:r}))}}function Gn(p,t){if(p.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${p.length}, points ${t.length}`);const r={};for(let l=0;l<p.length;l++)r[p[l].identifier]=t[l];return r}class Ar{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,r,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),l.length===this.numTouches&&(this.centroid=function(u){const _=new s.P(0,0);for(const x of u)_._add(x);return _.div(u.length)}(r),this.touches=Gn(l,r)))}touchmove(t,r,l){if(this.aborted||!this.centroid)return;const u=Gn(l,r);for(const _ in this.touches){const x=u[_];(!x||x.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(t,r,l){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class Xs{constructor(t){this.singleTap=new Ar(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,r,l){this.singleTap.touchstart(t,r,l)}touchmove(t,r,l){this.singleTap.touchmove(t,r,l)}touchend(t,r,l){const u=this.singleTap.touchend(t,r,l);if(u){const _=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(u)<30;if(_&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class Lo{constructor(t){this._tr=new wr(t),this._zoomIn=new Xs({numTouches:1,numTaps:2}),this._zoomOut=new Xs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,l){this._zoomIn.touchstart(t,r,l),this._zoomOut.touchstart(t,r,l)}touchmove(t,r,l){this._zoomIn.touchmove(t,r,l),this._zoomOut.touchmove(t,r,l)}touchend(t,r,l){const u=this._zoomIn.touchend(t,r,l),_=this._zoomOut.touchend(t,r,l),x=this._tr;return u?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:x.zoom+1,around:x.unproject(u)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:x.zoom-1,around:x.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zo{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const r=this._moveFunction(...t);if(r.bearingDelta||r.pitchDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(t,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=r.length?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,r){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const u=r.length?r[0]:r;return!this._moved&&u.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=u,this._move(l,u))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&M.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ki={0:1,2:2};class Bi{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const r=M.mouseButton(t);this._eventButton=r}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(r,l){const u=Ki[l];return r.buttons===void 0||(r.buttons&u)!==u}(t,this._eventButton)}isValidEndEvent(t){return M.mouseButton(t)===this._eventButton}}class Ks{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const ro=p=>{p.mousedown=p.dragStart,p.mousemoveWindow=p.dragMove,p.mouseup=p.dragEnd,p.contextmenu=function(t){t.preventDefault()}},Ko=({enable:p,clickTolerance:t,bearingDegreesPerPixelMoved:r=.8})=>{const l=new Bi({checkCorrectEvent:u=>M.mouseButton(u)===0&&u.ctrlKey||M.mouseButton(u)===2});return new zo({clickTolerance:t,move:(u,_)=>({bearingDelta:(_.x-u.x)*r}),moveStateManager:l,enable:p,assignEvents:ro})},kn=({enable:p,clickTolerance:t,pitchDegreesPerPixelMoved:r=-.5})=>{const l=new Bi({checkCorrectEvent:u=>M.mouseButton(u)===0&&u.ctrlKey||M.mouseButton(u)===2});return new zo({clickTolerance:t,move:(u,_)=>({pitchDelta:(_.y-u.y)*r}),moveStateManager:l,enable:p,assignEvents:ro})};class ht{constructor(t,r){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,r,l){return this._calculateTransform(t,r,l)}touchmove(t,r,l){if(this._map._cooperativeGestures&&(this._minTouches===2&&l.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,l.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(l.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,r,l)}touchend(t,r,l){this._calculateTransform(t,r,l),this._active&&l.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,l){l.length>0&&(this._active=!0);const u=Gn(l,r),_=new s.P(0,0),x=new s.P(0,0);let w=0;for(const A in u){const L=u[A],z=this._touches[A];z&&(_._add(L),x._add(L.sub(z)),w++,u[A]=L)}if(this._touches=u,w<this._minTouches||!x.mag())return;const I=x.div(w);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(w),panDelta:I}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class oo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,r,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,l){if(!this._firstTwoTouches)return;t.preventDefault();const[u,_]=this._firstTwoTouches,x=qr(l,r,u),w=qr(l,r,_);if(!x||!w)return;const I=this._aroundCenter?null:x.add(w).div(2);return this._move([x,w],I,t)}touchend(t,r,l){if(!this._firstTwoTouches)return;const[u,_]=this._firstTwoTouches,x=qr(l,r,u),w=qr(l,r,_);x&&w||(this._active&&M.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function qr(p,t,r){for(let l=0;l<p.length;l++)if(p[l].identifier===r)return t[l]}function Do(p,t){return Math.log(p/t)/Math.LN2}class fs extends oo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const l=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Do(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Do(this._distance,l),pinchAround:r}}}function ot(p,t){return 180*p.angleWith(t)/Math.PI}class Fa extends oo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r){const l=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ot(this._vector,l),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,l=ot(t,this._startVector);return Math.abs(l)<r}}function As(p){return Math.abs(p.y)>Math.abs(p.x)}class el extends oo{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,r,l){super.touchstart(t,r,l),this._currentTouchCount=l.length}_start(t){this._lastPoints=t,As(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,l){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const u=t[0].sub(this._lastPoints[0]),_=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,_,l.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(u.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(t,r,l){if(this._valid!==void 0)return this._valid;const u=t.mag()>=2,_=r.mag()>=2;if(!u&&!_)return;if(!u||!_)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const x=t.y>0==r.y>0;return As(t)&&As(r)&&x}}const Ps={panStep:100,bearingStep:15,pitchStep:10};class Js{constructor(t){this._tr=new wr(t);const r=Ps;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,l=0,u=0,_=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?l=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?l=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?u=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?u=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(l=0,u=0),{cameraAnimation:w=>{const I=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:tl,zoom:r?Math.round(I.zoom)+r*(t.shiftKey?2:1):I.zoom,bearing:I.bearing+l*this._bearingStep,pitch:I.pitch+u*this._pitchStep,offset:[-_*this._panStep,-x*this._panStep],center:I.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function tl(p){return p*(2-p)}const Ys=4.000244140625;class Ra{constructor(t,r){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=t,this._tr=new wr(t),this._el=t.getCanvasContainer(),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const l=s.h.now(),u=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,r!==0&&r%Ys==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(u*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=M.mousePos(this._el,t),l=this._tr;this._around=s.L.convert(this._aroundCenter?l.center:l.unproject(r)),this._aroundPoint=l.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const w=this._type==="wheel"&&Math.abs(this._delta)>Ys?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&I!==0&&(I=1/I);const A=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(A*I))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,l=this._startZoom,u=this._easing;let _,x=!1;if(this._type==="wheel"&&l&&u){const w=Math.min((s.h.now()-this._lastWheelEventTime)/200,1),I=u(w);_=s.B.number(l,r,I),w<1?this._frameId||(this._frameId=!0):x=!0}else _=r,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:_-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=s.bb;if(this._prevEase){const l=this._prevEase,u=(s.h.now()-l.start)/l.duration,_=l.easing(u+.01)-l.easing(u),x=.27/Math.sqrt(_*_+1e-4)*.01,w=Math.sqrt(.0729-x*x);r=s.ba(x,w,.25,1)}return this._prevEase={start:s.h.now(),duration:t,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Kl{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Jl{constructor(t){this._tr=new wr(t),this.reset()}reset(){this._active=!1}dblclick(t,r){return t.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yl{constructor(){this._tap=new Xs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,r,l){if(!this._swipePoint)if(this._tapTime){const u=r[0],_=t.timeStamp-this._tapTime<500,x=this._tapPoint.dist(u)<30;_&&x?l.length>0&&(this._swipePoint=u,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(t,r,l)}touchmove(t,r,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const u=r[0],_=u.y-this._swipePoint.y;return this._swipePoint=u,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,r,l)}touchend(t,r,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const u=this._tap.touchend(t,r,l);u&&(this._tapTime=t.timeStamp,this._tapPoint=u)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ql{constructor(t,r,l){this._el=t,this._mousePan=r,this._touchPan=l}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Zr{constructor(t,r,l){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=r,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ls{constructor(t,r,l,u){this._el=t,this._touchZoom=r,this._touchRotate=l,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const il=p=>p.zoom||p.drag||p.pitch||p.rotate;class $l extends s.k{}function nl(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class ec{constructor(t,r){this.handleWindowEvent=u=>{this.handleEvent(u,`${u.type}Window`)},this.handleEvent=(u,_)=>{if(u.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const x=u.type==="renderFrame"?void 0:u,w={needsRenderFrame:!1},I={},A={},L=u.touches,z=L?this._getMapTouches(L):void 0,N=z?M.touchPos(this._el,z):M.mousePos(this._el,u);for(const{handlerName:J,handler:G,allowed:ue}of this._handlers){if(!G.isEnabled())continue;let we;this._blockedByActive(A,ue,J)?G.reset():G[_||u.type]&&(we=G[_||u.type](u,N,z),this.mergeHandlerResult(w,I,we,J,x),we&&we.needsRenderFrame&&this._triggerRenderFrame()),(we||G.isActive())&&(A[J]=G)}const X={};for(const J in this._previousActiveHandlers)A[J]||(X[J]=x);this._previousActiveHandlers=A,(Object.keys(X).length||nl(w))&&(this._changes.push([w,I,X]),this._triggerRenderFrame()),(Object.keys(A).length||nl(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=w;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Tn(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,_,x]of this._listeners)M.addEventListener(u,_,u===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[t,r,l]of this._listeners)M.removeEventListener(t,r,t===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(t){const r=this._map,l=r.getCanvasContainer();this._add("mapEvent",new or(r,t));const u=r.boxZoom=new Hs(r,t);this._add("boxZoom",u),t.interactive&&t.boxZoom&&u.enable();const _=new Lo(r),x=new Jl(r);r.doubleClickZoom=new Kl(x,_),this._add("tapZoom",_),this._add("clickZoom",x),t.interactive&&t.doubleClickZoom&&r.doubleClickZoom.enable();const w=new Yl;this._add("tapDragZoom",w);const I=r.touchPitch=new el(r);this._add("touchPitch",I),t.interactive&&t.touchPitch&&r.touchPitch.enable(t.touchPitch);const A=Ko(t),L=kn(t);r.dragRotate=new Zr(t,A,L),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]),t.interactive&&t.dragRotate&&r.dragRotate.enable();const z=(({enable:ue,clickTolerance:we})=>{const te=new Bi({checkCorrectEvent:de=>M.mouseButton(de)===0&&!de.ctrlKey});return new zo({clickTolerance:we,move:(de,Ie)=>({around:Ie,panDelta:Ie.sub(de)}),activateOnStart:!0,moveStateManager:te,enable:ue,assignEvents:ro})})(t),N=new ht(t,r);r.dragPan=new Ql(l,z,N),this._add("mousePan",z),this._add("touchPan",N,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&r.dragPan.enable(t.dragPan);const X=new Fa,H=new fs;r.touchZoomRotate=new Ls(l,H,X,w),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&r.touchZoomRotate.enable(t.touchZoomRotate);const J=r.scrollZoom=new Ra(r,()=>this._triggerRenderFrame());this._add("scrollZoom",J,["mousePan"]),t.interactive&&t.scrollZoom&&r.scrollZoom.enable(t.scrollZoom);const G=r.keyboard=new Js(r);this._add("keyboard",G),t.interactive&&t.keyboard&&r.keyboard.enable(),this._add("blockableMapEvent",new Io(r))}_add(t,r,l){this._handlers.push({handlerName:t,handler:r,allowed:l}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!il(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,r,l){for(const u in t)if(u!==l&&(!r||r.indexOf(u)<0))return!0;return!1}_getMapTouches(t){const r=[];for(const l of t)this._el.contains(l.target)&&r.push(l);return r}mergeHandlerResult(t,r,l,u,_){if(!l)return;s.e(t,l);const x={handlerName:u,originalEvent:l.originalEvent||_};l.zoomDelta!==void 0&&(r.zoom=x),l.panDelta!==void 0&&(r.drag=x),l.pitchDelta!==void 0&&(r.pitch=x),l.bearingDelta!==void 0&&(r.rotate=x)}_applyChanges(){const t={},r={},l={};for(const[u,_,x]of this._changes)u.panDelta&&(t.panDelta=(t.panDelta||new s.P(0,0))._add(u.panDelta)),u.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+u.pitchDelta),u.around!==void 0&&(t.around=u.around),u.pinchAround!==void 0&&(t.pinchAround=u.pinchAround),u.noInertia&&(t.noInertia=u.noInertia),s.e(r,_),s.e(l,x);this._updateMapTransform(t,r,l),this._changes=[]}_updateMapTransform(t,r,l){const u=this._map,_=u._getTransformForUpdate(),x=u.terrain;if(!(nl(t)||x&&this._terrainMovement))return this._fireEvents(r,l,!0);let{panDelta:w,zoomDelta:I,bearingDelta:A,pitchDelta:L,around:z,pinchAround:N}=t;N!==void 0&&(z=N),u._stop(!0),z=z||u.transform.centerPoint;const X=_.pointLocation(w?z.sub(w):z);A&&(_.bearing+=A),L&&(_.pitch+=L),I&&(_.zoom+=I),x?this._terrainMovement||!r.drag&&!r.zoom?r.drag&&this._terrainMovement?_.center=_.pointLocation(_.centerPoint.sub(w)):_.setLocationAtPoint(X,z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,_.setLocationAtPoint(X,z),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,_.recalculateZoom(u.terrain)})):_.setLocationAtPoint(X,z),u._applyUpdatedTransform(_),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,l,!0)}_fireEvents(t,r,l){const u=il(this._eventsInProgress),_=il(t),x={};for(const L in t){const{originalEvent:z}=t[L];this._eventsInProgress[L]||(x[`${L}start`]=z),this._eventsInProgress[L]=t[L]}!u&&_&&this._fireEvent("movestart",_.originalEvent);for(const L in x)this._fireEvent(L,x[L]);_&&this._fireEvent("move",_.originalEvent);for(const L in t){const{originalEvent:z}=t[L];this._fireEvent(L,z)}const w={};let I;for(const L in this._eventsInProgress){const{handlerName:z,originalEvent:N}=this._eventsInProgress[L];this._handlersById[z].isActive()||(delete this._eventsInProgress[L],I=r[z]||N,w[`${L}end`]=I)}for(const L in w)this._fireEvent(L,w[L]);const A=il(this._eventsInProgress);if(l&&(u||_)&&!A){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=N=>N!==0&&-this._bearingSnap<N&&N<this._bearingSnap;!L||!L.essential&&s.h.prefersReducedMotion?(this._map.fire(new s.k("moveend",{originalEvent:I})),z(this._map.getBearing())&&this._map.resetNorth()):(z(L.bearing||this._map.getBearing())&&(L.bearing=0),L.freezeElevation=!0,this._map.easeTo(L,{originalEvent:I})),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new s.k(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new $l("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Kc extends s.E{constructor(t,r){super(),this._renderFrameCallback=()=>{const l=Math.min((s.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new s.L(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}panBy(t,r,l){return t=s.P.convert(t).mult(-1),this.panTo(this.transform.center,s.e({offset:t},r),l)}panTo(t,r,l){return this.easeTo(s.e({center:t},r),l)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,l){return this.easeTo(s.e({zoom:t},r),l)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,l){return this.easeTo(s.e({bearing:t},r),l)}resetNorth(t,r){return this.rotateTo(0,s.e({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}cameraForBounds(t,r){t=Ut.convert(t);const l=r&&r.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),l,r)}_cameraForBoxAndBearing(t,r,l,u){const _={top:0,bottom:0,right:0,left:0};if(typeof(u=s.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const Ie=u.padding;u.padding={top:Ie,bottom:Ie,right:Ie,left:Ie}}u.padding=s.e(_,u.padding);const x=this.transform,w=x.padding,I=x.project(s.L.convert(t)),A=x.project(s.L.convert(r)),L=I.rotate(-l*Math.PI/180),z=A.rotate(-l*Math.PI/180),N=new s.P(Math.max(L.x,z.x),Math.max(L.y,z.y)),X=new s.P(Math.min(L.x,z.x),Math.min(L.y,z.y)),H=N.sub(X),J=(x.width-(w.left+w.right+u.padding.left+u.padding.right))/H.x,G=(x.height-(w.top+w.bottom+u.padding.top+u.padding.bottom))/H.y;if(G<0||J<0)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ue=Math.min(x.scaleZoom(x.scale*Math.min(J,G)),u.maxZoom),we=s.P.convert(u.offset),te=new s.P((u.padding.left-u.padding.right)/2,(u.padding.top-u.padding.bottom)/2).rotate(l*Math.PI/180),de=we.add(te).mult(x.scale/x.zoomScale(ue));return{center:x.unproject(I.add(A).div(2).sub(de)),zoom:ue,bearing:l}}fitBounds(t,r,l){return this._fitInternal(this.cameraForBounds(t,r),r,l)}fitScreenCoordinates(t,r,l,u,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.P.convert(t)),this.transform.pointLocation(s.P.convert(r)),l,u),u,_)}_fitInternal(t,r,l){return t?(delete(r=s.e(t,r)).padding,r.linear?this.easeTo(r,l):this.flyTo(r,l)):this}jumpTo(t,r){this.stop();const l=this._getTransformForUpdate();let u=!1,_=!1,x=!1;return"zoom"in t&&l.zoom!==+t.zoom&&(u=!0,l.zoom=+t.zoom),t.center!==void 0&&(l.center=s.L.convert(t.center)),"bearing"in t&&l.bearing!==+t.bearing&&(_=!0,l.bearing=+t.bearing),"pitch"in t&&l.pitch!==+t.pitch&&(x=!0,l.pitch=+t.pitch),t.padding==null||l.isPaddingEqual(t.padding)||(l.padding=t.padding),this._applyUpdatedTransform(l),this.fire(new s.k("movestart",r)).fire(new s.k("move",r)),u&&this.fire(new s.k("zoomstart",r)).fire(new s.k("zoom",r)).fire(new s.k("zoomend",r)),_&&this.fire(new s.k("rotatestart",r)).fire(new s.k("rotate",r)).fire(new s.k("rotateend",r)),x&&this.fire(new s.k("pitchstart",r)).fire(new s.k("pitch",r)).fire(new s.k("pitchend",r)),this.fire(new s.k("moveend",r))}calculateCameraOptionsFromTo(t,r,l,u=0){const _=s.U.fromLngLat(t,r),x=s.U.fromLngLat(l,u),w=x.x-_.x,I=x.y-_.y,A=x.z-_.z,L=Math.hypot(w,I,A);if(L===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(w,I),N=this.transform.scaleZoom(this.transform.cameraToCenterDistance/L/this.transform.tileSize),X=180*Math.atan2(w,-I)/Math.PI;let H=180*Math.acos(z/L)/Math.PI;return H=A<0?90-H:90+H,{center:x.toLngLat(),zoom:N,pitch:H,bearing:X}}easeTo(t,r){this._stop(!1,t.easeId),((t=s.e({offset:[0,0],duration:500,easing:s.bb},t)).animate===!1||!t.essential&&s.h.prefersReducedMotion)&&(t.duration=0);const l=this._getTransformForUpdate(),u=this.getZoom(),_=this.getBearing(),x=this.getPitch(),w=this.getPadding(),I="zoom"in t?+t.zoom:u,A="bearing"in t?this._normalizeBearing(t.bearing,_):_,L="pitch"in t?+t.pitch:x,z="padding"in t?t.padding:l.padding,N=s.P.convert(t.offset);let X=l.centerPoint.add(N);const H=l.pointLocation(X),J=s.L.convert(t.center||H);this._normalizeCenter(J);const G=l.project(H),ue=l.project(J).sub(G),we=l.zoomScale(I-u);let te,de;t.around&&(te=s.L.convert(t.around),de=l.locationPoint(te));const Ie={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||I!==u,this._rotating=this._rotating||_!==A,this._pitching=this._pitching||L!==x,this._padding=!l.isPaddingEqual(z),this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,Ie),this.terrain&&this._prepareElevation(J),this._ease(Ce=>{if(this._zooming&&(l.zoom=s.B.number(u,I,Ce)),this._rotating&&(l.bearing=s.B.number(_,A,Ce)),this._pitching&&(l.pitch=s.B.number(x,L,Ce)),this._padding&&(l.interpolatePadding(w,z,Ce),X=l.centerPoint.add(N)),this.terrain&&!t.freezeElevation&&this._updateElevation(Ce),te)l.setLocationAtPoint(te,de);else{const Oe=l.zoomScale(l.zoom-u),We=I>u?Math.min(2,we):Math.max(.5,we),Ue=Math.pow(We,1-Ce),et=l.unproject(G.add(ue.mult(Ce*Ue)).mult(Oe));l.setLocationAtPoint(l.renderWorldCopies?et.wrap():et,X)}this._applyUpdatedTransform(l),this._fireMoveEvents(r)},Ce=>{this.terrain&&this._finalizeElevation(),this._afterEase(r,Ce)},t),this}_prepareEase(t,r,l={}){this._moving=!0,r||l.moving||this.fire(new s.k("movestart",t)),this._zooming&&!l.zooming&&this.fire(new s.k("zoomstart",t)),this._rotating&&!l.rotating&&this.fire(new s.k("rotatestart",t)),this._pitching&&!l.pitching&&this.fire(new s.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&r!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(l-(r-(l*t+this._elevationStart))/(1-t)),this._elevationTarget=r}this.transform.elevation=s.B.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const r=t.clone(),{center:l,zoom:u,pitch:_,bearing:x,elevation:w}=this.transformCameraUpdate(r);l&&(r.center=l),u!==void 0&&(r.zoom=u),_!==void 0&&(r.pitch=_),x!==void 0&&(r.bearing=x),w!==void 0&&(r.elevation=w),this.transform.apply(r)}_fireMoveEvents(t){this.fire(new s.k("move",t)),this._zooming&&this.fire(new s.k("zoom",t)),this._rotating&&this.fire(new s.k("rotate",t)),this._pitching&&this.fire(new s.k("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const l=this._zooming,u=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new s.k("zoomend",t)),u&&this.fire(new s.k("rotateend",t)),_&&this.fire(new s.k("pitchend",t)),this.fire(new s.k("moveend",t))}flyTo(t,r){if(!t.essential&&s.h.prefersReducedMotion){const Mt=s.F(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Mt,r)}this.stop(),t=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.bb},t);const l=this._getTransformForUpdate(),u=this.getZoom(),_=this.getBearing(),x=this.getPitch(),w=this.getPadding(),I="zoom"in t?s.ad(+t.zoom,l.minZoom,l.maxZoom):u,A="bearing"in t?this._normalizeBearing(t.bearing,_):_,L="pitch"in t?+t.pitch:x,z="padding"in t?t.padding:l.padding,N=l.zoomScale(I-u),X=s.P.convert(t.offset);let H=l.centerPoint.add(X);const J=l.pointLocation(H),G=s.L.convert(t.center||J);this._normalizeCenter(G);const ue=l.project(J),we=l.project(G).sub(ue);let te=t.curve;const de=Math.max(l.width,l.height),Ie=de/N,Ce=we.mag();if("minZoom"in t){const Mt=s.ad(Math.min(t.minZoom,u,I),l.minZoom,l.maxZoom),Zi=de/l.zoomScale(Mt-u);te=Math.sqrt(Zi/Ce*2)}const Oe=te*te;function We(Mt){const Zi=(Ie*Ie-de*de+(Mt?-1:1)*Oe*Oe*Ce*Ce)/(2*(Mt?Ie:de)*Oe*Ce);return Math.log(Math.sqrt(Zi*Zi+1)-Zi)}function Ue(Mt){return(Math.exp(Mt)-Math.exp(-Mt))/2}function et(Mt){return(Math.exp(Mt)+Math.exp(-Mt))/2}const It=We(!1);let _i=function(Mt){return et(It)/et(It+te*Mt)},ct=function(Mt){return de*((et(It)*(Ue(Zi=It+te*Mt)/et(Zi))-Ue(It))/Oe)/Ce;var Zi},Xt=(We(!0)-It)/te;if(Math.abs(Ce)<1e-6||!isFinite(Xt)){if(Math.abs(de-Ie)<1e-6)return this.easeTo(t,r);const Mt=Ie<de?-1:1;Xt=Math.abs(Math.log(Ie/de))/te,ct=function(){return 0},_i=function(Zi){return Math.exp(Mt*te*Zi)}}return t.duration="duration"in t?+t.duration:1e3*Xt/("screenSpeed"in t?+t.screenSpeed/te:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=_!==A,this._pitching=L!==x,this._padding=!l.isPaddingEqual(z),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(G),this._ease(Mt=>{const Zi=Mt*Xt,pi=1/_i(Zi);l.zoom=Mt===1?I:u+l.scaleZoom(pi),this._rotating&&(l.bearing=s.B.number(_,A,Mt)),this._pitching&&(l.pitch=s.B.number(x,L,Mt)),this._padding&&(l.interpolatePadding(w,z,Mt),H=l.centerPoint.add(X)),this.terrain&&!t.freezeElevation&&this._updateElevation(Mt);const li=Mt===1?G:l.unproject(ue.add(we.mult(ct(Zi))).mult(pi));l.setLocationAtPoint(l.renderWorldCopies?li.wrap():li,H),this._applyUpdatedTransform(l),this._fireMoveEvents(r)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(r)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,r){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const l=this._onEaseEnd;delete this._onEaseEnd,l.call(this,r)}if(!t){const l=this.handlers;l&&l.stop(!1)}return this}_ease(t,r,l){l.animate===!1||l.duration===0?(t(1),r()):(this._easeStart=s.h.now(),this._easeOptions=l,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,r){t=s.b5(t,-180,180);const l=Math.abs(t-r);return Math.abs(t-360-r)<l&&(t-=360),Math.abs(t+360-r)<l&&(t+=360),t}_normalizeCenter(t){const r=this.transform;if(!r.renderWorldCopies||r.lngRange)return;const l=t.lng-r.center.lng;t.lng+=l>180?-360:l<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(s.L.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}class so{constructor(t={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=M.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=M.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=M.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){M.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,r){const l=this._map._getUIString(`AttributionControl.${r}`);t.title=l,t.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(u=>typeof u!="string"?"":u)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const r=this._map.style.sourceCaches;for(const u in r){const _=r[u];if(_.used||_.usedForTerrain){const x=_.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t=t.filter(u=>String(u).trim()),t.sort((u,_)=>u.length-_.length),t=t.filter((u,_)=>{for(let x=_+1;x<t.length;x++)if(t[x].indexOf(u)>=0)return!1;return!0});const l=t.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,t.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class hn{constructor(t={}){this._updateCompact=()=>{const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=M.create("div","maplibregl-ctrl");const r=M.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){M.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Tl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,l=r?this._queue.concat(r):this._queue;for(const u of l)if(u.id===t)return void(u.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const l of r)if(!l.cancelled&&(l.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const tc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Jc=s.Q([{name:"a_pos3d",type:"Int16",components:3}]);class Yc extends s.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,r){this.sourceCache.update(t,r),this._renderableTilesKeys=[];const l={};for(const u of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r}))l[u.key]=!0,this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.posMatrix=new Float64Array(16),s.aS(u.posMatrix,0,s.N,0,s.N,0,1),this._tiles[u.key]=new Dn(u,this.tileSize));for(const u in this._tiles)l[u]||delete this._tiles[u]}freeRtt(t){for(const r in this._tiles){const l=this._tiles[r];(!t||l.tileID.equals(t)||l.tileID.isChildOf(t)||t.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const r={};for(const l of this._renderableTilesKeys){const u=this._tiles[l].tileID;if(u.canonical.equals(t.canonical)){const _=t.clone();_.posMatrix=new Float64Array(16),s.aS(_.posMatrix,0,s.N,0,s.N,0,1),r[l]=_}else if(u.canonical.isChildOf(t.canonical)){const _=t.clone();_.posMatrix=new Float64Array(16);const x=u.canonical.z-t.canonical.z,w=u.canonical.x-(u.canonical.x>>x<<x),I=u.canonical.y-(u.canonical.y>>x<<x),A=s.N>>x;s.aS(_.posMatrix,0,A,0,A,0,1),s.$(_.posMatrix,_.posMatrix,[-w*A,-I*A,0]),r[l]=_}else if(t.canonical.isChildOf(u.canonical)){const _=t.clone();_.posMatrix=new Float64Array(16);const x=t.canonical.z-u.canonical.z,w=t.canonical.x-(t.canonical.x>>x<<x),I=t.canonical.y-(t.canonical.y>>x<<x),A=s.N>>x;s.aS(_.posMatrix,0,s.N,0,s.N,0,1),s.$(_.posMatrix,_.posMatrix,[w*A,I*A,0]),s.a0(_.posMatrix,_.posMatrix,[1/2**x,1/2**x,0]),r[l]=_}}return r}getSourceTile(t,r){const l=this.sourceCache._source;let u=t.overscaledZ-this.deltaZoom;if(u>l.maxzoom&&(u=l.maxzoom),u<l.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(u).key);let _=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!_||!_.dem)&&r)for(;u>=l.minzoom&&(!_||!_.dem);)_=this.sourceCache.getTileByID(t.scaledTo(u--).key);return _}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(r=>r.timeAdded>=t)}}class Qc{constructor(t,r,l){this.painter=t,this.sourceCache=new Yc(r),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,r,l,u=s.N){var _;if(!(r>=0&&r<u&&l>=0&&l<u))return 0;const x=this.getTerrainData(t),w=(_=x.tile)===null||_===void 0?void 0:_.dem;if(!w)return 0;const I=function(H,J,G){var ue=J[0],we=J[1];return H[0]=G[0]*ue+G[4]*we+G[12],H[1]=G[1]*ue+G[5]*we+G[13],H}([],[r/u*s.N,l/u*s.N],x.u_terrain_matrix),A=[I[0]*w.dim,I[1]*w.dim],L=Math.floor(A[0]),z=Math.floor(A[1]),N=A[0]-L,X=A[1]-z;return w.get(L,z)*(1-N)*(1-X)+w.get(L+1,z)*N*(1-X)+w.get(L,z+1)*(1-N)*X+w.get(L+1,z+1)*N*X}getElevationForLngLatZoom(t,r){const{tileID:l,mercatorX:u,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(t,r);return this.getElevation(l,u%s.N,_%s.N,s.N)}getElevation(t,r,l,u=s.N){return this.getDEMElevation(t,r,l,u)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const u=this.painter.context,_=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Nt(u,_,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Nt(u,new s.R({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.ao([])}const r=this.sourceCache.getSourceTile(t,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const u=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new Nt(u,r.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),r.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const l=r&&r+r.tileID.key+t.key;if(l&&!this._demMatrixCache[l]){const u=this.sourceCache.sourceCache._source.maxzoom;let _=t.canonical.z-r.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=u?_=t.canonical.z-u:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=t.canonical.x-(t.canonical.x>>_<<_),w=t.canonical.y-(t.canonical.y>>_<<_),I=s.bc(new Float64Array(16),[1/(s.N<<_),1/(s.N<<_),0]);s.$(I,I,[x*s.N,w*s.N,0]),this._demMatrixCache[t.key]={matrix:I,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(t){const r=this.painter,l=r.width/devicePixelRatio,u=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Nt(r.context,{width:l,height:u,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Nt(r.context,{width:l,height:u,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(l,u,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,l,u))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,x=0;_<this._coordsTextureSize;_++)for(let w=0;w<this._coordsTextureSize;w++,x+=4)r[x+0]=255&w,r[x+1]=255&_,r[x+2]=w>>8<<4|_>>8,r[x+3]=0;const l=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),u=new Nt(t,l,t.gl.RGBA,{premultiply:!1});return u.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(t){const r=new Uint8Array(4),l=this.painter.context,u=l.gl;l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),u.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,r),l.bindFramebuffer.set(null);const _=r[0]+(r[2]>>4<<8),x=r[1]+((15&r[2])<<8),w=this.coordsIndex[255-r[3]],I=w&&this.sourceCache.getTileByID(w);if(!I)return null;const A=this._coordsTextureSize,L=(1<<I.tileID.canonical.z)*A;return new s.U(this._allowMercatorOverflow(t,(I.tileID.canonical.x*A+_)/L),(I.tileID.canonical.y*A+x)/L,this.getElevation(I.tileID,_,x,A))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,r=new s.bd,l=new s.b0,u=this.meshSize,_=s.N/u,x=u*u;for(let z=0;z<=u;z++)for(let N=0;N<=u;N++)r.emplaceBack(N*_,z*_,0);for(let z=0;z<x;z+=u+1)for(let N=0;N<u;N++)l.emplaceBack(N+z,u+N+z+1,u+N+z+2),l.emplaceBack(N+z,u+N+z+2,N+z+1);const w=r.length,I=w+2*(u+1);for(const z of[0,1])for(let N=0;N<=u;N++)for(const X of[0,1])r.emplaceBack(N*_,z*s.N,X);for(let z=0;z<2*u;z+=2)l.emplaceBack(I+z,I+z+1,I+z+3),l.emplaceBack(I+z,I+z+3,I+z+2),l.emplaceBack(w+z,w+z+3,w+z+1),l.emplaceBack(w+z,w+z+2,w+z+3);const A=r.length,L=A+2*(u+1);for(const z of[0,1])for(let N=0;N<=u;N++)for(const X of[0,1])r.emplaceBack(z*s.N,N*_,X);for(let z=0;z<2*u;z+=2)l.emplaceBack(A+z,A+z+1,A+z+3),l.emplaceBack(A+z,A+z+3,A+z+2),l.emplaceBack(L+z,L+z+3,L+z+1),l.emplaceBack(L+z,L+z+2,L+z+3);return this._mesh={indexBuffer:t.createIndexBuffer(l),vertexBuffer:t.createVertexBuffer(r,Jc.members),segments:s.S.simpleSegment(0,0,r.length,l.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*s.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,r){var l;const{tileID:u}=this._getOverscaledTileIDFromLngLatZoom(t,r);return(l=this.getMinMaxElevation(u).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(t){const r=this.getTerrainData(t).tile,l={minElevation:null,maxElevation:null};return r&&r.dem&&(l.minElevation=r.dem.min*this.exaggeration,l.maxElevation=r.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(t,r){const l=s.U.fromLngLat(t.wrap()),u=(1<<r)*s.N,_=l.x*u,x=l.y*u,w=Math.floor(_/s.N),I=Math.floor(x/s.N);return{tileID:new s.O(r,0,r,w,I),mercatorX:_,mercatorY:x}}_allowMercatorOverflow(t,r){const l=t.x<this.painter.width/2;let u=s.bf(r);const _=this.painter.transform.center.lng;return l&&Math.sign(u)>0&&Math.sign(_)<0||!l&&Math.sign(u)<0&&Math.sign(_)>0?(u=360*Math.sign(_)+u,s.G(u)):r}}class Ou{constructor(t,r,l){this._context=t,this._size=r,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new Nt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(l.texture),{id:t,fbo:r,texture:l,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(r=>t.id!==r),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Pr={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Il{constructor(t,r){this.painter=t,this.terrain=r,this.pool=new Ou(t.context,30,r.sourceCache.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(l=>!t._layers[l].isHidden(r)),this._coordsDescendingInv={};for(const l in t.sourceCaches){this._coordsDescendingInv[l]={};const u=t.sourceCaches[l].getVisibleCoordinates();for(const _ of u){const x=this.terrain.sourceCache.getTerrainCoords(_);for(const w in x)this._coordsDescendingInv[l][w]||(this._coordsDescendingInv[l][w]=[]),this._coordsDescendingInv[l][w].push(x[w])}}this._coordsDescendingInvStr={};for(const l of t._order){const u=t._layers[l],_=u.source;if(Pr[u.type]&&!this._coordsDescendingInvStr[_]){this._coordsDescendingInvStr[_]={};for(const x in this._coordsDescendingInv[_])this._coordsDescendingInvStr[_][x]=this._coordsDescendingInv[_][x].map(w=>w.key).sort().join()}}for(const l of this._renderableTiles)for(const u in this._coordsDescendingInvStr){const _=this._coordsDescendingInvStr[u][l.tileID.key];_&&_!==l.rttCoords[u]&&(l.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const r=t.type,l=this.painter,u=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Pr[r]&&(this._prevType&&Pr[this._prevType]||this._stacks.push([]),this._prevType=r,this._stacks[this._stacks.length-1].push(t.id),!u))return!0;if(Pr[this._prevType]||Pr[r]&&u){this._prevType=r;const _=this._stacks.length-1,x=this._stacks[_]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(un(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[_]){const A=this.pool.getObjectForId(w.rtt[_].id);if(A.stamp===w.rtt[_].stamp){this.pool.useObject(A);continue}}const I=this.pool.getOrCreateFreeObject();this.pool.useObject(I),this.pool.stampObject(I),w.rtt[_]={id:I.id,stamp:I.stamp},l.context.bindFramebuffer.set(I.fbo.framebuffer),l.context.clear({color:s.aT.transparent,stencil:0}),l.currentStencilSource=void 0;for(let A=0;A<x.length;A++){const L=l.style._layers[x[A]],z=L.source?this._coordsDescendingInv[L.source][w.tileID.key]:[w.tileID];l.context.viewport.set([0,0,I.fbo.width,I.fbo.height]),l._renderTileClippingMasks(L,z),l.renderLayer(l,l.style.sourceCaches[L.source],L,z),L.source&&(w.rttCoords[L.source]=this._coordsDescendingInvStr[L.source][w.tileID.key])}}return un(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Pr[r]}return!1}}const Ft=F,Ht={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},rl=p=>{p.touchstart=p.dragStart,p.touchmoveWindow=p.dragMove,p.touchend=p.dragEnd},ic={showCompass:!0,showZoom:!0,visualizePitch:!1};class nc{constructor(t,r,l=!1){this.mousedown=x=>{this.startMouse(s.e({},x,{ctrlKey:!0,preventDefault:()=>x.preventDefault()}),M.mousePos(this.element,x)),M.addEventListener(window,"mousemove",this.mousemove),M.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=x=>{this.moveMouse(x,M.mousePos(this.element,x))},this.mouseup=x=>{this.mouseRotate.dragEnd(x),this.mousePitch&&this.mousePitch.dragEnd(x),this.offTemp()},this.touchstart=x=>{x.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=M.touchPos(this.element,x.targetTouches)[0],this.startTouch(x,this._startPos),M.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),M.addEventListener(window,"touchend",this.touchend))},this.touchmove=x=>{x.targetTouches.length!==1?this.reset():(this._lastPos=M.touchPos(this.element,x.targetTouches)[0],this.moveTouch(x,this._lastPos))},this.touchend=x=>{x.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const u=t.dragRotate._mouseRotate.getClickTolerance(),_=t.dragRotate._mousePitch.getClickTolerance();this.element=r,this.mouseRotate=Ko({clickTolerance:u,enable:!0}),this.touchRotate=(({enable:x,clickTolerance:w,bearingDegreesPerPixelMoved:I=.8})=>{const A=new Ks;return new zo({clickTolerance:w,move:(L,z)=>({bearingDelta:(z.x-L.x)*I}),moveStateManager:A,enable:x,assignEvents:rl})})({clickTolerance:u,enable:!0}),this.map=t,l&&(this.mousePitch=kn({clickTolerance:_,enable:!0}),this.touchPitch=(({enable:x,clickTolerance:w,pitchDegreesPerPixelMoved:I=-.5})=>{const A=new Ks;return new zo({clickTolerance:w,move:(L,z)=>({pitchDelta:(z.y-L.y)*I}),moveStateManager:A,enable:x,assignEvents:rl})})({clickTolerance:_,enable:!0})),M.addEventListener(r,"mousedown",this.mousedown),M.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),M.addEventListener(r,"touchcancel",this.reset)}startMouse(t,r){this.mouseRotate.dragStart(t,r),this.mousePitch&&this.mousePitch.dragStart(t,r),M.disableDrag()}startTouch(t,r){this.touchRotate.dragStart(t,r),this.touchPitch&&this.touchPitch.dragStart(t,r),M.disableDrag()}moveMouse(t,r){const l=this.map,{bearingDelta:u}=this.mouseRotate.dragMove(t,r)||{};if(u&&l.setBearing(l.getBearing()+u),this.mousePitch){const{pitchDelta:_}=this.mousePitch.dragMove(t,r)||{};_&&l.setPitch(l.getPitch()+_)}}moveTouch(t,r){const l=this.map,{bearingDelta:u}=this.touchRotate.dragMove(t,r)||{};if(u&&l.setBearing(l.getBearing()+u),this.touchPitch){const{pitchDelta:_}=this.touchPitch.dragMove(t,r)||{};_&&l.setPitch(l.getPitch()+_)}}off(){const t=this.element;M.removeEventListener(t,"mousedown",this.mousedown),M.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),M.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),M.removeEventListener(window,"touchend",this.touchend),M.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){M.enableDrag(),M.removeEventListener(window,"mousemove",this.mousemove),M.removeEventListener(window,"mouseup",this.mouseup),M.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),M.removeEventListener(window,"touchend",this.touchend)}}let On;function rc(p,t,r){if(p=new s.L(p.lng,p.lat),t){const l=new s.L(p.lng-360,p.lat),u=new s.L(p.lng+360,p.lat),_=r.locationPoint(p).distSqr(t);r.locationPoint(l).distSqr(t)<_?p=l:r.locationPoint(u).distSqr(t)<_&&(p=u)}for(;Math.abs(p.lng-r.center.lng)>180;){const l=r.locationPoint(p);if(l.x>=0&&l.y>=0&&l.x<=r.width&&l.y<=r.height)break;p.lng>r.center.lng?p.lng-=360:p.lng+=360}return p}const Co={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function $c(p,t,r){const l=p.classList;for(const u in Co)l.remove(`maplibregl-${r}-anchor-${u}`);l.add(`maplibregl-${r}-anchor-${t}`)}class Qs extends s.E{constructor(t){if(super(),this._onKeyPress=r=>{const l=r.code,u=r.charCode||r.keyCode;l!=="Space"&&l!=="Enter"&&u!==32&&u!==13||this.togglePopup()},this._onMapClick=r=>{const l=r.originalEvent.target,u=this._element;this._popup&&(l===u||u.contains(l))&&this.togglePopup()},this._update=r=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();((r==null?void 0:r.type)==="terrain"||(r==null?void 0:r.type)==="render"&&!l)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=rc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let u="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?u=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(u=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_=`rotateX(${this._map.getPitch()}deg)`),r&&r.type!=="moveend"||(this._pos=this._pos.round()),M.setTransform(this._element,`${Co[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${_} ${u}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const x=this._map.unproject(this._pos),w=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=x.distanceTo(this._lngLat)>20*w?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=r=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.k("dragstart"))),this.fire(new s.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.k("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=s.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=M.create("div"),this._element.setAttribute("aria-label","Map marker");const r=M.createNS("http://www.w3.org/2000/svg","svg"),l=41,u=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${l}px`),r.setAttributeNS(null,"width",`${u}px`),r.setAttributeNS(null,"viewBox",`0 0 ${u} ${l}`);const _=M.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const x=M.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");const w=M.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const I=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ue of I){const we=M.createNS("http://www.w3.org/2000/svg","ellipse");we.setAttributeNS(null,"opacity","0.04"),we.setAttributeNS(null,"cx","10.5"),we.setAttributeNS(null,"cy","5.80029008"),we.setAttributeNS(null,"rx",ue.rx),we.setAttributeNS(null,"ry",ue.ry),w.appendChild(we)}const A=M.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const L=M.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(L);const z=M.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const N=M.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(N);const X=M.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(6.0, 7.0)"),X.setAttributeNS(null,"fill","#FFFFFF");const H=M.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(8.0, 8.0)");const J=M.createNS("http://www.w3.org/2000/svg","circle");J.setAttributeNS(null,"fill","#000000"),J.setAttributeNS(null,"opacity","0.25"),J.setAttributeNS(null,"cx","5.5"),J.setAttributeNS(null,"cy","5.5"),J.setAttributeNS(null,"r","5.4999962");const G=M.createNS("http://www.w3.org/2000/svg","circle");G.setAttributeNS(null,"fill","#FFFFFF"),G.setAttributeNS(null,"cx","5.5"),G.setAttributeNS(null,"cy","5.5"),G.setAttributeNS(null,"r","5.4999962"),H.appendChild(J),H.appendChild(G),x.appendChild(w),x.appendChild(A),x.appendChild(z),x.appendChild(X),x.appendChild(H),r.appendChild(x),r.setAttributeNS(null,"height",l*this._scale+"px"),r.setAttributeNS(null,"width",u*this._scale+"px"),this._element.appendChild(r),this._offset=s.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",r=>{r.preventDefault()}),this._element.addEventListener("mousedown",r=>{r.preventDefault()}),$c(this._element,this._anchor,"marker"),t&&t.className)for(const r of t.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),M.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.L.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const u=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(t){return this._offset=s.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const In={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let xn=0,Oa=!1;const ol={maxWidth:100,unit:"metric"};function sl(p,t,r){const l=r&&r.maxWidth||100,u=p._container.clientHeight/2,_=p.unproject([0,u]),x=p.unproject([l,u]),w=_.distanceTo(x);if(r&&r.unit==="imperial"){const I=3.2808*w;I>5280?$s(t,l,I/5280,p._getUIString("ScaleControl.Miles")):$s(t,l,I,p._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?$s(t,l,w/1852,p._getUIString("ScaleControl.NauticalMiles")):w>=1e3?$s(t,l,w/1e3,p._getUIString("ScaleControl.Kilometers")):$s(t,l,w,p._getUIString("ScaleControl.Meters"))}function $s(p,t,r,l){const u=function(_){const x=Math.pow(10,`${Math.floor(_)}`.length-1);let w=_/x;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(I){const A=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*A)/A}(w),x*w}(r);p.style.width=t*(u/r)+"px",p.innerHTML=`${u}&nbsp;${l}`}const oc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},sc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ba(p){if(p){if(typeof p=="number"){const t=Math.round(Math.abs(p)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,p),"top-left":new s.P(t,t),"top-right":new s.P(-t,t),bottom:new s.P(0,-p),"bottom-left":new s.P(t,-t),"bottom-right":new s.P(-t,-t),left:new s.P(p,0),right:new s.P(-p,0)}}if(p instanceof s.P||Array.isArray(p)){const t=s.P.convert(p);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:s.P.convert(p.center||[0,0]),top:s.P.convert(p.top||[0,0]),"top-left":s.P.convert(p["top-left"]||[0,0]),"top-right":s.P.convert(p["top-right"]||[0,0]),bottom:s.P.convert(p.bottom||[0,0]),"bottom-left":s.P.convert(p["bottom-left"]||[0,0]),"bottom-right":s.P.convert(p["bottom-right"]||[0,0]),left:s.P.convert(p.left||[0,0]),right:s.P.convert(p.right||[0,0])}}return Ba(new s.P(0,0))}const ac={extend:(p,...t)=>s.e(p,...t),run(p){p()},logToElement(p,t=!1,r="log"){const l=window.document.getElementById(r);l&&(t&&(l.innerHTML=""),l.innerHTML+=`<br>${p}`)}},lc=F;class Ni{static get version(){return lc}static get workerCount(){return $r.workerCount}static set workerCount(t){$r.workerCount=t}static get maxParallelImageRequests(){return s.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(t){s.c.MAX_PARALLEL_IMAGE_REQUESTS=t}static get workerUrl(){return s.c.WORKER_URL}static set workerUrl(t){s.c.WORKER_URL=t}static addProtocol(t,r){s.c.REGISTERED_PROTOCOLS[t]=r}static removeProtocol(t){delete s.c.REGISTERED_PROTOCOLS[t]}}return Ni.Map=class extends Kc{constructor(p){if(s.bg.mark(s.bh.create),(p=s.e({},Ht,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Da(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),{bearingSnap:p.bearingSnap}),this._cooperativeGesturesOnWheel=t=>{this._onCooperativeGesture(t,t[this._metaKey],1)},this._contextLost=t=>{t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=p.interactive,this._cooperativeGestures=p.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=p.maxTileCacheSize,this._maxTileCacheZoomLevels=p.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._renderTaskQueue=new Tl,this._controls=[],this._mapId=s.a2(),this._locale=s.e({},tc,p.locale),this._clickTolerance=p.clickTolerance,this._overridePixelRatio=p.pixelRatio,this._maxCanvasSize=p.maxCanvasSize,this.transformCameraUpdate=p.transformCameraUpdate,this._imageQueueHandle=fe.addThrottleControl(()=>this.isMoving()),this._requestManager=new Pe(p.transformRequest),typeof p.container=="string"){if(this._container=document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const r=_e(l=>{this._trackResize&&!this._removed&&this.resize(l)._update()},50);this._resizeObserver=new ResizeObserver(l=>{t?r(l):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new ec(this,p),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=p.hash&&new Me(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,s.e({},p.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=p.localIdeographFontFamily,this._validateStyle=p.validateStyle,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new so({customAttribution:p.customAttribution})),p.maplibreLogo&&this.addControl(new hn,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new s.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new s.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new s.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(p,t){if(t===void 0&&(t=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new s.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=p.onAdd(this);this._controls.push(p);const l=this._controlPositions[t];return t.indexOf("bottom")!==-1?l.insertBefore(r,l.firstChild):l.appendChild(r),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new s.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(p);return t>-1&&this._controls.splice(t,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}calculateCameraOptionsFromTo(p,t,r,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(p,t,r,l)}resize(p){var t;const r=this._containerDimensions(),l=r[0],u=r[1],_=this._getClampedPixelRatio(l,u);if(this._resizeCanvas(l,u,_),this.painter.resize(l,u,_),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const I=this._getClampedPixelRatio(l,u);this._resizeCanvas(l,u,I),this.painter.resize(l,u,I)}this.transform.resize(l,u),(t=this._requestedCameraState)===null||t===void 0||t.resize(l,u);const x=!this._moving;return x&&(this.stop(),this.fire(new s.k("movestart",p)).fire(new s.k("move",p))),this.fire(new s.k("resize",p)),x&&this.fire(new s.k("moveend",p)),this}_getClampedPixelRatio(p,t){const{0:r,1:l}=this._maxCanvasSize,u=this.getPixelRatio(),_=p*u,x=t*u;return Math.min(_>r?r/_:1,x>l?l/x:1)*u}getPixelRatio(){var p;return(p=this._overridePixelRatio)!==null&&p!==void 0?p:devicePixelRatio}setPixelRatio(p){this._overridePixelRatio=p,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(Ut.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(p){return this._cooperativeGestures=p,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(p){return this.transform.locationPoint(s.L.convert(p),this.style&&this.terrain)}unproject(p){return this.transform.pointLocation(s.P.convert(p),this.terrain)}isMoving(){var p;return this._moving||((p=this.handlers)===null||p===void 0?void 0:p.isMoving())}isZooming(){var p;return this._zooming||((p=this.handlers)===null||p===void 0?void 0:p.isZooming())}isRotating(){var p;return this._rotating||((p=this.handlers)===null||p===void 0?void 0:p.isRotating())}_createDelegatedListener(p,t,r){if(p==="mouseenter"||p==="mouseover"){let l=!1;return{layer:t,listener:r,delegates:{mousemove:_=>{const x=this.getLayer(t)?this.queryRenderedFeatures(_.point,{layers:[t]}):[];x.length?l||(l=!0,r.call(this,new Oi(p,this,_.originalEvent,{features:x}))):l=!1},mouseout:()=>{l=!1}}}}if(p==="mouseleave"||p==="mouseout"){let l=!1;return{layer:t,listener:r,delegates:{mousemove:x=>{(this.getLayer(t)?this.queryRenderedFeatures(x.point,{layers:[t]}):[]).length?l=!0:l&&(l=!1,r.call(this,new Oi(p,this,x.originalEvent)))},mouseout:x=>{l&&(l=!1,r.call(this,new Oi(p,this,x.originalEvent)))}}}}{const l=u=>{const _=this.getLayer(t)?this.queryRenderedFeatures(u.point,{layers:[t]}):[];_.length&&(u.features=_,r.call(this,u),delete u.features)};return{layer:t,listener:r,delegates:{[p]:l}}}}on(p,t,r){if(r===void 0)return super.on(p,t);const l=this._createDelegatedListener(p,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(l);for(const u in l.delegates)this.on(u,l.delegates[u]);return this}once(p,t,r){if(r===void 0)return super.once(p,t);const l=this._createDelegatedListener(p,t,r);for(const u in l.delegates)this.once(u,l.delegates[u]);return this}off(p,t,r){return r===void 0?super.off(p,t):(this._delegatedListeners&&this._delegatedListeners[p]&&(l=>{const u=this._delegatedListeners[p];for(let _=0;_<u.length;_++){const x=u[_];if(x.layer===t&&x.listener===r){for(const w in x.delegates)this.off(w,x.delegates[w]);return u.splice(_,1),this}}})(),this)}queryRenderedFeatures(p,t){if(!this.style)return[];let r;const l=p instanceof s.P||Array.isArray(p),u=l?p:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(l?{}:p)||{},u instanceof s.P||typeof u[0]=="number")r=[s.P.convert(u)];else{const _=s.P.convert(u[0]),x=s.P.convert(u[1]);r=[_,new s.P(x.x,_.y),x,new s.P(_.x,x.y),_]}return this.style.queryRenderedFeatures(r,t,this.transform)}querySourceFeatures(p,t){return this.style.querySourceFeatures(p,t)}setStyle(p,t){return(t=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(p,t))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){const t=this._locale[p];if(t==null)throw new Error(`Missing UI string '${p}'`);return t}_updateStyle(p,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(p,t));const r=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!p)),p?(this.style=new jn(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p,t,r):this.style.loadJSON(p,t,r),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new jn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,t){if(typeof p=="string"){const r=this._requestManager.transformRequest(p,Te.Style);s.f(r,(l,u)=>{l?this.fire(new s.j(l)):u&&this._updateDiff(u,t)})}else typeof p=="object"&&this._updateDiff(p,t)}_updateDiff(p,t){try{this.style.setState(p,t)&&this._update(!0)}catch(r){s.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(p,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(p,t){return this._lazyInitEmptyStyle(),this.style.addSource(p,t),this._update(!0)}isSourceLoaded(p){const t=this.style&&this.style.sourceCaches[p];if(t!==void 0)return t.loaded();this.fire(new s.j(new Error(`There is no source with ID '${p}'`)))}setTerrain(p){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),p){const t=this.style.sourceCaches[p.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${p.source}`);for(const r in this.style._layers){const l=this.style._layers[r];l.type==="hillshade"&&l.source===p.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Qc(this.painter,t,p),this.painter.renderToTexture=new Il(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=r=>{r.dataType==="style"?this.terrain.sourceCache.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==p.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new s.k("terrain",{terrain:p})),this}getTerrain(){var p,t;return(t=(p=this.terrain)===null||p===void 0?void 0:p.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const p=this.style&&this.style.sourceCaches;for(const t in p){const r=p[t]._tiles;for(const l in r){const u=r[l];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}addSourceType(p,t,r){return this._lazyInitEmptyStyle(),this.style.addSourceType(p,t,r)}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,t,r={}){const{pixelRatio:l=1,sdf:u=!1,stretchX:_,stretchY:x,content:w}=r;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||s.a(t))){if(t.width===void 0||t.height===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:I,height:A,data:L}=t,z=t;return this.style.addImage(p,{data:new s.R({width:I,height:A},new Uint8Array(L)),pixelRatio:l,stretchX:_,stretchY:x,content:w,sdf:u,version:0,userImage:z}),z.onAdd&&z.onAdd(this,p),this}}{const{width:I,height:A,data:L}=s.h.getImageData(t);this.style.addImage(p,{data:new s.R({width:I,height:A},L),pixelRatio:l,stretchX:_,stretchY:x,content:w,sdf:u,version:0})}}updateImage(p,t){const r=this.style.getImage(p);if(!r)return this.fire(new s.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=t instanceof HTMLImageElement||s.a(t)?s.h.getImageData(t):t,{width:u,height:_,data:x}=l;if(u===void 0||_===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==r.data.width||_!==r.data.height)return this.fire(new s.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(t instanceof HTMLImageElement||s.a(t));return r.data.replace(x,w),this.style.updateImage(p,r),this}getImage(p){return this.style.getImage(p)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new s.j(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,t){fe.getImage(this._requestManager.transformRequest(p,Te.Image),t)}listImages(){return this.style.listImages()}addLayer(p,t){return this._lazyInitEmptyStyle(),this.style.addLayer(p,t),this._update(!0)}moveLayer(p,t){return this.style.moveLayer(p,t),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(p,t,r){return this.style.setLayerZoomRange(p,t,r),this._update(!0)}setFilter(p,t,r={}){return this.style.setFilter(p,t,r),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,t,r,l={}){return this.style.setPaintProperty(p,t,r,l),this._update(!0)}getPaintProperty(p,t){return this.style.getPaintProperty(p,t)}setLayoutProperty(p,t,r,l={}){return this.style.setLayoutProperty(p,t,r,l),this._update(!0)}getLayoutProperty(p,t){return this.style.getLayoutProperty(p,t)}setGlyphs(p,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(p,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(p,t,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(p,t,r,l=>{l||this._update(!0)}),this}removeSprite(p){return this._lazyInitEmptyStyle(),this.style.removeSprite(p),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(p,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(p,t,r=>{r||this._update(!0)}),this}setLight(p,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(p,t){return this.style.setFeatureState(p,t),this._update()}removeFeatureState(p,t){return this.style.removeFeatureState(p,t),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,t=0;return this._container&&(p=this._container.clientWidth||400,t=this._container.clientHeight||300),[p,t]}_setupContainer(){const p=this._container;p.classList.add("maplibregl-map");const t=this._canvasContainer=M.create("div","maplibregl-canvas-container",p);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=M.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),l=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],l);const u=this._controlContainer=M.create("div","maplibregl-control-container",p),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{_[x]=M.create("div",`maplibregl-ctrl-${x} `,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=M.create("div","maplibregl-cooperative-gesture-screen",this._container);let p=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(p=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${p}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){M.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(p,t,r){this._canvas.width=Math.floor(r*p),this._canvas.height=Math.floor(r*t),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const p={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{t={requestedAttributes:p},l&&(t.statusMessage=l.statusMessage,t.type=l.type)},{once:!0});const r=this._canvas.getContext("webgl2",p)||this._canvas.getContext("webgl",p);if(!r){const l="Failed to initialize WebGL";throw t?(t.message=l,new Error(JSON.stringify(t))):new Error(l)}this.painter=new Xo(r,this.transform),q.testSupport(r)}_onCooperativeGesture(p,t,r){return!t&&r<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let r=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const u=this.transform.zoom,_=s.h.now();this.style.zoomHistory.update(u,_);const x=new s.a8(u,{now:_,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=x.crossFadingFactor();w===1&&w===this._crossFadingFactor||(r=!0,this._crossFadingFactor=w),this.style.update(x)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new s.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.bg.mark(s.bh.load),this.fire(new s.k("load"))),this.style&&(this.style.hasTransitions()||r)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const l=this._sourcesDirty||this._styleDirty||this._placementDirty;return l||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.k("idle")),!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,s.bg.mark(s.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var p;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),fe.removeThrottleControl(this._imageQueueHandle),(p=this._resizeObserver)===null||p===void 0||p.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),M.remove(this._canvasContainer),M.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),s.bg.clearMetrics(),this._removed=!0,this.fire(new s.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=s.h.frame(p=>{s.bg.frame(p),this._frame=null,this._render(p)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get version(){return Ft}getCameraTargetElevation(){return this.transform.elevation}},Ni.NavigationControl=class{constructor(p){this._updateZoomButtons=()=>{const t=this._map.getZoom(),r=t===this._map.getMaxZoom(),l=t===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,r)=>{const l=this._map._getUIString(`NavigationControl.${r}`);t.title=l,t.setAttribute("aria-label",l)},this.options=s.e({},ic,p),this._container=M.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),M.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),M.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=M.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new nc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){M.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,t){const r=M.create("button",p,this._container);return r.type="button",r.addEventListener("click",t),r}},Ni.GeolocateControl=class extends s.E{constructor(p){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new s.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const r=new s.L(t.coords.longitude,t.coords.latitude),l=t.coords.accuracy,u=this._map.getBearing(),_=s.e({bearing:u},this.options.fitBoundsOptions),x=Ut.fromLngLat(r,l);this._map.fitBounds(x,_,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const r=new s.L(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Oa)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=M.create("button","maplibregl-ctrl-geolocate",this._container),M.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=M.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Qs({element:this._dotElement}),this._circleElement=M.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Qs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.k("trackuserlocationend")))})}},this.options=s.e({},In,p)}onAdd(p){return this._map=p,this._container=M.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,r=!1){On===void 0||r?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(l=>{On=l.state!=="denied",t(On)}).catch(()=>{On=!!window.navigator.geolocation,t(On)}):(On=!!window.navigator.geolocation,t(On)):t(On)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),M.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,xn=0,Oa=!1}_isOutOfMapMaxBounds(p){const t=this._map.getMaxBounds(),r=p.coords;return t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const p=this._map.getBounds(),t=p.getSouthEast(),r=p.getNorthEast(),l=t.distanceTo(r),u=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":xn--,Oa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),xn++,xn>1?(p={maximumAge:6e5,timeout:0},Oa=!0):(p=this.options.positionOptions,Oa=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Ni.AttributionControl=so,Ni.LogoControl=hn,Ni.ScaleControl=class{constructor(p){this._onMove=()=>{sl(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,sl(this._map,this._container,this.options)},this.options=s.e({},ol,p)}getDefaultPosition(){return"bottom-left"}onAdd(p){return this._map=p,this._container=M.create("div","maplibregl-ctrl maplibregl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){M.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Ni.FullscreenControl=class extends s.E{constructor(p={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=M.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){M.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const p=this._fullscreenButton=M.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);M.create("span","maplibregl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new s.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Ni.TerrainControl=class{constructor(p){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=p}onAdd(p){return this._map=p,this._container=M.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=M.create("button","maplibregl-ctrl-terrain",this._container),M.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){M.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Ni.Popup=class extends s.E{constructor(p){super(),this.remove=()=>(this._content&&M.remove(this._content),this._container&&(M.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new s.k("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=M.create("div","maplibregl-popup",this._map.getContainer()),this._tip=M.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const x of this.options.className.split(" "))this._container.classList.add(x);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=rc(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const r=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let l=this.options.anchor;const u=Ba(this.options.offset);if(!l){const x=this._container.offsetWidth,w=this._container.offsetHeight;let I;I=r.y+u.bottom.y<w?["top"]:r.y>this._map.transform.height-w?["bottom"]:[],r.x<x/2?I.push("left"):r.x>this._map.transform.width-x/2&&I.push("right"),l=I.length===0?"bottom":I.join("-")}const _=r.add(u[l]).round();M.setTransform(this._container,`${Co[l]} translate(${_.x}px,${_.y}px)`),$c(this._container,l,"popup")},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(oc),p)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=s.L.convert(p),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const t=document.createDocumentFragment(),r=document.createElement("body");let l;for(r.innerHTML=p;l=r.firstChild,l;)t.appendChild(l);return this.setDOMContent(t)}getMaxWidth(){var p;return(p=this._container)===null||p===void 0?void 0:p.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=M.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){this._container&&this._container.classList.add(p)}removeClassName(p){this._container&&this._container.classList.remove(p)}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}_createCloseButton(){this.options.closeButton&&(this._closeButton=M.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(sc);p&&p.focus()}},Ni.Marker=Qs,Ni.Style=jn,Ni.LngLat=s.L,Ni.LngLatBounds=Ut,Ni.Point=s.P,Ni.MercatorCoordinate=s.U,Ni.Evented=s.E,Ni.AJAXError=s.bi,Ni.config=s.c,Ni.CanvasSource=Qi,Ni.GeoJSONSource=it,Ni.ImageSource=gt,Ni.RasterDEMTileSource=Gt,Ni.RasterTileSource=qe,Ni.VectorTileSource=Li,Ni.VideoSource=Xi,Ni.setRTLTextPlugin=s.bj,Ni.getRTLTextPluginStatus=s.bk,Ni.prewarm=function(){as().acquire(ei)},Ni.clearPrewarmedResources=function(){const p=eo;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(ei),eo=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},ac.extend(Ni,{isSafari:s.ac,getPerformanceMetrics:s.bg.getPerformanceMetrics}),Ni});var k=y;return k})})(Lf);var Df=Lf.exports;const rs=Pf(Df);function Rp(f){let a;return h=>{if(h)for(let d in h){let y=a==null?void 0:a[d],S=h[d];y!==S&&f(d,S,y)}else if(a)for(let d in a)f(d,void 0,a[d]);a=h}}function Eg(f,...a){let h=[f];for(let d of a)if(d)Array.isArray(d)&&d[0]===f?h.push(...d.slice(1)):h.push(d);else continue;if(h.length!==1)return h.length===2?h[1]:h}function kg(f){return f===!0?["has","point_count"]:f===!1?["!",["has","point_count"]]:void 0}function Op(f,a){return["case",["boolean",["feature-state","hover"],!1],a,f]}var zu=Mg;function Mg(f){var a,h,d;if(f){if(Array.isArray(f)){for(a=[],h=f.length,d=0;d<h;d++){var y=f[d];y!=null&&a.push(y)}return a}if(typeof f=="object"){a={};var S=Object.keys(f);for(h=S.length,d=0;d<h;d++){var k=S[d],s=f[k];s!=null&&(a[k]=s)}return a}}}function Bp(f){let a=f[0],h,d,y=Np(f);return{c(){y.c(),h=ss()},m(S,k){y.m(S,k),Ye(S,h,k),d=!0},p(S,k){k[0]&1&&Vi(a,a=S[0])?(lr(),Ve(y,1,1,vi),cr(),y=Np(S),y.c(),ze(y,1),y.m(h.parentNode,h)):y.p(S,k)},i(S){d||(ze(y),d=!0)},o(S){Ve(y),d=!1},d(S){S&&Xe(h),y.d(S)}}}function Np(f){let a;const h=f[37].default,d=fo(h,f,f[36],null);return{c(){d&&d.c()},m(y,S){d&&d.m(y,S),a=!0},p(y,S){d&&d.p&&(!a||S[1]&32)&&_o(d,h,y,y[36],a?mo(h,y[36],S,null):go(y[36]),null)},i(y){a||(ze(d,y),a=!0)},o(y){Ve(d,y),a=!1},d(y){d&&d.d(y)}}}function Ag(f){let a,h,d=f[0]&&Bp(f);return{c(){d&&d.c(),a=ss()},m(y,S){d&&d.m(y,S),Ye(y,a,S),h=!0},p(y,S){y[0]?d?(d.p(y,S),S[0]&1&&ze(d,1)):(d=Bp(y),d.c(),ze(d,1),d.m(a.parentNode,a)):d&&(lr(),Ve(d,1,1,()=>{d=null}),cr())},i(y){h||(ze(d),h=!0)},o(y){Ve(d),h=!1},d(y){y&&Xe(a),d&&d.d(y)}}}function Pg(f,a,h){let d,y,S,k,s,F,M,q,ie,he,xe,ye,{$$slots:ge={},$$scope:fe}=a,{id:Te=Hc("layer")}=a,{source:Pe=void 0}=a,{sourceLayer:Ke=void 0}=a,{beforeId:je=void 0}=a,{beforeLayerType:St=void 0}=a,{type:vt}=a,{paint:yt=void 0}=a,{layout:zt=void 0}=a,{filter:wt=void 0}=a,{applyToClusters:Nt=void 0}=a,{minzoom:De=void 0}=a,{maxzoom:Je=void 0}=a,{manageHoverState:$t=!1}=a,{hovered:$e=null}=a,{interactive:Kt=!0}=a,{hoverCursor:Pt=void 0}=a,{eventsIfTopMost:Lt=!1}=a;const ui=Wc(),{map:Ln,source:zn,self:Pi,minzoom:Mi,maxzoom:Ut,eventTopMost:bi,layerInfo:Li}=Tg();ni(f,Ln,it=>h(32,ie=it)),ni(f,zn,it=>h(33,he=it)),ni(f,Pi,it=>h(0,q=it)),ni(f,Mi,it=>h(35,ye=it)),ni(f,Ut,it=>h(34,xe=it)),xs(()=>{q&&ie&&(Li.delete(q),ie==null||ie.removeLayer(q))});let qe,Gt=!0;return f.$$set=it=>{"id"in it&&h(7,Te=it.id),"source"in it&&h(8,Pe=it.source),"sourceLayer"in it&&h(9,Ke=it.sourceLayer),"beforeId"in it&&h(10,je=it.beforeId),"beforeLayerType"in it&&h(11,St=it.beforeLayerType),"type"in it&&h(12,vt=it.type),"paint"in it&&h(13,yt=it.paint),"layout"in it&&h(14,zt=it.layout),"filter"in it&&h(15,wt=it.filter),"applyToClusters"in it&&h(16,Nt=it.applyToClusters),"minzoom"in it&&h(17,De=it.minzoom),"maxzoom"in it&&h(18,Je=it.maxzoom),"manageHoverState"in it&&h(19,$t=it.manageHoverState),"hovered"in it&&h(6,$e=it.hovered),"interactive"in it&&h(20,Kt=it.interactive),"hoverCursor"in it&&h(21,Pt=it.hoverCursor),"eventsIfTopMost"in it&&h(22,Lt=it.eventsIfTopMost),"$$scope"in it&&h(36,fe=it.$$scope)},f.$$.update=()=>{if(f.$$.dirty[0]&65536&&h(31,d=kg(Nt)),f.$$.dirty[0]&32768|f.$$.dirty[1]&1&&h(25,y=Eg("all",d,wt)),f.$$.dirty[0]&131072|f.$$.dirty[1]&16&&h(27,S=De??ye),f.$$.dirty[0]&262144|f.$$.dirty[1]&8&&h(26,k=Je??xe),f.$$.dirty[0]&256|f.$$.dirty[1]&4&&h(30,s=Pe||he),f.$$.dirty[0]&1324908161|f.$$.dirty[1]&2&&ie&&q!==Te&&s){let it=function(gt){var Ui,bn;if(!Kt||!q||!ie||Lt&&bi(gt)!==q)return;let Xi=gt.features??[],Qi=(bn=(Ui=Xi[0])==null?void 0:Ui.properties)==null?void 0:bn.cluster_id,Ze={event:gt,map:ie,clusterId:Qi,layer:q,source:s,features:Xi};ui(gt.type,Ze)};q&&Li.delete(q);let si=je;if(!je&&St){let gt=ie.getStyle().layers,Xi=typeof St=="function"?St:Ze=>Ze.type===St,Qi=gt==null?void 0:gt.find(Xi);Qi&&(si=Qi.id)}fn(Pi,q=Te,q),ie.addLayer(zu({id:q,type:vt,source:s,"source-layer":Ke,filter:y,paint:yt,layout:zt,minzoom:S,maxzoom:k}),si),h(24,Gt=!0),ie.on("click",q,it),ie.on("dblclick",q,it),ie.on("contextmenu",q,it),ie.on("mouseenter",q,gt=>{var Ui,bn;if(!Kt||!q||!ie||Lt&&bi(gt)!==q)return;Pt&&(ie.getCanvas().style.cursor=Pt);let Xi=gt.features??[];h(6,$e=Xi[0]??null);let Qi=(bn=(Ui=Xi[0])==null?void 0:Ui.properties)==null?void 0:bn.cluster_id;ui("mouseenter",{event:gt,map:ie,clusterId:Qi,layer:q,source:s,features:Xi})}),ie.on("mousemove",q,gt=>{var Ui,bn,xi;if(!Kt)return;if(Lt&&bi(gt)!==q){h(6,$e=null),$t&&qe!==void 0&&(ie==null||ie.setFeatureState({source:s,sourceLayer:Ke,id:qe},{hover:!1}),h(23,qe=void 0));return}ie.getCanvas().style.cursor=Pt;let Xi=gt.features??[],Qi=(bn=(Ui=Xi[0])==null?void 0:Ui.properties)==null?void 0:bn.cluster_id,Ze=(xi=Xi[0])==null?void 0:xi.id;Ze!==qe&&($t&&(qe!==void 0&&(ie==null||ie.setFeatureState({source:s,id:qe,sourceLayer:Ke},{hover:!1})),ie==null||ie.setFeatureState({source:s,id:Ze,sourceLayer:Ke},{hover:!0})),h(23,qe=Ze),h(6,$e=Xi[0]??null)),ui("mousemove",{event:gt,map:ie,clusterId:Qi,layer:q,source:s,features:Xi})}),ie.on("mouseleave",q,gt=>{if(!(!Kt||!q||!ie)){if(Pt&&(ie.getCanvas().style.cursor=""),h(6,$e=null),$t&&qe!==void 0){const Xi={source:s,id:qe,sourceLayer:Ke};ie==null||ie.setFeatureState(Xi,{hover:!1}),h(23,qe=void 0)}ui("mouseleave",{map:ie,layer:q,source:s})}})}f.$$.dirty[0]&1048577&&q&&Li.set(q,{interactive:Kt}),f.$$.dirty[0]&1|f.$$.dirty[1]&2&&h(29,F=q?Rp((it,si)=>ie==null?void 0:ie.setPaintProperty(q,it,si)):void 0),f.$$.dirty[0]&1|f.$$.dirty[1]&2&&h(28,M=q?Rp((it,si)=>ie==null?void 0:ie.setLayoutProperty(q,it,si)):void 0),f.$$.dirty[0]&536879104&&(F==null||F(yt)),f.$$.dirty[0]&268451840&&(M==null||M(zt)),f.$$.dirty[0]&201326593|f.$$.dirty[1]&2&&q&&(ie==null||ie.setLayerZoomRange(q,S,k)),f.$$.dirty[0]&50331649|f.$$.dirty[1]&2&&q&&(Gt?h(24,Gt=!1):ie==null||ie.setFilter(q,y))},[q,Ln,zn,Pi,Mi,Ut,$e,Te,Pe,Ke,je,St,vt,yt,zt,wt,Nt,De,Je,$t,Kt,Pt,Lt,qe,Gt,y,k,S,M,F,s,d,ie,he,xe,ye,fe,ge]}class Wh extends Hi{constructor(a){super(),Wi(this,a,Pg,Ag,Vi,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function Lg(f){let a;const h=f[16].default,d=fo(h,f,f[24],null);return{c(){d&&d.c()},m(y,S){d&&d.m(y,S),a=!0},p(y,S){d&&d.p&&(!a||S&16777216)&&_o(d,h,y,y[24],a?mo(h,y[24],S,null):go(y[24]),null)},i(y){a||(ze(d,y),a=!0)},o(y){Ve(d,y),a=!1},d(y){d&&d.d(y)}}}function zg(f){let a,h,d;function y(k){f[17](k)}let S={id:f[1],type:"circle",source:f[2],sourceLayer:f[3],beforeId:f[4],beforeLayerType:f[5],paint:f[6],layout:f[7],filter:f[8],applyToClusters:f[9],minzoom:f[10],maxzoom:f[11],hoverCursor:f[12],manageHoverState:f[13],eventsIfTopMost:f[14],interactive:f[15],$$slots:{default:[Lg]},$$scope:{ctx:f}};return f[0]!==void 0&&(S.hovered=f[0]),a=new Wh({props:S}),Or.push(()=>fl(a,"hovered",y)),a.$on("click",f[18]),a.$on("dblclick",f[19]),a.$on("contextmenu",f[20]),a.$on("mouseenter",f[21]),a.$on("mousemove",f[22]),a.$on("mouseleave",f[23]),{c(){Vt(a.$$.fragment)},m(k,s){Ot(a,k,s),d=!0},p(k,[s]){const F={};s&2&&(F.id=k[1]),s&4&&(F.source=k[2]),s&8&&(F.sourceLayer=k[3]),s&16&&(F.beforeId=k[4]),s&32&&(F.beforeLayerType=k[5]),s&64&&(F.paint=k[6]),s&128&&(F.layout=k[7]),s&256&&(F.filter=k[8]),s&512&&(F.applyToClusters=k[9]),s&1024&&(F.minzoom=k[10]),s&2048&&(F.maxzoom=k[11]),s&4096&&(F.hoverCursor=k[12]),s&8192&&(F.manageHoverState=k[13]),s&16384&&(F.eventsIfTopMost=k[14]),s&32768&&(F.interactive=k[15]),s&16777216&&(F.$$scope={dirty:s,ctx:k}),!h&&s&1&&(h=!0,F.hovered=k[0],pl(()=>h=!1)),a.$set(F)},i(k){d||(ze(a.$$.fragment,k),d=!0)},o(k){Ve(a.$$.fragment,k),d=!1},d(k){Bt(a,k)}}}function Dg(f,a,h){let{$$slots:d={},$$scope:y}=a,{id:S=Hc("circle")}=a,{source:k=void 0}=a,{sourceLayer:s=void 0}=a,{beforeId:F=void 0}=a,{beforeLayerType:M=void 0}=a,{paint:q}=a,{layout:ie=void 0}=a,{filter:he=void 0}=a,{applyToClusters:xe=void 0}=a,{minzoom:ye=void 0}=a,{maxzoom:ge=void 0}=a,{hoverCursor:fe=void 0}=a,{manageHoverState:Te=!1}=a,{hovered:Pe=null}=a,{eventsIfTopMost:Ke=!1}=a,{interactive:je=!0}=a;function St(Je){Pe=Je,h(0,Pe)}function vt(Je){sr.call(this,f,Je)}function yt(Je){sr.call(this,f,Je)}function zt(Je){sr.call(this,f,Je)}function wt(Je){sr.call(this,f,Je)}function Nt(Je){sr.call(this,f,Je)}function De(Je){sr.call(this,f,Je)}return f.$$set=Je=>{"id"in Je&&h(1,S=Je.id),"source"in Je&&h(2,k=Je.source),"sourceLayer"in Je&&h(3,s=Je.sourceLayer),"beforeId"in Je&&h(4,F=Je.beforeId),"beforeLayerType"in Je&&h(5,M=Je.beforeLayerType),"paint"in Je&&h(6,q=Je.paint),"layout"in Je&&h(7,ie=Je.layout),"filter"in Je&&h(8,he=Je.filter),"applyToClusters"in Je&&h(9,xe=Je.applyToClusters),"minzoom"in Je&&h(10,ye=Je.minzoom),"maxzoom"in Je&&h(11,ge=Je.maxzoom),"hoverCursor"in Je&&h(12,fe=Je.hoverCursor),"manageHoverState"in Je&&h(13,Te=Je.manageHoverState),"hovered"in Je&&h(0,Pe=Je.hovered),"eventsIfTopMost"in Je&&h(14,Ke=Je.eventsIfTopMost),"interactive"in Je&&h(15,je=Je.interactive),"$$scope"in Je&&h(24,y=Je.$$scope)},[Pe,S,k,s,F,M,q,ie,he,xe,ye,ge,fe,Te,Ke,je,d,St,vt,yt,zt,wt,Nt,De,y]}class Ff extends Hi{constructor(a){super(),Wi(this,a,Dg,zg,Vi,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function Fg(f){let a;const h=f[15].default,d=fo(h,f,f[23],null);return{c(){d&&d.c()},m(y,S){d&&d.m(y,S),a=!0},p(y,S){d&&d.p&&(!a||S&8388608)&&_o(d,h,y,y[23],a?mo(h,y[23],S,null):go(y[23]),null)},i(y){a||(ze(d,y),a=!0)},o(y){Ve(d,y),a=!1},d(y){d&&d.d(y)}}}function Rg(f){let a,h,d;function y(k){f[16](k)}let S={id:f[1],type:"fill",source:f[2],sourceLayer:f[3],beforeId:f[4],beforeLayerType:f[5],paint:f[6],layout:f[7],filter:f[8],minzoom:f[9],maxzoom:f[10],hoverCursor:f[11],manageHoverState:f[12],eventsIfTopMost:f[13],interactive:f[14],$$slots:{default:[Fg]},$$scope:{ctx:f}};return f[0]!==void 0&&(S.hovered=f[0]),a=new Wh({props:S}),Or.push(()=>fl(a,"hovered",y)),a.$on("click",f[17]),a.$on("dblclick",f[18]),a.$on("contextmenu",f[19]),a.$on("mouseenter",f[20]),a.$on("mousemove",f[21]),a.$on("mouseleave",f[22]),{c(){Vt(a.$$.fragment)},m(k,s){Ot(a,k,s),d=!0},p(k,[s]){const F={};s&2&&(F.id=k[1]),s&4&&(F.source=k[2]),s&8&&(F.sourceLayer=k[3]),s&16&&(F.beforeId=k[4]),s&32&&(F.beforeLayerType=k[5]),s&64&&(F.paint=k[6]),s&128&&(F.layout=k[7]),s&256&&(F.filter=k[8]),s&512&&(F.minzoom=k[9]),s&1024&&(F.maxzoom=k[10]),s&2048&&(F.hoverCursor=k[11]),s&4096&&(F.manageHoverState=k[12]),s&8192&&(F.eventsIfTopMost=k[13]),s&16384&&(F.interactive=k[14]),s&8388608&&(F.$$scope={dirty:s,ctx:k}),!h&&s&1&&(h=!0,F.hovered=k[0],pl(()=>h=!1)),a.$set(F)},i(k){d||(ze(a.$$.fragment,k),d=!0)},o(k){Ve(a.$$.fragment,k),d=!1},d(k){Bt(a,k)}}}function Og(f,a,h){let{$$slots:d={},$$scope:y}=a,{id:S=Hc("fill")}=a,{source:k=void 0}=a,{sourceLayer:s=void 0}=a,{beforeId:F=void 0}=a,{beforeLayerType:M=void 0}=a,{paint:q}=a,{layout:ie=void 0}=a,{filter:he=void 0}=a,{minzoom:xe=void 0}=a,{maxzoom:ye=void 0}=a,{hoverCursor:ge=void 0}=a,{manageHoverState:fe=!1}=a,{hovered:Te=null}=a,{eventsIfTopMost:Pe=!1}=a,{interactive:Ke=!0}=a;function je(De){Te=De,h(0,Te)}function St(De){sr.call(this,f,De)}function vt(De){sr.call(this,f,De)}function yt(De){sr.call(this,f,De)}function zt(De){sr.call(this,f,De)}function wt(De){sr.call(this,f,De)}function Nt(De){sr.call(this,f,De)}return f.$$set=De=>{"id"in De&&h(1,S=De.id),"source"in De&&h(2,k=De.source),"sourceLayer"in De&&h(3,s=De.sourceLayer),"beforeId"in De&&h(4,F=De.beforeId),"beforeLayerType"in De&&h(5,M=De.beforeLayerType),"paint"in De&&h(6,q=De.paint),"layout"in De&&h(7,ie=De.layout),"filter"in De&&h(8,he=De.filter),"minzoom"in De&&h(9,xe=De.minzoom),"maxzoom"in De&&h(10,ye=De.maxzoom),"hoverCursor"in De&&h(11,ge=De.hoverCursor),"manageHoverState"in De&&h(12,fe=De.manageHoverState),"hovered"in De&&h(0,Te=De.hovered),"eventsIfTopMost"in De&&h(13,Pe=De.eventsIfTopMost),"interactive"in De&&h(14,Ke=De.interactive),"$$scope"in De&&h(23,y=De.$$scope)},[Te,S,k,s,F,M,q,ie,he,xe,ye,ge,fe,Pe,Ke,d,je,St,vt,yt,zt,wt,Nt,y]}class Hh extends Hi{constructor(a){super(),Wi(this,a,Og,Rg,Vi,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function Bg(f,a,h){let d;const{map:y}=Gl();ni(f,y,F=>h(4,d=F));let{position:S="top-left"}=a,{container:k=void 0}=a,s=null;return xs(()=>{d!=null&&d.loaded()&&s&&d.removeControl(s)}),f.$$set=F=>{"position"in F&&h(1,S=F.position),"container"in F&&h(2,k=F.container)},f.$$.update=()=>{if(f.$$.dirty&30&&d&&!s){let F;typeof k=="string"?F=document.querySelector(k)??void 0:F=k,h(3,s=new rs.FullscreenControl({container:F})),d.addControl(s,S)}},[y,S,k,s,d]}class Ng extends Hi{constructor(a){super(),Wi(this,a,Bg,null,Vi,{position:1,container:2})}}function Vg(f,a,h,d,y){let S=!1;f.getSource(a)&&(S=!0,f.removeSource(a));const k=()=>{d(a)&&(f.addSource(a,h),y())};if(S){const s=()=>{a&&(f.getSource(a)?setTimeout(s,1):k())};s()}else k()}function Ug(f,a,h){Q_().then(()=>{let d=W_(f);if(!d)return;d.getSource(a)===h&&d.removeSource(a)})}function Vp(f){let a=f[0],h,d,y=Up(f);return{c(){y.c(),h=ss()},m(S,k){y.m(S,k),Ye(S,h,k),d=!0},p(S,k){k&1&&Vi(a,a=S[0])?(lr(),Ve(y,1,1,vi),cr(),y=Up(S),y.c(),ze(y,1),y.m(h.parentNode,h)):y.p(S,k)},i(S){d||(ze(y),d=!0)},o(S){Ve(y),d=!1},d(S){S&&Xe(h),y.d(S)}}}function Up(f){let a;const h=f[15].default,d=fo(h,f,f[14],null);return{c(){d&&d.c()},m(y,S){d&&d.m(y,S),a=!0},p(y,S){d&&d.p&&(!a||S&16384)&&_o(d,h,y,y[14],a?mo(h,y[14],S,null):go(y[14]),null)},i(y){a||(ze(d,y),a=!0)},o(y){Ve(d,y),a=!1},d(y){d&&d.d(y)}}}function jg(f){let a,h,d=f[0]&&Vp(f);return{c(){d&&d.c(),a=ss()},m(y,S){d&&d.m(y,S),Ye(y,a,S),h=!0},p(y,[S]){y[0]?d?(d.p(y,S),S&1&&ze(d,1)):(d=Vp(y),d.c(),ze(d,1),d.m(a.parentNode,a)):d&&(lr(),Ve(d,1,1,()=>{d=null}),cr())},i(y){h||(ze(d),h=!0)},o(y){Ve(d),h=!1},d(y){y&&Xe(a),d&&d.d(y)}}}function qg(f,a,h){let d,y,S,{$$slots:k={},$$scope:s}=a,{id:F=Hc("geojson")}=a,{data:M}=a,{generateId:q=!1}=a,{promoteId:ie=void 0}=a,{filter:he=void 0}=a,{lineMetrics:xe=void 0}=a,{cluster:ye=void 0}=a;const{map:ge,cluster:fe,self:Te}=Sg();ni(f,ge,je=>h(13,y=je)),ni(f,fe,je=>h(16,S=je)),ni(f,Te,je=>h(0,d=je));let Pe,Ke=!0;return xs(()=>{d&&Pe&&y&&(Ug(ge,d,Pe),fn(Te,d=null,d),h(11,Pe=void 0))}),f.$$set=je=>{"id"in je&&h(4,F=je.id),"data"in je&&h(5,M=je.data),"generateId"in je&&h(6,q=je.generateId),"promoteId"in je&&h(7,ie=je.promoteId),"filter"in je&&h(8,he=je.filter),"lineMetrics"in je&&h(9,xe=je.lineMetrics),"cluster"in je&&h(10,ye=je.cluster),"$$scope"in je&&h(14,s=je.$$scope)},f.$$.update=()=>{f.$$.dirty&1024&&fn(fe,S=ye,S),f.$$.dirty&12273&&y&&d!==F&&(fn(Te,d=F,d),Vg(y,d,zu({type:"geojson",data:M,filter:he,lineMetrics:xe,generateId:q,promoteId:ie,cluster:!!ye,clusterMinPoints:ye==null?void 0:ye.minPoints,clusterMaxZoom:ye==null?void 0:ye.maxZoom,clusterRadius:ye==null?void 0:ye.radius,clusterProperties:ye==null?void 0:ye.properties}),je=>y&&je===d,()=>{d&&(h(11,Pe=y==null?void 0:y.getSource(d)),h(12,Ke=!0))})),f.$$.dirty&8208&&(y==null||y.on("style.load",()=>{h(11,Pe=y==null?void 0:y.getSource(F))})),f.$$.dirty&6176&&Pe&&(Ke?h(12,Ke=!1):Pe.setData(M)),f.$$.dirty&3072&&(Pe==null||Pe.setClusterOptions(zu({cluster:!!ye,clusterMaxZoom:ye==null?void 0:ye.maxZoom,clusterRadius:ye==null?void 0:ye.radius})))},[d,ge,fe,Te,F,M,q,ie,he,xe,ye,Pe,Ke,y,s,k]}class Xa extends Hi{constructor(a){super(),Wi(this,a,qg,jg,Vi,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function Zg(f,a,h){let d;const{map:y}=Gl();ni(f,y,he=>h(8,d=he));let{position:S="top-left"}=a,{positionOptions:k=void 0}=a,{fitBoundsOptions:s=void 0}=a,{trackUserLocation:F=!1}=a,{showAccuracyCircle:M=!0}=a,{showUserLocation:q=!0}=a,ie=null;return xs(()=>{d!=null&&d.loaded()&&ie&&d.removeControl(ie)}),f.$$set=he=>{"position"in he&&h(1,S=he.position),"positionOptions"in he&&h(2,k=he.positionOptions),"fitBoundsOptions"in he&&h(3,s=he.fitBoundsOptions),"trackUserLocation"in he&&h(4,F=he.trackUserLocation),"showAccuracyCircle"in he&&h(5,M=he.showAccuracyCircle),"showUserLocation"in he&&h(6,q=he.showUserLocation)},f.$$.update=()=>{f.$$.dirty&510&&d&&!ie&&(h(7,ie=new rs.GeolocateControl({positionOptions:k,fitBoundsOptions:s,trackUserLocation:F,showAccuracyCircle:M,showUserLocation:q})),d.addControl(ie,S))},[y,S,k,s,F,M,q,ie,d]}class Gg extends Hi{constructor(a){super(),Wi(this,a,Zg,null,Vi,{position:1,positionOptions:2,fitBoundsOptions:3,trackUserLocation:4,showAccuracyCircle:5,showUserLocation:6})}}function Wg(f){let a;const h=f[15].default,d=fo(h,f,f[23],null);return{c(){d&&d.c()},m(y,S){d&&d.m(y,S),a=!0},p(y,S){d&&d.p&&(!a||S&8388608)&&_o(d,h,y,y[23],a?mo(h,y[23],S,null):go(y[23]),null)},i(y){a||(ze(d,y),a=!0)},o(y){Ve(d,y),a=!1},d(y){d&&d.d(y)}}}function Hg(f){let a,h,d;function y(k){f[16](k)}let S={id:f[1],type:"line",source:f[2],sourceLayer:f[3],beforeId:f[4],beforeLayerType:f[5],paint:f[6],layout:f[7],filter:f[8],minzoom:f[9],maxzoom:f[10],hoverCursor:f[11],manageHoverState:f[12],eventsIfTopMost:f[13],interactive:f[14],$$slots:{default:[Wg]},$$scope:{ctx:f}};return f[0]!==void 0&&(S.hovered=f[0]),a=new Wh({props:S}),Or.push(()=>fl(a,"hovered",y)),a.$on("click",f[17]),a.$on("dblclick",f[18]),a.$on("contextmenu",f[19]),a.$on("mouseenter",f[20]),a.$on("mousemove",f[21]),a.$on("mouseleave",f[22]),{c(){Vt(a.$$.fragment)},m(k,s){Ot(a,k,s),d=!0},p(k,[s]){const F={};s&2&&(F.id=k[1]),s&4&&(F.source=k[2]),s&8&&(F.sourceLayer=k[3]),s&16&&(F.beforeId=k[4]),s&32&&(F.beforeLayerType=k[5]),s&64&&(F.paint=k[6]),s&128&&(F.layout=k[7]),s&256&&(F.filter=k[8]),s&512&&(F.minzoom=k[9]),s&1024&&(F.maxzoom=k[10]),s&2048&&(F.hoverCursor=k[11]),s&4096&&(F.manageHoverState=k[12]),s&8192&&(F.eventsIfTopMost=k[13]),s&16384&&(F.interactive=k[14]),s&8388608&&(F.$$scope={dirty:s,ctx:k}),!h&&s&1&&(h=!0,F.hovered=k[0],pl(()=>h=!1)),a.$set(F)},i(k){d||(ze(a.$$.fragment,k),d=!0)},o(k){Ve(a.$$.fragment,k),d=!1},d(k){Bt(a,k)}}}function Xg(f,a,h){let{$$slots:d={},$$scope:y}=a,{id:S=Hc("line")}=a,{source:k=void 0}=a,{sourceLayer:s=void 0}=a,{beforeId:F=void 0}=a,{beforeLayerType:M=void 0}=a,{paint:q}=a,{layout:ie=void 0}=a,{filter:he=void 0}=a,{minzoom:xe=void 0}=a,{maxzoom:ye=void 0}=a,{hoverCursor:ge=void 0}=a,{manageHoverState:fe=!1}=a,{hovered:Te=null}=a,{eventsIfTopMost:Pe=!1}=a,{interactive:Ke=!0}=a;function je(De){Te=De,h(0,Te)}function St(De){sr.call(this,f,De)}function vt(De){sr.call(this,f,De)}function yt(De){sr.call(this,f,De)}function zt(De){sr.call(this,f,De)}function wt(De){sr.call(this,f,De)}function Nt(De){sr.call(this,f,De)}return f.$$set=De=>{"id"in De&&h(1,S=De.id),"source"in De&&h(2,k=De.source),"sourceLayer"in De&&h(3,s=De.sourceLayer),"beforeId"in De&&h(4,F=De.beforeId),"beforeLayerType"in De&&h(5,M=De.beforeLayerType),"paint"in De&&h(6,q=De.paint),"layout"in De&&h(7,ie=De.layout),"filter"in De&&h(8,he=De.filter),"minzoom"in De&&h(9,xe=De.minzoom),"maxzoom"in De&&h(10,ye=De.maxzoom),"hoverCursor"in De&&h(11,ge=De.hoverCursor),"manageHoverState"in De&&h(12,fe=De.manageHoverState),"hovered"in De&&h(0,Te=De.hovered),"eventsIfTopMost"in De&&h(13,Pe=De.eventsIfTopMost),"interactive"in De&&h(14,Ke=De.interactive),"$$scope"in De&&h(23,y=De.$$scope)},[Te,S,k,s,F,M,q,ie,he,xe,ye,ge,fe,Pe,Ke,d,je,St,vt,yt,zt,wt,Nt,y]}class _l extends Hi{constructor(a){super(),Wi(this,a,Xg,Hg,Vi,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function Kg(f){let a=f.getCenter(),h=Math.round(f.getZoom()*100)/100,d=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,d),S=Math.round(a.lat*y)/y,k=Math.round(a.lng*y)/y,s=`${h}/${S}/${k}`,F=f.getBearing(),M=f.getPitch();return(F||M)&&(s+=`/${Math.round(F*10)/10}`),M&&(s+=`/${Math.round(M)}`),`#${s}`}function Jg(f){return f.replace("#","").split("/").map(parseFloat)}var Iu=Xh;function Xh(f,a){return f===a||f!==f&&a!==a?!0:typeof f!=typeof a||{}.toString.call(f)!={}.toString.call(a)||f!==Object(f)||!f?!1:Array.isArray(f)?jp(f,a):{}.toString.call(f)=="[object Set]"?jp(Array.from(f),Array.from(a)):{}.toString.call(f)=="[object Object]"?Qg(f,a):Yg(f,a)}function Yg(f,a){return f.toString()===a.toString()}function jp(f,a){var h=f.length;if(h!=a.length)return!1;for(var d=0;d<h;d++)if(!Xh(f[d],a[d]))return!1;return!0}function Qg(f,a){var h=Object.keys(f),d=h.length;if(d!=Object.keys(a).length)return!1;for(var y=0;y<d;y++){var S=h[y];if(!(a.hasOwnProperty(S)&&Xh(f[S],a[S])))return!1}return!0}function $g(f,a,h){let d;const{map:y}=Gl();ni(f,y,q=>h(6,d=q));let{position:S="top-left"}=a,{showCompass:k=!0}=a,{showZoom:s=!0}=a,{visualizePitch:F=!1}=a,M=null;return xs(()=>{d!=null&&d.loaded()&&M&&d.removeControl(M)}),f.$$set=q=>{"position"in q&&h(1,S=q.position),"showCompass"in q&&h(2,k=q.showCompass),"showZoom"in q&&h(3,s=q.showZoom),"visualizePitch"in q&&h(4,F=q.visualizePitch)},f.$$.update=()=>{f.$$.dirty&126&&d&&!M&&(h(5,M=new rs.NavigationControl({showCompass:k,showZoom:s,visualizePitch:F})),d.addControl(M,S))},[y,S,k,s,F,M,d]}class ey extends Hi{constructor(a){super(),Wi(this,a,$g,null,Vi,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function ty(f,a,h){let d;const{map:y}=Gl();ni(f,y,M=>h(5,d=M));let{position:S="bottom-left"}=a,{maxWidth:k=void 0}=a,{unit:s="metric"}=a,F=null;return xs(()=>{d!=null&&d.loaded()&&F&&d.removeControl(F)}),f.$$set=M=>{"position"in M&&h(1,S=M.position),"maxWidth"in M&&h(2,k=M.maxWidth),"unit"in M&&h(3,s=M.unit)},f.$$.update=()=>{f.$$.dirty&62&&d&&!F&&(h(4,F=new rs.ScaleControl({maxWidth:k,unit:s})),d.addControl(F,S))},[y,S,k,s,F,d]}class iy extends Hi{constructor(a){super(),Wi(this,a,ty,null,Vi,{position:1,maxWidth:2,unit:3})}}const ny=f=>({map:f[0]&8,loadedImages:f[0]&16,allImagesLoaded:f[0]&32}),qp=f=>({map:f[3],loadedImages:f[4],allImagesLoaded:f[5]});function Zp(f){let a,h,d=f[2]&&Gp(f);const y=f[33].default,S=fo(y,f,f[32],qp);return{c(){d&&d.c(),a=Tt(),S&&S.c()},m(k,s){d&&d.m(k,s),Ye(k,a,s),S&&S.m(k,s),h=!0},p(k,s){k[2]?d?(d.p(k,s),s[0]&4&&ze(d,1)):(d=Gp(k),d.c(),ze(d,1),d.m(a.parentNode,a)):d&&(lr(),Ve(d,1,1,()=>{d=null}),cr()),S&&S.p&&(!h||s[0]&56|s[1]&2)&&_o(S,y,k,k[32],h?mo(y,k[32],s,ny):go(k[32]),qp)},i(k){h||(ze(d),ze(S,k),h=!0)},o(k){Ve(d),Ve(S,k),h=!1},d(k){k&&Xe(a),d&&d.d(k),S&&S.d(k)}}}function Gp(f){let a,h,d,y,S,k,s,F;return a=new ey({props:{position:f[6]}}),d=new Gg({props:{position:f[6],fitBoundsOptions:{maxZoom:12}}}),S=new Ng({props:{position:f[6]}}),s=new iy({props:{position:f[6]}}),{c(){Vt(a.$$.fragment),h=Tt(),Vt(d.$$.fragment),y=Tt(),Vt(S.$$.fragment),k=Tt(),Vt(s.$$.fragment)},m(M,q){Ot(a,M,q),Ye(M,h,q),Ot(d,M,q),Ye(M,y,q),Ot(S,M,q),Ye(M,k,q),Ot(s,M,q),F=!0},p(M,q){const ie={};q[0]&64&&(ie.position=M[6]),a.$set(ie);const he={};q[0]&64&&(he.position=M[6]),d.$set(he);const xe={};q[0]&64&&(xe.position=M[6]),S.$set(xe);const ye={};q[0]&64&&(ye.position=M[6]),s.$set(ye)},i(M){F||(ze(a.$$.fragment,M),ze(d.$$.fragment,M),ze(S.$$.fragment,M),ze(s.$$.fragment,M),F=!0)},o(M){Ve(a.$$.fragment,M),Ve(d.$$.fragment,M),Ve(S.$$.fragment,M),Ve(s.$$.fragment,M),F=!1},d(M){M&&(Xe(h),Xe(y),Xe(k)),Bt(a,M),Bt(d,M),Bt(S,M),Bt(s,M)}}}function ry(f){let a,h,d,y,S,k=f[3]&&f[0]&&Zp(f);return{c(){a=Ae("div"),k&&k.c(),yi(a,"class",h=Lp(f[1])+" svelte-p00lfq"),Dp(a,"expand-map",!f[1])},m(s,F){Ye(s,a,F),k&&k.m(a,null),d=!0,y||(S=Dh(f[9].call(null,a)),y=!0)},p(s,F){s[3]&&s[0]?k?(k.p(s,F),F[0]&9&&ze(k,1)):(k=Zp(s),k.c(),ze(k,1),k.m(a,null)):k&&(lr(),Ve(k,1,1,()=>{k=null}),cr()),(!d||F[0]&2&&h!==(h=Lp(s[1])+" svelte-p00lfq"))&&yi(a,"class",h),(!d||F[0]&2)&&Dp(a,"expand-map",!s[1])},i(s){d||(ze(k),d=!0)},o(s){Ve(k),d=!1},d(s){s&&Xe(a),k&&k.d(),y=!1,S()}}}function oy(f,a,h){let d,y,S,k,{$$slots:s={},$$scope:F}=a,{map:M=null}=a,{class:q=void 0}=a,{style:ie}=a,{diffStyleUpdates:he=!1}=a,{center:xe=void 0}=a,{zoom:ye=void 0}=a,{pitch:ge=0}=a,{bearing:fe=0}=a,{bounds:Te=void 0}=a,{hash:Pe=!1}=a,{loaded:Ke=!1}=a,{minZoom:je=0}=a,{maxZoom:St=22}=a,{zoomOnDoubleClick:vt=!0}=a,{interactive:yt=!0}=a,{attributionControl:zt=!0}=a,{preserveDrawingBuffer:wt=!1}=a,{maxBounds:Nt=void 0}=a,{images:De=[]}=a,{standardControls:Je=!1}=a,{filterLayers:$t=void 0}=a,{transformRequest:$e=void 0}=a;const Kt=Wc(),{map:Pt,loadedImages:Lt}=wg();ni(f,Pt,qe=>h(3,S=qe)),ni(f,Lt,qe=>h(4,k=qe));let ui=new Set;function Ln(qe){S!=null&&S.loaded()&&("url"in qe?(ui.add(qe.id),S.loadImage(qe.url,(Gt,it)=>{ui.delete(qe.id),Gt?Kt("error",Gt):it&&(S==null||S.addImage(qe.id,it,qe.options),k.add(qe.id),Lt.set(k))})):(S.addImage(qe.id,qe.data,qe.options),k.add(qe.id),Lt.set(k)))}let zn,Pi,Mi,Ut;function bi(qe){if(Pe){let Gt=Jg(window.location.hash);Gt.length>=3&&(h(11,ye=Gt[0]),h(10,xe=[Gt[2],Gt[1]])),Gt.length==5&&(h(15,fe=Gt[3]),h(14,ge=Gt[4]))}return fn(Pt,S=new rs.Map(zu({container:qe,style:ie,center:xe,zoom:ye,pitch:ge,bearing:fe,minZoom:je,maxZoom:St,interactive:yt,preserveDrawingBuffer:wt,maxBounds:Nt,bounds:Te,attributionControl:zt,transformRequest:$e})),S),S.on("load",Gt=>{h(0,Ke=!0),Kt("load",S)}),S.on("error",Gt=>Kt("error",{...Gt,map:S})),S.on("movestart",Gt=>Kt("movestart",{...Gt,map:S})),S.on("moveend",Gt=>{if(h(10,xe=Gt.target.getCenter()),h(11,ye=Gt.target.getZoom()),h(12,Te=Gt.target.getBounds()),Kt("moveend",{...Gt,map:S}),Pe){let it=window.location.href.replace(/(#.+)?$/,Kg(S));window.history.replaceState(window.history.state,"",it)}}),S.on("zoomstart",Gt=>Kt("zoomstart",{...Gt,map:S})),S.on("zoom",Gt=>{h(11,ye=Gt.target.getZoom()),Kt("zoom",{...Gt,map:S})}),S.on("zoomend",Gt=>{h(11,ye=Gt.target.getZoom()),Kt("zoomend",{...Gt,map:S})}),S.on("style.load",()=>{if(S){const Gt=S.getStyle();if(h(29,zn=Gt.layers.map(it=>it.id)),h(30,Pi=Object.keys(Gt.sources)),Ut)for(const[it,si]of Object.entries(Ut))S.addSource(it,si);if(Mi)for(const it of Mi)S.addLayer(it)}}),S.on("styledata",Gt=>{if(S&&$t){const it=S.getStyle().layers;if(it)for(let si of it)$t(si)||S.setLayoutProperty(si.id,"visibility","none")}Kt("styledata",{...Gt,map:S})}),{destroy(){h(0,Ke=!1),S==null||S.remove(),fn(Pt,S=null,S)}}}let Li=ie;return f.$$set=qe=>{"map"in qe&&h(13,M=qe.map),"class"in qe&&h(1,q=qe.class),"style"in qe&&h(16,ie=qe.style),"diffStyleUpdates"in qe&&h(17,he=qe.diffStyleUpdates),"center"in qe&&h(10,xe=qe.center),"zoom"in qe&&h(11,ye=qe.zoom),"pitch"in qe&&h(14,ge=qe.pitch),"bearing"in qe&&h(15,fe=qe.bearing),"bounds"in qe&&h(12,Te=qe.bounds),"hash"in qe&&h(18,Pe=qe.hash),"loaded"in qe&&h(0,Ke=qe.loaded),"minZoom"in qe&&h(19,je=qe.minZoom),"maxZoom"in qe&&h(20,St=qe.maxZoom),"zoomOnDoubleClick"in qe&&h(21,vt=qe.zoomOnDoubleClick),"interactive"in qe&&h(22,yt=qe.interactive),"attributionControl"in qe&&h(23,zt=qe.attributionControl),"preserveDrawingBuffer"in qe&&h(24,wt=qe.preserveDrawingBuffer),"maxBounds"in qe&&h(25,Nt=qe.maxBounds),"images"in qe&&h(26,De=qe.images),"standardControls"in qe&&h(2,Je=qe.standardControls),"filterLayers"in qe&&h(27,$t=qe.filterLayers),"transformRequest"in qe&&h(28,$e=qe.transformRequest),"$$scope"in qe&&h(32,F=qe.$$scope)},f.$$.update=()=>{if(f.$$.dirty[0]&4&&h(6,d=typeof Je=="boolean"?void 0:Je),f.$$.dirty[0]&8&&h(13,M=S),f.$$.dirty[0]&67108873&&Ke&&S!=null&&S.loaded())for(let qe of De)!ui.has(qe.id)&&!S.hasImage(qe.id)&&Ln(qe);if(f.$$.dirty[0]&67108880&&h(5,y=De.every(qe=>k.has(qe.id))),f.$$.dirty[0]&1610809352|f.$$.dirty[1]&1&&S&&!Iu(ie,Li)){const qe=S.getStyle();if(zn&&(Mi=qe.layers.filter(Gt=>!zn.includes(Gt.id))),Pi){const Gt=Object.keys(qe.sources).filter(it=>!Pi.includes(it));Ut={};for(const it of Gt)Ut[it]=qe.sources[it]}h(31,Li=ie),S.setStyle(ie,{diff:he})}f.$$.dirty[0]&1032&&xe&&!Iu(xe,S==null?void 0:S.getCenter())&&(S==null||S.panTo(xe)),f.$$.dirty[0]&2056&&ye&&!Iu(ye,S==null?void 0:S.getZoom())&&(S==null||S.zoomTo(ye)),f.$$.dirty[0]&4104&&Te&&!Iu(Te,S==null?void 0:S.getBounds())&&(S==null||S.fitBounds(Te)),f.$$.dirty[0]&2097160&&(vt?S==null||S.doubleClickZoom.enable():S==null||S.doubleClickZoom.disable())},[Ke,q,Je,S,k,y,d,Pt,Lt,bi,xe,ye,Te,M,ge,fe,ie,he,Pe,je,St,vt,yt,zt,wt,Nt,De,$t,$e,zn,Pi,Li,F,s]}class sy extends Hi{constructor(a){super(),Wi(this,a,oy,ry,Vi,{map:13,class:1,style:16,diffStyleUpdates:17,center:10,zoom:11,pitch:14,bearing:15,bounds:12,hash:18,loaded:0,minZoom:19,maxZoom:20,zoomOnDoubleClick:21,interactive:22,attributionControl:23,preserveDrawingBuffer:24,maxBounds:25,images:26,standardControls:2,filterLayers:27,transformRequest:28},null,[-1,-1])}}function ay(f){let a,h,d,y,S,k,s;const F=f[16].default,M=fo(F,f,f[15],null);return{c(){a=Ae("div"),M&&M.c(),yi(a,"tabindex",h=f[1]?0:void 0),yi(a,"role",d=f[1]?"button":void 0),Ul(a,"z-index",f[2])},m(q,ie){Ye(q,a,ie),M&&M.m(a,null),S=!0,k||(s=[Dh(f[6].call(null,a)),Dh(y=ly.call(null,a,f[0])),fi(a,"click",f[17]),fi(a,"dblclick",f[18]),fi(a,"contextmenu",f[19]),fi(a,"mouseenter",f[20]),fi(a,"mouseleave",f[21]),fi(a,"mousemove",f[22]),fi(a,"keydown",f[7])],k=!0)},p(q,[ie]){M&&M.p&&(!S||ie&32768)&&_o(M,F,q,q[15],S?mo(F,q[15],ie,null):go(q[15]),null),(!S||ie&2&&h!==(h=q[1]?0:void 0))&&yi(a,"tabindex",h),(!S||ie&2&&d!==(d=q[1]?"button":void 0))&&yi(a,"role",d),y&&Du(y.update)&&ie&1&&y.update.call(null,q[0]),ie&4&&Ul(a,"z-index",q[2])},i(q){S||(ze(M,q),S=!0)},o(q){Ve(M,q),S=!1},d(q){q&&Xe(a),M&&M.d(q),k=!1,os(s)}}}function ly(f,a){const h=f.className;function d(y){y?f.className=`${h} ${y}`:f.className=h}return d(a),{update:d}}function cy(f,a,h){let d,y,S,{$$slots:k={},$$scope:s}=a,{lngLat:F}=a,{class:M=void 0}=a,{interactive:q=!0}=a,{asButton:ie=!1}=a,{draggable:he=!1}=a,{feature:xe=null}=a,{offset:ye=void 0}=a,{zIndex:ge=void 0}=a;const fe=Wc(),{map:Te,layerEvent:Pe,self:Ke}=Ig();ni(f,Te,$e=>h(24,S=$e)),ni(f,Pe,$e=>h(23,d=$e)),ni(f,Ke,$e=>h(14,y=$e));function je($e){fn(Ke,y=new rs.Marker({element:$e,draggable:he,offset:ye}).setLngLat(F).addTo(S),y);const Kt=()=>yt("dragstart"),Pt=()=>{St(),yt("drag")},Lt=()=>{St(),yt("dragend")};return he&&(y.on("dragstart",Kt),y.on("drag",Pt),y.on("dragend",Lt)),{destroy(){he&&(y==null||y.off("dragstart",Kt),y==null||y.off("drag",Pt),y==null||y.off("dragend",Lt)),y==null||y.remove()}}}function St(){let $e=y==null?void 0:y.getLngLat();$e&&(Array.isArray(F)?h(9,F=[$e.lng,$e.lat]):F&&"lon"in F?h(9,F={lon:$e.lng,lat:$e.lat}):h(9,F=$e))}function vt($e){$e.key===" "&&($e.preventDefault(),$e.stopPropagation(),yt("click"))}function yt($e){if(!q)return;let Kt=y==null?void 0:y.getLngLat();if(!Kt)return;const Pt=[Kt.lng,Kt.lat];let Lt={map:S,marker:y,lngLat:Pt,features:[{type:"Feature",properties:(xe==null?void 0:xe.properties)??{},geometry:{type:"Point",coordinates:Pt}}]};fn(Pe,d={...Lt,layerType:"marker",type:$e},d),fe($e,Lt)}const zt=()=>yt("click"),wt=()=>yt("dblclick"),Nt=()=>yt("contextmenu"),De=$e=>{yt("mouseenter")},Je=()=>{yt("mouseleave")},$t=()=>yt("mousemove");return f.$$set=$e=>{"lngLat"in $e&&h(9,F=$e.lngLat),"class"in $e&&h(0,M=$e.class),"interactive"in $e&&h(10,q=$e.interactive),"asButton"in $e&&h(1,ie=$e.asButton),"draggable"in $e&&h(11,he=$e.draggable),"feature"in $e&&h(12,xe=$e.feature),"offset"in $e&&h(13,ye=$e.offset),"zIndex"in $e&&h(2,ge=$e.zIndex),"$$scope"in $e&&h(15,s=$e.$$scope)},f.$$.update=()=>{f.$$.dirty&16896&&(y==null||y.setLngLat(F)),f.$$.dirty&24576&&(y==null||y.setOffset(ye??[0,0]))},[M,ie,ge,Te,Pe,Ke,je,vt,yt,F,q,he,xe,ye,y,s,k,zt,wt,Nt,De,Je,$t]}class Wp extends Hi{constructor(a){super(),Wi(this,a,cy,ay,Vi,{lngLat:9,class:0,interactive:10,asButton:1,draggable:11,feature:12,offset:13,zIndex:2})}}const uy=f=>({features:f[0]&16,data:f[0]&16,map:f[0]&4,close:f[0]&1}),Hp=f=>{var a;return{features:f[4],data:(a=f[4])==null?void 0:a[0],map:f[2],close:f[31]}};function Xp(f){let a,h,d=(f[4]||f[3]instanceof rs.Marker)&&Kp(f);return{c(){a=Ae("div"),d&&d.c()},m(y,S){Ye(y,a,S),d&&d.m(a,null),f[32](a),h=!0},p(y,S){y[4]||y[3]instanceof rs.Marker?d?(d.p(y,S),S[0]&24&&ze(d,1)):(d=Kp(y),d.c(),ze(d,1),d.m(a,null)):d&&(lr(),Ve(d,1,1,()=>{d=null}),cr())},i(y){h||(ze(d),h=!0)},o(y){Ve(d),h=!1},d(y){y&&Xe(a),d&&d.d(),f[32](null)}}}function Kp(f){let a;const h=f[30].default,d=fo(h,f,f[29],Hp);return{c(){d&&d.c()},m(y,S){d&&d.m(y,S),a=!0},p(y,S){d&&d.p&&(!a||S[0]&536870933)&&_o(d,h,y,y[29],a?mo(h,y[29],S,uy):go(y[29]),Hp)},i(y){a||(ze(d,y),a=!0)},o(y){Ve(d,y),a=!1},d(y){d&&d.d(y)}}}function hy(f){let a,h,d=f[9].default&&Xp(f);return{c(){d&&d.c(),a=ss()},m(y,S){d&&d.m(y,S),Ye(y,a,S),h=!0},p(y,S){y[9].default?d?(d.p(y,S),S[0]&512&&ze(d,1)):(d=Xp(y),d.c(),ze(d,1),d.m(a.parentNode,a)):d&&(lr(),Ve(d,1,1,()=>{d=null}),cr())},i(y){h||(ze(d),h=!0)},o(y){Ve(d),h=!1},d(y){y&&Xe(a),d&&d.d(y)}}}function dy(f,a,h){let d,y,S,k,s,F,{$$slots:M={},$$scope:q}=a;const ie=H_(M);let{closeButton:he=void 0}=a,{closeOnClickOutside:xe=!0}=a,{closeOnClickInside:ye=!1}=a,{closeOnMove:ge=!1}=a,{openOn:fe="click"}=a,{openIfTopMost:Te=!0}=a,{focusAfterOpen:Pe=!0}=a,{anchor:Ke=void 0}=a,{offset:je=void 0}=a,{popupClass:St=void 0}=a,{maxWidth:vt=void 0}=a,{lngLat:yt=void 0}=a,{html:zt=void 0}=a,{open:wt=!1}=a;const{map:Nt,popupTarget:De,layerEvent:Je,layer:$t,eventTopMost:$e}=Gl();ni(f,Nt,Ze=>h(2,S=Ze)),ni(f,De,Ze=>h(3,s=Ze)),ni(f,Je,Ze=>h(28,k=Ze)),ni(f,$t,Ze=>h(35,F=Ze));const Kt=["click","dblclick","contextmenu"];let Pt,Lt=!1,ui;function Ln(){if(!Pt)return;let Ze=Pt.getElement();!Ze||Ze===ui||(ui=Ze,fe==="hover"&&(ui.style.pointerEvents="none"),ui.addEventListener("mouseenter",()=>{h(24,Lt=!0)},{passive:!0}),ui.addEventListener("mouseleave",()=>{h(24,Lt=!1)},{passive:!0}),ui.addEventListener("click",()=>{ye&&h(0,wt=!1)},{passive:!0}))}Gc(()=>{if(S)return S.on("click",si),S.on("contextmenu",si),typeof s=="string"&&(S.on("click",s,Ut),S.on("dblclick",s,Ut),S.on("contextmenu",s,Ut),S.on("mousemove",s,it),S.on("mouseleave",s,Gt),S.on("touchstart",s,Li),S.on("touchend",s,qe)),()=>{S!=null&&S.loaded()&&(Pt==null||Pt.remove(),S.off("click",si),S.off("contextmenu",si),s instanceof rs.Marker?s.getPopup()===Pt&&s.setPopup(void 0):typeof s=="string"&&(S.off("click",s,Ut),S.off("dblclick",s,Ut),S.off("contextmenu",s,Ut),S.off("mousemove",s,it),S.off("mouseleave",s,Gt),S.off("touchstart",s,Li),S.off("touchend",s,qe)))}});function zn(Ze){return Te?!("marker"in Ze)&&!Cg(Ze)&&$e(Ze)!==F:!1}let Pi=null,Mi="normal";function Ut(Ze){Ze.type===fe&&(zn(Ze)||("layerType"in Ze?Ze.layerType==="deckgl"?(h(10,yt=Ze.coordinate),h(4,Pi=Ze.object?[Ze.object]:null)):(h(10,yt=Ze.lngLat),h(4,Pi=Ze.features??[])):(h(10,yt=Ze.lngLat),h(4,Pi=Ze.features??[])),setTimeout(()=>h(0,wt=!0))))}let bi=null;function Li(Ze){bi=Ze.point}function qe(Ze){if(!bi||fe!=="hover")return;let Ui=bi.dist(Ze.point);bi=null,Ui<3&&(h(10,yt=Ze.lngLat),h(4,Pi=Ze.features??[]),Pt.isOpen()?h(25,Mi="justOpened"):(h(25,Mi="opening"),h(0,wt=!0)))}function Gt(Ze){fe!=="hover"||bi||Mi!=="normal"||(h(0,wt=!1),h(4,Pi=null))}function it(Ze){if(!(fe!=="hover"||bi||Mi!=="normal")){if(zn(Ze)){h(0,wt=!1),h(4,Pi=null);return}h(0,wt=!0),h(4,Pi=Ze.features??[]),h(10,yt=Ze.lngLat)}}function si(Ze){if(Mi==="justOpened"){h(25,Mi="normal");return}if(!xe)return;let Ui=[ui,s instanceof rs.Marker?s==null?void 0:s.getElement():null];wt&&Pt.isOpen()&&!Ui.some(bn=>bn==null?void 0:bn.contains(Ze.originalEvent.target))&&(Ze.type==="contextmenu"&&fe==="contextmenu"||Ze.type!=="contextmenu")&&h(0,wt=!1)}let gt;const Xi=()=>h(0,wt=!1);function Qi(Ze){Or[Ze?"unshift":"push"](()=>{gt=Ze,h(1,gt)})}return f.$$set=Ze=>{"closeButton"in Ze&&h(11,he=Ze.closeButton),"closeOnClickOutside"in Ze&&h(12,xe=Ze.closeOnClickOutside),"closeOnClickInside"in Ze&&h(13,ye=Ze.closeOnClickInside),"closeOnMove"in Ze&&h(14,ge=Ze.closeOnMove),"openOn"in Ze&&h(15,fe=Ze.openOn),"openIfTopMost"in Ze&&h(16,Te=Ze.openIfTopMost),"focusAfterOpen"in Ze&&h(17,Pe=Ze.focusAfterOpen),"anchor"in Ze&&h(18,Ke=Ze.anchor),"offset"in Ze&&h(19,je=Ze.offset),"popupClass"in Ze&&h(20,St=Ze.popupClass),"maxWidth"in Ze&&h(21,vt=Ze.maxWidth),"lngLat"in Ze&&h(10,yt=Ze.lngLat),"html"in Ze&&h(22,zt=Ze.html),"open"in Ze&&h(0,wt=Ze.open),"$$scope"in Ze&&h(29,q=Ze.$$scope)},f.$$.update=()=>{if(f.$$.dirty[0]&14336&&h(27,d=he??(!xe&&!ye)),f.$$.dirty[0]&146685952&&(Pt||(h(23,Pt=new rs.Popup({closeButton:d,closeOnClick:!1,closeOnMove:ge,focusAfterOpen:Pe,maxWidth:vt,className:St,anchor:Ke,offset:je})),ui=Pt.getElement(),Pt.on("open",()=>{h(0,wt=!0),Ln()}),Pt.on("close",Ze=>{h(0,wt=!1)}))),f.$$.dirty[0]&8421384&&Pt&&s instanceof rs.Marker&&(fe==="click"?s.setPopup(Pt):s.getPopup()===Pt&&s.setPopup(void 0)),f.$$.dirty[0]&268468224&&Kt.includes(fe)&&(k==null?void 0:k.type)===fe&&(Ut(k),fn(Je,k=null,k)),f.$$.dirty[0]&268468224&&h(26,y=fe==="hover"&&((k==null?void 0:k.type)==="mousemove"||(k==null?void 0:k.type)==="mouseenter")),f.$$.dirty[0]&352354304&&fe==="hover"&&Je&&(y&&k&&(k.layerType==="deckgl"?(h(10,yt=k.coordinate),h(4,Pi=k.object?[k.object]:null)):(h(10,yt=k.lngLat),h(4,Pi=k.features??[]))),h(0,wt=(y||Lt)??!1)),f.$$.dirty[0]&12582914&&(gt?Pt.setDOMContent(gt):zt&&Pt.setHTML(zt)),f.$$.dirty[0]&8389632&&yt&&Pt.setLngLat(yt),f.$$.dirty[0]&41943045&&S){let Ze=Pt.isOpen();wt&&!Ze?(Pt.addTo(S),Mi==="opening"&&h(25,Mi="justOpened")):!wt&&Ze&&Pt.remove()}},[wt,gt,S,s,Pi,Nt,De,Je,$t,ie,yt,he,xe,ye,ge,fe,Te,Pe,Ke,je,St,vt,zt,Pt,Lt,Mi,y,d,k,q,M,Xi,Qi]}class Fu extends Hi{constructor(a){super(),Wi(this,a,dy,hy,Vi,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}var Xc=Uint8Array,Rf=Uint16Array,py=Int32Array,fy=new Xc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),my=new Xc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Of=function(f,a){for(var h=new Rf(31),d=0;d<31;++d)h[d]=a+=1<<f[d-1];for(var y=new py(h[30]),d=1;d<30;++d)for(var S=h[d];S<h[d+1];++S)y[S]=S-h[d]<<5|d;return{b:h,r:y}},Bf=Of(fy,2),_y=Bf.b,gy=Bf.r;_y[28]=258,gy[258]=28;Of(my,0);var yy=new Rf(32768);for(Yi=0;Yi<32768;++Yi)la=(Yi&43690)>>1|(Yi&21845)<<1,la=(la&52428)>>2|(la&13107)<<2,la=(la&61680)>>4|(la&3855)<<4,yy[Yi]=((la&65280)>>8|(la&255)<<8)>>1;var la,Yi,Ru=new Xc(288);for(Yi=0;Yi<144;++Yi)Ru[Yi]=8;var Yi;for(Yi=144;Yi<256;++Yi)Ru[Yi]=9;var Yi;for(Yi=256;Yi<280;++Yi)Ru[Yi]=7;var Yi;for(Yi=280;Yi<288;++Yi)Ru[Yi]=8;var Yi,vy=new Xc(32);for(Yi=0;Yi<32;++Yi)vy[Yi]=5;var Yi,by=new Xc(0),xy=typeof TextDecoder<"u"&&new TextDecoder,wy=0;try{xy.decode(by,{stream:!0}),wy=1}catch{}const Sy=f=>({}),Jp=f=>({}),Ty=f=>({}),Yp=f=>({});function Iy(f){let a,h,d,y;const S=f[1].left,k=fo(S,f,f[0],Yp),s=f[1].main,F=fo(s,f,f[0],Jp);return{c(){a=Ae("div"),k&&k.c(),h=Tt(),d=Ae("div"),F&&F.c(),yi(a,"class","left svelte-6kzmjs"),yi(d,"class","main svelte-6kzmjs")},m(M,q){Ye(M,a,q),k&&k.m(a,null),Ye(M,h,q),Ye(M,d,q),F&&F.m(d,null),y=!0},p(M,[q]){k&&k.p&&(!y||q&1)&&_o(k,S,M,M[0],y?mo(S,M[0],q,Ty):go(M[0]),Yp),F&&F.p&&(!y||q&1)&&_o(F,s,M,M[0],y?mo(s,M[0],q,Sy):go(M[0]),Jp)},i(M){y||(ze(k,M),ze(F,M),y=!0)},o(M){Ve(k,M),Ve(F,M),y=!1},d(M){M&&(Xe(a),Xe(h),Xe(d)),k&&k.d(M),F&&F.d(M)}}}function Cy(f,a,h){let{$$slots:d={},$$scope:y}=a;return f.$$set=S=>{"$$scope"in S&&h(0,y=S.$$scope)},[y,d]}class Ey extends Hi{constructor(a){super(),Wi(this,a,Cy,Iy,Vi,{})}}function Qp(f){let a,h;return{c(){a=Ae("div"),h=Gi(f[0]),yi(a,"class","svelte-1uuov7f")},m(d,y){Ye(d,a,y),Ee(a,h)},p(d,y){y&1&&Rs(h,d[0])},d(d){d&&Xe(a)}}}function ky(f){let a,h=f[0]&&Qp(f);return{c(){h&&h.c(),a=ss()},m(d,y){h&&h.m(d,y),Ye(d,a,y)},p(d,[y]){d[0]?h?h.p(d,y):(h=Qp(d),h.c(),h.m(a.parentNode,a)):h&&(h.d(1),h=null)},i:vi,o:vi,d(d){d&&Xe(a),h&&h.d(d)}}}function My(f,a,h){let{msg:d=null}=a;return f.$$set=y=>{"msg"in y&&h(0,d=y.msg)},[d]}class Nf extends Hi{constructor(a){super(),Wi(this,a,My,ky,Vi,{msg:0})}}const Ay=f=>({dialog:f&1}),$p=f=>({dialog:f[0]});function Py(f){let a,h,d,y,S;const k=f[2].default,s=fo(k,f,f[1],$p);return{c(){a=Ae("dialog"),h=Ae("div"),s&&s.c(),yi(h,"class","svelte-1u3y8t2"),a.open=!0,yi(a,"class","svelte-1u3y8t2")},m(F,M){Ye(F,a,M),Ee(a,h),s&&s.m(h,null),f[4](a),d=!0,y||(S=fi(a,"close",f[3]),y=!0)},p(F,[M]){s&&s.p&&(!d||M&3)&&_o(s,k,F,F[1],d?mo(k,F[1],M,Ay):go(F[1]),$p)},i(F){d||(ze(s,F),d=!0)},o(F){Ve(s,F),d=!1},d(F){F&&Xe(a),s&&s.d(F),f[4](null),y=!1,S()}}}function Ly(f,a,h){let{$$slots:d={},$$scope:y}=a,S;function k(F){sr.call(this,f,F)}function s(F){Or[F?"unshift":"push"](()=>{S=F,h(0,S)})}return f.$$set=F=>{"$$scope"in F&&h(1,y=F.$$scope)},[S,y,d,k,s]}class Vf extends Hi{constructor(a){super(),Wi(this,a,Ly,Py,Vi,{})}}var Uf={exports:{}};(function(f,a){(function(h,d){f.exports=d()})(Vl,function(){var h=function(v,E){var V={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},Q={on:function(le,be,Ge){if(V[le]===void 0)throw new Error("Invalid event type: "+le);V[le].push({selector:be,fn:Ge})},render:function(le){E.store.featureChanged(le)}},se=function(le,be){for(var Ge=V[le],Qe=Ge.length;Qe--;){var dt=Ge[Qe];if(dt.selector(be)){dt.fn.call(Q,be)||E.store.render(),E.ui.updateMapClasses();break}}};return v.start.call(Q),{render:v.render,stop:function(){v.stop&&v.stop()},trash:function(){v.trash&&(v.trash(),E.store.render())},combineFeatures:function(){v.combineFeatures&&v.combineFeatures()},uncombineFeatures:function(){v.uncombineFeatures&&v.uncombineFeatures()},drag:function(le){se("drag",le)},click:function(le){se("click",le)},mousemove:function(le){se("mousemove",le)},mousedown:function(le){se("mousedown",le)},mouseup:function(le){se("mouseup",le)},mouseout:function(le){se("mouseout",le)},keydown:function(le){se("keydown",le)},keyup:function(le){se("keyup",le)},touchstart:function(le){se("touchstart",le)},touchmove:function(le){se("touchmove",le)},touchend:function(le){se("touchend",le)},tap:function(le){se("tap",le)}}};function d(v){return v&&v.__esModule&&Object.prototype.hasOwnProperty.call(v,"default")?v.default:v}function y(v){if(v.__esModule)return v;var E=v.default;if(typeof E=="function"){var V=function Q(){if(this instanceof Q){var se=[null];se.push.apply(se,arguments);var le=Function.bind.apply(E,se);return new le}return E.apply(this,arguments)};V.prototype=E.prototype}else V={};return Object.defineProperty(V,"__esModule",{value:!0}),Object.keys(v).forEach(function(Q){var se=Object.getOwnPropertyDescriptor(v,Q);Object.defineProperty(V,Q,se.get?se:{enumerable:!0,get:function(){return v[Q]}})}),V}var S={},k={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},s=k;function F(v){var E=0;if(v&&v.length>0){E+=Math.abs(M(v[0]));for(var V=1;V<v.length;V++)E-=Math.abs(M(v[V]))}return E}function M(v){var E,V,Q,se,le,be,Ge=0,Qe=v.length;if(Qe>2){for(be=0;be<Qe;be++)be===Qe-2?(Q=Qe-2,se=Qe-1,le=0):be===Qe-1?(Q=Qe-1,se=0,le=1):(Q=be,se=be+1,le=be+2),E=v[Q],V=v[se],Ge+=(q(v[le][0])-q(E[0]))*Math.sin(q(V[1]));Ge=Ge*s.RADIUS*s.RADIUS/2}return Ge}function q(v){return v*Math.PI/180}S.geometry=function v(E){var V,Q=0;switch(E.type){case"Polygon":return F(E.coordinates);case"MultiPolygon":for(V=0;V<E.coordinates.length;V++)Q+=F(E.coordinates[V]);return Q;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(V=0;V<E.geometries.length;V++)Q+=v(E.geometries[V]);return Q}},S.ring=M;var ie={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},he={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},xe={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},ye={POLYGON:"polygon",LINE:"line_string",POINT:"point"},ge={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},fe={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},Te={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Pe={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},Ke={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},je={ACTIVE:"true",INACTIVE:"false"},St=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],vt=-85,yt=Object.freeze({__proto__:null,classes:ie,sources:he,cursors:xe,types:ye,geojsonTypes:ge,modes:fe,events:Te,updateActions:Pe,meta:Ke,activeStates:je,interactions:St,LAT_MIN:-90,LAT_RENDERED_MIN:vt,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),zt={Point:0,LineString:1,MultiLineString:1,Polygon:2};function wt(v,E){var V=zt[v.geometry.type]-zt[E.geometry.type];return V===0&&v.geometry.type===ge.POLYGON?v.area-E.area:V}function Nt(v){return v.map(function(E){return E.geometry.type===ge.POLYGON&&(E.area=S.geometry({type:ge.FEATURE,property:{},geometry:E.geometry})),E}).sort(wt).map(function(E){return delete E.area,E})}function De(v,E){return E===void 0&&(E=0),[[v.point.x-E,v.point.y-E],[v.point.x+E,v.point.y+E]]}function Je(v){if(this._items={},this._nums={},this._length=v?v.length:0,v)for(var E=0,V=v.length;E<V;E++)this.add(v[E]),v[E]!==void 0&&(typeof v[E]=="string"?this._items[v[E]]=E:this._nums[v[E]]=E)}Je.prototype.add=function(v){return this.has(v)||(this._length++,typeof v=="string"?this._items[v]=this._length:this._nums[v]=this._length),this},Je.prototype.delete=function(v){return this.has(v)===!1||(this._length--,delete this._items[v],delete this._nums[v]),this},Je.prototype.has=function(v){return(typeof v=="string"||typeof v=="number")&&(this._items[v]!==void 0||this._nums[v]!==void 0)},Je.prototype.values=function(){var v=this,E=[];return Object.keys(this._items).forEach(function(V){E.push({k:V,v:v._items[V]})}),Object.keys(this._nums).forEach(function(V){E.push({k:JSON.parse(V),v:v._nums[V]})}),E.sort(function(V,Q){return V.v-Q.v}).map(function(V){return V.k})},Je.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var $t=[Ke.FEATURE,Ke.MIDPOINT,Ke.VERTEX],$e={click:function(v,E,V){return Kt(v,E,V,V.options.clickBuffer)},touch:function(v,E,V){return Kt(v,E,V,V.options.touchBuffer)}};function Kt(v,E,V,Q){if(V.map===null)return[];var se=v?De(v,Q):E,le={};V.options.styles&&(le.layers=V.options.styles.map(function(dt){return dt.id}).filter(function(dt){return V.map.getLayer(dt)!=null}));var be=V.map.queryRenderedFeatures(se,le).filter(function(dt){return $t.indexOf(dt.properties.meta)!==-1}),Ge=new Je,Qe=[];return be.forEach(function(dt){var ft=dt.properties.id;Ge.has(ft)||(Ge.add(ft),Qe.push(dt))}),Nt(Qe)}function Pt(v,E){var V=$e.click(v,null,E),Q={mouse:xe.NONE};return V[0]&&(Q.mouse=V[0].properties.active===je.ACTIVE?xe.MOVE:xe.POINTER,Q.feature=V[0].properties.meta),E.events.currentModeName().indexOf("draw")!==-1&&(Q.mouse=xe.ADD),E.ui.queueMapClasses(Q),E.ui.updateMapClasses(),V[0]}function Lt(v,E){var V=v.x-E.x,Q=v.y-E.y;return Math.sqrt(V*V+Q*Q)}function ui(v,E,V){V===void 0&&(V={});var Q=V.fineTolerance!=null?V.fineTolerance:4,se=V.grossTolerance!=null?V.grossTolerance:12,le=V.interval!=null?V.interval:500;v.point=v.point||E.point,v.time=v.time||E.time;var be=Lt(v.point,E.point);return be<Q||be<se&&E.time-v.time<le}function Ln(v,E,V){V===void 0&&(V={});var Q=V.tolerance!=null?V.tolerance:25,se=V.interval!=null?V.interval:250;return v.point=v.point||E.point,v.time=v.time||E.time,Lt(v.point,E.point)<Q&&E.time-v.time<se}var zn={exports:{}},Pi=zn.exports=function(v,E){if(E||(E=16),v===void 0&&(v=128),v<=0)return"0";for(var V=Math.log(Math.pow(2,v))/Math.log(E),Q=2;V===1/0;Q*=2)V=Math.log(Math.pow(2,v/Q))/Math.log(E)*Q;var se=V-Math.floor(V),le="";for(Q=0;Q<Math.floor(V);Q++)le=Math.floor(Math.random()*E).toString(E)+le;if(se){var be=Math.pow(E,se);le=Math.floor(Math.random()*be).toString(E)+le}var Ge=parseInt(le,E);return Ge!==1/0&&Ge>=Math.pow(2,v)?Pi(v,E):le};Pi.rack=function(v,E,V){var Q=function(le){var be=0;do{if(be++>10){if(!V)throw new Error("too many ID collisions, use more bits");v+=V}var Ge=Pi(v,E)}while(Object.hasOwnProperty.call(se,Ge));return se[Ge]=le,Ge},se=Q.hats={};return Q.get=function(le){return Q.hats[le]},Q.set=function(le,be){return Q.hats[le]=be,Q},Q.bits=v||128,Q.base=E||16,Q};var Mi=d(zn.exports),Ut=function(v,E){this.ctx=v,this.properties=E.properties||{},this.coordinates=E.geometry.coordinates,this.id=E.id||Mi(),this.type=E.geometry.type};Ut.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},Ut.prototype.incomingCoords=function(v){this.setCoordinates(v)},Ut.prototype.setCoordinates=function(v){this.coordinates=v,this.changed()},Ut.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},Ut.prototype.setProperty=function(v,E){this.properties[v]=E},Ut.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:ge.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},Ut.prototype.internal=function(v){var E={id:this.id,meta:Ke.FEATURE,"meta:type":this.type,active:je.INACTIVE,mode:v};if(this.ctx.options.userProperties)for(var V in this.properties)E["user_"+V]=this.properties[V];return{type:ge.FEATURE,properties:E,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var bi=function(v,E){Ut.call(this,v,E)};(bi.prototype=Object.create(Ut.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},bi.prototype.updateCoordinate=function(v,E,V){this.coordinates=arguments.length===3?[E,V]:[v,E],this.changed()},bi.prototype.getCoordinate=function(){return this.getCoordinates()};var Li=function(v,E){Ut.call(this,v,E)};(Li.prototype=Object.create(Ut.prototype)).isValid=function(){return this.coordinates.length>1},Li.prototype.addCoordinate=function(v,E,V){this.changed();var Q=parseInt(v,10);this.coordinates.splice(Q,0,[E,V])},Li.prototype.getCoordinate=function(v){var E=parseInt(v,10);return JSON.parse(JSON.stringify(this.coordinates[E]))},Li.prototype.removeCoordinate=function(v){this.changed(),this.coordinates.splice(parseInt(v,10),1)},Li.prototype.updateCoordinate=function(v,E,V){var Q=parseInt(v,10);this.coordinates[Q]=[E,V],this.changed()};var qe=function(v,E){Ut.call(this,v,E),this.coordinates=this.coordinates.map(function(V){return V.slice(0,-1)})};(qe.prototype=Object.create(Ut.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(v){return v.length>2})},qe.prototype.incomingCoords=function(v){this.coordinates=v.map(function(E){return E.slice(0,-1)}),this.changed()},qe.prototype.setCoordinates=function(v){this.coordinates=v,this.changed()},qe.prototype.addCoordinate=function(v,E,V){this.changed();var Q=v.split(".").map(function(se){return parseInt(se,10)});this.coordinates[Q[0]].splice(Q[1],0,[E,V])},qe.prototype.removeCoordinate=function(v){this.changed();var E=v.split(".").map(function(Q){return parseInt(Q,10)}),V=this.coordinates[E[0]];V&&(V.splice(E[1],1),V.length<3&&this.coordinates.splice(E[0],1))},qe.prototype.getCoordinate=function(v){var E=v.split(".").map(function(Q){return parseInt(Q,10)}),V=this.coordinates[E[0]];return JSON.parse(JSON.stringify(V[E[1]]))},qe.prototype.getCoordinates=function(){return this.coordinates.map(function(v){return v.concat([v[0]])})},qe.prototype.updateCoordinate=function(v,E,V){this.changed();var Q=v.split("."),se=parseInt(Q[0],10),le=parseInt(Q[1],10);this.coordinates[se]===void 0&&(this.coordinates[se]=[]),this.coordinates[se][le]=[E,V]};var Gt={MultiPoint:bi,MultiLineString:Li,MultiPolygon:qe},it=function(v,E,V,Q,se){var le=V.split("."),be=parseInt(le[0],10),Ge=le[1]?le.slice(1).join("."):null;return v[be][E](Ge,Q,se)},si=function(v,E){if(Ut.call(this,v,E),delete this.coordinates,this.model=Gt[E.geometry.type],this.model===void 0)throw new TypeError(E.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(E.geometry.coordinates)};function gt(v){this.map=v.map,this.drawConfig=JSON.parse(JSON.stringify(v.options||{})),this._ctx=v}(si.prototype=Object.create(Ut.prototype))._coordinatesToFeatures=function(v){var E=this,V=this.model.bind(this);return v.map(function(Q){return new V(E.ctx,{id:Mi(),type:ge.FEATURE,properties:{},geometry:{coordinates:Q,type:E.type.replace("Multi","")}})})},si.prototype.isValid=function(){return this.features.every(function(v){return v.isValid()})},si.prototype.setCoordinates=function(v){this.features=this._coordinatesToFeatures(v),this.changed()},si.prototype.getCoordinate=function(v){return it(this.features,"getCoordinate",v)},si.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(v){return v.type===ge.POLYGON?v.getCoordinates():v.coordinates})))},si.prototype.updateCoordinate=function(v,E,V){it(this.features,"updateCoordinate",v,E,V),this.changed()},si.prototype.addCoordinate=function(v,E,V){it(this.features,"addCoordinate",v,E,V),this.changed()},si.prototype.removeCoordinate=function(v){it(this.features,"removeCoordinate",v),this.changed()},si.prototype.getFeatures=function(){return this.features},gt.prototype.setSelected=function(v){return this._ctx.store.setSelected(v)},gt.prototype.setSelectedCoordinates=function(v){var E=this;this._ctx.store.setSelectedCoordinates(v),v.reduce(function(V,Q){return V[Q.feature_id]===void 0&&(V[Q.feature_id]=!0,E._ctx.store.get(Q.feature_id).changed()),V},{})},gt.prototype.getSelected=function(){return this._ctx.store.getSelected()},gt.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},gt.prototype.isSelected=function(v){return this._ctx.store.isSelected(v)},gt.prototype.getFeature=function(v){return this._ctx.store.get(v)},gt.prototype.select=function(v){return this._ctx.store.select(v)},gt.prototype.deselect=function(v){return this._ctx.store.deselect(v)},gt.prototype.deleteFeature=function(v,E){return E===void 0&&(E={}),this._ctx.store.delete(v,E)},gt.prototype.addFeature=function(v){return this._ctx.store.add(v)},gt.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},gt.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},gt.prototype.setActionableState=function(v){v===void 0&&(v={});var E={trash:v.trash||!1,combineFeatures:v.combineFeatures||!1,uncombineFeatures:v.uncombineFeatures||!1};return this._ctx.events.actionable(E)},gt.prototype.changeMode=function(v,E,V){return E===void 0&&(E={}),V===void 0&&(V={}),this._ctx.events.changeMode(v,E,V)},gt.prototype.updateUIClasses=function(v){return this._ctx.ui.queueMapClasses(v)},gt.prototype.activateUIButton=function(v){return this._ctx.ui.setActiveButton(v)},gt.prototype.featuresAt=function(v,E,V){if(V===void 0&&(V="click"),V!=="click"&&V!=="touch")throw new Error("invalid buffer type");return $e[V](v,E,this._ctx)},gt.prototype.newFeature=function(v){var E=v.geometry.type;return E===ge.POINT?new bi(this._ctx,v):E===ge.LINE_STRING?new Li(this._ctx,v):E===ge.POLYGON?new qe(this._ctx,v):new si(this._ctx,v)},gt.prototype.isInstanceOf=function(v,E){if(v===ge.POINT)return E instanceof bi;if(v===ge.LINE_STRING)return E instanceof Li;if(v===ge.POLYGON)return E instanceof qe;if(v==="MultiFeature")return E instanceof si;throw new Error("Unknown feature class: "+v)},gt.prototype.doRender=function(v){return this._ctx.store.featureChanged(v)},gt.prototype.onSetup=function(){},gt.prototype.onDrag=function(){},gt.prototype.onClick=function(){},gt.prototype.onMouseMove=function(){},gt.prototype.onMouseDown=function(){},gt.prototype.onMouseUp=function(){},gt.prototype.onMouseOut=function(){},gt.prototype.onKeyUp=function(){},gt.prototype.onKeyDown=function(){},gt.prototype.onTouchStart=function(){},gt.prototype.onTouchMove=function(){},gt.prototype.onTouchEnd=function(){},gt.prototype.onTap=function(){},gt.prototype.onStop=function(){},gt.prototype.onTrash=function(){},gt.prototype.onCombineFeature=function(){},gt.prototype.onUncombineFeature=function(){},gt.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Xi={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Qi=Object.keys(Xi);function Ze(v){var E=Object.keys(v);return function(V,Q){Q===void 0&&(Q={});var se={},le=E.reduce(function(be,Ge){return be[Ge]=v[Ge],be},new gt(V));return{start:function(){var be=this;se=le.onSetup(Q),Qi.forEach(function(Ge){var Qe,dt=Xi[Ge],ft=function(){return!1};v[dt]&&(ft=function(){return!0}),be.on(Ge,ft,(Qe=dt,function(at){return le[Qe](se,at)}))})},stop:function(){le.onStop(se)},trash:function(){le.onTrash(se)},combineFeatures:function(){le.onCombineFeatures(se)},uncombineFeatures:function(){le.onUncombineFeatures(se)},render:function(be,Ge){le.toDisplayFeatures(se,be,Ge)}}}}function Ui(v){return[].concat(v).filter(function(E){return E!==void 0})}function bn(){var v=this;if(!(v.ctx.map&&v.ctx.map.getSource(he.HOT)!==void 0))return Qe();var E=v.ctx.events.currentModeName();v.ctx.ui.queueMapClasses({mode:E});var V=[],Q=[];v.isDirty?Q=v.getAllIds():(V=v.getChangedIds().filter(function(dt){return v.get(dt)!==void 0}),Q=v.sources.hot.filter(function(dt){return dt.properties.id&&V.indexOf(dt.properties.id)===-1&&v.get(dt.properties.id)!==void 0}).map(function(dt){return dt.properties.id})),v.sources.hot=[];var se=v.sources.cold.length;v.sources.cold=v.isDirty?[]:v.sources.cold.filter(function(dt){var ft=dt.properties.id||dt.properties.parent;return V.indexOf(ft)===-1});var le=se!==v.sources.cold.length||Q.length>0;function be(dt,ft){var at=v.get(dt).internal(E);v.ctx.events.currentModeRender(at,function(ii){v.sources[ft].push(ii)})}if(V.forEach(function(dt){return be(dt,"hot")}),Q.forEach(function(dt){return be(dt,"cold")}),le&&v.ctx.map.getSource(he.COLD).setData({type:ge.FEATURE_COLLECTION,features:v.sources.cold}),v.ctx.map.getSource(he.HOT).setData({type:ge.FEATURE_COLLECTION,features:v.sources.hot}),v._emitSelectionChange&&(v.ctx.map.fire(Te.SELECTION_CHANGE,{features:v.getSelected().map(function(dt){return dt.toGeoJSON()}),points:v.getSelectedCoordinates().map(function(dt){return{type:ge.FEATURE,properties:{},geometry:{type:ge.POINT,coordinates:dt.coordinates}}})}),v._emitSelectionChange=!1),v._deletedFeaturesToEmit.length){var Ge=v._deletedFeaturesToEmit.map(function(dt){return dt.toGeoJSON()});v._deletedFeaturesToEmit=[],v.ctx.map.fire(Te.DELETE,{features:Ge})}function Qe(){v.isDirty=!1,v.clearChangedIds()}Qe(),v.ctx.map.fire(Te.RENDER,{})}function xi(v){var E,V=this;this._features={},this._featureIds=new Je,this._selectedFeatureIds=new Je,this._selectedCoordinates=[],this._changedFeatureIds=new Je,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=v,this.sources={hot:[],cold:[]},this.render=function(){E||(E=requestAnimationFrame(function(){E=null,bn.call(V)}))},this.isDirty=!1}function _r(v,E){var V=v._selectedCoordinates.filter(function(Q){return v._selectedFeatureIds.has(Q.feature_id)});v._selectedCoordinates.length===V.length||E.silent||(v._emitSelectionChange=!0),v._selectedCoordinates=V}xi.prototype.createRenderBatch=function(){var v=this,E=this.render,V=0;return this.render=function(){V++},function(){v.render=E,V>0&&v.render()}},xi.prototype.setDirty=function(){return this.isDirty=!0,this},xi.prototype.featureChanged=function(v){return this._changedFeatureIds.add(v),this},xi.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},xi.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},xi.prototype.getAllIds=function(){return this._featureIds.values()},xi.prototype.add=function(v){return this.featureChanged(v.id),this._features[v.id]=v,this._featureIds.add(v.id),this},xi.prototype.delete=function(v,E){var V=this;return E===void 0&&(E={}),Ui(v).forEach(function(Q){V._featureIds.has(Q)&&(V._featureIds.delete(Q),V._selectedFeatureIds.delete(Q),E.silent||V._deletedFeaturesToEmit.indexOf(V._features[Q])===-1&&V._deletedFeaturesToEmit.push(V._features[Q]),delete V._features[Q],V.isDirty=!0)}),_r(this,E),this},xi.prototype.get=function(v){return this._features[v]},xi.prototype.getAll=function(){var v=this;return Object.keys(this._features).map(function(E){return v._features[E]})},xi.prototype.select=function(v,E){var V=this;return E===void 0&&(E={}),Ui(v).forEach(function(Q){V._selectedFeatureIds.has(Q)||(V._selectedFeatureIds.add(Q),V._changedFeatureIds.add(Q),E.silent||(V._emitSelectionChange=!0))}),this},xi.prototype.deselect=function(v,E){var V=this;return E===void 0&&(E={}),Ui(v).forEach(function(Q){V._selectedFeatureIds.has(Q)&&(V._selectedFeatureIds.delete(Q),V._changedFeatureIds.add(Q),E.silent||(V._emitSelectionChange=!0))}),_r(this,E),this},xi.prototype.clearSelected=function(v){return v===void 0&&(v={}),this.deselect(this._selectedFeatureIds.values(),{silent:v.silent}),this},xi.prototype.setSelected=function(v,E){var V=this;return E===void 0&&(E={}),v=Ui(v),this.deselect(this._selectedFeatureIds.values().filter(function(Q){return v.indexOf(Q)===-1}),{silent:E.silent}),this.select(v.filter(function(Q){return!V._selectedFeatureIds.has(Q)}),{silent:E.silent}),this},xi.prototype.setSelectedCoordinates=function(v){return this._selectedCoordinates=v,this._emitSelectionChange=!0,this},xi.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},xi.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},xi.prototype.getSelected=function(){var v=this;return this._selectedFeatureIds.values().map(function(E){return v.get(E)})},xi.prototype.getSelectedCoordinates=function(){var v=this;return this._selectedCoordinates.map(function(E){return{coordinates:v.get(E.feature_id).getCoordinate(E.coord_path)}})},xi.prototype.isSelected=function(v){return this._selectedFeatureIds.has(v)},xi.prototype.setFeatureProperty=function(v,E,V){this.get(v).setProperty(E,V),this.featureChanged(v)},xi.prototype.storeMapConfig=function(){var v=this;St.forEach(function(E){v.ctx.map[E]&&(v._mapInitialConfig[E]=v.ctx.map[E].isEnabled())})},xi.prototype.restoreMapConfig=function(){var v=this;Object.keys(this._mapInitialConfig).forEach(function(E){v._mapInitialConfig[E]?v.ctx.map[E].enable():v.ctx.map[E].disable()})},xi.prototype.getInitialConfigValue=function(v){return this._mapInitialConfig[v]===void 0||this._mapInitialConfig[v]};var Dn=function(){for(var v=arguments,E={},V=0;V<arguments.length;V++){var Q=v[V];for(var se in Q)yo.call(Q,se)&&(E[se]=Q[se])}return E},yo=Object.prototype.hasOwnProperty,ke=d(Dn),tn=["mode","feature","mouse"];function zi(v){var E=null,V=null,Q={onRemove:function(){return v.map.off("load",Q.connect),clearInterval(V),Q.removeLayers(),v.store.restoreMapConfig(),v.ui.removeButtons(),v.events.removeEventListeners(),v.ui.clearMapClasses(),v.boxZoomInitial&&v.map.boxZoom.enable(),v.map=null,v.container=null,v.store=null,E&&E.parentNode&&E.parentNode.removeChild(E),E=null,this},connect:function(){v.map.off("load",Q.connect),clearInterval(V),Q.addLayers(),v.store.storeMapConfig(),v.events.addEventListeners()},onAdd:function(se){var le=se.fire;return se.fire=function(be,Ge){var Qe=arguments;return le.length===1&&arguments.length!==1&&(Qe=[ke({},{type:be},Ge)]),le.apply(se,Qe)},v.map=se,v.events=function(be){var Ge=Object.keys(be.options.modes).reduce(function(Ne,kt){return Ne[kt]=Ze(be.options.modes[kt]),Ne},{}),Qe={},dt={},ft={},at=null,ii=null;ft.drag=function(Ne,kt){kt({point:Ne.point,time:new Date().getTime()})?(be.ui.queueMapClasses({mouse:xe.DRAG}),ii.drag(Ne)):Ne.originalEvent.stopPropagation()},ft.mousedrag=function(Ne){ft.drag(Ne,function(kt){return!ui(Qe,kt)})},ft.touchdrag=function(Ne){ft.drag(Ne,function(kt){return!Ln(dt,kt)})},ft.mousemove=function(Ne){if((Ne.originalEvent.buttons!==void 0?Ne.originalEvent.buttons:Ne.originalEvent.which)===1)return ft.mousedrag(Ne);var kt=Pt(Ne,be);Ne.featureTarget=kt,ii.mousemove(Ne)},ft.mousedown=function(Ne){Qe={time:new Date().getTime(),point:Ne.point};var kt=Pt(Ne,be);Ne.featureTarget=kt,ii.mousedown(Ne)},ft.mouseup=function(Ne){var kt=Pt(Ne,be);Ne.featureTarget=kt,ui(Qe,{point:Ne.point,time:new Date().getTime()})?ii.click(Ne):ii.mouseup(Ne)},ft.mouseout=function(Ne){ii.mouseout(Ne)},ft.touchstart=function(Ne){if(be.options.touchEnabled){dt={time:new Date().getTime(),point:Ne.point};var kt=$e.touch(Ne,null,be)[0];Ne.featureTarget=kt,ii.touchstart(Ne)}},ft.touchmove=function(Ne){if(be.options.touchEnabled)return ii.touchmove(Ne),ft.touchdrag(Ne)},ft.touchend=function(Ne){if(Ne.originalEvent.preventDefault(),be.options.touchEnabled){var kt=$e.touch(Ne,null,be)[0];Ne.featureTarget=kt,Ln(dt,{time:new Date().getTime(),point:Ne.point})?ii.tap(Ne):ii.touchend(Ne)}};var an=function(Ne){return!(Ne===8||Ne===46||Ne>=48&&Ne<=57)};function ri(Ne,kt,Fi){Fi===void 0&&(Fi={}),ii.stop();var ln=Ge[Ne];if(ln===void 0)throw new Error(Ne+" is not valid");at=Ne;var _n=ln(be,kt);ii=h(_n,be),Fi.silent||be.map.fire(Te.MODE_CHANGE,{mode:Ne}),be.store.setDirty(),be.store.render()}ft.keydown=function(Ne){(Ne.srcElement||Ne.target).classList.contains("mapboxgl-canvas")&&(Ne.keyCode!==8&&Ne.keyCode!==46||!be.options.controls.trash?an(Ne.keyCode)?ii.keydown(Ne):Ne.keyCode===49&&be.options.controls.point?ri(fe.DRAW_POINT):Ne.keyCode===50&&be.options.controls.line_string?ri(fe.DRAW_LINE_STRING):Ne.keyCode===51&&be.options.controls.polygon&&ri(fe.DRAW_POLYGON):(Ne.preventDefault(),ii.trash()))},ft.keyup=function(Ne){an(Ne.keyCode)&&ii.keyup(Ne)},ft.zoomend=function(){be.store.changeZoom()},ft.data=function(Ne){if(Ne.dataType==="style"){var kt=be.setup,Fi=be.map,ln=be.options,_n=be.store;ln.styles.some(function(yr){return Fi.getLayer(yr.id)})||(kt.addLayers(),_n.setDirty(),_n.render())}};var Sn={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){at=be.options.defaultMode,ii=h(Ge[at](be),be)},changeMode:ri,actionable:function(Ne){var kt=!1;Object.keys(Ne).forEach(function(Fi){if(Sn[Fi]===void 0)throw new Error("Invalid action type");Sn[Fi]!==Ne[Fi]&&(kt=!0),Sn[Fi]=Ne[Fi]}),kt&&be.map.fire(Te.ACTIONABLE,{actions:Sn})},currentModeName:function(){return at},currentModeRender:function(Ne,kt){return ii.render(Ne,kt)},fire:function(Ne,kt){ft[Ne]&&ft[Ne](kt)},addEventListeners:function(){be.map.on("mousemove",ft.mousemove),be.map.on("mousedown",ft.mousedown),be.map.on("mouseup",ft.mouseup),be.map.on("data",ft.data),be.map.on("touchmove",ft.touchmove),be.map.on("touchstart",ft.touchstart),be.map.on("touchend",ft.touchend),be.container.addEventListener("mouseout",ft.mouseout),be.options.keybindings&&(be.container.addEventListener("keydown",ft.keydown),be.container.addEventListener("keyup",ft.keyup))},removeEventListeners:function(){be.map.off("mousemove",ft.mousemove),be.map.off("mousedown",ft.mousedown),be.map.off("mouseup",ft.mouseup),be.map.off("data",ft.data),be.map.off("touchmove",ft.touchmove),be.map.off("touchstart",ft.touchstart),be.map.off("touchend",ft.touchend),be.container.removeEventListener("mouseout",ft.mouseout),be.options.keybindings&&(be.container.removeEventListener("keydown",ft.keydown),be.container.removeEventListener("keyup",ft.keyup))},trash:function(Ne){ii.trash(Ne)},combineFeatures:function(){ii.combineFeatures()},uncombineFeatures:function(){ii.uncombineFeatures()},getMode:function(){return at}}}(v),v.ui=function(be){var Ge={},Qe=null,dt={mode:null,feature:null,mouse:null},ft={mode:null,feature:null,mouse:null};function at(Ne){ft=ke(ft,Ne)}function ii(){var Ne,kt;if(be.container){var Fi=[],ln=[];tn.forEach(function(_n){ft[_n]!==dt[_n]&&(Fi.push(_n+"-"+dt[_n]),ft[_n]!==null&&ln.push(_n+"-"+ft[_n]))}),Fi.length>0&&(Ne=be.container.classList).remove.apply(Ne,Fi),ln.length>0&&(kt=be.container.classList).add.apply(kt,ln),dt=ke(dt,ft)}}function an(Ne,kt){kt===void 0&&(kt={});var Fi=document.createElement("button");return Fi.className=ie.CONTROL_BUTTON+" "+kt.className,Fi.setAttribute("title",kt.title),kt.container.appendChild(Fi),Fi.addEventListener("click",function(ln){if(ln.preventDefault(),ln.stopPropagation(),ln.target===Qe)return ri(),void kt.onDeactivate();Sn(Ne),kt.onActivate()},!0),Fi}function ri(){Qe&&(Qe.classList.remove(ie.ACTIVE_BUTTON),Qe=null)}function Sn(Ne){ri();var kt=Ge[Ne];kt&&kt&&Ne!=="trash"&&(kt.classList.add(ie.ACTIVE_BUTTON),Qe=kt)}return{setActiveButton:Sn,queueMapClasses:at,updateMapClasses:ii,clearMapClasses:function(){at({mode:null,feature:null,mouse:null}),ii()},addButtons:function(){var Ne=be.options.controls,kt=document.createElement("div");return kt.className=ie.CONTROL_GROUP+" "+ie.CONTROL_BASE,Ne&&(Ne[ye.LINE]&&(Ge[ye.LINE]=an(ye.LINE,{container:kt,className:ie.CONTROL_BUTTON_LINE,title:"LineString tool "+(be.options.keybindings?"(l)":""),onActivate:function(){return be.events.changeMode(fe.DRAW_LINE_STRING)},onDeactivate:function(){return be.events.trash()}})),Ne[ye.POLYGON]&&(Ge[ye.POLYGON]=an(ye.POLYGON,{container:kt,className:ie.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(be.options.keybindings?"(p)":""),onActivate:function(){return be.events.changeMode(fe.DRAW_POLYGON)},onDeactivate:function(){return be.events.trash()}})),Ne[ye.POINT]&&(Ge[ye.POINT]=an(ye.POINT,{container:kt,className:ie.CONTROL_BUTTON_POINT,title:"Marker tool "+(be.options.keybindings?"(m)":""),onActivate:function(){return be.events.changeMode(fe.DRAW_POINT)},onDeactivate:function(){return be.events.trash()}})),Ne.trash&&(Ge.trash=an("trash",{container:kt,className:ie.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){be.events.trash()}})),Ne.combine_features&&(Ge.combine_features=an("combineFeatures",{container:kt,className:ie.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){be.events.combineFeatures()}})),Ne.uncombine_features&&(Ge.uncombine_features=an("uncombineFeatures",{container:kt,className:ie.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){be.events.uncombineFeatures()}}))),kt},removeButtons:function(){Object.keys(Ge).forEach(function(Ne){var kt=Ge[Ne];kt.parentNode&&kt.parentNode.removeChild(kt),delete Ge[Ne]})}}}(v),v.container=se.getContainer(),v.store=new xi(v),E=v.ui.addButtons(),v.options.boxSelect&&(v.boxZoomInitial=se.boxZoom.isEnabled(),se.boxZoom.disable(),se.dragPan.disable(),se.dragPan.enable()),se.loaded()?Q.connect():(se.on("load",Q.connect),V=setInterval(function(){se.loaded()&&Q.connect()},16)),v.events.start(),E},addLayers:function(){v.map.addSource(he.COLD,{data:{type:ge.FEATURE_COLLECTION,features:[]},type:"geojson"}),v.map.addSource(he.HOT,{data:{type:ge.FEATURE_COLLECTION,features:[]},type:"geojson"}),v.options.styles.forEach(function(se){v.map.addLayer(se)}),v.store.setDirty(!0),v.store.render()},removeLayers:function(){v.options.styles.forEach(function(se){v.map.getLayer(se.id)&&v.map.removeLayer(se.id)}),v.map.getSource(he.COLD)&&v.map.removeSource(he.COLD),v.map.getSource(he.HOT)&&v.map.removeSource(he.HOT)}};return v.setup=Q,Q}var jt=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function ei(v){return function(E){var V=E.featureTarget;return!!V&&!!V.properties&&V.properties.meta===v}}function $r(v){return!!v.originalEvent&&!!v.originalEvent.shiftKey&&v.originalEvent.button===0}function Br(v){return!!v.featureTarget&&!!v.featureTarget.properties&&v.featureTarget.properties.active===je.ACTIVE&&v.featureTarget.properties.meta===Ke.FEATURE}function eo(v){return!!v.featureTarget&&!!v.featureTarget.properties&&v.featureTarget.properties.active===je.INACTIVE&&v.featureTarget.properties.meta===Ke.FEATURE}function as(v){return v.featureTarget===void 0}function No(v){return!!v.featureTarget&&!!v.featureTarget.properties&&v.featureTarget.properties.meta===Ke.FEATURE}function Nr(v){var E=v.featureTarget;return!!E&&!!E.properties&&E.properties.meta===Ke.VERTEX}function vo(v){return!!v.originalEvent&&v.originalEvent.shiftKey===!0}function tt(v){return v.keyCode===27}function Er(v){return v.keyCode===13}var mn=Object.freeze({__proto__:null,isOfMetaType:ei,isShiftMousedown:$r,isActiveFeature:Br,isInactiveFeature:eo,noTarget:as,isFeature:No,isVertex:Nr,isShiftDown:vo,isEscapeKey:tt,isEnterKey:Er,isTrue:function(){return!0}}),ls=gr;function gr(v,E){this.x=v,this.y=E}gr.prototype={clone:function(){return new gr(this.x,this.y)},add:function(v){return this.clone()._add(v)},sub:function(v){return this.clone()._sub(v)},multByPoint:function(v){return this.clone()._multByPoint(v)},divByPoint:function(v){return this.clone()._divByPoint(v)},mult:function(v){return this.clone()._mult(v)},div:function(v){return this.clone()._div(v)},rotate:function(v){return this.clone()._rotate(v)},rotateAround:function(v,E){return this.clone()._rotateAround(v,E)},matMult:function(v){return this.clone()._matMult(v)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(v){return this.x===v.x&&this.y===v.y},dist:function(v){return Math.sqrt(this.distSqr(v))},distSqr:function(v){var E=v.x-this.x,V=v.y-this.y;return E*E+V*V},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(v){return Math.atan2(this.y-v.y,this.x-v.x)},angleWith:function(v){return this.angleWithSep(v.x,v.y)},angleWithSep:function(v,E){return Math.atan2(this.x*E-this.y*v,this.x*v+this.y*E)},_matMult:function(v){var E=v[0]*this.x+v[1]*this.y,V=v[2]*this.x+v[3]*this.y;return this.x=E,this.y=V,this},_add:function(v){return this.x+=v.x,this.y+=v.y,this},_sub:function(v){return this.x-=v.x,this.y-=v.y,this},_mult:function(v){return this.x*=v,this.y*=v,this},_div:function(v){return this.x/=v,this.y/=v,this},_multByPoint:function(v){return this.x*=v.x,this.y*=v.y,this},_divByPoint:function(v){return this.x/=v.x,this.y/=v.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var v=this.y;return this.y=this.x,this.x=-v,this},_rotate:function(v){var E=Math.cos(v),V=Math.sin(v),Q=E*this.x-V*this.y,se=V*this.x+E*this.y;return this.x=Q,this.y=se,this},_rotateAround:function(v,E){var V=Math.cos(v),Q=Math.sin(v),se=E.x+V*(this.x-E.x)-Q*(this.y-E.y),le=E.y+Q*(this.x-E.x)+V*(this.y-E.y);return this.x=se,this.y=le,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},gr.convert=function(v){return v instanceof gr?v:Array.isArray(v)?new gr(v[0],v[1]):v};var rt=d(ls);function oi(v,E){var V=E.getBoundingClientRect();return new rt(v.clientX-V.left-(E.clientLeft||0),v.clientY-V.top-(E.clientTop||0))}function Jt(v,E,V,Q){return{type:ge.FEATURE,properties:{meta:Ke.VERTEX,parent:v,coord_path:V,active:Q?je.ACTIVE:je.INACTIVE},geometry:{type:ge.POINT,coordinates:E}}}function ir(v,E,V){var Q=E.geometry.coordinates,se=V.geometry.coordinates;if(Q[1]>85||Q[1]<vt||se[1]>85||se[1]<vt)return null;var le={lng:(Q[0]+se[0])/2,lat:(Q[1]+se[1])/2};return{type:ge.FEATURE,properties:{meta:Ke.MIDPOINT,parent:v,lng:le.lng,lat:le.lat,coord_path:V.properties.coord_path},geometry:{type:ge.POINT,coordinates:[le.lng,le.lat]}}}function kr(v,E,V){E===void 0&&(E={}),V===void 0&&(V=null);var Q,se=v.geometry,le=se.type,be=se.coordinates,Ge=v.properties&&v.properties.id,Qe=[];function dt(at,ii){var an="",ri=null;at.forEach(function(Sn,Ne){var kt=ii!=null?ii+"."+Ne:String(Ne),Fi=Jt(Ge,Sn,kt,ft(kt));if(E.midpoints&&ri){var ln=ir(Ge,ri,Fi);ln&&Qe.push(ln)}ri=Fi;var _n=JSON.stringify(Sn);an!==_n&&Qe.push(Fi),Ne===0&&(an=_n)})}function ft(at){return!!E.selectedPaths&&E.selectedPaths.indexOf(at)!==-1}return le===ge.POINT?Qe.push(Jt(Ge,be,V,ft(V))):le===ge.POLYGON?be.forEach(function(at,ii){dt(at,V!==null?V+"."+ii:String(ii))}):le===ge.LINE_STRING?dt(be,V):le.indexOf(ge.MULTI_PREFIX)===0&&(Q=le.replace(ge.MULTI_PREFIX,""),be.forEach(function(at,ii){var an={type:ge.FEATURE,properties:v.properties,geometry:{type:Q,coordinates:at}};Qe=Qe.concat(kr(an,E,ii))})),Qe}var Wt={enable:function(v){setTimeout(function(){v.map&&v.map.doubleClickZoom&&v._ctx&&v._ctx.store&&v._ctx.store.getInitialConfigValue&&v._ctx.store.getInitialConfigValue("doubleClickZoom")&&v.map.doubleClickZoom.enable()},0)},disable:function(v){setTimeout(function(){v.map&&v.map.doubleClickZoom&&v.map.doubleClickZoom.disable()},0)}},Vr={exports:{}},K=function(v){if(!v||!v.type)return null;var E=R[v.type];if(!E)return null;if(E==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:v}]};if(E==="feature")return{type:"FeatureCollection",features:[v]};if(E==="featurecollection")return v},R={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},B=d(K),Z=Object.freeze({__proto__:null,default:function v(E){switch(E&&E.type||null){case"FeatureCollection":return E.features=E.features.reduce(function(V,Q){return V.concat(v(Q))},[]),E;case"Feature":return E.geometry?v(E.geometry).map(function(V){var Q={type:"Feature",properties:JSON.parse(JSON.stringify(E.properties)),geometry:V};return E.id!==void 0&&(Q.id=E.id),Q}):[E];case"MultiPoint":return E.coordinates.map(function(V){return{type:"Point",coordinates:V}});case"MultiPolygon":return E.coordinates.map(function(V){return{type:"Polygon",coordinates:V}});case"MultiLineString":return E.coordinates.map(function(V){return{type:"LineString",coordinates:V}});case"GeometryCollection":return E.geometries.map(v).reduce(function(V,Q){return V.concat(Q)},[]);case"Point":case"Polygon":case"LineString":return[E]}}}),Y=K,$=y(Z),me=function(v){return function E(V){return Array.isArray(V)&&V.length&&typeof V[0]=="number"?[V]:V.reduce(function(Q,se){return Array.isArray(se)&&Array.isArray(se[0])?Q.concat(E(se)):(Q.push(se),Q)},[])}(v)};$ instanceof Function||($=$.default);var ae={exports:{}},ne=ae.exports=function(v){return new ce(v)};function ce(v){this.value=v}function Le(v,E,V){var Q=[],se=[],le=!0;return function be(Ge){var Qe=V?Fe(Ge):Ge,dt={},ft=!0,at={node:Qe,node_:Ge,path:[].concat(Q),parent:se[se.length-1],parents:se,key:Q.slice(-1)[0],isRoot:Q.length===0,level:Q.length,circular:null,update:function(ri,Sn){at.isRoot||(at.parent.node[at.key]=ri),at.node=ri,Sn&&(ft=!1)},delete:function(ri){delete at.parent.node[at.key],ri&&(ft=!1)},remove:function(ri){Yt(at.parent.node)?at.parent.node.splice(at.key,1):delete at.parent.node[at.key],ri&&(ft=!1)},keys:null,before:function(ri){dt.before=ri},after:function(ri){dt.after=ri},pre:function(ri){dt.pre=ri},post:function(ri){dt.post=ri},stop:function(){le=!1},block:function(){ft=!1}};if(!le)return at;function ii(){if(typeof at.node=="object"&&at.node!==null){at.keys&&at.node_===at.node||(at.keys=Re(at.node)),at.isLeaf=at.keys.length==0;for(var ri=0;ri<se.length;ri++)if(se[ri].node_===Ge){at.circular=se[ri];break}}else at.isLeaf=!0,at.keys=null;at.notLeaf=!at.isLeaf,at.notRoot=!at.isRoot}ii();var an=E.call(at,at.node);return an!==void 0&&at.update&&at.update(an),dt.before&&dt.before.call(at,at.node),ft&&(typeof at.node!="object"||at.node===null||at.circular||(se.push(at),ii(),bt(at.keys,function(ri,Sn){Q.push(ri),dt.pre&&dt.pre.call(at,at.node[ri],ri);var Ne=be(at.node[ri]);V&&Dt.call(at.node,ri)&&(at.node[ri]=Ne.node),Ne.isLast=Sn==at.keys.length-1,Ne.isFirst=Sn==0,dt.post&&dt.post.call(at,Ne),Q.pop()}),se.pop()),dt.after&&dt.after.call(at,at.node)),at}(v).node}function Fe(v){if(typeof v=="object"&&v!==null){var E;if(Yt(v))E=[];else if(Et(v)==="[object Date]")E=new Date(v.getTime?v.getTime():v);else if(function(se){return Et(se)==="[object RegExp]"}(v))E=new RegExp(v);else if(function(se){return Et(se)==="[object Error]"}(v))E={message:v.message};else if(function(se){return Et(se)==="[object Boolean]"}(v))E=new Boolean(v);else if(function(se){return Et(se)==="[object Number]"}(v))E=new Number(v);else if(function(se){return Et(se)==="[object String]"}(v))E=new String(v);else if(Object.create&&Object.getPrototypeOf)E=Object.create(Object.getPrototypeOf(v));else if(v.constructor===Object)E={};else{var V=v.constructor&&v.constructor.prototype||v.__proto__||{},Q=function(){};Q.prototype=V,E=new Q}return bt(Re(v),function(se){E[se]=v[se]}),E}return v}ce.prototype.get=function(v){for(var E=this.value,V=0;V<v.length;V++){var Q=v[V];if(!E||!Dt.call(E,Q)){E=void 0;break}E=E[Q]}return E},ce.prototype.has=function(v){for(var E=this.value,V=0;V<v.length;V++){var Q=v[V];if(!E||!Dt.call(E,Q))return!1;E=E[Q]}return!0},ce.prototype.set=function(v,E){for(var V=this.value,Q=0;Q<v.length-1;Q++){var se=v[Q];Dt.call(V,se)||(V[se]={}),V=V[se]}return V[v[Q]]=E,E},ce.prototype.map=function(v){return Le(this.value,v,!0)},ce.prototype.forEach=function(v){return this.value=Le(this.value,v,!1),this.value},ce.prototype.reduce=function(v,E){var V=arguments.length===1,Q=V?this.value:E;return this.forEach(function(se){this.isRoot&&V||(Q=v.call(this,Q,se))}),Q},ce.prototype.paths=function(){var v=[];return this.forEach(function(E){v.push(this.path)}),v},ce.prototype.nodes=function(){var v=[];return this.forEach(function(E){v.push(this.node)}),v},ce.prototype.clone=function(){var v=[],E=[];return function V(Q){for(var se=0;se<v.length;se++)if(v[se]===Q)return E[se];if(typeof Q=="object"&&Q!==null){var le=Fe(Q);return v.push(Q),E.push(le),bt(Re(Q),function(be){le[be]=V(Q[be])}),v.pop(),E.pop(),le}return Q}(this.value)};var Re=Object.keys||function(v){var E=[];for(var V in v)E.push(V);return E};function Et(v){return Object.prototype.toString.call(v)}var Yt=Array.isArray||function(v){return Object.prototype.toString.call(v)==="[object Array]"},bt=function(v,E){if(v.forEach)return v.forEach(E);for(var V=0;V<v.length;V++)E(v[V],V,v)};bt(Re(ce.prototype),function(v){ne[v]=function(E){var V=[].slice.call(arguments,1),Q=new ce(E);return Q[v].apply(Q,V)}});var Dt=Object.hasOwnProperty||function(v,E){return E in v},ti=ae.exports,Ai=ai;function ai(v){if(!(this instanceof ai))return new ai(v);this._bbox=v||[1/0,1/0,-1/0,-1/0],this._valid=!!v}ai.prototype.include=function(v){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],v[0]),this._bbox[1]=Math.min(this._bbox[1],v[1]),this._bbox[2]=Math.max(this._bbox[2],v[0]),this._bbox[3]=Math.max(this._bbox[3],v[1]),this},ai.prototype.equals=function(v){var E;return E=v instanceof ai?v.bbox():v,this._bbox[0]==E[0]&&this._bbox[1]==E[1]&&this._bbox[2]==E[2]&&this._bbox[3]==E[3]},ai.prototype.center=function(v){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},ai.prototype.union=function(v){var E;return this._valid=!0,E=v instanceof ai?v.bbox():v,this._bbox[0]=Math.min(this._bbox[0],E[0]),this._bbox[1]=Math.min(this._bbox[1],E[1]),this._bbox[2]=Math.max(this._bbox[2],E[2]),this._bbox[3]=Math.max(this._bbox[3],E[3]),this},ai.prototype.bbox=function(){return this._valid?this._bbox:null},ai.prototype.contains=function(v){if(!v)return this._fastContains();if(!this._valid)return null;var E=v[0],V=v[1];return this._bbox[0]<=E&&this._bbox[1]<=V&&this._bbox[2]>=E&&this._bbox[3]>=V},ai.prototype.intersect=function(v){return this._valid?(E=v instanceof ai?v.bbox():v,!(this._bbox[0]>E[2]||this._bbox[2]<E[0]||this._bbox[3]<E[1]||this._bbox[1]>E[3])):null;var E},ai.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var v="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",v)},ai.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Ii=function(v){if(!v)return[];var E=$(Y(v)),V=[];return E.features.forEach(function(Q){Q.geometry&&(V=V.concat(me(Q.geometry.coordinates)))}),V},wi=ti,nr=Ai,ji={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Cn=Object.keys(ji);function Fn(v){for(var E=nr(),V=Ii(v),Q=0;Q<V.length;Q++)E.include(V[Q]);return E}Vr.exports=function(v){return Fn(v).bbox()},Vr.exports.polygon=function(v){return Fn(v).polygon()},Vr.exports.bboxify=function(v){return wi(v).map(function(E){E&&Cn.some(function(V){return!!E[V]&&ji[V].indexOf(E.type)!==-1})&&(E.bbox=Fn(E).bbox(),this.update(E))})};var Ur=d(Vr.exports),Os=-90;function Vo(v,E){var V=Os,Q=90,se=Os,le=90,be=270,Ge=-270;v.forEach(function(dt){var ft=Ur(dt),at=ft[1],ii=ft[3],an=ft[0],ri=ft[2];at>V&&(V=at),ii<Q&&(Q=ii),ii>se&&(se=ii),at<le&&(le=at),an<be&&(be=an),ri>Ge&&(Ge=ri)});var Qe=E;return V+Qe.lat>85&&(Qe.lat=85-V),se+Qe.lat>90&&(Qe.lat=90-se),Q+Qe.lat<-85&&(Qe.lat=-85-Q),le+Qe.lat<Os&&(Qe.lat=Os-le),be+Qe.lng<=-270&&(Qe.lng+=360*Math.ceil(Math.abs(Qe.lng)/360)),Ge+Qe.lng>=270&&(Qe.lng-=360*Math.ceil(Math.abs(Qe.lng)/360)),Qe}function Uo(v,E){var V=Vo(v.map(function(Q){return Q.toGeoJSON()}),E);v.forEach(function(Q){var se,le=Q.getCoordinates(),be=function(Qe){var dt={lng:Qe[0]+V.lng,lat:Qe[1]+V.lat};return[dt.lng,dt.lat]},Ge=function(Qe){return Qe.map(function(dt){return be(dt)})};Q.type===ge.POINT?se=be(le):Q.type===ge.LINE_STRING||Q.type===ge.MULTI_POINT?se=le.map(be):Q.type===ge.POLYGON||Q.type===ge.MULTI_LINE_STRING?se=le.map(Ge):Q.type===ge.MULTI_POLYGON&&(se=le.map(function(Qe){return Qe.map(function(dt){return Ge(dt)})})),Q.incomingCoords(se)})}var Rn={onSetup:function(v){var E=this,V={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:v.featureIds||[]};return this.setSelected(V.initiallySelectedFeatureIds.filter(function(Q){return E.getFeature(Q)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),V},fireUpdate:function(){this.map.fire(Te.UPDATE,{action:Pe.MOVE,features:this.getSelected().map(function(v){return v.toGeoJSON()})})},fireActionable:function(){var v=this,E=this.getSelected(),V=E.filter(function(Ge){return v.isInstanceOf("MultiFeature",Ge)}),Q=!1;if(E.length>1){Q=!0;var se=E[0].type.replace("Multi","");E.forEach(function(Ge){Ge.type.replace("Multi","")!==se&&(Q=!1)})}var le=V.length>0,be=E.length>0;this.setActionableState({combineFeatures:Q,uncombineFeatures:le,trash:be})},getUniqueIds:function(v){return v.length?v.map(function(E){return E.properties.id}).filter(function(E){return E!==void 0}).reduce(function(E,V){return E.add(V),E},new Je).values():[]},stopExtendedInteractions:function(v){v.boxSelectElement&&(v.boxSelectElement.parentNode&&v.boxSelectElement.parentNode.removeChild(v.boxSelectElement),v.boxSelectElement=null),this.map.dragPan.enable(),v.boxSelecting=!1,v.canBoxSelect=!1,v.dragMoving=!1,v.canDragMove=!1},onStop:function(){Wt.enable(this)},onMouseMove:function(v,E){return No(E)&&v.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(v),!0},onMouseOut:function(v){return!v.dragMoving||this.fireUpdate()}};Rn.onTap=Rn.onClick=function(v,E){return as(E)?this.clickAnywhere(v,E):ei(Ke.VERTEX)(E)?this.clickOnVertex(v,E):No(E)?this.clickOnFeature(v,E):void 0},Rn.clickAnywhere=function(v){var E=this,V=this.getSelectedIds();V.length&&(this.clearSelectedFeatures(),V.forEach(function(Q){return E.doRender(Q)})),Wt.enable(this),this.stopExtendedInteractions(v)},Rn.clickOnVertex=function(v,E){this.changeMode(fe.DIRECT_SELECT,{featureId:E.featureTarget.properties.parent,coordPath:E.featureTarget.properties.coord_path,startPos:E.lngLat}),this.updateUIClasses({mouse:xe.MOVE})},Rn.startOnActiveFeature=function(v,E){this.stopExtendedInteractions(v),this.map.dragPan.disable(),this.doRender(E.featureTarget.properties.id),v.canDragMove=!0,v.dragMoveLocation=E.lngLat},Rn.clickOnFeature=function(v,E){var V=this;Wt.disable(this),this.stopExtendedInteractions(v);var Q=vo(E),se=this.getSelectedIds(),le=E.featureTarget.properties.id,be=this.isSelected(le);if(!Q&&be&&this.getFeature(le).type!==ge.POINT)return this.changeMode(fe.DIRECT_SELECT,{featureId:le});be&&Q?(this.deselect(le),this.updateUIClasses({mouse:xe.POINTER}),se.length===1&&Wt.enable(this)):!be&&Q?(this.select(le),this.updateUIClasses({mouse:xe.MOVE})):be||Q||(se.forEach(function(Ge){return V.doRender(Ge)}),this.setSelected(le),this.updateUIClasses({mouse:xe.MOVE})),this.doRender(le)},Rn.onMouseDown=function(v,E){return Br(E)?this.startOnActiveFeature(v,E):this.drawConfig.boxSelect&&$r(E)?this.startBoxSelect(v,E):void 0},Rn.startBoxSelect=function(v,E){this.stopExtendedInteractions(v),this.map.dragPan.disable(),v.boxSelectStartLocation=oi(E.originalEvent,this.map.getContainer()),v.canBoxSelect=!0},Rn.onTouchStart=function(v,E){if(Br(E))return this.startOnActiveFeature(v,E)},Rn.onDrag=function(v,E){return v.canDragMove?this.dragMove(v,E):this.drawConfig.boxSelect&&v.canBoxSelect?this.whileBoxSelect(v,E):void 0},Rn.whileBoxSelect=function(v,E){v.boxSelecting=!0,this.updateUIClasses({mouse:xe.ADD}),v.boxSelectElement||(v.boxSelectElement=document.createElement("div"),v.boxSelectElement.classList.add(ie.BOX_SELECT),this.map.getContainer().appendChild(v.boxSelectElement));var V=oi(E.originalEvent,this.map.getContainer()),Q=Math.min(v.boxSelectStartLocation.x,V.x),se=Math.max(v.boxSelectStartLocation.x,V.x),le=Math.min(v.boxSelectStartLocation.y,V.y),be=Math.max(v.boxSelectStartLocation.y,V.y),Ge="translate("+Q+"px, "+le+"px)";v.boxSelectElement.style.transform=Ge,v.boxSelectElement.style.WebkitTransform=Ge,v.boxSelectElement.style.width=se-Q+"px",v.boxSelectElement.style.height=be-le+"px"},Rn.dragMove=function(v,E){v.dragMoving=!0,E.originalEvent.stopPropagation();var V={lng:E.lngLat.lng-v.dragMoveLocation.lng,lat:E.lngLat.lat-v.dragMoveLocation.lat};Uo(this.getSelected(),V),v.dragMoveLocation=E.lngLat},Rn.onTouchEnd=Rn.onMouseUp=function(v,E){var V=this;if(v.dragMoving)this.fireUpdate();else if(v.boxSelecting){var Q=[v.boxSelectStartLocation,oi(E.originalEvent,this.map.getContainer())],se=this.featuresAt(null,Q,"click"),le=this.getUniqueIds(se).filter(function(be){return!V.isSelected(be)});le.length&&(this.select(le),le.forEach(function(be){return V.doRender(be)}),this.updateUIClasses({mouse:xe.MOVE}))}this.stopExtendedInteractions(v)},Rn.toDisplayFeatures=function(v,E,V){E.properties.active=this.isSelected(E.properties.id)?je.ACTIVE:je.INACTIVE,V(E),this.fireActionable(),E.properties.active===je.ACTIVE&&E.geometry.type!==ge.POINT&&kr(E).forEach(V)},Rn.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Rn.onCombineFeatures=function(){var v=this.getSelected();if(!(v.length===0||v.length<2)){for(var E=[],V=[],Q=v[0].type.replace("Multi",""),se=0;se<v.length;se++){var le=v[se];if(le.type.replace("Multi","")!==Q)return;le.type.includes("Multi")?le.getCoordinates().forEach(function(Ge){E.push(Ge)}):E.push(le.getCoordinates()),V.push(le.toGeoJSON())}if(V.length>1){var be=this.newFeature({type:ge.FEATURE,properties:V[0].properties,geometry:{type:"Multi"+Q,coordinates:E}});this.addFeature(be),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([be.id]),this.map.fire(Te.COMBINE_FEATURES,{createdFeatures:[be.toGeoJSON()],deletedFeatures:V})}this.fireActionable()}},Rn.onUncombineFeatures=function(){var v=this,E=this.getSelected();if(E.length!==0){for(var V=[],Q=[],se=function(be){var Ge=E[be];v.isInstanceOf("MultiFeature",Ge)&&(Ge.getFeatures().forEach(function(Qe){v.addFeature(Qe),Qe.properties=Ge.properties,V.push(Qe.toGeoJSON()),v.select([Qe.id])}),v.deleteFeature(Ge.id,{silent:!0}),Q.push(Ge.toGeoJSON()))},le=0;le<E.length;le++)se(le);V.length>1&&this.map.fire(Te.UNCOMBINE_FEATURES,{createdFeatures:V,deletedFeatures:Q}),this.fireActionable()}};var Di=ei(Ke.VERTEX),pa=ei(Ke.MIDPOINT),to={fireUpdate:function(){this.map.fire(Te.UPDATE,{action:Pe.CHANGE_COORDINATES,features:this.getSelected().map(function(v){return v.toGeoJSON()})})},fireActionable:function(v){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:v.selectedCoordPaths.length>0})},startDragging:function(v,E){this.map.dragPan.disable(),v.canDragMove=!0,v.dragMoveLocation=E.lngLat},stopDragging:function(v){this.map.dragPan.enable(),v.dragMoving=!1,v.canDragMove=!1,v.dragMoveLocation=null},onVertex:function(v,E){this.startDragging(v,E);var V=E.featureTarget.properties,Q=v.selectedCoordPaths.indexOf(V.coord_path);vo(E)||Q!==-1?vo(E)&&Q===-1&&v.selectedCoordPaths.push(V.coord_path):v.selectedCoordPaths=[V.coord_path];var se=this.pathsToCoordinates(v.featureId,v.selectedCoordPaths);this.setSelectedCoordinates(se)},onMidpoint:function(v,E){this.startDragging(v,E);var V=E.featureTarget.properties;v.feature.addCoordinate(V.coord_path,V.lng,V.lat),this.fireUpdate(),v.selectedCoordPaths=[V.coord_path]},pathsToCoordinates:function(v,E){return E.map(function(V){return{feature_id:v,coord_path:V}})},onFeature:function(v,E){v.selectedCoordPaths.length===0?this.startDragging(v,E):this.stopDragging(v)},dragFeature:function(v,E,V){Uo(this.getSelected(),V),v.dragMoveLocation=E.lngLat},dragVertex:function(v,E,V){for(var Q=v.selectedCoordPaths.map(function(Ge){return v.feature.getCoordinate(Ge)}),se=Vo(Q.map(function(Ge){return{type:ge.FEATURE,properties:{},geometry:{type:ge.POINT,coordinates:Ge}}}),V),le=0;le<Q.length;le++){var be=Q[le];v.feature.updateCoordinate(v.selectedCoordPaths[le],be[0]+se.lng,be[1]+se.lat)}},clickNoTarget:function(){this.changeMode(fe.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(fe.SIMPLE_SELECT)},clickActiveFeature:function(v){v.selectedCoordPaths=[],this.clearSelectedCoordinates(),v.feature.changed()},onSetup:function(v){var E=v.featureId,V=this.getFeature(E);if(!V)throw new Error("You must provide a featureId to enter direct_select mode");if(V.type===ge.POINT)throw new TypeError("direct_select mode doesn't handle point features");var Q={featureId:E,feature:V,dragMoveLocation:v.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:v.coordPath?[v.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(E,Q.selectedCoordPaths)),this.setSelected(E),Wt.disable(this),this.setActionableState({trash:!0}),Q},onStop:function(){Wt.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(v,E,V){v.featureId===E.properties.id?(E.properties.active=je.ACTIVE,V(E),kr(E,{map:this.map,midpoints:!0,selectedPaths:v.selectedCoordPaths}).forEach(V)):(E.properties.active=je.INACTIVE,V(E)),this.fireActionable(v)},onTrash:function(v){v.selectedCoordPaths.sort(function(E,V){return V.localeCompare(E,"en",{numeric:!0})}).forEach(function(E){return v.feature.removeCoordinate(E)}),this.fireUpdate(),v.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(v),v.feature.isValid()===!1&&(this.deleteFeature([v.featureId]),this.changeMode(fe.SIMPLE_SELECT,{}))},onMouseMove:function(v,E){var V=Br(E),Q=Di(E),se=pa(E),le=v.selectedCoordPaths.length===0;return V&&le||Q&&!le?this.updateUIClasses({mouse:xe.MOVE}):this.updateUIClasses({mouse:xe.NONE}),(Q||V||se)&&v.dragMoving&&this.fireUpdate(),this.stopDragging(v),!0},onMouseOut:function(v){return v.dragMoving&&this.fireUpdate(),!0}};to.onTouchStart=to.onMouseDown=function(v,E){return Di(E)?this.onVertex(v,E):Br(E)?this.onFeature(v,E):pa(E)?this.onMidpoint(v,E):void 0},to.onDrag=function(v,E){if(v.canDragMove===!0){v.dragMoving=!0,E.originalEvent.stopPropagation();var V={lng:E.lngLat.lng-v.dragMoveLocation.lng,lat:E.lngLat.lat-v.dragMoveLocation.lat};v.selectedCoordPaths.length>0?this.dragVertex(v,E,V):this.dragFeature(v,E,V),v.dragMoveLocation=E.lngLat}},to.onClick=function(v,E){return as(E)?this.clickNoTarget(v,E):Br(E)?this.clickActiveFeature(v,E):eo(E)?this.clickInactive(v,E):void this.stopDragging(v)},to.onTap=function(v,E){return as(E)?this.clickNoTarget(v,E):Br(E)?this.clickActiveFeature(v,E):eo(E)?this.clickInactive(v,E):void 0},to.onTouchEnd=to.onMouseUp=function(v){v.dragMoving&&this.fireUpdate(),this.stopDragging(v)};var nn={};function rr(v,E){return!!v.lngLat&&v.lngLat.lng===E[0]&&v.lngLat.lat===E[1]}nn.onSetup=function(){var v=this.newFeature({type:ge.FEATURE,properties:{},geometry:{type:ge.POINT,coordinates:[]}});return this.addFeature(v),this.clearSelectedFeatures(),this.updateUIClasses({mouse:xe.ADD}),this.activateUIButton(ye.POINT),this.setActionableState({trash:!0}),{point:v}},nn.stopDrawingAndRemove=function(v){this.deleteFeature([v.point.id],{silent:!0}),this.changeMode(fe.SIMPLE_SELECT)},nn.onTap=nn.onClick=function(v,E){this.updateUIClasses({mouse:xe.MOVE}),v.point.updateCoordinate("",E.lngLat.lng,E.lngLat.lat),this.map.fire(Te.CREATE,{features:[v.point.toGeoJSON()]}),this.changeMode(fe.SIMPLE_SELECT,{featureIds:[v.point.id]})},nn.onStop=function(v){this.activateUIButton(),v.point.getCoordinate().length||this.deleteFeature([v.point.id],{silent:!0})},nn.toDisplayFeatures=function(v,E,V){var Q=E.properties.id===v.point.id;if(E.properties.active=Q?je.ACTIVE:je.INACTIVE,!Q)return V(E)},nn.onTrash=nn.stopDrawingAndRemove,nn.onKeyUp=function(v,E){if(tt(E)||Er(E))return this.stopDrawingAndRemove(v,E)};var cs={onSetup:function(){var v=this.newFeature({type:ge.FEATURE,properties:{},geometry:{type:ge.POLYGON,coordinates:[[]]}});return this.addFeature(v),this.clearSelectedFeatures(),Wt.disable(this),this.updateUIClasses({mouse:xe.ADD}),this.activateUIButton(ye.POLYGON),this.setActionableState({trash:!0}),{polygon:v,currentVertexPosition:0}},clickAnywhere:function(v,E){if(v.currentVertexPosition>0&&rr(E,v.polygon.coordinates[0][v.currentVertexPosition-1]))return this.changeMode(fe.SIMPLE_SELECT,{featureIds:[v.polygon.id]});this.updateUIClasses({mouse:xe.ADD}),v.polygon.updateCoordinate("0."+v.currentVertexPosition,E.lngLat.lng,E.lngLat.lat),v.currentVertexPosition++,v.polygon.updateCoordinate("0."+v.currentVertexPosition,E.lngLat.lng,E.lngLat.lat)},clickOnVertex:function(v){return this.changeMode(fe.SIMPLE_SELECT,{featureIds:[v.polygon.id]})},onMouseMove:function(v,E){v.polygon.updateCoordinate("0."+v.currentVertexPosition,E.lngLat.lng,E.lngLat.lat),Nr(E)&&this.updateUIClasses({mouse:xe.POINTER})}};cs.onTap=cs.onClick=function(v,E){return Nr(E)?this.clickOnVertex(v,E):this.clickAnywhere(v,E)},cs.onKeyUp=function(v,E){tt(E)?(this.deleteFeature([v.polygon.id],{silent:!0}),this.changeMode(fe.SIMPLE_SELECT)):Er(E)&&this.changeMode(fe.SIMPLE_SELECT,{featureIds:[v.polygon.id]})},cs.onStop=function(v){this.updateUIClasses({mouse:xe.NONE}),Wt.enable(this),this.activateUIButton(),this.getFeature(v.polygon.id)!==void 0&&(v.polygon.removeCoordinate("0."+v.currentVertexPosition),v.polygon.isValid()?this.map.fire(Te.CREATE,{features:[v.polygon.toGeoJSON()]}):(this.deleteFeature([v.polygon.id],{silent:!0}),this.changeMode(fe.SIMPLE_SELECT,{},{silent:!0})))},cs.toDisplayFeatures=function(v,E,V){var Q=E.properties.id===v.polygon.id;if(E.properties.active=Q?je.ACTIVE:je.INACTIVE,!Q)return V(E);if(E.geometry.coordinates.length!==0){var se=E.geometry.coordinates[0].length;if(!(se<3)){if(E.properties.meta=Ke.FEATURE,V(Jt(v.polygon.id,E.geometry.coordinates[0][0],"0.0",!1)),se>3){var le=E.geometry.coordinates[0].length-3;V(Jt(v.polygon.id,E.geometry.coordinates[0][le],"0."+le,!1))}if(se<=4){var be=[[E.geometry.coordinates[0][0][0],E.geometry.coordinates[0][0][1]],[E.geometry.coordinates[0][1][0],E.geometry.coordinates[0][1][1]]];if(V({type:ge.FEATURE,properties:E.properties,geometry:{coordinates:be,type:ge.LINE_STRING}}),se===3)return}return V(E)}}},cs.onTrash=function(v){this.deleteFeature([v.polygon.id],{silent:!0}),this.changeMode(fe.SIMPLE_SELECT)};var Un={onSetup:function(v){var E,V,Q=(v=v||{}).featureId,se="forward";if(Q){if(!(E=this.getFeature(Q)))throw new Error("Could not find a feature with the provided featureId");var le=v.from;if(le&&le.type==="Feature"&&le.geometry&&le.geometry.type==="Point"&&(le=le.geometry),le&&le.type==="Point"&&le.coordinates&&le.coordinates.length===2&&(le=le.coordinates),!le||!Array.isArray(le))throw new Error("Please use the `from` property to indicate which point to continue the line from");var be=E.coordinates.length-1;if(E.coordinates[be][0]===le[0]&&E.coordinates[be][1]===le[1])V=be+1,E.addCoordinate.apply(E,[V].concat(E.coordinates[be]));else{if(E.coordinates[0][0]!==le[0]||E.coordinates[0][1]!==le[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");se="backwards",V=0,E.addCoordinate.apply(E,[V].concat(E.coordinates[0]))}}else E=this.newFeature({type:ge.FEATURE,properties:{},geometry:{type:ge.LINE_STRING,coordinates:[]}}),V=0,this.addFeature(E);return this.clearSelectedFeatures(),Wt.disable(this),this.updateUIClasses({mouse:xe.ADD}),this.activateUIButton(ye.LINE),this.setActionableState({trash:!0}),{line:E,currentVertexPosition:V,direction:se}},clickAnywhere:function(v,E){if(v.currentVertexPosition>0&&rr(E,v.line.coordinates[v.currentVertexPosition-1])||v.direction==="backwards"&&rr(E,v.line.coordinates[v.currentVertexPosition+1]))return this.changeMode(fe.SIMPLE_SELECT,{featureIds:[v.line.id]});this.updateUIClasses({mouse:xe.ADD}),v.line.updateCoordinate(v.currentVertexPosition,E.lngLat.lng,E.lngLat.lat),v.direction==="forward"?(v.currentVertexPosition++,v.line.updateCoordinate(v.currentVertexPosition,E.lngLat.lng,E.lngLat.lat)):v.line.addCoordinate(0,E.lngLat.lng,E.lngLat.lat)},clickOnVertex:function(v){return this.changeMode(fe.SIMPLE_SELECT,{featureIds:[v.line.id]})},onMouseMove:function(v,E){v.line.updateCoordinate(v.currentVertexPosition,E.lngLat.lng,E.lngLat.lat),Nr(E)&&this.updateUIClasses({mouse:xe.POINTER})}};Un.onTap=Un.onClick=function(v,E){if(Nr(E))return this.clickOnVertex(v,E);this.clickAnywhere(v,E)},Un.onKeyUp=function(v,E){Er(E)?this.changeMode(fe.SIMPLE_SELECT,{featureIds:[v.line.id]}):tt(E)&&(this.deleteFeature([v.line.id],{silent:!0}),this.changeMode(fe.SIMPLE_SELECT))},Un.onStop=function(v){Wt.enable(this),this.activateUIButton(),this.getFeature(v.line.id)!==void 0&&(v.line.removeCoordinate(""+v.currentVertexPosition),v.line.isValid()?this.map.fire(Te.CREATE,{features:[v.line.toGeoJSON()]}):(this.deleteFeature([v.line.id],{silent:!0}),this.changeMode(fe.SIMPLE_SELECT,{},{silent:!0})))},Un.onTrash=function(v){this.deleteFeature([v.line.id],{silent:!0}),this.changeMode(fe.SIMPLE_SELECT)},Un.toDisplayFeatures=function(v,E,V){var Q=E.properties.id===v.line.id;if(E.properties.active=Q?je.ACTIVE:je.INACTIVE,!Q)return V(E);E.geometry.coordinates.length<2||(E.properties.meta=Ke.FEATURE,V(Jt(v.line.id,E.geometry.coordinates[v.direction==="forward"?E.geometry.coordinates.length-2:1],""+(v.direction==="forward"?E.geometry.coordinates.length-2:1),!1)),V(E))};var jn={simple_select:Rn,direct_select:to,draw_point:nn,draw_polygon:cs,draw_line_string:Un},fa={defaultMode:fe.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:jt,modes:jn,controls:{},userProperties:!1},ws={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},on={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function Ei(v,E){return v.map(function(V){return V.source?V:ke(V,{id:V.id+"."+E,source:E==="hot"?he.HOT:he.COLD})})}var Mo={exports:{}};(function(v,E){var V="__lodash_hash_undefined__",Q=9007199254740991,se="[object Arguments]",le="[object Array]",be="[object Boolean]",Ge="[object Date]",Qe="[object Error]",dt="[object Function]",ft="[object Map]",at="[object Number]",ii="[object Object]",an="[object Promise]",ri="[object RegExp]",Sn="[object Set]",Ne="[object String]",kt="[object Symbol]",Fi="[object WeakMap]",ln="[object ArrayBuffer]",_n="[object DataView]",yr=/^\[object .+?Constructor\]$/,ma=/^(?:0|[1-9]\d*)$/,qi={};qi["[object Float32Array]"]=qi["[object Float64Array]"]=qi["[object Int8Array]"]=qi["[object Int16Array]"]=qi["[object Int32Array]"]=qi["[object Uint8Array]"]=qi["[object Uint8ClampedArray]"]=qi["[object Uint16Array]"]=qi["[object Uint32Array]"]=!0,qi[se]=qi[le]=qi[ln]=qi[be]=qi[_n]=qi[Ge]=qi[Qe]=qi[dt]=qi[ft]=qi[at]=qi[ii]=qi[ri]=qi[Sn]=qi[Ne]=qi[Fi]=!1;var Ss=typeof Vl=="object"&&Vl&&Vl.Object===Object&&Vl,_a=typeof self=="object"&&self&&self.Object===Object&&self,vr=Ss||_a||Function("return this")(),Ao=E&&!E.nodeType&&E,di=Ao&&v&&!v.nodeType&&v,Vs=di&&di.exports===Ao,ur=Vs&&Ss.process,br=function(){try{return ur&&ur.binding&&ur.binding("util")}catch{}}(),ga=br&&br.isTypedArray;function ya(_e,Me){for(var lt=-1,Zt=_e==null?0:_e.length;++lt<Zt;)if(Me(_e[lt],lt,_e))return!0;return!1}function va(_e){var Me=-1,lt=Array(_e.size);return _e.forEach(function(Zt,en){lt[++Me]=[en,Zt]}),lt}function Ja(_e){var Me=-1,lt=Array(_e.size);return _e.forEach(function(Zt){lt[++Me]=Zt}),lt}var ba,Us,xa,Ya=Array.prototype,wa=Function.prototype,js=Object.prototype,Sa=vr["__core-js_shared__"],us=wa.toString,bo=js.hasOwnProperty,gl=(ba=/[^.]+$/.exec(Sa&&Sa.keys&&Sa.keys.IE_PROTO||""))?"Symbol(src)_1."+ba:"",yl=js.toString,Hl=RegExp("^"+us.call(bo).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),vl=Vs?vr.Buffer:void 0,Ta=vr.Symbol,Ia=vr.Uint8Array,qs=js.propertyIsEnumerable,Qa=Ya.splice,Po=Ta?Ta.toStringTag:void 0,hs=Object.getOwnPropertySymbols,bl=vl?vl.isBuffer:void 0,xl=(Us=Object.keys,xa=Object,function(_e){return Us(xa(_e))}),Zs=ds(vr,"DataView"),io=ds(vr,"Map"),Ca=ds(vr,"Promise"),xo=ds(vr,"Set"),qo=ds(vr,"WeakMap"),Ts=ds(Object,"create"),$a=Ho(Zs),ki=Ho(io),cn=Ho(Ca),Xl=Ho(xo),mi=Ho(qo),Zo=Ta?Ta.prototype:void 0,$i=Zo?Zo.valueOf:void 0;function Ri(_e){var Me=-1,lt=_e==null?0:_e.length;for(this.clear();++Me<lt;){var Zt=_e[Me];this.set(Zt[0],Zt[1])}}function Mr(_e){var Me=-1,lt=_e==null?0:_e.length;for(this.clear();++Me<lt;){var Zt=_e[Me];this.set(Zt[0],Zt[1])}}function Go(_e){var Me=-1,lt=_e==null?0:_e.length;for(this.clear();++Me<lt;){var Zt=_e[Me];this.set(Zt[0],Zt[1])}}function Is(_e){var Me=-1,lt=_e==null?0:_e.length;for(this.__data__=new Go;++Me<lt;)this.add(_e[Me])}function no(_e){var Me=this.__data__=new Mr(_e);this.size=Me.size}function Ea(_e,Me){var lt=ps(_e),Zt=!lt&&La(_e),en=!lt&&!Zt&&za(_e),Si=!lt&&!Zt&&!en&&Ms(_e),gn=lt||Zt||en||Si,Tn=gn?function(Oi,xr){for(var To=-1,or=Array(Oi);++To<Oi;)or[To]=xr(To);return or}(_e.length,String):[],En=Tn.length;for(var yn in _e)!Me&&!bo.call(_e,yn)||gn&&(yn=="length"||en&&(yn=="offset"||yn=="parent")||Si&&(yn=="buffer"||yn=="byteLength"||yn=="byteOffset")||Sl(yn,En))||Tn.push(yn);return Tn}function Cs(_e,Me){for(var lt=_e.length;lt--;)if(ks(_e[lt][0],Me))return lt;return-1}function Wo(_e){return _e==null?_e===void 0?"[object Undefined]":"[object Null]":Po&&Po in Object(_e)?function(Me){var lt=bo.call(Me,Po),Zt=Me[Po];try{Me[Po]=void 0;var en=!0}catch{}var Si=yl.call(Me);return en&&(lt?Me[Po]=Zt:delete Me[Po]),Si}(_e):function(Me){return yl.call(Me)}(_e)}function ka(_e){return So(_e)&&Wo(_e)==se}function Es(_e,Me,lt,Zt,en){return _e===Me||(_e==null||Me==null||!So(_e)&&!So(Me)?_e!=_e&&Me!=Me:function(Si,gn,Tn,En,yn,Oi){var xr=ps(Si),To=ps(gn),or=xr?le:wo(Si),Io=To?le:wo(gn),wr=(or=or==se?ii:or)==ii,Hs=(Io=Io==se?ii:Io)==ii,Gn=or==Io;if(Gn&&za(Si)){if(!za(gn))return!1;xr=!0,wr=!1}if(Gn&&!wr)return Oi||(Oi=new no),xr||Ms(Si)?wl(Si,gn,Tn,En,yn,Oi):function(Ki,Bi,Ks,ro,Ko,kn,ht){switch(Ks){case _n:if(Ki.byteLength!=Bi.byteLength||Ki.byteOffset!=Bi.byteOffset)return!1;Ki=Ki.buffer,Bi=Bi.buffer;case ln:return!(Ki.byteLength!=Bi.byteLength||!kn(new Ia(Ki),new Ia(Bi)));case be:case Ge:case at:return ks(+Ki,+Bi);case Qe:return Ki.name==Bi.name&&Ki.message==Bi.message;case ri:case Ne:return Ki==Bi+"";case ft:var oo=va;case Sn:var qr=1&ro;if(oo||(oo=Ja),Ki.size!=Bi.size&&!qr)return!1;var Do=ht.get(Ki);if(Do)return Do==Bi;ro|=2,ht.set(Ki,Bi);var fs=wl(oo(Ki),oo(Bi),ro,Ko,kn,ht);return ht.delete(Ki),fs;case kt:if($i)return $i.call(Ki)==$i.call(Bi)}return!1}(Si,gn,or,Tn,En,yn,Oi);if(!(1&Tn)){var Ar=wr&&bo.call(Si,"__wrapped__"),Xs=Hs&&bo.call(gn,"__wrapped__");if(Ar||Xs){var Lo=Ar?Si.value():Si,zo=Xs?gn.value():gn;return Oi||(Oi=new no),yn(Lo,zo,Tn,En,Oi)}}return Gn?(Oi||(Oi=new no),function(Ki,Bi,Ks,ro,Ko,kn){var ht=1&Ks,oo=Ma(Ki),qr=oo.length,Do=Ma(Bi).length;if(qr!=Do&&!ht)return!1;for(var fs=qr;fs--;){var ot=oo[fs];if(!(ht?ot in Bi:bo.call(Bi,ot)))return!1}var Fa=kn.get(Ki);if(Fa&&kn.get(Bi))return Fa==Bi;var As=!0;kn.set(Ki,Bi),kn.set(Bi,Ki);for(var el=ht;++fs<qr;){var Ps=Ki[ot=oo[fs]],Js=Bi[ot];if(ro)var tl=ht?ro(Js,Ps,ot,Bi,Ki,kn):ro(Ps,Js,ot,Ki,Bi,kn);if(!(tl===void 0?Ps===Js||Ko(Ps,Js,Ks,ro,kn):tl)){As=!1;break}el||(el=ot=="constructor")}if(As&&!el){var Ys=Ki.constructor,Ra=Bi.constructor;Ys==Ra||!("constructor"in Ki)||!("constructor"in Bi)||typeof Ys=="function"&&Ys instanceof Ys&&typeof Ra=="function"&&Ra instanceof Ra||(As=!1)}return kn.delete(Ki),kn.delete(Bi),As}(Si,gn,Tn,En,yn,Oi)):!1}(_e,Me,lt,Zt,Es,en))}function Gs(_e){return!(!hr(_e)||function(Me){return!!gl&&gl in Me}(_e))&&(un(_e)?Hl:yr).test(Ho(_e))}function Ws(_e){if(lt=(Me=_e)&&Me.constructor,Zt=typeof lt=="function"&&lt.prototype||js,Me!==Zt)return xl(_e);var Me,lt,Zt,en=[];for(var Si in Object(_e))bo.call(_e,Si)&&Si!="constructor"&&en.push(Si);return en}function wl(_e,Me,lt,Zt,en,Si){var gn=1&lt,Tn=_e.length,En=Me.length;if(Tn!=En&&!(gn&&En>Tn))return!1;var yn=Si.get(_e);if(yn&&Si.get(Me))return yn==Me;var Oi=-1,xr=!0,To=2&lt?new Is:void 0;for(Si.set(_e,Me),Si.set(Me,_e);++Oi<Tn;){var or=_e[Oi],Io=Me[Oi];if(Zt)var wr=gn?Zt(Io,or,Oi,Me,_e,Si):Zt(or,Io,Oi,_e,Me,Si);if(wr!==void 0){if(wr)continue;xr=!1;break}if(To){if(!ya(Me,function(Hs,Gn){if(Ar=Gn,!To.has(Ar)&&(or===Hs||en(or,Hs,lt,Zt,Si)))return To.push(Gn);var Ar})){xr=!1;break}}else if(or!==Io&&!en(or,Io,lt,Zt,Si)){xr=!1;break}}return Si.delete(_e),Si.delete(Me),xr}function Ma(_e){return function(Me,lt,Zt){var en=lt(Me);return ps(Me)?en:function(Si,gn){for(var Tn=-1,En=gn.length,yn=Si.length;++Tn<En;)Si[yn+Tn]=gn[Tn];return Si}(en,Zt(Me))}(_e,Da,Pa)}function Aa(_e,Me){var lt,Zt,en=_e.__data__;return((Zt=typeof(lt=Me))=="string"||Zt=="number"||Zt=="symbol"||Zt=="boolean"?lt!=="__proto__":lt===null)?en[typeof Me=="string"?"string":"hash"]:en.map}function ds(_e,Me){var lt=function(Zt,en){return Zt==null?void 0:Zt[en]}(_e,Me);return Gs(lt)?lt:void 0}Ri.prototype.clear=function(){this.__data__=Ts?Ts(null):{},this.size=0},Ri.prototype.delete=function(_e){var Me=this.has(_e)&&delete this.__data__[_e];return this.size-=Me?1:0,Me},Ri.prototype.get=function(_e){var Me=this.__data__;if(Ts){var lt=Me[_e];return lt===V?void 0:lt}return bo.call(Me,_e)?Me[_e]:void 0},Ri.prototype.has=function(_e){var Me=this.__data__;return Ts?Me[_e]!==void 0:bo.call(Me,_e)},Ri.prototype.set=function(_e,Me){var lt=this.__data__;return this.size+=this.has(_e)?0:1,lt[_e]=Ts&&Me===void 0?V:Me,this},Mr.prototype.clear=function(){this.__data__=[],this.size=0},Mr.prototype.delete=function(_e){var Me=this.__data__,lt=Cs(Me,_e);return!(lt<0)&&(lt==Me.length-1?Me.pop():Qa.call(Me,lt,1),--this.size,!0)},Mr.prototype.get=function(_e){var Me=this.__data__,lt=Cs(Me,_e);return lt<0?void 0:Me[lt][1]},Mr.prototype.has=function(_e){return Cs(this.__data__,_e)>-1},Mr.prototype.set=function(_e,Me){var lt=this.__data__,Zt=Cs(lt,_e);return Zt<0?(++this.size,lt.push([_e,Me])):lt[Zt][1]=Me,this},Go.prototype.clear=function(){this.size=0,this.__data__={hash:new Ri,map:new(io||Mr),string:new Ri}},Go.prototype.delete=function(_e){var Me=Aa(this,_e).delete(_e);return this.size-=Me?1:0,Me},Go.prototype.get=function(_e){return Aa(this,_e).get(_e)},Go.prototype.has=function(_e){return Aa(this,_e).has(_e)},Go.prototype.set=function(_e,Me){var lt=Aa(this,_e),Zt=lt.size;return lt.set(_e,Me),this.size+=lt.size==Zt?0:1,this},Is.prototype.add=Is.prototype.push=function(_e){return this.__data__.set(_e,V),this},Is.prototype.has=function(_e){return this.__data__.has(_e)},no.prototype.clear=function(){this.__data__=new Mr,this.size=0},no.prototype.delete=function(_e){var Me=this.__data__,lt=Me.delete(_e);return this.size=Me.size,lt},no.prototype.get=function(_e){return this.__data__.get(_e)},no.prototype.has=function(_e){return this.__data__.has(_e)},no.prototype.set=function(_e,Me){var lt=this.__data__;if(lt instanceof Mr){var Zt=lt.__data__;if(!io||Zt.length<199)return Zt.push([_e,Me]),this.size=++lt.size,this;lt=this.__data__=new Go(Zt)}return lt.set(_e,Me),this.size=lt.size,this};var Pa=hs?function(_e){return _e==null?[]:(_e=Object(_e),function(Me,lt){for(var Zt=-1,en=Me==null?0:Me.length,Si=0,gn=[];++Zt<en;){var Tn=Me[Zt];lt(Tn,Zt,Me)&&(gn[Si++]=Tn)}return gn}(hs(_e),function(Me){return qs.call(_e,Me)}))}:function(){return[]},wo=Wo;function Sl(_e,Me){return!!(Me=Me??Q)&&(typeof _e=="number"||ma.test(_e))&&_e>-1&&_e%1==0&&_e<Me}function Ho(_e){if(_e!=null){try{return us.call(_e)}catch{}try{return _e+""}catch{}}return""}function ks(_e,Me){return _e===Me||_e!=_e&&Me!=Me}(Zs&&wo(new Zs(new ArrayBuffer(1)))!=_n||io&&wo(new io)!=ft||Ca&&wo(Ca.resolve())!=an||xo&&wo(new xo)!=Sn||qo&&wo(new qo)!=Fi)&&(wo=function(_e){var Me=Wo(_e),lt=Me==ii?_e.constructor:void 0,Zt=lt?Ho(lt):"";if(Zt)switch(Zt){case $a:return _n;case ki:return ft;case cn:return an;case Xl:return Sn;case mi:return Fi}return Me});var La=ka(function(){return arguments}())?ka:function(_e){return So(_e)&&bo.call(_e,"callee")&&!qs.call(_e,"callee")},ps=Array.isArray,za=bl||function(){return!1};function un(_e){if(!hr(_e))return!1;var Me=Wo(_e);return Me==dt||Me=="[object GeneratorFunction]"||Me=="[object AsyncFunction]"||Me=="[object Proxy]"}function Xo(_e){return typeof _e=="number"&&_e>-1&&_e%1==0&&_e<=Q}function hr(_e){var Me=typeof _e;return _e!=null&&(Me=="object"||Me=="function")}function So(_e){return _e!=null&&typeof _e=="object"}var Ms=ga?function(_e){return function(Me){return _e(Me)}}(ga):function(_e){return So(_e)&&Xo(_e.length)&&!!qi[Wo(_e)]};function Da(_e){return(Me=_e)!=null&&Xo(Me.length)&&!un(Me)?Ea(_e):Ws(_e);var Me}v.exports=function(_e,Me){return Es(_e,Me)}})(Mo,Mo.exports);var sn=d(Mo.exports);function Bs(v,E){return v.length===E.length&&JSON.stringify(v.map(function(V){return V}).sort())===JSON.stringify(E.map(function(V){return V}).sort())}var jr={Polygon:qe,LineString:Li,Point:bi,MultiPolygon:si,MultiLineString:si,MultiPoint:si},Ka=Object.freeze({__proto__:null,CommonSelectors:mn,constrainFeatureMovement:Vo,createMidPoint:ir,createSupplementaryPoints:kr,createVertex:Jt,doubleClickZoom:Wt,euclideanDistance:Lt,featuresAt:$e,getFeatureAtAndSetCursors:Pt,isClick:ui,isEventAtCoordinates:rr,isTap:Ln,mapEventToBoundingBox:De,ModeHandler:h,moveFeatures:Uo,sortFeatures:Nt,stringSetsAreEqual:Bs,StringSet:Je,theme:jt,toDenseArray:Ui}),jo=function(v,E){var V={options:v=function(se){se===void 0&&(se={});var le=ke(se);return se.controls||(le.controls={}),se.displayControlsDefault===!1?le.controls=ke(on,se.controls):le.controls=ke(ws,se.controls),(le=ke(fa,le)).styles=Ei(le.styles,"cold").concat(Ei(le.styles,"hot")),le}(v)};E=function(se,le){return le.modes=fe,le.getFeatureIdsAt=function(be){return $e.click({point:be},null,se).map(function(Ge){return Ge.properties.id})},le.getSelectedIds=function(){return se.store.getSelectedIds()},le.getSelected=function(){return{type:ge.FEATURE_COLLECTION,features:se.store.getSelectedIds().map(function(be){return se.store.get(be)}).map(function(be){return be.toGeoJSON()})}},le.getSelectedPoints=function(){return{type:ge.FEATURE_COLLECTION,features:se.store.getSelectedCoordinates().map(function(be){return{type:ge.FEATURE,properties:{},geometry:{type:ge.POINT,coordinates:be.coordinates}}})}},le.set=function(be){if(be.type===void 0||be.type!==ge.FEATURE_COLLECTION||!Array.isArray(be.features))throw new Error("Invalid FeatureCollection");var Ge=se.store.createRenderBatch(),Qe=se.store.getAllIds().slice(),dt=le.add(be),ft=new Je(dt);return(Qe=Qe.filter(function(at){return!ft.has(at)})).length&&le.delete(Qe),Ge(),dt},le.add=function(be){var Ge=JSON.parse(JSON.stringify(B(be))).features.map(function(Qe){if(Qe.id=Qe.id||Mi(),Qe.geometry===null)throw new Error("Invalid geometry: null");if(se.store.get(Qe.id)===void 0||se.store.get(Qe.id).type!==Qe.geometry.type){var dt=jr[Qe.geometry.type];if(dt===void 0)throw new Error("Invalid geometry type: "+Qe.geometry.type+".");var ft=new dt(se,Qe);se.store.add(ft)}else{var at=se.store.get(Qe.id);at.properties=Qe.properties,sn(at.properties,Qe.properties)||se.store.featureChanged(at.id),sn(at.getCoordinates(),Qe.geometry.coordinates)||at.incomingCoords(Qe.geometry.coordinates)}return Qe.id});return se.store.render(),Ge},le.get=function(be){var Ge=se.store.get(be);if(Ge)return Ge.toGeoJSON()},le.getAll=function(){return{type:ge.FEATURE_COLLECTION,features:se.store.getAll().map(function(be){return be.toGeoJSON()})}},le.delete=function(be){return se.store.delete(be,{silent:!0}),le.getMode()!==fe.DIRECT_SELECT||se.store.getSelectedIds().length?se.store.render():se.events.changeMode(fe.SIMPLE_SELECT,void 0,{silent:!0}),le},le.deleteAll=function(){return se.store.delete(se.store.getAllIds(),{silent:!0}),le.getMode()===fe.DIRECT_SELECT?se.events.changeMode(fe.SIMPLE_SELECT,void 0,{silent:!0}):se.store.render(),le},le.changeMode=function(be,Ge){return Ge===void 0&&(Ge={}),be===fe.SIMPLE_SELECT&&le.getMode()===fe.SIMPLE_SELECT?(Bs(Ge.featureIds||[],se.store.getSelectedIds())||(se.store.setSelected(Ge.featureIds,{silent:!0}),se.store.render()),le):(be===fe.DIRECT_SELECT&&le.getMode()===fe.DIRECT_SELECT&&Ge.featureId===se.store.getSelectedIds()[0]||se.events.changeMode(be,Ge,{silent:!0}),le)},le.getMode=function(){return se.events.getMode()},le.trash=function(){return se.events.trash({silent:!0}),le},le.combineFeatures=function(){return se.events.combineFeatures({silent:!0}),le},le.uncombineFeatures=function(){return se.events.uncombineFeatures({silent:!0}),le},le.setFeatureProperty=function(be,Ge,Qe){return se.store.setFeatureProperty(be,Ge,Qe),le},le}(V,E),V.api=E;var Q=zi(V);return E.onAdd=Q.onAdd,E.onRemove=Q.onRemove,E.types=ye,E.options=v,E};function Ns(v){jo(v,this)}return Ns.modes=jn,Ns.constants=yt,Ns.lib=Ka,Ns})})(Uf);var zy=Uf.exports;const Wa=Pf(zy);function Dy(f){let a,h,d;return{c(){a=Ae("button"),a.textContent="Import current view",yi(a,"type","button")},m(y,S){Ye(y,a,S),h||(d=fi(a,"click",f[0]),h=!0)},p:vi,i:vi,o:vi,d(y){y&&Xe(a),h=!1,d()}}}function Fy(f){let a='poly:"';for(let[d,y]of f.geometry.coordinates[0])a+=`${y} ${d} `;return a=a.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${a}); node(w)->.x; <;); out meta;`}`}function Mc(f){return[f.lng,f.lat]}function Ry(f,a,h){let{map:d}=a;const y=Wc();let S=null;xs(()=>{d!=null&&d.loaded()&&S&&d.removeControl(S)});async function k(M){try{y("loading","Loading from Overpass");let ie=await(await fetch(Fy(M))).text();y("gotXml",ie)}catch(q){y("error",q.toString())}}function s(){let M=d.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[Mc(M.getSouthWest()),Mc(M.getNorthWest()),Mc(M.getNorthEast()),Mc(M.getSouthEast()),Mc(M.getSouthWest())]],type:"Polygon"}}}async function F(){if(d){if(d.getZoom()<13){y("error","Zoom in more to import");return}await k(s())}}return f.$$set=M=>{"map"in M&&h(1,d=M.map)},f.$$.update=()=>{f.$$.dirty&14&&d&&!S&&(h(2,Wa.constants.classes.CONTROL_BASE="maplibregl-ctrl",Wa),h(2,Wa.constants.classes.CONTROL_PREFIX="maplibregl-ctrl-",Wa),h(2,Wa.constants.classes.CONTROL_GROUP="maplibregl-ctrl-group",Wa),h(3,S=new Wa({displayControlsDefault:!1,controls:{polygon:!0}})),d.addControl(S),d.on("draw.create",async M=>{let q=M.features[0];S.deleteAll(),await k(q)}))},[F,d,Wa,S]}class Oy extends Hi{constructor(a){super(),Wi(this,a,Ry,Dy,Vi,{map:1})}}function ef(f,a,h){const d=f.slice();return d[1]=a[h][0],d[2]=a[h][1],d}function tf(f){let a,h,d=f[1]+"",y,S,k=f[2]+"",s;return{c(){a=Ae("tr"),h=Ae("td"),y=Gi(d),S=Ae("td"),s=Gi(k)},m(F,M){Ye(F,a,M),Ee(a,h),Ee(h,y),Ee(a,S),Ee(S,s)},p(F,M){M&1&&d!==(d=F[1]+"")&&Rs(y,d),M&1&&k!==(k=F[2]+"")&&Rs(s,k)},d(F){F&&Xe(a)}}}function By(f){let a,h,d=Pu(Object.entries(f[0])),y=[];for(let S=0;S<d.length;S+=1)y[S]=tf(ef(f,d,S));return{c(){a=Ae("table"),h=Ae("tbody");for(let S=0;S<y.length;S+=1)y[S].c();yi(a,"class","svelte-lh2o9l")},m(S,k){Ye(S,a,k),Ee(a,h);for(let s=0;s<y.length;s+=1)y[s]&&y[s].m(h,null)},p(S,[k]){if(k&1){d=Pu(Object.entries(S[0]));let s;for(s=0;s<d.length;s+=1){const F=ef(S,d,s);y[s]?y[s].p(F,k):(y[s]=tf(F),y[s].c(),y[s].m(h,null))}for(;s<y.length;s+=1)y[s].d(1);y.length=d.length}},i:vi,o:vi,d(S){S&&Xe(a),Sf(y,S)}}}function Ny(f,a,h){let{properties:d}=a;return f.$$set=y=>{"properties"in y&&h(0,d=y.properties)},[d]}class Kh extends Hi{constructor(a){super(),Wi(this,a,Ny,By,Vi,{properties:0})}}const jf=["==",["geometry-type"],"Polygon"],qf=["==",["geometry-type"],"LineString"],Zf=["==",["geometry-type"],"Point"];function Zl(f,a,h){let d=["match",f];for(let[y,S]of Object.entries(a))d.push(y),d.push(S);return d.push(h),d}function Vy(f,a){let h=document.createElement("a");h.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(a)),h.setAttribute("download",f),document.body.appendChild(h),h.click(),document.body.removeChild(h)}function tr(f){if(f==null||f==null)throw new Error("Oops, notNull given something null");return f}const Gf=ar({type:"FeatureCollection",features:[]}),Uy=ar(!0),Wf=ar(0),jy=30;class qy{constructor(a,h){Yr(this,"map");Yr(this,"inner");Yr(this,"active");Yr(this,"eventListenersSuccess");Yr(this,"eventListenersUpdated");Yr(this,"eventListenersFailure");Yr(this,"onMouseMove",a=>{if(!this.active)return;const h=[a.point.x-jy,a.point.y],d=this.map.unproject(a.point).distanceTo(this.map.unproject(h));this.inner.onMouseMove(a.lngLat.lng,a.lngLat.lat,d)&&(this.redraw(),this.dataUpdated())});Yr(this,"onClick",()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())});Yr(this,"onDoubleClick",a=>{this.active&&(a.preventDefault(),this.inner.onClick(),this.finish())});Yr(this,"onDragStart",()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()});Yr(this,"onMouseUp",()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()});Yr(this,"onKeyDown",a=>{this.active&&a.key=="Escape"&&(a.stopPropagation(),this.cancel())});Yr(this,"onKeyPress",a=>{this.active&&a.target.tagName!="INPUT"&&(a.key=="Enter"?(a.stopPropagation(),this.finish()):a.key=="s"?(a.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):a.key=="z"&&a.ctrlKey&&this.undo())});this.map=a,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Lu(h),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(a){a.properties??(a.properties={}),this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),a.properties.waypoints||(a.properties.waypoints=[{lon:a.geometry.coordinates[0][0],lat:a.geometry.coordinates[0][1],snapped:!0},{lon:a.geometry.coordinates[a.geometry.coordinates.length-1][0],lat:a.geometry.coordinates[a.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(a.properties.waypoints),this.redraw()}editExistingArea(a){a.properties??(a.properties={}),this.active&&window.alert("Bug: editExistingArea called when tool is already active"),a.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(a.properties.waypoints),this.redraw()}addEventListenerSuccess(a){this.eventListenersSuccess.push(a)}addEventListenerUpdated(a){this.eventListenersUpdated.push(a)}addEventListenerFailure(a){this.eventListenersFailure.push(a)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let a=this.inner.toFinalFeature();if(a)for(let h of this.eventListenersSuccess)h(JSON.parse(a));else for(let h of this.eventListenersFailure)h();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(a){this.inner.setRouteConfig(a),this.redraw()}addSnappedWaypoint(a){this.inner.addSnappedWaypoint(a[0],a[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}redraw(){let a=JSON.parse(this.inner.renderGeojson());Gf.set(a),this.map.getCanvas().style.cursor=a.cursor,Uy.set(a.snap_mode),Wf.set(a.undo_length)}dataUpdated(){let a=this.inner.toFinalFeature();if(a)for(let h of this.eventListenersUpdated)h(JSON.parse(a))}}function nf(f,a,h){const d=f.slice();return d[7]=a[h][0],d[8]=a[h][1],d[9]=a[h][2],d}function rf(f){let a,h,d,y,S=f[8]+"",k,s,F,M,q;function ie(){return f[3](f[7])}return{c(){a=Ae("div"),h=Ae("button"),d=Ae("img"),k=Gi(S),F=Tt(),zh(d.src,y=`/filters/${f[7]}.svg`)||yi(d,"src",y),yi(d,"alt",f[8]),Ul(h,"width","100%"),h.disabled=s=f[0]==f[7]},m(he,xe){Ye(he,a,xe),Ee(a,h),Ee(h,d),Ee(h,k),Ee(a,F),M||(q=fi(h,"click",ie),M=!0)},p(he,xe){f=he,xe&1&&s!==(s=f[0]==f[7])&&(h.disabled=s)},d(he){he&&Xe(a),M=!1,q()}}}function Zy(f){let a,h,d,y,S,k,s,F,M,q,ie,he,xe=f[1][2]+"",ye,ge,fe,Te,Pe,Ke,je=Pu(f[2]),St=[];for(let yt=0;yt<je.length;yt+=1)St[yt]=rf(nf(f,je,yt));function vt(){return f[4](f[6])}return{c(){a=Ae("h3"),a.textContent="Choose a modal filter to place on streets",h=Tt(),d=Ae("table"),y=Ae("tr"),S=Ae("td");for(let yt=0;yt<St.length;yt+=1)St[yt].c();k=Tt(),s=Ae("td"),F=Ae("img"),ie=Tt(),he=Ae("p"),ye=Gi(xe),ge=Tt(),fe=Ae("center"),Te=Ae("button"),Te.textContent="Confirm",zh(F.src,M=`/filters/${f[0]}.gif`)||yi(F,"src",M),yi(F,"height","300"),yi(F,"alt",q=f[1][1])},m(yt,zt){Ye(yt,a,zt),Ye(yt,h,zt),Ye(yt,d,zt),Ee(d,y),Ee(y,S);for(let wt=0;wt<St.length;wt+=1)St[wt]&&St[wt].m(S,null);Ee(y,k),Ee(y,s),Ee(s,F),Ee(s,ie),Ee(s,he),Ee(he,ye),Ye(yt,ge,zt),Ye(yt,fe,zt),Ee(fe,Te),Pe||(Ke=fi(Te,"click",vt),Pe=!0)},p(yt,zt){if(f=yt,zt&5){je=Pu(f[2]);let wt;for(wt=0;wt<je.length;wt+=1){const Nt=nf(f,je,wt);St[wt]?St[wt].p(Nt,zt):(St[wt]=rf(Nt),St[wt].c(),St[wt].m(S,null))}for(;wt<St.length;wt+=1)St[wt].d(1);St.length=je.length}zt&1&&!zh(F.src,M=`/filters/${f[0]}.gif`)&&yi(F,"src",M),zt&2&&q!==(q=f[1][1])&&yi(F,"alt",q),zt&2&&xe!==(xe=f[1][2]+"")&&Rs(ye,xe)},d(yt){yt&&(Xe(a),Xe(h),Xe(d),Xe(ge),Xe(fe)),Sf(St,yt),Pe=!1,Ke()}}}function Gy(f){let a,h;return a=new Vf({props:{$$slots:{default:[Zy,({dialog:d})=>({6:d}),({dialog:d})=>d?64:0]},$$scope:{ctx:f}}}),a.$on("close",f[5]),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p(d,[y]){const S={};y&4163&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function Wy(f,a,h){let d,{filterType:y}=a,S=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]];const k=M=>h(0,y=M),s=M=>tr(M).close();function F(M){sr.call(this,f,M)}return f.$$set=M=>{"filterType"in M&&h(0,y=M.filterType)},f.$$.update=()=>{f.$$.dirty&1&&h(1,d=S.find(M=>M[0]==y))},[y,d,S,k,s,F]}class Hy extends Hi{constructor(a){super(),Wi(this,a,Wy,Gy,Vi,{filterType:0})}}function of(f){let a,h;return a=new Xa({props:{data:f[0],$$slots:{default:[Xy]},$$scope:{ctx:f}}}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p(d,y){const S={};y&1&&(S.data=d[0]),y&64&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function Xy(f){let a,h;return a=new _l({props:{paint:{"line-width":5,"line-color":"red"}}}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p:vi,i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function Ky(f){let a,h,d=f[0]&&of(f);return{c(){d&&d.c(),a=ss()},m(y,S){d&&d.m(y,S),Ye(y,a,S),h=!0},p(y,[S]){y[0]?d?(d.p(y,S),S&1&&ze(d,1)):(d=of(y),d.c(),ze(d,1),d.m(a.parentNode,a)):d&&(lr(),Ve(d,1,1,()=>{d=null}),cr())},i(y){h||(ze(d),h=!0)},o(y){Ve(d),h=!1},d(y){y&&Xe(a),d&&d.d(y)}}}function Jy(f,a,h){let{map:d}=a,y=null;const S=Wc();d.on("dragstart",k),d.on("mousemove",s),d.on("mouseup",F),xs(()=>{d.dragPan.enable(),d.off("dragstart",k),d.off("mousemove",s),d.off("mouseup",F)});function k(){d.dragPan.disable(),h(0,y={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function s(M){y&&(y.geometry.coordinates.push(M.lngLat.toArray()),h(0,y))}function F(){y&&(S("done",y),h(0,y=null))}return f.$$set=M=>{"map"in M&&h(1,d=M.map)},[y,d]}class Yy extends Hi{constructor(a){super(),Wi(this,a,Jy,Ky,Vi,{map:1})}}let bs=ar(null),er=ar({mode:"title"}),Nh=ar(!0),ml=ar(null),Oc=ar(""),Vh=ar(null),Uh=ar(null);function Qy(f){let a,h,d,y,S,k,s,F,M,q,ie,he,xe,ye,ge,fe,Te,Pe,Ke;return fe=new Nf({props:{msg:f[0]}}),{c(){a=Ae("details"),h=Ae("summary"),h.textContent="Save / load project",d=Tt(),y=Ae("div"),S=Ae("button"),S.textContent="Save to GJ",k=Tt(),s=Ae("div"),F=Ae("label"),M=Gi(`Load edits from GJ
      `),q=Ae("input"),ie=Tt(),he=Ae("div"),xe=Ae("button"),xe.textContent="Save to local storage",ye=Ae("button"),ye.textContent="Load from local storage",ge=Tt(),Vt(fe.$$.fragment),yi(q,"type","file")},m(je,St){Ye(je,a,St),Ee(a,h),Ee(a,d),Ee(a,y),Ee(y,S),Ee(a,k),Ee(a,s),Ee(s,F),Ee(F,M),Ee(F,q),f[7](q),Ee(a,ie),Ee(a,he),Ee(he,xe),Ee(he,ye),Ye(je,ge,St),Ot(fe,je,St),Te=!0,Pe||(Ke=[fi(S,"click",f[2]),fi(q,"change",f[3]),fi(xe,"click",f[5]),fi(ye,"click",f[4])],Pe=!0)},p(je,[St]){const vt={};St&1&&(vt.msg=je[0]),fe.$set(vt)},i(je){Te||(ze(fe.$$.fragment,je),Te=!0)},o(je){Ve(fe.$$.fragment,je),Te=!1},d(je){je&&(Xe(a),Xe(ge)),f[7](null),Bt(fe,je),Pe=!1,os(Ke)}}}function $y(f,a,h){let d,y,S,k;ni(f,bs,ge=>h(9,y=ge)),ni(f,er,ge=>h(10,S=ge)),ni(f,Oc,ge=>h(6,k=ge));let s=null;function F(){Vy(d,y.toSavefile())}let M;async function q(ge){try{ie(await M.files[0].text())}catch(fe){window.alert(`Couldn't open this file: ${fe}`)}h(0,s=null)}function ie(ge){h(0,s="Loading edits from file or local storage"),y.loadSavefile(JSON.parse(ge))?fn(er,S={mode:"neighbourhood"},S):fn(er,S={mode:"network"},S),h(0,s=null)}function he(){let ge=window.localStorage.getItem(d);ge?ie(ge):window.alert("Nothing saved")}function xe(){window.localStorage.setItem(d,y.toSavefile())}function ye(ge){Or[ge?"unshift":"push"](()=>{M=ge,h(1,M)})}return f.$$.update=()=>{f.$$.dirty&64&&(d=`ltn_${k||"custom"}.geojson`)},[s,M,F,q,he,xe,k,ye]}class Hf extends Hi{constructor(a){super(),Wi(this,a,$y,Qy,Vi,{})}}const e0=f=>({}),sf=f=>({}),t0=f=>({}),af=f=>({});function lf(f){let a;const h=f[7]["line-popup"],d=fo(h,f,f[10],af);return{c(){d&&d.c()},m(y,S){d&&d.m(y,S),a=!0},p(y,S){d&&d.p&&(!a||S&1024)&&_o(d,h,y,y[10],a?mo(h,y[10],S,t0):go(y[10]),af)},i(y){a||(ze(d,y),a=!0)},o(y){Ve(d,y),a=!1},d(y){d&&d.d(y)}}}function i0(f){let a,h,d=f[0]&&lf(f);return{c(){d&&d.c(),a=ss()},m(y,S){d&&d.m(y,S),Ye(y,a,S),h=!0},p(y,S){y[0]?d?(d.p(y,S),S&1&&ze(d,1)):(d=lf(y),d.c(),ze(d,1),d.m(a.parentNode,a)):d&&(lr(),Ve(d,1,1,()=>{d=null}),cr())},i(y){h||(ze(d),h=!0)},o(y){Ve(d),h=!1},d(y){y&&Xe(a),d&&d.d(y)}}}function cf(f){let a;const h=f[7]["circle-popup"],d=fo(h,f,f[10],sf);return{c(){d&&d.c()},m(y,S){d&&d.m(y,S),a=!0},p(y,S){d&&d.p&&(!a||S&1024)&&_o(d,h,y,y[10],a?mo(h,y[10],S,e0):go(y[10]),sf)},i(y){a||(ze(d,y),a=!0)},o(y){Ve(d,y),a=!1},d(y){d&&d.d(y)}}}function n0(f){let a,h,d=f[0]&&cf(f);return{c(){d&&d.c(),a=ss()},m(y,S){d&&d.m(y,S),Ye(y,a,S),h=!0},p(y,S){y[0]?d?(d.p(y,S),S&1&&ze(d,1)):(d=cf(y),d.c(),ze(d,1),d.m(a.parentNode,a)):d&&(lr(),Ve(d,1,1,()=>{d=null}),cr())},i(y){h||(ze(d),h=!0)},o(y){Ve(d),h=!1},d(y){y&&Xe(a),d&&d.d(y)}}}function r0(f){let a,h,d,y,S,k;return a=new Hh({props:{beforeId:f[5]?"Building":void 0,filter:jf,manageHoverState:!0,paint:{"fill-color":["get","color"],"fill-opacity":f[0]?Op(.3,.5):.3}}}),d=new _l({props:{filter:qf,paint:{"line-width":5,"line-color":Zl(["get","kind"],{interior_road:["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",f[4],"#A32015"],crosses:"blue"},"red")},hoverCursor:f[0]?"pointer":void 0,$$slots:{default:[i0]},$$scope:{ctx:f}}}),d.$on("click",f[8]),S=new Ff({props:{filter:Zf,paint:{"circle-radius":15,"circle-color":Zl(["get","kind"],{border_intersection:"green",modal_filter:"black"},"red")},$$slots:{default:[n0]},$$scope:{ctx:f}}}),S.$on("click",f[9]),{c(){Vt(a.$$.fragment),h=Tt(),Vt(d.$$.fragment),y=Tt(),Vt(S.$$.fragment)},m(s,F){Ot(a,s,F),Ye(s,h,F),Ot(d,s,F),Ye(s,y,F),Ot(S,s,F),k=!0},p(s,F){const M={};F&32&&(M.beforeId=s[5]?"Building":void 0),F&1&&(M.paint={"fill-color":["get","color"],"fill-opacity":s[0]?Op(.3,.5):.3}),a.$set(M);const q={};F&16&&(q.paint={"line-width":5,"line-color":Zl(["get","kind"],{interior_road:["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",s[4],"#A32015"],crosses:"blue"},"red")}),F&1&&(q.hoverCursor=s[0]?"pointer":void 0),F&1025&&(q.$$scope={dirty:F,ctx:s}),d.$set(q);const ie={};F&1025&&(ie.$$scope={dirty:F,ctx:s}),S.$set(ie)},i(s){k||(ze(a.$$.fragment,s),ze(d.$$.fragment,s),ze(S.$$.fragment,s),k=!0)},o(s){Ve(a.$$.fragment,s),Ve(d.$$.fragment,s),Ve(S.$$.fragment,s),k=!1},d(s){s&&(Xe(h),Xe(y)),Bt(a,s),Bt(d,s),Bt(S,s)}}}function o0(f){let a,h;return a=new Xa({props:{data:f[3],generateId:!0,$$slots:{default:[r0]},$$scope:{ctx:f}}}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p(d,[y]){const S={};y&8&&(S.data=d[3]),y&1079&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function s0(f,a,h){let d;ni(f,Nh,ge=>h(5,d=ge));let{$$slots:y={},$$scope:S}=a,{gjInput:k}=a,{interactive:s=!0}=a,{onClickLine:F=ge=>{}}=a,{onClickCircle:M=ge=>{}}=a,q,ie;function he(ge){let fe=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];h(4,ie=Math.max(...k.features.map(Te=>Te.properties.shortcuts??0)));for(let Te of k.features)Te.properties??(Te.properties={}),Te.properties.color=="disconnected"?Te.properties.color="red":Object.hasOwn(Te.properties,"color")&&(Te.properties.color=fe[Te.properties.color%fe.length]);h(3,q=k)}const xe=ge=>s&&F(ge.detail.features[0]),ye=ge=>s&&M(ge.detail.features[0]);return f.$$set=ge=>{"gjInput"in ge&&h(6,k=ge.gjInput),"interactive"in ge&&h(0,s=ge.interactive),"onClickLine"in ge&&h(1,F=ge.onClickLine),"onClickCircle"in ge&&h(2,M=ge.onClickCircle),"$$scope"in ge&&h(10,S=ge.$$scope)},f.$$.update=()=>{f.$$.dirty&64&&he()},[s,F,M,q,ie,d,k,y,xe,ye,S]}class Jh extends Hi{constructor(a){super(),Wi(this,a,s0,o0,Vi,{gjInput:6,interactive:0,onClickLine:1,onClickCircle:2})}}const a0=f=>({}),uf=f=>({}),l0=f=>({}),hf=f=>({});function c0(f){let a,h,d,y;const S=f[3].sidebar,k=fo(S,f,f[2],hf),s=f[3].map,F=fo(s,f,f[2],uf);return{c(){a=Ae("div"),k&&k.c(),h=Tt(),d=Ae("div"),F&&F.c()},m(M,q){Ye(M,a,q),k&&k.m(a,null),f[4](a),Ye(M,h,q),Ye(M,d,q),F&&F.m(d,null),f[5](d),y=!0},p(M,[q]){k&&k.p&&(!y||q&4)&&_o(k,S,M,M[2],y?mo(S,M[2],q,l0):go(M[2]),hf),F&&F.p&&(!y||q&4)&&_o(F,s,M,M[2],y?mo(s,M[2],q,a0):go(M[2]),uf)},i(M){y||(ze(k,M),ze(F,M),y=!0)},o(M){Ve(k,M),Ve(F,M),y=!1},d(M){M&&(Xe(a),Xe(h),Xe(d)),k&&k.d(M),f[4](null),F&&F.d(M),f[5](null)}}}function u0(f,a,h){let d,y;ni(f,Vh,M=>h(0,d=M)),ni(f,Uh,M=>h(1,y=M));let{$$slots:S={},$$scope:k}=a;function s(M){Or[M?"unshift":"push"](()=>{d=M,Vh.set(d)})}function F(M){Or[M?"unshift":"push"](()=>{y=M,Uh.set(y)})}return f.$$set=M=>{"$$scope"in M&&h(2,k=M.$$scope)},[d,y,k,S,s,F]}class Wl extends Hi{constructor(a){super(),Wi(this,a,u0,c0,Vi,{})}}const{window:h0}=wf;function d0(f){let a,h,d;return{c(){a=Gi("Undo ("),h=Gi(f[5]),d=Gi(")")},m(y,S){Ye(y,a,S),Ye(y,h,S),Ye(y,d,S)},p(y,S){S[0]&32&&Rs(h,y[5])},d(y){y&&(Xe(a),Xe(h),Xe(d))}}}function p0(f){let a;return{c(){a=Gi("Undo")},m(h,d){Ye(h,a,d)},p:vi,d(h){h&&Xe(a)}}}function f0(f){let a,h,d;return{c(){a=Gi("Redo ("),h=Gi(f[6]),d=Gi(")")},m(y,S){Ye(y,a,S),Ye(y,h,S),Ye(y,d,S)},p(y,S){S[0]&64&&Rs(h,y[6])},d(y){y&&(Xe(a),Xe(h),Xe(d))}}}function m0(f){let a;return{c(){a=Gi("Redo")},m(h,d){Ye(h,a,d)},p:vi,d(h){h&&Xe(a)}}}function df(f){let a,h,d;function y(k){f[22](k)}let S={};return f[2]!==void 0&&(S.filterType=f[2]),a=new Hy({props:S}),Or.push(()=>fl(a,"filterType",y)),a.$on("close",f[23]),{c(){Vt(a.$$.fragment)},m(k,s){Ot(a,k,s),d=!0},p(k,s){const F={};!h&&s[0]&4&&(h=!0,F.filterType=k[2],pl(()=>h=!1)),a.$set(F)},i(k){d||(ze(a.$$.fragment,k),d=!0)},o(k){Ve(a.$$.fragment,k),d=!1},d(k){Bt(a,k)}}}function _0(f){let a,h,d,y,S,k,s,F,M,q,ie,he,xe,ye,ge,fe,Te,Pe,Ke,je,St,vt,yt,zt,wt,Nt,De,Je,$t,$e,Kt,Pt,Lt,ui,Ln,zn,Pi,Mi,Ut,bi,Li,qe,Gt,it,si,gt,Xi,Qi,Ze,Ui,bn;function xi(jt,ei){return jt[5]==0?p0:d0}let _r=xi(f),Dn=_r(f);function yo(jt,ei){return jt[6]==0?m0:f0}let ke=yo(f),tn=ke(f),zi=f[4]&&df(f);return Qi=new Hf({}),{c(){a=Ae("div"),h=Ae("h1"),h.textContent="Editing modal filters",d=Tt(),y=Ae("p"),y.textContent=`Now that you've defined a neighbourhood boundary, you can see the possible
      shortcuts that vehicles are currently able to take through it. You can add
      a new modal filter to try and solve this. The colored "cell" areas show
      what's reachable for drivers without leaving the boundary you've drawn.`,S=Tt(),k=Ae("div"),s=Ae("button"),s.textContent="Start over and change your study area",F=Tt(),M=Ae("div"),q=Ae("button"),q.textContent="Pick a different neighbourhood boundary",ie=Tt(),he=Ae("div"),xe=Ae("button"),xe.textContent="Change this neighbourhood boundary",ye=Tt(),ge=Ae("hr"),fe=Tt(),Te=Ae("div"),Pe=Ae("button"),Ke=Gi("Add a modal filter"),St=Tt(),vt=Ae("button"),yt=Gi("Add many modal filters along line"),wt=Tt(),Nt=Ae("button"),De=Gi("Change modal filter type"),$t=Tt(),$e=Ae("div"),Kt=Ae("button"),Dn.c(),Lt=Tt(),ui=Ae("button"),tn.c(),zn=Tt(),zi&&zi.c(),Pi=Tt(),Mi=Ae("hr"),Ut=Tt(),bi=Ae("div"),Li=Ae("button"),Li.textContent="View shortcuts",qe=Tt(),Gt=Ae("div"),it=Ae("button"),it.textContent="Route",si=Tt(),gt=Ae("hr"),Xi=Tt(),Vt(Qi.$$.fragment),Pe.disabled=je=f[0]||f[3],vt.disabled=zt=f[0]||f[3],Nt.disabled=Je=f[0]||f[3],Kt.disabled=Pt=f[5]==0,ui.disabled=Ln=f[6]==0,yi(a,"slot","sidebar")},m(jt,ei){Ye(jt,a,ei),Ee(a,h),Ee(a,d),Ee(a,y),Ee(a,S),Ee(a,k),Ee(k,s),Ee(a,F),Ee(a,M),Ee(M,q),Ee(a,ie),Ee(a,he),Ee(he,xe),Ee(a,ye),Ee(a,ge),Ee(a,fe),Ee(a,Te),Ee(Te,Pe),Ee(Pe,Ke),Ee(Te,St),Ee(Te,vt),Ee(vt,yt),Ee(Te,wt),Ee(Te,Nt),Ee(Nt,De),Ee(a,$t),Ee(a,$e),Ee($e,Kt),Dn.m(Kt,null),Ee($e,Lt),Ee($e,ui),tn.m(ui,null),Ee(a,zn),zi&&zi.m(a,null),Ee(a,Pi),Ee(a,Mi),Ee(a,Ut),Ee(a,bi),Ee(bi,Li),Ee(a,qe),Ee(a,Gt),Ee(Gt,it),Ee(a,si),Ee(a,gt),Ee(a,Xi),Ot(Qi,a,null),Ze=!0,Ui||(bn=[fi(s,"click",f[16]),fi(q,"click",f[14]),fi(xe,"click",f[18]),fi(Pe,"click",f[19]),fi(vt,"click",f[20]),fi(Nt,"click",f[21]),fi(Kt,"click",f[12]),fi(ui,"click",f[13]),fi(Li,"click",f[24]),fi(it,"click",f[25])],Ui=!0)},p(jt,ei){(!Ze||ei[0]&9&&je!==(je=jt[0]||jt[3]))&&(Pe.disabled=je),(!Ze||ei[0]&9&&zt!==(zt=jt[0]||jt[3]))&&(vt.disabled=zt),(!Ze||ei[0]&9&&Je!==(Je=jt[0]||jt[3]))&&(Nt.disabled=Je),_r===(_r=xi(jt))&&Dn?Dn.p(jt,ei):(Dn.d(1),Dn=_r(jt),Dn&&(Dn.c(),Dn.m(Kt,null))),(!Ze||ei[0]&32&&Pt!==(Pt=jt[5]==0))&&(Kt.disabled=Pt),ke===(ke=yo(jt))&&tn?tn.p(jt,ei):(tn.d(1),tn=ke(jt),tn&&(tn.c(),tn.m(ui,null))),(!Ze||ei[0]&64&&Ln!==(Ln=jt[6]==0))&&(ui.disabled=Ln),jt[4]?zi?(zi.p(jt,ei),ei[0]&16&&ze(zi,1)):(zi=df(jt),zi.c(),ze(zi,1),zi.m(a,Pi)):zi&&(lr(),Ve(zi,1,1,()=>{zi=null}),cr())},i(jt){Ze||(ze(zi),ze(Qi.$$.fragment,jt),Ze=!0)},o(jt){Ve(zi),Ve(Qi.$$.fragment,jt),Ze=!1},d(jt){jt&&Xe(a),Dn.d(),tn.d(),zi&&zi.d(),Bt(Qi),Ui=!1,os(bn)}}}function g0(f){let a,h;return a=new Kh({props:{properties:tr(f[30]).properties}}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p(d,y){const S={};y[0]&1073741824&&(S.properties=tr(d[30]).properties),a.$set(S)},i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function y0(f){let a,h,d;return h=new Fu({props:{openOn:"hover",$$slots:{default:[g0,({data:y})=>({30:y}),({data:y})=>[y?1073741824:0]]},$$scope:{ctx:f}}}),{c(){a=Ae("div"),Vt(h.$$.fragment),yi(a,"slot","line-popup")},m(y,S){Ye(y,a,S),Ot(h,a,null),d=!0},p(y,S){const k={};S[0]&1073741824|S[1]&1&&(k.$$scope={dirty:S,ctx:y}),h.$set(k)},i(y){d||(ze(h.$$.fragment,y),d=!0)},o(y){Ve(h.$$.fragment,y),d=!1},d(y){y&&Xe(a),Bt(h)}}}function v0(f){let a,h;return a=new Kh({props:{properties:tr(f[30]).properties}}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p(d,y){const S={};y[0]&1073741824&&(S.properties=tr(d[30]).properties),a.$set(S)},i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function b0(f){let a,h,d;return h=new Fu({props:{openOn:"hover",$$slots:{default:[v0,({data:y})=>({30:y}),({data:y})=>[y?1073741824:0]]},$$scope:{ctx:f}}}),{c(){a=Ae("div"),Vt(h.$$.fragment),yi(a,"slot","circle-popup")},m(y,S){Ye(y,a,S),Ot(h,a,null),d=!0},p(y,S){const k={};S[0]&1073741824|S[1]&1&&(k.$$scope={dirty:S,ctx:y}),h.$set(k)},i(y){d||(ze(h.$$.fragment,y),d=!0)},o(y){Ve(h.$$.fragment,y),d=!1},d(y){y&&Xe(a),Bt(h)}}}function pf(f){let a,h;return a=new Yy({props:{map:tr(f[1])}}),a.$on("done",f[15]),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p(d,y){const S={};y[0]&2&&(S.map=tr(d[1])),a.$set(S)},i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function x0(f){let a,h,d,y;h=new Jh({props:{gjInput:f[8],interactive:!f[0]&&!f[3],onClickLine:f[17],onClickCircle:f[10],$$slots:{"circle-popup":[b0],"line-popup":[y0]},$$scope:{ctx:f}}});let S=f[3]&&pf(f);return{c(){a=Ae("div"),Vt(h.$$.fragment),d=Tt(),S&&S.c(),yi(a,"slot","map")},m(k,s){Ye(k,a,s),Ot(h,a,null),Ee(a,d),S&&S.m(a,null),y=!0},p(k,s){const F={};s[0]&256&&(F.gjInput=k[8]),s[0]&9&&(F.interactive=!k[0]&&!k[3]),s[1]&1&&(F.$$scope={dirty:s,ctx:k}),h.$set(F),k[3]?S?(S.p(k,s),s[0]&8&&ze(S,1)):(S=pf(k),S.c(),ze(S,1),S.m(a,null)):S&&(lr(),Ve(S,1,1,()=>{S=null}),cr())},i(k){y||(ze(h.$$.fragment,k),ze(S),y=!0)},o(k){Ve(h.$$.fragment,k),Ve(S),y=!1},d(k){k&&Xe(a),Bt(h),S&&S.d()}}}function w0(f){let a,h,d,y;return a=new Wl({props:{$$slots:{map:[x0],sidebar:[_0]},$$scope:{ctx:f}}}),{c(){Vt(a.$$.fragment)},m(S,k){Ot(a,S,k),h=!0,d||(y=fi(h0,"keydown",f[11]),d=!0)},p(S,k){const s={};k[0]&1023|k[1]&1&&(s.$$scope={dirty:k,ctx:S}),a.$set(s)},i(S){h||(ze(a.$$.fragment,S),h=!0)},o(S){Ve(a.$$.fragment,S),h=!1},d(S){Bt(a,S),d=!1,y()}}}function S0(f,a,h){let d,y,S;ni(f,bs,Lt=>h(26,d=Lt)),ni(f,er,Lt=>h(9,y=Lt)),ni(f,ml,Lt=>h(1,S=Lt));let k="walk_cycle_only",s=!1,F=!1,M=!1,q=0,ie=0,he,xe;ye(d.renderNeighbourhood());function ye(Lt){h(8,xe=JSON.parse(Lt)),h(7,he=xe.features.find(ui=>ui.properties.kind=="boundary")),h(5,q=xe.undo_length),h(6,ie=xe.redo_length)}xs(()=>{fe()});function ge(Lt){ye(d.addModalFilter(Lt.lngLat,k)),fe()}function fe(){h(0,s=!1),S.off("click",ge),S.getCanvas().style.cursor="inherit"}function Te(Lt){Lt.properties.kind=="modal_filter"&&ye(d.deleteModalFilter(Lt.properties.road))}function Pe(Lt){Lt.key=="a"&&!s&&!F&&h(0,s=!0),Lt.key=="z"&&Lt.ctrlKey&&Ke(),Lt.key=="y"&&Lt.ctrlKey&&je()}function Ke(){ye(d.undo())}function je(){ye(d.redo())}function St(){fn(er,y={mode:"network"},y)}function vt(Lt){let ui=Lt.detail;ui&&ye(d.addManyModalFilters(ui,k)),h(3,F=!1)}function yt(){fn(er,y={mode:"title"},y),fn(bs,d=null,d)}const zt=Lt=>window.open(tr(Lt.properties).way,"_blank"),wt=()=>fn(er,y={mode:"set-boundary",existing:he},y),Nt=()=>h(0,s=!0),De=()=>h(3,F=!0),Je=()=>h(4,M=!0);function $t(Lt){k=Lt,h(2,k)}const $e=()=>h(4,M=!1),Kt=()=>fn(er,y={mode:"view-shortcuts"},y),Pt=()=>fn(er,y={mode:"route"},y);return f.$$.update=()=>{f.$$.dirty[0]&3&&s&&(S.on("click",ge),S.getCanvas().style.cursor="crosshair")},[s,S,k,F,M,q,ie,he,xe,y,Te,Pe,Ke,je,St,vt,yt,zt,wt,Nt,De,Je,$t,$e,Kt,Pt]}class T0 extends Hi{constructor(a){super(),Wi(this,a,S0,w0,Vi,{},null,[-1,-1])}}function I0(f){let a,h,d,y,S,k,s,F,M,q,ie,he,xe,ye,ge,fe,Te;return ye=new Hf({}),{c(){a=Ae("div"),h=Ae("h1"),h.textContent="Define neighbourhood boundaries",d=Tt(),y=Ae("p"),y.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
      deliberately permit) through-traffic. An appropriate neighbourhood
      boundary depends on many factors. The simplest approach is to find the
      area bounded on all sides by "main" roads, which are designed for higher
      traffic volumes. There are many other considerations, though -- maybe
      severances like rivers or rail should be part of a boundary. Bridges and
      tunnels near a boundary may be confusing as well. And note that your
      boundary may not match the conventional definition of "neighbourhood."`,S=Tt(),k=Ae("div"),s=Ae("button"),s.textContent="Start over and change your study area",F=Tt(),M=Ae("div"),q=Ae("button"),q.textContent="Draw a new boundary",ie=Tt(),he=Ae("hr"),xe=Tt(),Vt(ye.$$.fragment),yi(a,"slot","sidebar")},m(Pe,Ke){Ye(Pe,a,Ke),Ee(a,h),Ee(a,d),Ee(a,y),Ee(a,S),Ee(a,k),Ee(k,s),Ee(a,F),Ee(a,M),Ee(M,q),Ee(a,ie),Ee(a,he),Ee(a,xe),Ot(ye,a,null),ge=!0,fe||(Te=[fi(s,"click",f[2]),fi(q,"click",f[4])],fe=!0)},p:vi,i(Pe){ge||(ze(ye.$$.fragment,Pe),ge=!0)},o(Pe){Ve(ye.$$.fragment,Pe),ge=!1},d(Pe){Pe&&Xe(a),Bt(ye),fe=!1,os(Te)}}}function C0(f){let a,h;return a=new Kh({props:{properties:tr(f[5]).properties}}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p(d,y){const S={};y&32&&(S.properties=tr(d[5]).properties),a.$set(S)},i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function E0(f){let a,h;return a=new Fu({props:{openOn:"hover",$$slots:{default:[C0,({data:d})=>({5:d}),({data:d})=>d?32:0]},$$scope:{ctx:f}}}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p(d,y){const S={};y&96&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function k0(f){let a,h;return a=new _l({props:{id:"network",paint:{"line-width":5,"line-color":"black"},hoverCursor:"pointer",$$slots:{default:[E0]},$$scope:{ctx:f}}}),a.$on("click",f[3]),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p(d,y){const S={};y&64&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function M0(f){let a,h,d;return h=new Xa({props:{data:JSON.parse(tr(f[0]).render()),$$slots:{default:[k0]},$$scope:{ctx:f}}}),{c(){a=Ae("div"),Vt(h.$$.fragment),yi(a,"slot","map")},m(y,S){Ye(y,a,S),Ot(h,a,null),d=!0},p(y,S){const k={};S&1&&(k.data=JSON.parse(tr(y[0]).render())),S&64&&(k.$$scope={dirty:S,ctx:y}),h.$set(k)},i(y){d||(ze(h.$$.fragment,y),d=!0)},o(y){Ve(h.$$.fragment,y),d=!1},d(y){y&&Xe(a),Bt(h)}}}function A0(f){let a,h;return a=new Wl({props:{$$slots:{map:[M0],sidebar:[I0]},$$scope:{ctx:f}}}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p(d,[y]){const S={};y&67&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function P0(f,a,h){let d,y;ni(f,bs,F=>h(0,d=F)),ni(f,er,F=>h(1,y=F));function S(){fn(er,y={mode:"title"},y),fn(bs,d=null,d)}return[d,y,S,F=>window.open(tr(F.detail.features[0].properties).way,"_blank"),()=>fn(er,y={mode:"set-boundary",existing:null},y)]}class L0 extends Hi{constructor(a){super(),Wi(this,a,P0,A0,Vi,{})}}function z0(f){let a,h,d,y,S,k,s,F,M;return{c(){a=Ae("div"),h=Ae("div"),d=Ae("button"),d.textContent="Back to editing",y=Tt(),S=Ae("p"),S.textContent="Drag markers for a route",k=Tt(),s=Ae("p"),s.innerHTML=`<span style="color: red">Route before</span>,
      <span style="color: blue">route after</span>`,yi(a,"slot","sidebar")},m(q,ie){Ye(q,a,ie),Ee(a,h),Ee(h,d),Ee(a,y),Ee(a,S),Ee(a,k),Ee(a,s),F||(M=fi(d,"click",f[5]),F=!0)},p:vi,d(q){q&&Xe(a),F=!1,M()}}}function D0(f){let a,h;return a=new _l({props:{paint:{"line-width":10,"line-color":Zl(["get","kind"],{before:"red",after:"blue"},"red")}}}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p:vi,i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function F0(f){let a;return{c(){a=Ae("span"),a.textContent="A",yi(a,"class","dot svelte-1ukzawy")},m(h,d){Ye(h,a,d)},p:vi,d(h){h&&Xe(a)}}}function R0(f){let a;return{c(){a=Ae("span"),a.textContent="B",yi(a,"class","dot svelte-1ukzawy")},m(h,d){Ye(h,a,d)},p:vi,d(h){h&&Xe(a)}}}function O0(f){let a,h,d,y,S,k,s,F,M,q,ie;h=new Jh({props:{gjInput:JSON.parse(tr(f[2]).renderNeighbourhood()),interactive:!1}}),y=new Xa({props:{data:f[3],$$slots:{default:[D0]},$$scope:{ctx:f}}});function he(fe){f[6](fe)}let xe={draggable:!0,$$slots:{default:[F0]},$$scope:{ctx:f}};f[0]!==void 0&&(xe.lngLat=f[0]),k=new Wp({props:xe}),Or.push(()=>fl(k,"lngLat",he));function ye(fe){f[7](fe)}let ge={draggable:!0,$$slots:{default:[R0]},$$scope:{ctx:f}};return f[1]!==void 0&&(ge.lngLat=f[1]),M=new Wp({props:ge}),Or.push(()=>fl(M,"lngLat",ye)),{c(){a=Ae("div"),Vt(h.$$.fragment),d=Tt(),Vt(y.$$.fragment),S=Tt(),Vt(k.$$.fragment),F=Tt(),Vt(M.$$.fragment),yi(a,"slot","map")},m(fe,Te){Ye(fe,a,Te),Ot(h,a,null),Ee(a,d),Ot(y,a,null),Ee(a,S),Ot(k,a,null),Ee(a,F),Ot(M,a,null),ie=!0},p(fe,Te){const Pe={};Te&4&&(Pe.gjInput=JSON.parse(tr(fe[2]).renderNeighbourhood())),h.$set(Pe);const Ke={};Te&8&&(Ke.data=fe[3]),Te&2048&&(Ke.$$scope={dirty:Te,ctx:fe}),y.$set(Ke);const je={};Te&2048&&(je.$$scope={dirty:Te,ctx:fe}),!s&&Te&1&&(s=!0,je.lngLat=fe[0],pl(()=>s=!1)),k.$set(je);const St={};Te&2048&&(St.$$scope={dirty:Te,ctx:fe}),!q&&Te&2&&(q=!0,St.lngLat=fe[1],pl(()=>q=!1)),M.$set(St)},i(fe){ie||(ze(h.$$.fragment,fe),ze(y.$$.fragment,fe),ze(k.$$.fragment,fe),ze(M.$$.fragment,fe),ie=!0)},o(fe){Ve(h.$$.fragment,fe),Ve(y.$$.fragment,fe),Ve(k.$$.fragment,fe),Ve(M.$$.fragment,fe),ie=!1},d(fe){fe&&Xe(a),Bt(h),Bt(y),Bt(k),Bt(M)}}}function B0(f){let a,h,d,y;return a=new Wl({props:{$$slots:{map:[O0],sidebar:[z0]},$$scope:{ctx:f}}}),{c(){Vt(a.$$.fragment)},m(S,k){Ot(a,S,k),h=!0,d||(y=fi(window,"keydown",f[4]),d=!0)},p(S,[k]){const s={};k&2063&&(s.$$scope={dirty:k,ctx:S}),a.$set(s)},i(S){h||(ze(a.$$.fragment,S),h=!0)},o(S){Ve(a.$$.fragment,S),h=!1},d(S){Bt(a,S),d=!1,y()}}}function N0(f,a,h){let d,y,S,k;ni(f,er,ye=>h(8,y=ye)),ni(f,bs,ye=>h(2,S=ye)),ni(f,ml,ye=>h(9,k=ye));let s=M(),F=M();Gc(()=>{k==null||k.keyboard.disable()}),xs(()=>{k==null||k.keyboard.enable()});function M(){let ye=S.getBounds(),ge=ye[0]+Math.random()*(ye[2]-ye[0]),fe=ye[1]+Math.random()*(ye[3]-ye[1]);return new Df.LngLat(ge,fe)}function q(ye){ye.key=="Escape"&&(ye.stopPropagation(),ie())}function ie(){fn(er,y={mode:"neighbourhood"},y)}function he(ye){s=ye,h(0,s)}function xe(ye){F=ye,h(1,F)}return f.$$.update=()=>{f.$$.dirty&7&&h(3,d=JSON.parse(S.compareRoute(s.lng,s.lat,F.lng,F.lat)))},[s,F,S,d,q,ie,he,xe]}class V0 extends Hi{constructor(a){super(),Wi(this,a,N0,B0,Vi,{})}}function U0(f){let a,h,d,y,S,k;return a=new Ff({props:{filter:Zf,paint:{"circle-color":Zl(["get","type"],{"snapped-waypoint":"red","free-waypoint":"blue"},"black"),"circle-opacity":["case",["has","hovered"],.5,1],"circle-radius":Zl(["get","type"],{node:ff/2},ff)}}}),d=new _l({props:{filter:qf,paint:{"line-color":["case",["get","snapped"],"red","blue"],"line-width":2.5}}}),S=new Hh({props:{filter:jf,paint:{"fill-color":"black","fill-opacity":.5}}}),{c(){Vt(a.$$.fragment),h=Tt(),Vt(d.$$.fragment),y=Tt(),Vt(S.$$.fragment)},m(s,F){Ot(a,s,F),Ye(s,h,F),Ot(d,s,F),Ye(s,y,F),Ot(S,s,F),k=!0},p:vi,i(s){k||(ze(a.$$.fragment,s),ze(d.$$.fragment,s),ze(S.$$.fragment,s),k=!0)},o(s){Ve(a.$$.fragment,s),Ve(d.$$.fragment,s),Ve(S.$$.fragment,s),k=!1},d(s){s&&(Xe(h),Xe(y)),Bt(a,s),Bt(d,s),Bt(S,s)}}}function j0(f){let a,h;return a=new Xa({props:{data:f[0],$$slots:{default:[U0]},$$scope:{ctx:f}}}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p(d,[y]){const S={};y&1&&(S.data=d[0]),y&2&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}const ff=10;function q0(f,a,h){let d;return ni(f,Gf,y=>h(0,d=y)),[d]}class Z0 extends Hi{constructor(a){super(),Wi(this,a,q0,j0,Vi,{})}}function G0(f){let a,h,d;return{c(){a=Gi("Undo ("),h=Gi(f[1]),d=Gi(")")},m(y,S){Ye(y,a,S),Ye(y,h,S),Ye(y,d,S)},p(y,S){S&2&&Rs(h,y[1])},d(y){y&&(Xe(a),Xe(h),Xe(d))}}}function W0(f){let a;return{c(){a=Gi("Undo")},m(h,d){Ye(h,a,d)},p:vi,d(h){h&&Xe(a)}}}function H0(f){let a,h,d,y,S,k;function s(q,ie){return q[1]==0?W0:G0}let F=s(f),M=F(f);return{c(){a=Ae("button"),M.c(),d=Tt(),y=Ae("ul"),y.innerHTML=`<li><b>Click</b>
    the map to add points</li> <li><b>Click and drag</b>
    any point to move it</li> <li><b>Click</b>
    a waypoint to delete it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,a.disabled=h=f[1]==0},m(q,ie){Ye(q,a,ie),M.m(a,null),Ye(q,d,ie),Ye(q,y,ie),S||(k=fi(a,"click",f[2]),S=!0)},p(q,[ie]){F===(F=s(q))&&M?M.p(q,ie):(M.d(1),M=F(q),M&&(M.c(),M.m(a,null))),ie&2&&h!==(h=q[1]==0)&&(a.disabled=h)},i:vi,o:vi,d(q){q&&(Xe(a),Xe(d),Xe(y)),M.d(),S=!1,k()}}}function X0(f,a,h){let d;ni(f,Wf,k=>h(1,d=k));let{route_tool:y}=a;const S=()=>y.undo();return f.$$set=k=>{"route_tool"in k&&h(0,y=k.route_tool)},[y,d,S]}class K0 extends Hi{constructor(a){super(),Wi(this,a,X0,H0,Vi,{route_tool:0})}}function J0(f){let a,h,d,y,S,k,s,F,M,q,ie,he,xe,ye;return k=new K0({props:{route_tool:f[0]}}),{c(){a=Ae("div"),h=Ae("h1"),h.textContent="Draw your neighbourhood boundary",d=Tt(),y=Ae("p"),y.textContent="TODO: maybe move the instructions from the previous screen to here...",S=Tt(),Vt(k.$$.fragment),s=Tt(),F=Ae("div"),M=Ae("button"),M.textContent="Finish",q=Tt(),ie=Ae("button"),ie.textContent="Cancel",yi(a,"slot","sidebar")},m(ge,fe){Ye(ge,a,fe),Ee(a,h),Ee(a,d),Ee(a,y),Ee(a,S),Ot(k,a,null),Ee(a,s),Ee(a,F),Ee(F,M),Ee(F,q),Ee(F,ie),he=!0,xe||(ye=[fi(M,"click",f[3]),fi(ie,"click",f[1])],xe=!0)},p(ge,fe){const Te={};fe&1&&(Te.route_tool=ge[0]),k.$set(Te)},i(ge){he||(ze(k.$$.fragment,ge),he=!0)},o(ge){Ve(k.$$.fragment,ge),he=!1},d(ge){ge&&Xe(a),Bt(k),xe=!1,os(ye)}}}function Y0(f){let a,h,d;return h=new Z0({}),{c(){a=Ae("div"),Vt(h.$$.fragment),yi(a,"slot","map")},m(y,S){Ye(y,a,S),Ot(h,a,null),d=!0},p:vi,i(y){d||(ze(h.$$.fragment,y),d=!0)},o(y){Ve(h.$$.fragment,y),d=!1},d(y){y&&Xe(a),Bt(h)}}}function Q0(f){let a,h;return a=new Wl({props:{$$slots:{map:[Y0],sidebar:[J0]},$$scope:{ctx:f}}}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p(d,[y]){const S={};y&65&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function $0(f,a,h){let d,y;ni(f,er,M=>h(4,d=M)),ni(f,bs,M=>h(5,y=M));let{route_tool:S}=a,{existing:k}=a;k?S.editExistingArea(k):S.startArea();function s(){fn(er,d={mode:"network"},d),S.clearEventListeners()}S.addEventListenerSuccess(M=>{try{y.setNeighbourhood(M),fn(er,d={mode:"neighbourhood"},d),S.clearEventListeners()}catch{window.alert("Known georust bug hit, sorry. You may need to just refresh the page now."),s()}}),S.addEventListenerFailure(s);const F=()=>S.finish();return f.$$set=M=>{"route_tool"in M&&h(0,S=M.route_tool),"existing"in M&&h(2,k=M.existing)},[S,s,k,F]}class ev extends Hi{constructor(a){super(),Wi(this,a,$0,Q0,Vi,{route_tool:0,existing:2})}}function tv(f){let a,h,d,y,S,k,s,F,M,q,ie,he,xe,ye,ge,fe,Te,Pe,Ke,je,St,vt,yt,zt,wt,Nt,De,Je;return a=new Nf({props:{msg:f[1]}}),wt=new Oy({props:{map:f[3]}}),wt.$on("gotXml",f[5]),wt.$on("loading",f[8]),wt.$on("error",f[9]),{c(){Vt(a.$$.fragment),h=Tt(),d=Ae("div"),y=Ae("label"),S=Gi(`Load an example:
    `),k=Ae("select"),s=Ae("option"),s.textContent="Custom file loaded",F=Ae("option"),F.textContent="Akihabara",M=Ae("option"),M.textContent="Hanegi Park",q=Ae("option"),q.textContent="Harujuku",ie=Ae("option"),ie.textContent="Taipei main station",he=Ae("option"),he.textContent="Ximending",xe=Ae("option"),xe.textContent="Hong Kong",ye=Ae("option"),ye.textContent="Kowloon",ge=Ae("option"),ge.textContent="Bristol",fe=Ae("option"),fe.textContent="Elephant & Castle",Te=Ae("option"),Te.textContent="Westminster",Pe=Ae("option"),Pe.textContent="Montlake",Ke=Tt(),je=Ae("div"),St=Ae("label"),vt=Gi(`Load an osm.xml or a .pbf file:
    `),yt=Ae("input"),zt=Tt(),Vt(wt.$$.fragment),s.__value="",ns(s,s.__value),F.__value="akihabara",ns(F,F.__value),M.__value="hanegi",ns(M,M.__value),q.__value="harujuku",ns(q,q.__value),ie.__value="taipei_main_station",ns(ie,ie.__value),he.__value="ximending",ns(he,he.__value),xe.__value="hong_kong",ns(xe,xe.__value),ye.__value="kowloon",ns(ye,ye.__value),ge.__value="bristol",ns(ge,ge.__value),fe.__value="elephant_castle",ns(fe,fe.__value),Te.__value="westminster",ns(Te,Te.__value),Pe.__value="montlake",ns(Pe,Pe.__value),f[0]===void 0&&Au(()=>f[6].call(k)),yi(yt,"type","file")},m($t,$e){Ot(a,$t,$e),Ye($t,h,$e),Ye($t,d,$e),Ee(d,y),Ee(y,S),Ee(y,k),Ee(k,s),Ee(k,F),Ee(k,M),Ee(k,q),Ee(k,ie),Ee(k,he),Ee(k,xe),Ee(k,ye),Ee(k,ge),Ee(k,fe),Ee(k,Te),Ee(k,Pe),zp(k,f[0],!0),Ye($t,Ke,$e),Ye($t,je,$e),Ee(je,St),Ee(St,vt),Ee(St,yt),f[7](yt),Ye($t,zt,$e),Ot(wt,$t,$e),Nt=!0,De||(Je=[fi(k,"change",f[6]),fi(yt,"change",f[4])],De=!0)},p($t,[$e]){const Kt={};$e&2&&(Kt.msg=$t[1]),a.$set(Kt),$e&1&&zp(k,$t[0]);const Pt={};$e&8&&(Pt.map=$t[3]),wt.$set(Pt)},i($t){Nt||(ze(a.$$.fragment,$t),ze(wt.$$.fragment,$t),Nt=!0)},o($t){Ve(a.$$.fragment,$t),Ve(wt.$$.fragment,$t),Nt=!1},d($t){$t&&(Xe(h),Xe(d),Xe(Ke),Xe(je),Xe(zt)),Bt(a,$t),f[7](null),Bt(wt,$t),De=!1,os(Je)}}}function iv(f,a,h){let d,y,S;ni(f,Oc,Pe=>h(0,d=Pe)),ni(f,bs,Pe=>h(11,y=Pe)),ni(f,ml,Pe=>h(3,S=Pe));let k=null,s=!1;Gc(async()=>{await jh(),await qh();try{s=(await fetch("/osm/kowloon.pbf",{method:"HEAD"})).ok,console.log("Using local cache, not od2net.org")}catch{}});let F;async function M(Pe){try{q(await F.files[0].arrayBuffer()),fn(Oc,d="",d)}catch(Ke){window.alert(`Couldn't open this file: ${Ke}`)}h(1,k=null)}function q(Pe){h(1,k="Building map model from OSM input"),console.time("load"),fn(bs,y=new cg(new Uint8Array(Pe)),y),console.timeEnd("load")}function ie(Pe){try{q(new TextEncoder().encode(Pe.detail)),fn(Oc,d="",d)}catch(Ke){window.alert(`Couldn't import from Overpass: ${Ke}`)}h(1,k=null)}async function he(Pe){Pe!=""&&(s?await xe(`/osm/${Pe}.pbf`):await xe(`https://assets.od2net.org/severance_pbfs/${Pe}.pbf`))}async function xe(Pe){try{h(1,k=`Downloading ${Pe}`);let Ke=await fetch(Pe);q(await Ke.arrayBuffer())}catch(Ke){window.alert(`Couldn't open from URL ${Pe}: ${Ke}`)}h(1,k=null)}function ye(){d=K_(this),Oc.set(d)}function ge(Pe){Or[Pe?"unshift":"push"](()=>{F=Pe,h(2,F)})}const fe=Pe=>h(1,k=Pe.detail),Te=Pe=>window.alert(Pe.detail);return f.$$.update=()=>{f.$$.dirty&1&&he(d)},[d,k,F,S,M,ie,ye,ge,fe,Te]}class nv extends Hi{constructor(a){super(),Wi(this,a,iv,tv,Vi,{})}}function mf(f){let a,h;return a=new Vf({props:{$$slots:{default:[rv,({dialog:d})=>({6:d}),({dialog:d})=>d?64:0]},$$scope:{ctx:f}}}),a.$on("close",f[4]),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p(d,y){const S={};y&192&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function rv(f){let a,h,d,y,S,k,s,F,M,q,ie,he,xe,ye;function ge(){return f[3](f[6])}return{c(){a=Ae("h1"),a.textContent="The Low-traffic neighbourhood (LTN) tool, v2",h=Tt(),d=Ae("p"),d.innerHTML=`This is an <b>experimental</b> version of the
          <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>. Most parts of it do not work yet, and you should probably use the
          other version of the tool instead.`,y=Tt(),S=Ae("p"),S.textContent="To use this tool, you need to:",k=Tt(),s=Ae("ol"),s.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, to fix the basemap data on existing modal filters, turn
            restrictions, one-ways, etc</li> <li>To create one or more proposals with new modal filters, and explore
            their effects</li>`,F=Tt(),M=Ae("p"),M.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
          and relies heavily on
          <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a> data.`,q=Tt(),ie=Ae("center"),he=Ae("button"),he.textContent="Start!"},m(fe,Te){Ye(fe,a,Te),Ye(fe,h,Te),Ye(fe,d,Te),Ye(fe,y,Te),Ye(fe,S,Te),Ye(fe,k,Te),Ye(fe,s,Te),Ye(fe,F,Te),Ye(fe,M,Te),Ye(fe,q,Te),Ye(fe,ie,Te),Ee(ie,he),xe||(ye=fi(he,"click",ge),xe=!0)},p(fe,Te){f=fe},d(fe){fe&&(Xe(a),Xe(h),Xe(d),Xe(y),Xe(S),Xe(k),Xe(s),Xe(F),Xe(M),Xe(q),Xe(ie)),xe=!1,ye()}}}function ov(f){let a;return{c(){a=Ae("p"),a.textContent="Waiting for MapLibre and WASM to load..."},m(h,d){Ye(h,a,d)},i:vi,o:vi,d(h){h&&Xe(a)}}}function sv(f){let a,h;return a=new nv({}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function av(f){let a,h,d,y,S,k,s,F,M,q,ie,he,xe,ye=f[1]&&mf(f);const ge=[sv,ov],fe=[];function Te(Pe,Ke){return Pe[2]&&Pe[0]?0:1}return M=Te(f),q=fe[M]=ge[M](f),{c(){a=Ae("div"),ye&&ye.c(),h=Tt(),d=Ae("h1"),d.textContent="Choose your study area",y=Tt(),S=Ae("button"),S.textContent="About the LTN tool",k=Tt(),s=Ae("hr"),F=Tt(),q.c(),yi(a,"slot","sidebar")},m(Pe,Ke){Ye(Pe,a,Ke),ye&&ye.m(a,null),Ee(a,h),Ee(a,d),Ee(a,y),Ee(a,S),Ee(a,k),Ee(a,s),Ee(a,F),fe[M].m(a,null),ie=!0,he||(xe=fi(S,"click",f[5]),he=!0)},p(Pe,Ke){Pe[1]?ye?(ye.p(Pe,Ke),Ke&2&&ze(ye,1)):(ye=mf(Pe),ye.c(),ze(ye,1),ye.m(a,h)):ye&&(lr(),Ve(ye,1,1,()=>{ye=null}),cr());let je=M;M=Te(Pe),M!==je&&(lr(),Ve(fe[je],1,1,()=>{fe[je]=null}),cr(),q=fe[M],q||(q=fe[M]=ge[M](Pe),q.c()),ze(q,1),q.m(a,null))},i(Pe){ie||(ze(ye),ze(q),ie=!0)},o(Pe){Ve(ye),Ve(q),ie=!1},d(Pe){Pe&&Xe(a),ye&&ye.d(),fe[M].d(),he=!1,xe()}}}function lv(f){let a;return{c(){a=Ae("div"),yi(a,"slot","map")},m(h,d){Ye(h,a,d)},p:vi,d(h){h&&Xe(a)}}}function cv(f){let a,h;return a=new Wl({props:{$$slots:{map:[lv],sidebar:[av]},$$scope:{ctx:f}}}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p(d,[y]){const S={};y&135&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function uv(f,a,h){let d;ni(f,ml,M=>h(2,d=M));let{wasmReady:y}=a,S=!0;const k=M=>tr(M).close(),s=()=>h(1,S=!1),F=()=>h(1,S=!0);return f.$$set=M=>{"wasmReady"in M&&h(0,y=M.wasmReady)},[y,S,d,k,s,F]}class hv extends Hi{constructor(a){super(),Wi(this,a,uv,cv,Vi,{wasmReady:0})}}const{window:dv}=wf;function pv(f){let a,h,d,y,S,k=f[0].shortcutIndex+"",s,F,M=f[0].gj.features.length+"",q,ie,he,xe,ye,ge,fe;return{c(){a=Ae("div"),h=Ae("button"),d=Gi("Prev"),S=Tt(),s=Gi(k),F=Gi(" / "),q=Gi(M),ie=Tt(),he=Ae("button"),xe=Gi("Next"),h.disabled=y=f[0].shortcutIndex==null||f[0].shortcutIndex==0,he.disabled=ye=f[0].shortcutIndex==f[0].gj.features.length-1},m(Te,Pe){Ye(Te,a,Pe),Ee(a,h),Ee(h,d),Ee(a,S),Ee(a,s),Ee(a,F),Ee(a,q),Ee(a,ie),Ee(a,he),Ee(he,xe),ge||(fe=[fi(h,"click",f[6]),fi(he,"click",f[7])],ge=!0)},p(Te,Pe){Pe&1&&y!==(y=Te[0].shortcutIndex==null||Te[0].shortcutIndex==0)&&(h.disabled=y),Pe&1&&k!==(k=Te[0].shortcutIndex+"")&&Rs(s,k),Pe&1&&M!==(M=Te[0].gj.features.length+"")&&Rs(q,M),Pe&1&&ye!==(ye=Te[0].shortcutIndex==Te[0].gj.features.length-1)&&(he.disabled=ye)},d(Te){Te&&Xe(a),ge=!1,os(fe)}}}function fv(f){let a;return{c(){a=Ae("p"),a.textContent="Click a road to see shortcuts"},m(h,d){Ye(h,a,d)},p:vi,d(h){h&&Xe(a)}}}function mv(f){let a,h,d,y,S,k;function s(q,ie){if(q[0].state=="neutral")return fv;if(q[0].state=="chose-road")return pv}let F=s(f),M=F&&F(f);return{c(){a=Ae("div"),h=Ae("div"),d=Ae("button"),d.textContent="Back to editing",y=Tt(),M&&M.c(),yi(a,"slot","sidebar")},m(q,ie){Ye(q,a,ie),Ee(a,h),Ee(h,d),Ee(a,y),M&&M.m(a,null),S||(k=fi(d,"click",f[4]),S=!0)},p(q,ie){F===(F=s(q))&&M?M.p(q,ie):(M&&M.d(1),M=F&&F(q),M&&(M.c(),M.m(a,null)))},d(q){q&&Xe(a),M&&M.d(),S=!1,k()}}}function _v(f){let a,h,d,y;const S=[vv,yv],k=[];function s(F,M){return F[0].shortcutIndex==null?0:1}return a=s(f),h=k[a]=S[a](f),{c(){h.c(),d=ss()},m(F,M){k[a].m(F,M),Ye(F,d,M),y=!0},p(F,M){let q=a;a=s(F),a===q?k[a].p(F,M):(lr(),Ve(k[q],1,1,()=>{k[q]=null}),cr(),h=k[a],h?h.p(F,M):(h=k[a]=S[a](F),h.c()),ze(h,1),h.m(d.parentNode,d))},i(F){y||(ze(h),y=!0)},o(F){Ve(h),y=!1},d(F){F&&Xe(d),k[a].d(F)}}}function gv(f){let a,h;return a=new Jh({props:{gjInput:JSON.parse(tr(f[1]).renderNeighbourhood()),onClickLine:f[5],$$slots:{"line-popup":[Sv]},$$scope:{ctx:f}}}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p(d,y){const S={};y&2&&(S.gjInput=JSON.parse(tr(d[1]).renderNeighbourhood())),y&2048&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function yv(f){let a,h;return a=new Xa({props:{data:f[0].gj.features[f[0].shortcutIndex],$$slots:{default:[bv]},$$scope:{ctx:f}}}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p(d,y){const S={};y&1&&(S.data=d[0].gj.features[d[0].shortcutIndex]),y&2048&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function vv(f){let a,h;return a=new Xa({props:{data:f[0].gj,$$slots:{default:[xv]},$$scope:{ctx:f}}}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p(d,y){const S={};y&1&&(S.data=d[0].gj),y&2048&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function bv(f){let a,h;return a=new _l({props:{paint:{"line-width":5,"line-color":"red"}}}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p:vi,i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function xv(f){let a,h;return a=new _l({props:{paint:{"line-width":5,"line-color":"red"}}}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p:vi,i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function wv(f){let a=tr(f[10]).properties.shortcuts+"",h;return{c(){h=Gi(a)},m(d,y){Ye(d,h,y)},p(d,y){y&1024&&a!==(a=tr(d[10]).properties.shortcuts+"")&&Rs(h,a)},d(d){d&&Xe(h)}}}function Sv(f){let a,h,d;return h=new Fu({props:{openOn:"hover",$$slots:{default:[wv,({data:y})=>({10:y}),({data:y})=>y?1024:0]},$$scope:{ctx:f}}}),{c(){a=Ae("div"),Vt(h.$$.fragment),yi(a,"slot","line-popup")},m(y,S){Ye(y,a,S),Ot(h,a,null),d=!0},p(y,S){const k={};S&3072&&(k.$$scope={dirty:S,ctx:y}),h.$set(k)},i(y){d||(ze(h.$$.fragment,y),d=!0)},o(y){Ve(h.$$.fragment,y),d=!1},d(y){y&&Xe(a),Bt(h)}}}function Tv(f){let a,h,d,y;const S=[gv,_v],k=[];function s(F,M){return F[0].state=="neutral"?0:F[0].state=="chose-road"?1:-1}return~(h=s(f))&&(d=k[h]=S[h](f)),{c(){a=Ae("div"),d&&d.c(),yi(a,"slot","map")},m(F,M){Ye(F,a,M),~h&&k[h].m(a,null),y=!0},p(F,M){let q=h;h=s(F),h===q?~h&&k[h].p(F,M):(d&&(lr(),Ve(k[q],1,1,()=>{k[q]=null}),cr()),~h?(d=k[h],d?d.p(F,M):(d=k[h]=S[h](F),d.c()),ze(d,1),d.m(a,null)):d=null)},i(F){y||(ze(d),y=!0)},o(F){Ve(d),y=!1},d(F){F&&Xe(a),~h&&k[h].d()}}}function Iv(f){let a,h,d,y;return a=new Wl({props:{$$slots:{map:[Tv],sidebar:[mv]},$$scope:{ctx:f}}}),{c(){Vt(a.$$.fragment)},m(S,k){Ot(a,S,k),h=!0,d||(y=fi(dv,"keydown",f[3]),d=!0)},p(S,[k]){const s={};k&2051&&(s.$$scope={dirty:k,ctx:S}),a.$set(s)},i(S){h||(ze(a.$$.fragment,S),h=!0)},o(S){Ve(a.$$.fragment,S),h=!1},d(S){Bt(a,S),d=!1,y()}}}function Cv(f,a,h){let d,y,S;ni(f,er,xe=>h(8,d=xe)),ni(f,ml,xe=>h(9,y=xe)),ni(f,bs,xe=>h(1,S=xe));let k={state:"neutral"};function s(xe){let ye=JSON.parse(S.getShortcutsCrossingRoad(xe));if(ye.features.length==0){window.alert("No shortcuts here");return}h(0,k={state:"chose-road",road:xe,gj:ye,shortcutIndex:null})}Gc(()=>{y==null||y.keyboard.disable()}),xs(()=>{y==null||y.keyboard.enable()});function F(xe){k.state=="chose-road"&&(xe.key=="ArrowLeft"&&k.shortcutIndex&&(xe.stopPropagation(),h(0,k.shortcutIndex--,k)),xe.key=="ArrowRight"&&(xe.stopPropagation(),k.shortcutIndex==null?h(0,k.shortcutIndex=0,k):k.shortcutIndex!=k.gj.features.length-1&&h(0,k.shortcutIndex++,k)),xe.key=="Escape"&&(xe.stopPropagation(),M()))}function M(){fn(er,d={mode:"neighbourhood"},d)}return[k,S,s,F,M,xe=>s(tr(xe.properties).id),()=>h(0,k.shortcutIndex--,k),()=>h(0,k.shortcutIndex++,k)]}class Ev extends Hi{constructor(a){super(),Wi(this,a,Cv,Iv,Vi,{})}}function _f(f){let a,h,d,y;return{c(){a=Ae("div"),h=Ae("button"),h.textContent="Zoom to fit study area"},m(S,k){Ye(S,a,k),Ee(a,h),d||(y=fi(h,"click",f[9]),d=!0)},p:vi,d(S){S&&Xe(a),d=!1,y()}}}function kv(f){let a,h,d,y,S,k,s,F,M,q,ie,he,xe=f[3]&&_f(f);return{c(){a=Ae("div"),h=Ae("div"),d=Tt(),y=Ae("hr"),S=Tt(),xe&&xe.c(),k=Tt(),s=Ae("div"),F=Ae("label"),M=Ae("input"),q=Gi("Show basemap"),yi(M,"type","checkbox"),yi(a,"slot","left")},m(ye,ge){Ye(ye,a,ge),Ee(a,h),f[15](h),Ee(a,d),Ee(a,y),Ee(a,S),xe&&xe.m(a,null),Ee(a,k),Ee(a,s),Ee(s,F),Ee(F,M),M.checked=f[4],Ee(F,q),ie||(he=fi(M,"change",f[16]),ie=!0)},p(ye,ge){ye[3]?xe?xe.p(ye,ge):(xe=_f(ye),xe.c(),xe.m(a,k)):xe&&(xe.d(1),xe=null),ge&16&&(M.checked=ye[4])},d(ye){ye&&Xe(a),f[15](null),xe&&xe.d(),ie=!1,he()}}}function gf(f){let a,h;return a=new hv({props:{wasmReady:f[5]}}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p(d,y){const S={};y&32&&(S.wasmReady=d[5]),a.$set(S)},i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function yf(f){let a,h,d,y,S,k;a=new Xa({props:{data:JSON.parse(f[3].getInvertedBoundary()),$$slots:{default:[Mv]},$$scope:{ctx:f}}});const s=[Dv,zv,Lv,Pv,Av],F=[];function M(q,ie){return q[8].mode=="network"?0:q[8].mode=="set-boundary"?1:q[8].mode=="neighbourhood"?2:q[8].mode=="view-shortcuts"?3:q[8].mode=="route"?4:-1}return~(d=M(f))&&(y=F[d]=s[d](f)),{c(){Vt(a.$$.fragment),h=Tt(),y&&y.c(),S=ss()},m(q,ie){Ot(a,q,ie),Ye(q,h,ie),~d&&F[d].m(q,ie),Ye(q,S,ie),k=!0},p(q,ie){const he={};ie&8&&(he.data=JSON.parse(q[3].getInvertedBoundary())),ie&524288&&(he.$$scope={dirty:ie,ctx:q}),a.$set(he);let xe=d;d=M(q),d===xe?~d&&F[d].p(q,ie):(y&&(lr(),Ve(F[xe],1,1,()=>{F[xe]=null}),cr()),~d?(y=F[d],y?y.p(q,ie):(y=F[d]=s[d](q),y.c()),ze(y,1),y.m(S.parentNode,S)):y=null)},i(q){k||(ze(a.$$.fragment,q),ze(y),k=!0)},o(q){Ve(a.$$.fragment,q),Ve(y),k=!1},d(q){q&&(Xe(h),Xe(S)),Bt(a,q),~d&&F[d].d(q)}}}function Mv(f){let a,h;return a=new Hh({props:{paint:{"fill-color":"black","fill-opacity":.3}}}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p:vi,i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function Av(f){let a,h;return a=new V0({}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p:vi,i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function Pv(f){let a,h;return a=new Ev({}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p:vi,i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function Lv(f){let a,h;return a=new T0({}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p:vi,i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function zv(f){let a,h;return a=new ev({props:{route_tool:f[6],existing:f[8].existing}}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p(d,y){const S={};y&64&&(S.route_tool=d[6]),y&256&&(S.existing=d[8].existing),a.$set(S)},i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function Dv(f){let a,h;return a=new L0({}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p:vi,i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function Fv(f){let a,h,d,y,S,k=f[8].mode=="title"&&gf(f),s=f[3]&&yf(f);return{c(){a=Ae("div"),h=Tt(),k&&k.c(),d=Tt(),s&&s.c(),y=ss()},m(F,M){Ye(F,a,M),f[12](a),Ye(F,h,M),k&&k.m(F,M),Ye(F,d,M),s&&s.m(F,M),Ye(F,y,M),S=!0},p(F,M){F[8].mode=="title"?k?(k.p(F,M),M&256&&ze(k,1)):(k=gf(F),k.c(),ze(k,1),k.m(d.parentNode,d)):k&&(lr(),Ve(k,1,1,()=>{k=null}),cr()),F[3]?s?(s.p(F,M),M&8&&ze(s,1)):(s=yf(F),s.c(),ze(s,1),s.m(y.parentNode,y)):s&&(lr(),Ve(s,1,1,()=>{s=null}),cr())},i(F){S||(ze(k),ze(s),S=!0)},o(F){Ve(k),Ve(s),S=!1},d(F){F&&(Xe(a),Xe(h),Xe(d),Xe(y)),f[12](null),k&&k.d(F),s&&s.d(F)}}}function Rv(f){let a,h,d,y;function S(s){f[13](s)}let k={style:f[7],standardControls:!0,hash:!0,$$slots:{default:[Fv]},$$scope:{ctx:f}};return f[0]!==void 0&&(k.map=f[0]),h=new sy({props:k}),Or.push(()=>fl(h,"map",S)),h.$on("error",f[14]),{c(){a=Ae("div"),Vt(h.$$.fragment),yi(a,"slot","main"),Ul(a,"position","relative"),Ul(a,"width","100%"),Ul(a,"height","100vh")},m(s,F){Ye(s,a,F),Ot(h,a,null),y=!0},p(s,F){const M={};F&128&&(M.style=s[7]),F&524652&&(M.$$scope={dirty:F,ctx:s}),!d&&F&1&&(d=!0,M.map=s[0],pl(()=>d=!1)),h.$set(M)},i(s){y||(ze(h.$$.fragment,s),y=!0)},o(s){Ve(h.$$.fragment,s),y=!1},d(s){s&&Xe(a),Bt(h)}}}function Ov(f){let a,h;return a=new Ey({props:{$$slots:{main:[Rv],left:[kv]},$$scope:{ctx:f}}}),{c(){Vt(a.$$.fragment)},m(d,y){Ot(a,d,y),h=!0},p(d,[y]){const S={};y&524799&&(S.$$scope={dirty:y,ctx:d}),a.$set(S)},i(d){h||(ze(a.$$.fragment,d),h=!0)},o(d){Ve(a.$$.fragment,d),h=!1},d(d){Bt(a,d)}}}function Bv(f,a,h){let d,y,S,k,s,F,M;ni(f,Uh,vt=>h(10,y=vt)),ni(f,Vh,vt=>h(11,S=vt)),ni(f,bs,vt=>h(3,k=vt)),ni(f,ml,vt=>h(17,s=vt)),ni(f,er,vt=>h(8,F=vt)),ni(f,Nh,vt=>h(4,M=vt));let q=!1;Gc(async()=>{await jh(),await qh(),h(5,q=!0)});let ie,he;function xe(){s.fitBounds(Array.from(k.getBounds()),{animate:!1})}function ye(vt){k&&(console.log("New map model loaded"),xe(),fn(er,F={mode:"network"},F),h(6,he=new qy(s,k.toRouteSnapper())))}let ge,fe;function Te(vt){Or[vt?"unshift":"push"](()=>{fe=vt,h(2,fe),h(10,y)})}function Pe(vt){ie=vt,h(0,ie)}const Ke=vt=>{console.log(vt.detail.error)};function je(vt){Or[vt?"unshift":"push"](()=>{ge=vt,h(1,ge),h(11,S)})}function St(){M=this.checked,Nh.set(M)}return f.$$.update=()=>{f.$$.dirty&16&&h(7,d=M?"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo":{version:8,sources:{},layers:[]}),f.$$.dirty&1&&ie&&ml.set(ie),f.$$.dirty&8&&ye(),f.$$.dirty&2050&&ge&&S&&(h(1,ge.innerHTML="",ge),ge.appendChild(S)),f.$$.dirty&1028&&fe&&y&&(h(2,fe.innerHTML="",fe),fe.appendChild(y))},[ie,ge,fe,k,M,q,he,d,F,xe,y,S,Te,Pe,Ke,je,St]}class Nv extends Hi{constructor(a){super(),Wi(this,a,Bv,Ov,Vi,{})}}new Nv({target:document.getElementById("app")});
