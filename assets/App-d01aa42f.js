var G2=Object.defineProperty;var H2=(r,e,t)=>e in r?G2(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var tr=(r,e,t)=>(H2(r,typeof e!="symbol"?e+"":e,t),t);function W2(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in r)){const o=Object.getOwnPropertyDescriptor(n,i);o&&Object.defineProperty(r,i,o.get?o:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function et(){}function Bt(r,e){for(const t in e)r[t]=e[t];return r}function K2(r){return!!r&&(typeof r=="object"||typeof r=="function")&&typeof r.then=="function"}function _b(r){return r()}function R_(){return Object.create(null)}function pr(r){r.forEach(_b)}function bl(r){return typeof r=="function"}function vt(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let Of;function fr(r,e){return r===e?!0:(Of||(Of=document.createElement("a")),Of.href=e,r===Of.href)}function X2(r){return Object.keys(r).length===0}function yb(r,...e){if(r==null){for(const n of e)n(void 0);return et}const t=r.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function fi(r){let e;return yb(r,t=>e=t)(),e}function at(r,e,t){r.$$.on_destroy.push(yb(e,t))}function Sn(r,e,t,n){if(r){const i=bb(r,e,t,n);return r[0](i)}}function bb(r,e,t,n){return r[1]&&n?Bt(t.ctx.slice(),r[1](n(e))):t.ctx}function Cn(r,e,t,n){if(r[2]&&n){const i=r[2](n(t));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],c=Math.max(e.dirty.length,i.length);for(let a=0;a<c;a+=1)o[a]=e.dirty[a]|i[a];return o}return e.dirty|i}return e.dirty}function Tn(r,e,t,n,i,o){if(i){const c=bb(e,t,n,o);r.p(c,i)}}function Mn(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function pi(r){const e={};for(const t in r)t[0]!=="$"&&(e[t]=r[t]);return e}function F_(r,e){const t={};e=new Set(e);for(const n in r)!e.has(n)&&n[0]!=="$"&&(t[n]=r[n]);return t}function $m(r){const e={};for(const t in r)e[t]=!0;return e}function od(r){return r??""}function Nt(r,e,t){return r.set(t),e}function tm(r){return r&&bl(r.destroy)?r.destroy:et}const vb=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function R(r,e){r.appendChild(e)}function q(r,e,t){r.insertBefore(e,t||null)}function V(r){r.parentNode&&r.parentNode.removeChild(r)}function di(r,e){for(let t=0;t<r.length;t+=1)r[t]&&r[t].d(e)}function U(r){return document.createElement(r)}function ds(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function xe(r){return document.createTextNode(r)}function oe(){return xe(" ")}function Xn(){return xe("")}function wt(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function Rm(r){return function(e){return e.preventDefault(),r.call(this,e)}}function rh(r){return function(e){return e.stopPropagation(),r.call(this,e)}}function de(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function sd(r,e){for(const t in e)de(r,t,e[t])}function J2(r,e,t){const n=new Set;for(let i=0;i<r.length;i+=1)r[i].checked&&n.add(r[i].__value);return t||n.delete(e),Array.from(n)}function Fm(r){let e;return{p(...t){e=t,e.forEach(n=>r.push(n))},r(){e.forEach(t=>r.splice(r.indexOf(t),1))}}}function ml(r){return r===""?null:+r}function Y2(r){return Array.from(r.childNodes)}function Tt(r,e){e=""+e,r.data!==e&&(r.data=e)}function qn(r,e){r.value=e??""}function st(r,e,t,n){t==null?r.style.removeProperty(e):r.style.setProperty(e,t,n?"important":"")}function Zi(r,e,t){for(let n=0;n<r.options.length;n+=1){const i=r.options[n];if(i.__value===e){i.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function Sa(r){const e=r.querySelector(":checked");return e&&e.__value}function Qt(r,e,t){r.classList.toggle(e,!!t)}function Q2(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}let fh;function Hs(r){fh=r}function Oc(){if(!fh)throw new Error("Function called outside component initialization");return fh}function Ls(r){Oc().$$.on_mount.push(r)}function Yr(r){Oc().$$.on_destroy.push(r)}function ms(){const r=Oc();return(e,t,{cancelable:n=!1}={})=>{const i=r.$$.callbacks[e];if(i){const o=Q2(e,t,{cancelable:n});return i.slice().forEach(c=>{c.call(r,o)}),!o.defaultPrevented}return!0}}function bd(r,e){return Oc().$$.context.set(r,e),e}function kh(r){return Oc().$$.context.get(r)}function zn(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const Mc=[],hn=[];let Pc=[];const nm=[],wb=Promise.resolve();let rm=!1;function xb(){rm||(rm=!0,wb.then(Bm))}function kb(){return xb(),wb}function us(r){Pc.push(r)}function En(r){nm.push(r)}const Np=new Set;let vc=0;function Bm(){if(vc!==0)return;const r=fh;do{try{for(;vc<Mc.length;){const e=Mc[vc];vc++,Hs(e),ex(e.$$)}}catch(e){throw Mc.length=0,vc=0,e}for(Hs(null),Mc.length=0,vc=0;hn.length;)hn.pop()();for(let e=0;e<Pc.length;e+=1){const t=Pc[e];Np.has(t)||(Np.add(t),t())}Pc.length=0}while(Mc.length);for(;nm.length;)nm.pop()();rm=!1,Np.clear(),Hs(r)}function ex(r){if(r.fragment!==null){r.update(),pr(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(us)}}function tx(r){const e=[],t=[];Pc.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Pc=e}const Wf=new Set;let dl;function en(){dl={r:0,c:[],p:dl}}function tn(){dl.r||pr(dl.c),dl=dl.p}function j(r,e){r&&r.i&&(Wf.delete(r),r.i(e))}function Z(r,e,t,n){if(r&&r.o){if(Wf.has(r))return;Wf.add(r),dl.c.push(()=>{Wf.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function B_(r,e){const t=e.token={};function n(i,o,c,a){if(e.token!==t)return;e.resolved=a;let d=e.ctx;c!==void 0&&(d=d.slice(),d[c]=a);const p=i&&(e.current=i)(d);let y=!1;e.block&&(e.blocks?e.blocks.forEach((_,w)=>{w!==o&&_&&(en(),Z(_,1,1,()=>{e.blocks[w]===_&&(e.blocks[w]=null)}),tn())}):e.block.d(1),p.c(),j(p,1),p.m(e.mount(),e.anchor),y=!0),e.block=p,e.blocks&&(e.blocks[o]=p),y&&Bm()}if(K2(r)){const i=Oc();if(r.then(o=>{Hs(i),n(e.then,1,e.value,o),Hs(null)},o=>{if(Hs(i),n(e.catch,2,e.error,o),Hs(null),!e.hasCatch)throw o}),e.current!==e.pending)return n(e.pending,0),!0}else{if(e.current!==e.then)return n(e.then,1,e.value,r),!0;e.resolved=r}}function nx(r,e,t){const n=e.slice(),{resolved:i}=r;r.current===r.then&&(n[r.value]=i),r.current===r.catch&&(n[r.error]=i),r.block.p(n,t)}function Rn(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function rx(r,e){Z(r,1,1,()=>{e.delete(r.key)})}function ix(r,e,t,n,i,o,c,a,d,p,y,_){let w=r.length,T=o.length,M=w;const $={};for(;M--;)$[r[M].key]=M;const P=[],D=new Map,I=new Map,F=[];for(M=T;M--;){const J=_(i,o,M),ee=t(J);let me=c.get(ee);me?n&&F.push(()=>me.p(J,e)):(me=p(ee,J),me.c()),D.set(ee,P[M]=me),ee in $&&I.set(ee,Math.abs(M-$[ee]))}const N=new Set,W=new Set;function se(J){j(J,1),J.m(a,y),c.set(J.key,J),y=J.first,T--}for(;w&&T;){const J=P[T-1],ee=r[w-1],me=J.key,Ie=ee.key;J===ee?(y=J.first,w--,T--):D.has(Ie)?!c.has(me)||N.has(me)?se(J):W.has(Ie)?w--:I.get(me)>I.get(Ie)?(W.add(me),se(J)):(N.add(Ie),w--):(d(ee,c),w--)}for(;w--;){const J=r[w];D.has(J.key)||d(J,c)}for(;T;)se(P[T-1]);return pr(F),P}function Fn(r,e){const t={},n={},i={$$scope:1};let o=r.length;for(;o--;){const c=r[o],a=e[o];if(a){for(const d in c)d in a||(n[d]=1);for(const d in a)i[d]||(t[d]=a[d],i[d]=1);r[o]=a}else for(const d in c)i[d]=1}for(const c in n)c in t||(t[c]=void 0);return t}function Ys(r){return typeof r=="object"&&r!==null?r:{}}function In(r,e,t){const n=r.$$.props[e];n!==void 0&&(r.$$.bound[n]=t,t(r.$$.ctx[n]))}function fe(r){r&&r.c()}function ue(r,e,t){const{fragment:n,after_update:i}=r.$$;n&&n.m(e,t),us(()=>{const o=r.$$.on_mount.map(_b).filter(bl);r.$$.on_destroy?r.$$.on_destroy.push(...o):pr(o),r.$$.on_mount=[]}),i.forEach(us)}function he(r,e){const t=r.$$;t.fragment!==null&&(tx(t.after_update),pr(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function ox(r,e){r.$$.dirty[0]===-1&&(Mc.push(r),xb(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Mt(r,e,t,n,i,o,c=null,a=[-1]){const d=fh;Hs(r);const p=r.$$={fragment:null,ctx:[],props:o,update:et,not_equal:i,bound:R_(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:R_(),dirty:a,skip_bound:!1,root:e.target||d.$$.root};c&&c(p.root);let y=!1;if(p.ctx=t?t(r,e.props||{},(_,w,...T)=>{const M=T.length?T[0]:w;return p.ctx&&i(p.ctx[_],p.ctx[_]=M)&&(!p.skip_bound&&p.bound[_]&&p.bound[_](M),y&&ox(r,_)),w}):[],p.update(),y=!0,pr(p.before_update),p.fragment=n?n(p.ctx):!1,e.target){if(e.hydrate){const _=Y2(e.target);p.fragment&&p.fragment.l(_),_.forEach(V)}else p.fragment&&p.fragment.c();e.intro&&j(r.$$.fragment),ue(r,e.target,e.anchor),Bm()}Hs(d)}class Lt{constructor(){tr(this,"$$");tr(this,"$$set")}$destroy(){he(this,1),this.$destroy=et}$on(e,t){if(!bl(t))return et;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!X2(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const sx="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(sx);const ax="/ltn/assets/arrow-big-up-4ad5891e.png",lx="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",cx="/ltn/assets/logo-97f2d067.svg",Sb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAJCAYAAAACTR1pAAAACXBIWXMAAANVAAADaAEorMqLAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAPtJREFUKJF9kT1LwwAURc+NAQsdtFYHa8HBSAcHJ0HBUVz0n7i4ObkoKAV/gYObm5ubu7OKFMQPECFuoQgWRJtch9aSYvSO770D53Flm58kM401BdkesAJcYw4m4scz8kf9qGBGe3ZuNcuCHcEmcGv7qBo/nWKnAzCpR8+/yMGWUWAcU0L6wn4DOgAhcFHEGEoBLGAqoK7te6Eb406h6vv0/NRnyBawDYyATzKFzcmXu9chmaQeHfesVDZeFGqAU0QrMy3BR5FRCKz31FxGGrMdIrpATVD98/0hVSlo16INB9oFLyEuldKsxA/n/4O59DvdB5YNVzKH+U6/AaiZavkY71DDAAAAAElFTkSuQmCC";function O_(r){let e,t,n,i=r[1]!=null&&N_(r);return{c(){e=U("div"),t=xe(r[0]),n=oe(),i&&i.c(),de(e,"class","cover svelte-1w7hi45")},m(o,c){q(o,e,c),R(e,t),R(e,n),i&&i.m(e,null)},p(o,c){c&1&&Tt(t,o[0]),o[1]!=null?i?i.p(o,c):(i=N_(o),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},d(o){o&&V(e),i&&i.d()}}}function N_(r){let e,t;return{c(){e=U("div"),t=U("progress"),t.value=r[1],st(t,"width","100%")},m(n,i){q(n,e,i),R(e,t)},p(n,i){i&2&&(t.value=n[1])},d(n){n&&V(e)}}}function ux(r){let e,t=r[0]&&O_(r);return{c(){t&&t.c(),e=Xn()},m(n,i){t&&t.m(n,i),q(n,e,i)},p(n,[i]){n[0]?t?t.p(n,i):(t=O_(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:et,o:et,d(n){n&&V(e),t&&t.d(n)}}}function hx(r,e,t){let{loading:n}=e,{progress:i=null}=e;return r.$$set=o=>{"loading"in o&&t(0,n=o.loading),"progress"in o&&t(1,i=o.progress)},[n,i]}class Sh extends Lt{constructor(e){super(),Mt(this,e,hx,ux,vt,{loading:0,progress:1})}}function fx(r){let e,t,n,i,o;const c=r[5].default,a=Sn(c,r,r[4],null);return{c(){e=U("dialog"),t=U("article"),a&&a.c()},m(d,p){q(d,e,p),R(e,t),a&&a.m(t,null),r[6](e),n=!0,i||(o=[wt(e,"click",rh(r[1])),wt(e,"keydown",r[2])],i=!0)},p(d,[p]){a&&a.p&&(!n||p&16)&&Tn(a,c,d,d[4],n?Cn(c,d[4],p,null):Mn(d[4]),null)},i(d){n||(j(a,d),n=!0)},o(d){Z(a,d),n=!1},d(d){d&&V(e),a&&a.d(d),r[6](null),i=!1,pr(o)}}}function dx(r,e,t){let{$$slots:n={},$$scope:i}=e,{show:o=!1}=e,c;function a(y){y.target==c&&t(3,o=!1)}function d(y){(y.key=="Escape"||y.key=="Enter")&&(y.stopPropagation(),t(3,o=!1))}function p(y){hn[y?"unshift":"push"](()=>{c=y,t(0,c)})}return r.$$set=y=>{"show"in y&&t(3,o=y.show),"$$scope"in y&&t(4,i=y.$$scope)},r.$$.update=()=>{r.$$.dirty&9&&c&&(o?c.showModal():c.close())},[c,a,d,o,i,n,p]}class vd extends Lt{constructor(e){super(),Mt(this,e,dx,fx,vt,{show:3})}}function j_(r,e,t){const n=r.slice();return n[1]=e[t][0],n[2]=e[t][1],n}function U_(r){let e,t,n=r[1]+"",i,o,c,a=r[2]+"",d,p;return{c(){e=U("tr"),t=U("td"),i=xe(n),o=oe(),c=U("td"),d=xe(a),p=oe()},m(y,_){q(y,e,_),R(e,t),R(t,i),R(e,o),R(e,c),R(c,d),R(e,p)},p(y,_){_&1&&n!==(n=y[1]+"")&&Tt(i,n),_&1&&a!==(a=y[2]+"")&&Tt(d,a)},d(y){y&&V(e)}}}function px(r){let e,t,n=Rn(Object.entries(r[0])),i=[];for(let o=0;o<n.length;o+=1)i[o]=U_(j_(r,n,o));return{c(){e=U("table"),t=U("tbody");for(let o=0;o<i.length;o+=1)i[o].c();de(e,"class","svelte-lh2o9l")},m(o,c){q(o,e,c),R(e,t);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(t,null)},p(o,[c]){if(c&1){n=Rn(Object.entries(o[0]));let a;for(a=0;a<n.length;a+=1){const d=j_(o,n,a);i[a]?i[a].p(d,c):(i[a]=U_(d),i[a].c(),i[a].m(t,null))}for(;a<i.length;a+=1)i[a].d(1);i.length=n.length}},i:et,o:et,d(o){o&&V(e),di(i,o)}}}function mx(r,e,t){let{properties:n}=e;return r.$$set=i=>{"properties"in i&&t(0,n=i.properties)},[n]}class Ch extends Lt{constructor(e){super(),Mt(this,e,mx,px,vt,{properties:0})}}function wd(r,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function yr(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}var Cb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Tb(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Om(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var Mb={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(r,e){(function(t,n){r.exports=n()})(Cb,function(){var t={},n={};function i(c,a,d){if(n[c]=d,c==="index"){var p="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",y={};return n.shared(y),n.index(t,y),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([p],{type:"text/javascript"}))),t}}i("shared",["exports"],function(c){function a(u,s,h,m){return new(h||(h=Promise))(function(v,S){function C(O){try{z(m.next(O))}catch(H){S(H)}}function L(O){try{z(m.throw(O))}catch(H){S(H)}}function z(O){var H;O.done?v(O.value):(H=O.value,H instanceof h?H:new h(function(K){K(H)})).then(C,L)}z((m=m.apply(u,s||[])).next())})}function d(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}typeof SuppressedError=="function"&&SuppressedError;var p=y;function y(u,s){this.x=u,this.y=s}y.prototype={clone:function(){return new y(this.x,this.y)},add:function(u){return this.clone()._add(u)},sub:function(u){return this.clone()._sub(u)},multByPoint:function(u){return this.clone()._multByPoint(u)},divByPoint:function(u){return this.clone()._divByPoint(u)},mult:function(u){return this.clone()._mult(u)},div:function(u){return this.clone()._div(u)},rotate:function(u){return this.clone()._rotate(u)},rotateAround:function(u,s){return this.clone()._rotateAround(u,s)},matMult:function(u){return this.clone()._matMult(u)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(u){return this.x===u.x&&this.y===u.y},dist:function(u){return Math.sqrt(this.distSqr(u))},distSqr:function(u){var s=u.x-this.x,h=u.y-this.y;return s*s+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith:function(u){return this.angleWithSep(u.x,u.y)},angleWithSep:function(u,s){return Math.atan2(this.x*s-this.y*u,this.x*u+this.y*s)},_matMult:function(u){var s=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=s,this},_add:function(u){return this.x+=u.x,this.y+=u.y,this},_sub:function(u){return this.x-=u.x,this.y-=u.y,this},_mult:function(u){return this.x*=u,this.y*=u,this},_div:function(u){return this.x/=u,this.y/=u,this},_multByPoint:function(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint:function(u){return this.x/=u.x,this.y/=u.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var u=this.y;return this.y=this.x,this.x=-u,this},_rotate:function(u){var s=Math.cos(u),h=Math.sin(u),m=h*this.x+s*this.y;return this.x=s*this.x-h*this.y,this.y=m,this},_rotateAround:function(u,s){var h=Math.cos(u),m=Math.sin(u),v=s.y+m*(this.x-s.x)+h*(this.y-s.y);return this.x=s.x+h*(this.x-s.x)-m*(this.y-s.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},y.convert=function(u){return u instanceof y?u:Array.isArray(u)?new y(u[0],u[1]):u};var _=d(p),w=T;function T(u,s,h,m){this.cx=3*u,this.bx=3*(h-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(m-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=s,this.p2x=h,this.p2y=m}T.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,s){if(s===void 0&&(s=1e-6),u<0)return 0;if(u>1)return 1;for(var h=u,m=0;m<8;m++){var v=this.sampleCurveX(h)-u;if(Math.abs(v)<s)return h;var S=this.sampleCurveDerivativeX(h);if(Math.abs(S)<1e-6)break;h-=v/S}var C=0,L=1;for(h=u,m=0;m<20&&(v=this.sampleCurveX(h),!(Math.abs(v-u)<s));m++)u>v?C=h:L=h,h=.5*(L-C)+C;return h},solve:function(u,s){return this.sampleCurveY(this.solveCurveX(u,s))}};var M=d(w);let $,P;function D(){return $==null&&($=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),$}function I(){if(P==null&&(P=!1,D())){const s=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(s){for(let m=0;m<5*5;m++){const v=4*m;s.fillStyle=`rgb(${v},${v+1},${v+2})`,s.fillRect(m%5,Math.floor(m/5),1,1)}const h=s.getImageData(0,0,5,5).data;for(let m=0;m<5*5*4;m++)if(m%4!=3&&h[m]!==m){P=!0;break}}}return P||!1}function F(u,s,h,m){const v=new M(u,s,h,m);return function(S){return v.solve(S)}}const N=F(.25,.1,.25,1);function W(u,s,h){return Math.min(h,Math.max(s,u))}function se(u,s,h){const m=h-s,v=((u-s)%m+m)%m+s;return v===s?h:v}function J(u,...s){for(const h of s)for(const m in h)u[m]=h[m];return u}let ee=1;function me(u,s,h){const m={};for(const v in u)m[v]=s.call(h||this,u[v],v,u);return m}function Ie(u,s,h){const m={};for(const v in u)s.call(h||this,u[v],v,u)&&(m[v]=u[v]);return m}function Q(u){return Array.isArray(u)?u.map(Q):typeof u=="object"&&u?me(u,Q):u}const ae={};function Pe(u){ae[u]||(typeof console<"u"&&console.warn(u),ae[u]=!0)}function ve(u,s,h){return(h.y-u.y)*(s.x-u.x)>(s.y-u.y)*(h.x-u.x)}function tt(u){let s=0;for(let h,m,v=0,S=u.length,C=S-1;v<S;C=v++)h=u[v],m=u[C],s+=(m.x-h.x)*(h.y+m.y);return s}function Ge(u){return typeof WorkerGlobalScope<"u"&&u!==void 0&&u instanceof WorkerGlobalScope}let Ee=null;function $e(u){return typeof ImageBitmap<"u"&&u instanceof ImageBitmap}const St="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function rt(u,s,h,m,v){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const S=new VideoFrame(u,{timestamp:0});try{const C=S==null?void 0:S.format;if(!C||!C.startsWith("BGR")&&!C.startsWith("RGB"))throw new Error(`Unrecognized format ${C}`);const L=C.startsWith("BGR"),z=new Uint8ClampedArray(m*v*4);if(yield S.copyTo(z,function(O,H,K,ie,ce){const ge=4*Math.max(-H,0),be=(Math.max(0,K)-K)*ie*4+ge,Te=4*ie,Ae=Math.max(0,H),Ze=Math.max(0,K);return{rect:{x:Ae,y:Ze,width:Math.min(O.width,H+ie)-Ae,height:Math.min(O.height,K+ce)-Ze},layout:[{offset:be,stride:Te}]}}(u,s,h,m,v)),L)for(let O=0;O<z.length;O+=4){const H=z[O];z[O]=z[O+2],z[O+2]=H}return z}finally{S.close()}})}let lt,mt;const ft="AbortError";function Xe(){return new Error(ft)}const Dt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function _t(u){return Dt.REGISTERED_PROTOCOLS[u.substring(0,u.indexOf("://"))]}const $t="global-dispatcher";class Et extends Error{constructor(s,h,m,v){super(`AJAXError: ${h} (${s}): ${m}`),this.status=s,this.statusText=h,this.url=m,this.body=v}}const Yt=()=>Ge(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,_n=function(u,s){if(/:\/\//.test(u.url)&&!/^https?:|^file:/.test(u.url)){const m=_t(u.url);if(m)return m(u,s);if(Ge(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,targetMapId:$t},s)}if(!(/^file:/.test(h=u.url)||/^file:/.test(Yt())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(m,v){return a(this,void 0,void 0,function*(){const S=new Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,cache:m.cache,referrer:Yt(),signal:v.signal});m.type==="json"&&S.headers.set("Accept","application/json");const C=yield fetch(S);if(!C.ok){const O=yield C.blob();throw new Et(C.status,C.statusText,m.url,O)}let L;L=m.type==="arrayBuffer"||m.type==="image"?C.arrayBuffer():m.type==="json"?C.json():C.text();const z=yield L;if(v.signal.aborted)throw Xe();return{data:z,cacheControl:C.headers.get("Cache-Control"),expires:C.headers.get("Expires")}})}(u,s);if(Ge(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,mustQueue:!0,targetMapId:$t},s)}var h;return function(m,v){return new Promise((S,C)=>{const L=new XMLHttpRequest;L.open(m.method||"GET",m.url,!0),m.type!=="arrayBuffer"&&m.type!=="image"||(L.responseType="arraybuffer");for(const z in m.headers)L.setRequestHeader(z,m.headers[z]);m.type==="json"&&(L.responseType="text",L.setRequestHeader("Accept","application/json")),L.withCredentials=m.credentials==="include",L.onerror=()=>{C(new Error(L.statusText))},L.onload=()=>{if(!v.signal.aborted)if((L.status>=200&&L.status<300||L.status===0)&&L.response!==null){let z=L.response;if(m.type==="json")try{z=JSON.parse(L.response)}catch(O){return void C(O)}S({data:z,cacheControl:L.getResponseHeader("Cache-Control"),expires:L.getResponseHeader("Expires")})}else{const z=new Blob([L.response],{type:L.getResponseHeader("Content-Type")});C(new Et(L.status,L.statusText,m.url,z))}},v.signal.addEventListener("abort",()=>{L.abort(),C(Xe())}),L.send(m.body)})}(u,s)};function Zt(u){if(!u||u.indexOf("://")<=0||u.indexOf("data:image/")===0||u.indexOf("blob:")===0)return!0;const s=new URL(u),h=window.location;return s.protocol===h.protocol&&s.host===h.host}function ln(u,s,h){h[u]&&h[u].indexOf(s)!==-1||(h[u]=h[u]||[],h[u].push(s))}function ze(u,s,h){if(h&&h[u]){const m=h[u].indexOf(s);m!==-1&&h[u].splice(m,1)}}class Ne{constructor(s,h={}){J(this,h),this.type=s}}class kt extends Ne{constructor(s,h={}){super("error",J({error:s},h))}}class jt{on(s,h){return this._listeners=this._listeners||{},ln(s,h,this._listeners),this}off(s,h){return ze(s,h,this._listeners),ze(s,h,this._oneTimeListeners),this}once(s,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},ln(s,h,this._oneTimeListeners),this):new Promise(m=>this.once(s,m))}fire(s,h){typeof s=="string"&&(s=new Ne(s,h||{}));const m=s.type;if(this.listens(m)){s.target=this;const v=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const L of v)L.call(this,s);const S=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const L of S)ze(m,L,this._oneTimeListeners),L.call(this,s);const C=this._eventedParent;C&&(J(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),C.fire(s))}else s instanceof kt&&console.error(s.error);return this}listens(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)}setEventedParent(s,h){return this._eventedParent=s,this._eventedParentData=h,this}}var _e={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const vn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ue(u,s){const h={};for(const m in u)m!=="ref"&&(h[m]=u[m]);return vn.forEach(m=>{m in s&&(h[m]=s[m])}),h}function it(u,s){if(Array.isArray(u)){if(!Array.isArray(s)||u.length!==s.length)return!1;for(let h=0;h<u.length;h++)if(!it(u[h],s[h]))return!1;return!0}if(typeof u=="object"&&u!==null&&s!==null){if(typeof s!="object"||Object.keys(u).length!==Object.keys(s).length)return!1;for(const h in u)if(!it(u[h],s[h]))return!1;return!0}return u===s}function Kt(u,s){u.push(s)}function ur(u,s,h){Kt(h,{command:"addSource",args:[u,s[u]]})}function nr(u,s,h){Kt(s,{command:"removeSource",args:[u]}),h[u]=!0}function vr(u,s,h,m){nr(u,h,m),ur(u,s,h)}function Qr(u,s,h){let m;for(m in u[h])if(Object.prototype.hasOwnProperty.call(u[h],m)&&m!=="data"&&!it(u[h][m],s[h][m]))return!1;for(m in s[h])if(Object.prototype.hasOwnProperty.call(s[h],m)&&m!=="data"&&!it(u[h][m],s[h][m]))return!1;return!0}function mr(u,s,h,m,v,S){u=u||{},s=s||{};for(const C in u)Object.prototype.hasOwnProperty.call(u,C)&&(it(u[C],s[C])||h.push({command:S,args:[m,C,s[C],v]}));for(const C in s)Object.prototype.hasOwnProperty.call(s,C)&&!Object.prototype.hasOwnProperty.call(u,C)&&(it(u[C],s[C])||h.push({command:S,args:[m,C,s[C],v]}))}function Ci(u){return u.id}function Jn(u,s){return u[s.id]=s,u}class yt{constructor(s,h,m,v){this.message=(s?`${s}: `:"")+m,v&&(this.identifier=v),h!=null&&h.__line__&&(this.line=h.__line__)}}function wr(u,...s){for(const h of s)for(const m in h)u[m]=h[m];return u}class Tr extends Error{constructor(s,h){super(h),this.message=h,this.key=s}}class uo{constructor(s,h=[]){this.parent=s,this.bindings={};for(const[m,v]of h)this.bindings[m]=v}concat(s){return new uo(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const Yn={kind:"null"},At={kind:"number"},pn={kind:"string"},Gt={kind:"boolean"},Qn={kind:"color"},mi={kind:"object"},sn={kind:"value"},zi={kind:"collator"},er={kind:"formatted"},Ce={kind:"padding"},te={kind:"resolvedImage"},ne={kind:"variableAnchorOffsetCollection"};function le(u,s){return{kind:"array",itemType:u,N:s}}function we(u){if(u.kind==="array"){const s=we(u.itemType);return typeof u.N=="number"?`array<${s}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${s}>`}return u.kind}const Be=[Yn,At,pn,Gt,Qn,er,mi,le(sn),Ce,te,ne];function Oe(u,s){if(s.kind==="error")return null;if(u.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Oe(u.itemType,s.itemType))&&(typeof u.N!="number"||u.N===s.N))return null}else{if(u.kind===s.kind)return null;if(u.kind==="value"){for(const h of Be)if(!Oe(h,s))return null}}return`Expected ${we(u)} but found ${we(s)} instead.`}function qe(u,s){return s.some(h=>h.kind===u.kind)}function De(u,s){return s.some(h=>h==="null"?u===null:h==="array"?Array.isArray(u):h==="object"?u&&!Array.isArray(u)&&typeof u=="object":h===typeof u)}function re(u,s){return u.kind==="array"&&s.kind==="array"?u.itemType.kind===s.itemType.kind&&typeof u.N=="number":u.kind===s.kind}const He=.96422,Ke=.82521,Ye=4/29,ct=6/29,Ct=3*ct*ct,Xt=ct*ct*ct,fn=Math.PI/180,wn=180/Math.PI;function Bn(u){return(u%=360)<0&&(u+=360),u}function xr([u,s,h,m]){let v,S;const C=xn((.2225045*(u=qr(u))+.7168786*(s=qr(s))+.0606169*(h=qr(h)))/1);u===s&&s===h?v=S=C:(v=xn((.4360747*u+.3850649*s+.1430804*h)/He),S=xn((.0139322*u+.0971045*s+.7141733*h)/Ke));const L=116*C-16;return[L<0?0:L,500*(v-C),200*(C-S),m]}function qr(u){return u<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function xn(u){return u>Xt?Math.pow(u,1/3):u/Ct+Ye}function Pr([u,s,h,m]){let v=(u+16)/116,S=isNaN(s)?v:v+s/500,C=isNaN(h)?v:v-h/200;return v=1*Ti(v),S=He*Ti(S),C=Ke*Ti(C),[ei(3.1338561*S-1.6168667*v-.4906146*C),ei(-.9787684*S+1.9161415*v+.033454*C),ei(.0719453*S-.2289914*v+1.4052427*C),m]}function ei(u){return(u=u<=.00304?12.92*u:1.055*Math.pow(u,1/2.4)-.055)<0?0:u>1?1:u}function Ti(u){return u>ct?u*u*u:Ct*(u-Ye)}function Di(u){return parseInt(u.padEnd(2,u),16)/255}function hi(u,s){return No(s?u/100:u,0,1)}function No(u,s,h){return Math.min(Math.max(s,u),h)}function zh(u){return!u.some(Number.isNaN)}const $d={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class rr{constructor(s,h,m,v=1,S=!0){this.r=s,this.g=h,this.b=m,this.a=v,S||(this.r*=v,this.g*=v,this.b*=v,v||this.overwriteGetter("rgb",[s,h,m,v]))}static parse(s){if(s instanceof rr)return s;if(typeof s!="string")return;const h=function(m){if((m=m.toLowerCase().trim())==="transparent")return[0,0,0,0];const v=$d[m];if(v){const[C,L,z]=v;return[C/255,L/255,z/255,1]}if(m.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(m)){const C=m.length<6?1:2;let L=1;return[Di(m.slice(L,L+=C)),Di(m.slice(L,L+=C)),Di(m.slice(L,L+=C)),Di(m.slice(L,L+C)||"ff")]}if(m.startsWith("rgb")){const C=m.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(C){const[L,z,O,H,K,ie,ce,ge,be,Te,Ae,Ze]=C,Re=[H||" ",ce||" ",Te].join("");if(Re==="  "||Re==="  /"||Re===",,"||Re===",,,"){const je=[O,ie,be].join(""),ut=je==="%%%"?100:je===""?255:0;if(ut){const ht=[No(+z/ut,0,1),No(+K/ut,0,1),No(+ge/ut,0,1),Ae?hi(+Ae,Ze):1];if(zh(ht))return ht}}return}}const S=m.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(S){const[C,L,z,O,H,K,ie,ce,ge]=S,be=[z||" ",H||" ",ie].join("");if(be==="  "||be==="  /"||be===",,"||be===",,,"){const Te=[+L,No(+O,0,100),No(+K,0,100),ce?hi(+ce,ge):1];if(zh(Te))return function([Ae,Ze,Re,je]){function ut(ht){const qt=(ht+Ae/30)%12,Jt=Ze*Math.min(Re,1-Re);return Re-Jt*Math.max(-1,Math.min(qt-3,9-qt,1))}return Ae=Bn(Ae),Ze/=100,Re/=100,[ut(0),ut(8),ut(4),je]}(Te)}}}(s);return h?new rr(...h,!1):void 0}get rgb(){const{r:s,g:h,b:m,a:v}=this,S=v||1/0;return this.overwriteGetter("rgb",[s/S,h/S,m/S,v])}get hcl(){return this.overwriteGetter("hcl",function(s){const[h,m,v,S]=xr(s),C=Math.sqrt(m*m+v*v);return[Math.round(1e4*C)?Bn(Math.atan2(v,m)*wn):NaN,C,h,S]}(this.rgb))}get lab(){return this.overwriteGetter("lab",xr(this.rgb))}overwriteGetter(s,h){return Object.defineProperty(this,s,{value:h}),h}toString(){const[s,h,m,v]=this.rgb;return`rgba(${[s,h,m].map(S=>Math.round(255*S)).join(",")},${v})`}}rr.black=new rr(0,0,0,1),rr.white=new rr(1,1,1,1),rr.transparent=new rr(0,0,0,0),rr.red=new rr(1,0,0,1);class jc{constructor(s,h,m){this.sensitivity=s?h?"variant":"case":h?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,h){return this.collator.compare(s,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Uc{constructor(s,h,m,v,S){this.text=s,this.image=h,this.scale=m,this.fontStack=v,this.textColor=S}}class Xi{constructor(s){this.sections=s}static fromString(s){return new Xi([new Uc(s,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||s.image&&s.image.name.length!==0)}static factory(s){return s instanceof Xi?s:Xi.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}}class $i{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof $i)return s;if(typeof s=="number")return new $i([s,s,s,s]);if(Array.isArray(s)&&!(s.length<1||s.length>4)){for(const h of s)if(typeof h!="number")return;switch(s.length){case 1:s=[s[0],s[0],s[0],s[0]];break;case 2:s=[s[0],s[1],s[0],s[1]];break;case 3:s=[s[0],s[1],s[2],s[1]]}return new $i(s)}}toString(){return JSON.stringify(this.values)}}const Na=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ho{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof ho)return s;if(Array.isArray(s)&&!(s.length<1)&&s.length%2==0){for(let h=0;h<s.length;h+=2){const m=s[h],v=s[h+1];if(typeof m!="string"||!Na.has(m)||!Array.isArray(v)||v.length!==2||typeof v[0]!="number"||typeof v[1]!="number")return}return new ho(s)}}toString(){return JSON.stringify(this.values)}}class fo{constructor(s){this.name=s.name,this.available=s.available}toString(){return this.name}static fromString(s){return s?new fo({name:s,available:!1}):null}}function ra(u,s,h,m){return typeof u=="number"&&u>=0&&u<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof h=="number"&&h>=0&&h<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:`Invalid rgba value [${[u,s,h,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[u,s,h,m]:[u,s,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function kl(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof rr||u instanceof jc||u instanceof Xi||u instanceof $i||u instanceof ho||u instanceof fo)return!0;if(Array.isArray(u)){for(const s of u)if(!kl(s))return!1;return!0}if(typeof u=="object"){for(const s in u)if(!kl(u[s]))return!1;return!0}return!1}function Zr(u){if(u===null)return Yn;if(typeof u=="string")return pn;if(typeof u=="boolean")return Gt;if(typeof u=="number")return At;if(u instanceof rr)return Qn;if(u instanceof jc)return zi;if(u instanceof Xi)return er;if(u instanceof $i)return Ce;if(u instanceof ho)return ne;if(u instanceof fo)return te;if(Array.isArray(u)){const s=u.length;let h;for(const m of u){const v=Zr(m);if(h){if(h===v)continue;h=sn;break}h=v}return le(h||sn,s)}return mi}function ja(u){const s=typeof u;return u===null?"":s==="string"||s==="number"||s==="boolean"?String(u):u instanceof rr||u instanceof Xi||u instanceof $i||u instanceof ho||u instanceof fo?u.toString():JSON.stringify(u)}class gs{constructor(s,h){this.type=s,this.value=h}static parse(s,h){if(s.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!kl(s[1]))return h.error("invalid value");const m=s[1];let v=Zr(m);const S=h.expectedType;return v.kind!=="array"||v.N!==0||!S||S.kind!=="array"||typeof S.N=="number"&&S.N!==0||(v=S),new gs(v,m)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Mr{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}}const Sl={string:pn,number:At,boolean:Gt,object:mi};class Ji{constructor(s,h){this.type=s,this.args=h}static parse(s,h){if(s.length<2)return h.error("Expected at least one argument.");let m,v=1;const S=s[0];if(S==="array"){let L,z;if(s.length>2){const O=s[1];if(typeof O!="string"||!(O in Sl)||O==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);L=Sl[O],v++}else L=sn;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return h.error('The length argument to "array" must be a positive integer literal',2);z=s[2],v++}m=le(L,z)}else{if(!Sl[S])throw new Error(`Types doesn't contain name = ${S}`);m=Sl[S]}const C=[];for(;v<s.length;v++){const L=h.parse(s[v],v,sn);if(!L)return null;C.push(L)}return new Ji(m,C)}evaluate(s){for(let h=0;h<this.args.length;h++){const m=this.args[h].evaluate(s);if(!Oe(this.type,Zr(m)))return m;if(h===this.args.length-1)throw new Mr(`Expected value to be of type ${we(this.type)}, but found ${we(Zr(m))} instead.`)}throw new Error}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const Cl={"to-boolean":Gt,"to-color":Qn,"to-number":At,"to-string":pn};class jo{constructor(s,h){this.type=s,this.args=h}static parse(s,h){if(s.length<2)return h.error("Expected at least one argument.");const m=s[0];if(!Cl[m])throw new Error(`Can't parse ${m} as it is not part of the known types`);if((m==="to-boolean"||m==="to-string")&&s.length!==2)return h.error("Expected one argument.");const v=Cl[m],S=[];for(let C=1;C<s.length;C++){const L=h.parse(s[C],C,sn);if(!L)return null;S.push(L)}return new jo(v,S)}evaluate(s){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(s);case"color":{let h,m;for(const v of this.args){if(h=v.evaluate(s),m=null,h instanceof rr)return h;if(typeof h=="string"){const S=s.parseColor(h);if(S)return S}else if(Array.isArray(h)&&(m=h.length<3||h.length>4?`Invalid rbga value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:ra(h[0],h[1],h[2],h[3]),!m))return new rr(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new Mr(m||`Could not parse color from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"padding":{let h;for(const m of this.args){h=m.evaluate(s);const v=$i.parse(h);if(v)return v}throw new Mr(`Could not parse padding from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"variableAnchorOffsetCollection":{let h;for(const m of this.args){h=m.evaluate(s);const v=ho.parse(h);if(v)return v}throw new Mr(`Could not parse variableAnchorOffsetCollection from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"number":{let h=null;for(const m of this.args){if(h=m.evaluate(s),h===null)return 0;const v=Number(h);if(!isNaN(v))return v}throw new Mr(`Could not convert ${JSON.stringify(h)} to number.`)}case"formatted":return Xi.fromString(ja(this.args[0].evaluate(s)));case"resolvedImage":return fo.fromString(ja(this.args[0].evaluate(s)));default:return ja(this.args[0].evaluate(s))}}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const Ua=["Unknown","Point","LineString","Polygon"];class ir{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ua[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(s){let h=this._parseColorCache[s];return h||(h=this._parseColorCache[s]=rr.parse(s)),h}}class Tl{constructor(s,h,m=[],v,S=new uo,C=[]){this.registry=s,this.path=m,this.key=m.map(L=>`[${L}]`).join(""),this.scope=S,this.errors=C,this.expectedType=v,this._isConstant=h}parse(s,h,m,v,S={}){return h?this.concat(h,m,v)._parse(s,S):this._parse(s,S)}_parse(s,h){function m(v,S,C){return C==="assert"?new Ji(S,[v]):C==="coerce"?new jo(S,[v]):v}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const v=s[0];if(typeof v!="string")return this.error(`Expression name must be a string, but found ${typeof v} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const S=this.registry[v];if(S){let C=S.parse(s,this);if(!C)return null;if(this.expectedType){const L=this.expectedType,z=C.type;if(L.kind!=="string"&&L.kind!=="number"&&L.kind!=="boolean"&&L.kind!=="object"&&L.kind!=="array"||z.kind!=="value")if(L.kind!=="color"&&L.kind!=="formatted"&&L.kind!=="resolvedImage"||z.kind!=="value"&&z.kind!=="string")if(L.kind!=="padding"||z.kind!=="value"&&z.kind!=="number"&&z.kind!=="array")if(L.kind!=="variableAnchorOffsetCollection"||z.kind!=="value"&&z.kind!=="array"){if(this.checkSubtype(L,z))return null}else C=m(C,L,h.typeAnnotation||"coerce");else C=m(C,L,h.typeAnnotation||"coerce");else C=m(C,L,h.typeAnnotation||"coerce");else C=m(C,L,h.typeAnnotation||"assert")}if(!(C instanceof gs)&&C.type.kind!=="resolvedImage"&&this._isConstant(C)){const L=new ir;try{C=new gs(C.type,C.evaluate(L))}catch(z){return this.error(z.message),null}}return C}return this.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,h,m){const v=typeof s=="number"?this.path.concat(s):this.path,S=m?this.scope.concat(m):this.scope;return new Tl(this.registry,this._isConstant,v,h||null,S,this.errors)}error(s,...h){const m=`${this.key}${h.map(v=>`[${v}]`).join("")}`;this.errors.push(new Tr(m,s))}checkSubtype(s,h){const m=Oe(s,h);return m&&this.error(m),m}}class ia{constructor(s,h,m){this.type=zi,this.locale=m,this.caseSensitive=s,this.diacriticSensitive=h}static parse(s,h){if(s.length!==2)return h.error("Expected one argument.");const m=s[1];if(typeof m!="object"||Array.isArray(m))return h.error("Collator options argument must be an object.");const v=h.parse(m["case-sensitive"]!==void 0&&m["case-sensitive"],1,Gt);if(!v)return null;const S=h.parse(m["diacritic-sensitive"]!==void 0&&m["diacritic-sensitive"],1,Gt);if(!S)return null;let C=null;return m.locale&&(C=h.parse(m.locale,1,pn),!C)?null:new ia(v,S,C)}evaluate(s){return new jc(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}}const _s=8192;function Ml(u,s){u[0]=Math.min(u[0],s[0]),u[1]=Math.min(u[1],s[1]),u[2]=Math.max(u[2],s[0]),u[3]=Math.max(u[3],s[1])}function Va(u,s){return!(u[0]<=s[0]||u[2]>=s[2]||u[1]<=s[1]||u[3]>=s[3])}function Rd(u,s){const h=(180+u[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,v=Math.pow(2,s.z);return[Math.round(h*v*_s),Math.round(m*v*_s)]}function Dh(u,s,h){const m=u[0]-s[0],v=u[1]-s[1],S=u[0]-h[0],C=u[1]-h[1];return m*C-S*v==0&&m*S<=0&&v*C<=0}function Ll(u,s){let h=!1;for(let C=0,L=s.length;C<L;C++){const z=s[C];for(let O=0,H=z.length;O<H-1;O++){if(Dh(u,z[O],z[O+1]))return!1;(v=z[O])[1]>(m=u)[1]!=(S=z[O+1])[1]>m[1]&&m[0]<(S[0]-v[0])*(m[1]-v[1])/(S[1]-v[1])+v[0]&&(h=!h)}}var m,v,S;return h}function Fd(u,s){for(let h=0;h<s.length;h++)if(Ll(u,s[h]))return!0;return!1}function $h(u,s,h,m){const v=m[0]-h[0],S=m[1]-h[1],C=(u[0]-h[0])*S-v*(u[1]-h[1]),L=(s[0]-h[0])*S-v*(s[1]-h[1]);return C>0&&L<0||C<0&&L>0}function Bd(u,s,h){for(const O of h)for(let H=0;H<O.length-1;++H)if((L=[(C=O[H+1])[0]-(S=O[H])[0],C[1]-S[1]])[0]*(z=[(v=s)[0]-(m=u)[0],v[1]-m[1]])[1]-L[1]*z[0]!=0&&$h(m,v,S,C)&&$h(S,C,m,v))return!0;var m,v,S,C,L,z;return!1}function Rh(u,s){for(let h=0;h<u.length;++h)if(!Ll(u[h],s))return!1;for(let h=0;h<u.length-1;++h)if(Bd(u[h],u[h+1],s))return!1;return!0}function Fh(u,s){for(let h=0;h<s.length;h++)if(Rh(u,s[h]))return!0;return!1}function El(u,s,h){const m=[];for(let v=0;v<u.length;v++){const S=[];for(let C=0;C<u[v].length;C++){const L=Rd(u[v][C],h);Ml(s,L),S.push(L)}m.push(S)}return m}function Bh(u,s,h){const m=[];for(let v=0;v<u.length;v++){const S=El(u[v],s,h);m.push(S)}return m}function Oh(u,s,h,m){if(u[0]<h[0]||u[0]>h[2]){const v=.5*m;let S=u[0]-h[0]>v?-m:h[0]-u[0]>v?m:0;S===0&&(S=u[0]-h[2]>v?-m:h[2]-u[0]>v?m:0),u[0]+=S}Ml(s,u)}function Il(u,s,h,m){const v=Math.pow(2,m.z)*_s,S=[m.x*_s,m.y*_s],C=[];for(const L of u)for(const z of L){const O=[z.x+S[0],z.y+S[1]];Oh(O,s,h,v),C.push(O)}return C}function Nh(u,s,h,m){const v=Math.pow(2,m.z)*_s,S=[m.x*_s,m.y*_s],C=[];for(const z of u){const O=[];for(const H of z){const K=[H.x+S[0],H.y+S[1]];Ml(s,K),O.push(K)}C.push(O)}if(s[2]-s[0]<=v/2){(L=s)[0]=L[1]=1/0,L[2]=L[3]=-1/0;for(const z of C)for(const O of z)Oh(O,s,h,v)}var L;return C}class Es{constructor(s,h){this.type=Gt,this.geojson=s,this.geometries=h}static parse(s,h){if(s.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(kl(s[1])){const m=s[1];if(m.type==="FeatureCollection"){const v=[];for(const S of m.features){const{type:C,coordinates:L}=S.geometry;C==="Polygon"&&v.push(L),C==="MultiPolygon"&&v.push(...L)}if(v.length)return new Es(m,{type:"MultiPolygon",coordinates:v})}else if(m.type==="Feature"){const v=m.geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Es(m,m.geometry)}else if(m.type==="Polygon"||m.type==="MultiPolygon")return new Es(m,m)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(h,m){const v=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],C=h.canonicalID();if(m.type==="Polygon"){const L=El(m.coordinates,S,C),z=Il(h.geometry(),v,S,C);if(!Va(v,S))return!1;for(const O of z)if(!Ll(O,L))return!1}if(m.type==="MultiPolygon"){const L=Bh(m.coordinates,S,C),z=Il(h.geometry(),v,S,C);if(!Va(v,S))return!1;for(const O of z)if(!Fd(O,L))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(h,m){const v=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],C=h.canonicalID();if(m.type==="Polygon"){const L=El(m.coordinates,S,C),z=Nh(h.geometry(),v,S,C);if(!Va(v,S))return!1;for(const O of z)if(!Rh(O,L))return!1}if(m.type==="MultiPolygon"){const L=Bh(m.coordinates,S,C),z=Nh(h.geometry(),v,S,C);if(!Va(v,S))return!1;for(const O of z)if(!Fh(O,L))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Al{constructor(s,h){this.type=h.type,this.name=s,this.boundExpression=h}static parse(s,h){if(s.length!==2||typeof s[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const m=s[1];return h.scope.has(m)?new Al(m,h.scope.get(m)):h.error(`Unknown variable "${m}". Make sure "${m}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}}class Yi{constructor(s,h,m,v){this.name=s,this.type=h,this._evaluate=m,this.args=v}evaluate(s){return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}static parse(s,h){const m=s[0],v=Yi.definitions[m];if(!v)return h.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);const S=Array.isArray(v)?v[0]:v.type,C=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,L=C.filter(([O])=>!Array.isArray(O)||O.length===s.length-1);let z=null;for(const[O,H]of L){z=new Tl(h.registry,qa,h.path,null,h.scope);const K=[];let ie=!1;for(let ce=1;ce<s.length;ce++){const ge=s[ce],be=Array.isArray(O)?O[ce-1]:O.type,Te=z.parse(ge,1+K.length,be);if(!Te){ie=!0;break}K.push(Te)}if(!ie)if(Array.isArray(O)&&O.length!==K.length)z.error(`Expected ${O.length} arguments, but found ${K.length} instead.`);else{for(let ce=0;ce<K.length;ce++){const ge=Array.isArray(O)?O[ce]:O.type,be=K[ce];z.concat(ce+1).checkSubtype(ge,be.type)}if(z.errors.length===0)return new Yi(m,S,H,K)}}if(L.length===1)h.errors.push(...z.errors);else{const O=(L.length?L:C).map(([K])=>{return ie=K,Array.isArray(ie)?`(${ie.map(we).join(", ")})`:`(${we(ie.type)}...)`;var ie}).join(" | "),H=[];for(let K=1;K<s.length;K++){const ie=h.parse(s[K],1+H.length);if(!ie)return null;H.push(we(ie.type))}h.error(`Expected arguments of type ${O}, but found (${H.join(", ")}) instead.`)}return null}static register(s,h){Yi.definitions=h;for(const m in h)s[m]=Yi}}function qa(u){if(u instanceof Al)return qa(u.boundExpression);if(u instanceof Yi&&u.name==="error"||u instanceof ia||u instanceof Es)return!1;const s=u instanceof jo||u instanceof Ji;let h=!0;return u.eachChild(m=>{h=s?h&&qa(m):h&&m instanceof gs}),!!h&&Pl(u)&&Ga(u,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Pl(u){if(u instanceof Yi&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof Es)return!1;let s=!0;return u.eachChild(h=>{s&&!Pl(h)&&(s=!1)}),s}function Za(u){if(u instanceof Yi&&u.name==="feature-state")return!1;let s=!0;return u.eachChild(h=>{s&&!Za(h)&&(s=!1)}),s}function Ga(u,s){if(u instanceof Yi&&s.indexOf(u.name)>=0)return!1;let h=!0;return u.eachChild(m=>{h&&!Ga(m,s)&&(h=!1)}),h}function Ha(u,s){const h=u.length-1;let m,v,S=0,C=h,L=0;for(;S<=C;)if(L=Math.floor((S+C)/2),m=u[L],v=u[L+1],m<=s){if(L===h||s<v)return L;S=L+1}else{if(!(m>s))throw new Mr("Input is not a number.");C=L-1}return 0}class Wa{constructor(s,h,m){this.type=s,this.input=h,this.labels=[],this.outputs=[];for(const[v,S]of m)this.labels.push(v),this.outputs.push(S)}static parse(s,h){if(s.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return h.error("Expected an even number of arguments.");const m=h.parse(s[1],1,At);if(!m)return null;const v=[];let S=null;h.expectedType&&h.expectedType.kind!=="value"&&(S=h.expectedType);for(let C=1;C<s.length;C+=2){const L=C===1?-1/0:s[C],z=s[C+1],O=C,H=C+1;if(typeof L!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(v.length&&v[v.length-1][0]>=L)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',O);const K=h.parse(z,H,S);if(!K)return null;S=S||K.type,v.push([L,K])}return new Wa(S,m,v)}evaluate(s){const h=this.labels,m=this.outputs;if(h.length===1)return m[0].evaluate(s);const v=this.input.evaluate(s);if(v<=h[0])return m[0].evaluate(s);const S=h.length;return v>=h[S-1]?m[S-1].evaluate(s):m[Ha(h,v)].evaluate(s)}eachChild(s){s(this.input);for(const h of this.outputs)s(h)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Od(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var Nd=jh;function jh(u,s,h,m){this.cx=3*u,this.bx=3*(h-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(m-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=s,this.p2x=h,this.p2y=m}jh.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,s){if(s===void 0&&(s=1e-6),u<0)return 0;if(u>1)return 1;for(var h=u,m=0;m<8;m++){var v=this.sampleCurveX(h)-u;if(Math.abs(v)<s)return h;var S=this.sampleCurveDerivativeX(h);if(Math.abs(S)<1e-6)break;h-=v/S}var C=0,L=1;for(h=u,m=0;m<20&&(v=this.sampleCurveX(h),!(Math.abs(v-u)<s));m++)u>v?C=h:L=h,h=.5*(L-C)+C;return h},solve:function(u,s){return this.sampleCurveY(this.solveCurveX(u,s))}};var jd=Od(Nd);function Is(u,s,h){return u+h*(s-u)}function zl(u,s,h){return u.map((m,v)=>Is(m,s[v],h))}const Mi={number:Is,color:function(u,s,h,m="rgb"){switch(m){case"rgb":{const[v,S,C,L]=zl(u.rgb,s.rgb,h);return new rr(v,S,C,L,!1)}case"hcl":{const[v,S,C,L]=u.hcl,[z,O,H,K]=s.hcl;let ie,ce;if(isNaN(v)||isNaN(z))isNaN(v)?isNaN(z)?ie=NaN:(ie=z,C!==1&&C!==0||(ce=O)):(ie=v,H!==1&&H!==0||(ce=S));else{let Ze=z-v;z>v&&Ze>180?Ze-=360:z<v&&v-z>180&&(Ze+=360),ie=v+h*Ze}const[ge,be,Te,Ae]=function([Ze,Re,je,ut]){return Ze=isNaN(Ze)?0:Ze*fn,Pr([je,Math.cos(Ze)*Re,Math.sin(Ze)*Re,ut])}([ie,ce??Is(S,O,h),Is(C,H,h),Is(L,K,h)]);return new rr(ge,be,Te,Ae,!1)}case"lab":{const[v,S,C,L]=Pr(zl(u.lab,s.lab,h));return new rr(v,S,C,L,!1)}}},array:zl,padding:function(u,s,h){return new $i(zl(u.values,s.values,h))},variableAnchorOffsetCollection:function(u,s,h){const m=u.values,v=s.values;if(m.length!==v.length)throw new Mr(`Cannot interpolate values of different length. from: ${u.toString()}, to: ${s.toString()}`);const S=[];for(let C=0;C<m.length;C+=2){if(m[C]!==v[C])throw new Mr(`Cannot interpolate values containing mismatched anchors. from[${C}]: ${m[C]}, to[${C}]: ${v[C]}`);S.push(m[C]);const[L,z]=m[C+1],[O,H]=v[C+1];S.push([Is(L,O,h),Is(z,H,h)])}return new ho(S)}};class vi{constructor(s,h,m,v,S){this.type=s,this.operator=h,this.interpolation=m,this.input=v,this.labels=[],this.outputs=[];for(const[C,L]of S)this.labels.push(C),this.outputs.push(L)}static interpolationFactor(s,h,m,v){let S=0;if(s.name==="exponential")S=Zn(h,s.base,m,v);else if(s.name==="linear")S=Zn(h,1,m,v);else if(s.name==="cubic-bezier"){const C=s.controlPoints;S=new jd(C[0],C[1],C[2],C[3]).solve(Zn(h,1,m,v))}return S}static parse(s,h){let[m,v,S,...C]=s;if(!Array.isArray(v)||v.length===0)return h.error("Expected an interpolation type expression.",1);if(v[0]==="linear")v={name:"linear"};else if(v[0]==="exponential"){const O=v[1];if(typeof O!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);v={name:"exponential",base:O}}else{if(v[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(v[0])}`,1,0);{const O=v.slice(1);if(O.length!==4||O.some(H=>typeof H!="number"||H<0||H>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);v={name:"cubic-bezier",controlPoints:O}}}if(s.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(S=h.parse(S,2,At),!S)return null;const L=[];let z=null;m==="interpolate-hcl"||m==="interpolate-lab"?z=Qn:h.expectedType&&h.expectedType.kind!=="value"&&(z=h.expectedType);for(let O=0;O<C.length;O+=2){const H=C[O],K=C[O+1],ie=O+3,ce=O+4;if(typeof H!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ie);if(L.length&&L[L.length-1][0]>=H)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ie);const ge=h.parse(K,ce,z);if(!ge)return null;z=z||ge.type,L.push([H,ge])}return re(z,At)||re(z,Qn)||re(z,Ce)||re(z,ne)||re(z,le(At))?new vi(z,m,v,S,L):h.error(`Type ${we(z)} is not interpolatable.`)}evaluate(s){const h=this.labels,m=this.outputs;if(h.length===1)return m[0].evaluate(s);const v=this.input.evaluate(s);if(v<=h[0])return m[0].evaluate(s);const S=h.length;if(v>=h[S-1])return m[S-1].evaluate(s);const C=Ha(h,v),L=vi.interpolationFactor(this.interpolation,v,h[C],h[C+1]),z=m[C].evaluate(s),O=m[C+1].evaluate(s);switch(this.operator){case"interpolate":return Mi[this.type.kind](z,O,L);case"interpolate-hcl":return Mi.color(z,O,L,"hcl");case"interpolate-lab":return Mi.color(z,O,L,"lab")}}eachChild(s){s(this.input);for(const h of this.outputs)s(h)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Zn(u,s,h,m){const v=m-h,S=u-h;return v===0?0:s===1?S/v:(Math.pow(s,S)-1)/(Math.pow(s,v)-1)}class Dl{constructor(s,h){this.type=s,this.args=h}static parse(s,h){if(s.length<2)return h.error("Expectected at least one argument.");let m=null;const v=h.expectedType;v&&v.kind!=="value"&&(m=v);const S=[];for(const L of s.slice(1)){const z=h.parse(L,1+S.length,m,void 0,{typeAnnotation:"omit"});if(!z)return null;m=m||z.type,S.push(z)}if(!m)throw new Error("No output type");const C=v&&S.some(L=>Oe(v,L.type));return new Dl(C?sn:m,S)}evaluate(s){let h,m=null,v=0;for(const S of this.args)if(v++,m=S.evaluate(s),m&&m instanceof fo&&!m.available&&(h||(h=m.name),m=null,v===this.args.length&&(m=h)),m!==null)break;return m}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}class $l{constructor(s,h){this.type=h.type,this.bindings=[].concat(s),this.result=h}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const h of this.bindings)s(h[1]);s(this.result)}static parse(s,h){if(s.length<4)return h.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const m=[];for(let S=1;S<s.length-1;S+=2){const C=s[S];if(typeof C!="string")return h.error(`Expected string, but found ${typeof C} instead.`,S);if(/[^a-zA-Z0-9_]/.test(C))return h.error("Variable names must contain only alphanumeric characters or '_'.",S);const L=h.parse(s[S+1],S+1);if(!L)return null;m.push([C,L])}const v=h.parse(s[s.length-1],s.length-1,h.expectedType,m);return v?new $l(m,v):null}outputDefined(){return this.result.outputDefined()}}class Vc{constructor(s,h,m){this.type=s,this.index=h,this.input=m}static parse(s,h){if(s.length!==3)return h.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const m=h.parse(s[1],1,At),v=h.parse(s[2],2,le(h.expectedType||sn));return m&&v?new Vc(v.type.itemType,m,v):null}evaluate(s){const h=this.index.evaluate(s),m=this.input.evaluate(s);if(h<0)throw new Mr(`Array index out of bounds: ${h} < 0.`);if(h>=m.length)throw new Mr(`Array index out of bounds: ${h} > ${m.length-1}.`);if(h!==Math.floor(h))throw new Mr(`Array index must be an integer, but found ${h} instead.`);return m[h]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}}class qc{constructor(s,h){this.type=Gt,this.needle=s,this.haystack=h}static parse(s,h){if(s.length!==3)return h.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const m=h.parse(s[1],1,sn),v=h.parse(s[2],2,sn);return m&&v?qe(m.type,[Gt,pn,At,Yn,sn])?new qc(m,v):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${we(m.type)} instead`):null}evaluate(s){const h=this.needle.evaluate(s),m=this.haystack.evaluate(s);if(!m)return!1;if(!De(h,["boolean","string","number","null"]))throw new Mr(`Expected first argument to be of type boolean, string, number or null, but found ${we(Zr(h))} instead.`);if(!De(m,["string","array"]))throw new Mr(`Expected second argument to be of type array or string, but found ${we(Zr(m))} instead.`);return m.indexOf(h)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}}class Rl{constructor(s,h,m){this.type=At,this.needle=s,this.haystack=h,this.fromIndex=m}static parse(s,h){if(s.length<=2||s.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const m=h.parse(s[1],1,sn),v=h.parse(s[2],2,sn);if(!m||!v)return null;if(!qe(m.type,[Gt,pn,At,Yn,sn]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${we(m.type)} instead`);if(s.length===4){const S=h.parse(s[3],3,At);return S?new Rl(m,v,S):null}return new Rl(m,v)}evaluate(s){const h=this.needle.evaluate(s),m=this.haystack.evaluate(s);if(!De(h,["boolean","string","number","null"]))throw new Mr(`Expected first argument to be of type boolean, string, number or null, but found ${we(Zr(h))} instead.`);if(!De(m,["string","array"]))throw new Mr(`Expected second argument to be of type array or string, but found ${we(Zr(m))} instead.`);if(this.fromIndex){const v=this.fromIndex.evaluate(s);return m.indexOf(h,v)}return m.indexOf(h)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}}class Zc{constructor(s,h,m,v,S,C){this.inputType=s,this.type=h,this.input=m,this.cases=v,this.outputs=S,this.otherwise=C}static parse(s,h){if(s.length<5)return h.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return h.error("Expected an even number of arguments.");let m,v;h.expectedType&&h.expectedType.kind!=="value"&&(v=h.expectedType);const S={},C=[];for(let O=2;O<s.length-1;O+=2){let H=s[O];const K=s[O+1];Array.isArray(H)||(H=[H]);const ie=h.concat(O);if(H.length===0)return ie.error("Expected at least one branch label.");for(const ge of H){if(typeof ge!="number"&&typeof ge!="string")return ie.error("Branch labels must be numbers or strings.");if(typeof ge=="number"&&Math.abs(ge)>Number.MAX_SAFE_INTEGER)return ie.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ge=="number"&&Math.floor(ge)!==ge)return ie.error("Numeric branch labels must be integer values.");if(m){if(ie.checkSubtype(m,Zr(ge)))return null}else m=Zr(ge);if(S[String(ge)]!==void 0)return ie.error("Branch labels must be unique.");S[String(ge)]=C.length}const ce=h.parse(K,O,v);if(!ce)return null;v=v||ce.type,C.push(ce)}const L=h.parse(s[1],1,sn);if(!L)return null;const z=h.parse(s[s.length-1],s.length-1,v);return z?L.type.kind!=="value"&&h.concat(1).checkSubtype(m,L.type)?null:new Zc(m,v,L,S,C,z):null}evaluate(s){const h=this.input.evaluate(s);return(Zr(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}}class Gc{constructor(s,h,m){this.type=s,this.branches=h,this.otherwise=m}static parse(s,h){if(s.length<4)return h.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return h.error("Expected an odd number of arguments.");let m;h.expectedType&&h.expectedType.kind!=="value"&&(m=h.expectedType);const v=[];for(let C=1;C<s.length-1;C+=2){const L=h.parse(s[C],C,Gt);if(!L)return null;const z=h.parse(s[C+1],C+1,m);if(!z)return null;v.push([L,z]),m=m||z.type}const S=h.parse(s[s.length-1],s.length-1,m);if(!S)return null;if(!m)throw new Error("Can't infer output type");return new Gc(m,v,S)}evaluate(s){for(const[h,m]of this.branches)if(h.evaluate(s))return m.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[h,m]of this.branches)s(h),s(m);s(this.otherwise)}outputDefined(){return this.branches.every(([s,h])=>h.outputDefined())&&this.otherwise.outputDefined()}}class Fl{constructor(s,h,m,v){this.type=s,this.input=h,this.beginIndex=m,this.endIndex=v}static parse(s,h){if(s.length<=2||s.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const m=h.parse(s[1],1,sn),v=h.parse(s[2],2,At);if(!m||!v)return null;if(!qe(m.type,[le(sn),pn,sn]))return h.error(`Expected first argument to be of type array or string, but found ${we(m.type)} instead`);if(s.length===4){const S=h.parse(s[3],3,At);return S?new Fl(m.type,m,v,S):null}return new Fl(m.type,m,v)}evaluate(s){const h=this.input.evaluate(s),m=this.beginIndex.evaluate(s);if(!De(h,["string","array"]))throw new Mr(`Expected first argument to be of type array or string, but found ${we(Zr(h))} instead.`);if(this.endIndex){const v=this.endIndex.evaluate(s);return h.slice(m,v)}return h.slice(m)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}}function Uh(u,s){return u==="=="||u==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function Vh(u,s,h,m){return m.compare(s,h)===0}function oa(u,s,h){const m=u!=="=="&&u!=="!=";return class Lb{constructor(S,C,L){this.type=Gt,this.lhs=S,this.rhs=C,this.collator=L,this.hasUntypedArgument=S.type.kind==="value"||C.type.kind==="value"}static parse(S,C){if(S.length!==3&&S.length!==4)return C.error("Expected two or three arguments.");const L=S[0];let z=C.parse(S[1],1,sn);if(!z)return null;if(!Uh(L,z.type))return C.concat(1).error(`"${L}" comparisons are not supported for type '${we(z.type)}'.`);let O=C.parse(S[2],2,sn);if(!O)return null;if(!Uh(L,O.type))return C.concat(2).error(`"${L}" comparisons are not supported for type '${we(O.type)}'.`);if(z.type.kind!==O.type.kind&&z.type.kind!=="value"&&O.type.kind!=="value")return C.error(`Cannot compare types '${we(z.type)}' and '${we(O.type)}'.`);m&&(z.type.kind==="value"&&O.type.kind!=="value"?z=new Ji(O.type,[z]):z.type.kind!=="value"&&O.type.kind==="value"&&(O=new Ji(z.type,[O])));let H=null;if(S.length===4){if(z.type.kind!=="string"&&O.type.kind!=="string"&&z.type.kind!=="value"&&O.type.kind!=="value")return C.error("Cannot use collator to compare non-string types.");if(H=C.parse(S[3],3,zi),!H)return null}return new Lb(z,O,H)}evaluate(S){const C=this.lhs.evaluate(S),L=this.rhs.evaluate(S);if(m&&this.hasUntypedArgument){const z=Zr(C),O=Zr(L);if(z.kind!==O.kind||z.kind!=="string"&&z.kind!=="number")throw new Mr(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${z.kind}, ${O.kind}) instead.`)}if(this.collator&&!m&&this.hasUntypedArgument){const z=Zr(C),O=Zr(L);if(z.kind!=="string"||O.kind!=="string")return s(S,C,L)}return this.collator?h(S,C,L,this.collator.evaluate(S)):s(S,C,L)}eachChild(S){S(this.lhs),S(this.rhs),this.collator&&S(this.collator)}outputDefined(){return!0}}}const Ud=oa("==",function(u,s,h){return s===h},Vh),Vd=oa("!=",function(u,s,h){return s!==h},function(u,s,h,m){return!Vh(0,s,h,m)}),qd=oa("<",function(u,s,h){return s<h},function(u,s,h,m){return m.compare(s,h)<0}),Zd=oa(">",function(u,s,h){return s>h},function(u,s,h,m){return m.compare(s,h)>0}),Gd=oa("<=",function(u,s,h){return s<=h},function(u,s,h,m){return m.compare(s,h)<=0}),Hd=oa(">=",function(u,s,h){return s>=h},function(u,s,h,m){return m.compare(s,h)>=0});class Hc{constructor(s,h,m,v,S){this.type=pn,this.number=s,this.locale=h,this.currency=m,this.minFractionDigits=v,this.maxFractionDigits=S}static parse(s,h){if(s.length!==3)return h.error("Expected two arguments.");const m=h.parse(s[1],1,At);if(!m)return null;const v=s[2];if(typeof v!="object"||Array.isArray(v))return h.error("NumberFormat options argument must be an object.");let S=null;if(v.locale&&(S=h.parse(v.locale,1,pn),!S))return null;let C=null;if(v.currency&&(C=h.parse(v.currency,1,pn),!C))return null;let L=null;if(v["min-fraction-digits"]&&(L=h.parse(v["min-fraction-digits"],1,At),!L))return null;let z=null;return v["max-fraction-digits"]&&(z=h.parse(v["max-fraction-digits"],1,At),!z)?null:new Hc(m,S,C,L,z)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}}class Bl{constructor(s){this.type=er,this.sections=s}static parse(s,h){if(s.length<2)return h.error("Expected at least one argument.");const m=s[1];if(!Array.isArray(m)&&typeof m=="object")return h.error("First argument must be an image or text section.");const v=[];let S=!1;for(let C=1;C<=s.length-1;++C){const L=s[C];if(S&&typeof L=="object"&&!Array.isArray(L)){S=!1;let z=null;if(L["font-scale"]&&(z=h.parse(L["font-scale"],1,At),!z))return null;let O=null;if(L["text-font"]&&(O=h.parse(L["text-font"],1,le(pn)),!O))return null;let H=null;if(L["text-color"]&&(H=h.parse(L["text-color"],1,Qn),!H))return null;const K=v[v.length-1];K.scale=z,K.font=O,K.textColor=H}else{const z=h.parse(s[C],1,sn);if(!z)return null;const O=z.type.kind;if(O!=="string"&&O!=="value"&&O!=="null"&&O!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");S=!0,v.push({content:z,scale:null,font:null,textColor:null})}}return new Bl(v)}evaluate(s){return new Xi(this.sections.map(h=>{const m=h.content.evaluate(s);return Zr(m)===te?new Uc("",m,null,null,null):new Uc(ja(m),null,h.scale?h.scale.evaluate(s):null,h.font?h.font.evaluate(s).join(","):null,h.textColor?h.textColor.evaluate(s):null)}))}eachChild(s){for(const h of this.sections)s(h.content),h.scale&&s(h.scale),h.font&&s(h.font),h.textColor&&s(h.textColor)}outputDefined(){return!1}}class Wc{constructor(s){this.type=te,this.input=s}static parse(s,h){if(s.length!==2)return h.error("Expected two arguments.");const m=h.parse(s[1],1,pn);return m?new Wc(m):h.error("No image name provided.")}evaluate(s){const h=this.input.evaluate(s),m=fo.fromString(h);return m&&s.availableImages&&(m.available=s.availableImages.indexOf(h)>-1),m}eachChild(s){s(this.input)}outputDefined(){return!1}}class Kc{constructor(s){this.type=At,this.input=s}static parse(s,h){if(s.length!==2)return h.error(`Expected 1 argument, but found ${s.length-1} instead.`);const m=h.parse(s[1],1);return m?m.type.kind!=="array"&&m.type.kind!=="string"&&m.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${we(m.type)} instead.`):new Kc(m):null}evaluate(s){const h=this.input.evaluate(s);if(typeof h=="string"||Array.isArray(h))return h.length;throw new Mr(`Expected value to be of type string or array, but found ${we(Zr(h))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}}const sa={"==":Ud,"!=":Vd,">":Zd,"<":qd,">=":Hd,"<=":Gd,array:Ji,at:Vc,boolean:Ji,case:Gc,coalesce:Dl,collator:ia,format:Bl,image:Wc,in:qc,"index-of":Rl,interpolate:vi,"interpolate-hcl":vi,"interpolate-lab":vi,length:Kc,let:$l,literal:gs,match:Zc,number:Ji,"number-format":Hc,object:Ji,slice:Fl,step:Wa,string:Ji,"to-boolean":jo,"to-color":jo,"to-number":jo,"to-string":jo,var:Al,within:Es};function qh(u,[s,h,m,v]){s=s.evaluate(u),h=h.evaluate(u),m=m.evaluate(u);const S=v?v.evaluate(u):1,C=ra(s,h,m,S);if(C)throw new Mr(C);return new rr(s/255,h/255,m/255,S,!1)}function Zh(u,s){return u in s}function Xc(u,s){const h=s[u];return h===void 0?null:h}function As(u){return{type:u}}function Gh(u){return{result:"success",value:u}}function aa(u){return{result:"error",value:u}}function la(u){return u["property-type"]==="data-driven"||u["property-type"]==="cross-faded-data-driven"}function Hh(u){return!!u.expression&&u.expression.parameters.indexOf("zoom")>-1}function Jc(u){return!!u.expression&&u.expression.interpolated}function Vn(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}function Ol(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function Wd(u){return u}function Wh(u,s){const h=s.type==="color",m=u.stops&&typeof u.stops[0][0]=="object",v=m||!(m||u.property!==void 0),S=u.type||(Jc(s)?"exponential":"interval");if(h||s.type==="padding"){const H=h?rr.parse:$i.parse;(u=wr({},u)).stops&&(u.stops=u.stops.map(K=>[K[0],H(K[1])])),u.default=H(u.default?u.default:s.default)}if(u.colorSpace&&(C=u.colorSpace)!=="rgb"&&C!=="hcl"&&C!=="lab")throw new Error(`Unknown color space: "${u.colorSpace}"`);var C;let L,z,O;if(S==="exponential")L=Nn;else if(S==="interval")L=Kd;else if(S==="categorical"){L=jr,z=Object.create(null);for(const H of u.stops)z[H[0]]=H[1];O=typeof u.stops[0][0]}else{if(S!=="identity")throw new Error(`Unknown function type "${S}"`);L=Yc}if(m){const H={},K=[];for(let ge=0;ge<u.stops.length;ge++){const be=u.stops[ge],Te=be[0].zoom;H[Te]===void 0&&(H[Te]={zoom:Te,type:u.type,property:u.property,default:u.default,stops:[]},K.push(Te)),H[Te].stops.push([be[0].value,be[1]])}const ie=[];for(const ge of K)ie.push([H[ge].zoom,Wh(H[ge],s)]);const ce={name:"linear"};return{kind:"composite",interpolationType:ce,interpolationFactor:vi.interpolationFactor.bind(void 0,ce),zoomStops:ie.map(ge=>ge[0]),evaluate:({zoom:ge},be)=>Nn({stops:ie,base:u.base},s,ge).evaluate(ge,be)}}if(v){const H=S==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:H,interpolationFactor:vi.interpolationFactor.bind(void 0,H),zoomStops:u.stops.map(K=>K[0]),evaluate:({zoom:K})=>L(u,s,K,z,O)}}return{kind:"source",evaluate(H,K){const ie=K&&K.properties?K.properties[u.property]:void 0;return ie===void 0?Ka(u.default,s.default):L(u,s,ie,z,O)}}}function Ka(u,s,h){return u!==void 0?u:s!==void 0?s:h!==void 0?h:void 0}function jr(u,s,h,m,v){return Ka(typeof h===v?m[h]:void 0,u.default,s.default)}function Kd(u,s,h){if(Vn(h)!=="number")return Ka(u.default,s.default);const m=u.stops.length;if(m===1||h<=u.stops[0][0])return u.stops[0][1];if(h>=u.stops[m-1][0])return u.stops[m-1][1];const v=Ha(u.stops.map(S=>S[0]),h);return u.stops[v][1]}function Nn(u,s,h){const m=u.base!==void 0?u.base:1;if(Vn(h)!=="number")return Ka(u.default,s.default);const v=u.stops.length;if(v===1||h<=u.stops[0][0])return u.stops[0][1];if(h>=u.stops[v-1][0])return u.stops[v-1][1];const S=Ha(u.stops.map(H=>H[0]),h),C=function(H,K,ie,ce){const ge=ce-ie,be=H-ie;return ge===0?0:K===1?be/ge:(Math.pow(K,be)-1)/(Math.pow(K,ge)-1)}(h,m,u.stops[S][0],u.stops[S+1][0]),L=u.stops[S][1],z=u.stops[S+1][1],O=Mi[s.type]||Wd;return typeof L.evaluate=="function"?{evaluate(...H){const K=L.evaluate.apply(void 0,H),ie=z.evaluate.apply(void 0,H);if(K!==void 0&&ie!==void 0)return O(K,ie,C,u.colorSpace)}}:O(L,z,C,u.colorSpace)}function Yc(u,s,h){switch(s.type){case"color":h=rr.parse(h);break;case"formatted":h=Xi.fromString(h.toString());break;case"resolvedImage":h=fo.fromString(h.toString());break;case"padding":h=$i.parse(h);break;default:Vn(h)===s.type||s.type==="enum"&&s.values[h]||(h=void 0)}return Ka(h,u.default,s.default)}Yi.register(sa,{error:[{kind:"error"},[pn],(u,[s])=>{throw new Mr(s.evaluate(u))}],typeof:[pn,[sn],(u,[s])=>we(Zr(s.evaluate(u)))],"to-rgba":[le(At,4),[Qn],(u,[s])=>{const[h,m,v,S]=s.evaluate(u).rgb;return[255*h,255*m,255*v,S]}],rgb:[Qn,[At,At,At],qh],rgba:[Qn,[At,At,At,At],qh],has:{type:Gt,overloads:[[[pn],(u,[s])=>Zh(s.evaluate(u),u.properties())],[[pn,mi],(u,[s,h])=>Zh(s.evaluate(u),h.evaluate(u))]]},get:{type:sn,overloads:[[[pn],(u,[s])=>Xc(s.evaluate(u),u.properties())],[[pn,mi],(u,[s,h])=>Xc(s.evaluate(u),h.evaluate(u))]]},"feature-state":[sn,[pn],(u,[s])=>Xc(s.evaluate(u),u.featureState||{})],properties:[mi,[],u=>u.properties()],"geometry-type":[pn,[],u=>u.geometryType()],id:[sn,[],u=>u.id()],zoom:[At,[],u=>u.globals.zoom],"heatmap-density":[At,[],u=>u.globals.heatmapDensity||0],"line-progress":[At,[],u=>u.globals.lineProgress||0],accumulated:[sn,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[At,As(At),(u,s)=>{let h=0;for(const m of s)h+=m.evaluate(u);return h}],"*":[At,As(At),(u,s)=>{let h=1;for(const m of s)h*=m.evaluate(u);return h}],"-":{type:At,overloads:[[[At,At],(u,[s,h])=>s.evaluate(u)-h.evaluate(u)],[[At],(u,[s])=>-s.evaluate(u)]]},"/":[At,[At,At],(u,[s,h])=>s.evaluate(u)/h.evaluate(u)],"%":[At,[At,At],(u,[s,h])=>s.evaluate(u)%h.evaluate(u)],ln2:[At,[],()=>Math.LN2],pi:[At,[],()=>Math.PI],e:[At,[],()=>Math.E],"^":[At,[At,At],(u,[s,h])=>Math.pow(s.evaluate(u),h.evaluate(u))],sqrt:[At,[At],(u,[s])=>Math.sqrt(s.evaluate(u))],log10:[At,[At],(u,[s])=>Math.log(s.evaluate(u))/Math.LN10],ln:[At,[At],(u,[s])=>Math.log(s.evaluate(u))],log2:[At,[At],(u,[s])=>Math.log(s.evaluate(u))/Math.LN2],sin:[At,[At],(u,[s])=>Math.sin(s.evaluate(u))],cos:[At,[At],(u,[s])=>Math.cos(s.evaluate(u))],tan:[At,[At],(u,[s])=>Math.tan(s.evaluate(u))],asin:[At,[At],(u,[s])=>Math.asin(s.evaluate(u))],acos:[At,[At],(u,[s])=>Math.acos(s.evaluate(u))],atan:[At,[At],(u,[s])=>Math.atan(s.evaluate(u))],min:[At,As(At),(u,s)=>Math.min(...s.map(h=>h.evaluate(u)))],max:[At,As(At),(u,s)=>Math.max(...s.map(h=>h.evaluate(u)))],abs:[At,[At],(u,[s])=>Math.abs(s.evaluate(u))],round:[At,[At],(u,[s])=>{const h=s.evaluate(u);return h<0?-Math.round(-h):Math.round(h)}],floor:[At,[At],(u,[s])=>Math.floor(s.evaluate(u))],ceil:[At,[At],(u,[s])=>Math.ceil(s.evaluate(u))],"filter-==":[Gt,[pn,sn],(u,[s,h])=>u.properties()[s.value]===h.value],"filter-id-==":[Gt,[sn],(u,[s])=>u.id()===s.value],"filter-type-==":[Gt,[pn],(u,[s])=>u.geometryType()===s.value],"filter-<":[Gt,[pn,sn],(u,[s,h])=>{const m=u.properties()[s.value],v=h.value;return typeof m==typeof v&&m<v}],"filter-id-<":[Gt,[sn],(u,[s])=>{const h=u.id(),m=s.value;return typeof h==typeof m&&h<m}],"filter->":[Gt,[pn,sn],(u,[s,h])=>{const m=u.properties()[s.value],v=h.value;return typeof m==typeof v&&m>v}],"filter-id->":[Gt,[sn],(u,[s])=>{const h=u.id(),m=s.value;return typeof h==typeof m&&h>m}],"filter-<=":[Gt,[pn,sn],(u,[s,h])=>{const m=u.properties()[s.value],v=h.value;return typeof m==typeof v&&m<=v}],"filter-id-<=":[Gt,[sn],(u,[s])=>{const h=u.id(),m=s.value;return typeof h==typeof m&&h<=m}],"filter->=":[Gt,[pn,sn],(u,[s,h])=>{const m=u.properties()[s.value],v=h.value;return typeof m==typeof v&&m>=v}],"filter-id->=":[Gt,[sn],(u,[s])=>{const h=u.id(),m=s.value;return typeof h==typeof m&&h>=m}],"filter-has":[Gt,[sn],(u,[s])=>s.value in u.properties()],"filter-has-id":[Gt,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[Gt,[le(pn)],(u,[s])=>s.value.indexOf(u.geometryType())>=0],"filter-id-in":[Gt,[le(sn)],(u,[s])=>s.value.indexOf(u.id())>=0],"filter-in-small":[Gt,[pn,le(sn)],(u,[s,h])=>h.value.indexOf(u.properties()[s.value])>=0],"filter-in-large":[Gt,[pn,le(sn)],(u,[s,h])=>function(m,v,S,C){for(;S<=C;){const L=S+C>>1;if(v[L]===m)return!0;v[L]>m?C=L-1:S=L+1}return!1}(u.properties()[s.value],h.value,0,h.value.length-1)],all:{type:Gt,overloads:[[[Gt,Gt],(u,[s,h])=>s.evaluate(u)&&h.evaluate(u)],[As(Gt),(u,s)=>{for(const h of s)if(!h.evaluate(u))return!1;return!0}]]},any:{type:Gt,overloads:[[[Gt,Gt],(u,[s,h])=>s.evaluate(u)||h.evaluate(u)],[As(Gt),(u,s)=>{for(const h of s)if(h.evaluate(u))return!0;return!1}]]},"!":[Gt,[Gt],(u,[s])=>!s.evaluate(u)],"is-supported-script":[Gt,[pn],(u,[s])=>{const h=u.globals&&u.globals.isSupportedScript;return!h||h(s.evaluate(u))}],upcase:[pn,[pn],(u,[s])=>s.evaluate(u).toUpperCase()],downcase:[pn,[pn],(u,[s])=>s.evaluate(u).toLowerCase()],concat:[pn,As(sn),(u,s)=>s.map(h=>ja(h.evaluate(u))).join("")],"resolved-locale":[pn,[zi],(u,[s])=>s.evaluate(u).resolvedLocale()]});class gr{constructor(s,h){var m;this.expression=s,this._warningHistory={},this._evaluator=new ir,this._defaultValue=h?(m=h).type==="color"&&Ol(m.default)?new rr(0,0,0,0):m.type==="color"?rr.parse(m.default)||null:m.type==="padding"?$i.parse(m.default)||null:m.type==="variableAnchorOffsetCollection"?ho.parse(m.default)||null:m.default===void 0?null:m.default:null,this._enumValues=h&&h.type==="enum"?h.values:null}evaluateWithoutErrorHandling(s,h,m,v,S,C){return this._evaluator.globals=s,this._evaluator.feature=h,this._evaluator.featureState=m,this._evaluator.canonical=v,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=C,this.expression.evaluate(this._evaluator)}evaluate(s,h,m,v,S,C){this._evaluator.globals=s,this._evaluator.feature=h||null,this._evaluator.featureState=m||null,this._evaluator.canonical=v,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=C||null;try{const L=this.expression.evaluate(this._evaluator);if(L==null||typeof L=="number"&&L!=L)return this._defaultValue;if(this._enumValues&&!(L in this._enumValues))throw new Mr(`Expected value to be one of ${Object.keys(this._enumValues).map(z=>JSON.stringify(z)).join(", ")}, but found ${JSON.stringify(L)} instead.`);return L}catch(L){return this._warningHistory[L.message]||(this._warningHistory[L.message]=!0,typeof console<"u"&&console.warn(L.message)),this._defaultValue}}}function hr(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in sa}function Ps(u,s){const h=new Tl(sa,qa,[],s?function(v){const S={color:Qn,string:pn,number:At,enum:pn,boolean:Gt,formatted:er,padding:Ce,resolvedImage:te,variableAnchorOffsetCollection:ne};return v.type==="array"?le(S[v.value]||sn,v.length):S[v.type]}(s):void 0),m=h.parse(u,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?Gh(new gr(m,s)):aa(h.errors)}class Nl{constructor(s,h){this.kind=s,this._styleExpression=h,this.isStateDependent=s!=="constant"&&!Za(h.expression)}evaluateWithoutErrorHandling(s,h,m,v,S,C){return this._styleExpression.evaluateWithoutErrorHandling(s,h,m,v,S,C)}evaluate(s,h,m,v,S,C){return this._styleExpression.evaluate(s,h,m,v,S,C)}}class Qc{constructor(s,h,m,v){this.kind=s,this.zoomStops=m,this._styleExpression=h,this.isStateDependent=s!=="camera"&&!Za(h.expression),this.interpolationType=v}evaluateWithoutErrorHandling(s,h,m,v,S,C){return this._styleExpression.evaluateWithoutErrorHandling(s,h,m,v,S,C)}evaluate(s,h,m,v,S,C){return this._styleExpression.evaluate(s,h,m,v,S,C)}interpolationFactor(s,h,m){return this.interpolationType?vi.interpolationFactor(this.interpolationType,s,h,m):0}}function Kh(u,s){const h=Ps(u,s);if(h.result==="error")return h;const m=h.value.expression,v=Pl(m);if(!v&&!la(s))return aa([new Tr("","data expressions not supported")]);const S=Ga(m,["zoom"]);if(!S&&!Hh(s))return aa([new Tr("","zoom expressions not supported")]);const C=Ul(m);return C||S?C instanceof Tr?aa([C]):C instanceof vi&&!Jc(s)?aa([new Tr("",'"interpolate" expressions cannot be used with this property')]):Gh(C?new Qc(v?"camera":"composite",h.value,C.labels,C instanceof vi?C.interpolation:void 0):new Nl(v?"constant":"source",h.value)):aa([new Tr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class jl{constructor(s,h){this._parameters=s,this._specification=h,wr(this,Wh(this._parameters,this._specification))}static deserialize(s){return new jl(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function Ul(u){let s=null;if(u instanceof $l)s=Ul(u.result);else if(u instanceof Dl){for(const h of u.args)if(s=Ul(h),s)break}else(u instanceof Wa||u instanceof vi)&&u.input instanceof Yi&&u.input.name==="zoom"&&(s=u);return s instanceof Tr||u.eachChild(h=>{const m=Ul(h);m instanceof Tr?s=m:!s&&m?s=new Tr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):s&&m&&s!==m&&(s=new Tr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}function Vl(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const s of u.slice(1))if(!Vl(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}const Xh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ql(u){if(u==null)return{filter:()=>!0,needGeometry:!1};Vl(u)||(u=Gl(u));const s=Ps(u,Xh);if(s.result==="error")throw new Error(s.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,m,v)=>s.value.evaluate(h,m,{},v),needGeometry:Zl(u)}}function Jh(u,s){return u<s?-1:u>s?1:0}function Zl(u){if(!Array.isArray(u))return!1;if(u[0]==="within")return!0;for(let s=1;s<u.length;s++)if(Zl(u[s]))return!0;return!1}function Gl(u){if(!u)return!0;const s=u[0];return u.length<=1?s!=="any":s==="=="?eu(u[1],u[2],"=="):s==="!="?Hl(eu(u[1],u[2],"==")):s==="<"||s===">"||s==="<="||s===">="?eu(u[1],u[2],s):s==="any"?(h=u.slice(1),["any"].concat(h.map(Gl))):s==="all"?["all"].concat(u.slice(1).map(Gl)):s==="none"?["all"].concat(u.slice(1).map(Gl).map(Hl)):s==="in"?Yh(u[1],u.slice(2)):s==="!in"?Hl(Yh(u[1],u.slice(2))):s==="has"?Qh(u[1]):s==="!has"?Hl(Qh(u[1])):s!=="within"||u;var h}function eu(u,s,h){switch(u){case"$type":return[`filter-type-${h}`,s];case"$id":return[`filter-id-${h}`,s];default:return[`filter-${h}`,u,s]}}function Yh(u,s){if(s.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(h=>typeof h!=typeof s[0])?["filter-in-large",u,["literal",s.sort(Jh)]]:["filter-in-small",u,["literal",s]]}}function Qh(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function Hl(u){return["!",u]}function tu(u){const s=typeof u;if(s==="number"||s==="boolean"||s==="string"||u==null)return JSON.stringify(u);if(Array.isArray(u)){let v="[";for(const S of u)v+=`${tu(S)},`;return`${v}]`}const h=Object.keys(u).sort();let m="{";for(let v=0;v<h.length;v++)m+=`${JSON.stringify(h[v])}:${tu(u[h[v]])},`;return`${m}}`}function Xd(u){let s="";for(const h of vn)s+=`/${tu(u[h])}`;return s}function ef(u){const s=u.value;return s?[new yt(u.key,s,"constants have been deprecated as of v8")]:[]}function zr(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function ys(u){if(Array.isArray(u))return u.map(ys);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const s={};for(const h in u)s[h]=ys(u[h]);return s}return zr(u)}function Li(u){const s=u.key,h=u.value,m=u.valueSpec||{},v=u.objectElementValidators||{},S=u.style,C=u.styleSpec,L=u.validateSpec;let z=[];const O=Vn(h);if(O!=="object")return[new yt(s,h,`object expected, ${O} found`)];for(const H in h){const K=H.split(".")[0],ie=m[K]||m["*"];let ce;if(v[K])ce=v[K];else if(m[K])ce=L;else if(v["*"])ce=v["*"];else{if(!m["*"]){z.push(new yt(s,h[H],`unknown property "${H}"`));continue}ce=L}z=z.concat(ce({key:(s&&`${s}.`)+H,value:h[H],valueSpec:ie,style:S,styleSpec:C,object:h,objectKey:H,validateSpec:L},h))}for(const H in m)v[H]||m[H].required&&m[H].default===void 0&&h[H]===void 0&&z.push(new yt(s,h,`missing required property "${H}"`));return z}function nu(u){const s=u.value,h=u.valueSpec,m=u.style,v=u.styleSpec,S=u.key,C=u.arrayElementValidator||u.validateSpec;if(Vn(s)!=="array")return[new yt(S,s,`array expected, ${Vn(s)} found`)];if(h.length&&s.length!==h.length)return[new yt(S,s,`array length ${h.length} expected, length ${s.length} found`)];if(h["min-length"]&&s.length<h["min-length"])return[new yt(S,s,`array length at least ${h["min-length"]} expected, length ${s.length} found`)];let L={type:h.value,values:h.values};v.$version<7&&(L.function=h.function),Vn(h.value)==="object"&&(L=h.value);let z=[];for(let O=0;O<s.length;O++)z=z.concat(C({array:s,arrayIndex:O,value:s[O],valueSpec:L,validateSpec:u.validateSpec,style:m,styleSpec:v,key:`${S}[${O}]`}));return z}function Wl(u){const s=u.key,h=u.value,m=u.valueSpec;let v=Vn(h);return v==="number"&&h!=h&&(v="NaN"),v!=="number"?[new yt(s,h,`number expected, ${v} found`)]:"minimum"in m&&h<m.minimum?[new yt(s,h,`${h} is less than the minimum value ${m.minimum}`)]:"maximum"in m&&h>m.maximum?[new yt(s,h,`${h} is greater than the maximum value ${m.maximum}`)]:[]}function tf(u){const s=u.valueSpec,h=zr(u.value.type);let m,v,S,C={};const L=h!=="categorical"&&u.value.property===void 0,z=!L,O=Vn(u.value.stops)==="array"&&Vn(u.value.stops[0])==="array"&&Vn(u.value.stops[0][0])==="object",H=Li({key:u.key,value:u.value,valueSpec:u.styleSpec.function,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(ce){if(h==="identity")return[new yt(ce.key,ce.value,'identity function may not have a "stops" property')];let ge=[];const be=ce.value;return ge=ge.concat(nu({key:ce.key,value:be,valueSpec:ce.valueSpec,validateSpec:ce.validateSpec,style:ce.style,styleSpec:ce.styleSpec,arrayElementValidator:K})),Vn(be)==="array"&&be.length===0&&ge.push(new yt(ce.key,be,"array must have at least one stop")),ge},default:function(ce){return ce.validateSpec({key:ce.key,value:ce.value,valueSpec:s,validateSpec:ce.validateSpec,style:ce.style,styleSpec:ce.styleSpec})}}});return h==="identity"&&L&&H.push(new yt(u.key,u.value,'missing required property "property"')),h==="identity"||u.value.stops||H.push(new yt(u.key,u.value,'missing required property "stops"')),h==="exponential"&&u.valueSpec.expression&&!Jc(u.valueSpec)&&H.push(new yt(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(z&&!la(u.valueSpec)?H.push(new yt(u.key,u.value,"property functions not supported")):L&&!Hh(u.valueSpec)&&H.push(new yt(u.key,u.value,"zoom functions not supported"))),h!=="categorical"&&!O||u.value.property!==void 0||H.push(new yt(u.key,u.value,'"property" property is required')),H;function K(ce){let ge=[];const be=ce.value,Te=ce.key;if(Vn(be)!=="array")return[new yt(Te,be,`array expected, ${Vn(be)} found`)];if(be.length!==2)return[new yt(Te,be,`array length 2 expected, length ${be.length} found`)];if(O){if(Vn(be[0])!=="object")return[new yt(Te,be,`object expected, ${Vn(be[0])} found`)];if(be[0].zoom===void 0)return[new yt(Te,be,"object stop key must have zoom")];if(be[0].value===void 0)return[new yt(Te,be,"object stop key must have value")];if(S&&S>zr(be[0].zoom))return[new yt(Te,be[0].zoom,"stop zoom values must appear in ascending order")];zr(be[0].zoom)!==S&&(S=zr(be[0].zoom),v=void 0,C={}),ge=ge.concat(Li({key:`${Te}[0]`,value:be[0],valueSpec:{zoom:{}},validateSpec:ce.validateSpec,style:ce.style,styleSpec:ce.styleSpec,objectElementValidators:{zoom:Wl,value:ie}}))}else ge=ge.concat(ie({key:`${Te}[0]`,value:be[0],valueSpec:{},validateSpec:ce.validateSpec,style:ce.style,styleSpec:ce.styleSpec},be));return hr(ys(be[1]))?ge.concat([new yt(`${Te}[1]`,be[1],"expressions are not allowed in function stops.")]):ge.concat(ce.validateSpec({key:`${Te}[1]`,value:be[1],valueSpec:s,validateSpec:ce.validateSpec,style:ce.style,styleSpec:ce.styleSpec}))}function ie(ce,ge){const be=Vn(ce.value),Te=zr(ce.value),Ae=ce.value!==null?ce.value:ge;if(m){if(be!==m)return[new yt(ce.key,Ae,`${be} stop domain type must match previous stop domain type ${m}`)]}else m=be;if(be!=="number"&&be!=="string"&&be!=="boolean")return[new yt(ce.key,Ae,"stop domain value must be a number, string, or boolean")];if(be!=="number"&&h!=="categorical"){let Ze=`number expected, ${be} found`;return la(s)&&h===void 0&&(Ze+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new yt(ce.key,Ae,Ze)]}return h!=="categorical"||be!=="number"||isFinite(Te)&&Math.floor(Te)===Te?h!=="categorical"&&be==="number"&&v!==void 0&&Te<v?[new yt(ce.key,Ae,"stop domain values must appear in ascending order")]:(v=Te,h==="categorical"&&Te in C?[new yt(ce.key,Ae,"stop domain values must be unique")]:(C[Te]=!0,[])):[new yt(ce.key,Ae,`integer expected, found ${Te}`)]}}function bs(u){const s=(u.expressionContext==="property"?Kh:Ps)(ys(u.value),u.valueSpec);if(s.result==="error")return s.value.map(m=>new yt(`${u.key}${m.key}`,u.value,m.message));const h=s.value.expression||s.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!h.outputDefined())return[new yt(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!Za(h))return[new yt(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter"&&!Za(h))return[new yt(u.key,u.value,'"feature-state" data expressions are not supported with filters.')];if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!Ga(h,["zoom","feature-state"]))return[new yt(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!Pl(h))return[new yt(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function vs(u){const s=u.key,h=u.value,m=u.valueSpec,v=[];return Array.isArray(m.values)?m.values.indexOf(zr(h))===-1&&v.push(new yt(s,h,`expected one of [${m.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(m.values).indexOf(zr(h))===-1&&v.push(new yt(s,h,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(h)} found`)),v}function ca(u){return Vl(ys(u.value))?bs(wr({},u,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ru(u)}function ru(u){const s=u.value,h=u.key;if(Vn(s)!=="array")return[new yt(h,s,`array expected, ${Vn(s)} found`)];const m=u.styleSpec;let v,S=[];if(s.length<1)return[new yt(h,s,"filter array must have at least 1 element")];switch(S=S.concat(vs({key:`${h}[0]`,value:s[0],valueSpec:m.filter_operator,style:u.style,styleSpec:u.styleSpec})),zr(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&zr(s[1])==="$type"&&S.push(new yt(h,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&S.push(new yt(h,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(v=Vn(s[1]),v!=="string"&&S.push(new yt(`${h}[1]`,s[1],`string expected, ${v} found`)));for(let C=2;C<s.length;C++)v=Vn(s[C]),zr(s[1])==="$type"?S=S.concat(vs({key:`${h}[${C}]`,value:s[C],valueSpec:m.geometry_type,style:u.style,styleSpec:u.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&S.push(new yt(`${h}[${C}]`,s[C],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let C=1;C<s.length;C++)S=S.concat(ru({key:`${h}[${C}]`,value:s[C],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":v=Vn(s[1]),s.length!==2?S.push(new yt(h,s,`filter array for "${s[0]}" operator must have 2 elements`)):v!=="string"&&S.push(new yt(`${h}[1]`,s[1],`string expected, ${v} found`));break;case"within":v=Vn(s[1]),s.length!==2?S.push(new yt(h,s,`filter array for "${s[0]}" operator must have 2 elements`)):v!=="object"&&S.push(new yt(`${h}[1]`,s[1],`object expected, ${v} found`))}return S}function Kl(u,s){const h=u.key,m=u.validateSpec,v=u.style,S=u.styleSpec,C=u.value,L=u.objectKey,z=S[`${s}_${u.layerType}`];if(!z)return[];const O=L.match(/^(.*)-transition$/);if(s==="paint"&&O&&z[O[1]]&&z[O[1]].transition)return m({key:h,value:C,valueSpec:S.transition,style:v,styleSpec:S});const H=u.valueSpec||z[L];if(!H)return[new yt(h,C,`unknown property "${L}"`)];let K;if(Vn(C)==="string"&&la(H)&&!H.tokens&&(K=/^{([^}]+)}$/.exec(C)))return[new yt(h,C,`"${L}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(K[1])} }\`.`)];const ie=[];return u.layerType==="symbol"&&(L==="text-field"&&v&&!v.glyphs&&ie.push(new yt(h,C,'use of "text-field" requires a style "glyphs" property')),L==="text-font"&&Ol(ys(C))&&zr(C.type)==="identity"&&ie.push(new yt(h,C,'"text-font" does not support identity functions'))),ie.concat(m({key:u.key,value:C,valueSpec:H,style:v,styleSpec:S,expressionContext:"property",propertyType:s,propertyKey:L}))}function iu(u){return Kl(u,"paint")}function ou(u){return Kl(u,"layout")}function Xa(u){let s=[];const h=u.value,m=u.key,v=u.style,S=u.styleSpec;h.type||h.ref||s.push(new yt(m,h,'either "type" or "ref" is required'));let C=zr(h.type);const L=zr(h.ref);if(h.id){const z=zr(h.id);for(let O=0;O<u.arrayIndex;O++){const H=v.layers[O];zr(H.id)===z&&s.push(new yt(m,h.id,`duplicate layer id "${h.id}", previously used at line ${H.id.__line__}`))}}if("ref"in h){let z;["type","source","source-layer","filter","layout"].forEach(O=>{O in h&&s.push(new yt(m,h[O],`"${O}" is prohibited for ref layers`))}),v.layers.forEach(O=>{zr(O.id)===L&&(z=O)}),z?z.ref?s.push(new yt(m,h.ref,"ref cannot reference another ref layer")):C=zr(z.type):s.push(new yt(m,h.ref,`ref layer "${L}" not found`))}else if(C!=="background")if(h.source){const z=v.sources&&v.sources[h.source],O=z&&zr(z.type);z?O==="vector"&&C==="raster"?s.push(new yt(m,h.source,`layer "${h.id}" requires a raster source`)):O!=="raster-dem"&&C==="hillshade"?s.push(new yt(m,h.source,`layer "${h.id}" requires a raster-dem source`)):O==="raster"&&C!=="raster"?s.push(new yt(m,h.source,`layer "${h.id}" requires a vector source`)):O!=="vector"||h["source-layer"]?O==="raster-dem"&&C!=="hillshade"?s.push(new yt(m,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):C!=="line"||!h.paint||!h.paint["line-gradient"]||O==="geojson"&&z.lineMetrics||s.push(new yt(m,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new yt(m,h,`layer "${h.id}" must specify a "source-layer"`)):s.push(new yt(m,h.source,`source "${h.source}" not found`))}else s.push(new yt(m,h,'missing required property "source"'));return s=s.concat(Li({key:m,value:h,valueSpec:S.layer,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*":()=>[],type:()=>u.validateSpec({key:`${m}.type`,value:h.type,valueSpec:S.layer.type,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,object:h,objectKey:"type"}),filter:ca,layout:z=>Li({layer:h,key:z.key,value:z.value,style:z.style,styleSpec:z.styleSpec,validateSpec:z.validateSpec,objectElementValidators:{"*":O=>ou(wr({layerType:C},O))}}),paint:z=>Li({layer:h,key:z.key,value:z.value,style:z.style,styleSpec:z.styleSpec,validateSpec:z.validateSpec,objectElementValidators:{"*":O=>iu(wr({layerType:C},O))}})}})),s}function zs(u){const s=u.value,h=u.key,m=Vn(s);return m!=="string"?[new yt(h,s,`string expected, ${m} found`)]:[]}const nf={promoteId:function({key:u,value:s}){if(Vn(s)==="string")return zs({key:u,value:s});{const h=[];for(const m in s)h.push(...zs({key:`${u}.${m}`,value:s[m]}));return h}}};function rf(u){const s=u.value,h=u.key,m=u.styleSpec,v=u.style,S=u.validateSpec;if(!s.type)return[new yt(h,s,'"type" is required')];const C=zr(s.type);let L;switch(C){case"vector":case"raster":return L=Li({key:h,value:s,valueSpec:m[`source_${C.replace("-","_")}`],style:u.style,styleSpec:m,objectElementValidators:nf,validateSpec:S}),L;case"raster-dem":return L=function(z){var O;const H=(O=z.sourceName)!==null&&O!==void 0?O:"",K=z.value,ie=z.styleSpec,ce=ie.source_raster_dem,ge=z.style;let be=[];const Te=Vn(K);if(K===void 0)return be;if(Te!=="object")return be.push(new yt("source_raster_dem",K,`object expected, ${Te} found`)),be;const Ae=zr(K.encoding)==="custom",Ze=["redFactor","greenFactor","blueFactor","baseShift"],Re=z.value.encoding?`"${z.value.encoding}"`:"Default";for(const je in K)!Ae&&Ze.includes(je)?be.push(new yt(je,K[je],`In "${H}": "${je}" is only valid when "encoding" is set to "custom". ${Re} encoding found`)):ce[je]?be=be.concat(z.validateSpec({key:je,value:K[je],valueSpec:ce[je],validateSpec:z.validateSpec,style:ge,styleSpec:ie})):be.push(new yt(je,K[je],`unknown property "${je}"`));return be}({sourceName:h,value:s,style:u.style,styleSpec:m,validateSpec:S}),L;case"geojson":if(L=Li({key:h,value:s,valueSpec:m.source_geojson,style:v,styleSpec:m,validateSpec:S,objectElementValidators:nf}),s.cluster)for(const z in s.clusterProperties){const[O,H]=s.clusterProperties[z],K=typeof O=="string"?[O,["accumulated"],["get",z]]:O;L.push(...bs({key:`${h}.${z}.map`,value:H,validateSpec:S,expressionContext:"cluster-map"})),L.push(...bs({key:`${h}.${z}.reduce`,value:K,validateSpec:S,expressionContext:"cluster-reduce"}))}return L;case"video":return Li({key:h,value:s,valueSpec:m.source_video,style:v,validateSpec:S,styleSpec:m});case"image":return Li({key:h,value:s,valueSpec:m.source_image,style:v,validateSpec:S,styleSpec:m});case"canvas":return[new yt(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return vs({key:`${h}.type`,value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,validateSpec:S,styleSpec:m})}}function of(u){const s=u.value,h=u.styleSpec,m=h.light,v=u.style;let S=[];const C=Vn(s);if(s===void 0)return S;if(C!=="object")return S=S.concat([new yt("light",s,`object expected, ${C} found`)]),S;for(const L in s){const z=L.match(/^(.*)-transition$/);S=S.concat(z&&m[z[1]]&&m[z[1]].transition?u.validateSpec({key:L,value:s[L],valueSpec:h.transition,validateSpec:u.validateSpec,style:v,styleSpec:h}):m[L]?u.validateSpec({key:L,value:s[L],valueSpec:m[L],validateSpec:u.validateSpec,style:v,styleSpec:h}):[new yt(L,s[L],`unknown property "${L}"`)])}return S}function sf(u){const s=u.value,h=u.styleSpec,m=h.sky,v=u.style,S=Vn(s);if(s===void 0)return[];if(S!=="object")return[new yt("sky",s,`object expected, ${S} found`)];let C=[];for(const L in s)C=C.concat(m[L]?Uo({key:L,value:s[L],valueSpec:m[L],style:v,styleSpec:h}):[new yt(L,s[L],`unknown property "${L}"`)]);return C}function Ja(u){const s=u.value,h=u.styleSpec,m=h.terrain,v=u.style;let S=[];const C=Vn(s);if(s===void 0)return S;if(C!=="object")return S=S.concat([new yt("terrain",s,`object expected, ${C} found`)]),S;for(const L in s)S=S.concat(m[L]?u.validateSpec({key:L,value:s[L],valueSpec:m[L],validateSpec:u.validateSpec,style:v,styleSpec:h}):[new yt(L,s[L],`unknown property "${L}"`)]);return S}function Ya(u){let s=[];const h=u.value,m=u.key;if(Array.isArray(h)){const v=[],S=[];for(const C in h)h[C].id&&v.includes(h[C].id)&&s.push(new yt(m,h,`all the sprites' ids must be unique, but ${h[C].id} is duplicated`)),v.push(h[C].id),h[C].url&&S.includes(h[C].url)&&s.push(new yt(m,h,`all the sprites' URLs must be unique, but ${h[C].url} is duplicated`)),S.push(h[C].url),s=s.concat(Li({key:`${m}[${C}]`,value:h[C],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:u.validateSpec}));return s}return zs({key:m,value:h})}const Ri={"*":()=>[],array:nu,boolean:function(u){const s=u.value,h=u.key,m=Vn(s);return m!=="boolean"?[new yt(h,s,`boolean expected, ${m} found`)]:[]},number:Wl,color:function(u){const s=u.key,h=u.value,m=Vn(h);return m!=="string"?[new yt(s,h,`color expected, ${m} found`)]:rr.parse(String(h))?[]:[new yt(s,h,`color expected, "${h}" found`)]},constants:ef,enum:vs,filter:ca,function:tf,layer:Xa,object:Li,source:rf,light:of,sky:sf,terrain:Ja,string:zs,formatted:function(u){return zs(u).length===0?[]:bs(u)},resolvedImage:function(u){return zs(u).length===0?[]:bs(u)},padding:function(u){const s=u.key,h=u.value;if(Vn(h)==="array"){if(h.length<1||h.length>4)return[new yt(s,h,`padding requires 1 to 4 values; ${h.length} values found`)];const m={type:"number"};let v=[];for(let S=0;S<h.length;S++)v=v.concat(u.validateSpec({key:`${s}[${S}]`,value:h[S],validateSpec:u.validateSpec,valueSpec:m}));return v}return Wl({key:s,value:h,valueSpec:{}})},variableAnchorOffsetCollection:function(u){const s=u.key,h=u.value,m=Vn(h),v=u.styleSpec;if(m!=="array"||h.length<1||h.length%2!=0)return[new yt(s,h,"variableAnchorOffsetCollection requires a non-empty array of even length")];let S=[];for(let C=0;C<h.length;C+=2)S=S.concat(vs({key:`${s}[${C}]`,value:h[C],valueSpec:v.layout_symbol["text-anchor"]})),S=S.concat(nu({key:`${s}[${C+1}]`,value:h[C+1],valueSpec:{length:2,value:"number"},validateSpec:u.validateSpec,style:u.style,styleSpec:v}));return S},sprite:Ya};function Uo(u){const s=u.value,h=u.valueSpec,m=u.styleSpec;return u.validateSpec=Uo,h.expression&&Ol(zr(s))?tf(u):h.expression&&hr(ys(s))?bs(u):h.type&&Ri[h.type]?Ri[h.type](u):Li(wr({},u,{valueSpec:h.type?m[h.type]:h}))}function su(u){const s=u.value,h=u.key,m=zs(u);return m.length||(s.indexOf("{fontstack}")===-1&&m.push(new yt(h,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&m.push(new yt(h,s,'"glyphs" url must include a "{range}" token'))),m}function vo(u,s=_e){let h=[];return h=h.concat(Uo({key:"",value:u,valueSpec:s.$root,styleSpec:s,style:u,validateSpec:Uo,objectElementValidators:{glyphs:su,"*":()=>[]}})),u.constants&&(h=h.concat(ef({key:"constants",value:u.constants,style:u,styleSpec:s,validateSpec:Uo}))),ua(h)}function Vo(u){return function(s){return u({...s,validateSpec:Uo})}}function ua(u){return[].concat(u).sort((s,h)=>s.line-h.line)}function wo(u){return function(...s){return ua(u.apply(this,s))}}vo.source=wo(Vo(rf)),vo.sprite=wo(Vo(Ya)),vo.glyphs=wo(Vo(su)),vo.light=wo(Vo(of)),vo.sky=wo(Vo(sf)),vo.terrain=wo(Vo(Ja)),vo.layer=wo(Vo(Xa)),vo.filter=wo(Vo(ca)),vo.paintProperty=wo(Vo(iu)),vo.layoutProperty=wo(Vo(ou));const Ds=vo,Jd=Ds.light,au=Ds.paintProperty,Yd=Ds.layoutProperty;function ha(u,s){let h=!1;if(s&&s.length)for(const m of s)u.fire(new kt(new Error(m.message))),h=!0;return h}class Qa{constructor(s,h,m){const v=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;const C=new Int32Array(this.arrayBuffer);s=C[0],this.d=(h=C[1])+2*(m=C[2]);for(let z=0;z<this.d*this.d;z++){const O=C[3+z],H=C[3+z+1];v.push(O===H?null:C.subarray(O,H))}const L=C[3+v.length+1];this.keys=C.subarray(C[3+v.length],L),this.bboxes=C.subarray(L),this.insert=this._insertReadonly}else{this.d=h+2*m;for(let C=0;C<this.d*this.d;C++)v.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=s,this.padding=m,this.scale=h/s,this.uid=0;const S=m/h*s;this.min=-S,this.max=s+S}insert(s,h,m,v,S){this._forEachCell(h,m,v,S,this._insertCell,this.uid++,void 0,void 0),this.keys.push(s),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(S)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(s,h,m,v,S,C){this.cells[S].push(C)}query(s,h,m,v,S){const C=this.min,L=this.max;if(s<=C&&h<=C&&L<=m&&L<=v&&!S)return Array.prototype.slice.call(this.keys);{const z=[];return this._forEachCell(s,h,m,v,this._queryCell,z,{},S),z}}_queryCell(s,h,m,v,S,C,L,z){const O=this.cells[S];if(O!==null){const H=this.keys,K=this.bboxes;for(let ie=0;ie<O.length;ie++){const ce=O[ie];if(L[ce]===void 0){const ge=4*ce;(z?z(K[ge+0],K[ge+1],K[ge+2],K[ge+3]):s<=K[ge+2]&&h<=K[ge+3]&&m>=K[ge+0]&&v>=K[ge+1])?(L[ce]=!0,C.push(H[ce])):L[ce]=!1}}}}_forEachCell(s,h,m,v,S,C,L,z){const O=this._convertToCellCoord(s),H=this._convertToCellCoord(h),K=this._convertToCellCoord(m),ie=this._convertToCellCoord(v);for(let ce=O;ce<=K;ce++)for(let ge=H;ge<=ie;ge++){const be=this.d*ge+ce;if((!z||z(this._convertFromCellCoord(ce),this._convertFromCellCoord(ge),this._convertFromCellCoord(ce+1),this._convertFromCellCoord(ge+1)))&&S.call(this,s,h,m,v,be,C,L,z))return}}_convertFromCellCoord(s){return(s-this.padding)/this.scale}_convertToCellCoord(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const s=this.cells,h=3+this.cells.length+1+1;let m=0;for(let C=0;C<this.cells.length;C++)m+=this.cells[C].length;const v=new Int32Array(h+m+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;let S=h;for(let C=0;C<s.length;C++){const L=s[C];v[3+C]=S,v.set(L,S),S+=L.length}return v[3+s.length]=S,v.set(this.keys,S),S+=this.keys.length,v[3+s.length+1]=S,v.set(this.bboxes,S),S+=this.bboxes.length,v.buffer}static serialize(s,h){const m=s.toArrayBuffer();return h&&h.push(m),{buffer:m}}static deserialize(s){return new Qa(s.buffer)}}const qo={};function Ht(u,s,h={}){if(qo[u])throw new Error(`${u} is already registered.`);Object.defineProperty(s,"_classRegistryKey",{value:u,writeable:!1}),qo[u]={klass:s,omit:h.omit||[],shallow:h.shallow||[]}}Ht("Object",Object),Ht("TransferableGridIndex",Qa),Ht("Color",rr),Ht("Error",Error),Ht("AJAXError",Et),Ht("ResolvedImage",fo),Ht("StylePropertyFunction",jl),Ht("StyleExpression",gr,{omit:["_evaluator"]}),Ht("ZoomDependentExpression",Qc),Ht("ZoomConstantExpression",Nl),Ht("CompoundExpression",Yi,{omit:["_evaluate"]});for(const u in sa)sa[u]._classRegistryKey||Ht(`Expression_${u}`,sa[u]);function Xl(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function fa(u,s){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error)return u;if(Xl(u)||$e(u))return s&&s.push(u),u;if(ArrayBuffer.isView(u)){const h=u;return s&&s.push(h.buffer),h}if(u instanceof ImageData)return s&&s.push(u.data.buffer),u;if(Array.isArray(u)){const h=[];for(const m of u)h.push(fa(m,s));return h}if(typeof u=="object"){const h=u.constructor,m=h._classRegistryKey;if(!m)throw new Error(`can't serialize object of unregistered class ${h.name}`);if(!qo[m])throw new Error(`${m} is not registered.`);const v=h.serialize?h.serialize(u,s):{};if(h.serialize){if(s&&v===s[s.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const S in u){if(!u.hasOwnProperty(S)||qo[m].omit.indexOf(S)>=0)continue;const C=u[S];v[S]=qo[m].shallow.indexOf(S)>=0?C:fa(C,s)}u instanceof Error&&(v.message=u.message)}if(v.$name)throw new Error("$name property is reserved for worker serialization logic.");return m!=="Object"&&(v.$name=m),v}throw new Error("can't serialize object of type "+typeof u)}function da(u){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error||Xl(u)||$e(u)||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(da);if(typeof u=="object"){const s=u.$name||"Object";if(!qo[s])throw new Error(`can't deserialize unregistered class ${s}`);const{klass:h}=qo[s];if(!h)throw new Error(`can't deserialize unregistered class ${s}`);if(h.deserialize)return h.deserialize(u);const m=Object.create(h.prototype);for(const v of Object.keys(u)){if(v==="$name")continue;const S=u[v];m[v]=qo[s].shallow.indexOf(v)>=0?S:da(S)}return m}throw new Error("can't deserialize object of type "+typeof u)}class af{constructor(){this.first=!0}update(s,h){const m=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=m,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=m,!0):(this.lastFloorZoom>m?(this.lastIntegerZoom=m+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<m&&(this.lastIntegerZoom=m,this.lastIntegerZoomTime=h),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=m,!0))}}const Ut={"Latin-1 Supplement":u=>u>=128&&u<=255,Arabic:u=>u>=1536&&u<=1791,"Arabic Supplement":u=>u>=1872&&u<=1919,"Arabic Extended-A":u=>u>=2208&&u<=2303,"Hangul Jamo":u=>u>=4352&&u<=4607,"Unified Canadian Aboriginal Syllabics":u=>u>=5120&&u<=5759,Khmer:u=>u>=6016&&u<=6143,"Unified Canadian Aboriginal Syllabics Extended":u=>u>=6320&&u<=6399,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"CJK Radicals Supplement":u=>u>=11904&&u<=12031,"Kangxi Radicals":u=>u>=12032&&u<=12255,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Bopomofo:u=>u>=12544&&u<=12591,"Hangul Compatibility Jamo":u=>u>=12592&&u<=12687,Kanbun:u=>u>=12688&&u<=12703,"Bopomofo Extended":u=>u>=12704&&u<=12735,"CJK Strokes":u=>u>=12736&&u<=12783,"Katakana Phonetic Extensions":u=>u>=12784&&u<=12799,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"CJK Unified Ideographs Extension A":u=>u>=13312&&u<=19903,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Yi Syllables":u=>u>=40960&&u<=42127,"Yi Radicals":u=>u>=42128&&u<=42191,"Hangul Jamo Extended-A":u=>u>=43360&&u<=43391,"Hangul Syllables":u=>u>=44032&&u<=55215,"Hangul Jamo Extended-B":u=>u>=55216&&u<=55295,"Private Use Area":u=>u>=57344&&u<=63743,"CJK Compatibility Ideographs":u=>u>=63744&&u<=64255,"Arabic Presentation Forms-A":u=>u>=64336&&u<=65023,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Arabic Presentation Forms-B":u=>u>=65136&&u<=65279,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519};function pa(u){for(const s of u)if(Jl(s.charCodeAt(0)))return!0;return!1}function lf(u){for(const s of u)if(!cf(s.charCodeAt(0)))return!1;return!0}function cf(u){return!(Ut.Arabic(u)||Ut["Arabic Supplement"](u)||Ut["Arabic Extended-A"](u)||Ut["Arabic Presentation Forms-A"](u)||Ut["Arabic Presentation Forms-B"](u))}function Jl(u){return!(u!==746&&u!==747&&(u<4352||!(Ut["Bopomofo Extended"](u)||Ut.Bopomofo(u)||Ut["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||Ut["CJK Compatibility Ideographs"](u)||Ut["CJK Compatibility"](u)||Ut["CJK Radicals Supplement"](u)||Ut["CJK Strokes"](u)||!(!Ut["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||Ut["CJK Unified Ideographs Extension A"](u)||Ut["CJK Unified Ideographs"](u)||Ut["Enclosed CJK Letters and Months"](u)||Ut["Hangul Compatibility Jamo"](u)||Ut["Hangul Jamo Extended-A"](u)||Ut["Hangul Jamo Extended-B"](u)||Ut["Hangul Jamo"](u)||Ut["Hangul Syllables"](u)||Ut.Hiragana(u)||Ut["Ideographic Description Characters"](u)||Ut.Kanbun(u)||Ut["Kangxi Radicals"](u)||Ut["Katakana Phonetic Extensions"](u)||Ut.Katakana(u)&&u!==12540||!(!Ut["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!Ut["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||Ut["Unified Canadian Aboriginal Syllabics"](u)||Ut["Unified Canadian Aboriginal Syllabics Extended"](u)||Ut["Vertical Forms"](u)||Ut["Yijing Hexagram Symbols"](u)||Ut["Yi Syllables"](u)||Ut["Yi Radicals"](u))))}function lu(u){return!(Jl(u)||function(s){return!!(Ut["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||Ut["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||Ut["Letterlike Symbols"](s)||Ut["Number Forms"](s)||Ut["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||Ut["Control Pictures"](s)&&s!==9251||Ut["Optical Character Recognition"](s)||Ut["Enclosed Alphanumerics"](s)||Ut["Geometric Shapes"](s)||Ut["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||Ut["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||Ut["CJK Symbols and Punctuation"](s)||Ut.Katakana(s)||Ut["Private Use Area"](s)||Ut["CJK Compatibility Forms"](s)||Ut["Small Form Variants"](s)||Ut["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(u))}function Yl(u){return u>=1424&&u<=2303||Ut["Arabic Presentation Forms-A"](u)||Ut["Arabic Presentation Forms-B"](u)}function uf(u,s){return!(!s&&Yl(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||Ut.Khmer(u))}function Qd(u){for(const s of u)if(Yl(s.charCodeAt(0)))return!0;return!1}const ws=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(u){this.pluginStatus=u.pluginStatus,this.pluginURL=u.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(u){this.applyArabicShaping=u.applyArabicShaping,this.processBidirectionalText=u.processBidirectionalText,this.processStyledBidirectionalText=u.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class kr{constructor(s,h){this.zoom=s,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new af,this.transition={})}isSupportedScript(s){return function(h,m){for(const v of h)if(!uf(v.charCodeAt(0),m))return!1;return!0}(s,ws.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const s=this.zoom,h=s-Math.floor(s),m=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*m}:{fromScale:.5,toScale:1,t:1-(1-m)*h}}}class el{constructor(s,h){this.property=s,this.value=h,this.expression=function(m,v){if(Ol(m))return new jl(m,v);if(hr(m)){const S=Kh(m,v);if(S.result==="error")throw new Error(S.value.map(C=>`${C.key}: ${C.message}`).join(", "));return S.value}{let S=m;return v.type==="color"&&typeof m=="string"?S=rr.parse(m):v.type!=="padding"||typeof m!="number"&&!Array.isArray(m)?v.type==="variableAnchorOffsetCollection"&&Array.isArray(m)&&(S=ho.parse(m)):S=$i.parse(m),{kind:"constant",evaluate:()=>S}}}(h===void 0?s.specification.default:h,s.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(s,h,m){return this.property.possiblyEvaluate(this,s,h,m)}}class Ql{constructor(s){this.property=s,this.value=new el(s,void 0)}transitioned(s,h){return new hf(this.property,this.value,h,J({},s.transition,this.transition),s.now)}untransitioned(){return new hf(this.property,this.value,null,{},0)}}class cu{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues)}getValue(s){return Q(this._values[s].value.value)}setValue(s,h){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new Ql(this._values[s].property)),this._values[s].value=new el(this._values[s].property,h===null?void 0:Q(h))}getTransition(s){return Q(this._values[s].transition)}setTransition(s,h){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new Ql(this._values[s].property)),this._values[s].transition=Q(h)||void 0}serialize(){const s={};for(const h of Object.keys(this._values)){const m=this.getValue(h);m!==void 0&&(s[h]=m);const v=this.getTransition(h);v!==void 0&&(s[`${h}-transition`]=v)}return s}transitioned(s,h){const m=new ff(this._properties);for(const v of Object.keys(this._values))m._values[v]=this._values[v].transitioned(s,h._values[v]);return m}untransitioned(){const s=new ff(this._properties);for(const h of Object.keys(this._values))s._values[h]=this._values[h].untransitioned();return s}}class hf{constructor(s,h,m,v,S){this.property=s,this.value=h,this.begin=S+v.delay||0,this.end=this.begin+v.duration||0,s.specification.transition&&(v.delay||v.duration)&&(this.prior=m)}possiblyEvaluate(s,h,m){const v=s.now||0,S=this.value.possiblyEvaluate(s,h,m),C=this.prior;if(C){if(v>this.end)return this.prior=null,S;if(this.value.isDataDriven())return this.prior=null,S;if(v<this.begin)return C.possiblyEvaluate(s,h,m);{const L=(v-this.begin)/(this.end-this.begin);return this.property.interpolate(C.possiblyEvaluate(s,h,m),S,function(z){if(z<=0)return 0;if(z>=1)return 1;const O=z*z,H=O*z;return 4*(z<.5?H:3*(z-O)+H-.75)}(L))}}return S}}class ff{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,h,m){const v=new tl(this._properties);for(const S of Object.keys(this._values))v._values[S]=this._values[S].possiblyEvaluate(s,h,m);return v}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class df{constructor(s){this._properties=s,this._values=Object.create(s.defaultPropertyValues)}hasValue(s){return this._values[s].value!==void 0}getValue(s){return Q(this._values[s].value)}setValue(s,h){this._values[s]=new el(this._values[s].property,h===null?void 0:Q(h))}serialize(){const s={};for(const h of Object.keys(this._values)){const m=this.getValue(h);m!==void 0&&(s[h]=m)}return s}possiblyEvaluate(s,h,m){const v=new tl(this._properties);for(const S of Object.keys(this._values))v._values[S]=this._values[S].possiblyEvaluate(s,h,m);return v}}class xo{constructor(s,h,m){this.property=s,this.value=h,this.parameters=m}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,h,m,v){return this.property.evaluate(this.value,this.parameters,s,h,m,v)}}class tl{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class rn{constructor(s){this.specification=s}possiblyEvaluate(s,h){if(s.isDataDriven())throw new Error("Value should not be data driven");return s.expression.evaluate(h)}interpolate(s,h,m){const v=Mi[this.specification.type];return v?v(s,h,m):s}}class un{constructor(s,h){this.specification=s,this.overrides=h}possiblyEvaluate(s,h,m,v){return new xo(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(h,null,{},m,v)}:s.expression,h)}interpolate(s,h,m){if(s.value.kind!=="constant"||h.value.kind!=="constant")return s;if(s.value.value===void 0||h.value.value===void 0)return new xo(this,{kind:"constant",value:void 0},s.parameters);const v=Mi[this.specification.type];if(v){const S=v(s.value.value,h.value.value,m);return new xo(this,{kind:"constant",value:S},s.parameters)}return s}evaluate(s,h,m,v,S,C){return s.kind==="constant"?s.value:s.evaluate(h,m,v,S,C)}}class ec extends un{possiblyEvaluate(s,h,m,v){if(s.value===void 0)return new xo(this,{kind:"constant",value:void 0},h);if(s.expression.kind==="constant"){const S=s.expression.evaluate(h,null,{},m,v),C=s.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,L=this._calculate(C,C,C,h);return new xo(this,{kind:"constant",value:L},h)}if(s.expression.kind==="camera"){const S=this._calculate(s.expression.evaluate({zoom:h.zoom-1}),s.expression.evaluate({zoom:h.zoom}),s.expression.evaluate({zoom:h.zoom+1}),h);return new xo(this,{kind:"constant",value:S},h)}return new xo(this,s.expression,h)}evaluate(s,h,m,v,S,C){if(s.kind==="source"){const L=s.evaluate(h,m,v,S,C);return this._calculate(L,L,L,h)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(h.zoom)-1},m,v),s.evaluate({zoom:Math.floor(h.zoom)},m,v),s.evaluate({zoom:Math.floor(h.zoom)+1},m,v),h):s.value}_calculate(s,h,m,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:s,to:h}:{from:m,to:h}}interpolate(s){return s}}class nl{constructor(s){this.specification=s}possiblyEvaluate(s,h,m,v){if(s.value!==void 0){if(s.expression.kind==="constant"){const S=s.expression.evaluate(h,null,{},m,v);return this._calculate(S,S,S,h)}return this._calculate(s.expression.evaluate(new kr(Math.floor(h.zoom-1),h)),s.expression.evaluate(new kr(Math.floor(h.zoom),h)),s.expression.evaluate(new kr(Math.floor(h.zoom+1),h)),h)}}_calculate(s,h,m,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:s,to:h}:{from:m,to:h}}interpolate(s){return s}}class uu{constructor(s){this.specification=s}possiblyEvaluate(s,h,m,v){return!!s.expression.evaluate(h,null,{},m,v)}interpolate(){return!1}}class Fi{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in s){const m=s[h];m.specification.overridable&&this.overridableProperties.push(h);const v=this.defaultPropertyValues[h]=new el(m,void 0),S=this.defaultTransitionablePropertyValues[h]=new Ql(m);this.defaultTransitioningPropertyValues[h]=S.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=v.possiblyEvaluate({})}}}Ht("DataDrivenProperty",un),Ht("DataConstantProperty",rn),Ht("CrossFadedDataDrivenProperty",ec),Ht("CrossFadedProperty",nl),Ht("ColorRampProperty",uu);const hu="-transition";class ko extends jt{constructor(s,h){if(super(),this.id=s.id,this.type=s.type,this._featureFilter={filter:()=>!0,needGeometry:!1},s.type!=="custom"&&(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),h.layout&&(this._unevaluatedLayout=new df(h.layout)),h.paint)){this._transitionablePaint=new cu(h.paint);for(const m in s.paint)this.setPaintProperty(m,s.paint[m],{validate:!1});for(const m in s.layout)this.setLayoutProperty(m,s.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new tl(h.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}setLayoutProperty(s,h,m={}){h!=null&&this._validate(Yd,`layers.${this.id}.layout.${s}`,s,h,m)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,h):this.visibility=h)}getPaintProperty(s){return s.endsWith(hu)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}setPaintProperty(s,h,m={}){if(h!=null&&this._validate(au,`layers.${this.id}.paint.${s}`,s,h,m))return!1;if(s.endsWith(hu))return this._transitionablePaint.setTransition(s.slice(0,-11),h||void 0),!1;{const v=this._transitionablePaint._values[s],S=v.property.specification["property-type"]==="cross-faded-data-driven",C=v.value.isDataDriven(),L=v.value;this._transitionablePaint.setValue(s,h),this._handleSpecialPaintPropertyUpdate(s);const z=this._transitionablePaint._values[s].value;return z.isDataDriven()||C||S||this._handleOverridablePaintPropertyUpdate(s,L,z)}}_handleSpecialPaintPropertyUpdate(s){}_handleOverridablePaintPropertyUpdate(s,h,m){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,h){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,h)}serialize(){const s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),Ie(s,(h,m)=>!(h===void 0||m==="layout"&&!Object.keys(h).length||m==="paint"&&!Object.keys(h).length))}_validate(s,h,m,v,S={}){return(!S||S.validate!==!1)&&ha(this,s.call(Ds,{key:h,layerType:this.type,objectKey:m,value:v,styleSpec:_e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const s in this.paint._values){const h=this.paint.get(s);if(h instanceof xo&&la(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}}const pf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class rl{constructor(s,h){this._structArray=s,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Dr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(s,h){return s._trim(),h&&(s.isTransferred=!0,h.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const h=Object.create(this.prototype);return h.arrayBuffer=s.arrayBuffer,h.length=s.length,h.capacity=s.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ur(u,s=1){let h=0,m=0;return{members:u.map(v=>{const S=pf[v.type].BYTES_PER_ELEMENT,C=h=mf(h,Math.max(s,S)),L=v.components||1;return m=Math.max(m,S),h+=S*L,{name:v.name,type:v.type,components:L,offset:C}}),size:mf(h,Math.max(m,s)),alignment:s}}function mf(u,s){return Math.ceil(u/s)*s}class il extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h){const m=this.length;return this.resize(m+1),this.emplace(m,s,h)}emplace(s,h,m){const v=2*s;return this.int16[v+0]=h,this.int16[v+1]=m,s}}il.prototype.bytesPerElement=4,Ht("StructArrayLayout2i4",il);class ns extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,s,h,m)}emplace(s,h,m,v){const S=3*s;return this.int16[S+0]=h,this.int16[S+1]=m,this.int16[S+2]=v,s}}ns.prototype.bytesPerElement=6,Ht("StructArrayLayout3i6",ns);class fu extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,s,h,m,v)}emplace(s,h,m,v,S){const C=4*s;return this.int16[C+0]=h,this.int16[C+1]=m,this.int16[C+2]=v,this.int16[C+3]=S,s}}fu.prototype.bytesPerElement=8,Ht("StructArrayLayout4i8",fu);class du extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,C){const L=this.length;return this.resize(L+1),this.emplace(L,s,h,m,v,S,C)}emplace(s,h,m,v,S,C,L){const z=6*s;return this.int16[z+0]=h,this.int16[z+1]=m,this.int16[z+2]=v,this.int16[z+3]=S,this.int16[z+4]=C,this.int16[z+5]=L,s}}du.prototype.bytesPerElement=12,Ht("StructArrayLayout2i4i12",du);class pu extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,C){const L=this.length;return this.resize(L+1),this.emplace(L,s,h,m,v,S,C)}emplace(s,h,m,v,S,C,L){const z=4*s,O=8*s;return this.int16[z+0]=h,this.int16[z+1]=m,this.uint8[O+4]=v,this.uint8[O+5]=S,this.uint8[O+6]=C,this.uint8[O+7]=L,s}}pu.prototype.bytesPerElement=8,Ht("StructArrayLayout2i4ub8",pu);class ol extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h){const m=this.length;return this.resize(m+1),this.emplace(m,s,h)}emplace(s,h,m){const v=2*s;return this.float32[v+0]=h,this.float32[v+1]=m,s}}ol.prototype.bytesPerElement=8,Ht("StructArrayLayout2f8",ol);class tc extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,C,L,z,O,H){const K=this.length;return this.resize(K+1),this.emplace(K,s,h,m,v,S,C,L,z,O,H)}emplace(s,h,m,v,S,C,L,z,O,H,K){const ie=10*s;return this.uint16[ie+0]=h,this.uint16[ie+1]=m,this.uint16[ie+2]=v,this.uint16[ie+3]=S,this.uint16[ie+4]=C,this.uint16[ie+5]=L,this.uint16[ie+6]=z,this.uint16[ie+7]=O,this.uint16[ie+8]=H,this.uint16[ie+9]=K,s}}tc.prototype.bytesPerElement=20,Ht("StructArrayLayout10ui20",tc);class mu extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,C,L,z,O,H,K,ie){const ce=this.length;return this.resize(ce+1),this.emplace(ce,s,h,m,v,S,C,L,z,O,H,K,ie)}emplace(s,h,m,v,S,C,L,z,O,H,K,ie,ce){const ge=12*s;return this.int16[ge+0]=h,this.int16[ge+1]=m,this.int16[ge+2]=v,this.int16[ge+3]=S,this.uint16[ge+4]=C,this.uint16[ge+5]=L,this.uint16[ge+6]=z,this.uint16[ge+7]=O,this.int16[ge+8]=H,this.int16[ge+9]=K,this.int16[ge+10]=ie,this.int16[ge+11]=ce,s}}mu.prototype.bytesPerElement=24,Ht("StructArrayLayout4i4ui4i24",mu);class gu extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,s,h,m)}emplace(s,h,m,v){const S=3*s;return this.float32[S+0]=h,this.float32[S+1]=m,this.float32[S+2]=v,s}}gu.prototype.bytesPerElement=12,Ht("StructArrayLayout3f12",gu);class rs extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const h=this.length;return this.resize(h+1),this.emplace(h,s)}emplace(s,h){return this.uint32[1*s+0]=h,s}}rs.prototype.bytesPerElement=4,Ht("StructArrayLayout1ul4",rs);class nc extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,C,L,z,O){const H=this.length;return this.resize(H+1),this.emplace(H,s,h,m,v,S,C,L,z,O)}emplace(s,h,m,v,S,C,L,z,O,H){const K=10*s,ie=5*s;return this.int16[K+0]=h,this.int16[K+1]=m,this.int16[K+2]=v,this.int16[K+3]=S,this.int16[K+4]=C,this.int16[K+5]=L,this.uint32[ie+3]=z,this.uint16[K+8]=O,this.uint16[K+9]=H,s}}nc.prototype.bytesPerElement=20,Ht("StructArrayLayout6i1ul2ui20",nc);class sl extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,C){const L=this.length;return this.resize(L+1),this.emplace(L,s,h,m,v,S,C)}emplace(s,h,m,v,S,C,L){const z=6*s;return this.int16[z+0]=h,this.int16[z+1]=m,this.int16[z+2]=v,this.int16[z+3]=S,this.int16[z+4]=C,this.int16[z+5]=L,s}}sl.prototype.bytesPerElement=12,Ht("StructArrayLayout2i2i2i12",sl);class rc extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S){const C=this.length;return this.resize(C+1),this.emplace(C,s,h,m,v,S)}emplace(s,h,m,v,S,C){const L=4*s,z=8*s;return this.float32[L+0]=h,this.float32[L+1]=m,this.float32[L+2]=v,this.int16[z+6]=S,this.int16[z+7]=C,s}}rc.prototype.bytesPerElement=16,Ht("StructArrayLayout2f1f2i16",rc);class al extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,s,h,m,v)}emplace(s,h,m,v,S){const C=12*s,L=3*s;return this.uint8[C+0]=h,this.uint8[C+1]=m,this.float32[L+1]=v,this.float32[L+2]=S,s}}al.prototype.bytesPerElement=12,Ht("StructArrayLayout2ub2f12",al);class ic extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,s,h,m)}emplace(s,h,m,v){const S=3*s;return this.uint16[S+0]=h,this.uint16[S+1]=m,this.uint16[S+2]=v,s}}ic.prototype.bytesPerElement=6,Ht("StructArrayLayout3ui6",ic);class ma extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,C,L,z,O,H,K,ie,ce,ge,be,Te,Ae){const Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,s,h,m,v,S,C,L,z,O,H,K,ie,ce,ge,be,Te,Ae)}emplace(s,h,m,v,S,C,L,z,O,H,K,ie,ce,ge,be,Te,Ae,Ze){const Re=24*s,je=12*s,ut=48*s;return this.int16[Re+0]=h,this.int16[Re+1]=m,this.uint16[Re+2]=v,this.uint16[Re+3]=S,this.uint32[je+2]=C,this.uint32[je+3]=L,this.uint32[je+4]=z,this.uint16[Re+10]=O,this.uint16[Re+11]=H,this.uint16[Re+12]=K,this.float32[je+7]=ie,this.float32[je+8]=ce,this.uint8[ut+36]=ge,this.uint8[ut+37]=be,this.uint8[ut+38]=Te,this.uint32[je+10]=Ae,this.int16[Re+22]=Ze,s}}ma.prototype.bytesPerElement=48,Ht("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ma);class $s extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,C,L,z,O,H,K,ie,ce,ge,be,Te,Ae,Ze,Re,je,ut,ht,qt,Jt,Vt,Ot,Pt,Wt){const Ft=this.length;return this.resize(Ft+1),this.emplace(Ft,s,h,m,v,S,C,L,z,O,H,K,ie,ce,ge,be,Te,Ae,Ze,Re,je,ut,ht,qt,Jt,Vt,Ot,Pt,Wt)}emplace(s,h,m,v,S,C,L,z,O,H,K,ie,ce,ge,be,Te,Ae,Ze,Re,je,ut,ht,qt,Jt,Vt,Ot,Pt,Wt,Ft){const xt=32*s,cn=16*s;return this.int16[xt+0]=h,this.int16[xt+1]=m,this.int16[xt+2]=v,this.int16[xt+3]=S,this.int16[xt+4]=C,this.int16[xt+5]=L,this.int16[xt+6]=z,this.int16[xt+7]=O,this.uint16[xt+8]=H,this.uint16[xt+9]=K,this.uint16[xt+10]=ie,this.uint16[xt+11]=ce,this.uint16[xt+12]=ge,this.uint16[xt+13]=be,this.uint16[xt+14]=Te,this.uint16[xt+15]=Ae,this.uint16[xt+16]=Ze,this.uint16[xt+17]=Re,this.uint16[xt+18]=je,this.uint16[xt+19]=ut,this.uint16[xt+20]=ht,this.uint16[xt+21]=qt,this.uint16[xt+22]=Jt,this.uint32[cn+12]=Vt,this.float32[cn+13]=Ot,this.float32[cn+14]=Pt,this.uint16[xt+30]=Wt,this.uint16[xt+31]=Ft,s}}$s.prototype.bytesPerElement=64,Ht("StructArrayLayout8i15ui1ul2f2ui64",$s);class oc extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const h=this.length;return this.resize(h+1),this.emplace(h,s)}emplace(s,h){return this.float32[1*s+0]=h,s}}oc.prototype.bytesPerElement=4,Ht("StructArrayLayout1f4",oc);class sc extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,s,h,m)}emplace(s,h,m,v){const S=3*s;return this.uint16[6*s+0]=h,this.float32[S+1]=m,this.float32[S+2]=v,s}}sc.prototype.bytesPerElement=12,Ht("StructArrayLayout1ui2f12",sc);class Rs extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,s,h,m)}emplace(s,h,m,v){const S=4*s;return this.uint32[2*s+0]=h,this.uint16[S+2]=m,this.uint16[S+3]=v,s}}Rs.prototype.bytesPerElement=8,Ht("StructArrayLayout1ul2ui8",Rs);class _u extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h){const m=this.length;return this.resize(m+1),this.emplace(m,s,h)}emplace(s,h,m){const v=2*s;return this.uint16[v+0]=h,this.uint16[v+1]=m,s}}_u.prototype.bytesPerElement=4,Ht("StructArrayLayout2ui4",_u);class yu extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const h=this.length;return this.resize(h+1),this.emplace(h,s)}emplace(s,h){return this.uint16[1*s+0]=h,s}}yu.prototype.bytesPerElement=2,Ht("StructArrayLayout1ui2",yu);class ac extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,s,h,m,v)}emplace(s,h,m,v,S){const C=4*s;return this.float32[C+0]=h,this.float32[C+1]=m,this.float32[C+2]=v,this.float32[C+3]=S,s}}ac.prototype.bytesPerElement=16,Ht("StructArrayLayout4f16",ac);class gf extends rl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new _(this.anchorPointX,this.anchorPointY)}}gf.prototype.size=20;class x extends nc{get(s){return new gf(this,s)}}Ht("CollisionBoxArray",x);class l extends rl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(s){this._structArray.uint8[this._pos1+37]=s}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(s){this._structArray.uint8[this._pos1+38]=s}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(s){this._structArray.uint32[this._pos4+10]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}l.prototype.size=48;class f extends ma{get(s){return new l(this,s)}}Ht("PlacedSymbolArray",f);class g extends rl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(s){this._structArray.uint32[this._pos4+12]=s}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}g.prototype.size=64;class b extends $s{get(s){return new g(this,s)}}Ht("SymbolInstanceArray",b);class k extends oc{getoffsetX(s){return this.float32[1*s+0]}}Ht("GlyphOffsetArray",k);class E extends ns{getx(s){return this.int16[3*s+0]}gety(s){return this.int16[3*s+1]}gettileUnitDistanceFromAnchor(s){return this.int16[3*s+2]}}Ht("SymbolLineVertexArray",E);class A extends rl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}A.prototype.size=12;class B extends sc{get(s){return new A(this,s)}}Ht("TextAnchorOffsetArray",B);class G extends rl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}G.prototype.size=8;class X extends Rs{get(s){return new G(this,s)}}Ht("FeatureIndexArray",X);class Y extends il{}class pe extends il{}class Se extends il{}class ke extends du{}class Me extends pu{}class ye extends ol{}class Fe extends tc{}class Je extends mu{}class Le extends gu{}class Ve extends rs{}class Qe extends sl{}class nt extends al{}class ot extends ic{}class gt extends _u{}const dt=Ur([{name:"a_pos",components:2,type:"Int16"}],4),{members:It}=dt;class zt{constructor(s=[]){this.segments=s}prepareSegment(s,h,m,v){let S=this.segments[this.segments.length-1];return s>zt.MAX_VERTEX_ARRAY_LENGTH&&Pe(`Max vertices per segment is ${zt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}`),(!S||S.vertexLength+s>zt.MAX_VERTEX_ARRAY_LENGTH||S.sortKey!==v)&&(S={vertexOffset:h.length,primitiveOffset:m.length,vertexLength:0,primitiveLength:0},v!==void 0&&(S.sortKey=v),this.segments.push(S)),S}get(){return this.segments}destroy(){for(const s of this.segments)for(const h in s.vaos)s.vaos[h].destroy()}static simpleSegment(s,h,m,v){return new zt([{vertexOffset:s,primitiveOffset:h,vertexLength:m,primitiveLength:v,vaos:{},sortKey:0}])}}function yn(u,s){return 256*(u=W(Math.floor(u),0,255))+W(Math.floor(s),0,255)}zt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ht("SegmentVector",zt);const Rt=Ur([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var dn={exports:{}},bn={exports:{}};bn.exports=function(u,s){var h,m,v,S,C,L,z,O;for(m=u.length-(h=3&u.length),v=s,C=3432918353,L=461845907,O=0;O<m;)z=255&u.charCodeAt(O)|(255&u.charCodeAt(++O))<<8|(255&u.charCodeAt(++O))<<16|(255&u.charCodeAt(++O))<<24,++O,v=27492+(65535&(S=5*(65535&(v=(v^=z=(65535&(z=(z=(65535&z)*C+(((z>>>16)*C&65535)<<16)&4294967295)<<15|z>>>17))*L+(((z>>>16)*L&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(z=0,h){case 3:z^=(255&u.charCodeAt(O+2))<<16;case 2:z^=(255&u.charCodeAt(O+1))<<8;case 1:v^=z=(65535&(z=(z=(65535&(z^=255&u.charCodeAt(O)))*C+(((z>>>16)*C&65535)<<16)&4294967295)<<15|z>>>17))*L+(((z>>>16)*L&65535)<<16)&4294967295}return v^=u.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0};var jn=bn.exports,gn={exports:{}};gn.exports=function(u,s){for(var h,m=u.length,v=s^m,S=0;m>=4;)h=1540483477*(65535&(h=255&u.charCodeAt(S)|(255&u.charCodeAt(++S))<<8|(255&u.charCodeAt(++S))<<16|(255&u.charCodeAt(++S))<<24))+((1540483477*(h>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),m-=4,++S;switch(m){case 3:v^=(255&u.charCodeAt(S+2))<<16;case 2:v^=(255&u.charCodeAt(S+1))<<8;case 1:v=1540483477*(65535&(v^=255&u.charCodeAt(S)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0};var kn=jn,Pn=gn.exports;dn.exports=kn,dn.exports.murmur3=kn,dn.exports.murmur2=Pn;var $r=d(dn.exports);class or{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(s,h,m,v){this.ids.push(Qi(s)),this.positions.push(h,m,v)}getPositions(s){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const h=Qi(s);let m=0,v=this.ids.length-1;for(;m<v;){const C=m+v>>1;this.ids[C]>=h?v=C:m=C+1}const S=[];for(;this.ids[m]===h;)S.push({index:this.positions[3*m],start:this.positions[3*m+1],end:this.positions[3*m+2]}),m++;return S}static serialize(s,h){const m=new Float64Array(s.ids),v=new Uint32Array(s.positions);return ti(m,v,0,m.length-1),h&&h.push(m.buffer,v.buffer),{ids:m,positions:v}}static deserialize(s){const h=new or;return h.ids=s.ids,h.positions=s.positions,h.indexed=!0,h}}function Qi(u){const s=+u;return!isNaN(s)&&s<=Number.MAX_SAFE_INTEGER?s:$r(String(u))}function ti(u,s,h,m){for(;h<m;){const v=u[h+m>>1];let S=h-1,C=m+1;for(;;){do S++;while(u[S]<v);do C--;while(u[C]>v);if(S>=C)break;Lr(u,S,C),Lr(s,3*S,3*C),Lr(s,3*S+1,3*C+1),Lr(s,3*S+2,3*C+2)}C-h<m-C?(ti(u,s,h,C),h=C+1):(ti(u,s,C+1,m),m=C)}}function Lr(u,s,h){const m=u[s];u[s]=u[h],u[h]=m}Ht("FeaturePositionMap",or);class ni{constructor(s,h){this.gl=s.gl,this.location=h}}class eo extends ni{constructor(s,h){super(s,h),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Zo extends ni{constructor(s,h){super(s,h),this.current=[0,0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))}}class xs extends ni{constructor(s,h){super(s,h),this.current=rr.transparent}set(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))}}const ll=new Float32Array(16);function ks(u){return[yn(255*u.r,255*u.g),yn(255*u.b,255*u.a)]}class Go{constructor(s,h,m){this.value=s,this.uniformNames=h.map(v=>`u_${v}`),this.type=m}setUniform(s,h,m){s.set(m.constantOr(this.value))}getBinding(s,h,m){return this.type==="color"?new xs(s,h):new eo(s,h)}}class Gr{constructor(s,h){this.uniformNames=h.map(m=>`u_${m}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(s,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=s.tlbr}setUniform(s,h,m,v){const S=v==="u_pattern_to"?this.patternTo:v==="u_pattern_from"?this.patternFrom:v==="u_pixel_ratio_to"?this.pixelRatioTo:v==="u_pixel_ratio_from"?this.pixelRatioFrom:null;S&&s.set(S)}getBinding(s,h,m){return m.substr(0,9)==="u_pattern"?new Zo(s,h):new eo(s,h)}}class Er{constructor(s,h,m,v){this.expression=s,this.type=m,this.maxValue=0,this.paintVertexAttributes=h.map(S=>({name:`a_${S}`,type:"Float32",components:m==="color"?2:1,offset:0})),this.paintVertexArray=new v}populatePaintArray(s,h,m,v,S){const C=this.paintVertexArray.length,L=this.expression.evaluate(new kr(0),h,{},v,[],S);this.paintVertexArray.resize(s),this._setPaintValue(C,s,L)}updatePaintArray(s,h,m,v){const S=this.expression.evaluate({zoom:0},m,v);this._setPaintValue(s,h,S)}_setPaintValue(s,h,m){if(this.type==="color"){const v=ks(m);for(let S=s;S<h;S++)this.paintVertexArray.emplace(S,v[0],v[1])}else{for(let v=s;v<h;v++)this.paintVertexArray.emplace(v,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Sr{constructor(s,h,m,v,S,C){this.expression=s,this.uniformNames=h.map(L=>`u_${L}_t`),this.type=m,this.useIntegerZoom=v,this.zoom=S,this.maxValue=0,this.paintVertexAttributes=h.map(L=>({name:`a_${L}`,type:"Float32",components:m==="color"?4:2,offset:0})),this.paintVertexArray=new C}populatePaintArray(s,h,m,v,S){const C=this.expression.evaluate(new kr(this.zoom),h,{},v,[],S),L=this.expression.evaluate(new kr(this.zoom+1),h,{},v,[],S),z=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(z,s,C,L)}updatePaintArray(s,h,m,v){const S=this.expression.evaluate({zoom:this.zoom},m,v),C=this.expression.evaluate({zoom:this.zoom+1},m,v);this._setPaintValue(s,h,S,C)}_setPaintValue(s,h,m,v){if(this.type==="color"){const S=ks(m),C=ks(v);for(let L=s;L<h;L++)this.paintVertexArray.emplace(L,S[0],S[1],C[0],C[1])}else{for(let S=s;S<h;S++)this.paintVertexArray.emplace(S,m,v);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(v))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,h){const m=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,v=W(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);s.set(v)}getBinding(s,h,m){return new eo(s,h)}}class po{constructor(s,h,m,v,S,C){this.expression=s,this.type=h,this.useIntegerZoom=m,this.zoom=v,this.layerId=C,this.zoomInPaintVertexArray=new S,this.zoomOutPaintVertexArray=new S}populatePaintArray(s,h,m){const v=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(v,s,h.patterns&&h.patterns[this.layerId],m)}updatePaintArray(s,h,m,v,S){this._setPaintValues(s,h,m.patterns&&m.patterns[this.layerId],S)}_setPaintValues(s,h,m,v){if(!v||!m)return;const{min:S,mid:C,max:L}=m,z=v[S],O=v[C],H=v[L];if(z&&O&&H)for(let K=s;K<h;K++)this.zoomInPaintVertexArray.emplace(K,O.tl[0],O.tl[1],O.br[0],O.br[1],z.tl[0],z.tl[1],z.br[0],z.br[1],O.pixelRatio,z.pixelRatio),this.zoomOutPaintVertexArray.emplace(K,O.tl[0],O.tl[1],O.br[0],O.br[1],H.tl[0],H.tl[1],H.br[0],H.br[1],O.pixelRatio,H.pixelRatio)}upload(s){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,Rt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,Rt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Hr{constructor(s,h,m){this.binders={},this._buffers=[];const v=[];for(const S in s.paint._values){if(!m(S))continue;const C=s.paint.get(S);if(!(C instanceof xo&&la(C.property.specification)))continue;const L=mo(S,s.type),z=C.value,O=C.property.specification.type,H=C.property.useIntegerZoom,K=C.property.specification["property-type"],ie=K==="cross-faded"||K==="cross-faded-data-driven";if(z.kind==="constant")this.binders[S]=ie?new Gr(z.value,L):new Go(z.value,L,O),v.push(`/u_${S}`);else if(z.kind==="source"||ie){const ce=Wr(S,O,"source");this.binders[S]=ie?new po(z,O,H,h,ce,s.id):new Er(z,L,O,ce),v.push(`/a_${S}`)}else{const ce=Wr(S,O,"composite");this.binders[S]=new Sr(z,L,O,H,h,ce),v.push(`/z_${S}`)}}this.cacheKey=v.sort().join("")}getMaxValue(s){const h=this.binders[s];return h instanceof Er||h instanceof Sr?h.maxValue:0}populatePaintArrays(s,h,m,v,S){for(const C in this.binders){const L=this.binders[C];(L instanceof Er||L instanceof Sr||L instanceof po)&&L.populatePaintArray(s,h,m,v,S)}}setConstantPatternPositions(s,h){for(const m in this.binders){const v=this.binders[m];v instanceof Gr&&v.setConstantPatternPositions(s,h)}}updatePaintArrays(s,h,m,v,S){let C=!1;for(const L in s){const z=h.getPositions(L);for(const O of z){const H=m.feature(O.index);for(const K in this.binders){const ie=this.binders[K];if((ie instanceof Er||ie instanceof Sr||ie instanceof po)&&ie.expression.isStateDependent===!0){const ce=v.paint.get(K);ie.expression=ce.value,ie.updatePaintArray(O.start,O.end,H,s[L],S),C=!0}}}}return C}defines(){const s=[];for(const h in this.binders){const m=this.binders[h];(m instanceof Go||m instanceof Gr)&&s.push(...m.uniformNames.map(v=>`#define HAS_UNIFORM_${v}`))}return s}getBinderAttributes(){const s=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof Er||m instanceof Sr)for(let v=0;v<m.paintVertexAttributes.length;v++)s.push(m.paintVertexAttributes[v].name);else if(m instanceof po)for(let v=0;v<Rt.members.length;v++)s.push(Rt.members[v].name)}return s}getBinderUniforms(){const s=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof Go||m instanceof Gr||m instanceof Sr)for(const v of m.uniformNames)s.push(v)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s,h){const m=[];for(const v in this.binders){const S=this.binders[v];if(S instanceof Go||S instanceof Gr||S instanceof Sr){for(const C of S.uniformNames)if(h[C]){const L=S.getBinding(s,h[C],C);m.push({name:C,property:v,binding:L})}}}return m}setUniforms(s,h,m,v){for(const{name:S,property:C,binding:L}of h)this.binders[C].setUniform(L,v,m.get(C),S)}updatePaintBuffers(s){this._buffers=[];for(const h in this.binders){const m=this.binders[h];if(s&&m instanceof po){const v=s.fromScale===2?m.zoomInPaintVertexBuffer:m.zoomOutPaintVertexBuffer;v&&this._buffers.push(v)}else(m instanceof Er||m instanceof Sr)&&m.paintVertexBuffer&&this._buffers.push(m.paintVertexBuffer)}}upload(s){for(const h in this.binders){const m=this.binders[h];(m instanceof Er||m instanceof Sr||m instanceof po)&&m.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const h=this.binders[s];(h instanceof Er||h instanceof Sr||h instanceof po)&&h.destroy()}}}class Ir{constructor(s,h,m=()=>!0){this.programConfigurations={};for(const v of s)this.programConfigurations[v.id]=new Hr(v,h,m);this.needsUpload=!1,this._featureMap=new or,this._bufferOffset=0}populatePaintArrays(s,h,m,v,S,C){for(const L in this.programConfigurations)this.programConfigurations[L].populatePaintArrays(s,h,v,S,C);h.id!==void 0&&this._featureMap.add(h.id,m,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,h,m,v){for(const S of m)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(s,this._featureMap,h,S,v)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}function mo(u,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[u]||[u.replace(`${s}-`,"").replace(/-/g,"_")]}function Wr(u,s,h){const m={color:{source:ol,composite:ac},number:{source:oc,composite:ol}},v=function(S){return{"line-pattern":{source:Fe,composite:Fe},"fill-pattern":{source:Fe,composite:Fe},"fill-extrusion-pattern":{source:Fe,composite:Fe}}[S]}(u);return v&&v[h]||m[s][h]}Ht("ConstantBinder",Go),Ht("CrossFadedConstantBinder",Gr),Ht("SourceExpressionBinder",Er),Ht("CrossFadedCompositeBinder",po),Ht("CompositeExpressionBinder",Sr),Ht("ProgramConfiguration",Hr,{omit:["_buffers"]}),Ht("ProgramConfigurationSet",Ir);const Or=8192,bu=Math.pow(2,14)-1,_f=-bu-1;function Fs(u){const s=Or/u.extent,h=u.loadGeometry();for(let m=0;m<h.length;m++){const v=h[m];for(let S=0;S<v.length;S++){const C=v[S],L=Math.round(C.x*s),z=Math.round(C.y*s);C.x=W(L,_f,bu),C.y=W(z,_f,bu),(L<C.x||L>C.x+1||z<C.y||z>C.y+1)&&Pe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function Bs(u,s){return{type:u.type,id:u.id,properties:u.properties,geometry:s?Fs(u):[]}}function lc(u,s,h,m,v){u.emplaceBack(2*s+(m+1)/2,2*h+(v+1)/2)}class Ss{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(h=>h.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new pe,this.indexArray=new ot,this.segments=new zt,this.programConfigurations=new Ir(s.layers,s.zoom),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(s,h,m){const v=this.layers[0],S=[];let C=null,L=!1;v.type==="circle"&&(C=v.layout.get("circle-sort-key"),L=!C.isConstant());for(const{feature:z,id:O,index:H,sourceLayerIndex:K}of s){const ie=this.layers[0]._featureFilter.needGeometry,ce=Bs(z,ie);if(!this.layers[0]._featureFilter.filter(new kr(this.zoom),ce,m))continue;const ge=L?C.evaluate(ce,{},m):void 0,be={id:O,properties:z.properties,type:z.type,sourceLayerIndex:K,index:H,geometry:ie?ce.geometry:Fs(z),patterns:{},sortKey:ge};S.push(be)}L&&S.sort((z,O)=>z.sortKey-O.sortKey);for(const z of S){const{geometry:O,index:H,sourceLayerIndex:K}=z,ie=s[H].feature;this.addFeature(z,O,H,m),h.featureIndex.insert(ie,O,H,K,this.index)}}update(s,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,It),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,h,m,v){for(const S of h)for(const C of S){const L=C.x,z=C.y;if(L<0||L>=Or||z<0||z>=Or)continue;const O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),H=O.vertexLength;lc(this.layoutVertexArray,L,z,-1,-1),lc(this.layoutVertexArray,L,z,1,-1),lc(this.layoutVertexArray,L,z,1,1),lc(this.layoutVertexArray,L,z,-1,1),this.indexArray.emplaceBack(H,H+1,H+2),this.indexArray.emplaceBack(H,H+3,H+2),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,m,{},v)}}function vu(u,s){for(let h=0;h<u.length;h++)if(uc(s,u[h]))return!0;for(let h=0;h<s.length;h++)if(uc(u,s[h]))return!0;return!!cc(u,s)}function yf(u,s,h){return!!uc(u,s)||!!ep(s,u,h)}function wu(u,s){if(u.length===1)return lg(s,u[0]);for(let h=0;h<s.length;h++){const m=s[h];for(let v=0;v<m.length;v++)if(uc(u,m[v]))return!0}for(let h=0;h<u.length;h++)if(lg(s,u[h]))return!0;for(let h=0;h<s.length;h++)if(cc(u,s[h]))return!0;return!1}function xu(u,s,h){if(u.length>1){if(cc(u,s))return!0;for(let m=0;m<s.length;m++)if(ep(s[m],u,h))return!0}for(let m=0;m<u.length;m++)if(ep(u[m],s,h))return!0;return!1}function cc(u,s){if(u.length===0||s.length===0)return!1;for(let h=0;h<u.length-1;h++){const m=u[h],v=u[h+1];for(let S=0;S<s.length-1;S++)if(ku(m,v,s[S],s[S+1]))return!0}return!1}function ku(u,s,h,m){return ve(u,h,m)!==ve(s,h,m)&&ve(u,s,h)!==ve(u,s,m)}function ep(u,s,h){const m=h*h;if(s.length===1)return u.distSqr(s[0])<m;for(let v=1;v<s.length;v++)if(ag(u,s[v-1],s[v])<m)return!0;return!1}function ag(u,s,h){const m=s.distSqr(h);if(m===0)return u.distSqr(s);const v=((u.x-s.x)*(h.x-s.x)+(u.y-s.y)*(h.y-s.y))/m;return u.distSqr(v<0?s:v>1?h:h.sub(s)._mult(v)._add(s))}function lg(u,s){let h,m,v,S=!1;for(let C=0;C<u.length;C++){h=u[C];for(let L=0,z=h.length-1;L<h.length;z=L++)m=h[L],v=h[z],m.y>s.y!=v.y>s.y&&s.x<(v.x-m.x)*(s.y-m.y)/(v.y-m.y)+m.x&&(S=!S)}return S}function uc(u,s){let h=!1;for(let m=0,v=u.length-1;m<u.length;v=m++){const S=u[m],C=u[v];S.y>s.y!=C.y>s.y&&s.x<(C.x-S.x)*(s.y-S.y)/(C.y-S.y)+S.x&&(h=!h)}return h}function nw(u,s,h){const m=h[0],v=h[2];if(u.x<m.x&&s.x<m.x||u.x>v.x&&s.x>v.x||u.y<m.y&&s.y<m.y||u.y>v.y&&s.y>v.y)return!1;const S=ve(u,s,h[0]);return S!==ve(u,s,h[1])||S!==ve(u,s,h[2])||S!==ve(u,s,h[3])}function Su(u,s,h){const m=s.paint.get(u).value;return m.kind==="constant"?m.value:h.programConfigurations.get(s.id).getMaxValue(u)}function bf(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function vf(u,s,h,m,v){if(!s[0]&&!s[1])return u;const S=_.convert(s)._mult(v);h==="viewport"&&S._rotate(-m);const C=[];for(let L=0;L<u.length;L++)C.push(u[L].sub(S));return C}let cg,ug;Ht("CircleBucket",Ss,{omit:["layers"]});var rw={get paint(){return ug=ug||new Fi({"circle-radius":new un(_e.paint_circle["circle-radius"]),"circle-color":new un(_e.paint_circle["circle-color"]),"circle-blur":new un(_e.paint_circle["circle-blur"]),"circle-opacity":new un(_e.paint_circle["circle-opacity"]),"circle-translate":new rn(_e.paint_circle["circle-translate"]),"circle-translate-anchor":new rn(_e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new rn(_e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new rn(_e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new un(_e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new un(_e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new un(_e.paint_circle["circle-stroke-opacity"])})},get layout(){return cg=cg||new Fi({"circle-sort-key":new un(_e.layout_circle["circle-sort-key"])})}},Bi=1e-6,hc=typeof Float32Array<"u"?Float32Array:Array;function tp(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function hg(u,s,h){var m=s[0],v=s[1],S=s[2],C=s[3],L=s[4],z=s[5],O=s[6],H=s[7],K=s[8],ie=s[9],ce=s[10],ge=s[11],be=s[12],Te=s[13],Ae=s[14],Ze=s[15],Re=h[0],je=h[1],ut=h[2],ht=h[3];return u[0]=Re*m+je*L+ut*K+ht*be,u[1]=Re*v+je*z+ut*ie+ht*Te,u[2]=Re*S+je*O+ut*ce+ht*Ae,u[3]=Re*C+je*H+ut*ge+ht*Ze,u[4]=(Re=h[4])*m+(je=h[5])*L+(ut=h[6])*K+(ht=h[7])*be,u[5]=Re*v+je*z+ut*ie+ht*Te,u[6]=Re*S+je*O+ut*ce+ht*Ae,u[7]=Re*C+je*H+ut*ge+ht*Ze,u[8]=(Re=h[8])*m+(je=h[9])*L+(ut=h[10])*K+(ht=h[11])*be,u[9]=Re*v+je*z+ut*ie+ht*Te,u[10]=Re*S+je*O+ut*ce+ht*Ae,u[11]=Re*C+je*H+ut*ge+ht*Ze,u[12]=(Re=h[12])*m+(je=h[13])*L+(ut=h[14])*K+(ht=h[15])*be,u[13]=Re*v+je*z+ut*ie+ht*Te,u[14]=Re*S+je*O+ut*ce+ht*Ae,u[15]=Re*C+je*H+ut*ge+ht*Ze,u}Math.hypot||(Math.hypot=function(){for(var u=0,s=arguments.length;s--;)u+=arguments[s]*arguments[s];return Math.sqrt(u)});var Cu,iw=hg;function wf(u,s,h){var m=s[0],v=s[1],S=s[2],C=s[3];return u[0]=h[0]*m+h[4]*v+h[8]*S+h[12]*C,u[1]=h[1]*m+h[5]*v+h[9]*S+h[13]*C,u[2]=h[2]*m+h[6]*v+h[10]*S+h[14]*C,u[3]=h[3]*m+h[7]*v+h[11]*S+h[15]*C,u}Cu=new hc(4),hc!=Float32Array&&(Cu[0]=0,Cu[1]=0,Cu[2]=0,Cu[3]=0);class ow extends ko{constructor(s){super(s,rw)}createBucket(s){return new Ss(s)}queryRadius(s){const h=s;return Su("circle-radius",this,h)+Su("circle-stroke-width",this,h)+bf(this.paint.get("circle-translate"))}queryIntersectsFeature(s,h,m,v,S,C,L,z){const O=vf(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),C.angle,L),H=this.paint.get("circle-radius").evaluate(h,m)+this.paint.get("circle-stroke-width").evaluate(h,m),K=this.paint.get("circle-pitch-alignment")==="map",ie=K?O:function(ge,be){return ge.map(Te=>fg(Te,be))}(O,z),ce=K?H*L:H;for(const ge of v)for(const be of ge){const Te=K?be:fg(be,z);let Ae=ce;const Ze=wf([],[be.x,be.y,0,1],z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Ae*=Ze[3]/C.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Ae*=C.cameraToCenterDistance/Ze[3]),yf(ie,Te,Ae))return!0}return!1}}function fg(u,s){const h=wf([],[u.x,u.y,0,1],s);return new _(h[0]/h[3],h[1]/h[3])}class dg extends Ss{}let pg;Ht("HeatmapBucket",dg,{omit:["layers"]});var sw={get paint(){return pg=pg||new Fi({"heatmap-radius":new un(_e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new un(_e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new rn(_e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new uu(_e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new rn(_e.paint_heatmap["heatmap-opacity"])})}};function np(u,{width:s,height:h},m,v){if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==s*h*m)throw new RangeError(`mismatched image size. expected: ${v.length} but got: ${s*h*m}`)}else v=new Uint8Array(s*h*m);return u.width=s,u.height=h,u.data=v,u}function mg(u,{width:s,height:h},m){if(s===u.width&&h===u.height)return;const v=np({},{width:s,height:h},m);rp(u,v,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,s),height:Math.min(u.height,h)},m),u.width=s,u.height=h,u.data=v.data}function rp(u,s,h,m,v,S){if(v.width===0||v.height===0)return s;if(v.width>u.width||v.height>u.height||h.x>u.width-v.width||h.y>u.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>s.width||v.height>s.height||m.x>s.width-v.width||m.y>s.height-v.height)throw new RangeError("out of range destination coordinates for image copy");const C=u.data,L=s.data;if(C===L)throw new Error("srcData equals dstData, so image is already copied");for(let z=0;z<v.height;z++){const O=((h.y+z)*u.width+h.x)*S,H=((m.y+z)*s.width+m.x)*S;for(let K=0;K<v.width*S;K++)L[H+K]=C[O+K]}return s}class Tu{constructor(s,h){np(this,s,1,h)}resize(s){mg(this,s,1)}clone(){return new Tu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,h,m,v,S){rp(s,h,m,v,S,1)}}class So{constructor(s,h){np(this,s,4,h)}resize(s){mg(this,s,4)}replace(s,h){h?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new So({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,h,m,v,S){rp(s,h,m,v,S,4)}}function gg(u){const s={},h=u.resolution||256,m=u.clips?u.clips.length:1,v=u.image||new So({width:h,height:m});if(Math.log(h)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${h}`);const S=(C,L,z)=>{s[u.evaluationKey]=z;const O=u.expression.evaluate(s);v.data[C+L+0]=Math.floor(255*O.r/O.a),v.data[C+L+1]=Math.floor(255*O.g/O.a),v.data[C+L+2]=Math.floor(255*O.b/O.a),v.data[C+L+3]=Math.floor(255*O.a)};if(u.clips)for(let C=0,L=0;C<m;++C,L+=4*h)for(let z=0,O=0;z<h;z++,O+=4){const H=z/(h-1),{start:K,end:ie}=u.clips[C];S(L,O,K*(1-H)+ie*H)}else for(let C=0,L=0;C<h;C++,L+=4)S(0,L,C/(h-1));return v}Ht("AlphaImage",Tu),Ht("RGBAImage",So);class aw extends ko{createBucket(s){return new dg(s)}constructor(s){super(s,sw),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=gg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let _g;var lw={get paint(){return _g=_g||new Fi({"hillshade-illumination-direction":new rn(_e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new rn(_e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new rn(_e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new rn(_e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new rn(_e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new rn(_e.paint_hillshade["hillshade-accent-color"])})}};class cw extends ko{constructor(s){super(s,lw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const uw=Ur([{name:"a_pos",components:2,type:"Int16"}],4),{members:hw}=uw;var ip={exports:{}};function xf(u,s,h){h=h||2;var m,v,S,C,L,z,O,H=s&&s.length,K=H?s[0]*h:u.length,ie=yg(u,0,K,h,!0),ce=[];if(!ie||ie.next===ie.prev)return ce;if(H&&(ie=function(be,Te,Ae,Ze){var Re,je,ut,ht=[];for(Re=0,je=Te.length;Re<je;Re++)(ut=yg(be,Te[Re]*Ze,Re<je-1?Te[Re+1]*Ze:be.length,Ze,!1))===ut.next&&(ut.steiner=!0),ht.push(bw(ut));for(ht.sort(gw),Re=0;Re<ht.length;Re++)Ae=_w(ht[Re],Ae);return Ae}(u,s,ie,h)),u.length>80*h){m=S=u[0],v=C=u[1];for(var ge=h;ge<K;ge+=h)(L=u[ge])<m&&(m=L),(z=u[ge+1])<v&&(v=z),L>S&&(S=L),z>C&&(C=z);O=(O=Math.max(S-m,C-v))!==0?32767/O:0}return Mu(ie,ce,h,m,v,O,0),ce}function yg(u,s,h,m,v){var S,C;if(v===ap(u,s,h,m)>0)for(S=s;S<h;S+=m)C=wg(S,u[S],u[S+1],C);else for(S=h-m;S>=s;S-=m)C=wg(S,u[S],u[S+1],C);return C&&kf(C,C.next)&&(Eu(C),C=C.next),C}function cl(u,s){if(!u)return u;s||(s=u);var h,m=u;do if(h=!1,m.steiner||!kf(m,m.next)&&Vr(m.prev,m,m.next)!==0)m=m.next;else{if(Eu(m),(m=s=m.prev)===m.next)break;h=!0}while(h||m!==s);return s}function Mu(u,s,h,m,v,S,C){if(u){!C&&S&&function(H,K,ie,ce){var ge=H;do ge.z===0&&(ge.z=op(ge.x,ge.y,K,ie,ce)),ge.prevZ=ge.prev,ge.nextZ=ge.next,ge=ge.next;while(ge!==H);ge.prevZ.nextZ=null,ge.prevZ=null,function(be){var Te,Ae,Ze,Re,je,ut,ht,qt,Jt=1;do{for(Ae=be,be=null,je=null,ut=0;Ae;){for(ut++,Ze=Ae,ht=0,Te=0;Te<Jt&&(ht++,Ze=Ze.nextZ);Te++);for(qt=Jt;ht>0||qt>0&&Ze;)ht!==0&&(qt===0||!Ze||Ae.z<=Ze.z)?(Re=Ae,Ae=Ae.nextZ,ht--):(Re=Ze,Ze=Ze.nextZ,qt--),je?je.nextZ=Re:be=Re,Re.prevZ=je,je=Re;Ae=Ze}je.nextZ=null,Jt*=2}while(ut>1)}(ge)}(u,m,v,S);for(var L,z,O=u;u.prev!==u.next;)if(L=u.prev,z=u.next,S?dw(u,m,v,S):fw(u))s.push(L.i/h|0),s.push(u.i/h|0),s.push(z.i/h|0),Eu(u),u=z.next,O=z.next;else if((u=z)===O){C?C===1?Mu(u=pw(cl(u),s,h),s,h,m,v,S,2):C===2&&mw(u,s,h,m,v,S):Mu(cl(u),s,h,m,v,S,1);break}}}function fw(u){var s=u.prev,h=u,m=u.next;if(Vr(s,h,m)>=0)return!1;for(var v=s.x,S=h.x,C=m.x,L=s.y,z=h.y,O=m.y,H=v<S?v<C?v:C:S<C?S:C,K=L<z?L<O?L:O:z<O?z:O,ie=v>S?v>C?v:C:S>C?S:C,ce=L>z?L>O?L:O:z>O?z:O,ge=m.next;ge!==s;){if(ge.x>=H&&ge.x<=ie&&ge.y>=K&&ge.y<=ce&&fc(v,L,S,z,C,O,ge.x,ge.y)&&Vr(ge.prev,ge,ge.next)>=0)return!1;ge=ge.next}return!0}function dw(u,s,h,m){var v=u.prev,S=u,C=u.next;if(Vr(v,S,C)>=0)return!1;for(var L=v.x,z=S.x,O=C.x,H=v.y,K=S.y,ie=C.y,ce=L<z?L<O?L:O:z<O?z:O,ge=H<K?H<ie?H:ie:K<ie?K:ie,be=L>z?L>O?L:O:z>O?z:O,Te=H>K?H>ie?H:ie:K>ie?K:ie,Ae=op(ce,ge,s,h,m),Ze=op(be,Te,s,h,m),Re=u.prevZ,je=u.nextZ;Re&&Re.z>=Ae&&je&&je.z<=Ze;){if(Re.x>=ce&&Re.x<=be&&Re.y>=ge&&Re.y<=Te&&Re!==v&&Re!==C&&fc(L,H,z,K,O,ie,Re.x,Re.y)&&Vr(Re.prev,Re,Re.next)>=0||(Re=Re.prevZ,je.x>=ce&&je.x<=be&&je.y>=ge&&je.y<=Te&&je!==v&&je!==C&&fc(L,H,z,K,O,ie,je.x,je.y)&&Vr(je.prev,je,je.next)>=0))return!1;je=je.nextZ}for(;Re&&Re.z>=Ae;){if(Re.x>=ce&&Re.x<=be&&Re.y>=ge&&Re.y<=Te&&Re!==v&&Re!==C&&fc(L,H,z,K,O,ie,Re.x,Re.y)&&Vr(Re.prev,Re,Re.next)>=0)return!1;Re=Re.prevZ}for(;je&&je.z<=Ze;){if(je.x>=ce&&je.x<=be&&je.y>=ge&&je.y<=Te&&je!==v&&je!==C&&fc(L,H,z,K,O,ie,je.x,je.y)&&Vr(je.prev,je,je.next)>=0)return!1;je=je.nextZ}return!0}function pw(u,s,h){var m=u;do{var v=m.prev,S=m.next.next;!kf(v,S)&&bg(v,m,m.next,S)&&Lu(v,S)&&Lu(S,v)&&(s.push(v.i/h|0),s.push(m.i/h|0),s.push(S.i/h|0),Eu(m),Eu(m.next),m=u=S),m=m.next}while(m!==u);return cl(m)}function mw(u,s,h,m,v,S){var C=u;do{for(var L=C.next.next;L!==C.prev;){if(C.i!==L.i&&vw(C,L)){var z=vg(C,L);return C=cl(C,C.next),z=cl(z,z.next),Mu(C,s,h,m,v,S,0),void Mu(z,s,h,m,v,S,0)}L=L.next}C=C.next}while(C!==u)}function gw(u,s){return u.x-s.x}function _w(u,s){var h=function(v,S){var C,L=S,z=v.x,O=v.y,H=-1/0;do{if(O<=L.y&&O>=L.next.y&&L.next.y!==L.y){var K=L.x+(O-L.y)*(L.next.x-L.x)/(L.next.y-L.y);if(K<=z&&K>H&&(H=K,C=L.x<L.next.x?L:L.next,K===z))return C}L=L.next}while(L!==S);if(!C)return null;var ie,ce=C,ge=C.x,be=C.y,Te=1/0;L=C;do z>=L.x&&L.x>=ge&&z!==L.x&&fc(O<be?z:H,O,ge,be,O<be?H:z,O,L.x,L.y)&&(ie=Math.abs(O-L.y)/(z-L.x),Lu(L,v)&&(ie<Te||ie===Te&&(L.x>C.x||L.x===C.x&&yw(C,L)))&&(C=L,Te=ie)),L=L.next;while(L!==ce);return C}(u,s);if(!h)return s;var m=vg(h,u);return cl(m,m.next),cl(h,h.next)}function yw(u,s){return Vr(u.prev,u,s.prev)<0&&Vr(s.next,u,u.next)<0}function op(u,s,h,m,v){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-h)*v|0)|u<<8))|u<<4))|u<<2))|u<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-m)*v|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function bw(u){var s=u,h=u;do(s.x<h.x||s.x===h.x&&s.y<h.y)&&(h=s),s=s.next;while(s!==u);return h}function fc(u,s,h,m,v,S,C,L){return(v-C)*(s-L)>=(u-C)*(S-L)&&(u-C)*(m-L)>=(h-C)*(s-L)&&(h-C)*(S-L)>=(v-C)*(m-L)}function vw(u,s){return u.next.i!==s.i&&u.prev.i!==s.i&&!function(h,m){var v=h;do{if(v.i!==h.i&&v.next.i!==h.i&&v.i!==m.i&&v.next.i!==m.i&&bg(v,v.next,h,m))return!0;v=v.next}while(v!==h);return!1}(u,s)&&(Lu(u,s)&&Lu(s,u)&&function(h,m){var v=h,S=!1,C=(h.x+m.x)/2,L=(h.y+m.y)/2;do v.y>L!=v.next.y>L&&v.next.y!==v.y&&C<(v.next.x-v.x)*(L-v.y)/(v.next.y-v.y)+v.x&&(S=!S),v=v.next;while(v!==h);return S}(u,s)&&(Vr(u.prev,u,s.prev)||Vr(u,s.prev,s))||kf(u,s)&&Vr(u.prev,u,u.next)>0&&Vr(s.prev,s,s.next)>0)}function Vr(u,s,h){return(s.y-u.y)*(h.x-s.x)-(s.x-u.x)*(h.y-s.y)}function kf(u,s){return u.x===s.x&&u.y===s.y}function bg(u,s,h,m){var v=Cf(Vr(u,s,h)),S=Cf(Vr(u,s,m)),C=Cf(Vr(h,m,u)),L=Cf(Vr(h,m,s));return v!==S&&C!==L||!(v!==0||!Sf(u,h,s))||!(S!==0||!Sf(u,m,s))||!(C!==0||!Sf(h,u,m))||!(L!==0||!Sf(h,s,m))}function Sf(u,s,h){return s.x<=Math.max(u.x,h.x)&&s.x>=Math.min(u.x,h.x)&&s.y<=Math.max(u.y,h.y)&&s.y>=Math.min(u.y,h.y)}function Cf(u){return u>0?1:u<0?-1:0}function Lu(u,s){return Vr(u.prev,u,u.next)<0?Vr(u,s,u.next)>=0&&Vr(u,u.prev,s)>=0:Vr(u,s,u.prev)<0||Vr(u,u.next,s)<0}function vg(u,s){var h=new sp(u.i,u.x,u.y),m=new sp(s.i,s.x,s.y),v=u.next,S=s.prev;return u.next=s,s.prev=u,h.next=v,v.prev=h,m.next=h,h.prev=m,S.next=m,m.prev=S,m}function wg(u,s,h,m){var v=new sp(u,s,h);return m?(v.next=m.next,v.prev=m,m.next.prev=v,m.next=v):(v.prev=v,v.next=v),v}function Eu(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function sp(u,s,h){this.i=u,this.x=s,this.y=h,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ap(u,s,h,m){for(var v=0,S=s,C=h-m;S<h;S+=m)v+=(u[C]-u[S])*(u[S+1]+u[C+1]),C=S;return v}ip.exports=xf,ip.exports.default=xf,xf.deviation=function(u,s,h,m){var v=s&&s.length,S=Math.abs(ap(u,0,v?s[0]*h:u.length,h));if(v)for(var C=0,L=s.length;C<L;C++)S-=Math.abs(ap(u,s[C]*h,C<L-1?s[C+1]*h:u.length,h));var z=0;for(C=0;C<m.length;C+=3){var O=m[C]*h,H=m[C+1]*h,K=m[C+2]*h;z+=Math.abs((u[O]-u[K])*(u[H+1]-u[O+1])-(u[O]-u[H])*(u[K+1]-u[O+1]))}return S===0&&z===0?0:Math.abs((z-S)/S)},xf.flatten=function(u){for(var s=u[0][0].length,h={vertices:[],holes:[],dimensions:s},m=0,v=0;v<u.length;v++){for(var S=0;S<u[v].length;S++)for(var C=0;C<s;C++)h.vertices.push(u[v][S][C]);v>0&&h.holes.push(m+=u[v-1].length)}return h};var xg=d(ip.exports);function ww(u,s,h,m,v){kg(u,s,h||0,m||u.length-1,v||xw)}function kg(u,s,h,m,v){for(;m>h;){if(m-h>600){var S=m-h+1,C=s-h+1,L=Math.log(S),z=.5*Math.exp(2*L/3),O=.5*Math.sqrt(L*z*(S-z)/S)*(C-S/2<0?-1:1);kg(u,s,Math.max(h,Math.floor(s-C*z/S+O)),Math.min(m,Math.floor(s+(S-C)*z/S+O)),v)}var H=u[s],K=h,ie=m;for(Iu(u,h,s),v(u[m],H)>0&&Iu(u,h,m);K<ie;){for(Iu(u,K,ie),K++,ie--;v(u[K],H)<0;)K++;for(;v(u[ie],H)>0;)ie--}v(u[h],H)===0?Iu(u,h,ie):Iu(u,++ie,m),ie<=s&&(h=ie+1),s<=ie&&(m=ie-1)}}function Iu(u,s,h){var m=u[s];u[s]=u[h],u[h]=m}function xw(u,s){return u<s?-1:u>s?1:0}function lp(u,s){const h=u.length;if(h<=1)return[u];const m=[];let v,S;for(let C=0;C<h;C++){const L=tt(u[C]);L!==0&&(u[C].area=Math.abs(L),S===void 0&&(S=L<0),S===L<0?(v&&m.push(v),v=[u[C]]):v.push(u[C]))}if(v&&m.push(v),s>1)for(let C=0;C<m.length;C++)m[C].length<=s||(ww(m[C],s,1,m[C].length-1,kw),m[C]=m[C].slice(0,s));return m}function kw(u,s){return s.area-u.area}function cp(u,s,h){const m=h.patternDependencies;let v=!1;for(const S of s){const C=S.paint.get(`${u}-pattern`);C.isConstant()||(v=!0);const L=C.constantOr(null);L&&(v=!0,m[L.to]=!0,m[L.from]=!0)}return v}function up(u,s,h,m,v){const S=v.patternDependencies;for(const C of s){const L=C.paint.get(`${u}-pattern`).value;if(L.kind!=="constant"){let z=L.evaluate({zoom:m-1},h,{},v.availableImages),O=L.evaluate({zoom:m},h,{},v.availableImages),H=L.evaluate({zoom:m+1},h,{},v.availableImages);z=z&&z.name?z.name:z,O=O&&O.name?O.name:O,H=H&&H.name?H.name:H,S[z]=!0,S[O]=!0,S[H]=!0,h.patterns[C.id]={min:z,mid:O,max:H}}}return h}class hp{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(h=>h.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Se,this.indexArray=new ot,this.indexArray2=new gt,this.programConfigurations=new Ir(s.layers,s.zoom),this.segments=new zt,this.segments2=new zt,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(s,h,m){this.hasPattern=cp("fill",this.layers,h);const v=this.layers[0].layout.get("fill-sort-key"),S=!v.isConstant(),C=[];for(const{feature:L,id:z,index:O,sourceLayerIndex:H}of s){const K=this.layers[0]._featureFilter.needGeometry,ie=Bs(L,K);if(!this.layers[0]._featureFilter.filter(new kr(this.zoom),ie,m))continue;const ce=S?v.evaluate(ie,{},m,h.availableImages):void 0,ge={id:z,properties:L.properties,type:L.type,sourceLayerIndex:H,index:O,geometry:K?ie.geometry:Fs(L),patterns:{},sortKey:ce};C.push(ge)}S&&C.sort((L,z)=>L.sortKey-z.sortKey);for(const L of C){const{geometry:z,index:O,sourceLayerIndex:H}=L;if(this.hasPattern){const K=up("fill",this.layers,L,this.zoom,h);this.patternFeatures.push(K)}else this.addFeature(L,z,O,m,{});h.featureIndex.insert(s[O].feature,z,O,H,this.index)}}update(s,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,m)}addFeatures(s,h,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,hw),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(s,h,m,v,S){for(const C of lp(h,500)){let L=0;for(const ce of C)L+=ce.length;const z=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray),O=z.vertexLength,H=[],K=[];for(const ce of C){if(ce.length===0)continue;ce!==C[0]&&K.push(H.length/2);const ge=this.segments2.prepareSegment(ce.length,this.layoutVertexArray,this.indexArray2),be=ge.vertexLength;this.layoutVertexArray.emplaceBack(ce[0].x,ce[0].y),this.indexArray2.emplaceBack(be+ce.length-1,be),H.push(ce[0].x),H.push(ce[0].y);for(let Te=1;Te<ce.length;Te++)this.layoutVertexArray.emplaceBack(ce[Te].x,ce[Te].y),this.indexArray2.emplaceBack(be+Te-1,be+Te),H.push(ce[Te].x),H.push(ce[Te].y);ge.vertexLength+=ce.length,ge.primitiveLength+=ce.length}const ie=xg(H,K);for(let ce=0;ce<ie.length;ce+=3)this.indexArray.emplaceBack(O+ie[ce],O+ie[ce+1],O+ie[ce+2]);z.vertexLength+=L,z.primitiveLength+=ie.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,m,S,v)}}let Sg,Cg;Ht("FillBucket",hp,{omit:["layers","patternFeatures"]});var Sw={get paint(){return Cg=Cg||new Fi({"fill-antialias":new rn(_e.paint_fill["fill-antialias"]),"fill-opacity":new un(_e.paint_fill["fill-opacity"]),"fill-color":new un(_e.paint_fill["fill-color"]),"fill-outline-color":new un(_e.paint_fill["fill-outline-color"]),"fill-translate":new rn(_e.paint_fill["fill-translate"]),"fill-translate-anchor":new rn(_e.paint_fill["fill-translate-anchor"]),"fill-pattern":new ec(_e.paint_fill["fill-pattern"])})},get layout(){return Sg=Sg||new Fi({"fill-sort-key":new un(_e.layout_fill["fill-sort-key"])})}};class Cw extends ko{constructor(s){super(s,Sw)}recalculate(s,h){super.recalculate(s,h);const m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new hp(s)}queryRadius(){return bf(this.paint.get("fill-translate"))}queryIntersectsFeature(s,h,m,v,S,C,L){return wu(vf(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),C.angle,L),v)}isTileClipped(){return!0}}const Tw=Ur([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Mw=Ur([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Lw}=Tw;var ga={},Ew=p,Tg=dc;function dc(u,s,h,m,v){this.properties={},this.extent=h,this.type=0,this._pbf=u,this._geometry=-1,this._keys=m,this._values=v,u.readFields(Iw,this,s)}function Iw(u,s,h){u==1?s.id=h.readVarint():u==2?function(m,v){for(var S=m.readVarint()+m.pos;m.pos<S;){var C=v._keys[m.readVarint()],L=v._values[m.readVarint()];v.properties[C]=L}}(h,s):u==3?s.type=h.readVarint():u==4&&(s._geometry=h.pos)}function Aw(u){for(var s,h,m=0,v=0,S=u.length,C=S-1;v<S;C=v++)m+=((h=u[C]).x-(s=u[v]).x)*(s.y+h.y);return m}dc.types=["Unknown","Point","LineString","Polygon"],dc.prototype.loadGeometry=function(){var u=this._pbf;u.pos=this._geometry;for(var s,h=u.readVarint()+u.pos,m=1,v=0,S=0,C=0,L=[];u.pos<h;){if(v<=0){var z=u.readVarint();m=7&z,v=z>>3}if(v--,m===1||m===2)S+=u.readSVarint(),C+=u.readSVarint(),m===1&&(s&&L.push(s),s=[]),s.push(new Ew(S,C));else{if(m!==7)throw new Error("unknown command "+m);s&&s.push(s[0].clone())}}return s&&L.push(s),L},dc.prototype.bbox=function(){var u=this._pbf;u.pos=this._geometry;for(var s=u.readVarint()+u.pos,h=1,m=0,v=0,S=0,C=1/0,L=-1/0,z=1/0,O=-1/0;u.pos<s;){if(m<=0){var H=u.readVarint();h=7&H,m=H>>3}if(m--,h===1||h===2)(v+=u.readSVarint())<C&&(C=v),v>L&&(L=v),(S+=u.readSVarint())<z&&(z=S),S>O&&(O=S);else if(h!==7)throw new Error("unknown command "+h)}return[C,z,L,O]},dc.prototype.toGeoJSON=function(u,s,h){var m,v,S=this.extent*Math.pow(2,h),C=this.extent*u,L=this.extent*s,z=this.loadGeometry(),O=dc.types[this.type];function H(ce){for(var ge=0;ge<ce.length;ge++){var be=ce[ge];ce[ge]=[360*(be.x+C)/S-180,360/Math.PI*Math.atan(Math.exp((180-360*(be.y+L)/S)*Math.PI/180))-90]}}switch(this.type){case 1:var K=[];for(m=0;m<z.length;m++)K[m]=z[m][0];H(z=K);break;case 2:for(m=0;m<z.length;m++)H(z[m]);break;case 3:for(z=function(ce){var ge=ce.length;if(ge<=1)return[ce];for(var be,Te,Ae=[],Ze=0;Ze<ge;Ze++){var Re=Aw(ce[Ze]);Re!==0&&(Te===void 0&&(Te=Re<0),Te===Re<0?(be&&Ae.push(be),be=[ce[Ze]]):be.push(ce[Ze]))}return be&&Ae.push(be),Ae}(z),m=0;m<z.length;m++)for(v=0;v<z[m].length;v++)H(z[m][v])}z.length===1?z=z[0]:O="Multi"+O;var ie={type:"Feature",geometry:{type:O,coordinates:z},properties:this.properties};return"id"in this&&(ie.id=this.id),ie};var Pw=Tg,Mg=Lg;function Lg(u,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(zw,this,s),this.length=this._features.length}function zw(u,s,h){u===15?s.version=h.readVarint():u===1?s.name=h.readString():u===5?s.extent=h.readVarint():u===2?s._features.push(h.pos):u===3?s._keys.push(h.readString()):u===4&&s._values.push(function(m){for(var v=null,S=m.readVarint()+m.pos;m.pos<S;){var C=m.readVarint()>>3;v=C===1?m.readString():C===2?m.readFloat():C===3?m.readDouble():C===4?m.readVarint64():C===5?m.readVarint():C===6?m.readSVarint():C===7?m.readBoolean():null}return v}(h))}Lg.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var s=this._pbf.readVarint()+this._pbf.pos;return new Pw(this._pbf,s,this.extent,this._keys,this._values)};var Dw=Mg;function $w(u,s,h){if(u===3){var m=new Dw(h,h.readVarint()+h.pos);m.length&&(s[m.name]=m)}}ga.VectorTile=function(u,s){this.layers=u.readFields($w,{},s)},ga.VectorTileFeature=Tg,ga.VectorTileLayer=Mg;const Rw=ga.VectorTileFeature.types,fp=Math.pow(2,13);function Au(u,s,h,m,v,S,C,L){u.emplaceBack(s,h,2*Math.floor(m*fp)+C,v*fp*2,S*fp*2,Math.round(L))}class dp{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(h=>h.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new ke,this.centroidVertexArray=new Y,this.indexArray=new ot,this.programConfigurations=new Ir(s.layers,s.zoom),this.segments=new zt,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(s,h,m){this.features=[],this.hasPattern=cp("fill-extrusion",this.layers,h);for(const{feature:v,id:S,index:C,sourceLayerIndex:L}of s){const z=this.layers[0]._featureFilter.needGeometry,O=Bs(v,z);if(!this.layers[0]._featureFilter.filter(new kr(this.zoom),O,m))continue;const H={id:S,sourceLayerIndex:L,index:C,geometry:z?O.geometry:Fs(v),properties:v.properties,type:v.type,patterns:{}};this.hasPattern?this.features.push(up("fill-extrusion",this.layers,H,this.zoom,h)):this.addFeature(H,H.geometry,C,m,{}),h.featureIndex.insert(v,H.geometry,C,L,this.index,!0)}}addFeatures(s,h,m){for(const v of this.features){const{geometry:S}=v;this.addFeature(v,S,v.index,h,m)}}update(s,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Lw),this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,Mw.members,!0),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(s,h,m,v,S){const C={x:0,y:0,vertexCount:0};for(const L of lp(h,500)){let z=0;for(const ge of L)z+=ge.length;let O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ge of L){if(ge.length===0||Bw(ge))continue;let be=0;for(let Te=0;Te<ge.length;Te++){const Ae=ge[Te];if(Te>=1){const Ze=ge[Te-1];if(!Fw(Ae,Ze)){O.vertexLength+4>zt.MAX_VERTEX_ARRAY_LENGTH&&(O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Re=Ae.sub(Ze)._perp()._unit(),je=Ze.dist(Ae);be+je>32768&&(be=0),Au(this.layoutVertexArray,Ae.x,Ae.y,Re.x,Re.y,0,0,be),Au(this.layoutVertexArray,Ae.x,Ae.y,Re.x,Re.y,0,1,be),C.x+=2*Ae.x,C.y+=2*Ae.y,C.vertexCount+=2,be+=je,Au(this.layoutVertexArray,Ze.x,Ze.y,Re.x,Re.y,0,0,be),Au(this.layoutVertexArray,Ze.x,Ze.y,Re.x,Re.y,0,1,be),C.x+=2*Ze.x,C.y+=2*Ze.y,C.vertexCount+=2;const ut=O.vertexLength;this.indexArray.emplaceBack(ut,ut+2,ut+1),this.indexArray.emplaceBack(ut+1,ut+2,ut+3),O.vertexLength+=4,O.primitiveLength+=2}}}}if(O.vertexLength+z>zt.MAX_VERTEX_ARRAY_LENGTH&&(O=this.segments.prepareSegment(z,this.layoutVertexArray,this.indexArray)),Rw[s.type]!=="Polygon")continue;const H=[],K=[],ie=O.vertexLength;for(const ge of L)if(ge.length!==0){ge!==L[0]&&K.push(H.length/2);for(let be=0;be<ge.length;be++){const Te=ge[be];Au(this.layoutVertexArray,Te.x,Te.y,0,0,1,1,0),C.x+=Te.x,C.y+=Te.y,C.vertexCount+=1,H.push(Te.x),H.push(Te.y)}}const ce=xg(H,K);for(let ge=0;ge<ce.length;ge+=3)this.indexArray.emplaceBack(ie+ce[ge],ie+ce[ge+2],ie+ce[ge+1]);O.primitiveLength+=ce.length/3,O.vertexLength+=z}for(let L=0;L<C.vertexCount;L++)this.centroidVertexArray.emplaceBack(Math.floor(C.x/C.vertexCount),Math.floor(C.y/C.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,m,S,v)}}function Fw(u,s){return u.x===s.x&&(u.x<0||u.x>Or)||u.y===s.y&&(u.y<0||u.y>Or)}function Bw(u){return u.every(s=>s.x<0)||u.every(s=>s.x>Or)||u.every(s=>s.y<0)||u.every(s=>s.y>Or)}let Eg;Ht("FillExtrusionBucket",dp,{omit:["layers","features"]});var Ow={get paint(){return Eg=Eg||new Fi({"fill-extrusion-opacity":new rn(_e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new un(_e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new rn(_e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new rn(_e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ec(_e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new un(_e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new un(_e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new rn(_e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Nw extends ko{constructor(s){super(s,Ow)}createBucket(s){return new dp(s)}queryRadius(){return bf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(s,h,m,v,S,C,L,z){const O=vf(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),C.angle,L),H=this.paint.get("fill-extrusion-height").evaluate(h,m),K=this.paint.get("fill-extrusion-base").evaluate(h,m),ie=function(ge,be,Te,Ae){const Ze=[];for(const Re of ge){const je=[Re.x,Re.y,0,1];wf(je,je,be),Ze.push(new _(je[0]/je[3],je[1]/je[3]))}return Ze}(O,z),ce=function(ge,be,Te,Ae){const Ze=[],Re=[],je=Ae[8]*be,ut=Ae[9]*be,ht=Ae[10]*be,qt=Ae[11]*be,Jt=Ae[8]*Te,Vt=Ae[9]*Te,Ot=Ae[10]*Te,Pt=Ae[11]*Te;for(const Wt of ge){const Ft=[],xt=[];for(const cn of Wt){const nn=cn.x,Dn=cn.y,_r=Ae[0]*nn+Ae[4]*Dn+Ae[12],Cr=Ae[1]*nn+Ae[5]*Dn+Ae[13],ii=Ae[2]*nn+Ae[6]*Dn+Ae[14],go=Ae[3]*nn+Ae[7]*Dn+Ae[15],Oi=ii+ht,Kr=go+qt,gi=_r+Jt,xi=Cr+Vt,Ni=ii+Ot,ji=go+Pt,oi=new _((_r+je)/Kr,(Cr+ut)/Kr);oi.z=Oi/Kr,Ft.push(oi);const si=new _(gi/ji,xi/ji);si.z=Ni/ji,xt.push(si)}Ze.push(Ft),Re.push(xt)}return[Ze,Re]}(v,K,H,z);return function(ge,be,Te){let Ae=1/0;wu(Te,be)&&(Ae=Ig(Te,be[0]));for(let Ze=0;Ze<be.length;Ze++){const Re=be[Ze],je=ge[Ze];for(let ut=0;ut<Re.length-1;ut++){const ht=Re[ut],qt=[ht,Re[ut+1],je[ut+1],je[ut],ht];vu(Te,qt)&&(Ae=Math.min(Ae,Ig(Te,qt)))}}return Ae!==1/0&&Ae}(ce[0],ce[1],ie)}}function Pu(u,s){return u.x*s.x+u.y*s.y}function Ig(u,s){if(u.length===1){let h=0;const m=s[h++];let v;for(;!v||m.equals(v);)if(v=s[h++],!v)return 1/0;for(;h<s.length;h++){const S=s[h],C=u[0],L=v.sub(m),z=S.sub(m),O=C.sub(m),H=Pu(L,L),K=Pu(L,z),ie=Pu(z,z),ce=Pu(O,L),ge=Pu(O,z),be=H*ie-K*K,Te=(ie*ce-K*ge)/be,Ae=(H*ge-K*ce)/be,Ze=m.z*(1-Te-Ae)+v.z*Te+S.z*Ae;if(isFinite(Ze))return Ze}return 1/0}{let h=1/0;for(const m of s)h=Math.min(h,m.z);return h}}const jw=Ur([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Uw}=jw,Vw=Ur([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:qw}=Vw,Zw=ga.VectorTileFeature.types,Gw=Math.cos(Math.PI/180*37.5),Ag=Math.pow(2,14)/.5;class pp{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(h=>h.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new Me,this.layoutVertexArray2=new ye,this.indexArray=new ot,this.programConfigurations=new Ir(s.layers,s.zoom),this.segments=new zt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(s,h,m){this.hasPattern=cp("line",this.layers,h);const v=this.layers[0].layout.get("line-sort-key"),S=!v.isConstant(),C=[];for(const{feature:L,id:z,index:O,sourceLayerIndex:H}of s){const K=this.layers[0]._featureFilter.needGeometry,ie=Bs(L,K);if(!this.layers[0]._featureFilter.filter(new kr(this.zoom),ie,m))continue;const ce=S?v.evaluate(ie,{},m):void 0,ge={id:z,properties:L.properties,type:L.type,sourceLayerIndex:H,index:O,geometry:K?ie.geometry:Fs(L),patterns:{},sortKey:ce};C.push(ge)}S&&C.sort((L,z)=>L.sortKey-z.sortKey);for(const L of C){const{geometry:z,index:O,sourceLayerIndex:H}=L;if(this.hasPattern){const K=up("line",this.layers,L,this.zoom,h);this.patternFeatures.push(K)}else this.addFeature(L,z,O,m,{});h.featureIndex.insert(s[O].feature,z,O,H,this.index)}}update(s,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,m)}addFeatures(s,h,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,qw)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Uw),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,h,m,v,S){const C=this.layers[0].layout,L=C.get("line-join").evaluate(s,{}),z=C.get("line-cap"),O=C.get("line-miter-limit"),H=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(const K of h)this.addLine(K,s,L,z,O,H);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,m,S,v)}addLine(s,h,m,v,S,C){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ae=0;Ae<s.length-1;Ae++)this.totalDistance+=s[Ae].dist(s[Ae+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const L=Zw[h.type]==="Polygon";let z=s.length;for(;z>=2&&s[z-1].equals(s[z-2]);)z--;let O=0;for(;O<z-1&&s[O].equals(s[O+1]);)O++;if(z<(L?3:2))return;m==="bevel"&&(S=1.05);const H=this.overscaling<=16?15*Or/(512*this.overscaling):0,K=this.segments.prepareSegment(10*z,this.layoutVertexArray,this.indexArray);let ie,ce,ge,be,Te;this.e1=this.e2=-1,L&&(ie=s[z-2],Te=s[O].sub(ie)._unit()._perp());for(let Ae=O;Ae<z;Ae++){if(ge=Ae===z-1?L?s[O+1]:void 0:s[Ae+1],ge&&s[Ae].equals(ge))continue;Te&&(be=Te),ie&&(ce=ie),ie=s[Ae],Te=ge?ge.sub(ie)._unit()._perp():be,be=be||Te;let Ze=be.add(Te);Ze.x===0&&Ze.y===0||Ze._unit();const Re=be.x*Te.x+be.y*Te.y,je=Ze.x*Te.x+Ze.y*Te.y,ut=je!==0?1/je:1/0,ht=2*Math.sqrt(2-2*je),qt=je<Gw&&ce&&ge,Jt=be.x*Te.y-be.y*Te.x>0;if(qt&&Ae>O){const Pt=ie.dist(ce);if(Pt>2*H){const Wt=ie.sub(ie.sub(ce)._mult(H/Pt)._round());this.updateDistance(ce,Wt),this.addCurrentVertex(Wt,be,0,0,K),ce=Wt}}const Vt=ce&&ge;let Ot=Vt?m:L?"butt":v;if(Vt&&Ot==="round"&&(ut<C?Ot="miter":ut<=2&&(Ot="fakeround")),Ot==="miter"&&ut>S&&(Ot="bevel"),Ot==="bevel"&&(ut>2&&(Ot="flipbevel"),ut<S&&(Ot="miter")),ce&&this.updateDistance(ce,ie),Ot==="miter")Ze._mult(ut),this.addCurrentVertex(ie,Ze,0,0,K);else if(Ot==="flipbevel"){if(ut>100)Ze=Te.mult(-1);else{const Pt=ut*be.add(Te).mag()/be.sub(Te).mag();Ze._perp()._mult(Pt*(Jt?-1:1))}this.addCurrentVertex(ie,Ze,0,0,K),this.addCurrentVertex(ie,Ze.mult(-1),0,0,K)}else if(Ot==="bevel"||Ot==="fakeround"){const Pt=-Math.sqrt(ut*ut-1),Wt=Jt?Pt:0,Ft=Jt?0:Pt;if(ce&&this.addCurrentVertex(ie,be,Wt,Ft,K),Ot==="fakeround"){const xt=Math.round(180*ht/Math.PI/20);for(let cn=1;cn<xt;cn++){let nn=cn/xt;if(nn!==.5){const _r=nn-.5;nn+=nn*_r*(nn-1)*((1.0904+Re*(Re*(3.55645-1.43519*Re)-3.2452))*_r*_r+(.848013+Re*(.215638*Re-1.06021)))}const Dn=Te.sub(be)._mult(nn)._add(be)._unit()._mult(Jt?-1:1);this.addHalfVertex(ie,Dn.x,Dn.y,!1,Jt,0,K)}}ge&&this.addCurrentVertex(ie,Te,-Wt,-Ft,K)}else if(Ot==="butt")this.addCurrentVertex(ie,Ze,0,0,K);else if(Ot==="square"){const Pt=ce?1:-1;this.addCurrentVertex(ie,Ze,Pt,Pt,K)}else Ot==="round"&&(ce&&(this.addCurrentVertex(ie,be,0,0,K),this.addCurrentVertex(ie,be,1,1,K,!0)),ge&&(this.addCurrentVertex(ie,Te,-1,-1,K,!0),this.addCurrentVertex(ie,Te,0,0,K)));if(qt&&Ae<z-1){const Pt=ie.dist(ge);if(Pt>2*H){const Wt=ie.add(ge.sub(ie)._mult(H/Pt)._round());this.updateDistance(ie,Wt),this.addCurrentVertex(Wt,Te,0,0,K),ie=Wt}}}}addCurrentVertex(s,h,m,v,S,C=!1){const L=h.y*v-h.x,z=-h.y-h.x*v;this.addHalfVertex(s,h.x+h.y*m,h.y-h.x*m,C,!1,m,S),this.addHalfVertex(s,L,z,C,!0,-v,S),this.distance>Ag/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(s,h,m,v,S,C))}addHalfVertex({x:s,y:h},m,v,S,C,L,z){const O=.5*(this.lineClips?this.scaledDistance*(Ag-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s<<1)+(S?1:0),(h<<1)+(C?1:0),Math.round(63*m)+128,Math.round(63*v)+128,1+(L===0?0:L<0?-1:1)|(63&O)<<2,O>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const H=z.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,H),z.primitiveLength++),C?this.e2=H:this.e1=H}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(s,h){this.distance+=s.dist(h),this.updateScaledDistance()}}let Pg,zg;Ht("LineBucket",pp,{omit:["layers","patternFeatures"]});var Dg={get paint(){return zg=zg||new Fi({"line-opacity":new un(_e.paint_line["line-opacity"]),"line-color":new un(_e.paint_line["line-color"]),"line-translate":new rn(_e.paint_line["line-translate"]),"line-translate-anchor":new rn(_e.paint_line["line-translate-anchor"]),"line-width":new un(_e.paint_line["line-width"]),"line-gap-width":new un(_e.paint_line["line-gap-width"]),"line-offset":new un(_e.paint_line["line-offset"]),"line-blur":new un(_e.paint_line["line-blur"]),"line-dasharray":new nl(_e.paint_line["line-dasharray"]),"line-pattern":new ec(_e.paint_line["line-pattern"]),"line-gradient":new uu(_e.paint_line["line-gradient"])})},get layout(){return Pg=Pg||new Fi({"line-cap":new rn(_e.layout_line["line-cap"]),"line-join":new un(_e.layout_line["line-join"]),"line-miter-limit":new rn(_e.layout_line["line-miter-limit"]),"line-round-limit":new rn(_e.layout_line["line-round-limit"]),"line-sort-key":new un(_e.layout_line["line-sort-key"])})}};class Hw extends un{possiblyEvaluate(s,h){return h=new kr(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),super.possiblyEvaluate(s,h)}evaluate(s,h,m,v){return h=J({},h,{zoom:Math.floor(h.zoom)}),super.evaluate(s,h,m,v)}}let Tf;class Ww extends ko{constructor(s){super(s,Dg),this.gradientVersion=0,Tf||(Tf=new Hw(Dg.paint.properties["line-width"].specification),Tf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const h=this.gradientExpression();this.stepInterpolant=!!function(m){return m._styleExpression!==void 0}(h)&&h._styleExpression.expression instanceof Wa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,h){super.recalculate(s,h),this.paint._values["line-floorwidth"]=Tf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new pp(s)}queryRadius(s){const h=s,m=$g(Su("line-width",this,h),Su("line-gap-width",this,h)),v=Su("line-offset",this,h);return m/2+Math.abs(v)+bf(this.paint.get("line-translate"))}queryIntersectsFeature(s,h,m,v,S,C,L){const z=vf(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),C.angle,L),O=L/2*$g(this.paint.get("line-width").evaluate(h,m),this.paint.get("line-gap-width").evaluate(h,m)),H=this.paint.get("line-offset").evaluate(h,m);return H&&(v=function(K,ie){const ce=[];for(let ge=0;ge<K.length;ge++){const be=K[ge],Te=[];for(let Ae=0;Ae<be.length;Ae++){const Ze=be[Ae-1],Re=be[Ae],je=be[Ae+1],ut=Ae===0?new _(0,0):Re.sub(Ze)._unit()._perp(),ht=Ae===be.length-1?new _(0,0):je.sub(Re)._unit()._perp(),qt=ut._add(ht)._unit(),Jt=qt.x*ht.x+qt.y*ht.y;Jt!==0&&qt._mult(1/Jt),Te.push(qt._mult(ie)._add(Re))}ce.push(Te)}return ce}(v,H*L)),function(K,ie,ce){for(let ge=0;ge<ie.length;ge++){const be=ie[ge];if(K.length>=3){for(let Te=0;Te<be.length;Te++)if(uc(K,be[Te]))return!0}if(xu(K,be,ce))return!0}return!1}(z,v,O)}isTileClipped(){return!0}}function $g(u,s){return s>0?s+2*u:u}const Kw=Ur([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Xw=Ur([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ur([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Jw=Ur([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Ur([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Rg=Ur([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Yw=Ur([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Qw(u,s,h){return u.sections.forEach(m=>{m.text=function(v,S,C){const L=S.layout.get("text-transform").evaluate(C,{});return L==="uppercase"?v=v.toLocaleUpperCase():L==="lowercase"&&(v=v.toLocaleLowerCase()),ws.applyArabicShaping&&(v=ws.applyArabicShaping(v)),v}(m.text,s,h)}),u}Ur([{name:"triangle",components:3,type:"Uint16"}]),Ur([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ur([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ur([{type:"Float32",name:"offsetX"}]),Ur([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ur([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const zu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var ri=24,Fg=ar,Bg=function(u,s,h,m,v){var S,C,L=8*v-m-1,z=(1<<L)-1,O=z>>1,H=-7,K=h?v-1:0,ie=h?-1:1,ce=u[s+K];for(K+=ie,S=ce&(1<<-H)-1,ce>>=-H,H+=L;H>0;S=256*S+u[s+K],K+=ie,H-=8);for(C=S&(1<<-H)-1,S>>=-H,H+=m;H>0;C=256*C+u[s+K],K+=ie,H-=8);if(S===0)S=1-O;else{if(S===z)return C?NaN:1/0*(ce?-1:1);C+=Math.pow(2,m),S-=O}return(ce?-1:1)*C*Math.pow(2,S-m)},Og=function(u,s,h,m,v,S){var C,L,z,O=8*S-v-1,H=(1<<O)-1,K=H>>1,ie=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,ce=m?0:S-1,ge=m?1:-1,be=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(L=isNaN(s)?1:0,C=H):(C=Math.floor(Math.log(s)/Math.LN2),s*(z=Math.pow(2,-C))<1&&(C--,z*=2),(s+=C+K>=1?ie/z:ie*Math.pow(2,1-K))*z>=2&&(C++,z/=2),C+K>=H?(L=0,C=H):C+K>=1?(L=(s*z-1)*Math.pow(2,v),C+=K):(L=s*Math.pow(2,K-1)*Math.pow(2,v),C=0));v>=8;u[h+ce]=255&L,ce+=ge,L/=256,v-=8);for(C=C<<v|L,O+=v;O>0;u[h+ce]=255&C,ce+=ge,C/=256,O-=8);u[h+ce-ge]|=128*be};function ar(u){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(u)?u:new Uint8Array(u||0),this.pos=0,this.type=0,this.length=this.buf.length}ar.Varint=0,ar.Fixed64=1,ar.Bytes=2,ar.Fixed32=5;var mp=4294967296,Ng=1/mp,jg=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Os(u){return u.type===ar.Bytes?u.readVarint()+u.pos:u.pos+1}function pc(u,s,h){return h?4294967296*s+(u>>>0):4294967296*(s>>>0)+(u>>>0)}function Ug(u,s,h){var m=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));h.realloc(m);for(var v=h.pos-1;v>=u;v--)h.buf[v+m]=h.buf[v]}function e2(u,s){for(var h=0;h<u.length;h++)s.writeVarint(u[h])}function t2(u,s){for(var h=0;h<u.length;h++)s.writeSVarint(u[h])}function n2(u,s){for(var h=0;h<u.length;h++)s.writeFloat(u[h])}function r2(u,s){for(var h=0;h<u.length;h++)s.writeDouble(u[h])}function i2(u,s){for(var h=0;h<u.length;h++)s.writeBoolean(u[h])}function o2(u,s){for(var h=0;h<u.length;h++)s.writeFixed32(u[h])}function s2(u,s){for(var h=0;h<u.length;h++)s.writeSFixed32(u[h])}function a2(u,s){for(var h=0;h<u.length;h++)s.writeFixed64(u[h])}function l2(u,s){for(var h=0;h<u.length;h++)s.writeSFixed64(u[h])}function Mf(u,s){return(u[s]|u[s+1]<<8|u[s+2]<<16)+16777216*u[s+3]}function mc(u,s,h){u[h]=s,u[h+1]=s>>>8,u[h+2]=s>>>16,u[h+3]=s>>>24}function Vg(u,s){return(u[s]|u[s+1]<<8|u[s+2]<<16)+(u[s+3]<<24)}ar.prototype={destroy:function(){this.buf=null},readFields:function(u,s,h){for(h=h||this.length;this.pos<h;){var m=this.readVarint(),v=m>>3,S=this.pos;this.type=7&m,u(v,s,this),this.pos===S&&this.skip(m)}return s},readMessage:function(u,s){return this.readFields(u,s,this.readVarint()+this.pos)},readFixed32:function(){var u=Mf(this.buf,this.pos);return this.pos+=4,u},readSFixed32:function(){var u=Vg(this.buf,this.pos);return this.pos+=4,u},readFixed64:function(){var u=Mf(this.buf,this.pos)+Mf(this.buf,this.pos+4)*mp;return this.pos+=8,u},readSFixed64:function(){var u=Mf(this.buf,this.pos)+Vg(this.buf,this.pos+4)*mp;return this.pos+=8,u},readFloat:function(){var u=Bg(this.buf,this.pos,!0,23,4);return this.pos+=4,u},readDouble:function(){var u=Bg(this.buf,this.pos,!0,52,8);return this.pos+=8,u},readVarint:function(u){var s,h,m=this.buf;return s=127&(h=m[this.pos++]),h<128?s:(s|=(127&(h=m[this.pos++]))<<7,h<128?s:(s|=(127&(h=m[this.pos++]))<<14,h<128?s:(s|=(127&(h=m[this.pos++]))<<21,h<128?s:function(v,S,C){var L,z,O=C.buf;if(L=(112&(z=O[C.pos++]))>>4,z<128||(L|=(127&(z=O[C.pos++]))<<3,z<128)||(L|=(127&(z=O[C.pos++]))<<10,z<128)||(L|=(127&(z=O[C.pos++]))<<17,z<128)||(L|=(127&(z=O[C.pos++]))<<24,z<128)||(L|=(1&(z=O[C.pos++]))<<31,z<128))return pc(v,L,S);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(h=m[this.pos]))<<28,u,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var u=this.readVarint();return u%2==1?(u+1)/-2:u/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var u=this.readVarint()+this.pos,s=this.pos;return this.pos=u,u-s>=12&&jg?function(h,m,v){return jg.decode(h.subarray(m,v))}(this.buf,s,u):function(h,m,v){for(var S="",C=m;C<v;){var L,z,O,H=h[C],K=null,ie=H>239?4:H>223?3:H>191?2:1;if(C+ie>v)break;ie===1?H<128&&(K=H):ie===2?(192&(L=h[C+1]))==128&&(K=(31&H)<<6|63&L)<=127&&(K=null):ie===3?(z=h[C+2],(192&(L=h[C+1]))==128&&(192&z)==128&&((K=(15&H)<<12|(63&L)<<6|63&z)<=2047||K>=55296&&K<=57343)&&(K=null)):ie===4&&(z=h[C+2],O=h[C+3],(192&(L=h[C+1]))==128&&(192&z)==128&&(192&O)==128&&((K=(15&H)<<18|(63&L)<<12|(63&z)<<6|63&O)<=65535||K>=1114112)&&(K=null)),K===null?(K=65533,ie=1):K>65535&&(K-=65536,S+=String.fromCharCode(K>>>10&1023|55296),K=56320|1023&K),S+=String.fromCharCode(K),C+=ie}return S}(this.buf,s,u)},readBytes:function(){var u=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,u);return this.pos=u,s},readPackedVarint:function(u,s){if(this.type!==ar.Bytes)return u.push(this.readVarint(s));var h=Os(this);for(u=u||[];this.pos<h;)u.push(this.readVarint(s));return u},readPackedSVarint:function(u){if(this.type!==ar.Bytes)return u.push(this.readSVarint());var s=Os(this);for(u=u||[];this.pos<s;)u.push(this.readSVarint());return u},readPackedBoolean:function(u){if(this.type!==ar.Bytes)return u.push(this.readBoolean());var s=Os(this);for(u=u||[];this.pos<s;)u.push(this.readBoolean());return u},readPackedFloat:function(u){if(this.type!==ar.Bytes)return u.push(this.readFloat());var s=Os(this);for(u=u||[];this.pos<s;)u.push(this.readFloat());return u},readPackedDouble:function(u){if(this.type!==ar.Bytes)return u.push(this.readDouble());var s=Os(this);for(u=u||[];this.pos<s;)u.push(this.readDouble());return u},readPackedFixed32:function(u){if(this.type!==ar.Bytes)return u.push(this.readFixed32());var s=Os(this);for(u=u||[];this.pos<s;)u.push(this.readFixed32());return u},readPackedSFixed32:function(u){if(this.type!==ar.Bytes)return u.push(this.readSFixed32());var s=Os(this);for(u=u||[];this.pos<s;)u.push(this.readSFixed32());return u},readPackedFixed64:function(u){if(this.type!==ar.Bytes)return u.push(this.readFixed64());var s=Os(this);for(u=u||[];this.pos<s;)u.push(this.readFixed64());return u},readPackedSFixed64:function(u){if(this.type!==ar.Bytes)return u.push(this.readSFixed64());var s=Os(this);for(u=u||[];this.pos<s;)u.push(this.readSFixed64());return u},skip:function(u){var s=7&u;if(s===ar.Varint)for(;this.buf[this.pos++]>127;);else if(s===ar.Bytes)this.pos=this.readVarint()+this.pos;else if(s===ar.Fixed32)this.pos+=4;else{if(s!==ar.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(u,s){this.writeVarint(u<<3|s)},realloc:function(u){for(var s=this.length||16;s<this.pos+u;)s*=2;if(s!==this.length){var h=new Uint8Array(s);h.set(this.buf),this.buf=h,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(u){this.realloc(4),mc(this.buf,u,this.pos),this.pos+=4},writeSFixed32:function(u){this.realloc(4),mc(this.buf,u,this.pos),this.pos+=4},writeFixed64:function(u){this.realloc(8),mc(this.buf,-1&u,this.pos),mc(this.buf,Math.floor(u*Ng),this.pos+4),this.pos+=8},writeSFixed64:function(u){this.realloc(8),mc(this.buf,-1&u,this.pos),mc(this.buf,Math.floor(u*Ng),this.pos+4),this.pos+=8},writeVarint:function(u){(u=+u||0)>268435455||u<0?function(s,h){var m,v;if(s>=0?(m=s%4294967296|0,v=s/4294967296|0):(v=~(-s/4294967296),4294967295^(m=~(-s%4294967296))?m=m+1|0:(m=0,v=v+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),function(S,C,L){L.buf[L.pos++]=127&S|128,S>>>=7,L.buf[L.pos++]=127&S|128,S>>>=7,L.buf[L.pos++]=127&S|128,S>>>=7,L.buf[L.pos++]=127&S|128,L.buf[L.pos]=127&(S>>>=7)}(m,0,h),function(S,C){var L=(7&S)<<4;C.buf[C.pos++]|=L|((S>>>=3)?128:0),S&&(C.buf[C.pos++]=127&S|((S>>>=7)?128:0),S&&(C.buf[C.pos++]=127&S|((S>>>=7)?128:0),S&&(C.buf[C.pos++]=127&S|((S>>>=7)?128:0),S&&(C.buf[C.pos++]=127&S|((S>>>=7)?128:0),S&&(C.buf[C.pos++]=127&S)))))}(v,h)}(u,this):(this.realloc(4),this.buf[this.pos++]=127&u|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=u>>>7&127))))},writeSVarint:function(u){this.writeVarint(u<0?2*-u-1:2*u)},writeBoolean:function(u){this.writeVarint(!!u)},writeString:function(u){u=String(u),this.realloc(4*u.length),this.pos++;var s=this.pos;this.pos=function(m,v,S){for(var C,L,z=0;z<v.length;z++){if((C=v.charCodeAt(z))>55295&&C<57344){if(!L){C>56319||z+1===v.length?(m[S++]=239,m[S++]=191,m[S++]=189):L=C;continue}if(C<56320){m[S++]=239,m[S++]=191,m[S++]=189,L=C;continue}C=L-55296<<10|C-56320|65536,L=null}else L&&(m[S++]=239,m[S++]=191,m[S++]=189,L=null);C<128?m[S++]=C:(C<2048?m[S++]=C>>6|192:(C<65536?m[S++]=C>>12|224:(m[S++]=C>>18|240,m[S++]=C>>12&63|128),m[S++]=C>>6&63|128),m[S++]=63&C|128)}return S}(this.buf,u,this.pos);var h=this.pos-s;h>=128&&Ug(s,h,this),this.pos=s-1,this.writeVarint(h),this.pos+=h},writeFloat:function(u){this.realloc(4),Og(this.buf,u,this.pos,!0,23,4),this.pos+=4},writeDouble:function(u){this.realloc(8),Og(this.buf,u,this.pos,!0,52,8),this.pos+=8},writeBytes:function(u){var s=u.length;this.writeVarint(s),this.realloc(s);for(var h=0;h<s;h++)this.buf[this.pos++]=u[h]},writeRawMessage:function(u,s){this.pos++;var h=this.pos;u(s,this);var m=this.pos-h;m>=128&&Ug(h,m,this),this.pos=h-1,this.writeVarint(m),this.pos+=m},writeMessage:function(u,s,h){this.writeTag(u,ar.Bytes),this.writeRawMessage(s,h)},writePackedVarint:function(u,s){s.length&&this.writeMessage(u,e2,s)},writePackedSVarint:function(u,s){s.length&&this.writeMessage(u,t2,s)},writePackedBoolean:function(u,s){s.length&&this.writeMessage(u,i2,s)},writePackedFloat:function(u,s){s.length&&this.writeMessage(u,n2,s)},writePackedDouble:function(u,s){s.length&&this.writeMessage(u,r2,s)},writePackedFixed32:function(u,s){s.length&&this.writeMessage(u,o2,s)},writePackedSFixed32:function(u,s){s.length&&this.writeMessage(u,s2,s)},writePackedFixed64:function(u,s){s.length&&this.writeMessage(u,a2,s)},writePackedSFixed64:function(u,s){s.length&&this.writeMessage(u,l2,s)},writeBytesField:function(u,s){this.writeTag(u,ar.Bytes),this.writeBytes(s)},writeFixed32Field:function(u,s){this.writeTag(u,ar.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(u,s){this.writeTag(u,ar.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(u,s){this.writeTag(u,ar.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(u,s){this.writeTag(u,ar.Fixed64),this.writeSFixed64(s)},writeVarintField:function(u,s){this.writeTag(u,ar.Varint),this.writeVarint(s)},writeSVarintField:function(u,s){this.writeTag(u,ar.Varint),this.writeSVarint(s)},writeStringField:function(u,s){this.writeTag(u,ar.Bytes),this.writeString(s)},writeFloatField:function(u,s){this.writeTag(u,ar.Fixed32),this.writeFloat(s)},writeDoubleField:function(u,s){this.writeTag(u,ar.Fixed64),this.writeDouble(s)},writeBooleanField:function(u,s){this.writeVarintField(u,!!s)}};var gp=d(Fg);const _p=3;function c2(u,s,h){u===1&&h.readMessage(u2,s)}function u2(u,s,h){if(u===3){const{id:m,bitmap:v,width:S,height:C,left:L,top:z,advance:O}=h.readMessage(h2,{});s.push({id:m,bitmap:new Tu({width:S+2*_p,height:C+2*_p},v),metrics:{width:S,height:C,left:L,top:z,advance:O}})}}function h2(u,s,h){u===1?s.id=h.readVarint():u===2?s.bitmap=h.readBytes():u===3?s.width=h.readVarint():u===4?s.height=h.readVarint():u===5?s.left=h.readSVarint():u===6?s.top=h.readSVarint():u===7&&(s.advance=h.readVarint())}const qg=_p;function Zg(u){let s=0,h=0;for(const C of u)s+=C.w*C.h,h=Math.max(h,C.w);u.sort((C,L)=>L.h-C.h);const m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),h),h:1/0}];let v=0,S=0;for(const C of u)for(let L=m.length-1;L>=0;L--){const z=m[L];if(!(C.w>z.w||C.h>z.h)){if(C.x=z.x,C.y=z.y,S=Math.max(S,C.y+C.h),v=Math.max(v,C.x+C.w),C.w===z.w&&C.h===z.h){const O=m.pop();L<m.length&&(m[L]=O)}else C.h===z.h?(z.x+=C.w,z.w-=C.w):C.w===z.w?(z.y+=C.h,z.h-=C.h):(m.push({x:z.x+C.w,y:z.y,w:z.w-C.w,h:C.h}),z.y+=C.h,z.h-=C.h);break}}return{w:v,h:S,fill:s/(v*S)||0}}const to=1;class yp{constructor(s,{pixelRatio:h,version:m,stretchX:v,stretchY:S,content:C}){this.paddedRect=s,this.pixelRatio=h,this.stretchX=v,this.stretchY=S,this.content=C,this.version=m}get tl(){return[this.paddedRect.x+to,this.paddedRect.y+to]}get br(){return[this.paddedRect.x+this.paddedRect.w-to,this.paddedRect.y+this.paddedRect.h-to]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*to)/this.pixelRatio,(this.paddedRect.h-2*to)/this.pixelRatio]}}class Gg{constructor(s,h){const m={},v={};this.haveRenderCallbacks=[];const S=[];this.addImages(s,m,S),this.addImages(h,v,S);const{w:C,h:L}=Zg(S),z=new So({width:C||1,height:L||1});for(const O in s){const H=s[O],K=m[O].paddedRect;So.copy(H.data,z,{x:0,y:0},{x:K.x+to,y:K.y+to},H.data)}for(const O in h){const H=h[O],K=v[O].paddedRect,ie=K.x+to,ce=K.y+to,ge=H.data.width,be=H.data.height;So.copy(H.data,z,{x:0,y:0},{x:ie,y:ce},H.data),So.copy(H.data,z,{x:0,y:be-1},{x:ie,y:ce-1},{width:ge,height:1}),So.copy(H.data,z,{x:0,y:0},{x:ie,y:ce+be},{width:ge,height:1}),So.copy(H.data,z,{x:ge-1,y:0},{x:ie-1,y:ce},{width:1,height:be}),So.copy(H.data,z,{x:0,y:0},{x:ie+ge,y:ce},{width:1,height:be})}this.image=z,this.iconPositions=m,this.patternPositions=v}addImages(s,h,m){for(const v in s){const S=s[v],C={x:0,y:0,w:S.data.width+2*to,h:S.data.height+2*to};m.push(C),h[v]=new yp(C,S),S.hasRenderCallback&&this.haveRenderCallbacks.push(v)}}patchUpdatedImages(s,h){s.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const m in s.updatedImages)this.patchUpdatedImage(this.iconPositions[m],s.getImage(m),h),this.patchUpdatedImage(this.patternPositions[m],s.getImage(m),h)}patchUpdatedImage(s,h,m){if(!s||!h||s.version===h.version)return;s.version=h.version;const[v,S]=s.tl;m.update(h.data,void 0,{x:v,y:S})}}var _a;Ht("ImagePosition",yp),Ht("ImageAtlas",Gg),c.ah=void 0,(_a=c.ah||(c.ah={}))[_a.none=0]="none",_a[_a.horizontal=1]="horizontal",_a[_a.vertical=2]="vertical",_a[_a.horizontalOnly=3]="horizontalOnly";const Du=-17;class $u{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(s,h){const m=new $u;return m.scale=s||1,m.fontStack=h,m}static forImage(s){const h=new $u;return h.imageName=s,h}}class gc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,h){const m=new gc;for(let v=0;v<s.sections.length;v++){const S=s.sections[v];S.image?m.addImageSection(S):m.addTextSection(S,h)}return m}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSectionIndex(s){return this.sectionIndex[s]}getCharCode(s){return this.text.charCodeAt(s)}verticalizePunctuation(){this.text=function(s){let h="";for(let m=0;m<s.length;m++){const v=s.charCodeAt(m+1)||null,S=s.charCodeAt(m-1)||null;h+=v&&lu(v)&&!zu[s[m+1]]||S&&lu(S)&&!zu[s[m-1]]||!zu[s[m]]?s[m]:zu[s[m]]}return h}(this.text)}trim(){let s=0;for(let m=0;m<this.text.length&&Ef[this.text.charCodeAt(m)];m++)s++;let h=this.text.length;for(let m=this.text.length-1;m>=0&&m>=s&&Ef[this.text.charCodeAt(m)];m--)h--;this.text=this.text.substring(s,h),this.sectionIndex=this.sectionIndex.slice(s,h)}substring(s,h){const m=new gc;return m.text=this.text.substring(s,h),m.sectionIndex=this.sectionIndex.slice(s,h),m.sections=this.sections,m}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,h)=>Math.max(s,this.sections[h].scale),0)}addTextSection(s,h){this.text+=s.text,this.sections.push($u.forText(s.scale,s.fontStack||h));const m=this.sections.length-1;for(let v=0;v<s.text.length;++v)this.sectionIndex.push(m)}addImageSection(s){const h=s.image?s.image.name:"";if(h.length===0)return void Pe("Can't add FormattedSection with an empty image.");const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCharCode(m),this.sections.push($u.forImage(h)),this.sectionIndex.push(this.sections.length-1)):Pe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Lf(u,s,h,m,v,S,C,L,z,O,H,K,ie,ce,ge,be){const Te=gc.fromFeature(u,v);let Ae;K===c.ah.vertical&&Te.verticalizePunctuation();const{processBidirectionalText:Ze,processStyledBidirectionalText:Re}=ws;if(Ze&&Te.sections.length===1){Ae=[];const ht=Ze(Te.toString(),bp(Te,O,S,s,m,ce,ge));for(const qt of ht){const Jt=new gc;Jt.text=qt,Jt.sections=Te.sections;for(let Vt=0;Vt<qt.length;Vt++)Jt.sectionIndex.push(0);Ae.push(Jt)}}else if(Re){Ae=[];const ht=Re(Te.text,Te.sectionIndex,bp(Te,O,S,s,m,ce,ge));for(const qt of ht){const Jt=new gc;Jt.text=qt[0],Jt.sectionIndex=qt[1],Jt.sections=Te.sections,Ae.push(Jt)}}else Ae=function(ht,qt){const Jt=[],Vt=ht.text;let Ot=0;for(const Pt of qt)Jt.push(ht.substring(Ot,Pt)),Ot=Pt;return Ot<Vt.length&&Jt.push(ht.substring(Ot,Vt.length)),Jt}(Te,bp(Te,O,S,s,m,ce,ge));const je=[],ut={positionedLines:je,text:Te.toString(),top:H[1],bottom:H[1],left:H[0],right:H[0],writingMode:K,iconsInText:!1,verticalizable:!1};return function(ht,qt,Jt,Vt,Ot,Pt,Wt,Ft,xt,cn,nn,Dn){let _r=0,Cr=Du,ii=0,go=0;const Oi=Ft==="right"?1:Ft==="left"?0:.5;let Kr=0;for(const oi of Ot){oi.trim();const si=oi.getMaxScale(),Ei=(si-1)*ri,Ui={positionedGlyphs:[],lineOffset:0};ht.positionedLines[Kr]=Ui;const Ii=Ui.positionedGlyphs;let no=0;if(!oi.length()){Cr+=Pt,++Kr;continue}for(let ai=0;ai<oi.length();ai++){const On=oi.getSection(ai),Ai=oi.getSectionIndex(ai),ki=oi.getCharCode(ai);let li=0,Ho=null,is=null,os=null,Ns=ri;const Wo=!(xt===c.ah.horizontal||!nn&&!Jl(ki)||nn&&(Ef[ki]||(gi=ki,Ut.Arabic(gi)||Ut["Arabic Supplement"](gi)||Ut["Arabic Extended-A"](gi)||Ut["Arabic Presentation Forms-A"](gi)||Ut["Arabic Presentation Forms-B"](gi))));if(On.imageName){const To=Vt[On.imageName];if(!To)continue;os=On.imageName,ht.iconsInText=ht.iconsInText||!0,is=To.paddedRect;const io=To.displaySize;On.scale=On.scale*ri/Dn,Ho={width:io[0],height:io[1],left:to,top:-qg,advance:Wo?io[1]:io[0]},li=Ei+(ri-io[1]*On.scale),Ns=Ho.advance;const js=Wo?io[0]*On.scale-ri*si:io[1]*On.scale-ri*si;js>0&&js>no&&(no=js)}else{const To=Jt[On.fontStack],io=To&&To[ki];if(io&&io.rect)is=io.rect,Ho=io.metrics;else{const js=qt[On.fontStack],Nu=js&&js[ki];if(!Nu)continue;Ho=Nu.metrics}li=(si-On.scale)*ri}Wo?(ht.verticalizable=!0,Ii.push({glyph:ki,imageName:os,x:_r,y:Cr+li,vertical:Wo,scale:On.scale,fontStack:On.fontStack,sectionIndex:Ai,metrics:Ho,rect:is}),_r+=Ns*On.scale+cn):(Ii.push({glyph:ki,imageName:os,x:_r,y:Cr+li,vertical:Wo,scale:On.scale,fontStack:On.fontStack,sectionIndex:Ai,metrics:Ho,rect:is}),_r+=Ho.advance*On.scale+cn)}Ii.length!==0&&(ii=Math.max(_r-cn,ii),p2(Ii,0,Ii.length-1,Oi,no)),_r=0;const ro=Pt*si+no;Ui.lineOffset=Math.max(no,Ei),Cr+=ro,go=Math.max(ro,go),++Kr}var gi;const xi=Cr-Du,{horizontalAlign:Ni,verticalAlign:ji}=vp(Wt);(function(oi,si,Ei,Ui,Ii,no,ro,ai,On){const Ai=(si-Ei)*Ii;let ki=0;ki=no!==ro?-ai*Ui-Du:(-Ui*On+.5)*ro;for(const li of oi)for(const Ho of li.positionedGlyphs)Ho.x+=Ai,Ho.y+=ki})(ht.positionedLines,Oi,Ni,ji,ii,go,Pt,xi,Ot.length),ht.top+=-ji*xi,ht.bottom=ht.top+xi,ht.left+=-Ni*ii,ht.right=ht.left+ii}(ut,s,h,m,Ae,C,L,z,K,O,ie,be),!function(ht){for(const qt of ht)if(qt.positionedGlyphs.length!==0)return!1;return!0}(je)&&ut}const Ef={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},f2={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Hg(u,s,h,m,v,S){if(s.imageName){const C=m[s.imageName];return C?C.displaySize[0]*s.scale*ri/S+v:0}{const C=h[s.fontStack],L=C&&C[u];return L?L.metrics.advance*s.scale+v:0}}function Wg(u,s,h,m){const v=Math.pow(u-s,2);return m?u<s?v/2:2*v:v+Math.abs(h)*h}function d2(u,s,h){let m=0;return u===10&&(m-=1e4),h&&(m+=150),u!==40&&u!==65288||(m+=50),s!==41&&s!==65289||(m+=50),m}function Kg(u,s,h,m,v,S){let C=null,L=Wg(s,h,v,S);for(const z of m){const O=Wg(s-z.x,h,v,S)+z.badness;O<=L&&(C=z,L=O)}return{index:u,x:s,priorBreak:C,badness:L}}function Xg(u){return u?Xg(u.priorBreak).concat(u.index):[]}function bp(u,s,h,m,v,S,C){if(S!=="point")return[];if(!u)return[];const L=[],z=function(ie,ce,ge,be,Te,Ae){let Ze=0;for(let Re=0;Re<ie.length();Re++){const je=ie.getSection(Re);Ze+=Hg(ie.getCharCode(Re),je,be,Te,ce,Ae)}return Ze/Math.max(1,Math.ceil(Ze/ge))}(u,s,h,m,v,C),O=u.text.indexOf("")>=0;let H=0;for(let ie=0;ie<u.length();ie++){const ce=u.getSection(ie),ge=u.getCharCode(ie);if(Ef[ge]||(H+=Hg(ge,ce,m,v,s,C)),ie<u.length()-1){const be=!((K=ge)<11904||!(Ut["Bopomofo Extended"](K)||Ut.Bopomofo(K)||Ut["CJK Compatibility Forms"](K)||Ut["CJK Compatibility Ideographs"](K)||Ut["CJK Compatibility"](K)||Ut["CJK Radicals Supplement"](K)||Ut["CJK Strokes"](K)||Ut["CJK Symbols and Punctuation"](K)||Ut["CJK Unified Ideographs Extension A"](K)||Ut["CJK Unified Ideographs"](K)||Ut["Enclosed CJK Letters and Months"](K)||Ut["Halfwidth and Fullwidth Forms"](K)||Ut.Hiragana(K)||Ut["Ideographic Description Characters"](K)||Ut["Kangxi Radicals"](K)||Ut["Katakana Phonetic Extensions"](K)||Ut.Katakana(K)||Ut["Vertical Forms"](K)||Ut["Yi Radicals"](K)||Ut["Yi Syllables"](K)));(f2[ge]||be||ce.imageName)&&L.push(Kg(ie+1,H,z,L,d2(ge,u.getCharCode(ie+1),be&&O),!1))}}var K;return Xg(Kg(u.length(),H,z,L,0,!0))}function vp(u){let s=.5,h=.5;switch(u){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:s,verticalAlign:h}}function p2(u,s,h,m,v){if(!m&&!v)return;const S=u[h],C=(u[h].x+S.metrics.advance*S.scale)*m;for(let L=s;L<=h;L++)u[L].x-=C,u[L].y+=v}function m2(u,s,h){const{horizontalAlign:m,verticalAlign:v}=vp(h),S=s[0]-u.displaySize[0]*m,C=s[1]-u.displaySize[1]*v;return{image:u,top:C,bottom:C+u.displaySize[1],left:S,right:S+u.displaySize[0]}}function Jg(u,s,h,m,v,S){const C=u.image;let L;if(C.content){const Te=C.content,Ae=C.pixelRatio||1;L=[Te[0]/Ae,Te[1]/Ae,C.displaySize[0]-Te[2]/Ae,C.displaySize[1]-Te[3]/Ae]}const z=s.left*S,O=s.right*S;let H,K,ie,ce;h==="width"||h==="both"?(ce=v[0]+z-m[3],K=v[0]+O+m[1]):(ce=v[0]+(z+O-C.displaySize[0])/2,K=ce+C.displaySize[0]);const ge=s.top*S,be=s.bottom*S;return h==="height"||h==="both"?(H=v[1]+ge-m[0],ie=v[1]+be+m[2]):(H=v[1]+(ge+be-C.displaySize[1])/2,ie=H+C.displaySize[1]),{image:C,top:H,right:K,bottom:ie,left:ce,collisionPadding:L}}const Ru=255,Cs=128,ya=Ru*Cs;function Yg(u,s){const{expression:h}=s;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new kr(u+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:v}=h;let S=0;for(;S<m.length&&m[S]<=u;)S++;S=Math.max(0,S-1);let C=S;for(;C<m.length&&m[C]<u+1;)C++;C=Math.min(m.length-1,C);const L=m[S],z=m[C];return h.kind==="composite"?{kind:"composite",minZoom:L,maxZoom:z,interpolationType:v}:{kind:"camera",minZoom:L,maxZoom:z,minSize:h.evaluate(new kr(L)),maxSize:h.evaluate(new kr(z)),interpolationType:v}}}function wp(u,s,h){let m="never";const v=u.get(s);return v?m=v:u.get(h)&&(m="always"),m}const g2=ga.VectorTileFeature.types,_2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function If(u,s,h,m,v,S,C,L,z,O,H,K,ie){const ce=L?Math.min(ya,Math.round(L[0])):0,ge=L?Math.min(ya,Math.round(L[1])):0;u.emplaceBack(s,h,Math.round(32*m),Math.round(32*v),S,C,(ce<<1)+(z?1:0),ge,16*O,16*H,256*K,256*ie)}function xp(u,s,h){u.emplaceBack(s.x,s.y,h),u.emplaceBack(s.x,s.y,h),u.emplaceBack(s.x,s.y,h),u.emplaceBack(s.x,s.y,h)}function y2(u){for(const s of u.sections)if(Qd(s.text))return!0;return!1}class kp{constructor(s){this.layoutVertexArray=new Je,this.indexArray=new ot,this.programConfigurations=s,this.segments=new zt,this.dynamicLayoutVertexArray=new Le,this.opacityVertexArray=new Ve,this.hasVisibleVertices=!1,this.placedSymbolArray=new f}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(s,h,m,v){this.isEmpty()||(m&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Kw.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,Xw.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,_2,!0),this.opacityVertexBuffer.itemSize=1),(m||v)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ht("SymbolBuffers",kp);class Sp{constructor(s,h,m){this.layoutVertexArray=new s,this.layoutAttributes=h,this.indexArray=new m,this.segments=new zt,this.collisionVertexArray=new nt}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,Jw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ht("CollisionBuffers",Sp);class _c{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(C=>C.id),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=tp([]),this.placementViewportMatrix=tp([]);const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Yg(this.zoom,h["text-size"]),this.iconSizeData=Yg(this.zoom,h["icon-size"]);const m=this.layers[0].layout,v=m.get("symbol-sort-key"),S=m.get("symbol-z-order");this.canOverlap=wp(m,"text-overlap","text-allow-overlap")!=="never"||wp(m,"icon-overlap","icon-allow-overlap")!=="never"||m.get("text-ignore-placement")||m.get("icon-ignore-placement"),this.sortFeaturesByKey=S!=="viewport-y"&&!v.isConstant(),this.sortFeaturesByY=(S==="viewport-y"||S==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,m.get("symbol-placement")==="point"&&(this.writingModes=m.get("text-writing-mode").map(C=>c.ah[C])),this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id),this.sourceID=s.sourceID}createArrays(){this.text=new kp(new Ir(this.layers,this.zoom,s=>/^text/.test(s))),this.icon=new kp(new Ir(this.layers,this.zoom,s=>/^icon/.test(s))),this.glyphOffsetArray=new k,this.lineVertexArray=new E,this.symbolInstances=new b,this.textAnchorOffsets=new B}calculateGlyphDependencies(s,h,m,v,S){for(let C=0;C<s.length;C++)if(h[s.charCodeAt(C)]=!0,(m||v)&&S){const L=zu[s.charAt(C)];L&&(h[L.charCodeAt(0)]=!0)}}populate(s,h,m){const v=this.layers[0],S=v.layout,C=S.get("text-font"),L=S.get("text-field"),z=S.get("icon-image"),O=(L.value.kind!=="constant"||L.value.value instanceof Xi&&!L.value.value.isEmpty()||L.value.value.toString().length>0)&&(C.value.kind!=="constant"||C.value.value.length>0),H=z.value.kind!=="constant"||!!z.value.value||Object.keys(z.parameters).length>0,K=S.get("symbol-sort-key");if(this.features=[],!O&&!H)return;const ie=h.iconDependencies,ce=h.glyphDependencies,ge=h.availableImages,be=new kr(this.zoom);for(const{feature:Te,id:Ae,index:Ze,sourceLayerIndex:Re}of s){const je=v._featureFilter.needGeometry,ut=Bs(Te,je);if(!v._featureFilter.filter(be,ut,m))continue;let ht,qt;if(je||(ut.geometry=Fs(Te)),O){const Vt=v.getValueAndResolveTokens("text-field",ut,m,ge),Ot=Xi.factory(Vt),Pt=this.hasRTLText=this.hasRTLText||y2(Ot);(!Pt||ws.getRTLTextPluginStatus()==="unavailable"||Pt&&ws.isParsed())&&(ht=Qw(Ot,v,ut))}if(H){const Vt=v.getValueAndResolveTokens("icon-image",ut,m,ge);qt=Vt instanceof fo?Vt:fo.fromString(Vt)}if(!ht&&!qt)continue;const Jt=this.sortFeaturesByKey?K.evaluate(ut,{},m):void 0;if(this.features.push({id:Ae,text:ht,icon:qt,index:Ze,sourceLayerIndex:Re,geometry:ut.geometry,properties:Te.properties,type:g2[Te.type],sortKey:Jt}),qt&&(ie[qt.name]=!0),ht){const Vt=C.evaluate(ut,{},m).join(","),Ot=S.get("text-rotation-alignment")!=="viewport"&&S.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(c.ah.vertical)>=0;for(const Pt of ht.sections)if(Pt.image)ie[Pt.image.name]=!0;else{const Wt=pa(ht.toString()),Ft=Pt.fontStack||Vt,xt=ce[Ft]=ce[Ft]||{};this.calculateGlyphDependencies(Pt.text,xt,Ot,this.allowVerticalPlacement,Wt)}}}S.get("symbol-placement")==="line"&&(this.features=function(Te){const Ae={},Ze={},Re=[];let je=0;function ut(Vt){Re.push(Te[Vt]),je++}function ht(Vt,Ot,Pt){const Wt=Ze[Vt];return delete Ze[Vt],Ze[Ot]=Wt,Re[Wt].geometry[0].pop(),Re[Wt].geometry[0]=Re[Wt].geometry[0].concat(Pt[0]),Wt}function qt(Vt,Ot,Pt){const Wt=Ae[Ot];return delete Ae[Ot],Ae[Vt]=Wt,Re[Wt].geometry[0].shift(),Re[Wt].geometry[0]=Pt[0].concat(Re[Wt].geometry[0]),Wt}function Jt(Vt,Ot,Pt){const Wt=Pt?Ot[0][Ot[0].length-1]:Ot[0][0];return`${Vt}:${Wt.x}:${Wt.y}`}for(let Vt=0;Vt<Te.length;Vt++){const Ot=Te[Vt],Pt=Ot.geometry,Wt=Ot.text?Ot.text.toString():null;if(!Wt){ut(Vt);continue}const Ft=Jt(Wt,Pt),xt=Jt(Wt,Pt,!0);if(Ft in Ze&&xt in Ae&&Ze[Ft]!==Ae[xt]){const cn=qt(Ft,xt,Pt),nn=ht(Ft,xt,Re[cn].geometry);delete Ae[Ft],delete Ze[xt],Ze[Jt(Wt,Re[nn].geometry,!0)]=nn,Re[cn].geometry=null}else Ft in Ze?ht(Ft,xt,Pt):xt in Ae?qt(Ft,xt,Pt):(ut(Vt),Ae[Ft]=je-1,Ze[xt]=je-1)}return Re.filter(Vt=>Vt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Te,Ae)=>Te.sortKey-Ae.sortKey)}update(s,h,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,h,this.layers,m),this.icon.programConfigurations.updatePaintArrays(s,h,this.layers,m))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,h){const m=this.lineVertexArray.length;if(s.segment!==void 0){let v=s.dist(h[s.segment+1]),S=s.dist(h[s.segment]);const C={};for(let L=s.segment+1;L<h.length;L++)C[L]={x:h[L].x,y:h[L].y,tileUnitDistanceFromAnchor:v},L<h.length-1&&(v+=h[L+1].dist(h[L]));for(let L=s.segment||0;L>=0;L--)C[L]={x:h[L].x,y:h[L].y,tileUnitDistanceFromAnchor:S},L>0&&(S+=h[L-1].dist(h[L]));for(let L=0;L<h.length;L++){const z=C[L];this.lineVertexArray.emplaceBack(z.x,z.y,z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(s,h,m,v,S,C,L,z,O,H,K,ie){const ce=s.indexArray,ge=s.layoutVertexArray,be=s.segments.prepareSegment(4*h.length,ge,ce,this.canOverlap?C.sortKey:void 0),Te=this.glyphOffsetArray.length,Ae=be.vertexLength,Ze=this.allowVerticalPlacement&&L===c.ah.vertical?Math.PI/2:0,Re=C.text&&C.text.sections;for(let je=0;je<h.length;je++){const{tl:ut,tr:ht,bl:qt,br:Jt,tex:Vt,pixelOffsetTL:Ot,pixelOffsetBR:Pt,minFontScaleX:Wt,minFontScaleY:Ft,glyphOffset:xt,isSDF:cn,sectionIndex:nn}=h[je],Dn=be.vertexLength,_r=xt[1];If(ge,z.x,z.y,ut.x,_r+ut.y,Vt.x,Vt.y,m,cn,Ot.x,Ot.y,Wt,Ft),If(ge,z.x,z.y,ht.x,_r+ht.y,Vt.x+Vt.w,Vt.y,m,cn,Pt.x,Ot.y,Wt,Ft),If(ge,z.x,z.y,qt.x,_r+qt.y,Vt.x,Vt.y+Vt.h,m,cn,Ot.x,Pt.y,Wt,Ft),If(ge,z.x,z.y,Jt.x,_r+Jt.y,Vt.x+Vt.w,Vt.y+Vt.h,m,cn,Pt.x,Pt.y,Wt,Ft),xp(s.dynamicLayoutVertexArray,z,Ze),ce.emplaceBack(Dn,Dn+1,Dn+2),ce.emplaceBack(Dn+1,Dn+2,Dn+3),be.vertexLength+=4,be.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(xt[0]),je!==h.length-1&&nn===h[je+1].sectionIndex||s.programConfigurations.populatePaintArrays(ge.length,C,C.index,{},ie,Re&&Re[nn])}s.placedSymbolArray.emplaceBack(z.x,z.y,Te,this.glyphOffsetArray.length-Te,Ae,O,H,z.segment,m?m[0]:0,m?m[1]:0,v[0],v[1],L,0,!1,0,K)}_addCollisionDebugVertex(s,h,m,v,S,C){return h.emplaceBack(0,0),s.emplaceBack(m.x,m.y,v,S,Math.round(C.x),Math.round(C.y))}addCollisionDebugVertices(s,h,m,v,S,C,L){const z=S.segments.prepareSegment(4,S.layoutVertexArray,S.indexArray),O=z.vertexLength,H=S.layoutVertexArray,K=S.collisionVertexArray,ie=L.anchorX,ce=L.anchorY;this._addCollisionDebugVertex(H,K,C,ie,ce,new _(s,h)),this._addCollisionDebugVertex(H,K,C,ie,ce,new _(m,h)),this._addCollisionDebugVertex(H,K,C,ie,ce,new _(m,v)),this._addCollisionDebugVertex(H,K,C,ie,ce,new _(s,v)),z.vertexLength+=4;const ge=S.indexArray;ge.emplaceBack(O,O+1),ge.emplaceBack(O+1,O+2),ge.emplaceBack(O+2,O+3),ge.emplaceBack(O+3,O),z.primitiveLength+=4}addDebugCollisionBoxes(s,h,m,v){for(let S=s;S<h;S++){const C=this.collisionBoxArray.get(S);this.addCollisionDebugVertices(C.x1,C.y1,C.x2,C.y2,v?this.textCollisionBox:this.iconCollisionBox,C.anchorPoint,m)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Sp(Qe,Rg.members,gt),this.iconCollisionBox=new Sp(Qe,Rg.members,gt);for(let s=0;s<this.symbolInstances.length;s++){const h=this.symbolInstances.get(s);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(s,h,m,v,S,C,L,z,O){const H={};for(let K=h;K<m;K++){const ie=s.get(K);H.textBox={x1:ie.x1,y1:ie.y1,x2:ie.x2,y2:ie.y2,anchorPointX:ie.anchorPointX,anchorPointY:ie.anchorPointY},H.textFeatureIndex=ie.featureIndex;break}for(let K=v;K<S;K++){const ie=s.get(K);H.verticalTextBox={x1:ie.x1,y1:ie.y1,x2:ie.x2,y2:ie.y2,anchorPointX:ie.anchorPointX,anchorPointY:ie.anchorPointY},H.verticalTextFeatureIndex=ie.featureIndex;break}for(let K=C;K<L;K++){const ie=s.get(K);H.iconBox={x1:ie.x1,y1:ie.y1,x2:ie.x2,y2:ie.y2,anchorPointX:ie.anchorPointX,anchorPointY:ie.anchorPointY},H.iconFeatureIndex=ie.featureIndex;break}for(let K=z;K<O;K++){const ie=s.get(K);H.verticalIconBox={x1:ie.x1,y1:ie.y1,x2:ie.x2,y2:ie.y2,anchorPointX:ie.anchorPointX,anchorPointY:ie.anchorPointY},H.verticalIconFeatureIndex=ie.featureIndex;break}return H}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const m=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,m.textBoxStartIndex,m.textBoxEndIndex,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(s,h){const m=s.placedSymbolArray.get(h),v=m.vertexStartIndex+4*m.numGlyphs;for(let S=m.vertexStartIndex;S<v;S+=4)s.indexArray.emplaceBack(S,S+1,S+2),s.indexArray.emplaceBack(S+1,S+2,S+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(s),m=Math.cos(s),v=[],S=[],C=[];for(let L=0;L<this.symbolInstances.length;++L){C.push(L);const z=this.symbolInstances.get(L);v.push(0|Math.round(h*z.anchorX+m*z.anchorY)),S.push(z.featureIndex)}return C.sort((L,z)=>v[L]-v[z]||S[z]-S[L]),C}addToSortKeyRanges(s,h){const m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===h?m.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const m=this.symbolInstances.get(h);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach((v,S,C)=>{v>=0&&C.indexOf(v)===S&&this.addIndicesForPlacedSymbol(this.text,v)}),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Qg,e_;Ht("SymbolBucket",_c,{omit:["layers","collisionBoxArray","features","compareText"]}),_c.MAX_GLYPHS=65535,_c.addDynamicAttributes=xp;var Cp={get paint(){return e_=e_||new Fi({"icon-opacity":new un(_e.paint_symbol["icon-opacity"]),"icon-color":new un(_e.paint_symbol["icon-color"]),"icon-halo-color":new un(_e.paint_symbol["icon-halo-color"]),"icon-halo-width":new un(_e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new un(_e.paint_symbol["icon-halo-blur"]),"icon-translate":new rn(_e.paint_symbol["icon-translate"]),"icon-translate-anchor":new rn(_e.paint_symbol["icon-translate-anchor"]),"text-opacity":new un(_e.paint_symbol["text-opacity"]),"text-color":new un(_e.paint_symbol["text-color"],{runtimeType:Qn,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new un(_e.paint_symbol["text-halo-color"]),"text-halo-width":new un(_e.paint_symbol["text-halo-width"]),"text-halo-blur":new un(_e.paint_symbol["text-halo-blur"]),"text-translate":new rn(_e.paint_symbol["text-translate"]),"text-translate-anchor":new rn(_e.paint_symbol["text-translate-anchor"])})},get layout(){return Qg=Qg||new Fi({"symbol-placement":new rn(_e.layout_symbol["symbol-placement"]),"symbol-spacing":new rn(_e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new rn(_e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new un(_e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new rn(_e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new rn(_e.layout_symbol["icon-allow-overlap"]),"icon-overlap":new rn(_e.layout_symbol["icon-overlap"]),"icon-ignore-placement":new rn(_e.layout_symbol["icon-ignore-placement"]),"icon-optional":new rn(_e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new rn(_e.layout_symbol["icon-rotation-alignment"]),"icon-size":new un(_e.layout_symbol["icon-size"]),"icon-text-fit":new rn(_e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new rn(_e.layout_symbol["icon-text-fit-padding"]),"icon-image":new un(_e.layout_symbol["icon-image"]),"icon-rotate":new un(_e.layout_symbol["icon-rotate"]),"icon-padding":new un(_e.layout_symbol["icon-padding"]),"icon-keep-upright":new rn(_e.layout_symbol["icon-keep-upright"]),"icon-offset":new un(_e.layout_symbol["icon-offset"]),"icon-anchor":new un(_e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new rn(_e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new rn(_e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new rn(_e.layout_symbol["text-rotation-alignment"]),"text-field":new un(_e.layout_symbol["text-field"]),"text-font":new un(_e.layout_symbol["text-font"]),"text-size":new un(_e.layout_symbol["text-size"]),"text-max-width":new un(_e.layout_symbol["text-max-width"]),"text-line-height":new rn(_e.layout_symbol["text-line-height"]),"text-letter-spacing":new un(_e.layout_symbol["text-letter-spacing"]),"text-justify":new un(_e.layout_symbol["text-justify"]),"text-radial-offset":new un(_e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new rn(_e.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new un(_e.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new un(_e.layout_symbol["text-anchor"]),"text-max-angle":new rn(_e.layout_symbol["text-max-angle"]),"text-writing-mode":new rn(_e.layout_symbol["text-writing-mode"]),"text-rotate":new un(_e.layout_symbol["text-rotate"]),"text-padding":new rn(_e.layout_symbol["text-padding"]),"text-keep-upright":new rn(_e.layout_symbol["text-keep-upright"]),"text-transform":new un(_e.layout_symbol["text-transform"]),"text-offset":new un(_e.layout_symbol["text-offset"]),"text-allow-overlap":new rn(_e.layout_symbol["text-allow-overlap"]),"text-overlap":new rn(_e.layout_symbol["text-overlap"]),"text-ignore-placement":new rn(_e.layout_symbol["text-ignore-placement"]),"text-optional":new rn(_e.layout_symbol["text-optional"])})}};class t_{constructor(s){if(s.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=s.property.overrides?s.property.overrides.runtimeType:Yn,this.defaultValue=s}evaluate(s){if(s.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(s.formattedSection))return h.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ht("FormatSectionOverride",t_,{omit:["defaultValue"]});class Af extends ko{constructor(s){super(s,Cp)}recalculate(s,h){if(super.recalculate(s,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const m=this.layout.get("text-writing-mode");if(m){const v=[];for(const S of m)v.indexOf(S)<0&&v.push(S);this.layout._values["text-writing-mode"]=v}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(s,h,m,v){const S=this.layout.get(s).evaluate(h,{},m,v),C=this._unevaluatedLayout._values[s];return C.isDataDriven()||hr(C.value)||!S?S:function(L,z){return z.replace(/{([^{}]+)}/g,(O,H)=>L&&H in L?String(L[H]):"")}(h.properties,S)}createBucket(s){return new _c(s)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const s of Cp.paint.overridableProperties){if(!Af.hasPaintOverride(this.layout,s))continue;const h=this.paint.get(s),m=new t_(h),v=new gr(m,h.property.specification);let S=null;S=h.value.kind==="constant"||h.value.kind==="source"?new Nl("source",v):new Qc("composite",v,h.value.zoomStops),this.paint._values[s]=new xo(h.property,S,h.parameters)}}_handleOverridablePaintPropertyUpdate(s,h,m){return!(!this.layout||h.isDataDriven()||m.isDataDriven())&&Af.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,h){const m=s.get("text-field"),v=Cp.paint.properties[h];let S=!1;const C=L=>{for(const z of L)if(v.overrides&&v.overrides.hasOverride(z))return void(S=!0)};if(m.value.kind==="constant"&&m.value.value instanceof Xi)C(m.value.value.sections);else if(m.value.kind==="source"){const L=O=>{S||(O instanceof gs&&Zr(O.value)===er?C(O.value.sections):O instanceof Bl?C(O.sections):O.eachChild(L))},z=m.value;z._styleExpression&&L(z._styleExpression.expression)}return S}}let n_;var b2={get paint(){return n_=n_||new Fi({"background-color":new rn(_e.paint_background["background-color"]),"background-pattern":new nl(_e.paint_background["background-pattern"]),"background-opacity":new rn(_e.paint_background["background-opacity"])})}};class v2 extends ko{constructor(s){super(s,b2)}}let r_;var w2={get paint(){return r_=r_||new Fi({"raster-opacity":new rn(_e.paint_raster["raster-opacity"]),"raster-hue-rotate":new rn(_e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new rn(_e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new rn(_e.paint_raster["raster-brightness-max"]),"raster-saturation":new rn(_e.paint_raster["raster-saturation"]),"raster-contrast":new rn(_e.paint_raster["raster-contrast"]),"raster-resampling":new rn(_e.paint_raster["raster-resampling"]),"raster-fade-duration":new rn(_e.paint_raster["raster-fade-duration"])})}};class x2 extends ko{constructor(s){super(s,w2)}}class k2 extends ko{constructor(s){super(s,{}),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=s}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class S2{constructor(s){this._methodToThrottle=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Tp=63710088e-1;class ba{constructor(s,h){if(isNaN(s)||isNaN(h))throw new Error(`Invalid LngLat object: (${s}, ${h})`);if(this.lng=+s,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ba(se(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const h=Math.PI/180,m=this.lat*h,v=s.lat*h,S=Math.sin(m)*Math.sin(v)+Math.cos(m)*Math.cos(v)*Math.cos((s.lng-this.lng)*h);return Tp*Math.acos(Math.min(S,1))}static convert(s){if(s instanceof ba)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new ba(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new ba(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const i_=2*Math.PI*Tp;function o_(u){return i_*Math.cos(u*Math.PI/180)}function s_(u){return(180+u)/360}function a_(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function l_(u,s){return u/o_(s)}function Mp(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}class Pf{constructor(s,h,m=0){this.x=+s,this.y=+h,this.z=+m}static fromLngLat(s,h=0){const m=ba.convert(s);return new Pf(s_(m.lng),a_(m.lat),l_(h,m.lat))}toLngLat(){return new ba(360*this.x-180,Mp(this.y))}toAltitude(){return this.z*o_(Mp(this.y))}meterInMercatorCoordinateUnits(){return 1/i_*(s=Mp(this.y),1/Math.cos(s*Math.PI/180));var s}}function c_(u,s,h){var m=2*Math.PI*6378137/256/Math.pow(2,h);return[u*m-2*Math.PI*6378137/2,s*m-2*Math.PI*6378137/2]}class Lp{constructor(s,h,m){if(s<0||s>25||m<0||m>=Math.pow(2,s)||h<0||h>=Math.pow(2,s))throw new Error(`x=${h}, y=${m}, z=${s} outside of bounds. 0<=x<${Math.pow(2,s)}, 0<=y<${Math.pow(2,s)} 0<=z<=25 `);this.z=s,this.x=h,this.y=m,this.key=Fu(0,s,s,h,m)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,h,m){const v=(C=this.y,L=this.z,z=c_(256*(S=this.x),256*(C=Math.pow(2,L)-C-1),L),O=c_(256*(S+1),256*(C+1),L),z[0]+","+z[1]+","+O[0]+","+O[1]);var S,C,L,z,O;const H=function(K,ie,ce){let ge,be="";for(let Te=K;Te>0;Te--)ge=1<<Te-1,be+=(ie&ge?1:0)+(ce&ge?2:0);return be}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(m==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,H).replace(/{bbox-epsg-3857}/g,v)}isChildOf(s){const h=this.z-s.z;return h>0&&s.x===this.x>>h&&s.y===this.y>>h}getTilePoint(s){const h=Math.pow(2,this.z);return new _((s.x*h-this.x)*Or,(s.y*h-this.y)*Or)}toString(){return`${this.z}/${this.x}/${this.y}`}}class u_{constructor(s,h){this.wrap=s,this.canonical=h,this.key=Fu(s,h.z,h.z,h.x,h.y)}}class Co{constructor(s,h,m,v,S){if(s<m)throw new Error(`overscaledZ should be >= z; overscaledZ = ${s}; z = ${m}`);this.overscaledZ=s,this.wrap=h,this.canonical=new Lp(m,+v,+S),this.key=Fu(h,s,m,v,S)}clone(){return new Co(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-s;return s>this.canonical.z?new Co(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Co(s,this.wrap,s,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(s,h){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-s;return s>this.canonical.z?Fu(this.wrap*+h,s,this.canonical.z,this.canonical.x,this.canonical.y):Fu(this.wrap*+h,s,s,this.canonical.x>>m,this.canonical.y>>m)}isChildOf(s){if(s.wrap!==this.wrap)return!1;const h=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.x===this.canonical.x>>h&&s.canonical.y===this.canonical.y>>h}children(s){if(this.overscaledZ>=s)return[new Co(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,m=2*this.canonical.x,v=2*this.canonical.y;return[new Co(h,this.wrap,h,m,v),new Co(h,this.wrap,h,m+1,v),new Co(h,this.wrap,h,m,v+1),new Co(h,this.wrap,h,m+1,v+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new Co(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new Co(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new u_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(s){return this.canonical.getTilePoint(new Pf(s.x-this.wrap,s.y))}}function Fu(u,s,h,m,v){(u*=2)<0&&(u=-1*u-1);const S=1<<h;return(S*S*u+S*v+m).toString(36)+h.toString(36)+s.toString(36)}Ht("CanonicalTileID",Lp),Ht("OverscaledTileID",Co,{omit:["posMatrix"]});class h_{constructor(s,h,m,v=1,S=1,C=1,L=0){if(this.uid=s,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(m&&!["mapbox","terrarium","custom"].includes(m))return void Pe(`"${m}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=h.height;const z=this.dim=h.height-2;switch(this.data=new Uint32Array(h.data.buffer),m){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=v,this.greenFactor=S,this.blueFactor=C,this.baseShift=L;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let O=0;O<z;O++)this.data[this._idx(-1,O)]=this.data[this._idx(0,O)],this.data[this._idx(z,O)]=this.data[this._idx(z-1,O)],this.data[this._idx(O,-1)]=this.data[this._idx(O,0)],this.data[this._idx(O,z)]=this.data[this._idx(O,z-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(z,-1)]=this.data[this._idx(z-1,0)],this.data[this._idx(-1,z)]=this.data[this._idx(0,z-1)],this.data[this._idx(z,z)]=this.data[this._idx(z-1,z-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let O=0;O<z;O++)for(let H=0;H<z;H++){const K=this.get(O,H);K>this.max&&(this.max=K),K<this.min&&(this.min=K)}}get(s,h){const m=new Uint8Array(this.data.buffer),v=4*this._idx(s,h);return this.unpack(m[v],m[v+1],m[v+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(s,h){if(s<-1||s>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(s+1)}unpack(s,h,m){return s*this.redFactor+h*this.greenFactor+m*this.blueFactor-this.baseShift}getPixels(){return new So({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(s,h,m){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let v=h*this.dim,S=h*this.dim+this.dim,C=m*this.dim,L=m*this.dim+this.dim;switch(h){case-1:v=S-1;break;case 1:S=v+1}switch(m){case-1:C=L-1;break;case 1:L=C+1}const z=-h*this.dim,O=-m*this.dim;for(let H=C;H<L;H++)for(let K=v;K<S;K++)this.data[this._idx(K,H)]=s.data[this._idx(K+z,H+O)]}}Ht("DEMData",h_);class f_{constructor(s){this._stringToNumber={},this._numberToString=[];for(let h=0;h<s.length;h++){const m=s[h];this._stringToNumber[m]=h,this._numberToString[h]=m}}encode(s){return this._stringToNumber[s]}decode(s){if(s>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${s} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[s]}}class d_{constructor(s,h,m,v,S){this.type="Feature",this._vectorTileFeature=s,s._z=h,s._x=m,s._y=v,this.properties=s.properties,this.id=S}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={geometry:this.geometry};for(const h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(s[h]=this[h]);return s}}class p_{constructor(s,h){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new Qa(Or,16,0),this.grid3D=new Qa(Or,16,0),this.featureIndexArray=new X,this.promoteId=h}insert(s,h,m,v,S,C){const L=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(m,v,S);const z=C?this.grid3D:this.grid;for(let O=0;O<h.length;O++){const H=h[O],K=[1/0,1/0,-1/0,-1/0];for(let ie=0;ie<H.length;ie++){const ce=H[ie];K[0]=Math.min(K[0],ce.x),K[1]=Math.min(K[1],ce.y),K[2]=Math.max(K[2],ce.x),K[3]=Math.max(K[3],ce.y)}K[0]<Or&&K[1]<Or&&K[2]>=0&&K[3]>=0&&z.insert(L,K[0],K[1],K[2],K[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ga.VectorTile(new gp(this.rawTileData)).layers,this.sourceLayerCoder=new f_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(s,h,m,v){this.loadVTLayers();const S=s.params||{},C=Or/s.tileSize/s.scale,L=ql(S.filter),z=s.queryGeometry,O=s.queryPadding*C,H=g_(z),K=this.grid.query(H.minX-O,H.minY-O,H.maxX+O,H.maxY+O),ie=g_(s.cameraQueryGeometry),ce=this.grid3D.query(ie.minX-O,ie.minY-O,ie.maxX+O,ie.maxY+O,(Te,Ae,Ze,Re)=>function(je,ut,ht,qt,Jt){for(const Ot of je)if(ut<=Ot.x&&ht<=Ot.y&&qt>=Ot.x&&Jt>=Ot.y)return!0;const Vt=[new _(ut,ht),new _(ut,Jt),new _(qt,Jt),new _(qt,ht)];if(je.length>2){for(const Ot of Vt)if(uc(je,Ot))return!0}for(let Ot=0;Ot<je.length-1;Ot++)if(nw(je[Ot],je[Ot+1],Vt))return!0;return!1}(s.cameraQueryGeometry,Te-O,Ae-O,Ze+O,Re+O));for(const Te of ce)K.push(Te);K.sort(C2);const ge={};let be;for(let Te=0;Te<K.length;Te++){const Ae=K[Te];if(Ae===be)continue;be=Ae;const Ze=this.featureIndexArray.get(Ae);let Re=null;this.loadMatchingFeature(ge,Ze.bucketIndex,Ze.sourceLayerIndex,Ze.featureIndex,L,S.layers,S.availableImages,h,m,v,(je,ut,ht)=>(Re||(Re=Fs(je)),ut.queryIntersectsFeature(z,je,ht,Re,this.z,s.transform,C,s.pixelPosMatrix)))}return ge}loadMatchingFeature(s,h,m,v,S,C,L,z,O,H,K){const ie=this.bucketLayerIDs[h];if(C&&!function(Te,Ae){for(let Ze=0;Ze<Te.length;Ze++)if(Ae.indexOf(Te[Ze])>=0)return!0;return!1}(C,ie))return;const ce=this.sourceLayerCoder.decode(m),ge=this.vtLayers[ce].feature(v);if(S.needGeometry){const Te=Bs(ge,!0);if(!S.filter(new kr(this.tileID.overscaledZ),Te,this.tileID.canonical))return}else if(!S.filter(new kr(this.tileID.overscaledZ),ge))return;const be=this.getId(ge,ce);for(let Te=0;Te<ie.length;Te++){const Ae=ie[Te];if(C&&C.indexOf(Ae)<0)continue;const Ze=z[Ae];if(!Ze)continue;let Re={};be&&H&&(Re=H.getState(Ze.sourceLayer||"_geojsonTileLayer",be));const je=J({},O[Ae]);je.paint=m_(je.paint,Ze.paint,ge,Re,L),je.layout=m_(je.layout,Ze.layout,ge,Re,L);const ut=!K||K(ge,Ze,Re);if(!ut)continue;const ht=new d_(ge,this.z,this.x,this.y,be);ht.layer=je;let qt=s[Ae];qt===void 0&&(qt=s[Ae]=[]),qt.push({featureIndex:v,feature:ht,intersectionZ:ut})}}lookupSymbolFeatures(s,h,m,v,S,C,L,z){const O={};this.loadVTLayers();const H=ql(S);for(const K of s)this.loadMatchingFeature(O,m,v,K,H,C,L,z,h);return O}hasLayer(s){for(const h of this.bucketLayerIDs)for(const m of h)if(s===m)return!0;return!1}getId(s,h){let m=s.id;return this.promoteId&&(m=s.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]],typeof m=="boolean"&&(m=Number(m))),m}}function m_(u,s,h,m,v){return me(u,(S,C)=>{const L=s instanceof tl?s.get(C):null;return L&&L.evaluate?L.evaluate(h,m,v):L})}function g_(u){let s=1/0,h=1/0,m=-1/0,v=-1/0;for(const S of u)s=Math.min(s,S.x),h=Math.min(h,S.y),m=Math.max(m,S.x),v=Math.max(v,S.y);return{minX:s,minY:h,maxX:m,maxY:v}}function C2(u,s){return s-u}function __(u,s,h,m,v){const S=[];for(let C=0;C<u.length;C++){const L=u[C];let z;for(let O=0;O<L.length-1;O++){let H=L[O],K=L[O+1];H.x<s&&K.x<s||(H.x<s?H=new _(s,H.y+(s-H.x)/(K.x-H.x)*(K.y-H.y))._round():K.x<s&&(K=new _(s,H.y+(s-H.x)/(K.x-H.x)*(K.y-H.y))._round()),H.y<h&&K.y<h||(H.y<h?H=new _(H.x+(h-H.y)/(K.y-H.y)*(K.x-H.x),h)._round():K.y<h&&(K=new _(H.x+(h-H.y)/(K.y-H.y)*(K.x-H.x),h)._round()),H.x>=m&&K.x>=m||(H.x>=m?H=new _(m,H.y+(m-H.x)/(K.x-H.x)*(K.y-H.y))._round():K.x>=m&&(K=new _(m,H.y+(m-H.x)/(K.x-H.x)*(K.y-H.y))._round()),H.y>=v&&K.y>=v||(H.y>=v?H=new _(H.x+(v-H.y)/(K.y-H.y)*(K.x-H.x),v)._round():K.y>=v&&(K=new _(H.x+(v-H.y)/(K.y-H.y)*(K.x-H.x),v)._round()),z&&H.equals(z[z.length-1])||(z=[H],S.push(z)),z.push(K)))))}}return S}Ht("FeatureIndex",p_,{omit:["rawTileData","sourceLayerCoder"]});class va extends _{constructor(s,h,m,v){super(s,h),this.angle=m,v!==void 0&&(this.segment=v)}clone(){return new va(this.x,this.y,this.angle,this.segment)}}function y_(u,s,h,m,v){if(s.segment===void 0||h===0)return!0;let S=s,C=s.segment+1,L=0;for(;L>-h/2;){if(C--,C<0)return!1;L-=u[C].dist(S),S=u[C]}L+=u[C].dist(u[C+1]),C++;const z=[];let O=0;for(;L<h/2;){const H=u[C],K=u[C+1];if(!K)return!1;let ie=u[C-1].angleTo(H)-H.angleTo(K);for(ie=Math.abs((ie+3*Math.PI)%(2*Math.PI)-Math.PI),z.push({distance:L,angleDelta:ie}),O+=ie;L-z[0].distance>m;)O-=z.shift().angleDelta;if(O>v)return!1;C++,L+=H.dist(K)}return!0}function b_(u){let s=0;for(let h=0;h<u.length-1;h++)s+=u[h].dist(u[h+1]);return s}function v_(u,s,h){return u?.6*s*h:0}function w_(u,s){return Math.max(u?u.right-u.left:0,s?s.right-s.left:0)}function T2(u,s,h,m,v,S){const C=v_(h,v,S),L=w_(h,m)*S;let z=0;const O=b_(u)/2;for(let H=0;H<u.length-1;H++){const K=u[H],ie=u[H+1],ce=K.dist(ie);if(z+ce>O){const ge=(O-z)/ce,be=Mi.number(K.x,ie.x,ge),Te=Mi.number(K.y,ie.y,ge),Ae=new va(be,Te,ie.angleTo(K),H);return Ae._round(),!C||y_(u,Ae,L,C,s)?Ae:void 0}z+=ce}}function M2(u,s,h,m,v,S,C,L,z){const O=v_(m,S,C),H=w_(m,v),K=H*C,ie=u[0].x===0||u[0].x===z||u[0].y===0||u[0].y===z;return s-K<s/4&&(s=K+s/4),x_(u,ie?s/2*L%s:(H/2+2*S)*C*L%s,s,O,h,K,ie,!1,z)}function x_(u,s,h,m,v,S,C,L,z){const O=S/2,H=b_(u);let K=0,ie=s-h,ce=[];for(let ge=0;ge<u.length-1;ge++){const be=u[ge],Te=u[ge+1],Ae=be.dist(Te),Ze=Te.angleTo(be);for(;ie+h<K+Ae;){ie+=h;const Re=(ie-K)/Ae,je=Mi.number(be.x,Te.x,Re),ut=Mi.number(be.y,Te.y,Re);if(je>=0&&je<z&&ut>=0&&ut<z&&ie-O>=0&&ie+O<=H){const ht=new va(je,ut,Ze,ge);ht._round(),m&&!y_(u,ht,S,m,v)||ce.push(ht)}}K+=Ae}return L||ce.length||C||(ce=x_(u,K/2,h,m,v,S,C,!0,z)),ce}Ht("Anchor",va);const yc=to;function k_(u,s,h,m){const v=[],S=u.image,C=S.pixelRatio,L=S.paddedRect.w-2*yc,z=S.paddedRect.h-2*yc,O=u.right-u.left,H=u.bottom-u.top,K=S.stretchX||[[0,L]],ie=S.stretchY||[[0,z]],ce=(Pt,Wt)=>Pt+Wt[1]-Wt[0],ge=K.reduce(ce,0),be=ie.reduce(ce,0),Te=L-ge,Ae=z-be;let Ze=0,Re=ge,je=0,ut=be,ht=0,qt=Te,Jt=0,Vt=Ae;if(S.content&&m){const Pt=S.content;Ze=zf(K,0,Pt[0]),je=zf(ie,0,Pt[1]),Re=zf(K,Pt[0],Pt[2]),ut=zf(ie,Pt[1],Pt[3]),ht=Pt[0]-Ze,Jt=Pt[1]-je,qt=Pt[2]-Pt[0]-Re,Vt=Pt[3]-Pt[1]-ut}const Ot=(Pt,Wt,Ft,xt)=>{const cn=Df(Pt.stretch-Ze,Re,O,u.left),nn=$f(Pt.fixed-ht,qt,Pt.stretch,ge),Dn=Df(Wt.stretch-je,ut,H,u.top),_r=$f(Wt.fixed-Jt,Vt,Wt.stretch,be),Cr=Df(Ft.stretch-Ze,Re,O,u.left),ii=$f(Ft.fixed-ht,qt,Ft.stretch,ge),go=Df(xt.stretch-je,ut,H,u.top),Oi=$f(xt.fixed-Jt,Vt,xt.stretch,be),Kr=new _(cn,Dn),gi=new _(Cr,Dn),xi=new _(Cr,go),Ni=new _(cn,go),ji=new _(nn/C,_r/C),oi=new _(ii/C,Oi/C),si=s*Math.PI/180;if(si){const Ii=Math.sin(si),no=Math.cos(si),ro=[no,-Ii,Ii,no];Kr._matMult(ro),gi._matMult(ro),Ni._matMult(ro),xi._matMult(ro)}const Ei=Pt.stretch+Pt.fixed,Ui=Wt.stretch+Wt.fixed;return{tl:Kr,tr:gi,bl:Ni,br:xi,tex:{x:S.paddedRect.x+yc+Ei,y:S.paddedRect.y+yc+Ui,w:Ft.stretch+Ft.fixed-Ei,h:xt.stretch+xt.fixed-Ui},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ji,pixelOffsetBR:oi,minFontScaleX:qt/C/O,minFontScaleY:Vt/C/H,isSDF:h}};if(m&&(S.stretchX||S.stretchY)){const Pt=S_(K,Te,ge),Wt=S_(ie,Ae,be);for(let Ft=0;Ft<Pt.length-1;Ft++){const xt=Pt[Ft],cn=Pt[Ft+1];for(let nn=0;nn<Wt.length-1;nn++)v.push(Ot(xt,Wt[nn],cn,Wt[nn+1]))}}else v.push(Ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:L+1},{fixed:0,stretch:z+1}));return v}function zf(u,s,h){let m=0;for(const v of u)m+=Math.max(s,Math.min(h,v[1]))-Math.max(s,Math.min(h,v[0]));return m}function S_(u,s,h){const m=[{fixed:-yc,stretch:0}];for(const[v,S]of u){const C=m[m.length-1];m.push({fixed:v-C.stretch,stretch:C.stretch}),m.push({fixed:v-C.stretch,stretch:C.stretch+(S-v)})}return m.push({fixed:s+yc,stretch:h}),m}function Df(u,s,h,m){return u/s*h+m}function $f(u,s,h,m){return u-s*h/m}class Rf{constructor(s,h,m,v,S,C,L,z,O,H){if(this.boxStartIndex=s.length,O){let K=C.top,ie=C.bottom;const ce=C.collisionPadding;ce&&(K-=ce[1],ie+=ce[3]);let ge=ie-K;ge>0&&(ge=Math.max(10,ge),this.circleDiameter=ge)}else{let K=C.top*L-z[0],ie=C.bottom*L+z[2],ce=C.left*L-z[3],ge=C.right*L+z[1];const be=C.collisionPadding;if(be&&(ce-=be[0]*L,K-=be[1]*L,ge+=be[2]*L,ie+=be[3]*L),H){const Te=new _(ce,K),Ae=new _(ge,K),Ze=new _(ce,ie),Re=new _(ge,ie),je=H*Math.PI/180;Te._rotate(je),Ae._rotate(je),Ze._rotate(je),Re._rotate(je),ce=Math.min(Te.x,Ae.x,Ze.x,Re.x),ge=Math.max(Te.x,Ae.x,Ze.x,Re.x),K=Math.min(Te.y,Ae.y,Ze.y,Re.y),ie=Math.max(Te.y,Ae.y,Ze.y,Re.y)}s.emplaceBack(h.x,h.y,ce,K,ge,ie,m,v,S)}this.boxEndIndex=s.length}}class L2{constructor(s=[],h=E2){if(this.data=s,this.length=this.data.length,this.compare=h,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(s){this.data.push(s),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const s=this.data[0],h=this.data.pop();return this.length--,this.length>0&&(this.data[0]=h,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:h,compare:m}=this,v=h[s];for(;s>0;){const S=s-1>>1,C=h[S];if(m(v,C)>=0)break;h[s]=C,s=S}h[s]=v}_down(s){const{data:h,compare:m}=this,v=this.length>>1,S=h[s];for(;s<v;){let C=1+(s<<1),L=h[C];const z=C+1;if(z<this.length&&m(h[z],L)<0&&(C=z,L=h[z]),m(L,S)>=0)break;h[s]=L,s=C}h[s]=S}}function E2(u,s){return u<s?-1:u>s?1:0}function I2(u,s=1,h=!1){let m=1/0,v=1/0,S=-1/0,C=-1/0;const L=u[0];for(let ce=0;ce<L.length;ce++){const ge=L[ce];(!ce||ge.x<m)&&(m=ge.x),(!ce||ge.y<v)&&(v=ge.y),(!ce||ge.x>S)&&(S=ge.x),(!ce||ge.y>C)&&(C=ge.y)}const z=Math.min(S-m,C-v);let O=z/2;const H=new L2([],A2);if(z===0)return new _(m,v);for(let ce=m;ce<S;ce+=z)for(let ge=v;ge<C;ge+=z)H.push(new bc(ce+O,ge+O,O,u));let K=function(ce){let ge=0,be=0,Te=0;const Ae=ce[0];for(let Ze=0,Re=Ae.length,je=Re-1;Ze<Re;je=Ze++){const ut=Ae[Ze],ht=Ae[je],qt=ut.x*ht.y-ht.x*ut.y;be+=(ut.x+ht.x)*qt,Te+=(ut.y+ht.y)*qt,ge+=3*qt}return new bc(be/ge,Te/ge,0,ce)}(u),ie=H.length;for(;H.length;){const ce=H.pop();(ce.d>K.d||!K.d)&&(K=ce,h&&console.log("found best %d after %d probes",Math.round(1e4*ce.d)/1e4,ie)),ce.max-K.d<=s||(O=ce.h/2,H.push(new bc(ce.p.x-O,ce.p.y-O,O,u)),H.push(new bc(ce.p.x+O,ce.p.y-O,O,u)),H.push(new bc(ce.p.x-O,ce.p.y+O,O,u)),H.push(new bc(ce.p.x+O,ce.p.y+O,O,u)),ie+=4)}return h&&(console.log(`num probes: ${ie}`),console.log(`best distance: ${K.d}`)),K.p}function A2(u,s){return s.max-u.max}function bc(u,s,h,m){this.p=new _(u,s),this.h=h,this.d=function(v,S){let C=!1,L=1/0;for(let z=0;z<S.length;z++){const O=S[z];for(let H=0,K=O.length,ie=K-1;H<K;ie=H++){const ce=O[H],ge=O[ie];ce.y>v.y!=ge.y>v.y&&v.x<(ge.x-ce.x)*(v.y-ce.y)/(ge.y-ce.y)+ce.x&&(C=!C),L=Math.min(L,ag(v,ce,ge))}}return(C?1:-1)*Math.sqrt(L)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}var wi;c.ap=void 0,(wi=c.ap||(c.ap={}))[wi.center=1]="center",wi[wi.left=2]="left",wi[wi.right=3]="right",wi[wi.top=4]="top",wi[wi.bottom=5]="bottom",wi[wi["top-left"]=6]="top-left",wi[wi["top-right"]=7]="top-right",wi[wi["bottom-left"]=8]="bottom-left",wi[wi["bottom-right"]=9]="bottom-right";const wa=7,Ep=Number.POSITIVE_INFINITY;function C_(u,s){return s[1]!==Ep?function(h,m,v){let S=0,C=0;switch(m=Math.abs(m),v=Math.abs(v),h){case"top-right":case"top-left":case"top":C=v-wa;break;case"bottom-right":case"bottom-left":case"bottom":C=-v+wa}switch(h){case"top-right":case"bottom-right":case"right":S=-m;break;case"top-left":case"bottom-left":case"left":S=m}return[S,C]}(u,s[0],s[1]):function(h,m){let v=0,S=0;m<0&&(m=0);const C=m/Math.SQRT2;switch(h){case"top-right":case"top-left":S=C-wa;break;case"bottom-right":case"bottom-left":S=-C+wa;break;case"bottom":S=-m+wa;break;case"top":S=m-wa}switch(h){case"top-right":case"bottom-right":v=-C;break;case"top-left":case"bottom-left":v=C;break;case"left":v=m;break;case"right":v=-m}return[v,S]}(u,s[0])}function T_(u,s,h){var m;const v=u.layout,S=(m=v.get("text-variable-anchor-offset"))===null||m===void 0?void 0:m.evaluate(s,{},h);if(S){const L=S.values,z=[];for(let O=0;O<L.length;O+=2){const H=z[O]=L[O],K=L[O+1].map(ie=>ie*ri);H.startsWith("top")?K[1]-=wa:H.startsWith("bottom")&&(K[1]+=wa),z[O+1]=K}return new ho(z)}const C=v.get("text-variable-anchor");if(C){let L;L=u._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[v.get("text-radial-offset").evaluate(s,{},h)*ri,Ep]:v.get("text-offset").evaluate(s,{},h).map(O=>O*ri);const z=[];for(const O of C)z.push(O,C_(O,L));return new ho(z)}return null}function Ip(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function P2(u,s,h,m,v,S,C,L,z,O,H){let K=S.textMaxSize.evaluate(s,{});K===void 0&&(K=C);const ie=u.layers[0].layout,ce=ie.get("icon-offset").evaluate(s,{},H),ge=L_(h.horizontal),be=C/24,Te=u.tilePixelRatio*be,Ae=u.tilePixelRatio*K/24,Ze=u.tilePixelRatio*L,Re=u.tilePixelRatio*ie.get("symbol-spacing"),je=ie.get("text-padding")*u.tilePixelRatio,ut=function(xt,cn,nn,Dn=1){const _r=xt.get("icon-padding").evaluate(cn,{},nn),Cr=_r&&_r.values;return[Cr[0]*Dn,Cr[1]*Dn,Cr[2]*Dn,Cr[3]*Dn]}(ie,s,H,u.tilePixelRatio),ht=ie.get("text-max-angle")/180*Math.PI,qt=ie.get("text-rotation-alignment")!=="viewport"&&ie.get("symbol-placement")!=="point",Jt=ie.get("icon-rotation-alignment")==="map"&&ie.get("symbol-placement")!=="point",Vt=ie.get("symbol-placement"),Ot=Re/2,Pt=ie.get("icon-text-fit");let Wt;m&&Pt!=="none"&&(u.allowVerticalPlacement&&h.vertical&&(Wt=Jg(m,h.vertical,Pt,ie.get("icon-text-fit-padding"),ce,be)),ge&&(m=Jg(m,ge,Pt,ie.get("icon-text-fit-padding"),ce,be)));const Ft=(xt,cn)=>{cn.x<0||cn.x>=Or||cn.y<0||cn.y>=Or||function(nn,Dn,_r,Cr,ii,go,Oi,Kr,gi,xi,Ni,ji,oi,si,Ei,Ui,Ii,no,ro,ai,On,Ai,ki,li,Ho){const is=nn.addToLineVertexArray(Dn,_r);let os,Ns,Wo,To,io=0,js=0,Nu=0,P_=0,Bp=-1,Op=-1;const Us={};let z_=$r("");if(nn.allowVerticalPlacement&&Cr.vertical){const Pi=Kr.layout.get("text-rotate").evaluate(On,{},li)+90;Wo=new Rf(gi,Dn,xi,Ni,ji,Cr.vertical,oi,si,Ei,Pi),Oi&&(To=new Rf(gi,Dn,xi,Ni,ji,Oi,Ii,no,Ei,Pi))}if(ii){const Pi=Kr.layout.get("icon-rotate").evaluate(On,{}),Mo=Kr.layout.get("icon-text-fit")!=="none",ul=k_(ii,Pi,ki,Mo),as=Oi?k_(Oi,Pi,ki,Mo):void 0;Ns=new Rf(gi,Dn,xi,Ni,ji,ii,Ii,no,!1,Pi),io=4*ul.length;const hl=nn.iconSizeData;let Ts=null;hl.kind==="source"?(Ts=[Cs*Kr.layout.get("icon-size").evaluate(On,{})],Ts[0]>ya&&Pe(`${nn.layerIds[0]}: Value for "icon-size" is >= ${Ru}. Reduce your "icon-size".`)):hl.kind==="composite"&&(Ts=[Cs*Ai.compositeIconSizes[0].evaluate(On,{},li),Cs*Ai.compositeIconSizes[1].evaluate(On,{},li)],(Ts[0]>ya||Ts[1]>ya)&&Pe(`${nn.layerIds[0]}: Value for "icon-size" is >= ${Ru}. Reduce your "icon-size".`)),nn.addSymbols(nn.icon,ul,Ts,ai,ro,On,c.ah.none,Dn,is.lineStartIndex,is.lineLength,-1,li),Bp=nn.icon.placedSymbolArray.length-1,as&&(js=4*as.length,nn.addSymbols(nn.icon,as,Ts,ai,ro,On,c.ah.vertical,Dn,is.lineStartIndex,is.lineLength,-1,li),Op=nn.icon.placedSymbolArray.length-1)}const D_=Object.keys(Cr.horizontal);for(const Pi of D_){const Mo=Cr.horizontal[Pi];if(!os){z_=$r(Mo.text);const as=Kr.layout.get("text-rotate").evaluate(On,{},li);os=new Rf(gi,Dn,xi,Ni,ji,Mo,oi,si,Ei,as)}const ul=Mo.positionedLines.length===1;if(Nu+=M_(nn,Dn,Mo,go,Kr,Ei,On,Ui,is,Cr.vertical?c.ah.horizontal:c.ah.horizontalOnly,ul?D_:[Pi],Us,Bp,Ai,li),ul)break}Cr.vertical&&(P_+=M_(nn,Dn,Cr.vertical,go,Kr,Ei,On,Ui,is,c.ah.vertical,["vertical"],Us,Op,Ai,li));const $2=os?os.boxStartIndex:nn.collisionBoxArray.length,R2=os?os.boxEndIndex:nn.collisionBoxArray.length,F2=Wo?Wo.boxStartIndex:nn.collisionBoxArray.length,B2=Wo?Wo.boxEndIndex:nn.collisionBoxArray.length,O2=Ns?Ns.boxStartIndex:nn.collisionBoxArray.length,N2=Ns?Ns.boxEndIndex:nn.collisionBoxArray.length,j2=To?To.boxStartIndex:nn.collisionBoxArray.length,U2=To?To.boxEndIndex:nn.collisionBoxArray.length;let ss=-1;const Bf=(Pi,Mo)=>Pi&&Pi.circleDiameter?Math.max(Pi.circleDiameter,Mo):Mo;ss=Bf(os,ss),ss=Bf(Wo,ss),ss=Bf(Ns,ss),ss=Bf(To,ss);const $_=ss>-1?1:0;$_&&(ss*=Ho/ri),nn.glyphOffsetArray.length>=_c.MAX_GLYPHS&&Pe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),On.sortKey!==void 0&&nn.addToSortKeyRanges(nn.symbolInstances.length,On.sortKey);const V2=T_(Kr,On,li),[q2,Z2]=function(Pi,Mo){const ul=Pi.length,as=Mo==null?void 0:Mo.values;if((as==null?void 0:as.length)>0)for(let hl=0;hl<as.length;hl+=2){const Ts=as[hl+1];Pi.emplaceBack(c.ap[as[hl]],Ts[0],Ts[1])}return[ul,Pi.length]}(nn.textAnchorOffsets,V2);nn.symbolInstances.emplaceBack(Dn.x,Dn.y,Us.right>=0?Us.right:-1,Us.center>=0?Us.center:-1,Us.left>=0?Us.left:-1,Us.vertical||-1,Bp,Op,z_,$2,R2,F2,B2,O2,N2,j2,U2,xi,Nu,P_,io,js,$_,0,oi,ss,q2,Z2)}(u,cn,xt,h,m,v,Wt,u.layers[0],u.collisionBoxArray,s.index,s.sourceLayerIndex,u.index,Te,[je,je,je,je],qt,z,Ze,ut,Jt,ce,s,S,O,H,C)};if(Vt==="line")for(const xt of __(s.geometry,0,0,Or,Or)){const cn=M2(xt,Re,ht,h.vertical||ge,m,24,Ae,u.overscaling,Or);for(const nn of cn)ge&&z2(u,ge.text,Ot,nn)||Ft(xt,nn)}else if(Vt==="line-center"){for(const xt of s.geometry)if(xt.length>1){const cn=T2(xt,ht,h.vertical||ge,m,24,Ae);cn&&Ft(xt,cn)}}else if(s.type==="Polygon")for(const xt of lp(s.geometry,0)){const cn=I2(xt,16);Ft(xt[0],new va(cn.x,cn.y,0))}else if(s.type==="LineString")for(const xt of s.geometry)Ft(xt,new va(xt[0].x,xt[0].y,0));else if(s.type==="Point")for(const xt of s.geometry)for(const cn of xt)Ft([cn],new va(cn.x,cn.y,0))}function M_(u,s,h,m,v,S,C,L,z,O,H,K,ie,ce,ge){const be=function(Ze,Re,je,ut,ht,qt,Jt,Vt){const Ot=ut.layout.get("text-rotate").evaluate(qt,{})*Math.PI/180,Pt=[];for(const Wt of Re.positionedLines)for(const Ft of Wt.positionedGlyphs){if(!Ft.rect)continue;const xt=Ft.rect||{};let cn=qg+1,nn=!0,Dn=1,_r=0;const Cr=(ht||Vt)&&Ft.vertical,ii=Ft.metrics.advance*Ft.scale/2;if(Vt&&Re.verticalizable&&(_r=Wt.lineOffset/2-(Ft.imageName?-(ri-Ft.metrics.width*Ft.scale)/2:(Ft.scale-1)*ri)),Ft.imageName){const ai=Jt[Ft.imageName];nn=ai.sdf,Dn=ai.pixelRatio,cn=to/Dn}const go=ht?[Ft.x+ii,Ft.y]:[0,0];let Oi=ht?[0,0]:[Ft.x+ii+je[0],Ft.y+je[1]-_r],Kr=[0,0];Cr&&(Kr=Oi,Oi=[0,0]);const gi=Ft.metrics.isDoubleResolution?2:1,xi=(Ft.metrics.left-cn)*Ft.scale-ii+Oi[0],Ni=(-Ft.metrics.top-cn)*Ft.scale+Oi[1],ji=xi+xt.w/gi*Ft.scale/Dn,oi=Ni+xt.h/gi*Ft.scale/Dn,si=new _(xi,Ni),Ei=new _(ji,Ni),Ui=new _(xi,oi),Ii=new _(ji,oi);if(Cr){const ai=new _(-ii,ii-Du),On=-Math.PI/2,Ai=ri/2-ii,ki=new _(5-Du-Ai,-(Ft.imageName?Ai:0)),li=new _(...Kr);si._rotateAround(On,ai)._add(ki)._add(li),Ei._rotateAround(On,ai)._add(ki)._add(li),Ui._rotateAround(On,ai)._add(ki)._add(li),Ii._rotateAround(On,ai)._add(ki)._add(li)}if(Ot){const ai=Math.sin(Ot),On=Math.cos(Ot),Ai=[On,-ai,ai,On];si._matMult(Ai),Ei._matMult(Ai),Ui._matMult(Ai),Ii._matMult(Ai)}const no=new _(0,0),ro=new _(0,0);Pt.push({tl:si,tr:Ei,bl:Ui,br:Ii,tex:xt,writingMode:Re.writingMode,glyphOffset:go,sectionIndex:Ft.sectionIndex,isSDF:nn,pixelOffsetTL:no,pixelOffsetBR:ro,minFontScaleX:0,minFontScaleY:0})}return Pt}(0,h,L,v,S,C,m,u.allowVerticalPlacement),Te=u.textSizeData;let Ae=null;Te.kind==="source"?(Ae=[Cs*v.layout.get("text-size").evaluate(C,{})],Ae[0]>ya&&Pe(`${u.layerIds[0]}: Value for "text-size" is >= ${Ru}. Reduce your "text-size".`)):Te.kind==="composite"&&(Ae=[Cs*ce.compositeTextSizes[0].evaluate(C,{},ge),Cs*ce.compositeTextSizes[1].evaluate(C,{},ge)],(Ae[0]>ya||Ae[1]>ya)&&Pe(`${u.layerIds[0]}: Value for "text-size" is >= ${Ru}. Reduce your "text-size".`)),u.addSymbols(u.text,be,Ae,L,S,C,O,s,z.lineStartIndex,z.lineLength,ie,ge);for(const Ze of H)K[Ze]=u.text.placedSymbolArray.length-1;return 4*be.length}function L_(u){for(const s in u)return u[s];return null}function z2(u,s,h,m){const v=u.compareText;if(s in v){const S=v[s];for(let C=S.length-1;C>=0;C--)if(m.dist(S[C])<h)return!0}else v[s]=[];return v[s].push(m),!1}const E_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ap{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[h,m]=new Uint8Array(s,0,2);if(h!==219)throw new Error("Data does not appear to be in a KDBush format.");const v=m>>4;if(v!==1)throw new Error(`Got v${v} data when expected v1.`);const S=E_[15&m];if(!S)throw new Error("Unrecognized array type.");const[C]=new Uint16Array(s,2,1),[L]=new Uint32Array(s,4,1);return new Ap(L,C,S,s)}constructor(s,h=64,m=Float64Array,v){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+h,2),65535),this.ArrayType=m,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;const S=E_.indexOf(this.ArrayType),C=2*s*this.ArrayType.BYTES_PER_ELEMENT,L=s*this.IndexArrayType.BYTES_PER_ELEMENT,z=(8-L%8)%8;if(S<0)throw new Error(`Unexpected typed array class: ${m}.`);v&&v instanceof ArrayBuffer?(this.data=v,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+L+z,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+C+L+z),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+L+z,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+S]),new Uint16Array(this.data,2,1)[0]=h,new Uint32Array(this.data,4,1)[0]=s)}add(s,h){const m=this._pos>>1;return this.ids[m]=m,this.coords[this._pos++]=s,this.coords[this._pos++]=h,m}finish(){const s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return Pp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,h,m,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:S,coords:C,nodeSize:L}=this,z=[0,S.length-1,0],O=[];for(;z.length;){const H=z.pop()||0,K=z.pop()||0,ie=z.pop()||0;if(K-ie<=L){for(let Te=ie;Te<=K;Te++){const Ae=C[2*Te],Ze=C[2*Te+1];Ae>=s&&Ae<=m&&Ze>=h&&Ze<=v&&O.push(S[Te])}continue}const ce=ie+K>>1,ge=C[2*ce],be=C[2*ce+1];ge>=s&&ge<=m&&be>=h&&be<=v&&O.push(S[ce]),(H===0?s<=ge:h<=be)&&(z.push(ie),z.push(ce-1),z.push(1-H)),(H===0?m>=ge:v>=be)&&(z.push(ce+1),z.push(K),z.push(1-H))}return O}within(s,h,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:S,nodeSize:C}=this,L=[0,v.length-1,0],z=[],O=m*m;for(;L.length;){const H=L.pop()||0,K=L.pop()||0,ie=L.pop()||0;if(K-ie<=C){for(let Te=ie;Te<=K;Te++)A_(S[2*Te],S[2*Te+1],s,h)<=O&&z.push(v[Te]);continue}const ce=ie+K>>1,ge=S[2*ce],be=S[2*ce+1];A_(ge,be,s,h)<=O&&z.push(v[ce]),(H===0?s-m<=ge:h-m<=be)&&(L.push(ie),L.push(ce-1),L.push(1-H)),(H===0?s+m>=ge:h+m>=be)&&(L.push(ce+1),L.push(K),L.push(1-H))}return z}}function Pp(u,s,h,m,v,S){if(v-m<=h)return;const C=m+v>>1;I_(u,s,C,m,v,S),Pp(u,s,h,m,C-1,1-S),Pp(u,s,h,C+1,v,1-S)}function I_(u,s,h,m,v,S){for(;v>m;){if(v-m>600){const O=v-m+1,H=h-m+1,K=Math.log(O),ie=.5*Math.exp(2*K/3),ce=.5*Math.sqrt(K*ie*(O-ie)/O)*(H-O/2<0?-1:1);I_(u,s,h,Math.max(m,Math.floor(h-H*ie/O+ce)),Math.min(v,Math.floor(h+(O-H)*ie/O+ce)),S)}const C=s[2*h+S];let L=m,z=v;for(Bu(u,s,m,h),s[2*v+S]>C&&Bu(u,s,m,v);L<z;){for(Bu(u,s,L,z),L++,z--;s[2*L+S]<C;)L++;for(;s[2*z+S]>C;)z--}s[2*m+S]===C?Bu(u,s,m,z):(z++,Bu(u,s,z,v)),z<=h&&(m=z+1),h<=z&&(v=z-1)}}function Bu(u,s,h,m){zp(u,h,m),zp(s,2*h,2*m),zp(s,2*h+1,2*m+1)}function zp(u,s,h){const m=u[s];u[s]=u[h],u[h]=m}function A_(u,s,h,m){const v=u-h,S=s-m;return v*v+S*S}var Dp;c.bd=void 0,(Dp=c.bd||(c.bd={})).create="create",Dp.load="load",Dp.fullLoad="fullLoad";let Ff=null,Ou=[];const $p=1e3/60,Rp="loadTime",Fp="fullLoadTime",D2={mark(u){performance.mark(u)},frame(u){const s=u;Ff!=null&&Ou.push(s-Ff),Ff=s},clearMetrics(){Ff=null,Ou=[],performance.clearMeasures(Rp),performance.clearMeasures(Fp);for(const u in c.bd)performance.clearMarks(c.bd[u])},getPerformanceMetrics(){performance.measure(Rp,c.bd.create,c.bd.load),performance.measure(Fp,c.bd.create,c.bd.fullLoad);const u=performance.getEntriesByName(Rp)[0].duration,s=performance.getEntriesByName(Fp)[0].duration,h=Ou.length,m=1/(Ou.reduce((S,C)=>S+C,0)/h/1e3),v=Ou.filter(S=>S>$p).reduce((S,C)=>S+(C-$p)/$p,0);return{loadTime:u,fullLoadTime:s,fps:m,percentDroppedFrames:v/(h+v)*100,totalFrames:h}}};c.$=zt,c.A=hc,c.B=function(u){if(Ee==null){const s=u.navigator?u.navigator.userAgent:null;Ee=!!u.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Ee},c.C=class{constructor(u,s){this.target=u,this.mapId=s,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new S2(()=>this.process()),this.subscription=function(h,m,v,S){return h.addEventListener(m,v,!1),{unsubscribe:()=>{h.removeEventListener(m,v,!1)}}}(this.target,"message",h=>this.receive(h)),this.globalScope=Ge(self)?u:window}registerMessageHandler(u,s){this.messageHandlers[u]=s}sendAsync(u,s){return new Promise((h,m)=>{const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[v]={resolve:h,reject:m},s&&s.signal.addEventListener("abort",()=>{delete this.resolveRejects[v];const L={id:v,type:"<cancel>",origin:location.origin,targetMapId:u.targetMapId,sourceMapId:this.mapId};this.target.postMessage(L)},{once:!0});const S=[],C=Object.assign(Object.assign({},u),{id:v,sourceMapId:this.mapId,origin:location.origin,data:fa(u.data,S)});this.target.postMessage(C,{transfer:S})})}receive(u){const s=u.data,h=s.id;if(!(s.origin!=="file://"&&location.origin!=="file://"&&s.origin!==location.origin||s.targetMapId&&this.mapId!==s.targetMapId)){if(s.type==="<cancel>"){delete this.tasks[h];const m=this.abortControllers[h];return delete this.abortControllers[h],void(m&&m.abort())}if(Ge(self)||s.mustQueue)return this.tasks[h]=s,this.taskQueue.push(h),void this.invoker.trigger();this.processTask(h,s)}}process(){if(this.taskQueue.length===0)return;const u=this.taskQueue.shift(),s=this.tasks[u];delete this.tasks[u],this.taskQueue.length>0&&this.invoker.trigger(),s&&this.processTask(u,s)}processTask(u,s){return a(this,void 0,void 0,function*(){if(s.type==="<response>"){const v=this.resolveRejects[u];return delete this.resolveRejects[u],v?void(s.error?v.reject(da(s.error)):v.resolve(da(s.data))):void 0}if(!this.messageHandlers[s.type])return void this.completeTask(u,new Error(`Could not find a registered handler for ${s.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const h=da(s.data),m=new AbortController;this.abortControllers[u]=m;try{const v=yield this.messageHandlers[s.type](s.sourceMapId,h,m);this.completeTask(u,null,v)}catch(v){this.completeTask(u,v)}})}completeTask(u,s,h){const m=[];delete this.abortControllers[u];const v={id:u,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:s?fa(s):null,data:fa(h,m)};this.target.postMessage(v,{transfer:m})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},c.D=rn,c.E=jt,c.F=function(){var u=new hc(16);return hc!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u},c.G=$t,c.H=function(u,s,h){var m,v,S,C,L,z,O,H,K,ie,ce,ge,be=h[0],Te=h[1],Ae=h[2];return s===u?(u[12]=s[0]*be+s[4]*Te+s[8]*Ae+s[12],u[13]=s[1]*be+s[5]*Te+s[9]*Ae+s[13],u[14]=s[2]*be+s[6]*Te+s[10]*Ae+s[14],u[15]=s[3]*be+s[7]*Te+s[11]*Ae+s[15]):(v=s[1],S=s[2],C=s[3],L=s[4],z=s[5],O=s[6],H=s[7],K=s[8],ie=s[9],ce=s[10],ge=s[11],u[0]=m=s[0],u[1]=v,u[2]=S,u[3]=C,u[4]=L,u[5]=z,u[6]=O,u[7]=H,u[8]=K,u[9]=ie,u[10]=ce,u[11]=ge,u[12]=m*be+L*Te+K*Ae+s[12],u[13]=v*be+z*Te+ie*Ae+s[13],u[14]=S*be+O*Te+ce*Ae+s[14],u[15]=C*be+H*Te+ge*Ae+s[15]),u},c.I=yp,c.J=function(u,s,h){var m=h[0],v=h[1],S=h[2];return u[0]=s[0]*m,u[1]=s[1]*m,u[2]=s[2]*m,u[3]=s[3]*m,u[4]=s[4]*v,u[5]=s[5]*v,u[6]=s[6]*v,u[7]=s[7]*v,u[8]=s[8]*S,u[9]=s[9]*S,u[10]=s[10]*S,u[11]=s[11]*S,u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15],u},c.K=hg,c.L=function(u,s){const h={};for(let m=0;m<s.length;m++){const v=s[m];v in u&&(h[v]=u[v])}return h},c.M=ba,c.N=s_,c.O=a_,c.P=_,c.Q=Co,c.R=So,c.S=D,c.T=cu,c.U=I,c.V=rt,c.W=Or,c.X=Ur,c.Y=Pf,c.Z=class extends fu{},c._=a,c.a=Dt,c.a$=function(u,s,h){return u[0]=s[0]*h[0],u[1]=s[1]*h[1],u[2]=s[2]*h[2],u[3]=s[3]*h[3],u},c.a0=Lp,c.a1=yt,c.a2=u=>{const s=window.document.createElement("video");return s.muted=!0,new Promise(h=>{s.onloadstart=()=>{h(s)};for(const m of u){const v=window.document.createElement("source");Zt(m)||(s.crossOrigin="Anonymous"),v.src=m,s.appendChild(v)}})},c.a3=function(){return ee++},c.a4=x,c.a5=_c,c.a6=ql,c.a7=Bs,c.a8=kr,c.a9=d_,c.aA=Q,c.aB=function(u,s){if(!u)return[{command:"setStyle",args:[s]}];let h=[];try{if(!it(u.version,s.version))return[{command:"setStyle",args:[s]}];it(u.center,s.center)||h.push({command:"setCenter",args:[s.center]}),it(u.zoom,s.zoom)||h.push({command:"setZoom",args:[s.zoom]}),it(u.bearing,s.bearing)||h.push({command:"setBearing",args:[s.bearing]}),it(u.pitch,s.pitch)||h.push({command:"setPitch",args:[s.pitch]}),it(u.sprite,s.sprite)||h.push({command:"setSprite",args:[s.sprite]}),it(u.glyphs,s.glyphs)||h.push({command:"setGlyphs",args:[s.glyphs]}),it(u.transition,s.transition)||h.push({command:"setTransition",args:[s.transition]}),it(u.light,s.light)||h.push({command:"setLight",args:[s.light]}),it(u.terrain,s.terrain)||h.push({command:"setTerrain",args:[s.terrain]}),it(u.sky,s.sky)||h.push({command:"setSky",args:[s.sky]});const m={},v=[];(function(C,L,z,O){let H;for(H in L=L||{},C=C||{})Object.prototype.hasOwnProperty.call(C,H)&&(Object.prototype.hasOwnProperty.call(L,H)||nr(H,z,O));for(H in L)Object.prototype.hasOwnProperty.call(L,H)&&(Object.prototype.hasOwnProperty.call(C,H)?it(C[H],L[H])||(C[H].type==="geojson"&&L[H].type==="geojson"&&Qr(C,L,H)?Kt(z,{command:"setGeoJSONSourceData",args:[H,L[H].data]}):vr(H,L,z,O)):ur(H,L,z))})(u.sources,s.sources,v,m);const S=[];u.layers&&u.layers.forEach(C=>{"source"in C&&m[C.source]?h.push({command:"removeLayer",args:[C.id]}):S.push(C)}),h=h.concat(v),function(C,L,z){L=L||[];const O=(C=C||[]).map(Ci),H=L.map(Ci),K=C.reduce(Jn,{}),ie=L.reduce(Jn,{}),ce=O.slice(),ge=Object.create(null);let be,Te,Ae,Ze,Re;for(let je=0,ut=0;je<O.length;je++)be=O[je],Object.prototype.hasOwnProperty.call(ie,be)?ut++:(Kt(z,{command:"removeLayer",args:[be]}),ce.splice(ce.indexOf(be,ut),1));for(let je=0,ut=0;je<H.length;je++)be=H[H.length-1-je],ce[ce.length-1-je]!==be&&(Object.prototype.hasOwnProperty.call(K,be)?(Kt(z,{command:"removeLayer",args:[be]}),ce.splice(ce.lastIndexOf(be,ce.length-ut),1)):ut++,Ze=ce[ce.length-je],Kt(z,{command:"addLayer",args:[ie[be],Ze]}),ce.splice(ce.length-je,0,be),ge[be]=!0);for(let je=0;je<H.length;je++)if(be=H[je],Te=K[be],Ae=ie[be],!ge[be]&&!it(Te,Ae))if(it(Te.source,Ae.source)&&it(Te["source-layer"],Ae["source-layer"])&&it(Te.type,Ae.type)){for(Re in mr(Te.layout,Ae.layout,z,be,null,"setLayoutProperty"),mr(Te.paint,Ae.paint,z,be,null,"setPaintProperty"),it(Te.filter,Ae.filter)||Kt(z,{command:"setFilter",args:[be,Ae.filter]}),it(Te.minzoom,Ae.minzoom)&&it(Te.maxzoom,Ae.maxzoom)||Kt(z,{command:"setLayerZoomRange",args:[be,Ae.minzoom,Ae.maxzoom]}),Te)Object.prototype.hasOwnProperty.call(Te,Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&(Re.indexOf("paint.")===0?mr(Te[Re],Ae[Re],z,be,Re.slice(6),"setPaintProperty"):it(Te[Re],Ae[Re])||Kt(z,{command:"setLayerProperty",args:[be,Re,Ae[Re]]}));for(Re in Ae)Object.prototype.hasOwnProperty.call(Ae,Re)&&!Object.prototype.hasOwnProperty.call(Te,Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&(Re.indexOf("paint.")===0?mr(Te[Re],Ae[Re],z,be,Re.slice(6),"setPaintProperty"):it(Te[Re],Ae[Re])||Kt(z,{command:"setLayerProperty",args:[be,Re,Ae[Re]]}))}else Kt(z,{command:"removeLayer",args:[be]}),Ze=ce[ce.lastIndexOf(be)+1],Kt(z,{command:"addLayer",args:[Ae,Ze]})}(S,s.layers,h)}catch(m){console.warn("Unable to compute style diff:",m),h=[{command:"setStyle",args:[s]}]}return h},c.aC=function(u){const s=[],h=u.id;return h===void 0&&s.push({message:`layers.${h}: missing required property "id"`}),u.render===void 0&&s.push({message:`layers.${h}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&s.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),s},c.aD=function u(s,h){if(Array.isArray(s)){if(!Array.isArray(h)||s.length!==h.length)return!1;for(let m=0;m<s.length;m++)if(!u(s[m],h[m]))return!1;return!0}if(typeof s=="object"&&s!==null&&h!==null){if(typeof h!="object"||Object.keys(s).length!==Object.keys(h).length)return!1;for(const m in s)if(!u(s[m],h[m]))return!1;return!0}return s===h},c.aE=me,c.aF=Ie,c.aG=class extends ni{constructor(u,s){super(u,s),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},c.aH=eo,c.aI=class extends ni{constructor(u,s){super(u,s),this.current=ll}set(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let s=1;s<16;s++)if(u[s]!==this.current[s]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}},c.aJ=Zo,c.aK=class extends ni{constructor(u,s){super(u,s),this.current=[0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))}},c.aL=class extends ni{constructor(u,s){super(u,s),this.current=[0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))}},c.aM=xs,c.aN=function(u,s,h,m,v,S,C){var L=1/(s-h),z=1/(m-v),O=1/(S-C);return u[0]=-2*L,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*z,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*O,u[11]=0,u[12]=(s+h)*L,u[13]=(v+m)*z,u[14]=(C+S)*O,u[15]=1,u},c.aO=rr,c.aP=iw,c.aQ=class extends rc{},c.aR=Yw,c.aS=class extends ic{},c.aT=function(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))},c.aU=gg,c.aV=Y,c.aW=class extends yu{},c.aX=ot,c.aY=function(u,s){return u[0]===s[0]&&u[1]===s[1]&&u[2]===s[2]&&u[3]===s[3]&&u[4]===s[4]&&u[5]===s[5]&&u[6]===s[6]&&u[7]===s[7]&&u[8]===s[8]&&u[9]===s[9]&&u[10]===s[10]&&u[11]===s[11]&&u[12]===s[12]&&u[13]===s[13]&&u[14]===s[14]&&u[15]===s[15]},c.aZ=function(u,s){var h=u[0],m=u[1],v=u[2],S=u[3],C=u[4],L=u[5],z=u[6],O=u[7],H=u[8],K=u[9],ie=u[10],ce=u[11],ge=u[12],be=u[13],Te=u[14],Ae=u[15],Ze=s[0],Re=s[1],je=s[2],ut=s[3],ht=s[4],qt=s[5],Jt=s[6],Vt=s[7],Ot=s[8],Pt=s[9],Wt=s[10],Ft=s[11],xt=s[12],cn=s[13],nn=s[14],Dn=s[15];return Math.abs(h-Ze)<=Bi*Math.max(1,Math.abs(h),Math.abs(Ze))&&Math.abs(m-Re)<=Bi*Math.max(1,Math.abs(m),Math.abs(Re))&&Math.abs(v-je)<=Bi*Math.max(1,Math.abs(v),Math.abs(je))&&Math.abs(S-ut)<=Bi*Math.max(1,Math.abs(S),Math.abs(ut))&&Math.abs(C-ht)<=Bi*Math.max(1,Math.abs(C),Math.abs(ht))&&Math.abs(L-qt)<=Bi*Math.max(1,Math.abs(L),Math.abs(qt))&&Math.abs(z-Jt)<=Bi*Math.max(1,Math.abs(z),Math.abs(Jt))&&Math.abs(O-Vt)<=Bi*Math.max(1,Math.abs(O),Math.abs(Vt))&&Math.abs(H-Ot)<=Bi*Math.max(1,Math.abs(H),Math.abs(Ot))&&Math.abs(K-Pt)<=Bi*Math.max(1,Math.abs(K),Math.abs(Pt))&&Math.abs(ie-Wt)<=Bi*Math.max(1,Math.abs(ie),Math.abs(Wt))&&Math.abs(ce-Ft)<=Bi*Math.max(1,Math.abs(ce),Math.abs(Ft))&&Math.abs(ge-xt)<=Bi*Math.max(1,Math.abs(ge),Math.abs(xt))&&Math.abs(be-cn)<=Bi*Math.max(1,Math.abs(be),Math.abs(cn))&&Math.abs(Te-nn)<=Bi*Math.max(1,Math.abs(Te),Math.abs(nn))&&Math.abs(Ae-Dn)<=Bi*Math.max(1,Math.abs(Ae),Math.abs(Dn))},c.a_=function(u,s){return u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[4]=s[4],u[5]=s[5],u[6]=s[6],u[7]=s[7],u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15],u},c.aa=function(u){const s={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,m,v,S)=>{const C=v||S;return s[m]=!C||C.toLowerCase(),""}),s["max-age"]){const h=parseInt(s["max-age"],10);isNaN(h)?delete s["max-age"]:s["max-age"]=h}return s},c.ab=function(u,s){const h=[];for(const m in u)m in s||h.push(m);return h},c.ac=W,c.ad=function(u,s,h){var m=Math.sin(h),v=Math.cos(h),S=s[0],C=s[1],L=s[2],z=s[3],O=s[4],H=s[5],K=s[6],ie=s[7];return s!==u&&(u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[0]=S*v+O*m,u[1]=C*v+H*m,u[2]=L*v+K*m,u[3]=z*v+ie*m,u[4]=O*v-S*m,u[5]=H*v-C*m,u[6]=K*v-L*m,u[7]=ie*v-z*m,u},c.ae=function(u){var s=new hc(16);return s[0]=u[0],s[1]=u[1],s[2]=u[2],s[3]=u[3],s[4]=u[4],s[5]=u[5],s[6]=u[6],s[7]=u[7],s[8]=u[8],s[9]=u[9],s[10]=u[10],s[11]=u[11],s[12]=u[12],s[13]=u[13],s[14]=u[14],s[15]=u[15],s},c.af=wf,c.ag=function(u,s){let h=0,m=0;if(u.kind==="constant")m=u.layoutSize;else if(u.kind!=="source"){const{interpolationType:v,minZoom:S,maxZoom:C}=u,L=v?W(vi.interpolationFactor(v,s,S,C),0,1):0;u.kind==="camera"?m=Mi.number(u.minSize,u.maxSize,L):h=L}return{uSizeT:h,uSize:m}},c.ai=function(u,{uSize:s,uSizeT:h},{lowerSize:m,upperSize:v}){return u.kind==="source"?m/Cs:u.kind==="composite"?Mi.number(m/Cs,v/Cs,h):s},c.aj=xp,c.ak=function(u,s,h,m){const v=s.y-u.y,S=s.x-u.x,C=m.y-h.y,L=m.x-h.x,z=C*S-L*v;if(z===0)return null;const O=(L*(u.y-h.y)-C*(u.x-h.x))/z;return new _(u.x+O*S,u.y+O*v)},c.al=__,c.am=vu,c.an=tp,c.ao=ri,c.aq=wp,c.ar=function(u,s){var h=s[0],m=s[1],v=s[2],S=s[3],C=s[4],L=s[5],z=s[6],O=s[7],H=s[8],K=s[9],ie=s[10],ce=s[11],ge=s[12],be=s[13],Te=s[14],Ae=s[15],Ze=h*L-m*C,Re=h*z-v*C,je=h*O-S*C,ut=m*z-v*L,ht=m*O-S*L,qt=v*O-S*z,Jt=H*be-K*ge,Vt=H*Te-ie*ge,Ot=H*Ae-ce*ge,Pt=K*Te-ie*be,Wt=K*Ae-ce*be,Ft=ie*Ae-ce*Te,xt=Ze*Ft-Re*Wt+je*Pt+ut*Ot-ht*Vt+qt*Jt;return xt?(u[0]=(L*Ft-z*Wt+O*Pt)*(xt=1/xt),u[1]=(v*Wt-m*Ft-S*Pt)*xt,u[2]=(be*qt-Te*ht+Ae*ut)*xt,u[3]=(ie*ht-K*qt-ce*ut)*xt,u[4]=(z*Ot-C*Ft-O*Vt)*xt,u[5]=(h*Ft-v*Ot+S*Vt)*xt,u[6]=(Te*je-ge*qt-Ae*Re)*xt,u[7]=(H*qt-ie*je+ce*Re)*xt,u[8]=(C*Wt-L*Ot+O*Jt)*xt,u[9]=(m*Ot-h*Wt-S*Jt)*xt,u[10]=(ge*ht-be*je+Ae*Ze)*xt,u[11]=(K*je-H*ht-ce*Ze)*xt,u[12]=(L*Vt-C*Pt-z*Jt)*xt,u[13]=(h*Pt-m*Vt+v*Jt)*xt,u[14]=(be*Re-ge*ut-Te*Ze)*xt,u[15]=(H*ut-K*Re+ie*Ze)*xt,u):null},c.as=Ip,c.at=vp,c.au=Ap,c.av=function(){const u={},s=_e.$version;for(const h in _e.$root){const m=_e.$root[h];if(m.required){let v=null;v=h==="version"?s:m.type==="array"?[]:{},v!=null&&(u[h]=v)}}return u},c.aw=af,c.ax=Yt,c.ay=function(u){u=u.slice();const s=Object.create(null);for(let h=0;h<u.length;h++)s[u[h].id]=u[h];for(let h=0;h<u.length;h++)"ref"in u[h]&&(u[h]=Ue(u[h],s[u[h].ref]));return u},c.az=function(u){if(u.type==="custom")return new k2(u);switch(u.type){case"background":return new v2(u);case"circle":return new ow(u);case"fill":return new Cw(u);case"fill-extrusion":return new Nw(u);case"heatmap":return new aw(u);case"hillshade":return new cw(u);case"line":return new Ww(u);case"raster":return new x2(u);case"symbol":return new Af(u)}},c.b=$e,c.b0=function(u,s){return u[0]*s[0]+u[1]*s[1]+u[2]*s[2]+u[3]*s[3]},c.b1=se,c.b2=u_,c.b3=l_,c.b4=function(u,s,h,m,v){var S,C=1/Math.tan(s/2);return u[0]=C/h,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=C,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,v!=null&&v!==1/0?(u[10]=(v+m)*(S=1/(m-v)),u[14]=2*v*m*S):(u[10]=-1,u[14]=-2*m),u},c.b5=function(u,s,h){var m=Math.sin(h),v=Math.cos(h),S=s[4],C=s[5],L=s[6],z=s[7],O=s[8],H=s[9],K=s[10],ie=s[11];return s!==u&&(u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[4]=S*v+O*m,u[5]=C*v+H*m,u[6]=L*v+K*m,u[7]=z*v+ie*m,u[8]=O*v-S*m,u[9]=H*v-C*m,u[10]=K*v-L*m,u[11]=ie*v-z*m,u},c.b6=F,c.b7=N,c.b8=function(u){return u*Math.PI/180},c.b9=function(u,s){return u[0]=s[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=s[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=s[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u},c.bA=ws,c.ba=class extends ns{},c.bb=Tp,c.bc=D2,c.be=Et,c.bf=function(u,s){Dt.REGISTERED_PROTOCOLS[u]=s},c.bg=function(u){delete Dt.REGISTERED_PROTOCOLS[u]},c.bh=function(u,s){const h={};for(let v=0;v<u.length;v++){const S=s&&s[u[v].id]||Xd(u[v]);s&&(s[u[v].id]=S);let C=h[S];C||(C=h[S]=[]),C.push(u[v])}const m=[];for(const v in h)m.push(h[v]);return m},c.bi=Ht,c.bj=f_,c.bk=p_,c.bl=Gg,c.bm=function(u){u.bucket.createArrays(),u.bucket.tilePixelRatio=Or/(512*u.bucket.overscaling),u.bucket.compareText={},u.bucket.iconsNeedLinear=!1;const s=u.bucket.layers[0],h=s.layout,m=s._unevaluatedLayout._values,v={layoutIconSize:m["icon-size"].possiblyEvaluate(new kr(u.bucket.zoom+1),u.canonical),layoutTextSize:m["text-size"].possiblyEvaluate(new kr(u.bucket.zoom+1),u.canonical),textMaxSize:m["text-size"].possiblyEvaluate(new kr(18))};if(u.bucket.textSizeData.kind==="composite"){const{minZoom:O,maxZoom:H}=u.bucket.textSizeData;v.compositeTextSizes=[m["text-size"].possiblyEvaluate(new kr(O),u.canonical),m["text-size"].possiblyEvaluate(new kr(H),u.canonical)]}if(u.bucket.iconSizeData.kind==="composite"){const{minZoom:O,maxZoom:H}=u.bucket.iconSizeData;v.compositeIconSizes=[m["icon-size"].possiblyEvaluate(new kr(O),u.canonical),m["icon-size"].possiblyEvaluate(new kr(H),u.canonical)]}const S=h.get("text-line-height")*ri,C=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point",L=h.get("text-keep-upright"),z=h.get("text-size");for(const O of u.bucket.features){const H=h.get("text-font").evaluate(O,{},u.canonical).join(","),K=z.evaluate(O,{},u.canonical),ie=v.layoutTextSize.evaluate(O,{},u.canonical),ce=v.layoutIconSize.evaluate(O,{},u.canonical),ge={horizontal:{},vertical:void 0},be=O.text;let Te,Ae=[0,0];if(be){const je=be.toString(),ut=h.get("text-letter-spacing").evaluate(O,{},u.canonical)*ri,ht=lf(je)?ut:0,qt=h.get("text-anchor").evaluate(O,{},u.canonical),Jt=T_(s,O,u.canonical);if(!Jt){const Ft=h.get("text-radial-offset").evaluate(O,{},u.canonical);Ae=Ft?C_(qt,[Ft*ri,Ep]):h.get("text-offset").evaluate(O,{},u.canonical).map(xt=>xt*ri)}let Vt=C?"center":h.get("text-justify").evaluate(O,{},u.canonical);const Ot=h.get("symbol-placement"),Pt=Ot==="point"?h.get("text-max-width").evaluate(O,{},u.canonical)*ri:0,Wt=()=>{u.bucket.allowVerticalPlacement&&pa(je)&&(ge.vertical=Lf(be,u.glyphMap,u.glyphPositions,u.imagePositions,H,Pt,S,qt,"left",ht,Ae,c.ah.vertical,!0,Ot,ie,K))};if(!C&&Jt){const Ft=new Set;if(Vt==="auto")for(let cn=0;cn<Jt.values.length;cn+=2)Ft.add(Ip(Jt.values[cn]));else Ft.add(Vt);let xt=!1;for(const cn of Ft)if(!ge.horizontal[cn])if(xt)ge.horizontal[cn]=ge.horizontal[0];else{const nn=Lf(be,u.glyphMap,u.glyphPositions,u.imagePositions,H,Pt,S,"center",cn,ht,Ae,c.ah.horizontal,!1,Ot,ie,K);nn&&(ge.horizontal[cn]=nn,xt=nn.positionedLines.length===1)}Wt()}else{Vt==="auto"&&(Vt=Ip(qt));const Ft=Lf(be,u.glyphMap,u.glyphPositions,u.imagePositions,H,Pt,S,qt,Vt,ht,Ae,c.ah.horizontal,!1,Ot,ie,K);Ft&&(ge.horizontal[Vt]=Ft),Wt(),pa(je)&&C&&L&&(ge.vertical=Lf(be,u.glyphMap,u.glyphPositions,u.imagePositions,H,Pt,S,qt,Vt,ht,Ae,c.ah.vertical,!1,Ot,ie,K))}}let Ze=!1;if(O.icon&&O.icon.name){const je=u.imageMap[O.icon.name];je&&(Te=m2(u.imagePositions[O.icon.name],h.get("icon-offset").evaluate(O,{},u.canonical),h.get("icon-anchor").evaluate(O,{},u.canonical)),Ze=!!je.sdf,u.bucket.sdfIcons===void 0?u.bucket.sdfIcons=Ze:u.bucket.sdfIcons!==Ze&&Pe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(je.pixelRatio!==u.bucket.pixelRatio||h.get("icon-rotate").constantOr(1)!==0)&&(u.bucket.iconsNeedLinear=!0))}const Re=L_(ge.horizontal)||ge.vertical;u.bucket.iconsInText=!!Re&&Re.iconsInText,(Re||Te)&&P2(u.bucket,O,ge,Te,u.imageMap,v,ie,ce,Ae,Ze,u.canonical)}u.showCollisionBoxes&&u.bucket.generateCollisionDebugBuffers()},c.bn=pp,c.bo=hp,c.bp=dp,c.bq=ga,c.br=gp,c.bs=class{constructor(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let u=performance.getEntriesByName(this._marks.measure);return u.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),u=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),u}},c.bt=function(u,s,h,m,v){return a(this,void 0,void 0,function*(){if(I())try{return yield rt(u,s,h,m,v)}catch{}return function(S,C,L,z,O){const H=S.width,K=S.height;lt&&mt||(lt=new OffscreenCanvas(H,K),mt=lt.getContext("2d",{willReadFrequently:!0})),lt.width=H,lt.height=K,mt.drawImage(S,0,0,H,K);const ie=mt.getImageData(C,L,z,O);return mt.clearRect(0,0,H,K),ie.data}(u,s,h,m,v)})},c.bu=h_,c.bv=d,c.bw=p,c.bx=Fg,c.by=Ps,c.bz=function(u){return u.message===ft},c.c=Xe,c.d=u=>a(void 0,void 0,void 0,function*(){if(u.byteLength===0)return createImageBitmap(new ImageData(1,1));const s=new Blob([new Uint8Array(u)],{type:"image/png"});try{return createImageBitmap(s)}catch(h){throw new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),c.e=J,c.f=u=>new Promise((s,h)=>{const m=new Image;m.onload=()=>{s(m),URL.revokeObjectURL(m.src),m.onload=null,window.requestAnimationFrame(()=>{m.src=St})},m.onerror=()=>h(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const v=new Blob([new Uint8Array(u)],{type:"image/png"});m.src=u.byteLength?URL.createObjectURL(v):St}),c.g=_t,c.h=(u,s)=>_n(J(u,{type:"json"}),s),c.i=Ge,c.j=kt,c.k=Ne,c.l=(u,s)=>_n(J(u,{type:"arrayBuffer"}),s),c.m=_n,c.n=function(u){return new gp(u).readFields(c2,[])},c.o=Tu,c.p=Zg,c.q=Fi,c.r=Jd,c.s=Zt,c.t=ha,c.u=Ut,c.v=_e,c.w=Pe,c.x=Ds,c.y=function([u,s,h]){return s+=90,s*=Math.PI/180,h*=Math.PI/180,{x:u*Math.cos(s)*Math.sin(h),y:u*Math.sin(s)*Math.sin(h),z:u*Math.cos(h)}},c.z=Mi}),i("worker",["./shared"],function(c){class a{constructor(te){this.keyCache={},te&&this.replace(te)}replace(te){this._layerConfigs={},this._layers={},this.update(te,[])}update(te,ne){for(const we of te){this._layerConfigs[we.id]=we;const Be=this._layers[we.id]=c.az(we);Be._featureFilter=c.a6(Be.filter),this.keyCache[we.id]&&delete this.keyCache[we.id]}for(const we of ne)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};const le=c.bh(Object.values(this._layerConfigs),this.keyCache);for(const we of le){const Be=we.map(Ke=>this._layers[Ke.id]),Oe=Be[0];if(Oe.visibility==="none")continue;const qe=Oe.source||"";let De=this.familiesBySource[qe];De||(De=this.familiesBySource[qe]={});const re=Oe.sourceLayer||"_geojsonTileLayer";let He=De[re];He||(He=De[re]=[]),He.push(Be)}}}class d{constructor(te){const ne={},le=[];for(const qe in te){const De=te[qe],re=ne[qe]={};for(const He in De){const Ke=De[+He];if(!Ke||Ke.bitmap.width===0||Ke.bitmap.height===0)continue;const Ye={x:0,y:0,w:Ke.bitmap.width+2,h:Ke.bitmap.height+2};le.push(Ye),re[He]={rect:Ye,metrics:Ke.metrics}}}const{w:we,h:Be}=c.p(le),Oe=new c.o({width:we||1,height:Be||1});for(const qe in te){const De=te[qe];for(const re in De){const He=De[+re];if(!He||He.bitmap.width===0||He.bitmap.height===0)continue;const Ke=ne[qe][re].rect;c.o.copy(He.bitmap,Oe,{x:0,y:0},{x:Ke.x+1,y:Ke.y+1},He.bitmap)}}this.image=Oe,this.positions=ne}}c.bi("GlyphAtlas",d);class p{constructor(te){this.tileID=new c.Q(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.uid=te.uid,this.zoom=te.zoom,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=te.showCollisionBoxes,this.collectResourceTiming=!!te.collectResourceTiming,this.returnDependencies=!!te.returnDependencies,this.promoteId=te.promoteId,this.inFlightDependencies=[]}parse(te,ne,le,we){return c._(this,void 0,void 0,function*(){this.status="parsing",this.data=te,this.collisionBoxArray=new c.a4;const Be=new c.bj(Object.keys(te.layers).sort()),Oe=new c.bk(this.tileID,this.promoteId);Oe.bucketLayerIDs=[];const qe={},De={featureIndex:Oe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:le},re=ne.familiesBySource[this.source];for(const xn in re){const Pr=te.layers[xn];if(!Pr)continue;Pr.version===1&&c.w(`Vector tile source "${this.source}" layer "${xn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ei=Be.encode(xn),Ti=[];for(let Di=0;Di<Pr.length;Di++){const hi=Pr.feature(Di),No=Oe.getId(hi,xn);Ti.push({feature:hi,id:No,index:Di,sourceLayerIndex:ei})}for(const Di of re[xn]){const hi=Di[0];hi.source!==this.source&&c.w(`layer.source = ${hi.source} does not equal this.source = ${this.source}`),hi.minzoom&&this.zoom<Math.floor(hi.minzoom)||hi.maxzoom&&this.zoom>=hi.maxzoom||hi.visibility!=="none"&&(y(Di,this.zoom,le),(qe[hi.id]=hi.createBucket({index:Oe.bucketLayerIDs.length,layers:Di,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ei,sourceID:this.source})).populate(Ti,De,this.tileID.canonical),Oe.bucketLayerIDs.push(Di.map(No=>No.id)))}}const He=c.aE(De.glyphDependencies,xn=>Object.keys(xn).map(Number));this.inFlightDependencies.forEach(xn=>xn==null?void 0:xn.abort()),this.inFlightDependencies=[];let Ke=Promise.resolve({});if(Object.keys(He).length){const xn=new AbortController;this.inFlightDependencies.push(xn),Ke=we.sendAsync({type:"GG",data:{stacks:He,source:this.source,tileID:this.tileID,type:"glyphs"}},xn)}const Ye=Object.keys(De.iconDependencies);let ct=Promise.resolve({});if(Ye.length){const xn=new AbortController;this.inFlightDependencies.push(xn),ct=we.sendAsync({type:"GI",data:{icons:Ye,source:this.source,tileID:this.tileID,type:"icons"}},xn)}const Ct=Object.keys(De.patternDependencies);let Xt=Promise.resolve({});if(Ct.length){const xn=new AbortController;this.inFlightDependencies.push(xn),Xt=we.sendAsync({type:"GI",data:{icons:Ct,source:this.source,tileID:this.tileID,type:"patterns"}},xn)}const[fn,wn,Bn]=yield Promise.all([Ke,ct,Xt]),xr=new d(fn),qr=new c.bl(wn,Bn);for(const xn in qe){const Pr=qe[xn];Pr instanceof c.a5?(y(Pr.layers,this.zoom,le),c.bm({bucket:Pr,glyphMap:fn,glyphPositions:xr.positions,imageMap:wn,imagePositions:qr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Pr.hasPattern&&(Pr instanceof c.bn||Pr instanceof c.bo||Pr instanceof c.bp)&&(y(Pr.layers,this.zoom,le),Pr.addFeatures(De,this.tileID.canonical,qr.patternPositions))}return this.status="done",{buckets:Object.values(qe).filter(xn=>!xn.isEmpty()),featureIndex:Oe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xr.image,imageAtlas:qr,glyphMap:this.returnDependencies?fn:null,iconMap:this.returnDependencies?wn:null,glyphPositions:this.returnDependencies?xr.positions:null}})}}function y(Ce,te,ne){const le=new c.a8(te);for(const we of Ce)we.recalculate(le,ne)}class _{constructor(te,ne,le){this.actor=te,this.layerIndex=ne,this.availableImages=le,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(te,ne){return c._(this,void 0,void 0,function*(){const le=yield c.l(te.request,ne);try{return{vectorTile:new c.bq.VectorTile(new c.br(le.data)),rawData:le.data,cacheControl:le.cacheControl,expires:le.expires}}catch(we){const Be=new Uint8Array(le.data);let Oe=`Unable to parse the tile at ${te.request.url}, `;throw Oe+=Be[0]===31&&Be[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${we.messge}`,new Error(Oe)}})}loadTile(te){return c._(this,void 0,void 0,function*(){const ne=te.uid,le=!!(te&&te.request&&te.request.collectResourceTiming)&&new c.bs(te.request),we=new p(te);this.loading[ne]=we;const Be=new AbortController;we.abort=Be;try{const Oe=yield this.loadVectorTile(te,Be);if(delete this.loading[ne],!Oe)return null;const qe=Oe.rawData,De={};Oe.expires&&(De.expires=Oe.expires),Oe.cacheControl&&(De.cacheControl=Oe.cacheControl);const re={};if(le){const Ke=le.finish();Ke&&(re.resourceTiming=JSON.parse(JSON.stringify(Ke)))}we.vectorTile=Oe.vectorTile;const He=we.parse(Oe.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[ne]=we,this.fetching[ne]={rawTileData:qe,cacheControl:De,resourceTiming:re};try{const Ke=yield He;return c.e({rawTileData:qe.slice(0)},Ke,De,re)}finally{delete this.fetching[ne]}}catch(Oe){throw delete this.loading[ne],we.status="done",this.loaded[ne]=we,Oe}})}reloadTile(te){return c._(this,void 0,void 0,function*(){const ne=te.uid;if(!this.loaded||!this.loaded[ne])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const le=this.loaded[ne];if(le.showCollisionBoxes=te.showCollisionBoxes,le.status==="parsing"){const we=yield le.parse(le.vectorTile,this.layerIndex,this.availableImages,this.actor);let Be;if(this.fetching[ne]){const{rawTileData:Oe,cacheControl:qe,resourceTiming:De}=this.fetching[ne];delete this.fetching[ne],Be=c.e({rawTileData:Oe.slice(0)},we,qe,De)}else Be=we;return Be}if(le.status==="done"&&le.vectorTile)return le.parse(le.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(te){return c._(this,void 0,void 0,function*(){const ne=this.loading,le=te.uid;ne&&ne[le]&&ne[le].abort&&(ne[le].abort.abort(),delete ne[le])})}removeTile(te){return c._(this,void 0,void 0,function*(){this.loaded&&this.loaded[te.uid]&&delete this.loaded[te.uid]})}}class w{constructor(){this.loaded={}}loadTile(te){return c._(this,void 0,void 0,function*(){const{uid:ne,encoding:le,rawImageData:we,redFactor:Be,greenFactor:Oe,blueFactor:qe,baseShift:De}=te,re=we.width+2,He=we.height+2,Ke=c.b(we)?new c.R({width:re,height:He},yield c.bt(we,-1,-1,re,He)):we,Ye=new c.bu(ne,Ke,le,Be,Oe,qe,De);return this.loaded=this.loaded||{},this.loaded[ne]=Ye,Ye})}removeTile(te){const ne=this.loaded,le=te.uid;ne&&ne[le]&&delete ne[le]}}function T(Ce,te){if(Ce.length!==0){M(Ce[0],te);for(var ne=1;ne<Ce.length;ne++)M(Ce[ne],!te)}}function M(Ce,te){for(var ne=0,le=0,we=0,Be=Ce.length,Oe=Be-1;we<Be;Oe=we++){var qe=(Ce[we][0]-Ce[Oe][0])*(Ce[Oe][1]+Ce[we][1]),De=ne+qe;le+=Math.abs(ne)>=Math.abs(qe)?ne-De+qe:qe-De+ne,ne=De}ne+le>=0!=!!te&&Ce.reverse()}var $=c.bv(function Ce(te,ne){var le,we=te&&te.type;if(we==="FeatureCollection")for(le=0;le<te.features.length;le++)Ce(te.features[le],ne);else if(we==="GeometryCollection")for(le=0;le<te.geometries.length;le++)Ce(te.geometries[le],ne);else if(we==="Feature")Ce(te.geometry,ne);else if(we==="Polygon")T(te.coordinates,ne);else if(we==="MultiPolygon")for(le=0;le<te.coordinates.length;le++)T(te.coordinates[le],ne);return te});const P=c.bq.VectorTileFeature.prototype.toGeoJSON;var D={exports:{}},I=c.bw,F=c.bq.VectorTileFeature,N=W;function W(Ce,te){this.options=te||{},this.features=Ce,this.length=Ce.length}function se(Ce,te){this.id=typeof Ce.id=="number"?Ce.id:void 0,this.type=Ce.type,this.rawGeometry=Ce.type===1?[Ce.geometry]:Ce.geometry,this.properties=Ce.tags,this.extent=te||4096}W.prototype.feature=function(Ce){return new se(this.features[Ce],this.options.extent)},se.prototype.loadGeometry=function(){var Ce=this.rawGeometry;this.geometry=[];for(var te=0;te<Ce.length;te++){for(var ne=Ce[te],le=[],we=0;we<ne.length;we++)le.push(new I(ne[we][0],ne[we][1]));this.geometry.push(le)}return this.geometry},se.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ce=this.geometry,te=1/0,ne=-1/0,le=1/0,we=-1/0,Be=0;Be<Ce.length;Be++)for(var Oe=Ce[Be],qe=0;qe<Oe.length;qe++){var De=Oe[qe];te=Math.min(te,De.x),ne=Math.max(ne,De.x),le=Math.min(le,De.y),we=Math.max(we,De.y)}return[te,le,ne,we]},se.prototype.toGeoJSON=F.prototype.toGeoJSON;var J=c.bx,ee=N;function me(Ce){var te=new J;return function(ne,le){for(var we in ne.layers)le.writeMessage(3,Ie,ne.layers[we])}(Ce,te),te.finish()}function Ie(Ce,te){var ne;te.writeVarintField(15,Ce.version||1),te.writeStringField(1,Ce.name||""),te.writeVarintField(5,Ce.extent||4096);var le={keys:[],values:[],keycache:{},valuecache:{}};for(ne=0;ne<Ce.length;ne++)le.feature=Ce.feature(ne),te.writeMessage(2,Q,le);var we=le.keys;for(ne=0;ne<we.length;ne++)te.writeStringField(3,we[ne]);var Be=le.values;for(ne=0;ne<Be.length;ne++)te.writeMessage(4,Ge,Be[ne])}function Q(Ce,te){var ne=Ce.feature;ne.id!==void 0&&te.writeVarintField(1,ne.id),te.writeMessage(2,ae,Ce),te.writeVarintField(3,ne.type),te.writeMessage(4,tt,ne)}function ae(Ce,te){var ne=Ce.feature,le=Ce.keys,we=Ce.values,Be=Ce.keycache,Oe=Ce.valuecache;for(var qe in ne.properties){var De=ne.properties[qe],re=Be[qe];if(De!==null){re===void 0&&(le.push(qe),Be[qe]=re=le.length-1),te.writeVarint(re);var He=typeof De;He!=="string"&&He!=="boolean"&&He!=="number"&&(De=JSON.stringify(De));var Ke=He+":"+De,Ye=Oe[Ke];Ye===void 0&&(we.push(De),Oe[Ke]=Ye=we.length-1),te.writeVarint(Ye)}}}function Pe(Ce,te){return(te<<3)+(7&Ce)}function ve(Ce){return Ce<<1^Ce>>31}function tt(Ce,te){for(var ne=Ce.loadGeometry(),le=Ce.type,we=0,Be=0,Oe=ne.length,qe=0;qe<Oe;qe++){var De=ne[qe],re=1;le===1&&(re=De.length),te.writeVarint(Pe(1,re));for(var He=le===3?De.length-1:De.length,Ke=0;Ke<He;Ke++){Ke===1&&le!==1&&te.writeVarint(Pe(2,He-1));var Ye=De[Ke].x-we,ct=De[Ke].y-Be;te.writeVarint(ve(Ye)),te.writeVarint(ve(ct)),we+=Ye,Be+=ct}le===3&&te.writeVarint(Pe(7,1))}}function Ge(Ce,te){var ne=typeof Ce;ne==="string"?te.writeStringField(1,Ce):ne==="boolean"?te.writeBooleanField(7,Ce):ne==="number"&&(Ce%1!=0?te.writeDoubleField(3,Ce):Ce<0?te.writeSVarintField(6,Ce):te.writeVarintField(5,Ce))}D.exports=me,D.exports.fromVectorTileJs=me,D.exports.fromGeojsonVt=function(Ce,te){te=te||{};var ne={};for(var le in Ce)ne[le]=new ee(Ce[le].features,te),ne[le].name=le,ne[le].version=te.version,ne[le].extent=te.extent;return me({layers:ne})},D.exports.GeoJSONWrapper=ee;var Ee=c.bv(D.exports);const $e={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ce=>Ce},St=Math.fround||(rt=new Float32Array(1),Ce=>(rt[0]=+Ce,rt[0]));var rt;const lt=3,mt=5,ft=6;class Xe{constructor(te){this.options=Object.assign(Object.create($e),te),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(te){const{log:ne,minZoom:le,maxZoom:we}=this.options;ne&&console.time("total time");const Be=`prepare ${te.length} points`;ne&&console.time(Be),this.points=te;const Oe=[];for(let De=0;De<te.length;De++){const re=te[De];if(!re.geometry)continue;const[He,Ke]=re.geometry.coordinates,Ye=St($t(He)),ct=St(Et(Ke));Oe.push(Ye,ct,1/0,De,-1,1),this.options.reduce&&Oe.push(0)}let qe=this.trees[we+1]=this._createTree(Oe);ne&&console.timeEnd(Be);for(let De=we;De>=le;De--){const re=+Date.now();qe=this.trees[De]=this._createTree(this._cluster(qe,De)),ne&&console.log("z%d: %d clusters in %dms",De,qe.numItems,+Date.now()-re)}return ne&&console.timeEnd("total time"),this}getClusters(te,ne){let le=((te[0]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,te[1]));let Be=te[2]===180?180:((te[2]+180)%360+360)%360-180;const Oe=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)le=-180,Be=180;else if(le>Be){const Ke=this.getClusters([le,we,180,Oe],ne),Ye=this.getClusters([-180,we,Be,Oe],ne);return Ke.concat(Ye)}const qe=this.trees[this._limitZoom(ne)],De=qe.range($t(le),Et(Oe),$t(Be),Et(we)),re=qe.data,He=[];for(const Ke of De){const Ye=this.stride*Ke;He.push(re[Ye+mt]>1?Dt(re,Ye,this.clusterProps):this.points[re[Ye+lt]])}return He}getChildren(te){const ne=this._getOriginId(te),le=this._getOriginZoom(te),we="No cluster with the specified id.",Be=this.trees[le];if(!Be)throw new Error(we);const Oe=Be.data;if(ne*this.stride>=Oe.length)throw new Error(we);const qe=this.options.radius/(this.options.extent*Math.pow(2,le-1)),De=Be.within(Oe[ne*this.stride],Oe[ne*this.stride+1],qe),re=[];for(const He of De){const Ke=He*this.stride;Oe[Ke+4]===te&&re.push(Oe[Ke+mt]>1?Dt(Oe,Ke,this.clusterProps):this.points[Oe[Ke+lt]])}if(re.length===0)throw new Error(we);return re}getLeaves(te,ne,le){const we=[];return this._appendLeaves(we,te,ne=ne||10,le=le||0,0),we}getTile(te,ne,le){const we=this.trees[this._limitZoom(te)],Be=Math.pow(2,te),{extent:Oe,radius:qe}=this.options,De=qe/Oe,re=(le-De)/Be,He=(le+1+De)/Be,Ke={features:[]};return this._addTileFeatures(we.range((ne-De)/Be,re,(ne+1+De)/Be,He),we.data,ne,le,Be,Ke),ne===0&&this._addTileFeatures(we.range(1-De/Be,re,1,He),we.data,Be,le,Be,Ke),ne===Be-1&&this._addTileFeatures(we.range(0,re,De/Be,He),we.data,-1,le,Be,Ke),Ke.features.length?Ke:null}getClusterExpansionZoom(te){let ne=this._getOriginZoom(te)-1;for(;ne<=this.options.maxZoom;){const le=this.getChildren(te);if(ne++,le.length!==1)break;te=le[0].properties.cluster_id}return ne}_appendLeaves(te,ne,le,we,Be){const Oe=this.getChildren(ne);for(const qe of Oe){const De=qe.properties;if(De&&De.cluster?Be+De.point_count<=we?Be+=De.point_count:Be=this._appendLeaves(te,De.cluster_id,le,we,Be):Be<we?Be++:te.push(qe),te.length===le)break}return Be}_createTree(te){const ne=new c.au(te.length/this.stride|0,this.options.nodeSize,Float32Array);for(let le=0;le<te.length;le+=this.stride)ne.add(te[le],te[le+1]);return ne.finish(),ne.data=te,ne}_addTileFeatures(te,ne,le,we,Be,Oe){for(const qe of te){const De=qe*this.stride,re=ne[De+mt]>1;let He,Ke,Ye;if(re)He=_t(ne,De,this.clusterProps),Ke=ne[De],Ye=ne[De+1];else{const Xt=this.points[ne[De+lt]];He=Xt.properties;const[fn,wn]=Xt.geometry.coordinates;Ke=$t(fn),Ye=Et(wn)}const ct={type:1,geometry:[[Math.round(this.options.extent*(Ke*Be-le)),Math.round(this.options.extent*(Ye*Be-we))]],tags:He};let Ct;Ct=re||this.options.generateId?ne[De+lt]:this.points[ne[De+lt]].id,Ct!==void 0&&(ct.id=Ct),Oe.features.push(ct)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(Math.floor(+te),this.options.maxZoom+1))}_cluster(te,ne){const{radius:le,extent:we,reduce:Be,minPoints:Oe}=this.options,qe=le/(we*Math.pow(2,ne)),De=te.data,re=[],He=this.stride;for(let Ke=0;Ke<De.length;Ke+=He){if(De[Ke+2]<=ne)continue;De[Ke+2]=ne;const Ye=De[Ke],ct=De[Ke+1],Ct=te.within(De[Ke],De[Ke+1],qe),Xt=De[Ke+mt];let fn=Xt;for(const wn of Ct){const Bn=wn*He;De[Bn+2]>ne&&(fn+=De[Bn+mt])}if(fn>Xt&&fn>=Oe){let wn,Bn=Ye*Xt,xr=ct*Xt,qr=-1;const xn=((Ke/He|0)<<5)+(ne+1)+this.points.length;for(const Pr of Ct){const ei=Pr*He;if(De[ei+2]<=ne)continue;De[ei+2]=ne;const Ti=De[ei+mt];Bn+=De[ei]*Ti,xr+=De[ei+1]*Ti,De[ei+4]=xn,Be&&(wn||(wn=this._map(De,Ke,!0),qr=this.clusterProps.length,this.clusterProps.push(wn)),Be(wn,this._map(De,ei)))}De[Ke+4]=xn,re.push(Bn/fn,xr/fn,1/0,xn,-1,fn),Be&&re.push(qr)}else{for(let wn=0;wn<He;wn++)re.push(De[Ke+wn]);if(fn>1)for(const wn of Ct){const Bn=wn*He;if(!(De[Bn+2]<=ne)){De[Bn+2]=ne;for(let xr=0;xr<He;xr++)re.push(De[Bn+xr])}}}}return re}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,ne,le){if(te[ne+mt]>1){const Oe=this.clusterProps[te[ne+ft]];return le?Object.assign({},Oe):Oe}const we=this.points[te[ne+lt]].properties,Be=this.options.map(we);return le&&Be===we?Object.assign({},Be):Be}}function Dt(Ce,te,ne){return{type:"Feature",id:Ce[te+lt],properties:_t(Ce,te,ne),geometry:{type:"Point",coordinates:[(le=Ce[te],360*(le-.5)),Yt(Ce[te+1])]}};var le}function _t(Ce,te,ne){const le=Ce[te+mt],we=le>=1e4?`${Math.round(le/1e3)}k`:le>=1e3?Math.round(le/100)/10+"k":le,Be=Ce[te+ft],Oe=Be===-1?{}:Object.assign({},ne[Be]);return Object.assign(Oe,{cluster:!0,cluster_id:Ce[te+lt],point_count:le,point_count_abbreviated:we})}function $t(Ce){return Ce/360+.5}function Et(Ce){const te=Math.sin(Ce*Math.PI/180),ne=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return ne<0?0:ne>1?1:ne}function Yt(Ce){const te=(180-360*Ce)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}function _n(Ce,te,ne,le){for(var we,Be=le,Oe=ne-te>>1,qe=ne-te,De=Ce[te],re=Ce[te+1],He=Ce[ne],Ke=Ce[ne+1],Ye=te+3;Ye<ne;Ye+=3){var ct=Zt(Ce[Ye],Ce[Ye+1],De,re,He,Ke);if(ct>Be)we=Ye,Be=ct;else if(ct===Be){var Ct=Math.abs(Ye-Oe);Ct<qe&&(we=Ye,qe=Ct)}}Be>le&&(we-te>3&&_n(Ce,te,we,le),Ce[we+2]=Be,ne-we>3&&_n(Ce,we,ne,le))}function Zt(Ce,te,ne,le,we,Be){var Oe=we-ne,qe=Be-le;if(Oe!==0||qe!==0){var De=((Ce-ne)*Oe+(te-le)*qe)/(Oe*Oe+qe*qe);De>1?(ne=we,le=Be):De>0&&(ne+=Oe*De,le+=qe*De)}return(Oe=Ce-ne)*Oe+(qe=te-le)*qe}function ln(Ce,te,ne,le){var we={id:Ce===void 0?null:Ce,type:te,geometry:ne,tags:le,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Be){var Oe=Be.geometry,qe=Be.type;if(qe==="Point"||qe==="MultiPoint"||qe==="LineString")ze(Be,Oe);else if(qe==="Polygon"||qe==="MultiLineString")for(var De=0;De<Oe.length;De++)ze(Be,Oe[De]);else if(qe==="MultiPolygon")for(De=0;De<Oe.length;De++)for(var re=0;re<Oe[De].length;re++)ze(Be,Oe[De][re])}(we),we}function ze(Ce,te){for(var ne=0;ne<te.length;ne+=3)Ce.minX=Math.min(Ce.minX,te[ne]),Ce.minY=Math.min(Ce.minY,te[ne+1]),Ce.maxX=Math.max(Ce.maxX,te[ne]),Ce.maxY=Math.max(Ce.maxY,te[ne+1])}function Ne(Ce,te,ne,le){if(te.geometry){var we=te.geometry.coordinates,Be=te.geometry.type,Oe=Math.pow(ne.tolerance/((1<<ne.maxZoom)*ne.extent),2),qe=[],De=te.id;if(ne.promoteId?De=te.properties[ne.promoteId]:ne.generateId&&(De=le||0),Be==="Point")kt(we,qe);else if(Be==="MultiPoint")for(var re=0;re<we.length;re++)kt(we[re],qe);else if(Be==="LineString")jt(we,qe,Oe,!1);else if(Be==="MultiLineString"){if(ne.lineMetrics){for(re=0;re<we.length;re++)jt(we[re],qe=[],Oe,!1),Ce.push(ln(De,"LineString",qe,te.properties));return}_e(we,qe,Oe,!1)}else if(Be==="Polygon")_e(we,qe,Oe,!0);else{if(Be!=="MultiPolygon"){if(Be==="GeometryCollection"){for(re=0;re<te.geometry.geometries.length;re++)Ne(Ce,{id:De,geometry:te.geometry.geometries[re],properties:te.properties},ne,le);return}throw new Error("Input data is not a valid GeoJSON object.")}for(re=0;re<we.length;re++){var He=[];_e(we[re],He,Oe,!0),qe.push(He)}}Ce.push(ln(De,Be,qe,te.properties))}}function kt(Ce,te){te.push(vn(Ce[0])),te.push(Ue(Ce[1])),te.push(0)}function jt(Ce,te,ne,le){for(var we,Be,Oe=0,qe=0;qe<Ce.length;qe++){var De=vn(Ce[qe][0]),re=Ue(Ce[qe][1]);te.push(De),te.push(re),te.push(0),qe>0&&(Oe+=le?(we*re-De*Be)/2:Math.sqrt(Math.pow(De-we,2)+Math.pow(re-Be,2))),we=De,Be=re}var He=te.length-3;te[2]=1,_n(te,0,He,ne),te[He+2]=1,te.size=Math.abs(Oe),te.start=0,te.end=te.size}function _e(Ce,te,ne,le){for(var we=0;we<Ce.length;we++){var Be=[];jt(Ce[we],Be,ne,le),te.push(Be)}}function vn(Ce){return Ce/360+.5}function Ue(Ce){var te=Math.sin(Ce*Math.PI/180),ne=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return ne<0?0:ne>1?1:ne}function it(Ce,te,ne,le,we,Be,Oe,qe){if(le/=te,Be>=(ne/=te)&&Oe<le)return Ce;if(Oe<ne||Be>=le)return null;for(var De=[],re=0;re<Ce.length;re++){var He=Ce[re],Ke=He.geometry,Ye=He.type,ct=we===0?He.minX:He.minY,Ct=we===0?He.maxX:He.maxY;if(ct>=ne&&Ct<le)De.push(He);else if(!(Ct<ne||ct>=le)){var Xt=[];if(Ye==="Point"||Ye==="MultiPoint")Kt(Ke,Xt,ne,le,we);else if(Ye==="LineString")ur(Ke,Xt,ne,le,we,!1,qe.lineMetrics);else if(Ye==="MultiLineString")vr(Ke,Xt,ne,le,we,!1);else if(Ye==="Polygon")vr(Ke,Xt,ne,le,we,!0);else if(Ye==="MultiPolygon")for(var fn=0;fn<Ke.length;fn++){var wn=[];vr(Ke[fn],wn,ne,le,we,!0),wn.length&&Xt.push(wn)}if(Xt.length){if(qe.lineMetrics&&Ye==="LineString"){for(fn=0;fn<Xt.length;fn++)De.push(ln(He.id,Ye,Xt[fn],He.tags));continue}Ye!=="LineString"&&Ye!=="MultiLineString"||(Xt.length===1?(Ye="LineString",Xt=Xt[0]):Ye="MultiLineString"),Ye!=="Point"&&Ye!=="MultiPoint"||(Ye=Xt.length===3?"Point":"MultiPoint"),De.push(ln(He.id,Ye,Xt,He.tags))}}}return De.length?De:null}function Kt(Ce,te,ne,le,we){for(var Be=0;Be<Ce.length;Be+=3){var Oe=Ce[Be+we];Oe>=ne&&Oe<=le&&(te.push(Ce[Be]),te.push(Ce[Be+1]),te.push(Ce[Be+2]))}}function ur(Ce,te,ne,le,we,Be,Oe){for(var qe,De,re=nr(Ce),He=we===0?mr:Ci,Ke=Ce.start,Ye=0;Ye<Ce.length-3;Ye+=3){var ct=Ce[Ye],Ct=Ce[Ye+1],Xt=Ce[Ye+2],fn=Ce[Ye+3],wn=Ce[Ye+4],Bn=we===0?ct:Ct,xr=we===0?fn:wn,qr=!1;Oe&&(qe=Math.sqrt(Math.pow(ct-fn,2)+Math.pow(Ct-wn,2))),Bn<ne?xr>ne&&(De=He(re,ct,Ct,fn,wn,ne),Oe&&(re.start=Ke+qe*De)):Bn>le?xr<le&&(De=He(re,ct,Ct,fn,wn,le),Oe&&(re.start=Ke+qe*De)):Qr(re,ct,Ct,Xt),xr<ne&&Bn>=ne&&(De=He(re,ct,Ct,fn,wn,ne),qr=!0),xr>le&&Bn<=le&&(De=He(re,ct,Ct,fn,wn,le),qr=!0),!Be&&qr&&(Oe&&(re.end=Ke+qe*De),te.push(re),re=nr(Ce)),Oe&&(Ke+=qe)}var xn=Ce.length-3;ct=Ce[xn],Ct=Ce[xn+1],Xt=Ce[xn+2],(Bn=we===0?ct:Ct)>=ne&&Bn<=le&&Qr(re,ct,Ct,Xt),xn=re.length-3,Be&&xn>=3&&(re[xn]!==re[0]||re[xn+1]!==re[1])&&Qr(re,re[0],re[1],re[2]),re.length&&te.push(re)}function nr(Ce){var te=[];return te.size=Ce.size,te.start=Ce.start,te.end=Ce.end,te}function vr(Ce,te,ne,le,we,Be){for(var Oe=0;Oe<Ce.length;Oe++)ur(Ce[Oe],te,ne,le,we,Be,!1)}function Qr(Ce,te,ne,le){Ce.push(te),Ce.push(ne),Ce.push(le)}function mr(Ce,te,ne,le,we,Be){var Oe=(Be-te)/(le-te);return Ce.push(Be),Ce.push(ne+(we-ne)*Oe),Ce.push(1),Oe}function Ci(Ce,te,ne,le,we,Be){var Oe=(Be-ne)/(we-ne);return Ce.push(te+(le-te)*Oe),Ce.push(Be),Ce.push(1),Oe}function Jn(Ce,te){for(var ne=[],le=0;le<Ce.length;le++){var we,Be=Ce[le],Oe=Be.type;if(Oe==="Point"||Oe==="MultiPoint"||Oe==="LineString")we=yt(Be.geometry,te);else if(Oe==="MultiLineString"||Oe==="Polygon"){we=[];for(var qe=0;qe<Be.geometry.length;qe++)we.push(yt(Be.geometry[qe],te))}else if(Oe==="MultiPolygon")for(we=[],qe=0;qe<Be.geometry.length;qe++){for(var De=[],re=0;re<Be.geometry[qe].length;re++)De.push(yt(Be.geometry[qe][re],te));we.push(De)}ne.push(ln(Be.id,Oe,we,Be.tags))}return ne}function yt(Ce,te){var ne=[];ne.size=Ce.size,Ce.start!==void 0&&(ne.start=Ce.start,ne.end=Ce.end);for(var le=0;le<Ce.length;le+=3)ne.push(Ce[le]+te,Ce[le+1],Ce[le+2]);return ne}function wr(Ce,te){if(Ce.transformed)return Ce;var ne,le,we,Be=1<<Ce.z,Oe=Ce.x,qe=Ce.y;for(ne=0;ne<Ce.features.length;ne++){var De=Ce.features[ne],re=De.geometry,He=De.type;if(De.geometry=[],He===1)for(le=0;le<re.length;le+=2)De.geometry.push(Tr(re[le],re[le+1],te,Be,Oe,qe));else for(le=0;le<re.length;le++){var Ke=[];for(we=0;we<re[le].length;we+=2)Ke.push(Tr(re[le][we],re[le][we+1],te,Be,Oe,qe));De.geometry.push(Ke)}}return Ce.transformed=!0,Ce}function Tr(Ce,te,ne,le,we,Be){return[Math.round(ne*(Ce*le-we)),Math.round(ne*(te*le-Be))]}function uo(Ce,te,ne,le,we){for(var Be=te===we.maxZoom?0:we.tolerance/((1<<te)*we.extent),Oe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ne,y:le,z:te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},qe=0;qe<Ce.length;qe++){Oe.numFeatures++,Yn(Oe,Ce[qe],Be,we);var De=Ce[qe].minX,re=Ce[qe].minY,He=Ce[qe].maxX,Ke=Ce[qe].maxY;De<Oe.minX&&(Oe.minX=De),re<Oe.minY&&(Oe.minY=re),He>Oe.maxX&&(Oe.maxX=He),Ke>Oe.maxY&&(Oe.maxY=Ke)}return Oe}function Yn(Ce,te,ne,le){var we=te.geometry,Be=te.type,Oe=[];if(Be==="Point"||Be==="MultiPoint")for(var qe=0;qe<we.length;qe+=3)Oe.push(we[qe]),Oe.push(we[qe+1]),Ce.numPoints++,Ce.numSimplified++;else if(Be==="LineString")At(Oe,we,Ce,ne,!1,!1);else if(Be==="MultiLineString"||Be==="Polygon")for(qe=0;qe<we.length;qe++)At(Oe,we[qe],Ce,ne,Be==="Polygon",qe===0);else if(Be==="MultiPolygon")for(var De=0;De<we.length;De++){var re=we[De];for(qe=0;qe<re.length;qe++)At(Oe,re[qe],Ce,ne,!0,qe===0)}if(Oe.length){var He=te.tags||null;if(Be==="LineString"&&le.lineMetrics){for(var Ke in He={},te.tags)He[Ke]=te.tags[Ke];He.mapbox_clip_start=we.start/we.size,He.mapbox_clip_end=we.end/we.size}var Ye={geometry:Oe,type:Be==="Polygon"||Be==="MultiPolygon"?3:Be==="LineString"||Be==="MultiLineString"?2:1,tags:He};te.id!==null&&(Ye.id=te.id),Ce.features.push(Ye)}}function At(Ce,te,ne,le,we,Be){var Oe=le*le;if(le>0&&te.size<(we?Oe:le))ne.numPoints+=te.length/3;else{for(var qe=[],De=0;De<te.length;De+=3)(le===0||te[De+2]>Oe)&&(ne.numSimplified++,qe.push(te[De]),qe.push(te[De+1])),ne.numPoints++;we&&function(re,He){for(var Ke=0,Ye=0,ct=re.length,Ct=ct-2;Ye<ct;Ct=Ye,Ye+=2)Ke+=(re[Ye]-re[Ct])*(re[Ye+1]+re[Ct+1]);if(Ke>0===He)for(Ye=0,ct=re.length;Ye<ct/2;Ye+=2){var Xt=re[Ye],fn=re[Ye+1];re[Ye]=re[ct-2-Ye],re[Ye+1]=re[ct-1-Ye],re[ct-2-Ye]=Xt,re[ct-1-Ye]=fn}}(qe,Be),Ce.push(qe)}}function pn(Ce,te){var ne=(te=this.options=function(we,Be){for(var Oe in Be)we[Oe]=Be[Oe];return we}(Object.create(this.options),te)).debug;if(ne&&console.time("preprocess data"),te.maxZoom<0||te.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(te.promoteId&&te.generateId)throw new Error("promoteId and generateId cannot be used together.");var le=function(we,Be){var Oe=[];if(we.type==="FeatureCollection")for(var qe=0;qe<we.features.length;qe++)Ne(Oe,we.features[qe],Be,qe);else Ne(Oe,we.type==="Feature"?we:{geometry:we},Be);return Oe}(Ce,te);this.tiles={},this.tileCoords=[],ne&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",te.indexMaxZoom,te.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),le=function(we,Be){var Oe=Be.buffer/Be.extent,qe=we,De=it(we,1,-1-Oe,Oe,0,-1,2,Be),re=it(we,1,1-Oe,2+Oe,0,-1,2,Be);return(De||re)&&(qe=it(we,1,-Oe,1+Oe,0,-1,2,Be)||[],De&&(qe=Jn(De,1).concat(qe)),re&&(qe=qe.concat(Jn(re,-1)))),qe}(le,te),le.length&&this.splitTile(le,0,0,0),ne&&(le.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Gt(Ce,te,ne){return 32*((1<<Ce)*ne+te)+Ce}function Qn(Ce,te){return te?Ce.properties[te]:Ce.id}function mi(Ce,te){if(Ce==null)return!0;if(Ce.type==="Feature")return Qn(Ce,te)!=null;if(Ce.type==="FeatureCollection"){const ne=new Set;for(const le of Ce.features){const we=Qn(le,te);if(we==null||ne.has(we))return!1;ne.add(we)}return!0}return!1}function sn(Ce,te){const ne=new Map;if(Ce!=null)if(Ce.type==="Feature")ne.set(Qn(Ce,te),Ce);else for(const le of Ce.features)ne.set(Qn(le,te),le);return ne}pn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},pn.prototype.splitTile=function(Ce,te,ne,le,we,Be,Oe){for(var qe=[Ce,te,ne,le],De=this.options,re=De.debug;qe.length;){le=qe.pop(),ne=qe.pop(),te=qe.pop(),Ce=qe.pop();var He=1<<te,Ke=Gt(te,ne,le),Ye=this.tiles[Ke];if(!Ye&&(re>1&&console.time("creation"),Ye=this.tiles[Ke]=uo(Ce,te,ne,le,De),this.tileCoords.push({z:te,x:ne,y:le}),re)){re>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",te,ne,le,Ye.numFeatures,Ye.numPoints,Ye.numSimplified),console.timeEnd("creation"));var ct="z"+te;this.stats[ct]=(this.stats[ct]||0)+1,this.total++}if(Ye.source=Ce,we){if(te===De.maxZoom||te===we)continue;var Ct=1<<we-te;if(ne!==Math.floor(Be/Ct)||le!==Math.floor(Oe/Ct))continue}else if(te===De.indexMaxZoom||Ye.numPoints<=De.indexMaxPoints)continue;if(Ye.source=null,Ce.length!==0){re>1&&console.time("clipping");var Xt,fn,wn,Bn,xr,qr,xn=.5*De.buffer/De.extent,Pr=.5-xn,ei=.5+xn,Ti=1+xn;Xt=fn=wn=Bn=null,xr=it(Ce,He,ne-xn,ne+ei,0,Ye.minX,Ye.maxX,De),qr=it(Ce,He,ne+Pr,ne+Ti,0,Ye.minX,Ye.maxX,De),Ce=null,xr&&(Xt=it(xr,He,le-xn,le+ei,1,Ye.minY,Ye.maxY,De),fn=it(xr,He,le+Pr,le+Ti,1,Ye.minY,Ye.maxY,De),xr=null),qr&&(wn=it(qr,He,le-xn,le+ei,1,Ye.minY,Ye.maxY,De),Bn=it(qr,He,le+Pr,le+Ti,1,Ye.minY,Ye.maxY,De),qr=null),re>1&&console.timeEnd("clipping"),qe.push(Xt||[],te+1,2*ne,2*le),qe.push(fn||[],te+1,2*ne,2*le+1),qe.push(wn||[],te+1,2*ne+1,2*le),qe.push(Bn||[],te+1,2*ne+1,2*le+1)}}},pn.prototype.getTile=function(Ce,te,ne){var le=this.options,we=le.extent,Be=le.debug;if(Ce<0||Ce>24)return null;var Oe=1<<Ce,qe=Gt(Ce,te=(te%Oe+Oe)%Oe,ne);if(this.tiles[qe])return wr(this.tiles[qe],we);Be>1&&console.log("drilling down to z%d-%d-%d",Ce,te,ne);for(var De,re=Ce,He=te,Ke=ne;!De&&re>0;)re--,He=Math.floor(He/2),Ke=Math.floor(Ke/2),De=this.tiles[Gt(re,He,Ke)];return De&&De.source?(Be>1&&console.log("found parent tile z%d-%d-%d",re,He,Ke),Be>1&&console.time("drilling down"),this.splitTile(De.source,re,He,Ke,Ce,te,ne),Be>1&&console.timeEnd("drilling down"),this.tiles[qe]?wr(this.tiles[qe],we):null):null};class zi extends _{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(te,ne){return c._(this,void 0,void 0,function*(){const le=te.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const we=this._geoJSONIndex.getTile(le.z,le.x,le.y);if(!we)return null;const Be=new class{constructor(qe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.W,this.length=qe.length,this._features=qe}feature(qe){return new class{constructor(De){this._feature=De,this.extent=c.W,this.type=De.type,this.properties=De.tags,"id"in De&&!isNaN(De.id)&&(this.id=parseInt(De.id,10))}loadGeometry(){if(this._feature.type===1){const De=[];for(const re of this._feature.geometry)De.push([new c.P(re[0],re[1])]);return De}{const De=[];for(const re of this._feature.geometry){const He=[];for(const Ke of re)He.push(new c.P(Ke[0],Ke[1]));De.push(He)}return De}}toGeoJSON(De,re,He){return P.call(this,De,re,He)}}(this._features[qe])}}(we.features);let Oe=Ee(Be);return Oe.byteOffset===0&&Oe.byteLength===Oe.buffer.byteLength||(Oe=new Uint8Array(Oe)),{vectorTile:Be,rawData:Oe.buffer}})}loadData(te){return c._(this,void 0,void 0,function*(){var ne;(ne=this._pendingRequest)===null||ne===void 0||ne.abort();const le=!!(te&&te.request&&te.request.collectResourceTiming)&&new c.bs(te.request);this._pendingRequest=new AbortController;try{let we=yield this.loadGeoJSON(te,this._pendingRequest);if(delete this._pendingRequest,typeof we!="object")throw new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`);if($(we,!0),te.filter){const Oe=c.by(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Oe.result==="error")throw new Error(Oe.value.map(De=>`${De.key}: ${De.message}`).join(", "));we={type:"FeatureCollection",features:we.features.filter(De=>Oe.value.evaluate({zoom:0},De))}}this._geoJSONIndex=te.cluster?new Xe(function({superclusterOptions:Oe,clusterProperties:qe}){if(!qe||!Oe)return Oe;const De={},re={},He={accumulated:null,zoom:0},Ke={properties:null},Ye=Object.keys(qe);for(const ct of Ye){const[Ct,Xt]=qe[ct],fn=c.by(Xt),wn=c.by(typeof Ct=="string"?[Ct,["accumulated"],["get",ct]]:Ct);De[ct]=fn.value,re[ct]=wn.value}return Oe.map=ct=>{Ke.properties=ct;const Ct={};for(const Xt of Ye)Ct[Xt]=De[Xt].evaluate(He,Ke);return Ct},Oe.reduce=(ct,Ct)=>{Ke.properties=Ct;for(const Xt of Ye)He.accumulated=ct[Xt],ct[Xt]=re[Xt].evaluate(He,Ke)},Oe}(te)).load(we.features):function(Oe,qe){return new pn(Oe,qe)}(we,te.geojsonVtOptions),this.loaded={};const Be={};if(le){const Oe=le.finish();Oe&&(Be.resourceTiming={},Be.resourceTiming[te.source]=JSON.parse(JSON.stringify(Oe)))}return Be}catch(we){if(delete this._pendingRequest,c.bz(we))return{abandoned:!0};throw we}})}reloadTile(te){const ne=this.loaded;return ne&&ne[te.uid]?super.reloadTile(te):this.loadTile(te)}loadGeoJSON(te,ne){return c._(this,void 0,void 0,function*(){const{promoteId:le}=te;if(te.request){const we=yield c.h(te.request,ne);return this._dataUpdateable=mi(we.data,le)?sn(we.data,le):void 0,we.data}if(typeof te.data=="string")try{const we=JSON.parse(te.data);return this._dataUpdateable=mi(we,le)?sn(we,le):void 0,we}catch{throw new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`)}if(!te.dataDiff)throw new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${te.source}`);return function(we,Be,Oe){var qe,De,re,He;if(Be.removeAll&&we.clear(),Be.remove)for(const Ke of Be.remove)we.delete(Ke);if(Be.add)for(const Ke of Be.add){const Ye=Qn(Ke,Oe);Ye!=null&&we.set(Ye,Ke)}if(Be.update)for(const Ke of Be.update){let Ye=we.get(Ke.id);if(Ye==null)continue;const ct=!Ke.removeAllProperties&&(((qe=Ke.removeProperties)===null||qe===void 0?void 0:qe.length)>0||((De=Ke.addOrUpdateProperties)===null||De===void 0?void 0:De.length)>0);if((Ke.newGeometry||Ke.removeAllProperties||ct)&&(Ye=Object.assign({},Ye),we.set(Ke.id,Ye),ct&&(Ye.properties=Object.assign({},Ye.properties))),Ke.newGeometry&&(Ye.geometry=Ke.newGeometry),Ke.removeAllProperties)Ye.properties={};else if(((re=Ke.removeProperties)===null||re===void 0?void 0:re.length)>0)for(const Ct of Ke.removeProperties)Object.prototype.hasOwnProperty.call(Ye.properties,Ct)&&delete Ye.properties[Ct];if(((He=Ke.addOrUpdateProperties)===null||He===void 0?void 0:He.length)>0)for(const{key:Ct,value:Xt}of Ke.addOrUpdateProperties)Ye.properties[Ct]=Xt}}(this._dataUpdateable,te.dataDiff,le),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(te){return c._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(te){return this._geoJSONIndex.getClusterExpansionZoom(te.clusterId)}getClusterChildren(te){return this._geoJSONIndex.getChildren(te.clusterId)}getClusterLeaves(te){return this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset)}}class er{constructor(te){this.self=te,this.actor=new c.C(te),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ne,le)=>{if(this.externalWorkerSourceTypes[ne])throw new Error(`Worker source with name "${ne}" already registered.`);this.externalWorkerSourceTypes[ne]=le},this.self.addProtocol=c.bf,this.self.removeProtocol=c.bg,this.self.registerRTLTextPlugin=ne=>{if(c.bA.isParsed())throw new Error("RTL text plugin already registered.");c.bA.setMethods(ne)},this.actor.registerMessageHandler("LDT",(ne,le)=>this._getDEMWorkerSource(ne,le.source).loadTile(le)),this.actor.registerMessageHandler("RDT",(ne,le)=>c._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ne,le.source).removeTile(le)})),this.actor.registerMessageHandler("GCEZ",(ne,le)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(ne,le.type,le.source).getClusterExpansionZoom(le)})),this.actor.registerMessageHandler("GCC",(ne,le)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(ne,le.type,le.source).getClusterChildren(le)})),this.actor.registerMessageHandler("GCL",(ne,le)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(ne,le.type,le.source).getClusterLeaves(le)})),this.actor.registerMessageHandler("LD",(ne,le)=>this._getWorkerSource(ne,le.type,le.source).loadData(le)),this.actor.registerMessageHandler("LT",(ne,le)=>this._getWorkerSource(ne,le.type,le.source).loadTile(le)),this.actor.registerMessageHandler("RT",(ne,le)=>this._getWorkerSource(ne,le.type,le.source).reloadTile(le)),this.actor.registerMessageHandler("AT",(ne,le)=>this._getWorkerSource(ne,le.type,le.source).abortTile(le)),this.actor.registerMessageHandler("RMT",(ne,le)=>this._getWorkerSource(ne,le.type,le.source).removeTile(le)),this.actor.registerMessageHandler("RS",(ne,le)=>c._(this,void 0,void 0,function*(){if(!this.workerSources[ne]||!this.workerSources[ne][le.type]||!this.workerSources[ne][le.type][le.source])return;const we=this.workerSources[ne][le.type][le.source];delete this.workerSources[ne][le.type][le.source],we.removeSource!==void 0&&we.removeSource(le)})),this.actor.registerMessageHandler("RM",ne=>c._(this,void 0,void 0,function*(){delete this.layerIndexes[ne],delete this.availableImages[ne],delete this.workerSources[ne],delete this.demWorkerSources[ne]})),this.actor.registerMessageHandler("SR",(ne,le)=>c._(this,void 0,void 0,function*(){this.referrer=le})),this.actor.registerMessageHandler("SRPS",(ne,le)=>this._syncRTLPluginState(ne,le)),this.actor.registerMessageHandler("IS",(ne,le)=>c._(this,void 0,void 0,function*(){this.self.importScripts(le)})),this.actor.registerMessageHandler("SI",(ne,le)=>this._setImages(ne,le)),this.actor.registerMessageHandler("UL",(ne,le)=>c._(this,void 0,void 0,function*(){this._getLayerIndex(ne).update(le.layers,le.removedIds)})),this.actor.registerMessageHandler("SL",(ne,le)=>c._(this,void 0,void 0,function*(){this._getLayerIndex(ne).replace(le)}))}_setImages(te,ne){return c._(this,void 0,void 0,function*(){this.availableImages[te]=ne;for(const le in this.workerSources[te]){const we=this.workerSources[te][le];for(const Be in we)we[Be].availableImages=ne}})}_syncRTLPluginState(te,ne){return c._(this,void 0,void 0,function*(){if(c.bA.isParsed())return c.bA.getState();if(ne.pluginStatus!=="loading")return c.bA.setState(ne),ne;const le=ne.pluginURL;if(this.self.importScripts(le),c.bA.isParsed()){const we={pluginStatus:"loaded",pluginURL:le};return c.bA.setState(we),we}throw c.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${le}`)})}_getAvailableImages(te){let ne=this.availableImages[te];return ne||(ne=[]),ne}_getLayerIndex(te){let ne=this.layerIndexes[te];return ne||(ne=this.layerIndexes[te]=new a),ne}_getWorkerSource(te,ne,le){if(this.workerSources[te]||(this.workerSources[te]={}),this.workerSources[te][ne]||(this.workerSources[te][ne]={}),!this.workerSources[te][ne][le]){const we={sendAsync:(Be,Oe)=>(Be.targetMapId=te,this.actor.sendAsync(Be,Oe))};switch(ne){case"vector":this.workerSources[te][ne][le]=new _(we,this._getLayerIndex(te),this._getAvailableImages(te));break;case"geojson":this.workerSources[te][ne][le]=new zi(we,this._getLayerIndex(te),this._getAvailableImages(te));break;default:this.workerSources[te][ne][le]=new this.externalWorkerSourceTypes[ne](we,this._getLayerIndex(te),this._getAvailableImages(te))}}return this.workerSources[te][ne][le]}_getDEMWorkerSource(te,ne){return this.demWorkerSources[te]||(this.demWorkerSources[te]={}),this.demWorkerSources[te][ne]||(this.demWorkerSources[te][ne]=new w),this.demWorkerSources[te][ne]}}return c.i(self)&&(self.worker=new er(self)),er}),i("index",["exports","./shared"],function(c,a){var d="4.1.3";let p,y;const _={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:x=>new Promise((l,f)=>{const g=requestAnimationFrame(l);x.signal.addEventListener("abort",()=>{cancelAnimationFrame(g),f(a.c())})}),getImageData(x,l=0){return this.getImageCanvasContext(x).getImageData(-l,-l,x.width+2*l,x.height+2*l)},getImageCanvasContext(x){const l=window.document.createElement("canvas"),f=l.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return l.width=x.width,l.height=x.height,f.drawImage(x,0,0,x.width,x.height),f},resolveURL:x=>(p||(p=document.createElement("a")),p.href=x,p.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(y==null&&(y=matchMedia("(prefers-reduced-motion: reduce)")),y.matches)}};class w{static testProp(l){if(!w.docStyle)return l[0];for(let f=0;f<l.length;f++)if(l[f]in w.docStyle)return l[f];return l[0]}static create(l,f,g){const b=window.document.createElement(l);return f!==void 0&&(b.className=f),g&&g.appendChild(b),b}static createNS(l,f){return window.document.createElementNS(l,f)}static disableDrag(){w.docStyle&&w.selectProp&&(w.userSelect=w.docStyle[w.selectProp],w.docStyle[w.selectProp]="none")}static enableDrag(){w.docStyle&&w.selectProp&&(w.docStyle[w.selectProp]=w.userSelect)}static setTransform(l,f){l.style[w.transformProp]=f}static addEventListener(l,f,g,b={}){l.addEventListener(f,g,"passive"in b?b:b.capture)}static removeEventListener(l,f,g,b={}){l.removeEventListener(f,g,"passive"in b?b:b.capture)}static suppressClickInternal(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",w.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",w.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",w.suppressClickInternal,!0)},0)}static getScale(l){const f=l.getBoundingClientRect();return{x:f.width/l.offsetWidth||1,y:f.height/l.offsetHeight||1,boundingClientRect:f}}static getPoint(l,f,g){const b=f.boundingClientRect;return new a.P((g.clientX-b.left)/f.x-l.clientLeft,(g.clientY-b.top)/f.y-l.clientTop)}static mousePos(l,f){const g=w.getScale(l);return w.getPoint(l,g,f)}static touchPos(l,f){const g=[],b=w.getScale(l);for(let k=0;k<f.length;k++)g.push(w.getPoint(l,b,f[k]));return g}static mouseButton(l){return l.button}static remove(l){l.parentNode&&l.parentNode.removeChild(l)}}w.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,w.selectProp=w.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),w.transformProp=w.testProp(["transform","WebkitTransform"]);const T={supported:!1,testSupport:function(x){!P&&$&&(D?I(x):M=x)}};let M,$,P=!1,D=!1;function I(x){const l=x.createTexture();x.bindTexture(x.TEXTURE_2D,l);try{if(x.texImage2D(x.TEXTURE_2D,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,$),x.isContextLost())return;T.supported=!0}catch{}x.deleteTexture(l),P=!0}var F;typeof document<"u"&&($=document.createElement("img"),$.onload=function(){M&&I(M),M=null,D=!0},$.onerror=function(){P=!0,M=null},$.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(x){let l,f,g,b;x.resetRequestQueue=()=>{l=[],f=0,g=0,b={}},x.addThrottleControl=B=>{const G=g++;return b[G]=B,G},x.removeThrottleControl=B=>{delete b[B],E()},x.getImage=(B,G,X=!0)=>new Promise((Y,pe)=>{T.supported&&(B.headers||(B.headers={}),B.headers.accept="image/webp,*/*"),a.e(B,{type:"image"}),l.push({abortController:G,requestParameters:B,supportImageRefresh:X,state:"queued",onError:Se=>{pe(Se)},onSuccess:Se=>{Y(Se)}}),E()});const k=B=>a._(this,void 0,void 0,function*(){B.state="running";const{requestParameters:G,supportImageRefresh:X,onError:Y,onSuccess:pe,abortController:Se}=B,ke=X===!1&&!a.i(self)&&!a.g(G.url)&&(!G.headers||Object.keys(G.headers).reduce((Fe,Je)=>Fe&&Je==="accept",!0));f++;const Me=ke?A(G,Se):a.m(G,Se);try{const Fe=yield Me;delete B.abortController,B.state="completed",Fe.data instanceof HTMLImageElement||a.b(Fe.data)?pe(Fe):Fe.data&&pe({data:yield(ye=Fe.data,typeof createImageBitmap=="function"?a.d(ye):a.f(ye)),cacheControl:Fe.cacheControl,expires:Fe.expires})}catch(Fe){delete B.abortController,Y(Fe)}finally{f--,E()}var ye}),E=()=>{const B=(()=>{for(const G of Object.keys(b))if(b[G]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let G=f;G<B&&l.length>0;G++){const X=l.shift();X.abortController.signal.aborted?G--:k(X)}},A=(B,G)=>new Promise((X,Y)=>{const pe=new Image,Se=B.url,ke=B.credentials;ke&&ke==="include"?pe.crossOrigin="use-credentials":(ke&&ke==="same-origin"||!a.s(Se))&&(pe.crossOrigin="anonymous"),G.signal.addEventListener("abort",()=>{pe.src="",Y(a.c())}),pe.fetchPriority="high",pe.onload=()=>{pe.onerror=pe.onload=null,X({data:pe})},pe.onerror=()=>{pe.onerror=pe.onload=null,G.signal.aborted||Y(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},pe.src=Se})}(F||(F={})),F.resetRequestQueue();class N{constructor(l){this._transformRequestFn=l}transformRequest(l,f){return this._transformRequestFn&&this._transformRequestFn(l,f)||{url:l}}normalizeSpriteURL(l,f,g){const b=function(k){const E=k.match(W);if(!E)throw new Error(`Unable to parse URL "${k}"`);return{protocol:E[1],authority:E[2],path:E[3]||"/",params:E[4]?E[4].split("&"):[]}}(l);return b.path+=`${f}${g}`,function(k){const E=k.params.length?`?${k.params.join("&")}`:"";return`${k.protocol}://${k.authority}${k.path}${E}`}(b)}setTransformRequest(l){this._transformRequestFn=l}}const W=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function se(x){var l=new a.A(3);return l[0]=x[0],l[1]=x[1],l[2]=x[2],l}var J,ee=function(x,l,f){return x[0]=l[0]-f[0],x[1]=l[1]-f[1],x[2]=l[2]-f[2],x};J=new a.A(3),a.A!=Float32Array&&(J[0]=0,J[1]=0,J[2]=0);var me=function(x){var l=x[0],f=x[1];return l*l+f*f};function Ie(x){const l=[];if(typeof x=="string")l.push({id:"default",url:x});else if(x&&x.length>0){const f=[];for(const{id:g,url:b}of x){const k=`${g}${b}`;f.indexOf(k)===-1&&(f.push(k),l.push({id:g,url:b}))}}return l}(function(){var x=new a.A(2);a.A!=Float32Array&&(x[0]=0,x[1]=0)})();class Q{constructor(l,f,g,b){this.context=l,this.format=g,this.texture=l.gl.createTexture(),this.update(f,b)}update(l,f,g){const{width:b,height:k}=l,E=!(this.size&&this.size[0]===b&&this.size[1]===k||g),{context:A}=this,{gl:B}=A;if(this.useMipmap=!!(f&&f.useMipmap),B.bindTexture(B.TEXTURE_2D,this.texture),A.pixelStoreUnpackFlipY.set(!1),A.pixelStoreUnpack.set(1),A.pixelStoreUnpackPremultiplyAlpha.set(this.format===B.RGBA&&(!f||f.premultiply!==!1)),E)this.size=[b,k],l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||a.b(l)?B.texImage2D(B.TEXTURE_2D,0,this.format,this.format,B.UNSIGNED_BYTE,l):B.texImage2D(B.TEXTURE_2D,0,this.format,b,k,0,this.format,B.UNSIGNED_BYTE,l.data);else{const{x:G,y:X}=g||{x:0,y:0};l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||a.b(l)?B.texSubImage2D(B.TEXTURE_2D,0,G,X,B.RGBA,B.UNSIGNED_BYTE,l):B.texSubImage2D(B.TEXTURE_2D,0,G,X,b,k,B.RGBA,B.UNSIGNED_BYTE,l.data)}this.useMipmap&&this.isSizePowerOfTwo()&&B.generateMipmap(B.TEXTURE_2D)}bind(l,f,g){const{context:b}=this,{gl:k}=b;k.bindTexture(k.TEXTURE_2D,this.texture),g!==k.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(g=k.LINEAR),l!==this.filter&&(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,l),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,g||l),this.filter=l),f!==this.wrap&&(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,f),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,f),this.wrap=f)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}function ae(x){const{userImage:l}=x;return!!(l&&l.render&&l.render())&&(x.data.replace(new Uint8Array(l.data.buffer)),!0)}class Pe extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:f,promiseResolve:g}of this.requestors)g(this._getImagesForIds(f));this.requestors=[]}}getImage(l){const f=this.images[l];if(f&&!f.data&&f.spriteData){const g=f.spriteData;f.data=new a.R({width:g.width,height:g.height},g.context.getImageData(g.x,g.y,g.width,g.height).data),f.spriteData=null}return f}addImage(l,f){if(this.images[l])throw new Error(`Image id ${l} already exist, use updateImage instead`);this._validate(l,f)&&(this.images[l]=f)}_validate(l,f){let g=!0;const b=f.data||f.spriteData;return this._validateStretch(f.stretchX,b&&b.width)||(this.fire(new a.j(new Error(`Image "${l}" has invalid "stretchX" value`))),g=!1),this._validateStretch(f.stretchY,b&&b.height)||(this.fire(new a.j(new Error(`Image "${l}" has invalid "stretchY" value`))),g=!1),this._validateContent(f.content,f)||(this.fire(new a.j(new Error(`Image "${l}" has invalid "content" value`))),g=!1),g}_validateStretch(l,f){if(!l)return!0;let g=0;for(const b of l){if(b[0]<g||b[1]<b[0]||f<b[1])return!1;g=b[1]}return!0}_validateContent(l,f){if(!l)return!0;if(l.length!==4)return!1;const g=f.spriteData,b=g&&g.width||f.data.width,k=g&&g.height||f.data.height;return!(l[0]<0||b<l[0]||l[1]<0||k<l[1]||l[2]<0||b<l[2]||l[3]<0||k<l[3]||l[2]<l[0]||l[3]<l[1])}updateImage(l,f,g=!0){const b=this.getImage(l);if(g&&(b.data.width!==f.data.width||b.data.height!==f.data.height))throw new Error(`size mismatch between old image (${b.data.width}x${b.data.height}) and new image (${f.data.width}x${f.data.height}).`);f.version=b.version+1,this.images[l]=f,this.updatedImages[l]=!0}removeImage(l){const f=this.images[l];delete this.images[l],delete this.patterns[l],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l){return new Promise((f,g)=>{let b=!0;if(!this.isLoaded())for(const k of l)this.images[k]||(b=!1);this.isLoaded()||b?f(this._getImagesForIds(l)):this.requestors.push({ids:l,promiseResolve:f})})}_getImagesForIds(l){const f={};for(const g of l){let b=this.getImage(g);b||(this.fire(new a.k("styleimagemissing",{id:g})),b=this.getImage(g)),b?f[g]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:a.w(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return f}getPixelSize(){const{width:l,height:f}=this.atlasImage;return{width:l,height:f}}getPattern(l){const f=this.patterns[l],g=this.getImage(l);if(!g)return null;if(f&&f.position.version===g.version)return f.position;if(f)f.position.version=g.version;else{const b={w:g.data.width+2,h:g.data.height+2,x:0,y:0},k=new a.I(b,g);this.patterns[l]={bin:b,position:k}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const f=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Q(l,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const k in this.patterns)l.push(this.patterns[k].bin);const{w:f,h:g}=a.p(l),b=this.atlasImage;b.resize({width:f||1,height:g||1});for(const k in this.patterns){const{bin:E}=this.patterns[k],A=E.x+1,B=E.y+1,G=this.getImage(k).data,X=G.width,Y=G.height;a.R.copy(G,b,{x:0,y:0},{x:A,y:B},{width:X,height:Y}),a.R.copy(G,b,{x:0,y:Y-1},{x:A,y:B-1},{width:X,height:1}),a.R.copy(G,b,{x:0,y:0},{x:A,y:B+Y},{width:X,height:1}),a.R.copy(G,b,{x:X-1,y:0},{x:A-1,y:B},{width:1,height:Y}),a.R.copy(G,b,{x:0,y:0},{x:A+X,y:B},{width:1,height:Y})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const f of l){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const g=this.getImage(f);g||a.w(`Image with ID: "${f}" was not found`),ae(g)&&this.updateImage(f,g)}}}const ve=1e20;function tt(x,l,f,g,b,k,E,A,B){for(let G=l;G<l+g;G++)Ge(x,f*k+G,k,b,E,A,B);for(let G=f;G<f+b;G++)Ge(x,G*k+l,1,g,E,A,B)}function Ge(x,l,f,g,b,k,E){k[0]=0,E[0]=-ve,E[1]=ve,b[0]=x[l];for(let A=1,B=0,G=0;A<g;A++){b[A]=x[l+A*f];const X=A*A;do{const Y=k[B];G=(b[A]-b[Y]+X-Y*Y)/(A-Y)/2}while(G<=E[B]&&--B>-1);B++,k[B]=A,E[B]=G,E[B+1]=ve}for(let A=0,B=0;A<g;A++){for(;E[B+1]<A;)B++;const G=k[B],X=A-G;x[l+A*f]=b[G]+X*X}}class Ee{constructor(l,f){this.requestManager=l,this.localIdeographFontFamily=f,this.entries={}}setURL(l){this.url=l}getGlyphs(l){return a._(this,void 0,void 0,function*(){const f=[];for(const k in l)for(const E of l[k])f.push(this._getAndCacheGlyphsPromise(k,E));const g=yield Promise.all(f),b={};for(const{stack:k,id:E,glyph:A}of g)b[k]||(b[k]={}),b[k][E]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics};return b})}_getAndCacheGlyphsPromise(l,f){return a._(this,void 0,void 0,function*(){let g=this.entries[l];g||(g=this.entries[l]={glyphs:{},requests:{},ranges:{}});let b=g.glyphs[f];if(b!==void 0)return{stack:l,id:f,glyph:b};if(b=this._tinySDF(g,l,f),b)return g.glyphs[f]=b,{stack:l,id:f,glyph:b};const k=Math.floor(f/256);if(256*k>65535)throw new Error("glyphs > 65535 not supported");if(g.ranges[k])return{stack:l,id:f,glyph:b};if(!this.url)throw new Error("glyphsUrl is not set");if(!g.requests[k]){const A=Ee.loadGlyphRange(l,k,this.url,this.requestManager);g.requests[k]=A}const E=yield g.requests[k];for(const A in E)this._doesCharSupportLocalGlyph(+A)||(g.glyphs[+A]=E[+A]);return g.ranges[k]=!0,{stack:l,id:f,glyph:E[f]||null}})}_doesCharSupportLocalGlyph(l){return!!this.localIdeographFontFamily&&(a.u["CJK Unified Ideographs"](l)||a.u["Hangul Syllables"](l)||a.u.Hiragana(l)||a.u.Katakana(l))}_tinySDF(l,f,g){const b=this.localIdeographFontFamily;if(!b||!this._doesCharSupportLocalGlyph(g))return;let k=l.tinySDF;if(!k){let A="400";/bold/i.test(f)?A="900":/medium/i.test(f)?A="500":/light/i.test(f)&&(A="200"),k=l.tinySDF=new Ee.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:b,fontWeight:A})}const E=k.draw(String.fromCharCode(g));return{id:g,bitmap:new a.o({width:E.width||60,height:E.height||60},E.data),metrics:{width:E.glyphWidth/2||24,height:E.glyphHeight/2||24,left:E.glyphLeft/2+.5||0,top:E.glyphTop/2-27.5||-8,advance:E.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ee.loadGlyphRange=function(x,l,f,g){return a._(this,void 0,void 0,function*(){const b=256*l,k=b+255,E=g.transformRequest(f.replace("{fontstack}",x).replace("{range}",`${b}-${k}`),"Glyphs"),A=yield a.l(E,new AbortController);if(!A||!A.data)throw new Error(`Could not load glyph range. range: ${l}, ${b}-${k}`);const B={};for(const G of a.n(A.data))B[G.id]=G;return B})},Ee.TinySDF=class{constructor({fontSize:x=24,buffer:l=3,radius:f=8,cutoff:g=.25,fontFamily:b="sans-serif",fontWeight:k="normal",fontStyle:E="normal"}={}){this.buffer=l,this.cutoff=g,this.radius=f;const A=this.size=x+4*l,B=this._createCanvas(A),G=this.ctx=B.getContext("2d",{willReadFrequently:!0});G.font=`${E} ${k} ${x}px ${b}`,G.textBaseline="alphabetic",G.textAlign="left",G.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(x){const l=document.createElement("canvas");return l.width=l.height=x,l}draw(x){const{width:l,actualBoundingBoxAscent:f,actualBoundingBoxDescent:g,actualBoundingBoxLeft:b,actualBoundingBoxRight:k}=this.ctx.measureText(x),E=Math.ceil(f),A=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(k-b))),B=Math.min(this.size-this.buffer,E+Math.ceil(g)),G=A+2*this.buffer,X=B+2*this.buffer,Y=Math.max(G*X,0),pe=new Uint8ClampedArray(Y),Se={data:pe,width:G,height:X,glyphWidth:A,glyphHeight:B,glyphTop:E,glyphLeft:0,glyphAdvance:l};if(A===0||B===0)return Se;const{ctx:ke,buffer:Me,gridInner:ye,gridOuter:Fe}=this;ke.clearRect(Me,Me,A,B),ke.fillText(x,Me,Me+E);const Je=ke.getImageData(Me,Me,A,B);Fe.fill(ve,0,Y),ye.fill(0,0,Y);for(let Le=0;Le<B;Le++)for(let Ve=0;Ve<A;Ve++){const Qe=Je.data[4*(Le*A+Ve)+3]/255;if(Qe===0)continue;const nt=(Le+Me)*G+Ve+Me;if(Qe===1)Fe[nt]=0,ye[nt]=ve;else{const ot=.5-Qe;Fe[nt]=ot>0?ot*ot:0,ye[nt]=ot<0?ot*ot:0}}tt(Fe,0,0,G,X,G,this.f,this.v,this.z),tt(ye,Me,Me,A,B,G,this.f,this.v,this.z);for(let Le=0;Le<Y;Le++){const Ve=Math.sqrt(Fe[Le])-Math.sqrt(ye[Le]);pe[Le]=Math.round(255-255*(Ve/this.radius+this.cutoff))}return Se}};class $e{constructor(){this.specification=a.v.light.position}possiblyEvaluate(l,f){return a.y(l.expression.evaluate(f))}interpolate(l,f,g){return{x:a.z.number(l.x,f.x,g),y:a.z.number(l.y,f.y,g),z:a.z.number(l.z,f.z,g)}}}let St;class rt extends a.E{constructor(l){super(),St=St||new a.q({anchor:new a.D(a.v.light.anchor),position:new $e,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(St),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,f={}){if(!this._validate(a.r,l,f))for(const g in l){const b=l[g];g.endsWith("-transition")?this._transitionable.setTransition(g.slice(0,-11),b):this._transitionable.setValue(g,b)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,f,g){return(!g||g.validate!==!1)&&a.t(this,l.call(a.x,{value:f,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}class lt{constructor(l,f){this.width=l,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(l,f){const g=l.join(",")+String(f);return this.dashEntry[g]||(this.dashEntry[g]=this.addDash(l,f)),this.dashEntry[g]}getDashRanges(l,f,g){const b=[];let k=l.length%2==1?-l[l.length-1]*g:0,E=l[0]*g,A=!0;b.push({left:k,right:E,isDash:A,zeroLength:l[0]===0});let B=l[0];for(let G=1;G<l.length;G++){A=!A;const X=l[G];k=B*g,B+=X,E=B*g,b.push({left:k,right:E,isDash:A,zeroLength:X===0})}return b}addRoundDash(l,f,g){const b=f/2;for(let k=-g;k<=g;k++){const E=this.width*(this.nextRow+g+k);let A=0,B=l[A];for(let G=0;G<this.width;G++){G/B.right>1&&(B=l[++A]);const X=Math.abs(G-B.left),Y=Math.abs(G-B.right),pe=Math.min(X,Y);let Se;const ke=k/g*(b+1);if(B.isDash){const Me=b-Math.abs(ke);Se=Math.sqrt(pe*pe+Me*Me)}else Se=b-Math.sqrt(pe*pe+ke*ke);this.data[E+G]=Math.max(0,Math.min(255,Se+128))}}}addRegularDash(l){for(let A=l.length-1;A>=0;--A){const B=l[A],G=l[A+1];B.zeroLength?l.splice(A,1):G&&G.isDash===B.isDash&&(G.left=B.left,l.splice(A,1))}const f=l[0],g=l[l.length-1];f.isDash===g.isDash&&(f.left=g.left-this.width,g.right=f.right+this.width);const b=this.width*this.nextRow;let k=0,E=l[k];for(let A=0;A<this.width;A++){A/E.right>1&&(E=l[++k]);const B=Math.abs(A-E.left),G=Math.abs(A-E.right),X=Math.min(B,G);this.data[b+A]=Math.max(0,Math.min(255,(E.isDash?X:-X)+128))}}addDash(l,f){const g=f?7:0,b=2*g+1;if(this.nextRow+b>this.height)return a.w("LineAtlas out of space"),null;let k=0;for(let A=0;A<l.length;A++)k+=l[A];if(k!==0){const A=this.width/k,B=this.getDashRanges(l,this.width,A);f?this.addRoundDash(B,A,g):this.addRegularDash(B)}const E={y:(this.nextRow+g+.5)/this.height,height:2*g/this.height,width:k};return this.nextRow+=b,this.dirty=!0,E}bind(l){const f=l.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))}}const mt="maplibre_preloaded_worker_pool";class ft{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<ft.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[mt]}numActive(){return Object.keys(this.active).length}}const Xe=Math.floor(_.hardwareConcurrency/2);let Dt,_t;function $t(){return Dt||(Dt=new ft),Dt}ft.workerCount=a.B(globalThis)?Math.max(Math.min(Xe,3),1):1;class Et{constructor(l,f){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=f;const g=this.workerPool.acquire(f);for(let b=0;b<g.length;b++){const k=new a.C(g[b],f);k.name=`Worker ${b}`,this.actors.push(k)}if(!this.actors.length)throw new Error("No actors found")}broadcast(l,f){const g=[];for(const b of this.actors)g.push(b.sendAsync({type:l,data:f}));return Promise.all(g)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(l=!0){this.actors.forEach(f=>{f.remove()}),this.actors=[],l&&this.workerPool.release(this.id)}registerMessageHandler(l,f){for(const g of this.actors)g.registerMessageHandler(l,f)}}function Yt(){return _t||(_t=new Et($t(),a.G),_t.registerMessageHandler("GR",(x,l,f)=>a.m(l,f))),_t}function _n(x,l){const f=a.F();return a.H(f,f,[1,1,0]),a.J(f,f,[.5*x.width,.5*x.height,1]),a.K(f,f,x.calculatePosMatrix(l.toUnwrapped()))}function Zt(x,l,f,g,b,k){const E=function(Y,pe,Se){if(Y)for(const ke of Y){const Me=pe[ke];if(Me&&Me.source===Se&&Me.type==="fill-extrusion")return!0}else for(const ke in pe){const Me=pe[ke];if(Me.source===Se&&Me.type==="fill-extrusion")return!0}return!1}(b&&b.layers,l,x.id),A=k.maxPitchScaleFactor(),B=x.tilesIn(g,A,E);B.sort(ln);const G=[];for(const Y of B)G.push({wrappedTileID:Y.tileID.wrapped().key,queryResults:Y.tile.queryRenderedFeatures(l,f,x._state,Y.queryGeometry,Y.cameraQueryGeometry,Y.scale,b,k,A,_n(x.transform,Y.tileID))});const X=function(Y){const pe={},Se={};for(const ke of Y){const Me=ke.queryResults,ye=ke.wrappedTileID,Fe=Se[ye]=Se[ye]||{};for(const Je in Me){const Le=Me[Je],Ve=Fe[Je]=Fe[Je]||{},Qe=pe[Je]=pe[Je]||[];for(const nt of Le)Ve[nt.featureIndex]||(Ve[nt.featureIndex]=!0,Qe.push(nt))}}return pe}(G);for(const Y in X)X[Y].forEach(pe=>{const Se=pe.feature,ke=x.getFeatureState(Se.layer["source-layer"],Se.id);Se.source=Se.layer.source,Se.layer["source-layer"]&&(Se.sourceLayer=Se.layer["source-layer"]),Se.state=ke});return X}function ln(x,l){const f=x.tileID,g=l.tileID;return f.overscaledZ-g.overscaledZ||f.canonical.y-g.canonical.y||f.wrap-g.wrap||f.canonical.x-g.canonical.x}function ze(x,l,f){return a._(this,void 0,void 0,function*(){let g=x;if(x.url?g=(yield a.h(l.transformRequest(x.url,"Source"),f)).data:yield _.frameAsync(f),!g)return null;const b=a.L(a.e(g,x),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in g&&g.vector_layers&&(b.vectorLayerIds=g.vector_layers.map(k=>k.id)),b})}class Ne{constructor(l,f){l&&(f?this.setSouthWest(l).setNorthEast(f):Array.isArray(l)&&(l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1])))}setNorthEast(l){return this._ne=l instanceof a.M?new a.M(l.lng,l.lat):a.M.convert(l),this}setSouthWest(l){return this._sw=l instanceof a.M?new a.M(l.lng,l.lat):a.M.convert(l),this}extend(l){const f=this._sw,g=this._ne;let b,k;if(l instanceof a.M)b=l,k=l;else{if(!(l instanceof Ne))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(Ne.convert(l)):this.extend(a.M.convert(l)):l&&("lng"in l||"lon"in l)&&"lat"in l?this.extend(a.M.convert(l)):this;if(b=l._sw,k=l._ne,!b||!k)return this}return f||g?(f.lng=Math.min(b.lng,f.lng),f.lat=Math.min(b.lat,f.lat),g.lng=Math.max(k.lng,g.lng),g.lat=Math.max(k.lat,g.lat)):(this._sw=new a.M(b.lng,b.lat),this._ne=new a.M(k.lng,k.lat)),this}getCenter(){return new a.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.M(this.getWest(),this.getNorth())}getSouthEast(){return new a.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:f,lat:g}=a.M.convert(l);let b=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(b=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=g&&g<=this._ne.lat&&b}static convert(l){return l instanceof Ne?l:l&&new Ne(l)}static fromLngLat(l,f=0){const g=360*f/40075017,b=g/Math.cos(Math.PI/180*l.lat);return new Ne(new a.M(l.lng-b,l.lat-g),new a.M(l.lng+b,l.lat+g))}}class kt{constructor(l,f,g){this.bounds=Ne.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=g||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const f=Math.pow(2,l.z),g=Math.floor(a.N(this.bounds.getWest())*f),b=Math.floor(a.O(this.bounds.getNorth())*f),k=Math.ceil(a.N(this.bounds.getEast())*f),E=Math.ceil(a.O(this.bounds.getSouth())*f);return l.x>=g&&l.x<k&&l.y>=b&&l.y<E}}class jt extends a.E{constructor(l,f,g,b){if(super(),this.id=l,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.L(f,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield ze(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),l&&(a.e(this,l),l.bounds&&(this.tileBounds=new kt(l.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new a.j(l))}})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.abort(),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(l){return a._(this,void 0,void 0,function*(){const f=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g={request:this.map._requestManager.transformRequest(f,"Tile"),uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};g.request.collectResourceTiming=this._collectResourceTiming;let b="RT";if(l.actor&&l.state!=="expired"){if(l.state==="loading")return new Promise((k,E)=>{l.reloadPromise={resolve:k,reject:E}})}else l.actor=this.dispatcher.getActor(),b="LT";l.abortController=new AbortController;try{const k=yield l.actor.sendAsync({type:b,data:g},l.abortController);if(delete l.abortController,l.aborted)return;this._afterTileLoadWorkerResponse(l,k)}catch(k){if(delete l.abortController,l.aborted)return;if(k&&k.status!==404)throw k;this._afterTileLoadWorkerResponse(l,null)}})}_afterTileLoadWorkerResponse(l,f){if(f&&f.resourceTiming&&(l.resourceTiming=f.resourceTiming),f&&this.map._refreshExpiredTiles&&l.setExpiryData(f),l.loadVectorData(f,this.map.painter),l.reloadPromise){const g=l.reloadPromise;l.reloadPromise=null,this.loadTile(l).then(g.resolve).catch(g.reject)}}abortTile(l){return a._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.actor&&(yield l.actor.sendAsync({type:"AT",data:{uid:l.uid,type:this.type,source:this.id}}))})}unloadTile(l){return a._(this,void 0,void 0,function*(){l.unloadVectorData(),l.actor&&(yield l.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class _e extends a.E{constructor(l,f,g,b){super(),this.id=l,this.dispatcher=g,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},f),a.e(this,a.L(f,["url","scheme","tileSize"]))}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield ze(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,l&&(a.e(this,l),l.bounds&&(this.tileBounds=new kt(l.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new a.j(l))}})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(l){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}serialize(){return a.e({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l){return a._(this,void 0,void 0,function*(){const f=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);l.abortController=new AbortController;try{const g=yield F.getImage(this.map._requestManager.transformRequest(f,"Tile"),l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(g&&g.data){this.map._refreshExpiredTiles&&g.cacheControl&&g.expires&&l.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});const b=this.map.painter.context,k=b.gl,E=g.data;l.texture=this.map.painter.getTileTexture(E.width),l.texture?l.texture.update(E,{useMipmap:!0}):(l.texture=new Q(b,E,k.RGBA,{useMipmap:!0}),l.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),b.extTextureFilterAnisotropic&&k.texParameterf(k.TEXTURE_2D,b.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,b.extTextureFilterAnisotropicMax)),l.state="loaded"}}catch(g){if(delete l.abortController,l.aborted)l.state="unloaded";else if(g)throw l.state="errored",g}})}abortTile(l){return a._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController)})}unloadTile(l){return a._(this,void 0,void 0,function*(){l.texture&&this.map.painter.saveTileTexture(l.texture)})}hasTransition(){return!1}}class vn extends _e{constructor(l,f,g,b){super(l,f,g,b),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},f),this.encoding=f.encoding||"mapbox",this.redFactor=f.redFactor,this.greenFactor=f.greenFactor,this.blueFactor=f.blueFactor,this.baseShift=f.baseShift}loadTile(l){return a._(this,void 0,void 0,function*(){const f=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g=this.map._requestManager.transformRequest(f,"Tile");l.neighboringTiles=this._getNeighboringTiles(l.tileID),l.abortController=new AbortController;try{const b=yield F.getImage(g,l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(b&&b.data){const k=b.data;this.map._refreshExpiredTiles&&b.cacheControl&&b.expires&&l.setExpiryData({cacheControl:b.cacheControl,expires:b.expires});const E=a.b(k)&&a.S()?k:yield this.readImageNow(k),A={type:this.type,uid:l.uid,source:this.id,rawImageData:E,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!l.actor||l.state==="expired"){l.actor=this.dispatcher.getActor();const B=yield l.actor.sendAsync({type:"LDT",data:A});l.dem=B,l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0,l.state="loaded"}}}catch(b){if(delete l.abortController,l.aborted)l.state="unloaded";else if(b)throw l.state="errored",b}})}readImageNow(l){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.U()){const f=l.width+2,g=l.height+2;try{return new a.R({width:f,height:g},yield a.V(l,-1,-1,f,g))}catch{}}return _.getImageData(l,1)})}_getNeighboringTiles(l){const f=l.canonical,g=Math.pow(2,f.z),b=(f.x-1+g)%g,k=f.x===0?l.wrap-1:l.wrap,E=(f.x+1+g)%g,A=f.x+1===g?l.wrap+1:l.wrap,B={};return B[new a.Q(l.overscaledZ,k,f.z,b,f.y).key]={backfilled:!1},B[new a.Q(l.overscaledZ,A,f.z,E,f.y).key]={backfilled:!1},f.y>0&&(B[new a.Q(l.overscaledZ,k,f.z,b,f.y-1).key]={backfilled:!1},B[new a.Q(l.overscaledZ,l.wrap,f.z,f.x,f.y-1).key]={backfilled:!1},B[new a.Q(l.overscaledZ,A,f.z,E,f.y-1).key]={backfilled:!1}),f.y+1<g&&(B[new a.Q(l.overscaledZ,k,f.z,b,f.y+1).key]={backfilled:!1},B[new a.Q(l.overscaledZ,l.wrap,f.z,f.x,f.y+1).key]={backfilled:!1},B[new a.Q(l.overscaledZ,A,f.z,E,f.y+1).key]={backfilled:!1}),B}unloadTile(l){return a._(this,void 0,void 0,function*(){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded",l.actor&&(yield l.actor.sendAsync({type:"RDT",data:{type:this.type,uid:l.uid,source:this.id}}))})}}class Ue extends a.E{constructor(l,f,g,b){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=g.getActor(),this.setEventedParent(b),this._data=f.data,this._options=a.e({},f),this._collectResourceTiming=f.collectResourceTiming,f.maxzoom!==void 0&&(this.maxzoom=f.maxzoom),f.type&&(this.type=f.type),f.attribution&&(this.attribution=f.attribution),this.promoteId=f.promoteId;const k=a.W/this.tileSize;this.workerOptions=a.e({source:this.id,cluster:f.cluster||!1,geojsonVtOptions:{buffer:(f.buffer!==void 0?f.buffer:128)*k,tolerance:(f.tolerance!==void 0?f.tolerance:.375)*k,extent:a.W,maxZoom:this.maxzoom,lineMetrics:f.lineMetrics||!1,generateId:f.generateId||!1},superclusterOptions:{maxZoom:f.clusterMaxZoom!==void 0?f.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,f.clusterMinPoints||2),extent:a.W,radius:(f.clusterRadius||50)*k,log:!1,generateId:f.generateId||!1},clusterProperties:f.clusterProperties,filter:f.filter},f.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(l){this.map=l,this.load()}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){return this._updateWorkerData(l),this}setClusterOptions(l){return this.workerOptions.cluster=l.cluster,l&&(l.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=l.clusterRadius),l.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=l.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(l){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:l,source:this.id}})}getClusterChildren(l){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:l,source:this.id}})}getClusterLeaves(l,f,g){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:l,limit:f,offset:g}})}_updateWorkerData(l){return a._(this,void 0,void 0,function*(){const f=a.e({type:this.type},this.workerOptions);l?f.dataDiff=l:typeof this._data=="string"?(f.request=this.map._requestManager.transformRequest(_.resolveURL(this._data),"Source"),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"}));try{const g=yield this.actor.sendAsync({type:"LD",data:f});if(this._pendingLoads--,this._removed||g.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let b=null;g.resourceTiming&&g.resourceTiming[this.id]&&(b=g.resourceTiming[this.id].slice(0));const k={dataType:"source"};this._collectResourceTiming&&b&&b.length>0&&a.e(k,{resourceTiming:b}),this.fire(new a.k("data",Object.assign(Object.assign({},k),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},k),{sourceDataType:"content"})))}catch(g){if(this._pendingLoads--,this._removed)return void this.fire(new a.k("dataabort",{dataType:"source"}));this.fire(new a.j(g))}})}loaded(){return this._pendingLoads===0}loadTile(l){return a._(this,void 0,void 0,function*(){const f=l.actor?"RT":"LT";l.actor=this.actor;const g={type:this.type,uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.abortController=new AbortController;const b=yield this.actor.sendAsync({type:f,data:g},l.abortController);delete l.abortController,l.unloadVectorData(),l.aborted||l.loadVectorData(b,this.map.painter,f==="RT")})}abortTile(l){return a._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.aborted=!0})}unloadTile(l){return a._(this,void 0,void 0,function*(){l.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var it=a.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Kt extends a.E{constructor(l,f,g,b){super(),this.id=l,this.dispatcher=g,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=f}load(l){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const f=yield F.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,f&&f.data&&(this.image=f.data,l&&(this.coordinates=l),this._finishLoading())}catch(f){this._request=null,this._loaded=!0,this.fire(new a.j(f))}})}loaded(){return this._loaded}updateImage(l){return l.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=l.url,this.load(l.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(l){this.coordinates=l;const f=l.map(a.Y.fromLngLat);this.tileID=function(b){let k=1/0,E=1/0,A=-1/0,B=-1/0;for(const pe of b)k=Math.min(k,pe.x),E=Math.min(E,pe.y),A=Math.max(A,pe.x),B=Math.max(B,pe.y);const G=Math.max(A-k,B-E),X=Math.max(0,Math.floor(-Math.log(G)/Math.LN2)),Y=Math.pow(2,X);return new a.a0(X,Math.floor((k+A)/2*Y),Math.floor((E+B)/2*Y))}(f),this.minzoom=this.maxzoom=this.tileID.z;const g=f.map(b=>this.tileID.getTilePoint(b)._round());return this._boundsArray=new a.Z,this._boundsArray.emplaceBack(g[0].x,g[0].y,0,0),this._boundsArray.emplaceBack(g[1].x,g[1].y,a.W,0),this._boundsArray.emplaceBack(g[3].x,g[3].y,0,a.W),this._boundsArray.emplaceBack(g[2].x,g[2].y,a.W,a.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const l=this.map.painter.context,f=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,it.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Q(l,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let g=!1;for(const b in this.tiles){const k=this.tiles[b];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture,g=!0)}g&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(l){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={}):l.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class ur extends Kt{constructor(l,f,g,b){super(l,f,g,b),this.roundZoom=!0,this.type="video",this.options=f}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const l=this.options;this.urls=[];for(const f of l.urls)this.urls.push(this.map._requestManager.transformRequest(f,"Source").url);try{const f=yield a.a2(this.urls);if(this._loaded=!0,!f)return;this.video=f,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(f){this.fire(new a.j(f))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const f=this.video.seekable;l<f.start(0)||l>f.end(0)?this.fire(new a.j(new a.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${f.start(0)} and ${f.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,f=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,it.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,f.UNSIGNED_BYTE,this.video)):(this.texture=new Q(l,this.video,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let g=!1;for(const b in this.tiles){const k=this.tiles[b];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture,g=!0)}g&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class nr extends Kt{constructor(l,f,g,b){super(l,f,g,b),f.coordinates?Array.isArray(f.coordinates)&&f.coordinates.length===4&&!f.coordinates.some(k=>!Array.isArray(k)||k.length!==2||k.some(E=>typeof E!="number"))||this.fire(new a.j(new a.a1(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.a1(`sources.${l}`,null,'missing required property "coordinates"'))),f.animate&&typeof f.animate!="boolean"&&this.fire(new a.j(new a.a1(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),f.canvas?typeof f.canvas=="string"||f.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.a1(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.a1(`sources.${l}`,null,'missing required property "canvas"'))),this.options=f,this.animate=f.animate===void 0||f.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const f=this.map.painter.context,g=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,it.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Q(f,this.canvas,g.RGBA,{premultiply:!0});let b=!1;for(const k in this.tiles){const E=this.tiles[k];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,b=!0)}b&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}}const vr={},Qr=x=>{switch(x){case"geojson":return Ue;case"image":return Kt;case"raster":return _e;case"raster-dem":return vn;case"vector":return jt;case"video":return ur;case"canvas":return nr}return vr[x]},mr="RTLPluginLoaded";class Ci extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Yt()}_syncState(l){return this.status=l,this.dispatcher.broadcast("SRPS",{pluginStatus:l,pluginURL:this.url}).catch(f=>{throw this.status="error",f})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(l){return a._(this,arguments,void 0,function*(f,g=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=_.resolveURL(f),!this.url)throw new Error(`requested url ${f} is invalid`);if(this.status==="unavailable"){if(!g)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.k(mr))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Jn=null;function yt(){return Jn||(Jn=new Ci),Jn}class wr{constructor(l,f){this.timeAdded=0,this.fadeEndTime=0,this.tileID=l,this.uid=a.a3(),this.uses=0,this.tileSize=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(l){const f=l+this.timeAdded;f<this.fadeEndTime||(this.fadeEndTime=f)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(l){this.demTexture&&l.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(l,f,g){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=function(b,k){const E={};if(!k)return E;for(const A of b){const B=A.layerIds.map(G=>k.getLayer(G)).filter(Boolean);if(B.length!==0){A.layers=B,A.stateDependentLayerIds&&(A.stateDependentLayers=A.stateDependentLayerIds.map(G=>B.filter(X=>X.id===G)[0]));for(const G of B)E[G.id]=A}}return E}(l.buckets,f.style),this.hasSymbolBuckets=!1;for(const b in this.buckets){const k=this.buckets[b];if(k instanceof a.a5){if(this.hasSymbolBuckets=!0,!g)break;k.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const b in this.buckets){const k=this.buckets[b];if(k instanceof a.a5&&k.hasRTLText){this.hasRTLText=!0,yt().lazyLoad();break}}this.queryPadding=0;for(const b in this.buckets){const k=this.buckets[b];this.queryPadding=Math.max(this.queryPadding,f.style.getLayer(b).queryRadius(k))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage)}else this.collisionBoxArray=new a.a4}unloadVectorData(){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(l){return this.buckets[l.id]}upload(l){for(const g in this.buckets){const b=this.buckets[g];b.uploadPending()&&b.upload(l)}const f=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Q(l,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Q(l,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,f,g,b,k,E,A,B,G,X){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:b,cameraQueryGeometry:k,scale:E,tileSize:this.tileSize,pixelPosMatrix:X,transform:B,params:A,queryPadding:this.queryPadding*G},l,f,g):{}}querySourceFeatures(l,f){const g=this.latestFeatureIndex;if(!g||!g.rawTileData)return;const b=g.loadVTLayers(),k=f&&f.sourceLayer?f.sourceLayer:"",E=b._geojsonTileLayer||b[k];if(!E)return;const A=a.a6(f&&f.filter),{z:B,x:G,y:X}=this.tileID.canonical,Y={z:B,x:G,y:X};for(let pe=0;pe<E.length;pe++){const Se=E.feature(pe);if(A.needGeometry){const ye=a.a7(Se,!0);if(!A.filter(new a.a8(this.tileID.overscaledZ),ye,this.tileID.canonical))continue}else if(!A.filter(new a.a8(this.tileID.overscaledZ),Se))continue;const ke=g.getId(Se,k),Me=new a.a9(Se,B,G,X,ke);Me.tile=Y,l.push(Me)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const f=this.expirationTime;if(l.cacheControl){const g=a.aa(l.cacheControl);g["max-age"]&&(this.expirationTime=Date.now()+1e3*g["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const g=Date.now();let b=!1;if(this.expirationTime>g)b=!1;else if(f)if(this.expirationTime<f)b=!0;else{const k=this.expirationTime-f;k?this.expirationTime=g+Math.max(k,3e4):b=!0}else b=!0;b?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(l,f){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(l).length===0)return;const g=this.latestFeatureIndex.loadVTLayers();for(const b in this.buckets){if(!f.style.hasLayer(b))continue;const k=this.buckets[b],E=k.layers[0].sourceLayer||"_geojsonTileLayer",A=g[E],B=l[E];if(!A||!B||Object.keys(B).length===0)continue;k.update(B,A,this.imageAtlas&&this.imageAtlas.patternPositions||{});const G=f&&f.style&&f.style.getLayer(b);G&&(this.queryPadding=Math.max(this.queryPadding,G.queryRadius(k)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<_.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=_.now()+l}setDependencies(l,f){const g={};for(const b of f)g[b]=!0;this.dependencies[l]=g}hasDependency(l,f){for(const g of l){const b=this.dependencies[g];if(b){for(const k of f)if(b[k])return!0}}return!1}}class Tr{constructor(l,f){this.max=l,this.onRemove=f,this.reset()}reset(){for(const l in this.data)for(const f of this.data[l])f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value);return this.data={},this.order=[],this}add(l,f,g){const b=l.wrapped().key;this.data[b]===void 0&&(this.data[b]=[]);const k={value:f,timeout:void 0};if(g!==void 0&&(k.timeout=setTimeout(()=>{this.remove(l,k)},g)),this.data[b].push(k),this.order.push(b),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value}getByKey(l){const f=this.data[l];return f?f[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,f){if(!this.has(l))return this;const g=l.wrapped().key,b=f===void 0?0:this.data[g].indexOf(f),k=this.data[g][b];return this.data[g].splice(b,1),k.timeout&&clearTimeout(k.timeout),this.data[g].length===0&&delete this.data[g],this.onRemove(k.value),this.order.splice(this.order.indexOf(g),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}filter(l){const f=[];for(const g in this.data)for(const b of this.data[g])l(b.value)||f.push(b);for(const g of f)this.remove(g.value.tileID,g)}}class uo{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,f,g){const b=String(f);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][b]=this.stateChanges[l][b]||{},a.e(this.stateChanges[l][b],g),this.deletedStates[l]===null){this.deletedStates[l]={};for(const k in this.state[l])k!==b&&(this.deletedStates[l][k]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][b]===null){this.deletedStates[l][b]={};for(const k in this.state[l][b])g[k]||(this.deletedStates[l][b][k]=null)}else for(const k in g)this.deletedStates[l]&&this.deletedStates[l][b]&&this.deletedStates[l][b][k]===null&&delete this.deletedStates[l][b][k]}removeFeatureState(l,f,g){if(this.deletedStates[l]===null)return;const b=String(f);if(this.deletedStates[l]=this.deletedStates[l]||{},g&&f!==void 0)this.deletedStates[l][b]!==null&&(this.deletedStates[l][b]=this.deletedStates[l][b]||{},this.deletedStates[l][b][g]=null);else if(f!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][b])for(g in this.deletedStates[l][b]={},this.stateChanges[l][b])this.deletedStates[l][b][g]=null;else this.deletedStates[l][b]=null;else this.deletedStates[l]=null}getState(l,f){const g=String(f),b=a.e({},(this.state[l]||{})[g],(this.stateChanges[l]||{})[g]);if(this.deletedStates[l]===null)return{};if(this.deletedStates[l]){const k=this.deletedStates[l][f];if(k===null)return{};for(const E in k)delete b[E]}return b}initializeTileState(l,f){l.setFeatureState(this.state,f)}coalesceChanges(l,f){const g={};for(const b in this.stateChanges){this.state[b]=this.state[b]||{};const k={};for(const E in this.stateChanges[b])this.state[b][E]||(this.state[b][E]={}),a.e(this.state[b][E],this.stateChanges[b][E]),k[E]=this.state[b][E];g[b]=k}for(const b in this.deletedStates){this.state[b]=this.state[b]||{};const k={};if(this.deletedStates[b]===null)for(const E in this.state[b])k[E]={},this.state[b][E]={};else for(const E in this.deletedStates[b]){if(this.deletedStates[b][E]===null)this.state[b][E]={};else for(const A of Object.keys(this.deletedStates[b][E]))delete this.state[b][E][A];k[E]=this.state[b][E]}g[b]=g[b]||{},a.e(g[b],k)}if(this.stateChanges={},this.deletedStates={},Object.keys(g).length!==0)for(const b in l)l[b].setFeatureState(g,f)}}class Yn extends a.E{constructor(l,f,g){super(),this.id=l,this.dispatcher=g,this.on("data",b=>this._dataHandler(b)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((b,k,E,A)=>{const B=new(Qr(k.type))(b,k,E,A);if(B.id!==b)throw new Error(`Expected Source id to be ${b} instead of ${B.id}`);return B})(l,f,g,this),this._tiles={},this._cache=new Tr(0,b=>this._unloadTile(b)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new uo,this._didEmitContent=!1,this._updated=!1}onAdd(l){this.map=l,this._maxTileCacheSize=l?l._maxTileCacheSize:null,this._maxTileCacheZoomLevels=l?l._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(l)}onRemove(l){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(l)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const l in this._tiles){const f=this._tiles[l];if(f.state!=="loaded"&&f.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(l,f,g){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(l),this._tileLoaded(l,f,g)}catch(b){l.state="errored",b.status!==404?this._source.fire(new a.j(b,{tile:l})):this.update(this.transform,this.terrain)}})}_unloadTile(l){this._source.unloadTile&&this._source.unloadTile(l)}_abortTile(l){this._source.abortTile&&this._source.abortTile(l),this._source.fire(new a.k("dataabort",{tile:l,coord:l.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const f in this._tiles){const g=this._tiles[f];g.upload(l),g.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(l=>l.tileID).sort(At).map(l=>l.key)}getRenderableIds(l){const f=[];for(const g in this._tiles)this._isIdRenderable(g,l)&&f.push(this._tiles[g]);return l?f.sort((g,b)=>{const k=g.tileID,E=b.tileID,A=new a.P(k.canonical.x,k.canonical.y)._rotate(this.transform.angle),B=new a.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return k.overscaledZ-E.overscaledZ||B.y-A.y||B.x-A.x}).map(g=>g.tileID.key):f.map(g=>g.tileID).sort(At).map(g=>g.key)}hasRenderableParent(l){const f=this.findLoadedParent(l,0);return!!f&&this._isIdRenderable(f.tileID.key)}_isIdRenderable(l,f){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(f||!this._tiles[l].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)this._tiles[l].state!=="errored"&&this._reloadTile(l,"reloading")}}_reloadTile(l,f){return a._(this,void 0,void 0,function*(){const g=this._tiles[l];g&&(g.state!=="loading"&&(g.state=f),yield this._loadTile(g,l,f))})}_tileLoaded(l,f,g){l.timeAdded=_.now(),g==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(f,l),this.getSource().type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),l.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:l,coord:l.tileID}))}_backfillDEM(l){const f=this.getRenderableIds();for(let b=0;b<f.length;b++){const k=f[b];if(l.neighboringTiles&&l.neighboringTiles[k]){const E=this.getTileByID(k);g(l,E),g(E,l)}}function g(b,k){b.needsHillshadePrepare=!0,b.needsTerrainPrepare=!0;let E=k.tileID.canonical.x-b.tileID.canonical.x;const A=k.tileID.canonical.y-b.tileID.canonical.y,B=Math.pow(2,b.tileID.canonical.z),G=k.tileID.key;E===0&&A===0||Math.abs(A)>1||(Math.abs(E)>1&&(Math.abs(E+B)===1?E+=B:Math.abs(E-B)===1&&(E-=B)),k.dem&&b.dem&&(b.dem.backfillBorder(k.dem,E,A),b.neighboringTiles&&b.neighboringTiles[G]&&(b.neighboringTiles[G].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,f,g,b){for(const k in this._tiles){let E=this._tiles[k];if(b[k]||!E.hasData()||E.tileID.overscaledZ<=f||E.tileID.overscaledZ>g)continue;let A=E.tileID;for(;E&&E.tileID.overscaledZ>f+1;){const G=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[G.key],E&&E.hasData()&&(A=G)}let B=A;for(;B.overscaledZ>f;)if(B=B.scaledTo(B.overscaledZ-1),l[B.key]){b[A.key]=A;break}}}findLoadedParent(l,f){if(l.key in this._loadedParentTiles){const g=this._loadedParentTiles[l.key];return g&&g.tileID.overscaledZ>=f?g:null}for(let g=l.overscaledZ-1;g>=f;g--){const b=l.scaledTo(g),k=this._getLoadedTile(b);if(k)return k}}_getLoadedTile(l){const f=this._tiles[l.key];return f&&f.hasData()?f:this._cache.getByKey(l.wrapped().key)}updateCacheSize(l){const f=Math.ceil(l.width/this._source.tileSize)+1,g=Math.ceil(l.height/this._source.tileSize)+1,b=Math.floor(f*g*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),k=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(k)}handleWrapJump(l){const f=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,f){const g={};for(const b in this._tiles){const k=this._tiles[b];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+f),g[k.tileID.key]=k}this._tiles=g;for(const b in this._timers)clearTimeout(this._timers[b]),delete this._timers[b];for(const b in this._tiles)this._setTileReloadTimer(b,this._tiles[b])}}update(l,f){if(!this._sourceLoaded||this._paused)return;let g;this.transform=l,this.terrain=f,this.updateCacheSize(l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?g=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(X=>new a.Q(X.canonical.z,X.wrap,X.canonical.z,X.canonical.x,X.canonical.y)):(g=l.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:f}),this._source.hasTile&&(g=g.filter(X=>this._source.hasTile(X)))):g=[];const b=l.coveringZoomLevel(this._source),k=Math.max(b-Yn.maxOverzooming,this._source.minzoom),E=Math.max(b+Yn.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const X={};for(const Y of g)if(Y.canonical.z>this._source.minzoom){const pe=Y.scaledTo(Y.canonical.z-1);X[pe.key]=pe;const Se=Y.scaledTo(Math.max(this._source.minzoom,Math.min(Y.canonical.z,5)));X[Se.key]=Se}g=g.concat(Object.values(X))}const A=g.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,A&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const B=this._updateRetainedTiles(g,b);if(pn(this._source.type)){const X={},Y={},pe=Object.keys(B),Se=_.now();for(const ke of pe){const Me=B[ke],ye=this._tiles[ke];if(!ye||ye.fadeEndTime!==0&&ye.fadeEndTime<=Se)continue;const Fe=this.findLoadedParent(Me,k);Fe&&(this._addTile(Fe.tileID),X[Fe.tileID.key]=Fe.tileID),Y[ke]=Me}this._retainLoadedChildren(Y,b,E,B);for(const ke in X)B[ke]||(this._coveredTiles[ke]=!0,B[ke]=X[ke]);if(f){const ke={},Me={};for(const ye of g)this._tiles[ye.key].hasData()?ke[ye.key]=ye:Me[ye.key]=ye;for(const ye in Me){const Fe=Me[ye].children(this._source.maxzoom);this._tiles[Fe[0].key]&&this._tiles[Fe[1].key]&&this._tiles[Fe[2].key]&&this._tiles[Fe[3].key]&&(ke[Fe[0].key]=B[Fe[0].key]=Fe[0],ke[Fe[1].key]=B[Fe[1].key]=Fe[1],ke[Fe[2].key]=B[Fe[2].key]=Fe[2],ke[Fe[3].key]=B[Fe[3].key]=Fe[3],delete Me[ye])}for(const ye in Me){const Fe=this.findLoadedParent(Me[ye],this._source.minzoom);if(Fe){ke[Fe.tileID.key]=B[Fe.tileID.key]=Fe.tileID;for(const Je in ke)ke[Je].isChildOf(Fe.tileID)&&delete ke[Je]}}for(const ye in this._tiles)ke[ye]||(this._coveredTiles[ye]=!0)}}for(const X in B)this._tiles[X].clearFadeHold();const G=a.ab(this._tiles,B);for(const X of G){const Y=this._tiles[X];Y.hasSymbolBuckets&&!Y.holdingForFade()?Y.setHoldDuration(this.map._fadeDuration):Y.hasSymbolBuckets&&!Y.symbolFadeFinished()||this._removeTile(X)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(l)}_updateRetainedTiles(l,f){const g={},b={},k=Math.max(f-Yn.maxOverzooming,this._source.minzoom),E=Math.max(f+Yn.maxUnderzooming,this._source.minzoom),A={};for(const B of l){const G=this._addTile(B);g[B.key]=B,G.hasData()||f<this._source.maxzoom&&(A[B.key]=B)}this._retainLoadedChildren(A,f,E,g);for(const B of l){let G=this._tiles[B.key];if(G.hasData())continue;if(f+1>this._source.maxzoom){const Y=B.children(this._source.maxzoom)[0],pe=this.getTile(Y);if(pe&&pe.hasData()){g[Y.key]=Y;continue}}else{const Y=B.children(this._source.maxzoom);if(g[Y[0].key]&&g[Y[1].key]&&g[Y[2].key]&&g[Y[3].key])continue}let X=G.wasRequested();for(let Y=B.overscaledZ-1;Y>=k;--Y){const pe=B.scaledTo(Y);if(b[pe.key])break;if(b[pe.key]=!0,G=this.getTile(pe),!G&&X&&(G=this._addTile(pe)),G){const Se=G.hasData();if((X||Se)&&(g[pe.key]=pe),X=G.wasRequested(),Se)break}}}return g}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const f=[];let g,b=this._tiles[l].tileID;for(;b.overscaledZ>0;){if(b.key in this._loadedParentTiles){g=this._loadedParentTiles[b.key];break}f.push(b.key);const k=b.scaledTo(b.overscaledZ-1);if(g=this._getLoadedTile(k),g)break;b=k}for(const k of f)this._loadedParentTiles[k]=g}}_addTile(l){let f=this._tiles[l.key];if(f)return f;f=this._cache.getAndRemove(l),f&&(this._setTileReloadTimer(l.key,f),f.tileID=l,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,f)));const g=f;return f||(f=new wr(l,this._source.tileSize*l.overscaleFactor()),this._loadTile(f,l.key,f.state)),f.uses++,this._tiles[l.key]=f,g||this._source.fire(new a.k("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f}_setTileReloadTimer(l,f){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const g=f.getExpiryTimeout();g&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},g))}_removeTile(l){const f=this._tiles[l];f&&(f.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),f.uses>0||(f.hasData()&&f.state!=="reloading"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))}_dataHandler(l){const f=l.sourceDataType;l.dataType==="source"&&f==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&f==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(l);this._cache.reset()}tilesIn(l,f,g){const b=[],k=this.transform;if(!k)return b;const E=g?k.getCameraQueryGeometry(l):l,A=l.map(ke=>k.pointCoordinate(ke,this.terrain)),B=E.map(ke=>k.pointCoordinate(ke,this.terrain)),G=this.getIds();let X=1/0,Y=1/0,pe=-1/0,Se=-1/0;for(const ke of B)X=Math.min(X,ke.x),Y=Math.min(Y,ke.y),pe=Math.max(pe,ke.x),Se=Math.max(Se,ke.y);for(let ke=0;ke<G.length;ke++){const Me=this._tiles[G[ke]];if(Me.holdingForFade())continue;const ye=Me.tileID,Fe=Math.pow(2,k.zoom-Me.tileID.overscaledZ),Je=f*Me.queryPadding*a.W/Me.tileSize/Fe,Le=[ye.getTilePoint(new a.Y(X,Y)),ye.getTilePoint(new a.Y(pe,Se))];if(Le[0].x-Je<a.W&&Le[0].y-Je<a.W&&Le[1].x+Je>=0&&Le[1].y+Je>=0){const Ve=A.map(nt=>ye.getTilePoint(nt)),Qe=B.map(nt=>ye.getTilePoint(nt));b.push({tile:Me,tileID:ye,queryGeometry:Ve,cameraQueryGeometry:Qe,scale:Fe})}}return b}getVisibleCoordinates(l){const f=this.getRenderableIds(l).map(g=>this._tiles[g].tileID);for(const g of f)g.posMatrix=this.transform.calculatePosMatrix(g.toUnwrapped());return f}hasTransition(){if(this._source.hasTransition())return!0;if(pn(this._source.type)){const l=_.now();for(const f in this._tiles)if(this._tiles[f].fadeEndTime>=l)return!0}return!1}setFeatureState(l,f,g){this._state.updateState(l=l||"_geojsonTileLayer",f,g)}removeFeatureState(l,f,g){this._state.removeFeatureState(l=l||"_geojsonTileLayer",f,g)}getFeatureState(l,f){return this._state.getState(l=l||"_geojsonTileLayer",f)}setDependencies(l,f,g){const b=this._tiles[l];b&&b.setDependencies(f,g)}reloadTilesForDependencies(l,f){for(const g in this._tiles)this._tiles[g].hasDependency(l,f)&&this._reloadTile(g,"reloading");this._cache.filter(g=>!g.hasDependency(l,f))}}function At(x,l){const f=Math.abs(2*x.wrap)-+(x.wrap<0),g=Math.abs(2*l.wrap)-+(l.wrap<0);return x.overscaledZ-l.overscaledZ||g-f||l.canonical.y-x.canonical.y||l.canonical.x-x.canonical.x}function pn(x){return x==="raster"||x==="image"||x==="video"}Yn.maxOverzooming=10,Yn.maxUnderzooming=3;class Gt{constructor(l,f){this.reset(l,f)}reset(l,f){this.points=l||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=a.ac(l,0,1);let f=1,g=this._distances[f];const b=l*this.paddedLength+this.padding;for(;g<b&&f<this._distances.length;)g=this._distances[++f];const k=f-1,E=this._distances[k],A=g-E,B=A>0?(b-E)/A:0;return this.points[k].mult(1-B).add(this.points[f].mult(B))}}function Qn(x,l){let f=!0;return x==="always"||x!=="never"&&l!=="never"||(f=!1),f}class mi{constructor(l,f,g){const b=this.boxCells=[],k=this.circleCells=[];this.xCellCount=Math.ceil(l/g),this.yCellCount=Math.ceil(f/g);for(let E=0;E<this.xCellCount*this.yCellCount;E++)b.push([]),k.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,f,g,b,k){this._forEachCell(f,g,b,k,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(b),this.bboxes.push(k)}insertCircle(l,f,g,b){this._forEachCell(f-b,g-b,f+b,g+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(g),this.circles.push(b)}_insertBoxCell(l,f,g,b,k,E){this.boxCells[k].push(E)}_insertCircleCell(l,f,g,b,k,E){this.circleCells[k].push(E)}_query(l,f,g,b,k,E,A){if(g<0||l>this.width||b<0||f>this.height)return[];const B=[];if(l<=0&&f<=0&&this.width<=g&&this.height<=b){if(k)return[{key:null,x1:l,y1:f,x2:g,y2:b}];for(let G=0;G<this.boxKeys.length;G++)B.push({key:this.boxKeys[G],x1:this.bboxes[4*G],y1:this.bboxes[4*G+1],x2:this.bboxes[4*G+2],y2:this.bboxes[4*G+3]});for(let G=0;G<this.circleKeys.length;G++){const X=this.circles[3*G],Y=this.circles[3*G+1],pe=this.circles[3*G+2];B.push({key:this.circleKeys[G],x1:X-pe,y1:Y-pe,x2:X+pe,y2:Y+pe})}}else this._forEachCell(l,f,g,b,this._queryCell,B,{hitTest:k,overlapMode:E,seenUids:{box:{},circle:{}}},A);return B}query(l,f,g,b){return this._query(l,f,g,b,!1,null)}hitTest(l,f,g,b,k,E){return this._query(l,f,g,b,!0,k,E).length>0}hitTestCircle(l,f,g,b,k){const E=l-g,A=l+g,B=f-g,G=f+g;if(A<0||E>this.width||G<0||B>this.height)return!1;const X=[];return this._forEachCell(E,B,A,G,this._queryCellCircle,X,{hitTest:!0,overlapMode:b,circle:{x:l,y:f,radius:g},seenUids:{box:{},circle:{}}},k),X.length>0}_queryCell(l,f,g,b,k,E,A,B){const{seenUids:G,hitTest:X,overlapMode:Y}=A,pe=this.boxCells[k];if(pe!==null){const ke=this.bboxes;for(const Me of pe)if(!G.box[Me]){G.box[Me]=!0;const ye=4*Me,Fe=this.boxKeys[Me];if(l<=ke[ye+2]&&f<=ke[ye+3]&&g>=ke[ye+0]&&b>=ke[ye+1]&&(!B||B(Fe))&&(!X||!Qn(Y,Fe.overlapMode))&&(E.push({key:Fe,x1:ke[ye],y1:ke[ye+1],x2:ke[ye+2],y2:ke[ye+3]}),X))return!0}}const Se=this.circleCells[k];if(Se!==null){const ke=this.circles;for(const Me of Se)if(!G.circle[Me]){G.circle[Me]=!0;const ye=3*Me,Fe=this.circleKeys[Me];if(this._circleAndRectCollide(ke[ye],ke[ye+1],ke[ye+2],l,f,g,b)&&(!B||B(Fe))&&(!X||!Qn(Y,Fe.overlapMode))){const Je=ke[ye],Le=ke[ye+1],Ve=ke[ye+2];if(E.push({key:Fe,x1:Je-Ve,y1:Le-Ve,x2:Je+Ve,y2:Le+Ve}),X)return!0}}}return!1}_queryCellCircle(l,f,g,b,k,E,A,B){const{circle:G,seenUids:X,overlapMode:Y}=A,pe=this.boxCells[k];if(pe!==null){const ke=this.bboxes;for(const Me of pe)if(!X.box[Me]){X.box[Me]=!0;const ye=4*Me,Fe=this.boxKeys[Me];if(this._circleAndRectCollide(G.x,G.y,G.radius,ke[ye+0],ke[ye+1],ke[ye+2],ke[ye+3])&&(!B||B(Fe))&&!Qn(Y,Fe.overlapMode))return E.push(!0),!0}}const Se=this.circleCells[k];if(Se!==null){const ke=this.circles;for(const Me of Se)if(!X.circle[Me]){X.circle[Me]=!0;const ye=3*Me,Fe=this.circleKeys[Me];if(this._circlesCollide(ke[ye],ke[ye+1],ke[ye+2],G.x,G.y,G.radius)&&(!B||B(Fe))&&!Qn(Y,Fe.overlapMode))return E.push(!0),!0}}}_forEachCell(l,f,g,b,k,E,A,B){const G=this._convertToXCellCoord(l),X=this._convertToYCellCoord(f),Y=this._convertToXCellCoord(g),pe=this._convertToYCellCoord(b);for(let Se=G;Se<=Y;Se++)for(let ke=X;ke<=pe;ke++)if(k.call(this,l,f,g,b,this.xCellCount*ke+Se,E,A,B))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,f,g,b,k,E){const A=b-l,B=k-f,G=g+E;return G*G>A*A+B*B}_circleAndRectCollide(l,f,g,b,k,E,A){const B=(E-b)/2,G=Math.abs(l-(b+B));if(G>B+g)return!1;const X=(A-k)/2,Y=Math.abs(f-(k+X));if(Y>X+g)return!1;if(G<=B||Y<=X)return!0;const pe=G-B,Se=Y-X;return pe*pe+Se*Se<=g*g}}function sn(x,l,f,g,b){const k=a.F();return l?(a.J(k,k,[1/b,1/b,1]),f||a.ad(k,k,g.angle)):a.K(k,g.labelPlaneMatrix,x),k}function zi(x,l,f,g,b){if(l){const k=a.ae(x);return a.J(k,k,[b,b,1]),f||a.ad(k,k,-g.angle),k}return g.glCoordMatrix}function er(x,l,f){let g;f?(g=[x.x,x.y,f(x.x,x.y),1],a.af(g,g,l)):(g=[x.x,x.y,0,1],ct(g,g,l));const b=g[3];return{point:new a.P(g[0]/b,g[1]/b),signedDistanceFromCamera:b}}function Ce(x,l){return .5+x/l*.5}function te(x,l){const f=x[0]/x[3],g=x[1]/x[3];return f>=-l[0]&&f<=l[0]&&g>=-l[1]&&g<=l[1]}function ne(x,l,f,g,b,k,E,A,B,G){const X=g?x.textSizeData:x.iconSizeData,Y=a.ag(X,f.transform.zoom),pe=[256/f.width*2+1,256/f.height*2+1],Se=g?x.text.dynamicLayoutVertexArray:x.icon.dynamicLayoutVertexArray;Se.clear();const ke=x.lineVertexArray,Me=g?x.text.placedSymbolArray:x.icon.placedSymbolArray,ye=f.transform.width/f.transform.height;let Fe=!1;for(let Je=0;Je<Me.length;Je++){const Le=Me.get(Je);if(Le.hidden||Le.writingMode===a.ah.vertical&&!Fe){Ye(Le.numGlyphs,Se);continue}let Ve;if(Fe=!1,G?(Ve=[Le.anchorX,Le.anchorY,G(Le.anchorX,Le.anchorY),1],a.af(Ve,Ve,l)):(Ve=[Le.anchorX,Le.anchorY,0,1],ct(Ve,Ve,l)),!te(Ve,pe)){Ye(Le.numGlyphs,Se);continue}const Qe=Ce(f.transform.cameraToCenterDistance,Ve[3]),nt=a.ai(X,Y,Le),ot=E?nt/Qe:nt*Qe,gt=new a.P(Le.anchorX,Le.anchorY),dt=er(gt,b,G).point,It={projections:{},offsets:{}},zt=Be(Le,ot,!1,A,l,b,k,x.glyphOffsetArray,ke,Se,dt,gt,It,ye,B,G);Fe=zt.useVertical,(zt.notEnoughRoom||Fe||zt.needsFlipping&&Be(Le,ot,!0,A,l,b,k,x.glyphOffsetArray,ke,Se,dt,gt,It,ye,B,G).notEnoughRoom)&&Ye(Le.numGlyphs,Se)}g?x.text.dynamicLayoutVertexBuffer.updateData(Se):x.icon.dynamicLayoutVertexBuffer.updateData(Se)}function le(x,l,f,g,b,k,E,A,B,G,X,Y,pe){const Se=A.glyphStartIndex+A.numGlyphs,ke=A.lineStartIndex,Me=A.lineStartIndex+A.lineLength,ye=l.getoffsetX(A.glyphStartIndex),Fe=l.getoffsetX(Se-1),Je=He(x*ye,f,g,b,k,E,A.segment,ke,Me,B,G,X,Y,pe);if(!Je)return null;const Le=He(x*Fe,f,g,b,k,E,A.segment,ke,Me,B,G,X,Y,pe);return Le?{first:Je,last:Le}:null}function we(x,l,f,g){return x===a.ah.horizontal&&Math.abs(f.y-l.y)>Math.abs(f.x-l.x)*g?{useVertical:!0}:(x===a.ah.vertical?l.y<f.y:l.x>f.x)?{needsFlipping:!0}:null}function Be(x,l,f,g,b,k,E,A,B,G,X,Y,pe,Se,ke,Me){const ye=l/24,Fe=x.lineOffsetX*ye,Je=x.lineOffsetY*ye;let Le;if(x.numGlyphs>1){const Ve=x.glyphStartIndex+x.numGlyphs,Qe=x.lineStartIndex,nt=x.lineStartIndex+x.lineLength,ot=le(ye,A,Fe,Je,f,X,Y,x,B,k,pe,ke,Me);if(!ot)return{notEnoughRoom:!0};const gt=er(ot.first.point,E,Me).point,dt=er(ot.last.point,E,Me).point;if(g&&!f){const It=we(x.writingMode,gt,dt,Se);if(It)return It}Le=[ot.first];for(let It=x.glyphStartIndex+1;It<Ve-1;It++)Le.push(He(ye*A.getoffsetX(It),Fe,Je,f,X,Y,x.segment,Qe,nt,B,k,pe,ke,Me));Le.push(ot.last)}else{if(g&&!f){const Qe=er(Y,b,Me).point,nt=x.lineStartIndex+x.segment+1,ot=new a.P(B.getx(nt),B.gety(nt)),gt=er(ot,b,Me),dt=gt.signedDistanceFromCamera>0?gt.point:Oe(Y,ot,Qe,1,b,Me),It=we(x.writingMode,Qe,dt,Se);if(It)return It}const Ve=He(ye*A.getoffsetX(x.glyphStartIndex),Fe,Je,f,X,Y,x.segment,x.lineStartIndex,x.lineStartIndex+x.lineLength,B,k,pe,ke,Me);if(!Ve)return{notEnoughRoom:!0};Le=[Ve]}for(const Ve of Le)a.aj(G,Ve.point,Ve.angle);return{}}function Oe(x,l,f,g,b,k){const E=er(x.add(x.sub(l)._unit()),b,k).point,A=f.sub(E);return f.add(A._mult(g/A.mag()))}function qe(x,l){const{projectionCache:f,lineVertexArray:g,labelPlaneMatrix:b,tileAnchorPoint:k,distanceFromAnchor:E,getElevation:A,previousVertex:B,direction:G,absOffsetX:X}=l;if(f.projections[x])return f.projections[x];const Y=new a.P(g.getx(x),g.gety(x)),pe=er(Y,b,A);if(pe.signedDistanceFromCamera>0)return f.projections[x]=pe.point,pe.point;const Se=x-G;return Oe(E===0?k:new a.P(g.getx(Se),g.gety(Se)),Y,B,X-E+1,b,A)}function De(x,l,f){return x._unit()._perp()._mult(l*f)}function re(x,l,f,g,b,k,E,A){const{projectionCache:B,direction:G}=A;if(B.offsets[x])return B.offsets[x];const X=f.add(l);if(x+G<g||x+G>=b)return B.offsets[x]=X,X;const Y=qe(x+G,A),pe=De(Y.sub(f),E,G),Se=f.add(pe),ke=Y.add(pe);return B.offsets[x]=a.ak(k,X,Se,ke)||X,B.offsets[x]}function He(x,l,f,g,b,k,E,A,B,G,X,Y,pe,Se){const ke=g?x-l:x+l;let Me=ke>0?1:-1,ye=0;g&&(Me*=-1,ye=Math.PI),Me<0&&(ye+=Math.PI);let Fe,Je,Le=Me>0?A+E:A+E+1,Ve=b,Qe=b,nt=0,ot=0;const gt=Math.abs(ke),dt=[];let It;for(;nt+ot<=gt;){if(Le+=Me,Le<A||Le>=B)return null;nt+=ot,Qe=Ve,Je=Fe;const Rt={projectionCache:Y,lineVertexArray:G,labelPlaneMatrix:X,tileAnchorPoint:k,distanceFromAnchor:nt,getElevation:Se,previousVertex:Qe,direction:Me,absOffsetX:gt};if(Ve=qe(Le,Rt),f===0)dt.push(Qe),It=Ve.sub(Qe);else{let dn;const bn=Ve.sub(Qe);dn=bn.mag()===0?De(qe(Le+Me,Rt).sub(Ve),f,Me):De(bn,f,Me),Je||(Je=Qe.add(dn)),Fe=re(Le,dn,Ve,A,B,Je,f,Rt),dt.push(Je),It=Fe.sub(Je)}ot=It.mag()}const zt=It._mult((gt-nt)/ot)._add(Je||Qe),yn=ye+Math.atan2(Ve.y-Qe.y,Ve.x-Qe.x);return dt.push(zt),{point:zt,angle:pe?yn:0,path:dt}}const Ke=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ye(x,l){for(let f=0;f<x;f++){const g=l.length;l.resize(g+4),l.float32.set(Ke,3*g)}}function ct(x,l,f){const g=l[0],b=l[1];return x[0]=f[0]*g+f[4]*b+f[12],x[1]=f[1]*g+f[5]*b+f[13],x[3]=f[3]*g+f[7]*b+f[15],x}const Ct=100;class Xt{constructor(l,f=new mi(l.width+200,l.height+200,25),g=new mi(l.width+200,l.height+200,25)){this.transform=l,this.grid=f,this.ignoredGrid=g,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Ct,this.screenBottomBoundary=l.height+Ct,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(l,f,g,b,k,E){const A=this.projectAndGetPerspectiveRatio(b,l.anchorPointX,l.anchorPointY,E),B=g*A.perspectiveRatio,G=l.x1*B+A.point.x,X=l.y1*B+A.point.y,Y=l.x2*B+A.point.x,pe=l.y2*B+A.point.y;return!this.isInsideGrid(G,X,Y,pe)||f!=="always"&&this.grid.hitTest(G,X,Y,pe,f,k)||A.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[G,X,Y,pe],offscreen:this.isOffscreen(G,X,Y,pe)}}placeCollisionCircles(l,f,g,b,k,E,A,B,G,X,Y,pe,Se,ke){const Me=[],ye=new a.P(f.anchorX,f.anchorY),Fe=er(ye,E,ke),Je=Ce(this.transform.cameraToCenterDistance,Fe.signedDistanceFromCamera),Le=(X?k/Je:k*Je)/a.ao,Ve=er(ye,A,ke).point,Qe=le(Le,b,f.lineOffsetX*Le,f.lineOffsetY*Le,!1,Ve,ye,f,g,A,{projections:{},offsets:{}},!1,ke);let nt=!1,ot=!1,gt=!0;if(Qe){const dt=.5*pe*Je+Se,It=new a.P(-100,-100),zt=new a.P(this.screenRightBoundary,this.screenBottomBoundary),yn=new Gt,Rt=Qe.first,dn=Qe.last;let bn=[];for(let kn=Rt.path.length-1;kn>=1;kn--)bn.push(Rt.path[kn]);for(let kn=1;kn<dn.path.length;kn++)bn.push(dn.path[kn]);const jn=2.5*dt;if(B){const kn=bn.map(Pn=>er(Pn,B,ke));bn=kn.some(Pn=>Pn.signedDistanceFromCamera<=0)?[]:kn.map(Pn=>Pn.point)}let gn=[];if(bn.length>0){const kn=bn[0].clone(),Pn=bn[0].clone();for(let $r=1;$r<bn.length;$r++)kn.x=Math.min(kn.x,bn[$r].x),kn.y=Math.min(kn.y,bn[$r].y),Pn.x=Math.max(Pn.x,bn[$r].x),Pn.y=Math.max(Pn.y,bn[$r].y);gn=kn.x>=It.x&&Pn.x<=zt.x&&kn.y>=It.y&&Pn.y<=zt.y?[bn]:Pn.x<It.x||kn.x>zt.x||Pn.y<It.y||kn.y>zt.y?[]:a.al([bn],It.x,It.y,zt.x,zt.y)}for(const kn of gn){yn.reset(kn,.25*dt);let Pn=0;Pn=yn.length<=.5*dt?1:Math.ceil(yn.paddedLength/jn)+1;for(let $r=0;$r<Pn;$r++){const or=$r/Math.max(Pn-1,1),Qi=yn.lerp(or),ti=Qi.x+Ct,Lr=Qi.y+Ct;Me.push(ti,Lr,dt,0);const ni=ti-dt,eo=Lr-dt,Zo=ti+dt,xs=Lr+dt;if(gt=gt&&this.isOffscreen(ni,eo,Zo,xs),ot=ot||this.isInsideGrid(ni,eo,Zo,xs),l!=="always"&&this.grid.hitTestCircle(ti,Lr,dt,l,Y)&&(nt=!0,!G))return{circles:[],offscreen:!1,collisionDetected:nt}}}}return{circles:!G&&nt||!ot||Je<this.perspectiveRatioCutoff?[]:Me,offscreen:gt,collisionDetected:nt}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let g=1/0,b=1/0,k=-1/0,E=-1/0;for(const X of l){const Y=new a.P(X.x+Ct,X.y+Ct);g=Math.min(g,Y.x),b=Math.min(b,Y.y),k=Math.max(k,Y.x),E=Math.max(E,Y.y),f.push(Y)}const A=this.grid.query(g,b,k,E).concat(this.ignoredGrid.query(g,b,k,E)),B={},G={};for(const X of A){const Y=X.key;if(B[Y.bucketInstanceId]===void 0&&(B[Y.bucketInstanceId]={}),B[Y.bucketInstanceId][Y.featureIndex])continue;const pe=[new a.P(X.x1,X.y1),new a.P(X.x2,X.y1),new a.P(X.x2,X.y2),new a.P(X.x1,X.y2)];a.am(f,pe)&&(B[Y.bucketInstanceId][Y.featureIndex]=!0,G[Y.bucketInstanceId]===void 0&&(G[Y.bucketInstanceId]=[]),G[Y.bucketInstanceId].push(Y.featureIndex))}return G}insertCollisionBox(l,f,g,b,k,E){(g?this.ignoredGrid:this.grid).insert({bucketInstanceId:b,featureIndex:k,collisionGroupID:E,overlapMode:f},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,f,g,b,k,E){const A=g?this.ignoredGrid:this.grid,B={bucketInstanceId:b,featureIndex:k,collisionGroupID:E,overlapMode:f};for(let G=0;G<l.length;G+=4)A.insertCircle(B,l[G],l[G+1],l[G+2])}projectAndGetPerspectiveRatio(l,f,g,b){let k;return b?(k=[f,g,b(f,g),1],a.af(k,k,l)):(k=[f,g,0,1],ct(k,k,l)),{point:new a.P((k[0]/k[3]+1)/2*this.transform.width+Ct,(-k[1]/k[3]+1)/2*this.transform.height+Ct),perspectiveRatio:.5+this.transform.cameraToCenterDistance/k[3]*.5}}isOffscreen(l,f,g,b){return g<Ct||l>=this.screenRightBoundary||b<Ct||f>this.screenBottomBoundary}isInsideGrid(l,f,g,b){return g>=0&&l<this.gridRightBoundary&&b>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const l=a.an([]);return a.H(l,l,[-100,-100,0]),l}}function fn(x,l,f){return l*(a.W/(x.tileSize*Math.pow(2,f-x.tileID.overscaledZ)))}class wn{constructor(l,f,g,b){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):b&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class Bn{constructor(l,f,g,b,k){this.text=new wn(l?l.text:null,f,g,k),this.icon=new wn(l?l.icon:null,f,b,k)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class xr{constructor(l,f,g){this.text=l,this.icon=f,this.skipFade=g}}class qr{constructor(){this.invProjMatrix=a.F(),this.viewportMatrix=a.F(),this.circles=[]}}class xn{constructor(l,f,g,b,k){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=g,this.bucketIndex=b,this.tileID=k}}class Pr{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:g=>g.collisionGroupID===f}}return this.collisionGroups[l]}}function ei(x,l,f,g,b){const{horizontalAlign:k,verticalAlign:E}=a.at(x);return new a.P(-(k-.5)*l+g[0]*b,-(E-.5)*f+g[1]*b)}function Ti(x,l,f,g,b,k){const{x1:E,x2:A,y1:B,y2:G,anchorPointX:X,anchorPointY:Y}=x,pe=new a.P(l,f);return g&&pe._rotate(b?k:-k),{x1:E+pe.x,y1:B+pe.y,x2:A+pe.x,y2:G+pe.y,anchorPointX:X,anchorPointY:Y}}class Di{constructor(l,f,g,b,k){this.transform=l.clone(),this.terrain=f,this.collisionIndex=new Xt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=g,this.retainedQueryData={},this.collisionGroups=new Pr(b),this.collisionCircleArrays={},this.prevPlacement=k,k&&(k.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,f,g,b){const k=g.getBucket(f),E=g.latestFeatureIndex;if(!k||!E||f.id!==k.layerIds[0])return;const A=g.collisionBoxArray,B=k.layers[0].layout,G=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),X=g.tileSize/a.W,Y=this.transform.calculatePosMatrix(g.tileID.toUnwrapped()),pe=B.get("text-pitch-alignment")==="map",Se=B.get("text-rotation-alignment")==="map",ke=fn(g,1,this.transform.zoom),Me=sn(Y,pe,Se,this.transform,ke);let ye=null;if(pe){const Je=zi(Y,pe,Se,this.transform,ke);ye=a.K([],this.transform.labelPlaneMatrix,Je)}this.retainedQueryData[k.bucketInstanceId]=new xn(k.bucketInstanceId,E,k.sourceLayerIndex,k.index,g.tileID);const Fe={bucket:k,layout:B,posMatrix:Y,textLabelPlaneMatrix:Me,labelToScreenMatrix:ye,scale:G,textPixelRatio:X,holdingForFade:g.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:a.ag(k.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(k.sourceID)};if(b)for(const Je of k.sortKeyRanges){const{sortKey:Le,symbolInstanceStart:Ve,symbolInstanceEnd:Qe}=Je;l.push({sortKey:Le,symbolInstanceStart:Ve,symbolInstanceEnd:Qe,parameters:Fe})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:k.symbolInstances.length,parameters:Fe})}attemptAnchorPlacement(l,f,g,b,k,E,A,B,G,X,Y,pe,Se,ke,Me,ye){const Fe=a.ap[l.textAnchor],Je=[l.textOffset0,l.textOffset1],Le=ei(Fe,g,b,Je,k),Ve=this.collisionIndex.placeCollisionBox(Ti(f,Le.x,Le.y,E,A,this.transform.angle),Y,B,G,X.predicate,ye);if((!Me||this.collisionIndex.placeCollisionBox(Ti(Me,Le.x,Le.y,E,A,this.transform.angle),Y,B,G,X.predicate,ye).box.length!==0)&&Ve.box.length>0){let Qe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[pe.crossTileID]&&this.prevPlacement.placements[pe.crossTileID]&&this.prevPlacement.placements[pe.crossTileID].text&&(Qe=this.prevPlacement.variableOffsets[pe.crossTileID].anchor),pe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[pe.crossTileID]={textOffset:Je,width:g,height:b,anchor:Fe,textBoxScale:k,prevAnchor:Qe},this.markUsedJustification(Se,Fe,pe,ke),Se.allowVerticalPlacement&&(this.markUsedOrientation(Se,ke,pe),this.placedOrientations[pe.crossTileID]=ke),{shift:Le,placedGlyphBoxes:Ve}}}placeLayerBucketPart(l,f,g){const{bucket:b,layout:k,posMatrix:E,textLabelPlaneMatrix:A,labelToScreenMatrix:B,textPixelRatio:G,holdingForFade:X,collisionBoxArray:Y,partiallyEvaluatedTextSize:pe,collisionGroup:Se}=l.parameters,ke=k.get("text-optional"),Me=k.get("icon-optional"),ye=a.aq(k,"text-overlap","text-allow-overlap"),Fe=ye==="always",Je=a.aq(k,"icon-overlap","icon-allow-overlap"),Le=Je==="always",Ve=k.get("text-rotation-alignment")==="map",Qe=k.get("text-pitch-alignment")==="map",nt=k.get("icon-text-fit")!=="none",ot=k.get("symbol-z-order")==="viewport-y",gt=Fe&&(Le||!b.hasIconData()||Me),dt=Le&&(Fe||!b.hasTextData()||ke);!b.collisionArrays&&Y&&b.deserializeCollisionBoxes(Y);const It=this.retainedQueryData[b.bucketInstanceId].tileID,zt=this.terrain?(Rt,dn)=>this.terrain.getElevation(It,Rt,dn):null,yn=(Rt,dn)=>{var bn,jn;if(f[Rt.crossTileID])return;if(X)return void(this.placements[Rt.crossTileID]=new xr(!1,!1,!1));let gn=!1,kn=!1,Pn=!0,$r=null,or={box:null,offscreen:null},Qi={box:null,offscreen:null},ti=null,Lr=null,ni=null,eo=0,Zo=0,xs=0;dn.textFeatureIndex?eo=dn.textFeatureIndex:Rt.useRuntimeCollisionCircles&&(eo=Rt.featureIndex),dn.verticalTextFeatureIndex&&(Zo=dn.verticalTextFeatureIndex);const ll=dn.textBox;if(ll){const Gr=Hr=>{let Ir=a.ah.horizontal;if(b.allowVerticalPlacement&&!Hr&&this.prevPlacement){const mo=this.prevPlacement.placedOrientations[Rt.crossTileID];mo&&(this.placedOrientations[Rt.crossTileID]=mo,Ir=mo,this.markUsedOrientation(b,Ir,Rt))}return Ir},Er=(Hr,Ir)=>{if(b.allowVerticalPlacement&&Rt.numVerticalGlyphVertices>0&&dn.verticalTextBox){for(const mo of b.writingModes)if(mo===a.ah.vertical?(or=Ir(),Qi=or):or=Hr(),or&&or.box&&or.box.length)break}else or=Hr()},Sr=Rt.textAnchorOffsetStartIndex,po=Rt.textAnchorOffsetEndIndex;if(po===Sr){const Hr=(Ir,mo)=>{const Wr=this.collisionIndex.placeCollisionBox(Ir,ye,G,E,Se.predicate,zt);return Wr&&Wr.box&&Wr.box.length&&(this.markUsedOrientation(b,mo,Rt),this.placedOrientations[Rt.crossTileID]=mo),Wr};Er(()=>Hr(ll,a.ah.horizontal),()=>{const Ir=dn.verticalTextBox;return b.allowVerticalPlacement&&Rt.numVerticalGlyphVertices>0&&Ir?Hr(Ir,a.ah.vertical):{box:null,offscreen:null}}),Gr(or&&or.box&&or.box.length)}else{let Hr=a.ap[(jn=(bn=this.prevPlacement)===null||bn===void 0?void 0:bn.variableOffsets[Rt.crossTileID])===null||jn===void 0?void 0:jn.anchor];const Ir=(Wr,Or,bu)=>{const _f=Wr.x2-Wr.x1,Fs=Wr.y2-Wr.y1,Bs=Rt.textBoxScale,lc=nt&&Je==="never"?Or:null;let Ss={box:[],offscreen:!1},vu=ye==="never"?1:2,yf="never";Hr&&vu++;for(let wu=0;wu<vu;wu++){for(let xu=Sr;xu<po;xu++){const cc=b.textAnchorOffsets.get(xu);if(Hr&&cc.textAnchor!==Hr)continue;const ku=this.attemptAnchorPlacement(cc,Wr,_f,Fs,Bs,Ve,Qe,G,E,Se,yf,Rt,b,bu,lc,zt);if(ku&&(Ss=ku.placedGlyphBoxes,Ss&&Ss.box&&Ss.box.length))return gn=!0,$r=ku.shift,Ss}Hr?Hr=null:yf=ye}return Ss};Er(()=>Ir(ll,dn.iconBox,a.ah.horizontal),()=>{const Wr=dn.verticalTextBox;return b.allowVerticalPlacement&&!(or&&or.box&&or.box.length)&&Rt.numVerticalGlyphVertices>0&&Wr?Ir(Wr,dn.verticalIconBox,a.ah.vertical):{box:null,offscreen:null}}),or&&(gn=or.box,Pn=or.offscreen);const mo=Gr(or&&or.box);if(!gn&&this.prevPlacement){const Wr=this.prevPlacement.variableOffsets[Rt.crossTileID];Wr&&(this.variableOffsets[Rt.crossTileID]=Wr,this.markUsedJustification(b,Wr.anchor,Rt,mo))}}}if(ti=or,gn=ti&&ti.box&&ti.box.length>0,Pn=ti&&ti.offscreen,Rt.useRuntimeCollisionCircles){const Gr=b.text.placedSymbolArray.get(Rt.centerJustifiedTextSymbolIndex),Er=a.ai(b.textSizeData,pe,Gr),Sr=k.get("text-padding");Lr=this.collisionIndex.placeCollisionCircles(ye,Gr,b.lineVertexArray,b.glyphOffsetArray,Er,E,A,B,g,Qe,Se.predicate,Rt.collisionCircleDiameter,Sr,zt),Lr.circles.length&&Lr.collisionDetected&&!g&&a.w("Collisions detected, but collision boxes are not shown"),gn=Fe||Lr.circles.length>0&&!Lr.collisionDetected,Pn=Pn&&Lr.offscreen}if(dn.iconFeatureIndex&&(xs=dn.iconFeatureIndex),dn.iconBox){const Gr=Er=>{const Sr=nt&&$r?Ti(Er,$r.x,$r.y,Ve,Qe,this.transform.angle):Er;return this.collisionIndex.placeCollisionBox(Sr,Je,G,E,Se.predicate,zt)};Qi&&Qi.box&&Qi.box.length&&dn.verticalIconBox?(ni=Gr(dn.verticalIconBox),kn=ni.box.length>0):(ni=Gr(dn.iconBox),kn=ni.box.length>0),Pn=Pn&&ni.offscreen}const ks=ke||Rt.numHorizontalGlyphVertices===0&&Rt.numVerticalGlyphVertices===0,Go=Me||Rt.numIconVertices===0;if(ks||Go?Go?ks||(kn=kn&&gn):gn=kn&&gn:kn=gn=kn&&gn,gn&&ti&&ti.box&&this.collisionIndex.insertCollisionBox(ti.box,ye,k.get("text-ignore-placement"),b.bucketInstanceId,Qi&&Qi.box&&Zo?Zo:eo,Se.ID),kn&&ni&&this.collisionIndex.insertCollisionBox(ni.box,Je,k.get("icon-ignore-placement"),b.bucketInstanceId,xs,Se.ID),Lr&&(gn&&this.collisionIndex.insertCollisionCircles(Lr.circles,ye,k.get("text-ignore-placement"),b.bucketInstanceId,eo,Se.ID),g)){const Gr=b.bucketInstanceId;let Er=this.collisionCircleArrays[Gr];Er===void 0&&(Er=this.collisionCircleArrays[Gr]=new qr);for(let Sr=0;Sr<Lr.circles.length;Sr+=4)Er.circles.push(Lr.circles[Sr+0]),Er.circles.push(Lr.circles[Sr+1]),Er.circles.push(Lr.circles[Sr+2]),Er.circles.push(Lr.collisionDetected?1:0)}if(Rt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(b.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Rt.crossTileID]=new xr(gn||gt,kn||dt,Pn||b.justReloaded),f[Rt.crossTileID]=!0};if(ot){if(l.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Rt=b.getSortedSymbolIndexes(this.transform.angle);for(let dn=Rt.length-1;dn>=0;--dn){const bn=Rt[dn];yn(b.symbolInstances.get(bn),b.collisionArrays[bn])}}else for(let Rt=l.symbolInstanceStart;Rt<l.symbolInstanceEnd;Rt++)yn(b.symbolInstances.get(Rt),b.collisionArrays[Rt]);if(g&&b.bucketInstanceId in this.collisionCircleArrays){const Rt=this.collisionCircleArrays[b.bucketInstanceId];a.ar(Rt.invProjMatrix,E),Rt.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(l,f,g,b){let k;k=b===a.ah.vertical?g.verticalPlacedTextSymbolIndex:{left:g.leftJustifiedTextSymbolIndex,center:g.centerJustifiedTextSymbolIndex,right:g.rightJustifiedTextSymbolIndex}[a.as(f)];const E=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex,g.verticalPlacedTextSymbolIndex];for(const A of E)A>=0&&(l.text.placedSymbolArray.get(A).crossTileID=k>=0&&A!==k?0:g.crossTileID)}markUsedOrientation(l,f,g){const b=f===a.ah.horizontal||f===a.ah.horizontalOnly?f:0,k=f===a.ah.vertical?f:0,E=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex];for(const A of E)l.text.placedSymbolArray.get(A).placedOrientation=b;g.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(g.verticalPlacedTextSymbolIndex).placedOrientation=k)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let g=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const b=f?f.symbolFadeChange(l):1,k=f?f.opacities:{},E=f?f.variableOffsets:{},A=f?f.placedOrientations:{};for(const B in this.placements){const G=this.placements[B],X=k[B];X?(this.opacities[B]=new Bn(X,b,G.text,G.icon),g=g||G.text!==X.text.placed||G.icon!==X.icon.placed):(this.opacities[B]=new Bn(null,b,G.text,G.icon,G.skipFade),g=g||G.text||G.icon)}for(const B in k){const G=k[B];if(!this.opacities[B]){const X=new Bn(G,b,!1,!1);X.isHidden()||(this.opacities[B]=X,g=g||G.text.placed||G.icon.placed)}}for(const B in E)this.variableOffsets[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.variableOffsets[B]=E[B]);for(const B in A)this.placedOrientations[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.placedOrientations[B]=A[B]);if(f&&f.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");g?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)}updateLayerOpacities(l,f){const g={};for(const b of f){const k=b.getBucket(l);k&&b.latestFeatureIndex&&l.id===k.layerIds[0]&&this.updateBucketOpacities(k,g,b.collisionBoxArray)}}updateBucketOpacities(l,f,g){l.hasTextData()&&(l.text.opacityVertexArray.clear(),l.text.hasVisibleVertices=!1),l.hasIconData()&&(l.icon.opacityVertexArray.clear(),l.icon.hasVisibleVertices=!1),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const b=l.layers[0],k=b.layout,E=new Bn(null,0,!1,!1,!0),A=k.get("text-allow-overlap"),B=k.get("icon-allow-overlap"),G=b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"),X=k.get("text-rotation-alignment")==="map",Y=k.get("text-pitch-alignment")==="map",pe=k.get("icon-text-fit")!=="none",Se=new Bn(null,0,A&&(B||!l.hasIconData()||k.get("icon-optional")),B&&(A||!l.hasTextData()||k.get("text-optional")),!0);!l.collisionArrays&&g&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(g);const ke=(Me,ye,Fe)=>{for(let Je=0;Je<ye/4;Je++)Me.opacityVertexArray.emplaceBack(Fe);Me.hasVisibleVertices=Me.hasVisibleVertices||Fe!==Na};for(let Me=0;Me<l.symbolInstances.length;Me++){const ye=l.symbolInstances.get(Me),{numHorizontalGlyphVertices:Fe,numVerticalGlyphVertices:Je,crossTileID:Le}=ye;let Ve=this.opacities[Le];f[Le]?Ve=E:Ve||(Ve=Se,this.opacities[Le]=Ve),f[Le]=!0;const Qe=ye.numIconVertices>0,nt=this.placedOrientations[ye.crossTileID],ot=nt===a.ah.vertical,gt=nt===a.ah.horizontal||nt===a.ah.horizontalOnly;if(Fe>0||Je>0){const dt=$i(Ve.text);ke(l.text,Fe,ot?Na:dt),ke(l.text,Je,gt?Na:dt);const It=Ve.text.isHidden();[ye.rightJustifiedTextSymbolIndex,ye.centerJustifiedTextSymbolIndex,ye.leftJustifiedTextSymbolIndex].forEach(Rt=>{Rt>=0&&(l.text.placedSymbolArray.get(Rt).hidden=It||ot?1:0)}),ye.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(ye.verticalPlacedTextSymbolIndex).hidden=It||gt?1:0);const zt=this.variableOffsets[ye.crossTileID];zt&&this.markUsedJustification(l,zt.anchor,ye,nt);const yn=this.placedOrientations[ye.crossTileID];yn&&(this.markUsedJustification(l,"left",ye,yn),this.markUsedOrientation(l,yn,ye))}if(Qe){const dt=$i(Ve.icon),It=!(pe&&ye.verticalPlacedIconSymbolIndex&&ot);ye.placedIconSymbolIndex>=0&&(ke(l.icon,ye.numIconVertices,It?dt:Na),l.icon.placedSymbolArray.get(ye.placedIconSymbolIndex).hidden=Ve.icon.isHidden()),ye.verticalPlacedIconSymbolIndex>=0&&(ke(l.icon,ye.numVerticalIconVertices,It?Na:dt),l.icon.placedSymbolArray.get(ye.verticalPlacedIconSymbolIndex).hidden=Ve.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const dt=l.collisionArrays[Me];if(dt){let It=new a.P(0,0);if(dt.textBox||dt.verticalTextBox){let yn=!0;if(G){const Rt=this.variableOffsets[Le];Rt?(It=ei(Rt.anchor,Rt.width,Rt.height,Rt.textOffset,Rt.textBoxScale),X&&It._rotate(Y?this.transform.angle:-this.transform.angle)):yn=!1}dt.textBox&&hi(l.textCollisionBox.collisionVertexArray,Ve.text.placed,!yn||ot,It.x,It.y),dt.verticalTextBox&&hi(l.textCollisionBox.collisionVertexArray,Ve.text.placed,!yn||gt,It.x,It.y)}const zt=!!(!gt&&dt.verticalIconBox);dt.iconBox&&hi(l.iconCollisionBox.collisionVertexArray,Ve.icon.placed,zt,pe?It.x:0,pe?It.y:0),dt.verticalIconBox&&hi(l.iconCollisionBox.collisionVertexArray,Ve.icon.placed,!zt,pe?It.x:0,pe?It.y:0)}}}if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.text.opacityVertexArray.length!==l.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${l.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${l.text.layoutVertexArray.length}) / 4`);if(l.icon.opacityVertexArray.length!==l.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${l.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${l.icon.layoutVertexArray.length}) / 4`);if(l.bucketInstanceId in this.collisionCircleArrays){const Me=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Me.invProjMatrix,l.placementViewportMatrix=Me.viewportMatrix,l.collisionCircleArray=Me.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,f){const g=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*g>l}setStale(){this.stale=!0}}function hi(x,l,f,g,b){x.emplaceBack(l?1:0,f?1:0,g||0,b||0),x.emplaceBack(l?1:0,f?1:0,g||0,b||0),x.emplaceBack(l?1:0,f?1:0,g||0,b||0),x.emplaceBack(l?1:0,f?1:0,g||0,b||0)}const No=Math.pow(2,25),zh=Math.pow(2,24),$d=Math.pow(2,17),rr=Math.pow(2,16),jc=Math.pow(2,9),Uc=Math.pow(2,8),Xi=Math.pow(2,1);function $i(x){if(x.opacity===0&&!x.placed)return 0;if(x.opacity===1&&x.placed)return 4294967295;const l=x.placed?1:0,f=Math.floor(127*x.opacity);return f*No+l*zh+f*$d+l*rr+f*jc+l*Uc+f*Xi+l}const Na=0;class ho{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&!l.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,f,g,b,k){const E=this._bucketParts;for(;this._currentTileIndex<l.length;)if(f.getBucketParts(E,b,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,k())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((A,B)=>A.sortKey-B.sortKey));this._currentPartIndex<E.length;)if(f.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,g),this._currentPartIndex++,k())return!0;return!1}}class fo{constructor(l,f,g,b,k,E,A,B){this.placement=new Di(l,f,E,A,B),this._currentPlacementIndex=g.length-1,this._forceFullPlacement=b,this._showCollisionBoxes=k,this._done=!1}isDone(){return this._done}continuePlacement(l,f,g){const b=_.now(),k=()=>!this._forceFullPlacement&&_.now()-b>2;for(;this._currentPlacementIndex>=0;){const E=f[l[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=A)&&(!E.maxzoom||E.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new ho(E)),this._inProgressLayer.continuePlacement(g[E.source],this.placement,this._showCollisionBoxes,E,k))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const ra=512/a.W/2;class kl{constructor(l,f,g){this.tileID=l,this.bucketInstanceId=g,this._symbolsByKey={};const b=new Map;for(let k=0;k<f.length;k++){const E=f.get(k),A=E.key,B=b.get(A);B?B.push(E):b.set(A,[E])}for(const[k,E]of b){const A={positions:E.map(B=>({x:Math.floor(B.anchorX*ra),y:Math.floor(B.anchorY*ra)})),crossTileIDs:E.map(B=>B.crossTileID)};if(A.positions.length>128){const B=new a.au(A.positions.length,16,Uint16Array);for(const{x:G,y:X}of A.positions)B.add(G,X);B.finish(),delete A.positions,A.index=B}this._symbolsByKey[k]=A}}getScaledCoordinates(l,f){const{x:g,y:b,z:k}=this.tileID.canonical,{x:E,y:A,z:B}=f.canonical,G=ra/Math.pow(2,B-k),X=(A*a.W+l.anchorY)*G,Y=b*a.W*ra;return{x:Math.floor((E*a.W+l.anchorX)*G-g*a.W*ra),y:Math.floor(X-Y)}}findMatches(l,f,g){const b=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z);for(let k=0;k<l.length;k++){const E=l.get(k);if(E.crossTileID)continue;const A=this._symbolsByKey[E.key];if(!A)continue;const B=this.getScaledCoordinates(E,f);if(A.index){const G=A.index.range(B.x-b,B.y-b,B.x+b,B.y+b).sort();for(const X of G){const Y=A.crossTileIDs[X];if(!g[Y]){g[Y]=!0,E.crossTileID=Y;break}}}else if(A.positions)for(let G=0;G<A.positions.length;G++){const X=A.positions[G],Y=A.crossTileIDs[G];if(Math.abs(X.x-B.x)<=b&&Math.abs(X.y-B.y)<=b&&!g[Y]){g[Y]=!0,E.crossTileID=Y;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:l})=>l)}}class Zr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ja{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const f=Math.round((l-this.lng)/360);if(f!==0)for(const g in this.indexes){const b=this.indexes[g],k={};for(const E in b){const A=b[E];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+f),k[A.tileID.key]=A}this.indexes[g]=k}this.lng=l}addBucket(l,f,g){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let k=0;k<f.symbolInstances.length;k++)f.symbolInstances.get(k).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const b=this.usedCrossTileIDs[l.overscaledZ];for(const k in this.indexes){const E=this.indexes[k];if(Number(k)>l.overscaledZ)for(const A in E){const B=E[A];B.tileID.isChildOf(l)&&B.findMatches(f.symbolInstances,l,b)}else{const A=E[l.scaledTo(Number(k)).key];A&&A.findMatches(f.symbolInstances,l,b)}}for(let k=0;k<f.symbolInstances.length;k++){const E=f.symbolInstances.get(k);E.crossTileID||(E.crossTileID=g.generate(),b[E.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new kl(l,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(l,f){for(const g of f.getCrossTileIDsLists())for(const b of g)delete this.usedCrossTileIDs[l][b]}removeStaleBuckets(l){let f=!1;for(const g in this.indexes){const b=this.indexes[g];for(const k in b)l[b[k].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,b[k]),delete b[k],f=!0)}return f}}class gs{constructor(){this.layerIndexes={},this.crossTileIDs=new Zr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,f,g){let b=this.layerIndexes[l.id];b===void 0&&(b=this.layerIndexes[l.id]=new ja);let k=!1;const E={};b.handleWrapJump(g);for(const A of f){const B=A.getBucket(l);B&&l.id===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(A.tileID,B,this.crossTileIDs)&&(k=!0),E[B.bucketInstanceId]=!0)}return b.removeStaleBuckets(E)&&(k=!0),k}pruneUnusedLayers(l){const f={};l.forEach(g=>{f[g]=!0});for(const g in this.layerIndexes)f[g]||delete this.layerIndexes[g]}}const Mr=(x,l)=>a.t(x,l&&l.filter(f=>f.identifier!=="source.canvas")),Sl=a.av();class Ji extends a.E{constructor(l,f={}){super(),this._rtlPluginLoaded=()=>{for(const g in this.sourceCaches){const b=this.sourceCaches[g].getSource().type;b!=="vector"&&b!=="geojson"||this.sourceCaches[g].reload()}},this.map=l,this.dispatcher=new Et($t(),l._getMapId()),this.dispatcher.registerMessageHandler("GG",(g,b)=>this.getGlyphs(g,b)),this.dispatcher.registerMessageHandler("GI",(g,b)=>this.getImages(g,b)),this.imageManager=new Pe,this.imageManager.setEventedParent(this),this.glyphManager=new Ee(l._requestManager,f.localIdeographFontFamily),this.lineAtlas=new lt(256,512),this.crossTileSymbolIndex=new gs,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.ax()),yt().on(mr,this._rtlPluginLoaded),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const b=this.sourceCaches[g.sourceId];if(!b)return;const k=b.getSource();if(k&&k.vectorLayerIds)for(const E in this._layers){const A=this._layers[E];A.source===k.id&&this._validateLayer(A)}})}loadURL(l,f={},g){this.fire(new a.k("dataloading",{dataType:"style"})),f.validate=typeof f.validate!="boolean"||f.validate;const b=this.map._requestManager.transformRequest(l,"Style");this._loadStyleRequest=new AbortController,a.h(b,this._loadStyleRequest).then(k=>{this._loadStyleRequest=null,this._load(k.data,f,g)}).catch(k=>{this._loadStyleRequest=null,k&&this.fire(new a.j(k))})}loadJSON(l,f={},g){this.fire(new a.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,_.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,f.validate=f.validate!==!1,this._load(l,f,g)}).catch(()=>{})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(Sl,{validate:!1})}_load(l,f,g){var b;const k=f.transformStyle?f.transformStyle(g,l):l;if(!f.validate||!Mr(this,a.x(k))){this._loaded=!0,this.stylesheet=k;for(const E in k.sources)this.addSource(E,k.sources[E],{validate:!1});k.sprite?this._loadSprite(k.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(k.glyphs),this._createLayers(),this.light=new rt(this.stylesheet.light),this.map.setTerrain((b=this.stylesheet.terrain)!==null&&b!==void 0?b:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const l=a.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",l),this._order=l.map(f=>f.id),this._layers={},this._serializedLayers=null;for(const f of l){const g=a.az(f);g.setEventedParent(this,{layer:{id:f.id}}),this._layers[f.id]=g}}_loadSprite(l,f=!1,g=void 0){let b;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(k,E,A,B){return a._(this,void 0,void 0,function*(){const G=Ie(k),X=A>1?"@2x":"",Y={},pe={};for(const{id:Se,url:ke}of G){const Me=E.transformRequest(E.normalizeSpriteURL(ke,X,".json"),"SpriteJSON");Y[Se]=a.h(Me,B);const ye=E.transformRequest(E.normalizeSpriteURL(ke,X,".png"),"SpriteImage");pe[Se]=F.getImage(ye,B)}return yield Promise.all([...Object.values(Y),...Object.values(pe)]),function(Se,ke){return a._(this,void 0,void 0,function*(){const Me={};for(const ye in Se){Me[ye]={};const Fe=_.getImageCanvasContext((yield ke[ye]).data),Je=(yield Se[ye]).data;for(const Le in Je){const{width:Ve,height:Qe,x:nt,y:ot,sdf:gt,pixelRatio:dt,stretchX:It,stretchY:zt,content:yn}=Je[Le];Me[ye][Le]={data:null,pixelRatio:dt,sdf:gt,stretchX:It,stretchY:zt,content:yn,spriteData:{width:Ve,height:Qe,x:nt,y:ot,context:Fe}}}}return Me})}(Y,pe)})}(l,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(k=>{if(this._spriteRequest=null,k)for(const E in k){this._spritesImagesIds[E]=[];const A=this._spritesImagesIds[E]?this._spritesImagesIds[E].filter(B=>!(B in k)):[];for(const B of A)this.imageManager.removeImage(B),this._changedImages[B]=!0;for(const B in k[E]){const G=E==="default"?B:`${E}:${B}`;this._spritesImagesIds[E].push(G),G in this.imageManager.images?this.imageManager.updateImage(G,k[E][B],!1):this.imageManager.addImage(G,k[E][B]),f&&(this._changedImages[G]=!0)}}}).catch(k=>{this._spriteRequest=null,b=k,this.fire(new a.j(b))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),f&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),g&&g(b)})}_unloadSprite(){for(const l of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(l),this._changedImages[l]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(l){const f=this.sourceCaches[l.source];if(!f)return;const g=l.sourceLayer;if(!g)return;const b=f.getSource();(b.type==="geojson"||b.vectorLayerIds&&b.vectorLayerIds.indexOf(g)===-1)&&this.fire(new a.j(new Error(`Source layer "${g}" does not exist on source "${b.id}" as specified by style layer "${l.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this.sourceCaches)if(!this.sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(l){const f=this._serializedAllLayers();if(!l||l.length===0)return Object.values(f);const g=[];for(const b of l)f[b]&&g.push(f[b]);return g}_serializedAllLayers(){let l=this._serializedLayers;if(l)return l;l=this._serializedLayers={};const f=Object.keys(this._layers);for(const g of f){const b=this._layers[g];b.type!=="custom"&&(l[g]=b.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const l in this.sourceCaches)if(this.sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(l){if(!this._loaded)return;const f=this._changed;if(f){const b=Object.keys(this._updatedLayers),k=Object.keys(this._removedLayers);(b.length||k.length)&&this._updateWorkerLayers(b,k);for(const E in this._updatedSources){const A=this._updatedSources[E];if(A==="reload")this._reloadSource(E);else{if(A!=="clear")throw new Error(`Invalid action ${A}`);this._clearSource(E)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(l);this.light.updateTransitions(l),this._resetUpdates()}const g={};for(const b in this.sourceCaches){const k=this.sourceCaches[b];g[b]=k.used,k.used=!1}for(const b of this._order){const k=this._layers[b];k.recalculate(l,this._availableImages),!k.isHidden(l.zoom)&&k.source&&(this.sourceCaches[k.source].used=!0)}for(const b in g){const k=this.sourceCaches[b];!!g[b]!=!!k.used&&k.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:b}))}this.light.recalculate(l),this.z=l.zoom,f&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const f in this.sourceCaches)this.sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(l,f){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(l),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(l,f={}){var g;this._checkLoaded();const b=this.serialize();if(l=f.transformStyle?f.transformStyle(b,l):l,((g=f.validate)===null||g===void 0||g)&&Mr(this,a.x(l)))return!1;(l=a.aA(l)).layers=a.ay(l.layers);const k=a.aB(b,l),E=this._getOperationsToPerform(k);if(E.unimplemented.length>0)throw new Error(`Unimplemented: ${E.unimplemented.join(", ")}.`);if(E.operations.length===0)return!1;for(const A of E.operations)A();return this.stylesheet=l,this._serializedLayers=null,!0}_getOperationsToPerform(l){const f=[],g=[];for(const b of l)switch(b.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":f.push(()=>this.addLayer.apply(this,b.args));break;case"removeLayer":f.push(()=>this.removeLayer.apply(this,b.args));break;case"setPaintProperty":f.push(()=>this.setPaintProperty.apply(this,b.args));break;case"setLayoutProperty":f.push(()=>this.setLayoutProperty.apply(this,b.args));break;case"setFilter":f.push(()=>this.setFilter.apply(this,b.args));break;case"addSource":f.push(()=>this.addSource.apply(this,b.args));break;case"removeSource":f.push(()=>this.removeSource.apply(this,b.args));break;case"setLayerZoomRange":f.push(()=>this.setLayerZoomRange.apply(this,b.args));break;case"setLight":f.push(()=>this.setLight.apply(this,b.args));break;case"setGeoJSONSourceData":f.push(()=>this.setGeoJSONSourceData.apply(this,b.args));break;case"setGlyphs":f.push(()=>this.setGlyphs.apply(this,b.args));break;case"setSprite":f.push(()=>this.setSprite.apply(this,b.args));break;case"setTerrain":f.push(()=>this.map.setTerrain.apply(this,b.args));break;case"setTransition":f.push(()=>{});break;default:g.push(b.command)}return{operations:f,unimplemented:g}}addImage(l,f){if(this.getImage(l))return this.fire(new a.j(new Error(`An image named "${l}" already exists.`)));this.imageManager.addImage(l,f),this._afterImageUpdated(l)}updateImage(l,f){this.imageManager.updateImage(l,f)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){if(!this.getImage(l))return this.fire(new a.j(new Error(`An image named "${l}" does not exist.`)));this.imageManager.removeImage(l),this._afterImageUpdated(l)}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(l,f,g={}){if(this._checkLoaded(),this.sourceCaches[l]!==void 0)throw new Error(`Source "${l}" already exists.`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(a.x.source,`sources.${l}`,f,null,g))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const b=this.sourceCaches[l]=new Yn(l,f,this.dispatcher);b.style=this,b.setEventedParent(this,()=>({isSourceLoaded:b.loaded(),source:b.serialize(),sourceId:l})),b.onAdd(this.map),this._changed=!0}removeSource(l){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===l)return this.fire(new a.j(new Error(`Source "${l}" cannot be removed while layer "${g}" is using it.`)));const f=this.sourceCaches[l];delete this.sourceCaches[l],delete this._updatedSources[l],f.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:l})),f.setEventedParent(null),f.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(l,f){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error(`There is no source with this ID=${l}`);const g=this.sourceCaches[l].getSource();if(g.type!=="geojson")throw new Error(`geojsonSource.type is ${g.type}, which is !== 'geojson`);g.setData(f),this._changed=!0}getSource(l){return this.sourceCaches[l]&&this.sourceCaches[l].getSource()}addLayer(l,f,g={}){this._checkLoaded();const b=l.id;if(this.getLayer(b))return void this.fire(new a.j(new Error(`Layer "${b}" already exists on this map.`)));let k;if(l.type==="custom"){if(Mr(this,a.aC(l)))return;k=a.az(l)}else{if("source"in l&&typeof l.source=="object"&&(this.addSource(b,l.source),l=a.aA(l),l=a.e(l,{source:b})),this._validate(a.x.layer,`layers.${b}`,l,{arrayIndex:-1},g))return;k=a.az(l),this._validateLayer(k),k.setEventedParent(this,{layer:{id:b}})}const E=f?this._order.indexOf(f):this._order.length;if(f&&E===-1)this.fire(new a.j(new Error(`Cannot add layer "${b}" before non-existing layer "${f}".`)));else{if(this._order.splice(E,0,b),this._layerOrderChanged=!0,this._layers[b]=k,this._removedLayers[b]&&k.source&&k.type!=="custom"){const A=this._removedLayers[b];delete this._removedLayers[b],A.type!==k.type?this._updatedSources[k.source]="clear":(this._updatedSources[k.source]="reload",this.sourceCaches[k.source].pause())}this._updateLayer(k),k.onAdd&&k.onAdd(this.map)}}moveLayer(l,f){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new a.j(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===f)return;const g=this._order.indexOf(l);this._order.splice(g,1);const b=f?this._order.indexOf(f):this._order.length;f&&b===-1?this.fire(new a.j(new Error(`Cannot move layer "${l}" before non-existing layer "${f}".`))):(this._order.splice(b,0,l),this._layerOrderChanged=!0)}removeLayer(l){this._checkLoaded();const f=this._layers[l];if(!f)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${l}".`)));f.setEventedParent(null);const g=this._order.indexOf(l);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=f,delete this._layers[l],this._serializedLayers&&delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],f.onRemove&&f.onRemove(this.map)}getLayer(l){return this._layers[l]}getLayersOrder(){return[...this._order]}hasLayer(l){return l in this._layers}setLayerZoomRange(l,f,g){this._checkLoaded();const b=this.getLayer(l);b?b.minzoom===f&&b.maxzoom===g||(f!=null&&(b.minzoom=f),g!=null&&(b.maxzoom=g),this._updateLayer(b)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${l}".`)))}setFilter(l,f,g={}){this._checkLoaded();const b=this.getLayer(l);if(b){if(!a.aD(b.filter,f))return f==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(a.x.filter,`layers.${b.id}.filter`,f,null,g)||(b.filter=a.aA(f),this._updateLayer(b)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${l}".`)))}getFilter(l){return a.aA(this.getLayer(l).filter)}setLayoutProperty(l,f,g,b={}){this._checkLoaded();const k=this.getLayer(l);k?a.aD(k.getLayoutProperty(f),g)||(k.setLayoutProperty(f,g,b),this._updateLayer(k)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${l}".`)))}getLayoutProperty(l,f){const g=this.getLayer(l);if(g)return g.getLayoutProperty(f);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${l}".`)))}setPaintProperty(l,f,g,b={}){this._checkLoaded();const k=this.getLayer(l);k?a.aD(k.getPaintProperty(f),g)||(k.setPaintProperty(f,g,b)&&this._updateLayer(k),this._changed=!0,this._updatedPaintProps[l]=!0,this._serializedLayers=null):this.fire(new a.j(new Error(`Cannot style non-existing layer "${l}".`)))}getPaintProperty(l,f){return this.getLayer(l).getPaintProperty(f)}setFeatureState(l,f){this._checkLoaded();const g=l.source,b=l.sourceLayer,k=this.sourceCaches[g];if(k===void 0)return void this.fire(new a.j(new Error(`The source '${g}' does not exist in the map's style.`)));const E=k.getSource().type;E==="geojson"&&b?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||b?(l.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),k.setFeatureState(b,l.id,f)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(l,f){this._checkLoaded();const g=l.source,b=this.sourceCaches[g];if(b===void 0)return void this.fire(new a.j(new Error(`The source '${g}' does not exist in the map's style.`)));const k=b.getSource().type,E=k==="vector"?l.sourceLayer:void 0;k!=="vector"||E?f&&typeof l.id!="string"&&typeof l.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):b.removeFeatureState(E,l.id,f):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(l){this._checkLoaded();const f=l.source,g=l.sourceLayer,b=this.sourceCaches[f];if(b!==void 0)return b.getSource().type!=="vector"||g?(l.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),b.getFeatureState(g,l.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const l=a.aE(this.sourceCaches,k=>k.serialize()),f=this._serializeByIds(this._order),g=this.map.getTerrain()||void 0,b=this.stylesheet;return a.aF({version:b.version,name:b.name,metadata:b.metadata,light:b.light,center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch,sprite:b.sprite,glyphs:b.glyphs,transition:b.transition,sources:l,layers:f,terrain:g},k=>k!==void 0)}_updateLayer(l){this._updatedLayers[l.id]=!0,l.source&&!this._updatedSources[l.source]&&this.sourceCaches[l.source].getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",this.sourceCaches[l.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(l){const f=E=>this._layers[E].type==="fill-extrusion",g={},b=[];for(let E=this._order.length-1;E>=0;E--){const A=this._order[E];if(f(A)){g[A]=E;for(const B of l){const G=B[A];if(G)for(const X of G)b.push(X)}}}b.sort((E,A)=>A.intersectionZ-E.intersectionZ);const k=[];for(let E=this._order.length-1;E>=0;E--){const A=this._order[E];if(f(A))for(let B=b.length-1;B>=0;B--){const G=b[B].feature;if(g[G.layer.id]<E)break;k.push(G),b.pop()}else for(const B of l){const G=B[A];if(G)for(const X of G)k.push(X.feature)}}return k}queryRenderedFeatures(l,f,g){f&&f.filter&&this._validate(a.x.filter,"queryRenderedFeatures.filter",f.filter,null,f);const b={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const A of f.layers){const B=this._layers[A];if(!B)return this.fire(new a.j(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];b[B.source]=!0}}const k=[];f.availableImages=this._availableImages;const E=this._serializedAllLayers();for(const A in this.sourceCaches)f.layers&&!b[A]||k.push(Zt(this.sourceCaches[A],this._layers,E,l,f,g));return this.placement&&k.push(function(A,B,G,X,Y,pe,Se){const ke={},Me=pe.queryRenderedSymbols(X),ye=[];for(const Fe of Object.keys(Me).map(Number))ye.push(Se[Fe]);ye.sort(ln);for(const Fe of ye){const Je=Fe.featureIndex.lookupSymbolFeatures(Me[Fe.bucketInstanceId],B,Fe.bucketIndex,Fe.sourceLayerIndex,Y.filter,Y.layers,Y.availableImages,A);for(const Le in Je){const Ve=ke[Le]=ke[Le]||[],Qe=Je[Le];Qe.sort((nt,ot)=>{const gt=Fe.featureSortOrder;if(gt){const dt=gt.indexOf(nt.featureIndex);return gt.indexOf(ot.featureIndex)-dt}return ot.featureIndex-nt.featureIndex});for(const nt of Qe)Ve.push(nt)}}for(const Fe in ke)ke[Fe].forEach(Je=>{const Le=Je.feature,Ve=G[A[Fe].source].getFeatureState(Le.layer["source-layer"],Le.id);Le.source=Le.layer.source,Le.layer["source-layer"]&&(Le.sourceLayer=Le.layer["source-layer"]),Le.state=Ve});return ke}(this._layers,E,this.sourceCaches,l,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(k)}querySourceFeatures(l,f){f&&f.filter&&this._validate(a.x.filter,"querySourceFeatures.filter",f.filter,null,f);const g=this.sourceCaches[l];return g?function(b,k){const E=b.getRenderableIds().map(G=>b.getTileByID(G)),A=[],B={};for(let G=0;G<E.length;G++){const X=E[G],Y=X.tileID.canonical.key;B[Y]||(B[Y]=!0,X.querySourceFeatures(A,k))}return A}(g,f):[]}getLight(){return this.light.getLight()}setLight(l,f={}){this._checkLoaded();const g=this.light.getLight();let b=!1;for(const E in l)if(!a.aD(l[E],g[E])){b=!0;break}if(!b)return;const k={now:_.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,f),this.light.updateTransitions(k)}_validate(l,f,g,b,k={}){return(!k||k.validate!==!1)&&Mr(this,l.call(a.x,a.e({key:f,style:this.serialize(),value:g,styleSpec:a.v},b)))}_remove(l=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),yt().off(mr,this._rtlPluginLoaded);for(const f in this._layers)this._layers[f].setEventedParent(null);for(const f in this.sourceCaches){const g=this.sourceCaches[f];g.setEventedParent(null),g.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),l&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(l)}_clearSource(l){this.sourceCaches[l].clearTiles()}_reloadSource(l){this.sourceCaches[l].resume(),this.sourceCaches[l].reload()}_updateSources(l){for(const f in this.sourceCaches)this.sourceCaches[f].update(l,this.map.terrain)}_generateCollisionBoxes(){for(const l in this.sourceCaches)this._reloadSource(l)}_updatePlacement(l,f,g,b,k=!1){let E=!1,A=!1;const B={};for(const G of this._order){const X=this._layers[G];if(X.type!=="symbol")continue;if(!B[X.source]){const pe=this.sourceCaches[X.source];B[X.source]=pe.getRenderableIds(!0).map(Se=>pe.getTileByID(Se)).sort((Se,ke)=>ke.tileID.overscaledZ-Se.tileID.overscaledZ||(Se.tileID.isLessThan(ke.tileID)?-1:1))}const Y=this.crossTileSymbolIndex.addLayer(X,B[X.source],l.center.lng);E=E||Y}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((k=k||this._layerOrderChanged||g===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(_.now(),l.zoom))&&(this.pauseablePlacement=new fo(l,this.map.terrain,this._order,k,f,g,b,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,B),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(_.now()),A=!0),E&&this.pauseablePlacement.placement.setStale()),A||E)for(const G of this._order){const X=this._layers[G];X.type==="symbol"&&this.placement.updateLayerOpacities(X,B[X.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(_.now())}_releaseSymbolFadeTiles(){for(const l in this.sourceCaches)this.sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,f){return a._(this,void 0,void 0,function*(){const g=yield this.imageManager.getImages(f.icons);this._updateTilesForChangedImages();const b=this.sourceCaches[f.source];return b&&b.setDependencies(f.tileID.key,f.type,f.icons),g})}getGlyphs(l,f){return a._(this,void 0,void 0,function*(){const g=yield this.glyphManager.getGlyphs(f.stacks),b=this.sourceCaches[f.source];return b&&b.setDependencies(f.tileID.key,f.type,[""]),g})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(l,f={}){this._checkLoaded(),l&&this._validate(a.x.glyphs,"glyphs",l,null,f)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=l,this.glyphManager.entries={},this.glyphManager.setURL(l))}addSprite(l,f,g={},b){this._checkLoaded();const k=[{id:l,url:f}],E=[...Ie(this.stylesheet.sprite),...k];this._validate(a.x.sprite,"sprite",E,null,g)||(this.stylesheet.sprite=E,this._loadSprite(k,!0,b))}removeSprite(l){this._checkLoaded();const f=Ie(this.stylesheet.sprite);if(f.find(g=>g.id===l)){if(this._spritesImagesIds[l])for(const g of this._spritesImagesIds[l])this.imageManager.removeImage(g),this._changedImages[g]=!0;f.splice(f.findIndex(g=>g.id===l),1),this.stylesheet.sprite=f.length>0?f:void 0,delete this._spritesImagesIds[l],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${l}" doesn't exists on this map.`)))}getSprite(){return Ie(this.stylesheet.sprite)}setSprite(l,f={},g){this._checkLoaded(),l&&this._validate(a.x.sprite,"sprite",l,null,f)||(this.stylesheet.sprite=l,l?this._loadSprite(l,!0,g):(this._unloadSprite(),g&&g(null)))}}var Cl=a.X([{name:"a_pos",type:"Int16",components:2}]),jo="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Ua={prelude:ir(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:ir(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ir(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ir(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ir("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ir(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:ir(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ir("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ir("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ir("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ir(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:ir(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:ir(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:ir(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ir(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ir(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ir(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ir(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ir(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ir(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ir(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ir(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ir(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ir(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ir(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ir(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ir("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",jo),terrainDepth:ir("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",jo),terrainCoords:ir("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",jo)};function ir(x,l){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=l.match(/attribute ([\w]+) ([\w]+)/g),b=x.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),k=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=k?k.concat(b):b,A={};return{fragmentSource:x=x.replace(f,(B,G,X,Y,pe)=>(A[pe]=!0,G==="define"?`
#ifndef HAS_UNIFORM_u_${pe}
varying ${X} ${Y} ${pe};
#else
uniform ${X} ${Y} u_${pe};
#endif
`:`
#ifdef HAS_UNIFORM_u_${pe}
    ${X} ${Y} ${pe} = u_${pe};
#endif
`)),vertexSource:l=l.replace(f,(B,G,X,Y,pe)=>{const Se=Y==="float"?"vec2":"vec4",ke=pe.match(/color/)?"color":Se;return A[pe]?G==="define"?`
#ifndef HAS_UNIFORM_u_${pe}
uniform lowp float u_${pe}_t;
attribute ${X} ${Se} a_${pe};
varying ${X} ${Y} ${pe};
#else
uniform ${X} ${Y} u_${pe};
#endif
`:ke==="vec4"?`
#ifndef HAS_UNIFORM_u_${pe}
    ${pe} = a_${pe};
#else
    ${X} ${Y} ${pe} = u_${pe};
#endif
`:`
#ifndef HAS_UNIFORM_u_${pe}
    ${pe} = unpack_mix_${ke}(a_${pe}, u_${pe}_t);
#else
    ${X} ${Y} ${pe} = u_${pe};
#endif
`:G==="define"?`
#ifndef HAS_UNIFORM_u_${pe}
uniform lowp float u_${pe}_t;
attribute ${X} ${Se} a_${pe};
#else
uniform ${X} ${Y} u_${pe};
#endif
`:ke==="vec4"?`
#ifndef HAS_UNIFORM_u_${pe}
    ${X} ${Y} ${pe} = a_${pe};
#else
    ${X} ${Y} ${pe} = u_${pe};
#endif
`:`
#ifndef HAS_UNIFORM_u_${pe}
    ${X} ${Y} ${pe} = unpack_mix_${ke}(a_${pe}, u_${pe}_t);
#else
    ${X} ${Y} ${pe} = u_${pe};
#endif
`}),staticAttributes:g,staticUniforms:E}}class Tl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(l,f,g,b,k,E,A,B,G){this.context=l;let X=this.boundPaintVertexBuffers.length!==b.length;for(let Y=0;!X&&Y<b.length;Y++)this.boundPaintVertexBuffers[Y]!==b[Y]&&(X=!0);!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==g||X||this.boundIndexBuffer!==k||this.boundVertexOffset!==E||this.boundDynamicVertexBuffer!==A||this.boundDynamicVertexBuffer2!==B||this.boundDynamicVertexBuffer3!==G?this.freshBind(f,g,b,k,E,A,B,G):(l.bindVertexArray.set(this.vao),A&&A.bind(),k&&k.dynamicDraw&&k.bind(),B&&B.bind(),G&&G.bind())}freshBind(l,f,g,b,k,E,A,B){const G=l.numAttributes,X=this.context,Y=X.gl;this.vao&&this.destroy(),this.vao=X.createVertexArray(),X.bindVertexArray.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=b,this.boundVertexOffset=k,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=A,this.boundDynamicVertexBuffer3=B,f.enableAttributes(Y,l);for(const pe of g)pe.enableAttributes(Y,l);E&&E.enableAttributes(Y,l),A&&A.enableAttributes(Y,l),B&&B.enableAttributes(Y,l),f.bind(),f.setVertexAttribPointers(Y,l,k);for(const pe of g)pe.bind(),pe.setVertexAttribPointers(Y,l,k);E&&(E.bind(),E.setVertexAttribPointers(Y,l,k)),b&&b.bind(),A&&(A.bind(),A.setVertexAttribPointers(Y,l,k)),B&&(B.bind(),B.setVertexAttribPointers(Y,l,k)),X.currentNumAttributes=G}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ia(x){const l=[];for(let f=0;f<x.length;f++){if(x[f]===null)continue;const g=x[f].split(" ");l.push(g.pop())}return l}class _s{constructor(l,f,g,b,k,E){const A=l.gl;this.program=A.createProgram();const B=ia(f.staticAttributes),G=g?g.getBinderAttributes():[],X=B.concat(G),Y=Ua.prelude.staticUniforms?ia(Ua.prelude.staticUniforms):[],pe=f.staticUniforms?ia(f.staticUniforms):[],Se=g?g.getBinderUniforms():[],ke=Y.concat(pe).concat(Se),Me=[];for(const nt of ke)Me.indexOf(nt)<0&&Me.push(nt);const ye=g?g.defines():[];k&&ye.push("#define OVERDRAW_INSPECTOR;"),E&&ye.push("#define TERRAIN3D;");const Fe=ye.concat(Ua.prelude.fragmentSource,f.fragmentSource).join(`
`),Je=ye.concat(Ua.prelude.vertexSource,f.vertexSource).join(`
`),Le=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);if(A.shaderSource(Le,Fe),A.compileShader(Le),!A.getShaderParameter(Le,A.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${A.getShaderInfoLog(Le)}`);A.attachShader(this.program,Le);const Ve=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);if(A.shaderSource(Ve,Je),A.compileShader(Ve),!A.getShaderParameter(Ve,A.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${A.getShaderInfoLog(Ve)}`);A.attachShader(this.program,Ve),this.attributes={};const Qe={};this.numAttributes=X.length;for(let nt=0;nt<this.numAttributes;nt++)X[nt]&&(A.bindAttribLocation(this.program,nt,X[nt]),this.attributes[X[nt]]=nt);if(A.linkProgram(this.program),!A.getProgramParameter(this.program,A.LINK_STATUS))throw new Error(`Program failed to link: ${A.getProgramInfoLog(this.program)}`);A.deleteShader(Ve),A.deleteShader(Le);for(let nt=0;nt<Me.length;nt++){const ot=Me[nt];if(ot&&!Qe[ot]){const gt=A.getUniformLocation(this.program,ot);gt&&(Qe[ot]=gt)}}this.fixedUniforms=b(l,Qe),this.terrainUniforms=((nt,ot)=>({u_depth:new a.aG(nt,ot.u_depth),u_terrain:new a.aG(nt,ot.u_terrain),u_terrain_dim:new a.aH(nt,ot.u_terrain_dim),u_terrain_matrix:new a.aI(nt,ot.u_terrain_matrix),u_terrain_unpack:new a.aJ(nt,ot.u_terrain_unpack),u_terrain_exaggeration:new a.aH(nt,ot.u_terrain_exaggeration)}))(l,Qe),this.binderUniforms=g?g.getUniforms(l,Qe):[]}draw(l,f,g,b,k,E,A,B,G,X,Y,pe,Se,ke,Me,ye,Fe,Je){const Le=l.gl;if(this.failedToCreate)return;if(l.program.set(this.program),l.setDepthMode(g),l.setStencilMode(b),l.setColorMode(k),l.setCullFace(E),B){l.activeTexture.set(Le.TEXTURE2),Le.bindTexture(Le.TEXTURE_2D,B.depthTexture),l.activeTexture.set(Le.TEXTURE3),Le.bindTexture(Le.TEXTURE_2D,B.texture);for(const Qe in this.terrainUniforms)this.terrainUniforms[Qe].set(B[Qe])}for(const Qe in this.fixedUniforms)this.fixedUniforms[Qe].set(A[Qe]);Me&&Me.setUniforms(l,this.binderUniforms,Se,{zoom:ke});let Ve=0;switch(f){case Le.LINES:Ve=2;break;case Le.TRIANGLES:Ve=3;break;case Le.LINE_STRIP:Ve=1}for(const Qe of pe.get()){const nt=Qe.vaos||(Qe.vaos={});(nt[G]||(nt[G]=new Tl)).bind(l,this,X,Me?Me.getPaintVertexBuffers():[],Y,Qe.vertexOffset,ye,Fe,Je),Le.drawElements(f,Qe.primitiveLength*Ve,Le.UNSIGNED_SHORT,Qe.primitiveOffset*Ve*2)}}}function Ml(x,l,f){const g=1/fn(f,1,l.transform.tileZoom),b=Math.pow(2,f.tileID.overscaledZ),k=f.tileSize*Math.pow(2,l.transform.tileZoom)/b,E=k*(f.tileID.canonical.x+f.tileID.wrap*b),A=k*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[g,x.fromScale,x.toScale],u_fade:x.t,u_pixel_coord_upper:[E>>16,A>>16],u_pixel_coord_lower:[65535&E,65535&A]}}const Va=(x,l,f,g)=>{const b=l.style.light,k=b.properties.get("position"),E=[k.x,k.y,k.z],A=function(){var G=new a.A(9);return a.A!=Float32Array&&(G[1]=0,G[2]=0,G[3]=0,G[5]=0,G[6]=0,G[7]=0),G[0]=1,G[4]=1,G[8]=1,G}();b.properties.get("anchor")==="viewport"&&function(G,X){var Y=Math.sin(X),pe=Math.cos(X);G[0]=pe,G[1]=Y,G[2]=0,G[3]=-Y,G[4]=pe,G[5]=0,G[6]=0,G[7]=0,G[8]=1}(A,-l.transform.angle),function(G,X,Y){var pe=X[0],Se=X[1],ke=X[2];G[0]=pe*Y[0]+Se*Y[3]+ke*Y[6],G[1]=pe*Y[1]+Se*Y[4]+ke*Y[7],G[2]=pe*Y[2]+Se*Y[5]+ke*Y[8]}(E,E,A);const B=b.properties.get("color");return{u_matrix:x,u_lightpos:E,u_lightintensity:b.properties.get("intensity"),u_lightcolor:[B.r,B.g,B.b],u_vertical_gradient:+f,u_opacity:g}},Rd=(x,l,f,g,b,k,E)=>a.e(Va(x,l,f,g),Ml(k,l,E),{u_height_factor:-Math.pow(2,b.overscaledZ)/E.tileSize/8}),Dh=x=>({u_matrix:x}),Ll=(x,l,f,g)=>a.e(Dh(x),Ml(f,l,g)),Fd=(x,l)=>({u_matrix:x,u_world:l}),$h=(x,l,f,g,b)=>a.e(Ll(x,l,f,g),{u_world:b}),Bd=(x,l,f,g)=>{const b=x.transform;let k,E;if(g.paint.get("circle-pitch-alignment")==="map"){const A=fn(f,1,b.zoom);k=!0,E=[A,A]}else k=!1,E=b.pixelsToGLUnits;return{u_camera_to_center_distance:b.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_matrix:x.translatePosMatrix(l.posMatrix,f,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_pitch_with_map:+k,u_device_pixel_ratio:x.pixelRatio,u_extrude_scale:E}},Rh=(x,l,f)=>{const g=fn(f,1,l.zoom),b=Math.pow(2,l.zoom-f.tileID.overscaledZ),k=f.tileID.overscaleFactor();return{u_matrix:x,u_camera_to_center_distance:l.cameraToCenterDistance,u_pixels_to_tile_units:g,u_extrude_scale:[l.pixelsToGLUnits[0]/(g*b),l.pixelsToGLUnits[1]/(g*b)],u_overscale_factor:k}},Fh=(x,l,f=1)=>({u_matrix:x,u_color:l,u_overlay:0,u_overlay_scale:f}),El=x=>({u_matrix:x}),Bh=(x,l,f,g)=>({u_matrix:x,u_extrude_scale:fn(l,1,f),u_intensity:g});function Oh(x,l){const f=Math.pow(2,l.canonical.z),g=l.canonical.y;return[new a.Y(0,g/f).toLngLat().lat,new a.Y(0,(g+1)/f).toLngLat().lat]}const Il=(x,l,f,g)=>{const b=x.transform;return{u_matrix:qa(x,l,f,g),u_ratio:1/fn(l,1,b.zoom),u_device_pixel_ratio:x.pixelRatio,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Nh=(x,l,f,g,b)=>a.e(Il(x,l,f,b),{u_image:0,u_image_height:g}),Es=(x,l,f,g,b)=>{const k=x.transform,E=Yi(l,k);return{u_matrix:qa(x,l,f,b),u_texsize:l.imageAtlasTexture.size,u_ratio:1/fn(l,1,k.zoom),u_device_pixel_ratio:x.pixelRatio,u_image:0,u_scale:[E,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]]}},Al=(x,l,f,g,b,k)=>{const E=x.lineAtlas,A=Yi(l,x.transform),B=f.layout.get("line-cap")==="round",G=E.getDash(g.from,B),X=E.getDash(g.to,B),Y=G.width*b.fromScale,pe=X.width*b.toScale;return a.e(Il(x,l,f,k),{u_patternscale_a:[A/Y,-G.height/2],u_patternscale_b:[A/pe,-X.height/2],u_sdfgamma:E.width/(256*Math.min(Y,pe)*x.pixelRatio)/2,u_image:0,u_tex_y_a:G.y,u_tex_y_b:X.y,u_mix:b.t})};function Yi(x,l){return 1/fn(x,1,l.tileZoom)}function qa(x,l,f,g){return x.translatePosMatrix(g?g.posMatrix:l.tileID.posMatrix,l,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}const Pl=(x,l,f,g,b)=>{return{u_matrix:x,u_tl_parent:l,u_scale_parent:f,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(E=b.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(k=b.paint.get("raster-contrast"),k>0?1/(1-k):1+k),u_spin_weights:Za(b.paint.get("raster-hue-rotate"))};var k,E};function Za(x){x*=Math.PI/180;const l=Math.sin(x),f=Math.cos(x);return[(2*f+1)/3,(-Math.sqrt(3)*l-f+1)/3,(Math.sqrt(3)*l-f+1)/3]}const Ga=(x,l,f,g,b,k,E,A,B,G)=>{const X=b.transform;return{u_is_size_zoom_constant:+(x==="constant"||x==="source"),u_is_size_feature_constant:+(x==="constant"||x==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:X.cameraToCenterDistance,u_pitch:X.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:X.width/X.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:k,u_label_plane_matrix:E,u_coord_matrix:A,u_is_text:+B,u_pitch_with_map:+g,u_texsize:G,u_texture:0}},Ha=(x,l,f,g,b,k,E,A,B,G,X)=>{const Y=b.transform;return a.e(Ga(x,l,f,g,b,k,E,A,B,G),{u_gamma_scale:g?Math.cos(Y._pitch)*Y.cameraToCenterDistance:1,u_device_pixel_ratio:b.pixelRatio,u_is_halo:+X})},Wa=(x,l,f,g,b,k,E,A,B,G)=>a.e(Ha(x,l,f,g,b,k,E,A,!0,B,!0),{u_texsize_icon:G,u_texture_icon:1}),Od=(x,l,f)=>({u_matrix:x,u_opacity:l,u_color:f}),Nd=(x,l,f,g,b,k)=>a.e(function(E,A,B,G){const X=B.imageManager.getPattern(E.from.toString()),Y=B.imageManager.getPattern(E.to.toString()),{width:pe,height:Se}=B.imageManager.getPixelSize(),ke=Math.pow(2,G.tileID.overscaledZ),Me=G.tileSize*Math.pow(2,B.transform.tileZoom)/ke,ye=Me*(G.tileID.canonical.x+G.tileID.wrap*ke),Fe=Me*G.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:X.tl,u_pattern_br_a:X.br,u_pattern_tl_b:Y.tl,u_pattern_br_b:Y.br,u_texsize:[pe,Se],u_mix:A.t,u_pattern_size_a:X.displaySize,u_pattern_size_b:Y.displaySize,u_scale_a:A.fromScale,u_scale_b:A.toScale,u_tile_units_to_pixels:1/fn(G,1,B.transform.tileZoom),u_pixel_coord_upper:[ye>>16,Fe>>16],u_pixel_coord_lower:[65535&ye,65535&Fe]}}(g,k,f,b),{u_matrix:x,u_opacity:l}),jh={fillExtrusion:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_lightpos:new a.aK(x,l.u_lightpos),u_lightintensity:new a.aH(x,l.u_lightintensity),u_lightcolor:new a.aK(x,l.u_lightcolor),u_vertical_gradient:new a.aH(x,l.u_vertical_gradient),u_opacity:new a.aH(x,l.u_opacity)}),fillExtrusionPattern:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_lightpos:new a.aK(x,l.u_lightpos),u_lightintensity:new a.aH(x,l.u_lightintensity),u_lightcolor:new a.aK(x,l.u_lightcolor),u_vertical_gradient:new a.aH(x,l.u_vertical_gradient),u_height_factor:new a.aH(x,l.u_height_factor),u_image:new a.aG(x,l.u_image),u_texsize:new a.aL(x,l.u_texsize),u_pixel_coord_upper:new a.aL(x,l.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(x,l.u_pixel_coord_lower),u_scale:new a.aK(x,l.u_scale),u_fade:new a.aH(x,l.u_fade),u_opacity:new a.aH(x,l.u_opacity)}),fill:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix)}),fillPattern:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_image:new a.aG(x,l.u_image),u_texsize:new a.aL(x,l.u_texsize),u_pixel_coord_upper:new a.aL(x,l.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(x,l.u_pixel_coord_lower),u_scale:new a.aK(x,l.u_scale),u_fade:new a.aH(x,l.u_fade)}),fillOutline:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_world:new a.aL(x,l.u_world)}),fillOutlinePattern:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_world:new a.aL(x,l.u_world),u_image:new a.aG(x,l.u_image),u_texsize:new a.aL(x,l.u_texsize),u_pixel_coord_upper:new a.aL(x,l.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(x,l.u_pixel_coord_lower),u_scale:new a.aK(x,l.u_scale),u_fade:new a.aH(x,l.u_fade)}),circle:(x,l)=>({u_camera_to_center_distance:new a.aH(x,l.u_camera_to_center_distance),u_scale_with_map:new a.aG(x,l.u_scale_with_map),u_pitch_with_map:new a.aG(x,l.u_pitch_with_map),u_extrude_scale:new a.aL(x,l.u_extrude_scale),u_device_pixel_ratio:new a.aH(x,l.u_device_pixel_ratio),u_matrix:new a.aI(x,l.u_matrix)}),collisionBox:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_camera_to_center_distance:new a.aH(x,l.u_camera_to_center_distance),u_pixels_to_tile_units:new a.aH(x,l.u_pixels_to_tile_units),u_extrude_scale:new a.aL(x,l.u_extrude_scale),u_overscale_factor:new a.aH(x,l.u_overscale_factor)}),collisionCircle:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_inv_matrix:new a.aI(x,l.u_inv_matrix),u_camera_to_center_distance:new a.aH(x,l.u_camera_to_center_distance),u_viewport_size:new a.aL(x,l.u_viewport_size)}),debug:(x,l)=>({u_color:new a.aM(x,l.u_color),u_matrix:new a.aI(x,l.u_matrix),u_overlay:new a.aG(x,l.u_overlay),u_overlay_scale:new a.aH(x,l.u_overlay_scale)}),clippingMask:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix)}),heatmap:(x,l)=>({u_extrude_scale:new a.aH(x,l.u_extrude_scale),u_intensity:new a.aH(x,l.u_intensity),u_matrix:new a.aI(x,l.u_matrix)}),heatmapTexture:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_world:new a.aL(x,l.u_world),u_image:new a.aG(x,l.u_image),u_color_ramp:new a.aG(x,l.u_color_ramp),u_opacity:new a.aH(x,l.u_opacity)}),hillshade:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_image:new a.aG(x,l.u_image),u_latrange:new a.aL(x,l.u_latrange),u_light:new a.aL(x,l.u_light),u_shadow:new a.aM(x,l.u_shadow),u_highlight:new a.aM(x,l.u_highlight),u_accent:new a.aM(x,l.u_accent)}),hillshadePrepare:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_image:new a.aG(x,l.u_image),u_dimension:new a.aL(x,l.u_dimension),u_zoom:new a.aH(x,l.u_zoom),u_unpack:new a.aJ(x,l.u_unpack)}),line:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_ratio:new a.aH(x,l.u_ratio),u_device_pixel_ratio:new a.aH(x,l.u_device_pixel_ratio),u_units_to_pixels:new a.aL(x,l.u_units_to_pixels)}),lineGradient:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_ratio:new a.aH(x,l.u_ratio),u_device_pixel_ratio:new a.aH(x,l.u_device_pixel_ratio),u_units_to_pixels:new a.aL(x,l.u_units_to_pixels),u_image:new a.aG(x,l.u_image),u_image_height:new a.aH(x,l.u_image_height)}),linePattern:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_texsize:new a.aL(x,l.u_texsize),u_ratio:new a.aH(x,l.u_ratio),u_device_pixel_ratio:new a.aH(x,l.u_device_pixel_ratio),u_image:new a.aG(x,l.u_image),u_units_to_pixels:new a.aL(x,l.u_units_to_pixels),u_scale:new a.aK(x,l.u_scale),u_fade:new a.aH(x,l.u_fade)}),lineSDF:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_ratio:new a.aH(x,l.u_ratio),u_device_pixel_ratio:new a.aH(x,l.u_device_pixel_ratio),u_units_to_pixels:new a.aL(x,l.u_units_to_pixels),u_patternscale_a:new a.aL(x,l.u_patternscale_a),u_patternscale_b:new a.aL(x,l.u_patternscale_b),u_sdfgamma:new a.aH(x,l.u_sdfgamma),u_image:new a.aG(x,l.u_image),u_tex_y_a:new a.aH(x,l.u_tex_y_a),u_tex_y_b:new a.aH(x,l.u_tex_y_b),u_mix:new a.aH(x,l.u_mix)}),raster:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_tl_parent:new a.aL(x,l.u_tl_parent),u_scale_parent:new a.aH(x,l.u_scale_parent),u_buffer_scale:new a.aH(x,l.u_buffer_scale),u_fade_t:new a.aH(x,l.u_fade_t),u_opacity:new a.aH(x,l.u_opacity),u_image0:new a.aG(x,l.u_image0),u_image1:new a.aG(x,l.u_image1),u_brightness_low:new a.aH(x,l.u_brightness_low),u_brightness_high:new a.aH(x,l.u_brightness_high),u_saturation_factor:new a.aH(x,l.u_saturation_factor),u_contrast_factor:new a.aH(x,l.u_contrast_factor),u_spin_weights:new a.aK(x,l.u_spin_weights)}),symbolIcon:(x,l)=>({u_is_size_zoom_constant:new a.aG(x,l.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(x,l.u_is_size_feature_constant),u_size_t:new a.aH(x,l.u_size_t),u_size:new a.aH(x,l.u_size),u_camera_to_center_distance:new a.aH(x,l.u_camera_to_center_distance),u_pitch:new a.aH(x,l.u_pitch),u_rotate_symbol:new a.aG(x,l.u_rotate_symbol),u_aspect_ratio:new a.aH(x,l.u_aspect_ratio),u_fade_change:new a.aH(x,l.u_fade_change),u_matrix:new a.aI(x,l.u_matrix),u_label_plane_matrix:new a.aI(x,l.u_label_plane_matrix),u_coord_matrix:new a.aI(x,l.u_coord_matrix),u_is_text:new a.aG(x,l.u_is_text),u_pitch_with_map:new a.aG(x,l.u_pitch_with_map),u_texsize:new a.aL(x,l.u_texsize),u_texture:new a.aG(x,l.u_texture)}),symbolSDF:(x,l)=>({u_is_size_zoom_constant:new a.aG(x,l.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(x,l.u_is_size_feature_constant),u_size_t:new a.aH(x,l.u_size_t),u_size:new a.aH(x,l.u_size),u_camera_to_center_distance:new a.aH(x,l.u_camera_to_center_distance),u_pitch:new a.aH(x,l.u_pitch),u_rotate_symbol:new a.aG(x,l.u_rotate_symbol),u_aspect_ratio:new a.aH(x,l.u_aspect_ratio),u_fade_change:new a.aH(x,l.u_fade_change),u_matrix:new a.aI(x,l.u_matrix),u_label_plane_matrix:new a.aI(x,l.u_label_plane_matrix),u_coord_matrix:new a.aI(x,l.u_coord_matrix),u_is_text:new a.aG(x,l.u_is_text),u_pitch_with_map:new a.aG(x,l.u_pitch_with_map),u_texsize:new a.aL(x,l.u_texsize),u_texture:new a.aG(x,l.u_texture),u_gamma_scale:new a.aH(x,l.u_gamma_scale),u_device_pixel_ratio:new a.aH(x,l.u_device_pixel_ratio),u_is_halo:new a.aG(x,l.u_is_halo)}),symbolTextAndIcon:(x,l)=>({u_is_size_zoom_constant:new a.aG(x,l.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(x,l.u_is_size_feature_constant),u_size_t:new a.aH(x,l.u_size_t),u_size:new a.aH(x,l.u_size),u_camera_to_center_distance:new a.aH(x,l.u_camera_to_center_distance),u_pitch:new a.aH(x,l.u_pitch),u_rotate_symbol:new a.aG(x,l.u_rotate_symbol),u_aspect_ratio:new a.aH(x,l.u_aspect_ratio),u_fade_change:new a.aH(x,l.u_fade_change),u_matrix:new a.aI(x,l.u_matrix),u_label_plane_matrix:new a.aI(x,l.u_label_plane_matrix),u_coord_matrix:new a.aI(x,l.u_coord_matrix),u_is_text:new a.aG(x,l.u_is_text),u_pitch_with_map:new a.aG(x,l.u_pitch_with_map),u_texsize:new a.aL(x,l.u_texsize),u_texsize_icon:new a.aL(x,l.u_texsize_icon),u_texture:new a.aG(x,l.u_texture),u_texture_icon:new a.aG(x,l.u_texture_icon),u_gamma_scale:new a.aH(x,l.u_gamma_scale),u_device_pixel_ratio:new a.aH(x,l.u_device_pixel_ratio),u_is_halo:new a.aG(x,l.u_is_halo)}),background:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_opacity:new a.aH(x,l.u_opacity),u_color:new a.aM(x,l.u_color)}),backgroundPattern:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_opacity:new a.aH(x,l.u_opacity),u_image:new a.aG(x,l.u_image),u_pattern_tl_a:new a.aL(x,l.u_pattern_tl_a),u_pattern_br_a:new a.aL(x,l.u_pattern_br_a),u_pattern_tl_b:new a.aL(x,l.u_pattern_tl_b),u_pattern_br_b:new a.aL(x,l.u_pattern_br_b),u_texsize:new a.aL(x,l.u_texsize),u_mix:new a.aH(x,l.u_mix),u_pattern_size_a:new a.aL(x,l.u_pattern_size_a),u_pattern_size_b:new a.aL(x,l.u_pattern_size_b),u_scale_a:new a.aH(x,l.u_scale_a),u_scale_b:new a.aH(x,l.u_scale_b),u_pixel_coord_upper:new a.aL(x,l.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(x,l.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aH(x,l.u_tile_units_to_pixels)}),terrain:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_texture:new a.aG(x,l.u_texture),u_ele_delta:new a.aH(x,l.u_ele_delta)}),terrainDepth:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_ele_delta:new a.aH(x,l.u_ele_delta)}),terrainCoords:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_texture:new a.aG(x,l.u_texture),u_terrain_coords_id:new a.aH(x,l.u_terrain_coords_id),u_ele_delta:new a.aH(x,l.u_ele_delta)})};class jd{constructor(l,f,g){this.context=l;const b=l.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const f=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Is={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class zl{constructor(l,f,g,b){this.length=f.length,this.attributes=g,this.itemSize=f.bytesPerElement,this.dynamicDraw=b,this.context=l;const k=l.gl;this.buffer=k.createBuffer(),l.bindVertexBuffer.set(this.buffer),k.bufferData(k.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){if(l.length!==this.length)throw new Error(`Length of new data is ${l.length}, which doesn't match current length of ${this.length}`);const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,f){for(let g=0;g<this.attributes.length;g++){const b=f.attributes[this.attributes[g].name];b!==void 0&&l.enableVertexAttribArray(b)}}setVertexAttribPointers(l,f,g){for(let b=0;b<this.attributes.length;b++){const k=this.attributes[b],E=f.attributes[k.name];E!==void 0&&l.vertexAttribPointer(E,k.components,l[Is[k.type]],!1,this.itemSize,k.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Mi=new WeakMap;function vi(x){var l;if(Mi.has(x))return Mi.get(x);{const f=(l=x.getParameter(x.VERSION))===null||l===void 0?void 0:l.startsWith("WebGL 2.0");return Mi.set(x,f),f}}class Zn{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Dl extends Zn{getDefault(){return a.aO.transparent}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class $l extends Zn{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class Vc extends Zn{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class qc extends Zn{getDefault(){return[!0,!0,!0,!0]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Rl extends Zn{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class Zc extends Zn{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class Gc extends Zn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const f=this.current;(l.func!==f.func||l.ref!==f.ref||l.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class Fl extends Zn{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class Uh extends Zn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=l,this.dirty=!1}}class Vh extends Zn{getDefault(){return[0,1]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class oa extends Zn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=l,this.dirty=!1}}class Ud extends Zn{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class Vd extends Zn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.BLEND):f.disable(f.BLEND),this.current=l,this.dirty=!1}}class qd extends Zn{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class Zd extends Zn{getDefault(){return a.aO.transparent}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Gd extends Zn{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class Hd extends Zn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=l,this.dirty=!1}}class Hc extends Zn{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class Bl extends Zn{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class Wc extends Zn{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class Kc extends Zn{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class sa extends Zn{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class qh extends Zn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Zh extends Zn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Xc extends Zn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class As extends Zn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Gh extends Zn{getDefault(){return null}set(l){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class aa extends Zn{getDefault(){return null}set(l){var f;if(l===this.current&&!this.dirty)return;const g=this.gl;vi(g)?g.bindVertexArray(l):(f=g.getExtension("OES_vertex_array_object"))===null||f===void 0||f.bindVertexArrayOES(l),this.current=l,this.dirty=!1}}class la extends Zn{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class Hh extends Zn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class Jc extends Zn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Vn extends Zn{constructor(l,f){super(l),this.context=l,this.parent=f}getDefault(){return null}}class Ol extends Vn{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Wd extends Vn{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Wh extends Vn{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Ka{constructor(l,f,g,b,k){this.context=l,this.width=f,this.height=g;const E=l.gl,A=this.framebuffer=E.createFramebuffer();if(this.colorAttachment=new Ol(l,A),b)this.depthAttachment=k?new Wh(l,A):new Wd(l,A);else if(k)throw new Error("Stencil cannot be set without depth");if(E.checkFramebufferStatus(E.FRAMEBUFFER)!==E.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){const g=this.depthAttachment.get();g&&l.deleteRenderbuffer(g)}l.deleteFramebuffer(this.framebuffer)}}class jr{constructor(l,f,g){this.blendFunction=l,this.blendColor=f,this.mask=g}}jr.Replace=[1,0],jr.disabled=new jr(jr.Replace,a.aO.transparent,[!1,!1,!1,!1]),jr.unblended=new jr(jr.Replace,a.aO.transparent,[!0,!0,!0,!0]),jr.alphaBlended=new jr([1,771],a.aO.transparent,[!0,!0,!0,!0]);class Kd{constructor(l){var f,g;if(this.gl=l,this.clearColor=new Dl(this),this.clearDepth=new $l(this),this.clearStencil=new Vc(this),this.colorMask=new qc(this),this.depthMask=new Rl(this),this.stencilMask=new Zc(this),this.stencilFunc=new Gc(this),this.stencilOp=new Fl(this),this.stencilTest=new Uh(this),this.depthRange=new Vh(this),this.depthTest=new oa(this),this.depthFunc=new Ud(this),this.blend=new Vd(this),this.blendFunc=new qd(this),this.blendColor=new Zd(this),this.blendEquation=new Gd(this),this.cullFace=new Hd(this),this.cullFaceSide=new Hc(this),this.frontFace=new Bl(this),this.program=new Wc(this),this.activeTexture=new Kc(this),this.viewport=new sa(this),this.bindFramebuffer=new qh(this),this.bindRenderbuffer=new Zh(this),this.bindTexture=new Xc(this),this.bindVertexBuffer=new As(this),this.bindElementBuffer=new Gh(this),this.bindVertexArray=new aa(this),this.pixelStoreUnpack=new la(this),this.pixelStoreUnpackPremultiplyAlpha=new Hh(this),this.pixelStoreUnpackFlipY=new Jc(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),vi(l)){this.HALF_FLOAT=l.HALF_FLOAT;const b=l.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(f=l.RGBA16F)!==null&&f!==void 0?f:b==null?void 0:b.RGBA16F_EXT,this.RGB16F=(g=l.RGB16F)!==null&&g!==void 0?g:b==null?void 0:b.RGB16F_EXT,l.getExtension("EXT_color_buffer_float")}else{l.getExtension("EXT_color_buffer_half_float"),l.getExtension("OES_texture_half_float_linear");const b=l.getExtension("OES_texture_half_float");this.HALF_FLOAT=b==null?void 0:b.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,f){return new jd(this,l,f)}createVertexBuffer(l,f,g){return new zl(this,l,f,g)}createRenderbuffer(l,f,g){const b=this.gl,k=b.createRenderbuffer();return this.bindRenderbuffer.set(k),b.renderbufferStorage(b.RENDERBUFFER,l,f,g),this.bindRenderbuffer.set(null),k}createFramebuffer(l,f,g,b){return new Ka(this,l,f,g,b)}clear({color:l,depth:f,stencil:g}){const b=this.gl;let k=0;l&&(k|=b.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(k|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),g!==void 0&&(k|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),b.clear(k)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){a.aD(l.blendFunction,jr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}createVertexArray(){var l;return vi(this.gl)?this.gl.createVertexArray():(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.createVertexArrayOES()}deleteVertexArray(l){var f;return vi(this.gl)?this.gl.deleteVertexArray(l):(f=this.gl.getExtension("OES_vertex_array_object"))===null||f===void 0?void 0:f.deleteVertexArrayOES(l)}unbindVAO(){this.bindVertexArray.set(null)}}class Nn{constructor(l,f,g){this.func=l,this.mask=f,this.range=g}}Nn.ReadOnly=!1,Nn.ReadWrite=!0,Nn.disabled=new Nn(519,Nn.ReadOnly,[0,1]);const Yc=7680;class gr{constructor(l,f,g,b,k,E){this.test=l,this.ref=f,this.mask=g,this.fail=b,this.depthFail=k,this.pass=E}}gr.disabled=new gr({func:519,mask:0},0,0,Yc,Yc,Yc);class hr{constructor(l,f,g){this.enable=l,this.mode=f,this.frontFace=g}}let Ps;function Nl(x,l,f,g,b,k,E){const A=x.context,B=A.gl,G=x.useProgram("collisionBox"),X=[];let Y=0,pe=0;for(let Le=0;Le<g.length;Le++){const Ve=g[Le],Qe=l.getTile(Ve),nt=Qe.getBucket(f);if(!nt)continue;let ot=Ve.posMatrix;b[0]===0&&b[1]===0||(ot=x.translatePosMatrix(Ve.posMatrix,Qe,b,k));const gt=E?nt.textCollisionBox:nt.iconCollisionBox,dt=nt.collisionCircleArray;if(dt.length>0){const It=a.F(),zt=ot;a.aP(It,nt.placementInvProjMatrix,x.transform.glCoordMatrix),a.aP(It,It,nt.placementViewportMatrix),X.push({circleArray:dt,circleOffset:pe,transform:zt,invTransform:It,coord:Ve}),Y+=dt.length/4,pe=Y}gt&&G.draw(A,B.LINES,Nn.disabled,gr.disabled,x.colorModeForRenderPass(),hr.disabled,Rh(ot,x.transform,Qe),x.style.map.terrain&&x.style.map.terrain.getTerrainData(Ve),f.id,gt.layoutVertexBuffer,gt.indexBuffer,gt.segments,null,x.transform.zoom,null,null,gt.collisionVertexBuffer)}if(!E||!X.length)return;const Se=x.useProgram("collisionCircle"),ke=new a.aQ;ke.resize(4*Y),ke._trim();let Me=0;for(const Le of X)for(let Ve=0;Ve<Le.circleArray.length/4;Ve++){const Qe=4*Ve,nt=Le.circleArray[Qe+0],ot=Le.circleArray[Qe+1],gt=Le.circleArray[Qe+2],dt=Le.circleArray[Qe+3];ke.emplace(Me++,nt,ot,gt,dt,0),ke.emplace(Me++,nt,ot,gt,dt,1),ke.emplace(Me++,nt,ot,gt,dt,2),ke.emplace(Me++,nt,ot,gt,dt,3)}(!Ps||Ps.length<2*Y)&&(Ps=function(Le){const Ve=2*Le,Qe=new a.aS;Qe.resize(Ve),Qe._trim();for(let nt=0;nt<Ve;nt++){const ot=6*nt;Qe.uint16[ot+0]=4*nt+0,Qe.uint16[ot+1]=4*nt+1,Qe.uint16[ot+2]=4*nt+2,Qe.uint16[ot+3]=4*nt+2,Qe.uint16[ot+4]=4*nt+3,Qe.uint16[ot+5]=4*nt+0}return Qe}(Y));const ye=A.createIndexBuffer(Ps,!0),Fe=A.createVertexBuffer(ke,a.aR.members,!0);for(const Le of X){const Ve={u_matrix:Le.transform,u_inv_matrix:Le.invTransform,u_camera_to_center_distance:(Je=x.transform).cameraToCenterDistance,u_viewport_size:[Je.width,Je.height]};Se.draw(A,B.TRIANGLES,Nn.disabled,gr.disabled,x.colorModeForRenderPass(),hr.disabled,Ve,x.style.map.terrain&&x.style.map.terrain.getTerrainData(Le.coord),f.id,Fe,ye,a.$.simpleSegment(0,2*Le.circleOffset,Le.circleArray.length,Le.circleArray.length/2),null,x.transform.zoom,null,null,null)}var Je;Fe.destroy(),ye.destroy()}hr.disabled=new hr(!1,1029,2305),hr.backCCW=new hr(!0,1029,2305);const Qc=a.an(new Float32Array(16));function Kh(x,l,f,g,b,k){const{horizontalAlign:E,verticalAlign:A}=a.at(x);return new a.P((-(E-.5)*l/b+g[0])*k,(-(A-.5)*f/b+g[1])*k)}function jl(x,l,f,g,b,k,E,A,B,G,X){const Y=x.text.placedSymbolArray,pe=x.text.dynamicLayoutVertexArray,Se=x.icon.dynamicLayoutVertexArray,ke={};pe.clear();for(let Me=0;Me<Y.length;Me++){const ye=Y.get(Me),Fe=ye.hidden||!ye.crossTileID||x.allowVerticalPlacement&&!ye.placedOrientation?null:g[ye.crossTileID];if(Fe){const Je=new a.P(ye.anchorX,ye.anchorY),Le=er(Je,f?E:k,X),Ve=Ce(b.cameraToCenterDistance,Le.signedDistanceFromCamera);let Qe=a.ai(x.textSizeData,B,ye)*Ve/a.ao;f&&(Qe*=x.tilePixelRatio/A);const{width:nt,height:ot,anchor:gt,textOffset:dt,textBoxScale:It}=Fe,zt=Kh(gt,nt,ot,dt,It,Qe),yn=f?er(Je.add(zt),k,X).point:Le.point.add(l?zt.rotate(-b.angle):zt),Rt=x.allowVerticalPlacement&&ye.placedOrientation===a.ah.vertical?Math.PI/2:0;for(let dn=0;dn<ye.numGlyphs;dn++)a.aj(pe,yn,Rt);G&&ye.associatedIconIndex>=0&&(ke[ye.associatedIconIndex]={shiftedAnchor:yn,angle:Rt})}else Ye(ye.numGlyphs,pe)}if(G){Se.clear();const Me=x.icon.placedSymbolArray;for(let ye=0;ye<Me.length;ye++){const Fe=Me.get(ye);if(Fe.hidden)Ye(Fe.numGlyphs,Se);else{const Je=ke[ye];if(Je)for(let Le=0;Le<Fe.numGlyphs;Le++)a.aj(Se,Je.shiftedAnchor,Je.angle);else Ye(Fe.numGlyphs,Se)}}x.icon.dynamicLayoutVertexBuffer.updateData(Se)}x.text.dynamicLayoutVertexBuffer.updateData(pe)}function Ul(x,l,f){return f.iconsInText&&l?"symbolTextAndIcon":x?"symbolSDF":"symbolIcon"}function Vl(x,l,f,g,b,k,E,A,B,G,X,Y){const pe=x.context,Se=pe.gl,ke=x.transform,Me=A==="map",ye=B==="map",Fe=A!=="viewport"&&f.layout.get("symbol-placement")!=="point",Je=Me&&!ye&&!Fe,Le=!f.layout.get("symbol-sort-key").isConstant();let Ve=!1;const Qe=x.depthModeForSublayer(0,Nn.ReadOnly),nt=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ot=[];for(const gt of g){const dt=l.getTile(gt),It=dt.getBucket(f);if(!It)continue;const zt=b?It.text:It.icon;if(!zt||!zt.segments.get().length||!zt.hasVisibleVertices)continue;const yn=zt.programConfigurations.get(f.id),Rt=b||It.sdfIcons,dn=b?It.textSizeData:It.iconSizeData,bn=ye||ke.pitch!==0,jn=x.useProgram(Ul(Rt,b,It),yn),gn=a.ag(dn,ke.zoom),kn=x.style.map.terrain&&x.style.map.terrain.getTerrainData(gt);let Pn,$r,or,Qi,ti=[0,0],Lr=null;if(b)$r=dt.glyphAtlasTexture,or=Se.LINEAR,Pn=dt.glyphAtlasTexture.size,It.iconsInText&&(ti=dt.imageAtlasTexture.size,Lr=dt.imageAtlasTexture,Qi=bn||x.options.rotating||x.options.zooming||dn.kind==="composite"||dn.kind==="camera"?Se.LINEAR:Se.NEAREST);else{const Hr=f.layout.get("icon-size").constantOr(0)!==1||It.iconsNeedLinear;$r=dt.imageAtlasTexture,or=Rt||x.options.rotating||x.options.zooming||Hr||bn?Se.LINEAR:Se.NEAREST,Pn=dt.imageAtlasTexture.size}const ni=fn(dt,1,x.transform.zoom),eo=sn(gt.posMatrix,ye,Me,x.transform,ni),Zo=zi(gt.posMatrix,ye,Me,x.transform,ni),xs=nt&&It.hasTextData(),ll=f.layout.get("icon-text-fit")!=="none"&&xs&&It.hasIconData();if(Fe){const Hr=x.style.map.terrain?(mo,Wr)=>x.style.map.terrain.getElevation(gt,mo,Wr):null,Ir=f.layout.get("text-rotation-alignment")==="map";ne(It,gt.posMatrix,x,b,eo,Zo,ye,G,Ir,Hr)}const ks=x.translatePosMatrix(gt.posMatrix,dt,k,E),Go=Fe||b&&nt||ll?Qc:eo,Gr=x.translatePosMatrix(Zo,dt,k,E,!0),Er=Rt&&f.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Sr;Sr=Rt?It.iconsInText?Wa(dn.kind,gn,Je,ye,x,ks,Go,Gr,Pn,ti):Ha(dn.kind,gn,Je,ye,x,ks,Go,Gr,b,Pn,!0):Ga(dn.kind,gn,Je,ye,x,ks,Go,Gr,b,Pn);const po={program:jn,buffers:zt,uniformValues:Sr,atlasTexture:$r,atlasTextureIcon:Lr,atlasInterpolation:or,atlasInterpolationIcon:Qi,isSDF:Rt,hasHalo:Er};if(Le&&It.canOverlap){Ve=!0;const Hr=zt.segments.get();for(const Ir of Hr)ot.push({segments:new a.$([Ir]),sortKey:Ir.sortKey,state:po,terrainData:kn})}else ot.push({segments:zt.segments,sortKey:0,state:po,terrainData:kn})}Ve&&ot.sort((gt,dt)=>gt.sortKey-dt.sortKey);for(const gt of ot){const dt=gt.state;if(pe.activeTexture.set(Se.TEXTURE0),dt.atlasTexture.bind(dt.atlasInterpolation,Se.CLAMP_TO_EDGE),dt.atlasTextureIcon&&(pe.activeTexture.set(Se.TEXTURE1),dt.atlasTextureIcon&&dt.atlasTextureIcon.bind(dt.atlasInterpolationIcon,Se.CLAMP_TO_EDGE)),dt.isSDF){const It=dt.uniformValues;dt.hasHalo&&(It.u_is_halo=1,Xh(dt.buffers,gt.segments,f,x,dt.program,Qe,X,Y,It,gt.terrainData)),It.u_is_halo=0}Xh(dt.buffers,gt.segments,f,x,dt.program,Qe,X,Y,dt.uniformValues,gt.terrainData)}}function Xh(x,l,f,g,b,k,E,A,B,G){const X=g.context;b.draw(X,X.gl.TRIANGLES,k,E,A,hr.disabled,B,G,f.id,x.layoutVertexBuffer,x.indexBuffer,l,f.paint,g.transform.zoom,x.programConfigurations.get(f.id),x.dynamicLayoutVertexBuffer,x.opacityVertexBuffer)}function ql(x,l,f,g,b){if(!f||!g||!g.imageAtlas)return;const k=g.imageAtlas.patternPositions;let E=k[f.to.toString()],A=k[f.from.toString()];if(!E&&A&&(E=A),!A&&E&&(A=E),!E||!A){const B=b.getPaintProperty(l);E=k[B],A=k[B]}E&&A&&x.setConstantPatternPositions(E,A)}function Jh(x,l,f,g,b,k,E){const A=x.context.gl,B="fill-pattern",G=f.paint.get(B),X=G&&G.constantOr(1),Y=f.getCrossfadeParameters();let pe,Se,ke,Me,ye;E?(Se=X&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",pe=A.LINES):(Se=X?"fillPattern":"fill",pe=A.TRIANGLES);const Fe=G.constantOr(null);for(const Je of g){const Le=l.getTile(Je);if(X&&!Le.patternsLoaded())continue;const Ve=Le.getBucket(f);if(!Ve)continue;const Qe=Ve.programConfigurations.get(f.id),nt=x.useProgram(Se,Qe),ot=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Je);X&&(x.context.activeTexture.set(A.TEXTURE0),Le.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),Qe.updatePaintBuffers(Y)),ql(Qe,B,Fe,Le,f);const gt=ot?Je:null,dt=x.translatePosMatrix(gt?gt.posMatrix:Je.posMatrix,Le,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(E){Me=Ve.indexBuffer2,ye=Ve.segments2;const It=[A.drawingBufferWidth,A.drawingBufferHeight];ke=Se==="fillOutlinePattern"&&X?$h(dt,x,Y,Le,It):Fd(dt,It)}else Me=Ve.indexBuffer,ye=Ve.segments,ke=X?Ll(dt,x,Y,Le):Dh(dt);nt.draw(x.context,pe,b,x.stencilModeForClipping(Je),k,hr.disabled,ke,ot,f.id,Ve.layoutVertexBuffer,Me,ye,f.paint,x.transform.zoom,Qe)}}function Zl(x,l,f,g,b,k,E){const A=x.context,B=A.gl,G="fill-extrusion-pattern",X=f.paint.get(G),Y=X.constantOr(1),pe=f.getCrossfadeParameters(),Se=f.paint.get("fill-extrusion-opacity"),ke=X.constantOr(null);for(const Me of g){const ye=l.getTile(Me),Fe=ye.getBucket(f);if(!Fe)continue;const Je=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Me),Le=Fe.programConfigurations.get(f.id),Ve=x.useProgram(Y?"fillExtrusionPattern":"fillExtrusion",Le);Y&&(x.context.activeTexture.set(B.TEXTURE0),ye.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Le.updatePaintBuffers(pe)),ql(Le,G,ke,ye,f);const Qe=x.translatePosMatrix(Me.posMatrix,ye,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),nt=f.paint.get("fill-extrusion-vertical-gradient"),ot=Y?Rd(Qe,x,nt,Se,Me,pe,ye):Va(Qe,x,nt,Se);Ve.draw(A,A.gl.TRIANGLES,b,k,E,hr.backCCW,ot,Je,f.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,f.paint,x.transform.zoom,Le,x.style.map.terrain&&Fe.centroidVertexBuffer)}}function Gl(x,l,f,g,b,k,E){const A=x.context,B=A.gl,G=f.fbo;if(!G)return;const X=x.useProgram("hillshade"),Y=x.style.map.terrain&&x.style.map.terrain.getTerrainData(l);A.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,G.colorAttachment.get()),X.draw(A,B.TRIANGLES,b,k,E,hr.disabled,((pe,Se,ke,Me)=>{const ye=ke.paint.get("hillshade-shadow-color"),Fe=ke.paint.get("hillshade-highlight-color"),Je=ke.paint.get("hillshade-accent-color");let Le=ke.paint.get("hillshade-illumination-direction")*(Math.PI/180);ke.paint.get("hillshade-illumination-anchor")==="viewport"&&(Le-=pe.transform.angle);const Ve=!pe.options.moving;return{u_matrix:Me?Me.posMatrix:pe.transform.calculatePosMatrix(Se.tileID.toUnwrapped(),Ve),u_image:0,u_latrange:Oh(0,Se.tileID),u_light:[ke.paint.get("hillshade-exaggeration"),Le],u_shadow:ye,u_highlight:Fe,u_accent:Je}})(x,f,g,Y?l:null),Y,g.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments)}function eu(x,l,f,g,b,k){const E=x.context,A=E.gl,B=l.dem;if(B&&B.data){const G=B.dim,X=B.stride,Y=B.getPixels();if(E.activeTexture.set(A.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||x.getTileTexture(X),l.demTexture){const Se=l.demTexture;Se.update(Y,{premultiply:!1}),Se.bind(A.NEAREST,A.CLAMP_TO_EDGE)}else l.demTexture=new Q(E,Y,A.RGBA,{premultiply:!1}),l.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);E.activeTexture.set(A.TEXTURE0);let pe=l.fbo;if(!pe){const Se=new Q(E,{width:G,height:G,data:null},A.RGBA);Se.bind(A.LINEAR,A.CLAMP_TO_EDGE),pe=l.fbo=E.createFramebuffer(G,G,!0,!1),pe.colorAttachment.set(Se.texture)}E.bindFramebuffer.set(pe.framebuffer),E.viewport.set([0,0,G,G]),x.useProgram("hillshadePrepare").draw(E,A.TRIANGLES,g,b,k,hr.disabled,((Se,ke)=>{const Me=ke.stride,ye=a.F();return a.aN(ye,0,a.W,-a.W,0,0,1),a.H(ye,ye,[0,-a.W,0]),{u_matrix:ye,u_image:1,u_dimension:[Me,Me],u_zoom:Se.overscaledZ,u_unpack:ke.getUnpackVector()}})(l.tileID,B),null,f.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments),l.needsHillshadePrepare=!1}}function Yh(x,l,f,g,b,k){const E=g.paint.get("raster-fade-duration");if(!k&&E>0){const A=_.now(),B=(A-x.timeAdded)/E,G=l?(A-l.timeAdded)/E:-1,X=f.getSource(),Y=b.coveringZoomLevel({tileSize:X.tileSize,roundZoom:X.roundZoom}),pe=!l||Math.abs(l.tileID.overscaledZ-Y)>Math.abs(x.tileID.overscaledZ-Y),Se=pe&&x.refreshedUponExpiration?1:a.ac(pe?B:1-G,0,1);return x.refreshedUponExpiration&&B>=1&&(x.refreshedUponExpiration=!1),l?{opacity:1,mix:1-Se}:{opacity:Se,mix:0}}return{opacity:1,mix:0}}const Qh=new a.aO(1,0,0,1),Hl=new a.aO(0,1,0,1),tu=new a.aO(0,0,1,1),Xd=new a.aO(1,0,1,1),ef=new a.aO(0,1,1,1);function zr(x,l,f,g){Li(x,0,l+f/2,x.transform.width,f,g)}function ys(x,l,f,g){Li(x,l-f/2,0,f,x.transform.height,g)}function Li(x,l,f,g,b,k){const E=x.context,A=E.gl;A.enable(A.SCISSOR_TEST),A.scissor(l*x.pixelRatio,f*x.pixelRatio,g*x.pixelRatio,b*x.pixelRatio),E.clear({color:k}),A.disable(A.SCISSOR_TEST)}function nu(x,l,f){const g=x.context,b=g.gl,k=f.posMatrix,E=x.useProgram("debug"),A=Nn.disabled,B=gr.disabled,G=x.colorModeForRenderPass(),X="$debug",Y=x.style.map.terrain&&x.style.map.terrain.getTerrainData(f);g.activeTexture.set(b.TEXTURE0);const pe=l.getTileByID(f.key).latestRawTileData,Se=Math.floor((pe&&pe.byteLength||0)/1024),ke=l.getTile(f).tileSize,Me=512/Math.min(ke,512)*(f.overscaledZ/x.transform.zoom)*.5;let ye=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(ye+=` => ${f.overscaledZ}`),function(Fe,Je){Fe.initDebugOverlayCanvas();const Le=Fe.debugOverlayCanvas,Ve=Fe.context.gl,Qe=Fe.debugOverlayCanvas.getContext("2d");Qe.clearRect(0,0,Le.width,Le.height),Qe.shadowColor="white",Qe.shadowBlur=2,Qe.lineWidth=1.5,Qe.strokeStyle="white",Qe.textBaseline="top",Qe.font="bold 36px Open Sans, sans-serif",Qe.fillText(Je,5,5),Qe.strokeText(Je,5,5),Fe.debugOverlayTexture.update(Le),Fe.debugOverlayTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE)}(x,`${ye} ${Se}kB`),E.draw(g,b.TRIANGLES,A,B,jr.alphaBlended,hr.disabled,Fh(k,a.aO.transparent,Me),null,X,x.debugBuffer,x.quadTriangleIndexBuffer,x.debugSegments),E.draw(g,b.LINE_STRIP,A,B,G,hr.disabled,Fh(k,a.aO.red),Y,X,x.debugBuffer,x.tileBorderIndexBuffer,x.debugSegments)}function Wl(x,l,f){const g=x.context,b=g.gl,k=x.colorModeForRenderPass(),E=new Nn(b.LEQUAL,Nn.ReadWrite,x.depthRangeFor3D),A=x.useProgram("terrain"),B=l.getTerrainMesh();g.bindFramebuffer.set(null),g.viewport.set([0,0,x.width,x.height]);for(const G of f){const X=x.renderToTexture.getTexture(G),Y=l.getTerrainData(G.tileID);g.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,X.texture);const pe={u_matrix:x.transform.calculatePosMatrix(G.tileID.toUnwrapped()),u_texture:0,u_ele_delta:l.getMeshFrameDelta(x.transform.zoom)};A.draw(g,b.TRIANGLES,E,gr.disabled,k,hr.backCCW,pe,Y,"terrain",B.vertexBuffer,B.indexBuffer,B.segments)}}class tf{constructor(l,f){this.context=new Kd(l),this.transform=f,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Yn.maxUnderzooming+Yn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new gs}resize(l,f,g){if(this.width=Math.floor(l*g),this.height=Math.floor(f*g),this.pixelRatio=g,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const b of this.style._order)this.style._layers[b].resize()}setup(){const l=this.context,f=new a.aV;f.emplaceBack(0,0),f.emplaceBack(a.W,0),f.emplaceBack(0,a.W),f.emplaceBack(a.W,a.W),this.tileExtentBuffer=l.createVertexBuffer(f,Cl.members),this.tileExtentSegments=a.$.simpleSegment(0,0,4,2);const g=new a.aV;g.emplaceBack(0,0),g.emplaceBack(a.W,0),g.emplaceBack(0,a.W),g.emplaceBack(a.W,a.W),this.debugBuffer=l.createVertexBuffer(g,Cl.members),this.debugSegments=a.$.simpleSegment(0,0,4,5);const b=new a.Z;b.emplaceBack(0,0,0,0),b.emplaceBack(a.W,0,a.W,0),b.emplaceBack(0,a.W,0,a.W),b.emplaceBack(a.W,a.W,a.W,a.W),this.rasterBoundsBuffer=l.createVertexBuffer(b,it.members),this.rasterBoundsSegments=a.$.simpleSegment(0,0,4,2);const k=new a.aV;k.emplaceBack(0,0),k.emplaceBack(1,0),k.emplaceBack(0,1),k.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(k,Cl.members),this.viewportSegments=a.$.simpleSegment(0,0,4,2);const E=new a.aW;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(E);const A=new a.aX;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(A);const B=this.context.gl;this.stencilClearMode=new gr({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO)}clearStencil(){const l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const g=a.F();a.aN(g,0,this.width,this.height,0,0,1),a.J(g,g,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,f.TRIANGLES,Nn.disabled,this.stencilClearMode,jr.disabled,hr.disabled,El(g),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(l,f){if(this.currentStencilSource===l.source||!l.isTileClipped()||!f||!f.length)return;this.currentStencilSource=l.source;const g=this.context,b=g.gl;this.nextStencilID+f.length>256&&this.clearStencil(),g.setColorMode(jr.disabled),g.setDepthMode(Nn.disabled);const k=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of f){const A=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,B=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E);k.draw(g,b.TRIANGLES,Nn.disabled,new gr({func:b.ALWAYS,mask:0},A,255,b.KEEP,b.KEEP,b.REPLACE),jr.disabled,hr.disabled,El(E.posMatrix),B,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,f=this.context.gl;return new gr({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(l){const f=this.context.gl;return new gr({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(l){const f=this.context.gl,g=l.sort((E,A)=>A.overscaledZ-E.overscaledZ),b=g[g.length-1].overscaledZ,k=g[0].overscaledZ-b+1;if(k>1){this.currentStencilSource=void 0,this.nextStencilID+k>256&&this.clearStencil();const E={};for(let A=0;A<k;A++)E[A+b]=new gr({func:f.GEQUAL,mask:255},A+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=k,[E,g]}return[{[b]:gr.disabled},g]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new jr([l.CONSTANT_COLOR,l.ONE],new a.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?jr.unblended:jr.alphaBlended}depthModeForSublayer(l,f,g){if(!this.opaquePassEnabledForLayer())return Nn.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new Nn(g||this.context.gl.LEQUAL,f,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,f){this.style=l,this.options=f,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(_.now()),this.imageManager.beginFrame();const g=this.style._order,b=this.style.sourceCaches,k={},E={},A={};for(const B in b){const G=b[B];G.used&&G.prepare(this.context),k[B]=G.getVisibleCoordinates(),E[B]=k[B].slice().reverse(),A[B]=G.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let B=0;B<g.length;B++)if(this.style._layers[g[B]].is3D()){this.opaquePassCutoff=B;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const B of g){const G=this.style._layers[B];if(!G.hasOffscreenPass()||G.isHidden(this.transform.zoom))continue;const X=E[G.source];(G.type==="custom"||X.length)&&this.renderLayer(this,b[G.source],G,X)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?a.aO.black:a.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const B=this.style._layers[g[this.currentLayer]],G=b[B.source],X=k[B.source];this._renderTileClippingMasks(B,X),this.renderLayer(this,G,B,X)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const B=this.style._layers[g[this.currentLayer]],G=b[B.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(B))continue;const X=(B.type==="symbol"?A:E)[B.source];this._renderTileClippingMasks(B,k[B.source]),this.renderLayer(this,G,B,X)}if(this.options.showTileBoundaries){const B=function(G,X){let Y=null;const pe=Object.values(G._layers).flatMap(ye=>ye.source&&!ye.isHidden(X)?[G.sourceCaches[ye.source]]:[]),Se=pe.filter(ye=>ye.getSource().type==="vector"),ke=pe.filter(ye=>ye.getSource().type!=="vector"),Me=ye=>{(!Y||Y.getSource().maxzoom<ye.getSource().maxzoom)&&(Y=ye)};return Se.forEach(ye=>Me(ye)),Y||ke.forEach(ye=>Me(ye)),Y}(this.style,this.transform.zoom);B&&function(G,X,Y){for(let pe=0;pe<Y.length;pe++)nu(G,X,Y[pe])}(this,B,B.getVisibleCoordinates())}this.options.showPadding&&function(B){const G=B.transform.padding;zr(B,B.transform.height-(G.top||0),3,Qh),zr(B,G.bottom||0,3,Hl),ys(B,G.left||0,3,tu),ys(B,B.transform.width-(G.right||0),3,Xd);const X=B.transform.centerPoint;(function(Y,pe,Se,ke){Li(Y,pe-1,Se-10,2,20,ke),Li(Y,pe-10,Se-1,20,2,ke)})(B,X.x,B.transform.height-X.y,ef)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(l){if(!this.style||!this.style.map||!this.style.map.terrain)return;const f=this.terrainFacilitator.matrix,g=this.transform.projMatrix;let b=this.terrainFacilitator.dirty;b||(b=l?!a.aY(f,g):!a.aZ(f,g)),b||(b=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),b&&(a.a_(f,g),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(k,E){const A=k.context,B=A.gl,G=jr.unblended,X=new Nn(B.LEQUAL,Nn.ReadWrite,[0,1]),Y=E.getTerrainMesh(),pe=E.sourceCache.getRenderableTiles(),Se=k.useProgram("terrainDepth");A.bindFramebuffer.set(E.getFramebuffer("depth").framebuffer),A.viewport.set([0,0,k.width/devicePixelRatio,k.height/devicePixelRatio]),A.clear({color:a.aO.transparent,depth:1});for(const ke of pe){const Me=E.getTerrainData(ke.tileID),ye={u_matrix:k.transform.calculatePosMatrix(ke.tileID.toUnwrapped()),u_ele_delta:E.getMeshFrameDelta(k.transform.zoom)};Se.draw(A,B.TRIANGLES,X,gr.disabled,G,hr.backCCW,ye,Me,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments)}A.bindFramebuffer.set(null),A.viewport.set([0,0,k.width,k.height])}(this,this.style.map.terrain),function(k,E){const A=k.context,B=A.gl,G=jr.unblended,X=new Nn(B.LEQUAL,Nn.ReadWrite,[0,1]),Y=E.getTerrainMesh(),pe=E.getCoordsTexture(),Se=E.sourceCache.getRenderableTiles(),ke=k.useProgram("terrainCoords");A.bindFramebuffer.set(E.getFramebuffer("coords").framebuffer),A.viewport.set([0,0,k.width/devicePixelRatio,k.height/devicePixelRatio]),A.clear({color:a.aO.transparent,depth:1}),E.coordsIndex=[];for(const Me of Se){const ye=E.getTerrainData(Me.tileID);A.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,pe.texture);const Fe={u_matrix:k.transform.calculatePosMatrix(Me.tileID.toUnwrapped()),u_terrain_coords_id:(255-E.coordsIndex.length)/255,u_texture:0,u_ele_delta:E.getMeshFrameDelta(k.transform.zoom)};ke.draw(A,B.TRIANGLES,X,gr.disabled,G,hr.backCCW,Fe,ye,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments),E.coordsIndex.push(Me.tileID.key)}A.bindFramebuffer.set(null),A.viewport.set([0,0,k.width,k.height])}(this,this.style.map.terrain))}renderLayer(l,f,g,b){if(!g.isHidden(this.transform.zoom)&&(g.type==="background"||g.type==="custom"||(b||[]).length))switch(this.id=g.id,g.type){case"symbol":(function(k,E,A,B,G){if(k.renderPass!=="translucent")return;const X=gr.disabled,Y=k.colorModeForRenderPass();(A._unevaluatedLayout.hasValue("text-variable-anchor")||A._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(pe,Se,ke,Me,ye,Fe,Je){const Le=Se.transform,Ve=ye==="map",Qe=Fe==="map";for(const nt of pe){const ot=Me.getTile(nt),gt=ot.getBucket(ke);if(!gt||!gt.text||!gt.text.segments.get().length)continue;const dt=a.ag(gt.textSizeData,Le.zoom),It=fn(ot,1,Se.transform.zoom),zt=sn(nt.posMatrix,Qe,Ve,Se.transform,It),yn=ke.layout.get("icon-text-fit")!=="none"&&gt.hasIconData();if(dt){const Rt=Math.pow(2,Le.zoom-ot.tileID.overscaledZ);jl(gt,Ve,Qe,Je,Le,zt,nt.posMatrix,Rt,dt,yn,Se.style.map.terrain?(dn,bn)=>Se.style.map.terrain.getElevation(nt,dn,bn):null)}}}(B,k,A,E,A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),G),A.paint.get("icon-opacity").constantOr(1)!==0&&Vl(k,E,A,B,!1,A.paint.get("icon-translate"),A.paint.get("icon-translate-anchor"),A.layout.get("icon-rotation-alignment"),A.layout.get("icon-pitch-alignment"),A.layout.get("icon-keep-upright"),X,Y),A.paint.get("text-opacity").constantOr(1)!==0&&Vl(k,E,A,B,!0,A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),A.layout.get("text-keep-upright"),X,Y),E.map.showCollisionBoxes&&(Nl(k,E,A,B,A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),!0),Nl(k,E,A,B,A.paint.get("icon-translate"),A.paint.get("icon-translate-anchor"),!1))})(l,f,g,b,this.style.placement.variableOffsets);break;case"circle":(function(k,E,A,B){if(k.renderPass!=="translucent")return;const G=A.paint.get("circle-opacity"),X=A.paint.get("circle-stroke-width"),Y=A.paint.get("circle-stroke-opacity"),pe=!A.layout.get("circle-sort-key").isConstant();if(G.constantOr(1)===0&&(X.constantOr(1)===0||Y.constantOr(1)===0))return;const Se=k.context,ke=Se.gl,Me=k.depthModeForSublayer(0,Nn.ReadOnly),ye=gr.disabled,Fe=k.colorModeForRenderPass(),Je=[];for(let Le=0;Le<B.length;Le++){const Ve=B[Le],Qe=E.getTile(Ve),nt=Qe.getBucket(A);if(!nt)continue;const ot=nt.programConfigurations.get(A.id),gt=k.useProgram("circle",ot),dt=nt.layoutVertexBuffer,It=nt.indexBuffer,zt=k.style.map.terrain&&k.style.map.terrain.getTerrainData(Ve),yn={programConfiguration:ot,program:gt,layoutVertexBuffer:dt,indexBuffer:It,uniformValues:Bd(k,Ve,Qe,A),terrainData:zt};if(pe){const Rt=nt.segments.get();for(const dn of Rt)Je.push({segments:new a.$([dn]),sortKey:dn.sortKey,state:yn})}else Je.push({segments:nt.segments,sortKey:0,state:yn})}pe&&Je.sort((Le,Ve)=>Le.sortKey-Ve.sortKey);for(const Le of Je){const{programConfiguration:Ve,program:Qe,layoutVertexBuffer:nt,indexBuffer:ot,uniformValues:gt,terrainData:dt}=Le.state;Qe.draw(Se,ke.TRIANGLES,Me,ye,Fe,hr.disabled,gt,dt,A.id,nt,ot,Le.segments,A.paint,k.transform.zoom,Ve)}})(l,f,g,b);break;case"heatmap":(function(k,E,A,B){if(A.paint.get("heatmap-opacity")!==0)if(k.renderPass==="offscreen"){const G=k.context,X=G.gl,Y=gr.disabled,pe=new jr([X.ONE,X.ONE],a.aO.transparent,[!0,!0,!0,!0]);(function(Se,ke,Me){const ye=Se.gl;Se.activeTexture.set(ye.TEXTURE1),Se.viewport.set([0,0,ke.width/4,ke.height/4]);let Fe=Me.heatmapFbo;if(Fe)ye.bindTexture(ye.TEXTURE_2D,Fe.colorAttachment.get()),Se.bindFramebuffer.set(Fe.framebuffer);else{const Je=ye.createTexture();ye.bindTexture(ye.TEXTURE_2D,Je),ye.texParameteri(ye.TEXTURE_2D,ye.TEXTURE_WRAP_S,ye.CLAMP_TO_EDGE),ye.texParameteri(ye.TEXTURE_2D,ye.TEXTURE_WRAP_T,ye.CLAMP_TO_EDGE),ye.texParameteri(ye.TEXTURE_2D,ye.TEXTURE_MIN_FILTER,ye.LINEAR),ye.texParameteri(ye.TEXTURE_2D,ye.TEXTURE_MAG_FILTER,ye.LINEAR),Fe=Me.heatmapFbo=Se.createFramebuffer(ke.width/4,ke.height/4,!1,!1),function(Le,Ve,Qe,nt){var ot,gt;const dt=Le.gl,It=(ot=Le.HALF_FLOAT)!==null&&ot!==void 0?ot:dt.UNSIGNED_BYTE,zt=(gt=Le.RGBA16F)!==null&&gt!==void 0?gt:dt.RGBA;dt.texImage2D(dt.TEXTURE_2D,0,zt,Ve.width/4,Ve.height/4,0,dt.RGBA,It,null),nt.colorAttachment.set(Qe)}(Se,ke,Je,Fe)}})(G,k,A),G.clear({color:a.aO.transparent});for(let Se=0;Se<B.length;Se++){const ke=B[Se];if(E.hasRenderableParent(ke))continue;const Me=E.getTile(ke),ye=Me.getBucket(A);if(!ye)continue;const Fe=ye.programConfigurations.get(A.id),Je=k.useProgram("heatmap",Fe),{zoom:Le}=k.transform;Je.draw(G,X.TRIANGLES,Nn.disabled,Y,pe,hr.disabled,Bh(ke.posMatrix,Me,Le,A.paint.get("heatmap-intensity")),null,A.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,A.paint,k.transform.zoom,Fe)}G.viewport.set([0,0,k.width,k.height])}else k.renderPass==="translucent"&&(k.context.setColorMode(k.colorModeForRenderPass()),function(G,X){const Y=G.context,pe=Y.gl,Se=X.heatmapFbo;if(!Se)return;Y.activeTexture.set(pe.TEXTURE0),pe.bindTexture(pe.TEXTURE_2D,Se.colorAttachment.get()),Y.activeTexture.set(pe.TEXTURE1);let ke=X.colorRampTexture;ke||(ke=X.colorRampTexture=new Q(Y,X.colorRamp,pe.RGBA)),ke.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),G.useProgram("heatmapTexture").draw(Y,pe.TRIANGLES,Nn.disabled,gr.disabled,G.colorModeForRenderPass(),hr.disabled,((Me,ye,Fe,Je)=>{const Le=a.F();a.aN(Le,0,Me.width,Me.height,0,0,1);const Ve=Me.context.gl;return{u_matrix:Le,u_world:[Ve.drawingBufferWidth,Ve.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ye.paint.get("heatmap-opacity")}})(G,X),null,X.id,G.viewportBuffer,G.quadTriangleIndexBuffer,G.viewportSegments,X.paint,G.transform.zoom)}(k,A))})(l,f,g,b);break;case"line":(function(k,E,A,B){if(k.renderPass!=="translucent")return;const G=A.paint.get("line-opacity"),X=A.paint.get("line-width");if(G.constantOr(1)===0||X.constantOr(1)===0)return;const Y=k.depthModeForSublayer(0,Nn.ReadOnly),pe=k.colorModeForRenderPass(),Se=A.paint.get("line-dasharray"),ke=A.paint.get("line-pattern"),Me=ke.constantOr(1),ye=A.paint.get("line-gradient"),Fe=A.getCrossfadeParameters(),Je=Me?"linePattern":Se?"lineSDF":ye?"lineGradient":"line",Le=k.context,Ve=Le.gl;let Qe=!0;for(const nt of B){const ot=E.getTile(nt);if(Me&&!ot.patternsLoaded())continue;const gt=ot.getBucket(A);if(!gt)continue;const dt=gt.programConfigurations.get(A.id),It=k.context.program.get(),zt=k.useProgram(Je,dt),yn=Qe||zt.program!==It,Rt=k.style.map.terrain&&k.style.map.terrain.getTerrainData(nt),dn=ke.constantOr(null);if(dn&&ot.imageAtlas){const gn=ot.imageAtlas,kn=gn.patternPositions[dn.to.toString()],Pn=gn.patternPositions[dn.from.toString()];kn&&Pn&&dt.setConstantPatternPositions(kn,Pn)}const bn=Rt?nt:null,jn=Me?Es(k,ot,A,Fe,bn):Se?Al(k,ot,A,Se,Fe,bn):ye?Nh(k,ot,A,gt.lineClipsArray.length,bn):Il(k,ot,A,bn);if(Me)Le.activeTexture.set(Ve.TEXTURE0),ot.imageAtlasTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE),dt.updatePaintBuffers(Fe);else if(Se&&(yn||k.lineAtlas.dirty))Le.activeTexture.set(Ve.TEXTURE0),k.lineAtlas.bind(Le);else if(ye){const gn=gt.gradients[A.id];let kn=gn.texture;if(A.gradientVersion!==gn.version){let Pn=256;if(A.stepInterpolant){const $r=E.getSource().maxzoom,or=nt.canonical.z===$r?Math.ceil(1<<k.transform.maxZoom-nt.canonical.z):1;Pn=a.ac(a.aT(gt.maxLineLength/a.W*1024*or),256,Le.maxTextureSize)}gn.gradient=a.aU({expression:A.gradientExpression(),evaluationKey:"lineProgress",resolution:Pn,image:gn.gradient||void 0,clips:gt.lineClipsArray}),gn.texture?gn.texture.update(gn.gradient):gn.texture=new Q(Le,gn.gradient,Ve.RGBA),gn.version=A.gradientVersion,kn=gn.texture}Le.activeTexture.set(Ve.TEXTURE0),kn.bind(A.stepInterpolant?Ve.NEAREST:Ve.LINEAR,Ve.CLAMP_TO_EDGE)}zt.draw(Le,Ve.TRIANGLES,Y,k.stencilModeForClipping(nt),pe,hr.disabled,jn,Rt,A.id,gt.layoutVertexBuffer,gt.indexBuffer,gt.segments,A.paint,k.transform.zoom,dt,gt.layoutVertexBuffer2),Qe=!1}})(l,f,g,b);break;case"fill":(function(k,E,A,B){const G=A.paint.get("fill-color"),X=A.paint.get("fill-opacity");if(X.constantOr(1)===0)return;const Y=k.colorModeForRenderPass(),pe=A.paint.get("fill-pattern"),Se=k.opaquePassEnabledForLayer()&&!pe.constantOr(1)&&G.constantOr(a.aO.transparent).a===1&&X.constantOr(0)===1?"opaque":"translucent";if(k.renderPass===Se){const ke=k.depthModeForSublayer(1,k.renderPass==="opaque"?Nn.ReadWrite:Nn.ReadOnly);Jh(k,E,A,B,ke,Y,!1)}if(k.renderPass==="translucent"&&A.paint.get("fill-antialias")){const ke=k.depthModeForSublayer(A.getPaintProperty("fill-outline-color")?2:0,Nn.ReadOnly);Jh(k,E,A,B,ke,Y,!0)}})(l,f,g,b);break;case"fill-extrusion":(function(k,E,A,B){const G=A.paint.get("fill-extrusion-opacity");if(G!==0&&k.renderPass==="translucent"){const X=new Nn(k.context.gl.LEQUAL,Nn.ReadWrite,k.depthRangeFor3D);if(G!==1||A.paint.get("fill-extrusion-pattern").constantOr(1))Zl(k,E,A,B,X,gr.disabled,jr.disabled),Zl(k,E,A,B,X,k.stencilModeFor3D(),k.colorModeForRenderPass());else{const Y=k.colorModeForRenderPass();Zl(k,E,A,B,X,gr.disabled,Y)}}})(l,f,g,b);break;case"hillshade":(function(k,E,A,B){if(k.renderPass!=="offscreen"&&k.renderPass!=="translucent")return;const G=k.context,X=k.depthModeForSublayer(0,Nn.ReadOnly),Y=k.colorModeForRenderPass(),[pe,Se]=k.renderPass==="translucent"?k.stencilConfigForOverlap(B):[{},B];for(const ke of Se){const Me=E.getTile(ke);Me.needsHillshadePrepare!==void 0&&Me.needsHillshadePrepare&&k.renderPass==="offscreen"?eu(k,Me,A,X,gr.disabled,Y):k.renderPass==="translucent"&&Gl(k,ke,Me,A,X,pe[ke.overscaledZ],Y)}G.viewport.set([0,0,k.width,k.height])})(l,f,g,b);break;case"raster":(function(k,E,A,B){if(k.renderPass!=="translucent"||A.paint.get("raster-opacity")===0||!B.length)return;const G=k.context,X=G.gl,Y=E.getSource(),pe=k.useProgram("raster"),Se=k.colorModeForRenderPass(),[ke,Me]=Y instanceof Kt?[{},B]:k.stencilConfigForOverlap(B),ye=Me[Me.length-1].overscaledZ,Fe=!k.options.moving;for(const Je of Me){const Le=k.depthModeForSublayer(Je.overscaledZ-ye,A.paint.get("raster-opacity")===1?Nn.ReadWrite:Nn.ReadOnly,X.LESS),Ve=E.getTile(Je);Ve.registerFadeDuration(A.paint.get("raster-fade-duration"));const Qe=E.findLoadedParent(Je,0),nt=Yh(Ve,Qe,E,A,k.transform,k.style.map.terrain);let ot,gt;const dt=A.paint.get("raster-resampling")==="nearest"?X.NEAREST:X.LINEAR;G.activeTexture.set(X.TEXTURE0),Ve.texture.bind(dt,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST),G.activeTexture.set(X.TEXTURE1),Qe?(Qe.texture.bind(dt,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST),ot=Math.pow(2,Qe.tileID.overscaledZ-Ve.tileID.overscaledZ),gt=[Ve.tileID.canonical.x*ot%1,Ve.tileID.canonical.y*ot%1]):Ve.texture.bind(dt,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST);const It=k.style.map.terrain&&k.style.map.terrain.getTerrainData(Je),zt=It?Je:null,yn=zt?zt.posMatrix:k.transform.calculatePosMatrix(Je.toUnwrapped(),Fe),Rt=Pl(yn,gt||[0,0],ot||1,nt,A);Y instanceof Kt?pe.draw(G,X.TRIANGLES,Le,gr.disabled,Se,hr.disabled,Rt,It,A.id,Y.boundsBuffer,k.quadTriangleIndexBuffer,Y.boundsSegments):pe.draw(G,X.TRIANGLES,Le,ke[Je.overscaledZ],Se,hr.disabled,Rt,It,A.id,k.rasterBoundsBuffer,k.quadTriangleIndexBuffer,k.rasterBoundsSegments)}})(l,f,g,b);break;case"background":(function(k,E,A,B){const G=A.paint.get("background-color"),X=A.paint.get("background-opacity");if(X===0)return;const Y=k.context,pe=Y.gl,Se=k.transform,ke=Se.tileSize,Me=A.paint.get("background-pattern");if(k.isPatternMissing(Me))return;const ye=!Me&&G.a===1&&X===1&&k.opaquePassEnabledForLayer()?"opaque":"translucent";if(k.renderPass!==ye)return;const Fe=gr.disabled,Je=k.depthModeForSublayer(0,ye==="opaque"?Nn.ReadWrite:Nn.ReadOnly),Le=k.colorModeForRenderPass(),Ve=k.useProgram(Me?"backgroundPattern":"background"),Qe=B||Se.coveringTiles({tileSize:ke,terrain:k.style.map.terrain});Me&&(Y.activeTexture.set(pe.TEXTURE0),k.imageManager.bind(k.context));const nt=A.getCrossfadeParameters();for(const ot of Qe){const gt=B?ot.posMatrix:k.transform.calculatePosMatrix(ot.toUnwrapped()),dt=Me?Nd(gt,X,k,Me,{tileID:ot,tileSize:ke},nt):Od(gt,X,G),It=k.style.map.terrain&&k.style.map.terrain.getTerrainData(ot);Ve.draw(Y,pe.TRIANGLES,Je,Fe,Le,hr.disabled,dt,It,A.id,k.tileExtentBuffer,k.quadTriangleIndexBuffer,k.tileExtentSegments)}})(l,0,g,b);break;case"custom":(function(k,E,A){const B=k.context,G=A.implementation;if(k.renderPass==="offscreen"){const X=G.prerender;X&&(k.setCustomLayerDefaults(),B.setColorMode(k.colorModeForRenderPass()),X.call(G,B.gl,k.transform.customLayerMatrix()),B.setDirty(),k.setBaseState())}else if(k.renderPass==="translucent"){k.setCustomLayerDefaults(),B.setColorMode(k.colorModeForRenderPass()),B.setStencilMode(gr.disabled);const X=G.renderingMode==="3d"?new Nn(k.context.gl.LEQUAL,Nn.ReadWrite,k.depthRangeFor3D):k.depthModeForSublayer(0,Nn.ReadOnly);B.setDepthMode(X),G.render(B.gl,k.transform.customLayerMatrix()),B.setDirty(),k.setBaseState(),B.bindFramebuffer.set(null)}})(l,0,g)}}translatePosMatrix(l,f,g,b,k){if(!g[0]&&!g[1])return l;const E=k?b==="map"?this.transform.angle:0:b==="viewport"?-this.transform.angle:0;if(E){const G=Math.sin(E),X=Math.cos(E);g=[g[0]*X-g[1]*G,g[0]*G+g[1]*X]}const A=[k?g[0]:fn(f,g[0],this.transform.zoom),k?g[1]:fn(f,g[1],this.transform.zoom),0],B=new Float32Array(16);return a.H(B,l,A),B}saveTileTexture(l){const f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const f=this._tileTextures[l];return f&&f.length>0?f.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const f=this.imageManager.getPattern(l.from.toString()),g=this.imageManager.getPattern(l.to.toString());return!f||!g}useProgram(l,f){this.cache=this.cache||{};const g=l+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[g]||(this.cache[g]=new _s(this.context,Ua[l],f,jh[l],this._showOverdrawInspector,this.style.map.terrain)),this.cache[g]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Q(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:l,drawingBufferHeight:f}=this.context.gl;return this.width!==l||this.height!==f}}class bs{constructor(l,f){this.points=l,this.planes=f}static fromInvProjectionMatrix(l,f,g){const b=Math.pow(2,g),k=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const B=1/(A=a.af([],A,l))[3]/f*b;return a.a$(A,A,[B,B,1/A[3],B])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const B=function(pe,Se){var ke=Se[0],Me=Se[1],ye=Se[2],Fe=ke*ke+Me*Me+ye*ye;return Fe>0&&(Fe=1/Math.sqrt(Fe)),pe[0]=Se[0]*Fe,pe[1]=Se[1]*Fe,pe[2]=Se[2]*Fe,pe}([],function(pe,Se,ke){var Me=Se[0],ye=Se[1],Fe=Se[2],Je=ke[0],Le=ke[1],Ve=ke[2];return pe[0]=ye*Ve-Fe*Le,pe[1]=Fe*Je-Me*Ve,pe[2]=Me*Le-ye*Je,pe}([],ee([],k[A[0]],k[A[1]]),ee([],k[A[2]],k[A[1]]))),G=-((X=B)[0]*(Y=k[A[1]])[0]+X[1]*Y[1]+X[2]*Y[2]);var X,Y;return B.concat(G)});return new bs(k,E)}}class vs{constructor(l,f){this.min=l,this.max=f,this.center=function(g,b,k){return g[0]=.5*b[0],g[1]=.5*b[1],g[2]=.5*b[2],g}([],function(g,b,k){return g[0]=b[0]+k[0],g[1]=b[1]+k[1],g[2]=b[2]+k[2],g}([],this.min,this.max))}quadrant(l){const f=[l%2==0,l<2],g=se(this.min),b=se(this.max);for(let k=0;k<f.length;k++)g[k]=f[k]?this.min[k]:this.center[k],b[k]=f[k]?this.center[k]:this.max[k];return b[2]=this.max[2],new vs(g,b)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}intersects(l){const f=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let g=!0;for(let b=0;b<l.planes.length;b++){const k=l.planes[b];let E=0;for(let A=0;A<f.length;A++)a.b0(k,f[A])>=0&&E++;if(E===0)return 0;E!==f.length&&(g=!1)}if(g)return 2;for(let b=0;b<3;b++){let k=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let A=0;A<l.points.length;A++){const B=l.points[A][b]-this.min[b];k=Math.min(k,B),E=Math.max(E,B)}if(E<0||k>this.max[b]-this.min[b])return 0}return 1}}class ca{constructor(l=0,f=0,g=0,b=0){if(isNaN(l)||l<0||isNaN(f)||f<0||isNaN(g)||g<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=g,this.right=b}interpolate(l,f,g){return f.top!=null&&l.top!=null&&(this.top=a.z.number(l.top,f.top,g)),f.bottom!=null&&l.bottom!=null&&(this.bottom=a.z.number(l.bottom,f.bottom,g)),f.left!=null&&l.left!=null&&(this.left=a.z.number(l.left,f.left,g)),f.right!=null&&l.right!=null&&(this.right=a.z.number(l.right,f.right,g)),this}getCenter(l,f){const g=a.ac((this.left+l-this.right)/2,0,l),b=a.ac((this.top+f-this.bottom)/2,0,f);return new a.P(g,b)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new ca(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ru=85.051129;class Kl{constructor(l,f,g,b,k){this.tileSize=512,this._renderWorldCopies=k===void 0||!!k,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=g??0,this._maxPitch=b??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ca,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const l=new Kl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.apply(this),l}apply(l){this.tileSize=l.tileSize,this.latRange=l.latRange,this.width=l.width,this.height=l.height,this._center=l._center,this._elevation=l._elevation,this.minElevationForCurrentTile=l.minElevationForCurrentTile,this.zoom=l.zoom,this.angle=l.angle,this._fov=l._fov,this._pitch=l._pitch,this._unmodified=l._unmodified,this._edgeInsets=l._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(l){const f=-a.b1(l,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=function(){var g=new a.A(4);return a.A!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g}(),function(g,b,k){var E=b[0],A=b[1],B=b[2],G=b[3],X=Math.sin(k),Y=Math.cos(k);g[0]=E*Y+B*X,g[1]=A*Y+G*X,g[2]=E*-X+B*Y,g[3]=A*-X+G*Y}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const f=a.ac(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(l){const f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.tileZoom=Math.max(0,Math.floor(f)),this.scale=this.zoomScale(f),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(l){l!==this._elevation&&(this._elevation=l,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,f,g){this._unmodified=!1,this._edgeInsets.interpolate(l,f,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(l){const f=[new a.b2(0,l)];if(this._renderWorldCopies){const g=this.pointCoordinate(new a.P(0,0)),b=this.pointCoordinate(new a.P(this.width,0)),k=this.pointCoordinate(new a.P(this.width,this.height)),E=this.pointCoordinate(new a.P(0,this.height)),A=Math.floor(Math.min(g.x,b.x,k.x,E.x)),B=Math.floor(Math.max(g.x,b.x,k.x,E.x)),G=1;for(let X=A-G;X<=B+G;X++)X!==0&&f.push(new a.b2(X,l))}return f}coveringTiles(l){var f,g;let b=this.coveringZoomLevel(l);const k=b;if(l.minzoom!==void 0&&b<l.minzoom)return[];l.maxzoom!==void 0&&b>l.maxzoom&&(b=l.maxzoom);const E=this.pointCoordinate(this.getCameraPoint()),A=a.Y.fromLngLat(this.center),B=Math.pow(2,b),G=[B*E.x,B*E.y,0],X=[B*A.x,B*A.y,0],Y=bs.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,b);let pe=l.minzoom||0;!l.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(pe=b);const Se=l.terrain?2/Math.min(this.tileSize,l.tileSize)*this.tileSize:3,ke=Le=>({aabb:new vs([Le*B,0,0],[(Le+1)*B,B,0]),zoom:0,x:0,y:0,wrap:Le,fullyVisible:!1}),Me=[],ye=[],Fe=b,Je=l.reparseOverscaled?k:b;if(this._renderWorldCopies)for(let Le=1;Le<=3;Le++)Me.push(ke(-Le)),Me.push(ke(Le));for(Me.push(ke(0));Me.length>0;){const Le=Me.pop(),Ve=Le.x,Qe=Le.y;let nt=Le.fullyVisible;if(!nt){const zt=Le.aabb.intersects(Y);if(zt===0)continue;nt=zt===2}const ot=l.terrain?G:X,gt=Le.aabb.distanceX(ot),dt=Le.aabb.distanceY(ot),It=Math.max(Math.abs(gt),Math.abs(dt));if(Le.zoom===Fe||It>Se+(1<<Fe-Le.zoom)-2&&Le.zoom>=pe){const zt=Fe-Le.zoom,yn=G[0]-.5-(Ve<<zt),Rt=G[1]-.5-(Qe<<zt);ye.push({tileID:new a.Q(Le.zoom===Fe?Je:Le.zoom,Le.wrap,Le.zoom,Ve,Qe),distanceSq:me([X[0]-.5-Ve,X[1]-.5-Qe]),tileDistanceToCamera:Math.sqrt(yn*yn+Rt*Rt)})}else for(let zt=0;zt<4;zt++){const yn=(Ve<<1)+zt%2,Rt=(Qe<<1)+(zt>>1),dn=Le.zoom+1;let bn=Le.aabb.quadrant(zt);if(l.terrain){const jn=new a.Q(dn,Le.wrap,dn,yn,Rt),gn=l.terrain.getMinMaxElevation(jn),kn=(f=gn.minElevation)!==null&&f!==void 0?f:this.elevation,Pn=(g=gn.maxElevation)!==null&&g!==void 0?g:this.elevation;bn=new vs([bn.min[0],bn.min[1],kn],[bn.max[0],bn.max[1],Pn])}Me.push({aabb:bn,zoom:dn,x:yn,y:Rt,wrap:Le.wrap,fullyVisible:nt})}}return ye.sort((Le,Ve)=>Le.distanceSq-Ve.distanceSq).map(Le=>Le.tileID)}resize(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const f=a.ac(l.lat,-85.051129,ru);return new a.P(a.N(l.lng)*this.worldSize,a.O(f)*this.worldSize)}unproject(l){return new a.Y(l.x/this.worldSize,l.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(l){const f=this.elevation,g=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,b=this.pointLocation(this.centerPoint,l),k=l.getElevationForLngLatZoom(b,this.tileZoom);if(!(this.elevation-k))return;const E=g+f-k,A=Math.cos(this._pitch)*this.cameraToCenterDistance/E/a.b3(1,b.lat),B=this.scaleZoom(A/this.tileSize);this._elevation=k,this._center=b,this.zoom=B}setLocationAtPoint(l,f){const g=this.pointCoordinate(f),b=this.pointCoordinate(this.centerPoint),k=this.locationCoordinate(l),E=new a.Y(k.x-(g.x-b.x),k.y-(g.y-b.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(l,f){return f?this.coordinatePoint(this.locationCoordinate(l),f.getElevationForLngLatZoom(l,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(l))}pointLocation(l,f){return this.coordinateLocation(this.pointCoordinate(l,f))}locationCoordinate(l){return a.Y.fromLngLat(l)}coordinateLocation(l){return l&&l.toLngLat()}pointCoordinate(l,f){if(f){const pe=f.pointCoordinate(l);if(pe!=null)return pe}const g=[l.x,l.y,0,1],b=[l.x,l.y,1,1];a.af(g,g,this.pixelMatrixInverse),a.af(b,b,this.pixelMatrixInverse);const k=g[3],E=b[3],A=g[1]/k,B=b[1]/E,G=g[2]/k,X=b[2]/E,Y=G===X?0:(0-G)/(X-G);return new a.Y(a.z.number(g[0]/k,b[0]/E,Y)/this.worldSize,a.z.number(A,B,Y)/this.worldSize)}coordinatePoint(l,f=0,g=this.pixelMatrix){const b=[l.x*this.worldSize,l.y*this.worldSize,f,1];return a.af(b,b,g),new a.P(b[0]/b[3],b[1]/b[3])}getBounds(){const l=Math.max(0,this.height/2-this.getHorizon());return new Ne().extend(this.pointLocation(new a.P(0,l))).extend(this.pointLocation(new a.P(this.width,l))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ne([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,ru])}calculatePosMatrix(l,f=!1){const g=l.key,b=f?this._alignedPosMatrixCache:this._posMatrixCache;if(b[g])return b[g];const k=l.canonical,E=this.worldSize/this.zoomScale(k.z),A=k.x+Math.pow(2,k.z)*l.wrap,B=a.an(new Float64Array(16));return a.H(B,B,[A*E,k.y*E,0]),a.J(B,B,[E/a.W,E/a.W,1]),a.K(B,f?this.alignedProjMatrix:this.projMatrix,B),b[g]=new Float32Array(B),b[g]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(l,f){f=a.ac(+f,this.minZoom,this.maxZoom);const g={center:new a.M(l.lng,l.lat),zoom:f};let b=this.lngRange;if(!this._renderWorldCopies&&b===null){const Le=179.9999999999;b=[-Le,Le]}const k=this.tileSize*this.zoomScale(g.zoom);let E=0,A=k,B=0,G=k,X=0,Y=0;const{x:pe,y:Se}=this.size;if(this.latRange){const Le=this.latRange;E=a.O(Le[1])*k,A=a.O(Le[0])*k,A-E<Se&&(X=Se/(A-E))}b&&(B=a.b1(a.N(b[0])*k,0,k),G=a.b1(a.N(b[1])*k,0,k),G<B&&(G+=k),G-B<pe&&(Y=pe/(G-B)));const{x:ke,y:Me}=this.project.call({worldSize:k},l);let ye,Fe;const Je=Math.max(Y||0,X||0);if(Je){const Le=new a.P(Y?(G+B)/2:ke,X?(A+E)/2:Me);return g.center=this.unproject.call({worldSize:k},Le).wrap(),g.zoom+=this.scaleZoom(Je),g}if(this.latRange){const Le=Se/2;Me-Le<E&&(Fe=E+Le),Me+Le>A&&(Fe=A-Le)}if(b){const Le=(B+G)/2;let Ve=ke;this._renderWorldCopies&&(Ve=a.b1(ke,Le-k/2,Le+k/2));const Qe=pe/2;Ve-Qe<B&&(ye=B+Qe),Ve+Qe>G&&(ye=G-Qe)}if(ye!==void 0||Fe!==void 0){const Le=new a.P(ye??ke,Fe??Me);g.center=this.unproject.call({worldSize:k},Le).wrap()}return g}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this._unmodified,{center:f,zoom:g}=this.getConstrained(this.center,this.zoom);this.center=f,this.zoom=g,this._unmodified=l,this._constraining=!1}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,f=this.point.x,g=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b3(1,this.center.lat)*this.worldSize;let b=a.an(new Float64Array(16));a.J(b,b,[this.width/2,-this.height/2,1]),a.H(b,b,[1,-1,0]),this.labelPlaneMatrix=b,b=a.an(new Float64Array(16)),a.J(b,b,[1,-1,1]),a.H(b,b,[-1,-1,0]),a.J(b,b,[2/this.width,2/this.height,1]),this.glCoordMatrix=b;const k=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),E=Math.min(this.elevation,this.minElevationForCurrentTile),A=k-E*this._pixelPerMeter/Math.cos(this._pitch),B=E<0?A:k,G=Math.PI/2+this._pitch,X=this._fov*(.5+l.y/this.height),Y=Math.sin(X)*B/Math.sin(a.ac(Math.PI-G-X,.01,Math.PI-.01)),pe=this.getHorizon(),Se=2*Math.atan(pe/this.cameraToCenterDistance)*(.5+l.y/(2*pe)),ke=Math.sin(Se)*B/Math.sin(a.ac(Math.PI-G-Se,.01,Math.PI-.01)),Me=Math.min(Y,ke),ye=1.01*(Math.cos(Math.PI/2-this._pitch)*Me+B),Fe=this.height/50;b=new Float64Array(16),a.b4(b,this._fov,this.width/this.height,Fe,ye),b[8]=2*-l.x/this.width,b[9]=2*l.y/this.height,a.J(b,b,[1,-1,1]),a.H(b,b,[0,0,-this.cameraToCenterDistance]),a.b5(b,b,this._pitch),a.ad(b,b,this.angle),a.H(b,b,[-f,-g,0]),this.mercatorMatrix=a.J([],b,[this.worldSize,this.worldSize,this.worldSize]),a.J(b,b,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.K(new Float64Array(16),this.labelPlaneMatrix,b),a.H(b,b,[0,0,-this.elevation]),this.projMatrix=b,this.invProjMatrix=a.ar([],b),this.pixelMatrix3D=a.K(new Float64Array(16),this.labelPlaneMatrix,b);const Je=this.width%2/2,Le=this.height%2/2,Ve=Math.cos(this.angle),Qe=Math.sin(this.angle),nt=f-Math.round(f)+Ve*Je+Qe*Le,ot=g-Math.round(g)+Ve*Le+Qe*Je,gt=new Float64Array(b);if(a.H(gt,gt,[nt>.5?nt-1:nt,ot>.5?ot-1:ot,0]),this.alignedProjMatrix=gt,b=a.ar(new Float64Array(16),this.pixelMatrix),!b)throw new Error("failed to invert matrix");this.pixelMatrixInverse=b,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const l=this.pointCoordinate(new a.P(0,0)),f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return a.af(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,l))}getCameraQueryGeometry(l){const f=this.getCameraPoint();if(l.length===1)return[l[0],f];{let g=f.x,b=f.y,k=f.x,E=f.y;for(const A of l)g=Math.min(g,A.x),b=Math.min(b,A.y),k=Math.max(k,A.x),E=Math.max(E,A.y);return[new a.P(g,b),new a.P(k,b),new a.P(k,E),new a.P(g,E),new a.P(g,b)]}}lngLatToCameraDepth(l,f){const g=this.locationCoordinate(l),b=[g.x*this.worldSize,g.y*this.worldSize,f,1];return a.af(b,b,this.projMatrix),b[2]/b[3]}}function iu(x,l){let f,g=!1,b=null,k=null;const E=()=>{b=null,g&&(x.apply(k,f),b=setTimeout(E,l),g=!1)};return(...A)=>(g=!0,k=this,f=A,b||E(),b)}class ou{constructor(l){this._getCurrentHash=()=>{const f=window.location.hash.replace("#","");if(this._hashName){let g;return f.split("&").map(b=>b.split("=")).forEach(b=>{b[0]===this._hashName&&(g=b)}),(g&&g[1]||"").split("/")}return f.split("/")},this._onHashChange=()=>{const f=this._getCurrentHash();if(f.length>=3&&!f.some(g=>isNaN(g))){const g=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:g,pitch:+(f[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const f=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,f)}catch{}},this._updateHash=iu(this._updateHashUnthrottled,300),this._hashName=l&&encodeURIComponent(l)}addTo(l){return this._map=l,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(l){const f=this._map.getCenter(),g=Math.round(100*this._map.getZoom())/100,b=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),k=Math.pow(10,b),E=Math.round(f.lng*k)/k,A=Math.round(f.lat*k)/k,B=this._map.getBearing(),G=this._map.getPitch();let X="";if(X+=l?`/${E}/${A}/${g}`:`${g}/${A}/${E}`,(B||G)&&(X+="/"+Math.round(10*B)/10),G&&(X+=`/${Math.round(G)}`),this._hashName){const Y=this._hashName;let pe=!1;const Se=window.location.hash.slice(1).split("&").map(ke=>{const Me=ke.split("=")[0];return Me===Y?(pe=!0,`${Me}=${X}`):ke}).filter(ke=>ke);return pe||Se.push(`${Y}=${X}`),`#${Se.join("&")}`}return`#${X}`}}const Xa={linearity:.3,easing:a.b6(0,0,.3,1)},zs=a.e({deceleration:2500,maxSpeed:1400},Xa),nf=a.e({deceleration:20,maxSpeed:1400},Xa),rf=a.e({deceleration:1e3,maxSpeed:360},Xa),of=a.e({deceleration:1e3,maxSpeed:90},Xa);class sf{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:_.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,f=_.now();for(;l.length>0&&f-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const f={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:k}of this._inertiaBuffer)f.zoom+=k.zoomDelta||0,f.bearing+=k.bearingDelta||0,f.pitch+=k.pitchDelta||0,k.panDelta&&f.pan._add(k.panDelta),k.around&&(f.around=k.around),k.pinchAround&&(f.pinchAround=k.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(f.pan.mag()){const k=Ya(f.pan.mag(),g,a.e({},zs,l||{}));b.offset=f.pan.mult(k.amount/f.pan.mag()),b.center=this._map.transform.center,Ja(b,k)}if(f.zoom){const k=Ya(f.zoom,g,nf);b.zoom=this._map.transform.zoom+k.amount,Ja(b,k)}if(f.bearing){const k=Ya(f.bearing,g,rf);b.bearing=this._map.transform.bearing+a.ac(k.amount,-179,179),Ja(b,k)}if(f.pitch){const k=Ya(f.pitch,g,of);b.pitch=this._map.transform.pitch+k.amount,Ja(b,k)}if(b.zoom||b.bearing){const k=f.pinchAround===void 0?f.around:f.pinchAround;b.around=k?this._map.unproject(k):this._map.getCenter()}return this.clear(),a.e(b,{noMoveStart:!0})}}function Ja(x,l){(!x.duration||x.duration<l.duration)&&(x.duration=l.duration,x.easing=l.easing)}function Ya(x,l,f){const{maxSpeed:g,linearity:b,deceleration:k}=f,E=a.ac(x*b/(l/1e3),-g,g),A=Math.abs(E)/(k*b);return{easing:f.easing,duration:1e3*A,amount:E*(A/2)}}class Ri extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,g,b={}){const k=w.mousePos(f.getCanvas(),g),E=f.unproject(k);super(l,a.e({point:k,lngLat:E,originalEvent:g},b)),this._defaultPrevented=!1,this.target=f}}class Uo extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,g){const b=l==="touchend"?g.changedTouches:g.touches,k=w.touchPos(f.getCanvasContainer(),b),E=k.map(B=>f.unproject(B)),A=k.reduce((B,G,X,Y)=>B.add(G.div(Y.length)),new a.P(0,0));super(l,{points:k,point:A,lngLats:E,lngLat:f.unproject(A),originalEvent:g}),this._defaultPrevented=!1}}class su extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,g){super(l,{originalEvent:g}),this._defaultPrevented=!1}}class vo{constructor(l,f){this._map=l,this._clickTolerance=f.clickTolerance}reset(){delete this._mousedownPos}wheel(l){return this._firePreventable(new su(l.type,this._map,l))}mousedown(l,f){return this._mousedownPos=f,this._firePreventable(new Ri(l.type,this._map,l))}mouseup(l){this._map.fire(new Ri(l.type,this._map,l))}click(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new Ri(l.type,this._map,l))}dblclick(l){return this._firePreventable(new Ri(l.type,this._map,l))}mouseover(l){this._map.fire(new Ri(l.type,this._map,l))}mouseout(l){this._map.fire(new Ri(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Uo(l.type,this._map,l))}touchmove(l){this._map.fire(new Uo(l.type,this._map,l))}touchend(l){this._map.fire(new Uo(l.type,this._map,l))}touchcancel(l){this._map.fire(new Uo(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vo{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(l){this._map.fire(new Ri(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ri("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._ignoreContextMenu||this._map.fire(new Ri(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ua{constructor(l){this._map=l}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(l){return this.transform.pointLocation(a.P.convert(l),this._map.terrain)}}class wo{constructor(l,f){this._map=l,this._tr=new ua(l),this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(w.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(l,f){if(!this._active)return;const g=f;if(this._lastPos.equals(g)||!this._box&&g.dist(this._startPos)<this._clickTolerance)return;const b=this._startPos;this._lastPos=g,this._box||(this._box=w.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",l));const k=Math.min(b.x,g.x),E=Math.max(b.x,g.x),A=Math.min(b.y,g.y),B=Math.max(b.y,g.y);w.setTransform(this._box,`translate(${k}px,${A}px)`),this._box.style.width=E-k+"px",this._box.style.height=B-A+"px"}mouseupWindow(l,f){if(!this._active||l.button!==0)return;const g=this._startPos,b=f;if(this.reset(),w.suppressClick(),g.x!==b.x||g.y!==b.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:l})),{cameraAnimation:k=>k.fitScreenCoordinates(g,b,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",l)}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(w.remove(this._box),this._box=null),w.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(l,f){return this._map.fire(new a.k(l,{originalEvent:f}))}}function Ds(x,l){if(x.length!==l.length)throw new Error(`The number of touches and points are not equal - touches ${x.length}, points ${l.length}`);const f={};for(let g=0;g<x.length;g++)f[x[g].identifier]=l[g];return f}class Jd{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(l,f,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),g.length===this.numTouches&&(this.centroid=function(b){const k=new a.P(0,0);for(const E of b)k._add(E);return k.div(b.length)}(f),this.touches=Ds(g,f)))}touchmove(l,f,g){if(this.aborted||!this.centroid)return;const b=Ds(g,f);for(const k in this.touches){const E=b[k];(!E||E.dist(this.touches[k])>30)&&(this.aborted=!0)}}touchend(l,f,g){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class au{constructor(l){this.singleTap=new Jd(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(l,f,g){this.singleTap.touchstart(l,f,g)}touchmove(l,f,g){this.singleTap.touchmove(l,f,g)}touchend(l,f,g){const b=this.singleTap.touchend(l,f,g);if(b){const k=l.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(b)<30;if(k&&E||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Yd{constructor(l){this._tr=new ua(l),this._zoomIn=new au({numTouches:1,numTaps:2}),this._zoomOut=new au({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,f,g){this._zoomIn.touchstart(l,f,g),this._zoomOut.touchstart(l,f,g)}touchmove(l,f,g){this._zoomIn.touchmove(l,f,g),this._zoomOut.touchmove(l,f,g)}touchend(l,f,g){const b=this._zoomIn.touchend(l,f,g),k=this._zoomOut.touchend(l,f,g),E=this._tr;return b?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:E.zoom+1,around:E.unproject(b)},{originalEvent:l})}):k?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:E.zoom-1,around:E.unproject(k)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ha{constructor(l){this._enabled=!!l.enable,this._moveStateManager=l.moveStateManager,this._clickTolerance=l.clickTolerance||1,this._moveFunction=l.move,this._activateOnStart=!!l.activateOnStart,l.assignEvents(this),this.reset()}reset(l){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(l)}_move(...l){const f=this._moveFunction(...l);if(f.bearingDelta||f.pitchDelta||f.around||f.panDelta)return this._active=!0,f}dragStart(l,f){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(l)&&(this._moveStateManager.startMove(l),this._lastPoint=f.length?f[0]:f,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(l,f){if(!this.isEnabled())return;const g=this._lastPoint;if(!g)return;if(l.preventDefault(),!this._moveStateManager.isValidMoveEvent(l))return void this.reset(l);const b=f.length?f[0]:f;return!this._moved&&b.dist(g)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=b,this._move(g,b))}dragEnd(l){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(l)&&(this._moved&&w.suppressClick(),this.reset(l))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Qa={0:1,2:2};class qo{constructor(l){this._correctEvent=l.checkCorrectEvent}startMove(l){const f=w.mouseButton(l);this._eventButton=f}endMove(l){delete this._eventButton}isValidStartEvent(l){return this._correctEvent(l)}isValidMoveEvent(l){return!function(f,g){const b=Qa[g];return f.buttons===void 0||(f.buttons&b)!==b}(l,this._eventButton)}isValidEndEvent(l){return w.mouseButton(l)===this._eventButton}}class Ht{constructor(){this._firstTouch=void 0}_isOneFingerTouch(l){return l.targetTouches.length===1}_isSameTouchEvent(l){return l.targetTouches[0].identifier===this._firstTouch}startMove(l){this._firstTouch=l.targetTouches[0].identifier}endMove(l){delete this._firstTouch}isValidStartEvent(l){return this._isOneFingerTouch(l)}isValidMoveEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}isValidEndEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}}const Xl=x=>{x.mousedown=x.dragStart,x.mousemoveWindow=x.dragMove,x.mouseup=x.dragEnd,x.contextmenu=function(l){l.preventDefault()}},fa=({enable:x,clickTolerance:l,bearingDegreesPerPixelMoved:f=.8})=>{const g=new qo({checkCorrectEvent:b=>w.mouseButton(b)===0&&b.ctrlKey||w.mouseButton(b)===2});return new ha({clickTolerance:l,move:(b,k)=>({bearingDelta:(k.x-b.x)*f}),moveStateManager:g,enable:x,assignEvents:Xl})},da=({enable:x,clickTolerance:l,pitchDegreesPerPixelMoved:f=-.5})=>{const g=new qo({checkCorrectEvent:b=>w.mouseButton(b)===0&&b.ctrlKey||w.mouseButton(b)===2});return new ha({clickTolerance:l,move:(b,k)=>({pitchDelta:(k.y-b.y)*f}),moveStateManager:g,enable:x,assignEvents:Xl})};class af{constructor(l,f){this._clickTolerance=l.clickTolerance||1,this._map=f,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(l,f,g){return this._calculateTransform(l,f,g)}touchmove(l,f,g){if(this._active&&!(g.length<this.minTouchs()))return l.preventDefault(),this._calculateTransform(l,f,g)}touchend(l,f,g){this._calculateTransform(l,f,g),this._active&&g.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,f,g){g.length>0&&(this._active=!0);const b=Ds(g,f),k=new a.P(0,0),E=new a.P(0,0);let A=0;for(const G in b){const X=b[G],Y=this._touches[G];Y&&(k._add(X),E._add(X.sub(Y)),A++,b[G]=X)}if(this._touches=b,A<this.minTouchs()||!E.mag())return;const B=E.div(A);return this._sum._add(B),this._sum.mag()<this._clickTolerance?void 0:{around:k.div(A),panDelta:B}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ut{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(l,f,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([f[0],f[1]]))}touchmove(l,f,g){if(!this._firstTwoTouches)return;l.preventDefault();const[b,k]=this._firstTwoTouches,E=pa(g,f,b),A=pa(g,f,k);if(!E||!A)return;const B=this._aroundCenter?null:E.add(A).div(2);return this._move([E,A],B,l)}touchend(l,f,g){if(!this._firstTwoTouches)return;const[b,k]=this._firstTwoTouches,E=pa(g,f,b),A=pa(g,f,k);E&&A||(this._active&&w.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function pa(x,l,f){for(let g=0;g<x.length;g++)if(x[g].identifier===f)return l[g]}function lf(x,l){return Math.log(x/l)/Math.LN2}class cf extends Ut{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,f){const g=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(lf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:lf(this._distance,g),pinchAround:f}}}function Jl(x,l){return 180*x.angleWith(l)/Math.PI}class lu extends Ut{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,f,g){const b=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Jl(this._vector,b),pinchAround:f}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const f=25/(Math.PI*this._minDiameter)*360,g=Jl(l,this._startVector);return Math.abs(g)<f}}function Yl(x){return Math.abs(x.y)>Math.abs(x.x)}class uf extends Ut{constructor(l){super(),this._currentTouchCount=0,this._map=l}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(l,f,g){super.touchstart(l,f,g),this._currentTouchCount=g.length}_start(l){this._lastPoints=l,Yl(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,f,g){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const b=l[0].sub(this._lastPoints[0]),k=l[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(b,k,g.timeStamp),this._valid?(this._lastPoints=l,this._active=!0,{pitchDelta:(b.y+k.y)/2*-.5}):void 0}gestureBeginsVertically(l,f,g){if(this._valid!==void 0)return this._valid;const b=l.mag()>=2,k=f.mag()>=2;if(!b&&!k)return;if(!b||!k)return this._firstMove===void 0&&(this._firstMove=g),g-this._firstMove<100&&void 0;const E=l.y>0==f.y>0;return Yl(l)&&Yl(f)&&E}}const Qd={panStep:100,bearingStep:15,pitchStep:10};class ws{constructor(l){this._tr=new ua(l);const f=Qd;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let f=0,g=0,b=0,k=0,E=0;switch(l.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:l.shiftKey?g=-1:(l.preventDefault(),k=-1);break;case 39:l.shiftKey?g=1:(l.preventDefault(),k=1);break;case 38:l.shiftKey?b=1:(l.preventDefault(),E=-1);break;case 40:l.shiftKey?b=-1:(l.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(g=0,b=0),{cameraAnimation:A=>{const B=this._tr;A.easeTo({duration:300,easeId:"keyboardHandler",easing:kr,zoom:f?Math.round(B.zoom)+f*(l.shiftKey?2:1):B.zoom,bearing:B.bearing+g*this._bearingStep,pitch:B.pitch+b*this._pitchStep,offset:[-k*this._panStep,-E*this._panStep],center:B.center},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function kr(x){return x*(2-x)}const el=4.000244140625;class Ql{constructor(l,f){this._onTimeout=g=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(g)},this._map=l,this._tr=new ua(l),this._triggerRenderFrame=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(l){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!l[this._map.cooperativeGestures._bypassKey])return;let f=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const g=_.now(),b=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,f!==0&&f%el==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(b*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=w.mousePos(this._map.getCanvas(),l),g=this._tr;this._around=f.y>g.transform.height/2-g.transform.getHorizon()?a.M.convert(this._aroundCenter?g.center:g.unproject(f)):a.M.convert(g.center),this._aroundPoint=g.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._tr.transform;if(this._delta!==0){const A=this._type==="wheel"&&Math.abs(this._delta)>el?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&B!==0&&(B=1/B);const G=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):l.scale;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(G*B))),this._type==="wheel"&&(this._startZoom=l.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:l.zoom,g=this._startZoom,b=this._easing;let k,E=!1;if(this._type==="wheel"&&g&&b){const A=Math.min((_.now()-this._lastWheelEventTime)/200,1),B=b(A);k=a.z.number(g,f,B),A<1?this._frameId||(this._frameId=!0):E=!0}else k=f,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:k-l.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let f=a.b7;if(this._prevEase){const g=this._prevEase,b=(_.now()-g.start)/g.duration,k=g.easing(b+.01)-g.easing(b),E=.27/Math.sqrt(k*k+1e-4)*.01,A=Math.sqrt(.0729-E*E);f=a.b6(E,A,.25,1)}return this._prevEase={start:_.now(),duration:l,easing:f},f}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class cu{constructor(l,f){this._clickZoom=l,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class hf{constructor(l){this._tr=new ua(l),this.reset()}reset(){this._active=!1}dblclick(l,f){return l.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:this._tr.zoom+(l.shiftKey?-1:1),around:this._tr.unproject(f)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ff{constructor(){this._tap=new au({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(l,f,g){if(!this._swipePoint)if(this._tapTime){const b=f[0],k=l.timeStamp-this._tapTime<500,E=this._tapPoint.dist(b)<30;k&&E?g.length>0&&(this._swipePoint=b,this._swipeTouch=g[0].identifier):this.reset()}else this._tap.touchstart(l,f,g)}touchmove(l,f,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const b=f[0],k=b.y-this._swipePoint.y;return this._swipePoint=b,l.preventDefault(),this._active=!0,{zoomDelta:k/128}}}else this._tap.touchmove(l,f,g)}touchend(l,f,g){if(this._tapTime)this._swipePoint&&g.length===0&&this.reset();else{const b=this._tap.touchend(l,f,g);b&&(this._tapTime=l.timeStamp,this._tapPoint=b)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class df{constructor(l,f,g){this._el=l,this._mousePan=f,this._touchPan=g}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class xo{constructor(l,f,g){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class tl{constructor(l,f,g,b){this._el=l,this._touchZoom=f,this._touchRotate=g,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class rn{constructor(l,f){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=l,this._options=f,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const l=this._map.getCanvasContainer();l.classList.add("maplibregl-cooperative-gestures"),this._container=w.create("div","maplibregl-cooperative-gesture-screen",l);let f=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(f=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const g=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),b=document.createElement("div");b.className="maplibregl-desktop-message",b.textContent=f,this._container.appendChild(b);const k=document.createElement("div");k.className="maplibregl-mobile-message",k.textContent=g,this._container.appendChild(k),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(w.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(l){this._onCooperativeGesture(l.touches.length===1)}wheel(l){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!l[this._bypassKey])}_onCooperativeGesture(l){this._enabled&&l&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const un=x=>x.zoom||x.drag||x.pitch||x.rotate;class ec extends a.k{}function nl(x){return x.panDelta&&x.panDelta.mag()||x.zoomDelta||x.bearingDelta||x.pitchDelta}class uu{constructor(l,f){this.handleWindowEvent=b=>{this.handleEvent(b,`${b.type}Window`)},this.handleEvent=(b,k)=>{if(b.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const E=b.type==="renderFrame"?void 0:b,A={needsRenderFrame:!1},B={},G={},X=b.touches,Y=X?this._getMapTouches(X):void 0,pe=Y?w.touchPos(this._map.getCanvas(),Y):w.mousePos(this._map.getCanvas(),b);for(const{handlerName:Me,handler:ye,allowed:Fe}of this._handlers){if(!ye.isEnabled())continue;let Je;this._blockedByActive(G,Fe,Me)?ye.reset():ye[k||b.type]&&(Je=ye[k||b.type](b,pe,Y),this.mergeHandlerResult(A,B,Je,Me,E),Je&&Je.needsRenderFrame&&this._triggerRenderFrame()),(Je||ye.isActive())&&(G[Me]=ye)}const Se={};for(const Me in this._previousActiveHandlers)G[Me]||(Se[Me]=E);this._previousActiveHandlers=G,(Object.keys(Se).length||nl(A))&&(this._changes.push([A,B,Se]),this._triggerRenderFrame()),(Object.keys(G).length||nl(A))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ke}=A;ke&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ke(this._map))},this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new sf(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(const[b,k,E]of this._listeners)w.addEventListener(b,k,b===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[l,f,g]of this._listeners)w.removeEventListener(l,f,l===document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(l){const f=this._map,g=f.getCanvasContainer();this._add("mapEvent",new vo(f,l));const b=f.boxZoom=new wo(f,l);this._add("boxZoom",b),l.interactive&&l.boxZoom&&b.enable();const k=f.cooperativeGestures=new rn(f,l.cooperativeGestures);this._add("cooperativeGestures",k),l.cooperativeGestures&&k.enable();const E=new Yd(f),A=new hf(f);f.doubleClickZoom=new cu(A,E),this._add("tapZoom",E),this._add("clickZoom",A),l.interactive&&l.doubleClickZoom&&f.doubleClickZoom.enable();const B=new ff;this._add("tapDragZoom",B);const G=f.touchPitch=new uf(f);this._add("touchPitch",G),l.interactive&&l.touchPitch&&f.touchPitch.enable(l.touchPitch);const X=fa(l),Y=da(l);f.dragRotate=new xo(l,X,Y),this._add("mouseRotate",X,["mousePitch"]),this._add("mousePitch",Y,["mouseRotate"]),l.interactive&&l.dragRotate&&f.dragRotate.enable();const pe=(({enable:Je,clickTolerance:Le})=>{const Ve=new qo({checkCorrectEvent:Qe=>w.mouseButton(Qe)===0&&!Qe.ctrlKey});return new ha({clickTolerance:Le,move:(Qe,nt)=>({around:nt,panDelta:nt.sub(Qe)}),activateOnStart:!0,moveStateManager:Ve,enable:Je,assignEvents:Xl})})(l),Se=new af(l,f);f.dragPan=new df(g,pe,Se),this._add("mousePan",pe),this._add("touchPan",Se,["touchZoom","touchRotate"]),l.interactive&&l.dragPan&&f.dragPan.enable(l.dragPan);const ke=new lu,Me=new cf;f.touchZoomRotate=new tl(g,Me,ke,B),this._add("touchRotate",ke,["touchPan","touchZoom"]),this._add("touchZoom",Me,["touchPan","touchRotate"]),l.interactive&&l.touchZoomRotate&&f.touchZoomRotate.enable(l.touchZoomRotate);const ye=f.scrollZoom=new Ql(f,()=>this._triggerRenderFrame());this._add("scrollZoom",ye,["mousePan"]),l.interactive&&l.scrollZoom&&f.scrollZoom.enable(l.scrollZoom);const Fe=f.keyboard=new ws(f);this._add("keyboard",Fe),l.interactive&&l.keyboard&&f.keyboard.enable(),this._add("blockableMapEvent",new Vo(f))}_add(l,f,g){this._handlers.push({handlerName:l,handler:f,allowed:g}),this._handlersById[l]=f}stop(l){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!un(this._eventsInProgress)||this.isZooming()}_blockedByActive(l,f,g){for(const b in l)if(b!==g&&(!f||f.indexOf(b)<0))return!0;return!1}_getMapTouches(l){const f=[];for(const g of l)this._el.contains(g.target)&&f.push(g);return f}mergeHandlerResult(l,f,g,b,k){if(!g)return;a.e(l,g);const E={handlerName:b,originalEvent:g.originalEvent||k};g.zoomDelta!==void 0&&(f.zoom=E),g.panDelta!==void 0&&(f.drag=E),g.pitchDelta!==void 0&&(f.pitch=E),g.bearingDelta!==void 0&&(f.rotate=E)}_applyChanges(){const l={},f={},g={};for(const[b,k,E]of this._changes)b.panDelta&&(l.panDelta=(l.panDelta||new a.P(0,0))._add(b.panDelta)),b.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+b.pitchDelta),b.around!==void 0&&(l.around=b.around),b.pinchAround!==void 0&&(l.pinchAround=b.pinchAround),b.noInertia&&(l.noInertia=b.noInertia),a.e(f,k),a.e(g,E);this._updateMapTransform(l,f,g),this._changes=[]}_updateMapTransform(l,f,g){const b=this._map,k=b._getTransformForUpdate(),E=b.terrain;if(!(nl(l)||E&&this._terrainMovement))return this._fireEvents(f,g,!0);let{panDelta:A,zoomDelta:B,bearingDelta:G,pitchDelta:X,around:Y,pinchAround:pe}=l;pe!==void 0&&(Y=pe),b._stop(!0),Y=Y||b.transform.centerPoint;const Se=k.pointLocation(A?Y.sub(A):Y);G&&(k.bearing+=G),X&&(k.pitch+=X),B&&(k.zoom+=B),E?this._terrainMovement||!f.drag&&!f.zoom?f.drag&&this._terrainMovement?k.center=k.pointLocation(k.centerPoint.sub(A)):k.setLocationAtPoint(Se,Y):(this._terrainMovement=!0,this._map._elevationFreeze=!0,k.setLocationAtPoint(Se,Y),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,k.recalculateZoom(b.terrain)})):k.setLocationAtPoint(Se,Y),b._applyUpdatedTransform(k),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,g,!0)}_fireEvents(l,f,g){const b=un(this._eventsInProgress),k=un(l),E={};for(const X in l){const{originalEvent:Y}=l[X];this._eventsInProgress[X]||(E[`${X}start`]=Y),this._eventsInProgress[X]=l[X]}!b&&k&&this._fireEvent("movestart",k.originalEvent);for(const X in E)this._fireEvent(X,E[X]);k&&this._fireEvent("move",k.originalEvent);for(const X in l){const{originalEvent:Y}=l[X];this._fireEvent(X,Y)}const A={};let B;for(const X in this._eventsInProgress){const{handlerName:Y,originalEvent:pe}=this._eventsInProgress[X];this._handlersById[Y].isActive()||(delete this._eventsInProgress[X],B=f[Y]||pe,A[`${X}end`]=B)}for(const X in A)this._fireEvent(X,A[X]);const G=un(this._eventsInProgress);if(g&&(b||k)&&!G){this._updatingCamera=!0;const X=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Y=pe=>pe!==0&&-this._bearingSnap<pe&&pe<this._bearingSnap;!X||!X.essential&&_.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:B})),Y(this._map.getBearing())&&this._map.resetNorth()):(Y(X.bearing||this._map.getBearing())&&(X.bearing=0),X.freezeElevation=!0,this._map.easeTo(X,{originalEvent:B})),this._updatingCamera=!1}}_fireEvent(l,f){this._map.fire(new a.k(l,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{delete this._frameId,this.handleEvent(new ec("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Fi extends a.E{constructor(l,f){super(),this._renderFrameCallback=()=>{const g=Math.min((_.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(g)),g<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=f.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.M(this.transform.center.lng,this.transform.center.lat)}setCenter(l,f){return this.jumpTo({center:l},f)}panBy(l,f,g){return l=a.P.convert(l).mult(-1),this.panTo(this.transform.center,a.e({offset:l},f),g)}panTo(l,f,g){return this.easeTo(a.e({center:l},f),g)}getZoom(){return this.transform.zoom}setZoom(l,f){return this.jumpTo({zoom:l},f),this}zoomTo(l,f,g){return this.easeTo(a.e({zoom:l},f),g)}zoomIn(l,f){return this.zoomTo(this.getZoom()+1,l,f),this}zoomOut(l,f){return this.zoomTo(this.getZoom()-1,l,f),this}getBearing(){return this.transform.bearing}setBearing(l,f){return this.jumpTo({bearing:l},f),this}getPadding(){return this.transform.padding}setPadding(l,f){return this.jumpTo({padding:l},f),this}rotateTo(l,f,g){return this.easeTo(a.e({bearing:l},f),g)}resetNorth(l,f){return this.rotateTo(0,a.e({duration:1e3},l),f),this}resetNorthPitch(l,f){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},l),f),this}snapToNorth(l,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,f):this}getPitch(){return this.transform.pitch}setPitch(l,f){return this.jumpTo({pitch:l},f),this}cameraForBounds(l,f){l=Ne.convert(l);const g=f&&f.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),g,f)}_cameraForBoxAndBearing(l,f,g,b){const k={top:0,bottom:0,right:0,left:0};if(typeof(b=a.e({padding:k,offset:[0,0],maxZoom:this.transform.maxZoom},b)).padding=="number"){const zt=b.padding;b.padding={top:zt,bottom:zt,right:zt,left:zt}}b.padding=a.e(k,b.padding);const E=this.transform,A=E.padding,B=new Ne(l,f),G=E.project(B.getNorthWest()),X=E.project(B.getNorthEast()),Y=E.project(B.getSouthEast()),pe=E.project(B.getSouthWest()),Se=a.b8(-g),ke=G.rotate(Se),Me=X.rotate(Se),ye=Y.rotate(Se),Fe=pe.rotate(Se),Je=new a.P(Math.max(ke.x,Me.x,Fe.x,ye.x),Math.max(ke.y,Me.y,Fe.y,ye.y)),Le=new a.P(Math.min(ke.x,Me.x,Fe.x,ye.x),Math.min(ke.y,Me.y,Fe.y,ye.y)),Ve=Je.sub(Le),Qe=(E.width-(A.left+A.right+b.padding.left+b.padding.right))/Ve.x,nt=(E.height-(A.top+A.bottom+b.padding.top+b.padding.bottom))/Ve.y;if(nt<0||Qe<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ot=Math.min(E.scaleZoom(E.scale*Math.min(Qe,nt)),b.maxZoom),gt=a.P.convert(b.offset),dt=new a.P((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(a.b8(g)),It=gt.add(dt).mult(E.scale/E.zoomScale(ot));return{center:E.unproject(G.add(Y).div(2).sub(It)),zoom:ot,bearing:g}}fitBounds(l,f,g){return this._fitInternal(this.cameraForBounds(l,f),f,g)}fitScreenCoordinates(l,f,g,b,k){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(l)),this.transform.pointLocation(a.P.convert(f)),g,b),b,k)}_fitInternal(l,f,g){return l?(delete(f=a.e(l,f)).padding,f.linear?this.easeTo(f,g):this.flyTo(f,g)):this}jumpTo(l,f){this.stop();const g=this._getTransformForUpdate();let b=!1,k=!1,E=!1;return"zoom"in l&&g.zoom!==+l.zoom&&(b=!0,g.zoom=+l.zoom),l.center!==void 0&&(g.center=a.M.convert(l.center)),"bearing"in l&&g.bearing!==+l.bearing&&(k=!0,g.bearing=+l.bearing),"pitch"in l&&g.pitch!==+l.pitch&&(E=!0,g.pitch=+l.pitch),l.padding==null||g.isPaddingEqual(l.padding)||(g.padding=l.padding),this._applyUpdatedTransform(g),this.fire(new a.k("movestart",f)).fire(new a.k("move",f)),b&&this.fire(new a.k("zoomstart",f)).fire(new a.k("zoom",f)).fire(new a.k("zoomend",f)),k&&this.fire(new a.k("rotatestart",f)).fire(new a.k("rotate",f)).fire(new a.k("rotateend",f)),E&&this.fire(new a.k("pitchstart",f)).fire(new a.k("pitch",f)).fire(new a.k("pitchend",f)),this.fire(new a.k("moveend",f))}calculateCameraOptionsFromTo(l,f,g,b=0){const k=a.Y.fromLngLat(l,f),E=a.Y.fromLngLat(g,b),A=E.x-k.x,B=E.y-k.y,G=E.z-k.z,X=Math.hypot(A,B,G);if(X===0)throw new Error("Can't calculate camera options with same From and To");const Y=Math.hypot(A,B),pe=this.transform.scaleZoom(this.transform.cameraToCenterDistance/X/this.transform.tileSize),Se=180*Math.atan2(A,-B)/Math.PI;let ke=180*Math.acos(Y/X)/Math.PI;return ke=G<0?90-ke:90+ke,{center:E.toLngLat(),zoom:pe,pitch:ke,bearing:Se}}easeTo(l,f){var g;this._stop(!1,l.easeId),((l=a.e({offset:[0,0],duration:500,easing:a.b7},l)).animate===!1||!l.essential&&_.prefersReducedMotion)&&(l.duration=0);const b=this._getTransformForUpdate(),k=this.getZoom(),E=this.getBearing(),A=this.getPitch(),B=this.getPadding(),G="bearing"in l?this._normalizeBearing(l.bearing,E):E,X="pitch"in l?+l.pitch:A,Y="padding"in l?l.padding:b.padding,pe=a.P.convert(l.offset);let Se=b.centerPoint.add(pe);const ke=b.pointLocation(Se),{center:Me,zoom:ye}=b.getConstrained(a.M.convert(l.center||ke),(g=l.zoom)!==null&&g!==void 0?g:k);this._normalizeCenter(Me);const Fe=b.project(ke),Je=b.project(Me).sub(Fe),Le=b.zoomScale(ye-k);let Ve,Qe;l.around&&(Ve=a.M.convert(l.around),Qe=b.locationPoint(Ve));const nt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ye!==k,this._rotating=this._rotating||E!==G,this._pitching=this._pitching||X!==A,this._padding=!b.isPaddingEqual(Y),this._easeId=l.easeId,this._prepareEase(f,l.noMoveStart,nt),this.terrain&&this._prepareElevation(Me),this._ease(ot=>{if(this._zooming&&(b.zoom=a.z.number(k,ye,ot)),this._rotating&&(b.bearing=a.z.number(E,G,ot)),this._pitching&&(b.pitch=a.z.number(A,X,ot)),this._padding&&(b.interpolatePadding(B,Y,ot),Se=b.centerPoint.add(pe)),this.terrain&&!l.freezeElevation&&this._updateElevation(ot),Ve)b.setLocationAtPoint(Ve,Qe);else{const gt=b.zoomScale(b.zoom-k),dt=ye>k?Math.min(2,Le):Math.max(.5,Le),It=Math.pow(dt,1-ot),zt=b.unproject(Fe.add(Je.mult(ot*It)).mult(gt));b.setLocationAtPoint(b.renderWorldCopies?zt.wrap():zt,Se)}this._applyUpdatedTransform(b),this._fireMoveEvents(f)},ot=>{this.terrain&&this._finalizeElevation(),this._afterEase(f,ot)},l),this}_prepareEase(l,f,g={}){this._moving=!0,f||g.moving||this.fire(new a.k("movestart",l)),this._zooming&&!g.zooming&&this.fire(new a.k("zoomstart",l)),this._rotating&&!g.rotating&&this.fire(new a.k("rotatestart",l)),this._pitching&&!g.pitching&&this.fire(new a.k("pitchstart",l))}_prepareElevation(l){this._elevationCenter=l,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(l){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const f=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(l<1&&f!==this._elevationTarget){const g=this._elevationTarget-this._elevationStart;this._elevationStart+=l*(g-(f-(g*l+this._elevationStart))/(1-l)),this._elevationTarget=f}this.transform.elevation=a.z.number(this._elevationStart,this._elevationTarget,l)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(l){if(!this.transformCameraUpdate)return;const f=l.clone(),{center:g,zoom:b,pitch:k,bearing:E,elevation:A}=this.transformCameraUpdate(f);g&&(f.center=g),b!==void 0&&(f.zoom=b),k!==void 0&&(f.pitch=k),E!==void 0&&(f.bearing=E),A!==void 0&&(f.elevation=A),this.transform.apply(f)}_fireMoveEvents(l){this.fire(new a.k("move",l)),this._zooming&&this.fire(new a.k("zoom",l)),this._rotating&&this.fire(new a.k("rotate",l)),this._pitching&&this.fire(new a.k("pitch",l))}_afterEase(l,f){if(this._easeId&&f&&this._easeId===f)return;delete this._easeId;const g=this._zooming,b=this._rotating,k=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new a.k("zoomend",l)),b&&this.fire(new a.k("rotateend",l)),k&&this.fire(new a.k("pitchend",l)),this.fire(new a.k("moveend",l))}flyTo(l,f){var g;if(!l.essential&&_.prefersReducedMotion){const jn=a.L(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(jn,f)}this.stop(),l=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.b7},l);const b=this._getTransformForUpdate(),k=this.getZoom(),E=this.getBearing(),A=this.getPitch(),B=this.getPadding(),G="bearing"in l?this._normalizeBearing(l.bearing,E):E,X="pitch"in l?+l.pitch:A,Y="padding"in l?l.padding:b.padding,pe=a.P.convert(l.offset);let Se=b.centerPoint.add(pe);const ke=b.pointLocation(Se),{center:Me,zoom:ye}=b.getConstrained(a.M.convert(l.center||ke),(g=l.zoom)!==null&&g!==void 0?g:k);this._normalizeCenter(Me);const Fe=b.zoomScale(ye-k),Je=b.project(ke),Le=b.project(Me).sub(Je);let Ve=l.curve;const Qe=Math.max(b.width,b.height),nt=Qe/Fe,ot=Le.mag();if("minZoom"in l){const jn=a.ac(Math.min(l.minZoom,k,ye),b.minZoom,b.maxZoom),gn=Qe/b.zoomScale(jn-k);Ve=Math.sqrt(gn/ot*2)}const gt=Ve*Ve;function dt(jn){const gn=(nt*nt-Qe*Qe+(jn?-1:1)*gt*gt*ot*ot)/(2*(jn?nt:Qe)*gt*ot);return Math.log(Math.sqrt(gn*gn+1)-gn)}function It(jn){return(Math.exp(jn)-Math.exp(-jn))/2}function zt(jn){return(Math.exp(jn)+Math.exp(-jn))/2}const yn=dt(!1);let Rt=function(jn){return zt(yn)/zt(yn+Ve*jn)},dn=function(jn){return Qe*((zt(yn)*(It(gn=yn+Ve*jn)/zt(gn))-It(yn))/gt)/ot;var gn},bn=(dt(!0)-yn)/Ve;if(Math.abs(ot)<1e-6||!isFinite(bn)){if(Math.abs(Qe-nt)<1e-6)return this.easeTo(l,f);const jn=nt<Qe?-1:1;bn=Math.abs(Math.log(nt/Qe))/Ve,dn=function(){return 0},Rt=function(gn){return Math.exp(jn*Ve*gn)}}return l.duration="duration"in l?+l.duration:1e3*bn/("screenSpeed"in l?+l.screenSpeed/Ve:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=E!==G,this._pitching=X!==A,this._padding=!b.isPaddingEqual(Y),this._prepareEase(f,!1),this.terrain&&this._prepareElevation(Me),this._ease(jn=>{const gn=jn*bn,kn=1/Rt(gn);b.zoom=jn===1?ye:k+b.scaleZoom(kn),this._rotating&&(b.bearing=a.z.number(E,G,jn)),this._pitching&&(b.pitch=a.z.number(A,X,jn)),this._padding&&(b.interpolatePadding(B,Y,jn),Se=b.centerPoint.add(pe)),this.terrain&&!l.freezeElevation&&this._updateElevation(jn);const Pn=jn===1?Me:b.unproject(Je.add(Le.mult(dn(gn))).mult(kn));b.setLocationAtPoint(b.renderWorldCopies?Pn.wrap():Pn,Se),this._applyUpdatedTransform(b),this._fireMoveEvents(f)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(f)},l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,f)}if(!l){const g=this.handlers;g&&g.stop(!1)}return this}_ease(l,f,g){g.animate===!1||g.duration===0?(l(1),f()):(this._easeStart=_.now(),this._easeOptions=g,this._onEaseFrame=l,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(l,f){l=a.b1(l,-180,180);const g=Math.abs(l-f);return Math.abs(l-360-f)<g&&(l-=360),Math.abs(l+360-f)<g&&(l+=360),l}_normalizeCenter(l){const f=this.transform;if(!f.renderWorldCopies||f.lngRange)return;const g=l.lng-f.center.lng;l.lng+=g>180?-360:g<-180?360:0}queryTerrainElevation(l){return this.terrain?this.terrain.getElevationForLngLatZoom(a.M.convert(l),this.transform.tileZoom)-this.transform.elevation:null}}const hu={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ko{constructor(l=hu){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=f=>{!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"&&f.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=l}getDefaultPosition(){return"bottom-right"}onAdd(l){return this._map=l,this._compact=this.options.compact,this._container=w.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=w.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=w.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){w.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(l,f){const g=this._map._getUIString(`AttributionControl.${f}`);l.title=g,l.setAttribute("aria-label",g)}_updateAttributions(){if(!this._map.style)return;let l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(b=>typeof b!="string"?"":b)):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const f=this._map.style.sourceCaches;for(const b in f){const k=f[b];if(k.used||k.usedForTerrain){const E=k.getSource();E.attribution&&l.indexOf(E.attribution)<0&&l.push(E.attribution)}}l=l.filter(b=>String(b).trim()),l.sort((b,k)=>b.length-k.length),l=l.filter((b,k)=>{for(let E=k+1;E<l.length;E++)if(l[E].indexOf(b)>=0)return!1;return!0});const g=l.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,l.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class pf{constructor(l={}){this._updateCompact=()=>{const f=this._container.children;if(f.length){const g=f[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&g.classList.add("maplibregl-compact"):g.classList.remove("maplibregl-compact")}},this.options=l}getDefaultPosition(){return"bottom-left"}onAdd(l){this._map=l,this._compact=this.options&&this.options.compact,this._container=w.create("div","maplibregl-ctrl");const f=w.create("a","maplibregl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://maplibre.org/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){w.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class rl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f}remove(l){const f=this._currentlyRunning,g=f?this._queue.concat(f):this._queue;for(const b of g)if(b.id===l)return void(b.cancelled=!0)}run(l=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const f=this._currentlyRunning=this._queue;this._queue=[];for(const g of f)if(!g.cancelled&&(g.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Dr=a.X([{name:"a_pos3d",type:"Int16",components:3}]);class Ur extends a.E{constructor(l){super(),this.sourceCache=l,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,l.usedForTerrain=!0,l.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(l,f){this.sourceCache.update(l,f),this._renderableTilesKeys=[];const g={};for(const b of l.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:f}))g[b.key]=!0,this._renderableTilesKeys.push(b.key),this._tiles[b.key]||(b.posMatrix=new Float64Array(16),a.aN(b.posMatrix,0,a.W,0,a.W,0,1),this._tiles[b.key]=new wr(b,this.tileSize));for(const b in this._tiles)g[b]||delete this._tiles[b]}freeRtt(l){for(const f in this._tiles){const g=this._tiles[f];(!l||g.tileID.equals(l)||g.tileID.isChildOf(l)||l.isChildOf(g.tileID))&&(g.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(l=>this.getTileByID(l))}getTileByID(l){return this._tiles[l]}getTerrainCoords(l){const f={};for(const g of this._renderableTilesKeys){const b=this._tiles[g].tileID;if(b.canonical.equals(l.canonical)){const k=l.clone();k.posMatrix=new Float64Array(16),a.aN(k.posMatrix,0,a.W,0,a.W,0,1),f[g]=k}else if(b.canonical.isChildOf(l.canonical)){const k=l.clone();k.posMatrix=new Float64Array(16);const E=b.canonical.z-l.canonical.z,A=b.canonical.x-(b.canonical.x>>E<<E),B=b.canonical.y-(b.canonical.y>>E<<E),G=a.W>>E;a.aN(k.posMatrix,0,G,0,G,0,1),a.H(k.posMatrix,k.posMatrix,[-A*G,-B*G,0]),f[g]=k}else if(l.canonical.isChildOf(b.canonical)){const k=l.clone();k.posMatrix=new Float64Array(16);const E=l.canonical.z-b.canonical.z,A=l.canonical.x-(l.canonical.x>>E<<E),B=l.canonical.y-(l.canonical.y>>E<<E),G=a.W>>E;a.aN(k.posMatrix,0,a.W,0,a.W,0,1),a.H(k.posMatrix,k.posMatrix,[A*G,B*G,0]),a.J(k.posMatrix,k.posMatrix,[1/2**E,1/2**E,0]),f[g]=k}}return f}getSourceTile(l,f){const g=this.sourceCache._source;let b=l.overscaledZ-this.deltaZoom;if(b>g.maxzoom&&(b=g.maxzoom),b<g.minzoom)return null;this._sourceTileCache[l.key]||(this._sourceTileCache[l.key]=l.scaledTo(b).key);let k=this.sourceCache.getTileByID(this._sourceTileCache[l.key]);if((!k||!k.dem)&&f)for(;b>=g.minzoom&&(!k||!k.dem);)k=this.sourceCache.getTileByID(l.scaledTo(b--).key);return k}tilesAfterTime(l=Date.now()){return Object.values(this._tiles).filter(f=>f.timeAdded>=l)}}class mf{constructor(l,f,g){this.painter=l,this.sourceCache=new Ur(f),this.options=g,this.exaggeration=typeof g.exaggeration=="number"?g.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(l,f,g,b=a.W){var k;if(!(f>=0&&f<b&&g>=0&&g<b))return 0;const E=this.getTerrainData(l),A=(k=E.tile)===null||k===void 0?void 0:k.dem;if(!A)return 0;const B=function(ke,Me,ye){var Fe=Me[0],Je=Me[1];return ke[0]=ye[0]*Fe+ye[4]*Je+ye[12],ke[1]=ye[1]*Fe+ye[5]*Je+ye[13],ke}([],[f/b*a.W,g/b*a.W],E.u_terrain_matrix),G=[B[0]*A.dim,B[1]*A.dim],X=Math.floor(G[0]),Y=Math.floor(G[1]),pe=G[0]-X,Se=G[1]-Y;return A.get(X,Y)*(1-pe)*(1-Se)+A.get(X+1,Y)*pe*(1-Se)+A.get(X,Y+1)*(1-pe)*Se+A.get(X+1,Y+1)*pe*Se}getElevationForLngLatZoom(l,f){const{tileID:g,mercatorX:b,mercatorY:k}=this._getOverscaledTileIDFromLngLatZoom(l,f);return this.getElevation(g,b%a.W,k%a.W,a.W)}getElevation(l,f,g,b=a.W){return this.getDEMElevation(l,f,g,b)*this.exaggeration}getTerrainData(l){if(!this._emptyDemTexture){const b=this.painter.context,k=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Q(b,k,b.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Q(b,new a.R({width:1,height:1}),b.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(b.gl.NEAREST,b.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.an([])}const f=this.sourceCache.getSourceTile(l,!0);if(f&&f.dem&&(!f.demTexture||f.needsTerrainPrepare)){const b=this.painter.context;f.demTexture=this.painter.getTileTexture(f.dem.stride),f.demTexture?f.demTexture.update(f.dem.getPixels(),{premultiply:!1}):f.demTexture=new Q(b,f.dem.getPixels(),b.gl.RGBA,{premultiply:!1}),f.demTexture.bind(b.gl.NEAREST,b.gl.CLAMP_TO_EDGE),f.needsTerrainPrepare=!1}const g=f&&f+f.tileID.key+l.key;if(g&&!this._demMatrixCache[g]){const b=this.sourceCache.sourceCache._source.maxzoom;let k=l.canonical.z-f.tileID.canonical.z;l.overscaledZ>l.canonical.z&&(l.canonical.z>=b?k=l.canonical.z-b:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const E=l.canonical.x-(l.canonical.x>>k<<k),A=l.canonical.y-(l.canonical.y>>k<<k),B=a.b9(new Float64Array(16),[1/(a.W<<k),1/(a.W<<k),0]);a.H(B,B,[E*a.W,A*a.W,0]),this._demMatrixCache[l.key]={matrix:B,coord:l}}return{u_depth:2,u_terrain:3,u_terrain_dim:f&&f.dem&&f.dem.dim||1,u_terrain_matrix:g?this._demMatrixCache[l.key].matrix:this._emptyDemMatrix,u_terrain_unpack:f&&f.dem&&f.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(f&&f.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:f}}getFramebuffer(l){const f=this.painter,g=f.width/devicePixelRatio,b=f.height/devicePixelRatio;return!this._fbo||this._fbo.width===g&&this._fbo.height===b||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Q(f.context,{width:g,height:b,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Q(f.context,{width:g,height:b,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=f.context.createFramebuffer(g,b,!0,!1),this._fbo.depthAttachment.set(f.context.createRenderbuffer(f.context.gl.DEPTH_COMPONENT16,g,b))),this._fbo.colorAttachment.set(l==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const l=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const f=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let k=0,E=0;k<this._coordsTextureSize;k++)for(let A=0;A<this._coordsTextureSize;A++,E+=4)f[E+0]=255&A,f[E+1]=255&k,f[E+2]=A>>8<<4|k>>8,f[E+3]=0;const g=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(f.buffer)),b=new Q(l,g,l.gl.RGBA,{premultiply:!1});return b.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._coordsTexture=b,b}pointCoordinate(l){this.painter.maybeDrawDepthAndCoords(!0);const f=new Uint8Array(4),g=this.painter.context,b=g.gl,k=Math.round(l.x*this.painter.pixelRatio/devicePixelRatio),E=Math.round(l.y*this.painter.pixelRatio/devicePixelRatio),A=Math.round(this.painter.height/devicePixelRatio);g.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),b.readPixels(k,A-E-1,1,1,b.RGBA,b.UNSIGNED_BYTE,f),g.bindFramebuffer.set(null);const B=f[0]+(f[2]>>4<<8),G=f[1]+((15&f[2])<<8),X=this.coordsIndex[255-f[3]],Y=X&&this.sourceCache.getTileByID(X);if(!Y)return null;const pe=this._coordsTextureSize,Se=(1<<Y.tileID.canonical.z)*pe;return new a.Y((Y.tileID.canonical.x*pe+B)/Se+Y.tileID.wrap,(Y.tileID.canonical.y*pe+G)/Se,this.getElevation(Y.tileID,B,G,pe))}depthAtPoint(l){const f=new Uint8Array(4),g=this.painter.context,b=g.gl;return g.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),b.readPixels(l.x,this.painter.height/devicePixelRatio-l.y-1,1,1,b.RGBA,b.UNSIGNED_BYTE,f),g.bindFramebuffer.set(null),(f[0]/16777216+f[1]/65536+f[2]/256+f[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const l=this.painter.context,f=new a.ba,g=new a.aX,b=this.meshSize,k=a.W/b,E=b*b;for(let Y=0;Y<=b;Y++)for(let pe=0;pe<=b;pe++)f.emplaceBack(pe*k,Y*k,0);for(let Y=0;Y<E;Y+=b+1)for(let pe=0;pe<b;pe++)g.emplaceBack(pe+Y,b+pe+Y+1,b+pe+Y+2),g.emplaceBack(pe+Y,b+pe+Y+2,pe+Y+1);const A=f.length,B=A+2*(b+1);for(const Y of[0,1])for(let pe=0;pe<=b;pe++)for(const Se of[0,1])f.emplaceBack(pe*k,Y*a.W,Se);for(let Y=0;Y<2*b;Y+=2)g.emplaceBack(B+Y,B+Y+1,B+Y+3),g.emplaceBack(B+Y,B+Y+3,B+Y+2),g.emplaceBack(A+Y,A+Y+3,A+Y+1),g.emplaceBack(A+Y,A+Y+2,A+Y+3);const G=f.length,X=G+2*(b+1);for(const Y of[0,1])for(let pe=0;pe<=b;pe++)for(const Se of[0,1])f.emplaceBack(Y*a.W,pe*k,Se);for(let Y=0;Y<2*b;Y+=2)g.emplaceBack(G+Y,G+Y+1,G+Y+3),g.emplaceBack(G+Y,G+Y+3,G+Y+2),g.emplaceBack(X+Y,X+Y+3,X+Y+1),g.emplaceBack(X+Y,X+Y+2,X+Y+3);return this._mesh={indexBuffer:l.createIndexBuffer(g),vertexBuffer:l.createVertexBuffer(f,Dr.members),segments:a.$.simpleSegment(0,0,f.length,g.length)},this._mesh}getMeshFrameDelta(l){return 2*Math.PI*a.bb/Math.pow(2,l)/5}getMinTileElevationForLngLatZoom(l,f){var g;const{tileID:b}=this._getOverscaledTileIDFromLngLatZoom(l,f);return(g=this.getMinMaxElevation(b).minElevation)!==null&&g!==void 0?g:0}getMinMaxElevation(l){const f=this.getTerrainData(l).tile,g={minElevation:null,maxElevation:null};return f&&f.dem&&(g.minElevation=f.dem.min*this.exaggeration,g.maxElevation=f.dem.max*this.exaggeration),g}_getOverscaledTileIDFromLngLatZoom(l,f){const g=a.Y.fromLngLat(l.wrap()),b=(1<<f)*a.W,k=g.x*b,E=g.y*b,A=Math.floor(k/a.W),B=Math.floor(E/a.W);return{tileID:new a.Q(f,0,f,A,B),mercatorX:k,mercatorY:E}}}class il{constructor(l,f,g){this._context=l,this._size=f,this._tileSize=g,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const l of this._objects)l.texture.destroy(),l.fbo.destroy()}_createObject(l){const f=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),g=new Q(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return g.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),f.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),f.colorAttachment.set(g.texture),{id:l,fbo:f,texture:g,stamp:-1,inUse:!1}}getObjectForId(l){return this._objects[l]}useObject(l){l.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(f=>l.id!==f),this._recentlyUsed.push(l.id)}stampObject(l){l.stamp=++this._stamp}getOrCreateFreeObject(){for(const f of this._recentlyUsed)if(!this._objects[f].inUse)return this._objects[f];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const l=this._createObject(this._objects.length);return this._objects.push(l),l}freeObject(l){l.inUse=!1}freeAllObjects(){for(const l of this._objects)this.freeObject(l)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(l=>!l.inUse)===!1}}const ns={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class fu{constructor(l,f){this.painter=l,this.terrain=f,this.pool=new il(l.context,30,f.sourceCache.tileSize*f.qualityFactor)}destruct(){this.pool.destruct()}getTexture(l){return this.pool.getObjectForId(l.rtt[this._stacks.length-1].id).texture}prepareForRender(l,f){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=l._order.filter(g=>!l._layers[g].isHidden(f)),this._coordsDescendingInv={};for(const g in l.sourceCaches){this._coordsDescendingInv[g]={};const b=l.sourceCaches[g].getVisibleCoordinates();for(const k of b){const E=this.terrain.sourceCache.getTerrainCoords(k);for(const A in E)this._coordsDescendingInv[g][A]||(this._coordsDescendingInv[g][A]=[]),this._coordsDescendingInv[g][A].push(E[A])}}this._coordsDescendingInvStr={};for(const g of l._order){const b=l._layers[g],k=b.source;if(ns[b.type]&&!this._coordsDescendingInvStr[k]){this._coordsDescendingInvStr[k]={};for(const E in this._coordsDescendingInv[k])this._coordsDescendingInvStr[k][E]=this._coordsDescendingInv[k][E].map(A=>A.key).sort().join()}}for(const g of this._renderableTiles)for(const b in this._coordsDescendingInvStr){const k=this._coordsDescendingInvStr[b][g.tileID.key];k&&k!==g.rttCoords[b]&&(g.rtt=[])}}renderLayer(l){if(l.isHidden(this.painter.transform.zoom))return!1;const f=l.type,g=this.painter,b=this._renderableLayerIds[this._renderableLayerIds.length-1]===l.id;if(ns[f]&&(this._prevType&&ns[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(l.id),!b))return!0;if(ns[this._prevType]||ns[f]&&b){this._prevType=f;const k=this._stacks.length-1,E=this._stacks[k]||[];for(const A of this._renderableTiles){if(this.pool.isFull()&&(Wl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(A),A.rtt[k]){const G=this.pool.getObjectForId(A.rtt[k].id);if(G.stamp===A.rtt[k].stamp){this.pool.useObject(G);continue}}const B=this.pool.getOrCreateFreeObject();this.pool.useObject(B),this.pool.stampObject(B),A.rtt[k]={id:B.id,stamp:B.stamp},g.context.bindFramebuffer.set(B.fbo.framebuffer),g.context.clear({color:a.aO.transparent,stencil:0}),g.currentStencilSource=void 0;for(let G=0;G<E.length;G++){const X=g.style._layers[E[G]],Y=X.source?this._coordsDescendingInv[X.source][A.tileID.key]:[A.tileID];g.context.viewport.set([0,0,B.fbo.width,B.fbo.height]),g._renderTileClippingMasks(X,Y),g.renderLayer(g,g.style.sourceCaches[X.source],X,Y),X.source&&(A.rttCoords[X.source]=this._coordsDescendingInvStr[X.source][A.tileID.key])}}return Wl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ns[f]}return!1}}const du={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},pu=d,ol={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:hu,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},tc=x=>{x.touchstart=x.dragStart,x.touchmoveWindow=x.dragMove,x.touchend=x.dragEnd},mu={showCompass:!0,showZoom:!0,visualizePitch:!1};class gu{constructor(l,f,g=!1){this.mousedown=E=>{this.startMouse(a.e({},E,{ctrlKey:!0,preventDefault:()=>E.preventDefault()}),w.mousePos(this.element,E)),w.addEventListener(window,"mousemove",this.mousemove),w.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=E=>{this.moveMouse(E,w.mousePos(this.element,E))},this.mouseup=E=>{this.mouseRotate.dragEnd(E),this.mousePitch&&this.mousePitch.dragEnd(E),this.offTemp()},this.touchstart=E=>{E.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=w.touchPos(this.element,E.targetTouches)[0],this.startTouch(E,this._startPos),w.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.addEventListener(window,"touchend",this.touchend))},this.touchmove=E=>{E.targetTouches.length!==1?this.reset():(this._lastPos=w.touchPos(this.element,E.targetTouches)[0],this.moveTouch(E,this._lastPos))},this.touchend=E=>{E.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const b=l.dragRotate._mouseRotate.getClickTolerance(),k=l.dragRotate._mousePitch.getClickTolerance();this.element=f,this.mouseRotate=fa({clickTolerance:b,enable:!0}),this.touchRotate=(({enable:E,clickTolerance:A,bearingDegreesPerPixelMoved:B=.8})=>{const G=new Ht;return new ha({clickTolerance:A,move:(X,Y)=>({bearingDelta:(Y.x-X.x)*B}),moveStateManager:G,enable:E,assignEvents:tc})})({clickTolerance:b,enable:!0}),this.map=l,g&&(this.mousePitch=da({clickTolerance:k,enable:!0}),this.touchPitch=(({enable:E,clickTolerance:A,pitchDegreesPerPixelMoved:B=-.5})=>{const G=new Ht;return new ha({clickTolerance:A,move:(X,Y)=>({pitchDelta:(Y.y-X.y)*B}),moveStateManager:G,enable:E,assignEvents:tc})})({clickTolerance:k,enable:!0})),w.addEventListener(f,"mousedown",this.mousedown),w.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),w.addEventListener(f,"touchcancel",this.reset)}startMouse(l,f){this.mouseRotate.dragStart(l,f),this.mousePitch&&this.mousePitch.dragStart(l,f),w.disableDrag()}startTouch(l,f){this.touchRotate.dragStart(l,f),this.touchPitch&&this.touchPitch.dragStart(l,f),w.disableDrag()}moveMouse(l,f){const g=this.map,{bearingDelta:b}=this.mouseRotate.dragMove(l,f)||{};if(b&&g.setBearing(g.getBearing()+b),this.mousePitch){const{pitchDelta:k}=this.mousePitch.dragMove(l,f)||{};k&&g.setPitch(g.getPitch()+k)}}moveTouch(l,f){const g=this.map,{bearingDelta:b}=this.touchRotate.dragMove(l,f)||{};if(b&&g.setBearing(g.getBearing()+b),this.touchPitch){const{pitchDelta:k}=this.touchPitch.dragMove(l,f)||{};k&&g.setPitch(g.getPitch()+k)}}off(){const l=this.element;w.removeEventListener(l,"mousedown",this.mousedown),w.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),w.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.removeEventListener(window,"touchend",this.touchend),w.removeEventListener(l,"touchcancel",this.reset),this.offTemp()}offTemp(){w.enableDrag(),w.removeEventListener(window,"mousemove",this.mousemove),w.removeEventListener(window,"mouseup",this.mouseup),w.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.removeEventListener(window,"touchend",this.touchend)}}let rs;function nc(x,l,f){const g=new a.M(x.lng,x.lat);if(x=new a.M(x.lng,x.lat),l){const b=new a.M(x.lng-360,x.lat),k=new a.M(x.lng+360,x.lat),E=f.locationPoint(x).distSqr(l);f.locationPoint(b).distSqr(l)<E?x=b:f.locationPoint(k).distSqr(l)<E&&(x=k)}for(;Math.abs(x.lng-f.center.lng)>180;){const b=f.locationPoint(x);if(b.x>=0&&b.y>=0&&b.x<=f.width&&b.y<=f.height)break;x.lng>f.center.lng?x.lng-=360:x.lng+=360}return x.lng!==g.lng&&f.locationPoint(x).y>f.height/2-f.getHorizon()?x:g}const sl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function rc(x,l,f){const g=x.classList;for(const b in sl)g.remove(`maplibregl-${f}-anchor-${b}`);g.add(`maplibregl-${f}-anchor-${l}`)}class al extends a.E{constructor(l){if(super(),this._onKeyPress=f=>{const g=f.code,b=f.charCode||f.keyCode;g!=="Space"&&g!=="Enter"&&b!==32&&b!==13||this.togglePopup()},this._onMapClick=f=>{const g=f.originalEvent.target,b=this._element;this._popup&&(g===b||b.contains(g))&&this.togglePopup()},this._update=f=>{var g;if(!this._map)return;const b=this._map.loaded()&&!this._map.isMoving();((f==null?void 0:f.type)==="terrain"||(f==null?void 0:f.type)==="render"&&!b)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?nc(this._lngLat,this._flatPos,this._map.transform):(g=this._lngLat)===null||g===void 0?void 0:g.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let k="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?k=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(k=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E=`rotateX(${this._map.getPitch()}deg)`),f&&f.type!=="moveend"||(this._pos=this._pos.round()),w.setTransform(this._element,`${sl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${E} ${k}`),_.frameAsync(new AbortController).then(()=>{this._updateOpacity(f&&f.type==="moveend")}).catch(()=>{})},this._onMove=f=>{if(!this._isDragging){const g=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=f=>{this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment!=="auto"?l.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(l==null?void 0:l.opacity,l==null?void 0:l.opacityWhenCovered),l&&l.element)this._element=l.element,this._offset=a.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=w.create("div"),this._element.setAttribute("aria-label","Map marker");const f=w.createNS("http://www.w3.org/2000/svg","svg"),g=41,b=27;f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height",`${g}px`),f.setAttributeNS(null,"width",`${b}px`),f.setAttributeNS(null,"viewBox",`0 0 ${b} ${g}`);const k=w.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"stroke","none"),k.setAttributeNS(null,"stroke-width","1"),k.setAttributeNS(null,"fill","none"),k.setAttributeNS(null,"fill-rule","evenodd");const E=w.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");const A=w.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"transform","translate(3.0, 29.0)"),A.setAttributeNS(null,"fill","#000000");const B=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Fe of B){const Je=w.createNS("http://www.w3.org/2000/svg","ellipse");Je.setAttributeNS(null,"opacity","0.04"),Je.setAttributeNS(null,"cx","10.5"),Je.setAttributeNS(null,"cy","5.80029008"),Je.setAttributeNS(null,"rx",Fe.rx),Je.setAttributeNS(null,"ry",Fe.ry),A.appendChild(Je)}const G=w.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"fill",this._color);const X=w.createNS("http://www.w3.org/2000/svg","path");X.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),G.appendChild(X);const Y=w.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"opacity","0.25"),Y.setAttributeNS(null,"fill","#000000");const pe=w.createNS("http://www.w3.org/2000/svg","path");pe.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Y.appendChild(pe);const Se=w.createNS("http://www.w3.org/2000/svg","g");Se.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Se.setAttributeNS(null,"fill","#FFFFFF");const ke=w.createNS("http://www.w3.org/2000/svg","g");ke.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Me=w.createNS("http://www.w3.org/2000/svg","circle");Me.setAttributeNS(null,"fill","#000000"),Me.setAttributeNS(null,"opacity","0.25"),Me.setAttributeNS(null,"cx","5.5"),Me.setAttributeNS(null,"cy","5.5"),Me.setAttributeNS(null,"r","5.4999962");const ye=w.createNS("http://www.w3.org/2000/svg","circle");ye.setAttributeNS(null,"fill","#FFFFFF"),ye.setAttributeNS(null,"cx","5.5"),ye.setAttributeNS(null,"cy","5.5"),ye.setAttributeNS(null,"r","5.4999962"),ke.appendChild(Me),ke.appendChild(ye),E.appendChild(A),E.appendChild(G),E.appendChild(Y),E.appendChild(Se),E.appendChild(ke),f.appendChild(E),f.setAttributeNS(null,"height",g*this._scale+"px"),f.setAttributeNS(null,"width",b*this._scale+"px"),this._element.appendChild(f),this._offset=a.P.convert(l&&l.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()}),rc(this._element,this._anchor,"marker"),l&&l.className)for(const f of l.className.split(" "))this._element.classList.add(f);this._popup=null}addTo(l){return this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),l.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),w.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=a.M.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const b=Math.abs(13.5)/Math.SQRT2;l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const l=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:l?(l.isOpen()?l.remove():(l.setLngLat(this._lngLat),l.addTo(this._map)),this):this}_updateOpacity(l=!1){var f,g;if(!(!((f=this._map)===null||f===void 0)&&f.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(l)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const b=this._map,k=b.terrain.depthAtPoint(this._pos),E=b.terrain.getElevationForLngLatZoom(this._lngLat,b.transform.tileZoom);if(b.transform.lngLatToCameraDepth(this._lngLat,E)-k<.006)return void(this._element.style.opacity=this._opacity);const A=-this._offset.y/b.transform._pixelPerMeter,B=Math.sin(b.getPitch()*Math.PI/180)*A,G=b.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),X=b.transform.lngLatToCameraDepth(this._lngLat,E+B)-G>.006;!((g=this._popup)===null||g===void 0)&&g.isOpen()&&X&&this._popup.remove(),this._element.style.opacity=X?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(l){return this._offset=a.P.convert(l),this._update(),this}addClassName(l){this._element.classList.add(l)}removeClassName(l){this._element.classList.remove(l)}toggleClassName(l){return this._element.classList.toggle(l)}setDraggable(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l&&l!=="auto"?l:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(l,f){return l===void 0&&f===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),l!==void 0&&(this._opacity=l),f!==void 0&&(this._opacityWhenCovered=f),this._map&&this._updateOpacity(!0),this}}const ic={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ma=0,$s=!1;const oc={maxWidth:100,unit:"metric"};function sc(x,l,f){const g=f&&f.maxWidth||100,b=x._container.clientHeight/2,k=x.unproject([0,b]),E=x.unproject([g,b]),A=k.distanceTo(E);if(f&&f.unit==="imperial"){const B=3.2808*A;B>5280?Rs(l,g,B/5280,x._getUIString("ScaleControl.Miles")):Rs(l,g,B,x._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?Rs(l,g,A/1852,x._getUIString("ScaleControl.NauticalMiles")):A>=1e3?Rs(l,g,A/1e3,x._getUIString("ScaleControl.Kilometers")):Rs(l,g,A,x._getUIString("ScaleControl.Meters"))}function Rs(x,l,f,g){const b=function(k){const E=Math.pow(10,`${Math.floor(k)}`.length-1);let A=k/E;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(B){const G=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*G)/G}(A),E*A}(f);x.style.width=l*(b/f)+"px",x.innerHTML=`${b}&nbsp;${g}`}const _u={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},yu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ac(x){if(x){if(typeof x=="number"){const l=Math.round(Math.abs(x)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,x),"top-left":new a.P(l,l),"top-right":new a.P(-l,l),bottom:new a.P(0,-x),"bottom-left":new a.P(l,-l),"bottom-right":new a.P(-l,-l),left:new a.P(x,0),right:new a.P(-x,0)}}if(x instanceof a.P||Array.isArray(x)){const l=a.P.convert(x);return{center:l,top:l,"top-left":l,"top-right":l,bottom:l,"bottom-left":l,"bottom-right":l,left:l,right:l}}return{center:a.P.convert(x.center||[0,0]),top:a.P.convert(x.top||[0,0]),"top-left":a.P.convert(x["top-left"]||[0,0]),"top-right":a.P.convert(x["top-right"]||[0,0]),bottom:a.P.convert(x.bottom||[0,0]),"bottom-left":a.P.convert(x["bottom-left"]||[0,0]),"bottom-right":a.P.convert(x["bottom-right"]||[0,0]),left:a.P.convert(x.left||[0,0]),right:a.P.convert(x.right||[0,0])}}return ac(new a.P(0,0))}const gf=d;c.AJAXError=a.be,c.Evented=a.E,c.LngLat=a.M,c.MercatorCoordinate=a.Y,c.Point=a.P,c.addProtocol=a.bf,c.config=a.a,c.removeProtocol=a.bg,c.AttributionControl=ko,c.BoxZoomHandler=wo,c.CanvasSource=nr,c.CooperativeGesturesHandler=rn,c.DoubleClickZoomHandler=cu,c.DragPanHandler=df,c.DragRotateHandler=xo,c.EdgeInsets=ca,c.FullscreenControl=class extends a.E{constructor(x={}){super(),this._onFullscreenChange=()=>{var l;let f=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((l=f==null?void 0:f.shadowRoot)===null||l===void 0)&&l.fullscreenElement;)f=f.shadowRoot.fullscreenElement;f===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,x&&x.container&&(x.container instanceof HTMLElement?this._container=x.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(x){return this._map=x,this._container||(this._container=this._map.getContainer()),this._controlContainer=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){w.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const x=this._fullscreenButton=w.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);w.create("span","maplibregl-ctrl-icon",x).setAttribute("aria-hidden","true"),x.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const x=this._getTitle();this._fullscreenButton.setAttribute("aria-label",x),this._fullscreenButton.title=x}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},c.GeoJSONSource=Ue,c.GeolocateControl=class extends a.E{constructor(x){super(),this._onSuccess=l=>{if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",l)),this._finish()}},this._updateCamera=l=>{const f=new a.M(l.coords.longitude,l.coords.latitude),g=l.coords.accuracy,b=this._map.getBearing(),k=a.e({bearing:b},this.options.fitBoundsOptions),E=Ne.fromLngLat(f,g);this._map.fitBounds(E,k,{geolocateSource:!0})},this._updateMarker=l=>{if(l){const f=new a.M(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(f).addTo(this._map),this._userLocationDotMarker.setLngLat(f).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=l=>{if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&$s)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",l)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=l=>{if(this._map){if(this._container.addEventListener("contextmenu",f=>f.preventDefault()),this._geolocateButton=w.create("button","maplibregl-ctrl-geolocate",this._container),w.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}else{const f=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=w.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new al({element:this._dotElement}),this._circleElement=w.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new al({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",f=>{f.geolocateSource||this._watchState!=="ACTIVE_LOCK"||f.originalEvent&&f.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")))})}},this.options=a.e({},ic,x)}onAdd(x){return this._map=x,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return a._(this,arguments,void 0,function*(l=!1){if(rs!==void 0&&!l)return rs;if(window.navigator.permissions===void 0)return rs=!!window.navigator.geolocation,rs;try{rs=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{rs=!!window.navigator.geolocation}return rs})}().then(l=>this._setupUI(l)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),w.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ma=0,$s=!1}_isOutOfMapMaxBounds(x){const l=this._map.getMaxBounds(),f=x.coords;return l&&(f.longitude<l.getWest()||f.longitude>l.getEast()||f.latitude<l.getSouth()||f.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const x=this._map.getBounds(),l=x.getSouthEast(),f=x.getNorthEast(),g=l.distanceTo(f),b=Math.ceil(this._accuracy/(g/this._map._container.clientHeight)*2);this._circleElement.style.width=`${b}px`,this._circleElement.style.height=`${b}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ma--,$s=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let x;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ma++,ma>1?(x={maximumAge:6e5,timeout:0},$s=!0):(x=this.options.positionOptions,$s=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,x)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},c.Hash=ou,c.ImageSource=Kt,c.KeyboardHandler=ws,c.LngLatBounds=Ne,c.LogoControl=pf,c.Map=class extends Fi{constructor(x){if(a.bc.mark(a.bd.create),(x=a.e({},ol,x)).minZoom!=null&&x.maxZoom!=null&&x.minZoom>x.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(x.minPitch!=null&&x.maxPitch!=null&&x.minPitch>x.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(x.minPitch!=null&&x.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(x.maxPitch!=null&&x.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Kl(x.minZoom,x.maxZoom,x.minPitch,x.maxPitch,x.renderWorldCopies),{bearingSnap:x.bearingSnap}),this._contextLost=l=>{l.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.k("webglcontextlost",{originalEvent:l}))},this._contextRestored=l=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:l}))},this._onMapScroll=l=>{if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=x.interactive,this._maxTileCacheSize=x.maxTileCacheSize,this._maxTileCacheZoomLevels=x.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=x.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=x.preserveDrawingBuffer,this._antialias=x.antialias,this._trackResize=x.trackResize,this._bearingSnap=x.bearingSnap,this._refreshExpiredTiles=x.refreshExpiredTiles,this._fadeDuration=x.fadeDuration,this._crossSourceCollisions=x.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=x.collectResourceTiming,this._renderTaskQueue=new rl,this._controls=[],this._mapId=a.a3(),this._locale=a.e({},du,x.locale),this._clickTolerance=x.clickTolerance,this._overridePixelRatio=x.pixelRatio,this._maxCanvasSize=x.maxCanvasSize,this.transformCameraUpdate=x.transformCameraUpdate,this._imageQueueHandle=F.addThrottleControl(()=>this.isMoving()),this._requestManager=new N(x.transformRequest),typeof x.container=="string"){if(this._container=document.getElementById(x.container),!this._container)throw new Error(`Container '${x.container}' not found.`)}else{if(!(x.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=x.container}if(x.maxBounds&&this.setMaxBounds(x.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let l=!1;const f=iu(g=>{this._trackResize&&!this._removed&&this.resize(g)._update()},50);this._resizeObserver=new ResizeObserver(g=>{l?f(g):l=!0}),this._resizeObserver.observe(this._container)}this.handlers=new uu(this,x),this._hash=x.hash&&new ou(typeof x.hash=="string"&&x.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:x.center,zoom:x.zoom,bearing:x.bearing,pitch:x.pitch}),x.bounds&&(this.resize(),this.fitBounds(x.bounds,a.e({},x.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=x.localIdeographFontFamily,this._validateStyle=x.validateStyle,x.style&&this.setStyle(x.style,{localIdeographFontFamily:x.localIdeographFontFamily}),x.attributionControl&&this.addControl(new ko(typeof x.attributionControl=="boolean"?void 0:x.attributionControl)),x.maplibreLogo&&this.addControl(new pf,x.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new a.k(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new a.k(`${l.dataType}dataloading`,l))}),this.on("dataabort",l=>{this.fire(new a.k("sourcedataabort",l))})}_getMapId(){return this._mapId}addControl(x,l){if(l===void 0&&(l=x.getDefaultPosition?x.getDefaultPosition():"top-right"),!x||!x.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=x.onAdd(this);this._controls.push(x);const g=this._controlPositions[l];return l.indexOf("bottom")!==-1?g.insertBefore(f,g.firstChild):g.appendChild(f),this}removeControl(x){if(!x||!x.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(x);return l>-1&&this._controls.splice(l,1),x.onRemove(this),this}hasControl(x){return this._controls.indexOf(x)>-1}calculateCameraOptionsFromTo(x,l,f,g){return g==null&&this.terrain&&(g=this.terrain.getElevationForLngLatZoom(f,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(x,l,f,g)}resize(x){var l;const f=this._containerDimensions(),g=f[0],b=f[1],k=this._getClampedPixelRatio(g,b);if(this._resizeCanvas(g,b,k),this.painter.resize(g,b,k),this.painter.overLimit()){const A=this.painter.context.gl;this._maxCanvasSize=[A.drawingBufferWidth,A.drawingBufferHeight];const B=this._getClampedPixelRatio(g,b);this._resizeCanvas(g,b,B),this.painter.resize(g,b,B)}this.transform.resize(g,b),(l=this._requestedCameraState)===null||l===void 0||l.resize(g,b);const E=!this._moving;return E&&(this.stop(),this.fire(new a.k("movestart",x)).fire(new a.k("move",x))),this.fire(new a.k("resize",x)),E&&this.fire(new a.k("moveend",x)),this}_getClampedPixelRatio(x,l){const{0:f,1:g}=this._maxCanvasSize,b=this.getPixelRatio(),k=x*b,E=l*b;return Math.min(k>f?f/k:1,E>g?g/E:1)*b}getPixelRatio(){var x;return(x=this._overridePixelRatio)!==null&&x!==void 0?x:devicePixelRatio}setPixelRatio(x){this._overridePixelRatio=x,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(x){return this.transform.setMaxBounds(Ne.convert(x)),this._update()}setMinZoom(x){if((x=x??-2)>=-2&&x<=this.transform.maxZoom)return this.transform.minZoom=x,this._update(),this.getZoom()<x&&this.setZoom(x),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(x){if((x=x??22)>=this.transform.minZoom)return this.transform.maxZoom=x,this._update(),this.getZoom()>x&&this.setZoom(x),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(x){if((x=x??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(x>=0&&x<=this.transform.maxPitch)return this.transform.minPitch=x,this._update(),this.getPitch()<x&&this.setPitch(x),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(x){if((x=x??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(x>=this.transform.minPitch)return this.transform.maxPitch=x,this._update(),this.getPitch()>x&&this.setPitch(x),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(x){return this.transform.renderWorldCopies=x,this._update()}project(x){return this.transform.locationPoint(a.M.convert(x),this.style&&this.terrain)}unproject(x){return this.transform.pointLocation(a.P.convert(x),this.terrain)}isMoving(){var x;return this._moving||((x=this.handlers)===null||x===void 0?void 0:x.isMoving())}isZooming(){var x;return this._zooming||((x=this.handlers)===null||x===void 0?void 0:x.isZooming())}isRotating(){var x;return this._rotating||((x=this.handlers)===null||x===void 0?void 0:x.isRotating())}_createDelegatedListener(x,l,f){if(x==="mouseenter"||x==="mouseover"){let g=!1;return{layer:l,listener:f,delegates:{mousemove:k=>{const E=this.getLayer(l)?this.queryRenderedFeatures(k.point,{layers:[l]}):[];E.length?g||(g=!0,f.call(this,new Ri(x,this,k.originalEvent,{features:E}))):g=!1},mouseout:()=>{g=!1}}}}if(x==="mouseleave"||x==="mouseout"){let g=!1;return{layer:l,listener:f,delegates:{mousemove:E=>{(this.getLayer(l)?this.queryRenderedFeatures(E.point,{layers:[l]}):[]).length?g=!0:g&&(g=!1,f.call(this,new Ri(x,this,E.originalEvent)))},mouseout:E=>{g&&(g=!1,f.call(this,new Ri(x,this,E.originalEvent)))}}}}{const g=b=>{const k=this.getLayer(l)?this.queryRenderedFeatures(b.point,{layers:[l]}):[];k.length&&(b.features=k,f.call(this,b),delete b.features)};return{layer:l,listener:f,delegates:{[x]:g}}}}on(x,l,f){if(f===void 0)return super.on(x,l);const g=this._createDelegatedListener(x,l,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[x]=this._delegatedListeners[x]||[],this._delegatedListeners[x].push(g);for(const b in g.delegates)this.on(b,g.delegates[b]);return this}once(x,l,f){if(f===void 0)return super.once(x,l);const g=this._createDelegatedListener(x,l,f);for(const b in g.delegates)this.once(b,g.delegates[b]);return this}off(x,l,f){return f===void 0?super.off(x,l):(this._delegatedListeners&&this._delegatedListeners[x]&&(g=>{const b=this._delegatedListeners[x];for(let k=0;k<b.length;k++){const E=b[k];if(E.layer===l&&E.listener===f){for(const A in E.delegates)this.off(A,E.delegates[A]);return b.splice(k,1),this}}})(),this)}queryRenderedFeatures(x,l){if(!this.style)return[];let f;const g=x instanceof a.P||Array.isArray(x),b=g?x:[[0,0],[this.transform.width,this.transform.height]];if(l=l||(g?{}:x)||{},b instanceof a.P||typeof b[0]=="number")f=[a.P.convert(b)];else{const k=a.P.convert(b[0]),E=a.P.convert(b[1]);f=[k,new a.P(E.x,k.y),E,new a.P(k.x,E.y),k]}return this.style.queryRenderedFeatures(f,l,this.transform)}querySourceFeatures(x,l){return this.style.querySourceFeatures(x,l)}setStyle(x,l){return(l=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&x?(this._diffStyle(x,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._updateStyle(x,l))}setTransformRequest(x){return this._requestManager.setTransformRequest(x),this}_getUIString(x){const l=this._locale[x];if(l==null)throw new Error(`Missing UI string '${x}'`);return l}_updateStyle(x,l){if(l.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(x,l));const f=this.style&&l.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!x)),x?(this.style=new Ji(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof x=="string"?this.style.loadURL(x,l,f):this.style.loadJSON(x,l,f),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ji(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(x,l){if(typeof x=="string"){const f=this._requestManager.transformRequest(x,"Style");a.h(f,new AbortController).then(g=>{this._updateDiff(g.data,l)}).catch(g=>{g&&this.fire(new a.j(g))})}else typeof x=="object"&&this._updateDiff(x,l)}_updateDiff(x,l){try{this.style.setState(x,l)&&this._update(!0)}catch(f){a.w(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(x,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(x,l){return this._lazyInitEmptyStyle(),this.style.addSource(x,l),this._update(!0)}isSourceLoaded(x){const l=this.style&&this.style.sourceCaches[x];if(l!==void 0)return l.loaded();this.fire(new a.j(new Error(`There is no source with ID '${x}'`)))}setTerrain(x){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),x){const l=this.style.sourceCaches[x.source];if(!l)throw new Error(`cannot load terrain, because there exists no source with ID: ${x.source}`);this.terrain===null&&l.reload();for(const f in this.style._layers){const g=this.style._layers[f];g.type==="hillshade"&&g.source===x.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new mf(this.painter,l,x),this.painter.renderToTexture=new fu(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=f=>{f.dataType==="style"?this.terrain.sourceCache.freeRtt():f.dataType==="source"&&f.tile&&(f.sourceId!==x.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(f.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:x})),this}getTerrain(){var x,l;return(l=(x=this.terrain)===null||x===void 0?void 0:x.options)!==null&&l!==void 0?l:null}areTilesLoaded(){const x=this.style&&this.style.sourceCaches;for(const l in x){const f=x[l]._tiles;for(const g in f){const b=f[g];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}removeSource(x){return this.style.removeSource(x),this._update(!0)}getSource(x){return this.style.getSource(x)}addImage(x,l,f={}){const{pixelRatio:g=1,sdf:b=!1,stretchX:k,stretchY:E,content:A}=f;if(this._lazyInitEmptyStyle(),!(l instanceof HTMLImageElement||a.b(l))){if(l.width===void 0||l.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:B,height:G,data:X}=l,Y=l;return this.style.addImage(x,{data:new a.R({width:B,height:G},new Uint8Array(X)),pixelRatio:g,stretchX:k,stretchY:E,content:A,sdf:b,version:0,userImage:Y}),Y.onAdd&&Y.onAdd(this,x),this}}{const{width:B,height:G,data:X}=_.getImageData(l);this.style.addImage(x,{data:new a.R({width:B,height:G},X),pixelRatio:g,stretchX:k,stretchY:E,content:A,sdf:b,version:0})}}updateImage(x,l){const f=this.style.getImage(x);if(!f)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=l instanceof HTMLImageElement||a.b(l)?_.getImageData(l):l,{width:b,height:k,data:E}=g;if(b===void 0||k===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==f.data.width||k!==f.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const A=!(l instanceof HTMLImageElement||a.b(l));return f.data.replace(E,A),this.style.updateImage(x,f),this}getImage(x){return this.style.getImage(x)}hasImage(x){return x?!!this.style.getImage(x):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(x){this.style.removeImage(x)}loadImage(x){return F.getImage(this._requestManager.transformRequest(x,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(x,l){return this._lazyInitEmptyStyle(),this.style.addLayer(x,l),this._update(!0)}moveLayer(x,l){return this.style.moveLayer(x,l),this._update(!0)}removeLayer(x){return this.style.removeLayer(x),this._update(!0)}getLayer(x){return this.style.getLayer(x)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(x,l,f){return this.style.setLayerZoomRange(x,l,f),this._update(!0)}setFilter(x,l,f={}){return this.style.setFilter(x,l,f),this._update(!0)}getFilter(x){return this.style.getFilter(x)}setPaintProperty(x,l,f,g={}){return this.style.setPaintProperty(x,l,f,g),this._update(!0)}getPaintProperty(x,l){return this.style.getPaintProperty(x,l)}setLayoutProperty(x,l,f,g={}){return this.style.setLayoutProperty(x,l,f,g),this._update(!0)}getLayoutProperty(x,l){return this.style.getLayoutProperty(x,l)}setGlyphs(x,l={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(x,l),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(x,l,f={}){return this._lazyInitEmptyStyle(),this.style.addSprite(x,l,f,g=>{g||this._update(!0)}),this}removeSprite(x){return this._lazyInitEmptyStyle(),this.style.removeSprite(x),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(x,l={}){return this._lazyInitEmptyStyle(),this.style.setSprite(x,l,f=>{f||this._update(!0)}),this}setLight(x,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(x,l),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(x,l){return this.style.setFeatureState(x,l),this._update()}removeFeatureState(x,l){return this.style.removeFeatureState(x,l),this._update()}getFeatureState(x){return this.style.getFeatureState(x)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let x=0,l=0;return this._container&&(x=this._container.clientWidth||400,l=this._container.clientHeight||300),[x,l]}_setupContainer(){const x=this._container;x.classList.add("maplibregl-map");const l=this._canvasContainer=w.create("div","maplibregl-canvas-container",x);this._interactive&&l.classList.add("maplibregl-interactive"),this._canvas=w.create("canvas","maplibregl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const f=this._containerDimensions(),g=this._getClampedPixelRatio(f[0],f[1]);this._resizeCanvas(f[0],f[1],g);const b=this._controlContainer=w.create("div","maplibregl-control-container",x),k=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(E=>{k[E]=w.create("div",`maplibregl-ctrl-${E} `,b)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(x,l,f){this._canvas.width=Math.floor(f*x),this._canvas.height=Math.floor(f*l),this._canvas.style.width=`${x}px`,this._canvas.style.height=`${l}px`}_setupPainter(){const x={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let l=null;this._canvas.addEventListener("webglcontextcreationerror",g=>{l={requestedAttributes:x},g&&(l.statusMessage=g.statusMessage,l.type=g.type)},{once:!0});const f=this._canvas.getContext("webgl2",x)||this._canvas.getContext("webgl",x);if(!f){const g="Failed to initialize WebGL";throw l?(l.message=g,new Error(JSON.stringify(l))):new Error(g)}this.painter=new tf(f,this.transform),T.testSupport(f)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(x){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||x,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(x){return this._update(),this._renderTaskQueue.add(x)}_cancelRenderFrame(x){this._renderTaskQueue.remove(x)}_render(x){const l=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(x),this._removed)return;let f=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const b=this.transform.zoom,k=_.now();this.style.zoomHistory.update(b,k);const E=new a.a8(b,{now:k,fadeDuration:l,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),A=E.crossFadingFactor();A===1&&A===this._crossFadingFactor||(f=!0,this._crossFadingFactor=A),this.style.update(E)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bc.mark(a.bd.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||f)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const g=this._sourcesDirty||this._styleDirty||this._placementDirty;return g||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||g||(this._fullyLoaded=!0,a.bc.mark(a.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var x;this._hash&&this._hash.remove();for(const f of this._controls)f.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),F.removeThrottleControl(this._imageQueueHandle),(x=this._resizeObserver)===null||x===void 0||x.disconnect();const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),w.remove(this._canvasContainer),w.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),a.bc.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,_.frameAsync(this._frameRequest).then(x=>{a.bc.frame(x),this._frameRequest=null,this._render(x)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(x){this._showTileBoundaries!==x&&(this._showTileBoundaries=x,this._update())}get showPadding(){return!!this._showPadding}set showPadding(x){this._showPadding!==x&&(this._showPadding=x,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(x){this._showCollisionBoxes!==x&&(this._showCollisionBoxes=x,x?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(x){this._showOverdrawInspector!==x&&(this._showOverdrawInspector=x,this._update())}get repaint(){return!!this._repaint}set repaint(x){this._repaint!==x&&(this._repaint=x,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(x){this._vertices=x,this._update()}get version(){return pu}getCameraTargetElevation(){return this.transform.elevation}},c.MapMouseEvent=Ri,c.MapTouchEvent=Uo,c.MapWheelEvent=su,c.Marker=al,c.NavigationControl=class{constructor(x){this._updateZoomButtons=()=>{const l=this._map.getZoom(),f=l===this._map.getMaxZoom(),g=l===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())},this._rotateCompassArrow=()=>{const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=l},this._setButtonTitle=(l,f)=>{const g=this._map._getUIString(`NavigationControl.${f}`);l.title=g,l.setAttribute("aria-label",g)},this.options=a.e({},mu,x),this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",l=>this._map.zoomIn({},{originalEvent:l})),w.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",l=>this._map.zoomOut({},{originalEvent:l})),w.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",l=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})}),this._compassIcon=w.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(x){return this._map=x,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new gu(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){w.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(x,l){const f=w.create("button",x,this._container);return f.type="button",f.addEventListener("click",l),f}},c.Popup=class extends a.E{constructor(x){super(),this.remove=()=>(this._content&&w.remove(this._content),this._container&&(w.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.k("close"))),this),this._onMouseUp=l=>{this._update(l.point)},this._onMouseMove=l=>{this._update(l.point)},this._onDrag=l=>{this._update(l.point)},this._update=l=>{var f;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=w.create("div","maplibregl-popup",this._map.getContainer()),this._tip=w.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const A of this.options.className.split(" "))this._container.classList.add(A);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?nc(this._lngLat,this._flatPos,this._map.transform):(f=this._lngLat)===null||f===void 0?void 0:f.wrap(),this._trackPointer&&!l)return;const g=this._flatPos=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&l?l:this._map.transform.locationPoint(this._lngLat));let b=this.options.anchor;const k=ac(this.options.offset);if(!b){const A=this._container.offsetWidth,B=this._container.offsetHeight;let G;G=g.y+k.bottom.y<B?["top"]:g.y>this._map.transform.height-B?["bottom"]:[],g.x<A/2?G.push("left"):g.x>this._map.transform.width-A/2&&G.push("right"),b=G.length===0?"bottom":G.join("-")}let E=g.add(k[b]);this.options.subpixelPositioning||(E=E.round()),w.setTransform(this._container,`${sl[b]} translate(${E.x}px,${E.y}px)`),rc(this._container,b,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(_u),x)}addTo(x){return this._map&&this.remove(),this._map=x,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(x){return this._lngLat=a.M.convert(x),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(x){return this.setDOMContent(document.createTextNode(x))}setHTML(x){const l=document.createDocumentFragment(),f=document.createElement("body");let g;for(f.innerHTML=x;g=f.firstChild,g;)l.appendChild(g);return this.setDOMContent(l)}getMaxWidth(){var x;return(x=this._container)===null||x===void 0?void 0:x.style.maxWidth}setMaxWidth(x){return this.options.maxWidth=x,this._update(),this}setDOMContent(x){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=w.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(x),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(x){this._container&&this._container.classList.add(x)}removeClassName(x){this._container&&this._container.classList.remove(x)}setOffset(x){return this.options.offset=x,this._update(),this}toggleClassName(x){if(this._container)return this._container.classList.toggle(x)}setSubpixelPositioning(x){this.options.subpixelPositioning=x}_createCloseButton(){this.options.closeButton&&(this._closeButton=w.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const x=this._container.querySelector(yu);x&&x.focus()}},c.RasterDEMTileSource=vn,c.RasterTileSource=_e,c.ScaleControl=class{constructor(x){this._onMove=()=>{sc(this._map,this._container,this.options)},this.setUnit=l=>{this.options.unit=l,sc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},oc),x)}getDefaultPosition(){return"bottom-left"}onAdd(x){return this._map=x,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-scale",x.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){w.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},c.ScrollZoomHandler=Ql,c.Style=Ji,c.TerrainControl=class{constructor(x){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=x}onAdd(x){return this._map=x,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=w.create("button","maplibregl-ctrl-terrain",this._container),w.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){w.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},c.TwoFingersTouchPitchHandler=uf,c.TwoFingersTouchRotateHandler=lu,c.TwoFingersTouchZoomHandler=cf,c.TwoFingersTouchZoomRotateHandler=tl,c.VectorTileSource=jt,c.VideoSource=ur,c.addSourceType=(x,l)=>a._(void 0,void 0,void 0,function*(){if(Qr(x))throw new Error(`A source type called "${x}" already exists.`);((f,g)=>{vr[f]=g})(x,l)}),c.clearPrewarmedResources=function(){const x=Dt;x&&(x.isPreloaded()&&x.numActive()===1?(x.release(mt),Dt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},c.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},c.getRTLTextPluginStatus=function(){return yt().getRTLTextPluginStatus()},c.getVersion=function(){return gf},c.getWorkerCount=function(){return ft.workerCount},c.getWorkerUrl=function(){return a.a.WORKER_URL},c.importScriptInWorkers=function(x){return Yt().broadcast("IS",x)},c.prewarm=function(){$t().acquire(mt)},c.setMaxParallelImageRequests=function(x){a.a.MAX_PARALLEL_IMAGE_REQUESTS=x},c.setRTLTextPlugin=function(x,l){return yt().setRTLTextPlugin(x,l)},c.setWorkerCount=function(x){ft.workerCount=x},c.setWorkerUrl=function(x){a.a.WORKER_URL=x}});var o=t;return o})})(Mb);var Ks=Mb.exports;const Jr=Tb(Ks),gx=W2({__proto__:null,default:Jr},[Ks]);let on;const Eb=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Eb.decode();let Xu=null;function ih(){return(Xu===null||Xu.byteLength===0)&&(Xu=new Uint8Array(on.memory.buffer)),Xu}function Ko(r,e){return r=r>>>0,Eb.decode(ih().subarray(r,r+e))}const Zs=new Array(128).fill(void 0);Zs.push(void 0,null,!0,!1);let oh=Zs.length;function Xr(r){oh===Zs.length&&Zs.push(Zs.length+1);const e=oh;return oh=Zs[e],Zs[e]=r,e}function Un(r){return Zs[r]}function _x(r){r<132||(Zs[r]=oh,oh=r)}function Lc(r){const e=Un(r);return _x(r),e}function jp(r){return r==null}let Ju=null;function yx(){return(Ju===null||Ju.byteLength===0)&&(Ju=new Float64Array(on.memory.buffer)),Ju}let Yu=null;function Gn(){return(Yu===null||Yu.byteLength===0)&&(Yu=new Int32Array(on.memory.buffer)),Yu}let Ca=0;const Kf=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},bx=typeof Kf.encodeInto=="function"?function(r,e){return Kf.encodeInto(r,e)}:function(r,e){const t=Kf.encode(r);return e.set(t),{read:r.length,written:t.length}};function Nf(r,e,t){if(t===void 0){const a=Kf.encode(r),d=e(a.length,1)>>>0;return ih().subarray(d,d+a.length).set(a),Ca=a.length,d}let n=r.length,i=e(n,1)>>>0;const o=ih();let c=0;for(;c<n;c++){const a=r.charCodeAt(c);if(a>127)break;o[i+c]=a}if(c!==n){c!==0&&(r=r.slice(c)),i=t(i,n,n=c+r.length*3,1)>>>0;const a=ih().subarray(i+c,i+n),d=bx(r,a);c+=d.written}return Ca=c,i}function im(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=im(r[0]));for(let c=1;c<i;c++)o+=", "+im(r[c]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function vx(r,e){const t=e(r.length*1,1)>>>0;return ih().set(r,t/1),Ca=r.length,t}function Up(r,e){try{return r.apply(this,e)}catch(t){on.__wbindgen_exn_store(Xr(t))}}class ad{static __wrap(e){e=e>>>0;const t=Object.create(ad.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();on.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=on.__wbindgen_add_to_stack_pointer(-16),c=vx(e,on.__wbindgen_malloc),a=Ca;on.jsroutesnapper_new(o,c,a);var t=Gn()[o/4+0],n=Gn()[o/4+1],i=Gn()[o/4+2];if(i)throw Lc(n);return ad.__wrap(t)}finally{on.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){on.jsroutesnapper_setRouteConfig(this.__wbg_ptr,Xr(e))}setAreaMode(){on.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const o=on.__wbindgen_add_to_stack_pointer(-16);on.jsroutesnapper_getConfig(o,this.__wbg_ptr);var n=Gn()[o/4+0],i=Gn()[o/4+1];return e=n,t=i,Ko(n,i)}finally{on.__wbindgen_add_to_stack_pointer(16),on.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const n=on.__wbindgen_add_to_stack_pointer(-16);on.jsroutesnapper_toFinalFeature(n,this.__wbg_ptr);var e=Gn()[n/4+0],t=Gn()[n/4+1];let i;return e!==0&&(i=Ko(e,t).slice(),on.__wbindgen_free(e,t*1)),i}finally{on.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const o=on.__wbindgen_add_to_stack_pointer(-16);on.jsroutesnapper_renderGeojson(o,this.__wbg_ptr);var n=Gn()[o/4+0],i=Gn()[o/4+1];return e=n,t=i,Ko(n,i)}finally{on.__wbindgen_add_to_stack_pointer(16),on.__wbindgen_free(e,t,1)}}toggleSnapMode(){on.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,n){return on.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,n)!==0}onClick(){on.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return on.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return on.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){on.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const i=on.__wbindgen_add_to_stack_pointer(-16);on.jsroutesnapper_editExisting(i,this.__wbg_ptr,Xr(e));var t=Gn()[i/4+0],n=Gn()[i/4+1];if(n)throw Lc(t)}finally{on.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const o=on.__wbindgen_add_to_stack_pointer(-16);on.jsroutesnapper_debugRenderGraph(o,this.__wbg_ptr);var n=Gn()[o/4+0],i=Gn()[o/4+1];return e=n,t=i,Ko(n,i)}finally{on.__wbindgen_add_to_stack_pointer(16),on.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const o=on.__wbindgen_add_to_stack_pointer(-16);on.jsroutesnapper_debugSnappableNodes(o,this.__wbg_ptr);var n=Gn()[o/4+0],i=Gn()[o/4+1];return e=n,t=i,Ko(n,i)}finally{on.__wbindgen_add_to_stack_pointer(16),on.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,n;try{const y=on.__wbindgen_add_to_stack_pointer(-16);on.jsroutesnapper_routeNameForWaypoints(y,this.__wbg_ptr,Xr(e));var i=Gn()[y/4+0],o=Gn()[y/4+1],c=Gn()[y/4+2],a=Gn()[y/4+3],d=i,p=o;if(a)throw d=0,p=0,Lc(c);return t=d,n=p,Ko(d,p)}finally{on.__wbindgen_add_to_stack_pointer(16),on.__wbindgen_free(t,n,1)}}addSnappedWaypoint(e,t){on.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){on.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,n;try{const y=on.__wbindgen_add_to_stack_pointer(-16);on.jsroutesnapper_calculateRoute(y,this.__wbg_ptr,Xr(e));var i=Gn()[y/4+0],o=Gn()[y/4+1],c=Gn()[y/4+2],a=Gn()[y/4+3],d=i,p=o;if(a)throw d=0,p=0,Lc(c);return t=d,n=p,Ko(d,p)}finally{on.__wbindgen_add_to_stack_pointer(16),on.__wbindgen_free(t,n,1)}}getExtraNodes(e,t){let n,i;try{const _=on.__wbindgen_add_to_stack_pointer(-16);on.jsroutesnapper_getExtraNodes(_,this.__wbg_ptr,Xr(e),Xr(t));var o=Gn()[_/4+0],c=Gn()[_/4+1],a=Gn()[_/4+2],d=Gn()[_/4+3],p=o,y=c;if(d)throw p=0,y=0,Lc(a);return n=p,i=y,Ko(p,y)}finally{on.__wbindgen_add_to_stack_pointer(16),on.__wbindgen_free(n,i,1)}}}async function wx(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function xx(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=Ko(e,t);return Xr(n)},r.wbg.__wbindgen_object_drop_ref=function(e){Lc(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Ko(e,t));return Xr(n)},r.wbg.__wbindgen_number_get=function(e,t){const n=Un(t),i=typeof n=="number"?n:void 0;yx()[e/8+1]=jp(i)?0:i,Gn()[e/4+0]=!jp(i)},r.wbg.__wbindgen_is_object=function(e){const t=Un(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return Un(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return Un(e)in Un(t)},r.wbg.__wbindgen_boolean_get=function(e){const t=Un(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Un(e)==Un(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=Un(t),i=typeof n=="string"?n:void 0;var o=jp(i)?0:Nf(i,on.__wbindgen_malloc,on.__wbindgen_realloc),c=Ca;Gn()[e/4+1]=c,Gn()[e/4+0]=o},r.wbg.__wbg_String_4370c5505c674d30=function(e,t){const n=String(Un(t)),i=Nf(n,on.__wbindgen_malloc,on.__wbindgen_realloc),o=Ca;Gn()[e/4+1]=o,Gn()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Un(e);return Xr(t)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const n=Un(e)[Un(t)];return Xr(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Xr(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Un(t).stack,i=Nf(n,on.__wbindgen_malloc,on.__wbindgen_realloc),o=Ca;Gn()[e/4+1]=o,Gn()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(Ko(e,t))}finally{on.__wbindgen_free(n,i,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Un(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Un(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Un(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Un(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Un(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,t){const n=Un(e)[t>>>0];return Xr(n)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Un(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Un(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const t=Un(e).next;return Xr(t)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Up(function(e){const t=Un(e).next();return Xr(t)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Un(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const t=Un(e).value;return Xr(t)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return Xr(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return Up(function(e,t){const n=Reflect.get(Un(e),Un(t));return Xr(n)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return Up(function(e,t){const n=Un(e).call(Un(t));return Xr(n)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Un(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=Un(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=Un(e).buffer;return Xr(t)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(Un(e));return Xr(t)},r.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){Un(e).set(Un(t),n>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Un(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=Un(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_debug_string=function(e,t){const n=im(Un(t)),i=Nf(n,on.__wbindgen_malloc,on.__wbindgen_realloc),o=Ca;Gn()[e/4+1]=o,Gn()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Ko(e,t))},r.wbg.__wbindgen_memory=function(){const e=on.memory;return Xr(e)},r}function kx(r,e){return on=r.exports,Ib.__wbindgen_wasm_module=e,Ju=null,Yu=null,Xu=null,on}async function Ib(r){if(on!==void 0)return on;typeof r>"u"&&(r="/ltn/assets/route_snapper_bg.wasm");const e=xx();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await wx(await r,e);return kx(t,n)}var qi=63710088e-1,Nm={centimeters:qi*100,centimetres:qi*100,degrees:qi/111325,feet:qi*3.28084,inches:qi*39.37,kilometers:qi/1e3,kilometres:qi/1e3,meters:qi,metres:qi,miles:qi/1609.344,millimeters:qi*1e3,millimetres:qi*1e3,nauticalmiles:qi/1852,radians:1,yards:qi*1.0936},Sx={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/qi,yards:1.0936133},om={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ts(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Cx(r,e,t){switch(r){case"Point":return _o(e).geometry;case"LineString":return Jo(e).geometry;case"Polygon":return jm(e).geometry;case"MultiPoint":return Pb(e).geometry;case"MultiLineString":return Ab(e).geometry;case"MultiPolygon":return zb(e).geometry;default:throw new Error(r+" is invalid")}}function _o(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ld(r[0])||!ld(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return ts(n,e,t)}function Tx(r,e,t){return t===void 0&&(t={}),gl(r.map(function(n){return _o(n,e)}),t)}function jm(r,e,t){t===void 0&&(t={});for(var n=0,i=r;n<i.length;n++){var o=i[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var c=0;c<o[o.length-1].length;c++)if(o[o.length-1][c]!==o[0][c])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:r};return ts(a,e,t)}function Mx(r,e,t){return t===void 0&&(t={}),gl(r.map(function(n){return jm(n,e)}),t)}function Jo(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return ts(n,e,t)}function Lx(r,e,t){return t===void 0&&(t={}),gl(r.map(function(n){return Jo(n,e)}),t)}function gl(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function Ab(r,e,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:r};return ts(n,e,t)}function Pb(r,e,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:r};return ts(n,e,t)}function zb(r,e,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:r};return ts(n,e,t)}function Ex(r,e,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:r};return ts(n,e,t)}function Ix(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(r*t)/t}function Um(r,e){e===void 0&&(e="kilometers");var t=Nm[e];if(!t)throw new Error(e+" units is invalid");return r*t}function xd(r,e){e===void 0&&(e="kilometers");var t=Nm[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Ax(r,e){return dh(xd(r,e))}function Px(r){var e=r%360;return e<0&&(e+=360),e}function dh(r){var e=r%(2*Math.PI);return e*180/Math.PI}function Yo(r){var e=r%360;return e*Math.PI/180}function zx(r,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("length must be a positive number");return Um(xd(r,e),t)}function Dx(r,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("area must be a positive number");var n=om[e];if(!n)throw new Error("invalid original units");var i=om[t];if(!i)throw new Error("invalid final units");return r/n*i}function ld(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Vm(r){return!!r&&r.constructor===Object}function $x(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!ld(e))throw new Error("bbox must only contain numbers")})}function Rx(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const Fx=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:om,bearingToAzimuth:Px,convertArea:Dx,convertLength:zx,degreesToRadians:Yo,earthRadius:qi,factors:Nm,feature:ts,featureCollection:gl,geometry:Cx,geometryCollection:Ex,isNumber:ld,isObject:Vm,lengthToDegrees:Ax,lengthToRadians:xd,lineString:Jo,lineStrings:Lx,multiLineString:Ab,multiPoint:Pb,multiPolygon:zb,point:_o,points:Tx,polygon:jm,polygons:Mx,radiansToDegrees:dh,radiansToLength:Um,round:Ix,unitsFactors:Sx,validateBBox:$x,validateId:Rx},Symbol.toStringTag,{value:"Module"}));function ph(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Rc(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function ju(r,e,t){t===void 0&&(t={});var n=ph(r),i=ph(e),o=Yo(i[1]-n[1]),c=Yo(i[0]-n[0]),a=Yo(n[1]),d=Yo(i[1]),p=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(c/2),2)*Math.cos(a)*Math.cos(d);return Um(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),t.units)}function Th(r,e,t){if(r!==null)for(var n,i,o,c,a,d,p,y=0,_=0,w,T=r.type,M=T==="FeatureCollection",$=T==="Feature",P=M?r.features.length:1,D=0;D<P;D++){p=M?r.features[D].geometry:$?r.geometry:r,w=p?p.type==="GeometryCollection":!1,a=w?p.geometries.length:1;for(var I=0;I<a;I++){var F=0,N=0;if(c=w?p.geometries[I]:p,c!==null){d=c.coordinates;var W=c.type;switch(y=t&&(W==="Polygon"||W==="MultiPolygon")?1:0,W){case null:break;case"Point":if(e(d,_,D,F,N)===!1)return!1;_++,F++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],_,D,F,N)===!1)return!1;_++,W==="MultiPoint"&&F++}W==="LineString"&&F++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-y;i++){if(e(d[n][i],_,D,F,N)===!1)return!1;_++}W==="MultiLineString"&&F++,W==="Polygon"&&N++}W==="Polygon"&&F++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(N=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-y;o++){if(e(d[n][i][o],_,D,F,N)===!1)return!1;_++}N++}F++}break;case"GeometryCollection":for(n=0;n<c.geometries.length;n++)if(Th(c.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Bx(r,e,t,n){var i=t;return Th(r,function(o,c,a,d,p){c===0&&t===void 0?i=o:i=e(i,o,c,a,d,p)},n),i}function Db(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}function Ox(r,e,t){var n=t;return Db(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function cd(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function Nx(r,e,t){var n=t;return cd(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function jx(r){var e=[];return Th(r,function(t){e.push(t)}),e}function qm(r,e){var t,n,i,o,c,a,d,p,y,_,w=0,T=r.type==="FeatureCollection",M=r.type==="Feature",$=T?r.features.length:1;for(t=0;t<$;t++){for(a=T?r.features[t].geometry:M?r.geometry:r,p=T?r.features[t].properties:M?r.properties:{},y=T?r.features[t].bbox:M?r.bbox:void 0,_=T?r.features[t].id:M?r.id:void 0,d=a?a.type==="GeometryCollection":!1,c=d?a.geometries.length:1,i=0;i<c;i++){if(o=d?a.geometries[i]:a,o===null){if(e(null,w,p,y,_)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,w,p,y,_)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],w,p,y,_)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}w++}}function Ux(r,e,t){var n=t;return qm(r,function(i,o,c,a,d){o===0&&t===void 0?n=i:n=e(n,i,o,c,a,d)}),n}function Nc(r,e){qm(r,function(t,n,i,o,c){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(ts(t,i,{bbox:o,id:c}),n,0)===!1?!1:void 0}var d;switch(a){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var y=t.coordinates[p],_={type:d,coordinates:y};if(e(ts(_,i),n,p)===!1)return!1}})}function Vx(r,e,t){var n=t;return Nc(r,function(i,o,c){o===0&&c===0&&t===void 0?n=i:n=e(n,i,o,c)}),n}function $b(r,e){Nc(r,function(t,n,i){var o=0;if(t.geometry){var c=t.geometry.type;if(!(c==="Point"||c==="MultiPoint")){var a,d=0,p=0,y=0;if(Th(t,function(_,w,T,M,$){if(a===void 0||n>d||M>p||$>y){a=_,d=n,p=M,y=$,o=0;return}var P=Jo([a,_],t.properties);if(e(P,n,i,$,o)===!1)return!1;o++,a=_})===!1)return!1}}})}function qx(r,e,t){var n=t,i=!1;return $b(r,function(o,c,a,d,p){i===!1&&t===void 0?n=o:n=e(n,o,c,a,d,p),i=!0}),n}function Rb(r,e){if(!r)throw new Error("geojson is required");Nc(r,function(t,n,i){if(t.geometry!==null){var o=t.geometry.type,c=t.geometry.coordinates;switch(o){case"LineString":if(e(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var a=0;a<c.length;a++)if(e(Jo(c[a],t.properties),n,i,a)===!1)return!1;break}}})}function Zx(r,e,t){var n=t;return Rb(r,function(i,o,c,a){o===0&&t===void 0?n=i:n=e(n,i,o,c,a)}),n}function Gx(r,e){if(e=e||{},!Vm(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,c=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),c=c||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":c=c||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var d=a.coordinates;switch(a.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=d.length+o-1),Jo([d[o],d[o+1]],c,e);case"Polygon":return i<0&&(i=d.length+i),o<0&&(o=d[i].length+o-1),Jo([d[i][o],d[i][o+1]],c,e);case"MultiLineString":return n<0&&(n=d.length+n),o<0&&(o=d[n].length+o-1),Jo([d[n][o],d[n][o+1]],c,e);case"MultiPolygon":return n<0&&(n=d.length+n),i<0&&(i=d[n].length+i),o<0&&(o=d[n][i].length-o-1),Jo([d[n][i][o],d[n][i][o+1]],c,e)}throw new Error("geojson is invalid")}function Hx(r,e){if(e=e||{},!Vm(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,c=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),c=c||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":c=c||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var d=a.coordinates;switch(a.type){case"Point":return _o(d,c,e);case"MultiPoint":return n<0&&(n=d.length+n),_o(d[n],c,e);case"LineString":return o<0&&(o=d.length+o),_o(d[o],c,e);case"Polygon":return i<0&&(i=d.length+i),o<0&&(o=d[i].length+o),_o(d[i][o],c,e);case"MultiLineString":return n<0&&(n=d.length+n),o<0&&(o=d[n].length+o),_o(d[n][o],c,e);case"MultiPolygon":return n<0&&(n=d.length+n),i<0&&(i=d[n].length+i),o<0&&(o=d[n][i].length-o),_o(d[n][i][o],c,e)}throw new Error("geojson is invalid")}const Wx=Object.freeze(Object.defineProperty({__proto__:null,coordAll:jx,coordEach:Th,coordReduce:Bx,featureEach:cd,featureReduce:Nx,findPoint:Hx,findSegment:Gx,flattenEach:Nc,flattenReduce:Vx,geomEach:qm,geomReduce:Ux,lineEach:Rb,lineReduce:Zx,propEach:Db,propReduce:Ox,segmentEach:$b,segmentReduce:qx},Symbol.toStringTag,{value:"Module"}));function Fb(r,e,t){if(t===void 0&&(t={}),t.final===!0)return Kx(r,e);var n=ph(r),i=ph(e),o=Yo(n[0]),c=Yo(i[0]),a=Yo(n[1]),d=Yo(i[1]),p=Math.sin(c-o)*Math.cos(d),y=Math.cos(a)*Math.sin(d)-Math.sin(a)*Math.cos(d)*Math.cos(c-o);return dh(Math.atan2(p,y))}function Kx(r,e){var t=Fb(e,r);return t=(t+180)%360,t}function V_(r,e,t,n){n===void 0&&(n={});var i=ph(r),o=Yo(i[0]),c=Yo(i[1]),a=Yo(t),d=xd(e,n.units),p=Math.asin(Math.sin(c)*Math.cos(d)+Math.cos(c)*Math.sin(d)*Math.cos(a)),y=o+Math.atan2(Math.sin(a)*Math.sin(d)*Math.cos(c),Math.cos(d)-Math.sin(c)*Math.sin(p)),_=dh(y),w=dh(p);return _o([_,w],n.properties)}function q_(r){if(!r)throw new Error("geojson is required");var e=[];return Nc(r,function(t){Xx(t,e)}),gl(e)}function Xx(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Rc(n);break;case"LineString":t=[Rc(n)]}t.forEach(function(i){var o=Jx(i,r.properties);o.forEach(function(c){c.id=e.length,e.push(c)})})}}function Jx(r,e){var t=[];return r.reduce(function(n,i){var o=Jo([n,i],e);return o.bbox=Yx(n,i),t.push(o),i}),t}function Yx(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],c=t<i?t:i,a=n<o?n:o,d=t>i?t:i,p=n>o?n:o;return[c,a,d,p]}var Zm={exports:{}},Bb={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(Cb,function(){function t(I,F,N,W,se){(function J(ee,me,Ie,Q,ae){for(;Q>Ie;){if(Q-Ie>600){var Pe=Q-Ie+1,ve=me-Ie+1,tt=Math.log(Pe),Ge=.5*Math.exp(2*tt/3),Ee=.5*Math.sqrt(tt*Ge*(Pe-Ge)/Pe)*(ve-Pe/2<0?-1:1),$e=Math.max(Ie,Math.floor(me-ve*Ge/Pe+Ee)),St=Math.min(Q,Math.floor(me+(Pe-ve)*Ge/Pe+Ee));J(ee,me,$e,St,ae)}var rt=ee[me],lt=Ie,mt=Q;for(n(ee,Ie,me),ae(ee[Q],rt)>0&&n(ee,Ie,Q);lt<mt;){for(n(ee,lt,mt),lt++,mt--;ae(ee[lt],rt)<0;)lt++;for(;ae(ee[mt],rt)>0;)mt--}ae(ee[Ie],rt)===0?n(ee,Ie,mt):n(ee,++mt,Q),mt<=me&&(Ie=mt+1),me<=mt&&(Q=mt-1)}})(I,F,N||0,W||I.length-1,se||i)}function n(I,F,N){var W=I[F];I[F]=I[N],I[N]=W}function i(I,F){return I<F?-1:I>F?1:0}var o=function(I){I===void 0&&(I=9),this._maxEntries=Math.max(4,I),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function c(I,F,N){if(!N)return F.indexOf(I);for(var W=0;W<F.length;W++)if(N(I,F[W]))return W;return-1}function a(I,F){d(I,0,I.children.length,F,I)}function d(I,F,N,W,se){se||(se=P(null)),se.minX=1/0,se.minY=1/0,se.maxX=-1/0,se.maxY=-1/0;for(var J=F;J<N;J++){var ee=I.children[J];p(se,I.leaf?W(ee):ee)}return se}function p(I,F){return I.minX=Math.min(I.minX,F.minX),I.minY=Math.min(I.minY,F.minY),I.maxX=Math.max(I.maxX,F.maxX),I.maxY=Math.max(I.maxY,F.maxY),I}function y(I,F){return I.minX-F.minX}function _(I,F){return I.minY-F.minY}function w(I){return(I.maxX-I.minX)*(I.maxY-I.minY)}function T(I){return I.maxX-I.minX+(I.maxY-I.minY)}function M(I,F){return I.minX<=F.minX&&I.minY<=F.minY&&F.maxX<=I.maxX&&F.maxY<=I.maxY}function $(I,F){return F.minX<=I.maxX&&F.minY<=I.maxY&&F.maxX>=I.minX&&F.maxY>=I.minY}function P(I){return{children:I,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function D(I,F,N,W,se){for(var J=[F,N];J.length;)if(!((N=J.pop())-(F=J.pop())<=W)){var ee=F+Math.ceil((N-F)/W/2)*W;t(I,ee,F,N,se),J.push(F,ee,ee,N)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(I){var F=this.data,N=[];if(!$(I,F))return N;for(var W=this.toBBox,se=[];F;){for(var J=0;J<F.children.length;J++){var ee=F.children[J],me=F.leaf?W(ee):ee;$(I,me)&&(F.leaf?N.push(ee):M(I,me)?this._all(ee,N):se.push(ee))}F=se.pop()}return N},o.prototype.collides=function(I){var F=this.data;if(!$(I,F))return!1;for(var N=[];F;){for(var W=0;W<F.children.length;W++){var se=F.children[W],J=F.leaf?this.toBBox(se):se;if($(I,J)){if(F.leaf||M(I,J))return!0;N.push(se)}}F=N.pop()}return!1},o.prototype.load=function(I){if(!I||!I.length)return this;if(I.length<this._minEntries){for(var F=0;F<I.length;F++)this.insert(I[F]);return this}var N=this._build(I.slice(),0,I.length-1,0);if(this.data.children.length)if(this.data.height===N.height)this._splitRoot(this.data,N);else{if(this.data.height<N.height){var W=this.data;this.data=N,N=W}this._insert(N,this.data.height-N.height-1,!0)}else this.data=N;return this},o.prototype.insert=function(I){return I&&this._insert(I,this.data.height-1),this},o.prototype.clear=function(){return this.data=P([]),this},o.prototype.remove=function(I,F){if(!I)return this;for(var N,W,se,J=this.data,ee=this.toBBox(I),me=[],Ie=[];J||me.length;){if(J||(J=me.pop(),W=me[me.length-1],N=Ie.pop(),se=!0),J.leaf){var Q=c(I,J.children,F);if(Q!==-1)return J.children.splice(Q,1),me.push(J),this._condense(me),this}se||J.leaf||!M(J,ee)?W?(N++,J=W.children[N],se=!1):J=null:(me.push(J),Ie.push(N),N=0,W=J,J=J.children[0])}return this},o.prototype.toBBox=function(I){return I},o.prototype.compareMinX=function(I,F){return I.minX-F.minX},o.prototype.compareMinY=function(I,F){return I.minY-F.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(I){return this.data=I,this},o.prototype._all=function(I,F){for(var N=[];I;)I.leaf?F.push.apply(F,I.children):N.push.apply(N,I.children),I=N.pop();return F},o.prototype._build=function(I,F,N,W){var se,J=N-F+1,ee=this._maxEntries;if(J<=ee)return a(se=P(I.slice(F,N+1)),this.toBBox),se;W||(W=Math.ceil(Math.log(J)/Math.log(ee)),ee=Math.ceil(J/Math.pow(ee,W-1))),(se=P([])).leaf=!1,se.height=W;var me=Math.ceil(J/ee),Ie=me*Math.ceil(Math.sqrt(ee));D(I,F,N,Ie,this.compareMinX);for(var Q=F;Q<=N;Q+=Ie){var ae=Math.min(Q+Ie-1,N);D(I,Q,ae,me,this.compareMinY);for(var Pe=Q;Pe<=ae;Pe+=me){var ve=Math.min(Pe+me-1,ae);se.children.push(this._build(I,Pe,ve,W-1))}}return a(se,this.toBBox),se},o.prototype._chooseSubtree=function(I,F,N,W){for(;W.push(F),!F.leaf&&W.length-1!==N;){for(var se=1/0,J=1/0,ee=void 0,me=0;me<F.children.length;me++){var Ie=F.children[me],Q=w(Ie),ae=(Pe=I,ve=Ie,(Math.max(ve.maxX,Pe.maxX)-Math.min(ve.minX,Pe.minX))*(Math.max(ve.maxY,Pe.maxY)-Math.min(ve.minY,Pe.minY))-Q);ae<J?(J=ae,se=Q<se?Q:se,ee=Ie):ae===J&&Q<se&&(se=Q,ee=Ie)}F=ee||F.children[0]}var Pe,ve;return F},o.prototype._insert=function(I,F,N){var W=N?I:this.toBBox(I),se=[],J=this._chooseSubtree(W,this.data,F,se);for(J.children.push(I),p(J,W);F>=0&&se[F].children.length>this._maxEntries;)this._split(se,F),F--;this._adjustParentBBoxes(W,se,F)},o.prototype._split=function(I,F){var N=I[F],W=N.children.length,se=this._minEntries;this._chooseSplitAxis(N,se,W);var J=this._chooseSplitIndex(N,se,W),ee=P(N.children.splice(J,N.children.length-J));ee.height=N.height,ee.leaf=N.leaf,a(N,this.toBBox),a(ee,this.toBBox),F?I[F-1].children.push(ee):this._splitRoot(N,ee)},o.prototype._splitRoot=function(I,F){this.data=P([I,F]),this.data.height=I.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(I,F,N){for(var W,se,J,ee,me,Ie,Q,ae=1/0,Pe=1/0,ve=F;ve<=N-F;ve++){var tt=d(I,0,ve,this.toBBox),Ge=d(I,ve,N,this.toBBox),Ee=(se=tt,J=Ge,ee=void 0,me=void 0,Ie=void 0,Q=void 0,ee=Math.max(se.minX,J.minX),me=Math.max(se.minY,J.minY),Ie=Math.min(se.maxX,J.maxX),Q=Math.min(se.maxY,J.maxY),Math.max(0,Ie-ee)*Math.max(0,Q-me)),$e=w(tt)+w(Ge);Ee<ae?(ae=Ee,W=ve,Pe=$e<Pe?$e:Pe):Ee===ae&&$e<Pe&&(Pe=$e,W=ve)}return W||N-F},o.prototype._chooseSplitAxis=function(I,F,N){var W=I.leaf?this.compareMinX:y,se=I.leaf?this.compareMinY:_;this._allDistMargin(I,F,N,W)<this._allDistMargin(I,F,N,se)&&I.children.sort(W)},o.prototype._allDistMargin=function(I,F,N,W){I.children.sort(W);for(var se=this.toBBox,J=d(I,0,F,se),ee=d(I,N-F,N,se),me=T(J)+T(ee),Ie=F;Ie<N-F;Ie++){var Q=I.children[Ie];p(J,I.leaf?se(Q):Q),me+=T(J)}for(var ae=N-F-1;ae>=F;ae--){var Pe=I.children[ae];p(ee,I.leaf?se(Pe):Pe),me+=T(ee)}return me},o.prototype._adjustParentBBoxes=function(I,F,N){for(var W=N;W>=0;W--)p(F[W],I)},o.prototype._condense=function(I){for(var F=I.length-1,N=void 0;F>=0;F--)I[F].children.length===0?F>0?(N=I[F-1].children).splice(N.indexOf(I[F]),1):this.clear():a(I[F],this.toBBox)},o})})(Bb);var Qx=Bb.exports;const ek=Om(Fx),tk=Om(Wx);function Ob(r,e,t){if(r!==null)for(var n,i,o,c,a,d,p,y=0,_=0,w,T=r.type,M=T==="FeatureCollection",$=T==="Feature",P=M?r.features.length:1,D=0;D<P;D++){p=M?r.features[D].geometry:$?r.geometry:r,w=p?p.type==="GeometryCollection":!1,a=w?p.geometries.length:1;for(var I=0;I<a;I++){var F=0,N=0;if(c=w?p.geometries[I]:p,c!==null){d=c.coordinates;var W=c.type;switch(y=t&&(W==="Polygon"||W==="MultiPolygon")?1:0,W){case null:break;case"Point":if(e(d,_,D,F,N)===!1)return!1;_++,F++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],_,D,F,N)===!1)return!1;_++,W==="MultiPoint"&&F++}W==="LineString"&&F++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-y;i++){if(e(d[n][i],_,D,F,N)===!1)return!1;_++}W==="MultiLineString"&&F++,W==="Polygon"&&N++}W==="Polygon"&&F++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(N=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-y;o++){if(e(d[n][i][o],_,D,F,N)===!1)return!1;_++}N++}F++}break;case"GeometryCollection":for(n=0;n<c.geometries.length;n++)if(Ob(c.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Nb(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return Ob(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var nk=Nb;const rk=Object.freeze(Object.defineProperty({__proto__:null,bbox:Nb,default:nk},Symbol.toStringTag,{value:"Module"})),ik=Om(rk);var Ms=Qx,jb=ek,Ub=tk,wc=ik.default,ok=Ub.featureEach;Ub.coordEach;jb.polygon;var Z_=jb.featureCollection;function Vb(r){var e=new Ms(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:wc(t),Ms.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:wc(i),n.push(i)}):ok(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:wc(i),n.push(i)}),Ms.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:wc(t),Ms.prototype.remove.call(this,t,n)},e.clear=function(){return Ms.prototype.clear.call(this)},e.search=function(t){var n=Ms.prototype.search.call(this,this.toBBox(t));return Z_(n)},e.collides=function(t){return Ms.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Ms.prototype.all.call(this);return Z_(t)},e.toJSON=function(){return Ms.prototype.toJSON.call(this)},e.fromJSON=function(t){return Ms.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=wc(t);else if(t.type==="FeatureCollection")n=wc(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Zm.exports=Vb;Zm.exports.default=Vb;var sk=Zm.exports;const ak=Tb(sk);function lk(r,e){var t={},n=[];if(r.type==="LineString"&&(r=ts(r)),e.type==="LineString"&&(e=ts(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=G_(r,e);return i&&n.push(i),gl(n)}var o=ak();return o.load(q_(e)),cd(q_(r),function(c){cd(o.search(c),function(a){var d=G_(c,a);if(d){var p=Rc(d).join(",");t[p]||(t[p]=!0,n.push(d))}})}),gl(n)}function G_(r,e){var t=Rc(r),n=Rc(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],c=t[1][0],a=t[1][1],d=n[0][0],p=n[0][1],y=n[1][0],_=n[1][1],w=(_-p)*(c-i)-(y-d)*(a-o),T=(y-d)*(o-p)-(_-p)*(i-d),M=(c-i)*(o-p)-(a-o)*(i-d);if(w===0)return null;var $=T/w,P=M/w;if($>=0&&$<=1&&P>=0&&P<=1){var D=i+$*(c-i),I=o+$*(a-o);return _o([D,I])}return null}function ck(r,e,t){t===void 0&&(t={});var n=_o([1/0,1/0],{dist:1/0}),i=0;return Nc(r,function(o){for(var c=Rc(o),a=0;a<c.length-1;a++){var d=_o(c[a]);d.properties.dist=ju(e,d,t);var p=_o(c[a+1]);p.properties.dist=ju(e,p,t);var y=ju(d,p,t),_=Math.max(d.properties.dist,p.properties.dist),w=Fb(d,p),T=V_(e,_,w+90,t),M=V_(e,_,w-90,t),$=lk(Jo([T.geometry.coordinates,M.geometry.coordinates]),Jo([d.geometry.coordinates,p.geometry.coordinates])),P=null;$.features.length>0&&(P=$.features[0],P.properties.dist=ju(e,P,t),P.properties.location=i+ju(d,P,t)),d.properties.dist<n.properties.dist&&(n=d,n.properties.index=a,n.properties.location=i),p.properties.dist<n.properties.dist&&(n=p,n.properties.index=a+1,n.properties.location=i+y),P&&P.properties.dist<n.properties.dist&&(n=P,n.properties.index=a),i+=y}}),n}const uk=30;class hk{constructor(e,t,n,i,o){this.onMouseMove=c=>{if(!this.active)return;const a=[c.point.x-uk,c.point.y],d=this.map.unproject(c.point).distanceTo(this.map.unproject(a));this.inner.onMouseMove(c.lngLat.lng,c.lngLat.lat,d)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=c=>{this.active&&(c.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=c=>{if(!this.active)return;let a=c.target.tagName;a=="INPUT"||a=="TEXTAREA"||c.key=="Escape"&&(c.stopPropagation(),this.cancel())},this.onKeyPress=c=>{if(!this.active)return;let a=c.target.tagName;a=="INPUT"||a=="TEXTAREA"||(c.key=="Enter"?(c.stopPropagation(),this.finish()):c.key=="s"||c.key=="S"?(c.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):c.key=="z"&&c.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new ad(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=n,this.snapMode=i,this.undoLength=o,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}const xc=[];function Vp(r,e){return{subscribe:An(r,e).subscribe}}function An(r,e=et){let t;const n=new Set;function i(a){if(vt(r,a)&&(r=a,t)){const d=!xc.length;for(const p of n)p[1](),xc.push(p,r);if(d){for(let p=0;p<xc.length;p+=2)xc[p][0](xc[p+1]);xc.length=0}}}function o(a){i(a(r))}function c(a,d=et){const p=[a,d];return n.add(p),n.size===1&&(t=e(i,o)||et),a(r),()=>{n.delete(p),n.size===0&&t&&(t(),t=null)}}return{set:i,update:o,subscribe:c}}class fk{constructor(){tr(this,"rootKey","ltn")}get schemaVersionKey(){return`${this.rootKey}/_meta/schema-version`}get storedSchemaVersion(){let e,t=window.localStorage.getItem(this.schemaVersionKey);return t?(e=parseInt(t),Number.isNaN(e)&&(e=0)):e=0,e}ensureMigrated(){if(localStorage.length==0){console.log("localStorage is empty  nothing to migrate."),window.localStorage.setItem(this.schemaVersionKey,2 .toString());return}if(this.storedSchemaVersion==2){console.debug("Schema is already up to date.");return}if(this.storedSchemaVersion<1){console.log(`Migrating storage from version ${this.storedSchemaVersion} to 2`);for(const t of["cnt","global"]){const n=t,i=new qp(n,1,Xf);for(const[o,c]of dk(n))for(const{projectKey:a,projectName:d}of c){let p=window.localStorage.getItem(a);if(!p){console.warn(`Project features not found for ${a}, skipping migration`);continue}let y=JSON.parse(p);y.app_focus=n,y.study_area_name=o,y.project_name=d,console.log(`migrating project ${a}`);let _=i.createProject(y);console.log(`Successfully migrated v0->v1 project ${a} -> ${i.projectKey(_)}`),window.localStorage.removeItem(a)}}}if(this.storedSchemaVersion<2)for(const t of["cnt","global"]){const n=t,i=new qp(n,2,Xf);for(const[o,c]of i.projects()){if(c.db_schema_version>=2){console.log(`skipping previously migrated project: ${o}`);continue}c.db_schema_version=2,i.saveProject(o,c),console.log(`Successfully migrated v1->v2 project: ${i.projectKey(o)}`)}}window.localStorage.setItem(this.schemaVersionKey,2 .toString()),console.debug("Completed migrating database to v2")}projectStorage(e){return this.ensureMigrated(),new qp(e,this.storedSchemaVersion,Xf)}}const Xf=Symbol("internal_method_token");class qp{constructor(e,t,n){tr(this,"appFocus");tr(this,"dbSchemaVersion");if(n!==Xf)throw new Error("ProjectStorage must be created via Database.projectStorage()");this.appFocus=e,this.dbSchemaVersion=t}get collectionKey(){return"ltn/projects"}projectKey(e){if(!e)throw new Error("Cannot get project. ProjectID was blank/missing.");return`${this.collectionKey}/${e}`}projectName(e){return this.project(e).project_name}projectNameAlreadyExists(e){for(const[t,n]of this.projects())if(n.project_name==e)return!0;return!1}nextAvailableProjectName(e){if(this.projectNameAlreadyExists(e)){let t=e,n=2;do e=`${t} (${n})`,n++;while(this.projectNameAlreadyExists(e))}return e}nextAvailableNeighbourhoodName(e){let t=this.project(e),n=`${t.project_name} LTN`,i=t.features.filter(a=>{var d;return((d=a.properties)==null?void 0:d.kind)=="boundary"}),o=n,c=1;for(;i.some(a=>{var d;return((d=a.properties)==null?void 0:d.name)==o});)c++,o=`${n} #${c}`;return o}createEmptyProject(e,t){const n={type:"FeatureCollection",features:[],study_area_name:t,project_name:e,app_focus:this.appFocus};return this.createProject(n)}createProject(e){if(this.projectNameAlreadyExists(e.project_name))throw new Error(`Project name already taken: ${e.project_name}`);e.db_schema_version||(e.db_schema_version=this.dbSchemaVersion);let t=crypto.randomUUID();return this.saveProject(t,e),t}studyAreaProjects(){let e=new Map;for(const[t,n]of this.projects()){const i=n.study_area_name;e.has(i)||e.set(i,[]),e.get(i).push({projectID:t,projectName:n.project_name})}for(const[t,n]of e.entries())n.sort((i,o)=>i.projectName.localeCompare(o.projectName));return Array.from(e.entries()).sort((t,n)=>t[0]==null?1:n[0]==null?-1:t[0].localeCompare(n[0]))}projectIDFromKey(e){let t=e.match(/ltn\/projects\/([a-z0-9-]+)/);if(!t)return;let n=t[1];if(n)return n}projects(){return this.globalAndCntProjectKeys().map(e=>{let t=this.projectIDFromKey(e);if(!t)throw new Error(`Cannot get project: no projectID parsed from ${e}`);let n=window.localStorage.getItem(e);if(!n)throw new Error(`Cannot get project: no project found for ${e}`);let i=JSON.parse(n);return i.app_focus!=this.appFocus?null:[t,i]}).filter(e=>e!==null)}globalAndCntProjectKeys(){const e=this.collectionKey;let t=[];for(let n=0;n<localStorage.length;n++){const i=localStorage.key(n);i&&i.startsWith(e)&&t.push(i)}return t}saveProject(e,t){let n=this.projectKey(e);t.study_area_name||delete t.study_area_name,window.localStorage.setItem(n,JSON.stringify(t))}removeProject(e){let t=this.projectKey(e);window.localStorage.removeItem(t)}renameProject(e,t){let n=this.project(e);if(!n)throw new Error(`Cannot rename project: no existing project found for ${e}`);if(n.project_name==t){console.debug("Ignoring rename, since it's the same name.");return}if(this.projectNameAlreadyExists(t))throw new Error(`Project name ${t} already taken. Choose a different name.`);n.project_name=t,this.saveProject(e,n)}project(e){let t=this.projectKey(e),n=window.localStorage.getItem(t);if(!n)throw new Error(`Cannot get project: no project found for ${e}`);let i=JSON.parse(n);return console.assert(i.study_area_name||i.app_focus!="cnt","missing study area name for cnt project"),console.assert(i.project_name,"missing project name"),i}}function dk(r){let e=new Map,t=[];for(let i=0;i<window.localStorage.length;i++){let o=window.localStorage.key(i);if(o.startsWith("ltn_cnt/")){if(r!="cnt")continue;try{let[c,a,d]=o.split("/");e.has(a)||e.set(a,[]),e.get(a).push({projectKey:o,projectName:d})}catch(c){console.log(`error loading cnt project: ${o}`,c)}}else if(o.startsWith("ltn_")){if(r!="global")continue;let c=o.split("ltn_"),a=c[c.length-1],d="";try{d=JSON.parse(window.localStorage.getItem(o)).study_area_name}catch(p){console.log(`error loading global project: ${o}`,p)}d&&d.length>0?(e.has(d)||e.set(d,[]),e.get(d).push({projectKey:o,projectName:a})):t.push({projectKey:o,projectName:a})}}let n=[...e.entries()];return n.sort((i,o)=>i[0].localeCompare(o[0])),t.length>0&&n.push([void 0,t]),n}const qb="MZEJTanw3WpxRvt7qDfo";let Ro=An(null),Fo=An("global"),_l=An(void 0),Gm=new fk,Qs=An(Gm.projectStorage(fi(Fo)));Fo.subscribe(r=>{Qs.set(Gm.projectStorage(r))});let ud=An(!1),Ar=An(null),sh=An(new Ks.LngLat(0,0)),ah=An(new Ks.LngLat(0,0)),jf=An(new Ks.LngLat(0,0)),H_=An(1),so=An(1),an=An({mode:"title",firstLoad:!0}),hd=An(!1),sm=An("streets-v2"),am=An("walk_cycle_only"),W_=An(!1),lm=An(!0),fd=An(!0),dd=An("shortcuts"),cm=An(!1),um=An(!0),K_=An(500);function mh(){const r=fi(_l);try{fi(Qs).saveProject(r,fi(Ar).toSavefile())}catch(e){window.alert(`Autosave failed: ${e}`)}}let hm=An(!1);function zo(r){return fi(hm)?`/${r}`:`https://assets.od2net.org/${r}`}function Bo(){var e;an.set({mode:"title",firstLoad:!1});let r=[-180,-90,180,90];fi(Fo)=="cnt"&&(r=[-8.943,54.631,-.901,59.489]),(e=fi(Ro))==null||e.fitBounds(r,{duration:500})}function fm(r){var n;function e(i){const o=i.getEast()-i.getWest();let c=i.getWest()+Math.random()*o;const a=i.getNorth()-i.getSouth();let d=i.getSouth()+Math.random()*a;return new Ks.LngLat(c,d)}const t=(n=fi(Ro))==null?void 0:n.getBounds();if(!t){console.assert(!1,"missing map bounds");return}t.contains(fi(r))||r.set(e(t))}function pk(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M,$;return{c(){e=U("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",t=oe(),n=U("p"),n.innerHTML=`This is the second version of the A/B Street LTN tool, <a href="https://github.com/a-b-street/ltn" target="_blank">an open source project</a>. This version, called the Connected Neighbourhoods Tool, has been funded
    by
    <a href="https://www.transport.gov.scot/" target="_blank">Transport Scotland</a>
    and designed by
    <a href="https://www.sustrans.org.uk" target="_blank">Sustrans Scotland</a>.
    The team includes:`,i=oe(),o=U("ul"),o.innerHTML=`<li>Dustin Carlino, lead developer and director of <a href="https://find-and-update.company-information.service.gov.uk/company/16217327" target="_blank">A/B Street Ltd</a></li> <li><a href="https://github.com/michaelkirk/" target="_blank">Michael Kirk</a>, software developer</li> <li>Sustrans Scotland
      <ul><li><a href="https://www.linkedin.com/in/congying-hu/" target="_blank">Congying (Cici) Hu</a>, mobility planner</li> <li><a href="https://www.linkedin.com/in/angus-calder-a69543206" target="_blank">Angus Calder</a>, senior mobility planner</li> <li>Michael Naysmith, senior mobility planner (project manager)</li> <li><a href="https://www.linkedin.com/in/matthew-davis-6b3a8124/" target="_blank">Matthew Davis</a>, principal mobility planner</li></ul></li>`,c=oe(),a=U("p"),a.innerHTML=`This second version of the tool is an evolution from the original A/B Street
    tool, with <a href="https://a-b-street.github.io/docs/software/ltn/index.html#credits" target="_blank">many people</a> to thank there. Of the dozens of users giving excellent feedback and shaping
    the tools development, particular thanks to:`,d=oe(),p=U("ul"),p.innerHTML='<li><a href="https://github.com/XioNoX" target="_blank">Arzhel Younsi</a></li> <li><a href="https://github.com/rouelibre1" target="_blank">Rouelibre1</a></li>',y=oe(),_=U("p"),_.textContent="This tool would not be possible without:",w=oe(),T=U("ul"),T.innerHTML='<li><a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap contributors</a></li> <li><a href="https://www.maptiler.com/" target="_blank">Maptiler</a></li> <li><a href="https://georust.org/" target="_blank">GeoRust</a></li> <li><a href="https://lucide.dev/" target="_blank">Lucide icons</a></li> <li>And countless other open source libraries</li>',M=oe(),$=U("p"),$.textContent="Some road signs images  Crown copyright."},m(P,D){q(P,e,D),q(P,t,D),q(P,n,D),q(P,i,D),q(P,o,D),q(P,c,D),q(P,a,D),q(P,d,D),q(P,p,D),q(P,y,D),q(P,_,D),q(P,w,D),q(P,T,D),q(P,M,D),q(P,$,D)},p:et,d(P){P&&(V(e),V(t),V(n),V(i),V(o),V(c),V(a),V(d),V(p),V(y),V(_),V(w),V(T),V(M),V($))}}}function mk(r){let e,t,n;function i(c){r[1](c)}let o={$$slots:{default:[pk]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.show=r[0]),e=new vd({props:o}),hn.push(()=>In(e,"show",i)),{c(){fe(e.$$.fragment)},m(c,a){ue(e,c,a),n=!0},p(c,[a]){const d={};a&4&&(d.$$scope={dirty:a,ctx:c}),!t&&a&1&&(t=!0,d.show=c[0],En(()=>t=!1)),e.$set(d)},i(c){n||(j(e.$$.fragment,c),n=!0)},o(c){Z(e.$$.fragment,c),n=!1},d(c){he(e,c)}}}function gk(r,e,t){let n;at(r,ud,o=>t(0,n=o));function i(o){n=o,ud.set(n)}return[n,i]}class _k extends Lt{constructor(e){super(),Mt(this,e,gk,mk,vt,{})}}/**
 * @license lucide-svelte v0.475.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const yk={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},X_=yk;function J_(r,e,t){const n=r.slice();return n[11]=e[t][0],n[12]=e[t][1],n}function Zp(r){let e,t=[r[12]],n={};for(let i=0;i<t.length;i+=1)n=Bt(n,t[i]);return{c(){e=ds(r[11]),sd(e,n)},m(i,o){q(i,e,o)},p(i,o){sd(e,n=Fn(t,[o&32&&i[12]]))},d(i){i&&V(e)}}}function Y_(r){let e=r[11],t,n=r[11]&&Zp(r);return{c(){n&&n.c(),t=Xn()},m(i,o){n&&n.m(i,o),q(i,t,o)},p(i,o){i[11]?e?vt(e,i[11])?(n.d(1),n=Zp(i),e=i[11],n.c(),n.m(t.parentNode,t)):n.p(i,o):(n=Zp(i),e=i[11],n.c(),n.m(t.parentNode,t)):e&&(n.d(1),n=null,e=i[11])},d(i){i&&V(t),n&&n.d(i)}}}function bk(r){let e,t,n,i,o,c=Rn(r[5]),a=[];for(let w=0;w<c.length;w+=1)a[w]=Y_(J_(r,c,w));const d=r[10].default,p=Sn(d,r,r[9],null);let y=[X_,r[7],{width:r[2]},{height:r[2]},{stroke:r[1]},{"stroke-width":n=r[4]?Number(r[3])*24/Number(r[2]):r[3]},{class:i=r[6]("lucide-icon","lucide",r[0]?`lucide-${r[0]}`:"",r[8].class)}],_={};for(let w=0;w<y.length;w+=1)_=Bt(_,y[w]);return{c(){e=ds("svg");for(let w=0;w<a.length;w+=1)a[w].c();t=Xn(),p&&p.c(),sd(e,_)},m(w,T){q(w,e,T);for(let M=0;M<a.length;M+=1)a[M]&&a[M].m(e,null);R(e,t),p&&p.m(e,null),o=!0},p(w,[T]){if(T&32){c=Rn(w[5]);let M;for(M=0;M<c.length;M+=1){const $=J_(w,c,M);a[M]?a[M].p($,T):(a[M]=Y_($),a[M].c(),a[M].m(e,t))}for(;M<a.length;M+=1)a[M].d(1);a.length=c.length}p&&p.p&&(!o||T&512)&&Tn(p,d,w,w[9],o?Cn(d,w[9],T,null):Mn(w[9]),null),sd(e,_=Fn(y,[X_,T&128&&w[7],(!o||T&4)&&{width:w[2]},(!o||T&4)&&{height:w[2]},(!o||T&2)&&{stroke:w[1]},(!o||T&28&&n!==(n=w[4]?Number(w[3])*24/Number(w[2]):w[3]))&&{"stroke-width":n},(!o||T&257&&i!==(i=w[6]("lucide-icon","lucide",w[0]?`lucide-${w[0]}`:"",w[8].class)))&&{class:i}]))},i(w){o||(j(p,w),o=!0)},o(w){Z(p,w),o=!1},d(w){w&&V(e),di(a,w),p&&p.d(w)}}}function vk(r,e,t){const n=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"];let i=F_(e,n),{$$slots:o={},$$scope:c}=e,{name:a=void 0}=e,{color:d="currentColor"}=e,{size:p=24}=e,{strokeWidth:y=2}=e,{absoluteStrokeWidth:_=!1}=e,{iconNode:w=[]}=e;const T=(...M)=>M.filter(($,P,D)=>!!$&&D.indexOf($)===P).join(" ");return r.$$set=M=>{t(8,e=Bt(Bt({},e),pi(M))),t(7,i=F_(e,n)),"name"in M&&t(0,a=M.name),"color"in M&&t(1,d=M.color),"size"in M&&t(2,p=M.size),"strokeWidth"in M&&t(3,y=M.strokeWidth),"absoluteStrokeWidth"in M&&t(4,_=M.absoluteStrokeWidth),"iconNode"in M&&t(5,w=M.iconNode),"$$scope"in M&&t(9,c=M.$$scope)},e=pi(e),[a,d,p,y,_,w,T,i,e,c,o]}class wk extends Lt{constructor(e){super(),Mt(this,e,vk,bk,vt,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5})}}const ea=wk;function xk(r){let e;const t=r[2].default,n=Sn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&Tn(n,t,i,i[3],e?Cn(t,i[3],o,null):Mn(i[3]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function kk(r){let e,t;const n=[{name:"circle-help"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[xk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new ea({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,[c]){const a=c&3?Fn(n,[n[0],c&2&&Ys(o[1]),c&1&&{iconNode:o[0]}]):{};c&8&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function Sk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return r.$$set=c=>{t(1,e=Bt(Bt({},e),pi(c))),"$$scope"in c&&t(3,i=c.$$scope)},e=pi(e),[o,e,n,i]}class Ck extends Lt{constructor(e){super(),Mt(this,e,Sk,kk,vt,{})}}const Tk=Ck;function Mk(r){let e;const t=r[2].default,n=Sn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&Tn(n,t,i,i[3],e?Cn(t,i[3],o,null):Mn(i[3]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function Lk(r){let e,t;const n=[{name:"circle-plus"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Mk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new ea({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,[c]){const a=c&3?Fn(n,[n[0],c&2&&Ys(o[1]),c&1&&{iconNode:o[0]}]):{};c&8&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function Ek(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M8 12h8"}],["path",{d:"M12 8v8"}]];return r.$$set=c=>{t(1,e=Bt(Bt({},e),pi(c))),"$$scope"in c&&t(3,i=c.$$scope)},e=pi(e),[o,e,n,i]}class Ik extends Lt{constructor(e){super(),Mt(this,e,Ek,Lk,vt,{})}}const Ak=Ik;function Pk(r){let e;const t=r[2].default,n=Sn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&Tn(n,t,i,i[3],e?Cn(t,i[3],o,null):Mn(i[3]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function zk(r){let e,t;const n=[{name:"file-down"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Pk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new ea({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,[c]){const a=c&3?Fn(n,[n[0],c&2&&Ys(o[1]),c&1&&{iconNode:o[0]}]):{};c&8&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function Dk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}],["path",{d:"M12 18v-6"}],["path",{d:"m9 15 3 3 3-3"}]];return r.$$set=c=>{t(1,e=Bt(Bt({},e),pi(c))),"$$scope"in c&&t(3,i=c.$$scope)},e=pi(e),[o,e,n,i]}class $k extends Lt{constructor(e){super(),Mt(this,e,Dk,zk,vt,{})}}const Zb=$k;function Rk(r){let e;const t=r[2].default,n=Sn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&Tn(n,t,i,i[3],e?Cn(t,i[3],o,null):Mn(i[3]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function Fk(r){let e,t;const n=[{name:"layers"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Rk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new ea({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,[c]){const a=c&3?Fn(n,[n[0],c&2&&Ys(o[1]),c&1&&{iconNode:o[0]}]):{};c&8&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function Bk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17"}]];return r.$$set=c=>{t(1,e=Bt(Bt({},e),pi(c))),"$$scope"in c&&t(3,i=c.$$scope)},e=pi(e),[o,e,n,i]}class Ok extends Lt{constructor(e){super(),Mt(this,e,Bk,Fk,vt,{})}}const Nk=Ok;function jk(r){let e;const t=r[2].default,n=Sn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&Tn(n,t,i,i[3],e?Cn(t,i[3],o,null):Mn(i[3]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function Uk(r){let e,t;const n=[{name:"paintbrush-vertical"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[jk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new ea({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,[c]){const a=c&3?Fn(n,[n[0],c&2&&Ys(o[1]),c&1&&{iconNode:o[0]}]):{};c&8&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function Vk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M10 2v2"}],["path",{d:"M14 2v4"}],["path",{d:"M17 2a1 1 0 0 1 1 1v9H6V3a1 1 0 0 1 1-1z"}],["path",{d:"M6 12a1 1 0 0 0-1 1v1a2 2 0 0 0 2 2h2a1 1 0 0 1 1 1v2.9a2 2 0 1 0 4 0V17a1 1 0 0 1 1-1h2a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1"}]];return r.$$set=c=>{t(1,e=Bt(Bt({},e),pi(c))),"$$scope"in c&&t(3,i=c.$$scope)},e=pi(e),[o,e,n,i]}class qk extends Lt{constructor(e){super(),Mt(this,e,Vk,Uk,vt,{})}}const Zk=qk;function Gk(r){let e;const t=r[2].default,n=Sn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&Tn(n,t,i,i[3],e?Cn(t,i[3],o,null):Mn(i[3]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function Hk(r){let e,t;const n=[{name:"pencil"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Gk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new ea({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,[c]){const a=c&3?Fn(n,[n[0],c&2&&Ys(o[1]),c&1&&{iconNode:o[0]}]):{};c&8&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function Wk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return r.$$set=c=>{t(1,e=Bt(Bt({},e),pi(c))),"$$scope"in c&&t(3,i=c.$$scope)},e=pi(e),[o,e,n,i]}class Kk extends Lt{constructor(e){super(),Mt(this,e,Wk,Hk,vt,{})}}const Gb=Kk;function Xk(r){let e;const t=r[2].default,n=Sn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&Tn(n,t,i,i[3],e?Cn(t,i[3],o,null):Mn(i[3]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function Jk(r){let e,t;const n=[{name:"redo"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Xk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new ea({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,[c]){const a=c&3?Fn(n,[n[0],c&2&&Ys(o[1]),c&1&&{iconNode:o[0]}]):{};c&8&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function Yk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M21 7v6h-6"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7"}]];return r.$$set=c=>{t(1,e=Bt(Bt({},e),pi(c))),"$$scope"in c&&t(3,i=c.$$scope)},e=pi(e),[o,e,n,i]}class Qk extends Lt{constructor(e){super(),Mt(this,e,Yk,Jk,vt,{})}}const e3=Qk;function t3(r){let e;const t=r[2].default,n=Sn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&Tn(n,t,i,i[3],e?Cn(t,i[3],o,null):Mn(i[3]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function n3(r){let e,t;const n=[{name:"trash-2"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[t3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new ea({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,[c]){const a=c&3?Fn(n,[n[0],c&2&&Ys(o[1]),c&1&&{iconNode:o[0]}]):{};c&8&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function r3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]];return r.$$set=c=>{t(1,e=Bt(Bt({},e),pi(c))),"$$scope"in c&&t(3,i=c.$$scope)},e=pi(e),[o,e,n,i]}class i3 extends Lt{constructor(e){super(),Mt(this,e,r3,n3,vt,{})}}const Hm=i3;function o3(r){let e;const t=r[2].default,n=Sn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&Tn(n,t,i,i[3],e?Cn(t,i[3],o,null):Mn(i[3]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function s3(r){let e,t;const n=[{name:"undo"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[o3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new ea({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,[c]){const a=c&3?Fn(n,[n[0],c&2&&Ys(o[1]),c&1&&{iconNode:o[0]}]):{};c&8&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function a3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M3 7v6h6"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"}]];return r.$$set=c=>{t(1,e=Bt(Bt({},e),pi(c))),"$$scope"in c&&t(3,i=c.$$scope)},e=pi(e),[o,e,n,i]}class l3 extends Lt{constructor(e){super(),Mt(this,e,a3,s3,vt,{})}}const c3=l3;let u3=Date.now();function vl(r){return`${r}-${u3++}`}const Wm=Symbol.for("svelte-maplibre");function Da(){return kh(Wm)}function h3(r){let e=new WeakMap;return t=>{var c;let n=e.get(t.originalEvent);if(n!==void 0)return n;let o=(c=t.target.queryRenderedFeatures(t.point).find(a=>{var d;return(d=r.get(a.layer.id))==null?void 0:d.interactive}))==null?void 0:c.layer.id;return e.set(t.originalEvent,o),o}}function f3(){let r=new Map;return bd(Wm,{map:An(null),source:Vp(null),layer:Vp(null),popupTarget:Vp(null),cluster:An(),loadedImages:An(new Set),minzoom:An(0),maxzoom:An(24),layerEvent:An(null),layerInfo:r,eventTopMost:h3(r),markerClickManager:new m3})}function Q_(r){return{subscribe:r.subscribe}}function Km({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let i=Da(),o=An(null),c=Q_(o),a={...i,[r]:Q_(o)};if(e&&(a.popupTarget=c),n){let d=An(null);a.layerEvent=d,i.layerEvent=d}return t&&(a.cluster=An()),bd(Wm,a),{...i,self:o}}function Hb(){return Km({key:"source",setCluster:!0})}function Wb(r=!0){return Km({key:"layer",setPopupTarget:r,setMouseEvent:r})}function d3(){return Km({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}function p3(r){return"layerType"in r&&r.layerType==="deckgl"}class m3{constructor(){tr(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}function e0(r){let e;return t=>{if(t)for(let n in t){let i=e==null?void 0:e[n],o=t[n];i!==o&&r(n,o,i)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function g3(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function _3(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Hn(r,e){return["case",["boolean",["feature-state","hover"],!1],e,r]}var La=y3;function y3(r){var e,t,n;if(r){if(Array.isArray(r)){for(e=[],t=r.length,n=0;n<t;n++){var i=r[n];i!=null&&e.push(i)}return e}if(typeof r=="object"){e={};var o=Object.keys(r);for(t=o.length,n=0;n<t;n++){var c=o[n],a=r[c];a!=null&&(e[c]=a)}return e}}}function t0(r){let e=r[0],t,n,i=n0(r);return{c(){i.c(),t=Xn()},m(o,c){i.m(o,c),q(o,t,c),n=!0},p(o,c){c[0]&1&&vt(e,e=o[0])?(en(),Z(i,1,1,et),tn(),i=n0(o),i.c(),j(i,1),i.m(t.parentNode,t)):i.p(o,c)},i(o){n||(j(i),n=!0)},o(o){Z(i),n=!1},d(o){o&&V(t),i.d(o)}}}function n0(r){let e;const t=r[36].default,n=Sn(t,r,r[35],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[1]&16)&&Tn(n,t,i,i[35],e?Cn(t,i[35],o,null):Mn(i[35]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function b3(r){let e,t,n=r[0]&&t0(r);return{c(){n&&n.c(),e=Xn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o[0]&1&&j(n,1)):(n=t0(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(en(),Z(n,1,1,()=>{n=null}),tn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function v3(r,e,t){let n,i,o,c,a,d,p,y,_,w,T,M,{$$slots:$={},$$scope:P}=e,{id:D=vl("layer")}=e,{source:I=void 0}=e,{sourceLayer:F=void 0}=e,{beforeId:N=void 0}=e,{beforeLayerType:W=void 0}=e,{type:se}=e,{paint:J=void 0}=e,{layout:ee=void 0}=e,{filter:me=void 0}=e,{applyToClusters:Ie=void 0}=e,{minzoom:Q=void 0}=e,{maxzoom:ae=void 0}=e,{manageHoverState:Pe=!1}=e,{hovered:ve=null}=e,{interactive:tt=!0}=e,{hoverCursor:Ge=void 0}=e,{eventsIfTopMost:Ee=!1}=e;const $e=ms(),{map:St,source:rt,self:lt,minzoom:mt,maxzoom:ft,eventTopMost:Xe,layerInfo:Dt}=Wb();at(r,St,ze=>t(31,_=ze)),at(r,rt,ze=>t(32,w=ze)),at(r,lt,ze=>t(0,y=ze)),at(r,mt,ze=>t(34,M=ze)),at(r,ft,ze=>t(33,T=ze)),Yr(()=>{y&&_&&(Dt.delete(y),_==null||_.removeLayer(y))});let _t;function $t(ze){var _e,vn;if(!tt||!y||!_||Ee&&Xe(ze)!==y)return;let Ne=ze.features??[],kt=(vn=(_e=Ne[0])==null?void 0:_e.properties)==null?void 0:vn.cluster_id,jt={event:ze,map:_,clusterId:kt,layer:y,source:a,features:Ne};$e(ze.type,jt)}function Et(ze){var _e,vn;if(!tt||!y||!_||Ee&&Xe(ze)!==y)return;Ge&&(_.getCanvas().style.cursor=Ge);let Ne=ze.features??[];t(6,ve=Ne[0]??null);let kt=(vn=(_e=Ne[0])==null?void 0:_e.properties)==null?void 0:vn.cluster_id;$e("mouseenter",{event:ze,map:_,clusterId:kt,layer:y,source:a,features:Ne})}function Yt(ze){var _e,vn,Ue;if(!tt||!_)return;if(Ee&&Xe(ze)!==y){t(6,ve=null),Pe&&_t!==void 0&&(_==null||_.setFeatureState({source:a,sourceLayer:F,id:_t},{hover:!1}),_t=void 0);return}_.getCanvas().style.cursor=Ge;let Ne=ze.features??[],kt=(vn=(_e=Ne[0])==null?void 0:_e.properties)==null?void 0:vn.cluster_id,jt=(Ue=Ne[0])==null?void 0:Ue.id;jt!==_t&&(Pe&&(_t!==void 0&&(_==null||_.setFeatureState({source:a,id:_t,sourceLayer:F},{hover:!1})),_==null||_.setFeatureState({source:a,id:jt,sourceLayer:F},{hover:!0})),_t=jt,t(6,ve=Ne[0]??null)),$e("mousemove",{event:ze,map:_,clusterId:kt,layer:y,source:a,features:Ne})}function _n(ze){if(!(!tt||!y||!_)){if(Ge&&(_.getCanvas().style.cursor=""),t(6,ve=null),Pe&&_t!==void 0){const Ne={source:a,id:_t,sourceLayer:F};_==null||_.setFeatureState(Ne,{hover:!1}),_t=void 0}$e("mouseleave",{map:_,layer:y,source:a})}}let Zt=!0;function ln(ze){_&&(_.off("click",ze,$t),_.off("dblclick",ze,$t),_.off("contextmenu",ze,$t),_.off("mouseenter",ze,Et),_.off("mousemove",ze,Yt),_.off("mouseleave",ze,_n))}return Yr(()=>{_&&y&&ln(y)}),r.$$set=ze=>{"id"in ze&&t(7,D=ze.id),"source"in ze&&t(8,I=ze.source),"sourceLayer"in ze&&t(9,F=ze.sourceLayer),"beforeId"in ze&&t(10,N=ze.beforeId),"beforeLayerType"in ze&&t(11,W=ze.beforeLayerType),"type"in ze&&t(12,se=ze.type),"paint"in ze&&t(13,J=ze.paint),"layout"in ze&&t(14,ee=ze.layout),"filter"in ze&&t(15,me=ze.filter),"applyToClusters"in ze&&t(16,Ie=ze.applyToClusters),"minzoom"in ze&&t(17,Q=ze.minzoom),"maxzoom"in ze&&t(18,ae=ze.maxzoom),"manageHoverState"in ze&&t(19,Pe=ze.manageHoverState),"hovered"in ze&&t(6,ve=ze.hovered),"interactive"in ze&&t(20,tt=ze.interactive),"hoverCursor"in ze&&t(21,Ge=ze.hoverCursor),"eventsIfTopMost"in ze&&t(22,Ee=ze.eventsIfTopMost),"$$scope"in ze&&t(35,P=ze.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=_3(Ie)),r.$$.dirty[0]&1073774592&&t(24,i=g3("all",n,me)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,o=Q??M),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,c=ae??T),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,a=I||w),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&_&&y!==D&&a){y&&(ln(y),Dt.delete(y));let ze=N;if(!N&&W){let Ne=_.getStyle().layers,kt=typeof W=="function"?W:_e=>_e.type===W,jt=Ne==null?void 0:Ne.find(kt);jt&&(ze=jt.id)}Nt(lt,y=D,y),_.addLayer(La({id:y,type:se,source:a,"source-layer":F,filter:i,paint:J,layout:ee,minzoom:o,maxzoom:c}),ze),t(23,Zt=!0),_.on("click",y,$t),_.on("dblclick",y,$t),_.on("contextmenu",y,$t),_.on("mouseenter",y,Et),_.on("mousemove",y,Yt),_.on("mouseleave",y,_n)}r.$$.dirty[0]&1048577&&y&&Dt.set(y,{interactive:tt}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,d=y?e0((ze,Ne)=>{_!=null&&_.style._loaded?_.setPaintProperty(y,ze,Ne):_==null||_.once("styledata",()=>_==null?void 0:_.setPaintProperty(y,ze,Ne))}):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,p=y?e0((ze,Ne)=>{_!=null&&_.style._loaded?_.setLayoutProperty(y,ze,Ne):_==null||_.once("styledata",()=>_==null?void 0:_.setLayoutProperty(y,ze,Ne))}):void 0),r.$$.dirty[0]&268443648&&(d==null||d(J)),r.$$.dirty[0]&134234112&&(p==null||p(ee)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&y&&(_==null||_.setLayerZoomRange(y,o,c)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&y&&(Zt?t(23,Zt=!1):_==null||_.setFilter(y,i))},[y,St,rt,lt,mt,ft,ve,D,I,F,N,W,se,J,ee,me,Ie,Q,ae,Pe,tt,Ge,Ee,Zt,i,c,o,p,d,a,n,_,w,T,M,P,$]}let kd=class extends Lt{constructor(e){super(),Mt(this,e,v3,b3,vt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function w3(r){let e;const t=r[16].default,n=Sn(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&Tn(n,t,i,i[24],e?Cn(t,i[24],o,null):Mn(i[24]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function x3(r){let e,t,n;function i(c){r[17](c)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[w3]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new kd({props:o}),hn.push(()=>In(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){fe(e.$$.fragment)},m(c,a){ue(e,c,a),n=!0},p(c,[a]){const d={};a&2&&(d.id=c[1]),a&4&&(d.source=c[2]),a&8&&(d.sourceLayer=c[3]),a&16&&(d.beforeId=c[4]),a&32&&(d.beforeLayerType=c[5]),a&64&&(d.paint=c[6]),a&128&&(d.layout=c[7]),a&256&&(d.filter=c[8]),a&512&&(d.applyToClusters=c[9]),a&1024&&(d.minzoom=c[10]),a&2048&&(d.maxzoom=c[11]),a&4096&&(d.hoverCursor=c[12]),a&8192&&(d.manageHoverState=c[13]),a&16384&&(d.eventsIfTopMost=c[14]),a&32768&&(d.interactive=c[15]),a&16777216&&(d.$$scope={dirty:a,ctx:c}),!t&&a&1&&(t=!0,d.hovered=c[0],En(()=>t=!1)),e.$set(d)},i(c){n||(j(e.$$.fragment,c),n=!0)},o(c){Z(e.$$.fragment,c),n=!1},d(c){he(e,c)}}}function k3(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=vl("circle")}=e,{source:c=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:y}=e,{layout:_=void 0}=e,{filter:w=void 0}=e,{applyToClusters:T=void 0}=e,{minzoom:M=void 0}=e,{maxzoom:$=void 0}=e,{hoverCursor:P=void 0}=e,{manageHoverState:D=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:F=!1}=e,{interactive:N=!0}=e;function W(ae){I=ae,t(0,I)}function se(ae){zn.call(this,r,ae)}function J(ae){zn.call(this,r,ae)}function ee(ae){zn.call(this,r,ae)}function me(ae){zn.call(this,r,ae)}function Ie(ae){zn.call(this,r,ae)}function Q(ae){zn.call(this,r,ae)}return r.$$set=ae=>{"id"in ae&&t(1,o=ae.id),"source"in ae&&t(2,c=ae.source),"sourceLayer"in ae&&t(3,a=ae.sourceLayer),"beforeId"in ae&&t(4,d=ae.beforeId),"beforeLayerType"in ae&&t(5,p=ae.beforeLayerType),"paint"in ae&&t(6,y=ae.paint),"layout"in ae&&t(7,_=ae.layout),"filter"in ae&&t(8,w=ae.filter),"applyToClusters"in ae&&t(9,T=ae.applyToClusters),"minzoom"in ae&&t(10,M=ae.minzoom),"maxzoom"in ae&&t(11,$=ae.maxzoom),"hoverCursor"in ae&&t(12,P=ae.hoverCursor),"manageHoverState"in ae&&t(13,D=ae.manageHoverState),"hovered"in ae&&t(0,I=ae.hovered),"eventsIfTopMost"in ae&&t(14,F=ae.eventsIfTopMost),"interactive"in ae&&t(15,N=ae.interactive),"$$scope"in ae&&t(24,i=ae.$$scope)},[I,o,c,a,d,p,y,_,w,T,M,$,P,D,F,N,n,W,se,J,ee,me,Ie,Q,i]}let wl=class extends Lt{constructor(e){super(),Mt(this,e,k3,x3,vt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function S3(r){let e,t;const n=r[7].default,i=Sn(n,r,r[6],null);return{c(){e=U("div"),i&&i.c(),de(e,"class",r[1]),Qt(e,"maplibregl-ctrl",r[0])},m(o,c){q(o,e,c),i&&i.m(e,null),r[8](e),t=!0},p(o,[c]){i&&i.p&&(!t||c&64)&&Tn(i,n,o,o[6],t?Cn(n,o[6],c,null):Mn(o[6]),null),(!t||c&2)&&de(e,"class",o[1]),(!t||c&3)&&Qt(e,"maplibregl-ctrl",o[0])},i(o){t||(j(i,o),t=!0)},o(o){Z(i,o),t=!1},d(o){o&&V(e),i&&i.d(o),r[8](null)}}}function C3(r,e,t){let n,{$$slots:i={},$$scope:o}=e,{defaultStyling:c=!0}=e,{position:a="top-right"}=e,{class:d=void 0}=e;const{map:p}=Da();at(r,p,T=>t(5,n=T));let y,_={onAdd(){return y},onRemove(){var T;(T=y==null?void 0:y.parentNode)==null||T.removeChild(y)}};Yr(()=>{n==null||n.removeControl(_)});function w(T){hn[T?"unshift":"push"](()=>{y=T,t(2,y)})}return r.$$set=T=>{"defaultStyling"in T&&t(0,c=T.defaultStyling),"position"in T&&t(4,a=T.position),"class"in T&&t(1,d=T.class),"$$scope"in T&&t(6,o=T.$$scope)},r.$$.update=()=>{r.$$.dirty&52&&n&&y&&n.addControl(_,a)},[c,d,y,p,a,n,o,i,w]}class T3 extends Lt{constructor(e){super(),Mt(this,e,C3,S3,vt,{defaultStyling:0,position:4,class:1})}}function M3(r){let e;const t=r[15].default,n=Sn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&Tn(n,t,i,i[23],e?Cn(t,i[23],o,null):Mn(i[23]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function L3(r){let e,t,n;function i(c){r[16](c)}let o={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[M3]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new kd({props:o}),hn.push(()=>In(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){fe(e.$$.fragment)},m(c,a){ue(e,c,a),n=!0},p(c,[a]){const d={};a&2&&(d.id=c[1]),a&4&&(d.source=c[2]),a&8&&(d.sourceLayer=c[3]),a&16&&(d.beforeId=c[4]),a&32&&(d.beforeLayerType=c[5]),a&64&&(d.paint=c[6]),a&128&&(d.layout=c[7]),a&256&&(d.filter=c[8]),a&512&&(d.minzoom=c[9]),a&1024&&(d.maxzoom=c[10]),a&2048&&(d.hoverCursor=c[11]),a&4096&&(d.manageHoverState=c[12]),a&8192&&(d.eventsIfTopMost=c[13]),a&16384&&(d.interactive=c[14]),a&8388608&&(d.$$scope={dirty:a,ctx:c}),!t&&a&1&&(t=!0,d.hovered=c[0],En(()=>t=!1)),e.$set(d)},i(c){n||(j(e.$$.fragment,c),n=!0)},o(c){Z(e.$$.fragment,c),n=!1},d(c){he(e,c)}}}function E3(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=vl("fill")}=e,{source:c=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:y}=e,{layout:_=void 0}=e,{filter:w=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:M=void 0}=e,{hoverCursor:$=void 0}=e,{manageHoverState:P=!1}=e,{hovered:D=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:F=!0}=e;function N(Q){D=Q,t(0,D)}function W(Q){zn.call(this,r,Q)}function se(Q){zn.call(this,r,Q)}function J(Q){zn.call(this,r,Q)}function ee(Q){zn.call(this,r,Q)}function me(Q){zn.call(this,r,Q)}function Ie(Q){zn.call(this,r,Q)}return r.$$set=Q=>{"id"in Q&&t(1,o=Q.id),"source"in Q&&t(2,c=Q.source),"sourceLayer"in Q&&t(3,a=Q.sourceLayer),"beforeId"in Q&&t(4,d=Q.beforeId),"beforeLayerType"in Q&&t(5,p=Q.beforeLayerType),"paint"in Q&&t(6,y=Q.paint),"layout"in Q&&t(7,_=Q.layout),"filter"in Q&&t(8,w=Q.filter),"minzoom"in Q&&t(9,T=Q.minzoom),"maxzoom"in Q&&t(10,M=Q.maxzoom),"hoverCursor"in Q&&t(11,$=Q.hoverCursor),"manageHoverState"in Q&&t(12,P=Q.manageHoverState),"hovered"in Q&&t(0,D=Q.hovered),"eventsIfTopMost"in Q&&t(13,I=Q.eventsIfTopMost),"interactive"in Q&&t(14,F=Q.interactive),"$$scope"in Q&&t(23,i=Q.$$scope)},[D,o,c,a,d,p,y,_,w,T,M,$,P,I,F,n,N,W,se,J,ee,me,Ie,i]}let Hi=class extends Lt{constructor(e){super(),Mt(this,e,E3,L3,vt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function I3(r,e,t){let n;const{map:i}=Da();at(r,i,d=>t(4,n=d));let{position:o="top-left"}=e,{container:c=void 0}=e,a=null;return Yr(()=>{n!=null&&n.loaded()&&a&&n.removeControl(a)}),r.$$set=d=>{"position"in d&&t(1,o=d.position),"container"in d&&t(2,c=d.container)},r.$$.update=()=>{if(r.$$.dirty&30&&n&&!a){let d;typeof c=="string"?d=document.querySelector(c)??void 0:d=c,t(3,a=new Jr.FullscreenControl({container:d})),n.addControl(a,o)}},[i,o,c,a,n]}class A3 extends Lt{constructor(e){super(),Mt(this,e,I3,null,vt,{position:1,container:2})}}function Kb(r,e,t,n,i){let o=!1;r.getSource(e)&&(o=!0,r.removeSource(e));const c=()=>{n(e)&&(r.addSource(e,t),i())};if(o){const a=()=>{e&&(r.getSource(e)?setTimeout(a,1):c())};a()}else c()}function Xb(r,e,t){kb().then(()=>{let n=fi(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function r0(r){let e=r[0],t,n,i=i0(r);return{c(){i.c(),t=Xn()},m(o,c){i.m(o,c),q(o,t,c),n=!0},p(o,c){c&1&&vt(e,e=o[0])?(en(),Z(i,1,1,et),tn(),i=i0(o),i.c(),j(i,1),i.m(t.parentNode,t)):i.p(o,c)},i(o){n||(j(i),n=!0)},o(o){Z(i),n=!1},d(o){o&&V(t),i.d(o)}}}function i0(r){let e;const t=r[19].default,n=Sn(t,r,r[18],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&262144)&&Tn(n,t,i,i[18],e?Cn(t,i[18],o,null):Mn(i[18]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function P3(r){let e,t,n=r[0]&&r0(r);return{c(){n&&n.c(),e=Xn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&j(n,1)):(n=r0(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(en(),Z(n,1,1,()=>{n=null}),tn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function z3(r,e,t){let n,i,o,{$$slots:c={},$$scope:a}=e,{id:d=vl("geojson")}=e,{data:p}=e,{generateId:y=!1}=e,{promoteId:_=void 0}=e,{filter:w=void 0}=e,{lineMetrics:T=void 0}=e,{cluster:M=void 0}=e,{maxzoom:$=void 0}=e,{attribution:P=void 0}=e,{buffer:D=void 0}=e,{tolerance:I=void 0}=e;const{map:F,cluster:N,self:W}=Hb();at(r,F,ee=>t(17,i=ee)),at(r,N,ee=>t(20,o=ee)),at(r,W,ee=>t(0,n=ee));let se,J=!0;return Yr(()=>{n&&se&&i&&(Xb(F,n,se),Nt(W,n=null,n),t(15,se=void 0))}),r.$$set=ee=>{"id"in ee&&t(4,d=ee.id),"data"in ee&&t(5,p=ee.data),"generateId"in ee&&t(6,y=ee.generateId),"promoteId"in ee&&t(7,_=ee.promoteId),"filter"in ee&&t(8,w=ee.filter),"lineMetrics"in ee&&t(9,T=ee.lineMetrics),"cluster"in ee&&t(10,M=ee.cluster),"maxzoom"in ee&&t(11,$=ee.maxzoom),"attribution"in ee&&t(12,P=ee.attribution),"buffer"in ee&&t(13,D=ee.buffer),"tolerance"in ee&&t(14,I=ee.tolerance),"$$scope"in ee&&t(18,a=ee.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&Nt(N,o=M,o),r.$$.dirty&196593&&i&&n!==d&&(Nt(W,n=d,n),Kb(i,n,La({type:"geojson",data:p,filter:w,lineMetrics:T,generateId:y,promoteId:_,cluster:!!M,clusterMinPoints:M==null?void 0:M.minPoints,clusterMaxZoom:M==null?void 0:M.maxZoom,clusterRadius:M==null?void 0:M.radius,clusterProperties:M==null?void 0:M.properties,maxzoom:$,attribution:P,buffer:D,tolerance:I}),ee=>i&&ee===n,()=>{n&&(t(15,se=i==null?void 0:i.getSource(n)),t(16,J=!0))})),r.$$.dirty&131088&&(i==null||i.on("style.load",()=>{t(15,se=i==null?void 0:i.getSource(d))})),r.$$.dirty&98336&&se&&(J?t(16,J=!1):se.setData(p)),r.$$.dirty&33792&&(se==null||se.setClusterOptions(La({cluster:!!M,clusterMaxZoom:M==null?void 0:M.maxZoom,clusterRadius:M==null?void 0:M.radius})))},[n,F,N,W,d,p,y,_,w,T,M,$,P,D,I,se,J,i,a,c]}let dr=class extends Lt{constructor(e){super(),Mt(this,e,z3,P3,vt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}};function D3(r,e,t){let n;const{map:i}=Da();at(r,i,w=>t(8,n=w));let{position:o="top-left"}=e,{positionOptions:c=void 0}=e,{fitBoundsOptions:a=void 0}=e,{trackUserLocation:d=!1}=e,{showAccuracyCircle:p=!0}=e,{showUserLocation:y=!0}=e,{control:_=null}=e;return Yr(()=>{n!=null&&n.loaded()&&_&&n.removeControl(_)}),r.$$set=w=>{"position"in w&&t(2,o=w.position),"positionOptions"in w&&t(3,c=w.positionOptions),"fitBoundsOptions"in w&&t(4,a=w.fitBoundsOptions),"trackUserLocation"in w&&t(5,d=w.trackUserLocation),"showAccuracyCircle"in w&&t(6,p=w.showAccuracyCircle),"showUserLocation"in w&&t(7,y=w.showUserLocation),"control"in w&&t(1,_=w.control)},r.$$.update=()=>{r.$$.dirty&510&&n&&!_&&(t(1,_=new Jr.GeolocateControl({positionOptions:c,fitBoundsOptions:a,trackUserLocation:d,showAccuracyCircle:p,showUserLocation:y})),n.addControl(_,o))},[i,_,o,c,a,d,p,y,n]}class $3 extends Lt{constructor(e){super(),Mt(this,e,D3,null,vt,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function R3(r,e,t){let n,i,{data:o}=e,{idCol:c}=e,{sourceLayer:a=void 0}=e,d=new Set;const{map:p,source:y}=Wb();return at(r,p,_=>t(6,n=_)),at(r,y,_=>t(7,i=_)),r.$$set=_=>{"data"in _&&t(2,o=_.data),"idCol"in _&&t(3,c=_.idCol),"sourceLayer"in _&&t(4,a=_.sourceLayer)},r.$$.update=()=>{if(r.$$.dirty&252&&o&&n&&i){let _=new Set;for(const w of o){const T=w[c];if(!T)continue;d.delete(T),_.add(T);const M={id:T,source:i,sourceLayer:a},$=n.getFeatureState(M);let P=!1;for(const D of Object.keys(w))if($[D]!==w[D]){P=!0;break}P&&n.setFeatureState(M,w)}for(const w of d){const T={id:w,source:i,sourceLayer:a},M=n.getFeatureState(T);for(const $ of Object.keys(M))n.removeFeatureState(T,$)}t(5,d=_)}},[p,y,o,c,a,d,n,i]}class F3 extends Lt{constructor(e){super(),Mt(this,e,R3,null,vt,{data:2,idCol:3,sourceLayer:4})}}function B3(r){let e;const t=r[15].default,n=Sn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&Tn(n,t,i,i[23],e?Cn(t,i[23],o,null):Mn(i[23]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function O3(r){let e,t,n;function i(c){r[16](c)}let o={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[B3]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new kd({props:o}),hn.push(()=>In(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){fe(e.$$.fragment)},m(c,a){ue(e,c,a),n=!0},p(c,[a]){const d={};a&2&&(d.id=c[1]),a&4&&(d.source=c[2]),a&8&&(d.sourceLayer=c[3]),a&16&&(d.beforeId=c[4]),a&32&&(d.beforeLayerType=c[5]),a&64&&(d.paint=c[6]),a&128&&(d.layout=c[7]),a&256&&(d.filter=c[8]),a&512&&(d.minzoom=c[9]),a&1024&&(d.maxzoom=c[10]),a&2048&&(d.hoverCursor=c[11]),a&4096&&(d.manageHoverState=c[12]),a&8192&&(d.eventsIfTopMost=c[13]),a&16384&&(d.interactive=c[14]),a&8388608&&(d.$$scope={dirty:a,ctx:c}),!t&&a&1&&(t=!0,d.hovered=c[0],En(()=>t=!1)),e.$set(d)},i(c){n||(j(e.$$.fragment,c),n=!0)},o(c){Z(e.$$.fragment,c),n=!1},d(c){he(e,c)}}}function N3(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=vl("line")}=e,{source:c=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:y}=e,{layout:_=void 0}=e,{filter:w=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:M=void 0}=e,{hoverCursor:$=void 0}=e,{manageHoverState:P=!1}=e,{hovered:D=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:F=!0}=e;function N(Q){D=Q,t(0,D)}function W(Q){zn.call(this,r,Q)}function se(Q){zn.call(this,r,Q)}function J(Q){zn.call(this,r,Q)}function ee(Q){zn.call(this,r,Q)}function me(Q){zn.call(this,r,Q)}function Ie(Q){zn.call(this,r,Q)}return r.$$set=Q=>{"id"in Q&&t(1,o=Q.id),"source"in Q&&t(2,c=Q.source),"sourceLayer"in Q&&t(3,a=Q.sourceLayer),"beforeId"in Q&&t(4,d=Q.beforeId),"beforeLayerType"in Q&&t(5,p=Q.beforeLayerType),"paint"in Q&&t(6,y=Q.paint),"layout"in Q&&t(7,_=Q.layout),"filter"in Q&&t(8,w=Q.filter),"minzoom"in Q&&t(9,T=Q.minzoom),"maxzoom"in Q&&t(10,M=Q.maxzoom),"hoverCursor"in Q&&t(11,$=Q.hoverCursor),"manageHoverState"in Q&&t(12,P=Q.manageHoverState),"hovered"in Q&&t(0,D=Q.hovered),"eventsIfTopMost"in Q&&t(13,I=Q.eventsIfTopMost),"interactive"in Q&&t(14,F=Q.interactive),"$$scope"in Q&&t(23,i=Q.$$scope)},[D,o,c,a,d,p,y,_,w,T,M,$,P,I,F,n,N,W,se,J,ee,me,Ie,i]}let sr=class extends Lt{constructor(e){super(),Mt(this,e,N3,O3,vt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function j3(r,e,t){let n;const i=ms();let{layer:o=void 0}=e;const{map:c}=Da();at(r,c,y=>t(2,n=y));function a(y){i(y.type,{...y,map:c})}const d=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],p=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Yr(()=>{if(n)if(o)for(const y of d)n.off(y,o,a);else for(const y of p)n.off(y,a)}),r.$$set=y=>{"layer"in y&&t(1,o=y.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&n)if(o)for(const y of d)n.on(y,o,a);else for(const y of p)n.on(y,a)},[c,o,n]}class Xm extends Lt{constructor(e){super(),Mt(this,e,j3,null,vt,{layer:1})}}function U3(r){let e=r.getCenter(),t=Math.round(r.getZoom()*100)/100,n=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,n),o=Math.round(e.lat*i)/i,c=Math.round(e.lng*i)/i,a=`${t}/${o}/${c}`,d=r.getBearing(),p=r.getPitch();return(d||p)&&(a+=`/${Math.round(d*10)/10}`),p&&(a+=`/${Math.round(p)}`),`#${a}`}function V3(r){return r.replace("#","").split("/").map(parseFloat)}var kc=Jm;function Jm(r,e){return r===e||r!==r&&e!==e?!0:typeof r!=typeof e||{}.toString.call(r)!={}.toString.call(e)||r!==Object(r)||!r?!1:Array.isArray(r)?o0(r,e):{}.toString.call(r)=="[object Set]"?o0(Array.from(r),Array.from(e)):{}.toString.call(r)=="[object Object]"?Z3(r,e):q3(r,e)}function q3(r,e){return r.toString()===e.toString()}function o0(r,e){var t=r.length;if(t!=e.length)return!1;for(var n=0;n<t;n++)if(!Jm(r[n],e[n]))return!1;return!0}function Z3(r,e){var t=Object.keys(r),n=t.length;if(n!=Object.keys(e).length)return!1;for(var i=0;i<n;i++){var o=t[i];if(!(e.hasOwnProperty(o)&&Jm(r[o],e[o])))return!1}return!0}function G3(r,e,t){let n;const{map:i}=Da();at(r,i,y=>t(6,n=y));let{position:o="top-left"}=e,{showCompass:c=!0}=e,{showZoom:a=!0}=e,{visualizePitch:d=!1}=e,p=null;return Yr(()=>{n!=null&&n.loaded()&&p&&n.removeControl(p)}),r.$$set=y=>{"position"in y&&t(1,o=y.position),"showCompass"in y&&t(2,c=y.showCompass),"showZoom"in y&&t(3,a=y.showZoom),"visualizePitch"in y&&t(4,d=y.visualizePitch)},r.$$.update=()=>{r.$$.dirty&126&&n&&!p&&(t(5,p=new Jr.NavigationControl({showCompass:c,showZoom:a,visualizePitch:d})),n.addControl(p,o))},[i,o,c,a,d,p,n]}class Jb extends Lt{constructor(e){super(),Mt(this,e,G3,null,vt,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function H3(r,e,t){let n;const{map:i}=Da();at(r,i,p=>t(5,n=p));let{position:o="bottom-left"}=e,{maxWidth:c=void 0}=e,{unit:a="metric"}=e,d=null;return Yr(()=>{n!=null&&n.loaded()&&d&&n.removeControl(d)}),r.$$set=p=>{"position"in p&&t(1,o=p.position),"maxWidth"in p&&t(2,c=p.maxWidth),"unit"in p&&t(3,a=p.unit)},r.$$.update=()=>{r.$$.dirty&62&&n&&!d&&(t(4,d=new Jr.ScaleControl({maxWidth:c,unit:a})),n.addControl(d,o))},[i,o,c,a,d,n]}class Yb extends Lt{constructor(e){super(),Mt(this,e,H3,null,vt,{position:1,maxWidth:2,unit:3})}}const{window:W3}=vb,K3=r=>({map:r[0]&16,loadedImages:r[0]&32,allImagesLoaded:r[0]&64}),s0=r=>({map:r[4],loadedImages:r[5],allImagesLoaded:r[6]});function a0(r){let e,t,n=r[3]&&l0(r);const i=r[46].default,o=Sn(i,r,r[45],s0);return{c(){n&&n.c(),e=oe(),o&&o.c()},m(c,a){n&&n.m(c,a),q(c,e,a),o&&o.m(c,a),t=!0},p(c,a){c[3]?n?(n.p(c,a),a[0]&8&&j(n,1)):(n=l0(c),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(en(),Z(n,1,1,()=>{n=null}),tn()),o&&o.p&&(!t||a[0]&112|a[1]&16384)&&Tn(o,i,c,c[45],t?Cn(i,c[45],a,K3):Mn(c[45]),s0)},i(c){t||(j(n),j(o,c),t=!0)},o(c){Z(n),Z(o,c),t=!1},d(c){c&&V(e),n&&n.d(c),o&&o.d(c)}}}function l0(r){let e,t,n,i,o,c,a,d;return e=new Jb({props:{position:r[7]}}),n=new $3({props:{position:r[7],fitBoundsOptions:{maxZoom:12}}}),o=new A3({props:{position:r[7]}}),a=new Yb({props:{position:r[7]}}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment),i=oe(),fe(o.$$.fragment),c=oe(),fe(a.$$.fragment)},m(p,y){ue(e,p,y),q(p,t,y),ue(n,p,y),q(p,i,y),ue(o,p,y),q(p,c,y),ue(a,p,y),d=!0},p(p,y){const _={};y[0]&128&&(_.position=p[7]),e.$set(_);const w={};y[0]&128&&(w.position=p[7]),n.$set(w);const T={};y[0]&128&&(T.position=p[7]),o.$set(T);const M={};y[0]&128&&(M.position=p[7]),a.$set(M)},i(p){d||(j(e.$$.fragment,p),j(n.$$.fragment,p),j(o.$$.fragment,p),j(a.$$.fragment,p),d=!0)},o(p){Z(e.$$.fragment,p),Z(n.$$.fragment,p),Z(o.$$.fragment,p),Z(a.$$.fragment,p),d=!1},d(p){p&&(V(t),V(i),V(c)),he(e,p),he(n,p),he(o,p),he(a,p)}}}function X3(r){let e,t,n,i,o,c=r[4]&&r[0]&&a0(r);return{c(){e=U("div"),c&&c.c(),de(e,"class",t=od(r[2])+" svelte-p00lfq"),de(e,"data-testid","map-container"),Qt(e,"expand-map",!r[2])},m(a,d){q(a,e,d),c&&c.m(e,null),r[47](e),n=!0,i||(o=[wt(W3,"hashchange",r[11]),tm(r[10].call(null,e))],i=!0)},p(a,d){a[4]&&a[0]?c?(c.p(a,d),d[0]&17&&j(c,1)):(c=a0(a),c.c(),j(c,1),c.m(e,null)):c&&(en(),Z(c,1,1,()=>{c=null}),tn()),(!n||d[0]&4&&t!==(t=od(a[2])+" svelte-p00lfq"))&&de(e,"class",t),(!n||d[0]&4)&&Qt(e,"expand-map",!a[2])},i(a){n||(j(c),n=!0)},o(a){Z(c),n=!1},d(a){a&&V(e),c&&c.d(),r[47](null),i=!1,pr(o)}}}function J3(r,e,t){let n,i,o,c,{$$slots:a={},$$scope:d}=e,{map:p=null}=e,{mapContainer:y=void 0}=e,{class:_=void 0}=e,{style:w}=e,{diffStyleUpdates:T=!1}=e,{center:M=void 0}=e,{zoom:$=void 0}=e,{pitch:P=0}=e,{bearing:D=0}=e,{bounds:I=void 0}=e,{hash:F=!1}=e,{updateHash:N=Ue=>{window.history.replaceState(window.history.state,"",Ue)}}=e,{loaded:W=!1}=e,{minZoom:se=0}=e,{maxZoom:J=22}=e,{minPitch:ee=0}=e,{maxPitch:me=60}=e,{renderWorldCopies:Ie=void 0}=e,{dragPan:Q=void 0}=e,{dragRotate:ae=void 0}=e,{pitchWithRotate:Pe=void 0}=e,{antialias:ve=void 0}=e,{zoomOnDoubleClick:tt=!0}=e,{locale:Ge=void 0}=e,{interactive:Ee=!0}=e,{attributionControl:$e=!0}=e,{cooperativeGestures:St=!1}=e,{preserveDrawingBuffer:rt=!1}=e,{maxBounds:lt=void 0}=e,{images:mt=[]}=e,{standardControls:ft=!1}=e,{filterLayers:Xe=void 0}=e,{transformRequest:Dt=void 0}=e;const _t=ms(),{map:$t,loadedImages:Et}=f3();at(r,$t,Ue=>t(4,o=Ue)),at(r,Et,Ue=>t(5,c=Ue));let Yt=new Set;async function _n(Ue,it=!1){if(o&&!(!o.loaded()&&!it))if("url"in Ue){Yt.add(Ue.id);try{let Kt=await o.loadImage(Ue.url);o==null||o.addImage(Ue.id,Kt.data,Ue.options),c.add(Ue.id),Et.set(c)}catch(Kt){_t("error",Kt)}finally{Yt.delete(Ue.id)}}else o.addImage(Ue.id,Ue.data,Ue.options),c.add(Ue.id),Et.set(c)}let Zt,ln,ze,Ne;function kt(Ue){return _e(),Nt($t,o=new Jr.Map(La({container:Ue,style:w,locale:Ge,center:M,zoom:$,pitch:P,bearing:D,minZoom:se,maxZoom:J,minPitch:ee,maxPitch:me,renderWorldCopies:Ie,dragPan:Q,dragRotate:ae,pitchWithRotate:Pe,antialias:ve,interactive:Ee,preserveDrawingBuffer:rt,maxBounds:lt,bounds:I,attributionControl:$e,transformRequest:Dt,cooperativeGestures:St})),o),o.on("load",it=>{it.target.getContainer().setAttribute("data-testid","map"),it.target.getCanvas().setAttribute("data-testid","map-canvas"),t(0,W=!0),_t("load",o)}),o.on("error",it=>_t("error",{...it,map:o})),o.on("movestart",it=>_t("movestart",{...it,map:o})),o.on("moveend",it=>{if(t(12,M=it.target.getCenter()),t(13,$=it.target.getZoom()),t(14,P=it.target.getPitch()),t(15,D=it.target.getBearing()),t(16,I=it.target.getBounds()),_t("moveend",{...it,map:o}),F){let Kt=new URL(window.location.href.replace(/(#.+)?$/,U3(o)));N(Kt)}}),o.on("click",it=>_t("click",{...it,map:o})),o.on("dblclick",it=>_t("dblclick",{...it,map:o})),o.on("contextmenu",it=>_t("contextmenu",{...it,map:o})),o.on("zoomstart",it=>_t("zoomstart",{...it,map:o})),o.on("zoom",it=>{_t("zoom",{...it,map:o})}),o.on("zoomend",it=>{_t("zoomend",{...it,map:o})}),o.on("style.load",()=>{if(o){const it=o.getStyle();if(t(42,Zt=it.layers.map(Kt=>Kt.id)),t(43,ln=Object.keys(it.sources)),Ne)for(const[Kt,ur]of Object.entries(Ne))o.addSource(Kt,ur);if(ze)for(const Kt of ze)o.addLayer(Kt);for(const Kt of mt)_n(Kt,!0)}}),o.on("styledata",it=>{if(o&&Xe){const Kt=o.getStyle().layers;if(Kt)for(let ur of Kt)Xe(ur)||o.setLayoutProperty(ur.id,"visibility","none")}_t("styledata",{...it,map:o})}),{destroy(){t(0,W=!1),o==null||o.remove(),Nt($t,o=null,o)}}}let jt=w;function _e(){if(F){let Ue=V3(window.location.hash);Ue.length>=3&&(t(13,$=Ue[0]),t(12,M=[Ue[2],Ue[1]])),Ue.length==5&&(t(15,D=Ue[3]),t(14,P=Ue[4]))}}function vn(Ue){hn[Ue?"unshift":"push"](()=>{y=Ue,t(1,y)})}return r.$$set=Ue=>{"map"in Ue&&t(17,p=Ue.map),"mapContainer"in Ue&&t(1,y=Ue.mapContainer),"class"in Ue&&t(2,_=Ue.class),"style"in Ue&&t(18,w=Ue.style),"diffStyleUpdates"in Ue&&t(19,T=Ue.diffStyleUpdates),"center"in Ue&&t(12,M=Ue.center),"zoom"in Ue&&t(13,$=Ue.zoom),"pitch"in Ue&&t(14,P=Ue.pitch),"bearing"in Ue&&t(15,D=Ue.bearing),"bounds"in Ue&&t(16,I=Ue.bounds),"hash"in Ue&&t(20,F=Ue.hash),"updateHash"in Ue&&t(21,N=Ue.updateHash),"loaded"in Ue&&t(0,W=Ue.loaded),"minZoom"in Ue&&t(22,se=Ue.minZoom),"maxZoom"in Ue&&t(23,J=Ue.maxZoom),"minPitch"in Ue&&t(24,ee=Ue.minPitch),"maxPitch"in Ue&&t(25,me=Ue.maxPitch),"renderWorldCopies"in Ue&&t(26,Ie=Ue.renderWorldCopies),"dragPan"in Ue&&t(27,Q=Ue.dragPan),"dragRotate"in Ue&&t(28,ae=Ue.dragRotate),"pitchWithRotate"in Ue&&t(29,Pe=Ue.pitchWithRotate),"antialias"in Ue&&t(30,ve=Ue.antialias),"zoomOnDoubleClick"in Ue&&t(31,tt=Ue.zoomOnDoubleClick),"locale"in Ue&&t(32,Ge=Ue.locale),"interactive"in Ue&&t(33,Ee=Ue.interactive),"attributionControl"in Ue&&t(34,$e=Ue.attributionControl),"cooperativeGestures"in Ue&&t(35,St=Ue.cooperativeGestures),"preserveDrawingBuffer"in Ue&&t(36,rt=Ue.preserveDrawingBuffer),"maxBounds"in Ue&&t(37,lt=Ue.maxBounds),"images"in Ue&&t(38,mt=Ue.images),"standardControls"in Ue&&t(3,ft=Ue.standardControls),"filterLayers"in Ue&&t(39,Xe=Ue.filterLayers),"transformRequest"in Ue&&t(40,Dt=Ue.transformRequest),"$$scope"in Ue&&t(45,d=Ue.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&8&&t(7,n=typeof ft=="boolean"?void 0:ft),r.$$.dirty[0]&16&&t(17,p=o),r.$$.dirty[0]&786448|r.$$.dirty[1]&14336&&o&&!kc(w,jt)){const Ue=o.getStyle();if(Zt&&(ze=Ue.layers.filter(it=>!Zt.includes(it.id))),ln){const it=Object.keys(Ue.sources).filter(Kt=>!ln.includes(Kt));Ne={};for(const Kt of it)Ne[Kt]=Ue.sources[Kt]}t(44,jt=w),o.setStyle(w,{diff:T}),Nt(Et,c=new Set,c),t(41,Yt=new Set)}if(r.$$.dirty[0]&49|r.$$.dirty[1]&1152&&W&&o!=null&&o.loaded())for(let Ue of mt)!c.has(Ue.id)&&!Yt.has(Ue.id)&&!o.hasImage(Ue.id)&&_n(Ue);if(r.$$.dirty[0]&32|r.$$.dirty[1]&128&&t(6,i=mt.every(Ue=>c.has(Ue.id))),r.$$.dirty[0]&61456&&o){let Ue={};M!=null&&!kc(M,o==null?void 0:o.getCenter())&&(Ue.center=M),$!=null&&!kc($,o==null?void 0:o.getZoom())&&(Ue.zoom=$),D!=null&&!kc(D,o==null?void 0:o.getBearing())&&(Ue.bearing=D),P!=null&&!kc(P,o==null?void 0:o.getPitch())&&(Ue.pitch=P),Object.keys(Ue).length&&o.easeTo(Ue)}r.$$.dirty[0]&65552&&I&&!kc(I,o==null?void 0:o.getBounds())&&(o==null||o.fitBounds(I)),r.$$.dirty[0]&16|r.$$.dirty[1]&1&&(tt?o==null||o.doubleClickZoom.enable():o==null||o.doubleClickZoom.disable())},[W,y,_,ft,o,c,i,n,$t,Et,kt,_e,M,$,P,D,I,p,w,T,F,N,se,J,ee,me,Ie,Q,ae,Pe,ve,tt,Ge,Ee,$e,St,rt,lt,mt,Xe,Dt,Yt,Zt,ln,jt,d,a,vn]}class Y3 extends Lt{constructor(e){super(),Mt(this,e,J3,X3,vt,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const Q3=r=>({marker:r&8}),c0=r=>({marker:r[3]});function e4(r){let e,t,n,i,o,c,a;const d=r[19].default,p=Sn(d,r,r[18],c0);return{c(){e=U("div"),p&&p.c(),de(e,"tabindex",t=r[1]?0:void 0),de(e,"role",n=r[1]?"button":void 0),st(e,"z-index",r[2])},m(y,_){q(y,e,_),p&&p.m(e,null),o=!0,c||(a=[tm(r[7].call(null,e)),tm(i=t4.call(null,e,r[0])),wt(e,"click",rh(r[20])),wt(e,"dblclick",rh(r[21])),wt(e,"contextmenu",rh(Rm(r[22]))),wt(e,"mouseenter",r[23]),wt(e,"mouseleave",r[24]),wt(e,"mousemove",r[25]),wt(e,"keydown",r[8])],c=!0)},p(y,[_]){p&&p.p&&(!o||_&262152)&&Tn(p,d,y,y[18],o?Cn(d,y[18],_,Q3):Mn(y[18]),c0),(!o||_&2&&t!==(t=y[1]?0:void 0))&&de(e,"tabindex",t),(!o||_&2&&n!==(n=y[1]?"button":void 0))&&de(e,"role",n),i&&bl(i.update)&&_&1&&i.update.call(null,y[0]),_&4&&st(e,"z-index",y[2])},i(y){o||(j(p,y),o=!0)},o(y){Z(p,y),o=!1},d(y){y&&V(e),p&&p.d(y),c=!1,pr(a)}}}function t4(r,e){const t=r.className;function n(i){i?r.className=`${t} ${i}`:r.className=t}return n(e),{update:n}}function n4(r,e,t){let n,i,o,{$$slots:c={},$$scope:a}=e,{marker:d=void 0}=e,{lngLat:p}=e,{class:y=void 0}=e,{interactive:_=!0}=e,{asButton:w=!1}=e,{draggable:T=!1}=e,{feature:M=null}=e,{offset:$=void 0}=e,{zIndex:P=void 0}=e,{rotation:D=0}=e,{opacity:I=1}=e;const F=ms(),{map:N,layerEvent:W,self:se,markerClickManager:J}=d3();at(r,N,$e=>t(27,o=$e)),at(r,W,$e=>t(26,n=$e)),at(r,se,$e=>t(3,i=$e));function ee($e){Nt(se,i=new Jr.Marker({element:$e,rotation:D,draggable:T,offset:$,opacity:I.toString()}).setLngLat(p).addTo(o),i),t(11,d=i);const St=()=>Q("dragstart"),rt=()=>{me(),Q("drag")},lt=()=>{me(),Q("dragend")};return T&&(i.on("dragstart",St),i.on("drag",rt),i.on("dragend",lt)),{destroy(){T&&(i==null||i.off("dragstart",St),i==null||i.off("drag",rt),i==null||i.off("dragend",lt)),t(11,d=void 0),i==null||i.remove()}}}function me(){let $e=i==null?void 0:i.getLngLat();$e&&(Array.isArray(p)?t(10,p=[$e.lng,$e.lat]):p&&"lon"in p?t(10,p={lon:$e.lng,lat:$e.lat}):t(10,p=$e))}function Ie($e){$e.key===" "&&($e.preventDefault(),$e.stopPropagation(),Q("click"))}function Q($e){if(!_)return;let St=i==null?void 0:i.getLngLat();if(!St)return;const rt=[St.lng,St.lat];let lt={map:o,marker:i,lngLat:rt,features:[{type:"Feature",properties:(M==null?void 0:M.properties)??{},geometry:{type:"Point",coordinates:rt}}]};($e==="click"||$e==="contextmenu")&&J.handleClick(lt),Nt(W,n={...lt,layerType:"marker",type:$e},n),F($e,lt)}const ae=()=>Q("click"),Pe=()=>Q("dblclick"),ve=()=>{Q("contextmenu")},tt=()=>{Q("mouseenter")},Ge=()=>{Q("mouseleave")},Ee=()=>Q("mousemove");return r.$$set=$e=>{"marker"in $e&&t(11,d=$e.marker),"lngLat"in $e&&t(10,p=$e.lngLat),"class"in $e&&t(0,y=$e.class),"interactive"in $e&&t(12,_=$e.interactive),"asButton"in $e&&t(1,w=$e.asButton),"draggable"in $e&&t(13,T=$e.draggable),"feature"in $e&&t(14,M=$e.feature),"offset"in $e&&t(15,$=$e.offset),"zIndex"in $e&&t(2,P=$e.zIndex),"rotation"in $e&&t(16,D=$e.rotation),"opacity"in $e&&t(17,I=$e.opacity),"$$scope"in $e&&t(18,a=$e.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(i==null||i.setLngLat(p)),r.$$.dirty&32776&&(i==null||i.setOffset($??[0,0])),r.$$.dirty&65544&&(i==null||i.setRotation(D)),r.$$.dirty&131080&&(i==null||i.setOpacity(I.toString()))},[y,w,P,i,N,W,se,ee,Ie,Q,p,d,_,T,M,$,D,I,a,c,ae,Pe,ve,tt,Ge,Ee]}class Sd extends Lt{constructor(e){super(),Mt(this,e,n4,e4,vt,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}const r4=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),u0=r=>{var e;return{features:r[4],data:((e=r[4])==null?void 0:e[0])??null,map:r[2],close:r[31]}};function h0(r){var i;let e,t,n=(((i=r[4])==null?void 0:i.length)||r[3]instanceof Jr.Marker)&&f0(r);return{c(){e=U("div"),n&&n.c()},m(o,c){q(o,e,c),n&&n.m(e,null),r[32](e),t=!0},p(o,c){var a;(a=o[4])!=null&&a.length||o[3]instanceof Jr.Marker?n?(n.p(o,c),c[0]&24&&j(n,1)):(n=f0(o),n.c(),j(n,1),n.m(e,null)):n&&(en(),Z(n,1,1,()=>{n=null}),tn())},i(o){t||(j(n),t=!0)},o(o){Z(n),t=!1},d(o){o&&V(e),n&&n.d(),r[32](null)}}}function f0(r){let e;const t=r[30].default,n=Sn(t,r,r[29],u0);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[0]&536870933)&&Tn(n,t,i,i[29],e?Cn(t,i[29],o,r4):Mn(i[29]),u0)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function i4(r){let e,t,n=r[9].default&&h0(r);return{c(){n&&n.c(),e=Xn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,o){i[9].default?n?(n.p(i,o),o[0]&512&&j(n,1)):(n=h0(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(en(),Z(n,1,1,()=>{n=null}),tn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function o4(r,e,t){let n,i,o,c,a,d,{$$slots:p={},$$scope:y}=e;const _=$m(p);let{closeButton:w=void 0}=e,{closeOnClickOutside:T=!0}=e,{closeOnClickInside:M=!1}=e,{closeOnMove:$=!1}=e,{openOn:P="click"}=e,{openIfTopMost:D=!0}=e,{focusAfterOpen:I=!0}=e,{anchor:F=void 0}=e,{offset:N=void 0}=e,{popupClass:W=void 0}=e,{maxWidth:se=void 0}=e,{lngLat:J=void 0}=e,{html:ee=void 0}=e,{open:me=!1}=e;const Ie=ms(),{map:Q,popupTarget:ae,layerEvent:Pe,layer:ve,eventTopMost:tt,markerClickManager:Ge}=Da();at(r,Q,_e=>t(2,o=_e)),at(r,ae,_e=>t(3,a=_e)),at(r,Pe,_e=>t(28,c=_e)),at(r,ve,_e=>t(35,d=_e));const Ee=["click","dblclick","contextmenu"];let $e,St=!1,rt;function lt(){if(!$e)return;let _e=$e.getElement();!_e||_e===rt||(rt=_e,P==="hover"&&(rt.style.pointerEvents="none"),rt.addEventListener("mouseenter",()=>{t(24,St=!0)},{passive:!0}),rt.addEventListener("mouseleave",()=>{t(24,St=!1)},{passive:!0}),rt.addEventListener("click",()=>{M&&t(0,me=!1)},{passive:!0}))}Ls(()=>{if(o)return o.on("click",ln),o.on("contextmenu",ln),Ge.add(ze),typeof a=="string"&&(o.on("click",a,_t),o.on("dblclick",a,_t),o.on("contextmenu",a,_t),o.on("mousemove",a,Zt),o.on("mouseleave",a,_n),o.on("touchstart",a,Et),o.on("touchend",a,Yt)),()=>{o!=null&&o.loaded()&&($e==null||$e.remove(),o.off("click",ln),o.off("contextmenu",ln),Ge.remove(ze),a instanceof Jr.Marker?a.getPopup()===$e&&a.setPopup(void 0):typeof a=="string"&&(o.off("click",a,_t),o.off("dblclick",a,_t),o.off("contextmenu",a,_t),o.off("mousemove",a,Zt),o.off("mouseleave",a,_n),o.off("touchstart",a,Et),o.off("touchend",a,Yt)))}});function mt(_e){return D?!("marker"in _e)&&!p3(_e)&&tt(_e)!==d:!1}let ft=null,Xe="normal";function Dt(_e){"layerType"in _e&&_e.layerType==="deckgl"?(t(10,J=_e.coordinate),t(4,ft=_e.object?[_e.object]:null)):(t(10,J=_e.lngLat),t(4,ft=_e.features??[]))}function _t(_e){_e.type!==P||mt(_e)||(Dt(_e),setTimeout(()=>t(0,me=!0)))}let $t=null;function Et(_e){$t=_e.point}function Yt(_e){if(!$t||P!=="hover")return;let vn=$t.dist(_e.point);$t=null,vn<3&&(t(10,J=_e.lngLat),t(4,ft=_e.features??[]),$e.isOpen()?t(25,Xe="justOpened"):(t(25,Xe="opening"),t(0,me=!0)))}function _n(_e){P!=="hover"||$t||Xe!=="normal"||(t(0,me=!1),t(4,ft=null))}function Zt(_e){if(!(P!=="hover"||$t||Xe!=="normal")){if(mt(_e)){t(0,me=!1),t(4,ft=null);return}t(0,me=!0),t(4,ft=_e.features??[]),t(10,J=_e.lngLat)}}function ln(_e){if(Xe==="justOpened"){t(25,Xe="normal");return}if(!T)return;let vn=[rt,a instanceof Jr.Marker?a==null?void 0:a.getElement():null];me&&$e.isOpen()&&!vn.some(Ue=>Ue==null?void 0:Ue.contains(_e.originalEvent.target))&&(_e.type==="contextmenu"&&P==="contextmenu"||_e.type!=="contextmenu")&&t(0,me=!1)}function ze(_e){T&&me&&$e.isOpen()&&_e.marker!==a&&t(0,me=!1)}Yr(()=>{o&&($e!=null&&$e.isOpen())&&$e.remove()});let Ne;const kt=()=>t(0,me=!1);function jt(_e){hn[_e?"unshift":"push"](()=>{Ne=_e,t(1,Ne)})}return r.$$set=_e=>{"closeButton"in _e&&t(11,w=_e.closeButton),"closeOnClickOutside"in _e&&t(12,T=_e.closeOnClickOutside),"closeOnClickInside"in _e&&t(13,M=_e.closeOnClickInside),"closeOnMove"in _e&&t(14,$=_e.closeOnMove),"openOn"in _e&&t(15,P=_e.openOn),"openIfTopMost"in _e&&t(16,D=_e.openIfTopMost),"focusAfterOpen"in _e&&t(17,I=_e.focusAfterOpen),"anchor"in _e&&t(18,F=_e.anchor),"offset"in _e&&t(19,N=_e.offset),"popupClass"in _e&&t(20,W=_e.popupClass),"maxWidth"in _e&&t(21,se=_e.maxWidth),"lngLat"in _e&&t(10,J=_e.lngLat),"html"in _e&&t(22,ee=_e.html),"open"in _e&&t(0,me=_e.open),"$$scope"in _e&&t(29,y=_e.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=w??(!T&&!M)),r.$$.dirty[0]&146685952&&($e||(t(23,$e=new Jr.Popup({closeButton:n,closeOnClick:!1,closeOnMove:$,focusAfterOpen:I,maxWidth:se,className:W,anchor:F,offset:N})),rt=$e.getElement(),$e.on("open",()=>{t(0,me=!0),lt(),Ie("open",$e)}),$e.on("close",()=>{t(0,me=!1),Ie("close",$e)}),$e.on("hover",()=>{Ie("hover",$e)}))),r.$$.dirty[0]&8421384&&$e&&a instanceof Jr.Marker&&(P==="click"?a.setPopup($e):a.getPopup()===$e&&a.setPopup(void 0)),r.$$.dirty[0]&268468224&&Ee.includes(P)&&(c==null?void 0:c.type)===P&&(_t(c),Nt(Pe,c=null,c)),r.$$.dirty[0]&268468224&&t(26,i=P==="hover"&&((c==null?void 0:c.type)==="mousemove"||(c==null?void 0:c.type)==="mouseenter")),r.$$.dirty[0]&352354304&&P==="hover"&&Pe&&(i&&c&&Dt(c),t(0,me=(i||St)??!1)),r.$$.dirty[0]&12582914&&(Ne?$e.setDOMContent(Ne):ee&&$e.setHTML(ee)),r.$$.dirty[0]&8389632&&J&&$e.setLngLat(J),r.$$.dirty[0]&41943045&&o){let _e=$e.isOpen();me&&!_e?($e.addTo(o),Xe==="opening"&&t(25,Xe="justOpened")):!me&&_e&&$e.remove()}},[me,Ne,o,a,ft,Q,ae,Pe,ve,_,J,w,T,M,$,P,D,I,F,N,W,se,ee,$e,St,Xe,i,n,c,y,p,kt,jt]}let Qb=class extends Lt{constructor(e){super(),Mt(this,e,o4,i4,vt,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}};var zc=Math.pow,Gi=(r,e,t)=>new Promise((n,i)=>{var o=d=>{try{a(t.next(d))}catch(p){i(p)}},c=d=>{try{a(t.throw(d))}catch(p){i(p)}},a=d=>d.done?n(d.value):Promise.resolve(d.value).then(o,c);a((t=t.apply(r,e)).next())}),$o=Uint8Array,Ac=Uint16Array,s4=Int32Array,ev=new $o([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),tv=new $o([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a4=new $o([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),nv=function(r,e){for(var t=new Ac(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new s4(t[30]),n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)i[o]=o-t[n]<<5|n;return{b:t,r:i}},rv=nv(ev,2),iv=rv.b,l4=rv.r;iv[28]=258,l4[258]=28;var c4=nv(tv,0),u4=c4.b,dm=new Ac(32768);for(cr=0;cr<32768;++cr)Vs=(cr&43690)>>1|(cr&21845)<<1,Vs=(Vs&52428)>>2|(Vs&13107)<<2,Vs=(Vs&61680)>>4|(Vs&3855)<<4,dm[cr]=((Vs&65280)>>8|(Vs&255)<<8)>>1;var Vs,cr,lh=function(r,e,t){for(var n=r.length,i=0,o=new Ac(e);i<n;++i)r[i]&&++o[r[i]-1];var c=new Ac(e);for(i=1;i<e;++i)c[i]=c[i-1]+o[i-1]<<1;var a;if(t){a=new Ac(1<<e);var d=15-e;for(i=0;i<n;++i)if(r[i])for(var p=i<<4|r[i],y=e-r[i],_=c[r[i]-1]++<<y,w=_|(1<<y)-1;_<=w;++_)a[dm[_]>>d]=p}else for(a=new Ac(n),i=0;i<n;++i)r[i]&&(a[i]=dm[c[r[i]-1]++]>>15-r[i]);return a},Mh=new $o(288);for(cr=0;cr<144;++cr)Mh[cr]=8;var cr;for(cr=144;cr<256;++cr)Mh[cr]=9;var cr;for(cr=256;cr<280;++cr)Mh[cr]=7;var cr;for(cr=280;cr<288;++cr)Mh[cr]=8;var cr,ov=new $o(32);for(cr=0;cr<32;++cr)ov[cr]=5;var cr,h4=lh(Mh,9,1),f4=lh(ov,5,1),Gp=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},ls=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},Hp=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},d4=function(r){return(r+7)/8|0},p4=function(r,e,t){(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length);var n=new $o(t-e);return n.set(r.subarray(e,t)),n},m4=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ao=function(r,e,t){var n=new Error(e||m4[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,Ao),!t)throw n;return n},Ym=function(r,e,t,n){var i=r.length,o=n?n.length:0;if(!i||e.f&&!e.l)return t||new $o(0);var c=!t||e.i!=2,a=e.i;t||(t=new $o(i*3));var d=function(_n){var Zt=t.length;if(_n>Zt){var ln=new $o(Math.max(Zt*2,_n));ln.set(t),t=ln}},p=e.f||0,y=e.p||0,_=e.b||0,w=e.l,T=e.d,M=e.m,$=e.n,P=i*8;do{if(!w){p=ls(r,y,1);var D=ls(r,y+1,3);if(y+=3,D)if(D==1)w=h4,T=f4,M=9,$=5;else if(D==2){var W=ls(r,y,31)+257,se=ls(r,y+10,15)+4,J=W+ls(r,y+5,31)+1;y+=14;for(var ee=new $o(J),me=new $o(19),Ie=0;Ie<se;++Ie)me[a4[Ie]]=ls(r,y+Ie*3,7);y+=se*3;for(var Q=Gp(me),ae=(1<<Q)-1,Pe=lh(me,Q,1),Ie=0;Ie<J;){var ve=Pe[ls(r,y,ae)];y+=ve&15;var I=ve>>4;if(I<16)ee[Ie++]=I;else{var tt=0,Ge=0;for(I==16?(Ge=3+ls(r,y,3),y+=2,tt=ee[Ie-1]):I==17?(Ge=3+ls(r,y,7),y+=3):I==18&&(Ge=11+ls(r,y,127),y+=7);Ge--;)ee[Ie++]=tt}}var Ee=ee.subarray(0,W),$e=ee.subarray(W);M=Gp(Ee),$=Gp($e),w=lh(Ee,M,1),T=lh($e,$,1)}else Ao(1);else{var I=d4(y)+4,F=r[I-4]|r[I-3]<<8,N=I+F;if(N>i){a&&Ao(0);break}c&&d(_+F),t.set(r.subarray(I,N),_),e.b=_+=F,e.p=y=N*8,e.f=p;continue}if(y>P){a&&Ao(0);break}}c&&d(_+131072);for(var St=(1<<M)-1,rt=(1<<$)-1,lt=y;;lt=y){var tt=w[Hp(r,y)&St],mt=tt>>4;if(y+=tt&15,y>P){a&&Ao(0);break}if(tt||Ao(2),mt<256)t[_++]=mt;else if(mt==256){lt=y,w=null;break}else{var ft=mt-254;if(mt>264){var Ie=mt-257,Xe=ev[Ie];ft=ls(r,y,(1<<Xe)-1)+iv[Ie],y+=Xe}var Dt=T[Hp(r,y)&rt],_t=Dt>>4;Dt||Ao(3),y+=Dt&15;var $e=u4[_t];if(_t>3){var Xe=tv[_t];$e+=Hp(r,y)&(1<<Xe)-1,y+=Xe}if(y>P){a&&Ao(0);break}c&&d(_+131072);var $t=_+ft;if(_<$e){var Et=o-$e,Yt=Math.min($e,$t);for(Et+_<0&&Ao(3);_<Yt;++_)t[_]=n[Et+_]}for(;_<$t;_+=4)t[_]=t[_-$e],t[_+1]=t[_+1-$e],t[_+2]=t[_+2-$e],t[_+3]=t[_+3-$e];_=$t}}e.l=w,e.p=lt,e.b=_,e.f=p,w&&(p=1,e.m=M,e.d=T,e.n=$)}while(!p);return _==t.length?t:p4(t,0,_)},g4=new $o(0),_4=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&Ao(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)},y4=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},b4=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&Ao(6,"invalid zlib data"),(r[1]>>5&1)==+!e&&Ao(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function v4(r,e){return Ym(r,{i:2},e&&e.out,e&&e.dictionary)}function w4(r,e){var t=_4(r);return t+8>r.length&&Ao(6,"invalid gzip data"),Ym(r.subarray(t,-8),{i:2},e&&e.out||new $o(y4(r)),e&&e.dictionary)}function x4(r,e){return Ym(r.subarray(b4(r,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function pm(r,e){return r[0]==31&&r[1]==139&&r[2]==8?w4(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?v4(r,e):x4(r,e)}var k4=typeof TextDecoder<"u"&&new TextDecoder,S4=0;try{k4.decode(g4,{stream:!0}),S4=1}catch{}var sv=(r,e)=>r*zc(2,e),Uu=(r,e)=>Math.floor(r/zc(2,e)),pd=(r,e)=>sv(r.getUint16(e+1,!0),8)+r.getUint8(e),av=(r,e)=>sv(r.getUint32(e+2,!0),16)+r.getUint16(e,!0),C4=(r,e,t,n,i)=>{if(r!==n.getUint8(i))return r-n.getUint8(i);const o=pd(n,i+1);if(e!==o)return e-o;const c=pd(n,i+4);return t!==c?t-c:0},T4=(r,e,t,n)=>{const i=lv(r,e|128,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],isDir:!0}:null},d0=(r,e,t,n)=>{const i=lv(r,e,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],isDir:!1}:null},lv=(r,e,t,n)=>{let i=0,o=r.byteLength/17-1;for(;i<=o;){const c=o+i>>1,a=C4(e,t,n,r,c*17);if(a>0)i=c+1;else if(a<0)o=c-1;else return[av(r,c*17+7),r.getUint32(c*17+13,!0)]}return null},M4=(r,e)=>r.isDir&&!e.isDir?1:!r.isDir&&e.isDir?-1:r.z!==e.z?r.z-e.z:r.x!==e.x?r.x-e.x:r.y-e.y,cv=(r,e)=>{const t=r.getUint8(e*17);return{z:t&127,x:pd(r,e*17+1),y:pd(r,e*17+4),offset:av(r,e*17+7),length:r.getUint32(e*17+13,!0),isDir:t>>7===1}},p0=r=>{const e=[],t=new DataView(r);for(let n=0;n<t.byteLength/17;n++)e.push(cv(t,n));return L4(e)},L4=r=>{r.sort(M4);const e=new ArrayBuffer(17*r.length),t=new Uint8Array(e);for(let n=0;n<r.length;n++){const i=r[n];let o=i.z;i.isDir&&(o=o|128),t[n*17]=o,t[n*17+1]=i.x&255,t[n*17+2]=i.x>>8&255,t[n*17+3]=i.x>>16&255,t[n*17+4]=i.y&255,t[n*17+5]=i.y>>8&255,t[n*17+6]=i.y>>16&255,t[n*17+7]=i.offset&255,t[n*17+8]=Uu(i.offset,8)&255,t[n*17+9]=Uu(i.offset,16)&255,t[n*17+10]=Uu(i.offset,24)&255,t[n*17+11]=Uu(i.offset,32)&255,t[n*17+12]=Uu(i.offset,48)&255,t[n*17+13]=i.length&255,t[n*17+14]=i.length>>8&255,t[n*17+15]=i.length>>16&255,t[n*17+16]=i.length>>24&255}return e},E4=(r,e)=>{if(r.byteLength<17)return null;const t=r.byteLength/17,n=cv(r,t-1);if(n.isDir){const i=n.z,o=e.z-i,c=Math.trunc(e.x/(1<<o)),a=Math.trunc(e.y/(1<<o));return{z:i,x:c,y:a}}return null};function I4(r){return Gi(this,null,function*(){const e=yield r.getBytes(0,512e3),t=new DataView(e.data),n=t.getUint32(4,!0),i=t.getUint16(8,!0),o=new TextDecoder("utf-8"),c=JSON.parse(o.decode(new DataView(e.data,10,n)));let a=0;c.compression==="gzip"&&(a=2);let d=0;"minzoom"in c&&(d=+c.minzoom);let p=0;"maxzoom"in c&&(p=+c.maxzoom);let y=0,_=0,w=0,T=-180,M=-85,$=180,P=85;if(c.bounds){const I=c.bounds.split(",");T=+I[0],M=+I[1],$=+I[2],P=+I[3]}if(c.center){const I=c.center.split(",");y=+I[0],_=+I[1],w=+I[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+n,rootDirectoryLength:i*17,jsonMetadataOffset:10,jsonMetadataLength:n,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:d,maxZoom:p,minLon:T,minLat:M,maxLon:$,maxLat:P,centerZoom:w,centerLon:y,centerLat:_,etag:e.etag}})}function A4(r,e,t,n,i,o,c){return Gi(this,null,function*(){let a=yield t.getArrayBuffer(e,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(a=p0(a));const d=d0(new DataView(a),n,i,o);if(d){let _=(yield e.getBytes(d.offset,d.length,c)).data;const w=new DataView(_);return w.getUint8(0)===31&&w.getUint8(1)===139&&(_=pm(new Uint8Array(_))),{data:_}}const p=E4(new DataView(a),{z:n,x:i,y:o});if(p){const y=T4(new DataView(a),p.z,p.x,p.y);if(y){let _=yield t.getArrayBuffer(e,y.offset,y.length,r);r.specVersion===1&&(_=p0(_));const w=d0(new DataView(_),n,i,o);if(w){let M=(yield e.getBytes(w.offset,w.length,c)).data;const $=new DataView(M);return $.getUint8(0)===31&&$.getUint8(1)===139&&(M=pm(new Uint8Array(M))),{data:M}}}}})}var uv={getHeader:I4,getZxy:A4},P4=r=>(e,t)=>{if(t instanceof AbortController)return r(e,t);const n=new AbortController;return r(e,n).then(i=>t(void 0,i.data,i.cacheControl||"",i.expires||""),i=>t(i)).catch(i=>t(i)),{cancel:()=>n.abort()}},z4=class{constructor(){this.tilev4=(r,e)=>Gi(this,null,function*(){if(r.type==="json"){const _=r.url.substr(10);let w=this.tiles.get(_);w||(w=new m0(_),this.tiles.set(_,w));const T=yield w.getHeader();return{data:{tiles:[`${r.url}/{z}/{x}/{y}`],minzoom:T.minZoom,maxzoom:T.maxZoom,bounds:[T.minLon,T.minLat,T.maxLon,T.maxLat]}}}const t=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),n=r.url.match(t);if(!n)throw new Error("Invalid PMTiles protocol URL");const i=n[1];let o=this.tiles.get(i);o||(o=new m0(i),this.tiles.set(i,o));const c=n[2],a=n[3],d=n[4],p=yield o.getHeader(),y=yield o==null?void 0:o.getZxy(+c,+a,+d,e.signal);return y?{data:new Uint8Array(y.data),cacheControl:y.cacheControl,expires:y.expires}:p.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=P4(this.tilev4),this.tiles=new Map}add(r){this.tiles.set(r.source.getKey(),r)}get(r){return this.tiles.get(r)}};function Sc(r,e){return(e>>>0)*4294967296+(r>>>0)}function D4(r,e){const t=e.buf;let n=t[e.pos++],i=(n&112)>>4;if(n<128||(n=t[e.pos++],i|=(n&127)<<3,n<128)||(n=t[e.pos++],i|=(n&127)<<10,n<128)||(n=t[e.pos++],i|=(n&127)<<17,n<128)||(n=t[e.pos++],i|=(n&127)<<24,n<128)||(n=t[e.pos++],i|=(n&1)<<31,n<128))return Sc(r,i);throw new Error("Expected varint not more than 10 bytes")}function Vu(r){const e=r.buf;let t=e[r.pos++],n=t&127;return t<128||(t=e[r.pos++],n|=(t&127)<<7,t<128)||(t=e[r.pos++],n|=(t&127)<<14,t<128)||(t=e[r.pos++],n|=(t&127)<<21,t<128)?n:(t=e[r.pos],n|=(t&15)<<28,D4(n,r))}function $4(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}var R4=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function F4(r,e,t){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>zc(2,r)-1||t>zc(2,r)-1)throw Error("tile x/y outside zoom level bounds");const n=R4[r],i=zc(2,r);let o=0,c=0,a=0;const d=[e,t];let p=i/2;for(;p>0;)o=(d[0]&p)>0?1:0,c=(d[1]&p)>0?1:0,a+=p*p*(3*o^c),$4(p,d,o,c),p=p/2;return n+a}function hv(r,e){return Gi(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return pm(new Uint8Array(r));const t=new Response(r).body;if(!t)throw Error("Failed to read response stream");const n=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw Error("Compression method not supported")})}var B4=127;function O4(r,e){let t=0,n=r.length-1;for(;t<=n;){const i=n+t>>1,o=e-r[i].tileId;if(o>0)t=i+1;else if(o<0)n=i-1;else return r[i]}return n>=0&&(r[n].runLength===0||e-r[n].tileId<r[n].runLength)?r[n]:null}var N4=class{constructor(r,e=new Headers){this.url=r,this.customHeaders=e,this.mustReload=!1}getKey(){return this.url}setHeaders(r){this.customHeaders=r}getBytes(r,e,t,n){return Gi(this,null,function*(){let i,o;t?o=t:(i=new AbortController,o=i.signal);const c=new Headers(this.customHeaders);c.set("range",`bytes=${r}-${r+e-1}`);let a;this.mustReload&&(a="reload");let d=yield fetch(this.url,{signal:o,cache:a,headers:c});if(r===0&&d.status===416){const w=d.headers.get("Content-Range");if(!w||!w.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const T=+w.substr(8);d=yield fetch(this.url,{signal:o,cache:"reload",headers:{range:`bytes=0-${T-1}`}})}let p=d.headers.get("Etag");if(p!=null&&p.startsWith("W/")&&(p=null),d.status===416||n&&p&&p!==n)throw this.mustReload=!0,new mm(n);if(d.status>=300)throw Error(`Bad response code: ${d.status}`);const y=d.headers.get("Content-Length");if(d.status===200&&(!y||+y>e))throw i&&i.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield d.arrayBuffer(),etag:p||void 0,cacheControl:d.headers.get("Cache-Control")||void 0,expires:d.headers.get("Expires")||void 0}})}};function cs(r,e){const t=r.getUint32(e+4,!0),n=r.getUint32(e+0,!0);return t*zc(2,32)+n}function j4(r,e){const t=new DataView(r),n=t.getUint8(7);if(n>3)throw Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:cs(t,8),rootDirectoryLength:cs(t,16),jsonMetadataOffset:cs(t,24),jsonMetadataLength:cs(t,32),leafDirectoryOffset:cs(t,40),leafDirectoryLength:cs(t,48),tileDataOffset:cs(t,56),tileDataLength:cs(t,64),numAddressedTiles:cs(t,72),numTileEntries:cs(t,80),numTileContents:cs(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function fv(r){const e={buf:new Uint8Array(r),pos:0},t=Vu(e),n=[];let i=0;for(let o=0;o<t;o++){const c=Vu(e);n.push({tileId:i+c,offset:0,length:0,runLength:1}),i+=c}for(let o=0;o<t;o++)n[o].runLength=Vu(e);for(let o=0;o<t;o++)n[o].length=Vu(e);for(let o=0;o<t;o++){const c=Vu(e);c===0&&o>0?n[o].offset=n[o-1].offset+n[o-1].length:n[o].offset=c-1}return n}function U4(r){const e=new DataView(r);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var mm=class extends Error{};function V4(r,e){return Gi(this,null,function*(){const t=yield r.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(U4(t.data)<3)return[yield uv.getHeader(r)];const i=t.data.slice(0,B4),o=j4(i,t.etag),c=t.data.slice(o.rootDirectoryOffset,o.rootDirectoryOffset+o.rootDirectoryLength),a=`${r.getKey()}|${o.etag||""}|${o.rootDirectoryOffset}|${o.rootDirectoryLength}`,d=fv(yield e(c,o.internalCompression));return[o,[a,d.length,d]]})}function q4(r,e,t,n,i){return Gi(this,null,function*(){const o=yield r.getBytes(t,n,void 0,i.etag),c=yield e(o.data,i.internalCompression),a=fv(c);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var Z4=class{constructor(r=100,e=!0,t=hv){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=r,this.counter=1,this.decompress=t}getHeader(r){return Gi(this,null,function*(){const e=r.getKey(),t=this.cache.get(e);if(t)return t.lastUsed=this.counter++,yield t.data;const n=new Promise((i,o)=>{V4(r,this.decompress).then(c=>{c[1]&&this.cache.set(c[1][0],{lastUsed:this.counter++,data:Promise.resolve(c[1][2])}),i(c[0]),this.prune()}).catch(c=>{o(c)})});return this.cache.set(e,{lastUsed:this.counter++,data:n}),n})}getDirectory(r,e,t,n){return Gi(this,null,function*(){const i=`${r.getKey()}|${n.etag||""}|${e}|${t}`,o=this.cache.get(i);if(o)return o.lastUsed=this.counter++,yield o.data;const c=new Promise((a,d)=>{q4(r,this.decompress,e,t,n).then(p=>{a(p),this.prune()}).catch(p=>{d(p)})});return this.cache.set(i,{lastUsed:this.counter++,data:c}),c})}getArrayBuffer(r,e,t,n){return Gi(this,null,function*(){const i=`${r.getKey()}|${n.etag||""}|${e}|${t}`,o=this.cache.get(i);if(o)return o.lastUsed=this.counter++,yield o.data;const c=new Promise((a,d)=>{r.getBytes(e,t,void 0,n.etag).then(p=>{a(p.data),this.cache.has(i),this.prune()}).catch(p=>{d(p)})});return this.cache.set(i,{lastUsed:this.counter++,data:c}),c})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,e;this.cache.forEach((t,n)=>{t.lastUsed<r&&(r=t.lastUsed,e=n)}),e&&this.cache.delete(e)}}invalidate(r){return Gi(this,null,function*(){const e=r.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(r.getKey());const t=new Promise((n,i)=>{this.getHeader(r).then(o=>{n(),this.invalidations.delete(e)}).catch(o=>{i(o)})});this.invalidations.set(e,t)})}},m0=class{constructor(r,e,t){typeof r=="string"?this.source=new N4(r):this.source=r,t?this.decompress=t:this.decompress=hv,e?this.cache=e:this.cache=new Z4}getHeader(){return Gi(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,e,t,n){return Gi(this,null,function*(){const i=F4(r,e,t),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return uv.getZxy(o,this.source,this.cache,r,e,t,n);if(r<o.minZoom||r>o.maxZoom)return;let c=o.rootDirectoryOffset,a=o.rootDirectoryLength;for(let d=0;d<=3;d++){const p=yield this.cache.getDirectory(this.source,c,a,o),y=O4(p,i);if(y){if(y.runLength>0){const _=yield this.source.getBytes(o.tileDataOffset+y.offset,y.length,n,o.etag);return{data:yield this.decompress(_.data,o.tileCompression),cacheControl:_.cacheControl,expires:_.expires}}c=o.leafDirectoryOffset+y.offset,a=y.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,e,t,n){return Gi(this,null,function*(){try{return yield this.getZxyAttempt(r,e,t,n)}catch(i){if(i instanceof mm)return this.cache.invalidate(this.source),yield this.getZxyAttempt(r,e,t,n);throw i}})}getMetadataAttempt(){return Gi(this,null,function*(){const r=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength,void 0,r.etag),t=yield this.decompress(e.data,r.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(t))})}getMetadata(){return Gi(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof mm)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw r}})}};function G4(r){let e;const t=r[16].default,n=Sn(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&Tn(n,t,i,i[24],e?Cn(t,i[24],o,null):Mn(i[24]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function H4(r){let e,t,n;function i(c){r[17](c)}let o={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[G4]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new kd({props:o}),hn.push(()=>In(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){fe(e.$$.fragment)},m(c,a){ue(e,c,a),n=!0},p(c,[a]){const d={};a&2&&(d.id=c[1]),a&4&&(d.source=c[2]),a&8&&(d.sourceLayer=c[3]),a&16&&(d.beforeId=c[4]),a&32&&(d.beforeLayerType=c[5]),a&64&&(d.paint=c[6]),a&128&&(d.layout=c[7]),a&256&&(d.filter=c[8]),a&512&&(d.applyToClusters=c[9]),a&1024&&(d.minzoom=c[10]),a&2048&&(d.maxzoom=c[11]),a&4096&&(d.hoverCursor=c[12]),a&8192&&(d.manageHoverState=c[13]),a&16384&&(d.eventsIfTopMost=c[14]),a&32768&&(d.interactive=c[15]),a&16777216&&(d.$$scope={dirty:a,ctx:c}),!t&&a&1&&(t=!0,d.hovered=c[0],En(()=>t=!1)),e.$set(d)},i(c){n||(j(e.$$.fragment,c),n=!0)},o(c){Z(e.$$.fragment,c),n=!1},d(c){he(e,c)}}}function W4(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=vl("symbol")}=e,{source:c=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:y=void 0}=e,{layout:_=void 0}=e,{filter:w=void 0}=e,{applyToClusters:T=void 0}=e,{minzoom:M=void 0}=e,{maxzoom:$=void 0}=e,{hoverCursor:P=void 0}=e,{manageHoverState:D=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:F=!1}=e,{interactive:N=!0}=e;function W(ae){I=ae,t(0,I)}function se(ae){zn.call(this,r,ae)}function J(ae){zn.call(this,r,ae)}function ee(ae){zn.call(this,r,ae)}function me(ae){zn.call(this,r,ae)}function Ie(ae){zn.call(this,r,ae)}function Q(ae){zn.call(this,r,ae)}return r.$$set=ae=>{"id"in ae&&t(1,o=ae.id),"source"in ae&&t(2,c=ae.source),"sourceLayer"in ae&&t(3,a=ae.sourceLayer),"beforeId"in ae&&t(4,d=ae.beforeId),"beforeLayerType"in ae&&t(5,p=ae.beforeLayerType),"paint"in ae&&t(6,y=ae.paint),"layout"in ae&&t(7,_=ae.layout),"filter"in ae&&t(8,w=ae.filter),"applyToClusters"in ae&&t(9,T=ae.applyToClusters),"minzoom"in ae&&t(10,M=ae.minzoom),"maxzoom"in ae&&t(11,$=ae.maxzoom),"hoverCursor"in ae&&t(12,P=ae.hoverCursor),"manageHoverState"in ae&&t(13,D=ae.manageHoverState),"hovered"in ae&&t(0,I=ae.hovered),"eventsIfTopMost"in ae&&t(14,F=ae.eventsIfTopMost),"interactive"in ae&&t(15,N=ae.interactive),"$$scope"in ae&&t(24,i=ae.$$scope)},[I,o,c,a,d,p,y,_,w,T,M,$,P,D,F,N,n,W,se,J,ee,me,Ie,Q,i]}class Fc extends Lt{constructor(e){super(),Mt(this,e,W4,H4,vt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function g0(r){let e=r[0],t,n,i=_0(r);return{c(){i.c(),t=Xn()},m(o,c){i.m(o,c),q(o,t,c),n=!0},p(o,c){c&1&&vt(e,e=o[0])?(en(),Z(i,1,1,et),tn(),i=_0(o),i.c(),j(i,1),i.m(t.parentNode,t)):i.p(o,c)},i(o){n||(j(i),n=!0)},o(o){Z(i),n=!1},d(o){o&&V(t),i.d(o)}}}function _0(r){let e;const t=r[15].default,n=Sn(t,r,r[14],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16384)&&Tn(n,t,i,i[14],e?Cn(t,i[14],o,null):Mn(i[14]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function K4(r){let e,t,n=r[0]&&g0(r);return{c(){n&&n.c(),e=Xn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&j(n,1)):(n=g0(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(en(),Z(n,1,1,()=>{n=null}),tn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function X4(r,e,t){let n,i,{$$slots:o={},$$scope:c}=e,{id:a=vl("vector")}=e,{url:d=null}=e,{tiles:p=null}=e,{promoteId:y=null}=e,{bounds:_=null}=e,{scheme:w=null}=e,{attribution:T=null}=e,{minzoom:M=null}=e,{maxzoom:$=null}=e,{volatile:P=null}=e;if(d&&d.includes("pmtiles://")&&!Jr.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let N=new z4;Jr.addProtocol("pmtiles",N.tile)}const{map:D,self:I}=Hb();at(r,D,N=>t(13,i=N)),at(r,I,N=>t(0,n=N));let F;return Yr(()=>{n&&i&&(Xb(D,n,F),Nt(I,n=null,n),F=void 0)}),r.$$set=N=>{"id"in N&&t(3,a=N.id),"url"in N&&t(4,d=N.url),"tiles"in N&&t(5,p=N.tiles),"promoteId"in N&&t(6,y=N.promoteId),"bounds"in N&&t(7,_=N.bounds),"scheme"in N&&t(8,w=N.scheme),"attribution"in N&&t(9,T=N.attribution),"minzoom"in N&&t(10,M=N.minzoom),"maxzoom"in N&&t(11,$=N.maxzoom),"volatile"in N&&t(12,P=N.volatile),"$$scope"in N&&t(14,c=N.$$scope)},r.$$.update=()=>{r.$$.dirty&16377&&i&&n!==a&&(Nt(I,n=a,n),Kb(i,n,La({type:"vector",url:d,tiles:p,promoteId:y,bounds:_,scheme:w,attribution:T,minzoom:M,maxzoom:$,volatile:P}),N=>i&&N===n,()=>{n&&(F=i==null?void 0:i.getSource(n))})),r.$$.dirty&8200&&(i==null||i.on("style.load",()=>{F=i==null?void 0:i.getSource(a)}))},[n,D,I,a,d,p,y,_,w,T,M,$,P,i,c,o]}class Lh extends Lt{constructor(e){super(),Mt(this,e,X4,K4,vt,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}function J4(r){let e,t,n,i,o,c,a,d,p;return{c(){e=U("label"),t=xe(`Basemap:
  `),n=U("select"),i=U("option"),i.textContent="MapTiler Dataviz",o=U("option"),o.textContent="MapTiler Streets",c=U("option"),c.textContent="MapTiler Satellite",a=U("option"),a.textContent="OS Open Zoomstack",i.__value="dataviz",qn(i,i.__value),o.__value="streets-v2",qn(o,o.__value),c.__value="hybrid",qn(c,c.__value),a.__value="uk-openzoomstack-light",qn(a,a.__value),r[0]===void 0&&us(()=>r[1].call(n))},m(y,_){q(y,e,_),R(e,t),R(e,n),R(n,i),R(n,o),R(n,c),R(n,a),Zi(n,r[0],!0),d||(p=wt(n,"change",r[1]),d=!0)},p(y,[_]){_&1&&Zi(n,y[0])},i:et,o:et,d(y){y&&V(e),d=!1,p()}}}function Y4(r,e,t){let n;at(r,sm,o=>t(0,n=o));function i(){n=Sa(this),sm.set(n)}return[n,i]}class Q4 extends Lt{constructor(e){super(),Mt(this,e,Y4,J4,vt,{})}}const eS=r=>({}),y0=r=>({}),tS=r=>({}),b0=r=>({});function v0(r){let e,t;return e=new Qm({props:{color:"var(--pico-secondary-inverse)",$$slots:{default:[nS]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&64&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function nS(r){let e,t;const n=r[3].help,i=Sn(n,r,r[6],b0);return{c(){e=U("div"),i&&i.c(),de(e,"class","context-layer-help-content")},m(o,c){q(o,e,c),i&&i.m(e,null),t=!0},p(o,c){i&&i.p&&(!t||c&64)&&Tn(i,n,o,o[6],t?Cn(n,o[6],c,tS):Mn(o[6]),b0)},i(o){t||(j(i,o),t=!0)},o(o){Z(i,o),t=!1},d(o){o&&V(e),i&&i.d(o)}}}function w0(r){let e,t;const n=r[3].legend,i=Sn(n,r,r[6],y0);return{c(){e=U("div"),i&&i.c(),de(e,"class","legend svelte-wh5rsr")},m(o,c){q(o,e,c),i&&i.m(e,null),t=!0},p(o,c){i&&i.p&&(!t||c&64)&&Tn(i,n,o,o[6],t?Cn(n,o[6],c,eS):Mn(o[6]),y0)},i(o){t||(j(i,o),t=!0)},o(o){Z(i,o),t=!1},d(o){o&&V(e),i&&i.d(o)}}}function rS(r){let e,t,n,i,o,c,a,d,p,y,_=r[2].help&&v0(r),w=r[0]&&r[2].legend&&w0(r);return{c(){e=U("button"),t=U("input"),n=oe(),i=xe(r[1]),o=oe(),_&&_.c(),c=oe(),w&&w.c(),a=Xn(),st(t,"aspect-ratio","1.0"),de(t,"type","checkbox"),st(e,"display","flex"),st(e,"align-items","center"),st(e,"justify-content","leading"),st(e,"gap","8px"),st(e,"text-align","left"),de(e,"class","secondary")},m(T,M){q(T,e,M),R(e,t),t.checked=r[0],R(e,n),R(e,i),R(e,o),_&&_.m(e,null),q(T,c,M),w&&w.m(T,M),q(T,a,M),d=!0,p||(y=[wt(t,"change",r[4]),wt(e,"click",r[5])],p=!0)},p(T,[M]){M&1&&(t.checked=T[0]),(!d||M&2)&&Tt(i,T[1]),T[2].help?_?(_.p(T,M),M&4&&j(_,1)):(_=v0(T),_.c(),j(_,1),_.m(e,null)):_&&(en(),Z(_,1,1,()=>{_=null}),tn()),T[0]&&T[2].legend?w?(w.p(T,M),M&5&&j(w,1)):(w=w0(T),w.c(),j(w,1),w.m(a.parentNode,a)):w&&(en(),Z(w,1,1,()=>{w=null}),tn())},i(T){d||(j(_),j(w),d=!0)},o(T){Z(_),Z(w),d=!1},d(T){T&&(V(e),V(c),V(a)),_&&_.d(),w&&w.d(T),p=!1,pr(y)}}}function iS(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=$m(n);let{label:c}=e,{show:a=!1}=e;function d(){a=this.checked,t(0,a)}const p=()=>t(0,a=!a);return r.$$set=y=>{"label"in y&&t(1,c=y.label),"show"in y&&t(0,a=y.show),"$$scope"in y&&t(6,i=y.$$scope)},[a,c,o,n,d,p,i]}class es extends Lt{constructor(e){super(),Mt(this,e,iS,rS,vt,{label:1,show:0})}}let Jf=An(!0);function oS(r){let e,t;return e=new Hi({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:r[0]?"none":"visible"}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.layout={visibility:n[0]?"none":"visible"}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function sS(r){let e,t;return e=new dr({props:{data:r[1],$$slots:{default:[oS]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,[i]){const o={};i&5&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function aS(r,e,t){let n;return at(r,Jf,o=>t(0,n=o)),[n,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class lS extends Lt{constructor(e){super(),Mt(this,e,aS,sS,vt,{})}}function cS(r){let e,t;return e=new Sd({props:{lngLat:r[0],$$slots:{default:[hS]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.lngLat=n[0]),i&16&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function uS(r){let e,t,n;function i(c){r[3](c)}let o={draggable:!0,$$slots:{default:[fS]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.lngLat=r[0]),e=new Sd({props:o}),hn.push(()=>In(e,"lngLat",i)),{c(){fe(e.$$.fragment)},m(c,a){ue(e,c,a),n=!0},p(c,a){const d={};a&16&&(d.$$scope={dirty:a,ctx:c}),!t&&a&1&&(t=!0,d.lngLat=c[0],En(()=>t=!1)),e.$set(d)},i(c){n||(j(e.$$.fragment,c),n=!0)},o(c){Z(e.$$.fragment,c),n=!1},d(c){he(e,c)}}}function hS(r){let e,t;const n=r[2].default,i=Sn(n,r,r[4],null);return{c(){e=U("span"),i&&i.c(),de(e,"class","dot svelte-nb4dgc")},m(o,c){q(o,e,c),i&&i.m(e,null),t=!0},p(o,c){i&&i.p&&(!t||c&16)&&Tn(i,n,o,o[4],t?Cn(n,o[4],c,null):Mn(o[4]),null)},i(o){t||(j(i,o),t=!0)},o(o){Z(i,o),t=!1},d(o){o&&V(e),i&&i.d(o)}}}function fS(r){let e,t;const n=r[2].default,i=Sn(n,r,r[4],null);return{c(){e=U("span"),i&&i.c(),de(e,"class","dot svelte-nb4dgc")},m(o,c){q(o,e,c),i&&i.m(e,null),t=!0},p(o,c){i&&i.p&&(!t||c&16)&&Tn(i,n,o,o[4],t?Cn(n,o[4],c,null):Mn(o[4]),null)},i(o){t||(j(i,o),t=!0)},o(o){Z(i,o),t=!1},d(o){o&&V(e),i&&i.d(o)}}}function dS(r){let e,t,n,i;const o=[uS,cS],c=[];function a(d,p){return d[1]?0:1}return e=a(r),t=c[e]=o[e](r),{c(){t.c(),n=Xn()},m(d,p){c[e].m(d,p),q(d,n,p),i=!0},p(d,[p]){let y=e;e=a(d),e===y?c[e].p(d,p):(en(),Z(c[y],1,1,()=>{c[y]=null}),tn(),t=c[e],t?t.p(d,p):(t=c[e]=o[e](d),t.c()),j(t,1),t.m(n.parentNode,n))},i(d){i||(j(t),i=!0)},o(d){Z(t),i=!1},d(d){d&&V(n),c[e].d(d)}}}function pS(r,e,t){let{$$slots:n={},$$scope:i}=e,{lngLat:o}=e,{draggable:c=!1}=e;function a(d){o=d,t(0,o)}return r.$$set=d=>{"lngLat"in d&&t(0,o=d.lngLat),"draggable"in d&&t(1,c=d.draggable),"$$scope"in d&&t(4,i=d.$$scope)},[o,c,n,a,i]}class yl extends Lt{constructor(e){super(),Mt(this,e,pS,dS,vt,{lngLat:0,draggable:1})}}function mS(r){let e,t,n;const i=r[2].default,o=Sn(i,r,r[5],null);return{c(){e=U("h2"),e.textContent="Help",t=oe(),o&&o.c()},m(c,a){q(c,e,a),q(c,t,a),o&&o.m(c,a),n=!0},p(c,a){o&&o.p&&(!n||a&32)&&Tn(o,i,c,c[5],n?Cn(i,c[5],a,null):Mn(c[5]),null)},i(c){n||(j(o,c),n=!0)},o(c){Z(o,c),n=!1},d(c){c&&(V(e),V(t)),o&&o.d(c)}}}function gS(r){let e,t,n,i,o,c,a,d;t=new Tk({props:{color:r[0]}});function p(_){r[4](_)}let y={$$slots:{default:[mS]},$$scope:{ctx:r}};return r[1]!==void 0&&(y.show=r[1]),i=new vd({props:y}),hn.push(()=>In(i,"show",p)),{c(){e=U("button"),fe(t.$$.fragment),n=oe(),fe(i.$$.fragment),de(e,"class","icon-btn help svelte-my65h"),de(e,"title","Help")},m(_,w){q(_,e,w),ue(t,e,null),q(_,n,w),ue(i,_,w),c=!0,a||(d=wt(e,"click",rh(r[3])),a=!0)},p(_,[w]){const T={};w&1&&(T.color=_[0]),t.$set(T);const M={};w&32&&(M.$$scope={dirty:w,ctx:_}),!o&&w&2&&(o=!0,M.show=_[1],En(()=>o=!1)),i.$set(M)},i(_){c||(j(t.$$.fragment,_),j(i.$$.fragment,_),c=!0)},o(_){Z(t.$$.fragment,_),Z(i.$$.fragment,_),c=!1},d(_){_&&(V(e),V(n)),he(t),he(i,_),a=!1,d()}}}function _S(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!1,{color:c="black"}=e;const a=()=>t(1,o=!0);function d(p){o=p,t(1,o)}return r.$$set=p=>{"color"in p&&t(0,c=p.color),"$$scope"in p&&t(5,i=p.$$scope)},[c,o,n,a,d,i]}class Qm extends Lt{constructor(e){super(),Mt(this,e,_S,gS,vt,{color:0})}}function yS(r){let e,t,n,i;const o=r[1].default,c=Sn(o,r,r[0],null);return{c(){e=U("a"),c&&c.c(),de(e,"href","#")},m(a,d){q(a,e,d),c&&c.m(e,null),t=!0,n||(i=wt(e,"click",Rm(r[2])),n=!0)},p(a,[d]){c&&c.p&&(!t||d&1)&&Tn(c,o,a,a[0],t?Cn(o,a[0],d,null):Mn(a[0]),null)},i(a){t||(j(c,a),t=!0)},o(a){Z(c,a),t=!1},d(a){a&&V(e),c&&c.d(a),n=!1,i()}}}function bS(r,e,t){let{$$slots:n={},$$scope:i}=e;function o(c){zn.call(this,r,c)}return r.$$set=c=>{"$$scope"in c&&t(0,i=c.$$scope)},[i,n,o]}class $n extends Lt{constructor(e){super(),Mt(this,e,bS,yS,vt,{})}}function vS(r){let e,t,n,i,o,c=r[0]+1+"",a,d,p=r[1].length+"",y,_,w,T,M,$,P;return{c(){e=U("div"),t=U("button"),n=xe("Previous"),o=oe(),a=xe(c),d=xe(" / "),y=xe(p),_=oe(),w=U("button"),T=xe("Next"),t.disabled=i=r[0]==0,de(t,"data-tooltip","Left"),w.disabled=M=r[0]==r[1].length-1,de(w,"data-tooltip","Right"),st(e,"display","flex"),st(e,"justify-content","space-between"),st(e,"align-items","center")},m(D,I){q(D,e,I),R(e,t),R(t,n),R(e,o),R(e,a),R(e,d),R(e,y),R(e,_),R(e,w),R(w,T),$||(P=[wt(window,"keydown",r[2]),wt(t,"click",r[3]),wt(w,"click",r[4])],$=!0)},p(D,[I]){I&1&&i!==(i=D[0]==0)&&(t.disabled=i),I&1&&c!==(c=D[0]+1+"")&&Tt(a,c),I&2&&p!==(p=D[1].length+"")&&Tt(y,p),I&3&&M!==(M=D[0]==D[1].length-1)&&(w.disabled=M)},i:et,o:et,d(D){D&&V(e),$=!1,pr(P)}}}function wS(r,e,t){let n;at(r,Ro,p=>t(5,n=p));let{list:i}=e,{idx:o=0}=e;Ls(()=>{n==null||n.keyboard.disable()}),Yr(()=>{n==null||n.keyboard.enable()});function c(p){p.key=="ArrowLeft"&&(p.stopPropagation(),a()),p.key=="ArrowRight"&&(p.stopPropagation(),d())}function a(){o!=0&&t(0,o--,o)}function d(){o!=i.length-1&&t(0,o++,o)}return r.$$set=p=>{"list"in p&&t(1,i=p.list),"idx"in p&&t(0,o=p.idx)},[o,i,c,a,d]}class Cd extends Lt{constructor(e){super(),Mt(this,e,wS,vS,vt,{list:1,idx:0})}}function x0(r,e,t){const n=r.slice();return n[4]=e[t][0],n[5]=e[t][1],n}function k0(r){let e,t,n,i,o=r[4]+"",c,a;return{c(){e=U("div"),t=U("span"),i=oe(),c=xe(o),a=oe(),de(t,"class",n="color-swatch "+r[1]+" svelte-1enycr6"),st(t,"background",r[5]),st(e,"display","flex"),st(e,"align-items","center"),st(e,"gap","6px")},m(d,p){q(d,e,p),R(e,t),R(e,i),R(e,c),R(e,a)},p(d,p){p&2&&n!==(n="color-swatch "+d[1]+" svelte-1enycr6")&&de(t,"class",n),p&1&&st(t,"background",d[5]),p&1&&o!==(o=d[4]+"")&&Tt(c,o)},d(d){d&&V(e)}}}function xS(r){let e,t=Rn(Object.entries(r[0])),n=[];for(let i=0;i<t.length;i+=1)n[i]=k0(x0(r,t,i));return{c(){e=U("div");for(let i=0;i<n.length;i+=1)n[i].c();st(e,"display","grid"),st(e,"grid-template-columns","repeat(auto-fill, calc("+r[2]+" - 10px))"),st(e,"gap","10px")},m(i,o){q(i,e,o);for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(e,null)},p(i,[o]){if(o&3){t=Rn(Object.entries(i[0]));let c;for(c=0;c<t.length;c+=1){const a=x0(i,t,c);n[c]?n[c].p(a,o):(n[c]=k0(a),n[c].c(),n[c].m(e,null))}for(;c<n.length;c+=1)n[c].d(1);n.length=t.length}},i:et,o:et,d(i){i&&V(e),di(n,i)}}}function kS(r,e,t){let{labelColors:n}=e,{swatchClass:i="rectangle"}=e,{itemsPerRow:o=2}=e,c=`${100/o}%`;return r.$$set=a=>{"labelColors"in a&&t(0,n=a.labelColors),"swatchClass"in a&&t(1,i=a.swatchClass),"itemsPerRow"in a&&t(3,o=a.itemsPerRow)},[n,i,c,o]}class eg extends Lt{constructor(e){super(),Mt(this,e,kS,xS,vt,{labelColors:0,swatchClass:1,itemsPerRow:3})}}function S0(r,e,t){const n=r.slice();return n[6]=e[t],n}function C0(r,e,t){const n=r.slice();return n[9]=e[t],n}function T0(r){let e,t;return{c(){e=U("span"),t=xe(""),de(e,"class","bucket svelte-3plrz9"),st(e,"background",r[9])},m(n,i){q(n,e,i),R(e,t)},p(n,i){i&1&&st(e,"background",n[9])},d(n){n&&V(e)}}}function M0(r){let e;return{c(){e=U("span"),e.textContent=`${r[6]}`,de(e,"class","svelte-3plrz9")},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function SS(r){let e,t,n,i,o=Rn(r[0]),c=[];for(let p=0;p<o.length;p+=1)c[p]=T0(C0(r,o,p));let a=Rn(r[3]),d=[];for(let p=0;p<a.length;p+=1)d[p]=M0(S0(r,a,p));return{c(){e=U("div"),t=U("div");for(let p=0;p<c.length;p+=1)c[p].c();n=oe(),i=U("div");for(let p=0;p<d.length;p+=1)d[p].c();de(t,"class","colors svelte-3plrz9"),de(i,"class","labels svelte-3plrz9"),de(e,"class","svelte-3plrz9"),Qt(e,"full-width-bucket-legend",r[2]),Qt(e,"bucketed",r[1].hasOwnProperty("buckets")),Qt(e,"limits",r[1].hasOwnProperty("limits"))},m(p,y){q(p,e,y),R(e,t);for(let _=0;_<c.length;_+=1)c[_]&&c[_].m(t,null);R(e,n),R(e,i);for(let _=0;_<d.length;_+=1)d[_]&&d[_].m(i,null)},p(p,[y]){if(y&1){o=Rn(p[0]);let _;for(_=0;_<o.length;_+=1){const w=C0(p,o,_);c[_]?c[_].p(w,y):(c[_]=T0(w),c[_].c(),c[_].m(t,null))}for(;_<c.length;_+=1)c[_].d(1);c.length=o.length}if(y&8){a=Rn(p[3]);let _;for(_=0;_<a.length;_+=1){const w=S0(p,a,_);d[_]?d[_].p(w,y):(d[_]=M0(w),d[_].c(),d[_].m(i,null))}for(;_<d.length;_+=1)d[_].d(1);d.length=a.length}y&4&&Qt(e,"full-width-bucket-legend",p[2]),y&2&&Qt(e,"bucketed",p[1].hasOwnProperty("buckets")),y&2&&Qt(e,"limits",p[1].hasOwnProperty("limits"))},i:et,o:et,d(p){p&&V(e),di(c,p),di(d,p)}}}function CS(r,e,t){let{colorScale:n}=e,{labels:i}=e,{decimalPlaces:o=0}=e,{fullWidthBucketLegend:c=!1}=e,a=[];"limits"in i?a=i.limits:a=i.buckets;let d=a.map(p=>typeof p=="number"?o>0?p.toFixed(o):p.toLocaleString():p);return r.$$set=p=>{"colorScale"in p&&t(0,n=p.colorScale),"labels"in p&&t(1,i=p.labels),"decimalPlaces"in p&&t(4,o=p.decimalPlaces),"fullWidthBucketLegend"in p&&t(2,c=p.fullWidthBucketLegend)},[n,i,c,d,o]}class Oo extends Lt{constructor(e){super(),Mt(this,e,CS,SS,vt,{colorScale:0,labels:1,decimalPlaces:4,fullWidthBucketLegend:2})}}function TS(r,e){let t=new Set(r.getStyle().layers.filter(n=>n.type=="line").map(n=>n.id));return e=="dataviz"?["Road network","Path"].filter(n=>t.has(n)):e=="hybrid"?["Path","Road","Tunnel"].filter(n=>t.has(n)):e=="streets-v2"?r.getStyle().layers.filter(n=>n["source-layer"]=="transportation"&&n.type=="line").map(n=>n.id):e=="uk-openzoomstack-light"?r.getStyle().layers.filter(n=>n["source-layer"]=="roads"&&n.type=="line").map(n=>n.id):[]}const{window:MS}=vb;function LS(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M,$;return T=Fm(r[8][0]),{c(){e=U("button"),e.textContent="Stop StreetView",t=oe(),n=U("fieldset"),i=U("legend"),i.textContent="Source:",o=oe(),c=U("label"),a=U("input"),d=xe(`
      Google Street View`),p=oe(),y=U("label"),_=U("input"),w=xe(`
      Bing Streetside`),de(e,"class","secondary"),de(a,"type","radio"),a.__value="google",qn(a,a.__value),de(_,"type","radio"),_.__value="bing",qn(_,_.__value),T.p(a,_)},m(P,D){q(P,e,D),q(P,t,D),q(P,n,D),R(n,i),R(n,o),R(n,c),R(c,a),a.checked=a.__value===r[0],R(c,d),R(n,p),R(n,y),R(y,_),_.checked=_.__value===r[0],R(y,w),M||($=[wt(e,"click",r[3]),wt(a,"change",r[7]),wt(_,"change",r[9])],M=!0)},p(P,D){D&1&&(a.checked=a.__value===P[0]),D&1&&(_.checked=_.__value===P[0])},d(P){P&&(V(e),V(t),V(n)),T.r(),M=!1,pr($)}}}function ES(r){let e,t,n;return{c(){e=U("button"),e.textContent="StreetView",de(e,"class","secondary")},m(i,o){q(i,e,o),t||(n=wt(e,"click",r[2]),t=!0)},p:et,d(i){i&&V(e),t=!1,n()}}}function IS(r){let e,t,n;function i(a,d){return a[1]?ES:LS}let o=i(r),c=o(r);return{c(){c.c(),e=Xn()},m(a,d){c.m(a,d),q(a,e,d),t||(n=wt(MS,"keydown",r[4]),t=!0)},p(a,[d]){o===(o=i(a))&&c?c.p(a,d):(c.d(1),c=o(a),c&&(c.c(),c.m(e.parentNode,e)))},i:et,o:et,d(a){a&&V(e),c.d(a),t=!1,n()}}}function AS(r,e,t){let n;at(r,Jf,$=>t(1,n=$));let{map:i}=e,{maptilerBasemap:o}=e,c="google",a=[];function d(){Nt(Jf,n=!1,n),i.on("click",y),i.getCanvas().style.cursor="crosshair";for(let $ of TS(i,o))a.push([$,i.getPaintProperty($,"line-color")]),i.setPaintProperty($,"line-color","cyan")}function p(){Nt(Jf,n=!0,n),i.off("click",y),i.getCanvas().style.cursor="inherit";for(let[$,P]of a)i.setPaintProperty($,"line-color",P);a=[]}Yr(p);function y($){let P=$.lngLat.lng,D=$.lngLat.lat;c=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${D},${P}&cbp=11,0,0,0,0`,"_blank"):c=="bing"&&window.open(`https://www.bing.com/maps?cp=${D}~${P}&style=x`,"_blank")}function _($){!n&&$.key=="Escape"&&($.stopPropagation(),p())}const w=[[]];function T(){c=this.__value,t(0,c)}function M(){c=this.__value,t(0,c)}return r.$$set=$=>{"map"in $&&t(5,i=$.map),"maptilerBasemap"in $&&t(6,o=$.maptilerBasemap)},[c,n,d,p,_,i,o,T,w,M]}class PS extends Lt{constructor(e){super(),Mt(this,e,AS,IS,vt,{map:5,maptilerBasemap:6})}}function mn(r,e=!0){return{id:r,beforeId:zS(r),eventsIfTopMost:e}}function zS(r){let e=fi(Ro);if(!e){console.warn(`getBeforeId(${r}) called before map is ready. Z-ordering may be incorrect.`);return}let t,n=!1;for(let i=L0.length-1;i>=0;i--){let o=L0[i];if(o==r){n=!0;break}e.getLayer(o)&&(t=o)}if(!n)throw new Error(`Layer ID ${r} not defined in layerZorder`);return t}let Wp=r=>r,Kp=r=>r;const L0=[Wp(Kp("Background")),"neighbourhood-boundaries",Wp("Ferry line"),"neighbourhood-boundaries-outline","neighbourhood-boundaries-selected-outline-base","neighbourhood-boundaries-selected-outline","debug-borders","debug-filters","cells","main-roads-outlines","main-roads","interior-roads-outlines","interior-roads","turn-restriction-targets","debug-intersections","debug-movements-outline","debug-movements-fill","debug-editable-intersections","editable-intersections","intersection-filters","border-entries","compare-route","shortcuts","shortcuts-focus","predict-impact-outline","predict-impact",Kp("Building"),"draw-area-lines","draw-area-area","draw-area-lines-preview","debug-demand-fill","debug-demand-outline","one-ways","context-population-car-ownership","context-simd","context-population-density","context-population-outline","context-traffic","context-los","context-existing-infra","context-route-network","context-bus-routes","context-pois","context-railway-stations","context-stats19",Kp("Road labels"),Wp("road_label"),"animate-shortcuts","modal-filters","turn-restrictions","turn-restrictions-debug-arrows","boundary","neighbourhood-boundary","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];let dv=["#8a9a5b","#ffc300","#cc5500","#c70039","#900c3f","#581845"],pv=[20,30,40,50,60,70],xl=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],Td=xl,Md=[0,20,40,60,80,100],Ld=xl.toReversed(),Ed=[0,1300,3e3,4200,5900,52e3],Yf=xl.toReversed(),DS=[0,.3,.6,1,1.5,2],$S=xl.toReversed(),mv=[0,1,10,50,100,1e3],gv=xl.toReversed(),_v=[0,1,10,50,100,1e3],yv=xl.toReversed(),Id=[0,20,40,60,80,100],Ad=xl;function bv(r){let e=[];for(let t=1;t<r.length;t++)e.push(t);return e}const RS="#0C793A",yo={mapFeature:{hover:{backgroundColor:"rgb(72, 96, 202)"}}};function qs(r){return["interpolate",["linear"],["zoom"],5,.5+r,10,1+r,12,1.5+r,14,4+r,16,7+r,20,24+r]}function Ea(r){return r<1e3?Math.round(r)+"m":(r/1e3).toFixed(1)+"km"}function Ia(r){if(r<60)return Math.round(r)+"s";let e=Math.floor(r/60),t=Math.round(r-e*60);return`${e}m${t}s`}function Bc(r,e){return e===0?"0%":`${Math.round(r/e*100)}%`}function ch(r){return r?fi(Fo)=="cnt"?_m(r,"LAD_"):r:"custom area"}function vv(r){let e=fi(Qs).project(r),t=new Date().toISOString().split("T")[0],n=`${e.project_name}-${t}.geojson`;wd(n,JSON.stringify(e))}function gm(r,e=4){return["interpolate",["exponential",2],["zoom"],0,["max",["/",r,15654.303392],e],22,["max",["/",r,.0597164283],e]]}async function xa(r){let e=await fetch(r);if(!e.ok)throw new Error(`${r} not OK: ${e.status}`);return e}function E0(r){return r.reduce((e,t)=>e+t,0)}function _m(r,e){return r.startsWith(e)?r.slice(e.length):r}function I0(r,e){return r.endsWith(e)?r.slice(0,-e.length):r}function FS(r){let e;return{c(){e=U("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:route%3Dbus" target="_blank">bus routes</a>
    according to OpenStreetMap.`,de(e,"slot","help")},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function BS(r){let e,t;const n=[mn("context-bus-routes"),{sourceLayer:"bus_routes"},{paint:{"line-color":"blue","line-width":qs(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let i={};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new sr({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,c){const a=c&1?Fn(n,[n[0],n[1],n[2],{layout:{visibility:o[0]?"visible":"none"}}]):{};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function OS(r){let e,t,n,i,o;function c(d){r[1](d)}let a={label:"Bus routes",$$slots:{help:[FS]},$$scope:{ctx:r}};return r[0]!==void 0&&(a.show=r[0]),e=new es({props:a}),hn.push(()=>In(e,"show",c)),i=new Lh({props:{url:`pmtiles://${zo("cnt_layers/bus_routes.pmtiles")}`,$$slots:{default:[BS]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment),n=oe(),fe(i.$$.fragment)},m(d,p){ue(e,d,p),q(d,n,p),ue(i,d,p),o=!0},p(d,[p]){const y={};p&4&&(y.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,y.show=d[0],En(()=>t=!1)),e.$set(y);const _={};p&5&&(_.$$scope={dirty:p,ctx:d}),i.$set(_)},i(d){o||(j(e.$$.fragment,d),j(i.$$.fragment,d),o=!0)},o(d){Z(e.$$.fragment,d),Z(i.$$.fragment,d),o=!1},d(d){d&&V(n),he(e,d),he(i,d)}}}function NS(r,e,t){let n=!1;function i(o){n=o,t(0,n)}return[n,i]}class jS extends Lt{constructor(e){super(),Mt(this,e,NS,OS,vt,{})}}var US=Object.defineProperty,wv=r=>{throw TypeError(r)},VS=(r,e,t)=>e in r?US(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Eo=(r,e,t)=>VS(r,typeof e!="symbol"?e+"":e,t),xv=(r,e,t)=>e.has(r)||wv("Cannot "+t),_i=(r,e,t)=>(xv(r,e,"read from private field"),t?t.call(r):e.get(r)),A0=(r,e,t)=>e.has(r)?wv("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),P0=(r,e,t,n)=>(xv(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);function Fr(){}function qS(r,e){for(const t in e)r[t]=e[t];return r}function kv(r){return r()}function z0(){return Object.create(null)}function ta(r){r.forEach(kv)}function Sv(r){return typeof r=="function"}function $a(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let Uf;function Wi(r,e){return r===e?!0:(Uf||(Uf=document.createElement("a")),Uf.href=e,r===Uf.href)}function ZS(r){return Object.keys(r).length===0}function GS(r,e,t,n){if(r){const i=Cv(r,e,t,n);return r[0](i)}}function Cv(r,e,t,n){return r[1]&&n?qS(t.ctx.slice(),r[1](n(e))):t.ctx}function HS(r,e,t,n){if(r[2]&&n){const i=r[2](n(t));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],c=Math.max(e.dirty.length,i.length);for(let a=0;a<c;a+=1)o[a]=e.dirty[a]|i[a];return o}return e.dirty|i}return e.dirty}function WS(r,e,t,n,i,o){if(i){const c=Cv(e,t,n,o);r.p(c,i)}}function KS(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function D0(r){return r??""}function Kn(r,e){r.appendChild(e)}function Nr(r,e,t){r.insertBefore(e,t||null)}function Br(r){r.parentNode&&r.parentNode.removeChild(r)}function br(r){return document.createElement(r)}function ps(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Aa(r){return document.createTextNode(r)}function Po(){return Aa(" ")}function XS(){return Aa("")}function ao(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function JS(r){return function(e){return e.preventDefault(),r.call(this,e)}}function bt(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function YS(r){return Array.from(r.childNodes)}function gh(r,e){e=""+e,r.data!==e&&(r.data=e)}function $0(r,e){r.value=e??""}function Qo(r,e,t){r.classList.toggle(e,!!t)}function QS(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}let _h;function uh(r){_h=r}function Tv(){if(!_h)throw new Error("Function called outside component initialization");return _h}function e5(r){Tv().$$.on_destroy.push(r)}function t5(){const r=Tv();return(e,t,{cancelable:n=!1}={})=>{const i=r.$$.callbacks[e];if(i){const o=QS(e,t,{cancelable:n});return i.slice().forEach(c=>{c.call(r,o)}),!o.defaultPrevented}return!0}}function R0(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const Ec=[],ym=[];let Dc=[];const F0=[],n5=Promise.resolve();let bm=!1;function r5(){bm||(bm=!0,n5.then(Mv))}function vm(r){Dc.push(r)}const Xp=new Set;let Cc=0;function Mv(){if(Cc!==0)return;const r=_h;do{try{for(;Cc<Ec.length;){const e=Ec[Cc];Cc++,uh(e),i5(e.$$)}}catch(e){throw Ec.length=0,Cc=0,e}for(uh(null),Ec.length=0,Cc=0;ym.length;)ym.pop()();for(let e=0;e<Dc.length;e+=1){const t=Dc[e];Xp.has(t)||(Xp.add(t),t())}Dc.length=0}while(Ec.length);for(;F0.length;)F0.pop()();bm=!1,Xp.clear(),uh(r)}function i5(r){if(r.fragment!==null){r.update(),ta(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(vm)}}function o5(r){const e=[],t=[];Dc.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Dc=e}const Qf=new Set;let pl;function ed(){pl={r:0,c:[],p:pl}}function td(){pl.r||ta(pl.c),pl=pl.p}function ci(r,e){r&&r.i&&(Qf.delete(r),r.i(e))}function Si(r,e,t,n){if(r&&r.o){if(Qf.has(r))return;Qf.add(r),pl.c.push(()=>{Qf.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function B0(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function s5(r,e){Si(r,1,1,()=>{e.delete(r.key)})}function a5(r,e,t,n,i,o,c,a,d,p,y,_){let w=r.length,T=o.length,M=w;const $={};for(;M--;)$[r[M].key]=M;const P=[],D=new Map,I=new Map,F=[];for(M=T;M--;){const J=_(i,o,M),ee=t(J);let me=c.get(ee);me?F.push(()=>me.p(J,e)):(me=p(ee,J),me.c()),D.set(ee,P[M]=me),ee in $&&I.set(ee,Math.abs(M-$[ee]))}const N=new Set,W=new Set;function se(J){ci(J,1),J.m(a,y),c.set(J.key,J),y=J.first,T--}for(;w&&T;){const J=P[T-1],ee=r[w-1],me=J.key,Ie=ee.key;J===ee?(y=J.first,w--,T--):D.has(Ie)?!c.has(me)||N.has(me)?se(J):W.has(Ie)?w--:I.get(me)>I.get(Ie)?(W.add(me),se(J)):(N.add(Ie),w--):(d(ee,c),w--)}for(;w--;){const J=r[w];D.has(J.key)||d(J,c)}for(;T;)se(P[T-1]);return ta(F),P}function Pa(r){r&&r.c()}function Xs(r,e,t){const{fragment:n,after_update:i}=r.$$;n&&n.m(e,t),vm(()=>{const o=r.$$.on_mount.map(kv).filter(Sv);r.$$.on_destroy?r.$$.on_destroy.push(...o):ta(o),r.$$.on_mount=[]}),i.forEach(vm)}function Js(r,e){const t=r.$$;t.fragment!==null&&(o5(t.after_update),ta(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function l5(r,e){r.$$.dirty[0]===-1&&(Ec.push(r),r5(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Ra(r,e,t,n,i,o,c=null,a=[-1]){const d=_h;uh(r);const p=r.$$={fragment:null,ctx:[],props:o,update:Fr,not_equal:i,bound:z0(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:z0(),dirty:a,skip_bound:!1,root:e.target||d.$$.root};c&&c(p.root);let y=!1;if(p.ctx=t?t(r,e.props||{},(_,w,...T)=>{const M=T.length?T[0]:w;return p.ctx&&i(p.ctx[_],p.ctx[_]=M)&&(!p.skip_bound&&p.bound[_]&&p.bound[_](M),y&&l5(r,_)),w}):[],p.update(),y=!0,ta(p.before_update),p.fragment=n?n(p.ctx):!1,e.target){if(e.hydrate){const _=YS(e.target);p.fragment&&p.fragment.l(_),_.forEach(Br)}else p.fragment&&p.fragment.c();e.intro&&ci(r.$$.fragment),Xs(r,e.target,e.anchor),Mv()}uh(d)}class Fa{constructor(){Eo(this,"$$"),Eo(this,"$$set")}$destroy(){Js(this,1),this.$destroy=Fr}$on(e,t){if(!Sv(t))return Fr;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!ZS(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const c5="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(c5);function u5(r){let e,t;return{c(){e=ps("svg"),t=ps("path"),bt(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),bt(e,"viewBox","0 0 14 14"),bt(e,"width","13"),bt(e,"height","13"),bt(e,"class","svelte-en2qvf")},m(n,i){Nr(n,e,i),Kn(e,t)},p:Fr,i:Fr,o:Fr,d(n){n&&Br(e)}}}class Lv extends Fa{constructor(e){super(),Ra(this,e,null,u5,$a,{})}}function h5(r){let e,t;return{c(){e=ps("svg"),t=ps("path"),bt(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),bt(e,"viewBox","0 0 30 30"),bt(e,"fill","none"),bt(e,"xmlns","http://www.w3.org/2000/svg"),bt(e,"class","svelte-d2loi5")},m(n,i){Nr(n,e,i),Kn(e,t)},p:Fr,i:Fr,o:Fr,d(n){n&&Br(e)}}}class Ev extends Fa{constructor(e){super(),Ra(this,e,null,h5,$a,{})}}function f5(r){let e,t;return{c(){e=br("img"),Wi(e.src,t=r[3]+"area.svg")||bt(e,"src",t),bt(e,"alt",r[6]),bt(e,"class","svelte-ltkwvy")},m(n,i){Nr(n,e,i)},p(n,i){i&8&&!Wi(e.src,t=n[3]+"area.svg")&&bt(e,"src",t),i&64&&bt(e,"alt",n[6])},d(n){n&&Br(e)}}}function d5(r){let e,t;return{c(){e=br("img"),Wi(e.src,t=r[3]+"reverse.svg")||bt(e,"src",t),bt(e,"alt",r[6]),bt(e,"class","svelte-ltkwvy")},m(n,i){Nr(n,e,i)},p(n,i){i&8&&!Wi(e.src,t=n[3]+"reverse.svg")&&bt(e,"src",t),i&64&&bt(e,"alt",n[6])},d(n){n&&Br(e)}}}function p5(r){let e,t;return{c(){e=br("img"),Wi(e.src,t=r[3]+"poi.svg")||bt(e,"src",t),bt(e,"alt",r[6]),bt(e,"class","svelte-ltkwvy")},m(n,i){Nr(n,e,i)},p(n,i){i&8&&!Wi(e.src,t=n[3]+"poi.svg")&&bt(e,"src",t),i&64&&bt(e,"alt",n[6])},d(n){n&&Br(e)}}}function m5(r){let e,t;return{c(){e=br("img"),Wi(e.src,t=r[3]+"postal_code.svg")||bt(e,"src",t),bt(e,"alt",r[6]),bt(e,"class","svelte-ltkwvy")},m(n,i){Nr(n,e,i)},p(n,i){i&8&&!Wi(e.src,t=n[3]+"postal_code.svg")&&bt(e,"src",t),i&64&&bt(e,"alt",n[6])},d(n){n&&Br(e)}}}function g5(r){let e,t;return{c(){e=br("img"),Wi(e.src,t=r[3]+"street.svg")||bt(e,"src",t),bt(e,"alt",r[6]),bt(e,"class","svelte-ltkwvy")},m(n,i){Nr(n,e,i)},p(n,i){i&8&&!Wi(e.src,t=n[3]+"street.svg")&&bt(e,"src",t),i&64&&bt(e,"alt",n[6])},d(n){n&&Br(e)}}}function _5(r){let e,t;return{c(){e=br("img"),Wi(e.src,t=r[3]+"road.svg")||bt(e,"src",t),bt(e,"alt",r[6]),bt(e,"class","svelte-ltkwvy")},m(n,i){Nr(n,e,i)},p(n,i){i&8&&!Wi(e.src,t=n[3]+"road.svg")&&bt(e,"src",t),i&64&&bt(e,"alt",n[6])},d(n){n&&Br(e)}}}function y5(r){let e,t;return{c(){e=br("img"),Wi(e.src,t=r[3]+"housenumber.svg")||bt(e,"src",t),bt(e,"alt",r[6]),bt(e,"class","svelte-ltkwvy")},m(n,i){Nr(n,e,i)},p(n,i){i&8&&!Wi(e.src,t=n[3]+"housenumber.svg")&&bt(e,"src",t),i&64&&bt(e,"alt",n[6])},d(n){n&&Br(e)}}}function b5(r){let e,t,n,i;return{c(){e=br("img"),Wi(e.src,t=r[5])||bt(e,"src",t),bt(e,"alt",r[4]),bt(e,"class","svelte-ltkwvy")},m(o,c){Nr(o,e,c),n||(i=ao(e,"error",r[14]),n=!0)},p(o,c){c&32&&!Wi(e.src,t=o[5])&&bt(e,"src",t),c&16&&bt(e,"alt",o[4])},d(o){o&&Br(e),n=!1,i()}}}function O0(r){let e,t;return{c(){e=br("span"),t=Aa(r[6]),bt(e,"class","secondary svelte-ltkwvy")},m(n,i){Nr(n,e,i),Kn(e,t)},p(n,i){i&64&&gh(t,n[6])},d(n){n&&Br(e)}}}function v5(r){let e,t,n,i,o,c,a,d,p,y=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",_,w,T=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],M,$,P=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",D,I,F;function N(ee,me){return me&1&&(t=null),me&1&&(n=null),me&1&&(i=null),me&1&&(o=null),ee[5]?b5:ee[0].address?y5:(t==null&&(t=!!ee[0].id.startsWith("road.")),t?_5:(n==null&&(n=!!ee[0].id.startsWith("address.")),n?g5:(i==null&&(i=!!ee[0].id.startsWith("postal_code.")),i?m5:(o==null&&(o=!!ee[0].id.startsWith("poi.")),o?p5:ee[7]?d5:f5))))}let W=N(r,-1),se=W(r),J=T&&O0(r);return{c(){e=br("li"),se.c(),c=Po(),a=br("span"),d=br("span"),p=br("span"),_=Aa(y),w=Po(),J&&J.c(),M=Po(),$=br("span"),D=Aa(P),bt(p,"class","primary svelte-ltkwvy"),bt(d,"class","svelte-ltkwvy"),bt($,"class","line2 svelte-ltkwvy"),bt(a,"class","texts svelte-ltkwvy"),bt(e,"tabindex","0"),bt(e,"data-selected",r[1]),bt(e,"class","svelte-ltkwvy"),Qo(e,"selected",r[1])},m(ee,me){Nr(ee,e,me),se.m(e,null),Kn(e,c),Kn(e,a),Kn(a,d),Kn(d,p),Kn(p,_),Kn(d,w),J&&J.m(d,null),Kn(a,M),Kn(a,$),Kn($,D),I||(F=[ao(e,"mouseenter",r[12]),ao(e,"focus",r[13])],I=!0)},p(ee,[me]){W===(W=N(ee,me))&&se?se.p(ee,me):(se.d(1),se=W(ee),se&&(se.c(),se.m(e,c))),me&1&&y!==(y=(ee[7]?ee[0].place_name:ee[0].place_name.replace(/,.*/,""))+"")&&gh(_,y),me&37&&(T=ee[2]==="always"||ee[2]!=="never"&&!ee[0].address&&!ee[0].id.startsWith("road.")&&!ee[0].id.startsWith("address.")&&!ee[0].id.startsWith("postal_code.")&&(!ee[0].id.startsWith("poi.")||!ee[5])&&!ee[7]),T?J?J.p(ee,me):(J=O0(ee),J.c(),J.m(d,null)):J&&(J.d(1),J=null),me&1&&P!==(P=(ee[7]?"":ee[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&gh(D,P),me&2&&bt(e,"data-selected",ee[1]),me&2&&Qo(e,"selected",ee[1])},i:Fr,o:Fr,d(ee){ee&&Br(e),se.d(),J&&J.d(),I=!1,ta(F)}}}function w5(r,e,t){var n;let i,o,{feature:c}=e,{selected:a=!1}=e,{showPlaceType:d}=e,{missingIconsCache:p}=e,{iconsBaseUrl:y}=e;const _=(n=c.properties)==null?void 0:n.categories;let w,T,M=0,$=c.place_type[0]==="reverse";function P(){T&&p.add(T),t(10,M++,M)}function D(N){R0.call(this,r,N)}function I(N){R0.call(this,r,N)}const F=()=>P();return r.$$set=N=>{"feature"in N&&t(0,c=N.feature),"selected"in N&&t(1,a=N.selected),"showPlaceType"in N&&t(2,d=N.showPlaceType),"missingIconsCache"in N&&t(9,p=N.missingIconsCache),"iconsBaseUrl"in N&&t(3,y=N.iconsBaseUrl)},r.$$.update=()=>{var N,W,se,J;if(r.$$.dirty&3640)do t(11,i--,i),t(4,w=_==null?void 0:_[i]),t(5,T=w?y+w.replace(/ /g,"_")+".svg":void 0);while(i>-1&&(!T||p.has(T)));r.$$.dirty&1&&t(6,o=((W=(N=c.properties)==null?void 0:N.categories)==null?void 0:W.join(", "))??((J=(se=c.properties)==null?void 0:se.place_type_name)==null?void 0:J[0])??c.place_type[0])},t(11,i=(_==null?void 0:_.length)??0),[c,a,d,y,w,T,o,$,P,p,M,i,D,I,F]}class x5 extends Fa{constructor(e){super(),Ra(this,e,w5,v5,$a,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function k5(r){let e;return{c(){e=br("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',bt(e,"class","svelte-7cmwmc")},m(t,n){Nr(t,e,n)},p:Fr,i:Fr,o:Fr,d(t){t&&Br(e)}}}class S5 extends Fa{constructor(e){super(),Ra(this,e,null,k5,$a,{})}}function C5(r){let e,t,n;return{c(){e=ps("svg"),t=ps("path"),bt(t,"stroke-width","4"),bt(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),bt(t,"class","svelte-gzo3ar"),bt(e,"width",n=r[0]==="list"?20:void 0),bt(e,"viewBox","0 0 70 85"),bt(e,"fill","none"),bt(e,"class","svelte-gzo3ar"),Qo(e,"in-map",r[0]!=="list"),Qo(e,"list-icon",r[0]==="list")},m(i,o){Nr(i,e,o),Kn(e,t)},p(i,[o]){o&1&&n!==(n=i[0]==="list"?20:void 0)&&bt(e,"width",n),o&1&&Qo(e,"in-map",i[0]!=="list"),o&1&&Qo(e,"list-icon",i[0]==="list")},i:Fr,o:Fr,d(i){i&&Br(e)}}}function T5(r,e,t){let{displayIn:n}=e;return r.$$set=i=>{"displayIn"in i&&t(0,n=i.displayIn)},[n]}class M5 extends Fa{constructor(e){super(),Ra(this,e,T5,C5,$a,{displayIn:0})}}function L5(r){let e,t;return{c(){e=ps("svg"),t=ps("path"),bt(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),bt(e,"viewBox","0 0 60.006 21.412"),bt(e,"width","14"),bt(e,"height","20"),bt(e,"class","svelte-en2qvf")},m(n,i){Nr(n,e,i),Kn(e,t)},p:Fr,i:Fr,o:Fr,d(n){n&&Br(e)}}}class E5 extends Fa{constructor(e){super(),Ra(this,e,null,L5,$a,{})}}function I5(r){let e,t,n;return{c(){e=ps("svg"),t=ps("circle"),n=ps("path"),bt(t,"cx","4.789"),bt(t,"cy","4.787"),bt(t,"r","3.85"),bt(t,"class","svelte-1aq105l"),bt(n,"d","M12.063 12.063 7.635 7.635"),bt(n,"class","svelte-1aq105l"),bt(e,"xmlns","http://www.w3.org/2000/svg"),bt(e,"width","13"),bt(e,"height","13"),bt(e,"viewBox","0 0 13 13"),bt(e,"class","svelte-1aq105l")},m(i,o){Nr(i,e,o),Kn(e,t),Kn(e,n)},p:Fr,i:Fr,o:Fr,d(i){i&&Br(e)}}}class A5 extends Fa{constructor(e){super(),Ra(this,e,null,I5,$a,{})}}function P5(r,e,t){const n=e[1],i=e[0],o=n-i;return r===n&&t?r:((r-i)%o+o)%o+i}function md(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let qu;async function z5(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const i of e??[])if(!(n&&(i.minZoom!=null&&i.minZoom>n[0]||i.maxZoom!=null&&i.maxZoom<n[0]))){if(i.type==="fixed")return i.coordinates.join(",");e:if(i.type==="client-geolocation"){if(qu&&i.cachedLocationExpiry&&qu.time+i.cachedLocationExpiry>Date.now()){if(!qu.coords)break e;return qu.coords}let o;try{return o=await new Promise((c,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(d=>{c([d.coords.longitude,d.coords.latitude].map(p=>p.toFixed(6)).join(","))},d=>{a(d)},i)}),o}catch{}finally{i.cachedLocationExpiry&&(qu={time:Date.now(),coords:o})}if(t.signal.aborted)return}if(i.type==="server-geolocation")return"ip";if(n&&i.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const D5=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,N0=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,j0=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,U0=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,V0=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,q0=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function $5(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(T=>Number(T.trim())),t=Number(e[0]),n=Number(e[1]),i=Math.abs(t),o=Math.abs(n),c=t>0?"N":"S",a=n>0?"E":"W";let d;r=="DD"&&(d=`${i} ${c}, ${o} ${a}`);const p=Math.floor(i),y=Math.floor(o),_=(i-p)*60,w=(o-y)*60;if(r=="DM"){let T=Z0(_,3).toFixed(3).padStart(6,"0"),M=Z0(w,3).toFixed(3).padStart(6,"0");T.endsWith(".000")&&M.endsWith(".000")&&(T=T.replace(/\.000$/,""),M=M.replace(/\.000$/,"")),d=`${p} ${T}' ${c}, ${y} ${M}' ${a}`}if(r=="DMS"){const T=Math.floor(_),M=Math.floor(w);let $=((_-T)*60).toFixed(1).padStart(4,"0"),P=((w-M)*60).toFixed(1).padStart(4,"0");const D=T.toString().padStart(2,"0"),I=M.toString().padStart(2,"0");$.endsWith(".0")&&P.endsWith(".0")&&($=$.replace(/\.0$/,""),P=P.replace(/\.0$/,"")),d=`${p} ${D}' ${$}" ${c}, ${y} ${I}' ${P}" ${a}`}return d}else throw new Error("no decimal coordinates to convert")}function Z0(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function tg(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,n=null,i="",o="",c=null,a=[],d=!1;if(D5.test(r))throw new Error("invalid coordinate value");if(N0.test(r))if(a=N0.exec(r),d=Zu(a),d)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),n=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(n*=-1),c="DM";else throw new Error("invalid coordinate format");else if(j0.test(r))if(a=j0.exec(r),d=Zu(a),d){if(t=a[2],n=a[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),c="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");a[1]?(i=a[1],o=a[5]):a[4]&&(i=a[4],o=a[8])}else throw new Error("invalid decimal coordinate format");else if(U0.test(r))if(a=U0.exec(r),d=Zu(a),d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,c="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,c="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[9])),a[11]&&(n+=a[11]/60),a[13]&&(n+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(n=-1*n),a[1]?(i=a[1],o=a[8]):a[7]&&(i=a[7],o=a[14]);else throw new Error("invalid DMS coordinates format");else if(V0.test(r))if(a=V0.exec(r),d=Zu(a),d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,c="DM"),a[6]&&(t+=a[6]/3600,c="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12]/60),a[14]&&(n+=a[14]/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(i=a[1],o=a[9]):a[8]&&(i=a[8],o=a[16]);else throw new Error("invalid DMS coordinates format");else if(q0.test(r)){if(a=q0.exec(r),d=Zu(a),a.filter(p=>p).length<=5)throw new Error("invalid coordinates format");if(d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,c="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,c="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12].replace(",",".")/60),a[14]&&(n+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(i=a[1],o=a[9]):a[8]&&(i=a[8],o=a[16]);else throw new Error("invalid coordinates format")}if(d){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(i&&!o||!i&&o)throw new Error("invalid coordinates value");if(i&&i==o)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let p=/S|SOUTH/i;p.test(i)&&t>0&&(t=-1*t),p=/W|WEST/i,p.test(o)&&n>0&&(n=-1*n);const y=a[0].trim();let _,w;const T=/[,/;\u0020]/g,M=y.match(T);if(M==null){const D=Math.floor(r.length/2);_=y.substring(0,D).trim(),w=y.substring(D).trim()}else{let D;M.length%2==1?D=Math.floor(M.length/2):D=M.length/2-1;let I=0;if(D==0)I=y.indexOf(M[0]),_=y.substring(0,I).trim(),w=y.substring(I+1).trim();else{let F=0,N=0;for(;F<=D;)I=y.indexOf(M[F],N),N=I+1,F++;_=y.substring(0,I).trim(),w=y.substring(I+1).trim()}}const $=_.split(".");if($.length==2&&$[1]==0&&$[1].length!=2)throw new Error("invalid coordinates format");const P=w.split(".");if(P.length==2&&P[1]==0&&P[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(_)||/^\d+$/.test(w))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:y,verbatimLatitude:_,verbatimLongitude:w,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:c,closeEnough:R5,toCoordinateFormat:$5})}else throw new Error("coordinates pattern match failed")}function Zu(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,i=e.length/2;for(let o=0;o<i;o++){const c=e[o],a=e[o+i],d=t.test(c)&&t.test(a),p=n.test(c)&&n.test(a),y=c==a;if(!(c==null&&a==null)){if(c==null||a==null)return!1;if(d||p||y)continue;return!1}}return!0}function G0(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function R5(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return G0(this.decimalLatitude,Number(e[0]))&&G0(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const F5=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});tg.to=F5;const B5=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],O5={decimalLatitude:40.123,decimalLongitude:-74.123},N5=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],j5=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function U5(){const r=[];return B5.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...O5})}),[...r,...N5,...j5]}const V5=U5();tg.formats=V5.map(r=>r.verbatimCoordinates);const q5=tg;function H0(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function W0(r){let e,t;return e=new S5({}),{c(){Pa(e.$$.fragment)},m(n,i){Xs(e,n,i),t=!0},i(n){t||(ci(e.$$.fragment,n),t=!0)},o(n){Si(e.$$.fragment,n),t=!1},d(n){Js(e,n)}}}function K0(r){let e,t,n,i,o;return t=new E5({}),{c(){e=br("button"),Pa(t.$$.fragment),bt(e,"type","button"),bt(e,"title",r[9]),bt(e,"class","svelte-bz0zu3"),Qo(e,"active",r[0])},m(c,a){Nr(c,e,a),Xs(t,e,null),n=!0,i||(o=ao(e,"click",r[69]),i=!0)},p(c,a){(!n||a[0]&512)&&bt(e,"title",c[9]),(!n||a[0]&1)&&Qo(e,"active",c[0])},i(c){n||(ci(t.$$.fragment,c),n=!0)},o(c){Si(t.$$.fragment,c),n=!1},d(c){c&&Br(e),Js(t),i=!1,o()}}}function Z5(r){let e,t=[],n=new Map,i,o,c,a=B0(r[14]);const d=p=>p[84].id+(p[84].address?","+p[84].address:"");for(let p=0;p<a.length;p+=1){let y=H0(r,a,p),_=d(y);n.set(_,t[p]=X0(_,y))}return{c(){e=br("ul");for(let p=0;p<t.length;p+=1)t[p].c();bt(e,"class","options svelte-bz0zu3")},m(p,y){Nr(p,e,y);for(let _=0;_<t.length;_+=1)t[_]&&t[_].m(e,null);i=!0,o||(c=[ao(e,"mouseleave",r[73]),ao(e,"blur",r[74])],o=!0)},p(p,y){y[0]&17880064&&(a=B0(p[14]),ed(),t=a5(t,y,d,1,p,a,n,e,s5,X0,null,H0),td())},i(p){if(!i){for(let y=0;y<a.length;y+=1)ci(t[y]);i=!0}},o(p){for(let y=0;y<t.length;y+=1)Si(t[y]);i=!1},d(p){p&&Br(e);for(let y=0;y<t.length;y+=1)t[y].d();o=!1,ta(c)}}}function G5(r){let e,t,n,i,o,c;return t=new Ev({}),{c(){e=br("div"),Pa(t.$$.fragment),n=Po(),i=br("div"),o=Aa(r[7]),bt(i,"class","svelte-bz0zu3"),bt(e,"class","no-results svelte-bz0zu3")},m(a,d){Nr(a,e,d),Xs(t,e,null),Kn(e,n),Kn(e,i),Kn(i,o),c=!0},p(a,d){(!c||d[0]&128)&&gh(o,a[7])},i(a){c||(ci(t.$$.fragment,a),c=!0)},o(a){Si(t.$$.fragment,a),c=!1},d(a){a&&Br(e),Js(t)}}}function H5(r){let e="",t;return{c(){t=Aa(e)},m(n,i){Nr(n,t,i)},p:Fr,i:Fr,o:Fr,d(n){n&&Br(t)}}}function W5(r){let e,t,n,i,o,c,a,d,p,y,_;return t=new Ev({}),d=new Lv({}),{c(){e=br("div"),Pa(t.$$.fragment),n=Po(),i=br("div"),o=Aa(r[6]),c=Po(),a=br("button"),Pa(d.$$.fragment),bt(i,"class","svelte-bz0zu3"),bt(a,"class","svelte-bz0zu3"),bt(e,"class","error svelte-bz0zu3")},m(w,T){Nr(w,e,T),Xs(t,e,null),Kn(e,n),Kn(e,i),Kn(i,o),Kn(e,c),Kn(e,a),Xs(d,a,null),p=!0,y||(_=ao(a,"click",r[70]),y=!0)},p(w,T){(!p||T[0]&64)&&gh(o,w[6])},i(w){p||(ci(t.$$.fragment,w),ci(d.$$.fragment,w),p=!0)},o(w){Si(t.$$.fragment,w),Si(d.$$.fragment,w),p=!1},d(w){w&&Br(e),Js(t),Js(d),y=!1,_()}}}function X0(r,e){let t,n,i;function o(){return e[71](e[86])}function c(){return e[72](e[84])}return n=new x5({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",o),n.$on("focus",c),{key:r,first:null,c(){t=XS(),Pa(n.$$.fragment),this.first=t},m(a,d){Nr(a,t,d),Xs(n,a,d),i=!0},p(a,d){e=a;const p={};d[0]&16384&&(p.feature=e[84]),d[0]&1024&&(p.showPlaceType=e[10]),d[0]&49152&&(p.selected=e[15]===e[86]),d[0]&4096&&(p.iconsBaseUrl=e[12]),n.$set(p)},i(a){i||(ci(n.$$.fragment,a),i=!0)},o(a){Si(n.$$.fragment,a),i=!1},d(a){a&&Br(t),Js(n,a)}}}function K5(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M,$,P,D,I,F,N,W,se=!1;o=new A5({}),_=new Lv({});let J=r[19]&&W0(),ee=r[5]==="button"&&K0(r);const me=r[61].default,Ie=GS(me,r,r[60],null),Q=[W5,H5,G5,Z5],ae=[];function Pe(ve,tt){var Ge,Ee;return ve[18]?0:ve[16]?((Ge=ve[14])==null?void 0:Ge.length)===0?2:ve[16]&&(Ee=ve[14])!=null&&Ee.length?3:-1:1}return~(P=Pe(r))&&(D=ae[P]=Q[P](r)),{c(){e=Po(),t=br("form"),n=br("div"),i=br("button"),Pa(o.$$.fragment),c=Po(),a=br("input"),d=Po(),p=br("div"),y=br("button"),Pa(_.$$.fragment),w=Po(),J&&J.c(),T=Po(),ee&&ee.c(),M=Po(),Ie&&Ie.c(),$=Po(),D&&D.c(),bt(i,"class","search-button svelte-bz0zu3"),bt(i,"type","button"),bt(a,"placeholder",r[8]),bt(a,"aria-label",r[8]),bt(a,"class","svelte-bz0zu3"),bt(y,"type","button"),bt(y,"title",r[3]),bt(y,"class","svelte-bz0zu3"),bt(p,"class","clear-button-container svelte-bz0zu3"),Qo(p,"displayable",r[1]!==""),bt(n,"class","input-group svelte-bz0zu3"),bt(t,"tabindex","0"),bt(t,"class",I=D0(r[2])+" svelte-bz0zu3"),Qo(t,"can-collapse",r[4]&&r[1]==="")},m(ve,tt){Nr(ve,e,tt),Nr(ve,t,tt),Kn(t,n),Kn(n,i),Xs(o,i,null),Kn(n,c),Kn(n,a),r[63](a),$0(a,r[1]),Kn(n,d),Kn(n,p),Kn(p,y),Xs(_,y,null),Kn(p,w),J&&J.m(p,null),Kn(n,T),ee&&ee.m(n,null),Kn(n,M),Ie&&Ie.m(n,null),Kn(t,$),~P&&ae[P].m(t,null),F=!0,N||(W=[ao(i,"click",r[62]),ao(a,"input",r[64]),ao(a,"focus",r[65]),ao(a,"blur",r[66]),ao(a,"keydown",r[22]),ao(a,"input",r[67]),ao(y,"click",r[68]),ao(t,"submit",JS(r[21]))],N=!0)},p(ve,tt){(!F||tt[0]&256)&&bt(a,"placeholder",ve[8]),(!F||tt[0]&256)&&bt(a,"aria-label",ve[8]),tt[0]&2&&a.value!==ve[1]&&$0(a,ve[1]),(!F||tt[0]&8)&&bt(y,"title",ve[3]),ve[19]?J?tt[0]&524288&&ci(J,1):(J=W0(),J.c(),ci(J,1),J.m(p,null)):J&&(ed(),Si(J,1,1,()=>{J=null}),td()),(!F||tt[0]&2)&&Qo(p,"displayable",ve[1]!==""),ve[5]==="button"?ee?(ee.p(ve,tt),tt[0]&32&&ci(ee,1)):(ee=K0(ve),ee.c(),ci(ee,1),ee.m(n,M)):ee&&(ed(),Si(ee,1,1,()=>{ee=null}),td()),Ie&&Ie.p&&(!F||tt[1]&536870912)&&WS(Ie,me,ve,ve[60],F?HS(me,ve[60],tt,null):KS(ve[60]),null);let Ge=P;P=Pe(ve),P===Ge?~P&&ae[P].p(ve,tt):(D&&(ed(),Si(ae[Ge],1,1,()=>{ae[Ge]=null}),td()),~P?(D=ae[P],D?D.p(ve,tt):(D=ae[P]=Q[P](ve),D.c()),ci(D,1),D.m(t,null)):D=null),(!F||tt[0]&4&&I!==(I=D0(ve[2])+" svelte-bz0zu3"))&&bt(t,"class",I),(!F||tt[0]&22)&&Qo(t,"can-collapse",ve[4]&&ve[1]==="")},i(ve){F||(ci(se),ci(o.$$.fragment,ve),ci(_.$$.fragment,ve),ci(J),ci(ee),ci(Ie,ve),ci(D),F=!0)},o(ve){Si(se),Si(o.$$.fragment,ve),Si(_.$$.fragment,ve),Si(J),Si(ee),Si(Ie,ve),Si(D),F=!1},d(ve){ve&&(Br(e),Br(t)),Js(o),r[63](null),Js(_),J&&J.d(),ee&&ee.d(),Ie&&Ie.d(ve),~P&&ae[P].d(),N=!1,ta(W)}}}function X5(r,e,t){let n,i,{$$slots:o={},$$scope:c}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:d=void 0}=e,{apiKey:p}=e,{bbox:y=void 0}=e,{clearButtonTitle:_="clear"}=e,{clearOnBlur:w=!1}=e,{collapsed:T=!1}=e,{country:M=void 0}=e,{debounceSearch:$=200}=e,{enableReverse:P="never"}=e,{errorMessage:D="Something went wrong"}=e,{filter:I=()=>!0}=e,{flyTo:F=!0}=e,{fuzzyMatch:N=!0}=e,{language:W=void 0}=e,{limit:se=void 0}=e,{mapController:J=void 0}=e,{minLength:ee=2}=e,{noResultsMessage:me="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Ie="Search"}=e,{proximity:Q=[{type:"server-geolocation"}]}=e,{reverseActive:ae=P==="always"}=e,{reverseButtonTitle:Pe="toggle reverse geocoding"}=e,{searchValue:ve=""}=e,{pickedResultStyle:tt="full-geometry"}=e,{showPlaceType:Ge="if-needed"}=e,{showResultsWhileTyping:Ee=!0}=e,{selectFirst:$e=!0}=e,{flyToSelected:St=!1}=e,{markerOnSelected:rt=!0}=e,{types:lt=void 0}=e,{exhaustiveReverseGeocoding:mt=!1}=e,{excludeTypes:ft=!1}=e,{zoom:Xe=a}=e,{apiUrl:Dt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:_t={}}=e,{iconsBaseUrl:$t="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:Et=()=>{}}=e;function Yt(){Ue.focus()}function _n(){Ue.blur()}function Zt(re,He=!0,Ke=!1){t(1,ve=re),He?(t(15,it=-1),yt()):(Gt(!Ke,Ke),setTimeout(()=>{Ue.focus(),Ue.select()}))}function ln(){t(14,kt=void 0),t(56,_e=void 0),t(15,it=-1)}function ze(){t(55,jt=[]),t(56,_e=void 0)}let Ne=!1,kt,jt,_e,vn="",Ue,it=-1,Kt,ur=[],nr,vr,Qr,mr;const Ci=new Set,Jn=t5();e5(()=>{J&&(J.setEventHandler(void 0),J.indicateReverse(!1),J.setSelectedMarker(-1),J.setFeatures(void 0,void 0,!1))});function yt(re){if(vr&&(clearTimeout(vr),vr=void 0),it>-1&&kt)t(56,_e=kt[it]),t(1,ve=_e.place_type[0]==="reverse"?_e.place_name:_e.place_name.replace(/,.*/,"")),t(18,Kt=void 0),t(55,jt=void 0),t(15,it=-1);else if(ve){const He=re||!wr(ve);Tr(ve,{exact:!0}).then(()=>{t(55,jt=kt),t(56,_e=void 0),He&&uo()}).catch(Ke=>t(18,Kt=Ke))}}function wr(re){try{return q5(re,6)}catch{return!1}}async function Tr(re,{byId:He=!1,exact:Ke=!1}={}){t(18,Kt=void 0),nr==null||nr.abort();const Ye=new AbortController;t(19,nr=Ye);try{const ct=wr(re),Ct=new URLSearchParams;if(W!==void 0&&Ct.set("language",Array.isArray(W)?W.join(","):W??""),lt&&Ct.set("types",lt.join(",")),ft&&Ct.set("excludeTypes",String(ft)),y&&Ct.set("bbox",y.map(Bn=>Bn.toFixed(6)).join(",")),M&&Ct.set("country",Array.isArray(M)?M.join(","):M),!He&&!ct){const Bn=await z5(J,Q,Ye);Bn&&Ct.set("proximity",Bn),(Ke||!Ee)&&Ct.set("autocomplete","false"),Ct.set("fuzzyMatch",String(N))}se!==void 0&&(mt||!ct||(lt==null?void 0:lt.length)===1)&&Ct.set("limit",String(se)),Ct.set("key",p),Et(Ct);const Xt=Dt+"/"+encodeURIComponent(ct?ct.decimalLongitude+","+ct.decimalLatitude:re)+".json?"+Ct.toString();if(Xt===vn){He?(t(14,kt=void 0),t(56,_e=ur[0])):t(14,kt=ur);return}vn=Xt;const fn=await fetch(Xt,{signal:Ye.signal,..._t});if(!fn.ok)throw new Error(await fn.text());const wn=await fn.json();Jn("response",{url:Xt,featureCollection:wn}),He?(t(14,kt=void 0),t(56,_e=wn.features[0]),ur=[_e]):(t(14,kt=wn.features.filter(I)),ct&&kt.unshift({type:"Feature",properties:{},id:"reverse_"+ct.decimalLongitude+"_"+ct.decimalLatitude,text:ct.decimalLatitude+", "+ct.decimalLongitude,place_name:ct.decimalLatitude+", "+ct.decimalLongitude,place_type:["reverse"],center:[ct.decimalLongitude,ct.decimalLatitude],bbox:[ct.decimalLongitude,ct.decimalLatitude,ct.decimalLongitude,ct.decimalLatitude],geometry:{type:"Point",coordinates:[ct.decimalLongitude,ct.decimalLatitude]}}),ur=kt,ct&&Ue.focus())}catch(ct){if(ct&&typeof ct=="object"&&"name"in ct&&ct.name==="AbortError")return;throw ct}finally{Ye===nr&&t(19,nr=void 0)}}function uo(){var re;if(!(jt!=null&&jt.length)||!F)return;const He=[180,90,-180,-90],Ke=!jt.some(ct=>!ct.matching_text);let Ye;for(const ct of jt){const Ct=Yn(ct);if(Ye=Ye===void 0?Ct:Ct===void 0?Ye:Math.max(Ye,Ct),Ke||!ct.matching_text)for(const Xt of[0,1,2,3])He[Xt]=Math[Xt<2?"min":"max"](He[Xt],((re=ct.bbox)==null?void 0:re[Xt])??ct.center[Xt%2])}J&&jt.length>0&&(_e&&He[0]===He[2]&&He[1]===He[3]?J.flyTo(_e.center,Yn(_e)):J.fitBounds(md(He),50,Ye))}function Yn(re){var He;if(!re.bbox||re.bbox[0]!==re.bbox[2]&&re.bbox[1]!==re.bbox[3])return;const Ke=re.id.replace(/\..*/,"");return(Array.isArray((He=re.properties)==null?void 0:He.categories)?re.properties.categories.reduce((Ye,ct)=>{const Ct=Xe[Ke+"."+ct];return Ye===void 0?Ct:Ct===void 0?Ye:Math.max(Ye,Ct)},void 0):void 0)??Xe[Ke]}function At(re){t(0,ae=P==="always"),t(14,kt=void 0),t(56,_e=void 0),t(15,it=-1),Zt(re[1].toFixed(6)+", "+P5(re[0],[-180,180],!0).toFixed(6),!1,!0)}function pn(re){if(!kt)return;let He=re.key==="ArrowDown"?1:re.key==="ArrowUp"?-1:0;He&&(it===($e?0:-1)&&He===-1&&t(15,it=kt.length),t(15,it+=He),it>=kt.length&&t(15,it=-1),it<0&&$e&&t(15,it=0),re.preventDefault())}function Gt(re=!0,He=!1){if(t(18,Kt=void 0),Ee||He){if(vr&&clearTimeout(vr),ve.length<ee)return;const Ke=ve;vr=window.setTimeout(()=>{Tr(Ke).catch(Ye=>t(18,Kt=Ye))},re?$:0)}else t(14,kt=void 0),t(18,Kt=void 0)}function Qn(re){t(56,_e=re),t(1,ve=re.place_name),t(15,it=-1)}const mi=()=>Ue.focus();function sn(re){ym[re?"unshift":"push"](()=>{Ue=re,t(17,Ue)})}function zi(){ve=this.value,t(1,ve),t(13,Ne),t(28,w)}const er=()=>t(13,Ne=!0),Ce=()=>t(13,Ne=!1),te=()=>Gt(),ne=()=>{t(1,ve=""),Ue.focus()},le=()=>t(0,ae=!ae),we=()=>t(18,Kt=void 0),Be=re=>t(15,it=re),Oe=re=>Qn(re),qe=()=>{$e||t(15,it=-1)},De=()=>{};return r.$$set=re=>{"class"in re&&t(2,d=re.class),"apiKey"in re&&t(26,p=re.apiKey),"bbox"in re&&t(27,y=re.bbox),"clearButtonTitle"in re&&t(3,_=re.clearButtonTitle),"clearOnBlur"in re&&t(28,w=re.clearOnBlur),"collapsed"in re&&t(4,T=re.collapsed),"country"in re&&t(29,M=re.country),"debounceSearch"in re&&t(30,$=re.debounceSearch),"enableReverse"in re&&t(5,P=re.enableReverse),"errorMessage"in re&&t(6,D=re.errorMessage),"filter"in re&&t(31,I=re.filter),"flyTo"in re&&t(32,F=re.flyTo),"fuzzyMatch"in re&&t(33,N=re.fuzzyMatch),"language"in re&&t(34,W=re.language),"limit"in re&&t(35,se=re.limit),"mapController"in re&&t(36,J=re.mapController),"minLength"in re&&t(37,ee=re.minLength),"noResultsMessage"in re&&t(7,me=re.noResultsMessage),"placeholder"in re&&t(8,Ie=re.placeholder),"proximity"in re&&t(38,Q=re.proximity),"reverseActive"in re&&t(0,ae=re.reverseActive),"reverseButtonTitle"in re&&t(9,Pe=re.reverseButtonTitle),"searchValue"in re&&t(1,ve=re.searchValue),"pickedResultStyle"in re&&t(39,tt=re.pickedResultStyle),"showPlaceType"in re&&t(10,Ge=re.showPlaceType),"showResultsWhileTyping"in re&&t(40,Ee=re.showResultsWhileTyping),"selectFirst"in re&&t(11,$e=re.selectFirst),"flyToSelected"in re&&t(41,St=re.flyToSelected),"markerOnSelected"in re&&t(42,rt=re.markerOnSelected),"types"in re&&t(43,lt=re.types),"exhaustiveReverseGeocoding"in re&&t(44,mt=re.exhaustiveReverseGeocoding),"excludeTypes"in re&&t(45,ft=re.excludeTypes),"zoom"in re&&t(46,Xe=re.zoom),"apiUrl"in re&&t(47,Dt=re.apiUrl),"fetchParameters"in re&&t(48,_t=re.fetchParameters),"iconsBaseUrl"in re&&t(12,$t=re.iconsBaseUrl),"adjustUrlQuery"in re&&t(49,Et=re.adjustUrlQuery),"$$scope"in re&&t(60,c=re.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,ae=P==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,Qr=Ne),w&&!Ne&&t(1,ve="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&ve.length<ee&&(t(56,_e=void 0),t(14,kt=void 0),t(18,Kt=void 0),t(55,jt=kt)),r.$$.dirty[1]&33554688&&tt!=="marker-only"&&_e&&!_e.address&&_e.geometry.type==="Point"&&_e.place_type[0]!=="reverse"&&Tr(_e.id,{byId:!0}).catch(re=>t(18,Kt=re)),r.$$.dirty[1]&100663330&&(J&&_e&&_e.id!==mr&&F&&(!_e.bbox||_e.bbox[0]===_e.bbox[2]&&_e.bbox[1]===_e.bbox[3]?J.flyTo(_e.center,Yn(_e)):J.fitBounds(md(_e.bbox),50,Yn(_e)),t(14,kt=void 0),t(55,jt=void 0),t(15,it=-1)),t(57,mr=_e==null?void 0:_e.id)),r.$$.dirty[0]&18432&&$e&&kt!=null&&kt.length&&t(15,it=0),r.$$.dirty[0]&2&&t(15,it=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&jt!==kt&&t(55,jt=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&J&&J.setEventHandler(re=>{switch(re.type){case"mapClick":ae&&At(re.coordinates);break;case"markerClick":{const He=kt==null?void 0:kt.find(Ke=>Ke.id===re.id);He&&Qn(He)}break;case"markerMouseEnter":jt&&t(15,it=Qr?(kt==null?void 0:kt.findIndex(He=>He.id===re.id))??-1:-1);break;case"markerMouseLeave":jt&&t(15,it=-1);break}}),r.$$.dirty[0]&49152&&t(58,i=kt==null?void 0:kt[it]),r.$$.dirty[1]&134218786&&J&&i&&F&&St&&J.flyTo(i.center,Yn(i)),r.$$.dirty[1]&256&&t(59,n=tt==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(rt||J==null||J.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&J&&rt&&!jt&&(J.setFeatures(i?[i]:void 0,void 0,n),J.setSelectedMarker(i?0:-1)),r.$$.dirty[1]&318767136&&J&&J.setFeatures(jt,_e,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&jt&&J&&J.setSelectedMarker(it),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&J){const re=wr(ve);J.setReverseMarker(re?[re.decimalLongitude,re.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Jn("select",{feature:i}),r.$$.dirty[1]&33554432&&Jn("pick",{feature:_e}),r.$$.dirty[0]&81920&&Jn("optionsvisibilitychange",{optionsVisible:Qr&&!!kt}),r.$$.dirty[0]&16384&&Jn("featureslisted",{features:kt}),r.$$.dirty[1]&16777216&&Jn("featuresmarked",{features:jt}),r.$$.dirty[0]&1&&Jn("reversetoggle",{reverse:ae}),r.$$.dirty[0]&2&&Jn("querychange",{query:ve}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&J&&J.indicateReverse(ae)},[ae,ve,d,_,T,P,D,me,Ie,Pe,Ge,$e,$t,Ne,kt,it,Qr,Ue,Kt,nr,Ci,yt,pn,Gt,Qn,a,p,y,w,M,$,I,F,N,W,se,J,ee,Q,tt,Ee,St,rt,lt,mt,ft,Xe,Dt,_t,Et,Yt,_n,Zt,ln,ze,jt,_e,mr,i,n,c,o,mi,sn,zi,er,Ce,te,ne,le,we,Be,Oe,qe,De]}let J5=class extends Fa{constructor(r){super(),Ra(this,r,X5,K5,$a,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}};function yh(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function ng(r,e,t={}){for(const n of r){if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(n[n.length-1].length!==n[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<n[n.length-1].length;i++)if(n[n.length-1][i]!==n[0][i])throw new Error("First and last Position are not equivalent.")}return yh({type:"Polygon",coordinates:r},e,t)}function bh(r,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function Iv(r,e,t={}){return yh({type:"MultiPolygon",coordinates:r},e,t)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Y5(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,c;return c={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function a(p){return function(y){return d([p,y])}}function d(p){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=p[0]&2?i.return:p[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,p[1])).done)return o;switch(i=0,o&&(p=[p[0]&2,o.value]),p[0]){case 0:case 1:o=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!o||p[1]>o[0]&&p[1]<o[3])){t.label=p[1];break}if(p[0]===6&&t.label<o[1]){t.label=o[1],o=p;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(p);break}o[2]&&t.ops.pop(),t.trys.pop();continue}p=e.call(r,t)}catch(y){p=[6,y],i=0}finally{n=o=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}var za=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function Q5(r,e){return r>e?1:r<e?-1:0}function ka(r,e,t){for(var n=new za(null,null),i=n,o=n;;){var c=t(r,e.key);if(c<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(c>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function Jp(r,e,t,n){var i=new za(r,e);if(t===null)return i.left=i.right=null,i;t=ka(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function J0(r,e,t){var n=null,i=null;if(e){e=ka(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function eC(r,e,t){return e===null?r:(r===null||(e=ka(r.key,e,t),e.left=r),e)}function wm(r,e,t,n,i){if(r){n(""+e+(t?" ":" ")+i(r)+`
`);var o=e+(t?"    ":"   ");r.left&&wm(r.left,o,!1,n,i),r.right&&wm(r.right,o,!0,n,i)}}var rg=function(){function r(e){e===void 0&&(e=Q5),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=Jp(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new za(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=ka(e,this._root,i),c=i(e,o.key);return c===0?this._root=o:(c<0?(n.left=o.left,n.right=o,o.left=null):c>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=ka(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=ka(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=ka(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=ka(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],c=this._comparator,a=this._root,d;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),d=c(a.key,t),d>0)break;if(c(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return nC(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&Sm(e,t,0,i-1,o),this._root===null)this._root=xm(e,t,0,i),this._size=i;else{var c=rC(this.toList(),tC(e,t),o);i=this._size+i,this._root=km({head:c},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return wm(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=J0(e,this._root,i),c=o.left,a=o.right;i(e,t)<0?a=Jp(t,n,a,i):c=Jp(t,n,c,i),this._root=eC(c,a,i)},r.prototype.split=function(e){return J0(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e,t,n;return Y5(this,function(i){switch(i.label){case 0:e=this._root,t=[],n=!1,i.label=1;case 1:return n?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return i.sent(),e=e.right,[3,5];case 4:n=!0,i.label=5;case 5:return[3,1];case 6:return[2]}})},r}();function xm(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),c=r[o],a=e[o],d=new za(c,a);return d.left=xm(r,e,t,o),d.right=xm(r,e,o+1,n),d}return null}function tC(r,e){for(var t=new za(null,null),n=t,i=0;i<r.length;i++)n=n.next=new za(r[i],e[i]);return n.next=null,t.next}function nC(r){for(var e=r,t=[],n=!1,i=new za(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function km(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=km(r,e,i),c=r.head;return c.left=o,r.head=r.head.next,c.right=km(r,i+1,t),c}return null}function rC(r,e,t){for(var n=new za(null,null),i=n,o=r,c=e;o!==null&&c!==null;)t(o.key,c.key)<0?(i.next=o,o=o.next):(i.next=c,c=c.next),i=i.next;return o!==null?i.next=o:c!==null&&(i.next=c),n.next}function Sm(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],c=t-1,a=n+1;;){do c++;while(i(r[c],o)<0);do a--;while(i(r[a],o)>0);if(c>=a)break;var d=r[c];r[c]=r[a],r[a]=d,d=e[c],e[c]=e[a],e[a]=d}Sm(r,e,t,a,i),Sm(r,e,a+1,n,i)}}const Ws=11102230246251565e-32,Vi=134217729,iC=(3+8*Ws)*Ws;function Yp(r,e,t,n,i){let o,c,a,d,p=e[0],y=n[0],_=0,w=0;y>p==y>-p?(o=p,p=e[++_]):(o=y,y=n[++w]);let T=0;if(_<r&&w<t)for(y>p==y>-p?(c=p+o,a=o-(c-p),p=e[++_]):(c=y+o,a=o-(c-y),y=n[++w]),o=c,a!==0&&(i[T++]=a);_<r&&w<t;)y>p==y>-p?(c=o+p,d=c-o,a=o-(c-d)+(p-d),p=e[++_]):(c=o+y,d=c-o,a=o-(c-d)+(y-d),y=n[++w]),o=c,a!==0&&(i[T++]=a);for(;_<r;)c=o+p,d=c-o,a=o-(c-d)+(p-d),p=e[++_],o=c,a!==0&&(i[T++]=a);for(;w<t;)c=o+y,d=c-o,a=o-(c-d)+(y-d),y=n[++w],o=c,a!==0&&(i[T++]=a);return(o!==0||T===0)&&(i[T++]=o),T}function oC(r,e){let t=e[0];for(let n=1;n<r;n++)t+=e[n];return t}function Eh(r){return new Float64Array(r)}const sC=(3+16*Ws)*Ws,aC=(2+12*Ws)*Ws,lC=(9+64*Ws)*Ws*Ws,Tc=Eh(4),Y0=Eh(8),Q0=Eh(12),ey=Eh(16),oo=Eh(4);function cC(r,e,t,n,i,o,c){let a,d,p,y,_,w,T,M,$,P,D,I,F,N,W,se,J,ee;const me=r-i,Ie=t-i,Q=e-o,ae=n-o;N=me*ae,w=Vi*me,T=w-(w-me),M=me-T,w=Vi*ae,$=w-(w-ae),P=ae-$,W=M*P-(N-T*$-M*$-T*P),se=Q*Ie,w=Vi*Q,T=w-(w-Q),M=Q-T,w=Vi*Ie,$=w-(w-Ie),P=Ie-$,J=M*P-(se-T*$-M*$-T*P),D=W-J,_=W-D,Tc[0]=W-(D+_)+(_-J),I=N+D,_=I-N,F=N-(I-_)+(D-_),D=F-se,_=F-D,Tc[1]=F-(D+_)+(_-se),ee=I+D,_=ee-I,Tc[2]=I-(ee-_)+(D-_),Tc[3]=ee;let Pe=oC(4,Tc),ve=aC*c;if(Pe>=ve||-Pe>=ve||(_=r-me,a=r-(me+_)+(_-i),_=t-Ie,p=t-(Ie+_)+(_-i),_=e-Q,d=e-(Q+_)+(_-o),_=n-ae,y=n-(ae+_)+(_-o),a===0&&d===0&&p===0&&y===0)||(ve=lC*c+iC*Math.abs(Pe),Pe+=me*y+ae*a-(Q*p+Ie*d),Pe>=ve||-Pe>=ve))return Pe;N=a*ae,w=Vi*a,T=w-(w-a),M=a-T,w=Vi*ae,$=w-(w-ae),P=ae-$,W=M*P-(N-T*$-M*$-T*P),se=d*Ie,w=Vi*d,T=w-(w-d),M=d-T,w=Vi*Ie,$=w-(w-Ie),P=Ie-$,J=M*P-(se-T*$-M*$-T*P),D=W-J,_=W-D,oo[0]=W-(D+_)+(_-J),I=N+D,_=I-N,F=N-(I-_)+(D-_),D=F-se,_=F-D,oo[1]=F-(D+_)+(_-se),ee=I+D,_=ee-I,oo[2]=I-(ee-_)+(D-_),oo[3]=ee;const tt=Yp(4,Tc,4,oo,Y0);N=me*y,w=Vi*me,T=w-(w-me),M=me-T,w=Vi*y,$=w-(w-y),P=y-$,W=M*P-(N-T*$-M*$-T*P),se=Q*p,w=Vi*Q,T=w-(w-Q),M=Q-T,w=Vi*p,$=w-(w-p),P=p-$,J=M*P-(se-T*$-M*$-T*P),D=W-J,_=W-D,oo[0]=W-(D+_)+(_-J),I=N+D,_=I-N,F=N-(I-_)+(D-_),D=F-se,_=F-D,oo[1]=F-(D+_)+(_-se),ee=I+D,_=ee-I,oo[2]=I-(ee-_)+(D-_),oo[3]=ee;const Ge=Yp(tt,Y0,4,oo,Q0);N=a*y,w=Vi*a,T=w-(w-a),M=a-T,w=Vi*y,$=w-(w-y),P=y-$,W=M*P-(N-T*$-M*$-T*P),se=d*p,w=Vi*d,T=w-(w-d),M=d-T,w=Vi*p,$=w-(w-p),P=p-$,J=M*P-(se-T*$-M*$-T*P),D=W-J,_=W-D,oo[0]=W-(D+_)+(_-J),I=N+D,_=I-N,F=N-(I-_)+(D-_),D=F-se,_=F-D,oo[1]=F-(D+_)+(_-se),ee=I+D,_=ee-I,oo[2]=I-(ee-_)+(D-_),oo[3]=ee;const Ee=Yp(Ge,Q0,4,oo,ey);return ey[Ee-1]}function uC(r,e,t,n,i,o){const c=(e-o)*(t-i),a=(r-i)*(n-o),d=c-a,p=Math.abs(c+a);return Math.abs(d)>=sC*p?d:-cC(r,e,t,n,i,o,p)}const Gu=(r,e)=>r.ll.x<=e.x&&e.x<=r.ur.x&&r.ll.y<=e.y&&e.y<=r.ur.y,Cm=(r,e)=>{if(e.ur.x<r.ll.x||r.ur.x<e.ll.x||e.ur.y<r.ll.y||r.ur.y<e.ll.y)return null;const t=r.ll.x<e.ll.x?e.ll.x:r.ll.x,n=r.ur.x<e.ur.x?r.ur.x:e.ur.x,i=r.ll.y<e.ll.y?e.ll.y:r.ll.y,o=r.ur.y<e.ur.y?r.ur.y:e.ur.y;return{ll:{x:t,y:i},ur:{x:n,y:o}}};let Ta=Number.EPSILON;Ta===void 0&&(Ta=Math.pow(2,-52));const hC=Ta*Ta,ty=(r,e)=>{if(-Ta<r&&r<Ta&&-Ta<e&&e<Ta)return 0;const t=r-e;return t*t<hC*r*e?0:r<e?-1:1};class fC{constructor(){this.reset()}reset(){this.xRounder=new ny,this.yRounder=new ny}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class ny{constructor(){this.tree=new rg,this.round(0)}round(e){const t=this.tree.add(e),n=this.tree.prev(t);if(n!==null&&ty(t.key,n.key)===0)return this.tree.remove(e),n.key;const i=this.tree.next(t);return i!==null&&ty(t.key,i.key)===0?(this.tree.remove(e),i.key):e}}const vh=new fC,nd=(r,e)=>r.x*e.y-r.y*e.x,Av=(r,e)=>r.x*e.x+r.y*e.y,ry=(r,e,t)=>{const n=uC(r.x,r.y,e.x,e.y,t.x,t.y);return n>0?-1:n<0?1:0},gd=r=>Math.sqrt(Av(r,r)),dC=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},i={x:t.x-r.x,y:t.y-r.y};return nd(i,n)/gd(i)/gd(n)},pC=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},i={x:t.x-r.x,y:t.y-r.y};return Av(i,n)/gd(i)/gd(n)},iy=(r,e,t)=>e.y===0?null:{x:r.x+e.x/e.y*(t-r.y),y:t},oy=(r,e,t)=>e.x===0?null:{x:t,y:r.y+e.y/e.x*(t-r.x)},mC=(r,e,t,n)=>{if(e.x===0)return oy(t,n,r.x);if(n.x===0)return oy(r,e,t.x);if(e.y===0)return iy(t,n,r.y);if(n.y===0)return iy(r,e,t.y);const i=nd(e,n);if(i==0)return null;const o={x:t.x-r.x,y:t.y-r.y},c=nd(o,e)/i,a=nd(o,n)/i,d=r.x+a*e.x,p=t.x+c*n.x,y=r.y+a*e.y,_=t.y+c*n.y,w=(d+p)/2,T=(y+_)/2;return{x:w,y:T}};class Xo{static compare(e,t){const n=Xo.comparePoints(e.point,t.point);return n!==0?n:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Ma.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let n=0,i=t.length;n<i;n++){const o=t[n];this.point.events.push(o),o.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const n=this.point.events[t];if(n.segment.consumedBy===void 0)for(let i=t+1;i<e;i++){const o=this.point.events[i];o.consumedBy===void 0&&n.otherSE.point.events===o.otherSE.point.events&&n.segment.consume(o.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,n=this.point.events.length;t<n;t++){const i=this.point.events[t];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&e.push(i)}return e}getLeftmostComparator(e){const t=new Map,n=i=>{const o=i.otherSE;t.set(i,{sine:dC(this.point,e.point,o.point),cosine:pC(this.point,e.point,o.point)})};return(i,o)=>{t.has(i)||n(i),t.has(o)||n(o);const{sine:c,cosine:a}=t.get(i),{sine:d,cosine:p}=t.get(o);return c>=0&&d>=0?a<p?1:a>p?-1:0:c<0&&d<0?a<p?-1:a>p?1:0:d<c?-1:d>c?1:0}}}let gC=0;class Ma{static compare(e,t){const n=e.leftSE.point.x,i=t.leftSE.point.x,o=e.rightSE.point.x,c=t.rightSE.point.x;if(c<n)return 1;if(o<i)return-1;const a=e.leftSE.point.y,d=t.leftSE.point.y,p=e.rightSE.point.y,y=t.rightSE.point.y;if(n<i){if(d<a&&d<p)return 1;if(d>a&&d>p)return-1;const _=e.comparePoint(t.leftSE.point);if(_<0)return 1;if(_>0)return-1;const w=t.comparePoint(e.rightSE.point);return w!==0?w:-1}if(n>i){if(a<d&&a<y)return-1;if(a>d&&a>y)return 1;const _=t.comparePoint(e.leftSE.point);if(_!==0)return _;const w=e.comparePoint(t.rightSE.point);return w<0?1:w>0?-1:1}if(a<d)return-1;if(a>d)return 1;if(o<c){const _=t.comparePoint(e.rightSE.point);if(_!==0)return _}if(o>c){const _=e.comparePoint(t.rightSE.point);if(_<0)return 1;if(_>0)return-1}if(o!==c){const _=p-a,w=o-n,T=y-d,M=c-i;if(_>w&&T<M)return 1;if(_<w&&T>M)return-1}return o>c?1:o<c||p<y?-1:p>y?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,n,i){this.id=++gC,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}static fromRing(e,t,n){let i,o,c;const a=Xo.comparePoints(e,t);if(a<0)i=e,o=t,c=1;else if(a>0)i=t,o=e,c=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const d=new Xo(i,!0),p=new Xo(o,!1);return new Ma(d,p,[n],[c])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,n=this.rightSE.point,i=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;const o=(e.y-t.y)/i.y,c=t.x+o*i.x;if(e.x===c)return 0;const a=(e.x-t.x)/i.x,d=t.y+a*i.y;return e.y===d?0:e.y<d?-1:1}getIntersection(e){const t=this.bbox(),n=e.bbox(),i=Cm(t,n);if(i===null)return null;const o=this.leftSE.point,c=this.rightSE.point,a=e.leftSE.point,d=e.rightSE.point,p=Gu(t,a)&&this.comparePoint(a)===0,y=Gu(n,o)&&e.comparePoint(o)===0,_=Gu(t,d)&&this.comparePoint(d)===0,w=Gu(n,c)&&e.comparePoint(c)===0;if(y&&p)return w&&!_?c:!w&&_?d:null;if(y)return _&&o.x===d.x&&o.y===d.y?null:o;if(p)return w&&c.x===a.x&&c.y===a.y?null:a;if(w&&_)return null;if(w)return c;if(_)return d;const T=mC(o,this.vector(),a,e.vector());return T===null||!Gu(i,T)?null:vh.round(T.x,T.y)}split(e){const t=[],n=e.events!==void 0,i=new Xo(e,!0),o=new Xo(e,!1),c=this.rightSE;this.replaceRightSE(o),t.push(o),t.push(i);const a=new Ma(i,c,this.rings.slice(),this.windings.slice());return Xo.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),Xo.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(i.checkForConsuming(),o.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}consume(e){let t=this,n=e;for(;t.consumedBy;)t=t.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const i=Ma.compare(t,n);if(i!==0){if(i>0){const o=t;t=n,n=o}if(t.prev===n){const o=t;t=n,n=o}for(let o=0,c=n.rings.length;o<c;o++){const a=n.rings[o],d=n.windings[o],p=t.rings.indexOf(a);p===-1?(t.rings.push(a),t.windings.push(d)):t.windings[p]+=d}n.rings=null,n.windings=null,n.consumedBy=t,n.leftSE.consumedBy=t.leftSE,n.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,n=this._afterState.windings,i=this._afterState.multiPolys;for(let a=0,d=this.rings.length;a<d;a++){const p=this.rings[a],y=this.windings[a],_=t.indexOf(p);_===-1?(t.push(p),n.push(y)):n[_]+=y}const o=[],c=[];for(let a=0,d=t.length;a<d;a++){if(n[a]===0)continue;const p=t[a],y=p.poly;if(c.indexOf(y)===-1)if(p.isExterior)o.push(y);else{c.indexOf(y)===-1&&c.push(y);const _=o.indexOf(p.poly);_!==-1&&o.splice(_,1)}}for(let a=0,d=o.length;a<d;a++){const p=o[a].multiPoly;i.indexOf(p)===-1&&i.push(p)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(hs.type){case"union":{const n=e.length===0,i=t.length===0;this._isInResult=n!==i;break}case"intersection":{let n,i;e.length<t.length?(n=e.length,i=t.length):(n=t.length,i=e.length),this._isInResult=i===hs.numMultiPolys&&n<i;break}case"xor":{const n=Math.abs(e.length-t.length);this._isInResult=n%2===1;break}case"difference":{const n=i=>i.length===1&&i[0].isSubject;this._isInResult=n(e)!==n(t);break}default:throw new Error(`Unrecognized operation type found ${hs.type}`)}return this._isInResult}}class sy{constructor(e,t,n){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=vh.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let o=i;for(let c=1,a=e.length;c<a;c++){if(typeof e[c][0]!="number"||typeof e[c][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let d=vh.round(e[c][0],e[c][1]);d.x===o.x&&d.y===o.y||(this.segments.push(Ma.fromRing(o,d,this)),d.x<this.bbox.ll.x&&(this.bbox.ll.x=d.x),d.y<this.bbox.ll.y&&(this.bbox.ll.y=d.y),d.x>this.bbox.ur.x&&(this.bbox.ur.x=d.x),d.y>this.bbox.ur.y&&(this.bbox.ur.y=d.y),o=d)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(Ma.fromRing(o,i,this))}getSweepEvents(){const e=[];for(let t=0,n=this.segments.length;t<n;t++){const i=this.segments[t];e.push(i.leftSE),e.push(i.rightSE)}return e}}class _C{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new sy(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,i=e.length;n<i;n++){const o=new sy(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,n=this.interiorRings.length;t<n;t++){const i=this.interiorRings[t].getSweepEvents();for(let o=0,c=i.length;o<c;o++)e.push(i[o])}return e}}class ay{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let n=0,i=e.length;n<i;n++){const o=new _C(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const i=this.polys[t].getSweepEvents();for(let o=0,c=i.length;o<c;o++)e.push(i[o])}return e}}class _d{static factory(e){const t=[];for(let n=0,i=e.length;n<i;n++){const o=e[n];if(!o.isInResult()||o.ringOut)continue;let c=null,a=o.leftSE,d=o.rightSE;const p=[a],y=a.point,_=[];for(;c=a,a=d,p.push(a),a.point!==y;)for(;;){const w=a.getAvailableLinkedEvents();if(w.length===0){const $=p[0].point,P=p[p.length-1].point;throw new Error(`Unable to complete output ring starting at [${$.x}, ${$.y}]. Last matching segment found ends at [${P.x}, ${P.y}].`)}if(w.length===1){d=w[0].otherSE;break}let T=null;for(let $=0,P=_.length;$<P;$++)if(_[$].point===a.point){T=$;break}if(T!==null){const $=_.splice(T)[0],P=p.splice($.index);P.unshift(P[0].otherSE),t.push(new _d(P.reverse()));continue}_.push({index:p.length,point:a.point});const M=a.getLeftmostComparator(c);d=w.sort(M)[0].otherSE;break}t.push(new _d(p))}return t}constructor(e){this.events=e;for(let t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let p=1,y=this.events.length-1;p<y;p++){const _=this.events[p].point,w=this.events[p+1].point;ry(_,e,w)!==0&&(t.push(_),e=_)}if(t.length===1)return null;const n=t[0],i=t[1];ry(n,e,i)===0&&t.shift(),t.push(t[0]);const o=this.isExteriorRing()?1:-1,c=this.isExteriorRing()?0:t.length-1,a=this.isExteriorRing()?t.length:-1,d=[];for(let p=c;p!=a;p+=o)d.push([t[p].x,t[p].y]);return d}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let i=1,o=this.events.length;i<o;i++){const c=this.events[i];Xo.compare(e,c)>0&&(e=c)}let t=e.segment.prevInResult(),n=t?t.prevInResult():null;for(;;){if(!t)return null;if(!n)return t.ringOut;if(n.ringOut!==t.ringOut)return n.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=n.prevInResult(),n=t?t.prevInResult():null}}}class ly{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,n=this.interiorRings.length;t<n;t++){const i=this.interiorRings[t].getGeom();i!==null&&e.push(i)}return e}}class yC{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const i=this.polys[t].getGeom();i!==null&&e.push(i)}return e}_composePolys(e){const t=[];for(let n=0,i=e.length;n<i;n++){const o=e[n];if(!o.poly)if(o.isExteriorRing())t.push(new ly(o));else{const c=o.enclosingRing();c.poly||t.push(new ly(c)),c.poly.addInterior(o)}}return t}}class bC{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ma.compare;this.queue=e,this.tree=new rg(t),this.segments=[]}process(e){const t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;const i=e.isLeft?this.tree.add(t):this.tree.find(t);if(!i)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let o=i,c=i,a,d;for(;a===void 0;)o=this.tree.prev(o),o===null?a=null:o.key.consumedBy===void 0&&(a=o.key);for(;d===void 0;)c=this.tree.next(c),c===null?d=null:c.key.consumedBy===void 0&&(d=c.key);if(e.isLeft){let p=null;if(a){const _=a.getIntersection(t);if(_!==null&&(t.isAnEndpoint(_)||(p=_),!a.isAnEndpoint(_))){const w=this._splitSafely(a,_);for(let T=0,M=w.length;T<M;T++)n.push(w[T])}}let y=null;if(d){const _=d.getIntersection(t);if(_!==null&&(t.isAnEndpoint(_)||(y=_),!d.isAnEndpoint(_))){const w=this._splitSafely(d,_);for(let T=0,M=w.length;T<M;T++)n.push(w[T])}}if(p!==null||y!==null){let _=null;p===null?_=y:y===null?_=p:_=Xo.comparePoints(p,y)<=0?p:y,this.queue.remove(t.rightSE),n.push(t.rightSE);const w=t.split(_);for(let T=0,M=w.length;T<M;T++)n.push(w[T])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&d){const p=a.getIntersection(d);if(p!==null){if(!a.isAnEndpoint(p)){const y=this._splitSafely(a,p);for(let _=0,w=y.length;_<w;_++)n.push(y[_])}if(!d.isAnEndpoint(p)){const y=this._splitSafely(d,p);for(let _=0,w=y.length;_<w;_++)n.push(y[_])}}}this.tree.remove(t)}return n}_splitSafely(e,t){this.tree.remove(e);const n=e.rightSE;this.queue.remove(n);const i=e.split(t);return i.push(n),e.consumedBy===void 0&&this.tree.add(e),i}}const cy=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,vC=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class wC{run(e,t,n){hs.type=e,vh.reset();const i=[new ay(t,!0)];for(let y=0,_=n.length;y<_;y++)i.push(new ay(n[y],!1));if(hs.numMultiPolys=i.length,hs.type==="difference"){const y=i[0];let _=1;for(;_<i.length;)Cm(i[_].bbox,y.bbox)!==null?_++:i.splice(_,1)}if(hs.type==="intersection")for(let y=0,_=i.length;y<_;y++){const w=i[y];for(let T=y+1,M=i.length;T<M;T++)if(Cm(w.bbox,i[T].bbox)===null)return[]}const o=new rg(Xo.compare);for(let y=0,_=i.length;y<_;y++){const w=i[y].getSweepEvents();for(let T=0,M=w.length;T<M;T++)if(o.insert(w[T]),o.size>cy)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const c=new bC(o);let a=o.size,d=o.pop();for(;d;){const y=d.key;if(o.size===a){const w=y.segment;throw new Error(`Unable to pop() ${y.isLeft?"left":"right"} SweepEvent [${y.point.x}, ${y.point.y}] from segment #${w.id} [${w.leftSE.point.x}, ${w.leftSE.point.y}] -> [${w.rightSE.point.x}, ${w.rightSE.point.y}] from queue.`)}if(o.size>cy)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(c.segments.length>vC)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const _=c.process(y);for(let w=0,T=_.length;w<T;w++){const M=_[w];M.consumedBy===void 0&&o.insert(M)}a=o.size,d=o.pop()}vh.reset();const p=_d.factory(c.segments);return new yC(p).getGeom()}}const hs=new wC,xC=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return hs.run("union",r,t)},kC=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return hs.run("intersection",r,t)},SC=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return hs.run("xor",r,t)},CC=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return hs.run("difference",r,t)};var Pv={union:xC,intersection:kC,xor:SC,difference:CC};function zv(r,e,t){if(r!==null)for(var n,i,o,c,a,d,p,y=0,_=0,w,T=r.type,M=T==="FeatureCollection",$=T==="Feature",P=M?r.features.length:1,D=0;D<P;D++){p=M?r.features[D].geometry:$?r.geometry:r,w=p?p.type==="GeometryCollection":!1,a=w?p.geometries.length:1;for(var I=0;I<a;I++){var F=0,N=0;if(c=w?p.geometries[I]:p,c!==null){d=c.coordinates;var W=c.type;switch(y=0,W){case null:break;case"Point":if(e(d,_,D,F,N)===!1)return!1;_++,F++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],_,D,F,N)===!1)return!1;_++,W==="MultiPoint"&&F++}W==="LineString"&&F++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-y;i++){if(e(d[n][i],_,D,F,N)===!1)return!1;_++}W==="MultiLineString"&&F++,W==="Polygon"&&N++}W==="Polygon"&&F++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(N=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-y;o++){if(e(d[n][i][o],_,D,F,N)===!1)return!1;_++}N++}F++}break;case"GeometryCollection":for(n=0;n<c.geometries.length;n++)if(zv(c.geometries[n],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ig(r,e){var t,n,i,o,c,a,d,p,y,_,w=0,T=r.type==="FeatureCollection",M=r.type==="Feature",$=T?r.features.length:1;for(t=0;t<$;t++){for(a=T?r.features[t].geometry:M?r.geometry:r,p=T?r.features[t].properties:M?r.properties:{},y=T?r.features[t].bbox:M?r.bbox:void 0,_=T?r.features[t].id:M?r.id:void 0,d=a?a.type==="GeometryCollection":!1,c=d?a.geometries.length:1,i=0;i<c;i++){if(o=d?a.geometries[i]:a,o===null){if(e(null,w,p,y,_)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,w,p,y,_)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],w,p,y,_)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}w++}}function TC(r,e){ig(r,function(t,n,i,o,c){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(yh(t,i,{bbox:o,id:c}),n,0)===!1?!1:void 0}var d;switch(a){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var y=t.coordinates[p],_={type:d,coordinates:y};if(e(yh(_,i),n,p)===!1)return!1}})}function MC(r,e={}){const t=[];if(ig(r,i=>{t.push(i.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const n=Pv.union(t[0],...t.slice(1));return n.length===0?null:n.length===1?ng(n[0],e.properties):Iv(n,e.properties)}var Dv=MC;function LC(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return zv(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var uy=LC;function EC(r){const e=[];if(ig(r,i=>{e.push(i.coordinates)}),e.length<2)throw new Error("Must have at least two features");const t=r.features[0].properties||{},n=Pv.difference(e[0],...e.slice(1));return n.length===0?null:n.length===1?ng(n[0],t):Iv(n,t)}var IC=EC;function AC(r){if(!r)throw new Error("geojson is required");var e=[];return TC(r,function(t){e.push(t)}),bh(e)}var PC=AC;function hy(r,e){const t=IC(bh([ng([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),r]));if(!t)return;t.properties={isMask:!0};const n=md(uy(r)),i=(n[2]-n[0])/360/1e3,o=n[0]<-180,c=n[2]>180,a=PC(r);if(a.features.length>1&&(o||c))for(const d of a.features){const p=md(uy(d));if(c&&p[0]<-180+i)for(const y of d.geometry.coordinates)for(const _ of y)_[0]+=360-i;if(o&&p[2]>180-i)for(const y of d.geometry.coordinates)for(const _ of y)_[0]-=360-i}e(bh([a.features.length<2?r:Dv(a)??r,t]))}const fy={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},Vf="mtlr-gc-full-geom",dy="mtlr-gc-full-geom-fill",py="mtlr-gc-full-geom-line";function $v(r,e,t=!0,n=!0,i={},o={},c=fy){let a;const d=[];let p,y,_;function w(){if(!r.loaded){r.once("load",w);return}const P=c?c===!0?fy:c:void 0;if(!(P!=null&&P.fill)&&!(P!=null&&P.line))return;const D=r.getSource(Vf);if(D)D.setData(_??bh([]));else if(_)r.addSource(Vf,{type:"geojson",data:_});else return;!r.getLayer(dy)&&P!=null&&P.fill&&r.addLayer({...P==null?void 0:P.fill,id:dy,type:"fill",source:Vf}),!r.getLayer(py)&&P!=null&&P.line&&r.addLayer({...P==null?void 0:P.line,id:py,type:"line",source:Vf})}function T(P){_=P,w()}r.on("styledata",()=>{setTimeout(()=>{_&&w()})});const M=P=>{a==null||a({type:"mapClick",coordinates:[P.lngLat.lng,P.lngLat.lat]})};function $(P=!1){if(!e)throw new Error;const D=document.createElement("div");return P&&D.classList.add("marker-interactive"),new M5({props:{displayIn:"maplibre"},target:D}),new e.Marker({element:D,offset:[1,-13]})}return{setEventHandler(P){P?(a=P,r.on("click",M)):(a=void 0,r.off("click",M))},flyTo(P,D){r.flyTo({center:P,...D?{zoom:D}:{},...i})},fitBounds(P,D,I){r.fitBounds([[P[0],P[1]],[P[2],P[3]]],{padding:D,...I?{maxZoom:I}:{},...o})},indicateReverse(P){r.getCanvasContainer().style.cursor=P?"crosshair":""},setReverseMarker(P){!e||!t||(y?P?y.setLngLat(P):(y.remove(),y=void 0):P&&(t instanceof Function?y=t(r)??void 0:(y=(typeof t=="object"?new e.Marker(t):$()).setLngLat(P).addTo(r),y.getElement().classList.add("marker-reverse"))))},setFeatures(P,D,I){for(const F of d)F.remove();if(d.length=0,T(void 0),!!e){if(D){let F=!1;if(D.geometry.type==="GeometryCollection"){const N=D.geometry.geometries.filter(W=>W.type==="Polygon"||W.type==="MultiPolygon");e:if(N.length>0){const W=Dv(bh(N.map(se=>yh(se))));if(!W)break e;hy({...D,geometry:W.geometry},T),F=!0}else{const W=D.geometry.geometries.filter(se=>se.type==="LineString"||se.type==="MultiLineString");W.length>0&&(T({...D,geometry:{type:"GeometryCollection",geometries:W}}),F=!0)}}if(!F){if(D.geometry.type==="Polygon"||D.geometry.type==="MultiPolygon")hy(D,T);else if(D.geometry.type==="LineString"||D.geometry.type==="MultiLineString"){T(D);return}}if(!I&&D.geometry.type!=="Point")return;if(t instanceof Function){const N=t(r,D);N&&d.push(N)}else t&&d.push(typeof t=="object"?new e.Marker(t):$().setLngLat(D.center).addTo(r))}if(n)for(const F of P??[]){if(F===D)continue;let N;if(n instanceof Function){if(N=n(r,F),!N)continue}else N=(typeof n=="object"?new e.Marker(n):$(!0)).setLngLat(F.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(F.place_type[0]==="reverse"?F.place_name:F.place_name.replace(/,.*/,""))).addTo(r);const W=N.getElement();W.addEventListener("click",se=>{se.stopPropagation(),a==null||a({type:"markerClick",id:F.id})}),W.addEventListener("mouseenter",()=>{a==null||a({type:"markerMouseEnter",id:F.id}),N.togglePopup()}),W.addEventListener("mouseleave",()=>{a==null||a({type:"markerMouseLeave",id:F.id}),N.togglePopup()}),d.push(N)}}},setSelectedMarker(P){p&&p.getElement().classList.toggle("marker-selected",!1),p=P>-1?d[P]:void 0,p==null||p.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const P=r.getCenter();return[r.getZoom(),P.lng,P.lat]}}}function zC(r,e,t){var n,i;class o{constructor(P,D){Eo(this,"type"),Eo(this,"target"),this.type=D,this.target=P}}class c extends o{constructor(P,D){super(P,"select"),Eo(this,"feature"),Object.assign(this,D)}}class a extends o{constructor(P,D){super(P,"featureslisted"),Eo(this,"features"),this.features=D}}class d extends o{constructor(P,D){super(P,"featuresmarked"),Eo(this,"features"),this.features=D}}class p extends o{constructor(P,D){super(P,"optionsvisibilitychange"),Eo(this,"optionsVisible"),this.optionsVisible=D}}class y extends o{constructor(P,D){super(P,"pick"),Eo(this,"feature"),this.feature=D}}class _ extends o{constructor(P,D){super(P,"querychange"),Eo(this,"query"),this.query=D}}class w extends o{constructor(P,D,I){super(P,"response"),Eo(this,"url"),Eo(this,"featureCollection"),this.url=D,this.featureCollection=I}}class T extends o{constructor(P,D){super(P,"reversetoggle"),Eo(this,"reverse"),this.reverse=D}}class M extends r{constructor(P={}){super(),A0(this,n),A0(this,i),P0(this,i,P)}onAddInt(P){const D=document.createElement("div");D.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:I,showResultMarkers:F,flyTo:N,fullGeometryStyle:W,...se}=_i(this,i),J=typeof N=="boolean"?{}:N,ee={mapController:$v(P,e,I,F,J,J,W),flyTo:N===void 0?!0:!!N,apiKey:"",...t==null?void 0:t(P,D),...se};if(!ee.apiKey)throw new Error("no apiKey provided");return P0(this,n,new J5({target:D,props:ee})),_i(this,n).$on("select",me=>{this.fire(new c(this,me.detail))}),_i(this,n).$on("pick",me=>{this.fire(new y(this,me.detail.feature))}),_i(this,n).$on("featureslisted",me=>{this.fire(new a(this,me.detail.features))}),_i(this,n).$on("featuresmarked",me=>{this.fire(new d(this,me.detail.features))}),_i(this,n).$on("response",me=>{this.fire(new w(this,me.detail.url,me.detail.featureCollection))}),_i(this,n).$on("optionsvisibilitychange",me=>{this.fire(new p(this,me.detail.optionsVisible))}),_i(this,n).$on("reversetoggle",me=>{this.fire(new T(this,me.detail.reverse))}),_i(this,n).$on("querychange",me=>{this.fire(new _(this,me.detail.query))}),D}on(P,D){return super.on(P,D)}once(P,D){return super.once(P,D)}off(P,D){return super.off(P,D)}listens(P){return super.listens(P)}setOptions(P){var D;Object.assign(_i(this,i),P);const{marker:I,showResultMarkers:F,flyTo:N,fullGeometryStyle:W,...se}=_i(this,i);(D=_i(this,n))==null||D.$set(se)}setQuery(P,D=!0){var I;(I=_i(this,n))==null||I.setQuery(P,D)}clearMap(){var P;(P=_i(this,n))==null||P.clearMap()}clearList(){var P;(P=_i(this,n))==null||P.clearList()}setReverseMode(P){var D;(D=_i(this,n))==null||D.$set({reverseActive:P})}focus(){var P;(P=_i(this,n))==null||P.focus()}blur(){var P;(P=_i(this,n))==null||P.blur()}onRemove(){var P;(P=_i(this,n))==null||P.$destroy()}}return n=new WeakMap,i=new WeakMap,{MapLibreBasedGeocodingControl:M,events:{SelectEvent:c,FeaturesListedEvent:a,FeaturesMarkedEvent:d,OptionsVisibilityChangeEvent:p,PickEvent:y,QueryChangeEvent:_,ResponseEvent:w,ReverseToggleEvent:T}}}const{MapLibreBasedGeocodingControl:Zz,events:Ba}=zC(Ks.Evented,gx);Ba.SelectEvent;Ba.FeaturesListedEvent;Ba.FeaturesMarkedEvent;Ba.OptionsVisibilityChangeEvent;Ba.PickEvent;Ba.QueryChangeEvent;Ba.ResponseEvent;Ba.ReverseToggleEvent;function DC(r){let e,t;return{c(){e=ds("svg"),t=ds("path"),de(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),de(e,"viewBox","0 0 14 14"),de(e,"width","13"),de(e,"height","13"),de(e,"class","svelte-en2qvf")},m(n,i){q(n,e,i),R(e,t)},p:et,i:et,o:et,d(n){n&&V(e)}}}class Rv extends Lt{constructor(e){super(),Mt(this,e,null,DC,vt,{})}}function $C(r){let e,t;return{c(){e=ds("svg"),t=ds("path"),de(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),de(e,"viewBox","0 0 30 30"),de(e,"fill","none"),de(e,"xmlns","http://www.w3.org/2000/svg"),de(e,"class","svelte-d2loi5")},m(n,i){q(n,e,i),R(e,t)},p:et,i:et,o:et,d(n){n&&V(e)}}}class Fv extends Lt{constructor(e){super(),Mt(this,e,null,$C,vt,{})}}function RC(r){let e,t;return{c(){e=U("img"),fr(e.src,t=r[3]+"area.svg")||de(e,"src",t),de(e,"alt",r[6]),de(e,"class","svelte-ltkwvy")},m(n,i){q(n,e,i)},p(n,i){i&8&&!fr(e.src,t=n[3]+"area.svg")&&de(e,"src",t),i&64&&de(e,"alt",n[6])},d(n){n&&V(e)}}}function FC(r){let e,t;return{c(){e=U("img"),fr(e.src,t=r[3]+"reverse.svg")||de(e,"src",t),de(e,"alt",r[6]),de(e,"class","svelte-ltkwvy")},m(n,i){q(n,e,i)},p(n,i){i&8&&!fr(e.src,t=n[3]+"reverse.svg")&&de(e,"src",t),i&64&&de(e,"alt",n[6])},d(n){n&&V(e)}}}function BC(r){let e,t;return{c(){e=U("img"),fr(e.src,t=r[3]+"poi.svg")||de(e,"src",t),de(e,"alt",r[6]),de(e,"class","svelte-ltkwvy")},m(n,i){q(n,e,i)},p(n,i){i&8&&!fr(e.src,t=n[3]+"poi.svg")&&de(e,"src",t),i&64&&de(e,"alt",n[6])},d(n){n&&V(e)}}}function OC(r){let e,t;return{c(){e=U("img"),fr(e.src,t=r[3]+"postal_code.svg")||de(e,"src",t),de(e,"alt",r[6]),de(e,"class","svelte-ltkwvy")},m(n,i){q(n,e,i)},p(n,i){i&8&&!fr(e.src,t=n[3]+"postal_code.svg")&&de(e,"src",t),i&64&&de(e,"alt",n[6])},d(n){n&&V(e)}}}function NC(r){let e,t;return{c(){e=U("img"),fr(e.src,t=r[3]+"street.svg")||de(e,"src",t),de(e,"alt",r[6]),de(e,"class","svelte-ltkwvy")},m(n,i){q(n,e,i)},p(n,i){i&8&&!fr(e.src,t=n[3]+"street.svg")&&de(e,"src",t),i&64&&de(e,"alt",n[6])},d(n){n&&V(e)}}}function jC(r){let e,t;return{c(){e=U("img"),fr(e.src,t=r[3]+"road.svg")||de(e,"src",t),de(e,"alt",r[6]),de(e,"class","svelte-ltkwvy")},m(n,i){q(n,e,i)},p(n,i){i&8&&!fr(e.src,t=n[3]+"road.svg")&&de(e,"src",t),i&64&&de(e,"alt",n[6])},d(n){n&&V(e)}}}function UC(r){let e,t;return{c(){e=U("img"),fr(e.src,t=r[3]+"housenumber.svg")||de(e,"src",t),de(e,"alt",r[6]),de(e,"class","svelte-ltkwvy")},m(n,i){q(n,e,i)},p(n,i){i&8&&!fr(e.src,t=n[3]+"housenumber.svg")&&de(e,"src",t),i&64&&de(e,"alt",n[6])},d(n){n&&V(e)}}}function VC(r){let e,t,n,i;return{c(){e=U("img"),fr(e.src,t=r[5])||de(e,"src",t),de(e,"alt",r[4]),de(e,"class","svelte-ltkwvy")},m(o,c){q(o,e,c),n||(i=wt(e,"error",r[14]),n=!0)},p(o,c){c&32&&!fr(e.src,t=o[5])&&de(e,"src",t),c&16&&de(e,"alt",o[4])},d(o){o&&V(e),n=!1,i()}}}function my(r){let e,t;return{c(){e=U("span"),t=xe(r[6]),de(e,"class","secondary svelte-ltkwvy")},m(n,i){q(n,e,i),R(e,t)},p(n,i){i&64&&Tt(t,n[6])},d(n){n&&V(e)}}}function qC(r){let e,t,n,i,o,c,a,d,p,y=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",_,w,T=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],M,$,P=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",D,I,F;function N(ee,me){return me&1&&(t=null),me&1&&(n=null),me&1&&(i=null),me&1&&(o=null),ee[5]?VC:ee[0].address?UC:(t==null&&(t=!!ee[0].id.startsWith("road.")),t?jC:(n==null&&(n=!!ee[0].id.startsWith("address.")),n?NC:(i==null&&(i=!!ee[0].id.startsWith("postal_code.")),i?OC:(o==null&&(o=!!ee[0].id.startsWith("poi.")),o?BC:ee[7]?FC:RC))))}let W=N(r,-1),se=W(r),J=T&&my(r);return{c(){e=U("li"),se.c(),c=oe(),a=U("span"),d=U("span"),p=U("span"),_=xe(y),w=oe(),J&&J.c(),M=oe(),$=U("span"),D=xe(P),de(p,"class","primary svelte-ltkwvy"),de(d,"class","svelte-ltkwvy"),de($,"class","line2 svelte-ltkwvy"),de(a,"class","texts svelte-ltkwvy"),de(e,"tabindex","0"),de(e,"data-selected",r[1]),de(e,"class","svelte-ltkwvy"),Qt(e,"selected",r[1])},m(ee,me){q(ee,e,me),se.m(e,null),R(e,c),R(e,a),R(a,d),R(d,p),R(p,_),R(d,w),J&&J.m(d,null),R(a,M),R(a,$),R($,D),I||(F=[wt(e,"mouseenter",r[12]),wt(e,"focus",r[13])],I=!0)},p(ee,[me]){W===(W=N(ee,me))&&se?se.p(ee,me):(se.d(1),se=W(ee),se&&(se.c(),se.m(e,c))),me&1&&y!==(y=(ee[7]?ee[0].place_name:ee[0].place_name.replace(/,.*/,""))+"")&&Tt(_,y),me&37&&(T=ee[2]==="always"||ee[2]!=="never"&&!ee[0].address&&!ee[0].id.startsWith("road.")&&!ee[0].id.startsWith("address.")&&!ee[0].id.startsWith("postal_code.")&&(!ee[0].id.startsWith("poi.")||!ee[5])&&!ee[7]),T?J?J.p(ee,me):(J=my(ee),J.c(),J.m(d,null)):J&&(J.d(1),J=null),me&1&&P!==(P=(ee[7]?"":ee[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Tt(D,P),me&2&&de(e,"data-selected",ee[1]),me&2&&Qt(e,"selected",ee[1])},i:et,o:et,d(ee){ee&&V(e),se.d(),J&&J.d(),I=!1,pr(F)}}}function ZC(r,e,t){var F;let n,i,{feature:o}=e,{selected:c=!1}=e,{showPlaceType:a}=e,{missingIconsCache:d}=e,{iconsBaseUrl:p}=e;const y=(F=o.properties)==null?void 0:F.categories;let _,w,T=0,M=o.place_type[0]==="reverse";function $(){w&&d.add(w),t(10,T++,T)}function P(N){zn.call(this,r,N)}function D(N){zn.call(this,r,N)}const I=()=>$();return r.$$set=N=>{"feature"in N&&t(0,o=N.feature),"selected"in N&&t(1,c=N.selected),"showPlaceType"in N&&t(2,a=N.showPlaceType),"missingIconsCache"in N&&t(9,d=N.missingIconsCache),"iconsBaseUrl"in N&&t(3,p=N.iconsBaseUrl)},r.$$.update=()=>{var N,W,se,J;if(r.$$.dirty&3640)do t(11,n--,n),t(4,_=y==null?void 0:y[n]),t(5,w=_?p+_.replace(/ /g,"_")+".svg":void 0);while(n>-1&&(!w||d.has(w)));r.$$.dirty&1&&t(6,i=((W=(N=o.properties)==null?void 0:N.categories)==null?void 0:W.join(", "))??((J=(se=o.properties)==null?void 0:se.place_type_name)==null?void 0:J[0])??o.place_type[0])},t(11,n=(y==null?void 0:y.length)??0),[o,c,a,p,_,w,i,M,$,d,T,n,P,D,I]}class GC extends Lt{constructor(e){super(),Mt(this,e,ZC,qC,vt,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function HC(r){let e;return{c(){e=U("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',de(e,"class","svelte-7cmwmc")},m(t,n){q(t,e,n)},p:et,i:et,o:et,d(t){t&&V(e)}}}class WC extends Lt{constructor(e){super(),Mt(this,e,null,HC,vt,{})}}function KC(r){let e,t;return{c(){e=ds("svg"),t=ds("path"),de(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),de(e,"viewBox","0 0 60.006 21.412"),de(e,"width","14"),de(e,"height","20"),de(e,"class","svelte-en2qvf")},m(n,i){q(n,e,i),R(e,t)},p:et,i:et,o:et,d(n){n&&V(e)}}}class XC extends Lt{constructor(e){super(),Mt(this,e,null,KC,vt,{})}}function JC(r){let e,t,n;return{c(){e=ds("svg"),t=ds("circle"),n=ds("path"),de(t,"cx","4.789"),de(t,"cy","4.787"),de(t,"r","3.85"),de(t,"class","svelte-1aq105l"),de(n,"d","M12.063 12.063 7.635 7.635"),de(n,"class","svelte-1aq105l"),de(e,"xmlns","http://www.w3.org/2000/svg"),de(e,"width","13"),de(e,"height","13"),de(e,"viewBox","0 0 13 13"),de(e,"class","svelte-1aq105l")},m(i,o){q(i,e,o),R(e,t),R(e,n)},p:et,i:et,o:et,d(i){i&&V(e)}}}class YC extends Lt{constructor(e){super(),Mt(this,e,null,JC,vt,{})}}function QC(r,e,t){const n=e[1],i=e[0],o=n-i;return r===n&&t?r:((r-i)%o+o)%o+i}function gy(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let Hu;async function eT(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const i of e??[])if(!(n&&(i.minZoom!=null&&i.minZoom>n[0]||i.maxZoom!=null&&i.maxZoom<n[0]))){if(i.type==="fixed")return i.coordinates.join(",");e:if(i.type==="client-geolocation"){if(Hu&&i.cachedLocationExpiry&&Hu.time+i.cachedLocationExpiry>Date.now()){if(!Hu.coords)break e;return Hu.coords}let o;try{return o=await new Promise((c,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(d=>{c([d.coords.longitude,d.coords.latitude].map(p=>p.toFixed(6)).join(","))},d=>{a(d)},i)}),o}catch{}finally{i.cachedLocationExpiry&&(Hu={time:Date.now(),coords:o})}if(t.signal.aborted)return}if(i.type==="server-geolocation")return"ip";if(n&&i.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const tT=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,_y=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,yy=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,by=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,vy=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,wy=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function nT(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(T=>Number(T.trim())),t=Number(e[0]),n=Number(e[1]),i=Math.abs(t),o=Math.abs(n),c=t>0?"N":"S",a=n>0?"E":"W";let d;r=="DD"&&(d=`${i} ${c}, ${o} ${a}`);const p=Math.floor(i),y=Math.floor(o),_=(i-p)*60,w=(o-y)*60;if(r=="DM"){let T=xy(_,3).toFixed(3).padStart(6,"0"),M=xy(w,3).toFixed(3).padStart(6,"0");T.endsWith(".000")&&M.endsWith(".000")&&(T=T.replace(/\.000$/,""),M=M.replace(/\.000$/,"")),d=`${p} ${T}' ${c}, ${y} ${M}' ${a}`}if(r=="DMS"){const T=Math.floor(_),M=Math.floor(w);let $=((_-T)*60).toFixed(1).padStart(4,"0"),P=((w-M)*60).toFixed(1).padStart(4,"0");const D=T.toString().padStart(2,"0"),I=M.toString().padStart(2,"0");$.endsWith(".0")&&P.endsWith(".0")&&($=$.replace(/\.0$/,""),P=P.replace(/\.0$/,"")),d=`${p} ${D}' ${$}" ${c}, ${y} ${I}' ${P}" ${a}`}return d}else throw new Error("no decimal coordinates to convert")}function xy(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function og(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,n=null,i="",o="",c=null,a=[],d=!1;if(tT.test(r))throw new Error("invalid coordinate value");if(_y.test(r))if(a=_y.exec(r),d=Wu(a),d)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),n=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(n*=-1),c="DM";else throw new Error("invalid coordinate format");else if(yy.test(r))if(a=yy.exec(r),d=Wu(a),d){if(t=a[2],n=a[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),c="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");a[1]?(i=a[1],o=a[5]):a[4]&&(i=a[4],o=a[8])}else throw new Error("invalid decimal coordinate format");else if(by.test(r))if(a=by.exec(r),d=Wu(a),d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,c="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,c="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[9])),a[11]&&(n+=a[11]/60),a[13]&&(n+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(n=-1*n),a[1]?(i=a[1],o=a[8]):a[7]&&(i=a[7],o=a[14]);else throw new Error("invalid DMS coordinates format");else if(vy.test(r))if(a=vy.exec(r),d=Wu(a),d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,c="DM"),a[6]&&(t+=a[6]/3600,c="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12]/60),a[14]&&(n+=a[14]/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(i=a[1],o=a[9]):a[8]&&(i=a[8],o=a[16]);else throw new Error("invalid DMS coordinates format");else if(wy.test(r)){if(a=wy.exec(r),d=Wu(a),a.filter(p=>p).length<=5)throw new Error("invalid coordinates format");if(d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,c="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,c="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12].replace(",",".")/60),a[14]&&(n+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(i=a[1],o=a[9]):a[8]&&(i=a[8],o=a[16]);else throw new Error("invalid coordinates format")}if(d){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(i&&!o||!i&&o)throw new Error("invalid coordinates value");if(i&&i==o)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let p=/S|SOUTH/i;p.test(i)&&t>0&&(t=-1*t),p=/W|WEST/i,p.test(o)&&n>0&&(n=-1*n);const y=a[0].trim();let _,w;const T=/[,/;\u0020]/g,M=y.match(T);if(M==null){const D=Math.floor(r.length/2);_=y.substring(0,D).trim(),w=y.substring(D).trim()}else{let D;M.length%2==1?D=Math.floor(M.length/2):D=M.length/2-1;let I=0;if(D==0)I=y.indexOf(M[0]),_=y.substring(0,I).trim(),w=y.substring(I+1).trim();else{let F=0,N=0;for(;F<=D;)I=y.indexOf(M[F],N),N=I+1,F++;_=y.substring(0,I).trim(),w=y.substring(I+1).trim()}}const $=_.split(".");if($.length==2&&$[1]==0&&$[1].length!=2)throw new Error("invalid coordinates format");const P=w.split(".");if(P.length==2&&P[1]==0&&P[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(_)||/^\d+$/.test(w))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:y,verbatimLatitude:_,verbatimLongitude:w,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:c,closeEnough:rT,toCoordinateFormat:nT})}else throw new Error("coordinates pattern match failed")}function Wu(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,i=e.length/2;for(let o=0;o<i;o++){const c=e[o],a=e[o+i],d=t.test(c)&&t.test(a),p=n.test(c)&&n.test(a),y=c==a;if(!(c==null&&a==null)){if(c==null||a==null)return!1;if(d||p||y)continue;return!1}}return!0}function ky(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function rT(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return ky(this.decimalLatitude,Number(e[0]))&&ky(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const iT=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});og.to=iT;const oT=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],sT={decimalLatitude:40.123,decimalLongitude:-74.123},aT=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],lT=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function cT(){const r=[];return oT.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...sT})}),[...r,...aT,...lT]}const uT=cT();og.formats=uT.map(r=>r.verbatimCoordinates);const hT=og;function Sy(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function Cy(r){let e,t;return e=new WC({}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Ty(r){let e,t,n,i,o;return t=new XC({}),{c(){e=U("button"),fe(t.$$.fragment),de(e,"type","button"),de(e,"title",r[9]),de(e,"class","svelte-bz0zu3"),Qt(e,"active",r[0])},m(c,a){q(c,e,a),ue(t,e,null),n=!0,i||(o=wt(e,"click",r[69]),i=!0)},p(c,a){(!n||a[0]&512)&&de(e,"title",c[9]),(!n||a[0]&1)&&Qt(e,"active",c[0])},i(c){n||(j(t.$$.fragment,c),n=!0)},o(c){Z(t.$$.fragment,c),n=!1},d(c){c&&V(e),he(t),i=!1,o()}}}function fT(r){let e,t=[],n=new Map,i,o,c,a=Rn(r[14]);const d=p=>p[84].id+(p[84].address?","+p[84].address:"");for(let p=0;p<a.length;p+=1){let y=Sy(r,a,p),_=d(y);n.set(_,t[p]=My(_,y))}return{c(){e=U("ul");for(let p=0;p<t.length;p+=1)t[p].c();de(e,"class","options svelte-bz0zu3")},m(p,y){q(p,e,y);for(let _=0;_<t.length;_+=1)t[_]&&t[_].m(e,null);i=!0,o||(c=[wt(e,"mouseleave",r[73]),wt(e,"blur",r[74])],o=!0)},p(p,y){y[0]&17880064&&(a=Rn(p[14]),en(),t=ix(t,y,d,1,p,a,n,e,rx,My,null,Sy),tn())},i(p){if(!i){for(let y=0;y<a.length;y+=1)j(t[y]);i=!0}},o(p){for(let y=0;y<t.length;y+=1)Z(t[y]);i=!1},d(p){p&&V(e);for(let y=0;y<t.length;y+=1)t[y].d();o=!1,pr(c)}}}function dT(r){let e,t,n,i,o,c;return t=new Fv({}),{c(){e=U("div"),fe(t.$$.fragment),n=oe(),i=U("div"),o=xe(r[7]),de(i,"class","svelte-bz0zu3"),de(e,"class","no-results svelte-bz0zu3")},m(a,d){q(a,e,d),ue(t,e,null),R(e,n),R(e,i),R(i,o),c=!0},p(a,d){(!c||d[0]&128)&&Tt(o,a[7])},i(a){c||(j(t.$$.fragment,a),c=!0)},o(a){Z(t.$$.fragment,a),c=!1},d(a){a&&V(e),he(t)}}}function pT(r){let e="",t;return{c(){t=xe(e)},m(n,i){q(n,t,i)},p:et,i:et,o:et,d(n){n&&V(t)}}}function mT(r){let e,t,n,i,o,c,a,d,p,y,_;return t=new Fv({}),d=new Rv({}),{c(){e=U("div"),fe(t.$$.fragment),n=oe(),i=U("div"),o=xe(r[6]),c=oe(),a=U("button"),fe(d.$$.fragment),de(i,"class","svelte-bz0zu3"),de(a,"class","svelte-bz0zu3"),de(e,"class","error svelte-bz0zu3")},m(w,T){q(w,e,T),ue(t,e,null),R(e,n),R(e,i),R(i,o),R(e,c),R(e,a),ue(d,a,null),p=!0,y||(_=wt(a,"click",r[70]),y=!0)},p(w,T){(!p||T[0]&64)&&Tt(o,w[6])},i(w){p||(j(t.$$.fragment,w),j(d.$$.fragment,w),p=!0)},o(w){Z(t.$$.fragment,w),Z(d.$$.fragment,w),p=!1},d(w){w&&V(e),he(t),he(d),y=!1,_()}}}function My(r,e){let t,n,i;function o(){return e[71](e[86])}function c(){return e[72](e[84])}return n=new GC({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",o),n.$on("focus",c),{key:r,first:null,c(){t=Xn(),fe(n.$$.fragment),this.first=t},m(a,d){q(a,t,d),ue(n,a,d),i=!0},p(a,d){e=a;const p={};d[0]&16384&&(p.feature=e[84]),d[0]&1024&&(p.showPlaceType=e[10]),d[0]&49152&&(p.selected=e[15]===e[86]),d[0]&4096&&(p.iconsBaseUrl=e[12]),n.$set(p)},i(a){i||(j(n.$$.fragment,a),i=!0)},o(a){Z(n.$$.fragment,a),i=!1},d(a){a&&V(t),he(n,a)}}}function gT(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M,$,P,D,I,F,N,W,se=!1;o=new YC({}),_=new Rv({});let J=r[19]&&Cy(),ee=r[5]==="button"&&Ty(r);const me=r[61].default,Ie=Sn(me,r,r[60],null),Q=[mT,pT,dT,fT],ae=[];function Pe(ve,tt){var Ge,Ee;return ve[18]?0:ve[16]?((Ge=ve[14])==null?void 0:Ge.length)===0?2:ve[16]&&((Ee=ve[14])!=null&&Ee.length)?3:-1:1}return~(P=Pe(r))&&(D=ae[P]=Q[P](r)),{c(){e=oe(),t=U("form"),n=U("div"),i=U("button"),fe(o.$$.fragment),c=oe(),a=U("input"),d=oe(),p=U("div"),y=U("button"),fe(_.$$.fragment),w=oe(),J&&J.c(),T=oe(),ee&&ee.c(),M=oe(),Ie&&Ie.c(),$=oe(),D&&D.c(),de(i,"class","search-button svelte-bz0zu3"),de(i,"type","button"),de(a,"placeholder",r[8]),de(a,"aria-label",r[8]),de(a,"class","svelte-bz0zu3"),de(y,"type","button"),de(y,"title",r[3]),de(y,"class","svelte-bz0zu3"),de(p,"class","clear-button-container svelte-bz0zu3"),Qt(p,"displayable",r[1]!==""),de(n,"class","input-group svelte-bz0zu3"),de(t,"tabindex","0"),de(t,"class",I=od(r[2])+" svelte-bz0zu3"),Qt(t,"can-collapse",r[4]&&r[1]==="")},m(ve,tt){q(ve,e,tt),q(ve,t,tt),R(t,n),R(n,i),ue(o,i,null),R(n,c),R(n,a),r[63](a),qn(a,r[1]),R(n,d),R(n,p),R(p,y),ue(_,y,null),R(p,w),J&&J.m(p,null),R(n,T),ee&&ee.m(n,null),R(n,M),Ie&&Ie.m(n,null),R(t,$),~P&&ae[P].m(t,null),F=!0,N||(W=[wt(i,"click",r[62]),wt(a,"input",r[64]),wt(a,"focus",r[65]),wt(a,"blur",r[66]),wt(a,"keydown",r[22]),wt(a,"input",r[67]),wt(y,"click",r[68]),wt(t,"submit",Rm(r[21]))],N=!0)},p(ve,tt){(!F||tt[0]&256)&&de(a,"placeholder",ve[8]),(!F||tt[0]&256)&&de(a,"aria-label",ve[8]),tt[0]&2&&a.value!==ve[1]&&qn(a,ve[1]),(!F||tt[0]&8)&&de(y,"title",ve[3]),ve[19]?J?tt[0]&524288&&j(J,1):(J=Cy(),J.c(),j(J,1),J.m(p,null)):J&&(en(),Z(J,1,1,()=>{J=null}),tn()),(!F||tt[0]&2)&&Qt(p,"displayable",ve[1]!==""),ve[5]==="button"?ee?(ee.p(ve,tt),tt[0]&32&&j(ee,1)):(ee=Ty(ve),ee.c(),j(ee,1),ee.m(n,M)):ee&&(en(),Z(ee,1,1,()=>{ee=null}),tn()),Ie&&Ie.p&&(!F||tt[1]&536870912)&&Tn(Ie,me,ve,ve[60],F?Cn(me,ve[60],tt,null):Mn(ve[60]),null);let Ge=P;P=Pe(ve),P===Ge?~P&&ae[P].p(ve,tt):(D&&(en(),Z(ae[Ge],1,1,()=>{ae[Ge]=null}),tn()),~P?(D=ae[P],D?D.p(ve,tt):(D=ae[P]=Q[P](ve),D.c()),j(D,1),D.m(t,null)):D=null),(!F||tt[0]&4&&I!==(I=od(ve[2])+" svelte-bz0zu3"))&&de(t,"class",I),(!F||tt[0]&22)&&Qt(t,"can-collapse",ve[4]&&ve[1]==="")},i(ve){F||(j(se),j(o.$$.fragment,ve),j(_.$$.fragment,ve),j(J),j(ee),j(Ie,ve),j(D),F=!0)},o(ve){Z(se),Z(o.$$.fragment,ve),Z(_.$$.fragment,ve),Z(J),Z(ee),Z(Ie,ve),Z(D),F=!1},d(ve){ve&&(V(e),V(t)),he(o),r[63](null),he(_),J&&J.d(),ee&&ee.d(),Ie&&Ie.d(ve),~P&&ae[P].d(),N=!1,pr(W)}}}function _T(r,e,t){let n,i,{$$slots:o={},$$scope:c}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:d=void 0}=e,{apiKey:p}=e,{bbox:y=void 0}=e,{clearButtonTitle:_="clear"}=e,{clearOnBlur:w=!1}=e,{collapsed:T=!1}=e,{country:M=void 0}=e,{debounceSearch:$=200}=e,{enableReverse:P="never"}=e,{errorMessage:D="Something went wrong"}=e,{filter:I=()=>!0}=e,{flyTo:F=!0}=e,{fuzzyMatch:N=!0}=e,{language:W=void 0}=e,{limit:se=void 0}=e,{mapController:J=void 0}=e,{minLength:ee=2}=e,{noResultsMessage:me="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Ie="Search"}=e,{proximity:Q=[{type:"server-geolocation"}]}=e,{reverseActive:ae=P==="always"}=e,{reverseButtonTitle:Pe="toggle reverse geocoding"}=e,{searchValue:ve=""}=e,{pickedResultStyle:tt="full-geometry"}=e,{showPlaceType:Ge="if-needed"}=e,{showResultsWhileTyping:Ee=!0}=e,{selectFirst:$e=!0}=e,{flyToSelected:St=!1}=e,{markerOnSelected:rt=!0}=e,{types:lt=void 0}=e,{exhaustiveReverseGeocoding:mt=!1}=e,{excludeTypes:ft=!1}=e,{zoom:Xe=a}=e,{apiUrl:Dt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:_t={}}=e,{iconsBaseUrl:$t="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:Et=()=>{}}=e;function Yt(){Ue.focus()}function _n(){Ue.blur()}function Zt(re,He=!0,Ke=!1){t(1,ve=re),He?(t(15,it=-1),yt()):(Gt(!Ke,Ke),setTimeout(()=>{Ue.focus(),Ue.select()}))}function ln(){t(14,kt=void 0),t(56,_e=void 0),t(15,it=-1)}function ze(){t(55,jt=[]),t(56,_e=void 0)}let Ne=!1,kt,jt,_e,vn="",Ue,it=-1,Kt,ur=[],nr,vr,Qr,mr;const Ci=new Set,Jn=ms();Yr(()=>{J&&(J.setEventHandler(void 0),J.indicateReverse(!1),J.setSelectedMarker(-1),J.setFeatures(void 0,void 0,!1))});function yt(re){if(vr&&(clearTimeout(vr),vr=void 0),it>-1&&kt)t(56,_e=kt[it]),t(1,ve=_e.place_type[0]==="reverse"?_e.place_name:_e.place_name.replace(/,.*/,"")),t(18,Kt=void 0),t(55,jt=void 0),t(15,it=-1);else if(ve){const He=re||!wr(ve);Tr(ve,{exact:!0}).then(()=>{t(55,jt=kt),t(56,_e=void 0),He&&uo()}).catch(Ke=>t(18,Kt=Ke))}}function wr(re){try{return hT(re,6)}catch{return!1}}async function Tr(re,{byId:He=!1,exact:Ke=!1}={}){t(18,Kt=void 0),nr==null||nr.abort();const Ye=new AbortController;t(19,nr=Ye);try{const ct=wr(re),Ct=new URLSearchParams;if(W!==void 0&&Ct.set("language",Array.isArray(W)?W.join(","):W??""),lt&&Ct.set("types",lt.join(",")),ft&&Ct.set("excludeTypes",String(ft)),y&&Ct.set("bbox",y.map(Bn=>Bn.toFixed(6)).join(",")),M&&Ct.set("country",Array.isArray(M)?M.join(","):M),!He&&!ct){const Bn=await eT(J,Q,Ye);Bn&&Ct.set("proximity",Bn),(Ke||!Ee)&&Ct.set("autocomplete","false"),Ct.set("fuzzyMatch",String(N))}se!==void 0&&(mt||!ct||(lt==null?void 0:lt.length)===1)&&Ct.set("limit",String(se)),Ct.set("key",p),Et(Ct);const Xt=Dt+"/"+encodeURIComponent(ct?ct.decimalLongitude+","+ct.decimalLatitude:re)+".json?"+Ct.toString();if(Xt===vn){He?(t(14,kt=void 0),t(56,_e=ur[0])):t(14,kt=ur);return}vn=Xt;const fn=await fetch(Xt,{signal:Ye.signal,..._t});if(!fn.ok)throw new Error(await fn.text());const wn=await fn.json();Jn("response",{url:Xt,featureCollection:wn}),He?(t(14,kt=void 0),t(56,_e=wn.features[0]),ur=[_e]):(t(14,kt=wn.features.filter(I)),ct&&kt.unshift({type:"Feature",properties:{},id:"reverse_"+ct.decimalLongitude+"_"+ct.decimalLatitude,text:ct.decimalLatitude+", "+ct.decimalLongitude,place_name:ct.decimalLatitude+", "+ct.decimalLongitude,place_type:["reverse"],center:[ct.decimalLongitude,ct.decimalLatitude],bbox:[ct.decimalLongitude,ct.decimalLatitude,ct.decimalLongitude,ct.decimalLatitude],geometry:{type:"Point",coordinates:[ct.decimalLongitude,ct.decimalLatitude]}}),ur=kt,ct&&Ue.focus())}catch(ct){if(ct&&typeof ct=="object"&&"name"in ct&&ct.name==="AbortError")return;throw ct}finally{Ye===nr&&t(19,nr=void 0)}}function uo(){var Ye;if(!(jt!=null&&jt.length)||!F)return;const re=[180,90,-180,-90],He=!jt.some(ct=>!ct.matching_text);let Ke;for(const ct of jt){const Ct=Yn(ct);if(Ke=Ke===void 0?Ct:Ct===void 0?Ke:Math.max(Ke,Ct),He||!ct.matching_text)for(const Xt of[0,1,2,3])re[Xt]=Math[Xt<2?"min":"max"](re[Xt],((Ye=ct.bbox)==null?void 0:Ye[Xt])??ct.center[Xt%2])}J&&jt.length>0&&(_e&&re[0]===re[2]&&re[1]===re[3]?J.flyTo(_e.center,Yn(_e)):J.fitBounds(gy(re),50,Ke))}function Yn(re){var Ke;if(!re.bbox||re.bbox[0]!==re.bbox[2]&&re.bbox[1]!==re.bbox[3])return;const He=re.id.replace(/\..*/,"");return(Array.isArray((Ke=re.properties)==null?void 0:Ke.categories)?re.properties.categories.reduce((Ye,ct)=>{const Ct=Xe[He+"."+ct];return Ye===void 0?Ct:Ct===void 0?Ye:Math.max(Ye,Ct)},void 0):void 0)??Xe[He]}function At(re){t(0,ae=P==="always"),t(14,kt=void 0),t(56,_e=void 0),t(15,it=-1),Zt(re[1].toFixed(6)+", "+QC(re[0],[-180,180],!0).toFixed(6),!1,!0)}function pn(re){if(!kt)return;let He=re.key==="ArrowDown"?1:re.key==="ArrowUp"?-1:0;He&&(it===($e?0:-1)&&He===-1&&t(15,it=kt.length),t(15,it+=He),it>=kt.length&&t(15,it=-1),it<0&&$e&&t(15,it=0),re.preventDefault())}function Gt(re=!0,He=!1){if(t(18,Kt=void 0),Ee||He){if(vr&&clearTimeout(vr),ve.length<ee)return;const Ke=ve;vr=window.setTimeout(()=>{Tr(Ke).catch(Ye=>t(18,Kt=Ye))},re?$:0)}else t(14,kt=void 0),t(18,Kt=void 0)}function Qn(re){t(56,_e=re),t(1,ve=re.place_name),t(15,it=-1)}const mi=()=>Ue.focus();function sn(re){hn[re?"unshift":"push"](()=>{Ue=re,t(17,Ue)})}function zi(){ve=this.value,t(1,ve),t(13,Ne),t(28,w)}const er=()=>t(13,Ne=!0),Ce=()=>t(13,Ne=!1),te=()=>Gt(),ne=()=>{t(1,ve=""),Ue.focus()},le=()=>t(0,ae=!ae),we=()=>t(18,Kt=void 0),Be=re=>t(15,it=re),Oe=re=>Qn(re),qe=()=>{$e||t(15,it=-1)},De=()=>{};return r.$$set=re=>{"class"in re&&t(2,d=re.class),"apiKey"in re&&t(26,p=re.apiKey),"bbox"in re&&t(27,y=re.bbox),"clearButtonTitle"in re&&t(3,_=re.clearButtonTitle),"clearOnBlur"in re&&t(28,w=re.clearOnBlur),"collapsed"in re&&t(4,T=re.collapsed),"country"in re&&t(29,M=re.country),"debounceSearch"in re&&t(30,$=re.debounceSearch),"enableReverse"in re&&t(5,P=re.enableReverse),"errorMessage"in re&&t(6,D=re.errorMessage),"filter"in re&&t(31,I=re.filter),"flyTo"in re&&t(32,F=re.flyTo),"fuzzyMatch"in re&&t(33,N=re.fuzzyMatch),"language"in re&&t(34,W=re.language),"limit"in re&&t(35,se=re.limit),"mapController"in re&&t(36,J=re.mapController),"minLength"in re&&t(37,ee=re.minLength),"noResultsMessage"in re&&t(7,me=re.noResultsMessage),"placeholder"in re&&t(8,Ie=re.placeholder),"proximity"in re&&t(38,Q=re.proximity),"reverseActive"in re&&t(0,ae=re.reverseActive),"reverseButtonTitle"in re&&t(9,Pe=re.reverseButtonTitle),"searchValue"in re&&t(1,ve=re.searchValue),"pickedResultStyle"in re&&t(39,tt=re.pickedResultStyle),"showPlaceType"in re&&t(10,Ge=re.showPlaceType),"showResultsWhileTyping"in re&&t(40,Ee=re.showResultsWhileTyping),"selectFirst"in re&&t(11,$e=re.selectFirst),"flyToSelected"in re&&t(41,St=re.flyToSelected),"markerOnSelected"in re&&t(42,rt=re.markerOnSelected),"types"in re&&t(43,lt=re.types),"exhaustiveReverseGeocoding"in re&&t(44,mt=re.exhaustiveReverseGeocoding),"excludeTypes"in re&&t(45,ft=re.excludeTypes),"zoom"in re&&t(46,Xe=re.zoom),"apiUrl"in re&&t(47,Dt=re.apiUrl),"fetchParameters"in re&&t(48,_t=re.fetchParameters),"iconsBaseUrl"in re&&t(12,$t=re.iconsBaseUrl),"adjustUrlQuery"in re&&t(49,Et=re.adjustUrlQuery),"$$scope"in re&&t(60,c=re.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,ae=P==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,Qr=Ne),w&&!Ne&&t(1,ve="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&ve.length<ee&&(t(56,_e=void 0),t(14,kt=void 0),t(18,Kt=void 0),t(55,jt=kt)),r.$$.dirty[1]&33554688&&tt!=="marker-only"&&_e&&!_e.address&&_e.geometry.type==="Point"&&_e.place_type[0]!=="reverse"&&Tr(_e.id,{byId:!0}).catch(re=>t(18,Kt=re)),r.$$.dirty[1]&100663330&&(J&&_e&&_e.id!==mr&&F&&(!_e.bbox||_e.bbox[0]===_e.bbox[2]&&_e.bbox[1]===_e.bbox[3]?J.flyTo(_e.center,Yn(_e)):J.fitBounds(gy(_e.bbox),50,Yn(_e)),t(14,kt=void 0),t(55,jt=void 0),t(15,it=-1)),t(57,mr=_e==null?void 0:_e.id)),r.$$.dirty[0]&18432&&$e&&kt!=null&&kt.length&&t(15,it=0),r.$$.dirty[0]&2&&t(15,it=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&jt!==kt&&t(55,jt=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&J&&J.setEventHandler(re=>{switch(re.type){case"mapClick":ae&&At(re.coordinates);break;case"markerClick":{const He=kt==null?void 0:kt.find(Ke=>Ke.id===re.id);He&&Qn(He)}break;case"markerMouseEnter":jt&&t(15,it=Qr?(kt==null?void 0:kt.findIndex(He=>He.id===re.id))??-1:-1);break;case"markerMouseLeave":jt&&t(15,it=-1);break}}),r.$$.dirty[0]&49152&&t(58,i=kt==null?void 0:kt[it]),r.$$.dirty[1]&134218786&&J&&i&&F&&St&&J.flyTo(i.center,Yn(i)),r.$$.dirty[1]&256&&t(59,n=tt==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(rt||J==null||J.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&J&&rt&&!jt&&(J.setFeatures(i?[i]:void 0,void 0,n),J.setSelectedMarker(i?0:-1)),r.$$.dirty[1]&318767136&&J&&J.setFeatures(jt,_e,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&jt&&J&&J.setSelectedMarker(it),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&J){const re=wr(ve);J.setReverseMarker(re?[re.decimalLongitude,re.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Jn("select",{feature:i}),r.$$.dirty[1]&33554432&&Jn("pick",{feature:_e}),r.$$.dirty[0]&81920&&Jn("optionsvisibilitychange",{optionsVisible:Qr&&!!kt}),r.$$.dirty[0]&16384&&Jn("featureslisted",{features:kt}),r.$$.dirty[1]&16777216&&Jn("featuresmarked",{features:jt}),r.$$.dirty[0]&1&&Jn("reversetoggle",{reverse:ae}),r.$$.dirty[0]&2&&Jn("querychange",{query:ve}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&J&&J.indicateReverse(ae)},[ae,ve,d,_,T,P,D,me,Ie,Pe,Ge,$e,$t,Ne,kt,it,Qr,Ue,Kt,nr,Ci,yt,pn,Gt,Qn,a,p,y,w,M,$,I,F,N,W,se,J,ee,Q,tt,Ee,St,rt,lt,mt,ft,Xe,Dt,_t,Et,Yt,_n,Zt,ln,ze,jt,_e,mr,i,n,c,o,mi,sn,zi,er,Ce,te,ne,le,we,Be,Oe,qe,De]}class yT extends Lt{constructor(e){super(),Mt(this,e,_T,gT,vt,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function Ly(r){let e,t,n;return t=new yT({props:{mapController:r[2],apiKey:r[0],country:r[1],types:r[3],proximity:[{type:"map-center"}]}}),{c(){e=U("div"),fe(t.$$.fragment),de(e,"class","svelte-ixhnie")},m(i,o){q(i,e,o),ue(t,e,null),n=!0},p(i,o){const c={};o&4&&(c.mapController=i[2]),o&1&&(c.apiKey=i[0]),o&2&&(c.country=i[1]),t.$set(c)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),he(t)}}}function bT(r){let e,t,n=r[2]&&Ly(r);return{c(){n&&n.c(),e=Xn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,[o]){i[2]?n?(n.p(i,o),o&4&&j(n,1)):(n=Ly(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(en(),Z(n,1,1,()=>{n=null}),tn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function vT(r,e,t){let n,{apiKey:i}=e,{map:o}=e,{country:c}=e,a=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function d(p){return p?$v(p,Jr,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=p=>{"apiKey"in p&&t(0,i=p.apiKey),"map"in p&&t(4,o=p.map),"country"in p&&t(1,c=p.country)},r.$$.update=()=>{r.$$.dirty&16&&t(2,n=d(o))},[i,c,n,a,o]}class wT extends Lt{constructor(e){super(),Mt(this,e,vT,bT,vt,{apiKey:0,map:4,country:1})}}const xT=Symbol.for("svelte-maplibre");function kT(){return kh(xT)}function ST(r){return"layerType"in r&&r.layerType==="deckgl"}const CT=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),Ey=r=>{var e;return{features:r[4],data:(e=r[4])==null?void 0:e[0],map:r[2],close:r[31]}};function Iy(r){let e,t,n=(r[4]||r[3]instanceof Jr.Marker)&&Ay(r);return{c(){e=U("div"),n&&n.c()},m(i,o){q(i,e,o),n&&n.m(e,null),r[32](e),t=!0},p(i,o){i[4]||i[3]instanceof Jr.Marker?n?(n.p(i,o),o[0]&24&&j(n,1)):(n=Ay(i),n.c(),j(n,1),n.m(e,null)):n&&(en(),Z(n,1,1,()=>{n=null}),tn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(),r[32](null)}}}function Ay(r){let e;const t=r[30].default,n=Sn(t,r,r[29],Ey);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[0]&536870933)&&Tn(n,t,i,i[29],e?Cn(t,i[29],o,CT):Mn(i[29]),Ey)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function TT(r){let e,t,n=r[9].default&&Iy(r);return{c(){n&&n.c(),e=Xn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,o){i[9].default?n?(n.p(i,o),o[0]&512&&j(n,1)):(n=Iy(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(en(),Z(n,1,1,()=>{n=null}),tn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function MT(r,e,t){let n,i,o,c,a,d,{$$slots:p={},$$scope:y}=e;const _=$m(p);let{closeButton:w=void 0}=e,{closeOnClickOutside:T=!0}=e,{closeOnClickInside:M=!1}=e,{closeOnMove:$=!1}=e,{openOn:P="click"}=e,{openIfTopMost:D=!0}=e,{focusAfterOpen:I=!0}=e,{anchor:F=void 0}=e,{offset:N=void 0}=e,{popupClass:W=void 0}=e,{maxWidth:se=void 0}=e,{lngLat:J=void 0}=e,{html:ee=void 0}=e,{open:me=!1}=e;const Ie=ms(),{map:Q,popupTarget:ae,layerEvent:Pe,layer:ve,eventTopMost:tt}=kT();at(r,Q,Ne=>t(2,o=Ne)),at(r,ae,Ne=>t(3,a=Ne)),at(r,Pe,Ne=>t(28,c=Ne)),at(r,ve,Ne=>t(35,d=Ne));const Ge=["click","dblclick","contextmenu"];let Ee,$e=!1,St;function rt(){if(!Ee)return;let Ne=Ee.getElement();!Ne||Ne===St||(St=Ne,P==="hover"&&(St.style.pointerEvents="none"),St.addEventListener("mouseenter",()=>{t(24,$e=!0)},{passive:!0}),St.addEventListener("mouseleave",()=>{t(24,$e=!1)},{passive:!0}),St.addEventListener("click",()=>{M&&t(0,me=!1)},{passive:!0}))}Ls(()=>{if(o)return o.on("click",_n),o.on("contextmenu",_n),typeof a=="string"&&(o.on("click",a,Xe),o.on("dblclick",a,Xe),o.on("contextmenu",a,Xe),o.on("mousemove",a,Yt),o.on("mouseleave",a,Et),o.on("touchstart",a,_t),o.on("touchend",a,$t)),()=>{o!=null&&o.loaded()&&(Ee==null||Ee.remove(),o.off("click",_n),o.off("contextmenu",_n),a instanceof Jr.Marker?a.getPopup()===Ee&&a.setPopup(void 0):typeof a=="string"&&(o.off("click",a,Xe),o.off("dblclick",a,Xe),o.off("contextmenu",a,Xe),o.off("mousemove",a,Yt),o.off("mouseleave",a,Et),o.off("touchstart",a,_t),o.off("touchend",a,$t)))}});function lt(Ne){return D?!("marker"in Ne)&&!ST(Ne)&&tt(Ne)!==d:!1}let mt=null,ft="normal";function Xe(Ne){Ne.type===P&&(lt(Ne)||("layerType"in Ne?Ne.layerType==="deckgl"?(t(10,J=Ne.coordinate),t(4,mt=Ne.object?[Ne.object]:null)):(t(10,J=Ne.lngLat),t(4,mt=Ne.features??[])):(t(10,J=Ne.lngLat),t(4,mt=Ne.features??[])),setTimeout(()=>t(0,me=!0))))}let Dt=null;function _t(Ne){Dt=Ne.point}function $t(Ne){if(!Dt||P!=="hover")return;let kt=Dt.dist(Ne.point);Dt=null,kt<3&&(t(10,J=Ne.lngLat),t(4,mt=Ne.features??[]),Ee.isOpen()?t(25,ft="justOpened"):(t(25,ft="opening"),t(0,me=!0)))}function Et(Ne){P!=="hover"||Dt||ft!=="normal"||(t(0,me=!1),t(4,mt=null))}function Yt(Ne){if(!(P!=="hover"||Dt||ft!=="normal")){if(lt(Ne)){t(0,me=!1),t(4,mt=null);return}t(0,me=!0),t(4,mt=Ne.features??[]),t(10,J=Ne.lngLat)}}function _n(Ne){if(ft==="justOpened"){t(25,ft="normal");return}if(!T)return;let kt=[St,a instanceof Jr.Marker?a==null?void 0:a.getElement():null];me&&Ee.isOpen()&&!kt.some(jt=>jt==null?void 0:jt.contains(Ne.originalEvent.target))&&(Ne.type==="contextmenu"&&P==="contextmenu"||Ne.type!=="contextmenu")&&t(0,me=!1)}Yr(()=>{o&&(Ee!=null&&Ee.isOpen())&&Ee.remove()});let Zt;const ln=()=>t(0,me=!1);function ze(Ne){hn[Ne?"unshift":"push"](()=>{Zt=Ne,t(1,Zt)})}return r.$$set=Ne=>{"closeButton"in Ne&&t(11,w=Ne.closeButton),"closeOnClickOutside"in Ne&&t(12,T=Ne.closeOnClickOutside),"closeOnClickInside"in Ne&&t(13,M=Ne.closeOnClickInside),"closeOnMove"in Ne&&t(14,$=Ne.closeOnMove),"openOn"in Ne&&t(15,P=Ne.openOn),"openIfTopMost"in Ne&&t(16,D=Ne.openIfTopMost),"focusAfterOpen"in Ne&&t(17,I=Ne.focusAfterOpen),"anchor"in Ne&&t(18,F=Ne.anchor),"offset"in Ne&&t(19,N=Ne.offset),"popupClass"in Ne&&t(20,W=Ne.popupClass),"maxWidth"in Ne&&t(21,se=Ne.maxWidth),"lngLat"in Ne&&t(10,J=Ne.lngLat),"html"in Ne&&t(22,ee=Ne.html),"open"in Ne&&t(0,me=Ne.open),"$$scope"in Ne&&t(29,y=Ne.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=w??(!T&&!M)),r.$$.dirty[0]&146685952&&(Ee||(t(23,Ee=new Jr.Popup({closeButton:n,closeOnClick:!1,closeOnMove:$,focusAfterOpen:I,maxWidth:se,className:W,anchor:F,offset:N})),St=Ee.getElement(),Ee.on("open",()=>{t(0,me=!0),rt(),Ie("open",Ee)}),Ee.on("close",()=>{t(0,me=!1),Ie("close",Ee)}),Ee.on("hover",()=>{Ie("hover",Ee)}))),r.$$.dirty[0]&8421384&&Ee&&a instanceof Jr.Marker&&(P==="click"?a.setPopup(Ee):a.getPopup()===Ee&&a.setPopup(void 0)),r.$$.dirty[0]&268468224&&Ge.includes(P)&&(c==null?void 0:c.type)===P&&(Xe(c),Nt(Pe,c=null,c)),r.$$.dirty[0]&268468224&&t(26,i=P==="hover"&&((c==null?void 0:c.type)==="mousemove"||(c==null?void 0:c.type)==="mouseenter")),r.$$.dirty[0]&352354304&&P==="hover"&&Pe&&(i&&c&&(c.layerType==="deckgl"?(t(10,J=c.coordinate),t(4,mt=c.object?[c.object]:null)):(t(10,J=c.lngLat),t(4,mt=c.features??[]))),t(0,me=(i||$e)??!1)),r.$$.dirty[0]&12582914&&(Zt?Ee.setDOMContent(Zt):ee&&Ee.setHTML(ee)),r.$$.dirty[0]&8389632&&J&&Ee.setLngLat(J),r.$$.dirty[0]&41943045&&o){let Ne=Ee.isOpen();me&&!Ne?(Ee.addTo(o),ft==="opening"&&t(25,ft="justOpened")):!me&&Ne&&Ee.remove()}},[me,Zt,o,a,mt,Q,ae,Pe,ve,_,J,w,T,M,$,P,D,I,F,N,W,se,ee,Ee,$e,ft,i,n,c,y,p,ln,ze]}class LT extends Lt{constructor(e){super(),Mt(this,e,MT,TT,vt,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}const ET=r=>({props:r&8}),Py=r=>({props:PT(r[3])});function IT(r){let e;const t=r[1].default,n=Sn(t,r,r[2],Py);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&12)&&Tn(n,t,i,i[2],e?Cn(t,i[2],o,ET):Mn(i[2]),Py)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function AT(r){let e,t;return e=new LT({props:{openOn:r[0],$$slots:{default:[IT,({features:n})=>({3:n}),({features:n})=>n?8:0]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.openOn=n[0]),i&12&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function PT(r){return r?r[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function zT(r,e,t){let{$$slots:n={},$$scope:i}=e,{openOn:o="hover"}=e;return r.$$set=c=>{"openOn"in c&&t(0,o=c.openOn),"$$scope"in c&&t(2,i=c.$$scope)},[o,n,i]}class ui extends Lt{constructor(e){super(),Mt(this,e,zT,AT,vt,{openOn:0})}}function Do(r,e,t){let n=["match",r];for(let[i,o]of Object.entries(e))n.push(i),n.push(o);return n.push(t),n}function co(r,e,t){let n=["step",r];for(let i=1;i<e.length;i++)n.push(t[i-1]),n.push(e[i]);return n.push(t[t.length-1]),n}function Ki(){return{type:"FeatureCollection",features:[]}}function DT(r){let e,t,n;return t=new Oo({props:{colorScale:r[3].colorScale,labels:{limits:r[3].limits}}}),{c(){e=U("div"),fe(t.$$.fragment),de(e,"slot","legend")},m(i,o){q(i,e,o),ue(t,e,null),n=!0},p:et,i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),he(t)}}}function $T(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',de(e,"slot","help")},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function RT(r){let e,t,n;return t=new Oo({props:{colorScale:Object.values(r[4]),labels:{buckets:Object.keys(r[4])},fullWidthBucketLegend:!0}}),{c(){e=U("div"),fe(t.$$.fragment),de(e,"slot","legend")},m(i,o){q(i,e,o),ue(t,e,null),n=!0},p:et,i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),he(t)}}}function FT(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',de(e,"slot","help")},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function BT(r){let e,t,n;return t=new eg({props:{labelColors:r[5]}}),{c(){e=U("div"),fe(t.$$.fragment),de(e,"slot","legend")},m(i,o){q(i,e,o),ue(t,e,null),n=!0},p:et,i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),he(t)}}}function OT(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',de(e,"slot","help")},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function NT(r){let e,t,n,i,o,c;const a=[mn("context-traffic"),{sourceLayer:"cbd_layer"},{filter:["has","Traffic volume category"]},{paint:{"line-color":Do(["get","Traffic volume category"],{"0 to 1999":r[3].colorScale[0],"2000 to 3999":r[3].colorScale[1],"4000+":r[3].colorScale[2]},"cyan"),"line-width":qs(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let d={};for(let T=0;T<a.length;T+=1)d=Bt(d,a[T]);e=new sr({props:d});const p=[mn("context-los"),{sourceLayer:"cbd_layer"},{paint:{"line-color":Do(["get","Level of Service"],r[4],"cyan"),"line-width":qs(1)}},{layout:{visibility:r[1]?"visible":"none"}}];let y={};for(let T=0;T<p.length;T+=1)y=Bt(y,p[T]);n=new sr({props:y});const _=[mn("context-existing-infra"),{sourceLayer:"cbd_layer"},{filter:["!=",["get","Infrastructure type"],"Mixed Traffic Street"]},{paint:{"line-color":Do(["get","Infrastructure type"],r[5],"cyan"),"line-width":qs(1)}},{layout:{visibility:r[2]?"visible":"none"}}];let w={};for(let T=0;T<_.length;T+=1)w=Bt(w,_[T]);return o=new sr({props:w}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment),i=oe(),fe(o.$$.fragment)},m(T,M){ue(e,T,M),q(T,t,M),ue(n,T,M),q(T,i,M),ue(o,T,M),c=!0},p(T,M){const $=M&9?Fn(a,[a[0],a[1],a[2],M&8&&{paint:{"line-color":Do(["get","Traffic volume category"],{"0 to 1999":T[3].colorScale[0],"2000 to 3999":T[3].colorScale[1],"4000+":T[3].colorScale[2]},"cyan"),"line-width":qs(0)}},M&1&&{layout:{visibility:T[0]?"visible":"none"}}]):{};e.$set($);const P=M&18?Fn(p,[p[0],p[1],M&16&&{paint:{"line-color":Do(["get","Level of Service"],T[4],"cyan"),"line-width":qs(1)}},M&2&&{layout:{visibility:T[1]?"visible":"none"}}]):{};n.$set(P);const D=M&36?Fn(_,[_[0],_[1],_[2],M&32&&{paint:{"line-color":Do(["get","Infrastructure type"],T[5],"cyan"),"line-width":qs(1)}},M&4&&{layout:{visibility:T[2]?"visible":"none"}}]):{};o.$set(D)},i(T){c||(j(e.$$.fragment,T),j(n.$$.fragment,T),j(o.$$.fragment,T),c=!0)},o(T){Z(e.$$.fragment,T),Z(n.$$.fragment,T),Z(o.$$.fragment,T),c=!1},d(T){T&&(V(t),V(i)),he(e,T),he(n,T),he(o,T)}}}function jT(r){let e,t,n,i,o,c,a,d,p,y,_;function w(I){r[6](I)}let T={label:"Traffic",$$slots:{help:[$T],legend:[DT]},$$scope:{ctx:r}};r[0]!==void 0&&(T.show=r[0]),e=new es({props:T}),hn.push(()=>In(e,"show",w));function M(I){r[7](I)}let $={label:"Level of Service",$$slots:{help:[FT],legend:[RT]},$$scope:{ctx:r}};r[1]!==void 0&&($.show=r[1]),i=new es({props:$}),hn.push(()=>In(i,"show",M));function P(I){r[8](I)}let D={label:"Cycle infrastructure",$$slots:{help:[OT],legend:[BT]},$$scope:{ctx:r}};return r[2]!==void 0&&(D.show=r[2]),a=new es({props:D}),hn.push(()=>In(a,"show",P)),y=new Lh({props:{url:`pmtiles://${zo("cnt_layers/cbd.pmtiles")}`,$$slots:{default:[NT]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment),n=oe(),fe(i.$$.fragment),c=oe(),fe(a.$$.fragment),p=oe(),fe(y.$$.fragment)},m(I,F){ue(e,I,F),q(I,n,F),ue(i,I,F),q(I,c,F),ue(a,I,F),q(I,p,F),ue(y,I,F),_=!0},p(I,[F]){const N={};F&512&&(N.$$scope={dirty:F,ctx:I}),!t&&F&1&&(t=!0,N.show=I[0],En(()=>t=!1)),e.$set(N);const W={};F&512&&(W.$$scope={dirty:F,ctx:I}),!o&&F&2&&(o=!0,W.show=I[1],En(()=>o=!1)),i.$set(W);const se={};F&512&&(se.$$scope={dirty:F,ctx:I}),!d&&F&4&&(d=!0,se.show=I[2],En(()=>d=!1)),a.$set(se);const J={};F&519&&(J.$$scope={dirty:F,ctx:I}),y.$set(J)},i(I){_||(j(e.$$.fragment,I),j(i.$$.fragment,I),j(a.$$.fragment,I),j(y.$$.fragment,I),_=!0)},o(I){Z(e.$$.fragment,I),Z(i.$$.fragment,I),Z(a.$$.fragment,I),Z(y.$$.fragment,I),_=!1},d(I){I&&(V(n),V(c),V(p)),he(e,I),he(i,I),he(a,I),he(y,I)}}}function UT(r,e,t){let n=!1,i=!1,o=!1,c={colorScale:["#27918d","#ffaa33","#440154"],limits:[0,2e3,4e3,1e4]},a={High:"mediumseagreen",Medium:"orange",Low:"red","Should not be used":"brown"},d={"Segregated Track (wide)":"#054d05","Off Road Cycleway":"#3a9120","Segregated Track (narrow)":"#87d668","Shared Footway":"#ffbf00","Painted Cycle Lane":"#7faedd"};function p(w){n=w,t(0,n)}function y(w){i=w,t(1,i)}function _(w){o=w,t(2,o)}return[n,i,o,c,a,d,p,y,_]}class VT extends Lt{constructor(e){super(),Mt(this,e,UT,jT,vt,{})}}function qT(r){let e,t,n;return t=new eg({props:{labelColors:r[2],swatchClass:"circle"}}),{c(){e=U("div"),fe(t.$$.fragment),de(e,"slot","legend")},m(i,o){q(i,e,o),ue(t,e,null),n=!0},p:et,i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),he(t)}}}function ZT(r){let e;return{c(){e=U("p"),e.innerHTML=`See Scottish data sources for
    <a href="https://www.data.gov.uk/dataset/9a6f9d86-9698-4a5d-a2c8-89f3b212c52c/scottish-school-roll-and-locations" target="_blank">schools</a>
    ,
    <a href="https://data.spatialhub.scot/dataset/gp_practices-is" target="_blank">GP practices</a>
    , and
    <a href="https://data.spatialhub.scot/dataset/nhs_hospitals-is" target="_blank">hospitals</a>
    . Other data is from
    <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
    .`,de(e,"slot","help")},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function zy(r){let e,t;return e=new dr({props:{data:r[1].getPOIs(),generateId:!0,$$slots:{default:[WT]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.data=n[1].getPOIs()),i&33&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function GT(r){let e=(r[4].name||`unnamed ${r[4].kind}`)+"",t;return{c(){t=xe(e)},m(n,i){q(n,t,i)},p(n,i){i&16&&e!==(e=(n[4].name||`unnamed ${n[4].kind}`)+"")&&Tt(t,e)},d(n){n&&V(t)}}}function HT(r){let e,t;return e=new ui({props:{openOn:"hover",$$slots:{default:[GT,({props:n})=>({4:n}),({props:n})=>n?16:0]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&48&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function WT(r){let e,t;const n=[mn("context-pois"),{paint:{"circle-color":Do(["get","kind"],r[2],"black"),"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let i={$$slots:{default:[HT]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new wl({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,c){const a=c&5?Fn(n,[n[0],c&4&&{paint:{"circle-color":Do(["get","kind"],o[2],"black"),"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},c&1&&{layout:{visibility:o[0]?"visible":"none"}}]):{};c&32&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function KT(r){let e,t,n,i,o;function c(p){r[3](p)}let a={label:"POIs",$$slots:{help:[ZT],legend:[qT]},$$scope:{ctx:r}};r[0]!==void 0&&(a.show=r[0]),e=new es({props:a}),hn.push(()=>In(e,"show",c));let d=r[1]&&zy(r);return{c(){fe(e.$$.fragment),n=oe(),d&&d.c(),i=Xn()},m(p,y){ue(e,p,y),q(p,n,y),d&&d.m(p,y),q(p,i,y),o=!0},p(p,[y]){const _={};y&32&&(_.$$scope={dirty:y,ctx:p}),!t&&y&1&&(t=!0,_.show=p[0],En(()=>t=!1)),e.$set(_),p[1]?d?(d.p(p,y),y&2&&j(d,1)):(d=zy(p),d.c(),j(d,1),d.m(i.parentNode,i)):d&&(en(),Z(d,1,1,()=>{d=null}),tn())},i(p){o||(j(e.$$.fragment,p),j(d),o=!0)},o(p){Z(e.$$.fragment,p),Z(d),o=!1},d(p){p&&(V(n),V(i)),he(e,p),d&&d.d(p)}}}function XT(r,e,t){let n;at(r,Ar,a=>t(1,n=a));let i=!1,o={School:"#7fc97f",GP:"#beaed4",Hospital:"#fdc086",Grocery:"#386cb0",CommunityCenter:"#ffff99"};function c(a){i=a,t(0,i)}return[i,n,o,c]}class JT extends Lt{constructor(e){super(),Mt(this,e,XT,KT,vt,{})}}function YT(r){let e,t,n,i,o;return t=new Oo({props:{colorScale:Td,labels:{buckets:bv(Md)}}}),{c(){e=U("div"),fe(t.$$.fragment),n=oe(),i=U("div"),i.innerHTML="<span>More deprived</span> <span>Less deprived</span>",st(i,"display","flex"),st(i,"justify-content","space-between"),de(e,"slot","legend")},m(c,a){q(c,e,a),ue(t,e,null),R(e,n),R(e,i),o=!0},p:et,i(c){o||(j(t.$$.fragment,c),o=!0)},o(c){Z(t.$$.fragment,c),o=!1},d(c){c&&V(e),he(t)}}}function QT(r){let e;return{c(){e=U("p"),e.innerHTML=`This shows the Scottish Index of Multiple Deprivation (SIMD) from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
    . SIMD combines different domains: income; employment; health; education, skills
    and training; geographic access to services; crime; and housing.`,de(e,"slot","help")},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function e6(r){let e,t,n,i,o;return t=new Oo({props:{colorScale:Ld,labels:{limits:Ed}}}),{c(){e=U("div"),fe(t.$$.fragment),n=oe(),i=U("div"),i.innerHTML="<span>Less dense</span> <span>people / km</span> <span>More dense</span>",st(i,"display","flex"),st(i,"justify-content","space-between"),de(e,"slot","legend")},m(c,a){q(c,e,a),ue(t,e,null),R(e,n),R(e,i),o=!0},p:et,i(c){o||(j(t.$$.fragment,c),o=!0)},o(c){Z(t.$$.fragment,c),o=!1},d(c){c&&V(e),he(t)}}}function t6(r){let e;return{c(){e=U("p"),e.innerHTML=`This shows population data from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
    .`,de(e,"slot","help")},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function n6(r){let e,t,n,i,o;return t=new Oo({props:{colorScale:Ad,labels:{limits:Id.map(f6)}}}),{c(){e=U("div"),fe(t.$$.fragment),n=oe(),i=U("div"),i.innerHTML='<span style="text-align: center; width: 100%">Households with at least one car or van</span>',st(i,"display","flex"),st(i,"justify-content","space-between"),de(e,"slot","legend")},m(c,a){q(c,e,a),ue(t,e,null),R(e,n),R(e,i),o=!0},p:et,i(c){o||(j(t.$$.fragment,c),o=!0)},o(c){Z(t.$$.fragment,c),o=!1},d(c){c&&V(e),he(t)}}}function r6(r){let e;return{c(){e=U("p"),e.textContent="Show households from the Scottish census with at least one car.",de(e,"slot","help")},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function i6(r){let e,t,n=r[6].id+"",i,o,c=r[6].population.toLocaleString()+"",a,d,p=r[6].imd_rank+"",y,_,w=r[6].imd_percentile+"",T,M;return{c(){e=U("p"),t=xe("Data zone "),i=xe(n),o=xe(`
        has `),a=xe(c),d=xe(`
        people, and a SIMD rank of `),y=xe(p),_=xe(`, making it less deprived
        than `),T=xe(w),M=xe("% of data zones.")},m($,P){q($,e,P),R(e,t),R(e,i),R(e,o),R(e,a),R(e,d),R(e,y),R(e,_),R(e,T),R(e,M)},p($,P){P&64&&n!==(n=$[6].id+"")&&Tt(i,n),P&64&&c!==(c=$[6].population.toLocaleString()+"")&&Tt(a,c),P&64&&p!==(p=$[6].imd_rank+"")&&Tt(y,p),P&64&&w!==(w=$[6].imd_percentile+"")&&Tt(T,w)},d($){$&&V(e)}}}function o6(r){let e,t;return e=new ui({props:{openOn:"hover",$$slots:{default:[i6,({props:n})=>({6:n}),({props:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function s6(r){let e,t,n=r[6].id+"",i,o,c=Bc(r[6].households_with_cars_or_vans,r[6].total_households)+"",a,d,p=r[6].total_households.toLocaleString()+"",y,_;return{c(){e=U("p"),t=xe("In data zone "),i=xe(n),o=oe(),a=xe(c),d=xe(" of approximately "),y=xe(p),_=xe(`
        households have at least one car or van.`)},m(w,T){q(w,e,T),R(e,t),R(e,i),R(e,o),R(e,a),R(e,d),R(e,y),R(e,_)},p(w,T){T&64&&n!==(n=w[6].id+"")&&Tt(i,n),T&64&&c!==(c=Bc(w[6].households_with_cars_or_vans,w[6].total_households)+"")&&Tt(a,c),T&64&&p!==(p=w[6].total_households.toLocaleString()+"")&&Tt(y,p)},d(w){w&&V(e)}}}function a6(r){let e,t;return e=new ui({props:{openOn:"hover",$$slots:{default:[s6,({props:n})=>({6:n}),({props:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function l6(r){let e,t,n=r[6].id+"",i,o,c=r[6].population.toLocaleString()+"",a,d,p=Math.round(r[6].population/(r[6].area/1e6)).toLocaleString()+"",y,_;return{c(){e=U("p"),t=xe("Data zone "),i=xe(n),o=xe(`
        has `),a=xe(c),d=xe(`
        people, with a density of `),y=xe(p),_=xe(" people per square kilometer")},m(w,T){q(w,e,T),R(e,t),R(e,i),R(e,o),R(e,a),R(e,d),R(e,y),R(e,_)},p(w,T){T&64&&n!==(n=w[6].id+"")&&Tt(i,n),T&64&&c!==(c=w[6].population.toLocaleString()+"")&&Tt(a,c),T&64&&p!==(p=Math.round(w[6].population/(w[6].area/1e6)).toLocaleString()+"")&&Tt(y,p)},d(w){w&&V(e)}}}function c6(r){let e,t;return e=new ui({props:{openOn:"hover",$$slots:{default:[l6,({props:n})=>({6:n}),({props:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function u6(r){let e,t,n,i,o,c,a,d;const p=[mn("context-simd"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":co(["get","imd_percentile"],Md,Td),"fill-opacity":Hn(.7,.9)}},{layout:{visibility:r[0]?"visible":"none"}}];let y={$$slots:{default:[o6]},$$scope:{ctx:r}};for(let D=0;D<p.length;D+=1)y=Bt(y,p[D]);e=new Hi({props:y});const _=[mn("context-population-car-ownership"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":co(["*",100,["/",["get","households_with_cars_or_vans"],["get","total_households"]]],Id,Ad),"fill-opacity":Hn(.7,.9)}},{layout:{visibility:r[2]?"visible":"none"}}];let w={$$slots:{default:[a6]},$$scope:{ctx:r}};for(let D=0;D<_.length;D+=1)w=Bt(w,_[D]);n=new Hi({props:w});const T=[mn("context-population-density"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":co(["/",["get","population"],["/",["get","area"],1e6]],Ed,Ld),"fill-opacity":Hn(.7,.9)}},{layout:{visibility:r[1]?"visible":"none"}}];let M={$$slots:{default:[c6]},$$scope:{ctx:r}};for(let D=0;D<T.length;D+=1)M=Bt(M,T[D]);o=new Hi({props:M});const $=[mn("context-population-outline"),{sourceLayer:"population"},{paint:{"line-color":"black","line-width":1}},{layout:{visibility:r[0]||r[1]||r[2]?"visible":"none"}}];let P={};for(let D=0;D<$.length;D+=1)P=Bt(P,$[D]);return a=new sr({props:P}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment),i=oe(),fe(o.$$.fragment),c=oe(),fe(a.$$.fragment)},m(D,I){ue(e,D,I),q(D,t,I),ue(n,D,I),q(D,i,I),ue(o,D,I),q(D,c,I),ue(a,D,I),d=!0},p(D,I){const F=I&1?Fn(p,[p[0],p[1],p[2],p[3],{layout:{visibility:D[0]?"visible":"none"}}]):{};I&128&&(F.$$scope={dirty:I,ctx:D}),e.$set(F);const N=I&4?Fn(_,[_[0],_[1],_[2],_[3],{layout:{visibility:D[2]?"visible":"none"}}]):{};I&128&&(N.$$scope={dirty:I,ctx:D}),n.$set(N);const W=I&2?Fn(T,[T[0],T[1],T[2],T[3],{layout:{visibility:D[1]?"visible":"none"}}]):{};I&128&&(W.$$scope={dirty:I,ctx:D}),o.$set(W);const se=I&7?Fn($,[$[0],$[1],$[2],{layout:{visibility:D[0]||D[1]||D[2]?"visible":"none"}}]):{};a.$set(se)},i(D){d||(j(e.$$.fragment,D),j(n.$$.fragment,D),j(o.$$.fragment,D),j(a.$$.fragment,D),d=!0)},o(D){Z(e.$$.fragment,D),Z(n.$$.fragment,D),Z(o.$$.fragment,D),Z(a.$$.fragment,D),d=!1},d(D){D&&(V(t),V(i),V(c)),he(e,D),he(n,D),he(o,D),he(a,D)}}}function h6(r){let e,t,n,i,o,c,a,d,p,y,_;function w(I){r[3](I)}let T={label:"SIMD",$$slots:{help:[QT],legend:[YT]},$$scope:{ctx:r}};r[0]!==void 0&&(T.show=r[0]),e=new es({props:T}),hn.push(()=>In(e,"show",w));function M(I){r[4](I)}let $={label:"Population density",$$slots:{help:[t6],legend:[e6]},$$scope:{ctx:r}};r[1]!==void 0&&($.show=r[1]),i=new es({props:$}),hn.push(()=>In(i,"show",M));function P(I){r[5](I)}let D={label:"Car ownership",$$slots:{help:[r6],legend:[n6]},$$scope:{ctx:r}};return r[2]!==void 0&&(D.show=r[2]),a=new es({props:D}),hn.push(()=>In(a,"show",P)),y=new Lh({props:{url:`pmtiles://${zo("cnt_layers/population.pmtiles")}`,$$slots:{default:[u6]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment),n=oe(),fe(i.$$.fragment),c=oe(),fe(a.$$.fragment),p=oe(),fe(y.$$.fragment)},m(I,F){ue(e,I,F),q(I,n,F),ue(i,I,F),q(I,c,F),ue(a,I,F),q(I,p,F),ue(y,I,F),_=!0},p(I,[F]){const N={};F&128&&(N.$$scope={dirty:F,ctx:I}),!t&&F&1&&(t=!0,N.show=I[0],En(()=>t=!1)),e.$set(N);const W={};F&128&&(W.$$scope={dirty:F,ctx:I}),!o&&F&2&&(o=!0,W.show=I[1],En(()=>o=!1)),i.$set(W);const se={};F&128&&(se.$$scope={dirty:F,ctx:I}),!d&&F&4&&(d=!0,se.show=I[2],En(()=>d=!1)),a.$set(se);const J={};F&135&&(J.$$scope={dirty:F,ctx:I}),y.$set(J)},i(I){_||(j(e.$$.fragment,I),j(i.$$.fragment,I),j(a.$$.fragment,I),j(y.$$.fragment,I),_=!0)},o(I){Z(e.$$.fragment,I),Z(i.$$.fragment,I),Z(a.$$.fragment,I),Z(y.$$.fragment,I),_=!1},d(I){I&&(V(n),V(c),V(p)),he(e,I),he(i,I),he(a,I),he(y,I)}}}const f6=r=>`${r}%`;function d6(r,e,t){let n=!1,i=!1,o=!1;function c(p){n=p,t(0,n)}function a(p){i=p,t(1,i)}function d(p){o=p,t(2,o)}return[n,i,o,c,a,d]}class p6 extends Lt{constructor(e){super(),Mt(this,e,d6,h6,vt,{})}}function m6(r){let e;return{c(){e=U("div"),e.innerHTML=`<img src="${Sb}" alt="National Rail logo"/>
    Station`,de(e,"slot","legend"),st(e,"display","flex"),st(e,"gap","8px"),st(e,"align-items","center")},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function g6(r){let e;return{c(){e=U("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:railway%3Dstation" target="_blank">railway stations</a>
    according to OpenStreetMap.`,de(e,"slot","help")},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function _6(r){let e,t=(r[2].name??"Unnamed railway station")+"",n;return{c(){e=U("p"),n=xe(t)},m(i,o){q(i,e,o),R(e,n)},p(i,o){o&4&&t!==(t=(i[2].name??"Unnamed railway station")+"")&&Tt(n,t)},d(i){i&&V(e)}}}function y6(r){let e,t;return e=new ui({props:{$$slots:{default:[_6,({props:n})=>({2:n}),({props:n})=>n?4:0]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&12&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function b6(r){let e,t;const n=[mn("context-railway-stations"),{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:r[0]?"visible":"none"}}];let i={$$slots:{default:[y6]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new Fc({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,c){const a=c&1?Fn(n,[n[0],{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:o[0]?"visible":"none"}}]):{};c&8&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function v6(r){let e,t,n,i,o;function c(d){r[1](d)}let a={label:"Railway stations",$$slots:{help:[g6],legend:[m6]},$$scope:{ctx:r}};return r[0]!==void 0&&(a.show=r[0]),e=new es({props:a}),hn.push(()=>In(e,"show",c)),i=new dr({props:{data:zo("cnt_layers/railways.geojson"),generateId:!0,$$slots:{default:[b6]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment),n=oe(),fe(i.$$.fragment)},m(d,p){ue(e,d,p),q(d,n,p),ue(i,d,p),o=!0},p(d,[p]){const y={};p&8&&(y.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,y.show=d[0],En(()=>t=!1)),e.$set(y);const _={};p&9&&(_.$$scope={dirty:p,ctx:d}),i.$set(_)},i(d){o||(j(e.$$.fragment,d),j(i.$$.fragment,d),o=!0)},o(d){Z(e.$$.fragment,d),Z(i.$$.fragment,d),o=!1},d(d){d&&V(n),he(e,d),he(i,d)}}}function w6(r,e,t){let n=!1;function i(o){n=o,t(0,n)}return[n,i]}class x6 extends Lt{constructor(e){super(),Mt(this,e,w6,v6,vt,{})}}function Dy(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function $y(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Ry(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Fy(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function By(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Oy(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function k6(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#routenetwork" target="_blank">Data from NPT</a>',de(e,"slot","help")},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function Ny(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=xe(t),e.__value=r[18],qn(e,e.__value)},m(i,o){q(i,e,o),R(e,n)},p:et,d(i){i&&V(e)}}}function jy(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=xe(t),e.__value=r[18],qn(e,e.__value)},m(i,o){q(i,e,o),R(e,n)},p:et,d(i){i&&V(e)}}}function Uy(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=xe(t),e.__value=r[18],qn(e,e.__value)},m(i,o){q(i,e,o),R(e,n)},p:et,d(i){i&&V(e)}}}function Vy(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=xe(t),e.__value=r[18],qn(e,e.__value)},m(i,o){q(i,e,o),R(e,n)},p:et,d(i){i&&V(e)}}}function S6(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M,$,P,D,I,F=Rn(r[7]),N=[];for(let Q=0;Q<F.length;Q+=1)N[Q]=Ny(Oy(r,F,Q));let W=Rn(r[8]),se=[];for(let Q=0;Q<W.length;Q+=1)se[Q]=jy(By(r,W,Q));let J=Rn(r[9]),ee=[];for(let Q=0;Q<J.length;Q+=1)ee[Q]=Uy(Fy(r,J,Q));let me=Rn(r[10]),Ie=[];for(let Q=0;Q<me.length;Q+=1)Ie[Q]=Vy(Ry(r,me,Q));return{c(){e=U("div"),t=U("label"),n=xe(`Trip purpose:
      `),i=U("select");for(let Q=0;Q<N.length;Q+=1)N[Q].c();o=oe(),c=U("label"),a=xe(`Scenario:
      `),d=U("select");for(let Q=0;Q<se.length;Q+=1)se[Q].c();p=oe(),y=U("label"),_=xe(`Network type:
      `),w=U("select");for(let Q=0;Q<ee.length;Q+=1)ee[Q].c();T=oe(),M=U("label"),$=xe(`Color by:
      `),P=U("select");for(let Q=0;Q<Ie.length;Q+=1)Ie[Q].c();r[0]===void 0&&us(()=>r[11].call(i)),r[1]===void 0&&us(()=>r[12].call(d)),r[2]===void 0&&us(()=>r[13].call(w)),r[3]===void 0&&us(()=>r[14].call(P)),de(e,"slot","legend")},m(Q,ae){q(Q,e,ae),R(e,t),R(t,n),R(t,i);for(let Pe=0;Pe<N.length;Pe+=1)N[Pe]&&N[Pe].m(i,null);Zi(i,r[0],!0),R(e,o),R(e,c),R(c,a),R(c,d);for(let Pe=0;Pe<se.length;Pe+=1)se[Pe]&&se[Pe].m(d,null);Zi(d,r[1],!0),R(e,p),R(e,y),R(y,_),R(y,w);for(let Pe=0;Pe<ee.length;Pe+=1)ee[Pe]&&ee[Pe].m(w,null);Zi(w,r[2],!0),R(e,T),R(e,M),R(M,$),R(M,P);for(let Pe=0;Pe<Ie.length;Pe+=1)Ie[Pe]&&Ie[Pe].m(P,null);Zi(P,r[3],!0),D||(I=[wt(i,"change",r[11]),wt(d,"change",r[12]),wt(w,"change",r[13]),wt(P,"change",r[14])],D=!0)},p(Q,ae){if(ae[0]&128){F=Rn(Q[7]);let Pe;for(Pe=0;Pe<F.length;Pe+=1){const ve=Oy(Q,F,Pe);N[Pe]?N[Pe].p(ve,ae):(N[Pe]=Ny(ve),N[Pe].c(),N[Pe].m(i,null))}for(;Pe<N.length;Pe+=1)N[Pe].d(1);N.length=F.length}if(ae[0]&129&&Zi(i,Q[0]),ae[0]&256){W=Rn(Q[8]);let Pe;for(Pe=0;Pe<W.length;Pe+=1){const ve=By(Q,W,Pe);se[Pe]?se[Pe].p(ve,ae):(se[Pe]=jy(ve),se[Pe].c(),se[Pe].m(d,null))}for(;Pe<se.length;Pe+=1)se[Pe].d(1);se.length=W.length}if(ae[0]&258&&Zi(d,Q[1]),ae[0]&512){J=Rn(Q[9]);let Pe;for(Pe=0;Pe<J.length;Pe+=1){const ve=Fy(Q,J,Pe);ee[Pe]?ee[Pe].p(ve,ae):(ee[Pe]=Uy(ve),ee[Pe].c(),ee[Pe].m(w,null))}for(;Pe<ee.length;Pe+=1)ee[Pe].d(1);ee.length=J.length}if(ae[0]&516&&Zi(w,Q[2]),ae[0]&1024){me=Rn(Q[10]);let Pe;for(Pe=0;Pe<me.length;Pe+=1){const ve=Ry(Q,me,Pe);Ie[Pe]?Ie[Pe].p(ve,ae):(Ie[Pe]=Vy(ve),Ie[Pe].c(),Ie[Pe].m(P,null))}for(;Pe<Ie.length;Pe+=1)Ie[Pe].d(1);Ie.length=me.length}ae[0]&1032&&Zi(P,Q[3])},d(Q){Q&&V(e),di(N,Q),di(se,Q),di(ee,Q),di(Ie,Q),D=!1,pr(I)}}}function qy(r){let e,t,n,i,o=r[17][`${r[18]}_fastest_bicycle`].toLocaleString()+"",c,a,d,p=r[17][`${r[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"",y,_,w,T=r[17][`${r[18]}_fastest_bicycle_ebike`].toLocaleString()+"",M,$;return{c(){e=U("tr"),t=U("th"),t.textContent=`${r[19]}`,n=oe(),i=U("td"),c=xe(o),a=oe(),d=U("td"),y=xe(p),_=oe(),w=U("td"),M=xe(T),$=oe()},m(P,D){q(P,e,D),R(e,t),R(e,n),R(e,i),R(i,c),R(e,a),R(e,d),R(d,y),R(e,_),R(e,w),R(w,M),R(e,$)},p(P,D){D[0]&131072&&o!==(o=P[17][`${P[18]}_fastest_bicycle`].toLocaleString()+"")&&Tt(c,o),D[0]&131072&&p!==(p=P[17][`${P[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&Tt(y,p),D[0]&131072&&T!==(T=P[17][`${P[18]}_fastest_bicycle_ebike`].toLocaleString()+"")&&Tt(M,T)},d(P){P&&V(e)}}}function Zy(r){let e,t,n,i,o=r[17][`${r[18]}_quietest_bicycle`].toLocaleString()+"",c,a,d,p=r[17][`${r[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"",y,_,w,T=r[17][`${r[18]}_quietest_bicycle_ebike`].toLocaleString()+"",M,$;return{c(){e=U("tr"),t=U("th"),t.textContent=`${r[19]}`,n=oe(),i=U("td"),c=xe(o),a=oe(),d=U("td"),y=xe(p),_=oe(),w=U("td"),M=xe(T),$=oe()},m(P,D){q(P,e,D),R(e,t),R(e,n),R(e,i),R(i,c),R(e,a),R(e,d),R(d,y),R(e,_),R(e,w),R(w,M),R(e,$)},p(P,D){D[0]&131072&&o!==(o=P[17][`${P[18]}_quietest_bicycle`].toLocaleString()+"")&&Tt(c,o),D[0]&131072&&p!==(p=P[17][`${P[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&Tt(y,p),D[0]&131072&&T!==(T=P[17][`${P[18]}_quietest_bicycle_ebike`].toLocaleString()+"")&&Tt(M,T)},d(P){P&&V(e)}}}function C6(r){let e,t,n,i=r[17][r[4]].toLocaleString()+"",o,c,a,d,p=r[17].gradient+"",y,_,w,T,M,$=r[17].quietness+"",P,D,I,F,N,W,se,J,ee,me,Ie,Q,ae,Pe,ve,tt,Ge,Ee=Rn(r[7]),$e=[];for(let lt=0;lt<Ee.length;lt+=1)$e[lt]=qy($y(r,Ee,lt));let St=Rn(r[7]),rt=[];for(let lt=0;lt<St.length;lt+=1)rt[lt]=Zy(Dy(r,St,lt));return{c(){e=U("div"),t=U("p"),n=xe("Cyclists: "),o=xe(i),c=oe(),a=U("p"),d=xe("Gradient: "),y=xe(p),_=xe("%"),w=oe(),T=U("p"),M=xe("Cycle-friendliness: "),P=xe($),D=xe("%"),I=oe(),F=U("details"),N=U("summary"),N.textContent="All network details",W=oe(),se=U("p"),se.textContent="Fast/Direct network",J=oe(),ee=U("table"),me=U("tr"),me.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Ie=oe();for(let lt=0;lt<$e.length;lt+=1)$e[lt].c();Q=oe(),ae=U("p"),ae.textContent="Quiet/Indirect network",Pe=oe(),ve=U("table"),tt=U("tr"),tt.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Ge=oe();for(let lt=0;lt<rt.length;lt+=1)rt[lt].c();st(e,"max-width","30vw"),st(e,"max-height","60vh"),st(e,"overflow","auto")},m(lt,mt){q(lt,e,mt),R(e,t),R(t,n),R(t,o),R(e,c),R(e,a),R(a,d),R(a,y),R(a,_),R(e,w),R(e,T),R(T,M),R(T,P),R(T,D),R(e,I),R(e,F),R(F,N),R(F,W),R(F,se),R(F,J),R(F,ee),R(ee,me),R(ee,Ie);for(let ft=0;ft<$e.length;ft+=1)$e[ft]&&$e[ft].m(ee,null);R(F,Q),R(F,ae),R(F,Pe),R(F,ve),R(ve,tt),R(ve,Ge);for(let ft=0;ft<rt.length;ft+=1)rt[ft]&&rt[ft].m(ve,null)},p(lt,mt){if(mt[0]&131088&&i!==(i=lt[17][lt[4]].toLocaleString()+"")&&Tt(o,i),mt[0]&131072&&p!==(p=lt[17].gradient+"")&&Tt(y,p),mt[0]&131072&&$!==($=lt[17].quietness+"")&&Tt(P,$),mt[0]&131200){Ee=Rn(lt[7]);let ft;for(ft=0;ft<Ee.length;ft+=1){const Xe=$y(lt,Ee,ft);$e[ft]?$e[ft].p(Xe,mt):($e[ft]=qy(Xe),$e[ft].c(),$e[ft].m(ee,null))}for(;ft<$e.length;ft+=1)$e[ft].d(1);$e.length=Ee.length}if(mt[0]&131200){St=Rn(lt[7]);let ft;for(ft=0;ft<St.length;ft+=1){const Xe=Dy(lt,St,ft);rt[ft]?rt[ft].p(Xe,mt):(rt[ft]=Zy(Xe),rt[ft].c(),rt[ft].m(ve,null))}for(;ft<rt.length;ft+=1)rt[ft].d(1);rt.length=St.length}},d(lt){lt&&V(e),di($e,lt),di(rt,lt)}}}function T6(r){let e,t;return e=new ui({props:{openOn:"click",$$slots:{default:[C6,({props:n})=>({17:n}),({props:n})=>[n?131072:0]]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i[0]&131088|i[1]&2&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function M6(r){let e,t;const n=[mn("context-route-network"),{sourceLayer:"rnet"},{paint:{"line-color":r[6],"line-width":Gy(["get",r[4]])}},{layout:{visibility:r[5]?"visible":"none"}},{hoverCursor:"pointer"}];let i={$$slots:{default:[T6]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new sr({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,c){const a=c[0]&112?Fn(n,[n[0],n[1],c[0]&80&&{paint:{"line-color":o[6],"line-width":Gy(["get",o[4]])}},c[0]&32&&{layout:{visibility:o[5]?"visible":"none"}},n[4]]):{};c[0]&16|c[1]&2&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function L6(r){let e,t,n,i,o;function c(d){r[15](d)}let a={label:"Route network",$$slots:{legend:[S6],help:[k6]},$$scope:{ctx:r}};return r[5]!==void 0&&(a.show=r[5]),e=new es({props:a}),hn.push(()=>In(e,"show",c)),i=new Lh({props:{url:`pmtiles://${zo("cnt_layers/route_network.pmtiles")}`,$$slots:{default:[M6]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment),n=oe(),fe(i.$$.fragment)},m(d,p){ue(e,d,p),q(d,n,p),ue(i,d,p),o=!0},p(d,p){const y={};p[0]&15|p[1]&2&&(y.$$scope={dirty:p,ctx:d}),!t&&p[0]&32&&(t=!0,y.show=d[5],En(()=>t=!1)),e.$set(y);const _={};p[0]&112|p[1]&2&&(_.$$scope={dirty:p,ctx:d}),i.$set(_)},i(d){o||(j(e.$$.fragment,d),j(i.$$.fragment,d),o=!0)},o(d){Z(e.$$.fragment,d),Z(i.$$.fragment,d),o=!1},d(d){d&&V(n),he(e,d),he(i,d)}}}function Gy(r){return["let","base",["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",r,.0021]]]]]],["interpolate",["linear"],["zoom"],12,["*",2.1,["var","base"]],14,["*",5.25,["var","base"]],15,["*",7.5,["var","base"]],16,["*",18,["var","base"]],18,["*",52.5,["var","base"]]]]}function E6(r){return["step",r,"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function I6(r,e,t){let n,i,o=!1,c="all",a="bicycle_go_dutch",d="fastest",p="flow",y=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],_=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],w=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],T=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]],M={colorScale:["#59ee19","#37a009","#FFC300","#C70039","#581845","#000000"],limits:[3,5,7,10,100]};function $(){c=Sa(this),t(0,c),t(7,y)}function P(){a=Sa(this),t(1,a),t(8,_)}function D(){d=Sa(this),t(2,d),t(9,w)}function I(){p=Sa(this),t(3,p),t(10,T)}function F(N){o=N,t(5,o)}return r.$$.update=()=>{r.$$.dirty[0]&7&&t(4,n=`${c}_${d}_${a}`),r.$$.dirty[0]&24&&t(6,i={none:"#304ce7",flow:E6(["get",n]),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:co(["abs",["get","gradient"]],M.limits,M.colorScale)}[p])},[c,a,d,p,n,o,i,y,_,w,T,$,P,D,I,F]}class A6 extends Lt{constructor(e){super(),Mt(this,e,I6,L6,vt,{},null,[-1,-1])}}function P6(r){let e;return{c(){e=U("div"),e.innerHTML=`<p>This layer shows collisions recorded in the <a href="https://www.data.gov.uk/dataset/cb7ae6f0-4be6-4935-9277-47e5ce24a11f/road-safety-data" target="_blank">DfT stats19</a>
      dataset, as of 30 September 2024. Please note these limitations:</p> <ul><li>Only collisions between 2017 and 2023 are included</li> <li>This tool is intended to be used when zoomed into the map, while
        inspecting a scheme or development area. Not all points are shown when
        zoomed out and showing large areas. Do not use this to look for trends
        across a city or region scale.</li> <li>Approximately 150 collisions from the source data aren&#39;t included, due
        to problems with the recorded location</li> <li>The &quot;pedestrians&quot; category also include mobility scooters</li> <li>All limitations <a href="https://www.gov.uk/guidance/road-accident-and-safety-statistics-guidance" target="_blank">documented by DfT</a>
        also apply. Not all collisions or near misses are reported. There&#39;s nuance
        with the severity categories.</li></ul> <p>You can click a point to open the full report, thanks to CycleStreets.</p> <p>License: <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">Open Government License</a>
      . Contains OS data  Crown copyright and database right 2025.</p>`,de(e,"slot","help")},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function z6(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M,$,P,D,I,F,N,W,se,J;return N=new eg({props:{labelColors:r[6],swatchClass:"circle",itemsPerRow:3}}),{c(){e=U("div"),t=U("fieldset"),n=U("label"),i=U("input"),o=xe(`
        Pedestrians`),c=oe(),a=U("label"),d=U("input"),p=xe(`
        Cyclists`),y=oe(),_=U("fieldset"),w=U("label"),T=xe(`From
        `),M=U("input"),$=oe(),P=U("label"),D=xe(`To
        `),I=U("input"),F=oe(),fe(N.$$.fragment),de(i,"type","checkbox"),de(i,"class","svelte-rvrx5w"),de(d,"type","checkbox"),de(d,"class","svelte-rvrx5w"),st(t,"display","flex"),st(t,"gap","3em"),de(t,"class","svelte-rvrx5w"),de(M,"type","number"),de(M,"min",2017),de(M,"max",2023),de(M,"class","svelte-rvrx5w"),de(I,"type","number"),de(I,"min",2017),de(I,"max",2023),de(I,"class","svelte-rvrx5w"),de(_,"class","year-filter svelte-rvrx5w"),de(e,"slot","legend")},m(ee,me){q(ee,e,me),R(e,t),R(t,n),R(n,i),i.checked=r[1].pedestrians,R(n,o),R(t,c),R(t,a),R(a,d),d.checked=r[1].cyclists,R(a,p),R(e,y),R(e,_),R(_,w),R(w,T),R(w,M),qn(M,r[1].minYear),R(_,$),R(_,P),R(P,D),R(P,I),qn(I,r[1].maxYear),R(e,F),ue(N,e,null),W=!0,se||(J=[wt(i,"change",r[7]),wt(d,"change",r[8]),wt(M,"input",r[9]),wt(I,"input",r[10])],se=!0)},p(ee,me){me&2&&(i.checked=ee[1].pedestrians),me&2&&(d.checked=ee[1].cyclists),me&2&&ml(M.value)!==ee[1].minYear&&qn(M,ee[1].minYear),me&2&&ml(I.value)!==ee[1].maxYear&&qn(I,ee[1].maxYear)},i(ee){W||(j(N.$$.fragment,ee),W=!0)},o(ee){Z(N.$$.fragment,ee),W=!1},d(ee){ee&&V(e),he(N),se=!1,pr(J)}}}function Hy(r){let e,t,n,i=r[3][r[12].pedestrian_location]+"",o;return{c(){e=U("p"),t=xe("Pedestrian location: "),n=U("b"),o=xe(i)},m(c,a){q(c,e,a),R(e,t),R(e,n),R(n,o)},p(c,a){a&4096&&i!==(i=c[3][c[12].pedestrian_location]+"")&&Tt(o,i)},d(c){c&&V(e)}}}function Wy(r){let e,t,n,i=r[4][r[12].pedestrian_movement]+"",o;return{c(){e=U("p"),t=xe("Pedestrian movement: "),n=U("b"),o=xe(i)},m(c,a){q(c,e,a),R(e,t),R(e,n),R(n,o)},p(c,a){a&4096&&i!==(i=c[4][c[12].pedestrian_movement]+"")&&Tt(o,i)},d(c){c&&V(e)}}}function D6(r){let e,t,n,i=r[12].year+"",o,c,a,d,p,y=r[5][r[12].severity]+"",_,w,T,M,$,P=Ky(r[12])+"",D,I,F,N,W,se=r[12].pedestrian_location&&Hy(r),J=r[12].pedestrian_movement&&Wy(r);return{c(){e=U("p"),t=xe("Year: "),n=U("b"),o=xe(i),c=oe(),a=U("p"),d=xe("Severity: "),p=U("b"),_=xe(y),w=oe(),T=U("p"),M=xe("Casualties: "),$=U("b"),D=xe(P),I=oe(),se&&se.c(),F=oe(),J&&J.c(),N=oe(),W=U("p"),W.textContent="Click to open full report in CycleStreets"},m(ee,me){q(ee,e,me),R(e,t),R(e,n),R(n,o),q(ee,c,me),q(ee,a,me),R(a,d),R(a,p),R(p,_),q(ee,w,me),q(ee,T,me),R(T,M),R(T,$),R($,D),q(ee,I,me),se&&se.m(ee,me),q(ee,F,me),J&&J.m(ee,me),q(ee,N,me),q(ee,W,me)},p(ee,me){me&4096&&i!==(i=ee[12].year+"")&&Tt(o,i),me&4096&&y!==(y=ee[5][ee[12].severity]+"")&&Tt(_,y),me&4096&&P!==(P=Ky(ee[12])+"")&&Tt(D,P),ee[12].pedestrian_location?se?se.p(ee,me):(se=Hy(ee),se.c(),se.m(F.parentNode,F)):se&&(se.d(1),se=null),ee[12].pedestrian_movement?J?J.p(ee,me):(J=Wy(ee),J.c(),J.m(N.parentNode,N)):J&&(J.d(1),J=null)},d(ee){ee&&(V(e),V(c),V(a),V(w),V(T),V(I),V(F),V(N),V(W)),se&&se.d(ee),J&&J.d(ee)}}}function $6(r){let e,t;return e=new ui({props:{$$slots:{default:[D6,({props:n})=>({12:n}),({props:n})=>n?4096:0]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&12288&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function R6(r){let e,t;const n=[mn("context-stats19"),{sourceLayer:"stats19"},{paint:{"circle-color":co(["get","severity"],[1,2,3],[Tm,Mm,Lm]),"circle-opacity":.9,"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,15],"circle-stroke-color":"black","circle-stroke-width":.1}},{filter:r[2](r[1])},{layout:{visibility:r[0]?"visible":"none"}},{hoverCursor:"pointer"}];let i={$$slots:{default:[$6]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new wl({props:i}),e.$on("click",B6),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,c){const a=c&7?Fn(n,[n[0],n[1],c&0&&{paint:{"circle-color":co(["get","severity"],[1,2,3],[Tm,Mm,Lm]),"circle-opacity":.9,"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,15],"circle-stroke-color":"black","circle-stroke-width":.1}},c&6&&{filter:o[2](o[1])},c&1&&{layout:{visibility:o[0]?"visible":"none"}},n[5]]):{};c&8192&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function F6(r){let e,t,n,i,o;function c(d){r[11](d)}let a={label:"Collisions",$$slots:{legend:[z6],help:[P6]},$$scope:{ctx:r}};return r[0]!==void 0&&(a.show=r[0]),e=new es({props:a}),hn.push(()=>In(e,"show",c)),i=new Lh({props:{url:`pmtiles://${zo("cnt_layers/stats19.pmtiles")}`,$$slots:{default:[R6]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment),n=oe(),fe(i.$$.fragment)},m(d,p){ue(e,d,p),q(d,n,p),ue(i,d,p),o=!0},p(d,[p]){const y={};p&8194&&(y.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,y.show=d[0],En(()=>t=!1)),e.$set(y);const _={};p&8195&&(_.$$scope={dirty:p,ctx:d}),i.$set(_)},i(d){o||(j(e.$$.fragment,d),j(i.$$.fragment,d),o=!0)},o(d){Z(e.$$.fragment,d),Z(i.$$.fragment,d),o=!1},d(d){d&&V(n),he(e,d),he(i,d)}}}let Tm="#080C54",Mm="#1F9EB7",Lm="#CDE594";function Ky(r){let e=[];return r.pedestrian&&e.push("pedestrian"),r.cyclist&&e.push("cyclist"),e.join(", ")}function B6(r){window.open(`https://www.cyclestreets.net/collisions/reports/${r.detail.features[0].properties.accident_index}`,"_blank")}function O6(r,e,t){let n=!1,i={pedestrians:!0,cyclists:!0,minYear:2017,maxYear:2023};function o($){let P=["any"];return i.pedestrians&&P.push(["get","pedestrian"]),i.cyclists&&P.push(["get","cyclist"]),["all",[">=",["get","year"],i.minYear],["<=",["get","year"],i.maxYear],P]}let c={1:"Crossing on pedestrian crossing facility",2:"Crossing in zig-zag approach lines",3:"Crossing in zig-zag exit lines",4:"Crossing elsewhere within 50m. of pedestrian crossing",5:"In carriageway, crossing elsewhere",6:"On footway or verge",7:"On refuge, central island or central reservation",8:"In centre of carriageway - not on refuge, island or central reservation",9:"In carriageway, not crossing"},a={1:"Crossing from driver's nearside",2:"Crossing from nearside - masked by parked or stationary vehicle",3:"Crossing from driver's offside",4:"Crossing from offside - masked by parked or stationary vehicle",5:"In carriageway, stationary - not crossing (standing or playing)",6:"In carriageway, stationary - not crossing (standing or playing - masked by parked or stationary vehicle)",7:"Walking along in carriageway, facing traffic",8:"Walking along in carriageway, back to traffic"},d={1:"Fatal",2:"Serious",3:"Slight"},p={Slight:Lm,Serious:Mm,Fatal:Tm};function y(){i.pedestrians=this.checked,t(1,i)}function _(){i.cyclists=this.checked,t(1,i)}function w(){i.minYear=ml(this.value),t(1,i)}function T(){i.maxYear=ml(this.value),t(1,i)}function M($){n=$,t(0,n)}return[n,i,o,c,a,d,p,y,_,w,T,M]}class N6 extends Lt{constructor(e){super(),Mt(this,e,O6,F6,vt,{})}}function Xy(r){let e;return{c(){e=xe("Layers")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function Jy(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M;return e=new JT({}),n=new p6({}),o=new x6({}),a=new jS({}),p=new VT({}),_=new A6({}),T=new N6({}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment),i=oe(),fe(o.$$.fragment),c=oe(),fe(a.$$.fragment),d=oe(),fe(p.$$.fragment),y=oe(),fe(_.$$.fragment),w=oe(),fe(T.$$.fragment)},m($,P){ue(e,$,P),q($,t,P),ue(n,$,P),q($,i,P),ue(o,$,P),q($,c,P),ue(a,$,P),q($,d,P),ue(p,$,P),q($,y,P),ue(_,$,P),q($,w,P),ue(T,$,P),M=!0},i($){M||(j(e.$$.fragment,$),j(n.$$.fragment,$),j(o.$$.fragment,$),j(a.$$.fragment,$),j(p.$$.fragment,$),j(_.$$.fragment,$),j(T.$$.fragment,$),M=!0)},o($){Z(e.$$.fragment,$),Z(n.$$.fragment,$),Z(o.$$.fragment,$),Z(a.$$.fragment,$),Z(p.$$.fragment,$),Z(_.$$.fragment,$),Z(T.$$.fragment,$),M=!1},d($){$&&(V(t),V(i),V(c),V(d),V(y),V(w)),he(e,$),he(n,$),he(o,$),he(a,$),he(p,$),he(_,$),he(T,$)}}}function j6(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M;i=new Nk({props:{color:"#333"}});let $=r[0]&&Xy();function P(F){r[4](F)}let D={label:"Existing modal filters and turn restrictions"};r[1]!==void 0&&(D.show=r[1]),p=new es({props:D}),hn.push(()=>In(p,"show",P));let I=r[2]=="cnt"&&Jy();return{c(){e=U("div"),t=U("button"),n=U("div"),fe(i.$$.fragment),o=oe(),$&&$.c(),a=oe(),d=U("div"),fe(p.$$.fragment),_=oe(),I&&I.c(),st(n,"display","flex"),st(n,"gap","12px"),st(n,"color","#333"),st(n,"align-items","center"),st(n,"justify-content","center"),de(t,"class",c="show-layers-button icon-btn "+(r[0]?"expanded":"")+" svelte-8cnrrn"),de(t,"aria-label","Layers"),st(d,"flex-direction","column"),st(d,"display",r[0]?"flex":"none"),st(d,"background-color","#515f7A"),de(e,"class","pico contextual-layers svelte-8cnrrn"),st(e,"display","flex"),st(e,"flex-direction","column"),st(e,"max-height","80vh"),st(e,"overflow","auto"),st(e,"border-radius","5px"),st(e,"width",r[0]?"300px":"auto")},m(F,N){q(F,e,N),R(e,t),R(t,n),ue(i,n,null),R(n,o),$&&$.m(n,null),R(e,a),R(e,d),ue(p,d,null),R(d,_),I&&I.m(d,null),w=!0,T||(M=wt(t,"click",r[3]),T=!0)},p(F,N){F[0]?$||($=Xy(),$.c(),$.m(n,null)):$&&($.d(1),$=null),(!w||N&1&&c!==(c="show-layers-button icon-btn "+(F[0]?"expanded":"")+" svelte-8cnrrn"))&&de(t,"class",c);const W={};!y&&N&2&&(y=!0,W.show=F[1],En(()=>y=!1)),p.$set(W),F[2]=="cnt"?I?N&4&&j(I,1):(I=Jy(),I.c(),j(I,1),I.m(d,null)):I&&(en(),Z(I,1,1,()=>{I=null}),tn()),N&1&&st(d,"display",F[0]?"flex":"none"),N&1&&st(e,"width",F[0]?"300px":"auto")},i(F){w||(j(i.$$.fragment,F),j(p.$$.fragment,F),j(I),w=!0)},o(F){Z(i.$$.fragment,F),Z(p.$$.fragment,F),Z(I),w=!1},d(F){F&&V(e),he(i),$&&$.d(),he(p),I&&I.d(),T=!1,M()}}}function U6(r){let e,t;return e=new T3({props:{defaultStyling:!0,$$slots:{default:[j6]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,[i]){const o={};i&39&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function V6(r,e,t){let n,i;at(r,fd,d=>t(1,n=d)),at(r,Fo,d=>t(2,i=d));let o=!1;const c=()=>t(0,o=!o);function a(d){n=d,fd.set(n)}return[o,n,i,c,a]}class q6 extends Lt{constructor(e){super(),Mt(this,e,V6,U6,vt,{})}}let We;const Bv=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Bv.decode();let Qu=null;function $c(){return(Qu===null||Qu.byteLength===0)&&(Qu=new Uint8Array(We.memory.buffer)),Qu}function Rr(r,e){return r=r>>>0,Bv.decode($c().subarray(r,r+e))}const Gs=new Array(128).fill(void 0);Gs.push(void 0,null,!0,!1);let hh=Gs.length;function lr(r){hh===Gs.length&&Gs.push(Gs.length+1);const e=hh;return hh=Gs[e],Gs[e]=r,e}function Ln(r){return Gs[r]}let bi=0;const rd=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Z6=typeof rd.encodeInto=="function"?function(r,e){return rd.encodeInto(r,e)}:function(r,e){const t=rd.encode(r);return e.set(t),{read:r.length,written:t.length}};function Io(r,e,t){if(t===void 0){const a=rd.encode(r),d=e(a.length,1)>>>0;return $c().subarray(d,d+a.length).set(a),bi=a.length,d}let n=r.length,i=e(n,1)>>>0;const o=$c();let c=0;for(;c<n;c++){const a=r.charCodeAt(c);if(a>127)break;o[i+c]=a}if(c!==n){c!==0&&(r=r.slice(c)),i=t(i,n,n=c+r.length*3,1)>>>0;const a=$c().subarray(i+c,i+n),d=Z6(r,a);c+=d.written}return bi=c,i}function Ic(r){return r==null}let eh=null;function pt(){return(eh===null||eh.byteLength===0)&&(eh=new Int32Array(We.memory.buffer)),eh}function G6(r){r<132||(Gs[r]=hh,hh=r)}function Wn(r){const e=Ln(r);return G6(r),e}let th=null;function Ov(){return(th===null||th.byteLength===0)&&(th=new Float64Array(We.memory.buffer)),th}let nh=null;function H6(){return(nh===null||nh.byteLength===0)&&(nh=new BigInt64Array(We.memory.buffer)),nh}function Em(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Em(r[0]));for(let c=1;c<i;c++)o+=", "+Em(r[c]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Qp(r,e){const t=e(r.length*1,1)>>>0;return $c().set(r,t/1),bi=r.length,t}function W6(r,e){return r=r>>>0,Ov().subarray(r/8,r/8+e)}function K6(r,e){return r=r>>>0,$c().subarray(r/1,r/1+e)}function fl(r,e){try{return r.apply(this,e)}catch(t){We.__wbindgen_exn_store(lr(t))}}class X6{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();We.__wbg_ltn_free(e)}constructor(e,t,n,i,o,c,a,d){try{const M=We.__wbindgen_add_to_stack_pointer(-16),$=Qp(e,We.__wbindgen_malloc),P=bi,D=Qp(t,We.__wbindgen_malloc),I=bi,F=Qp(n,We.__wbindgen_malloc),N=bi,W=Io(o,We.__wbindgen_malloc,We.__wbindgen_realloc),se=bi;var p=Ic(c)?0:Io(c,We.__wbindgen_malloc,We.__wbindgen_realloc),y=bi;const J=Io(a,We.__wbindgen_malloc,We.__wbindgen_realloc),ee=bi;We.ltn_new(M,$,P,D,I,F,N,lr(i),W,se,p,y,J,ee,d);var _=pt()[M/4+0],w=pt()[M/4+1],T=pt()[M/4+2];if(T)throw Wn(w);return this.__wbg_ptr=_>>>0,this}finally{We.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getInvertedBoundary(p,this.__wbg_ptr);var n=pt()[p/4+0],i=pt()[p/4+1],o=pt()[p/4+2],c=pt()[p/4+3],a=n,d=i;if(c)throw a=0,d=0,Wn(o);return e=a,t=d,Rr(a,d)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}getBounds(){try{const i=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getBounds(i,this.__wbg_ptr);var e=pt()[i/4+0],t=pt()[i/4+1],n=W6(e,t).slice();return We.__wbindgen_free(e,t*8,8),n}finally{We.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const i=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_toRouteSnapper(i,this.__wbg_ptr);var e=pt()[i/4+0],t=pt()[i/4+1],n=K6(e,t).slice();return We.__wbindgen_free(e,t*1,1),n}finally{We.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_toRouteSnapperGj(p,this.__wbg_ptr);var n=pt()[p/4+0],i=pt()[p/4+1],o=pt()[p/4+2],c=pt()[p/4+3],a=n,d=i;if(c)throw a=0,d=0,Wn(o);return e=a,t=d,Rr(a,d)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}renderModalFilters(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_renderModalFilters(p,this.__wbg_ptr);var n=pt()[p/4+0],i=pt()[p/4+1],o=pt()[p/4+2],c=pt()[p/4+3],a=n,d=i;if(c)throw a=0,d=0,Wn(o);return e=a,t=d,Rr(a,d)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}renderTurnRestrictions(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_renderTurnRestrictions(p,this.__wbg_ptr);var n=pt()[p/4+0],i=pt()[p/4+1],o=pt()[p/4+2],c=pt()[p/4+3],a=n,d=i;if(c)throw a=0,d=0,Wn(o);return e=a,t=d,Rr(a,d)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}renderNeighbourhood(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_renderNeighbourhood(p,this.__wbg_ptr);var n=pt()[p/4+0],i=pt()[p/4+1],o=pt()[p/4+2],c=pt()[p/4+3],a=n,d=i;if(c)throw a=0,d=0,Wn(o);return e=a,t=d,Rr(a,d)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}generatedBoundaries(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_generatedBoundaries(p,this.__wbg_ptr);var n=pt()[p/4+0],i=pt()[p/4+1],o=pt()[p/4+2],c=pt()[p/4+3],a=n,d=i;if(c)throw a=0,d=0,Wn(o);return e=a,t=d,Rr(a,d)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}generateMergedBoundary(e){let t,n;try{const y=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_generateMergedBoundary(y,this.__wbg_ptr,lr(e));var i=pt()[y/4+0],o=pt()[y/4+1],c=pt()[y/4+2],a=pt()[y/4+3],d=i,p=o;if(a)throw d=0,p=0,Wn(c);return t=d,n=p,Rr(d,p)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(t,n,1)}}setNeighbourhoodBoundary(e,t){try{const o=We.__wbindgen_add_to_stack_pointer(-16),c=Io(e,We.__wbindgen_malloc,We.__wbindgen_realloc),a=bi;We.ltn_setNeighbourhoodBoundary(o,this.__wbg_ptr,c,a,lr(t));var n=pt()[o/4+0],i=pt()[o/4+1];if(i)throw Wn(n)}finally{We.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(e){const t=Io(e,We.__wbindgen_malloc,We.__wbindgen_realloc),n=bi;We.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,t,n)}renameNeighbourhoodBoundary(e,t){const n=Io(e,We.__wbindgen_malloc,We.__wbindgen_realloc),i=bi,o=Io(t,We.__wbindgen_malloc,We.__wbindgen_realloc),c=bi;We.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,n,i,o,c)}setCurrentNeighbourhood(e){try{const i=We.__wbindgen_add_to_stack_pointer(-16),o=Io(e,We.__wbindgen_malloc,We.__wbindgen_realloc),c=bi;We.ltn_setCurrentNeighbourhood(i,this.__wbg_ptr,o,c);var t=pt()[i/4+0],n=pt()[i/4+1];if(n)throw Wn(t)}finally{We.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(e,t){try{const o=We.__wbindgen_add_to_stack_pointer(-16),c=Io(t,We.__wbindgen_malloc,We.__wbindgen_realloc),a=bi;We.ltn_addModalFilter(o,this.__wbg_ptr,lr(e),c,a);var n=pt()[o/4+0],i=pt()[o/4+1];if(i)throw Wn(n)}finally{We.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(e,t){try{const o=We.__wbindgen_add_to_stack_pointer(-16),c=Io(t,We.__wbindgen_malloc,We.__wbindgen_realloc),a=bi;We.ltn_addManyModalFilters(o,this.__wbg_ptr,lr(e),c,a);var n=pt()[o/4+0],i=pt()[o/4+1];if(i)throw Wn(n)}finally{We.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(e){We.ltn_deleteModalFilter(this.__wbg_ptr,e)}addDiagonalFilter(e){try{const i=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_addDiagonalFilter(i,this.__wbg_ptr,e);var t=pt()[i/4+0],n=pt()[i/4+1];if(n)throw Wn(t)}finally{We.__wbindgen_add_to_stack_pointer(16)}}rotateDiagonalFilter(e){try{const i=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_rotateDiagonalFilter(i,this.__wbg_ptr,e);var t=pt()[i/4+0],n=pt()[i/4+1];if(n)throw Wn(t)}finally{We.__wbindgen_add_to_stack_pointer(16)}}deleteDiagonalFilter(e){try{const i=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_deleteDiagonalFilter(i,this.__wbg_ptr,e);var t=pt()[i/4+0],n=pt()[i/4+1];if(n)throw Wn(t)}finally{We.__wbindgen_add_to_stack_pointer(16)}}addTurnRestriction(e,t){try{const o=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_addTurnRestriction(o,this.__wbg_ptr,e,t);var n=pt()[o/4+0],i=pt()[o/4+1];if(i)throw Wn(n)}finally{We.__wbindgen_add_to_stack_pointer(16)}}deleteTurnRestriction(e,t,n){try{const c=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_deleteTurnRestriction(c,this.__wbg_ptr,e,t,n);var i=pt()[c/4+0],o=pt()[c/4+1];if(o)throw Wn(i)}finally{We.__wbindgen_add_to_stack_pointer(16)}}getTurnRestrictionTargets(e){let t,n;try{const y=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getTurnRestrictionTargets(y,this.__wbg_ptr,e);var i=pt()[y/4+0],o=pt()[y/4+1],c=pt()[y/4+2],a=pt()[y/4+3],d=i,p=o;if(a)throw d=0,p=0,Wn(c);return t=d,n=p,Rr(d,p)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(t,n,1)}}toggleTravelFlow(e){We.ltn_toggleTravelFlow(this.__wbg_ptr,e)}toggleMainRoad(e){try{const i=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_toggleMainRoad(i,this.__wbg_ptr,e);var t=pt()[i/4+0],n=pt()[i/4+1];if(n)throw Wn(t)}finally{We.__wbindgen_add_to_stack_pointer(16)}}undo(){try{const n=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_undo(n,this.__wbg_ptr);var e=pt()[n/4+0],t=pt()[n/4+1];if(t)throw Wn(e)}finally{We.__wbindgen_add_to_stack_pointer(16)}}redo(){try{const n=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_redo(n,this.__wbg_ptr);var e=pt()[n/4+0],t=pt()[n/4+1];if(t)throw Wn(e)}finally{We.__wbindgen_add_to_stack_pointer(16)}}getShortcutsCrossingRoad(e){let t,n;try{const y=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getShortcutsCrossingRoad(y,this.__wbg_ptr,e);var i=pt()[y/4+0],o=pt()[y/4+1],c=pt()[y/4+2],a=pt()[y/4+3],d=i,p=o;if(a)throw d=0,p=0,Wn(c);return t=d,n=p,Rr(d,p)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(t,n,1)}}getAllShortcuts(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getAllShortcuts(p,this.__wbg_ptr);var n=pt()[p/4+0],i=pt()[p/4+1],o=pt()[p/4+2],c=pt()[p/4+3],a=n,d=i;if(c)throw a=0,d=0,Wn(o);return e=a,t=d,Rr(a,d)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_toSavefile(p,this.__wbg_ptr);var n=pt()[p/4+0],i=pt()[p/4+1],o=pt()[p/4+2],c=pt()[p/4+3],a=n,d=i;if(c)throw a=0,d=0,Wn(o);return e=a,t=d,Rr(a,d)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}loadSavefile(e){try{const i=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_loadSavefile(i,this.__wbg_ptr,lr(e));var t=pt()[i/4+0],n=pt()[i/4+1];if(n)throw Wn(t)}finally{We.__wbindgen_add_to_stack_pointer(16)}}compareRoute(e,t,n,i,o){let c,a;try{const M=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_compareRoute(M,this.__wbg_ptr,e,t,n,i,o);var d=pt()[M/4+0],p=pt()[M/4+1],y=pt()[M/4+2],_=pt()[M/4+3],w=d,T=p;if(_)throw w=0,T=0,Wn(y);return c=w,a=T,Rr(w,T)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(c,a,1)}}impactToOneDestination(e,t){let n,i;try{const _=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_impactToOneDestination(_,this.__wbg_ptr,e,t);var o=pt()[_/4+0],c=pt()[_/4+1],a=pt()[_/4+2],d=pt()[_/4+3],p=o,y=c;if(d)throw p=0,y=0,Wn(a);return n=p,i=y,Rr(p,y)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(n,i,1)}}predictImpact(e){let t,n;try{const y=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_predictImpact(y,this.__wbg_ptr,e);var i=pt()[y/4+0],o=pt()[y/4+1],c=pt()[y/4+2],a=pt()[y/4+3],d=i,p=o;if(a)throw d=0,p=0,Wn(c);return t=d,n=p,Rr(d,p)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(t,n,1)}}getImpactsOnRoad(e,t){let n,i;try{const _=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getImpactsOnRoad(_,this.__wbg_ptr,e,t);var o=pt()[_/4+0],c=pt()[_/4+1],a=pt()[_/4+2],d=pt()[_/4+3],p=o,y=c;if(d)throw p=0,y=0,Wn(a);return n=p,i=y,Rr(p,y)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(n,i,1)}}getAllNeighbourhoods(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getAllNeighbourhoods(p,this.__wbg_ptr);var n=pt()[p/4+0],i=pt()[p/4+1],o=pt()[p/4+2],c=pt()[p/4+3],a=n,d=i;if(c)throw a=0,d=0,Wn(o);return e=a,t=d,Rr(a,d)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}getAllIntersections(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getAllIntersections(p,this.__wbg_ptr);var n=pt()[p/4+0],i=pt()[p/4+1],o=pt()[p/4+2],c=pt()[p/4+3],a=n,d=i;if(c)throw a=0,d=0,Wn(o);return e=a,t=d,Rr(a,d)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}getMovements(e){let t,n;try{const y=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getMovements(y,this.__wbg_ptr,e);var i=pt()[y/4+0],o=pt()[y/4+1],c=pt()[y/4+2],a=pt()[y/4+3],d=i,p=o;if(a)throw d=0,p=0,Wn(c);return t=d,n=p,Rr(d,p)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(t,n,1)}}getDemandModel(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getDemandModel(p,this.__wbg_ptr);var n=pt()[p/4+0],i=pt()[p/4+1],o=pt()[p/4+2],c=pt()[p/4+3],a=n,d=i;if(c)throw a=0,d=0,Wn(o);return e=a,t=d,Rr(a,d)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}getPOIs(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getPOIs(p,this.__wbg_ptr);var n=pt()[p/4+0],i=pt()[p/4+1],o=pt()[p/4+2],c=pt()[p/4+3],a=n,d=i;if(c)throw a=0,d=0,Wn(o);return e=a,t=d,Rr(a,d)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}}async function J6(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Y6(){const r={};return r.wbg={},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Rr(e,t));return lr(n)},r.wbg.__wbindgen_string_get=function(e,t){const n=Ln(t),i=typeof n=="string"?n:void 0;var o=Ic(i)?0:Io(i,We.__wbindgen_malloc,We.__wbindgen_realloc),c=bi;pt()[e/4+1]=c,pt()[e/4+0]=o},r.wbg.__wbindgen_object_drop_ref=function(e){Wn(e)},r.wbg.__wbindgen_string_new=function(e,t){const n=Rr(e,t);return lr(n)},r.wbg.__wbindgen_boolean_get=function(e){const t=Ln(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof Ln(e)=="bigint"},r.wbg.__wbindgen_number_get=function(e,t){const n=Ln(t),i=typeof n=="number"?n:void 0;Ov()[e/8+1]=Ic(i)?0:i,pt()[e/4+0]=!Ic(i)},r.wbg.__wbindgen_is_object=function(e){const t=Ln(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return Ln(e)in Ln(t)},r.wbg.__wbindgen_bigint_from_i64=function(e){return lr(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return Ln(e)===Ln(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return lr(t)},r.wbg.__wbindgen_is_undefined=function(e){return Ln(e)===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Ln(e)==Ln(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Ln(e);return lr(t)},r.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,t){const n=Ln(e)[Ln(t)];return lr(n)},r.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(Ln(e))},r.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(Ln(e))},r.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(Ln(e))},r.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(Ln(e))},r.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(Ln(e))},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return lr(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Ln(t).stack,i=Io(n,We.__wbindgen_malloc,We.__wbindgen_realloc),o=bi;pt()[e/4+1]=o,pt()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(Rr(e,t))}finally{We.__wbindgen_free(n,i,1)}},r.wbg.__wbg_performance_3f3012faa4463882=function(e){const t=Ln(e).performance;return lr(t)},r.wbg.__wbg_now_2fd65358804c9485=function(e){return Ln(e).now()},r.wbg.__wbg_get_f01601b5a68d10e3=function(e,t){const n=Ln(e)[t>>>0];return lr(n)},r.wbg.__wbg_length_1009b1af0c481d7b=function(e){return Ln(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Ln(e)=="function"},r.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,t){const n=new Function(Rr(e,t));return lr(n)},r.wbg.__wbg_next_9b877f231f476d01=function(e){const t=Ln(e).next;return lr(t)},r.wbg.__wbg_next_6529ee0cca8d57ed=function(){return fl(function(e){const t=Ln(e).next();return lr(t)},arguments)},r.wbg.__wbg_done_5fe336b092d60cf2=function(e){return Ln(e).done},r.wbg.__wbg_value_0c248a78fdc8e19f=function(e){const t=Ln(e).value;return lr(t)},r.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return lr(Symbol.iterator)},r.wbg.__wbg_get_7b48513de5dc5ea4=function(){return fl(function(e,t){const n=Reflect.get(Ln(e),Ln(t));return lr(n)},arguments)},r.wbg.__wbg_call_90c26b09837aba1c=function(){return fl(function(e,t){const n=Ln(e).call(Ln(t));return lr(n)},arguments)},r.wbg.__wbg_self_f0e34d89f33b99fd=function(){return fl(function(){const e=self.self;return lr(e)},arguments)},r.wbg.__wbg_window_d3b084224f4774d7=function(){return fl(function(){const e=window.window;return lr(e)},arguments)},r.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return fl(function(){const e=globalThis.globalThis;return lr(e)},arguments)},r.wbg.__wbg_global_35dfdd59a4da3e74=function(){return fl(function(){const e=global.global;return lr(e)},arguments)},r.wbg.__wbg_isArray_74fb723e24f76012=function(e){return Array.isArray(Ln(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let t;try{t=Ln(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(e){return Number.isSafeInteger(Ln(e))},r.wbg.__wbg_entries_9e2e2aa45aa5094a=function(e){const t=Object.entries(Ln(e));return lr(t)},r.wbg.__wbg_buffer_a448f833075b71ba=function(e){const t=Ln(e).buffer;return lr(t)},r.wbg.__wbg_new_8f67e318f15d7254=function(e){const t=new Uint8Array(Ln(e));return lr(t)},r.wbg.__wbg_set_2357bf09366ee480=function(e,t,n){Ln(e).set(Ln(t),n>>>0)},r.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return Ln(e).length},r.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let t;try{t=Ln(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=Ln(t),i=typeof n=="bigint"?n:void 0;H6()[e/8+1]=Ic(i)?BigInt(0):i,pt()[e/4+0]=!Ic(i)},r.wbg.__wbindgen_debug_string=function(e,t){const n=Em(Ln(t)),i=Io(n,We.__wbindgen_malloc,We.__wbindgen_realloc),o=bi;pt()[e/4+1]=o,pt()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Rr(e,t))},r.wbg.__wbindgen_memory=function(){const e=We.memory;return lr(e)},r}function Q6(r,e){return We=r.exports,Nv.__wbindgen_wasm_module=e,nh=null,th=null,eh=null,Qu=null,We}async function Nv(r){if(We!==void 0)return We;typeof r>"u"&&(r="/ltn/assets/backend_bg.wasm");const e=Y6();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await J6(await r,e);return Q6(t,n)}const eM=r=>({}),Yy=r=>({}),tM=r=>({}),Qy=r=>({}),nM=r=>({}),e1=r=>({});function rM(r){let e,t,n,i,o,c,a,d;const p=r[1].top,y=Sn(p,r,r[0],e1),_=r[1].left,w=Sn(_,r,r[0],Qy),T=r[1].main,M=Sn(T,r,r[0],Yy);return{c(){e=U("div"),t=U("div"),y&&y.c(),n=oe(),i=U("div"),o=U("div"),w&&w.c(),c=oe(),a=U("div"),M&&M.c(),de(t,"class","top svelte-29q570"),de(o,"class","left svelte-29q570"),de(a,"class","main svelte-29q570"),de(i,"class","content svelte-29q570"),de(e,"class","flex-container svelte-29q570")},m($,P){q($,e,P),R(e,t),y&&y.m(t,null),R(e,n),R(e,i),R(i,o),w&&w.m(o,null),R(i,c),R(i,a),M&&M.m(a,null),d=!0},p($,[P]){y&&y.p&&(!d||P&1)&&Tn(y,p,$,$[0],d?Cn(p,$[0],P,nM):Mn($[0]),e1),w&&w.p&&(!d||P&1)&&Tn(w,_,$,$[0],d?Cn(_,$[0],P,tM):Mn($[0]),Qy),M&&M.p&&(!d||P&1)&&Tn(M,T,$,$[0],d?Cn(T,$[0],P,eM):Mn($[0]),Yy)},i($){d||(j(y,$),j(w,$),j(M,$),d=!0)},o($){Z(y,$),Z(w,$),Z(M,$),d=!1},d($){$&&V(e),y&&y.d($),w&&w.d($),M&&M.d($)}}}function iM(r,e,t){let{$$slots:n={},$$scope:i}=e;return r.$$set=o=>{"$$scope"in o&&t(0,i=o.$$scope)},[i,n]}class oM extends Lt{constructor(e){super(),Mt(this,e,iM,rM,vt,{})}}const sM=r=>({}),t1=r=>({}),aM=r=>({}),n1=r=>({}),lM=r=>({}),r1=r=>({});function cM(r){let e,t,n,i,o,c;const a=r[4].top,d=Sn(a,r,r[3],r1),p=r[4].sidebar,y=Sn(p,r,r[3],n1),_=r[4].map,w=Sn(_,r,r[3],t1);return{c(){e=U("div"),d&&d.c(),t=oe(),n=U("div"),y&&y.c(),i=oe(),o=U("div"),w&&w.c()},m(T,M){q(T,e,M),d&&d.m(e,null),r[5](e),q(T,t,M),q(T,n,M),y&&y.m(n,null),r[6](n),q(T,i,M),q(T,o,M),w&&w.m(o,null),r[7](o),c=!0},p(T,[M]){d&&d.p&&(!c||M&8)&&Tn(d,a,T,T[3],c?Cn(a,T[3],M,lM):Mn(T[3]),r1),y&&y.p&&(!c||M&8)&&Tn(y,p,T,T[3],c?Cn(p,T[3],M,aM):Mn(T[3]),n1),w&&w.p&&(!c||M&8)&&Tn(w,_,T,T[3],c?Cn(_,T[3],M,sM):Mn(T[3]),t1)},i(T){c||(j(d,T),j(y,T),j(w,T),c=!0)},o(T){Z(d,T),Z(y,T),Z(w,T),c=!1},d(T){T&&(V(e),V(t),V(n),V(i),V(o)),d&&d.d(T),r[5](null),y&&y.d(T),r[6](null),w&&w.d(T),r[7](null)}}}function uM(r,e,t){let n,i,o;at(r,Im,_=>t(0,n=_)),at(r,Am,_=>t(1,i=_)),at(r,Pm,_=>t(2,o=_));let{$$slots:c={},$$scope:a}=e;function d(_){hn[_?"unshift":"push"](()=>{n=_,Im.set(n)})}function p(_){hn[_?"unshift":"push"](()=>{i=_,Am.set(i)})}function y(_){hn[_?"unshift":"push"](()=>{o=_,Pm.set(o)})}return r.$$set=_=>{"$$scope"in _&&t(3,a=_.$$scope)},[n,i,o,a,c,d,p,y]}class bo extends Lt{constructor(e){super(),Mt(this,e,uM,cM,vt,{})}}let Im=An(null),Am=An(null),Pm=An(null);const hM="/ltn/assets/streets-v2-style-b76f3b8b.json";function fM(r){let e;return{c(){e=xe("Back")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function dM(r){let e,t,n,i;return e=new $n({props:{$$slots:{default:[fM]},$$scope:{ctx:r}}}),e.$on("click",r[2]),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0,n||(i=wt(window,"keydown",r[1]),n=!0)},p(o,[c]){const a={};c&8&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o),n=!1,i()}}}function pM(r){let e=ms();function t(i){i.key=="Escape"&&(i.stopPropagation(),e("click"))}return[e,t,()=>e("click")]}class na extends Lt{constructor(e){super(),Mt(this,e,pM,dM,vt,{})}}let yd=An(null);function i1(r,e,t){const n=r.slice();return n[37]=e[t],n[38]=e,n[39]=t,n}function o1(r,e,t){const n=r.slice();return n[40]=e[t],n[41]=e,n[42]=t,n}function mM(r){let e,t=r[6].length+"",n,i;return{c(){e=xe("Undo ("),n=xe(t),i=xe(")")},m(o,c){q(o,e,c),q(o,n,c),q(o,i,c)},p(o,c){c[0]&64&&t!==(t=o[6].length+"")&&Tt(n,t)},d(o){o&&(V(e),V(n),V(i))}}}function gM(r){let e;return{c(){e=xe("Undo")},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function _M(r){let e;return{c(){e=U("span"),de(e,"class","dot svelte-11yzwwb"),Qt(e,"snapped-node",r[40].snapped),Qt(e,"free-node",!r[40].snapped),Qt(e,"hide",r[4])},m(t,n){q(t,e,n)},p(t,n){n[0]&128&&Qt(e,"snapped-node",t[40].snapped),n[0]&128&&Qt(e,"free-node",!t[40].snapped),n[0]&16&&Qt(e,"hide",t[4])},d(t){t&&V(e)}}}function s1(r){let e,t,n;function i(p){r[23](p,r[40])}function o(){return r[24](r[40])}function c(){return r[25](r[40])}function a(){return r[26](r[40])}let d={draggable:!0,zIndex:0,$$slots:{default:[_M]},$$scope:{ctx:r}};return r[40].point!==void 0&&(d.lngLat=r[40].point),e=new Sd({props:d}),hn.push(()=>In(e,"lngLat",i)),e.$on("dragstart",o),e.$on("drag",c),e.$on("dragend",r[16]),e.$on("click",a),{c(){fe(e.$$.fragment)},m(p,y){ue(e,p,y),n=!0},p(p,y){r=p;const _={};y[0]&144|y[1]&4096&&(_.$$scope={dirty:y,ctx:r}),!t&&y[0]&128&&(t=!0,_.lngLat=r[40].point,En(()=>t=!1)),e.$set(_)},i(p){n||(j(e.$$.fragment,p),n=!0)},o(p){Z(e.$$.fragment,p),n=!1},d(p){he(e,p)}}}function yM(r){let e;return{c(){e=U("ul"),e.innerHTML=`<li><b>Click and drag</b>
          to move</li> <li><b>Click</b>
          to toggle snapping</li> <li><b>Right click</b>
          to delete</li>`,st(e,"padding-right","0"),st(e,"padding-left","20px"),st(e,"margin","0")},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function bM(r){let e,t,n,i;return n=new Qb({props:{openOn:"hover",popupClass:"edit-waypoint-popup",$$slots:{default:[yM]},$$scope:{ctx:r}}}),{c(){e=U("span"),e.textContent=`${r[39]+1}`,t=oe(),fe(n.$$.fragment),de(e,"class","dot svelte-11yzwwb"),Qt(e,"snapped",r[37].snapped)},m(o,c){q(o,e,c),q(o,t,c),ue(n,o,c),i=!0},p(o,c){(!i||c[0]&1)&&Qt(e,"snapped",o[37].snapped);const a={};c[1]&4096&&(a.$$scope={dirty:c,ctx:o}),n.$set(a)},i(o){i||(j(n.$$.fragment,o),i=!0)},o(o){Z(n.$$.fragment,o),i=!1},d(o){o&&(V(e),V(t)),he(n,o)}}}function a1(r){let e,t,n;function i(d){r[27](d,r[37])}function o(){return r[28](r[39])}function c(){return r[29](r[39])}let a={draggable:!0,zIndex:1,$$slots:{default:[bM]},$$scope:{ctx:r}};return r[37].point!==void 0&&(a.lngLat=r[37].point),e=new Sd({props:a}),hn.push(()=>In(e,"lngLat",i)),e.$on("click",o),e.$on("contextmenu",c),e.$on("mouseenter",r[30]),e.$on("mouseleave",r[31]),e.$on("dragstart",r[17]),e.$on("dragend",r[32]),{c(){fe(e.$$.fragment)},m(d,p){ue(e,d,p),n=!0},p(d,p){r=d;const y={};p[0]&1|p[1]&4096&&(y.$$scope={dirty:p,ctx:r}),!t&&p[0]&1&&(t=!0,y.lngLat=r[37].point,En(()=>t=!1)),e.$set(y)},i(d){n||(j(e.$$.fragment,d),n=!0)},o(d){Z(e.$$.fragment,d),n=!1},d(d){he(e,d)}}}function vM(r){let e,t,n,i;const o=[mn("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let c={};for(let p=0;p<o.length;p+=1)c=Bt(c,o[p]);e=new sr({props:c});const a=[mn("draw-area-area"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let d={};for(let p=0;p<a.length;p+=1)d=Bt(d,a[p]);return n=new Hi({props:d}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment)},m(p,y){ue(e,p,y),q(p,t,y),ue(n,p,y),i=!0},p(p,y){const _={};e.$set(_);const w={};n.$set(w)},i(p){i||(j(e.$$.fragment,p),j(n.$$.fragment,p),i=!0)},o(p){Z(e.$$.fragment,p),Z(n.$$.fragment,p),i=!1},d(p){p&&V(t),he(e,p),he(n,p)}}}function wM(r){let e,t;const n=[mn("draw-area-lines-preview"),{paint:{"line-color":"black","line-width":3}}];let i={};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new sr({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function xM(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M,$,P,D,I,F,N,W,se;function J(Ge,Ee){return Ge[6].length==0?gM:mM}let ee=J(r),me=ee(r);w=new Xm({}),w.$on("click",r[10]),w.$on("mousemove",r[11]);let Ie=Rn(r[7]),Q=[];for(let Ge=0;Ge<Ie.length;Ge+=1)Q[Ge]=s1(o1(r,Ie,Ge));const ae=Ge=>Z(Q[Ge],1,1,()=>{Q[Ge]=null});let Pe=Rn(r[0]),ve=[];for(let Ge=0;Ge<Pe.length;Ge+=1)ve[Ge]=a1(i1(r,Pe,Ge));const tt=Ge=>Z(ve[Ge],1,1,()=>{ve[Ge]=null});return P=new dr({props:{data:r[1]||Ki(),generateId:!0,$$slots:{default:[vM]},$$scope:{ctx:r}}}),I=new dr({props:{data:r[8],$$slots:{default:[wM]},$$scope:{ctx:r}}}),N=Fm(r[22][0]),{c(){e=U("p"),e.textContent="Click the map to add three points. Then adjust the points or add more.",t=oe(),n=U("div"),i=U("label"),o=U("input"),a=xe(`
    Snap boundary to roads`),d=oe(),p=U("button"),me.c(),_=oe(),fe(w.$$.fragment),T=oe();for(let Ge=0;Ge<Q.length;Ge+=1)Q[Ge].c();M=oe();for(let Ge=0;Ge<ve.length;Ge+=1)ve[Ge].c();$=oe(),fe(P.$$.fragment),D=oe(),fe(I.$$.fragment),o.disabled=c=r[0].length>=3,de(o,"type","checkbox"),o.__value="snap",qn(o,o.__value),de(p,"class","secondary"),p.disabled=y=r[6].length==0,st(n,"display","flex"),st(n,"gap","16px"),N.p(o)},m(Ge,Ee){q(Ge,e,Ee),q(Ge,t,Ee),q(Ge,n,Ee),R(n,i),R(i,o),o.checked=~(r[5]||[]).indexOf(o.__value),R(i,a),R(n,d),R(n,p),me.m(p,null),q(Ge,_,Ee),ue(w,Ge,Ee),q(Ge,T,Ee);for(let $e=0;$e<Q.length;$e+=1)Q[$e]&&Q[$e].m(Ge,Ee);q(Ge,M,Ee);for(let $e=0;$e<ve.length;$e+=1)ve[$e]&&ve[$e].m(Ge,Ee);q(Ge,$,Ee),ue(P,Ge,Ee),q(Ge,D,Ee),ue(I,Ge,Ee),F=!0,W||(se=[wt(o,"change",r[21]),wt(p,"click",r[9])],W=!0)},p(Ge,Ee){if((!F||Ee[0]&1&&c!==(c=Ge[0].length>=3))&&(o.disabled=c),Ee[0]&32&&(o.checked=~(Ge[5]||[]).indexOf(o.__value)),ee===(ee=J(Ge))&&me?me.p(Ge,Ee):(me.d(1),me=ee(Ge),me&&(me.c(),me.m(p,null))),(!F||Ee[0]&64&&y!==(y=Ge[6].length==0))&&(p.disabled=y),Ee[0]&114832){Ie=Rn(Ge[7]);let rt;for(rt=0;rt<Ie.length;rt+=1){const lt=o1(Ge,Ie,rt);Q[rt]?(Q[rt].p(lt,Ee),j(Q[rt],1)):(Q[rt]=s1(lt),Q[rt].c(),j(Q[rt],1),Q[rt].m(M.parentNode,M))}for(en(),rt=Ie.length;rt<Q.length;rt+=1)ae(rt);tn()}if(Ee[0]&143373){Pe=Rn(Ge[0]);let rt;for(rt=0;rt<Pe.length;rt+=1){const lt=i1(Ge,Pe,rt);ve[rt]?(ve[rt].p(lt,Ee),j(ve[rt],1)):(ve[rt]=a1(lt),ve[rt].c(),j(ve[rt],1),ve[rt].m($.parentNode,$))}for(en(),rt=Pe.length;rt<ve.length;rt+=1)tt(rt);tn()}const $e={};Ee[0]&2&&($e.data=Ge[1]||Ki()),Ee[1]&4096&&($e.$$scope={dirty:Ee,ctx:Ge}),P.$set($e);const St={};Ee[0]&256&&(St.data=Ge[8]),Ee[1]&4096&&(St.$$scope={dirty:Ee,ctx:Ge}),I.$set(St)},i(Ge){if(!F){j(w.$$.fragment,Ge);for(let Ee=0;Ee<Ie.length;Ee+=1)j(Q[Ee]);for(let Ee=0;Ee<Pe.length;Ee+=1)j(ve[Ee]);j(P.$$.fragment,Ge),j(I.$$.fragment,Ge),F=!0}},o(Ge){Z(w.$$.fragment,Ge),Q=Q.filter(Boolean);for(let Ee=0;Ee<Q.length;Ee+=1)Z(Q[Ee]);ve=ve.filter(Boolean);for(let Ee=0;Ee<ve.length;Ee+=1)Z(ve[Ee]);Z(P.$$.fragment,Ge),Z(I.$$.fragment,Ge),F=!1},d(Ge){Ge&&(V(e),V(t),V(n),V(_),V(T),V(M),V($),V(D)),me.d(),he(w,Ge),di(Q,Ge),di(ve,Ge),he(P,Ge),he(I,Ge),N.r(),W=!1,pr(se)}}}function kM(r,e){if(e.length<3)return JSON.parse(r.inner.calculateRoute(e));let t=JSON.parse(JSON.stringify(e));t.push(t[0]);let n=JSON.parse(r.inner.calculateRoute(t));return n.properties.waypoints.pop(),n.geometry.type="Polygon",n.geometry.coordinates=[n.geometry.coordinates],n}function SM(r,e,t){let n,i;at(r,yd,Xe=>t(20,i=Xe));let{map:o}=e,{waypoints:c}=e,{drawnShapeOut:a=void 0}=e;Yr(()=>{i==null||i.stop(),o.getCanvas().style.cursor="inherit"});let d="snap",p=[],y=[],_=null,w=!1,T=!1,M=!1;function $(Xe){let Dt=Xe.length==0?"crosshair":"inherit";o.getCanvas().style.cursor=Dt}function P(){let Xe=p.pop();t(6,p),Xe&&t(0,c=Xe)}function D(){p.length==100&&p.shift(),t(6,p=[...p,JSON.parse(JSON.stringify(c))])}function I(Xe){c.length>=3||(D(),c.push({point:Xe.detail.lngLat.toArray(),snapped:d=="snap"}),t(0,c))}function F(Xe){t(19,_={point:Xe.detail.lngLat.toArray(),snapped:d=="snap"})}function N(Xe){D(),t(0,c[Xe].snapped=!c[Xe].snapped,c),t(0,c)}function W(Xe){D(),c.splice(Xe,1),t(0,c),t(2,w=!1)}function se(Xe,Dt,_t,$t){if($t||Dt.length>=3)return Ki();try{if(Xe&&Dt.length>0&&_t)return JSON.parse(Xe.inner.calculateRoute([Dt[Dt.length-1],_t]))}catch{}return Ki()}function J(Xe,Dt,_t){if(_t)return;if(!Xe||Dt.length<3){t(7,y=[]);return}let $t=[],Et=1,Yt=JSON.parse(JSON.stringify(Dt));Yt.push(Yt[0]);for(let _n=0;_n<Yt.length-1;_n++){let Zt=JSON.parse(Xe.inner.getExtraNodes(Yt[_n],Yt[_n+1]));for(let[ln,ze,Ne]of Zt)$t.push({point:[ln,ze],snapped:Ne,insertIdx:Et});Et++}t(7,y=$t)}function ee(Xe){D(),c.splice(Xe.insertIdx,0,{point:Xe.point,snapped:Xe.snapped}),t(0,c),t(4,M=!0)}function me(Xe){t(0,c[Xe.insertIdx].point=Xe.point,c),t(0,c)}function Ie(){t(4,M=!1)}function Q(){D(),t(3,T=!0)}const ae=[[]];function Pe(){d=J2(ae[0],this.__value,this.checked),t(5,d)}function ve(Xe,Dt){r.$$.not_equal(Dt.point,Xe)&&(Dt.point=Xe,t(7,y))}const tt=Xe=>ee(Xe),Ge=Xe=>me(Xe),Ee=Xe=>{ee(Xe),t(4,M=!1)};function $e(Xe,Dt){r.$$.not_equal(Dt.point,Xe)&&(Dt.point=Xe,t(0,c))}const St=Xe=>N(Xe),rt=Xe=>W(Xe),lt=()=>t(2,w=!0),mt=()=>t(2,w=!1),ft=()=>t(3,T=!1);return r.$$set=Xe=>{"map"in Xe&&t(18,o=Xe.map),"waypoints"in Xe&&t(0,c=Xe.waypoints),"drawnShapeOut"in Xe&&t(1,a=Xe.drawnShapeOut)},r.$$.update=()=>{if(r.$$.dirty[0]&1048577)try{i&&t(1,a=kM(i,c))}catch(Xe){console.log("error drawing shape",Xe),t(1,a=void 0)}r.$$.dirty[0]&1048593&&J(i,c,M),r.$$.dirty[0]&1572877&&t(8,n=se(i,c,_,w||T)),r.$$.dirty[0]&1&&$(c)},[c,a,w,T,M,d,p,y,n,P,I,F,N,W,ee,me,Ie,Q,o,_,i,Pe,ae,ve,tt,Ge,Ee,$e,St,rt,lt,mt,ft]}class jv extends Lt{constructor(e){super(),Mt(this,e,SM,xM,vt,{map:18,waypoints:0,drawnShapeOut:1},null,[-1,-1])}}function l1(r){let e,t,n,i,o=Math.round(r[0].properties.population/r[0].properties.area_km2).toLocaleString()+"",c,a,d,p,y,_,w,T=r[0].properties.simd.toFixed(1)+"",M,$,P,D,I,F,N,W=(r[0].properties.number_stats19_collisions/r[0].properties.area_km2).toFixed(1)+"",se,J,ee,me,Ie,Q,ae,Pe=Bc(r[0].properties.households_with_cars_or_vans,r[0].properties.total_households)+"",ve,tt,Ge,Ee,$e,St,rt,lt=(r[0].properties.number_pois/r[0].properties.area_km2).toFixed(1)+"",mt,ft;return{c(){e=U("tr"),t=U("th"),t.textContent="Population density",n=oe(),i=U("td"),c=xe(o),a=xe(" people / km"),d=oe(),p=U("tr"),y=U("th"),y.textContent="SIMD",_=oe(),w=U("td"),M=xe(T),$=xe("%"),P=oe(),D=U("tr"),I=U("th"),I.textContent="Collision density",F=oe(),N=U("td"),se=xe(W),J=xe(" / km"),ee=oe(),me=U("tr"),Ie=U("th"),Ie.textContent="Car ownership",Q=oe(),ae=U("td"),ve=xe(Pe),tt=xe(" of households"),Ge=oe(),Ee=U("tr"),$e=U("th"),$e.textContent="POI density",St=oe(),rt=U("td"),mt=xe(lt),ft=xe(" / km")},m(Xe,Dt){q(Xe,e,Dt),R(e,t),R(e,n),R(e,i),R(i,c),R(i,a),q(Xe,d,Dt),q(Xe,p,Dt),R(p,y),R(p,_),R(p,w),R(w,M),R(w,$),q(Xe,P,Dt),q(Xe,D,Dt),R(D,I),R(D,F),R(D,N),R(N,se),R(N,J),q(Xe,ee,Dt),q(Xe,me,Dt),R(me,Ie),R(me,Q),R(me,ae),R(ae,ve),R(ae,tt),q(Xe,Ge,Dt),q(Xe,Ee,Dt),R(Ee,$e),R(Ee,St),R(Ee,rt),R(rt,mt),R(rt,ft)},p(Xe,Dt){Dt&1&&o!==(o=Math.round(Xe[0].properties.population/Xe[0].properties.area_km2).toLocaleString()+"")&&Tt(c,o),Dt&1&&T!==(T=Xe[0].properties.simd.toFixed(1)+"")&&Tt(M,T),Dt&1&&W!==(W=(Xe[0].properties.number_stats19_collisions/Xe[0].properties.area_km2).toFixed(1)+"")&&Tt(se,W),Dt&1&&Pe!==(Pe=Bc(Xe[0].properties.households_with_cars_or_vans,Xe[0].properties.total_households)+"")&&Tt(ve,Pe),Dt&1&&lt!==(lt=(Xe[0].properties.number_pois/Xe[0].properties.area_km2).toFixed(1)+"")&&Tt(mt,lt)},d(Xe){Xe&&(V(e),V(d),V(p),V(P),V(D),V(ee),V(me),V(Ge),V(Ee))}}}function CM(r){let e,t,n,i,o,c=r[0].properties.area_km2.toFixed(1)+"",a,d,p,y=r[1]=="cnt"&&l1(r);return{c(){e=U("table"),t=U("tr"),n=U("th"),n.textContent="Area",i=oe(),o=U("td"),a=xe(c),d=xe(" km"),p=oe(),y&&y.c(),de(e,"class","svelte-1kpsyee")},m(_,w){q(_,e,w),R(e,t),R(t,n),R(t,i),R(t,o),R(o,a),R(o,d),R(e,p),y&&y.m(e,null)},p(_,[w]){w&1&&c!==(c=_[0].properties.area_km2.toFixed(1)+"")&&Tt(a,c),_[1]=="cnt"?y?y.p(_,w):(y=l1(_),y.c(),y.m(e,null)):y&&(y.d(1),y=null)},i:et,o:et,d(_){_&&V(e),y&&y.d()}}}function TM(r,e,t){let n;at(r,Fo,o=>t(1,n=o));let{neighbourhoodBoundary:i}=e;return r.$$set=o=>{"neighbourhoodBoundary"in o&&t(0,i=o.neighbourhoodBoundary)},[i,n]}class Uv extends Lt{constructor(e){super(),Mt(this,e,TM,CM,vt,{neighbourhoodBoundary:0})}}function Vv(r,e,t){let n=new Set(r.toSavefile().features.filter(i=>i.properties.kind=="boundary").map(i=>i.properties.name));for(;;){let i=window.prompt(e,t);if(i===null)return null;if(i=i.trim(),i==="")window.alert("Neighbourhood cannot be blank; please pick a name or cancel");else if(n.has(i))window.alert(`There is already a neighbourhood called ${i}; please pick another name`);else return i}}function MM(r){let e,t,n,i;return e=new Oo({props:{colorScale:yv,labels:{limits:_v}}}),{c(){fe(e.$$.fragment),t=oe(),n=U("div"),n.textContent="POIs / km",st(n,"text-align","center")},m(o,c){ue(e,o,c),q(o,t,c),q(o,n,c),i=!0},i(o){i||(j(e.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),i=!1},d(o){o&&(V(t),V(n)),he(e,o)}}}function LM(r){let e,t,n,i;return e=new Oo({props:{colorScale:gv,labels:{limits:mv}}}),{c(){fe(e.$$.fragment),t=oe(),n=U("div"),n.textContent="collisions / km",st(n,"text-align","center")},m(o,c){ue(e,o,c),q(o,t,c),q(o,n,c),i=!0},i(o){i||(j(e.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),i=!1},d(o){o&&(V(t),V(n)),he(e,o)}}}function EM(r){let e,t,n,i;return e=new Oo({props:{colorScale:Td,labels:{buckets:bv(Md)}}}),{c(){fe(e.$$.fragment),t=oe(),n=U("div"),n.innerHTML="<span>More deprived</span> <span>Less deprived</span>",de(n,"class","sub-labels svelte-3xhwrh")},m(o,c){ue(e,o,c),q(o,t,c),q(o,n,c),i=!0},i(o){i||(j(e.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),i=!1},d(o){o&&(V(t),V(n)),he(e,o)}}}function IM(r){let e,t,n,i;return e=new Oo({props:{colorScale:Ad,labels:{limits:Id.map(zM)}}}),{c(){fe(e.$$.fragment),t=oe(),n=U("div"),n.innerHTML='<span style="text-align: center; width: 100%">Households with at least one car or van</span>',st(n,"display","flex"),st(n,"justify-content","space-between")},m(o,c){ue(e,o,c),q(o,t,c),q(o,n,c),i=!0},i(o){i||(j(e.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),i=!1},d(o){o&&(V(t),V(n)),he(e,o)}}}function AM(r){let e,t,n,i;return e=new Oo({props:{colorScale:Ld,labels:{limits:Ed}}}),{c(){fe(e.$$.fragment),t=oe(),n=U("div"),n.innerHTML="<span>Less dense</span> <span>people / km</span> <span>More dense</span>",de(n,"class","sub-labels svelte-3xhwrh")},m(o,c){ue(e,o,c),q(o,t,c),q(o,n,c),i=!0},i(o){i||(j(e.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),i=!1},d(o){o&&(V(t),V(n)),he(e,o)}}}function PM(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M,$,P,D;const I=[AM,IM,EM,LM,MM],F=[];function N(W,se){return W[0]=="density"?0:W[0]=="car_ownership"?1:W[0]=="simd"?2:W[0]=="stats19"?3:W[0]=="pois"?4:-1}return~(w=N(r))&&(T=F[w]=I[w](r)),{c(){e=U("div"),t=U("label"),t.textContent="Metric",n=oe(),i=U("select"),o=U("option"),o.textContent="None",c=U("option"),c.textContent="Density",a=U("option"),a.textContent="Collisions",d=U("option"),d.textContent="SIMD",p=U("option"),p.textContent="Points of interest",y=U("option"),y.textContent="Car ownership",_=oe(),T&&T.c(),M=Xn(),de(t,"for","prioritization-selection"),o.__value="none",qn(o,o.__value),c.__value="density",qn(c,c.__value),a.__value="stats19",qn(a,a.__value),d.__value="simd",qn(d,d.__value),p.__value="pois",qn(p,p.__value),y.__value="car_ownership",qn(y,y.__value),de(i,"id","prioritization-selection"),r[0]===void 0&&us(()=>r[1].call(i)),st(e,"display","flex"),st(e,"gap","16px"),st(e,"align-items","center")},m(W,se){q(W,e,se),R(e,t),R(e,n),R(e,i),R(i,o),R(i,c),R(i,a),R(i,d),R(i,p),R(i,y),Zi(i,r[0],!0),q(W,_,se),~w&&F[w].m(W,se),q(W,M,se),$=!0,P||(D=wt(i,"change",r[1]),P=!0)},p(W,[se]){se&1&&Zi(i,W[0]);let J=w;w=N(W),w!==J&&(T&&(en(),Z(F[J],1,1,()=>{F[J]=null}),tn()),~w?(T=F[w],T||(T=F[w]=I[w](W),T.c()),j(T,1),T.m(M.parentNode,M)):T=null)},i(W){$||(j(T),$=!0)},o(W){Z(T),$=!1},d(W){W&&(V(e),V(_),V(M)),~w&&F[w].d(W),P=!1,D()}}}const zM=r=>`${r}%`;function DM(r,e,t){let n;at(r,Fo,a=>t(2,n=a));let{selectedPrioritization:i}=e;function o(){let a=new URL(window.location.href).searchParams.get("prioritizationMetric");a=="density"?t(0,i="density"):a=="simd"?t(0,i="simd"):a=="stats19"?t(0,i="stats19"):a=="pois"?t(0,i="pois"):a=="car_ownership"&&t(0,i="car_ownership")}n=="cnt"?o():i="none";function c(){i=Sa(this),t(0,i)}return r.$$set=a=>{"selectedPrioritization"in a&&t(0,i=a.selectedPrioritization)},r.$$.update=()=>{if(r.$$.dirty&1){const a=new URL(window.location.href);i=="none"?a.searchParams.delete("prioritizationMetric"):a.searchParams.set("prioritizationMetric",i),history.replaceState({},"",a)}},[i,c]}class qv extends Lt{constructor(e){super(),Mt(this,e,DM,PM,vt,{selectedPrioritization:0})}}function Zv(r,e){return{none:r.none,area:co(["get","area_km2"],DS,$S),car_ownership:co(["*",100,["/",["get","households_with_cars_or_vans"],["get","total_households"]]],Id,Ad),density:co(["/",["get","population"],["get","area_km2"]],Ed,Ld),pois:co(["/",["get","number_pois"],["get","area_km2"]],_v,yv),simd:co(["get","simd"],Md,Td),stats19:co(["/",["get","number_stats19_collisions"],["get","area_km2"]],mv,gv)}[e]}function $M(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function RM(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function FM(r){let e,t,n,i,o,c,a,d,p,y,_;return o=new $n({props:{$$slots:{default:[$M]},$$scope:{ctx:r}}}),o.$on("click",Bo),d=new $n({props:{$$slots:{default:[RM]},$$scope:{ctx:r}}}),d.$on("click",r[27]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),fe(o.$$.fragment),c=oe(),a=U("li"),fe(d.$$.fragment),p=oe(),y=U("li"),y.textContent="Add a neighbourhood",de(t,"aria-label","breadcrumb"),de(e,"slot","top")},m(w,T){q(w,e,T),R(e,t),R(t,n),R(n,i),ue(o,i,null),R(n,c),R(n,a),ue(d,a,null),R(n,p),R(n,y),_=!0},p(w,T){const M={};T[1]&1&&(M.$$scope={dirty:T,ctx:w}),o.$set(M);const $={};T[1]&1&&($.$$scope={dirty:T,ctx:w}),d.$set($)},i(w){_||(j(o.$$.fragment,w),j(d.$$.fragment,w),_=!0)},o(w){Z(o.$$.fragment,w),Z(d.$$.fragment,w),_=!1},d(w){w&&V(e),he(o),he(d)}}}function c1(r){let e,t,n,i,o,c,a;function d(y){r[21](y)}let p={};return r[4]!==void 0&&(p.selectedPrioritization=r[4]),o=new qv({props:p}),hn.push(()=>In(o,"selectedPrioritization",d)),{c(){e=U("h3"),e.textContent="Prioritization",t=oe(),n=U("p"),n.textContent="Compare metrics across candidate neighbourhoods.",i=oe(),fe(o.$$.fragment)},m(y,_){q(y,e,_),q(y,t,_),q(y,n,_),q(y,i,_),ue(o,y,_),a=!0},p(y,_){const w={};!c&&_[0]&16&&(c=!0,w.selectedPrioritization=y[4],En(()=>c=!1)),o.$set(w)},i(y){a||(j(o.$$.fragment,y),a=!0)},o(y){Z(o.$$.fragment,y),a=!1},d(y){y&&(V(e),V(t),V(n),V(i)),he(o,y)}}}function u1(r){let e;return{c(){e=U("p"),e.textContent="The colors are arbitrary, just to distinguish better."},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function BM(r){let e,t,n,i,o,c,a,d;function p(w){r[24](w)}function y(w){r[25](w)}let _={map:yr(r[10])};return r[6]!==void 0&&(_.waypoints=r[6]),r[1]!==void 0&&(_.drawnShapeOut=r[1]),n=new jv({props:_}),hn.push(()=>In(n,"waypoints",p)),hn.push(()=>In(n,"drawnShapeOut",y)),{c(){e=U("div"),e.innerHTML='<h3 class="svelte-qlwqvq">1. Draw your neighbourhood</h3>',t=oe(),fe(n.$$.fragment),c=oe(),a=U("div"),a.innerHTML=`<h3 class="svelte-qlwqvq">2. Refine your boundary</h3> <p>Continue to add, delete, and move points until you&#39;re happy with
            your neighbourhood boundary. Don&#39;t worry, you can always adjust the
            boundary more later.</p>`,de(e,"class","step svelte-qlwqvq"),Qt(e,"active",!r[7]),Qt(e,"complete",r[7]),de(a,"class","step svelte-qlwqvq"),st(a,"margin-top","16px"),Qt(a,"active",r[7]),Qt(a,"complete",r[5].size>1)},m(w,T){q(w,e,T),q(w,t,T),ue(n,w,T),q(w,c,T),q(w,a,T),d=!0},p(w,T){(!d||T[0]&128)&&Qt(e,"active",!w[7]),(!d||T[0]&128)&&Qt(e,"complete",w[7]);const M={};T[0]&1024&&(M.map=yr(w[10])),!i&&T[0]&64&&(i=!0,M.waypoints=w[6],En(()=>i=!1)),!o&&T[0]&2&&(o=!0,M.drawnShapeOut=w[1],En(()=>o=!1)),n.$set(M),(!d||T[0]&128)&&Qt(a,"active",w[7]),(!d||T[0]&32)&&Qt(a,"complete",w[5].size>1)},i(w){d||(j(n.$$.fragment,w),d=!0)},o(w){Z(n.$$.fragment,w),d=!1},d(w){w&&(V(e),V(t),V(c),V(a)),he(n,w)}}}function OM(r){let e,t,n;return{c(){e=U("div"),e.innerHTML=`<h3 class="svelte-qlwqvq">1. Click an area to start your neighbourhood</h3> <p>These particular boundaries are suggested by finding roads,
            railways, and water that form severances.</p>`,t=oe(),n=U("div"),n.innerHTML='<h3 class="svelte-qlwqvq">2. Include additional areas</h3> <p>Click any adjacent areas you&#39;d like to add to your boundary.</p>',de(e,"class","step svelte-qlwqvq"),Qt(e,"active",!r[7]),Qt(e,"complete",r[7]),de(n,"class","step svelte-qlwqvq"),Qt(n,"active",r[7]),Qt(n,"complete",r[5].size>1)},m(i,o){q(i,e,o),q(i,t,o),q(i,n,o)},p(i,o){o[0]&128&&Qt(e,"active",!i[7]),o[0]&128&&Qt(e,"complete",i[7]),o[0]&128&&Qt(n,"active",i[7]),o[0]&32&&Qt(n,"complete",i[5].size>1)},i:et,o:et,d(i){i&&(V(e),V(t),V(n))}}}function NM(r){let e;function t(o,c){if(o[0]=="choose-area")return VM;if(o[0]=="draw-area")return UM}let n=t(r),i=n&&n(r);return{c(){e=U("span"),i&&i.c(),st(e,"text-align","center")},m(o,c){q(o,e,c),i&&i.m(e,null)},p(o,c){n===(n=t(o))&&i?i.p(o,c):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e,null)))},i:et,o:et,d(o){o&&V(e),i&&i.d()}}}function jM(r){let e,t;return e=new Uv({props:{neighbourhoodBoundary:r[7]}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i[0]&128&&(o.neighbourhoodBoundary=n[7]),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function UM(r){let e;function t(o,c){return o[6].length<3?ZM:qM}let n=t(r),i=n(r);return{c(){i.c(),e=Xn()},m(o,c){i.m(o,c),q(o,e,c)},p(o,c){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&V(e),i.d(o)}}}function VM(r){let e;return{c(){e=xe("Empty so far. Click an area to get started.")},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function qM(r){let e;return{c(){e=xe(`Not a valid shape yet  try dragging the points into a box
                around your neighbourhood. Note the ordering of the points.`)},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function ZM(r){let e;return{c(){e=xe(`Empty so far. Click the map to add points around your
                neighborhood to get started.`)},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function GM(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M,$,P,D,I,F,N,W,se,J,ee,me,Ie,Q,ae,Pe,ve,tt,Ge,Ee,$e,St,rt,lt,mt,ft,Xe,Dt,_t,$t,Et,Yt,_n;t=new na({}),t.$on("click",r[20]);let Zt=r[9]=="cnt"&&c1(r),ln=r[4]=="none"&&u1();const ze=[OM,BM],Ne=[];function kt(Ue,it){return Ue[0]=="choose-area"?0:Ue[0]=="draw-area"?1:-1}~(N=kt(r))&&(W=Ne[N]=ze[N](r)),tt=new Hm({});const jt=[jM,NM],_e=[];function vn(Ue,it){return Ue[7]?0:1}return mt=vn(r),ft=_e[mt]=jt[mt](r),{c(){e=U("div"),fe(t.$$.fragment),n=oe(),Zt&&Zt.c(),i=oe(),ln&&ln.c(),o=oe(),c=U("hr"),a=oe(),d=U("div"),p=U("div"),y=U("button"),_=xe("Choose area"),T=oe(),M=U("span"),M.textContent="or",$=oe(),P=U("button"),D=xe("Draw area"),F=oe(),W&&W.c(),se=oe(),J=U("div"),J.innerHTML='<h3 class="svelte-qlwqvq">3. Finished?</h3> <p>When you&#39;re done, click &quot;Create&quot;.</p>',ee=oe(),me=U("div"),Ie=U("button"),Q=xe("Create neighborhood"),Pe=oe(),ve=U("button"),fe(tt.$$.fragment),Ge=xe(" Start over"),$e=oe(),St=U("h3"),St.textContent="Your neighbourhood overall",rt=oe(),lt=U("div"),ft.c(),Xe=oe(),Dt=U("hr"),_t=oe(),$t=U("button"),$t.textContent="Export to GeoJSON",y.disabled=w=r[0]=="choose-area",de(y,"class","svelte-qlwqvq"),Qt(y,"active",r[0]=="choose-area"),st(M,"margin","0 16px"),P.disabled=I=r[0]=="draw-area",de(P,"class","svelte-qlwqvq"),Qt(P,"active",r[0]=="draw-area"),de(p,"class","modes svelte-qlwqvq"),de(J,"class","step svelte-qlwqvq"),Qt(J,"active",r[7]),Ie.disabled=ae=!r[7],de(ve,"class","destructive"),st(ve,"display","flex"),st(ve,"gap","8px"),st(ve,"align-items","center"),ve.disabled=Ee=!(r[7]||r[0]=="draw-area"&&r[6].length>0),st(me,"display","flex"),st(me,"gap","16px"),st(me,"justify-content","space-between"),st(me,"margin-bottom","16px"),de(lt,"class","neighbourhood-boundary-summary svelte-qlwqvq"),de($t,"class","secondary"),de(e,"slot","sidebar")},m(Ue,it){q(Ue,e,it),ue(t,e,null),R(e,n),Zt&&Zt.m(e,null),R(e,i),ln&&ln.m(e,null),R(e,o),R(e,c),R(e,a),R(e,d),R(d,p),R(p,y),R(y,_),R(p,T),R(p,M),R(p,$),R(p,P),R(P,D),R(d,F),~N&&Ne[N].m(d,null),R(d,se),R(d,J),R(d,ee),R(d,me),R(me,Ie),R(Ie,Q),R(me,Pe),R(me,ve),ue(tt,ve,null),R(ve,Ge),R(d,$e),R(d,St),R(d,rt),R(d,lt),_e[mt].m(lt,null),R(e,Xe),R(e,Dt),R(e,_t),R(e,$t),Et=!0,Yt||(_n=[wt(y,"click",r[22]),wt(P,"click",r[23]),wt(Ie,"click",r[26]),wt(ve,"click",r[16]),wt($t,"click",r[13])],Yt=!0)},p(Ue,it){Ue[9]=="cnt"?Zt?(Zt.p(Ue,it),it[0]&512&&j(Zt,1)):(Zt=c1(Ue),Zt.c(),j(Zt,1),Zt.m(e,i)):Zt&&(en(),Z(Zt,1,1,()=>{Zt=null}),tn()),Ue[4]=="none"?ln||(ln=u1(),ln.c(),ln.m(e,o)):ln&&(ln.d(1),ln=null),(!Et||it[0]&1&&w!==(w=Ue[0]=="choose-area"))&&(y.disabled=w),(!Et||it[0]&1)&&Qt(y,"active",Ue[0]=="choose-area"),(!Et||it[0]&1&&I!==(I=Ue[0]=="draw-area"))&&(P.disabled=I),(!Et||it[0]&1)&&Qt(P,"active",Ue[0]=="draw-area");let Kt=N;N=kt(Ue),N===Kt?~N&&Ne[N].p(Ue,it):(W&&(en(),Z(Ne[Kt],1,1,()=>{Ne[Kt]=null}),tn()),~N?(W=Ne[N],W?W.p(Ue,it):(W=Ne[N]=ze[N](Ue),W.c()),j(W,1),W.m(d,se)):W=null),(!Et||it[0]&128)&&Qt(J,"active",Ue[7]),(!Et||it[0]&128&&ae!==(ae=!Ue[7]))&&(Ie.disabled=ae),(!Et||it[0]&193&&Ee!==(Ee=!(Ue[7]||Ue[0]=="draw-area"&&Ue[6].length>0)))&&(ve.disabled=Ee);let ur=mt;mt=vn(Ue),mt===ur?_e[mt].p(Ue,it):(en(),Z(_e[ur],1,1,()=>{_e[ur]=null}),tn(),ft=_e[mt],ft?ft.p(Ue,it):(ft=_e[mt]=jt[mt](Ue),ft.c()),j(ft,1),ft.m(lt,null))},i(Ue){Et||(j(t.$$.fragment,Ue),j(Zt),j(W),j(tt.$$.fragment,Ue),j(ft),Et=!0)},o(Ue){Z(t.$$.fragment,Ue),Z(Zt),Z(W),Z(tt.$$.fragment,Ue),Z(ft),Et=!1},d(Ue){Ue&&V(e),he(t),Zt&&Zt.d(),ln&&ln.d(),~N&&Ne[N].d(),he(tt),_e[mt].d(),Yt=!1,pr(_n)}}}function h1(r){let e,t;return e=new dr({props:{data:{type:"FeatureCollection",features:[r[7]]},$$slots:{default:[HM]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i[0]&128&&(o.data={type:"FeatureCollection",features:[n[7]]}),i[1]&1&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function HM(r){let e,t,n,i;const o=[mn("neighbourhood-boundaries-selected-outline",!1),{paint:{"line-color":"black","line-width":4,"line-dasharray":[2,2]}}];let c={};for(let p=0;p<o.length;p+=1)c=Bt(c,o[p]);e=new sr({props:c});const a=[mn("neighbourhood-boundaries-selected-outline-base",!1),{paint:{"line-color":"white","line-width":8,"line-opacity":.7}}];let d={};for(let p=0;p<a.length;p+=1)d=Bt(d,a[p]);return n=new sr({props:d}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment)},m(p,y){ue(e,p,y),q(p,t,y),ue(n,p,y),i=!0},p(p,y){const _={};e.$set(_);const w={};n.$set(w)},i(p){i||(j(e.$$.fragment,p),j(n.$$.fragment,p),i=!0)},o(p){Z(e.$$.fragment,p),Z(n.$$.fragment,p),i=!1},d(p){p&&V(t),he(e,p),he(n,p)}}}function f1(r){let e,t;return e=new dr({props:{data:r[3],generateId:!0,$$slots:{default:[tL]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i[0]&8&&(o.data=n[3]),i[0]&16|i[1]&1&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function d1(r){let e,t;return e=new ui({props:{openOn:"hover",$$slots:{default:[QM,({props:n})=>({30:n}),({props:n})=>[n?1073741824:0]]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i[0]&1073741840|i[1]&1&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function WM(r){let e,t,n,i,o=(r[30].number_pois/r[30].area_km2).toFixed(1)+"",c,a;return{c(){e=U("b"),e.textContent="Points of interest",t=oe(),n=U("br"),i=oe(),c=xe(o),a=xe(" / km")},m(d,p){q(d,e,p),q(d,t,p),q(d,n,p),q(d,i,p),q(d,c,p),q(d,a,p)},p(d,p){p[0]&1073741824&&o!==(o=(d[30].number_pois/d[30].area_km2).toFixed(1)+"")&&Tt(c,o)},d(d){d&&(V(e),V(t),V(n),V(i),V(c),V(a))}}}function KM(r){let e,t,n,i,o=(r[30].number_stats19_collisions/r[30].area_km2).toFixed(1)+"",c,a;return{c(){e=U("b"),e.textContent="Pedestrian and cyclist collisions",t=oe(),n=U("br"),i=oe(),c=xe(o),a=xe(` /
                km`)},m(d,p){q(d,e,p),q(d,t,p),q(d,n,p),q(d,i,p),q(d,c,p),q(d,a,p)},p(d,p){p[0]&1073741824&&o!==(o=(d[30].number_stats19_collisions/d[30].area_km2).toFixed(1)+"")&&Tt(c,o)},d(d){d&&(V(e),V(t),V(n),V(i),V(c),V(a))}}}function XM(r){let e,t,n,i,o=Math.round(r[30].population/r[30].area_km2).toLocaleString()+"",c,a;return{c(){e=U("b"),e.textContent="Population density",t=oe(),n=U("br"),i=oe(),c=xe(o),a=xe(`
                people / km`)},m(d,p){q(d,e,p),q(d,t,p),q(d,n,p),q(d,i,p),q(d,c,p),q(d,a,p)},p(d,p){p[0]&1073741824&&o!==(o=Math.round(d[30].population/d[30].area_km2).toLocaleString()+"")&&Tt(c,o)},d(d){d&&(V(e),V(t),V(n),V(i),V(c),V(a))}}}function JM(r){let e,t,n,i,o=Bc(r[30].households_with_cars_or_vans,r[30].total_households)+"",c,a,d=r[30].total_households.toLocaleString()+"",p,y;return{c(){e=U("b"),e.textContent="Car or van ownership",t=oe(),n=U("br"),i=oe(),c=xe(o),a=xe(" of approximately "),p=xe(d),y=xe(`
                households have at least one car or van.`)},m(_,w){q(_,e,w),q(_,t,w),q(_,n,w),q(_,i,w),q(_,c,w),q(_,a,w),q(_,p,w),q(_,y,w)},p(_,w){w[0]&1073741824&&o!==(o=Bc(_[30].households_with_cars_or_vans,_[30].total_households)+"")&&Tt(c,o),w[0]&1073741824&&d!==(d=_[30].total_households.toLocaleString()+"")&&Tt(p,d)},d(_){_&&(V(e),V(t),V(n),V(i),V(c),V(a),V(p),V(y))}}}function YM(r){let e,t,n=r[30].area_km2.toFixed(1)+"",i,o;return{c(){e=U("b"),e.textContent="Area:",t=oe(),i=xe(n),o=xe(" km")},m(c,a){q(c,e,a),q(c,t,a),q(c,i,a),q(c,o,a)},p(c,a){a[0]&1073741824&&n!==(n=c[30].area_km2.toFixed(1)+"")&&Tt(i,n)},d(c){c&&(V(e),V(t),V(i),V(o))}}}function QM(r){let e;function t(o,c){if(o[4]=="none")return YM;if(o[4]=="car_ownership")return JM;if(o[4]=="density")return XM;if(o[4]=="stats19")return KM;if(o[4]=="pois")return WM}let n=t(r),i=n&&n(r);return{c(){i&&i.c(),e=Xn()},m(o,c){i&&i.m(o,c),q(o,e,c)},p(o,c){n===(n=t(o))&&i?i.p(o,c):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&V(e),i&&i.d(o)}}}function eL(r){let e,t,n=r[4]!="simd"&&d1(r);return{c(){n&&n.c(),e=Xn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,o){i[4]!="simd"?n?(n.p(i,o),o[0]&16&&j(n,1)):(n=d1(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(en(),Z(n,1,1,()=>{n=null}),tn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function tL(r){let e,t,n,i;const o=[mn("neighbourhood-boundaries",!1),{paint:{"fill-color":r[14](r[4]),"fill-opacity":r[15](r[4])}},{manageHoverState:!0},{hoverCursor:"pointer"}];let c={$$slots:{default:[eL]},$$scope:{ctx:r}};for(let p=0;p<o.length;p+=1)c=Bt(c,o[p]);e=new Hi({props:c}),e.$on("click",r[11]);const a=[mn("neighbourhood-boundaries-outline",!1),{paint:{"line-color":"black","line-width":1}}];let d={};for(let p=0;p<a.length;p+=1)d=Bt(d,a[p]);return n=new sr({props:d}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment)},m(p,y){ue(e,p,y),q(p,t,y),ue(n,p,y),i=!0},p(p,y){const _=y[0]&49168?Fn(o,[o[0],{paint:{"fill-color":p[14](p[4]),"fill-opacity":p[15](p[4])}},o[2],o[3]]):{};y[0]&16|y[1]&1&&(_.$$scope={dirty:y,ctx:p}),e.$set(_);const w={};n.$set(w)},i(p){i||(j(e.$$.fragment,p),j(n.$$.fragment,p),i=!0)},o(p){Z(e.$$.fragment,p),Z(n.$$.fragment,p),i=!1},d(p){p&&V(t),he(e,p),he(n,p)}}}function nL(r){let e,t,n,i=r[7]&&h1(r),o=r[0]=="choose-area"&&f1(r);return{c(){e=U("div"),i&&i.c(),t=oe(),o&&o.c(),de(e,"slot","map")},m(c,a){q(c,e,a),i&&i.m(e,null),R(e,t),o&&o.m(e,null),n=!0},p(c,a){c[7]?i?(i.p(c,a),a[0]&128&&j(i,1)):(i=h1(c),i.c(),j(i,1),i.m(e,t)):i&&(en(),Z(i,1,1,()=>{i=null}),tn()),c[0]=="choose-area"?o?(o.p(c,a),a[0]&1&&j(o,1)):(o=f1(c),o.c(),j(o,1),o.m(e,null)):o&&(en(),Z(o,1,1,()=>{o=null}),tn())},i(c){n||(j(i),j(o),n=!0)},o(c){Z(i),Z(o),n=!1},d(c){c&&V(e),i&&i.d(),o&&o.d()}}}function rL(r){let e,t,n,i;return e=new Sh({props:{loading:r[2]}}),n=new bo({props:{$$slots:{map:[nL],sidebar:[GM],top:[FM]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment)},m(o,c){ue(e,o,c),q(o,t,c),ue(n,o,c),i=!0},p(o,c){const a={};c[0]&4&&(a.loading=o[2]),e.$set(a);const d={};c[0]&2043|c[1]&1&&(d.$$scope={dirty:c,ctx:o}),n.$set(d)},i(o){i||(j(e.$$.fragment,o),j(n.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),Z(n.$$.fragment,o),i=!1},d(o){o&&V(t),he(e,o),he(n,o)}}}function iL(r,e,t){let n,i,o,c,a,d;at(r,an,Ee=>t(8,n=Ee)),at(r,Ar,Ee=>t(19,i=Ee)),at(r,_l,Ee=>t(28,o=Ee)),at(r,Qs,Ee=>t(29,c=Ee)),at(r,Fo,Ee=>t(9,a=Ee)),at(r,Ro,Ee=>t(10,d=Ee));let p="Generating severance boundaries...",y=Ki(),_="choose-area",w="none",T=null,M=new Map,$=[],P,D=null,I=null;Ls(async()=>{await new Promise(Ee=>{requestAnimationFrame(()=>{requestAnimationFrame(Ee)})}),t(3,y=i.generatedBoundaries()),t(2,p="")});function F(Ee){let $e=Ee.detail.features[0].id,St=y.features[$e],rt=new Map(M);if(rt.has($e)?rt.delete($e):rt.set($e,St),rt.size===0)t(17,T=null),t(5,M=rt);else if(rt.size===1)t(17,T=rt.values().next().value),t(5,M=rt);else{let lt={type:"FeatureCollection",features:Array.from(rt.values())};try{t(17,T=i.generateMergedBoundary(lt)),t(5,M=rt)}catch(mt){console.log(`error merging boundaries: ${mt}`),window.alert(`Sorry, the boundaries you selected cannot be merged.
Error: ${mt}`)}}}function N(Ee){var rt;let $e=c.nextAvailableNeighbourhoodName(o),St=Vv(i,"What do you want to name the neighbourhood?",$e);if(St)try{const lt={};_=="draw-area"&&((rt=P==null?void 0:P.properties)!=null&&rt.waypoints)&&(lt.waypoints=P.properties.waypoints);let mt={type:"Feature",properties:lt,geometry:Ee.geometry};i.setNeighbourhoodBoundary(St,mt),mh(),i.setCurrentNeighbourhood(St),Nt(an,n={mode:"neighbourhood"},n)}catch(lt){window.alert(`Sorry, this boundary is invalid: ${lt}`)}}function W(){wd("auto_boundaries.geojson",JSON.stringify(y,null,"  "))}function se(Ee){return Zv({none:["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"]},Ee)}function J(Ee){return{none:Hn(.3,.5),area:Hn(.7,.9),car_ownership:Hn(.7,.9),density:Hn(.7,.9),pois:Hn(.7,.9),simd:Hn(.7,.9),stats19:Hn(.7,.9)}[Ee]}function ee(){t(17,T=null),M.clear(),t(5,M),t(6,$=[]),t(18,D=null),t(7,I=null)}const me=()=>Nt(an,n={mode:"pick-neighbourhood"},n);function Ie(Ee){w=Ee,t(4,w)}const Q=()=>t(0,_="choose-area"),ae=()=>t(0,_="draw-area");function Pe(Ee){$=Ee,t(6,$)}function ve(Ee){P=Ee,t(1,P)}const tt=()=>N(yr(I)),Ge=()=>Nt(an,n={mode:"pick-neighbourhood"},n);return r.$$.update=()=>{if(r.$$.dirty[0]&524290){let Ee=null;if(P&&P.geometry.coordinates[0].length>3){let $e={type:"FeatureCollection",features:[P]};try{Ee=i.generateMergedBoundary($e)}catch(St){console.log(`error merging boundaries: ${St}`)}}t(18,D=Ee)}r.$$.dirty[0]&393217&&(_=="draw-area"?t(7,I=D):t(7,I=T))},[_,P,p,y,w,M,$,I,n,a,d,F,N,W,se,J,ee,T,D,i,me,Ie,Q,ae,Pe,ve,tt,Ge]}class oL extends Lt{constructor(e){super(),Mt(this,e,iL,rL,vt,{},null,[-1,-1])}}const yi=class yi{constructor(e,t,n){tr(this,"filterType");tr(this,"label");tr(this,"description");this.filterType=e,this.label=t,this.description=n}get iconURL(){return`/ltn//filters/${this.filterType}_icon.gif`}get largeImageURL(){return`/ltn//filters/${this.filterType}.gif`}static getFilter(e){switch(e){case"walk_cycle_only":return yi.walkCycleOnly;case"no_entry":return yi.noEntry;case"bus_gate":return yi.busGate;case"school_street":return yi.schoolStreet;default:console.assert(`unknown filter type: "${e}"`);return}}};tr(yi,"walkCycleOnly",new yi("walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter.")),tr(yi,"noEntry",new yi("no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through.")),tr(yi,"busGate",new yi("bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier.")),tr(yi,"schoolStreet",new yi("school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school.")),tr(yi,"allTypes",[yi.walkCycleOnly,yi.noEntry,yi.busGate,yi.schoolStreet]);let lo=yi;function sL(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function aL(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function lL(r){let e,t,n,i,o,c,a,d,p,y,_;return o=new $n({props:{$$slots:{default:[sL]},$$scope:{ctx:r}}}),o.$on("click",Bo),d=new $n({props:{$$slots:{default:[aL]},$$scope:{ctx:r}}}),d.$on("click",r[11]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),fe(o.$$.fragment),c=oe(),a=U("li"),fe(d.$$.fragment),p=oe(),y=U("li"),y.textContent="Explore origin/destination demand data",de(t,"aria-label","breadcrumb"),de(e,"slot","top")},m(w,T){q(w,e,T),R(e,t),R(t,n),R(n,i),ue(o,i,null),R(n,c),R(n,a),ue(d,a,null),R(n,p),R(n,y),_=!0},p(w,T){const M={};T&32768&&(M.$$scope={dirty:T,ctx:w}),o.$set(M);const $={};T&32768&&($.$$scope={dirty:T,ctx:w}),d.$set($)},i(w){_||(j(o.$$.fragment,w),j(d.$$.fragment,w),_=!0)},o(w){Z(o.$$.fragment,w),Z(d.$$.fragment,w),_=!1},d(w){w&&V(e),he(o),he(d)}}}function cL(r){let e;return{c(){e=U("p"),e.textContent="Hover on a zone"},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function uL(r){let e,t=r[6].properties.name+"",n,i,o,c,a=r[6].properties.sum_from.toLocaleString()+"",d,p,y,_,w=r[6].properties.sum_to.toLocaleString()+"",T,M,$,P,D=r[6].properties.counts_from[r[3]]+"",I;return{c(){e=U("u"),n=xe(t),i=oe(),o=U("p"),c=xe("Total trips from here: "),d=xe(a),p=oe(),y=U("p"),_=xe("Total trips to here: "),T=xe(w),M=oe(),$=U("p"),P=xe("Total intra-zonal trips starting and ending here: "),I=xe(D)},m(F,N){q(F,e,N),R(e,n),q(F,i,N),q(F,o,N),R(o,c),R(o,d),q(F,p,N),q(F,y,N),R(y,_),R(y,T),q(F,M,N),q(F,$,N),R($,P),R($,I)},p(F,N){N&64&&t!==(t=F[6].properties.name+"")&&Tt(n,t),N&64&&a!==(a=F[6].properties.sum_from.toLocaleString()+"")&&Tt(d,a),N&64&&w!==(w=F[6].properties.sum_to.toLocaleString()+"")&&Tt(T,w),N&72&&D!==(D=F[6].properties.counts_from[F[3]]+"")&&Tt(I,D)},d(F){F&&(V(e),V(i),V(o),V(p),V(y),V(M),V($))}}}function hL(r){let e,t,n,i,o,c=r[0].features.length.toLocaleString()+"",a,d,p,y,_,w,T,M,$,P,D=r[1]?"from":"to",I,F,N=r[3]==null?"each zone":"this zone",W,se,J,ee,me,Ie,Q,ae,Pe,ve;t=new na({}),t.$on("click",r[9]),ee=new Oo({props:{colorScale:Yf,labels:{limits:r[5]}}});function tt($e,St){return $e[6]&&$e[3]!=null?uL:cL}let Ge=tt(r),Ee=Ge(r);return{c(){e=U("div"),fe(t.$$.fragment),n=oe(),i=U("p"),o=xe("Trips begin and end in "),a=xe(c),d=xe(" zones"),p=oe(),y=U("label"),_=xe(`Trips from
      `),w=U("input"),T=xe(`
      Trips to`),M=oe(),$=U("p"),P=xe("Trips "),I=xe(D),F=oe(),W=xe(N),se=xe(":"),J=oe(),fe(ee.$$.fragment),me=oe(),Ie=U("hr"),Q=oe(),Ee.c(),de(w,"type","checkbox"),de(w,"role","switch"),de(e,"slot","sidebar")},m($e,St){q($e,e,St),ue(t,e,null),R(e,n),R(e,i),R(i,o),R(i,a),R(i,d),R(e,p),R(e,y),R(y,_),R(y,w),w.checked=r[1],R(y,T),R(e,M),R(e,$),R($,P),R($,I),R($,F),R($,W),R($,se),R(e,J),ue(ee,e,null),R(e,me),R(e,Ie),R(e,Q),Ee.m(e,null),ae=!0,Pe||(ve=wt(w,"change",r[10]),Pe=!0)},p($e,St){(!ae||St&1)&&c!==(c=$e[0].features.length.toLocaleString()+"")&&Tt(a,c),St&2&&(w.checked=$e[1]),(!ae||St&2)&&D!==(D=$e[1]?"from":"to")&&Tt(I,D),(!ae||St&8)&&N!==(N=$e[3]==null?"each zone":"this zone")&&Tt(W,N);const rt={};St&32&&(rt.labels={limits:$e[5]}),ee.$set(rt),Ge===(Ge=tt($e))&&Ee?Ee.p($e,St):(Ee.d(1),Ee=Ge($e),Ee&&(Ee.c(),Ee.m(e,null)))},i($e){ae||(j(t.$$.fragment,$e),j(ee.$$.fragment,$e),ae=!0)},o($e){Z(t.$$.fragment,$e),Z(ee.$$.fragment,$e),ae=!1},d($e){$e&&V(e),he(t),he(ee),Ee.d(),Pe=!1,ve()}}}function fL(r){let e,t,n,i,o;const c=[mn("debug-demand-fill"),{paint:{"fill-color":r[4],"fill-opacity":Hn(.5,.1)}},{manageHoverState:!0}];function a(_){r[8](_)}let d={};for(let _=0;_<c.length;_+=1)d=Bt(d,c[_]);r[2]!==void 0&&(d.hovered=r[2]),e=new Hi({props:d}),hn.push(()=>In(e,"hovered",a));const p=[mn("debug-demand-outline"),{paint:{"line-width":2,"line-color":"black"}}];let y={};for(let _=0;_<p.length;_+=1)y=Bt(y,p[_]);return i=new sr({props:y}),{c(){fe(e.$$.fragment),n=oe(),fe(i.$$.fragment)},m(_,w){ue(e,_,w),q(_,n,w),ue(i,_,w),o=!0},p(_,w){const T=w&16?Fn(c,[c[0],{paint:{"fill-color":_[4],"fill-opacity":Hn(.5,.1)}},c[2]]):{};!t&&w&4&&(t=!0,T.hovered=_[2],En(()=>t=!1)),e.$set(T);const M={};i.$set(M)},i(_){o||(j(e.$$.fragment,_),j(i.$$.fragment,_),o=!0)},o(_){Z(e.$$.fragment,_),Z(i.$$.fragment,_),o=!1},d(_){_&&V(n),he(e,_),he(i,_)}}}function dL(r){let e,t,n;return t=new dr({props:{data:r[0],generateId:!0,$$slots:{default:[fL]},$$scope:{ctx:r}}}),{c(){e=U("div"),fe(t.$$.fragment),de(e,"slot","map")},m(i,o){q(i,e,o),ue(t,e,null),n=!0},p(i,o){const c={};o&1&&(c.data=i[0]),o&32788&&(c.$$scope={dirty:o,ctx:i}),t.$set(c)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),he(t)}}}function pL(r){let e,t;return e=new bo({props:{$$slots:{map:[dL],sidebar:[hL],top:[lL]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,[i]){const o={};i&33023&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function mL(r,e,t){let n,i,o,c,a,d;at(r,an,I=>t(7,a=I)),at(r,Ar,I=>t(12,d=I));let p=Ki();try{p=d.getDemandModel()}catch{window.alert("No demand model for this area"),Nt(an,a={mode:"pick-neighbourhood"},a)}let y=!1,_=null;function w(I,F){if(I==null){let N=F?"sum_to":"sum_from",W=Math.max(...p.features.map(J=>J.properties[N])),se=T(W);return[se,co(["get",N],se,Yf)]}else{let N=F?"counts_to":"counts_from",W=[...p.features.map(ee=>ee.properties[N][I])],se=Math.max(...W),J=T(se);return[J,co(["at",["id"],["literal",W]],J,Yf)]}}function T(I){let F=Yf.length+1;return Array.from(Array(F).keys()).map(N=>Math.round(I/(F-1)*N))}function M(I){_=I,t(2,_)}const $=()=>Nt(an,a={mode:"predict-impact"},a);function P(){y=this.checked,t(1,y)}const D=()=>Nt(an,a={mode:"pick-neighbourhood"},a);return r.$$.update=()=>{r.$$.dirty&4&&t(3,n=_==null?null:_.id),r.$$.dirty&9&&t(6,i=n!=null?p.features[n]:null),r.$$.dirty&10&&t(5,[o,c]=w(n,y),o,(t(4,c),t(3,n),t(1,y),t(2,_)))},[p,y,_,n,c,o,i,a,M,$,P,D]}class gL extends Lt{constructor(e){super(),Mt(this,e,mL,pL,vt,{})}}function _L(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function yL(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function bL(r){let e,t,n,i,o,c,a,d,p,y,_;return o=new $n({props:{$$slots:{default:[_L]},$$scope:{ctx:r}}}),o.$on("click",Bo),d=new $n({props:{$$slots:{default:[yL]},$$scope:{ctx:r}}}),d.$on("click",r[9]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),fe(o.$$.fragment),c=oe(),a=U("li"),fe(d.$$.fragment),p=oe(),y=U("li"),y.textContent="Debug intersections",de(t,"aria-label","breadcrumb"),de(e,"slot","top")},m(w,T){q(w,e,T),R(e,t),R(t,n),R(n,i),ue(o,i,null),R(n,c),R(n,a),ue(d,a,null),R(n,p),R(n,y),_=!0},p(w,T){const M={};T&1024&&(M.$$scope={dirty:T,ctx:w}),o.$set(M);const $={};T&1024&&($.$$scope={dirty:T,ctx:w}),d.$set($)},i(w){_||(j(o.$$.fragment,w),j(d.$$.fragment,w),_=!0)},o(w){Z(o.$$.fragment,w),Z(d.$$.fragment,w),_=!1},d(w){w&&V(e),he(o),he(d)}}}function p1(r){let e,t,n,i,o,c,a;function d(y){r[8](y)}let p={list:r[1].features};return r[2]!==void 0&&(p.idx=r[2]),n=new Cd({props:p}),hn.push(()=>In(n,"idx",d)),{c(){e=U("button"),e.textContent="Pick another intersection",t=oe(),fe(n.$$.fragment),de(e,"class","secondary")},m(y,_){q(y,e,_),q(y,t,_),ue(n,y,_),o=!0,c||(a=wt(e,"click",r[7]),c=!0)},p(y,_){const w={};_&2&&(w.list=y[1].features),!i&&_&4&&(i=!0,w.idx=y[2],En(()=>i=!1)),n.$set(w)},i(y){o||(j(n.$$.fragment,y),o=!0)},o(y){Z(n.$$.fragment,y),o=!1},d(y){y&&(V(e),V(t)),he(n,y),c=!1,a()}}}function m1(r){let e,t;return{c(){e=U("a"),t=xe("Open OSM"),de(e,"href",r[0]),de(e,"target","_blank")},m(n,i){q(n,e,i),R(e,t)},p(n,i){i&1&&de(e,"href",n[0])},d(n){n&&V(e)}}}function vL(r){let e,t,n,i,o,c,a;t=new na({}),t.$on("click",r[6]);let d=r[1].features.length>0&&p1(r),p=r[0]&&m1(r);return{c(){e=U("div"),fe(t.$$.fragment),n=oe(),i=U("p"),i.textContent="Purple intersections have some kind of turn restriction.",o=oe(),d&&d.c(),c=oe(),p&&p.c(),de(e,"slot","sidebar")},m(y,_){q(y,e,_),ue(t,e,null),R(e,n),R(e,i),R(e,o),d&&d.m(e,null),R(e,c),p&&p.m(e,null),a=!0},p(y,_){y[1].features.length>0?d?(d.p(y,_),_&2&&j(d,1)):(d=p1(y),d.c(),j(d,1),d.m(e,c)):d&&(en(),Z(d,1,1,()=>{d=null}),tn()),y[0]?p?p.p(y,_):(p=m1(y),p.c(),p.m(e,null)):p&&(p.d(1),p=null)},i(y){a||(j(t.$$.fragment,y),j(d),a=!0)},o(y){Z(t.$$.fragment,y),Z(d),a=!1},d(y){y&&V(e),he(t),d&&d.d(),p&&p.d()}}}function wL(r){let e,t;const n=[mn("debug-intersections"),{paint:{"circle-radius":15,"circle-color":["case",["get","has_turn_restrictions"],"purple","black"]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new wl({props:i}),e.$on("click",r[5]),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function xL(r){let e,t,n,i;const o=[mn("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let c={};for(let p=0;p<o.length;p+=1)c=Bt(c,o[p]);e=new sr({props:c});const a=[mn("debug-movements-fill"),{filter:["==",["id"],r[2]]},{paint:{"fill-color":"cyan"}}];let d={};for(let p=0;p<a.length;p+=1)d=Bt(d,a[p]);return n=new Hi({props:d}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment)},m(p,y){ue(e,p,y),q(p,t,y),ue(n,p,y),i=!0},p(p,y){const _={};e.$set(_);const w=y&4?Fn(a,[a[0],{filter:["==",["id"],p[2]]},a[2]]):{};n.$set(w)},i(p){i||(j(e.$$.fragment,p),j(n.$$.fragment,p),i=!0)},o(p){Z(e.$$.fragment,p),Z(n.$$.fragment,p),i=!1},d(p){p&&V(t),he(e,p),he(n,p)}}}function kL(r){let e,t,n,i,o;return t=new dr({props:{data:yr(r[3]).getAllIntersections(),generateId:!0,$$slots:{default:[wL]},$$scope:{ctx:r}}}),i=new dr({props:{data:r[1],generateId:!0,$$slots:{default:[xL]},$$scope:{ctx:r}}}),{c(){e=U("div"),fe(t.$$.fragment),n=oe(),fe(i.$$.fragment),de(e,"slot","map")},m(c,a){q(c,e,a),ue(t,e,null),R(e,n),ue(i,e,null),o=!0},p(c,a){const d={};a&8&&(d.data=yr(c[3]).getAllIntersections()),a&1024&&(d.$$scope={dirty:a,ctx:c}),t.$set(d);const p={};a&2&&(p.data=c[1]),a&1028&&(p.$$scope={dirty:a,ctx:c}),i.$set(p)},i(c){o||(j(t.$$.fragment,c),j(i.$$.fragment,c),o=!0)},o(c){Z(t.$$.fragment,c),Z(i.$$.fragment,c),o=!1},d(c){c&&V(e),he(t),he(i)}}}function SL(r){let e,t;return e=new bo({props:{$$slots:{map:[kL],sidebar:[vL],top:[bL]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,[i]){const o={};i&1055&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function CL(r,e,t){let n,i;at(r,Ar,T=>t(3,n=T)),at(r,an,T=>t(4,i=T));let o=null,c=Ki(),a=0;function d(T){t(0,o=T.detail.features[0].properties.osm),t(1,c=n.getMovements(T.detail.features[0].id)),t(2,a=0)}const p=()=>Nt(an,i={mode:"pick-neighbourhood"},i),y=()=>t(1,c=Ki());function _(T){a=T,t(2,a)}return[o,c,a,n,i,d,p,y,_,()=>Nt(an,i={mode:"pick-neighbourhood"},i)]}class TL extends Lt{constructor(e){super(),Mt(this,e,CL,SL,vt,{})}}function ML(r){let e,t,n,i;const o=[mn("cells"),{filter:["==",["get","kind"],"cell"]},{layout:{visibility:r[0]=="cells"?"none":"visible"}},{paint:{"fill-color":id(),"fill-opacity":.5,"fill-outline-color":"hsla(0, 0%, 0%, 0.3)"}}];let c={};for(let p=0;p<o.length;p+=1)c=Bt(c,o[p]);e=new Hi({props:c});const a=[mn("border-entries"),{filter:["==",["get","kind"],"border_entry"]},{layout:{"icon-image":"border_entry_arrow","icon-rotate":["get","bearing_upon_entry"],"icon-allow-overlap":!0,"icon-size":qf(1),"icon-offset":g1(1),"symbol-sort-key":["get","bearing_upon_entry"],visibility:r[1]?"visible":"none"}},{paint:{"icon-color":id(),"icon-halo-color":"black","icon-opacity":_1(),"icon-halo-width":qf(1.5),"icon-halo-blur":0}},{minzoom:13},{interactive:!1}];let d={};for(let p=0;p<a.length;p+=1)d=Bt(d,a[p]);return n=new Fc({props:d}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment)},m(p,y){ue(e,p,y),q(p,t,y),ue(n,p,y),i=!0},p(p,[y]){const _=y&1?Fn(o,[o[0],o[1],{layout:{visibility:p[0]=="cells"?"none":"visible"}},o[3]]):{};e.$set(_);const w=y&2?Fn(a,[a[0],a[1],y&2&&{layout:{"icon-image":"border_entry_arrow","icon-rotate":["get","bearing_upon_entry"],"icon-allow-overlap":!0,"icon-size":qf(1),"icon-offset":g1(1),"symbol-sort-key":["get","bearing_upon_entry"],visibility:p[1]?"visible":"none"}},y&0&&{paint:{"icon-color":id(),"icon-halo-color":"black","icon-opacity":_1(),"icon-halo-width":qf(1.5),"icon-halo-blur":0}},a[4],a[5]]):{};n.$set(w)},i(p){i||(j(e.$$.fragment,p),j(n.$$.fragment,p),i=!0)},o(p){Z(e.$$.fragment,p),Z(n.$$.fragment,p),i=!1},d(p){p&&V(t),he(e,p),he(n,p)}}}function qf(r){return["interpolate",["linear"],["zoom"],14,.08*r,22,.7*r]}function g1(r){return[0,-50*r]}function _1(){return["interpolate",["linear"],["zoom"],14,1,22,.7]}function LL(r,e,t){let n,i;return at(r,dd,o=>t(0,n=o)),at(r,lm,o=>t(1,i=o)),[n,i]}class Pd extends Lt{constructor(e){super(),Mt(this,e,LL,ML,vt,{})}}function EL(r){let e,t;const n=[mn("neighbourhood-boundary"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":.3}}];let i={};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new Hi({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,[c]){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}class zd extends Lt{constructor(e){super(),Mt(this,e,null,EL,vt,{})}}const IL=r=>({}),y1=r=>({}),AL=r=>({}),b1=r=>({});function v1(r){let e;const t=r[7]["line-popup"],n=Sn(t,r,r[10],b1);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&1024)&&Tn(n,t,i,i[10],e?Cn(t,i[10],o,AL):Mn(i[10]),b1)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function PL(r){let e,t,n=r[0]&&v1(r);return{c(){n&&n.c(),e=Xn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o&1&&j(n,1)):(n=v1(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(en(),Z(n,1,1,()=>{n=null}),tn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function w1(r){let e;const t=r[7]["line-popup"],n=Sn(t,r,r[10],y1);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&1024)&&Tn(n,t,i,i[10],e?Cn(t,i[10],o,IL):Mn(i[10]),y1)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function zL(r){let e,t,n=r[0]&&w1(r);return{c(){n&&n.c(),e=Xn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o&1&&j(n,1)):(n=w1(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(en(),Z(n,1,1,()=>{n=null}),tn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function DL(r){let e,t,n,i,o,c,a,d;const p=[mn("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,1),"line-color":"black"}},{minzoom:13}];let y={};for(let D=0;D<p.length;D+=1)y=Bt(y,p[D]);e=new sr({props:y});const _=[mn("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":r[5](r[3],r[4].maxShortcuts),"line-opacity":Hn(1,.5)}},{layout:{"line-sort-key":["get","shortcuts"]}},{minzoom:13},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let w={$$slots:{default:[PL]},$$scope:{ctx:r}};for(let D=0;D<_.length;D+=1)w=Bt(w,_[D]);n=new sr({props:w}),n.$on("click",r[8]);const T=[mn("main-roads-outlines"),{filter:["==",["get","kind"],"main_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,6),"line-color":"black"}},{minzoom:13}];let M={};for(let D=0;D<T.length;D+=1)M=Bt(M,T[D]);o=new sr({props:M});const $=[mn("main-roads"),{filter:["==",["get","kind"],"main_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,4),"line-color":Hn("gray",yo.mapFeature.hover.backgroundColor),"line-opacity":Hn(1,.5)}},{layout:{"line-sort-key":["get","shortcuts"]}},{minzoom:13},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let P={$$slots:{default:[zL]},$$scope:{ctx:r}};for(let D=0;D<$.length;D+=1)P=Bt(P,$[D]);return a=new sr({props:P}),a.$on("click",r[9]),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment),i=oe(),fe(o.$$.fragment),c=oe(),fe(a.$$.fragment)},m(D,I){ue(e,D,I),q(D,t,I),ue(n,D,I),q(D,i,I),ue(o,D,I),q(D,c,I),ue(a,D,I),d=!0},p(D,[I]){const F=I&84?Fn(p,[p[0],p[1],{paint:{"line-width":D[6](D[2],D[4].maxShortcuts,1),"line-color":"black"}},p[3]]):{};e.$set(F);const N=I&125?Fn(_,[_[0],_[1],I&124&&{paint:{"line-width":D[6](D[2],D[4].maxShortcuts,0),"line-color":D[5](D[3],D[4].maxShortcuts),"line-opacity":Hn(1,.5)}},_[3],_[4],I&1&&{manageHoverState:D[0]},I&1&&{hoverCursor:D[0]?"pointer":void 0}]):{};I&1025&&(N.$$scope={dirty:I,ctx:D}),n.$set(N);const W=I&84?Fn(T,[T[0],T[1],{paint:{"line-width":D[6](D[2],D[4].maxShortcuts,6),"line-color":"black"}},T[3]]):{};o.$set(W);const se=I&85?Fn($,[$[0],$[1],I&84&&{paint:{"line-width":D[6](D[2],D[4].maxShortcuts,4),"line-color":Hn("gray",yo.mapFeature.hover.backgroundColor),"line-opacity":Hn(1,.5)}},$[3],$[4],I&1&&{manageHoverState:D[0]},I&1&&{hoverCursor:D[0]?"pointer":void 0}]):{};I&1025&&(se.$$scope={dirty:I,ctx:D}),a.$set(se)},i(D){d||(j(e.$$.fragment,D),j(n.$$.fragment,D),j(o.$$.fragment,D),j(a.$$.fragment,D),d=!0)},o(D){Z(e.$$.fragment,D),Z(n.$$.fragment,D),Z(o.$$.fragment,D),Z(a.$$.fragment,D),d=!1},d(D){D&&(V(t),V(i),V(c)),he(e,D),he(n,D),he(o,D),he(a,D)}}}function $L(r,e,t){let n,i;at(r,cm,M=>t(2,n=M)),at(r,dd,M=>t(3,i=M));let{$$slots:o={},$$scope:c}=e,a=kh("neighbourhoodGj"),{interactive:d=!0}=e,{onClickLine:p=(M,$)=>{}}=e;function y(M,$){return M=="cells"?id():M=="edits"?Hn(["case",["get","edited"],RS,"white"],yo.mapFeature.hover.backgroundColor):M=="speeds"?co(["get","speed_mph"],pv,dv):$<=2?Hn("white","blue"):(console.assert(M=="shortcuts"),Hn(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",$,"#A32015"],yo.mapFeature.hover.backgroundColor))}function _(M,$,P){return!M||$<=2?qs(P):["interpolate",["linear"],["get","shortcuts"],0,5+P,$,25+P]}const w=M=>d&&p(M.detail.features[0],M.detail.event.lngLat),T=M=>d&&p(M.detail.features[0],M.detail.event.lngLat);return r.$$set=M=>{"interactive"in M&&t(0,d=M.interactive),"onClickLine"in M&&t(1,p=M.onClickLine),"$$scope"in M&&t(10,c=M.$$scope)},[d,p,n,i,a,y,_,o,w,T,c]}class Ih extends Lt{constructor(e){super(),Mt(this,e,$L,DL,vt,{interactive:0,onClickLine:1})}}function RL(r){let e;const t=r[7].default,n=Sn(t,r,r[9],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&512)&&Tn(n,t,i,i[9],e?Cn(t,i[9],o,null):Mn(i[9]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function FL(r){let e,t,n;const i=[mn("turn-restrictions"),{minzoom:13},{filter:r[4]?void 0:["get","edited"]},{layout:{"icon-image":["concat","no_",["get","kind"],"_turn"],"icon-rotate":["get","icon_angle"],"icon-allow-overlap":!0,"icon-size":.05}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];function o(a){r[8](a)}let c={$$slots:{default:[RL]},$$scope:{ctx:r}};for(let a=0;a<i.length;a+=1)c=Bt(c,i[a]);return r[1]!==void 0&&(c.hovered=r[1]),e=new Fc({props:c}),hn.push(()=>In(e,"hovered",o)),e.$on("click",function(){bl(r[0])&&r[0].apply(this,arguments)}),{c(){fe(e.$$.fragment)},m(a,d){ue(e,a,d),n=!0},p(a,d){r=a;const p=d&16?Fn(i,[i[0],i[1],{filter:r[4]?void 0:["get","edited"]},i[3],i[4]]):{};d&512&&(p.$$scope={dirty:d,ctx:r}),!t&&d&2&&(t=!0,p.hovered=r[1],En(()=>t=!1)),e.$set(p)},i(a){n||(j(e.$$.fragment,a),n=!0)},o(a){Z(e.$$.fragment,a),n=!1},d(a){he(e,a)}}}function BL(r){let e,t;const n=[mn("turn-restrictions-debug-arrows"),{interactive:!1},{paint:{"line-width":4,"line-color":"red"}}];let i={};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new sr({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function OL(r){let e,t,n,i;return e=new dr({props:{data:r[2],generateId:!0,$$slots:{default:[FL]},$$scope:{ctx:r}}}),n=new dr({props:{data:r[3],$$slots:{default:[BL]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment)},m(o,c){ue(e,o,c),q(o,t,c),ue(n,o,c),i=!0},p(o,[c]){const a={};c&4&&(a.data=o[2]),c&531&&(a.$$scope={dirty:c,ctx:o}),e.$set(a);const d={};c&8&&(d.data=o[3]),c&512&&(d.$$scope={dirty:c,ctx:o}),n.$set(d)},i(o){i||(j(e.$$.fragment,o),j(n.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),Z(n.$$.fragment,o),i=!1},d(o){o&&V(t),he(e,o),he(n,o)}}}function NL(r,e,t){let n,i,o,c,a;at(r,Ar,T=>t(5,o=T)),at(r,so,T=>t(6,c=T)),at(r,fd,T=>t(4,a=T));let{$$slots:d={},$$scope:p}=e,{onClickTurnRestriction:y=()=>{}}=e,_=null;function w(T){_=T,t(1,_)}return r.$$set=T=>{"onClickTurnRestriction"in T&&t(0,y=T.onClickTurnRestriction),"$$scope"in T&&t(9,p=T.$$scope)},r.$$.update=()=>{r.$$.dirty&2&&t(3,n=_==null?Ki():{type:"FeatureCollection",features:[{type:"Feature",geometry:JSON.parse(_.properties.from_geometry),properties:{}},{type:"Feature",geometry:JSON.parse(_.properties.to_geometry),properties:{}}]}),r.$$.dirty&96&&t(2,i=c>0?o.renderTurnRestrictions():Ki())},[y,_,i,n,a,o,c,d,w,p]}class jL extends Lt{constructor(e){super(),Mt(this,e,NL,OL,vt,{onClickTurnRestriction:0})}}const UL=r=>({}),x1=r=>({}),VL=r=>({}),k1=r=>({});function qL(r){let e;const t=r[6]["modal-filter"],n=Sn(t,r,r[7],k1);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&128)&&Tn(n,t,i,i[7],e?Cn(t,i[7],o,VL):Mn(i[7]),k1)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function ZL(r){let e,t,n,i;const o=[mn("modal-filters"),{filter:["all",["!=",["get","filter_kind"],"diagonal_filter"],r[3]?["literal",!0]:["get","edited"]]},{minzoom:Zf},{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let c={$$slots:{default:[qL]},$$scope:{ctx:r}};for(let p=0;p<o.length;p+=1)c=Bt(c,o[p]);e=new Fc({props:c}),e.$on("click",function(){bl(r[0])&&r[0].apply(this,arguments)});const a=[mn("intersection-filters"),{filter:["==",["get","filter_kind"],"diagonal_filter"]},{minzoom:Zf},{layout:{"icon-image":"diagonal_filter","icon-rotate":["get","angle",["get","filter"]],"icon-allow-overlap":!0,"icon-size":.07}},{interactive:!1}];let d={};for(let p=0;p<a.length;p+=1)d=Bt(d,a[p]);return n=new Fc({props:d}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment)},m(p,y){ue(e,p,y),q(p,t,y),ue(n,p,y),i=!0},p(p,y){r=p;const _=y&8?Fn(o,[o[0],y&8&&{filter:["all",["!=",["get","filter_kind"],"diagonal_filter"],r[3]?["literal",!0]:["get","edited"]]},y&0&&{minzoom:Zf},o[3],o[4]]):{};y&128&&(_.$$scope={dirty:y,ctx:r}),e.$set(_);const w=y&0?Fn(a,[a[0],a[1],{minzoom:Zf},a[3],a[4]]):{};n.$set(w)},i(p){i||(j(e.$$.fragment,p),j(n.$$.fragment,p),i=!0)},o(p){Z(e.$$.fragment,p),Z(n.$$.fragment,p),i=!1},d(p){p&&V(t),he(e,p),he(n,p)}}}function GL(r){let e;const t=r[6]["turn-restriction"],n=Sn(t,r,r[7],x1);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&128)&&Tn(n,t,i,i[7],e?Cn(t,i[7],o,UL):Mn(i[7]),x1)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function HL(r){let e,t,n,i;return e=new dr({props:{data:r[2],generateId:!0,$$slots:{default:[ZL]},$$scope:{ctx:r}}}),n=new jL({props:{onClickTurnRestriction:r[1],$$slots:{default:[GL]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment)},m(o,c){ue(e,o,c),q(o,t,c),ue(n,o,c),i=!0},p(o,[c]){const a={};c&4&&(a.data=o[2]),c&137&&(a.$$scope={dirty:c,ctx:o}),e.$set(a);const d={};c&2&&(d.onClickTurnRestriction=o[1]),c&128&&(d.$$scope={dirty:c,ctx:o}),n.$set(d)},i(o){i||(j(e.$$.fragment,o),j(n.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),Z(n.$$.fragment,o),i=!1},d(o){o&&V(t),he(e,o),he(n,o)}}}let Zf=13;function WL(r,e,t){let n,i,o,c;at(r,Ar,_=>t(4,i=_)),at(r,so,_=>t(5,o=_)),at(r,fd,_=>t(3,c=_));let{$$slots:a={},$$scope:d}=e,{onClickModalFilter:p=()=>{}}=e,{onClickTurnRestriction:y=()=>{}}=e;return r.$$set=_=>{"onClickModalFilter"in _&&t(0,p=_.onClickModalFilter),"onClickTurnRestriction"in _&&t(1,y=_.onClickTurnRestriction),"$$scope"in _&&t(7,d=_.$$scope)},r.$$.update=()=>{r.$$.dirty&48&&t(2,n=o>0?i.renderModalFilters():Ki())},[p,y,n,c,i,o,a,d]}class Oa extends Lt{constructor(e){super(),Mt(this,e,WL,HL,vt,{onClickModalFilter:0,onClickTurnRestriction:1})}}function KL(r){let e,t;const n=[mn("one-ways"),{filter:["all",["in",["get","kind"],["literal",["interior_road","main_road"]]],["!=",["get","travel_flow"],"both"]]},{layout:{"icon-image":"oneway_arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","travel_flow"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","travel_flow_edited"],1,.5]}},{minzoom:13},{interactive:!1},{hoverCursor:"pointer"}];let i={};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new Fc({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,[c]){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}class Dd extends Lt{constructor(e){super(),Mt(this,e,null,KL,vt,{})}}function XL(r){let e;const t=r[3].default,n=Sn(t,r,r[4],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16)&&Tn(n,t,i,i[4],e?Cn(t,i[4],o,null):Mn(i[4]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function JL(r){let e,t;return e=new dr({props:{data:r[0],generateId:!0,$$slots:{default:[XL]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&16&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function YL(r,e,t){let n,i;at(r,Ar,d=>t(2,i=d));let{$$slots:o={},$$scope:c}=e,{input:a=null}=e;return r.$$set=d=>{"input"in d&&t(1,a=d.input),"$$scope"in d&&t(4,c=d.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&t(0,n=a||i.renderNeighbourhood()),r.$$.dirty&1&&bd("neighbourhoodGj",n)},[n,a,i,o,c]}class Ah extends Lt{constructor(e){super(),Mt(this,e,YL,JL,vt,{input:1})}}function id(){return["match",["get","cell_color"],"disconnected","red",["let","index",["%",["to-number",["get","cell_color"]],10],["match",["var","index"],0,"#8dd3c7",1,"#ffffb3",2,"#bebada",3,"#80b1d3",4,"#fdb462",5,"#b3de69",6,"#fccde5",7,"#bc80bd",8,"#ccebc5",9,"#ffed6f","blue"]]]}function QL(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function eE(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function tE(r){let e;return{c(){e=xe("Editing")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function nE(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M;return o=new $n({props:{$$slots:{default:[QL]},$$scope:{ctx:r}}}),o.$on("click",Bo),d=new $n({props:{$$slots:{default:[eE]},$$scope:{ctx:r}}}),d.$on("click",r[8]),_=new $n({props:{$$slots:{default:[tE]},$$scope:{ctx:r}}}),_.$on("click",r[9]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),fe(o.$$.fragment),c=oe(),a=U("li"),fe(d.$$.fragment),p=oe(),y=U("li"),fe(_.$$.fragment),w=oe(),T=U("li"),T.textContent="Debug mode",de(t,"aria-label","breadcrumb"),de(e,"slot","top")},m($,P){q($,e,P),R(e,t),R(t,n),R(n,i),ue(o,i,null),R(n,c),R(n,a),ue(d,a,null),R(n,p),R(n,y),ue(_,y,null),R(n,w),R(n,T),M=!0},p($,P){const D={};P&2048&&(D.$$scope={dirty:P,ctx:$}),o.$set(D);const I={};P&2048&&(I.$$scope={dirty:P,ctx:$}),d.$set(I);const F={};P&2048&&(F.$$scope={dirty:P,ctx:$}),_.$set(F)},i($){M||(j(o.$$.fragment,$),j(d.$$.fragment,$),j(_.$$.fragment,$),M=!0)},o($){Z(o.$$.fragment,$),Z(d.$$.fragment,$),Z(_.$$.fragment,$),M=!1},d($){$&&V(e),he(o),he(d),he(_)}}}function S1(r){let e,t,n;return{c(){e=U("button"),e.textContent="",de(e,"class","close-btn svelte-khnvno")},m(i,o){q(i,e,o),t||(n=wt(e,"click",r[6]),t=!0)},p:et,d(i){i&&V(e),t=!1,n()}}}function rE(r){let e;return{c(){e=U("p"),e.textContent="Click an intersection to inspect its movements."},m(t,n){q(t,e,n)},p:et,i:et,o:et,d(t){t&&V(e)}}}function iE(r){let e,t,n,i,o,c,a;e=new Ch({props:{properties:r[0].feature.properties}});function d(y){r[7](y)}let p={list:r[0].movements.features};return r[0].movementIdx!==void 0&&(p.idx=r[0].movementIdx),o=new Cd({props:p}),hn.push(()=>In(o,"idx",d)),{c(){fe(e.$$.fragment),t=oe(),n=U("h5"),n.textContent="Turn restrictions:",i=oe(),fe(o.$$.fragment)},m(y,_){ue(e,y,_),q(y,t,_),q(y,n,_),q(y,i,_),ue(o,y,_),a=!0},p(y,_){const w={};_&1&&(w.properties=y[0].feature.properties),e.$set(w);const T={};_&1&&(T.list=y[0].movements.features),!c&&_&1&&(c=!0,T.idx=y[0].movementIdx,En(()=>c=!1)),o.$set(T)},i(y){a||(j(e.$$.fragment,y),j(o.$$.fragment,y),a=!0)},o(y){Z(e.$$.fragment,y),Z(o.$$.fragment,y),a=!1},d(y){y&&(V(t),V(n),V(i)),he(e,y),he(o,y)}}}function oE(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M;t=new na({}),t.$on("click",r[5]);let $=r[0]&&S1(r);const P=[iE,rE],D=[];function I(F,N){return F[0]?0:1}return w=I(r),T=D[w]=P[w](r),{c(){e=U("div"),fe(t.$$.fragment),n=oe(),i=U("h4"),i.textContent="Roads",o=oe(),c=U("p"),c.textContent="Click a road to visit its OSM object.",a=oe(),d=U("div"),p=U("h4"),p.textContent="Intersections",y=oe(),$&&$.c(),_=oe(),T.c(),st(d,"display","flex"),st(d,"align-items","start"),st(d,"justify-content","space-between"),de(e,"slot","sidebar")},m(F,N){q(F,e,N),ue(t,e,null),R(e,n),R(e,i),R(e,o),R(e,c),R(e,a),R(e,d),R(d,p),R(d,y),$&&$.m(d,null),R(e,_),D[w].m(e,null),M=!0},p(F,N){F[0]?$?$.p(F,N):($=S1(F),$.c(),$.m(d,null)):$&&($.d(1),$=null);let W=w;w=I(F),w===W?D[w].p(F,N):(en(),Z(D[W],1,1,()=>{D[W]=null}),tn(),T=D[w],T?T.p(F,N):(T=D[w]=P[w](F),T.c()),j(T,1),T.m(e,null))},i(F){M||(j(t.$$.fragment,F),j(T),M=!0)},o(F){Z(t.$$.fragment,F),Z(T),M=!1},d(F){F&&V(e),he(t),$&&$.d(),D[w].d()}}}function sE(r){let e,t;return e=new Ch({props:{properties:r[10]}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.properties=n[10]),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function aE(r){let e,t;return e=new ui({props:{openOn:"hover",$$slots:{default:[sE,({props:n})=>({10:n}),({props:n})=>n?1024:0]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&3072&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function lE(r){let e,t;return e=new Ch({props:{properties:r[10]}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.properties=n[10]),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function cE(r){let e,t,n;return t=new ui({props:{openOn:"hover",$$slots:{default:[lE,({props:i})=>({10:i}),({props:i})=>i?1024:0]},$$scope:{ctx:r}}}),{c(){e=U("div"),fe(t.$$.fragment),de(e,"slot","line-popup")},m(i,o){q(i,e,o),ue(t,e,null),n=!0},p(i,o){const c={};o&3072&&(c.$$scope={dirty:o,ctx:i}),t.$set(c)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),he(t)}}}function uE(r){let e,t,n,i,o,c,a,d,p,y;e=new zd({}),n=new Pd({}),o=new Dd({});const _=[mn("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let w={$$slots:{default:[aE]},$$scope:{ctx:r}};for(let T=0;T<_.length;T+=1)w=Bt(w,_[T]);return a=new wl({props:w}),p=new Ih({props:{interactive:!0,onClickLine:r[4],$$slots:{"line-popup":[cE]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment),i=oe(),fe(o.$$.fragment),c=oe(),fe(a.$$.fragment),d=oe(),fe(p.$$.fragment)},m(T,M){ue(e,T,M),q(T,t,M),ue(n,T,M),q(T,i,M),ue(o,T,M),q(T,c,M),ue(a,T,M),q(T,d,M),ue(p,T,M),y=!0},p(T,M){const $={};M&2048&&($.$$scope={dirty:M,ctx:T}),a.$set($);const P={};M&2048&&(P.$$scope={dirty:M,ctx:T}),p.$set(P)},i(T){y||(j(e.$$.fragment,T),j(n.$$.fragment,T),j(o.$$.fragment,T),j(a.$$.fragment,T),j(p.$$.fragment,T),y=!0)},o(T){Z(e.$$.fragment,T),Z(n.$$.fragment,T),Z(o.$$.fragment,T),Z(a.$$.fragment,T),Z(p.$$.fragment,T),y=!1},d(T){T&&(V(t),V(i),V(c),V(d)),he(e,T),he(n,T),he(o,T),he(a,T),he(p,T)}}}function hE(r){let e,t;return e=new Ch({props:{properties:r[10]}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.properties=n[10]),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function fE(r){let e,t;return e=new ui({props:{openOn:"hover",$$slots:{default:[hE,({props:n})=>({10:n}),({props:n})=>n?1024:0]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&3072&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function dE(r){let e,t;return e=new Ch({props:{properties:r[10]}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.properties=n[10]),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function pE(r){let e,t;return e=new ui({props:{openOn:"hover",$$slots:{default:[dE,({props:n})=>({10:n}),({props:n})=>n?1024:0]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&3072&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function mE(r){var o,c,a;let e,t;const n=[mn("debug-intersections"),{paint:{"circle-radius":gm(30),"circle-color":yo.mapFeature.hover.backgroundColor,"circle-stroke-color":yo.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":Hn(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((a=(c=(o=r[0])==null?void 0:o.feature)==null?void 0:c.properties)==null?void 0:a.intersection_id)??-1],.3,Hn(0,.5)]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={$$slots:{default:[pE]},$$scope:{ctx:r}};for(let d=0;d<n.length;d+=1)i=Bt(i,n[d]);return e=new wl({props:i}),e.$on("click",r[3]),{c(){fe(e.$$.fragment)},m(d,p){ue(e,d,p),t=!0},p(d,p){var _,w,T;const y=p&1?Fn(n,[n[0],{paint:{"circle-radius":gm(30),"circle-color":yo.mapFeature.hover.backgroundColor,"circle-stroke-color":yo.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":Hn(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((T=(w=(_=d[0])==null?void 0:_.feature)==null?void 0:w.properties)==null?void 0:T.intersection_id)??-1],.3,Hn(0,.5)]}},n[2],n[3]]):{};p&2048&&(y.$$scope={dirty:p,ctx:d}),e.$set(y)},i(d){t||(j(e.$$.fragment,d),t=!0)},o(d){Z(e.$$.fragment,d),t=!1},d(d){he(e,d)}}}function C1(r){let e,t;return e=new dr({props:{data:r[0].movements,generateId:!0,$$slots:{default:[gE]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.data=n[0].movements),i&2049&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function gE(r){let e,t,n,i;const o=[mn("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let c={};for(let p=0;p<o.length;p+=1)c=Bt(c,o[p]);e=new sr({props:c});const a=[mn("debug-movements-fill"),{filter:["==",["id"],r[0].movementIdx]},{paint:{"fill-color":"cyan"}}];let d={};for(let p=0;p<a.length;p+=1)d=Bt(d,a[p]);return n=new Hi({props:d}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment)},m(p,y){ue(e,p,y),q(p,t,y),ue(n,p,y),i=!0},p(p,y){const _={};e.$set(_);const w=y&1?Fn(a,[a[0],{filter:["==",["id"],p[0].movementIdx]},a[2]]):{};n.$set(w)},i(p){i||(j(e.$$.fragment,p),j(n.$$.fragment,p),i=!0)},o(p){Z(e.$$.fragment,p),Z(n.$$.fragment,p),i=!1},d(p){p&&V(t),he(e,p),he(n,p)}}}function _E(r){let e,t,n,i,o,c,a,d;t=new Ah({props:{$$slots:{default:[uE]},$$scope:{ctx:r}}}),i=new Oa({props:{$$slots:{default:[fE]},$$scope:{ctx:r}}}),c=new dr({props:{data:yr(r[1]).getAllIntersections(),generateId:!0,$$slots:{default:[mE]},$$scope:{ctx:r}}});let p=r[0]&&C1(r);return{c(){e=U("div"),fe(t.$$.fragment),n=oe(),fe(i.$$.fragment),o=oe(),fe(c.$$.fragment),a=oe(),p&&p.c(),de(e,"slot","map")},m(y,_){q(y,e,_),ue(t,e,null),R(e,n),ue(i,e,null),R(e,o),ue(c,e,null),R(e,a),p&&p.m(e,null),d=!0},p(y,_){const w={};_&2048&&(w.$$scope={dirty:_,ctx:y}),t.$set(w);const T={};_&2048&&(T.$$scope={dirty:_,ctx:y}),i.$set(T);const M={};_&2&&(M.data=yr(y[1]).getAllIntersections()),_&2049&&(M.$$scope={dirty:_,ctx:y}),c.$set(M),y[0]?p?(p.p(y,_),_&1&&j(p,1)):(p=C1(y),p.c(),j(p,1),p.m(e,null)):p&&(en(),Z(p,1,1,()=>{p=null}),tn())},i(y){d||(j(t.$$.fragment,y),j(i.$$.fragment,y),j(c.$$.fragment,y),j(p),d=!0)},o(y){Z(t.$$.fragment,y),Z(i.$$.fragment,y),Z(c.$$.fragment,y),Z(p),d=!1},d(y){y&&V(e),he(t),he(i),he(c),p&&p.d()}}}function yE(r){let e,t;return e=new bo({props:{$$slots:{map:[_E],sidebar:[oE],top:[nE]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,[i]){const o={};i&2055&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function bE(r,e,t){let n,i;at(r,Ar,T=>t(1,n=T)),at(r,an,T=>t(2,i=T));let o=null;function c(T){let M=T.detail.features[0],$=n.getMovements(M.properties.intersection_id);t(0,o={feature:M,movements:$,movementIdx:0})}const a=(T,M)=>window.open(yr(T.properties).way,"_blank"),d=()=>Nt(an,i={mode:"neighbourhood"},i),p=()=>t(0,o=null);function y(T){r.$$.not_equal(o.movementIdx,T)&&(o.movementIdx=T,t(0,o))}return[o,n,i,c,a,d,p,y,()=>Nt(an,i={mode:"pick-neighbourhood"},i),()=>Nt(an,i={mode:"neighbourhood"},i)]}class vE extends Lt{constructor(e){super(),Mt(this,e,bE,yE,vt,{})}}const T1="/ltn/assets/one_way_left-9368d5dd.svg",wE="/ltn/assets/traffic_1-a90740ec.svg";var Lo=63710088e-1,Gv={centimeters:Lo*100,centimetres:Lo*100,degrees:360/(2*Math.PI),feet:Lo*3.28084,inches:Lo*39.37,kilometers:Lo/1e3,kilometres:Lo/1e3,meters:Lo,metres:Lo,miles:Lo/1609.344,millimeters:Lo*1e3,millimetres:Lo*1e3,nauticalmiles:Lo/1852,radians:1,yards:Lo*1.0936};function xE(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function zm(r,e,t={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!M1(r[0])||!M1(r[1]))throw new Error("coordinates must contain numbers");return xE({type:"Point",coordinates:r},e,t)}function kE(r,e="kilometers"){const t=Gv[e];if(!t)throw new Error(e+" units is invalid");return r*t}function SE(r,e="kilometers"){const t=Gv[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Dm(r){return r%(2*Math.PI)*180/Math.PI}function fs(r){return r%360*Math.PI/180}function M1(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function wh(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function CE(r){return r.type==="Feature"?r.geometry:r}function Hv(r,e,t={}){if(t.final===!0)return TE(r,e);const n=wh(r),i=wh(e),o=fs(n[0]),c=fs(i[0]),a=fs(n[1]),d=fs(i[1]),p=Math.sin(c-o)*Math.cos(d),y=Math.cos(a)*Math.sin(d)-Math.sin(a)*Math.cos(d)*Math.cos(c-o);return Dm(Math.atan2(p,y))}function TE(r,e){let t=Hv(e,r);return t=(t+180)%360,t}function ME(r,e,t,n={}){const i=wh(r),o=fs(i[0]),c=fs(i[1]),a=fs(t),d=SE(e,n.units),p=Math.asin(Math.sin(c)*Math.cos(d)+Math.cos(c)*Math.sin(d)*Math.cos(a)),y=o+Math.atan2(Math.sin(a)*Math.sin(d)*Math.cos(c),Math.cos(d)-Math.sin(c)*Math.sin(p)),_=Dm(y),w=Dm(p);return zm([_,w],n.properties)}function LE(r,e,t={}){var n=wh(r),i=wh(e),o=fs(i[1]-n[1]),c=fs(i[0]-n[0]),a=fs(n[1]),d=fs(i[1]),p=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(c/2),2)*Math.cos(a)*Math.cos(d);return kE(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),t.units)}function EE(r,e,t={}){const i=CE(r).coordinates;let o=0;for(let c=0;c<i.length&&!(e>=o&&c===i.length-1);c++)if(o>=e){const a=e-o;if(a){const d=Hv(i[c],i[c-1])-180;return ME(i[c],a,d,t)}else return zm(i[c])}else o+=LE(i[c],i[c+1],t);return zm(i[i.length-1])}var IE=EE;function AE(r){let e,t;const n=[mn("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let i={};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new wl({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function PE(r){let e,t;return e=new dr({props:{data:r[0],$$slots:{default:[AE]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&1024&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}let zE=50,DE=100,$E=.01;function RE(r,e,t){let{paths:n}=e,i=d(),o=p(),c=_(),a=setInterval(w,DE);Yr(()=>clearInterval(a));function d(){return n.features.map(T=>1/T.properties.directness).reduce((T,M)=>T+M,0)}function p(){return n.features.length==0?[]:Array.from({length:zE},y)}function y(){let T=Math.random()*i,M=0;for(let[$,P]of n.features.entries())if(M+=1/P.properties.directness,T<M)return{idx:$,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${i}`)}function _(){return{type:"FeatureCollection",features:o.map(({idx:T,distance:M})=>IE(n.features[T],M,{units:"kilometers"}))}}function w(){for(let[T,M]of o.entries())M.distance+=$E,M.distance>=n.features[M.idx].properties.length_meters/1e3&&(o[T]=y());t(0,c=_())}return r.$$set=T=>{"paths"in T&&t(1,n=T.paths)},r.$$.update=()=>{r.$$.dirty&2&&n&&(i=d(),o=p())},[c,n]}class FE extends Lt{constructor(e){super(),Mt(this,e,RE,PE,vt,{paths:1})}}class BE{constructor(e){tr(this,"feature");this.feature=e}get intersectionId(){return this.feature.properties.intersection_id}get filter(){return this.feature.properties.filter}get filterAngle(){var e;return(e=this.feature.properties.filter)==null?void 0:e.angle}get hasRotatedFilter(){var e;return((e=this.feature.properties.filter)==null?void 0:e.is_rotated)??!1}}function OE(r){let e,t,n,i,o;return{c(){e=U("div"),e.textContent="+",t=oe(),n=U("img"),o=xe(`
    Add diagonal filter`),st(e,"font-size","200%"),st(e,"margin-top","-12px"),de(e,"class","icon"),fr(n.src,i="/ltn//filters/diagonal_filter_icon.png")||de(n,"src",i),de(n,"alt","Add diagonal filter"),st(n,"transform","rotate(135deg)"),de(n,"class","svelte-j2s60j")},m(c,a){q(c,e,a),q(c,t,a),q(c,n,a),q(c,o,a)},p:et,d(c){c&&(V(e),V(t),V(n),V(o))}}}function NE(r){let e;function t(o,c){return o[0].hasRotatedFilter?UE:jE}let n=t(r),i=n(r);return{c(){i.c(),e=Xn()},m(o,c){i.m(o,c),q(o,e,c)},p(o,c){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&V(e),i.d(o)}}}function jE(r){let e,t,n,i,o;return{c(){e=U("div"),e.textContent="",t=oe(),n=U("img"),o=xe(`
      Rotate diagonal filter`),st(e,"font-size","200%"),st(e,"padding-bottom","4px"),de(e,"class","icon"),fr(n.src,i="/ltn//filters/diagonal_filter_icon.png")||de(n,"src",i),de(n,"alt","Rotate diagonal filter"),st(n,"transform","rotate(45deg)"),de(n,"class","svelte-j2s60j")},m(c,a){q(c,e,a),q(c,t,a),q(c,n,a),q(c,o,a)},d(c){c&&(V(e),V(t),V(n),V(o))}}}function UE(r){let e,t,n,i,o;return{c(){e=U("div"),e.textContent="",t=oe(),n=U("img"),o=xe(`
      Delete diagonal filter`),de(e,"class","icon"),fr(n.src,i="/ltn//filters/diagonal_filter_icon.png")||de(n,"src",i),de(n,"alt","Remove diagonal filter"),st(n,"transform","rotate(45deg)"),de(n,"class","svelte-j2s60j")},m(c,a){q(c,e,a),q(c,t,a),q(c,n,a),q(c,o,a)},d(c){c&&(V(e),V(t),V(n),V(o))}}}function VE(r){let e;function t(o,c){return o[0].filter?NE:OE}let n=t(r),i=n(r);return{c(){e=U("div"),i.c(),st(e,"display","flex"),st(e,"align-items","center")},m(o,c){q(o,e,c),i.m(e,null)},p(o,[c]){n===(n=t(o))&&i?i.p(o,c):(i.d(1),i=n(o),i&&(i.c(),i.m(e,null)))},i:et,o:et,d(o){o&&V(e),i.d()}}}function qE(r,e,t){let{intersection:n}=e;return r.$$set=i=>{"intersection"in i&&t(0,n=i.intersection)},[n]}class ZE extends Lt{constructor(e){super(),Mt(this,e,qE,VE,vt,{intersection:0})}}function GE(r){let e,t;return e=new ZE({props:{intersection:r[2](r[6])}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&64&&(o.intersection=n[2](n[6])),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function HE(r){let e,t;return e=new Qb({props:{openOn:"hover",$$slots:{default:[GE,({features:n})=>({6:n}),({features:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function WE(r){let e,t;const n=[mn("editable-intersections"),{filter:["==",["get","kind"],"editable_intersection"]},{paint:{"circle-radius":gm(30),"circle-color":yo.mapFeature.hover.backgroundColor,"circle-opacity":Hn(0,.5),"circle-stroke-color":yo.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":Hn(0,3)}},{minzoom:13},{interactive:r[1]},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={$$slots:{default:[HE]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new wl({props:i}),e.$on("click",r[4]),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,[c]){const a=c&2?Fn(n,[n[0],n[1],n[2],n[3],{interactive:o[1]},n[5],n[6]]):{};c&128&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function KE(r,e,t){let{neighbourhood:n=kh("neighbourhoodGj")}=e,{onClickIntersection:i=p=>{}}=e,{interactive:o=!1}=e;function c(p){let y=n.features[p];return new BE(y)}function a(p){return c(p[0].id)}const d=p=>i(a(p.detail.features));return r.$$set=p=>{"neighbourhood"in p&&t(3,n=p.neighbourhood),"onClickIntersection"in p&&t(0,i=p.onClickIntersection),"interactive"in p&&t(1,o=p.interactive)},[i,o,a,n,d]}class XE extends Lt{constructor(e){super(),Mt(this,e,KE,WE,vt,{neighbourhood:3,onClickIntersection:0,interactive:1})}}function L1(r,e,t){const n=r.slice();return n[6]=e[t],n}function E1(r){let e,t,n,i,o,c,a=r[6].label+"",d,p,y,_,w;function T(){return r[3](r[6])}return{c(){e=U("button"),t=U("img"),i=oe(),o=U("br"),c=oe(),d=xe(a),p=oe(),fr(t.src,n=r[6].iconURL)||de(t,"src",n),de(t,"width","80"),de(t,"alt",r[6].label),de(e,"class","outline"),st(e,"width","100%"),e.disabled=y=r[1]==r[6].filterType},m(M,$){q(M,e,$),R(e,t),R(e,i),R(e,o),R(e,c),R(e,d),R(e,p),_||(w=wt(e,"click",T),_=!0)},p(M,$){r=M,$&2&&y!==(y=r[1]==r[6].filterType)&&(e.disabled=y)},d(M){M&&V(e),_=!1,w()}}}function JE(r){let e,t,n,i,o,c,a,d,p,y,_,w,T=r[2].description+"",M,$,P,D,I,F,N=Rn(lo.allTypes),W=[];for(let se=0;se<N.length;se+=1)W[se]=E1(L1(r,N,se));return{c(){e=U("h3"),e.textContent="Choose a modal filter to place on streets",t=oe(),n=U("table"),i=U("tr"),o=U("td");for(let se=0;se<W.length;se+=1)W[se].c();c=oe(),a=U("td"),d=U("img"),_=oe(),w=U("p"),M=xe(T),$=oe(),P=U("center"),D=U("button"),D.textContent="Confirm",fr(d.src,p=r[2].largeImageURL)||de(d,"src",p),de(d,"height","300"),de(d,"alt",y=r[2].label)},m(se,J){q(se,e,J),q(se,t,J),q(se,n,J),R(n,i),R(i,o);for(let ee=0;ee<W.length;ee+=1)W[ee]&&W[ee].m(o,null);R(i,c),R(i,a),R(a,d),R(a,_),R(a,w),R(w,M),q(se,$,J),q(se,P,J),R(P,D),I||(F=wt(D,"click",r[4]),I=!0)},p(se,J){if(J&2){N=Rn(lo.allTypes);let ee;for(ee=0;ee<N.length;ee+=1){const me=L1(se,N,ee);W[ee]?W[ee].p(me,J):(W[ee]=E1(me),W[ee].c(),W[ee].m(o,null))}for(;ee<W.length;ee+=1)W[ee].d(1);W.length=N.length}J&4&&!fr(d.src,p=se[2].largeImageURL)&&de(d,"src",p),J&4&&y!==(y=se[2].label)&&de(d,"alt",y),J&4&&T!==(T=se[2].description+"")&&Tt(M,T)},d(se){se&&(V(e),V(t),V(n),V($),V(P)),di(W,se),I=!1,F()}}}function YE(r){let e,t,n;function i(c){r[5](c)}let o={$$slots:{default:[JE]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.show=r[0]),e=new vd({props:o}),hn.push(()=>In(e,"show",i)),{c(){fe(e.$$.fragment)},m(c,a){ue(e,c,a),n=!0},p(c,[a]){const d={};a&519&&(d.$$scope={dirty:a,ctx:c}),!t&&a&1&&(t=!0,d.show=c[0],En(()=>t=!1)),e.$set(d)},i(c){n||(j(e.$$.fragment,c),n=!0)},o(c){Z(e.$$.fragment,c),n=!1},d(c){he(e,c)}}}function QE(r,e,t){let n,i;at(r,am,p=>t(1,i=p));let{show:o}=e;const c=p=>Nt(am,i=p.filterType,i),a=()=>t(0,o=!1);function d(p){o=p,t(0,o)}return r.$$set=p=>{"show"in p&&t(0,o=p.show)},r.$$.update=()=>{r.$$.dirty&2&&t(2,n=lo.allTypes.find(p=>p.filterType==i))},[o,i,n,c,a,d]}class eI extends Lt{constructor(e){super(),Mt(this,e,QE,YE,vt,{show:0})}}function I1(r){let e,t;return e=new dr({props:{data:r[0],$$slots:{default:[tI]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.data=n[0]),i&64&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function tI(r){let e,t;const n=[mn("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let i={};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new sr({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function nI(r){let e,t,n=r[0]&&I1(r);return{c(){n&&n.c(),e=Xn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&j(n,1)):(n=I1(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(en(),Z(n,1,1,()=>{n=null}),tn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function rI(r,e,t){let{map:n}=e,i=null;const o=ms();n.on("dragstart",c),n.on("mousemove",a),n.on("mouseup",d),Yr(()=>{n.dragPan.enable(),n.off("dragstart",c),n.off("mousemove",a),n.off("mouseup",d)});function c(){n.dragPan.disable(),t(0,i={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function a(p){i&&(i.geometry.coordinates.push(p.lngLat.toArray()),t(0,i))}function d(){i&&(o("done",i),t(0,i=null))}return r.$$set=p=>{"map"in p&&t(1,n=p.map)},[i,n]}class iI extends Lt{constructor(e){super(),Mt(this,e,rI,nI,vt,{map:1})}}function oI(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function sI(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function aI(r){let e;return{c(){e=U("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function lI(r){let e;return{c(){e=xe("View shortcuts")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function cI(r){let e;return{c(){e=xe("Route")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function uI(r){let e;return{c(){e=xe("Impact routing to one destination")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function hI(r){let e;return{c(){e=xe("Change this boundary")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function A1(r){let e,t,n;return t=new $n({props:{$$slots:{default:[fI]},$$scope:{ctx:r}}}),t.$on("click",r[43]),{c(){e=U("li"),fe(t.$$.fragment)},m(i,o){q(i,e,o),ue(t,e,null),n=!0},p(i,o){const c={};o[1]&65536&&(c.$$scope={dirty:o,ctx:i}),t.$set(c)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),he(t)}}}function fI(r){let e;return{c(){e=xe("Debug")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function dI(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M,$,P,D,I,F,N,W,se,J,ee,me,Ie,Q,ae;o=new $n({props:{$$slots:{default:[oI]},$$scope:{ctx:r}}}),o.$on("click",Bo),d=new $n({props:{$$slots:{default:[sI]},$$scope:{ctx:r}}}),d.$on("click",r[38]),w=new Qm({props:{$$slots:{default:[aI]},$$scope:{ctx:r}}}),D=new $n({props:{$$slots:{default:[lI]},$$scope:{ctx:r}}}),D.$on("click",r[39]),N=new $n({props:{$$slots:{default:[cI]},$$scope:{ctx:r}}}),N.$on("click",r[40]),J=new $n({props:{$$slots:{default:[uI]},$$scope:{ctx:r}}}),J.$on("click",r[41]),Ie=new $n({props:{$$slots:{default:[hI]},$$scope:{ctx:r}}}),Ie.$on("click",r[42]);let Pe=r[14]&&A1(r);return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),fe(o.$$.fragment),c=oe(),a=U("li"),fe(d.$$.fragment),p=oe(),y=U("li"),_=xe(`Editing
          `),fe(w.$$.fragment),T=oe(),M=U("nav"),$=U("ul"),P=U("li"),fe(D.$$.fragment),I=oe(),F=U("li"),fe(N.$$.fragment),W=oe(),se=U("li"),fe(J.$$.fragment),ee=oe(),me=U("li"),fe(Ie.$$.fragment),Q=oe(),Pe&&Pe.c(),de(t,"aria-label","breadcrumb"),de(e,"slot","top"),st(e,"display","flex"),st(e,"justify-content","space-between")},m(ve,tt){q(ve,e,tt),R(e,t),R(t,n),R(n,i),ue(o,i,null),R(n,c),R(n,a),ue(d,a,null),R(n,p),R(n,y),R(y,_),ue(w,y,null),R(e,T),R(e,M),R(M,$),R($,P),ue(D,P,null),R($,I),R($,F),ue(N,F,null),R($,W),R($,se),ue(J,se,null),R($,ee),R($,me),ue(Ie,me,null),R($,Q),Pe&&Pe.m($,null),ae=!0},p(ve,tt){const Ge={};tt[1]&65536&&(Ge.$$scope={dirty:tt,ctx:ve}),o.$set(Ge);const Ee={};tt[1]&65536&&(Ee.$$scope={dirty:tt,ctx:ve}),d.$set(Ee);const $e={};tt[1]&65536&&($e.$$scope={dirty:tt,ctx:ve}),w.$set($e);const St={};tt[1]&65536&&(St.$$scope={dirty:tt,ctx:ve}),D.$set(St);const rt={};tt[1]&65536&&(rt.$$scope={dirty:tt,ctx:ve}),N.$set(rt);const lt={};tt[1]&65536&&(lt.$$scope={dirty:tt,ctx:ve}),J.$set(lt);const mt={};tt[1]&65536&&(mt.$$scope={dirty:tt,ctx:ve}),Ie.$set(mt),ve[14]?Pe?(Pe.p(ve,tt),tt[0]&16384&&j(Pe,1)):(Pe=A1(ve),Pe.c(),j(Pe,1),Pe.m($,null)):Pe&&(en(),Z(Pe,1,1,()=>{Pe=null}),tn())},i(ve){ae||(j(o.$$.fragment,ve),j(d.$$.fragment,ve),j(w.$$.fragment,ve),j(D.$$.fragment,ve),j(N.$$.fragment,ve),j(J.$$.fragment,ve),j(Ie.$$.fragment,ve),j(Pe),ae=!0)},o(ve){Z(o.$$.fragment,ve),Z(d.$$.fragment,ve),Z(w.$$.fragment,ve),Z(D.$$.fragment,ve),Z(N.$$.fragment,ve),Z(J.$$.fragment,ve),Z(Ie.$$.fragment,ve),Z(Pe),ae=!1},d(ve){ve&&V(e),he(o),he(d),he(w),he(D),he(N),he(J),he(Ie),Pe&&Pe.d()}}}function P1(r){let e;return{c(){e=U("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function pI(r){let e,t,n,i,o;return{c(){e=U("h3"),e.textContent="Reclassify main roads",t=oe(),n=U("p"),n.innerHTML=`<i>Main roads</i>, drawn in grey, were classified automatically using
          data from
          <a href="https://openstreetmap.org/about" target="_blank">OpenStreetMap</a>, but you can reclassify a road segment by clicking on it.`,i=oe(),o=U("p"),o.textContent=`Main roads are typically better suited to support higher levels of
          traffic than neighbourhood roads.`},m(c,a){q(c,e,a),q(c,t,a),q(c,n,a),q(c,i,a),q(c,o,a)},p:et,i:et,o:et,d(c){c&&(V(e),V(t),V(n),V(i),V(o))}}}function mI(r){let e,t,n;return{c(){e=U("h3"),e.textContent="Restrict turns",t=oe(),n=U("p"),n.textContent=`To restrict certain turns, first click on the source road, then the
          destination road. Traffic will no longer be able to turn from the
          source road to the destination road.`},m(i,o){q(i,e,o),q(i,t,o),q(i,n,o)},p:et,i:et,o:et,d(i){i&&(V(e),V(t),V(n))}}}function gI(r){let e,t,n;return{c(){e=U("h3"),e.textContent="Toggle one-way",t=oe(),n=U("p"),n.textContent=`Click on a road segment to toggle its direction. This will change the
          direction of traffic flow on that road.`},m(i,o){q(i,e,o),q(i,t,o),q(i,n,o)},p:et,i:et,o:et,d(i){i&&(V(e),V(t),V(n))}}}function _I(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M,$,P,D,I;function F(W){r[31](W)}let N={};return r[3]!==void 0&&(N.show=r[3]),o=new eI({props:N}),hn.push(()=>In(o,"show",F)),T=new Zk({}),{c(){e=U("h3"),e.textContent="Add modal filter",t=oe(),n=U("p"),n.textContent=`Modal filters restrict what kind of traffic can pass through a road
          segment. Place them strategically to deter shortcuts through your
          neighbourhood.`,i=oe(),fe(o.$$.fragment),a=oe(),d=U("div"),p=U("button"),p.textContent="Change modal filter type",y=oe(),_=U("button"),w=U("div"),fe(T.$$.fragment),M=oe(),$=U("span"),$.textContent="Add along a line",de(p,"class","outline"),st(w,"display","flex"),st(w,"align-items","center"),st(w,"gap","8px"),de(_,"data-tooltip","Add many modal filters along a line"),Qt(_,"active",r[0].freehand),Qt(_,"outline",!r[0].freehand),st(d,"display","flex"),st(d,"gap","8px"),st(d,"align-items","center")},m(W,se){q(W,e,se),q(W,t,se),q(W,n,se),q(W,i,se),ue(o,W,se),q(W,a,se),q(W,d,se),R(d,p),R(d,y),R(d,_),R(_,w),ue(T,w,null),R(w,M),R(w,$),P=!0,D||(I=[wt(p,"click",r[32]),wt(_,"click",function(){bl(r[0].freehand?r[33]:r[34])&&(r[0].freehand?r[33]:r[34]).apply(this,arguments)})],D=!0)},p(W,se){r=W;const J={};!c&&se[0]&8&&(c=!0,J.show=r[3],En(()=>c=!1)),o.$set(J),(!P||se[0]&1)&&Qt(_,"active",r[0].freehand),(!P||se[0]&1)&&Qt(_,"outline",!r[0].freehand)},i(W){P||(j(o.$$.fragment,W),j(T.$$.fragment,W),P=!0)},o(W){Z(o.$$.fragment,W),Z(T.$$.fragment,W),P=!1},d(W){W&&(V(e),V(t),V(n),V(i),V(a),V(d)),he(o,W),he(T),D=!1,pr(I)}}}function z1(r){let e,t;return e=new Oo({props:{colorScale:dv,labels:{limits:pv}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function yI(r){let e,t,n=yr(r[6]).properties.name+"",i,o,c,a,d,p,y,_,w,T,M,$,P,D,I,F,N,W,se,J,ee,me,Ie,Q,ae,Pe,ve,tt,Ge,Ee,$e,St,rt,lt,mt,ft,Xe,Dt,_t,$t,Et,Yt,_n,Zt,ln,ze,Ne,kt,jt,_e,vn,Ue,it,Kt,ur,nr,vr,Qr,mr,Ci,Jn,yt,wr,Tr,uo,Yn,At,pn,Gt,Qn,mi,sn=r[8]>0&&P1();Ge=new c3({}),lt=new e3({});const zi=[_I,gI,mI,pI],er=[];function Ce(ne,le){return ne[0].kind=="filter"?0:ne[0].kind=="oneway"?1:ne[0].kind=="turn_restriction"?2:ne[0].kind=="main-roads"?3:-1}~(_t=Ce(r))&&($t=er[_t]=zi[_t](r));let te=r[12]=="speeds"&&z1();return pn=new Uv({props:{neighbourhoodBoundary:yr(r[6])}}),{c(){e=U("div"),t=U("h1"),i=xe(n),o=oe(),sn&&sn.c(),c=oe(),a=U("h2"),a.textContent="Editing tools",d=oe(),p=U("div"),y=U("div"),_=U("button"),w=U("img"),$=oe(),P=U("button"),D=U("div"),D.innerHTML=`<img style="position: absolute; width: 60%; height: 60%; top: -1px; left: -1px;" src="${T1}" alt="Reverse directions" class="svelte-1x77jt8"/> <img style="position: absolute; width: 60%; height: 60%; bottom: -1px; right: -1px; transform: rotate(180deg);" src="${T1}" alt="Reverse directions" class="svelte-1x77jt8"/>`,F=oe(),N=U("button"),W=U("img"),ee=oe(),me=U("button"),Ie=U("img"),Pe=oe(),ve=U("div"),tt=U("button"),fe(Ge.$$.fragment),St=oe(),rt=U("button"),fe(lt.$$.fragment),Xe=oe(),Dt=U("div"),$t&&$t.c(),Et=oe(),Yt=U("h2"),Yt.textContent="Map style",_n=oe(),Zt=U("label"),ln=U("input"),ze=xe(`
      Animate shortcuts`),Ne=oe(),kt=U("p"),kt.innerHTML=`<i>Shortcuts</i>
      are routes from one main road to another, which cut through the neighborhood&#39;s
      interior.`,jt=oe(),_e=U("label"),vn=U("input"),Ue=xe(`
      Show arrows into cells`),it=oe(),Kt=U("p"),Kt.innerHTML="<i>Cells</i> show the area reachable without travelling along a main road.",ur=oe(),nr=U("div"),vr=U("label"),Qr=xe(`Draw roads:
        `),mr=U("select"),Ci=U("option"),Ci.textContent="Worst shortcuts",Jn=U("option"),Jn.textContent="Cell",yt=U("option"),yt.textContent="Edits (either filter or direction)",wr=U("option"),wr.textContent="Speed limit",Tr=oe(),te&&te.c(),uo=oe(),Yn=U("h2"),Yn.textContent="Neighbourhood stats",At=oe(),fe(pn.$$.fragment),fr(w.src,T=yr(lo.getFilter(r[9])).iconURL)||de(w,"src",T),de(w,"alt","Add a modal filter"),de(w,"class","svelte-1x77jt8"),_.disabled=M=r[0].kind=="filter",de(_,"class","icon-btn svelte-1x77jt8"),de(_,"data-tooltip","Add a modal filter (hotkey 1)"),Qt(_,"active",r[0].kind=="filter"),Qt(_,"outline",r[0].kind!="filter"),st(D,"height","100%"),st(D,"width","100%"),st(D,"position","relative"),P.disabled=I=r[0].kind=="oneway",de(P,"class","icon-btn svelte-1x77jt8"),de(P,"data-tooltip","Toggle one-way (hotkey 2)"),Qt(P,"active",r[0].kind=="oneway"),Qt(P,"outline",r[0].kind!="oneway"),fr(W.src,se="/ltn//filters/no_right_turn.svg")||de(W,"src",se),de(W,"alt","Restrict turns"),de(W,"class","svelte-1x77jt8"),N.disabled=J=r[0].kind=="turn_restriction",de(N,"class","icon-btn svelte-1x77jt8"),de(N,"data-tooltip","Restrict turns (hotkey 3)"),Qt(N,"active",r[0].kind=="turn_restriction"),Qt(N,"outline",r[0].kind!="turn_restriction"),fr(Ie.src,Q=wE)||de(Ie,"src",Q),de(Ie,"alt","Change main/minor roads"),de(Ie,"class","svelte-1x77jt8"),me.disabled=ae=r[0].kind=="main-roads",de(me,"class","icon-btn svelte-1x77jt8"),de(me,"data-tooltip","Reclassify main roads (hotkey 4)"),Qt(me,"active",r[0].kind=="main-roads"),Qt(me,"outline",r[0].kind!="main-roads"),st(y,"display","flex"),st(y,"justify-content","left"),st(y,"gap","8px"),de(tt,"class","outline icon-btn svelte-1x77jt8"),tt.disabled=Ee=r[4]==0,de(tt,"data-tooltip",$e=r[4]==0?"Undo Ctrl+Z":`Undo (${r[4]}) Ctrl+Z`),de(rt,"class","outline icon-btn svelte-1x77jt8"),rt.disabled=mt=r[5]==0,de(rt,"data-tooltip",ft=r[5]==0?"Redo Ctrl+Y":`Redo (${r[5]}) Ctrl+Y`),st(ve,"display","flex"),st(ve,"justify-content","right"),st(ve,"gap","8px"),de(p,"class","tool-palette svelte-1x77jt8"),st(p,"height","54px"),st(p,"display","flex"),st(p,"justify-content","space-between"),st(p,"gap","32px"),st(Dt,"min-height","200px"),st(Dt,"padding-bottom","16px"),st(Dt,"border-bottom","solid var(--pico-muted-border-color) 1px"),de(ln,"type","checkbox"),de(vn,"type","checkbox"),Ci.__value="shortcuts",qn(Ci,Ci.__value),Jn.__value="cells",qn(Jn,Jn.__value),yt.__value="edits",qn(yt,yt.__value),wr.__value="speeds",qn(wr,wr.__value),r[12]===void 0&&us(()=>r[37].call(mr)),st(nr,"border","1px solid black"),st(nr,"padding","4px"),de(e,"slot","sidebar")},m(ne,le){q(ne,e,le),R(e,t),R(t,i),R(e,o),sn&&sn.m(e,null),R(e,c),R(e,a),R(e,d),R(e,p),R(p,y),R(y,_),R(_,w),R(y,$),R(y,P),R(P,D),R(y,F),R(y,N),R(N,W),R(y,ee),R(y,me),R(me,Ie),R(p,Pe),R(p,ve),R(ve,tt),ue(Ge,tt,null),R(ve,St),R(ve,rt),ue(lt,rt,null),R(e,Xe),R(e,Dt),~_t&&er[_t].m(Dt,null),R(e,Et),R(e,Yt),R(e,_n),R(e,Zt),R(Zt,ln),ln.checked=r[10],R(Zt,ze),R(e,Ne),R(e,kt),R(e,jt),R(e,_e),R(_e,vn),vn.checked=r[11],R(_e,Ue),R(e,it),R(e,Kt),R(e,ur),R(e,nr),R(nr,vr),R(vr,Qr),R(vr,mr),R(mr,Ci),R(mr,Jn),R(mr,yt),R(mr,wr),Zi(mr,r[12],!0),R(nr,Tr),te&&te.m(nr,null),R(e,uo),R(e,Yn),R(e,At),ue(pn,e,null),Gt=!0,Qn||(mi=[wt(_,"click",r[27]),wt(P,"click",r[28]),wt(N,"click",r[29]),wt(me,"click",r[30]),wt(tt,"click",r[23]),wt(rt,"click",r[24]),wt(ln,"change",r[35]),wt(vn,"change",r[36]),wt(mr,"change",r[37])],Qn=!0)},p(ne,le){(!Gt||le[0]&64)&&n!==(n=yr(ne[6]).properties.name+"")&&Tt(i,n),ne[8]>0?sn||(sn=P1(),sn.c(),sn.m(e,c)):sn&&(sn.d(1),sn=null),(!Gt||le[0]&512&&!fr(w.src,T=yr(lo.getFilter(ne[9])).iconURL))&&de(w,"src",T),(!Gt||le[0]&1&&M!==(M=ne[0].kind=="filter"))&&(_.disabled=M),(!Gt||le[0]&1)&&Qt(_,"active",ne[0].kind=="filter"),(!Gt||le[0]&1)&&Qt(_,"outline",ne[0].kind!="filter"),(!Gt||le[0]&1&&I!==(I=ne[0].kind=="oneway"))&&(P.disabled=I),(!Gt||le[0]&1)&&Qt(P,"active",ne[0].kind=="oneway"),(!Gt||le[0]&1)&&Qt(P,"outline",ne[0].kind!="oneway"),(!Gt||le[0]&1&&J!==(J=ne[0].kind=="turn_restriction"))&&(N.disabled=J),(!Gt||le[0]&1)&&Qt(N,"active",ne[0].kind=="turn_restriction"),(!Gt||le[0]&1)&&Qt(N,"outline",ne[0].kind!="turn_restriction"),(!Gt||le[0]&1&&ae!==(ae=ne[0].kind=="main-roads"))&&(me.disabled=ae),(!Gt||le[0]&1)&&Qt(me,"active",ne[0].kind=="main-roads"),(!Gt||le[0]&1)&&Qt(me,"outline",ne[0].kind!="main-roads"),(!Gt||le[0]&16&&Ee!==(Ee=ne[4]==0))&&(tt.disabled=Ee),(!Gt||le[0]&16&&$e!==($e=ne[4]==0?"Undo Ctrl+Z":`Undo (${ne[4]}) Ctrl+Z`))&&de(tt,"data-tooltip",$e),(!Gt||le[0]&32&&mt!==(mt=ne[5]==0))&&(rt.disabled=mt),(!Gt||le[0]&32&&ft!==(ft=ne[5]==0?"Redo Ctrl+Y":`Redo (${ne[5]}) Ctrl+Y`))&&de(rt,"data-tooltip",ft);let we=_t;_t=Ce(ne),_t===we?~_t&&er[_t].p(ne,le):($t&&(en(),Z(er[we],1,1,()=>{er[we]=null}),tn()),~_t?($t=er[_t],$t?$t.p(ne,le):($t=er[_t]=zi[_t](ne),$t.c()),j($t,1),$t.m(Dt,null)):$t=null),le[0]&1024&&(ln.checked=ne[10]),le[0]&2048&&(vn.checked=ne[11]),le[0]&4096&&Zi(mr,ne[12]),ne[12]=="speeds"?te?le[0]&4096&&j(te,1):(te=z1(),te.c(),j(te,1),te.m(nr,null)):te&&(en(),Z(te,1,1,()=>{te=null}),tn());const Be={};le[0]&64&&(Be.neighbourhoodBoundary=yr(ne[6])),pn.$set(Be)},i(ne){Gt||(j(Ge.$$.fragment,ne),j(lt.$$.fragment,ne),j($t),j(te),j(pn.$$.fragment,ne),Gt=!0)},o(ne){Z(Ge.$$.fragment,ne),Z(lt.$$.fragment,ne),Z($t),Z(te),Z(pn.$$.fragment,ne),Gt=!1},d(ne){ne&&V(e),sn&&sn.d(),he(Ge),he(lt),~_t&&er[_t].d(),te&&te.d(),he(pn),Qn=!1,pr(mi)}}}function bI(r){let e,t,n=(r[46].name??"unnamed road")+"",i,o,c=Math.round(r[46].speed_mph)+"",a,d;return{c(){e=U("p"),t=xe("Main road: "),i=xe(n),o=xe(`
                (`),a=xe(c),d=xe(" mph)")},m(p,y){q(p,e,y),R(e,t),R(e,i),R(e,o),R(e,a),R(e,d)},p(p,y){y[1]&32768&&n!==(n=(p[46].name??"unnamed road")+"")&&Tt(i,n),y[1]&32768&&c!==(c=Math.round(p[46].speed_mph)+"")&&Tt(a,c)},d(p){p&&V(e)}}}function vI(r){let e,t=r[46].shortcuts+"",n,i,o=(r[46].name??"unnamed road")+"",c,a,d=Math.round(r[46].speed_mph)+"",p,y;return{c(){e=U("p"),n=xe(t),i=xe(" shortcuts through "),c=xe(o),a=xe(`
                (`),p=xe(d),y=xe(" mph)")},m(_,w){q(_,e,w),R(e,n),R(e,i),R(e,c),R(e,a),R(e,p),R(e,y)},p(_,w){w[1]&32768&&t!==(t=_[46].shortcuts+"")&&Tt(n,t),w[1]&32768&&o!==(o=(_[46].name??"unnamed road")+"")&&Tt(c,o),w[1]&32768&&d!==(d=Math.round(_[46].speed_mph)+"")&&Tt(p,d)},d(_){_&&V(e)}}}function wI(r){let e;return{c(){e=U("p"),e.textContent="Click to create a turn restriction from here"},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function xI(r){let e;return{c(){e=U("p"),e.textContent="Click to designate a main road or not"},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function kI(r){let e;return{c(){e=U("p"),e.textContent="Click to change direction"},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function SI(r){let e,t,n,i;return{c(){e=U("div"),t=U("img"),i=xe(`
                Click to add modal filter`),fr(t.src,n=`/ltn//filters/${r[9]}_icon.gif`)||de(t,"src",n),de(t,"width","20"),de(t,"alt","Add modal filter")},m(o,c){q(o,e,c),R(e,t),R(e,i)},p(o,c){c[0]&512&&!fr(t.src,n=`/ltn//filters/${o[9]}_icon.gif`)&&de(t,"src",n)},d(o){o&&V(e)}}}function CI(r){let e,t;function n(p,y){if(p[46].kind=="interior_road")return vI;if(p[46].kind=="main_road")return bI}let i=n(r),o=i&&i(r);function c(p,y){if(p[0].kind=="filter")return SI;if(p[0].kind=="oneway")return kI;if(p[0].kind=="main-roads")return xI;if(p[0].kind=="turn_restriction")return wI}let a=c(r),d=a&&a(r);return{c(){o&&o.c(),e=oe(),d&&d.c(),t=Xn()},m(p,y){o&&o.m(p,y),q(p,e,y),d&&d.m(p,y),q(p,t,y)},p(p,y){i===(i=n(p))&&o?o.p(p,y):(o&&o.d(1),o=i&&i(p),o&&(o.c(),o.m(e.parentNode,e))),a===(a=c(p))&&d?d.p(p,y):(d&&d.d(1),d=a&&a(p),d&&(d.c(),d.m(t.parentNode,t)))},d(p){p&&(V(e),V(t)),o&&o.d(p),d&&d.d(p)}}}function TI(r){let e,t,n;return t=new ui({props:{openOn:"hover",$$slots:{default:[CI,({props:i})=>({46:i}),({props:i})=>[0,i?32768:0]]},$$scope:{ctx:r}}}),{c(){e=U("div"),fe(t.$$.fragment),de(e,"slot","line-popup")},m(i,o){q(i,e,o),ue(t,e,null),n=!0},p(i,o){const c={};o[0]&513|o[1]&98304&&(c.$$scope={dirty:o,ctx:i}),t.$set(c)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),he(t)}}}function MI(r){let e,t,n,i,o,c,a,d,p,y;return e=new zd({}),n=new Pd({}),o=new Dd({}),a=new Ih({props:{interactive:r[0].kind=="filter"||r[0].kind=="oneway"||r[0].kind=="main-roads"||r[0].kind=="turn_restriction"&&r[0].from_road_id==null,onClickLine:r[16],$$slots:{"line-popup":[TI]},$$scope:{ctx:r}}}),p=new XE({props:{interactive:r[0].kind=="filter",neighbourhood:r[1],onClickIntersection:r[21]}}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment),i=oe(),fe(o.$$.fragment),c=oe(),fe(a.$$.fragment),d=oe(),fe(p.$$.fragment)},m(_,w){ue(e,_,w),q(_,t,w),ue(n,_,w),q(_,i,w),ue(o,_,w),q(_,c,w),ue(a,_,w),q(_,d,w),ue(p,_,w),y=!0},p(_,w){const T={};w[0]&1&&(T.interactive=_[0].kind=="filter"||_[0].kind=="oneway"||_[0].kind=="main-roads"||_[0].kind=="turn_restriction"&&_[0].from_road_id==null),w[0]&513|w[1]&65536&&(T.$$scope={dirty:w,ctx:_}),a.$set(T);const M={};w[0]&1&&(M.interactive=_[0].kind=="filter"),w[0]&2&&(M.neighbourhood=_[1]),p.$set(M)},i(_){y||(j(e.$$.fragment,_),j(n.$$.fragment,_),j(o.$$.fragment,_),j(a.$$.fragment,_),j(p.$$.fragment,_),y=!0)},o(_){Z(e.$$.fragment,_),Z(n.$$.fragment,_),Z(o.$$.fragment,_),Z(a.$$.fragment,_),Z(p.$$.fragment,_),y=!1},d(_){_&&(V(t),V(i),V(c),V(d)),he(e,_),he(n,_),he(o,_),he(a,_),he(p,_)}}}function D1(r){let e,t;return e=new FE({props:{paths:r[7]}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i[0]&128&&(o.paths=n[7]),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function LI(r){let e;return{c(){e=xe("Click to delete filter")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function EI(r){let e,t,n;return t=new ui({props:{openOn:"hover",$$slots:{default:[LI]},$$scope:{ctx:r}}}),{c(){e=U("div"),fe(t.$$.fragment),de(e,"slot","modal-filter")},m(i,o){q(i,e,o),ue(t,e,null),n=!0},p(i,o){const c={};o[1]&65536&&(c.$$scope={dirty:o,ctx:i}),t.$set(c)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),he(t)}}}function II(r){let e;return{c(){e=xe("Click to delete turn restriction")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function AI(r){let e,t,n;return t=new ui({props:{openOn:"hover",$$slots:{default:[II]},$$scope:{ctx:r}}}),{c(){e=U("div"),fe(t.$$.fragment),de(e,"slot","turn-restriction")},m(i,o){q(i,e,o),ue(t,e,null),n=!0},p(i,o){const c={};o[1]&65536&&(c.$$scope={dirty:o,ctx:i}),t.$set(c)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),he(t)}}}function $1(r){let e,t;return e=new iI({props:{map:yr(r[2])}}),e.$on("done",r[25]),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i[0]&4&&(o.map=yr(n[2])),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function R1(r){let e,t;return e=new dr({props:{data:r[0].possible_targets||Ki(),generateId:!0,$$slots:{default:[DI]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i[0]&1&&(o.data=n[0].possible_targets||Ki()),i[0]&1|i[1]&65536&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function PI(r){let e,t,n,i,o=r[0].from_road_name+"",c,a,d=(r[46].name||"unnamed road")+"",p;return{c(){e=U("div"),t=U("img"),i=xe(`

              Create a turn restriction from `),c=xe(o),a=xe(" to "),p=xe(d),fr(t.src,n=`/ltn//filters/no_${r[46].kind}_turn.png`)||de(t,"src",n),de(t,"width","20"),de(t,"alt","Add turn restriction")},m(y,_){q(y,e,_),R(e,t),R(e,i),R(e,c),R(e,a),R(e,p)},p(y,_){_[1]&32768&&!fr(t.src,n=`/ltn//filters/no_${y[46].kind}_turn.png`)&&de(t,"src",n),_[0]&1&&o!==(o=y[0].from_road_name+"")&&Tt(c,o),_[1]&32768&&d!==(d=(y[46].name||"unnamed road")+"")&&Tt(p,d)},d(y){y&&V(e)}}}function zI(r){let e,t;return e=new ui({props:{openOn:"hover",$$slots:{default:[PI,({props:n})=>({46:n}),({props:n})=>[0,n?32768:0]]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i[0]&1|i[1]&98304&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function DI(r){let e,t;const n=[mn("turn-restriction-targets"),{manageHoverState:!0},{paint:{"line-color":"yellow","line-opacity":Hn(.5,1),"line-width":qs(1)}}];let i={$$slots:{default:[zI]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new sr({props:i}),e.$on("click",r[18]),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,c){const a={};c[0]&1|c[1]&65536&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function $I(r){let e,t,n,i,o,c,a,d,p,y;t=new Xm({}),t.$on("click",r[17]),i=new Ah({props:{input:r[1],$$slots:{default:[MI]},$$scope:{ctx:r}}});let _=r[10]&&D1(r);a=new Oa({props:{onClickModalFilter:r[19],onClickTurnRestriction:r[20],$$slots:{"turn-restriction":[AI],"modal-filter":[EI]},$$scope:{ctx:r}}});let w=r[0].kind=="filter"&&r[0].freehand&&$1(r),T=r[0].kind=="turn_restriction"&&R1(r);return{c(){e=U("div"),fe(t.$$.fragment),n=oe(),fe(i.$$.fragment),o=oe(),_&&_.c(),c=oe(),fe(a.$$.fragment),d=oe(),w&&w.c(),p=oe(),T&&T.c(),de(e,"slot","map")},m(M,$){q(M,e,$),ue(t,e,null),R(e,n),ue(i,e,null),R(e,o),_&&_.m(e,null),R(e,c),ue(a,e,null),R(e,d),w&&w.m(e,null),R(e,p),T&&T.m(e,null),y=!0},p(M,$){const P={};$[0]&2&&(P.input=M[1]),$[0]&515|$[1]&65536&&(P.$$scope={dirty:$,ctx:M}),i.$set(P),M[10]?_?(_.p(M,$),$[0]&1024&&j(_,1)):(_=D1(M),_.c(),j(_,1),_.m(e,c)):_&&(en(),Z(_,1,1,()=>{_=null}),tn());const D={};$[1]&65536&&(D.$$scope={dirty:$,ctx:M}),a.$set(D),M[0].kind=="filter"&&M[0].freehand?w?(w.p(M,$),$[0]&1&&j(w,1)):(w=$1(M),w.c(),j(w,1),w.m(e,p)):w&&(en(),Z(w,1,1,()=>{w=null}),tn()),M[0].kind=="turn_restriction"?T?(T.p(M,$),$[0]&1&&j(T,1)):(T=R1(M),T.c(),j(T,1),T.m(e,null)):T&&(en(),Z(T,1,1,()=>{T=null}),tn())},i(M){y||(j(t.$$.fragment,M),j(i.$$.fragment,M),j(_),j(a.$$.fragment,M),j(w),j(T),y=!0)},o(M){Z(t.$$.fragment,M),Z(i.$$.fragment,M),Z(_),Z(a.$$.fragment,M),Z(w),Z(T),y=!1},d(M){M&&V(e),he(t),he(i),_&&_.d(),he(a),w&&w.d(),T&&T.d()}}}function RI(r){let e,t,n,i;return e=new bo({props:{$$slots:{map:[$I],sidebar:[yI],top:[dI]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0,n||(i=wt(window,"keydown",r[22]),n=!0)},p(o,c){const a={};c[0]&32767|c[1]&65536&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o),n=!1,i()}}}function FI(r,e,t){let n,i,o,c,a,d,p,y,_,w;at(r,so,ze=>t(26,i=ze)),at(r,am,ze=>t(9,o=ze)),at(r,Ar,ze=>t(44,c=ze)),at(r,Ro,ze=>t(2,a=ze)),at(r,W_,ze=>t(10,d=ze)),at(r,lm,ze=>t(11,p=ze)),at(r,dd,ze=>t(12,y=ze)),at(r,an,ze=>t(13,_=ze)),at(r,hd,ze=>t(14,w=ze));function T(){return{kind:"turn_restriction",from_road_id:null,from_road_name:"",possible_targets:Ki()}}let M={kind:"filter",freehand:!1},$=!1,P=0,D=0,I,F,N=c.getAllShortcuts();Yr(()=>{a.doubleClickZoom.enable()});function W(ze){t(1,F=c.renderNeighbourhood()),t(6,I=F.features.find(Ne=>Ne.properties.kind=="boundary")),t(4,P=F.undo_length),t(5,D=F.redo_length),t(7,N=c.getAllShortcuts()),mh()}function se(ze,Ne){M.kind=="filter"?(c.addModalFilter(Ne,o),Nt(so,i++,i)):M.kind=="oneway"?(c.toggleTravelFlow(ze.properties.road),Nt(so,i++,i)):M.kind=="main-roads"?(c.toggleMainRoad(ze.properties.road),Nt(so,i++,i)):M.kind=="turn_restriction"&&(t(0,M.from_road_id=ze.properties.road,M),t(0,M.from_road_name=ze.properties.name||"unnamed road",M),t(0,M.possible_targets=c.getTurnRestrictionTargets(ze.properties.road),M))}function J(ze){M.kind=="turn_restriction"&&(a.queryRenderedFeatures(ze.detail.point,{layers:["interior-roads","turn-restriction-targets"]}).length>0||t(0,M=T()))}function ee(ze){if(M.kind=="turn_restriction"&&M.from_road_id!=null){let Ne=ze.detail.features[0].properties.road;c.addTurnRestriction(M.from_road_id,Ne),Nt(so,i++,i)}t(0,M=T())}function me(ze){let Ne=ze.detail.features[0];c.deleteModalFilter(Ne.properties.road),Nt(so,i++,i)}function Ie(ze){let Ne=ze.detail.features[0];c.deleteTurnRestriction(Ne.properties.intersection,Ne.properties.from_road,Ne.properties.to_road),Nt(so,i++,i)}function Q(ze){if(M.kind!="filter"){console.assert(!1,`this shouldn't happen - intersections should only be clickable when in 'filter' mode, not ${M.kind}`);return}ze.hasRotatedFilter?(c.deleteDiagonalFilter(ze),Nt(so,i++,i)):ze.filter?(c.rotateDiagonalFilter(ze),Nt(so,i++,i)):(c.addDiagonalFilter(ze),Nt(so,i++,i))}function ae(ze){ze.target.tagName!="INPUT"&&(ze.ctrlKey&&ze.key=="z"&&Pe(),ze.ctrlKey&&ze.key=="y"&&ve(),ze.key=="1"&&t(0,M={kind:"filter",freehand:!1}),ze.key=="2"&&t(0,M={kind:"oneway"}),ze.key=="3"&&t(0,M=T()),ze.key=="4"&&t(0,M={kind:"main-roads"}))}function Pe(){c.undo(),Nt(so,i++,i)}function ve(){c.redo(),Nt(so,i++,i)}function tt(ze){let Ne=ze.detail;Ne&&(c.addManyModalFilters(Ne,o),Nt(so,i++,i)),t(0,M={kind:"filter",freehand:!1})}const Ge=()=>t(0,M={kind:"filter",freehand:!1}),Ee=()=>t(0,M={kind:"oneway"}),$e=()=>t(0,M=T()),St=()=>t(0,M={kind:"main-roads"});function rt(ze){$=ze,t(3,$)}const lt=()=>t(3,$=!0),mt=()=>t(0,M={kind:"filter",freehand:!1}),ft=()=>t(0,M={kind:"filter",freehand:!0});function Xe(){d=this.checked,W_.set(d)}function Dt(){p=this.checked,lm.set(p)}function _t(){y=Sa(this),dd.set(y)}const $t=()=>Nt(an,_={mode:"pick-neighbourhood"},_),Et=()=>Nt(an,_={mode:"view-shortcuts"},_),Yt=()=>Nt(an,_={mode:"route",prevMode:"neighbourhood"},_),_n=()=>Nt(an,_={mode:"impact-one-destination"},_),Zt=()=>Nt(an,_={mode:"set-boundary",name:yr(I).properties.name,existing:yr(I)},_),ln=()=>Nt(an,_={mode:"debug-neighbourhood"},_);return r.$$.update=()=>{r.$$.dirty[0]&5&&(M.kind=="oneway"||M.kind=="main-roads"?a.doubleClickZoom.disable():a.doubleClickZoom.enable()),r.$$.dirty[0]&67108864&&W(),r.$$.dirty[0]&2&&t(8,n=F.features.filter(ze=>ze.properties.kind=="cell"&&ze.properties.cell_color=="disconnected").length)},[M,F,a,$,P,D,I,N,n,o,d,p,y,_,w,T,se,J,ee,me,Ie,Q,ae,Pe,ve,tt,i,Ge,Ee,$e,St,rt,lt,mt,ft,Xe,Dt,_t,$t,Et,Yt,_n,Zt,ln]}class BI extends Lt{constructor(e){super(),Mt(this,e,FI,RI,vt,{},null,[-1,-1])}}function OI(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function NI(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function jI(r){let e,t,n,i,o,c,a,d,p,y,_;return o=new $n({props:{$$slots:{default:[OI]},$$scope:{ctx:r}}}),o.$on("click",Bo),d=new $n({props:{$$slots:{default:[NI]},$$scope:{ctx:r}}}),d.$on("click",r[11]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),fe(o.$$.fragment),c=oe(),a=U("li"),fe(d.$$.fragment),p=oe(),y=U("li"),y.textContent="Predict impact",de(t,"aria-label","breadcrumb"),de(e,"slot","top")},m(w,T){q(w,e,T),R(e,t),R(t,n),R(n,i),ue(o,i,null),R(n,c),R(n,a),ue(d,a,null),R(n,p),R(n,y),_=!0},p(w,T){const M={};T&16384&&(M.$$scope={dirty:T,ctx:w}),o.$set(M);const $={};T&16384&&($.$$scope={dirty:T,ctx:w}),d.$set($)},i(w){_||(j(o.$$.fragment,w),j(d.$$.fragment,w),_=!0)},o(w){Z(o.$$.fragment,w),Z(d.$$.fragment,w),_=!1},d(w){w&&V(e),he(o),he(d)}}}function F1(r){let e,t,n,i,o,c,a;function d(T){r[10](T)}let p={list:r[1]};r[2]!==void 0&&(p.idx=r[2]),e=new Cd({props:p}),hn.push(()=>In(e,"idx",d));let y=r[1][r[2]].count>1&&B1(r),_=r[1][r[2]].before==null&&O1(),w=r[1][r[2]].after==null&&N1();return{c(){fe(e.$$.fragment),n=oe(),y&&y.c(),i=oe(),_&&_.c(),o=oe(),w&&w.c(),c=Xn()},m(T,M){ue(e,T,M),q(T,n,M),y&&y.m(T,M),q(T,i,M),_&&_.m(T,M),q(T,o,M),w&&w.m(T,M),q(T,c,M),a=!0},p(T,M){const $={};M&2&&($.list=T[1]),!t&&M&4&&(t=!0,$.idx=T[2],En(()=>t=!1)),e.$set($),T[1][T[2]].count>1?y?y.p(T,M):(y=B1(T),y.c(),y.m(i.parentNode,i)):y&&(y.d(1),y=null),T[1][T[2]].before==null?_||(_=O1(),_.c(),_.m(o.parentNode,o)):_&&(_.d(1),_=null),T[1][T[2]].after==null?w||(w=N1(),w.c(),w.m(c.parentNode,c)):w&&(w.d(1),w=null)},i(T){a||(j(e.$$.fragment,T),a=!0)},o(T){Z(e.$$.fragment,T),a=!1},d(T){T&&(V(n),V(i),V(o),V(c)),he(e,T),y&&y.d(T),_&&_.d(T),w&&w.d(T)}}}function B1(r){let e,t,n=r[1][r[2]].count.toLocaleString()+"",i,o,c,a;return{c(){e=U("p"),t=xe(`The routes are currently sampled, to speed things up. This one sample
          route represents `),i=xe(n),o=xe(` trips between the
          same points.`),c=oe(),a=U("i"),a.textContent=`Note: if these don't sum to the total above, that's likely a known
          software bug`},m(d,p){q(d,e,p),R(e,t),R(e,i),R(e,o),q(d,c,p),q(d,a,p)},p(d,p){p&6&&n!==(n=d[1][d[2]].count.toLocaleString()+"")&&Tt(i,n)},d(d){d&&(V(e),V(c),V(a))}}}function O1(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route before changes (
          <i>This is usually a known software bug</i>`,st(e,"color","red")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function N1(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route after changes (
          <i>This is usually a known software bug</i>`,st(e,"color","blue")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function UI(r){let e,t,n,i,o=r[0].before.toLocaleString()+"",c,a,d,p,y=r[0].after.toLocaleString()+"",_,w,T,M,$=Math.round(100*r[0].after/r[0].before)+"",P,D,I,F;t=new na({}),t.$on("click",r[9]);let N=r[1].length>0&&F1(r);return{c(){e=U("div"),fe(t.$$.fragment),n=oe(),i=U("p"),c=xe(o),a=xe(` routes cross here
      `),d=U("span"),d.textContent="before your changes",p=xe(`
      , and `),_=xe(y),w=oe(),T=U("span"),T.textContent="after your changes",M=xe(`
      . That's
      `),P=xe($),D=xe("% of the original traffic."),I=oe(),N&&N.c(),st(d,"color","red"),st(T,"color","blue"),de(e,"slot","sidebar")},m(W,se){q(W,e,se),ue(t,e,null),R(e,n),R(e,i),R(i,c),R(i,a),R(i,d),R(i,p),R(i,_),R(i,w),R(i,T),R(i,M),R(i,P),R(i,D),R(e,I),N&&N.m(e,null),F=!0},p(W,se){(!F||se&1)&&o!==(o=W[0].before.toLocaleString()+"")&&Tt(c,o),(!F||se&1)&&y!==(y=W[0].after.toLocaleString()+"")&&Tt(_,y),(!F||se&1)&&$!==($=Math.round(100*W[0].after/W[0].before)+"")&&Tt(P,$),W[1].length>0?N?(N.p(W,se),se&2&&j(N,1)):(N=F1(W),N.c(),j(N,1),N.m(e,null)):N&&(en(),Z(N,1,1,()=>{N=null}),tn())},i(W){F||(j(t.$$.fragment,W),j(N),F=!0)},o(W){Z(t.$$.fragment,W),Z(N),F=!1},d(W){W&&V(e),he(t),N&&N.d()}}}function j1(r){let e,t,n,i,o,c;return e=new dr({props:{data:r[5](r[2]),$$slots:{default:[VI]},$$scope:{ctx:r}}}),n=new yl({props:{lngLat:r[6](r[2]),$$slots:{default:[qI]},$$scope:{ctx:r}}}),o=new yl({props:{lngLat:r[7](r[2]),$$slots:{default:[ZI]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment),i=oe(),fe(o.$$.fragment)},m(a,d){ue(e,a,d),q(a,t,d),ue(n,a,d),q(a,i,d),ue(o,a,d),c=!0},p(a,d){const p={};d&4&&(p.data=a[5](a[2])),d&16384&&(p.$$scope={dirty:d,ctx:a}),e.$set(p);const y={};d&4&&(y.lngLat=a[6](a[2])),d&16384&&(y.$$scope={dirty:d,ctx:a}),n.$set(y);const _={};d&4&&(_.lngLat=a[7](a[2])),d&16384&&(_.$$scope={dirty:d,ctx:a}),o.$set(_)},i(a){c||(j(e.$$.fragment,a),j(n.$$.fragment,a),j(o.$$.fragment,a),c=!0)},o(a){Z(e.$$.fragment,a),Z(n.$$.fragment,a),Z(o.$$.fragment,a),c=!1},d(a){a&&(V(t),V(i)),he(e,a),he(n,a),he(o,a)}}}function VI(r){let e,t;const n=[mn("predict-impact"),{paint:{"line-width":Do(["get","kind"],{focus:8},5),"line-color":Do(["get","kind"],{focus:"black",before:"red",after:"blue"},"cyan"),"line-opacity":Do(["get","kind"],{focus:1},.5)}}];let i={};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new sr({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function qI(r){let e;return{c(){e=xe("A")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function ZI(r){let e;return{c(){e=xe("B")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function GI(r){let e,t,n,i,o=r[1].length>0&&j1(r);return n=new Oa({}),{c(){e=U("div"),o&&o.c(),t=oe(),fe(n.$$.fragment),de(e,"slot","map")},m(c,a){q(c,e,a),o&&o.m(e,null),R(e,t),ue(n,e,null),i=!0},p(c,a){c[1].length>0?o?(o.p(c,a),a&2&&j(o,1)):(o=j1(c),o.c(),j(o,1),o.m(e,t)):o&&(en(),Z(o,1,1,()=>{o=null}),tn())},i(c){i||(j(o),j(n.$$.fragment,c),i=!0)},o(c){Z(o),Z(n.$$.fragment,c),i=!1},d(c){c&&V(e),o&&o.d(),he(n)}}}function HI(r){let e,t,n,i;return e=new Sh({props:{loading:r[3]}}),n=new bo({props:{$$slots:{map:[GI],sidebar:[UI],top:[jI]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment)},m(o,c){ue(e,o,c),q(o,t,c),ue(n,o,c),i=!0},p(o,[c]){const a={};c&8&&(a.loading=o[3]),e.$set(a);const d={};c&16407&&(d.$$scope={dirty:c,ctx:o}),n.$set(d)},i(o){i||(j(e.$$.fragment,o),j(n.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),Z(n.$$.fragment,o),i=!1},d(o){o&&V(t),he(e,o),he(n,o)}}}function WI(r,e,t){let n,i,o;at(r,an,D=>t(4,n=D)),at(r,um,D=>t(12,i=D)),at(r,Ar,D=>t(13,o=D));let{road:c}=e,a=c.properties;a.kind="focus";let d=[],p=0,y="Finding changes to this road";Ls(async()=>{await new Promise(D=>{requestAnimationFrame(()=>{requestAnimationFrame(D)})}),t(1,d=o.getImpactsOnRoad(a.id,i)),t(3,y=""),d.length==0&&(window.alert("No routes over this road change. (This is a bug in progress of being fixed.)"),Nt(an,n={mode:"predict-impact"},n))});function _(D){return{type:"FeatureCollection",features:[d[D].before,d[D].after,c].filter(I=>I!=null)}}function w(D){return d[D].before!=null?d[D].before.geometry.coordinates[0]:d[D].after.geometry.coordinates[0]}function T(D){let I=d[D].before!=null?d[D].before.geometry.coordinates:d[D].after.geometry.coordinates;return I[I.length-1]}const M=()=>Nt(an,n={mode:"predict-impact"},n);function $(D){p=D,t(2,p)}const P=()=>Nt(an,n={mode:"pick-neighbourhood"},n);return r.$$set=D=>{"road"in D&&t(8,c=D.road)},[a,d,p,y,n,_,w,T,c,M,$,P]}class KI extends Lt{constructor(e){super(),Mt(this,e,WI,HI,vt,{road:8})}}function XI(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function JI(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function YI(r){let e;return{c(){e=xe("Editing")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function QI(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M;return o=new $n({props:{$$slots:{default:[XI]},$$scope:{ctx:r}}}),o.$on("click",Bo),d=new $n({props:{$$slots:{default:[JI]},$$scope:{ctx:r}}}),d.$on("click",r[14]),_=new $n({props:{$$slots:{default:[YI]},$$scope:{ctx:r}}}),_.$on("click",r[7]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),fe(o.$$.fragment),c=oe(),a=U("li"),fe(d.$$.fragment),p=oe(),y=U("li"),fe(_.$$.fragment),w=oe(),T=U("li"),T.textContent="Impact routing to one destination",de(t,"aria-label","breadcrumb"),de(e,"slot","top")},m($,P){q($,e,P),R(e,t),R(t,n),R(n,i),ue(o,i,null),R(n,c),R(n,a),ue(d,a,null),R(n,p),R(n,y),ue(_,y,null),R(n,w),R(n,T),M=!0},p($,P){const D={};P&524288&&(D.$$scope={dirty:P,ctx:$}),o.$set(D);const I={};P&524288&&(I.$$scope={dirty:P,ctx:$}),d.$set(I);const F={};P&524288&&(F.$$scope={dirty:P,ctx:$}),_.$set(F)},i($){M||(j(o.$$.fragment,$),j(d.$$.fragment,$),j(_.$$.fragment,$),M=!0)},o($){Z(o.$$.fragment,$),Z(d.$$.fragment,$),Z(_.$$.fragment,$),M=!1},d($){$&&V(e),he(o),he(d),he(_)}}}function eA(r){let e;return{c(){e=U("p"),e.textContent="Hover on a road to compare"},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function tA(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function nA(r){let e,t=Ea(r[4].properties.distance)+"",n,i,o=Ia(r[4].properties.time)+"",c;return{c(){e=U("p"),n=xe(t),i=xe(", "),c=xe(o)},m(a,d){q(a,e,d),R(e,n),R(e,i),R(e,c)},p(a,d){d&16&&t!==(t=Ea(a[4].properties.distance)+"")&&Tt(n,t),d&16&&o!==(o=Ia(a[4].properties.time)+"")&&Tt(c,o)},d(a){a&&V(e)}}}function rA(r){let e;return{c(){e=U("p"),e.textContent="Hover on a road to compare"},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function iA(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function oA(r){let e,t=Ea(r[3].properties.distance)+"",n,i,o=Ia(r[3].properties.time)+"",c;return{c(){e=U("p"),n=xe(t),i=xe(", "),c=xe(o)},m(a,d){q(a,e,d),R(e,n),R(e,i),R(e,c)},p(a,d){d&8&&t!==(t=Ea(a[3].properties.distance)+"")&&Tt(n,t),d&8&&o!==(o=Ia(a[3].properties.time)+"")&&Tt(c,o)},d(a){a&&V(e)}}}function sA(r){let e,t,n,i,o,c,a,d,p,y,_;t=new na({}),t.$on("click",r[7]);function w(I,F){return I[4]?nA:I[3]?tA:eA}let T=w(r),M=T(r);function $(I,F){return I[3]?oA:I[4]?iA:rA}let P=$(r),D=P(r);return{c(){e=U("div"),fe(t.$$.fragment),n=oe(),i=U("p"),i.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin around to change that destination.`,o=oe(),c=U("u"),c.textContent="Route before changes",a=oe(),M.c(),d=oe(),p=U("u"),p.textContent="Route after changes",y=oe(),D.c(),st(c,"color","red"),st(p,"color","blue"),de(e,"slot","sidebar")},m(I,F){q(I,e,F),ue(t,e,null),R(e,n),R(e,i),R(e,o),R(e,c),R(e,a),M.m(e,null),R(e,d),R(e,p),R(e,y),D.m(e,null),_=!0},p(I,F){T===(T=w(I))&&M?M.p(I,F):(M.d(1),M=T(I),M&&(M.c(),M.m(e,d))),P===(P=$(I))&&D?D.p(I,F):(D.d(1),D=P(I),D&&(D.c(),D.m(e,null)))},i(I){_||(j(t.$$.fragment,I),_=!0)},o(I){Z(t.$$.fragment,I),_=!1},d(I){I&&V(e),he(t),M.d(),D.d()}}}function aA(r){let e,t;const n=[mn("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let i={};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new Hi({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function lA(r){let e,t,n=(r[18].time_after/r[18].time_before).toFixed(1)+"",i;return{c(){e=U("p"),t=xe("Time ratio: "),i=xe(n)},m(o,c){q(o,e,c),R(e,t),R(e,i)},p(o,c){c&262144&&n!==(n=(o[18].time_after/o[18].time_before).toFixed(1)+"")&&Tt(i,n)},d(o){o&&V(e)}}}function cA(r){let e,t;return e=new ui({props:{openOn:"hover",$$slots:{default:[lA,({props:n})=>({18:n}),({props:n})=>n?262144:0]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&786432&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function uA(r){let e,t,n;const i=[mn("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(r[5].highest_time_ratio,1.1),"red"],"line-width":5}},{manageHoverState:!0}];function o(a){r[11](a)}let c={$$slots:{default:[cA]},$$scope:{ctx:r}};for(let a=0;a<i.length;a+=1)c=Bt(c,i[a]);return r[0]!==void 0&&(c.hovered=r[0]),e=new sr({props:c}),hn.push(()=>In(e,"hovered",o)),e.$on("click",r[12]),{c(){fe(e.$$.fragment)},m(a,d){ue(e,a,d),n=!0},p(a,d){const p=d&32?Fn(i,[i[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(a[5].highest_time_ratio,1.1),"red"],"line-width":5}},i[2]]):{};d&524288&&(p.$$scope={dirty:d,ctx:a}),!t&&d&1&&(t=!0,p.hovered=a[0],En(()=>t=!1)),e.$set(p)},i(a){n||(j(e.$$.fragment,a),n=!0)},o(a){Z(e.$$.fragment,a),n=!1},d(a){he(e,a)}}}function hA(r){let e,t;const n=[mn("compare-route"),{interactive:!1},{paint:{"line-width":10,"line-color":Do(["get","kind"],{before:"red",after:"blue"},"red")}}];let i={};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new sr({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function fA(r){let e;return{c(){e=xe("X")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function dA(r){let e,t,n,i,o,c,a,d,p,y,_,w;t=new Ah({props:{$$slots:{default:[aA]},$$scope:{ctx:r}}}),i=new dr({props:{data:r[5],generateId:!0,$$slots:{default:[uA]},$$scope:{ctx:r}}}),c=new dr({props:{data:r[1],$$slots:{default:[hA]},$$scope:{ctx:r}}}),d=new Oa({});function T($){r[13]($)}let M={draggable:!0,$$slots:{default:[fA]},$$scope:{ctx:r}};return r[2]!==void 0&&(M.lngLat=r[2]),y=new yl({props:M}),hn.push(()=>In(y,"lngLat",T)),{c(){e=U("div"),fe(t.$$.fragment),n=oe(),fe(i.$$.fragment),o=oe(),fe(c.$$.fragment),a=oe(),fe(d.$$.fragment),p=oe(),fe(y.$$.fragment),de(e,"slot","map")},m($,P){q($,e,P),ue(t,e,null),R(e,n),ue(i,e,null),R(e,o),ue(c,e,null),R(e,a),ue(d,e,null),R(e,p),ue(y,e,null),w=!0},p($,P){const D={};P&524288&&(D.$$scope={dirty:P,ctx:$}),t.$set(D);const I={};P&32&&(I.data=$[5]),P&524321&&(I.$$scope={dirty:P,ctx:$}),i.$set(I);const F={};P&2&&(F.data=$[1]),P&524288&&(F.$$scope={dirty:P,ctx:$}),c.$set(F);const N={};P&524288&&(N.$$scope={dirty:P,ctx:$}),!_&&P&4&&(_=!0,N.lngLat=$[2],En(()=>_=!1)),y.$set(N)},i($){w||(j(t.$$.fragment,$),j(i.$$.fragment,$),j(c.$$.fragment,$),j(d.$$.fragment,$),j(y.$$.fragment,$),w=!0)},o($){Z(t.$$.fragment,$),Z(i.$$.fragment,$),Z(c.$$.fragment,$),Z(d.$$.fragment,$),Z(y.$$.fragment,$),w=!1},d($){$&&V(e),he(t),he(i),he(c),he(d),he(y)}}}function pA(r){let e,t,n,i;return e=new Xm({}),e.$on("contextmenu",r[9]),n=new bo({props:{$$slots:{map:[dA],sidebar:[sA],top:[QI]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment)},m(o,c){ue(e,o,c),q(o,t,c),ue(n,o,c),i=!0},p(o,[c]){const a={};c&524415&&(a.$$scope={dirty:c,ctx:o}),n.$set(a)},i(o){i||(j(e.$$.fragment,o),j(n.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),Z(n.$$.fragment,o),i=!1},d(o){o&&V(t),he(e,o),he(n,o)}}}function mA(r,e,t){let n,i,o,c,a,d,p,y,_;at(r,jf,W=>t(2,a=W)),at(r,an,W=>t(6,d=W)),at(r,ah,W=>t(15,p=W)),at(r,sh,W=>t(16,y=W)),at(r,Ar,W=>t(10,_=W));function w(){Nt(an,d={mode:"neighbourhood"},d)}let T=null;Ls(()=>{setTimeout(()=>{a&&fm(jf)},10)});function M(W){return W?_.compareRoute(new Ks.LngLat(W.properties.pt1_x,W.properties.pt1_y),a,1):Ki()}function $(W){Nt(sh,y=new Ks.LngLat(W.properties.pt1_x,W.properties.pt1_y),y),Nt(ah,p=a,p),Nt(an,d={mode:"route",prevMode:"impact-one-destination"},d)}function P(W){Nt(jf,a=W.detail.lngLat,a)}function D(W){T=W,t(0,T)}const I=W=>$(W.detail.features[0]);function F(W){a=W,jf.set(a)}const N=()=>Nt(an,d={mode:"pick-neighbourhood"},d);return r.$$.update=()=>{r.$$.dirty&1028&&t(5,n=_.impactToOneDestination(a)),r.$$.dirty&1&&t(1,i=M(T)),r.$$.dirty&2&&t(4,o=i.features.find(W=>W.properties.kind=="before")),r.$$.dirty&2&&t(3,c=i.features.find(W=>W.properties.kind=="after"))},[T,i,a,c,o,n,d,w,$,P,_,D,I,F,N]}class gA extends Lt{constructor(e){super(),Mt(this,e,mA,pA,vt,{})}}function U1(r,e,t){const n=r.slice();return n[31]=e[t].properties.name,n}function _A(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function yA(r){let e;return{c(){e=U("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function bA(r){let e;return{c(){e=xe("Route")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function vA(r){let e;return{c(){e=xe("Predict impact")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function V1(r){let e,t,n;return t=new $n({props:{$$slots:{default:[wA]},$$scope:{ctx:r}}}),t.$on("click",r[29]),{c(){e=U("li"),fe(t.$$.fragment)},m(i,o){q(i,e,o),ue(t,e,null),n=!0},p(i,o){const c={};o[1]&8&&(c.$$scope={dirty:o,ctx:i}),t.$set(c)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),he(t)}}}function wA(r){let e;return{c(){e=xe("Debug intersections")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function xA(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M,$,P,D,I,F;o=new $n({props:{$$slots:{default:[_A]},$$scope:{ctx:r}}}),o.$on("click",Bo),p=new Qm({props:{$$slots:{default:[yA]},$$scope:{ctx:r}}}),M=new $n({props:{$$slots:{default:[bA]},$$scope:{ctx:r}}}),M.$on("click",r[27]),D=new $n({props:{$$slots:{default:[vA]},$$scope:{ctx:r}}}),D.$on("click",r[28]);let N=r[9]&&V1(r);return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),fe(o.$$.fragment),c=oe(),a=U("li"),d=xe(`Pick neighbourhood
          `),fe(p.$$.fragment),y=oe(),_=U("nav"),w=U("ul"),T=U("li"),fe(M.$$.fragment),$=oe(),P=U("li"),fe(D.$$.fragment),I=oe(),N&&N.c(),de(t,"aria-label","breadcrumb"),de(e,"slot","top"),st(e,"display","flex"),st(e,"justify-content","space-between")},m(W,se){q(W,e,se),R(e,t),R(t,n),R(n,i),ue(o,i,null),R(n,c),R(n,a),R(a,d),ue(p,a,null),R(e,y),R(e,_),R(_,w),R(w,T),ue(M,T,null),R(w,$),R(w,P),ue(D,P,null),R(w,I),N&&N.m(w,null),F=!0},p(W,se){const J={};se[1]&8&&(J.$$scope={dirty:se,ctx:W}),o.$set(J);const ee={};se[1]&8&&(ee.$$scope={dirty:se,ctx:W}),p.$set(ee);const me={};se[1]&8&&(me.$$scope={dirty:se,ctx:W}),M.$set(me);const Ie={};se[1]&8&&(Ie.$$scope={dirty:se,ctx:W}),D.$set(Ie),W[9]?N?(N.p(W,se),se[0]&512&&j(N,1)):(N=V1(W),N.c(),j(N,1),N.m(w,null)):N&&(en(),Z(N,1,1,()=>{N=null}),tn())},i(W){F||(j(o.$$.fragment,W),j(p.$$.fragment,W),j(M.$$.fragment,W),j(D.$$.fragment,W),j(N),F=!0)},o(W){Z(o.$$.fragment,W),Z(p.$$.fragment,W),Z(M.$$.fragment,W),Z(D.$$.fragment,W),Z(N),F=!1},d(W){W&&V(e),he(o),he(p),he(M),he(D),N&&N.d()}}}function kA(r){let e=r[31]+"",t;return{c(){t=xe(e)},m(n,i){q(n,t,i)},p(n,i){i[0]&1&&e!==(e=n[31]+"")&&Tt(t,e)},d(n){n&&V(t)}}}function q1(r){let e,t,n,i,o,c,a,d,p,y,_,w,T;function M(){return r[20](r[31])}n=new $n({props:{$$slots:{default:[kA]},$$scope:{ctx:r}}}),n.$on("click",M),a=new Gb({props:{color:"black"}});function $(){return r[21](r[31])}y=new Hm({props:{color:"white"}});function P(){return r[22](r[31])}function D(){return r[23](r[31])}return{c(){var I;e=U("li"),t=U("h3"),fe(n.$$.fragment),i=oe(),o=U("span"),c=U("button"),fe(a.$$.fragment),d=oe(),p=U("button"),fe(y.$$.fragment),de(c,"class","outline icon-btn"),de(c,"title","Rename neighbourhood"),de(p,"class","icon-btn destructive"),de(p,"title","Delete neighbourhood"),de(o,"class","actions"),de(e,"class","actionable-cell svelte-qhjp0j"),Qt(e,"highlighted",((I=r[3])==null?void 0:I.properties.name)==r[31]||r[2]==r[31])},m(I,F){q(I,e,F),R(e,t),ue(n,t,null),R(e,i),R(e,o),R(o,c),ue(a,c,null),R(o,d),R(o,p),ue(y,p,null),_=!0,w||(T=[wt(c,"click",$),wt(p,"click",P),wt(e,"mouseenter",D),wt(e,"mouseleave",r[24])],w=!0)},p(I,F){var W;r=I;const N={};F[0]&1|F[1]&8&&(N.$$scope={dirty:F,ctx:r}),n.$set(N),(!_||F[0]&13)&&Qt(e,"highlighted",((W=r[3])==null?void 0:W.properties.name)==r[31]||r[2]==r[31])},i(I){_||(j(n.$$.fragment,I),j(a.$$.fragment,I),j(y.$$.fragment,I),_=!0)},o(I){Z(n.$$.fragment,I),Z(a.$$.fragment,I),Z(y.$$.fragment,I),_=!1},d(I){I&&V(e),he(n),he(a),he(y),w=!1,pr(T)}}}function SA(r){let e,t,n;return e=new Ak({}),{c(){fe(e.$$.fragment),t=xe(`
          Add a new neighbourhood`)},m(i,o){ue(e,i,o),q(i,t,o),n=!0},i(i){n||(j(e.$$.fragment,i),n=!0)},o(i){Z(e.$$.fragment,i),n=!1},d(i){i&&V(t),he(e,i)}}}function Z1(r){let e,t,n,i,o,c,a,d,p;function y(w){r[26](w)}let _={};return r[1]!==void 0&&(_.selectedPrioritization=r[1]),o=new qv({props:_}),hn.push(()=>In(o,"selectedPrioritization",y)),{c(){e=U("h3"),e.textContent="Prioritization",t=oe(),n=U("p"),n.textContent="Compare metrics across your neighbourhoods.",i=oe(),fe(o.$$.fragment),a=oe(),d=U("hr")},m(w,T){q(w,e,T),q(w,t,T),q(w,n,T),q(w,i,T),ue(o,w,T),q(w,a,T),q(w,d,T),p=!0},p(w,T){const M={};!c&&T[0]&2&&(c=!0,M.selectedPrioritization=w[1],En(()=>c=!1)),o.$set(M)},i(w){p||(j(o.$$.fragment,w),p=!0)},o(w){Z(o.$$.fragment,w),p=!1},d(w){w&&(V(e),V(t),V(n),V(i),V(a),V(d)),he(o,w)}}}function G1(r){let e,t,n;return{c(){e=U("button"),e.textContent="Debug route-snapper",de(e,"class","secondary")},m(i,o){q(i,e,o),t||(n=wt(e,"click",r[13]),t=!0)},p:et,d(i){i&&V(e),t=!1,n()}}}function CA(r){let e,t,n,i=r[6].projectName(yr(r[7]))+"",o,c,a,d,p,y,_,w,T,M,$,P,D,I,F,N,W,se=r[4].modalFilters+"",J,ee,me,Ie,Q=r[4].deletedModalFilters+"",ae,Pe,ve,tt,Ge=r[4].travelFlows+"",Ee,$e,St,rt,lt,mt;p=new Zb({});let ft=Rn(r[0].features),Xe=[];for(let Et=0;Et<ft.length;Et+=1)Xe[Et]=q1(U1(r,ft,Et));const Dt=Et=>Z(Xe[Et],1,1,()=>{Xe[Et]=null});I=new $n({props:{$$slots:{default:[SA]},$$scope:{ctx:r}}}),I.$on("click",r[25]);let _t=r[8]=="cnt"&&Z1(r),$t=r[9]&&G1(r);return{c(){e=U("div"),t=U("div"),n=U("h1"),o=xe(i),c=oe(),a=U("button"),d=U("div"),fe(p.$$.fragment),y=oe(),_=U("span"),_.textContent="Export",w=oe(),T=U("h2"),T.textContent="Neighbourhoods",M=oe(),$=U("ul");for(let Et=0;Et<Xe.length;Et+=1)Xe[Et].c();P=oe(),D=U("li"),fe(I.$$.fragment),F=oe(),_t&&_t.c(),N=oe(),W=U("p"),J=xe(se),ee=xe(" new modal filter(s) added"),me=oe(),Ie=U("p"),ae=xe(Q),Pe=xe(`
      existing modal filter(s) removed`),ve=oe(),tt=U("p"),Ee=xe(Ge),$e=xe(" road segment direction(s) changed"),St=oe(),$t&&$t.c(),st(_,"margin-right","2px"),st(d,"display","flex"),st(d,"align-items","center"),st(d,"gap","8px"),st(d,"color","black"),de(a,"class","outline icon-btn"),st(a,"margin-right","8px"),de(a,"title","Download project as GeoJSON"),st(t,"display","flex"),st(t,"justify-content","space-between"),st(t,"align-items","center"),st(t,"gap","16px"),de($,"class","navigable-list"),de(e,"slot","sidebar")},m(Et,Yt){q(Et,e,Yt),R(e,t),R(t,n),R(n,o),R(t,c),R(t,a),R(a,d),ue(p,d,null),R(d,y),R(d,_),R(e,w),R(e,T),R(e,M),R(e,$);for(let _n=0;_n<Xe.length;_n+=1)Xe[_n]&&Xe[_n].m($,null);R($,P),R($,D),ue(I,D,null),R(e,F),_t&&_t.m(e,null),R(e,N),R(e,W),R(W,J),R(W,ee),R(e,me),R(e,Ie),R(Ie,ae),R(Ie,Pe),R(e,ve),R(e,tt),R(tt,Ee),R(tt,$e),R(e,St),$t&&$t.m(e,null),rt=!0,lt||(mt=wt(a,"click",r[19]),lt=!0)},p(Et,Yt){if((!rt||Yt[0]&192)&&i!==(i=Et[6].projectName(yr(Et[7]))+"")&&Tt(o,i),Yt[0]&7181){ft=Rn(Et[0].features);let Zt;for(Zt=0;Zt<ft.length;Zt+=1){const ln=U1(Et,ft,Zt);Xe[Zt]?(Xe[Zt].p(ln,Yt),j(Xe[Zt],1)):(Xe[Zt]=q1(ln),Xe[Zt].c(),j(Xe[Zt],1),Xe[Zt].m($,P))}for(en(),Zt=ft.length;Zt<Xe.length;Zt+=1)Dt(Zt);tn()}const _n={};Yt[1]&8&&(_n.$$scope={dirty:Yt,ctx:Et}),I.$set(_n),Et[8]=="cnt"?_t?(_t.p(Et,Yt),Yt[0]&256&&j(_t,1)):(_t=Z1(Et),_t.c(),j(_t,1),_t.m(e,N)):_t&&(en(),Z(_t,1,1,()=>{_t=null}),tn()),(!rt||Yt[0]&16)&&se!==(se=Et[4].modalFilters+"")&&Tt(J,se),(!rt||Yt[0]&16)&&Q!==(Q=Et[4].deletedModalFilters+"")&&Tt(ae,Q),(!rt||Yt[0]&16)&&Ge!==(Ge=Et[4].travelFlows+"")&&Tt(Ee,Ge),Et[9]?$t?$t.p(Et,Yt):($t=G1(Et),$t.c(),$t.m(e,null)):$t&&($t.d(1),$t=null)},i(Et){if(!rt){j(p.$$.fragment,Et);for(let Yt=0;Yt<ft.length;Yt+=1)j(Xe[Yt]);j(I.$$.fragment,Et),j(_t),rt=!0}},o(Et){Z(p.$$.fragment,Et),Xe=Xe.filter(Boolean);for(let Yt=0;Yt<Xe.length;Yt+=1)Z(Xe[Yt]);Z(I.$$.fragment,Et),Z(_t),rt=!1},d(Et){Et&&V(e),he(p),di(Xe,Et),he(I),_t&&_t.d(),$t&&$t.d(),lt=!1,mt()}}}function TA(r){let e,t,n=(r[30].number_pois/r[30].area_km2).toFixed(1)+"",i,o;return{c(){e=U("b"),e.textContent="Points of interest:",t=oe(),i=xe(n),o=xe(" / km")},m(c,a){q(c,e,a),q(c,t,a),q(c,i,a),q(c,o,a)},p(c,a){a[0]&1073741824&&n!==(n=(c[30].number_pois/c[30].area_km2).toFixed(1)+"")&&Tt(i,n)},d(c){c&&(V(e),V(t),V(i),V(o))}}}function MA(r){let e,t,n=(r[30].number_stats19_collisions/r[30].area_km2).toFixed(1)+"",i,o;return{c(){e=U("b"),e.textContent="Pedestrian and cyclist collisions:",t=oe(),i=xe(n),o=xe(" / km")},m(c,a){q(c,e,a),q(c,t,a),q(c,i,a),q(c,o,a)},p(c,a){a[0]&1073741824&&n!==(n=(c[30].number_stats19_collisions/c[30].area_km2).toFixed(1)+"")&&Tt(i,n)},d(c){c&&(V(e),V(t),V(i),V(o))}}}function LA(r){let e,t,n=Math.round(r[30].population/r[30].area_km2).toLocaleString()+"",i,o;return{c(){e=U("b"),e.textContent="Population density:",t=oe(),i=xe(n),o=xe(` people
            / km`)},m(c,a){q(c,e,a),q(c,t,a),q(c,i,a),q(c,o,a)},p(c,a){a[0]&1073741824&&n!==(n=Math.round(c[30].population/c[30].area_km2).toLocaleString()+"")&&Tt(i,n)},d(c){c&&(V(e),V(t),V(i),V(o))}}}function EA(r){let e,t=r[30].name+"",n,i,o;function c(p,y){if(p[1]=="density")return LA;if(p[1]=="stats19")return MA;if(p[1]=="pois")return TA}let a=c(r),d=a&&a(r);return{c(){e=U("h2"),n=xe(t),i=oe(),d&&d.c(),o=Xn()},m(p,y){q(p,e,y),R(e,n),q(p,i,y),d&&d.m(p,y),q(p,o,y)},p(p,y){y[0]&1073741824&&t!==(t=p[30].name+"")&&Tt(n,t),a===(a=c(p))&&d?d.p(p,y):(d&&d.d(1),d=a&&a(p),d&&(d.c(),d.m(o.parentNode,o)))},d(p){p&&(V(e),V(i),V(o)),d&&d.d(p)}}}function IA(r){let e,t;return e=new ui({props:{openOn:"hover",$$slots:{default:[EA,({props:n})=>({30:n}),({props:n})=>[n?1073741824:0]]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i[0]&1073741826|i[1]&8&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function AA(r){let e,t,n,i,o,c,a,d,p;e=new F3({props:{data:r[2]?[{name:r[2],highlight:"yes"}]:[],idCol:"name"}});const y=[{filter:["==",["get","kind"],"boundary"]},mn("neighbourhood-boundaries-selected-outline",!1),{manageHoverState:!1},{paint:{"line-color":"black","line-width":4,"line-dasharray":[2,2]}}];let _={};for(let D=0;D<y.length;D+=1)_=Bt(_,y[D]);n=new sr({props:_});const w=[{filter:["==",["get","kind"],"boundary"]},mn("neighbourhood-boundaries-selected-outline-base",!1),{manageHoverState:!1},{paint:{"line-color":"white","line-width":8,"line-opacity":.7}}];let T={};for(let D=0;D<w.length;D+=1)T=Bt(T,w[D]);o=new sr({props:T});const M=[mn("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":r[14](r[1]),"fill-opacity":r[15](r[1])}},{manageHoverState:!0},{hoverCursor:"pointer"}];function $(D){r[17](D)}let P={$$slots:{default:[IA]},$$scope:{ctx:r}};for(let D=0;D<M.length;D+=1)P=Bt(P,M[D]);return r[3]!==void 0&&(P.hovered=r[3]),a=new Hi({props:P}),hn.push(()=>In(a,"hovered",$)),a.$on("click",r[18]),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment),i=oe(),fe(o.$$.fragment),c=oe(),fe(a.$$.fragment)},m(D,I){ue(e,D,I),q(D,t,I),ue(n,D,I),q(D,i,I),ue(o,D,I),q(D,c,I),ue(a,D,I),p=!0},p(D,I){const F={};I[0]&4&&(F.data=D[2]?[{name:D[2],highlight:"yes"}]:[]),e.$set(F);const N={};n.$set(N);const W={};o.$set(W);const se=I[0]&49154?Fn(M,[M[0],M[1],{paint:{"fill-color":D[14](D[1]),"fill-opacity":D[15](D[1])}},M[3],M[4]]):{};I[0]&2|I[1]&8&&(se.$$scope={dirty:I,ctx:D}),!d&&I[0]&8&&(d=!0,se.hovered=D[3],En(()=>d=!1)),a.$set(se)},i(D){p||(j(e.$$.fragment,D),j(n.$$.fragment,D),j(o.$$.fragment,D),j(a.$$.fragment,D),p=!0)},o(D){Z(e.$$.fragment,D),Z(n.$$.fragment,D),Z(o.$$.fragment,D),Z(a.$$.fragment,D),p=!1},d(D){D&&(V(t),V(i),V(c)),he(e,D),he(n,D),he(o,D),he(a,D)}}}function PA(r){let e,t,n,i,o;return t=new dr({props:{data:r[0],promoteId:"name",$$slots:{default:[AA]},$$scope:{ctx:r}}}),i=new Oa({}),{c(){e=U("div"),fe(t.$$.fragment),n=oe(),fe(i.$$.fragment),de(e,"slot","map")},m(c,a){q(c,e,a),ue(t,e,null),R(e,n),ue(i,e,null),o=!0},p(c,a){const d={};a[0]&1&&(d.data=c[0]),a[0]&14|a[1]&8&&(d.$$scope={dirty:a,ctx:c}),t.$set(d)},i(c){o||(j(t.$$.fragment,c),j(i.$$.fragment,c),o=!0)},o(c){Z(t.$$.fragment,c),Z(i.$$.fragment,c),o=!1},d(c){c&&V(e),he(t),he(i)}}}function zA(r){let e,t;return e=new bo({props:{$$slots:{map:[PA],sidebar:[CA],top:[xA]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i[0]&1023|i[1]&8&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function DA(r){let e=0,t=0,n=0;for(let i of r.features)i.properties.kind=="modal_filter"?e++:i.properties.kind=="deleted_existing_modal_filter"?t++:i.properties.kind=="travel_flow"&&n++;return{modalFilters:e,deletedModalFilters:t,travelFlows:n}}function $A(r,e,t){let n,i,o,c,a,d,p,y;at(r,Ar,Ee=>t(16,o=Ee)),at(r,an,Ee=>t(5,c=Ee)),at(r,Qs,Ee=>t(6,a=Ee)),at(r,_l,Ee=>t(7,d=Ee)),at(r,Fo,Ee=>t(8,p=Ee)),at(r,hd,Ee=>t(9,y=Ee));let _="none",w=null,T=null;function M(Ee){o.setCurrentNeighbourhood(Ee),Nt(an,c={mode:"neighbourhood"},c)}function $(Ee){window.confirm(`Really delete neighbourhood ${Ee}? You can't undo this.`)&&(o.deleteNeighbourhoodBoundary(Ee),mh(),t(0,n=o.getAllNeighbourhoods()))}function P(Ee){let $e=Vv(o,`Rename neighbourhood ${Ee} to what?`,Ee);$e&&(o.renameNeighbourhoodBoundary(Ee,$e),mh(),t(0,n=o.getAllNeighbourhoods()))}function D(){wd("debug_route_snapper.geojson",o.toRouteSnapperGj())}function I(Ee){let $e=yo.mapFeature.hover.backgroundColor,St=Zv({none:$e},Ee);return["case",["==",["feature-state","highlight"],"yes"],$e,St]}function F(Ee){let $e=.7;return{none:["case",["==",["feature-state","highlight"],"yes"],$e,Hn(.3,$e)],area:Hn(.7,.9),density:Hn(.7,.9),simd:Hn(.7,.9),stats19:Hn(.7,.9),pois:Hn(.7,.9),car_ownership:Hn(.7,.9)}[Ee]}function N(Ee){T=Ee,t(3,T)}const W=Ee=>M(yr(Ee.detail.features[0].properties).name),se=()=>vv(yr(d)),J=Ee=>M(Ee),ee=Ee=>P(Ee),me=Ee=>$(Ee),Ie=Ee=>t(2,w=Ee),Q=()=>t(2,w=null),ae=()=>Nt(an,c={mode:"add-neighbourhood"},c);function Pe(Ee){_=Ee,t(1,_)}const ve=()=>Nt(an,c={mode:"route",prevMode:"pick-neighbourhood"},c),tt=()=>Nt(an,c={mode:"predict-impact"},c),Ge=()=>Nt(an,c={mode:"debug-intersections"},c);return r.$$.update=()=>{r.$$.dirty[0]&65536&&t(0,n=o.getAllNeighbourhoods()),r.$$.dirty[0]&1&&t(4,i=DA(n))},[n,_,w,T,i,c,a,d,p,y,M,$,P,D,I,F,o,N,W,se,J,ee,me,Ie,Q,ae,Pe,ve,tt,Ge]}class RA extends Lt{constructor(e){super(),Mt(this,e,$A,zA,vt,{},null,[-1,-1])}}function FA(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function BA(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function OA(r){let e,t,n,i,o,c,a,d,p,y,_;return o=new $n({props:{$$slots:{default:[FA]},$$scope:{ctx:r}}}),o.$on("click",Bo),d=new $n({props:{$$slots:{default:[BA]},$$scope:{ctx:r}}}),d.$on("click",r[17]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),fe(o.$$.fragment),c=oe(),a=U("li"),fe(d.$$.fragment),p=oe(),y=U("li"),y.textContent="Predict impact",de(t,"aria-label","breadcrumb"),de(e,"slot","top")},m(w,T){q(w,e,T),R(e,t),R(t,n),R(n,i),ue(o,i,null),R(n,c),R(n,a),ue(d,a,null),R(n,p),R(n,y),_=!0},p(w,T){const M={};T&2097152&&(M.$$scope={dirty:T,ctx:w}),o.$set(M);const $={};T&2097152&&($.$$scope={dirty:T,ctx:w}),d.$set($)},i(w){_||(j(o.$$.fragment,w),j(d.$$.fragment,w),_=!0)},o(w){Z(o.$$.fragment,w),Z(d.$$.fragment,w),_=!1},d(w){w&&V(e),he(o),he(d)}}}function NA(r){let e;return{c(){e=xe("Explore the origin/destination demand data used")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function jA(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M,$,P,D,I,F,N,W,se,J,ee,me,Ie,Q;return t=new na({}),t.$on("click",r[11]),c=new $n({props:{$$slots:{default:[NA]},$$scope:{ctx:r}}}),c.$on("click",r[12]),J=new Oo({props:{colorScale:r[5],labels:{limits:["0%","50%","same","150%","200%"]}}}),me=Fm(r[14][0]),{c(){e=U("div"),fe(t.$$.fragment),n=oe(),i=U("p"),o=xe(`This mode estimates the impact of all your changes on traffic around the
      entire area. It's based on many assumptions and must be interpreted very
      carefully. `),fe(c.$$.fragment),a=oe(),d=U("fieldset"),p=U("label"),y=U("input"),_=xe(`
        Calculate quickly`),w=oe(),T=U("label"),M=U("input"),$=xe(`
        Calculate more accurately`),P=oe(),D=U("p"),D.textContent=`Red roads have increased traffic, and green roads have decreased. Thicker
      roads have more traffic after edits. If hovering on a road doesn't show
      anything, there was no change there. Click a road to see example routes
      through it that've changed.`,I=oe(),F=U("label"),N=xe(`Only show roads with at least this many daily trips before or after
      `),W=U("input"),se=oe(),fe(J.$$.fragment),de(y,"type","radio"),y.__value="fast",qn(y,y.__value),de(M,"type","radio"),M.__value="accurate",qn(M,M.__value),de(W,"type","number"),de(W,"min",0),de(e,"slot","sidebar"),me.p(y,M)},m(ae,Pe){q(ae,e,Pe),ue(t,e,null),R(e,n),R(e,i),R(i,o),ue(c,i,null),R(e,a),R(e,d),R(d,p),R(p,y),y.checked=y.__value===r[2],R(p,_),R(d,w),R(d,T),R(T,M),M.checked=M.__value===r[2],R(T,$),R(e,P),R(e,D),R(e,I),R(e,F),R(F,N),R(F,W),qn(W,r[4]),R(e,se),ue(J,e,null),ee=!0,Ie||(Q=[wt(y,"change",r[13]),wt(y,"change",r[8]),wt(M,"change",r[15]),wt(M,"change",r[8]),wt(W,"input",r[16])],Ie=!0)},p(ae,Pe){const ve={};Pe&2097152&&(ve.$$scope={dirty:Pe,ctx:ae}),c.$set(ve),Pe&4&&(y.checked=y.__value===ae[2]),Pe&4&&(M.checked=M.__value===ae[2]),Pe&16&&ml(W.value)!==ae[4]&&qn(W,ae[4])},i(ae){ee||(j(t.$$.fragment,ae),j(c.$$.fragment,ae),j(J.$$.fragment,ae),ee=!0)},o(ae){Z(t.$$.fragment,ae),Z(c.$$.fragment,ae),Z(J.$$.fragment,ae),ee=!1},d(ae){ae&&V(e),he(t),he(c),he(J),me.r(),Ie=!1,pr(Q)}}}function UA(r){let e,t;const n=[mn("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"grey","fill-opacity":.5}}];let i={};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new Hi({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function VA(r){let e,t=r[20].before.toLocaleString()+"",n,i,o=r[20].after.toLocaleString()+"",c,a,d,p,y=Math.round(100*r[20].after/r[20].before)+"",_,w;return{c(){e=U("p"),n=xe(t),i=xe(" before, "),c=xe(o),a=xe(`
            after`),d=oe(),p=U("p"),_=xe(y),w=xe("%")},m(T,M){q(T,e,M),R(e,n),R(e,i),R(e,c),R(e,a),q(T,d,M),q(T,p,M),R(p,_),R(p,w)},p(T,M){M&1048576&&t!==(t=T[20].before.toLocaleString()+"")&&Tt(n,t),M&1048576&&o!==(o=T[20].after.toLocaleString()+"")&&Tt(c,o),M&1048576&&y!==(y=Math.round(100*T[20].after/T[20].before)+"")&&Tt(_,y)},d(T){T&&(V(e),V(d),V(p))}}}function qA(r){let e,t;return e=new ui({props:{openOn:"hover",$$slots:{default:[VA,({props:n})=>({20:n}),({props:n})=>n?1048576:0]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&3145728&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function ZA(r){let e,t,n,i;const o=[mn("predict-impact-outline"),{filter:[">=",["max",["get","before"],["get","after"]],r[4]]},{paint:{"line-width":["interpolate",["linear"],["get","after"],0,1.5*Gf,r[1].max_count,1.5*Hf],"line-color":"black"}}];let c={};for(let p=0;p<o.length;p+=1)c=Bt(c,o[p]);e=new sr({props:c});const a=[mn("predict-impact"),{filter:[">=",["max",["get","before"],["get","after"]],r[4]]},{paint:{"line-width":["interpolate",["linear"],["get","after"],0,Gf,r[1].max_count,Hf],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,r[5][0],50,r[5][1],100,r[5][2],150,r[5][3],200,r[5][4]]]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let d={$$slots:{default:[qA]},$$scope:{ctx:r}};for(let p=0;p<a.length;p+=1)d=Bt(d,a[p]);return n=new sr({props:d}),n.$on("click",r[10]),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment)},m(p,y){ue(e,p,y),q(p,t,y),ue(n,p,y),i=!0},p(p,y){const _=y&18?Fn(o,[o[0],y&16&&{filter:[">=",["max",["get","before"],["get","after"]],p[4]]},y&2&&{paint:{"line-width":["interpolate",["linear"],["get","after"],0,1.5*Gf,p[1].max_count,1.5*Hf],"line-color":"black"}}]):{};e.$set(_);const w=y&50?Fn(a,[a[0],y&16&&{filter:[">=",["max",["get","before"],["get","after"]],p[4]]},y&34&&{paint:{"line-width":["interpolate",["linear"],["get","after"],0,Gf,p[1].max_count,Hf],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,p[5][0],50,p[5][1],100,p[5][2],150,p[5][3],200,p[5][4]]]}},a[3],a[4]]):{};y&2097152&&(w.$$scope={dirty:y,ctx:p}),n.$set(w)},i(p){i||(j(e.$$.fragment,p),j(n.$$.fragment,p),i=!0)},o(p){Z(e.$$.fragment,p),Z(n.$$.fragment,p),i=!1},d(p){p&&V(t),he(e,p),he(n,p)}}}function GA(r){let e,t,n,i,o,c,a;return t=new dr({props:{data:r[6],$$slots:{default:[UA]},$$scope:{ctx:r}}}),i=new dr({props:{data:r[1],generateId:!0,$$slots:{default:[ZA]},$$scope:{ctx:r}}}),c=new Oa({}),{c(){e=U("div"),fe(t.$$.fragment),n=oe(),fe(i.$$.fragment),o=oe(),fe(c.$$.fragment),de(e,"slot","map")},m(d,p){q(d,e,p),ue(t,e,null),R(e,n),ue(i,e,null),R(e,o),ue(c,e,null),a=!0},p(d,p){const y={};p&2097152&&(y.$$scope={dirty:p,ctx:d}),t.$set(y);const _={};p&2&&(_.data=d[1]),p&2097170&&(_.$$scope={dirty:p,ctx:d}),i.$set(_)},i(d){a||(j(t.$$.fragment,d),j(i.$$.fragment,d),j(c.$$.fragment,d),a=!0)},o(d){Z(t.$$.fragment,d),Z(i.$$.fragment,d),Z(c.$$.fragment,d),a=!1},d(d){d&&V(e),he(t),he(i),he(c)}}}function HA(r){let e,t,n,i;return e=new Sh({props:{loading:r[0]}}),n=new bo({props:{$$slots:{map:[GA],sidebar:[jA],top:[OA]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment)},m(o,c){ue(e,o,c),q(o,t,c),ue(n,o,c),i=!0},p(o,[c]){const a={};c&1&&(a.loading=o[0]),e.$set(a);const d={};c&2097182&&(d.$$scope={dirty:c,ctx:o}),n.$set(d)},i(o){i||(j(e.$$.fragment,o),j(n.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),Z(n.$$.fragment,o),i=!1},d(o){o&&V(t),he(e,o),he(n,o)}}}let Gf=3,Hf=10;function WA(r,e,t){let n,i,o,c;at(r,um,J=>t(9,n=J)),at(r,Ar,J=>t(18,i=J)),at(r,an,J=>t(3,o=J)),at(r,K_,J=>t(4,c=J));let a=["#1a9641","#a6d96a","white","#fdae61","#d7191c"],d="",p={type:"FeatureCollection",features:[],max_count:1},y=i.getAllNeighbourhoods();function _(J){Nt(an,o={mode:"impact-detail",road:J},o)}async function w(J){t(0,d="Calculating impact"),await new Promise(ee=>{requestAnimationFrame(()=>{requestAnimationFrame(ee)})}),t(1,p=i.predictImpact(J)),t(0,d="")}let T=n?"fast":"accurate";function M(){Nt(um,n=T=="fast",n)}const $=[[]],P=J=>_(J.detail.features[0]),D=()=>Nt(an,o={mode:"pick-neighbourhood"},o),I=()=>Nt(an,o={mode:"debug-demand"},o);function F(){T=this.__value,t(2,T)}function N(){T=this.__value,t(2,T)}function W(){c=ml(this.value),K_.set(c)}const se=()=>Nt(an,o={mode:"pick-neighbourhood"},o);return r.$$.update=()=>{r.$$.dirty&512&&w(n)},[d,p,T,o,c,a,y,_,M,n,P,D,I,F,$,N,W,se]}class KA extends Lt{constructor(e){super(),Mt(this,e,WA,HA,vt,{})}}function XA(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function JA(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function H1(r){let e,t,n;return t=new $n({props:{$$slots:{default:[YA]},$$scope:{ctx:r}}}),t.$on("click",r[14]),{c(){e=U("li"),fe(t.$$.fragment)},m(i,o){q(i,e,o),ue(t,e,null),n=!0},p(i,o){const c={};o&32768&&(c.$$scope={dirty:o,ctx:i}),t.$set(c)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),he(t)}}}function YA(r){let e;return{c(){e=xe("Editing")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function QA(r){let e,t,n,i,o,c,a,d,p,y,_,w;o=new $n({props:{$$slots:{default:[XA]},$$scope:{ctx:r}}}),o.$on("click",Bo),d=new $n({props:{$$slots:{default:[JA]},$$scope:{ctx:r}}}),d.$on("click",r[13]);let T=r[0]=="neighbourhood"&&H1(r);return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),fe(o.$$.fragment),c=oe(),a=U("li"),fe(d.$$.fragment),p=oe(),T&&T.c(),y=oe(),_=U("li"),_.textContent="Routing",de(t,"aria-label","breadcrumb"),de(e,"slot","top")},m(M,$){q(M,e,$),R(e,t),R(t,n),R(n,i),ue(o,i,null),R(n,c),R(n,a),ue(d,a,null),R(n,p),T&&T.m(n,null),R(n,y),R(n,_),w=!0},p(M,$){const P={};$&32768&&(P.$$scope={dirty:$,ctx:M}),o.$set(P);const D={};$&32768&&(D.$$scope={dirty:$,ctx:M}),d.$set(D),M[0]=="neighbourhood"?T?(T.p(M,$),$&1&&j(T,1)):(T=H1(M),T.c(),j(T,1),T.m(n,y)):T&&(en(),Z(T,1,1,()=>{T=null}),tn())},i(M){w||(j(o.$$.fragment,M),j(d.$$.fragment,M),j(T),w=!0)},o(M){Z(o.$$.fragment,M),Z(d.$$.fragment,M),Z(T),w=!1},d(M){M&&V(e),he(o),he(d),T&&T.d()}}}function e8(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function t8(r){let e,t=Ea(r[6].properties.distance)+"",n,i,o=Ia(r[6].properties.time)+"",c;return{c(){e=U("p"),n=xe(t),i=xe(", "),c=xe(o)},m(a,d){q(a,e,d),R(e,n),R(e,i),R(e,c)},p(a,d){d&64&&t!==(t=Ea(a[6].properties.distance)+"")&&Tt(n,t),d&64&&o!==(o=Ia(a[6].properties.time)+"")&&Tt(c,o)},d(a){a&&V(e)}}}function n8(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function r8(r){let e,t=Ea(r[5].properties.distance)+"",n,i,o=Ia(r[5].properties.time)+"",c;return{c(){e=U("p"),n=xe(t),i=xe(", "),c=xe(o)},m(a,d){q(a,e,d),R(e,n),R(e,i),R(e,c)},p(a,d){d&32&&t!==(t=Ea(a[5].properties.distance)+"")&&Tt(n,t),d&32&&o!==(o=Ia(a[5].properties.time)+"")&&Tt(c,o)},d(a){a&&V(e)}}}function i8(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M,$,P,D,I,F,N,W;t=new na({}),t.$on("click",r[8]);function se(ae,Pe){return ae[6]?t8:e8}let J=se(r),ee=J(r);function me(ae,Pe){return ae[5]?r8:n8}let Ie=me(r),Q=Ie(r);return{c(){e=U("div"),fe(t.$$.fragment),n=oe(),i=U("p"),i.textContent="Drag markers for a route",o=oe(),c=U("u"),c.textContent="Route before changes",a=oe(),ee.c(),d=oe(),p=U("u"),p.textContent="Route after changes",y=oe(),Q.c(),_=oe(),w=U("label"),T=xe("Slow-down factor for main roads: "),M=xe(r[2]),$=oe(),P=U("input"),D=oe(),I=U("i"),I.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,st(c,"color","red"),st(p,"color","blue"),de(P,"type","range"),de(P,"min","1.0"),de(P,"max","5.0"),de(P,"step","0.1"),de(e,"slot","sidebar")},m(ae,Pe){q(ae,e,Pe),ue(t,e,null),R(e,n),R(e,i),R(e,o),R(e,c),R(e,a),ee.m(e,null),R(e,d),R(e,p),R(e,y),Q.m(e,null),R(e,_),R(e,w),R(w,T),R(w,M),R(w,$),R(w,P),qn(P,r[2]),R(e,D),R(e,I),F=!0,N||(W=[wt(P,"change",r[12]),wt(P,"input",r[12])],N=!0)},p(ae,Pe){J===(J=se(ae))&&ee?ee.p(ae,Pe):(ee.d(1),ee=J(ae),ee&&(ee.c(),ee.m(e,d))),Ie===(Ie=me(ae))&&Q?Q.p(ae,Pe):(Q.d(1),Q=Ie(ae),Q&&(Q.c(),Q.m(e,_))),(!F||Pe&4)&&Tt(M,ae[2]),Pe&4&&qn(P,ae[2])},i(ae){F||(j(t.$$.fragment,ae),F=!0)},o(ae){Z(t.$$.fragment,ae),F=!1},d(ae){ae&&V(e),he(t),ee.d(),Q.d(),N=!1,pr(W)}}}function W1(r){let e,t;return e=new Ah({props:{$$slots:{default:[o8]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function o8(r){let e,t,n,i,o,c,a,d;return e=new zd({}),n=new Pd({}),o=new Dd({}),a=new Ih({props:{interactive:!1}}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment),i=oe(),fe(o.$$.fragment),c=oe(),fe(a.$$.fragment)},m(p,y){ue(e,p,y),q(p,t,y),ue(n,p,y),q(p,i,y),ue(o,p,y),q(p,c,y),ue(a,p,y),d=!0},p:et,i(p){d||(j(e.$$.fragment,p),j(n.$$.fragment,p),j(o.$$.fragment,p),j(a.$$.fragment,p),d=!0)},o(p){Z(e.$$.fragment,p),Z(n.$$.fragment,p),Z(o.$$.fragment,p),Z(a.$$.fragment,p),d=!1},d(p){p&&(V(t),V(i),V(c)),he(e,p),he(n,p),he(o,p),he(a,p)}}}function s8(r){let e,t;const n=[mn("compare-route"),{paint:{"line-width":10,"line-color":Do(["get","kind"],{before:"red",after:"blue"},"red")}}];let i={};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new sr({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function a8(r){let e;return{c(){e=xe("A")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function l8(r){let e;return{c(){e=xe("B")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function c8(r){let e,t,n,i,o,c,a,d,p,y,_,w,T=r[0]=="neighbourhood"&&W1(r);n=new Oa({}),o=new dr({props:{data:r[1],$$slots:{default:[s8]},$$scope:{ctx:r}}});function M(I){r[10](I)}let $={draggable:!0,$$slots:{default:[a8]},$$scope:{ctx:r}};r[4]!==void 0&&($.lngLat=r[4]),a=new yl({props:$}),hn.push(()=>In(a,"lngLat",M));function P(I){r[11](I)}let D={draggable:!0,$$slots:{default:[l8]},$$scope:{ctx:r}};return r[3]!==void 0&&(D.lngLat=r[3]),y=new yl({props:D}),hn.push(()=>In(y,"lngLat",P)),{c(){e=U("div"),T&&T.c(),t=oe(),fe(n.$$.fragment),i=oe(),fe(o.$$.fragment),c=oe(),fe(a.$$.fragment),p=oe(),fe(y.$$.fragment),de(e,"slot","map")},m(I,F){q(I,e,F),T&&T.m(e,null),R(e,t),ue(n,e,null),R(e,i),ue(o,e,null),R(e,c),ue(a,e,null),R(e,p),ue(y,e,null),w=!0},p(I,F){I[0]=="neighbourhood"?T?F&1&&j(T,1):(T=W1(I),T.c(),j(T,1),T.m(e,t)):T&&(en(),Z(T,1,1,()=>{T=null}),tn());const N={};F&2&&(N.data=I[1]),F&32768&&(N.$$scope={dirty:F,ctx:I}),o.$set(N);const W={};F&32768&&(W.$$scope={dirty:F,ctx:I}),!d&&F&16&&(d=!0,W.lngLat=I[4],En(()=>d=!1)),a.$set(W);const se={};F&32768&&(se.$$scope={dirty:F,ctx:I}),!_&&F&8&&(_=!0,se.lngLat=I[3],En(()=>_=!1)),y.$set(se)},i(I){w||(j(T),j(n.$$.fragment,I),j(o.$$.fragment,I),j(a.$$.fragment,I),j(y.$$.fragment,I),w=!0)},o(I){Z(T),Z(n.$$.fragment,I),Z(o.$$.fragment,I),Z(a.$$.fragment,I),Z(y.$$.fragment,I),w=!1},d(I){I&&V(e),T&&T.d(),he(n),he(o),he(a),he(y)}}}function u8(r){let e,t;return e=new bo({props:{$$slots:{map:[c8],sidebar:[i8],top:[QA]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,[i]){const o={};i&33023&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function h8(r,e,t){let n,i,o,c,a,d,p,y;at(r,an,I=>t(7,c=I)),at(r,H_,I=>t(2,a=I)),at(r,ah,I=>t(3,d=I)),at(r,sh,I=>t(4,p=I)),at(r,Ar,I=>t(9,y=I));let{prevMode:_}=e;Ls(()=>{setTimeout(()=>{fm(sh),fm(ah)},10)});function w(){Nt(an,c={mode:_},c)}function T(I){p=I,sh.set(p)}function M(I){d=I,ah.set(d)}function $(){a=ml(this.value),H_.set(a)}const P=()=>Nt(an,c={mode:"pick-neighbourhood"},c),D=()=>Nt(an,c={mode:"neighbourhood"},c);return r.$$set=I=>{"prevMode"in I&&t(0,_=I.prevMode)},r.$$.update=()=>{r.$$.dirty&540&&t(1,n=y.compareRoute(p,d,a)),r.$$.dirty&2&&t(6,i=n.features.find(I=>I.properties.kind=="before")),r.$$.dirty&2&&t(5,o=n.features.find(I=>I.properties.kind=="after"))},[_,n,a,d,p,o,i,c,w,y,T,M,$,P,D]}class f8 extends Lt{constructor(e){super(),Mt(this,e,h8,u8,vt,{prevMode:0})}}function d8(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function p8(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function m8(r){let e;return{c(){e=xe("Editing")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function g8(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M;return o=new $n({props:{$$slots:{default:[d8]},$$scope:{ctx:r}}}),o.$on("click",Bo),d=new $n({props:{$$slots:{default:[p8]},$$scope:{ctx:r}}}),d.$on("click",r[10]),_=new $n({props:{$$slots:{default:[m8]},$$scope:{ctx:r}}}),_.$on("click",r[11]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),fe(o.$$.fragment),c=oe(),a=U("li"),fe(d.$$.fragment),p=oe(),y=U("li"),fe(_.$$.fragment),w=oe(),T=U("li"),T.textContent="Changing neighbourhood boundary",de(t,"aria-label","breadcrumb"),de(e,"slot","top")},m($,P){q($,e,P),R(e,t),R(t,n),R(n,i),ue(o,i,null),R(n,c),R(n,a),ue(d,a,null),R(n,p),R(n,y),ue(_,y,null),R(n,w),R(n,T),M=!0},p($,P){const D={};P&8192&&(D.$$scope={dirty:P,ctx:$}),o.$set(D);const I={};P&8192&&(I.$$scope={dirty:P,ctx:$}),d.$set(I);const F={};P&8192&&(F.$$scope={dirty:P,ctx:$}),_.$set(F)},i($){M||(j(o.$$.fragment,$),j(d.$$.fragment,$),j(_.$$.fragment,$),M=!0)},o($){Z(o.$$.fragment,$),Z(d.$$.fragment,$),Z(_.$$.fragment,$),M=!1},d($){$&&V(e),he(o),he(d),he(_)}}}function _8(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M,$,P;function D(N){r[8](N)}function I(N){r[9](N)}let F={map:yr(r[3])};return r[0]!==void 0&&(F.waypoints=r[0]),r[1]!==void 0&&(F.drawnShapeOut=r[1]),i=new jv({props:F}),hn.push(()=>In(i,"waypoints",D)),hn.push(()=>In(i,"drawnShapeOut",I)),{c(){e=U("div"),t=U("h1"),t.textContent="Edit boundary",n=oe(),fe(i.$$.fragment),a=oe(),d=U("div"),p=U("button"),y=xe("Finish"),w=oe(),T=U("button"),T.textContent="Cancel",p.disabled=_=r[0].length<3,de(T,"class","secondary"),st(d,"display","flex"),st(d,"gap","16px"),de(e,"slot","sidebar")},m(N,W){q(N,e,W),R(e,t),R(e,n),ue(i,e,null),R(e,a),R(e,d),R(d,p),R(p,y),R(d,w),R(d,T),M=!0,$||(P=[wt(p,"click",r[4]),wt(T,"click",r[5])],$=!0)},p(N,W){const se={};W&8&&(se.map=yr(N[3])),!o&&W&1&&(o=!0,se.waypoints=N[0],En(()=>o=!1)),!c&&W&2&&(c=!0,se.drawnShapeOut=N[1],En(()=>c=!1)),i.$set(se),(!M||W&1&&_!==(_=N[0].length<3))&&(p.disabled=_)},i(N){M||(j(i.$$.fragment,N),M=!0)},o(N){Z(i.$$.fragment,N),M=!1},d(N){N&&V(e),he(i),$=!1,pr(P)}}}function y8(r){let e,t;return e=new bo({props:{$$slots:{sidebar:[_8],top:[g8]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,[i]){const o={};i&8207&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function b8(r,e,t){let n,i,o;at(r,an,P=>t(2,n=P)),at(r,Ar,P=>t(12,i=P)),at(r,Ro,P=>t(3,o=P));let{name:c}=e,{existing:a}=e,d=[],p;a.properties.waypoints?d=a.properties.waypoints.map(P=>({point:[P.lon,P.lat],snapped:P.snapped})):d=a.geometry.coordinates[1].slice(1).map(P=>({point:P,snapped:!1}));function y(){if(p)try{i.setNeighbourhoodBoundary(c,p),mh(),i.setCurrentNeighbourhood(c),Nt(an,n={mode:"neighbourhood"},n)}catch(P){window.alert(`Sorry, this boundary is invalid: ${P}`),_()}}function _(){Nt(an,n={mode:"neighbourhood"},n)}function w(P){d=P,t(0,d)}function T(P){p=P,t(1,p)}const M=()=>Nt(an,n={mode:"pick-neighbourhood"},n),$=()=>Nt(an,n={mode:"neighbourhood"},n);return r.$$set=P=>{"name"in P&&t(6,c=P.name),"existing"in P&&t(7,a=P.existing)},[d,p,n,o,y,_,c,a,w,T,M,$]}class v8 extends Lt{constructor(e){super(),Mt(this,e,b8,y8,vt,{name:6,existing:7})}}const w8="/ltn/assets/settings-342fb430.svg";function x8(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M,$,P,D;return n=new Q4({}),{c(){e=U("h1"),e.textContent="Settings",t=oe(),fe(n.$$.fragment),i=oe(),o=U("label"),c=U("input"),a=xe(`
    Road thickness depends on shortcuts`),d=oe(),p=U("label"),y=U("input"),_=xe(`
    Developer mode`),w=oe(),T=U("center"),M=U("button"),M.textContent="Confirm",de(c,"type","checkbox"),de(y,"type","checkbox")},m(I,F){q(I,e,F),q(I,t,F),ue(n,I,F),q(I,i,F),q(I,o,F),R(o,c),c.checked=r[1],R(o,a),q(I,d,F),q(I,p,F),R(p,y),y.checked=r[2],R(p,_),q(I,w,F),q(I,T,F),R(T,M),$=!0,P||(D=[wt(c,"change",r[4]),wt(y,"change",r[5]),wt(M,"click",r[6])],P=!0)},p(I,F){F&2&&(c.checked=I[1]),F&4&&(y.checked=I[2])},i(I){$||(j(n.$$.fragment,I),$=!0)},o(I){Z(n.$$.fragment,I),$=!1},d(I){I&&(V(e),V(t),V(i),V(o),V(d),V(p),V(w),V(T)),he(n,I),P=!1,pr(D)}}}function k8(r){let e,t,n,i,o,c,a;function d(y){r[7](y)}let p={$$slots:{default:[x8]},$$scope:{ctx:r}};return r[0]!==void 0&&(p.show=r[0]),n=new vd({props:p}),hn.push(()=>In(n,"show",d)),{c(){e=U("button"),e.innerHTML=`<img src="${w8}" alt="Settings"/>`,t=oe(),fe(n.$$.fragment),de(e,"class","outline")},m(y,_){q(y,e,_),q(y,t,_),ue(n,y,_),o=!0,c||(a=wt(e,"click",r[3]),c=!0)},p(y,[_]){const w={};_&263&&(w.$$scope={dirty:_,ctx:y}),!i&&_&1&&(i=!0,w.show=y[0],En(()=>i=!1)),n.$set(w)},i(y){o||(j(n.$$.fragment,y),o=!0)},o(y){Z(n.$$.fragment,y),o=!1},d(y){y&&(V(e),V(t)),he(n,y),c=!1,a()}}}function S8(r,e,t){let n,i;at(r,cm,_=>t(1,n=_)),at(r,hd,_=>t(2,i=_));let o=!1;const c=()=>t(0,o=!0);function a(){n=this.checked,cm.set(n)}function d(){i=this.checked,hd.set(i)}const p=()=>t(0,o=!1);function y(_){o=_,t(0,o)}return[o,n,i,c,a,d,p,y]}class C8 extends Lt{constructor(e){super(),Mt(this,e,S8,k8,vt,{})}}const T8=["==",["geometry-type"],"Polygon"],M8=["==",["geometry-type"],"LineString"],L8=["==",["geometry-type"],"Point"];function Wv(){return{type:"FeatureCollection",features:[]}}function em(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:Kv(r)}}}function Kv(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const Xv=An(Wv()),Jv=An(0),E8=100;class I8{constructor(e){tr(this,"map");tr(this,"active");tr(this,"eventListenersSuccess");tr(this,"eventListenersUpdated");tr(this,"eventListenersFailure");tr(this,"points");tr(this,"cursor");tr(this,"hover");tr(this,"dragFrom");tr(this,"previousStates");tr(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});tr(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(K1(this.points).forEach((n,i)=>{t.push([i+1,ck(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});tr(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=em(e.lngLat.toArray()),this.onClick(e),this.finish())});tr(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});tr(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});tr(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});tr(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=Wv();this.points.forEach((i,o)=>{let c=em(i);c.properties.hover=this.hover==o,c.properties.idx=o,e.features.push(c)}),e.features=e.features.concat(K1(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),Xv.set(e);let n="crosshair";this.hover!=null&&(n=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=n,Jv.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=em(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(Kv),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>E8&&this.previousStates.shift()}}function K1(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}function A8(r){let e,t,n;return{c(){e=xe("Undo ("),t=xe(r[1]),n=xe(")")},m(i,o){q(i,e,o),q(i,t,o),q(i,n,o)},p(i,o){o&2&&Tt(t,i[1])},d(i){i&&(V(e),V(t),V(n))}}}function P8(r){let e;return{c(){e=xe("Undo")},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function z8(r){let e,t,n,i,o,c,a,d,p,y,_;function w($,P){return $[1]==0?P8:A8}let T=w(r),M=T(r);return{c(){e=U("div"),t=U("button"),t.textContent="Finish",n=oe(),i=U("button"),i.textContent="Cancel",o=oe(),c=U("button"),M.c(),d=oe(),p=U("ul"),p.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,c.disabled=a=r[1]==0,st(e,"display","flex"),st(e,"justify-content","space-between")},m($,P){q($,e,P),R(e,t),R(e,n),R(e,i),R(e,o),R(e,c),M.m(c,null),q($,d,P),q($,p,P),y||(_=[wt(t,"click",r[2]),wt(i,"click",r[3]),wt(c,"click",r[4])],y=!0)},p($,[P]){T===(T=w($))&&M?M.p($,P):(M.d(1),M=T($),M&&(M.c(),M.m(c,null))),P&2&&a!==(a=$[1]==0)&&(c.disabled=a)},i:et,o:et,d($){$&&(V(e),V(d),V(p)),M.d(),y=!1,pr(_)}}}function D8(r,e,t){let n;at(r,Jv,d=>t(1,n=d));let{polygonTool:i}=e;const o=()=>i.finish(),c=()=>i.cancel(),a=()=>i.undo();return r.$$set=d=>{"polygonTool"in d&&t(0,i=d.polygonTool)},[i,n,o,c,a]}class $8 extends Lt{constructor(e){super(),Mt(this,e,D8,z8,vt,{polygonTool:0})}}let R8=Date.now();function Ph(r){return`${r}-${R8++}`}const Yv=Symbol.for("svelte-maplibre");function F8(){return kh(Yv)}function X1(r){return{subscribe:r.subscribe}}function Qv({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let i=F8(),o=An(null),c=X1(o),a={...i,[r]:X1(o)};if(e&&(a.popupTarget=c),n){let d=An(null);a.layerEvent=d,i.layerEvent=d}return t&&(a.cluster=An()),bd(Yv,a),{...i,self:o}}function B8(){return Qv({key:"source",setCluster:!0})}function O8(r=!0){return Qv({key:"layer",setPopupTarget:r,setMouseEvent:r})}function J1(r){let e;return t=>{if(t)for(let n in t){let i=e==null?void 0:e[n],o=t[n];i!==o&&r(n,o,i)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function N8(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function j8(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Y1(r){let e=r[0],t,n,i=Q1(r);return{c(){i.c(),t=Xn()},m(o,c){i.m(o,c),q(o,t,c),n=!0},p(o,c){c[0]&1&&vt(e,e=o[0])?(en(),Z(i,1,1,et),tn(),i=Q1(o),i.c(),j(i,1),i.m(t.parentNode,t)):i.p(o,c)},i(o){n||(j(i),n=!0)},o(o){Z(i),n=!1},d(o){o&&V(t),i.d(o)}}}function Q1(r){let e;const t=r[36].default,n=Sn(t,r,r[35],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[1]&16)&&Tn(n,t,i,i[35],e?Cn(t,i[35],o,null):Mn(i[35]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function U8(r){let e,t,n=r[0]&&Y1(r);return{c(){n&&n.c(),e=Xn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o[0]&1&&j(n,1)):(n=Y1(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(en(),Z(n,1,1,()=>{n=null}),tn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function V8(r,e,t){let n,i,o,c,a,d,p,y,_,w,T,M,{$$slots:$={},$$scope:P}=e,{id:D=Ph("layer")}=e,{source:I=void 0}=e,{sourceLayer:F=void 0}=e,{beforeId:N=void 0}=e,{beforeLayerType:W=void 0}=e,{type:se}=e,{paint:J=void 0}=e,{layout:ee=void 0}=e,{filter:me=void 0}=e,{applyToClusters:Ie=void 0}=e,{minzoom:Q=void 0}=e,{maxzoom:ae=void 0}=e,{manageHoverState:Pe=!1}=e,{hovered:ve=null}=e,{interactive:tt=!0}=e,{hoverCursor:Ge=void 0}=e,{eventsIfTopMost:Ee=!1}=e;const $e=ms(),{map:St,source:rt,self:lt,minzoom:mt,maxzoom:ft,eventTopMost:Xe,layerInfo:Dt}=O8();at(r,St,ze=>t(31,_=ze)),at(r,rt,ze=>t(32,w=ze)),at(r,lt,ze=>t(0,y=ze)),at(r,mt,ze=>t(34,M=ze)),at(r,ft,ze=>t(33,T=ze)),Yr(()=>{y&&_&&(Dt.delete(y),_==null||_.removeLayer(y))});let _t;function $t(ze){var _e,vn;if(!tt||!y||!_||Ee&&Xe(ze)!==y)return;let Ne=ze.features??[],kt=(vn=(_e=Ne[0])==null?void 0:_e.properties)==null?void 0:vn.cluster_id,jt={event:ze,map:_,clusterId:kt,layer:y,source:a,features:Ne};$e(ze.type,jt)}function Et(ze){var _e,vn;if(!tt||!y||!_||Ee&&Xe(ze)!==y)return;Ge&&(_.getCanvas().style.cursor=Ge);let Ne=ze.features??[];t(6,ve=Ne[0]??null);let kt=(vn=(_e=Ne[0])==null?void 0:_e.properties)==null?void 0:vn.cluster_id;$e("mouseenter",{event:ze,map:_,clusterId:kt,layer:y,source:a,features:Ne})}function Yt(ze){var _e,vn,Ue;if(!tt||!_)return;if(Ee&&Xe(ze)!==y){t(6,ve=null),Pe&&_t!==void 0&&(_==null||_.setFeatureState({source:a,sourceLayer:F,id:_t},{hover:!1}),_t=void 0);return}_.getCanvas().style.cursor=Ge;let Ne=ze.features??[],kt=(vn=(_e=Ne[0])==null?void 0:_e.properties)==null?void 0:vn.cluster_id,jt=(Ue=Ne[0])==null?void 0:Ue.id;jt!==_t&&(Pe&&(_t!==void 0&&(_==null||_.setFeatureState({source:a,id:_t,sourceLayer:F},{hover:!1})),_==null||_.setFeatureState({source:a,id:jt,sourceLayer:F},{hover:!0})),_t=jt,t(6,ve=Ne[0]??null)),$e("mousemove",{event:ze,map:_,clusterId:kt,layer:y,source:a,features:Ne})}function _n(ze){if(!(!tt||!y||!_)){if(Ge&&(_.getCanvas().style.cursor=""),t(6,ve=null),Pe&&_t!==void 0){const Ne={source:a,id:_t,sourceLayer:F};_==null||_.setFeatureState(Ne,{hover:!1}),_t=void 0}$e("mouseleave",{map:_,layer:y,source:a})}}let Zt=!0;function ln(ze){_&&(_.off("click",ze,$t),_.off("dblclick",ze,$t),_.off("contextmenu",ze,$t),_.off("mouseenter",ze,Et),_.off("mousemove",ze,Yt),_.off("mouseleave",ze,_n))}return Yr(()=>{_&&y&&ln(y)}),r.$$set=ze=>{"id"in ze&&t(7,D=ze.id),"source"in ze&&t(8,I=ze.source),"sourceLayer"in ze&&t(9,F=ze.sourceLayer),"beforeId"in ze&&t(10,N=ze.beforeId),"beforeLayerType"in ze&&t(11,W=ze.beforeLayerType),"type"in ze&&t(12,se=ze.type),"paint"in ze&&t(13,J=ze.paint),"layout"in ze&&t(14,ee=ze.layout),"filter"in ze&&t(15,me=ze.filter),"applyToClusters"in ze&&t(16,Ie=ze.applyToClusters),"minzoom"in ze&&t(17,Q=ze.minzoom),"maxzoom"in ze&&t(18,ae=ze.maxzoom),"manageHoverState"in ze&&t(19,Pe=ze.manageHoverState),"hovered"in ze&&t(6,ve=ze.hovered),"interactive"in ze&&t(20,tt=ze.interactive),"hoverCursor"in ze&&t(21,Ge=ze.hoverCursor),"eventsIfTopMost"in ze&&t(22,Ee=ze.eventsIfTopMost),"$$scope"in ze&&t(35,P=ze.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=j8(Ie)),r.$$.dirty[0]&1073774592&&t(24,i=N8("all",n,me)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,o=Q??M),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,c=ae??T),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,a=I||w),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&_&&y!==D&&a){y&&(ln(y),Dt.delete(y));let ze=N;if(!N&&W){let Ne=_.getStyle().layers,kt=typeof W=="function"?W:_e=>_e.type===W,jt=Ne==null?void 0:Ne.find(kt);jt&&(ze=jt.id)}Nt(lt,y=D,y),_.addLayer(La({id:y,type:se,source:a,"source-layer":F,filter:i,paint:J,layout:ee,minzoom:o,maxzoom:c}),ze),t(23,Zt=!0),_.on("click",y,$t),_.on("dblclick",y,$t),_.on("contextmenu",y,$t),_.on("mouseenter",y,Et),_.on("mousemove",y,Yt),_.on("mouseleave",y,_n)}r.$$.dirty[0]&1048577&&y&&Dt.set(y,{interactive:tt}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,d=y?J1((ze,Ne)=>_==null?void 0:_.setPaintProperty(y,ze,Ne)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,p=y?J1((ze,Ne)=>_==null?void 0:_.setLayoutProperty(y,ze,Ne)):void 0),r.$$.dirty[0]&268443648&&(d==null||d(J)),r.$$.dirty[0]&134234112&&(p==null||p(ee)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&y&&(_==null||_.setLayerZoomRange(y,o,c)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&y&&(Zt?t(23,Zt=!1):_==null||_.setFilter(y,i))},[y,St,rt,lt,mt,ft,ve,D,I,F,N,W,se,J,ee,me,Ie,Q,ae,Pe,tt,Ge,Ee,Zt,i,c,o,p,d,a,n,_,w,T,M,P,$]}class sg extends Lt{constructor(e){super(),Mt(this,e,V8,U8,vt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function q8(r){let e;const t=r[16].default,n=Sn(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&Tn(n,t,i,i[24],e?Cn(t,i[24],o,null):Mn(i[24]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function Z8(r){let e,t,n;function i(c){r[17](c)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[q8]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new sg({props:o}),hn.push(()=>In(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){fe(e.$$.fragment)},m(c,a){ue(e,c,a),n=!0},p(c,[a]){const d={};a&2&&(d.id=c[1]),a&4&&(d.source=c[2]),a&8&&(d.sourceLayer=c[3]),a&16&&(d.beforeId=c[4]),a&32&&(d.beforeLayerType=c[5]),a&64&&(d.paint=c[6]),a&128&&(d.layout=c[7]),a&256&&(d.filter=c[8]),a&512&&(d.applyToClusters=c[9]),a&1024&&(d.minzoom=c[10]),a&2048&&(d.maxzoom=c[11]),a&4096&&(d.hoverCursor=c[12]),a&8192&&(d.manageHoverState=c[13]),a&16384&&(d.eventsIfTopMost=c[14]),a&32768&&(d.interactive=c[15]),a&16777216&&(d.$$scope={dirty:a,ctx:c}),!t&&a&1&&(t=!0,d.hovered=c[0],En(()=>t=!1)),e.$set(d)},i(c){n||(j(e.$$.fragment,c),n=!0)},o(c){Z(e.$$.fragment,c),n=!1},d(c){he(e,c)}}}function G8(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Ph("circle")}=e,{source:c=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:y}=e,{layout:_=void 0}=e,{filter:w=void 0}=e,{applyToClusters:T=void 0}=e,{minzoom:M=void 0}=e,{maxzoom:$=void 0}=e,{hoverCursor:P=void 0}=e,{manageHoverState:D=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:F=!1}=e,{interactive:N=!0}=e;function W(ae){I=ae,t(0,I)}function se(ae){zn.call(this,r,ae)}function J(ae){zn.call(this,r,ae)}function ee(ae){zn.call(this,r,ae)}function me(ae){zn.call(this,r,ae)}function Ie(ae){zn.call(this,r,ae)}function Q(ae){zn.call(this,r,ae)}return r.$$set=ae=>{"id"in ae&&t(1,o=ae.id),"source"in ae&&t(2,c=ae.source),"sourceLayer"in ae&&t(3,a=ae.sourceLayer),"beforeId"in ae&&t(4,d=ae.beforeId),"beforeLayerType"in ae&&t(5,p=ae.beforeLayerType),"paint"in ae&&t(6,y=ae.paint),"layout"in ae&&t(7,_=ae.layout),"filter"in ae&&t(8,w=ae.filter),"applyToClusters"in ae&&t(9,T=ae.applyToClusters),"minzoom"in ae&&t(10,M=ae.minzoom),"maxzoom"in ae&&t(11,$=ae.maxzoom),"hoverCursor"in ae&&t(12,P=ae.hoverCursor),"manageHoverState"in ae&&t(13,D=ae.manageHoverState),"hovered"in ae&&t(0,I=ae.hovered),"eventsIfTopMost"in ae&&t(14,F=ae.eventsIfTopMost),"interactive"in ae&&t(15,N=ae.interactive),"$$scope"in ae&&t(24,i=ae.$$scope)},[I,o,c,a,d,p,y,_,w,T,M,$,P,D,F,N,n,W,se,J,ee,me,Ie,Q,i]}class H8 extends Lt{constructor(e){super(),Mt(this,e,G8,Z8,vt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function W8(r){let e;const t=r[15].default,n=Sn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&Tn(n,t,i,i[23],e?Cn(t,i[23],o,null):Mn(i[23]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function K8(r){let e,t,n;function i(c){r[16](c)}let o={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[W8]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new sg({props:o}),hn.push(()=>In(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){fe(e.$$.fragment)},m(c,a){ue(e,c,a),n=!0},p(c,[a]){const d={};a&2&&(d.id=c[1]),a&4&&(d.source=c[2]),a&8&&(d.sourceLayer=c[3]),a&16&&(d.beforeId=c[4]),a&32&&(d.beforeLayerType=c[5]),a&64&&(d.paint=c[6]),a&128&&(d.layout=c[7]),a&256&&(d.filter=c[8]),a&512&&(d.minzoom=c[9]),a&1024&&(d.maxzoom=c[10]),a&2048&&(d.hoverCursor=c[11]),a&4096&&(d.manageHoverState=c[12]),a&8192&&(d.eventsIfTopMost=c[13]),a&16384&&(d.interactive=c[14]),a&8388608&&(d.$$scope={dirty:a,ctx:c}),!t&&a&1&&(t=!0,d.hovered=c[0],En(()=>t=!1)),e.$set(d)},i(c){n||(j(e.$$.fragment,c),n=!0)},o(c){Z(e.$$.fragment,c),n=!1},d(c){he(e,c)}}}function X8(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Ph("fill")}=e,{source:c=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:y}=e,{layout:_=void 0}=e,{filter:w=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:M=void 0}=e,{hoverCursor:$=void 0}=e,{manageHoverState:P=!1}=e,{hovered:D=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:F=!0}=e;function N(Q){D=Q,t(0,D)}function W(Q){zn.call(this,r,Q)}function se(Q){zn.call(this,r,Q)}function J(Q){zn.call(this,r,Q)}function ee(Q){zn.call(this,r,Q)}function me(Q){zn.call(this,r,Q)}function Ie(Q){zn.call(this,r,Q)}return r.$$set=Q=>{"id"in Q&&t(1,o=Q.id),"source"in Q&&t(2,c=Q.source),"sourceLayer"in Q&&t(3,a=Q.sourceLayer),"beforeId"in Q&&t(4,d=Q.beforeId),"beforeLayerType"in Q&&t(5,p=Q.beforeLayerType),"paint"in Q&&t(6,y=Q.paint),"layout"in Q&&t(7,_=Q.layout),"filter"in Q&&t(8,w=Q.filter),"minzoom"in Q&&t(9,T=Q.minzoom),"maxzoom"in Q&&t(10,M=Q.maxzoom),"hoverCursor"in Q&&t(11,$=Q.hoverCursor),"manageHoverState"in Q&&t(12,P=Q.manageHoverState),"hovered"in Q&&t(0,D=Q.hovered),"eventsIfTopMost"in Q&&t(13,I=Q.eventsIfTopMost),"interactive"in Q&&t(14,F=Q.interactive),"$$scope"in Q&&t(23,i=Q.$$scope)},[D,o,c,a,d,p,y,_,w,T,M,$,P,I,F,n,N,W,se,J,ee,me,Ie,i]}class J8 extends Lt{constructor(e){super(),Mt(this,e,X8,K8,vt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function Y8(r,e,t,n,i){let o=!1;r.getSource(e)&&(o=!0,r.removeSource(e));const c=()=>{n(e)&&(r.addSource(e,t),i())};if(o){const a=()=>{e&&(r.getSource(e)?setTimeout(a,1):c())};a()}else c()}function Q8(r,e,t){kb().then(()=>{let n=fi(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function eb(r){let e=r[0],t,n,i=tb(r);return{c(){i.c(),t=Xn()},m(o,c){i.m(o,c),q(o,t,c),n=!0},p(o,c){c&1&&vt(e,e=o[0])?(en(),Z(i,1,1,et),tn(),i=tb(o),i.c(),j(i,1),i.m(t.parentNode,t)):i.p(o,c)},i(o){n||(j(i),n=!0)},o(o){Z(i),n=!1},d(o){o&&V(t),i.d(o)}}}function tb(r){let e;const t=r[15].default,n=Sn(t,r,r[14],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16384)&&Tn(n,t,i,i[14],e?Cn(t,i[14],o,null):Mn(i[14]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function eP(r){let e,t,n=r[0]&&eb(r);return{c(){n&&n.c(),e=Xn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&j(n,1)):(n=eb(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(en(),Z(n,1,1,()=>{n=null}),tn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function tP(r,e,t){let n,i,o,{$$slots:c={},$$scope:a}=e,{id:d=Ph("geojson")}=e,{data:p}=e,{generateId:y=!1}=e,{promoteId:_=void 0}=e,{filter:w=void 0}=e,{lineMetrics:T=void 0}=e,{cluster:M=void 0}=e;const{map:$,cluster:P,self:D}=B8();at(r,$,N=>t(13,i=N)),at(r,P,N=>t(16,o=N)),at(r,D,N=>t(0,n=N));let I,F=!0;return Yr(()=>{n&&I&&i&&(Q8($,n,I),Nt(D,n=null,n),t(11,I=void 0))}),r.$$set=N=>{"id"in N&&t(4,d=N.id),"data"in N&&t(5,p=N.data),"generateId"in N&&t(6,y=N.generateId),"promoteId"in N&&t(7,_=N.promoteId),"filter"in N&&t(8,w=N.filter),"lineMetrics"in N&&t(9,T=N.lineMetrics),"cluster"in N&&t(10,M=N.cluster),"$$scope"in N&&t(14,a=N.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&Nt(P,o=M,o),r.$$.dirty&12273&&i&&n!==d&&(Nt(D,n=d,n),Y8(i,n,La({type:"geojson",data:p,filter:w,lineMetrics:T,generateId:y,promoteId:_,cluster:!!M,clusterMinPoints:M==null?void 0:M.minPoints,clusterMaxZoom:M==null?void 0:M.maxZoom,clusterRadius:M==null?void 0:M.radius,clusterProperties:M==null?void 0:M.properties}),N=>i&&N===n,()=>{n&&(t(11,I=i==null?void 0:i.getSource(n)),t(12,F=!0))})),r.$$.dirty&8208&&(i==null||i.on("style.load",()=>{t(11,I=i==null?void 0:i.getSource(d))})),r.$$.dirty&6176&&I&&(F?t(12,F=!1):I.setData(p)),r.$$.dirty&3072&&(I==null||I.setClusterOptions(La({cluster:!!M,clusterMaxZoom:M==null?void 0:M.maxZoom,clusterRadius:M==null?void 0:M.radius})))},[n,$,P,D,d,p,y,_,w,T,M,I,F,i,a,c]}class nP extends Lt{constructor(e){super(),Mt(this,e,tP,eP,vt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function rP(r){let e;const t=r[15].default,n=Sn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&Tn(n,t,i,i[23],e?Cn(t,i[23],o,null):Mn(i[23]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function iP(r){let e,t,n;function i(c){r[16](c)}let o={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[rP]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new sg({props:o}),hn.push(()=>In(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){fe(e.$$.fragment)},m(c,a){ue(e,c,a),n=!0},p(c,[a]){const d={};a&2&&(d.id=c[1]),a&4&&(d.source=c[2]),a&8&&(d.sourceLayer=c[3]),a&16&&(d.beforeId=c[4]),a&32&&(d.beforeLayerType=c[5]),a&64&&(d.paint=c[6]),a&128&&(d.layout=c[7]),a&256&&(d.filter=c[8]),a&512&&(d.minzoom=c[9]),a&1024&&(d.maxzoom=c[10]),a&2048&&(d.hoverCursor=c[11]),a&4096&&(d.manageHoverState=c[12]),a&8192&&(d.eventsIfTopMost=c[13]),a&16384&&(d.interactive=c[14]),a&8388608&&(d.$$scope={dirty:a,ctx:c}),!t&&a&1&&(t=!0,d.hovered=c[0],En(()=>t=!1)),e.$set(d)},i(c){n||(j(e.$$.fragment,c),n=!0)},o(c){Z(e.$$.fragment,c),n=!1},d(c){he(e,c)}}}function oP(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Ph("line")}=e,{source:c=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:y}=e,{layout:_=void 0}=e,{filter:w=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:M=void 0}=e,{hoverCursor:$=void 0}=e,{manageHoverState:P=!1}=e,{hovered:D=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:F=!0}=e;function N(Q){D=Q,t(0,D)}function W(Q){zn.call(this,r,Q)}function se(Q){zn.call(this,r,Q)}function J(Q){zn.call(this,r,Q)}function ee(Q){zn.call(this,r,Q)}function me(Q){zn.call(this,r,Q)}function Ie(Q){zn.call(this,r,Q)}return r.$$set=Q=>{"id"in Q&&t(1,o=Q.id),"source"in Q&&t(2,c=Q.source),"sourceLayer"in Q&&t(3,a=Q.sourceLayer),"beforeId"in Q&&t(4,d=Q.beforeId),"beforeLayerType"in Q&&t(5,p=Q.beforeLayerType),"paint"in Q&&t(6,y=Q.paint),"layout"in Q&&t(7,_=Q.layout),"filter"in Q&&t(8,w=Q.filter),"minzoom"in Q&&t(9,T=Q.minzoom),"maxzoom"in Q&&t(10,M=Q.maxzoom),"hoverCursor"in Q&&t(11,$=Q.hoverCursor),"manageHoverState"in Q&&t(12,P=Q.manageHoverState),"hovered"in Q&&t(0,D=Q.hovered),"eventsIfTopMost"in Q&&t(13,I=Q.eventsIfTopMost),"interactive"in Q&&t(14,F=Q.interactive),"$$scope"in Q&&t(23,i=Q.$$scope)},[D,o,c,a,d,p,y,_,w,T,M,$,P,I,F,n,N,W,se,J,ee,me,Ie,i]}class sP extends Lt{constructor(e){super(),Mt(this,e,oP,iP,vt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function aP(r){let e,t,n,i,o,c;return e=new J8({props:{id:"edit-polygon-fill",filter:T8,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),n=new sP({props:{id:"edit-polygon-lines",filter:M8,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),o=new H8({props:{id:"edit-polygon-vertices",filter:L8,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment),i=oe(),fe(o.$$.fragment)},m(a,d){ue(e,a,d),q(a,t,d),ue(n,a,d),q(a,i,d),ue(o,a,d),c=!0},p:et,i(a){c||(j(e.$$.fragment,a),j(n.$$.fragment,a),j(o.$$.fragment,a),c=!0)},o(a){Z(e.$$.fragment,a),Z(n.$$.fragment,a),Z(o.$$.fragment,a),c=!1},d(a){a&&(V(t),V(i)),he(e,a),he(n,a),he(o,a)}}}function lP(r){let e,t;return e=new nP({props:{data:r[0],$$slots:{default:[aP]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&2&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function cP(r,e,t){let n;return at(r,Xv,i=>t(0,n=i)),[n]}class uP extends Lt{constructor(e){super(),Mt(this,e,cP,lP,vt,{})}}function hP(r){let e,t,n,i,o,c,a;return{c(){e=U("button"),e.textContent="Import current view",t=oe(),n=U("i"),n.textContent="or...",i=oe(),o=U("button"),o.textContent="Draw an area to import on the map",de(e,"type","button"),de(o,"type","button")},m(d,p){q(d,e,p),q(d,t,p),q(d,n,p),q(d,i,p),q(d,o,p),c||(a=[wt(e,"click",r[2]),wt(o,"click",r[3])],c=!0)},p:et,i:et,o:et,d(d){d&&(V(e),V(t),V(n),V(i),V(o)),c=!1,pr(a)}}}function fP(r){let e,t;return e=new $8({props:{polygonTool:r[0]}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.polygonTool=n[0]),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function dP(r){let e,t,n,i,o,c,a,d,p;const y=[fP,hP],_=[];function w(T,M){return T[0]?0:1}return e=w(r),t=_[e]=y[e](r),{c(){t.c(),n=oe(),i=U("label"),o=U("input"),c=xe(`Save a copy of the osm.xml
  after importing`),de(o,"type","checkbox")},m(T,M){_[e].m(T,M),q(T,n,M),q(T,i,M),R(i,o),o.checked=r[1],R(i,c),a=!0,d||(p=wt(o,"change",r[5]),d=!0)},p(T,[M]){let $=e;e=w(T),e===$?_[e].p(T,M):(en(),Z(_[$],1,1,()=>{_[$]=null}),tn(),t=_[e],t?t.p(T,M):(t=_[e]=y[e](T),t.c()),j(t,1),t.m(n.parentNode,n)),M&2&&(o.checked=T[1])},i(T){a||(j(t),a=!0)},o(T){Z(t),a=!1},d(T){T&&(V(n),V(i)),_[e].d(T),d=!1,p()}}}function Ku(r){return[r.lng,r.lat]}function pP(r,e,t){let{map:n}=e;const i=ms();let o=null,c=!1;async function a(w){try{i("loading","Loading from Overpass");let M=await(await fetch(ew(w))).text();c&&wd("osm.xml",M),i("gotXml",{xml:M,boundary:w})}catch(T){i("error",T.toString())}}function d(){let w=n.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[Ku(w.getSouthWest()),Ku(w.getNorthWest()),Ku(w.getNorthEast()),Ku(w.getSouthEast()),Ku(w.getSouthWest())]],type:"Polygon"}}}async function p(){if(n){if(n.getZoom()<13){i("error","Zoom in more to import");return}await a(d())}}function y(){n&&(t(0,o=new I8(n)),o.startNew(),o.addEventListenerSuccess(async w=>{t(0,o=null),await a(w)}),o.addEventListenerFailure(()=>{t(0,o=null)}))}function _(){c=this.checked,t(1,c)}return r.$$set=w=>{"map"in w&&t(4,n=w.map)},[o,c,p,y,n,_]}class mP extends Lt{constructor(e){super(),Mt(this,e,pP,dP,vt,{map:4})}}function ew(r){let e='poly:"';if(r.geometry.type=="Polygon")for(let[n,i]of r.geometry.coordinates[0])e+=`${i} ${n} `;else if(r.geometry.type=="MultiPolygon")for(let[n,i]of r.geometry.coordinates[0][0])e+=`${i} ${n} `;else throw new Error("overpassQueryForPolygon needs a Polygon or MultiPolygon");return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}class tw{constructor(e,t,n,i,o,c,a,d){tr(this,"inner");this.inner=new X6(e,t||new Uint8Array,n||new Uint8Array,i,o,c,a,d)}getInvertedBoundary(){return JSON.parse(this.inner.getInvertedBoundary())}getBounds(){return Array.from(this.inner.getBounds())}toRouteSnapper(){return this.inner.toRouteSnapper()}toRouteSnapperGj(){return this.inner.toRouteSnapperGj()}renderModalFilters(){return JSON.parse(this.inner.renderModalFilters())}renderTurnRestrictions(){return JSON.parse(this.inner.renderTurnRestrictions())}renderNeighbourhood(){let e=JSON.parse(this.inner.renderNeighbourhood());return e.maxShortcuts=Math.max(...e.features.map(t=>t.properties.kind=="interior_road"?t.properties.shortcuts:0))??0,e}generatedBoundaries(){return JSON.parse(this.inner.generatedBoundaries())}generateMergedBoundary(e){let t=this.inner.generateMergedBoundary(e);return JSON.parse(t)}setNeighbourhoodBoundary(e,t){this.inner.setNeighbourhoodBoundary(e,t)}deleteNeighbourhoodBoundary(e){this.inner.deleteNeighbourhoodBoundary(e)}renameNeighbourhoodBoundary(e,t){this.inner.renameNeighbourhoodBoundary(e,t)}setCurrentNeighbourhood(e){this.inner.setCurrentNeighbourhood(e)}addModalFilter(e,t){this.inner.addModalFilter(e,t)}addManyModalFilters(e,t){this.inner.addManyModalFilters(e,t)}deleteModalFilter(e){this.inner.deleteModalFilter(e)}addDiagonalFilter(e){this.inner.addDiagonalFilter(e.intersectionId)}rotateDiagonalFilter(e){this.inner.rotateDiagonalFilter(e.intersectionId)}deleteDiagonalFilter(e){this.inner.deleteDiagonalFilter(e.intersectionId)}toggleTravelFlow(e){this.inner.toggleTravelFlow(e)}toggleMainRoad(e){this.inner.toggleMainRoad(e)}addTurnRestriction(e,t){this.inner.addTurnRestriction(e,t)}deleteTurnRestriction(e,t,n){this.inner.deleteTurnRestriction(e,t,n)}getTurnRestrictionTargets(e){return JSON.parse(this.inner.getTurnRestrictionTargets(e))}undo(){this.inner.undo()}redo(){this.inner.redo()}getShortcutsCrossingRoad(e){return JSON.parse(this.inner.getShortcutsCrossingRoad(e))}getAllShortcuts(){return JSON.parse(this.inner.getAllShortcuts())}toSavefile(){return JSON.parse(this.inner.toSavefile())}loadSavefile(e){this.inner.loadSavefile(e)}compareRoute(e,t,n){return JSON.parse(this.inner.compareRoute(e.lng,e.lat,t.lng,t.lat,n))}impactToOneDestination(e){return JSON.parse(this.inner.impactToOneDestination(e.lng,e.lat))}predictImpact(e){return JSON.parse(this.inner.predictImpact(e))}getImpactsOnRoad(e,t){return JSON.parse(this.inner.getImpactsOnRoad(e,t)).map(n=>{let[i,o,c]=n;return{count:i,before:o,after:c}})}getAllNeighbourhoods(){return JSON.parse(this.inner.getAllNeighbourhoods())}getAllIntersections(){return JSON.parse(this.inner.getAllIntersections())}getMovements(e){return JSON.parse(this.inner.getMovements(e))}getDemandModel(){let e=JSON.parse(this.inner.getDemandModel());for(let t of e.features)t.properties.sum_from=E0(t.properties.counts_from),t.properties.sum_to=E0(t.properties.counts_to);return e}getPOIs(){return JSON.parse(this.inner.getPOIs())}}async function xh(r){let e=fi(Qs).project(r);try{console.time("get input files");let{osmBuffer:t,demandBuffer:n,contextDataBuffer:i,boundary:o}=await gP(e);console.timeEnd("get input files"),console.time("load"),Ar.set(new tw(new Uint8Array(t),n?new Uint8Array(n):void 0,i?new Uint8Array(i):void 0,o,e.app_focus,e.study_area_name,e.project_name,e.db_schema_version)),fi(Ar).loadSavefile(e),_l.set(r),console.timeEnd("load"),_P(r)}catch(t){window.alert(`Couldn't open project: ${t}`),_l.set(void 0)}}async function gP(r){if(r.app_focus=="cnt"){console.assert(r.study_area_name,"CNT projects must have a study area name");let e=zo(`cnt_osm/${r.study_area_name}.osm.pbf`);console.log(`Grabbing ${e}`);let n=await(await xa(e)).arrayBuffer(),i=zo(`cnt_boundaries/${r.study_area_name}.geojson`),c=await(await xa(i)).json(),a=zo(`cnt_demand/demand_${r.study_area_name}.bin`);console.log(`Grabbing ${a}`);let d;try{d=await(await xa(a)).arrayBuffer()}catch(_){console.log(`No demand model: ${_}`)}let p=zo(`cnt_prioritization/context_${r.study_area_name}.bin`);console.log(`Grabbing ${p}`);let y;try{y=await(await xa(p)).arrayBuffer()}catch(_){console.log(`No context data for prioritization: ${_}`)}return{osmBuffer:n,boundary:c,demandBuffer:d,contextDataBuffer:y}}else if(r.study_area_name){let e=zo(`severance_pbfs/${r.study_area_name}.pbf`);console.log(`Grabbing ${e}`);let n=await(await xa(e)).arrayBuffer(),i=zo(`boundaries/${r.study_area_name}.geojson`),c=await(await xa(i)).json();return{osmBuffer:n,boundary:c}}else{console.log("Grabbing from Overpass");let e=r.features.find(i=>i.properties.kind=="study_area_boundary");return{osmBuffer:await(await xa(ew(e))).arrayBuffer(),boundary:e}}}function _P(r){yd.set(new hk(fi(Ro),fi(Ar).toRouteSnapper(),An(Ki()),An(!0),An(0))),fi(Ro).fitBounds(fi(Ar).getBounds(),{duration:500});let e=new URL(window.location.href);e.searchParams.set("project",r),window.history.replaceState(null,"",e.toString())}function nb(r,e,t){const n=r.slice();return n[16]=e[t][0],n[17]=e[t][1],n}function rb(r,e,t){const n=r.slice();return n[20]=e[t][0],n[21]=e[t][1],n}function yP(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function bP(r){let e,t,n,i,o,c,a,d;return o=new $n({props:{$$slots:{default:[yP]},$$scope:{ctx:r}}}),o.$on("click",Bo),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),fe(o.$$.fragment),c=oe(),a=U("li"),a.textContent="New project",de(t,"aria-label","breadcrumb"),de(e,"slot","top")},m(p,y){q(p,e,y),R(e,t),R(t,n),R(n,i),ue(o,i,null),R(n,c),R(n,a),d=!0},p(p,y){const _={};y&16777216&&(_.$$scope={dirty:y,ctx:p}),o.$set(_)},i(p){d||(j(o.$$.fragment,p),d=!0)},o(p){Z(o.$$.fragment,p),d=!1},d(p){p&&V(e),he(o)}}}function ib(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M;e=new Sh({props:{loading:r[4]}});let $=Rn(r[3]),P=[];for(let D=0;D<$.length;D+=1)P[D]=sb(nb(r,$,D));return _=new mP({props:{map:r[5]}}),_.$on("gotXml",r[6]),_.$on("loading",r[10]),_.$on("error",r[11]),{c(){fe(e.$$.fragment),t=oe(),n=U("label"),i=xe(`Load a built-in area:
        `),o=U("select"),c=U("option");for(let D=0;D<P.length;D+=1)P[D].c();a=oe(),d=U("i"),d.textContent="or...",p=oe(),y=U("div"),fe(_.$$.fragment),c.__value="",qn(c,c.__value),r[2]===void 0&&us(()=>r[8].call(o))},m(D,I){ue(e,D,I),q(D,t,I),q(D,n,I),R(n,i),R(n,o),R(o,c);for(let F=0;F<P.length;F+=1)P[F]&&P[F].m(o,null);Zi(o,r[2],!0),q(D,a,I),q(D,d,I),q(D,p,I),q(D,y,I),ue(_,y,null),w=!0,T||(M=[wt(o,"change",r[8]),wt(o,"change",r[9])],T=!0)},p(D,I){const F={};if(I&16&&(F.loading=D[4]),e.$set(F),I&8){$=Rn(D[3]);let W;for(W=0;W<$.length;W+=1){const se=nb(D,$,W);P[W]?P[W].p(se,I):(P[W]=sb(se),P[W].c(),P[W].m(o,null))}for(;W<P.length;W+=1)P[W].d(1);P.length=$.length}I&12&&Zi(o,D[2]);const N={};I&32&&(N.map=D[5]),_.$set(N)},i(D){w||(j(e.$$.fragment,D),j(_.$$.fragment,D),w=!0)},o(D){Z(e.$$.fragment,D),Z(_.$$.fragment,D),w=!1},d(D){D&&(V(t),V(n),V(a),V(d),V(p),V(y)),he(e,D),di(P,D),he(_),T=!1,pr(M)}}}function ob(r){let e,t=r[21]+"",n,i;return{c(){e=U("option"),n=xe(t),e.__value=i=r[20],qn(e,e.__value)},m(o,c){q(o,e,c),R(e,n)},p(o,c){c&8&&t!==(t=o[21]+"")&&Tt(n,t),c&8&&i!==(i=o[20])&&(e.__value=i,qn(e,e.__value))},d(o){o&&V(e)}}}function sb(r){let e,t,n=Rn(r[17]),i=[];for(let o=0;o<n.length;o+=1)i[o]=ob(rb(r,n,o));return{c(){e=U("optgroup");for(let o=0;o<i.length;o+=1)i[o].c();de(e,"label",t=r[16])},m(o,c){q(o,e,c);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(e,null)},p(o,c){if(c&8){n=Rn(o[17]);let a;for(a=0;a<n.length;a+=1){const d=rb(o,n,a);i[a]?i[a].p(d,c):(i[a]=ob(d),i[a].c(),i[a].m(e,null))}for(;a<i.length;a+=1)i[a].d(1);i.length=n.length}c&8&&t!==(t=o[16])&&de(e,"label",t)},d(o){o&&V(e),di(i,o)}}}function vP(r){let e,t,n,i,o,c,a,d,p,y=r[1]&&ib(r);return{c(){e=U("div"),t=U("div"),n=U("label"),i=xe(`Project name:
        `),o=U("input"),c=oe(),y&&y.c(),de(o,"type","text"),de(e,"slot","sidebar")},m(_,w){q(_,e,w),R(e,t),R(t,n),R(n,i),R(n,o),qn(o,r[1]),R(e,c),y&&y.m(e,null),a=!0,d||(p=wt(o,"input",r[7]),d=!0)},p(_,w){w&2&&o.value!==_[1]&&qn(o,_[1]),_[1]?y?(y.p(_,w),w&2&&j(y,1)):(y=ib(_),y.c(),j(y,1),y.m(e,null)):y&&(en(),Z(y,1,1,()=>{y=null}),tn())},i(_){a||(j(y),a=!0)},o(_){Z(y),a=!1},d(_){_&&V(e),y&&y.d(),d=!1,p()}}}function wP(r){let e,t,n;return t=new uP({}),{c(){e=U("div"),fe(t.$$.fragment),de(e,"slot","map")},m(i,o){q(i,e,o),ue(t,e,null),n=!0},p:et,i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),he(t)}}}function xP(r){let e,t;return e=new bo({props:{$$slots:{map:[wP],sidebar:[vP],top:[bP]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,[i]){const o={};i&16777278&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function kP(r,e,t){let n,i,o,c,a;at(r,an,F=>t(12,n=F)),at(r,Qs,F=>t(13,i=F)),at(r,Ar,F=>t(14,o=F)),at(r,Fo,F=>t(15,c=F)),at(r,Ro,F=>t(5,a=F));let d="",p=null,y=[],_="";Ls(async()=>{let F=await xa(zo("severance_pbfs/areas.json"));t(3,y=await F.json())});async function w(F){t(4,_="Loading OSM");try{let N;Nt(Ar,o=new tw(new TextEncoder().encode(F.detail.xml),void 0,void 0,F.detail.boundary,c,N,d,i.dbSchemaVersion),o);const W=i.createProject(o.toSavefile());await xh(W),Nt(an,n={mode:"add-neighbourhood"},n)}catch(N){window.alert(`Couldn't import from Overpass: ${N}`)}t(4,_="")}async function T(){if(!p)return;let F;try{F=i.createEmptyProject(d,p)}catch(N){t(2,p=null),window.alert(`Couldn't create project: ${N}`);return}t(4,_=`Loading pre-clipped OSM area ${p}`),await xh(F),Nt(an,n={mode:"add-neighbourhood"},n),t(4,_="")}function M(){d=this.value,t(1,d)}function $(){p=Sa(this),t(2,p),t(3,y)}return[T,d,p,y,_,a,w,M,$,()=>T(),F=>t(4,_=F.detail),F=>window.alert(F.detail)]}class SP extends Lt{constructor(e){super(),Mt(this,e,kP,xP,vt,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}const CP="/ltn/assets/boundaries-2701bb3b.geojson";function ab(r,e,t){const n=r.slice();return n[9]=e[t],n}function TP(r){let e=r[9]+"",t;return{c(){t=xe(e)},m(n,i){q(n,t,i)},p(n,i){i&2&&e!==(e=n[9]+"")&&Tt(t,e)},d(n){n&&V(t)}}}function lb(r){let e,t,n;function i(){return r[5](r[9])}return t=new $n({props:{$$slots:{default:[TP]},$$scope:{ctx:r}}}),t.$on("click",i),{c(){e=U("li"),fe(t.$$.fragment)},m(o,c){q(o,e,c),ue(t,e,null),n=!0},p(o,c){r=o;const a={};c&4098&&(a.$$scope={dirty:c,ctx:r}),t.$set(a)},i(o){n||(j(t.$$.fragment,o),n=!0)},o(o){Z(t.$$.fragment,o),n=!1},d(o){o&&V(e),he(t)}}}function MP(r){let e,t,n=r[8].name+"",i;return{c(){e=U("p"),t=xe("Click to start a new project in "),i=xe(n)},m(o,c){q(o,e,c),R(e,t),R(e,i)},p(o,c){c&256&&n!==(n=o[8].name+"")&&Tt(i,n)},d(o){o&&V(e)}}}function LP(r){let e,t;return e=new ui({props:{openOn:"hover",$$slots:{default:[MP,({props:n})=>({8:n}),({props:n})=>n?256:0]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&4352&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function EP(r){let e,t,n,i;return e=new Hi({props:{paint:{"fill-color":yo.mapFeature.hover.backgroundColor,"fill-outline-color":yo.mapFeature.hover.backgroundColor,"fill-opacity":Hn(0,.5)},beforeId:"Road labels",manageHoverState:!0,hoverCursor:"pointer",$$slots:{default:[LP]},$$scope:{ctx:r}}}),e.$on("click",r[2]),n=new sr({props:{paint:{"line-color":yo.mapFeature.hover.backgroundColor,"line-width":2.5},beforeId:"Road labels",manageHoverState:!1}}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment)},m(o,c){ue(e,o,c),q(o,t,c),ue(n,o,c),i=!0},p(o,c){const a={};c&4096&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){i||(j(e.$$.fragment,o),j(n.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),Z(n.$$.fragment,o),i=!1},d(o){o&&V(t),he(e,o),he(n,o)}}}function IP(r){let e,t,n,i,o,c,a=Rn(r[1]),d=[];for(let y=0;y<a.length;y+=1)d[y]=lb(ab(r,a,y));const p=y=>Z(d[y],1,1,()=>{d[y]=null});return o=new dr({props:{data:r[0],generateId:!0,$$slots:{default:[EP]},$$scope:{ctx:r}}}),{c(){e=U("p"),e.textContent="Choose a boundary below or on the map to begin sketching:",t=oe(),n=U("ul");for(let y=0;y<d.length;y+=1)d[y].c();i=oe(),fe(o.$$.fragment),st(n,"columns","3")},m(y,_){q(y,e,_),q(y,t,_),q(y,n,_);for(let w=0;w<d.length;w+=1)d[w]&&d[w].m(n,null);q(y,i,_),ue(o,y,_),c=!0},p(y,[_]){if(_&10){a=Rn(y[1]);let T;for(T=0;T<a.length;T+=1){const M=ab(y,a,T);d[T]?(d[T].p(M,_),j(d[T],1)):(d[T]=lb(M),d[T].c(),j(d[T],1),d[T].m(n,null))}for(en(),T=a.length;T<d.length;T+=1)p(T);tn()}const w={};_&1&&(w.data=y[0]),_&4096&&(w.$$scope={dirty:_,ctx:y}),o.$set(w)},i(y){if(!c){for(let _=0;_<a.length;_+=1)j(d[_]);j(o.$$.fragment,y),c=!0}},o(y){d=d.filter(Boolean);for(let _=0;_<d.length;_+=1)Z(d[_]);Z(o.$$.fragment,y),c=!1},d(y){y&&(V(e),V(t),V(n),V(i)),di(d,y),he(o,y)}}}function AP(r,e,t){let n,i;at(r,an,_=>t(6,n=_)),at(r,Qs,_=>t(7,i=_));let{activityIndicatorText:o}=e,c={type:"FeatureCollection",features:[]},a=[];Ls(async()=>{let _=await fetch(CP);t(0,c=await _.json());for(let w of c.features)a.push(w.properties.name);a.sort(),t(1,a)});function d(_){let w=_.detail.features[0].properties;p(`${w.kind}_${w.name}`)}async function p(_){let w,T=!1;for(;!T;){let M=w||i.nextAvailableProjectName(ch(_));if(w=window.prompt(`Please pick a project name to create in ${ch(_)}`,M),w===null)return;if(w=w.trim(),w===""){window.alert("Project name cannot be blank; Please pick a name or cancel.");continue}t(4,o=`Loading pre-clipped OSM area ${ch(_)}`);try{let $=i.createEmptyProject(w,_);await xh($),Nt(an,n={mode:"add-neighbourhood"},n),T=!0}catch($){window.alert($)}t(4,o="")}}const y=_=>p(`LAD_${_}`);return r.$$set=_=>{"activityIndicatorText"in _&&t(4,o=_.activityIndicatorText)},[c,a,d,p,o,y]}class PP extends Lt{constructor(e){super(),Mt(this,e,AP,IP,vt,{activityIndicatorText:4})}}function zP(r){let e,t,n,i,o,c;return{c(){e=U("label"),t=U("strong"),t.textContent="Load a project from a file",n=oe(),i=U("input"),de(i,"type","file"),st(e,"margin-top","16px")},m(a,d){q(a,e,d),R(e,t),R(e,n),R(e,i),r[3](i),o||(c=wt(i,"change",r[1]),o=!0)},p:et,i:et,o:et,d(a){a&&V(e),r[3](null),o=!1,c()}}}function DP(r,e,t){let n;at(r,an,d=>t(4,n=d));let{loading:i}=e,o;async function c(d){let p=o.files[0].name;t(2,i=`Loading from file ${p}`);let y=await o.files[0].text(),_=JSON.parse(y),w,T,M;_.app_focus&&(console.assert(_.app_focus=="global"||_.app_focus=="cnt"),w=_.app_focus),_.study_area_name&&(T=_.study_area_name),_.project_name&&(M=_.project_name),(!_.app_focus||!_.project_name)&&(_.study_area_name&&_.study_area_name.startsWith("LAD_")?(w="cnt",M=I0(_m(p,`ltn_cnt_${_.study_area_name}_`),".geojson")):(w="global",M=I0(_m(p,"ltn_"),".geojson"))),M=M,w=w;let $=Gm.projectStorage(w);M=$.nextAvailableProjectName(M),_.project_name=M,_.app_focus=w,_.study_area_name=T;let P=$.createProject(_);await xh(P),Nt(an,n={mode:"pick-neighbourhood"},n),t(2,i="")}function a(d){hn[d?"unshift":"push"](()=>{o=d,t(0,o)})}return r.$$set=d=>{"loading"in d&&t(2,i=d.loading)},[o,c,i,a]}class $P extends Lt{constructor(e){super(),Mt(this,e,DP,zP,vt,{loading:2})}}function cb(r,e,t){const n=r.slice();return n[22]=e[t][0],n[23]=e[t][1],n}function ub(r,e,t){const n=r.slice();return n[26]=e[t].projectID,n[27]=e[t].projectName,n}function RP(r){let e;return{c(){e=U("div"),e.innerHTML='<nav aria-label="breadcrumb"><ul><li>Choose project</li></ul></nav>',de(e,"slot","top")},m(t,n){q(t,e,n)},p:et,d(t){t&&V(e)}}}function FP(r){let e;return{c(){e=U("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(t,n){q(t,e,n)},p:et,i:et,o:et,d(t){t&&V(e)}}}function BP(r){let e,t,n,i,o,c,a,d,p,y=r[2].length>0&&hb(r);const _=[jP,NP],w=[];function T(P,D){return P[5]=="global"?0:P[5]=="cnt"?1:-1}~(i=T(r))&&(o=w[i]=_[i](r));function M(P){r[16](P)}let $={};return r[1]!==void 0&&($.loading=r[1]),a=new $P({props:$}),hn.push(()=>In(a,"loading",M)),{c(){y&&y.c(),e=oe(),t=U("h1"),t.textContent="Start a new project",n=oe(),o&&o.c(),c=oe(),fe(a.$$.fragment)},m(P,D){y&&y.m(P,D),q(P,e,D),q(P,t,D),q(P,n,D),~i&&w[i].m(P,D),q(P,c,D),ue(a,P,D),p=!0},p(P,D){P[2].length>0?y?(y.p(P,D),D&4&&j(y,1)):(y=hb(P),y.c(),j(y,1),y.m(e.parentNode,e)):y&&(en(),Z(y,1,1,()=>{y=null}),tn());let I=i;i=T(P),i===I?~i&&w[i].p(P,D):(o&&(en(),Z(w[I],1,1,()=>{w[I]=null}),tn()),~i?(o=w[i],o?o.p(P,D):(o=w[i]=_[i](P),o.c()),j(o,1),o.m(c.parentNode,c)):o=null);const F={};!d&&D&2&&(d=!0,F.loading=P[1],En(()=>d=!1)),a.$set(F)},i(P){p||(j(y),j(o),j(a.$$.fragment,P),p=!0)},o(P){Z(y),Z(o),Z(a.$$.fragment,P),p=!1},d(P){P&&(V(e),V(t),V(n),V(c)),y&&y.d(P),~i&&w[i].d(P),he(a,P)}}}function hb(r){let e,t,n,i,o=Rn(r[2]),c=[];for(let d=0;d<o.length;d+=1)c[d]=db(cb(r,o,d));const a=d=>Z(c[d],1,1,()=>{c[d]=null});return{c(){e=U("h1"),e.textContent="Your projects",t=oe(),n=U("div");for(let d=0;d<c.length;d+=1)c[d].c();de(n,"class","project-list svelte-s5f8l2")},m(d,p){q(d,e,p),q(d,t,p),q(d,n,p);for(let y=0;y<c.length;y+=1)c[y]&&c[y].m(n,null);i=!0},p(d,p){if(p&452){o=Rn(d[2]);let y;for(y=0;y<o.length;y+=1){const _=cb(d,o,y);c[y]?(c[y].p(_,p),j(c[y],1)):(c[y]=db(_),c[y].c(),j(c[y],1),c[y].m(n,null))}for(en(),y=o.length;y<c.length;y+=1)a(y);tn()}},i(d){if(!i){for(let p=0;p<o.length;p+=1)j(c[p]);i=!0}},o(d){c=c.filter(Boolean);for(let p=0;p<c.length;p+=1)Z(c[p]);i=!1},d(d){d&&(V(e),V(t),V(n)),di(c,d)}}}function OP(r){let e=r[27]+"",t;return{c(){t=xe(e)},m(n,i){q(n,t,i)},p(n,i){i&4&&e!==(e=n[27]+"")&&Tt(t,e)},d(n){n&&V(t)}}}function fb(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M,$,P;function D(){return r[10](r[26],r[27])}n=new $n({props:{$$slots:{default:[OP]},$$scope:{ctx:r}}}),n.$on("click",D),a=new Zb({props:{color:"black"}});function I(){return r[11](r[26])}y=new Gb({props:{color:"black"}});function F(){return r[12](r[26],r[27])}T=new Hm({props:{color:"white"}});function N(){return r[13](r[26],r[27])}return{c(){e=U("li"),t=U("h3"),fe(n.$$.fragment),i=oe(),o=U("span"),c=U("button"),fe(a.$$.fragment),d=oe(),p=U("button"),fe(y.$$.fragment),_=oe(),w=U("button"),fe(T.$$.fragment),de(c,"class","outline icon-btn"),de(c,"title","Download project as GeoJSON"),de(p,"class","outline icon-btn"),de(p,"title","Rename project"),de(w,"class","icon-btn destructive"),de(w,"title","Delete project"),de(o,"class","actions"),de(e,"class","actionable-cell svelte-s5f8l2")},m(W,se){q(W,e,se),R(e,t),ue(n,t,null),R(e,i),R(e,o),R(o,c),ue(a,c,null),R(o,d),R(o,p),ue(y,p,null),R(o,_),R(o,w),ue(T,w,null),M=!0,$||(P=[wt(c,"click",I),wt(p,"click",F),wt(w,"click",N)],$=!0)},p(W,se){r=W;const J={};se&1073741828&&(J.$$scope={dirty:se,ctx:r}),n.$set(J)},i(W){M||(j(n.$$.fragment,W),j(a.$$.fragment,W),j(y.$$.fragment,W),j(T.$$.fragment,W),M=!0)},o(W){Z(n.$$.fragment,W),Z(a.$$.fragment,W),Z(y.$$.fragment,W),Z(T.$$.fragment,W),M=!1},d(W){W&&V(e),he(n),he(a),he(y),he(T),$=!1,pr(P)}}}function db(r){let e,t=ch(r[22])+"",n,i,o,c,a,d=Rn(r[23]),p=[];for(let _=0;_<d.length;_+=1)p[_]=fb(ub(r,d,_));const y=_=>Z(p[_],1,1,()=>{p[_]=null});return{c(){e=U("h2"),n=xe(t),i=oe(),o=U("ul");for(let _=0;_<p.length;_+=1)p[_].c();c=oe(),de(e,"class","study-area-name svelte-s5f8l2"),de(o,"class","navigable-list")},m(_,w){q(_,e,w),R(e,n),q(_,i,w),q(_,o,w);for(let T=0;T<p.length;T+=1)p[T]&&p[T].m(o,null);R(o,c),a=!0},p(_,w){if((!a||w&4)&&t!==(t=ch(_[22])+"")&&Tt(n,t),w&452){d=Rn(_[23]);let T;for(T=0;T<d.length;T+=1){const M=ub(_,d,T);p[T]?(p[T].p(M,w),j(p[T],1)):(p[T]=fb(M),p[T].c(),j(p[T],1),p[T].m(o,c))}for(en(),T=d.length;T<p.length;T+=1)y(T);tn()}},i(_){if(!a){for(let w=0;w<d.length;w+=1)j(p[w]);a=!0}},o(_){p=p.filter(Boolean);for(let w=0;w<p.length;w+=1)Z(p[w]);a=!1},d(_){_&&(V(e),V(i),V(o)),di(p,_)}}}function NP(r){let e,t,n;function i(c){r[15](c)}let o={};return r[1]!==void 0&&(o.activityIndicatorText=r[1]),e=new PP({props:o}),hn.push(()=>In(e,"activityIndicatorText",i)),{c(){fe(e.$$.fragment)},m(c,a){ue(e,c,a),n=!0},p(c,a){const d={};!t&&a&2&&(t=!0,d.activityIndicatorText=c[1],En(()=>t=!1)),e.$set(d)},i(c){n||(j(e.$$.fragment,c),n=!0)},o(c){Z(e.$$.fragment,c),n=!1},d(c){he(e,c)}}}function jP(r){let e,t,n;return{c(){e=U("button"),e.textContent="New project"},m(i,o){q(i,e,o),t||(n=wt(e,"click",r[14]),t=!0)},p:et,i:et,o:et,d(i){i&&V(e),t=!1,n()}}}function UP(r){let e,t,n,i;const o=[BP,FP],c=[];function a(d,p){return d[4]&&d[0]?0:1}return t=a(r),n=c[t]=o[t](r),{c(){e=U("div"),n.c(),de(e,"slot","sidebar")},m(d,p){q(d,e,p),c[t].m(e,null),i=!0},p(d,p){let y=t;t=a(d),t===y?c[t].p(d,p):(en(),Z(c[y],1,1,()=>{c[y]=null}),tn(),n=c[t],n?n.p(d,p):(n=c[t]=o[t](d),n.c()),j(n,1),n.m(e,null))},i(d){i||(j(n),i=!0)},o(d){Z(n),i=!1},d(d){d&&V(e),c[t].d()}}}function VP(r){let e,t,n,i;return e=new Sh({props:{loading:r[1]}}),n=new bo({props:{$$slots:{sidebar:[UP],top:[RP]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment)},m(o,c){ue(e,o,c),q(o,t,c),ue(n,o,c),i=!0},p(o,[c]){const a={};c&2&&(a.loading=o[1]),e.$set(a);const d={};c&1073741887&&(d.$$scope={dirty:c,ctx:o}),n.$set(d)},i(o){i||(j(e.$$.fragment,o),j(n.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),Z(n.$$.fragment,o),i=!1},d(o){o&&V(t),he(e,o),he(n,o)}}}function qP(r,e,t){let n,i,o,c,a,d,p;at(r,an,me=>t(3,n=me)),at(r,Qs,me=>t(17,i=me)),at(r,_l,me=>t(18,o=me)),at(r,yd,me=>t(19,c=me)),at(r,Ar,me=>t(20,a=me)),at(r,Ro,me=>t(4,d=me)),at(r,Fo,me=>t(5,p=me));let{wasmReady:y}=e,{firstLoad:_}=e,w="";if(Nt(Ar,a=null,a),Nt(yd,c=null,c),Nt(_l,o=void 0,o),_){let Ie=new URLSearchParams(window.location.search).get("project");Ie&&M(Ie)}else{let me=new URL(window.location.href);me.searchParams.delete("project"),window.history.replaceState(null,"",me.toString())}let T=i.studyAreaProjects();function M(me){let Ie=me;try{let Q=i.projectName(Ie);if(!Q){console.error(`Project ${Ie} from URL not found`);return}D(Ie,Q)}catch{console.error(`Error trying to fetch project from URL: ${Ie}`)}}function $(me,Ie){window.confirm(`Really delete project ${Ie}? You can't undo this.`)&&(i.removeProject(me),t(2,T=i.studyAreaProjects()))}function P(me,Ie){let Q=window.prompt(`Rename project ${Ie} to what?`,Ie);if(Q){try{i.renameProject(me,Q)}catch(ae){window.alert(`Couldn't rename project: ${ae}`)}t(2,T=i.studyAreaProjects())}}async function D(me,Ie){t(1,w=`Loading project ${Ie}`),await xh(me),Nt(an,n={mode:"pick-neighbourhood"},n),t(1,w="")}const I=(me,Ie)=>D(me,Ie),F=me=>vv(me),N=(me,Ie)=>P(me,Ie),W=(me,Ie)=>$(me,Ie),se=()=>Nt(an,n={mode:"new-project"},n);function J(me){w=me,t(1,w)}function ee(me){w=me,t(1,w)}return r.$$set=me=>{"wasmReady"in me&&t(0,y=me.wasmReady),"firstLoad"in me&&t(9,_=me.firstLoad)},[y,w,T,n,d,p,$,P,D,_,I,F,N,W,se,J,ee]}class ZP extends Lt{constructor(e){super(),Mt(this,e,qP,VP,vt,{wasmReady:0,firstLoad:9})}}function GP(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function HP(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function WP(r){let e;return{c(){e=xe("Editing")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function KP(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M;return o=new $n({props:{$$slots:{default:[GP]},$$scope:{ctx:r}}}),o.$on("click",Bo),d=new $n({props:{$$slots:{default:[HP]},$$scope:{ctx:r}}}),d.$on("click",r[6]),_=new $n({props:{$$slots:{default:[WP]},$$scope:{ctx:r}}}),_.$on("click",r[3]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),fe(o.$$.fragment),c=oe(),a=U("li"),fe(d.$$.fragment),p=oe(),y=U("li"),fe(_.$$.fragment),w=oe(),T=U("li"),T.textContent="Viewing shortcuts",de(t,"aria-label","breadcrumb"),de(e,"slot","top")},m($,P){q($,e,P),R(e,t),R(t,n),R(n,i),ue(o,i,null),R(n,c),R(n,a),ue(d,a,null),R(n,p),R(n,y),ue(_,y,null),R(n,w),R(n,T),M=!0},p($,P){const D={};P&512&&(D.$$scope={dirty:P,ctx:$}),o.$set(D);const I={};P&512&&(I.$$scope={dirty:P,ctx:$}),d.$set(I);const F={};P&512&&(F.$$scope={dirty:P,ctx:$}),_.$set(F)},i($){M||(j(o.$$.fragment,$),j(d.$$.fragment,$),j(_.$$.fragment,$),M=!0)},o($){Z(o.$$.fragment,$),Z(d.$$.fragment,$),Z(_.$$.fragment,$),M=!1},d($){$&&V(e),he(o),he(d),he(_)}}}function XP(r){let e,t,n,i,o,c,a,d,p,y,_=yr(r[0].gj.features[r[0].shortcutIndex].properties).directness.toFixed(1)+"",w,T,M,$,P,D;function I(N){r[5](N)}let F={list:r[0].gj.features};return r[0].shortcutIndex!==void 0&&(F.idx=r[0].shortcutIndex),o=new Cd({props:F}),hn.push(()=>In(o,"idx",I)),{c(){e=U("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending on main (busy)
        roads, then cutting through smaller streets. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,t=oe(),n=U("button"),n.textContent="Pick a different road",i=oe(),fe(o.$$.fragment),a=oe(),d=U("p"),p=xe("This shortcut is "),y=U("b"),w=xe(_),T=xe("x"),M=xe(`
        the length of the shortest route using all roads, not just this neighbourhood`)},m(N,W){q(N,e,W),q(N,t,W),q(N,n,W),q(N,i,W),ue(o,N,W),q(N,a,W),q(N,d,W),R(d,p),R(d,y),R(y,w),R(y,T),R(d,M),$=!0,P||(D=wt(n,"click",r[4]),P=!0)},p(N,W){const se={};W&1&&(se.list=N[0].gj.features),!c&&W&1&&(c=!0,se.idx=N[0].shortcutIndex,En(()=>c=!1)),o.$set(se),(!$||W&1)&&_!==(_=yr(N[0].gj.features[N[0].shortcutIndex].properties).directness.toFixed(1)+"")&&Tt(w,_)},i(N){$||(j(o.$$.fragment,N),$=!0)},o(N){Z(o.$$.fragment,N),$=!1},d(N){N&&(V(e),V(t),V(n),V(i),V(a),V(d)),he(o,N),P=!1,D()}}}function JP(r){let e;return{c(){e=U("p"),e.textContent="Click a road to see shortcuts"},m(t,n){q(t,e,n)},p:et,i:et,o:et,d(t){t&&V(e)}}}function YP(r){let e,t,n,i,o,c;t=new na({}),t.$on("click",r[3]);const a=[JP,XP],d=[];function p(y,_){return y[0].state=="neutral"?0:y[0].state=="chose-road"?1:-1}return~(i=p(r))&&(o=d[i]=a[i](r)),{c(){e=U("div"),fe(t.$$.fragment),n=oe(),o&&o.c(),de(e,"slot","sidebar")},m(y,_){q(y,e,_),ue(t,e,null),R(e,n),~i&&d[i].m(e,null),c=!0},p(y,_){let w=i;i=p(y),i===w?~i&&d[i].p(y,_):(o&&(en(),Z(d[w],1,1,()=>{d[w]=null}),tn()),~i?(o=d[i],o?o.p(y,_):(o=d[i]=a[i](y),o.c()),j(o,1),o.m(e,null)):o=null)},i(y){c||(j(t.$$.fragment,y),j(o),c=!0)},o(y){Z(t.$$.fragment,y),Z(o),c=!1},d(y){y&&V(e),he(t),~i&&d[i].d()}}}function QP(r){let e,t;return e=new Ih({props:{interactive:!1}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p:et,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function ez(r){let e,t;return e=new Ih({props:{onClickLine:r[2],$$slots:{"line-popup":[iz]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&512&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function tz(r){let e,t,n=(r[8].name??"unnamed road")+"",i;return{c(){e=U("p"),t=xe("Main road: "),i=xe(n)},m(o,c){q(o,e,c),R(e,t),R(e,i)},p(o,c){c&256&&n!==(n=(o[8].name??"unnamed road")+"")&&Tt(i,n)},d(o){o&&V(e)}}}function nz(r){let e,t=r[8].shortcuts+"",n,i,o=(r[8].name??"unnamed road")+"",c;return{c(){e=U("p"),n=xe(t),i=xe(" shortcuts through "),c=xe(o)},m(a,d){q(a,e,d),R(e,n),R(e,i),R(e,c)},p(a,d){d&256&&t!==(t=a[8].shortcuts+"")&&Tt(n,t),d&256&&o!==(o=(a[8].name??"unnamed road")+"")&&Tt(c,o)},d(a){a&&V(e)}}}function rz(r){let e;function t(o,c){if(o[8].kind=="interior_road")return nz;if(o[8].kind=="main_road")return tz}let n=t(r),i=n&&n(r);return{c(){i&&i.c(),e=Xn()},m(o,c){i&&i.m(o,c),q(o,e,c)},p(o,c){n===(n=t(o))&&i?i.p(o,c):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&V(e),i&&i.d(o)}}}function iz(r){let e,t,n;return t=new ui({props:{openOn:"hover",$$slots:{default:[rz,({props:i})=>({8:i}),({props:i})=>i?256:0]},$$scope:{ctx:r}}}),{c(){e=U("div"),fe(t.$$.fragment),de(e,"slot","line-popup")},m(i,o){q(i,e,o),ue(t,e,null),n=!0},p(i,o){const c={};o&768&&(c.$$scope={dirty:o,ctx:i}),t.$set(c)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),he(t)}}}function oz(r){let e,t,n,i,o,c,a,d,p,y;e=new zd({}),n=new Pd({}),o=new Dd({});const _=[ez,QP],w=[];function T(M,$){return M[0].state=="neutral"?0:M[0].state=="chose-road"?1:-1}return~(a=T(r))&&(d=w[a]=_[a](r)),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment),i=oe(),fe(o.$$.fragment),c=oe(),d&&d.c(),p=Xn()},m(M,$){ue(e,M,$),q(M,t,$),ue(n,M,$),q(M,i,$),ue(o,M,$),q(M,c,$),~a&&w[a].m(M,$),q(M,p,$),y=!0},p(M,$){let P=a;a=T(M),a===P?~a&&w[a].p(M,$):(d&&(en(),Z(w[P],1,1,()=>{w[P]=null}),tn()),~a?(d=w[a],d?d.p(M,$):(d=w[a]=_[a](M),d.c()),j(d,1),d.m(p.parentNode,p)):d=null)},i(M){y||(j(e.$$.fragment,M),j(n.$$.fragment,M),j(o.$$.fragment,M),j(d),y=!0)},o(M){Z(e.$$.fragment,M),Z(n.$$.fragment,M),Z(o.$$.fragment,M),Z(d),y=!1},d(M){M&&(V(t),V(i),V(c),V(p)),he(e,M),he(n,M),he(o,M),~a&&w[a].d(M)}}}function pb(r){let e,t,n,i,o,c,a,d;return e=new dr({props:{data:r[0].gj.features[r[0].shortcutIndex],$$slots:{default:[sz]},$$scope:{ctx:r}}}),n=new dr({props:{data:r[0].roadGj,$$slots:{default:[az]},$$scope:{ctx:r}}}),o=new yl({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[0],$$slots:{default:[lz]},$$scope:{ctx:r}}}),a=new yl({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[r[0].gj.features[r[0].shortcutIndex].geometry.coordinates.length-1],$$slots:{default:[cz]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment),i=oe(),fe(o.$$.fragment),c=oe(),fe(a.$$.fragment)},m(p,y){ue(e,p,y),q(p,t,y),ue(n,p,y),q(p,i,y),ue(o,p,y),q(p,c,y),ue(a,p,y),d=!0},p(p,y){const _={};y&1&&(_.data=p[0].gj.features[p[0].shortcutIndex]),y&512&&(_.$$scope={dirty:y,ctx:p}),e.$set(_);const w={};y&1&&(w.data=p[0].roadGj),y&512&&(w.$$scope={dirty:y,ctx:p}),n.$set(w);const T={};y&1&&(T.lngLat=p[0].gj.features[p[0].shortcutIndex].geometry.coordinates[0]),y&512&&(T.$$scope={dirty:y,ctx:p}),o.$set(T);const M={};y&1&&(M.lngLat=p[0].gj.features[p[0].shortcutIndex].geometry.coordinates[p[0].gj.features[p[0].shortcutIndex].geometry.coordinates.length-1]),y&512&&(M.$$scope={dirty:y,ctx:p}),a.$set(M)},i(p){d||(j(e.$$.fragment,p),j(n.$$.fragment,p),j(o.$$.fragment,p),j(a.$$.fragment,p),d=!0)},o(p){Z(e.$$.fragment,p),Z(n.$$.fragment,p),Z(o.$$.fragment,p),Z(a.$$.fragment,p),d=!1},d(p){p&&(V(t),V(i),V(c)),he(e,p),he(n,p),he(o,p),he(a,p)}}}function sz(r){let e,t;const n=[mn("shortcuts"),{paint:{"line-width":10,"line-color":"cyan"}}];let i={};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new sr({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function az(r){let e,t;const n=[mn("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let i={};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new sr({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function lz(r){let e;return{c(){e=xe("A")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function cz(r){let e;return{c(){e=xe("B")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function uz(r){let e,t,n,i,o,c;t=new Ah({props:{$$slots:{default:[oz]},$$scope:{ctx:r}}});let a=r[0].state=="chose-road"&&pb(r);return o=new Oa({}),{c(){e=U("div"),fe(t.$$.fragment),n=oe(),a&&a.c(),i=oe(),fe(o.$$.fragment),de(e,"slot","map")},m(d,p){q(d,e,p),ue(t,e,null),R(e,n),a&&a.m(e,null),R(e,i),ue(o,e,null),c=!0},p(d,p){const y={};p&513&&(y.$$scope={dirty:p,ctx:d}),t.$set(y),d[0].state=="chose-road"?a?(a.p(d,p),p&1&&j(a,1)):(a=pb(d),a.c(),j(a,1),a.m(e,i)):a&&(en(),Z(a,1,1,()=>{a=null}),tn())},i(d){c||(j(t.$$.fragment,d),j(a),j(o.$$.fragment,d),c=!0)},o(d){Z(t.$$.fragment,d),Z(a),Z(o.$$.fragment,d),c=!1},d(d){d&&V(e),he(t),a&&a.d(),he(o)}}}function hz(r){let e,t;return e=new bo({props:{$$slots:{map:[uz],sidebar:[YP],top:[KP]},$$scope:{ctx:r}}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,[i]){const o={};i&515&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function fz(r,e,t){let n,i;at(r,an,_=>t(1,n=_)),at(r,Ar,_=>t(7,i=_));let o={state:"neutral"};function c(_,w){let T=i.getShortcutsCrossingRoad(_.properties.id);if(T.features.length==0){window.alert("No shortcuts here");return}t(0,o={state:"chose-road",roadGj:_,gj:T,shortcutIndex:0})}function a(){Nt(an,n={mode:"neighbourhood"},n)}const d=()=>t(0,o={state:"neutral"});function p(_){r.$$.not_equal(o.shortcutIndex,_)&&(o.shortcutIndex=_,t(0,o))}return[o,n,c,a,d,p,()=>Nt(an,n={mode:"pick-neighbourhood"},n)]}class dz extends Lt{constructor(e){super(),Mt(this,e,fz,hz,vt,{})}}function pz(r){let e,t,n,i,o,c,a,d,p;return i=new C8({}),{c(){e=U("div"),t=U("button"),t.innerHTML=`<img src="${cx}" alt="A/B Street logo"/>`,n=oe(),fe(i.$$.fragment),o=oe(),c=U("span"),de(t,"class","outline"),st(c,"width","100%"),de(e,"slot","top"),de(e,"class","pico"),st(e,"display","flex"),st(e,"align-items","center"),st(e,"gap","8px")},m(y,_){q(y,e,_),R(e,t),R(e,n),ue(i,e,null),R(e,o),R(e,c),r[23](c),a=!0,d||(p=wt(t,"click",r[22]),d=!0)},p:et,i(y){a||(j(i.$$.fragment,y),a=!0)},o(y){Z(i.$$.fragment,y),a=!1},d(y){y&&V(e),he(i),r[23](null),d=!1,p()}}}function mb(r){let e,t,n,i,o,c;return n=new PS({props:{map:yr(r[7]),maptilerBasemap:r[9]}}),{c(){e=U("button"),e.textContent="Zoom to fit study area",t=oe(),fe(n.$$.fragment),de(e,"class","secondary")},m(a,d){q(a,e,d),q(a,t,d),ue(n,a,d),i=!0,o||(c=wt(e,"click",r[12]),o=!0)},p(a,d){const p={};d&128&&(p.map=yr(a[7])),d&512&&(p.maptilerBasemap=a[9]),n.$set(p)},i(a){i||(j(n.$$.fragment,a),i=!0)},o(a){Z(n.$$.fragment,a),i=!1},d(a){a&&(V(e),V(t)),he(n,a),o=!1,c()}}}function mz(r){let e,t,n,i,o,c,a=r[6]&&mb(r);return{c(){e=U("div"),t=U("div"),n=oe(),i=U("hr"),o=oe(),a&&a.c(),de(e,"class","pico"),de(e,"slot","left")},m(d,p){q(d,e,p),R(e,t),r[21](t),R(e,n),R(e,i),R(e,o),a&&a.m(e,null),c=!0},p(d,p){d[6]?a?(a.p(d,p),p&64&&j(a,1)):(a=mb(d),a.c(),j(a,1),a.m(e,null)):a&&(en(),Z(a,1,1,()=>{a=null}),tn())},i(d){c||(j(a),c=!0)},o(d){Z(a),c=!1},d(d){d&&V(e),r[21](null),a&&a.d()}}}function gz(r){return{c:et,m:et,p:et,i:et,o:et,d:et}}function _z(r){let e,t,n;function i(c){r[19](c)}let o={style:r[25],hash:!0,bounds:r[5],maxZoom:19,images:[{id:lo.walkCycleOnly.filterType,url:lo.walkCycleOnly.iconURL},{id:lo.noEntry.filterType,url:lo.noEntry.iconURL},{id:lo.busGate.filterType,url:lo.busGate.iconURL},{id:lo.schoolStreet.filterType,url:lo.schoolStreet.iconURL},{id:"diagonal_filter",url:"/ltn//filters/diagonal_filter_icon.png"},{id:"no_straight_turn",url:"/ltn//filters/no_straight_turn.png"},{id:"no_left_turn",url:"/ltn//filters/no_left_turn.png"},{id:"no_right_turn",url:"/ltn//filters/no_right_turn.png"},{id:"no_u_left_to_right_turn",url:"/ltn//filters/no_u_left_to_right_turn.png"},{id:"no_u_right_to_left_turn",url:"/ltn//filters/no_u_right_to_left_turn.png"},{id:"oneway_arrow",url:lx},{id:"border_entry_arrow",url:ax,options:{sdf:!0}},{id:"national_rail",url:Sb}],$$slots:{default:[zz]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.map=r[0]),e=new Y3({props:o}),hn.push(()=>In(e,"map",i)),e.$on("error",r[20]),{c(){fe(e.$$.fragment)},m(c,a){ue(e,c,a),n=!0},p(c,a){const d={};a&512&&(d.style=c[25]),a&32&&(d.bounds=c[5]),a&67109977&&(d.$$scope={dirty:a,ctx:c}),!t&&a&1&&(t=!0,d.map=c[0],En(()=>t=!1)),e.$set(d)},i(c){n||(j(e.$$.fragment,c),n=!0)},o(c){Z(e.$$.fragment,c),n=!1},d(c){he(e,c)}}}function yz(r){let e,t;return e=new SP({}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p:et,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function bz(r){let e,t;return e=new ZP({props:{wasmReady:r[4],firstLoad:r[10].firstLoad}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&16&&(o.wasmReady=n[4]),i&1024&&(o.firstLoad=n[10].firstLoad),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function gb(r){let e,t,n,i,o,c,a,d;e=new q6({}),n=new dr({props:{data:r[6].getInvertedBoundary(),$$slots:{default:[vz]},$$scope:{ctx:r}}});const p=[Pz,Az,Iz,Ez,Lz,Mz,Tz,Cz,Sz,kz,xz,wz],y=[];function _(w,T){return w[10].mode=="pick-neighbourhood"?0:w[10].mode=="set-boundary"?1:w[10].mode=="add-neighbourhood"?2:w[10].mode=="neighbourhood"?3:w[10].mode=="view-shortcuts"?4:w[10].mode=="impact-one-destination"?5:w[10].mode=="route"?6:w[10].mode=="predict-impact"?7:w[10].mode=="impact-detail"?8:w[10].mode=="debug-neighbourhood"?9:w[10].mode=="debug-intersections"?10:w[10].mode=="debug-demand"?11:-1}return~(o=_(r))&&(c=y[o]=p[o](r)),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment),i=oe(),c&&c.c(),a=Xn()},m(w,T){ue(e,w,T),q(w,t,T),ue(n,w,T),q(w,i,T),~o&&y[o].m(w,T),q(w,a,T),d=!0},p(w,T){const M={};T&64&&(M.data=w[6].getInvertedBoundary()),T&67108864&&(M.$$scope={dirty:T,ctx:w}),n.$set(M);let $=o;o=_(w),o===$?~o&&y[o].p(w,T):(c&&(en(),Z(y[$],1,1,()=>{y[$]=null}),tn()),~o?(c=y[o],c?c.p(w,T):(c=y[o]=p[o](w),c.c()),j(c,1),c.m(a.parentNode,a)):c=null)},i(w){d||(j(e.$$.fragment,w),j(n.$$.fragment,w),j(c),d=!0)},o(w){Z(e.$$.fragment,w),Z(n.$$.fragment,w),Z(c),d=!1},d(w){w&&(V(t),V(i),V(a)),he(e,w),he(n,w),~o&&y[o].d(w)}}}function vz(r){let e,t;const n=[mn("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let i={};for(let o=0;o<n.length;o+=1)i=Bt(i,n[o]);return e=new Hi({props:i}),{c(){fe(e.$$.fragment)},m(o,c){ue(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function wz(r){let e,t;return e=new gL({}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p:et,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function xz(r){let e,t;return e=new TL({}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p:et,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function kz(r){let e,t;return e=new vE({}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p:et,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Sz(r){let e,t;return e=new KI({props:{road:r[10].road}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.road=n[10].road),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Cz(r){let e,t;return e=new KA({}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p:et,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Tz(r){let e,t;return e=new f8({props:{prevMode:r[10].prevMode}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.prevMode=n[10].prevMode),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Mz(r){let e,t;return e=new gA({}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p:et,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Lz(r){let e,t;return e=new dz({}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p:et,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Ez(r){let e,t;return e=new BI({}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p:et,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Iz(r){let e,t;return e=new oL({}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p:et,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Az(r){let e,t;return e=new v8({props:{name:r[10].name,existing:r[10].existing}}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.name=n[10].name),i&1024&&(o.existing=n[10].existing),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Pz(r){let e,t;return e=new RA({}),{c(){fe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p:et,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function zz(r){let e,t,n,i,o,c,a,d,p,y,_,w,T,M;e=new Jb({}),n=new Yb({}),o=new wT({props:{map:r[0],apiKey:qb,country:void 0}});const $=[bz,yz],P=[];function D(F,N){return F[10].mode=="title"?0:F[10].mode=="new-project"?1:-1}~(p=D(r))&&(y=P[p]=$[p](r));let I=r[6]&&gb(r);return T=new lS({}),{c(){fe(e.$$.fragment),t=oe(),fe(n.$$.fragment),i=oe(),fe(o.$$.fragment),c=oe(),a=U("div"),d=oe(),y&&y.c(),_=oe(),I&&I.c(),w=oe(),fe(T.$$.fragment)},m(F,N){ue(e,F,N),q(F,t,N),ue(n,F,N),q(F,i,N),ue(o,F,N),q(F,c,N),q(F,a,N),r[18](a),q(F,d,N),~p&&P[p].m(F,N),q(F,_,N),I&&I.m(F,N),q(F,w,N),ue(T,F,N),M=!0},p(F,N){const W={};N&1&&(W.map=F[0]),o.$set(W);let se=p;p=D(F),p===se?~p&&P[p].p(F,N):(y&&(en(),Z(P[se],1,1,()=>{P[se]=null}),tn()),~p?(y=P[p],y?y.p(F,N):(y=P[p]=$[p](F),y.c()),j(y,1),y.m(_.parentNode,_)):y=null),F[6]?I?(I.p(F,N),N&64&&j(I,1)):(I=gb(F),I.c(),j(I,1),I.m(w.parentNode,w)):I&&(en(),Z(I,1,1,()=>{I=null}),tn())},i(F){M||(j(e.$$.fragment,F),j(n.$$.fragment,F),j(o.$$.fragment,F),j(y),j(I),j(T.$$.fragment,F),M=!0)},o(F){Z(e.$$.fragment,F),Z(n.$$.fragment,F),Z(o.$$.fragment,F),Z(y),Z(I),Z(T.$$.fragment,F),M=!1},d(F){F&&(V(t),V(i),V(c),V(a),V(d),V(_),V(w)),he(e,F),he(n,F),he(o,F),r[18](null),~p&&P[p].d(F),I&&I.d(F),he(T,F)}}}function Dz(r){return{c:et,m:et,p:et,i:et,o:et,d:et}}function $z(r){let e,t,n,i={ctx:r,current:null,token:null,hasCatch:!1,pending:Dz,then:_z,catch:gz,value:25,blocks:[,,,]};return B_(t=r[13](r[9]),i),{c(){e=U("div"),i.block.c(),de(e,"slot","main"),st(e,"position","relative"),st(e,"width","100%"),st(e,"height","100%")},m(o,c){q(o,e,c),i.block.m(e,i.anchor=null),i.mount=()=>e,i.anchor=null,n=!0},p(o,c){r=o,i.ctx=r,c&512&&t!==(t=r[13](r[9]))&&B_(t,i)||nx(i,r,c)},i(o){n||(j(i.block),n=!0)},o(o){for(let c=0;c<3;c+=1){const a=i.blocks[c];Z(a)}n=!1},d(o){o&&V(e),i.block.d(),i.token=null,i=null}}}function Rz(r){let e,t,n,i,o,c,a;return t=new _k({}),o=new oM({props:{$$slots:{main:[$z],left:[mz],top:[pz]},$$scope:{ctx:r}}}),{c(){e=U("div"),fe(t.$$.fragment),n=oe(),i=U("div"),fe(o.$$.fragment),de(e,"class","pico"),de(i,"class",c="app-focus-"+r[8])},m(d,p){q(d,e,p),ue(t,e,null),q(d,n,p),q(d,i,p),ue(o,i,null),a=!0},p(d,[p]){const y={};p&67112703&&(y.$$scope={dirty:p,ctx:d}),o.$set(y),(!a||p&256&&c!==(c="app-focus-"+d[8]))&&de(i,"class",c)},i(d){a||(j(t.$$.fragment,d),j(o.$$.fragment,d),a=!0)},o(d){Z(t.$$.fragment,d),Z(o.$$.fragment,d),a=!1},d(d){d&&(V(e),V(n),V(i)),he(t),he(o)}}}function Fz(r,e,t){let n,i,o,c,a,d,p,y,_,w;at(r,Pm,ae=>t(15,n=ae)),at(r,Am,ae=>t(16,i=ae)),at(r,Im,ae=>t(17,o=ae)),at(r,Ar,ae=>t(6,c=ae)),at(r,Ro,ae=>t(7,a=ae)),at(r,hm,ae=>t(24,d=ae)),at(r,Fo,ae=>t(8,p=ae)),at(r,sm,ae=>t(9,y=ae)),at(r,an,ae=>t(10,_=ae)),at(r,ud,ae=>t(11,w=ae));let{appFocus:T="global"}=e;Fo.set(T);let M=!1;Ls(async()=>{await Nv(),await Ib(),t(4,M=!0);try{(await fetch("/severance_pbfs/areas.json")).ok&&(Nt(hm,d=!0,d),console.log("Using local cache, not od2net.org"))}catch{}});let $=null;function P(){a.fitBounds(c.getBounds(),{animate:!1})}let D,I,F,N;T=="cnt"&&(N=[-8.943,54.631,-.901,59.489]);async function W(ae){return ae=="streets-v2"?hM:`https://api.maptiler.com/maps/${ae}/style.json?key=${qb}`}function se(ae){hn[ae?"unshift":"push"](()=>{F=ae,t(3,F),t(15,n)})}function J(ae){$=ae,t(0,$)}const ee=ae=>{console.log(ae.detail.error)};function me(ae){hn[ae?"unshift":"push"](()=>{I=ae,t(2,I),t(16,i)})}const Ie=()=>Nt(ud,w=!0,w);function Q(ae){hn[ae?"unshift":"push"](()=>{D=ae,t(1,D),t(17,o)})}return r.$$set=ae=>{"appFocus"in ae&&t(14,T=ae.appFocus)},r.$$.update=()=>{r.$$.dirty&1&&$&&Ro.set($),r.$$.dirty&131074&&D&&o&&(t(1,D.innerHTML="",D),D.appendChild(o)),r.$$.dirty&65540&&I&&i&&(t(2,I.innerHTML="",I),I.appendChild(i)),r.$$.dirty&32776&&F&&n&&(t(3,F.innerHTML="",F),F.appendChild(n))},[$,D,I,F,M,N,c,a,p,y,_,w,P,W,T,n,i,o,se,J,ee,me,Ie,Q]}class Gz extends Lt{constructor(e){super(),Mt(this,e,Fz,Rz,vt,{appFocus:14})}}export{Gz as A};
